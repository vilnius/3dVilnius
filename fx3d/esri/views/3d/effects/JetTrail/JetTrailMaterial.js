//>>built
require({cache:{"url:fx3d/views/3d/effects/JetTrail/JetTrailMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\x3c!-- Copyright @ 2017 Esri. All rights reserved under the copyright laws of the United States and applicable international laws, treaties, and conventions. --\x3e\x3csnippets\x3e\x3csnippet name\x3d"jetTrailFS"\x3e\x3c![CDATA[\r\n#ifdef GL_ES\r\nprecision mediump float;\r\n#endif\r\nuniform sampler2D lm;uniform float mo;uniform vec3 ei;uniform vec4 io;uniform vec4 ls;uniform vec4 po;uniform vec3 es;varying vec4 hd;varying vec3 gg;varying vec3 dg;varying vec4 gd;void main(){float a\x3dmo*0.01;gl_FragColor.rgb\x3dhd.xyz;gl_FragColor.a\x3d1.0;if(gd.x\x3c2.0){gl_FragColor\x3d(texture2D(lm,gl_PointCoord)*gl_FragColor)+vec4(0.35,0.35,0.35,0.0);gl_FragColor.a*\x3da;}else if(gd.x\x3e2.0){if(gd.w\x3e0.0){discard;}else{gl_FragColor.a*\x3d(a*(gd.y)/gd.z);}}else{discard;}if(gl_FragColor.r\x3c\x3d1e-6\x26\x26gl_FragColor.g\x3c\x3d1e-6\x26\x26gl_FragColor.b\x3c\x3d1e-6){gl_FragColor.rgb\x3dvec3(0.1,0.1,0.1);}}]]\x3e\x3c/snippet\x3e\x3csnippet name\x3d"jetTrailPulseFS"\x3e\x3c![CDATA[\r\n#ifdef GL_ES\r\nprecision mediump float;\r\n#endif\r\nuniform float mo;uniform vec3 ei;uniform vec4 io;uniform vec4 ls;uniform vec4 po;uniform vec3 es;varying vec4 hd;varying vec3 gg;varying vec3 dg;varying vec3 gd;void main(){float a\x3dmo*0.01;gl_FragColor.rgb\x3dhd.xyz;gl_FragColor.a\x3d1.0;float b\x3d(length(gd.yz)-gd.x*0.7)/(gd.x*0.3);if(b\x3e-1.0){gl_FragColor.a*\x3d(a*b);}else{gl_FragColor.a\x3d0.0;}if(gl_FragColor.r\x3c\x3d1e-6\x26\x26gl_FragColor.g\x3c\x3d1e-6\x26\x26gl_FragColor.b\x3c\x3d1e-6){gl_FragColor.rgb\x3dvec3(0.1,0.1,0.1);}}]]\x3e\x3c/snippet\x3e\x3csnippet name\x3d"jetTrailPulseVS"\x3e\x3c![CDATA[attribute vec2 $auxpos1;attribute vec3 $auxpos2;uniform mat4 lo;uniform mat4 ml;uniform sampler2D so;uniform vec2 im;uniform float oo;uniform vec2 ol;uniform float ms;uniform vec2 mi;uniform sampler2D si;varying vec4 hd;varying vec3 gg;varying vec3 dg;varying vec3 gd; $linearInterpolator  $lonlat2position  $translationMat  $localTrans  $expoEaseOut void main(void){float a\x3dfract($auxpos1.y/im.x);float b\x3dfloor($auxpos1.y/im.y)/im.y;float c\x3d(texture2D(so,vec2(a,b))).r;float d\x3dmod(ms,oo);c\x3dgetExpoEaseOutValue(d,0.0,c,oo);float e\x3dgetLinearValue(mi,c);vec3 f;vec2 g;float h\x3dgetScope(ol,e);if(h\x3cEpsilon){h\x3d1000.0;}if($auxpos1.x\x3e\x3d0.0){g\x3dvec2(h*cos($auxpos1.x),h*sin($auxpos1.x));}else{g\x3dvec2(0.0,0.0);}\r\n#ifdef GLOBAL\r\nmat4 i\x3dgetTransMat($auxpos2);f\x3d(i*vec4(g,0.0,1.0)).xyz;gg\x3dnormalize(f);\r\n#else\r\nf\x3dwgs84ToWebMerc($auxpos2);f.x+\x3dg.x;f.y+\x3dg.y;gg\x3dvec3(0.0,0.0,1.0);\r\n#endif\r\ngl_Position\x3dlo*ml*vec4(f,1.0);dg\x3df;hd\x3dtexture2D(si,vec2(e,0.5));gd\x3dvec3(h,g);}]]\x3e\x3c/snippet\x3e\x3csnippet name\x3d"jetTrailVS"\x3e\x3c![CDATA[attribute vec2 $auxpos1;attribute vec3 $auxpos2;uniform mat4 lo;uniform mat4 ml;uniform sampler2D so;uniform vec2 im;uniform sampler2D pp;uniform vec2 pi;uniform float oo;uniform float ss;uniform float ms;uniform vec2 mi;uniform sampler2D si;varying vec4 hd;varying vec3 gg;varying vec3 dg;varying vec4 gd; $linearInterpolator  $lonlat2position  $translationMat  $localTrans  $curveInter void main(void){float a\x3dfract($auxpos1.x*2.0/pi.x);float b\x3dfloor($auxpos1.x*2.0/pi.y)/pi.y;vec4 c\x3dtexture2D(pp,vec2(a,b));if(c.r\x3d\x3d$auxpos1.x){vec3 d\x3dc.gba;a\x3dfract(($auxpos1.x*2.0+1.0)/pi.x);b\x3dfloor(($auxpos1.x*2.0+1.0)/pi.y)/pi.y;vec4 e\x3dtexture2D(pp,vec2(a,b));vec3 f\x3de.gba;vec3 g,h,i,j;float k,l;float m\x3d1.0;float n\x3d0.0;gd\x3dvec4($auxpos2,0.0);\r\n#ifdef GLOBAL\r\nd\x3dlonlat2position(d);f\x3dlonlat2position(f);g\x3d(d+f)*0.5;h\x3dnormalize(g);i\x3dd-f;k\x3dlength(i);g\x3dh*(length(g)+k*0.6);if(k\x3c\x3d1000.0){l\x3d32.0;}else if(k\x3c\x3d10000.0){l\x3d24.0;}else if(k\x3c\x3d500000.0){l\x3d18.0;}else if(k\x3c\x3d1000000.0){l\x3d40.0;}else{l\x3dfloor(k*0.00001);}n\x3dmod($auxpos2.y+(l*2.0-1.0)/oo*ms,l*2.0-1.0);if((n\x3e\x3dl)\x26\x26(n\x3c(l*2.0-1.0))){m\x3d-1.0;n-\x3dl;}vec3 o\x3dnormalize(i);vec3 p\x3dg+o*(k*0.6*m);float q\x3dn/l;q\x3dclamp(q,0.0,1.0);if(m\x3c\x3d0.0){if(q\x3e(l-3.0)/l){gd.w\x3d4.0;}j\x3dgetPoint(q,g,p,f,f);}else{j\x3dgetPoint(q,d,d,p,g);}gg\x3dnormalize(j);\r\n#else\r\nd\x3dwgs84ToWebMerc(d);f\x3dwgs84ToWebMerc(f);g\x3d(d+f)*0.5;h\x3dvec3(0.0,0.0,1.0);i\x3dd-f;k\x3dlength(i);g\x3dg+h*(k*0.3);if(k\x3c\x3d1000.0){l\x3d48.0;}else if(k\x3c\x3d10000.0){l\x3d42.0;}else if(k\x3c\x3d100000.0){l\x3d32.0;}else if(k\x3c\x3d1000000.0){l\x3d24.0;}else if(k\x3c\x3d2000000.0){l\x3d36.0;}else{l\x3dfloor(k*0.000006);}n\x3dmod($auxpos2.y+(l*2.0-1.0)/oo*ms,l*2.0-1.0);if((n\x3e\x3dl)\x26\x26(n\x3c(l*2.0-1.0))){m\x3d-1.0;n-\x3dl;}vec3 o\x3dnormalize(i);vec3 p\x3dg+o*(k*0.3*m);float q\x3dn/l;q\x3dclamp(q,0.0,1.0);if(m\x3c\x3d0.0){if(q\x3e(l-3.0)/l){gd.w\x3d4.0;}j\x3dgetPoint(q,g,p,f,f);}else{j\x3dgetPoint(q,d,d,p,g);}gg\x3dvec3(0.0,0.0,1.0);\r\n#endif\r\ngl_Position\x3dlo*ml*vec4(j,1.0);dg\x3dj;a\x3dfract($auxpos1.y/im.x);b\x3dfloor($auxpos1.y/im.y)/im.y;float r\x3d(texture2D(so,vec2(a,b))).r;float s\x3dgetLinearValue(mi,r);if($auxpos2.x\x3c2.0){gl_PointSize\x3dss*pow(2.718,s);}hd\x3dtexture2D(si,vec2(s,0.5));}else{vec3 j\x3dvec3(0.0,0.0,0.0);gl_Position\x3dlo*ml*vec4(j,1.0);dg\x3dj;if($auxpos1.y\x3c1.0){gl_PointSize\x3dss;}hd\x3dvec4(1.0,0.0,0.0,1.0);gg\x3dnormalize(j);gd\x3dvec4($auxpos2,0.0);}}]]\x3e\x3c/snippet\x3e\x3c/snippets\x3e'}});
define(["dojo/text!./JetTrailMaterial.xml","esri/core/declare","esri/views/3d/webgl-engine/lib/GLSLShader","../../webgl-engine-extensions/GLSLProgramExt","../../support/fx3dUtils"],function(e,h,d,g,k){return h(null,{declaredClass:"esri.views.3d.effects.JetTrail.JetTrailMaterial",constructor:function(a){this._gl=a.gl;this._shaderSnippets=a.shaderSnippets;this._pulseProgram=this._program=null;this._pushState=a.pushState;this._restoreState=a.restoreState;this._srcAlpha=770;this._dstAlpha=771;this._viewingMode=
a.viewingMode;"local"==a.viewingMode&&(this._srcAlpha=770,this._dstAlpha=771)},destroy:function(){this._program&&(this._program.dispose(),delete this._program,this._program=null);this._pulseProgram&&(this._pulseProgram.dispose(),delete this._pulseProgram,this._pulseProgram=null)},_addDefines:function(a,b){var c="";if(null!=b)if(Array.isArray(b))for(var d=0,e=b.length;d<e;d++)var f=b[d],c=c+("#define "+f+"\n");else for(f in b)c+="#define "+f+"\n";return this._shaderSnippets.defines+"\n"+c+a},loadShaders:function(a){if(this._shaderSnippets){null!=
this._shaderSnippets.jetTrailVS&&null!=this._shaderSnippets.jetTrailFS||this._shaderSnippets._parse(e);a=[];"global"==this._viewingMode?a.push("GLOBAL"):a.push("LOCAL");var b=this._addDefines(this._shaderSnippets.jetTrailVS,a),b=new d(35633,b,this._gl),c=new d(35632,this._shaderSnippets.jetTrailFS,this._gl);this._program=new g([b,c],this._gl);null!=this._shaderSnippets.jetTrailPulseVS&&null!=this._shaderSnippets.jetTrailPulseFS||this._shaderSnippets._parse(e);b=this._addDefines(this._shaderSnippets.jetTrailPulseVS,
a);b=new d(35633,b,this._gl);c=new d(35632,this._shaderSnippets.jetTrailPulseFS,this._gl);this._pulseProgram=new g([b,c],this._gl)}return this._initResources()},getProgram:function(){return this._program},_initResources:function(){return!0},bind:function(a,b){this._program.use();this._program.uniformMatrix4fv("lo",a.proj);this._program.uniformMatrix4fv("ml",a.view);this._program.uniform3fv("es",a.camPos);this._program.uniform3fv("ei",a.lightingData.direction);this._program.uniform4fv("io",a.lightingData.ambient);
this._program.uniform4fv("ls",a.lightingData.diffuse);this._program.uniform4fv("po",a.lightingData.specular);this._oldTex=this._gl.getParameter(32873);var c=b._activeTextureUnit;c>b.parameters.maxVertexTextureImageUnits-1-4&&(console.warn("Many textures are binded now, 3DFx lib may be work abnormally."),c=0);a.so.bind(c+1);this._program.uniform1i("so",c+1);this._program.uniform2fv("im",a.im);this._program.uniform2fv("ps",[a.ps,a.mi]);a.pp.bind(c+2);this._program.uniform1i("pp",c+2);this._program.uniform2fv("pi",
a.pi);this._gl.activeTexture(33984+c+3);this._gl.bindTexture(3553,a.lm);this._program.uniform1i("lm",c+3);this._gl.activeTexture(33984+c+4);this._gl.bindTexture(3553,a.si);this._program.uniform1i("si",c+4);this._program.uniform1f("oo",a.oo);this._program.uniform1f("ss",a.ss);this._program.uniform1f("mo",a.mo);this._program.uniform1f("ms",a.time);0!=b._depthWriteEnabled&&(this._pushState(["setDepthWriteEnabled",b._depthWriteEnabled]),b.setDepthWriteEnabled(!1));1!=b._polygonCullingEnabled&&(this._pushState(["setFaceCullingEnabled",
b._polygonCullingEnabled]),b.setFaceCullingEnabled(!0));1!=b._depthTestEnabled&&(this._pushState(["setDepthTestEnabled",b._depthTestEnabled]),b.setDepthTestEnabled(!0));1!=b._blendEnabled&&(this._pushState(["setBlendingEnabled",b._blendEnabled]),b.setBlendingEnabled(!0))},bindPulse:function(a,b){this._pulseProgram.use();this._pulseProgram.uniformMatrix4fv("lo",a.proj);this._pulseProgram.uniformMatrix4fv("ml",a.view);this._pulseProgram.uniform3fv("es",a.camPos);this._pulseProgram.uniform3fv("ei",a.lightingData.direction);
this._pulseProgram.uniform4fv("io",a.lightingData.ambient);this._pulseProgram.uniform4fv("ls",a.lightingData.diffuse);this._pulseProgram.uniform4fv("po",a.lightingData.specular);var c=b._activeTextureUnit;c>b.parameters.maxVertexTextureImageUnits-1-2&&(console.warn("Many textures are binded now, 3DFx lib may be work abnormally."),c=0);a.so.bind(c+1);this._pulseProgram.uniform1i("so",c+1);this._pulseProgram.uniform2fv("im",a.im);this._pulseProgram.uniform2fv("ps",[a.ps,a.mi]);this._gl.activeTexture(33984+
c+2);this._gl.bindTexture(3553,a.si);this._pulseProgram.uniform1i("si",c+2);this._pulseProgram.uniform1f("oo",a.oo);this._pulseProgram.uniform2fv("ol",a.ol);this._pulseProgram.uniform1f("mo",a.mo);this._pulseProgram.uniform1f("ms",a.time);519!=b._depthFunction&&(this._pushState(["setDepthFunction",b._depthFunction]),b.setDepthFunction(519));1!=b._blendEnabled&&(this._pushState(["setBlendingEnabled",b._blendEnabled]),b.setBlendingEnabled(!0))},blend:function(a,b){a?a&&(this._pushState(["setBlendFunctionSeparate",
[b._blendFunctionState.srcRGB,b._blendFunctionState.dstRGB,b._blendFunctionState.srcAlpha,b._blendFunctionState.dstAlpha]]),b.setBlendFunction(770,771)):(this._pushState(["setBlendFunctionSeparate",[b._blendFunctionState.srcRGB,b._blendFunctionState.dstRGB,b._blendFunctionState.srcAlpha,b._blendFunctionState.dstAlpha]]),b.setBlendFunction(this._srcAlpha,this._dstAlpha))},release:function(a){this._gl.activeTexture(33984+a._activeTextureUnit+1);this._gl.bindTexture(3553,this._oldTex);this._restoreState(a);
this._gl.useProgram(null)}})});