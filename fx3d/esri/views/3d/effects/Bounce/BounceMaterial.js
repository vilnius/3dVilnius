//>>built
require({cache:{"url:fx3d/views/3d/effects/Bounce/BounceMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\x3c!-- Copyright @ 2017 Esri. All rights reserved under the copyright laws of the United States and applicable international laws, treaties, and conventions. --\x3e\x3csnippets\x3e\x3csnippet name\x3d"bounceFS"\x3e\x3c![CDATA[\r\n#ifdef GL_ES\r\nprecision mediump float;\r\n#endif\r\nuniform float os;uniform vec3 ls;uniform vec4 il;uniform vec4 mo;uniform vec4 es;uniform vec3 lo;uniform float lm;uniform sampler2D om;varying vec4 dg;varying vec3 cg;varying vec3 gg;void main(void){float a\x3dos*0.01;gl_FragColor.rgb\x3ddg.rgb;gl_FragColor.a\x3d1.0;gl_FragColor\x3dtexture2D(om,gl_PointCoord)*gl_FragColor;gl_FragColor.a*\x3da*0.8;if(gl_FragColor.r\x3c\x3d1e-6\x26\x26gl_FragColor.g\x3c\x3d1e-6\x26\x26gl_FragColor.b\x3c\x3d1e-6){gl_FragColor.rgb\x3dvec3(0.1,0.1,0.1);gl_FragColor.a*\x3d0.1;}}]]\x3e\x3c/snippet\x3e\x3csnippet name\x3d"bounceVS"\x3e\x3c![CDATA[attribute vec3 $position;attribute vec2 $auxpos1;uniform mat4 ie;uniform mat4 ol;uniform sampler2D ms;uniform vec2 pi;uniform float lm;uniform float pp;uniform vec2 ll;uniform sampler2D is;uniform vec3 ss;varying vec4 dg;varying vec3 cg;varying vec3 gg;varying vec3 gc; $linearInterpolator  $lonlat2position  $translationMat  $localTrans  $bounceEaseOut void main(void){float a\x3dfract($auxpos1.y/pi.x);float b\x3dfloor($auxpos1.y/pi.y)/pi.y;float c\x3d(texture2D(ms,vec2(a,b))).r;float d\x3dgetLinearValue(ll,c);float e\x3dmod(pp,lm);float f\x3dgetBounceEaseOutValue(e,0.0,c,lm);float g\x3dgetLinearValue(ll,f);vec3 h,i;mat4 j\x3dmat4(1.0);\r\n#ifdef GLOBAL\r\nmat4 k\x3dgetTransMat($position);h\x3dk[3].xyz;j\x3dtoRotationMat(k);vec4 l\x3dvec4(0.0,0.0,1.0,0.0);i\x3d(j*l).xyz;\r\n#else\r\nh\x3dwgs84ToWebMerc($position);i\x3dvec3(0.0,0.0,1.0);\r\n#endif\r\ncg\x3dnormalize(i);h+\x3d(i*abs($auxpos1.x)*ss.z*g);if($auxpos1.x\x3c0.0){gl_PointSize\x3dgetScope(ss.xy,d);}else{gl_PointSize\x3dgetScope(ss.xy,d)*0.4;}gl_Position\x3die*ol*vec4(h,1.0);gg\x3dh;dg\x3dtexture2D(is,vec2(g,0.5));}]]\x3e\x3c/snippet\x3e\x3csnippet name\x3d"timeInfoBounceFS"\x3e\x3c![CDATA[\r\n#ifdef GL_ES\r\nprecision mediump float;\r\n#endif\r\nuniform float os;uniform vec3 ls;uniform vec4 il;uniform vec4 mo;uniform vec4 es;uniform vec3 lo;uniform bool drawFlyPath;uniform float lm;uniform sampler2D om;varying vec4 dg;varying vec3 cg;varying vec3 gg;varying vec4 gc; $quintEaseOut void main(void){float a\x3dos*0.01;gl_FragColor.rgb\x3ddg.rgb;gl_FragColor.a\x3d1.0;if(drawFlyPath){float b\x3dgetQuintEaseInOutValue(gc.x,0.0,gc.z-1.0,lm);if(gc.y\x3eb){gl_FragColor.a\x3d0.0;discard;}}else{gl_FragColor\x3dtexture2D(om,gl_PointCoord)*gl_FragColor;gl_FragColor.a*\x3da;}if(gl_FragColor.r\x3c\x3d1e-6\x26\x26gl_FragColor.g\x3c\x3d1e-6\x26\x26gl_FragColor.b\x3c\x3d1e-6){gl_FragColor.rgb\x3dvec3(0.1,0.1,0.1);}}]]\x3e\x3c/snippet\x3e\x3csnippet name\x3d"timeInfoBounceVS"\x3e\x3c![CDATA[ $defines attribute vec3 $position;attribute vec2 $auxpos1;uniform mat4 ie;uniform mat4 ol;uniform sampler2D ms;uniform vec2 pi;uniform float lm;uniform float pp;uniform vec2 ll;uniform sampler2D is;uniform bool drawFlyPath;uniform vec3 ss;uniform float currentIndex;varying vec4 dg;varying vec3 cg;varying vec3 gg;varying vec4 gc; $linearInterpolator  $lonlat2position  $translationMat  $localTrans  $bounceEaseOut void main(void){float a\x3dfract($auxpos1.y/pi.x);float b\x3dfloor($auxpos1.y/pi.y)/pi.y;float c\x3d(texture2D(ms,vec2(a,b))).r;float d\x3dgetLinearValue(ll,c);float e\x3dmod(pp,lm);float f\x3dgetBounceEaseOutValue(e,0.0,c,lm);float g\x3dgetLinearValue(ll,f);vec3 h,i;if(drawFlyPath){h\x3d$position;cg\x3dnormalize(h);}else{mat4 j\x3dmat4(1.0);\r\n#ifdef GLOBAL\r\nmat4 k\x3dgetTransMat($position);h\x3dk[3].xyz;j\x3dtoRotationMat(k);vec4 l\x3dvec4(0.0,0.0,1.0,0.0);i\x3d(j*l).xyz;\r\n#else\r\nh\x3dwgs84ToWebMerc($position);i\x3dvec3(0.0,0.0,1.0);\r\n#endif\r\ncg\x3dnormalize(i);if(currentIndex\x3d\x3d$auxpos1.y){h+\x3d(i*abs($auxpos1.x)*ss.z*g);}else{h+\x3d(i*abs($auxpos1.x)*ss.z*d);}if($auxpos1.x\x3c0.0){gl_PointSize\x3dgetScope(ss.xy,d);}else{gl_PointSize\x3dgetScope(ss.xy,d)*0.4;}}if(drawFlyPath){gc\x3dvec4(e,$auxpos1.x,$auxpos1.y,0.0);}gl_Position\x3die*ol*vec4(h,1.0);gg\x3dh;dg\x3dtexture2D(is,vec2(d,0.5));}]]\x3e\x3c/snippet\x3e\x3c/snippets\x3e'}});
define(["dojo/text!./BounceMaterial.xml","esri/core/declare","esri/views/3d/webgl-engine/lib/GLSLShader","../../webgl-engine-extensions/GLSLProgramExt","../../support/fx3dUtils"],function(g,h,d,k,l){return h(null,{declaredClass:"esri.views.3d.effects.Bounce.BounceMaterial",constructor:function(a){this._gl=a.gl;this._shaderSnippets=a.shaderSnippets;this._program=null;this._pushState=a.pushState;this._restoreState=a.restoreState;this._srcAlpha=770;this._dstAlpha=771;this._viewingMode=a.viewingMode;
"local"==a.viewingMode&&(this._srcAlpha=770,this._dstAlpha=771)},destroy:function(){this._program&&(this._program.dispose(),delete this._program,this._program=null)},_addDefines:function(a,b){var c="";if(null!=b)if(Array.isArray(b))for(var e=0,d=b.length;e<d;e++)var f=b[e],c=c+("#define "+f+"\n");else for(f in b)c+="#define "+f+"\n";return this._shaderSnippets.defines+"\n"+c+a},loadShaders:function(a){if(this._shaderSnippets){var b="bounceVS",c="bounceFS";a&&(b="timeInfoBounceVS",c="timeInfoBounceFS");
null!=this._shaderSnippets[b]&&null!=this._shaderSnippets[c]||this._shaderSnippets._parse(g);a=[];"global"==this._viewingMode?a.push("GLOBAL"):a.push("LOCAL");b=this._addDefines(this._shaderSnippets[b],a);b=new d(35633,b,this._gl);c=new d(35632,this._shaderSnippets[c],this._gl);this._program=new k([b,c],this._gl)}return this._initResources()},getProgram:function(){return this._program},_initResources:function(){return!0},bind:function(a,b){this._program.use();this._program.uniformMatrix4fv("ie",a.proj);
this._program.uniformMatrix4fv("ol",a.view);this._program.uniform3fv("lo",a.camPos);this._program.uniform3fv("ls",a.lightingData.direction);this._program.uniform4fv("il",a.lightingData.ambient);this._program.uniform4fv("mo",a.lightingData.diffuse);this._program.uniform4fv("es",a.lightingData.specular);this._oldTex=this._gl.getParameter(32873);var c=b._activeTextureUnit;c>b.parameters.maxVertexTextureImageUnits-1-3&&(console.warn("Many textures are binded now, 3DFx lib may be work abnormally."),c=
0);a.ms.bind(c+1);this._program.uniform1i("ms",c+1);this._program.uniform2fv("pi",a.pi);this._program.uniform2fv("ll",[a.ll,a.si]);this._gl.activeTexture(33984+c+2);this._gl.bindTexture(3553,a.is);this._program.uniform1i("is",c+2);this._gl.activeTexture(33984+c+3);this._gl.bindTexture(3553,a.om);this._program.uniform1i("om",c+3);this._program.uniform3fv("ss",a.ss);this._program.uniform1f("lm",a.lm);this._program.uniform1f("os",a.os);this._program.uniform1f("pp",a.time);1!=b._depthTestEnabled&&(this._pushState(["setDepthTestEnabled",
b._depthTestEnabled]),b.setDepthTestEnabled(!0));0!=b._depthWriteEnabled&&(this._pushState(["setDepthWriteEnabled",b._depthWriteEnabled]),b.setDepthWriteEnabled(!1))},bindBoolean:function(a,b){this._program.uniform1i(a,b)},bindFloat:function(a,b){this._program.uniform1f(a,b)},blend:function(a,b){a?(1!=b._blendEnabled&&(this._pushState(["setBlendingEnabled",b._blendEnabled]),b.setBlendingEnabled(!0)),this._pushState(["setBlendFunctionSeparate",[b._blendFunctionState.srcRGB,b._blendFunctionState.dstRGB,
b._blendFunctionState.srcAlpha,b._blendFunctionState.dstAlpha]]),b.setBlendFunction(this._srcAlpha,this._dstAlpha)):0!=b._blendEnabled&&(this._pushState(["setBlendingEnabled",b._blendEnabled]),b.setFaceCullingEnabled(!1))},release:function(a){this._gl.activeTexture(33984+a._activeTextureUnit+1);this._gl.bindTexture(3553,this._oldTex);this._restoreState(a);this._gl.useProgram(null)}})});