// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./portalUtils esri/config esri/tasks/GeometryService".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v){function q(c,a){var x=h.clone(c),b=m.widgetProperties;"undefined"===typeof a&&(a=!1);delete x.mode;m.visitElement(x,function(c,e){c.widgets?(delete c.isOnScreen,
delete c.gid,"jimu.js/images/group_icon.png"===c.icon&&delete c.icon,delete c.openType,e.isOnScreen&&c.panel&&m.isEqual(c.panel,x.widgetOnScreen.panel)&&delete c.panel):(c.icon&&c.icon===c.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion&&delete c.icon,delete c.panel,delete c.folderUrl,delete c.amdFolder,delete c.thumbnail,delete c.configFile,delete c.gid,delete c.isOnScreen,b.forEach(function(a){delete c[a]}),a?("undefined"===typeof c.openAtStart&&(c.openAtStart=!1),c.config||delete c.config):
(c.visible&&delete c.visible,c.manifest&&c.label===c.manifest.label&&delete c.label,c.isDefaultConfig&&(delete c.config,delete c.isDefaultConfig)),delete c.manifest)});delete x.rawAppConfig;delete x._ssl;delete x.getConfigElementById;delete x.getConfigElementsByName;delete x.getConfigElementByLabel;delete x.processNoUriWidgets;delete x.addElementId;delete x.getCleanConfig;delete x.visitElement;delete x.agolConfig;delete x._itemData;delete x.oldWabVersion;return x}var n=null,w;w=p(null,{urlParams:null,
appConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(c){this.urlParams=c||{};this.listenBuilderEvents();this.versionManager=new b;this.widgetManager=e.getInstance();this.configLoader=l.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&window.parent.setConfigViewerTopic&&h.isFunction(window.parent.setConfigViewerTopic)&&window.parent.setConfigViewerTopic(g);"preview"===this.urlParams.mode&&window.parent.setPreviewViewerTopic&&
h.isFunction(window.parent.setPreviewViewerTopic)&&window.parent.setPreviewViewerTopic(g);k(window,"resize",h.hitch(this,this._onWindowResize))},listenBuilderEvents:function(){g.subscribe("builder/widgetChanged",h.hitch(this,this._onWidgetChanged));g.subscribe("builder/groupChanged",h.hitch(this,this._onGroupChanged));g.subscribe("builder/widgetPoolChanged",h.hitch(this,this._onWidgetPoolChanged));g.subscribe("builder/openAtStartChange",h.hitch(this,this._onOpenAtStartChanged));g.subscribe("builder/onScreenOrderChanged",
h.hitch(this,this._onScreenOrderChanged));g.subscribe("builder/layoutDefinitionChanged",h.hitch(this,this._onLayoutDefinitionChanged));g.subscribe("builder/sceneViewChanged",h.hitch(this,this._onSceneViewChanged));g.subscribe("builder/mapOptionsChanged",h.hitch(this,this._onMapOptionsChanged));g.subscribe("builder/appAttributeChanged",h.hitch(this,this._onAppAttributeChanged));g.subscribe("builder/setAppConfig",h.hitch(this,this._onAppConfigSet));g.subscribe("builder/themeChanged",h.hitch(this,this._onThemeChanged));
g.subscribe("builder/layoutChanged",h.hitch(this,this._onLayoutChanged));g.subscribe("builder/styleChanged",h.hitch(this,this._onStyleChanged));g.subscribe("builder/syncExtent",h.hitch(this,this._onSyncExtent));g.subscribe("builder/loadingPageChanged",h.hitch(this,this._onLoadingPageChanged));g.subscribe("builder/templateConfigChanged",h.hitch(this,this._onTemplateConfigChanged));g.subscribe("builder/sharedThemeChanged",h.hitch(this,this._onSharedThemeChanged))},loadConfig:function(){if("preview"!==
this.urlParams.mode&&"config"!==this.urlParams.mode)return this.configLoader.loadConfig().then(h.hitch(this,function(c){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(c);window.appInfo.isRunInMobile=this._isRunInMobile();console.timeEnd("Load Config");c=this.getAppConfig();g.publish("appConfigLoaded",c);return c}),h.hitch(this,function(c){console.error(c);c&&c.message&&"string"===typeof c.message&&this._showErrorMessage(c.message)}))},_showErrorMessage:function(c){a.create("div",
{"class":"app-error",innerHTML:m.sanitizeHTML("Unable to create map: "+c)},document.body)},getAppConfig:function(){var c;window.appInfo.isRunInMobile?(c=h.clone(this._getMobileConfig(this.appConfig)),c._originConfig=h.clone(this.appConfig)):c=h.clone(this.appConfig);c.getConfigElementById=function(c){return m.getConfigElementById(this,c)};c.getConfigElementByLabel=function(c){return m.getConfigElementByLabel(this,c)};c.getConfigElementsByName=function(c){return m.getConfigElementsByName(this,c)};
c.getCleanConfig=function(c){return this._originConfig?q(this._originConfig,c):q(this,c)};c.visitElement=function(c){m.visitElement(this,c)};return c},_onWindowResize:function(){var c=this._isRunInMobile();window.appInfo.isRunInMobile!==c&&(window.appInfo.isRunInMobile=c,this.appConfig&&g.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_isRunInMobile:function(){var c=a.getMarginBox(window.jimuConfig.layoutId);if(c.w<=window.jimuConfig.breakPoints[0]||c.h<=window.jimuConfig.breakPoints[0])return a.addClass(window.jimuConfig.layoutId,
"jimu-ismobile"),!0;a.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1},_getMobileConfig:function(c){return m.mixinAppConfigPosition(c,c.mobileLayout)},_onWidgetChanged:function(c){var a=m.reCreateObject(c);c=m.getConfigElementById(this.appConfig,c.id);!1!==a.inPanel||c.uri||(a.closeable=!0);for(var b in a)c[b]=a[b];delete c.isDefaultConfig;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"widgetChange",
a)},_onGroupChanged:function(c){var a=m.reCreateObject(c);c=m.getConfigElementById(this.appConfig,c.id);for(var b in a)c[b]=a[b];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"groupChange",a)},_onWidgetPoolChanged:function(c){c=m.reCreateObject(c);if(1===this.widgetManager.getControllerWidgets().length)this.appConfig.widgetPool.widgets=c.widgets,this.appConfig.widgetPool.groups=c.groups;else{var a=m.getConfigElementById(this.appConfig,
c.controllerId);d.forEach(a.controlledWidgets,function(c){this._removeWidgetOrGroupFromPoolById(this.appConfig,c)},this);d.forEach(a.controlledGroups,function(c){this._removeWidgetOrGroupFromPoolById(this.appConfig,c)},this);this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?c.widgets:this.appConfig.widgetPool.widgets.concat(c.widgets);this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?c.groups:this.appConfig.widgetPool.groups.concat(c.groups);
this.configLoader.addNeedValues(this.appConfig);a.controlledWidgets=d.map(c.widgets,function(c){return c.id});a.controlledGroups=d.map(c.groups,function(c){return c.id})}this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",c)},_removeWidgetOrGroupFromPoolById:function(c,a){d.some(c.widgetPool.widgets,function(x,b){if(x.id===a)return c.widgetPool.widgets.splice(b,1),!0});d.some(c.widgetPool.groups,
function(x,b){if(x.id===a)return c.widgetPool.groups.splice(b,1),!0})},_onOpenAtStartChanged:function(c){var a=m.reCreateObject(c),b=this.appConfig;c.isOnScreen?(b=b.widgetOnScreen&&b.widgetOnScreen.widgets)&&0<b.length&&d.forEach(b,h.hitch(this,function(a){a.id===c.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})):((b=b.widgetPool)&&b.groups&&0<b.groups.length&&d.forEach(b.groups,h.hitch(this,function(a){a.id===c.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})),b&&b.widgets&&0<b.widgets.length&&
d.forEach(b.widgets,h.hitch(this,function(a){a.id===c.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})));g.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",a)},_onScreenOrderChanged:function(c){var a=m.reCreateObject(c);d.forEach(this.appConfig.widgetOnScreen.widgets,function(c){c.isController||(!1!==c.inPanel||!0!==c.closeable)&&!0!==c.inPanel&&c.uri||d.some(a,function(a){if(c.id===a.id)return c.position=a.position,!0})},this);g.publish("appConfigChanged",this.getAppConfig(),
"onScreenOrderChange",a)},_onAppAttributeChanged:function(c){c=m.reCreateObject(c);h.mixin(this.appConfig,c);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"attributeChange",c)},_onLoadingPageChanged:function(c){c=m.reCreateObject(c);var a;"backgroundColor"in c?this.appConfig.loadingPage.backgroundColor=c.backgroundColor:"backgroundImage"in c?(a=this.appConfig.loadingPage.backgroundImage||
{},this.appConfig.loadingPage.backgroundImage=h.mixin(a,c.backgroundImage)):"loadingGif"in c&&(a=this.appConfig.loadingPage.loadingGif||{},this.appConfig.loadingPage.loadingGif=h.mixin(a,c.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"loadingPageChange",c)},_onTemplateConfigChanged:function(c){c=m.reCreateObject(c);this.appConfig.templateConfig=c;this.configLoader.addNeedValues(this.appConfig);
this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",c)},_onLayoutDefinitionChanged:function(c){c=m.reCreateObject(c);m.isEqual(this.appConfig.layoutDefinition,c.layoutDefinition)||(this.appConfig.layoutDefinition=c.layoutDefinition,this.appConfig.widgetOnScreen.groups=m.handleGridLayoutOnScreenGroupChange(this.appConfig.widgetOnScreen.groups,c.groupIds),this.configLoader.addNeedValues(this.appConfig),this._addDefaultValues(this.appConfig),
g.publish("appConfigChanged",this.getAppConfig(),"layoutDefinitionChange",c.layoutDefinition))},_onSceneViewChanged:function(c){c=m.reCreateObject(c);c.itemId&&c.itemId!==this.appConfig.map.itemId&&this.appConfig.map.mapOptions&&m.deleteMapOptions(this.appConfig.map.mapOptions);h.mixin(this.appConfig.map,c);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"mapChange",c)},_onMapOptionsChanged:function(c){c=m.reCreateObject(c);
this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});h.mixin(this.appConfig.map.mapOptions,c);g.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",c)},_onThemeChanged:function(c){this._getAppConfigFromTheme(c).then(h.hitch(this,function(a){this.appConfig=a;g.publish("appConfigChanged",this.getAppConfig(),"themeChange",c.getName())}))},_onLayoutChanged:function(c){this.appConfig=m.mixinAppConfigPosition(this.appConfig,c.layoutConfig);this.appConfig.layoutDefinition=c.layoutConfig.layoutDefinition;
this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);this._addDefaultPanelAndPosition(this.appConfig);g.publish("appConfigChanged",this.getAppConfig(),"layoutChange",c.name)},_onStyleChanged:function(c){this.appConfig.theme.styles=this._genStyles(this.appConfig.theme.styles,c.name);c.isCustom?this.appConfig.theme.customStyles={mainBackgroundColor:c.styleColor}:(delete this.appConfig.theme.customStyles,delete this.appConfig.titleColor,this.appConfig.theme.sharedTheme=
{isPortalSupport:this.appConfig.theme.sharedTheme.isPortalSupport,useHeader:!1,useLogo:!1});g.publish("appConfigChanged",this.getAppConfig(),"styleChange",c.name)},_onSharedThemeChanged:function(c){var a=this.appConfig.theme.sharedTheme;c=m.reCreateObject(c);c.useHeader&&!a.useHeader&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},this.appConfig.titleColor=
this.portalSelf.portalProperties.sharedTheme.header.text,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor})):console.error("Portal does not support sharedTheme."));!c.useHeader&&a.useHeader&&(delete this.appConfig.titleColor,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor}));c.useLogo&&!a.useLogo&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:
"images/app-logo.png",this.appConfig.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link,this._onAppAttributeChanged({logo:this.appConfig.logo,logoLink:this.appConfig.logoLink})):console.error("Portal does not support sharedTheme."));!c.useLogo&&a.useLogo&&this._onAppAttributeChanged({logo:this.appConfig.logo});h.mixin(a,c);g.publish("appConfigChanged",this.getAppConfig(),"sharedThemeChange",c)},_onSyncExtent:function(c){g.publish("syncExtent",c)},_genStyles:function(c,a){var b=[];b.push(a);
d.forEach(c,function(c){0>b.indexOf(c)&&b.push(c)});return b},_getAppConfigFromTheme:function(c){var a=new f,b,e=[],n=this.getAppConfig().getCleanConfig();n.mode=this.urlParams.mode;d.forEach(n.widgetPool.groups,function(c){delete c.panel},this);if(c.appConfig)b=h.clone(c.appConfig),b.map=n.map,b.map.position=c.appConfig.map.position,this._copyPoolToThemePool(n,b),b.links=n.links,b.title=n.title,b.subtitle=n.subtitle,b.logo=n.logo;else{var g=c.getCurrentLayout(),e=c.getCurrentStyle();b=h.clone(n);
g=h.clone(g.layoutConfig);b.widgetOnScreen=g.widgetOnScreen;g.widgetPool&&(d.forEach(g.widgetPool.widgets,function(c){c.isPreconfiguredInTheme=!0}),d.forEach(g.widgetPool.groups,function(c){c.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(n,g);b.widgetPool=g.widgetPool;g.map&&g.map.position&&(b.map.position=g.map.position);b.mobileLayout=g.mobileLayout;b.layoutDefinition=g.layoutDefinition;e=this._genStyles(d.map(c.getStyles(),function(c){return c.name}),e.name);b.theme={name:c.getName(),
styles:e,version:c.getVersion()};this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(b.theme.sharedTheme={useHeader:!0,useLogo:!0,isPortalSupport:!0},b.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background}):(b.theme.sharedTheme={useHeader:!1,useLogo:!1,isPortalSupport:!1},b.theme.customStyles={mainBackgroundColor:""});b.titleColor=n.titleColor;b.logoLink=n.logoLink}this.configLoader.addNeedValues(b);this.configLoader.loadWidgetsManifest(b).then(h.hitch(this,
function(){this._addDefaultValues(b);a.resolve(b)}));return a},_copyPoolToThemePool:function(c,a){var b=c.widgetPool;a.widgetPool||(a.widgetPool={});c=a.widgetPool;var x=d.filter(c.widgets,function(c){if(c.isPreconfiguredInTheme||!d.some(b.widgets,function(a){return a.name===c.name}))return!0}),e=d.filter(c.groups,function(c){return c.isPreconfiguredInTheme}),n=d.filter(b.widgets,function(c){return!c.isPreconfiguredInTheme}),f=d.filter(b.groups,function(c){return!c.isPreconfiguredInTheme}),n=this._getPoolWidgetsWithoutDuplicated(n,
a.widgetOnScreen.widgets||[]);c.widgets=n.concat(x);c.groups=f.concat(e)},_getPoolWidgetsWithoutDuplicated:function(c,a){for(var b=h.clone(c),x=this.getAppConfig(),e=c.length-1;0<=e;e--)for(var n=a.length-1;0<=n;n--)if(a[n].uri){var f=a[n].name;f||(f=m.getWidgetNameFromUri(a[n].uri));var g=x.getConfigElementById(c[e].id);c[e]&&c[e].name===f&&!1===g.supportMultiInstance&&(console.log("Widget",c[e].name,"is not copied to new theme because this widget exists in new theme."),b.splice(e,1))}return b},
_onAppConfigSet:function(c){c=m.reCreateObject(c);window.appInfo.isRunInMobile=this._isRunInMobile();this.configLoader.processProxy(c);this.configLoader.addNeedValues(c);this._addDefaultValues(c);t.setPortalUrl(c.portalUrl);this.appConfig?(c.map.itemId&&c.map.itemId!==this.appConfig.map.itemId&&m.deleteMapOptions(c.map.mapOptions),this.appConfig=c,g.publish("appConfigChanged",this.getAppConfig(),"resetConfig",c)):(this.appConfig=c,u.getPortal(c.portalUrl).loadSelfInfo().then(h.hitch(this,function(c){this.portalSelf=
c;g.publish("appConfigLoaded",this.getAppConfig())})))},_addDefaultValues:function(c){this._addDefaultPortalUrl(c);this._addDefaultGeometryService(c);this._addDefaultStyle(c);this._addDefaultMap(c);this._addDefaultVisible(c);this._addDefaultSharedTheme(c);"undefined"===typeof c.widgetOnScreen&&(c.widgetOnScreen={});"undefined"===typeof c.widgetPool&&(c.widgetPool={});this._addDefaultPanelAndPosition(c);this._addDefaultOfWidgetGroup(c);(c.widgetPool.widgets&&0<c.widgetPool.widgets.length&&void 0===
c.widgetPool.widgets[0].index||c.widgetPool.groups&&0<c.widgetPool.groups.length&&void 0===c.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(c);return c},_addDefaultPortalUrl:function(c){"undefined"===typeof c.portalUrl&&(c.portalUrl="http://www.arcgis.com/");c.portalUrl&&"/"!==c.portalUrl.substr(c.portalUrl.length-1)&&(c.portalUrl+="/")},_addDefaultGeometryService:function(c){var a=c&&c.geometryService,a=a&&"string"===typeof a&&h.trim(a)?h.trim(a):this.portalSelf.helperServices.geometry.url;
c.geometryService=a;r.geometryService=new v(c.geometryService);m.setGlobalGeometryService(c.geometryService)},_addDefaultStyle:function(c){!c.theme||c.theme.styles&&0!==c.theme.styles.length||(c.theme.styles=["default"])},_addDefaultMap:function(c){c.map.id="map";"undefined"===typeof c.map["3D"]&&"undefined"===typeof c.map["2D"]&&(c.map["2D"]=!0);"undefined"===typeof c.map.position&&(c.map.position={left:0,right:0,top:0,bottom:0});"undefined"===typeof c.map.portalUrl&&(c.map.portalUrl=c.portalUrl)},
_addDefaultVisible:function(c){m.visitElement(c,function(c){void 0===c.visible&&(c.visible=!0)})},_addDefaultSharedTheme:function(c){c.theme.sharedTheme?("undefined"===typeof c.theme.sharedTheme.useHeader&&(c.theme.sharedTheme.useHeader=!1),"undefined"===typeof c.theme.sharedTheme.useLogo&&(c.theme.sharedTheme.useLogo=!1)):c.theme.sharedTheme={useHeader:!1,useLogo:!1}},_addDefaultPanelAndPosition:function(c){this._addOnScreenDefaultPanelAndPosition(c);this._addPoolDefaultPanelAndPosition(c)},_addOnScreenDefaultPanelAndPosition:function(c){var a,
b;if(c=c.widgetOnScreen){a=c.panel&&c.panel.positionRelativeTo?c.panel.positionRelativeTo:"map";"undefined"===typeof c.panel||"undefined"===typeof c.panel.uri?c.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:a}}:"undefined"===typeof c.panel.position?c.panel.position={relativeTo:a}:"undefined"===typeof c.panel.position.relativeTo&&(c.panel.position.relativeTo=a);if(c.widgets)for(a=0;a<c.widgets.length;a++)c.widgets[a].position||(c.widgets[a].position={}),c.widgets[a].position.relativeTo||
(c.widgets[a].position.relativeTo=c.widgets[a]&&c.widgets[a].positionRelativeTo?c.widgets[a].positionRelativeTo:"map"),!0!==c.widgets[a].inPanel||c.widgets[a].panel||(c.widgets[a].panel=h.clone(c.panel),c.widgets[a].panel.position=c.widgets[a].position,c.widgets[a].panel.position.relativeTo=c.widgets[a].position.relativeTo);if(c.groups)for(a=0;a<c.groups.length;a++)for(c.groups[a].panel||(c.groups[a].panel=c.panel),c.groups[a].panel&&!c.groups[a].panel.position&&(c.groups[a].panel.position={}),c.groups[a].panel.position.relativeTo||
(c.groups[a].panel.position.relativeTo=c.groups[a].panel.positionRelativeTo?c.groups[a].panel.positionRelativeTo:"map"),c.groups[a].widgets||(c.groups[a].widgets=[]),b=0;b<c.groups[a].widgets.length;b++)c.groups[a].widgets[b].panel=c.groups[a].panel}},_addPoolDefaultPanelAndPosition:function(c){var a,b,e=c.widgetPool;if(e){a=e.panel&&e.panel.positionRelativeTo?e.panel.positionRelativeTo:"map";"undefined"===typeof e.panel||"undefined"===typeof e.panel.uri?e.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:a}}:
"undefined"===typeof e.panel.position?e.panel.position={relativeTo:a}:"undefined"===typeof e.panel.position.relativeTo&&(e.panel.position.relativeTo=a);if(e.groups)for(a=0;a<e.groups.length;a++)for(e.groups[a].panel?e.groups[a].panel.position.relativeTo||(e.groups[a].panel.position.relativeTo=e.groups[a].panel.positionRelativeTo?e.groups[a].panel.positionRelativeTo:"map"):e.groups[a].panel=e.panel,e.groups[a].widgets||(e.groups[a].widgets=[]),b=0;b<e.groups[a].widgets.length;b++)e.groups[a].widgets[b].panel=
e.groups[a].panel;if(e.widgets)for(a=0;a<e.widgets.length;a++)!1===e.widgets[a].inPanel?(b=e.widgets[a].positionRelativeTo?e.widgets[a].positionRelativeTo:"map",e.widgets[a].position)?e.widgets[a].position.relativeTo||(e.widgets[a].position.relativeTo=b):e.widgets[a].position={relativeTo:b}:e.widgets[a].panel||(e.widgets[a].panel=c.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(c){m.visitElement(c,h.hitch(this,function(c,a){c.isOnScreen=a.isOnScreen;c.widgets?(c.gid=c.id,1===c.widgets.length?
(c.label||(c.label=c.widgets[0].label?c.widgets[0].label:"Group"),c.icon||(c.icon=c.widgets[0].uri?this._getDefaultIconFromUri(c.widgets[0].uri):"jimu.js/images/group_icon.png")):(c.icon=c.icon?c.icon:"jimu.js/images/group_icon.png",c.label=c.label?c.label:"Group_"+a.index)):(c.gid=a.groupId,c.uri&&m.processWidgetSetting(c))}))},_getDefaultIconFromUri:function(c){c=c.split("/");c.pop();return c.join("/")+"/images/icon.png"},_addIndexForWidgetPool:function(c){var a=0,b,e;if(c.widgetPool.widgets)for(b=
0;b<c.widgetPool.widgets.length;b++)c.widgetPool.widgets[b].index=a,a++;if(c.widgetPool.groups)for(b=0;b<c.widgetPool.groups.length;b++)for(c.widgetPool.groups[b].index=a,a++,e=0;e<c.widgetPool.groups[b].widgets.length;e++)c.widgetPool.groups[b].widgets[e].index=e}});w.getInstance=function(c){null===n?n=new w(c):c&&(n.urlParams=c);window.getAppConfig=h.hitch(n,n.getAppConfig);return n};return w})},"dojo/_base/html":function(){define("./kernel ../dom ../dom-style ../dom-attr ../dom-prop ../dom-class ../dom-construct ../dom-geometry".split(" "),
function(p,h,d,a,g,f,k,m){p.byId=h.byId;p.isDescendant=h.isDescendant;p.setSelectable=h.setSelectable;p.getAttr=a.get;p.setAttr=a.set;p.hasAttr=a.has;p.removeAttr=a.remove;p.getNodeProp=a.getNodeProp;p.attr=function(e,b,f){return 2==arguments.length?a["string"==typeof b?"get":"set"](e,b):a.set(e,b,f)};p.hasClass=f.contains;p.addClass=f.add;p.removeClass=f.remove;p.toggleClass=f.toggle;p.replaceClass=f.replace;p._toDom=p.toDom=k.toDom;p.place=k.place;p.create=k.create;p.empty=function(a){k.empty(a)};
p._destroyElement=p.destroy=function(a){k.destroy(a)};p._getPadExtents=p.getPadExtents=m.getPadExtents;p._getBorderExtents=p.getBorderExtents=m.getBorderExtents;p._getPadBorderExtents=p.getPadBorderExtents=m.getPadBorderExtents;p._getMarginExtents=p.getMarginExtents=m.getMarginExtents;p._getMarginSize=p.getMarginSize=m.getMarginSize;p._getMarginBox=p.getMarginBox=m.getMarginBox;p.setMarginBox=m.setMarginBox;p._getContentBox=p.getContentBox=m.getContentBox;p.setContentSize=m.setContentSize;p._isBodyLtr=
p.isBodyLtr=m.isBodyLtr;p._docScroll=p.docScroll=m.docScroll;p._getIeDocumentElementOffset=p.getIeDocumentElementOffset=m.getIeDocumentElementOffset;p._fixIeBiDiScrollLeft=p.fixIeBiDiScrollLeft=m.fixIeBiDiScrollLeft;p.position=m.position;p.marginBox=function(a,b){return b?m.setMarginBox(a,b):m.getMarginBox(a)};p.contentBox=function(a,b){return b?m.setContentSize(a,b):m.getContentBox(a)};p.coords=function(a,b){p.deprecated("dojo.coords()","Use dojo.position() or dojo.marginBox().");a=h.byId(a);var e=
d.getComputedStyle(a),e=m.getMarginBox(a,e);a=m.position(a,b);e.x=a.x;e.y=a.y;return e};p.getProp=g.get;p.setProp=g.set;p.prop=function(a,b,f){return 2==arguments.length?g["string"==typeof b?"get":"set"](a,b):g.set(a,b,f)};p.getStyle=d.get;p.setStyle=d.set;p.getComputedStyle=d.getComputedStyle;p.__toPixelValue=p.toPixelValue=d.toPixelValue;p.style=function(a,b,f){switch(arguments.length){case 1:return d.get(a);case 2:return d["string"==typeof b?"get":"set"](a,b)}return d.set(a,b,f)};return p})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/promise/all dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/kernel esri/config esri/core/lang esri/geometry/SpatialReference esri/geometry/Extent esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/support/webMercatorUtils esri/tasks/GeometryService esri/tasks/support/ProjectParameters esri/core/urlUtils esri/request ./shared/utils".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x,z,A,y,B,E,C,G,J,F,I,H){function K(c,a){c=c||"";var b=0,e=[{test:window.File&&window.FileReader&&window.FileList&&window.Blob||!D.file.isEnabledFlash(),failure:[c+"libs/polyfills/fileAPI/FileAPI.js"],callback:function(){b++;b===e.length&&a()}}];for(c=0;c<e.length;c++)testLoad(e[c])}function L(c,a){var b=c.match(/url\([^)]+\)/gi),e,n;if(null===b||""===a)return c;for(e=0;e<b.length;e++)if(n=b[e].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i),4<=n.length){var x=
n[2];/^data:image\/.*;/.test(x)||(a.endWith("/")||(a+="/"),c=c.replace(n[1]+x+n[3],n[1]+a+x+n[3]))}return c}function M(c,a){var b=Array.isArray(a),e=b&&[]||{};b?(c=c||[],e=e.concat(c),a.forEach(function(a,b){"undefined"===typeof c[b]?e[b]=a:"object"===typeof a?e[b]=M(c[b],a):-1===c.indexOf(a)&&e.push(a)})):(c&&"object"===typeof c&&Object.keys(c).forEach(function(a){e[a]=c[a]}),Object.keys(a).forEach(function(b){e[b]="object"===typeof a[b]&&a[b]?c[b]?M(c[b],a[b]):a[b]:a[b]}));return e}function V(c){var a,
b={};a=c.indexOf("/");c.substring(0,a);a=c.substring(0,c.lastIndexOf("/")+1);b.folderUrl=require(D.getRequireConfig()).toUrl(a);b.amdFolder=a;b.url=b.folderUrl;if(/^http(s)?:\/\//.test(c)||/^\/\//.test(c))b.isRemote=!0;return b}function S(c){c.panels.forEach(function(c){c.uri="panels/"+c.name+"/Panel.js"});c.styles.forEach(function(c){c.uri="styles/"+c.name+"/style.css"});c.layouts.forEach(function(c){c.uri="layouts/"+c.name+"/config.json";c.icon="layouts/"+c.name+"/icon.png";c.RTLIcon="layouts/"+
c.name+"/icon_rtl.png"})}function Z(c,a){var b=c.map(function(c){return c.id});h.forEach(a,function(a){0>b.indexOf(a)&&c.push({id:a,widgets:[]})},this);var e=[];c=h.filter(c,function(c){return 0>a.indexOf(c.id)?(e.push(c),!1):!0},this);if(0===c.length)return[];var n=c[c.length-1];h.forEach(e,function(c){n.widgets=n.widgets.concat(c.widgets)},this);return c=c.sort(function(c,b){return a.indexOf(c.id)-a.indexOf(b.id)})}function R(c,a,b){function e(c,a){return p.isArray(c[a.key])?c[a.key][a.index]:c[a.key]}
a=function(c){var a=[];c.split("_").forEach(function(c){var b=!1,e;"--"===c.slice(c.length-2)&&(b=!0,c=c.slice(0,c.length-2));e=c.search(/\[[0-9]+\]/);-1===e&&(e=c.length);a.push({key:c.slice(0,e),index:Number(c.slice(e+1,-1)),deleteFlag:b})});return a}(a);for(var n=1;n<a.length-1;n++)if(c=e(c,a[n]),!c)return;if(a[a.length-1].deleteFlag)!0===b&&(p.isArray(c[a[a.length-1].key])?delete c[a[a.length-1].key][a[a.length-1].index]:delete c[a[a.length-1].key]);else if(p.isArray(c[a[a.length-1].key])){if(void 0===
b)return c[a[a.length-1].key][a[a.length-1].index];c[a[a.length-1].key][a[a.length-1].index]=b}else{if(void 0===b)return c[a[a.length-1].key];c[a[a.length-1].key]=b}}function N(c,a,b){function e(b){b=D.template.getSearchRange(a,b,"]");var e=a.slice(b.firstPos,b.lastPos);return-1!==b.firstPos?(e=a.slice(b.firstPos+e.indexOf("[")+1,b.lastPos-1),b=a.slice(b.lastPos+1),(e=D.getConfigElementById(c,e))?{object:e,key:"section_"+b,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}var n=c,x=a=a.replace(/\//g,
"_"),f=e("groups\\[.+\\]");if("deleted"!==f.state&&("isSection"===f.state&&(n=f.object,x=f.key),f=e("widgets\\[.+\\]"),"delete"!==f.state))return"isSection"===f.state&&(n=f.object,x=f.key),R(n,x,b)}var D={},P={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};p.mixin(D,H);window.atob||(window.atob=function(c){c=n.decode(c);for(var a="",b=0,e=c.length;b<e;b++)a+=String.fromCharCode(c[b]);return a});window.btob||(window.btob=function(c){for(var a=[],b=0,
e=c.length;b<e;b++)a.push(String.charCodeAt(c[b]));return n.encode(a)});var O="unload",Q=[];require.on("error",function(c){h.forEach(Q,function(a){c.info[0]&&-1<c.info[0].indexOf(a.resKey)&&a.def.reject(c);for(var b in c.info)-1<b.indexOf(a.resKey)&&a.def.reject(c)})});D.checkError=function(c,a){Q.push({resKey:c,def:a})};D.replacePlaceHolder=function(c,a){var b=t.stringify(c),e=b.match(/\$\{(\w)+\}/g);if(null===e)return c;for(c=0;c<e.length;c++){var n=e[c].match(/(\w)+/g)[0];a[n]&&(b=b.replace(e[c],
a[n]))}return t.parse(b)};D.changeUnit=function(c){var a=Math.abs(c),b;c=Math.floor(a);b=Math.floor(60*(a-c));a=(60*(60*(a-c)-b)).toFixed(2);return c+"\u00b0"+(10>b?"0"+b:b)+"'"+(10>a?"0"+a:a)+'"'};D.formatTime=function(c){var a=c/1E3;c=Math.floor(a/60);a=Number(a-60*c).toFixed(1);return(10>c?"0"+c:c)+":"+(10>a?"0"+a:a)};D.parseTime=function(c){var a=/(\d{2,})\:(\d{2})\.(\d{1})/;if(!a.test(c))return console.log("wrong time format."),-1;c=c.match(a);return 1E3*(60*parseInt(c[1],10)+parseInt(c[2],10)+
parseInt(c[3],10)/10)};D.preloadImg=function(c,a){var b=[],b="string"===typeof c?[c]:c;h.forEach(b,function(c){(new Image).src=a?a+c:c})};var T=null;D.getImagesSize=function(c){var a=new e;if(!c||0!==c.indexOf("http"))return a.reject(),a;null===T&&(T=d.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var b=l(T,"load",function(){clearTimeout(n);n=null;b.remove();var c=d.getContentBox(T);1===c.w&&1===c.h||0===c.w||0===c.h?a.reject():a.resolve([c.w,
c.h])},{}),n=setTimeout(function(){clearTimeout(n);n=null;a.reject()},5E3);d.setAttr(T,"src",c);return a};D.getPositionStyle=function(c){var a={};if(!c)return a;c=p.clone(c);if(window.isRTL){var b;"undefined"!==typeof c.left&&"undefined"!==typeof c.right?(b=c.left,c.left=c.right,c.right=b):"undefined"!==typeof c.left?(c.right=c.left,delete c.left):"undefined"!==typeof c.right&&(c.left=c.right,delete c.right);"undefined"!==typeof c.paddingLeft&&"undefined"!==typeof c.paddingRight?(b=c.paddingLeft,
c.paddingLeft=c.paddingRight,c.paddingRight=b):"undefined"!==typeof c.paddingLeft?(c.paddingRight=c.paddingLeft,delete c.paddingLeft):"undefined"!==typeof c.paddingRight&&(c.paddingLeft=c.paddingRight,delete c.paddingRight);"undefined"!==typeof c.marginLeft&&"undefined"!==typeof c.marginRight?(b=c.marginLeft,c.marginLeft=c.marginRight,c.marginRight=b):"undefined"!==typeof c.marginLeft?(c.marginRight=c.marginLeft,delete c.marginLeft):"undefined"!==typeof c.marginRight&&(c.marginLeft=c.marginRight,
delete c.marginRight)}b="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom margin marginLeft marginRight marginTop marginBottom".split(" ");for(var e=0;e<b.length;e++){var n=b[e];"number"===typeof c[n]?a[n]=c[n]+"px":"undefined"!==typeof c[n]?a[n]=c[n]:"padding"===n.substr(0,7)||"margin"===n.substr(0,7)?a[n]=0:a[n]="auto"}a.zIndex="undefined"===typeof c.zIndex?"auto":c.zIndex;return a};D.isEqual=function(c,a){function b(c,a){var x;if(null===c&&null===a||
"undefined"===typeof c&&"undefined"===typeof a)return!0;if(null===c&&null!==a||null===a&&null!==c||"undefined"===typeof c&&"undefined"!==typeof a||"undefined"===typeof a&&"undefined"!==typeof c)return!1;if(isNaN(c)&&isNaN(a)&&"number"===typeof c&&"number"===typeof a||c===a)return!0;if("function"===typeof c&&"function"===typeof a||c instanceof Date&&a instanceof Date||c instanceof RegExp&&a instanceof RegExp||c instanceof String&&a instanceof String||c instanceof Number&&a instanceof Number)return c.toString()===
a.toString();if(-1<e.indexOf(c)||-1<n.indexOf(a))return!1;if(null!==a){for(x in a)if(a.hasOwnProperty(x)!==c.hasOwnProperty(x)||typeof a[x]!==typeof c[x])return!1;for(x in c){if(a.hasOwnProperty(x)!==c.hasOwnProperty(x)||typeof a[x]!==typeof c[x])return!1;switch(typeof c[x]){case "object":case "function":e.push(c);n.push(a);if(!b(c[x],a[x]))return!1;e.pop();n.pop();break;default:if(c[x]!==a[x])return!1}}}return!0}var e,n;e=[];n=[];return b(c,a)?!0:!1};D.getUriInfo=V;D.file={loadFileAPI:function(){var c=
new e;if("unload"===O){var a=window.isBuilder?"stemapp/":"";window.FileAPI={debug:!1,flash:!0,staticPath:a+"libs/polyfills/fileAPI/",flashUrl:a+"libs/polyfills/fileAPI/FileAPI.flash.swf",flashImageUrl:a+"libs/polyfills/fileAPI/FileAPI.flash.image.swf"};K(a,p.hitch(this,function(){O="loaded";c.resolve()}));O="loading"}else"loaded"===O&&c.resolve();return c},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return a("safari")&&
6>a("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var c=null;if(document.all)try{c=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(U){c=null}else navigator.plugins&&0<navigator.plugins.length&&(c=navigator.plugins["Shockwave Flash"]);return!!c},containSeparator:function(c){return 0<=c.indexOf("/")?!0:0<=c.indexOf("\\")?!0:!1},getNameFromPath:function(c){var a="",a=0<=c.indexOf("/")?"/":"\\";c=c.split(a);return 0<c.length?c[c.length-1]:null},getFolderFromPath:function(c){return c.substr(0,
c.length-D.file.getNameFromPath(c).length)},readFile:function(c,a,b,e){if(this.supportHTML5()){var n=c.target.files[0];n&&(n.type.match(a)?n.size>=b?e({errCode:"exceed"}):(c=new FileReader,c.onload=function(c){e(null,n.name,c.target.result)},c.readAsDataURL(n)):e({errCode:"invalidType"}))}else if(this.supportFileAPI()){var x=window.FileAPI.getFiles(c);x[0].type.match(a)?x[0].size>=b?e({errCode:"exceed"}):window.FileAPI.readAsDataURL(x[0],function(c){c&&c.result?e(null,x[0].name,c.result):e({errCode:"readError"})}):
e({errCode:"invalidType"})}}};D.processWidgetSetting=function(c){if(!c.uri)return c;p.mixin(c,V(c.uri));c.icon||(c.icon=c.amdFolder+"images/icon.png");c.thumbnail||(c.thumbnail=c.amdFolder+"images/thumbnail.png");return c};D.getRequireConfig=function(){if(jimuConfig){var c=[];jimuConfig.widgetsPackage&&(c=c.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(c=c.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(c=c.concat(jimuConfig.configsPackage));return{packages:c}}return{}};
D.getTypeByGeometryType=function(c){var a="",b="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),e=["esriGeometryRing","esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(c)?a="point":0<=b.indexOf(c)?a="polyline":0<=e.indexOf(c)&&(a="polygon");return a};D.getSymbolTypeByGeometryType=function(c){var a=null;c=D.getTypeByGeometryType(c);"point"===c?a="marker":
"polyline"===c?a="line":"polygon"===c&&(a="fill");return a};D.getServices=function(){return P};D.getArcGISDefaultGeometryService=function(){return new G(P.geometryService)};D.restoreToDefaultWebMapExtent=function(a,b,n){var x=new e;if(!a||"esri.Map"!==a.declaredClass)return setTimeout(function(){x.reject("Invalid map.")},0),x;b=b&&b.itemInfo;if(!b)return setTimeout(function(){x.reject("Invalid itemInfo")},0),x;b=b.item&&b.item.extent;if(!b)return setTimeout(function(){x.reject("Invalid itemInfo.item.extent")}),
x;var f=new z({wkid:4326}),f=new A(b[0][0],b[0][1],b[1][0],b[1][1],f);if(4326===parseInt(a.spatialReference.wkid,10))return a.setExtent(f);if(a.spatialReference.isWebMercator)return f=C.geographicToWebMercator(f),a.setExtent(f);b=new J;b.geometries=[f];b.outSR=a.spatialReference;f=c&&c.defaults&&c.defaults.geometryService;f&&"esri.tasks.GeometryService"===f.declaredClass||(n&&"string"===typeof n&&p.trim(n)?(n=p.trim(n),f=new G(n)):f=D.getArcGISDefaultGeometryService());f.project(b).then(function(c){if(c=
c&&c[0])return a.setExtent(c);x.reject("Invalid projected geometry.");return x},function(c){console.error(c);x.reject(c);return x});return x};D.getAncestorWindow=function(){for(var c=window;c&&c.parent&&c!==c.parent;)c=c.parent;return c};D.getAncestorDom=function(c,a,b){if(c&&1===c.nodeType&&a&&"function"===typeof a){var e=100,n=document.body;b&&("number"===typeof b?(b=parseInt(b,10),0<b&&(e=b)):1===b.nodeType&&(n=b));for(b=0;c.parentNode&&b<e&&d.isDescendant(c.parentNode,n);){if(a(c.parentNode))return c.parentNode;
c=c.parentNode;b++}}return null};D.bindClickAndDblclickEvents=function(c,a,b,e){var n=null;if(c&&1===c.nodeType&&a&&"function"===typeof a&&b&&"function"===typeof b){var x=200;e&&"number"===typeof e&&(e=parseInt(e,10),0<e&&(x=e));var f=0,n=l(c,"click",function(c){f++;1===f?setTimeout(function(){1===f&&(f=0,a(c))},x):2===f&&(f=0,b(c))})}return n};D.isScrollToBottom=function(c){var a=d.getContentBox(c);return 1>c.scrollHeight-(c.scrollTop+a.h)};D.getAllItemTypes=function(){var c=[],c=c.concat(["Web Map",
"Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service","Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));
return c=c.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer","Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};D.getItemQueryStringByTypes=function(c){var a=
"",b=D.getAllItemTypes();if(c&&0<c.length&&0<c.length){var e="";h.forEach(c,function(a,b){e+=' type:"'+a+'" ';b!==c.length-1&&(e+=" OR ")});a=" ( "+e+" ) ";b=c.concat(b);b=h.filter(b,function(a){return h.every(c,function(c){return 0>c.toLowerCase().indexOf(a.toLowerCase())})});h.forEach(b,function(c){a+=' -type:"'+c+'" '})}return a};D.getItemQueryStringByTypeKeywords=function(c){var a="";c&&0<c.length&&(a=' typekeywords:"'+c.join(",")+'" ');return a};D.isNotEmptyString=function(c,a){var b=c&&"string"===
typeof c;return b?a?b&&p.trim(c):!0:!1};D.isValidNumber=function(c){return"number"===typeof c&&!isNaN(c)};D.isObject=function(c){return c&&"object"===typeof c};D.getRandomString=function(){var c=Math.random().toString();return c=c.slice(2,c.length)};D._getDomainsByServerName=function(c){var a=c.split("."),b=a.length;return h.map(a,p.hitch(this,function(c,e){c=a.slice(e,b);var n="",x=c.length-1;h.forEach(c,p.hitch(this,function(c,a){n+=c;a!==x&&(n+=".")}));return n}))};D.removeCookie=function(c,a){var b=
this._getDomainsByServerName(window.location.hostname);h.forEach(b,p.hitch(this,function(b){u(c,null,{expires:-1,path:a});u(c,null,{expires:-1,path:a,domain:b});u(c,null,{expires:-1,path:a,domain:"."+b})}))};D.isLocaleChanged=function(c,a){return!c.startWith(a)};D.hashToObject=function(c){c=c.replace("#","");c=f.queryToObject(c);for(var a in c)if(c.hasOwnProperty(a))try{c[a]=t.parse(c[a])}catch(aa){}return c};D.reCreateObject=function(c){function a(c){var e=[];c.forEach(function(c){Array.isArray(c)?
e.push(a(c)):"object"===typeof c?e.push(b(c)):e.push(c)});return e}function b(c){var e={},n;for(n in c)c.hasOwnProperty(n)&&(null===c[n]?e[n]=null:Array.isArray(c[n])?e[n]=a(c[n]):e[n]="object"===typeof c[n]?b(c[n]):c[n]);return e}return Array.isArray(c)?a(c):b(c)};D.setVerticalCenter=function(c){setTimeout(function(){var a=k(".jimu-vcenter-text",c),b,e;h.forEach(a,function(c){b=d.getContentBox(c).h;d.setStyle(c,{lineHeight:b+"px"})},this);a=k(".jimu-vcenter",c);h.forEach(a,function(c){b=d.getContentBox(c).h;
e=d.getContentBox(k(c).parent()[0]).h;d.setStyle(c,{marginTop:(e-b)/2+"px"})},this)},10)};D.merge=M;D.loadStyleLink=function(c,a,b){var n=new e,x,f=require(D.getRequireConfig()).toUrl(a);if(require.cache["url:"+f]){x=require.cache["url:"+f];var g=f.split("/").pop(),f=f.substr(0,f.length-g.length);x=L(x,f);c=b?d.create("style",{id:c,type:"text/css"},d.byId(b),"before"):d.create("style",{id:c,type:"text/css"},document.getElementsByTagName("head")[0]);c.styleSheet&&!c.sheet?c.styleSheet.cssText=x:c.appendChild(d.toDom(x));
n.resolve("load");return n}x=b?d.create("link",{id:c,rel:"stylesheet",type:"text/css",href:f},d.byId(b),"before"):d.create("link",{id:c,rel:"stylesheet",type:"text/css",href:f},document.getElementsByTagName("head")[0]);l(x,"load",function(){n.resolve("load")});var k=setInterval(function(){var c;if(h.some(document.styleSheets,function(b){if(b.href&&b.href.substr(b.href.indexOf(a),b.href.length)===a)return c=b,!0}))try{!n.isFulfilled()&&(c.cssRules&&c.cssRules.length||c.rules&&c.rules.length)&&n.resolve("load"),
clearInterval(k)}catch(ga){}},50);return n};D.changeLocation=function(c){window.history.pushState&&window.history.pushState({path:c},"",c)};D.urlToObject=function(c){var a=null;-1===c.indexOf("#")?(a=F.urlToObject(c),a.hash=null):(c=c.split("#"),a=F.urlToObject(c[0]),a.hash=c[1]?-1<c[1].indexOf("\x3d")?f.queryToObject(c[1]):c[1]:null);return a};D.addManifestProperies=function(c){c.icon=c.url+"images/icon.png";"theme"===c.category?S(c):("undefined"!==typeof c["2D"]&&(c.support2D=c["2D"]),"undefined"!==
typeof c["3D"]&&(c.support3D=c["3D"]),"undefined"===typeof c["2D"]&&"undefined"===typeof c["3D"]&&(c.support2D=!0),delete c["2D"],delete c["3D"],"undefined"===typeof c.properties&&(c.properties={}),H.processWidgetProperties(c))};D.getUniqueValues=function(c,a){var b=new e;c=c.replace(/\/*$/g,"")+"/generateRenderer";a=t.stringify({type:"uniqueValueDef",uniqueValueFields:[a]});I(c,{query:{classificationDef:a,f:"json"},responseType:"json",callbackParamName:"callback"}).then(p.hitch(this,function(c){var a=
c.data;c=[];(a=a&&a.uniqueValueInfos)&&0<a.length&&(c=h.map(a,p.hitch(this,function(c){return c.value})));b.resolve(c)}),p.hitch(this,function(c){b.reject(c)}));return b};D.combineRadioCheckBoxWithLabel=function(c,a){var b=!1;if(c&&1===c.nodeType&&"input"===c.tagName.toLowerCase()){var e=c.getAttribute("type")||"",e=e.toLowerCase();if("radio"===e||"checkbox"===e)b=!0}e=!1;a&&1===a.nodeType&&"label"===a.tagName.toLowerCase()&&(e=!0);b&&e&&(b=c.getAttribute("id"),b||(b="input_"+D.getRandomString(),
c.setAttribute("id",b)),a.setAttribute("for",b),d.setStyle(a,"cursor","pointer"))};D.convertExtentToPolygon=function(c){var a=c.xmin,b=c.xmax,e=c.ymin,n=c.ymax;return new E({rings:[[[a,n],[b,n],[b,e],[a,e],[a,n]]],spatialReference:c.toJson()})};D.combineGeometries=function(c){function a(c){var a={points:[],spatialReference:c[0].spatialReference.toJson()};h.forEach(c,function(c){a.points=a.points.concat(c.points)});return new y(a)}function b(c){var a={paths:[],spatialReference:c[0].spatialReference.toJson()};
h.forEach(c,function(c){a.paths=a.paths.concat(c.paths)});return new B(a)}function e(c){var a={rings:[],spatialReference:c[0].spatialReference.toJson()};h.forEach(c,function(c){"polygon"===c.type?a.rings=a.rings.concat(c.rings):"extent"===c.type&&(c=D.convertExtentToPolygon(c),a.rings=a.rings.concat(c.rings))});return new E(a)}var n=null;if(c&&0<c.length)if(1===c.length)n=c[0];else{for(var x=null,f=null,g=null,d=null,l=0;l<c.length;l++){x=c[l];switch(x.type){case "point":case "multipoint":d="point";
break;case "polyline":d="polyline";break;case "polygon":case "extent":d="polygon";break;default:return null}if(0===l)g=d;else if(g!==d)return null;if(l!==c.length-1&&(f=c[l+1],!x.spatialReference.equals(f.spatialReference)))return null}"point"===d?n=a(c):"polyline"===d?n=b(c):"polygon"===d&&(n=e(c))}return n};D.isFeaturelayerUrlSupportQuery=function(c,a){var b=!1,e=/\/featureserver\//gi.test(c);c=/\/mapserver\//gi.test(c);a=(a||"").toLowerCase();e?b=0<=a.indexOf("query"):c&&(b=0<=a.indexOf("data"));
return b};D.isImageServiceSupportQuery=function(c){return 0<=(c||"").toLowerCase().indexOf("catalog")};D.isStringEndWith=function(c,a){return c.lastIndexOf(a)+a.length===c.length};D.processManifestLabel=function(c,a){c.label=c.i18nLabels&&(c.i18nLabels[a]||c.i18nLabels.defaultLabel)||c.label||c.name;c.layouts&&h.forEach(c.layouts,function(b){var e="i18nLabels_layout_"+b.name;b.label=c[e]&&(c[e][a]||c[e].defaultLabel)||b.label||b.name});c.styles&&h.forEach(c.styles,function(b){var e="i18nLabels_style_"+
b.name;b.label=c[e]&&(c[e][a]||c[e].defaultLabel)||b.label||b.name})};D.addManifest2WidgetJson=function(c,a){p.mixin(c,a.properties);c.name=a.name;c.label||(c.label=a.label);c.manifest=a};D.widgetJson=function(){var c={addManifest2WidgetJson:function(c,a){p.mixin(c,a.properties);c.name=a.name;c.label||(c.label=a.label);c.manifest=a;c.isRemote=a.isRemote;c.isRemote&&(c.itemId=a.itemId);a.featureActions&&(c.featureActions=a.featureActions);c.icon||(c.icon=a.icon);c.thumbnail||(c.thumbnail=a.thumbnail);
c.folderUrl=a.folderUrl;c.amdFolder=a.amdFolder},removeManifestFromWidgetJson:function(c){if(c.manifest){for(var a in c.manifest.properties)c[a]=void 0;c.name=void 0;c.label=void 0;c.featureActions=void 0;c.manifest=void 0}},getUriFromItem:function(a){return a.url?c.getFolderUrlFromItem(a)+"Widget":null},getFolderUrlFromItem:function(c){if(!c.url)return null;c=/manifest\.json$/.test(c.url)?c.url.substring(0,c.url.length-13):/\/$/.test(c.url)?c.url:c.url+"/";"https:"===window.location.protocol&&(c=
c.replace(/^http:\/\//,"https://"));return c}};return c}();D.addI18NLabel=function(c){var a=new e;if(c.i18nLabels)return a.resolve(c),a;c.i18nLabels={};if(c.properties&&!1===c.properties.hasLocale)return a.resolve(c),a;var b="widget"===c.category?"_widgetLabel":"_themeLabel";require(D.getRequireConfig(),["dojo/i18n!"+c.amdFolder+"nls/strings"],function(e){c.i18nLabels[dojoConfig.locale]=e[b];"theme"===c.category&&(c.layouts&&c.layouts.forEach(function(a){c["i18nLabels_layout_"+a.name]={};c["i18nLabels_layout_"+
a.name][dojoConfig.locale]=e["_layout_"+a.name]}),c.styles&&c.styles.forEach(function(a){c["i18nLabels_style_"+a.name]={};c["i18nLabels_style_"+a.name][dojoConfig.locale]=e["_style_"+a.name]}));a.resolve(c)});return a};D.localizeNumber=function(c,a){var b=(c.toString().split(".")[1]||"").length,e="",e=a&&isFinite(a.places)&&a.places,e=0<e||0<b?"#,###,###,##0.0"+Array.prototype.join.call({length:0<e?e+1:b},"0"):"#,###,###,##0",b={locale:g.locale,pattern:e};p.mixin(b,a||{});try{return r.format(c,b)}catch(ba){return console.error(ba),
c.toLocaleString()}};D.parseNumber=function(c,a){var b={locale:g.locale};p.mixin(b,a||{});try{return r.parse(c,b)}catch(X){return console.error(X),c}};D.localizeDate=function(c,a){var b={locale:g.locale,fullYear:!0};p.mixin(b,a||{});try{return v.format(c,b)}catch(X){return console.error(X),"date"===b.selector?c.toLocaleDateString():"time"===b.selector?c.toLocaleTimeString():c.toLocaleString()}};D.localizeNumberByFieldInfo=function(c,a){var b=null,b=p.exists("format.places",a)&&a.format.places,b=D.localizeNumber(c,
{places:b});return p.exists("format.digitSeparator",a)&&!a.format.digitSeparator?b.toString().replace(new RegExp("\\"+q.group,"g"),""):b};D.fieldFormatter={getFormattedUrl:function(c){if(c&&"string"===typeof c){var a=c.indexOf("http:");-1===a&&(a=c.indexOf("https:"));if(-1<a&&-1===c.indexOf("href\x3d")){var b=c.indexOf(" ",a);-1===b&&(b=c.length);var e=c.substring(a,b);c=c.substring(0,a)+'\x3cA href\x3d"'+e+'" target\x3d"_blank"\x3e'+e+"\x3c/A\x3e"+c.substring(b,c.length)}}return c||""},getFormattedNumber:function(c,
a){if("number"===typeof c){var b=(c.toString().split(".")[1]||"").length;c=D.localizeNumberByFieldInfo(c,{format:{places:a&&"number"===typeof a.places?parseInt(a.places,10):b,digitSeparator:a&&a.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+(c||"")+"\x3c/span\x3e"}return c},getFormattedDate:function(c){c&&(c=D.localizeDate(new Date(c),{fullYear:!0}));return c||""},getCodedValue:function(c,a){if(c&&c.codedValues){for(var b=0,e=c.codedValues.length;b<e;b++){var n=c.codedValues[b];
if(x.isDefined(a)&&p.exists("code",n)&&a.toString()===n.code.toString())return n.name}return a}return a||null},getTypeName:function(c,a){for(var b=a.length,e=0;e<b;e++)if(c===a[e].id)return a[e].name;return c}};D.addRelativePathInCss=L;D.url={isAbsolute:function(c){return c?c.startWith("http")||c.startWith("/"):!1},removeQueryParamFromUrl:function(c,a){c=F.urlToObject(c);c.query&&delete c.query[a];a=c.path;for(var b in c.query)a=a===c.path?a+"?"+b+"\x3d"+c.query[b]:a+"\x26"+b+"\x3d"+c.query[b];return a},
addQueryParamToUrl:function(c,a,b){c=F.urlToObject(c);c.query||(c.query={});c.query[a]=b;a=c.path;for(var e in c.query)a=a===c.path?a+"?"+e+"\x3d"+c.query[e]:a+"\x26"+e+"\x3d"+c.query[e];return a}};D.processUrlInWidgetConfig=function(c,a){if(c)return c.startWith("data:")||c.startWith("http")||c.startWith("/")?c:c.startWith("${appPath}")?c.replace("${appPath}",window.appInfo.appPath):a+c};D.processUrlInAppConfig=function(c){if(c)return c.startWith("data:")||c.startWith("http")||c.startWith("/")?c:
window.appInfo.appPath+c};D.getLocationUrlWithoutHashAndQueryParams=function(){var c=window.location,a=c.protocol+"//"+c.host+c.pathname,c=F.urlToObject(c.href);c.query&&c.query.apiurl&&(a=D.url.addQueryParamToUrl(a,"apiurl",c.query.apiurl));return a};D.getDefaultWebMapThumbnail=function(){return require.toUrl("jimu/images/webmap.png")};D.invertColor=function(c){c=c.substring(1);3===c.length&&(c=c.slice(0,1)+c.slice(0,1)+c.slice(1,1)+c.slice(1,1)+c.slice(2,1)+c.slice(2,1));c=parseInt(c,16);return 7829367<
c?"#000000":"#ffffff"};D.mixinAppConfigPosition=function(c,a){var b=p.clone(c);if(!a)return b;a=p.clone(a);var e=b.widgetOnScreen,n=a.widgetOnScreen;n&&n.widgets&&("[object Object]"===Object.prototype.toString.call(n.widgets)?h.forEach(e.widgets,function(c,a){a=c.uri?c.uri:"ph_"+a;n.widgets[a]&&n.widgets[a].position&&(n.widgets[a].position.relativeTo||(n.widgets[a].position.relativeTo="map"),c.position=n.widgets[a].position)},this):h.forEach(n.widgets,function(c,a){c.position&&!c.position.relativeTo&&
(c.position.relativeTo="map");e.widgets[a]&&c.position&&(e.widgets[a].position=c.position)}));n&&n.groups&&("[object Object]"===Object.prototype.toString.call(n.groups)?h.forEach(e.groups,function(c,a){a=c.label?c.label:"g_"+a;n.groups[a]&&n.groups[a].panel&&n.groups[a].panel.position&&(n.groups[a].panel.position.relativeTo||(n.groups[a].panel.position.relativeTo="map"),c.panel.position=n.groups[a].panel.position)},this):(c=c.layoutDefinition?c.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager",
"jimu/layoutManagers/AbsolutePositionLayoutManager"===c?h.forEach(n.groups,function(c,a){c.panel&&c.panel.position&&!c.panel.position.relativeTo&&(c.panel.position.relativeTo="map");e.groups[a]&&c.panel&&c.panel.position&&(e.groups[a].panel.position=c.panel.position)}):"jimu/layoutManagers/GridLayoutManager"===c&&(e.groups=Z(e.groups,n.groups.map(function(c){return c.id})))));a.map&&a.map.position&&(b.map?b.map.position=a.map.position:b.map={position:a.map.position});a.widgetPool&&a.widgetPool.panel&&
(a.widgetPool.panel.position&&!a.widgetPool.panel.position.relativeTo&&(a.widgetPool.panel.position.relativeTo="map"),b.widgetPool.panel.position=a.widgetPool.panel.position);a.mobileLayout&&(b.mobileLayout=a.mobileLayout);return b};D.handleGridLayoutOnScreenGroupChange=Z;D.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(c,a,b){var e=-1;a=c.search(new RegExp(a));0<=a&&(c=c.slice(a,c.length),c=c.indexOf(b),e=a+c+b.length);return{firstPos:a,
lastPos:e}},setConfigValue:function(c,a,b){R(c,a,b)},getConfigValue:function(c,a){return R(c,a)},setConfigValueWithId:function(c,a,b){N(c,a,b)},getConfigValueWithId:function(c,a){return N(c,a)},getKeyInfo:function(c){var a=this.getWidgetIdByKey(c);if(null!==a)return{type:"widget",id:a};c=this.getGroupIdByKey(c);return null!==c?{type:"group",id:c}:{type:"unknow",id:null}},getWidgetIdByKey:function(c){var a=D.template.getSearchRange(c,D.template.widgetIdentification,"]");if(-1===a.firstPos)c=null;else{var b=
c.slice(a.firstPos,a.lastPos);c=c.slice(a.firstPos+b.indexOf("[")+1,a.lastPos-1)}return c},getGroupIdByKey:function(c){var a=D.template.getSearchRange(c,D.template.groupIdentification,"]");if(-1===a.firstPos)c=null;else{var b=c.slice(a.firstPos,a.lastPos);c=c.slice(a.firstPos+b.indexOf("[")+1,a.lastPos-1)}return c},getConfigedWidgetsByTemplateConfig:function(c){var a=[],b=D.template.widgetIdentification+"_config",e;h.forEach(c.configurationSettings,function(c){h.forEach(c.fields,function(c){c.fieldName&&
(e=D.template.getSearchRange(c.fieldName,b,"]"),0<=e.firstPos&&(c=D.template.getWidgetIdByKey(c.fieldName),-1===a.indexOf(c)&&a.push(c)))},this)},this);return a},mergeTemplateAppConfigToAppConfig:function(c,a,b){function e(c){var a=[];h.forEach(c,function(c){c&&a.push(c)},this);return a}var n=c.widgetOnScreen,x=c.portalUrl;a.values.webmap&&(c.map.itemId=a.values.webmap);b&&(c.map.mapOptions&&D.deleteMapOptions(c.map.mapOptions),c.map.portalUrl=x,a.values.app_title||(a.values.app_title=b.title),a.values.app_subtitle||
(a.values.app_subtitle=b.snippet));for(var f in a.values)"webmap"!==f&&D.template.setConfigValueWithId(c,f,a.values[f]);c.widgetPool.widgets=e(c.widgetPool.widgets);n.widgets=e(n.widgets);if(c.widgetPool.groups)for(a=0;a<c.widgetPool.groups.length;a++)c.widgetPool.groups[a].widgets=e(c.widgetPool.groups[a].widgets);if(n.groups)for(a=0;a<n.groups.length;a++)n.groups[a].widgets=e(n.groups[a].widgets);return c}};D.deleteMapOptions=function(c){c&&(delete c.extent,delete c.lods,delete c.center,delete c.scale,
delete c.zoom,delete c.maxScale,delete c.maxZoom,delete c.minScale,delete c.minZoom,delete c.initialState)};D.localeIsSame=function(c,a){return c.split("-")[0]===a.split("-")[0]};D.graphicsExtent=function(){return null};D.sanitizeHTML=function(c){return html_sanitize(c,function(c){return c},function(c){return c})};D.stripHTML=function(c){return c?-1<c.indexOf("\x3c")&&-1<c.indexOf("\x3e")?c.replace(/<(?:.|\s)*?>/g,""):c:c};D.removeSuffixSlashes=function(c){return c.replace(/\/*$/g,"")};D.getBestDisplayAttributes=
function(c,a){var b={},e=null,n;for(n in c)e=D.getBestDisplayValue(n,c,a),b[n]=e;return b};D.getBestDisplayValue=function(c,a,b){var e="",n=null;p.isArrayLike(b)?n=D.getFieldInfoByFieldName(b,c):"object"===typeof b&&b.name===c&&(n=b);n&&(e=a[c],"esriFieldTypeDate"===n.type?e&&(c=new Date(parseInt(e,10)),e=D._tryLocaleDate(c)):"number"===typeof e&&(n.domain&&"codedValue"===n.domain.type?h.some(n.domain.codedValues,function(c){if(c.code===e)return e=c.name,!0}):e=D._tryLocaleNumber(e)));if(null===e||
void 0===e)e="";return e};D._tryLocaleNumber=function(c){var a=D.localizeNumber(c);if(null===a||void 0===a)a=c;return a};D._tryLocaleDate=function(c){var a=D.localizeDate(c);a||(a=c.toLocaleDateString());return a};D.getFieldInfoByFieldName=function(c,a){var b=null;c&&0<c.length&&h.some(c,p.hitch(this,function(c){return c.name===a?(b=c,!0):!1}));return b};D.containsNonLatinCharacter=function(c){for(var a=0;a<c.length;a++)if(255<c.charCodeAt(a))return!0;return!1};D.isVersion4API=function(){return 0===
w.version.indexOf("4")};D.getEsriConfig=function(){return c};D.getEsriConfigRequestObject=function(){var a=null;return a=D.isVersion4API()?c.request:c.defaults.io};D.setGlobalGeometryService=function(a){a=new G(a);D.isVersion4API()?c.geometryService=a:c.defaults.geometryService=a;return a};D.getQueryableFeatureLayersFromMap=function(c){var a=[];c.layers&&(a=c.layers.filter(function(c){return"esri.layers.FeatureLayer"===c.declaredClass&&c.url&&c.supportedQueryFormats&&0<=c.supportedQueryFormats.toUpperCase().indexOf("JSON")}));
return a};D.has=function(c){var b=a(c);if(b)return b;if("ie"===c.toLowerCase()){c=0;var e=/MSIE (\d+\.\d+);/.test(navigator.userAgent),n=!!navigator.userAgent.match(/Trident\/7.0/),x=navigator.userAgent.indexOf("rv:11.0");e&&(c=Number(RegExp.$1));-1!==navigator.appVersion.indexOf("MSIE 10")&&(c=10);n&&-1!==x&&(c=11);return 11===c&&11||b}if("edge"===c.toLowerCase())return navigator.userAgent.split("Edge/")[1]||b};D.isNeedHttpsButNot=function(){var c=navigator.geolocation,a=window.hasOwnProperty("isSecureContext");
return(a&&window.isSecureContext||!a&&"https:"===window.location.protocol)&&c?!1:!0};D.isInConfigOrPreviewWindow=function(){var c=!1;try{c=!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(U){c=!1}return!!c};D.getAppHref=function(){var c="";return c=D.isInConfigOrPreviewWindow()?window.parent.location.href:window.location.href};D.getAppIdFromUrl=function(){var c=!0,a=D.getAppHref();if(-1!==a.indexOf("id\x3d")||-1!==a.indexOf("appid\x3d")||-1!==a.indexOf("apps"))c=
!1;if(!0===c)return a;c=this.urlToObject(window.location.href);if(c.query&&(c.query.id||c.query.appid))return c.query.id||c.query.appid;if(window.appInfo){if(window.appInfo.id)return window.appInfo.id;if(window.appInfo.appPath){if(c=window.appInfo.appPath.split("/"),c.length&&2<c.length)return c[c.length-2]}else console.error("CAN NOT getAppIdFromUrl")}};D.getEditorContentHeight=function(c,a,b){var n=new e;this._content=c;this._dom=a;this._domParam=b;var x=setTimeout(p.hitch(this,function(){clearTimeout(x);
x=null;var c=0,a=this._domParam.contentWidth;try{var b=document.createElement("div");b.setAttribute("id","fakeContent");d.setStyle(b,"background-size","contain");b.innerHTML=this._content;this._dom.appendChild(b);if(b){var e=k("img",b);e&&e.length&&e.style({maxWidth:a-20+"px"});d.setStyle(b,"position","absolute");d.setStyle(b,"width",a+"px");d.setStyle(b,"left","-99999px");d.setStyle(b,"top","-99999px");d.setStyle(b,"visibility","hidden");var f=d.getContentBox(b);f.h&&(c=f.h,c+=this._domParam.contentMarginTop+
this._domParam.footerHeight+8)}}catch(ia){console.error("can't getEditorContentHeight"+ia),c=200}n.resolve(c)}),1500);return n};D.getEditorTextColor=function(c,a){return{name:"dijit.editor.plugins.EditorTextColor",custom:{recordUID:D.getColorRecordName(c),forceAttr:a}}};D.getEditorBackgroundColor=function(c){return{name:"dijit.editor.plugins.EditorBackgroundColor",custom:{recordUID:D.getColorRecordName(c)}}};D.getColorRecordName=function(c){return"wab_cr_"+(c||"")};D.isEsriDomain=function(c){return/^https?:\/\/(?:[\w\-\_]+\.)+(?:esri|arcgis)\.com/.test(c)};
D.b64toBlob=function(c,a,b){a=a||"";b=b||512;c=window.atob(c.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,""));for(var e=[],n=0;n<c.length;n+=b){for(var x=c.slice(n,n+b),f=Array(x.length),g=0;g<x.length;g++)f[g]=x.charCodeAt(g);x=new Uint8Array(f);e.push(x)}return new Blob(e,{type:a})};D.subtractionArray=function(c,a){for(var b=c.length-1;0<=b;b--)for(var e=c[b],n=a.length-1;0<=n;n--)if(e===a[n]){c.splice(b,1);a.splice(n,1);break}return c};D.resourcesUrlToBlob=function(c){return I({url:c,handleAs:"blob"})};
D.processItemResourceOfAppConfig=function(c,a){function e(c){var a=c.obj,b=c.key,e={obj:a,key:b};"number"===typeof c.i?(e.i=c.i,e.value=a[b][c.i]):e.value=a[b];return e}function n(c){for(var a in c)if("object"===typeof c[a])if(Array.isArray(c[a]))for(var b=c,e=a,f=0;f<b[e].length;f++)"string"===typeof b[e][f]?x(b,e,f):"object"===typeof b[e][f]&&n(b[e][f]);else n(c[a]);else"string"===typeof c[a]&&x(c,a)}function x(c,b,n){"number"===typeof n?a.test(c[b][n])&&(d=a.func(e({obj:c,key:b,i:n})),"function"===
typeof d.then?g.push(d):f.push(d)):a.test(c[b])&&(d=a.func(e({obj:c,key:b})),"function"===typeof d.then?g.push(d):f.push(d))}var f=[],g=[],d;n(c);return 0<g.length?b(g).then(function(a){0<f.length&&(a=a.concat(f));return{appConfig:c,result:a}}):{appConfig:c,result:f}};return D})},"dojo/NodeList-traverse":function(){define(["./query","./_base/lang","./_base/array"],function(p,h,d){var a=p.NodeList;h.extend(a,{_buildArrayFromCallback:function(a){for(var f=[],g=0;g<this.length;g++){var d=a.call(this[g],
this[g],f);d&&(f=f.concat(d))}return f},_getUniqueAsNodeList:function(a){for(var f=[],g=0,m;m=a[g];g++)1==m.nodeType&&-1==d.indexOf(f,m)&&f.push(m);return this._wrap(f,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(a,f){a=this._getUniqueAsNodeList(a);a=f?p._filterResult(a,f):a;return a._stash(this)},_getRelatedUniqueNodes:function(a,f){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(f),a)},children:function(a){return this._getRelatedUniqueNodes(a,function(a,
d){return h._toArray(a.childNodes)})},closest:function(a,f){return this._getRelatedUniqueNodes(null,function(d,g){do if(p._filterResult([d],a,f).length)return d;while(d!=f&&(d=d.parentNode)&&1==d.nodeType);return null})},parent:function(a){return this._getRelatedUniqueNodes(a,function(a,d){return a.parentNode})},parents:function(a){return this._getRelatedUniqueNodes(a,function(a,d){for(d=[];a.parentNode;)a=a.parentNode,d.push(a);return d})},siblings:function(a){return this._getRelatedUniqueNodes(a,
function(a,d){d=[];for(var f=a.parentNode&&a.parentNode.childNodes,e=0;e<f.length;e++)f[e]!=a&&d.push(f[e]);return d})},next:function(a){return this._getRelatedUniqueNodes(a,function(a,d){for(a=a.nextSibling;a&&1!=a.nodeType;)a=a.nextSibling;return a})},nextAll:function(a){return this._getRelatedUniqueNodes(a,function(a,d){for(d=[];a=a.nextSibling;)1==a.nodeType&&d.push(a);return d})},prev:function(a){return this._getRelatedUniqueNodes(a,function(a,d){for(a=a.previousSibling;a&&1!=a.nodeType;)a=a.previousSibling;
return a})},prevAll:function(a){return this._getRelatedUniqueNodes(a,function(a,d){for(d=[];a=a.previousSibling;)1==a.nodeType&&d.push(a);return d})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-1]]:[],this)},even:function(){return this.filter(function(a,f){return 0!=f%2})},odd:function(){return this.filter(function(a,f){return 0==f%2})}});return a})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],
function(p){p=p.getObject("dojox.encoding.base64",!0);p.encode=function(h){for(var d=[],a=h.length,g=a%3,a=a-g,f=0;f<a;){var k=h[f++]<<16|h[f++]<<8|h[f++];d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>18&63));d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>12&63));d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>6&63));d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k&
63))}switch(g){case 2:k=h[f++]<<16|h[f++]<<8;d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>18&63));d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>12&63));d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>6&63));d.push("\x3d");break;case 1:k=h[f++]<<16,d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>18&63)),d.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k>>>
12&63)),d.push("\x3d"),d.push("\x3d")}return d.join("")};p.decode=function(h){h=h.split("");for(var d=[],a=h.length;"\x3d"==h[--a];);for(var g=0;g<a;){var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(h[g++])<<18;g<=a&&(f|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(h[g++])<<12);g<=a&&(f|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(h[g++])<<6);g<=a&&(f|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(h[g++]));
d.push(f>>>16&255);d.push(f>>>8&255);d.push(f&255)}for(;0==d[d.length-1];)d.pop();return d};return p})},"jimu/shared/utils":function(){define(["./basePortalUrlUtils"],function(p){function h(a,f){function d(f,e){var b,d,g,k,r="widgetOnScreen"===f;if(a[f]){if(a[f].groups)for(b=0;b<a[f].groups.length;b++)if(g=a[f].groups[b],e(g,{index:b,isWidget:!1,groupId:g.id,isThemeWidget:!1,isOnScreen:r}),a[f].groups[b].widgets)for(d=0;d<a[f].groups[b].widgets.length;d++)k=a[f].groups[b].widgets[d],e(k,{index:d,
isWidget:!0,groupId:g.id,isThemeWidget:k.uri&&-1<k.uri.indexOf("themes/"+a.theme.name),isOnScreen:r});if(a[f].widgets)for(b=0;b<a[f].widgets.length;b++)k=a[f].widgets[b],e(a[f].widgets[b],{index:b,isWidget:!0,groupId:f,isThemeWidget:k.uri&&-1<k.uri.indexOf("themes/"+a.theme.name),isOnScreen:r})}}d("widgetOnScreen",f);d("widgetPool",f)}var d={},a="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwitched isController hasVersionManager isThemeWidget supportMultiInstance mirrorIconForRTL".split(" ");
d.visitElement=h;d.getConfigElementById=function(a,f){var d;if("map"===f)return a.map;h(a,function(a){if(a.id===f)return d=a,!0});return d};d.getConfigElementByLabel=function(a,f){var d;if("map"===f)return a.map;h(a,function(a){if(a.label||a.name===f)return d=a,!0});return d};d.getConfigElementsByName=function(a,f){var d=[];if("map"===f)return[a.map];h(a,function(a){a.name===f&&d.push(a)});return d};d.getWidgetNameFromUri=function(a){a=a.split("/");a.pop();return a.pop()};d.getAmdFolderFromUri=function(a){a=
a.split("/");a.pop();return a.join("/")+"/"};d.widgetProperties=a;d.processWidgetProperties=function(d){"undefined"===typeof d.properties.isController&&(d.properties.isController=!1);"undefined"===typeof d.properties.isThemeWidget&&(d.properties.isThemeWidget=!1);"undefined"===typeof d.properties.hasVersionManager&&(d.properties.hasVersionManager=!1);a.forEach(function(a){"undefined"===typeof d.properties[a]&&(d.properties[a]=!0)})};d.getControllerWidgets=function(a){var d=[];a.visitElement(function(a){a.isController&&
d.push(a)});return d};d.isHostedService=function(a){var d=p.getServerByUrl(a);return(new RegExp(d+"/[^/]+/[^/]+/rest/services","gi")).test(a)};return d})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var p={declaredClass:"jimu.shared.basePortalUrlUtils"};"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=function(h){return this.substr(0,
h.length)===h});"function"!==typeof String.prototype.endWith&&(String.prototype.endWith=function(h){return this.substr(this.length-h.length,h.length)===h});p.getServerByUrl=function(h){h=(h||"").trim();h=h.replace(/^(http(s?):?)\/\//gi,"");0===h.indexOf("//")&&(h=h.slice(2));return h.split("/")[0]};p.getServerWithProtocol=function(h){var d="";if(h=(h||"").trim()){var a=p.getServerByUrl(h);if(!a)return d;var g=p.getProtocol(h);g?d=g+"://"+a:0===h.indexOf("//")&&(d="//"+a)}return d};p.isSameServer=
function(h,d){h=p.getServerByUrl(h)||"";d=p.getServerByUrl(d)||"";return h.toLowerCase()===d.toLowerCase()};p.isOnline=function(h){return 0<=p.getServerByUrl(h).toLowerCase().indexOf(".arcgis.com")};p.isArcGIScom=function(h){h=p.getServerByUrl(h).toLowerCase();return"www.arcgis.com"===h||"arcgis.com"===h};p.getStandardPortalUrl=function(h){var d=p.getServerByUrl(h);if(""===d)return"";p.isOnline(d)?(p.isArcGIScom(d)&&(d="www.arcgis.com"),h=p.addProtocol(h),h=p.getProtocol(h)+"://"+d):(h=(h||"").trim().replace(/sharing(.*)/gi,
"").replace(/\/*$/g,""),h=p.addProtocol(h),h.replace(new RegExp("http(s?)://"+d,"g"),"")||(h+="/arcgis"));return h};p.isSamePortalUrl=function(h,d){var a=/^http(s?):\/\//gi,g=/^\/\//gi;h=p.getStandardPortalUrl(h).toLowerCase().replace(a,"").replace(g,"");d=p.getStandardPortalUrl(d).toLowerCase().replace(a,"").replace(g,"");return h===d};p.addProtocol=function(h){if(-1>=h.toLowerCase().indexOf("http://")&&-1>=h.toLowerCase().indexOf("https://")){var d="";"undefined"!==typeof window&&window.location?
(d=window.location.protocol,h=h.startWith("//")?d+h:h.startWith("/")?d+"//"+window.location.host+h:d+"//"+h):(d="http:",h.startWith("//")&&(h=d+h))}return h};p.getProtocol=function(h){var d="";h=h.toLowerCase();0===h.indexOf("https://")?d="https":0===h.indexOf("http://")&&(d="http");return d};p.updateUrlProtocolByOtherUrl=function(h,d){d=d.toLowerCase();0===d.indexOf("https://")?h=p.setHttpsProtocol(h):0===d.indexOf("http://")&&(h=p.setHttpProtocol(h));return h};p.removeProtocol=function(h){return h.replace(/^http(s?):\/\//i,
"//")};p.setHttpProtocol=function(h){h=p.addProtocol(h);return h.replace(/^https:\/\//,"http://")};p.setHttpsProtocol=function(h){h=p.addProtocol(h);return h.replace(/^http:\/\//,"https://")};p.setProtocol=function(h,d){return 0<=d.indexOf("https")?p.setHttpsProtocol(h):0<=d.indexOf("http")?p.setHttpProtocol(h):h};p.getSharingUrl=function(h){var d="";(h=p.getStandardPortalUrl(h))&&(d=h+"/sharing");return d};p.getOAuth2Url=function(h){var d="";(h=p.getStandardPortalUrl(h))&&(d=h+"/sharing/oauth2");
return d};p.getAppIdUrl=function(h,d){var a="";(h=p.getStandardPortalUrl(h))&&(a=h+"/sharing/oauth2/apps/"+d);return a};p.getSignInUrl=function(h){var d="";(h=p.getStandardPortalUrl(h))&&(d=h+"/home/signin.html");return d};p.getBaseSearchUrl=function(h){var d="";h=p.getStandardPortalUrl(h);(h=h.replace(/\/*$/g,""))&&(d=h+"/sharing/rest/search");return d};p.getBaseItemUrl=function(h){var d="";(h=p.getStandardPortalUrl(h))&&(d=h+"/sharing/rest/content/items");return d};p.getItemUrl=function(h,d){var a=
"";(h=p.getBaseItemUrl(h))&&d&&(a=h+"/"+d);return a};p.getItemDataUrl=function(h,d){var a="";(h=p.getItemUrl(h,d))&&(a=h+"/data");return a};p.getGenerateTokenUrl=function(h){var d="";h&&(h=p.getStandardPortalUrl(h),d=h+"/sharing/generateToken");return d};p.getItemDetailsPageUrl=function(h,d){var a="";h&&d&&(h=p.getStandardPortalUrl(h),a=h+"/home/item.html?id\x3d"+d);return a};p.getUserProfilePageUrl=function(h,d){var a="";h&&d&&(h=p.getStandardPortalUrl(h),a=h+"/home/user.html?user\x3d"+d);return a};
p.getBaseGroupUrl=function(h){var d="";(h=p.getStandardPortalUrl(h))&&(d=h+"/sharing/rest/community/groups");return d};p.getPortalSelfInfoUrl=function(h){var d="";(h=p.getStandardPortalUrl(h||""))&&(d=h+"/sharing/portals/self");return d};p.getCommunitySelfUrl=function(h){var d="";(h=p.getStandardPortalUrl(h||""))&&(d=h+"/sharing/rest/community/self");return d};p.getBaseUserUrl=function(h){var d="";(h=p.getStandardPortalUrl(h))&&(d=h+"/sharing/rest/community/users");return d};p.getUserUrl=function(h,
d){var a="",g=p.getBaseUserUrl(h);h&&d&&(a=g+"/"+d);return a};p.getUserTagsUrl=function(h,d){var a="",g=p.getUserUrl(h,d);h&&d&&(a=g+"/tags");return a};p.getUserThumbnailUrl=function(h,d,a){var g="";(h=p.getUserUrl(h,d))&&a&&(g=h+"/info/"+a);return g};p.getContentUrl=function(h){var d="";h&&(h=p.getStandardPortalUrl(h),d=h+"/sharing/rest/content");return d};p.getUserContentUrl=function(h,d,a){var g="",g="";h&&d&&(g=p.getContentUrl(h),g=a?g+"/users/"+d+"/"+a:g+"/users/"+d);return g};p.getUserContentItemUrl=
function(h,d,a){var g="",g="";h&&d&&a&&(g=p.getUserContentUrl(h,d),g=g+"/items/"+a);return g};p.getItemResourceUrl=function(h,d,a){var g="",g="";h&&d&&(g=p.getContentUrl(h),g=a?g+"/items/"+d+"/resources/"+a:g+"/items/"+d+"/resources");return g};p.getAddItemUrl=function(h,d,a){var g="",g="";h&&d&&(g=p.getUserContentUrl(h,d,a),g+="/addItem");return g};p.getDeleteItemUrl=function(h,d,a){var g="";(h=p.getUserItemsUrl(h,d))&&(g=h+"/"+a+"/delete");return g};p.getUserItemsUrl=function(h,d,a){var g="",g=
"";h&&d&&(g=p.getUserContentUrl(h,d,a),g+="/items");return g};p.getUpdateItemUrl=function(h,d,a,g){var f="",f="";h&&d&&(f=p.getUserItemsUrl(h,d,g),f=f+"/"+a+"/update");return f};p.shareItemUrl=function(h,d,a,g){var f="",f="";h&&d&&(f=p.getUserItemsUrl(h,d,g),f=f+"/"+a+"/share");return f};p.getHomeIndexUrl=function(h){var d="";(h=p.getStandardPortalUrl(h))&&(d=h+"/home/index.html");return d};p.getHomeMapViewerUrl=function(h,d){var a="";if(h=p.getStandardPortalUrl(h))a=h+"/home/webmap/viewer.html",
a=d?a+("?webmap\x3d"+d):a+"?useExisting\x3d1";return a};p.getHomeGalleryUrl=function(h){var d="";(h=p.getStandardPortalUrl(h))&&(d=h+"/home/gallery.html");return d};p.getHomeGroupsUrl=function(h){var d="";(h=p.getStandardPortalUrl(h))&&(d=h+"/home/groups.html");return d};p.getHomeMyContentUrl=function(h){var d="";(h=p.getStandardPortalUrl(h))&&(d=h+"/home/content.html");return d};p.getHomeMyOrganizationUrl=function(h){var d="";(h=p.getStandardPortalUrl(h))&&(d=h+"/home/organization.html");return d};
p.getHomeUserUrl=function(h){var d="";(h=p.getStandardPortalUrl(h))&&(d=h+"/home/user.html");return d};p.getPortalHelpUrl=function(h,d){var a="";(h=p.getStandardPortalUrl(h))&&(a=h+"/portalhelp/"+(d||"en")+"/website/help/");return a};p.getPortalAdminHelpUrl=function(h,d){var a="";(h=p.getStandardPortalUrl(h))&&(a=h+"/portalhelp/"+(d||"en")+"/admin/help/");return a};p.getPortalProxyUrl=function(h){var d="";(h=p.getStandardPortalUrl(h))&&(d=h+"/sharing/proxy");return d};p.getOAuth2SignOutUrl=function(h){var d=
"";(h=p.getStandardPortalUrl(h))&&(d=h+"/sharing/oauth2/signout");return d};p.getNewPrintUrl=function(h){var d="";if(h=p.getStandardPortalUrl(h))h=p.setHttpProtocol(h),d=h+"/sharing/tools/newPrint";return d};return p})},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all ./utils jimu/tokenUtils ./dijit/Message".split(" "),function(p,
h,d,a,g,f,k,m,e,b,l,t,u,r,v,q){var n=null,w=p(k,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;window.isBuilder?(f.subscribe("app/sceneViewLoaded",h.hitch(this,this._onSceneViewLoaded)),f.subscribe("app/sceneViewChanged",h.hitch(this,this._onSceneViewChanged))):(f.subscribe("sceneViewLoaded",h.hitch(this,this._onSceneViewLoaded)),f.subscribe("sceneViewChanged",h.hitch(this,this._onSceneViewChanged)));window.isBuilder?(f.subscribe("app/appConfigLoaded",h.hitch(this,
this._onAppConfigLoaded)),f.subscribe("app/appConfigChanged",h.hitch(this,this._onAppConfigChanged))):(f.subscribe("appConfigLoaded",h.hitch(this,this._onAppConfigLoaded)),f.subscribe("appConfigChanged",h.hitch(this,this._onAppConfigChanged)));f.subscribe("userSignIn",h.hitch(this,this._onUserSignIn));f.subscribe("userSignOut",h.hitch(this,this._onUserSignOut));f.subscribe("builder/actionTriggered",h.hitch(this,this._onActionTriggered));f.subscribe("/dnd/move/start",h.hitch(this,this._onMoveStart))},
loadWidget:function(c){var a=new g,b;c=h.clone(c);c.folderUrl||r.processWidgetSetting(c);(b=this.getWidgetById(c.id))?a.resolve(b):u([this.loadWidgetClass(c),this.loadWidgetManifest(c)]).then(h.hitch(this,function(c){var b=c[0],e=c[1];this.loadWidgetResources(e).then(h.hitch(this,function(c){try{var n=this.createWidget(e,b,c);console.log("widget ["+e.uri+"] created.")}catch(G){console.log("create ["+e.uri+"] error:"+G.stack),new q({message:window.jimuNls.createWidgetError+": "+e.uri}),a.reject(G)}setTimeout(h.hitch(this,
function(){a.resolve(n);this.emit("widget-created",n);f.publish("widgetCreated",n)}),50)}),function(c){a.reject(c)})}),function(c){a.reject(c)});return a},loadWidgetClass:function(c){var a=new g,b;b=c.isRemote?c.uri+".js":c.uri;require(r.getRequireConfig(),[b],h.hitch(this,function(c){a.resolve(c)}));r.checkError(c.uri,a);return a},loadWidgetResources:function(c){var a=new g,b,e,n,d=[];n=h.clone(c);c=this.tryLoadWidgetConfig(n);b=this._tryLoadResource(n,"i18n");e=this._tryLoadResource(n,"style");
n=this._tryLoadResource(n,"template");d.push(c);d.push(b);d.push(n);d.push(e);u(d).then(h.hitch(this,function(c){var b={};b.config=c[0];b.i18n=c[1];b.template=c[2];b.style=c[3];a.resolve(b)}),function(c){a.reject(c)});return a},loadWidgetManifest:function(c){var a=new g,b=r.getUriInfo(c.uri),b=b.isRemote?b.folderUrl+"manifest.json?f\x3djson":b.folderUrl+"manifest.json";if(c.manifest)return a.resolve(c),a;t(b,{handleAs:"json",headers:{"X-Requested-With":null}}).then(h.hitch(this,function(b){if(b.error&&
b.error.code)return a.reject(b.error);b.amdFolder=c.amdFolder;b.category="widget";c.label?(this._processManifest(b),r.addManifest2WidgetJson(c,b),a.resolve(c)):r.addI18NLabel(b).then(h.hitch(this,function(){this._processManifest(b);r.addManifest2WidgetJson(c,b);a.resolve(c)}))}),function(c){a.reject(c)});return a},getWidgetMarginBox:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return{};if(c._marginBox)return c._marginBox;c.setPosition({left:-9999,top:-9999,relativeTo:c.position.relativeTo});
this.openWidget(c);c._marginBox=c.getMarginBox();this.closeWidget(c);return c._marginBox},_processManifest:function(c){r.addManifestProperies(c);r.processManifestLabel(c,window.dojoConfig.locale)},createWidget:function(c,a,b){if(this.getWidgetById(c.id))return this.getWidgetById(c.id);b.config&&b.i18n&&(b.config=r.replacePlaceHolder(b.config,b.i18n));c.rawConfig=c.config;c.config=b.config||{};this.appConfig._appData&&this._mergeAgolConfig(c);c.nls=b.i18n||{};b.template&&(c.templateString=b.template);
c["class"]="jimu-widget";c.label||(c.label=c.name);c.sceneView=this.sceneView;c.appConfig=this.appConfig;b={};for(var n in c)c.hasOwnProperty(n)&&(b[n]=c[n]);b.widgetManager=this;c=new a(b);c.clazz=a;e.after(c,"startup",h.hitch(this,this._postWidgetStartup,c));e.before(c,"destroy",h.hitch(this,this._onDestroyWidget,c));m(c.domNode,"click",h.hitch(this,this._onClickWidget,c));this.loaded.push(c);return c},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var c=d.map(this.loaded,
function(c){return c.id});d.forEach(c,function(c){this.destroyWidget(c)},this);this.loaded=[]},loadWidgetSettingPage:function(c){var a=new g;c=h.clone(c);c.id+="_setting";u([this.loadWidgetSettingClass(c)]).then(h.hitch(this,function(b){var n=b[0];this.loadWidgetSettingPageResources(c).then(h.hitch(this,function(b){var d;b={nls:b.i18n,templateString:b.template,appConfig:this.appConfig,sceneView:this.sceneView,"class":"jimu-widget-setting"};for(var x in c)c.hasOwnProperty(x)&&(b[x]=c[x]);try{d=new n(b),
e.before(d,"destroy",h.hitch(this,this._onDestroyWidgetSetting,d)),a.resolve(d)}catch(C){new q({message:window.jimuNls.createWidgetSettingError+":"+c.uri}),a.reject(C)}}),function(c){console.log(c)})}),function(c){a.reject(c)});return a},loadWidgetSettingClass:function(c){var a=new g;require(r.getRequireConfig(),[url],h.hitch(this,function(c){a.resolve(c)}));r.checkError(c.folderUrl+"setting/Setting.js",a);return a},loadWidgetSettingPageResources:function(c){var a=new g,b,e,n=[];c=h.clone(c);b=this._tryLoadResource(c,
"settingI18n");e=this._tryLoadResource(c,"settingTemplate");c=this._tryLoadResource(c,"settingStyle");n.push(b);n.push(e);n.push(c);u(n).then(h.hitch(this,function(c){var b={};b.i18n=c[0]||{};b.template=c[1];b.style=c[2];a.resolve(b)}),function(c){console.log(c)});return a},getWidgetById:function(c){var a;d.some(this.loaded,function(b){if(b.id===c)return a=b,!0},this);return a},getWidgetByLabel:function(c){var a;d.some(this.loaded,function(b){if(b.label===c)return a=b,!0},this);return a},getWidgetsByName:function(c){var a=
[];d.some(this.loaded,function(b){b.name===c&&a.push(b)},this);return a},changeWindowStateTo:function(c,a){"normal"===a?this.normalizeWidget(c):"minimized"===a?this.minimizeWidget(c):"maximized"===a?this.maximizeWidget(c):console.log("error state: "+a)},closeWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;if("closed"!==c.state){this.activeWidget&&this.activeWidget.id===c.id&&(this.activeWidget.onDeActive(),this.activeWidget=null);a.setStyle(c.domNode,"display","none");
c.setState("closed");try{c.onClose()}catch(x){console.log(console.error("fail to close widget "+c.name+". "+x.stack))}}},openWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;if(!c.started)try{c.started=!0,c.startup()}catch(x){console.error("fail to startup widget "+c.name+". "+x.stack)}if("closed"===c.state){a.setStyle(c.domNode,"display","");c.setState("opened");try{c.onOpen()}catch(x){console.error("fail to open widget "+c.name+". "+x.stack)}}},activateWidget:function(c){if("string"===
typeof c&&(c=this.getWidgetById(c),!c))return;"opened"===c.state&&this._activeWidget(c)},maximizeWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;"closed"===c.state&&this.openWidget(c);c.setWindowState("maximized");try{c.onMaximize()}catch(x){console.log(console.error("fail to maximize widget "+c.name+". "+x.stack))}},minimizeWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;"closed"===c.state&&this.openWidget(c);c.setWindowState("minimized");
try{c.onMinimize()}catch(x){console.log(console.error("fail to minimize widget "+c.name+". "+x.stack))}},normalizeWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;"closed"===c.state&&this.openWidget(c);c.setWindowState("normal");try{c.onNormalize()}catch(x){console.log(console.error("fail to normalize widget "+c.name+". "+x.stack))}},destroyWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;this._removeWidget(c);try{c.destroy()}catch(x){console.log(console.error("fail to destroy widget "+
c.name+". "+x.stack))}},tryLoadWidgetConfig:function(c){return this._tryLoadWidgetConfig(c).then(h.hitch(this,function(a){return this._upgradeWidgetConfig(c,a).then(function(a){return c.config=a})}))},triggerWidgetOpen:function(c){function a(c){var a=e.after(c,"onOpen",function(){a.remove();b.resolve(c)})}var b=new g,n=this.getWidgetById(c);if(n){if("closed"!==n.state)return b.resolve(n),b;a(n)}else var d=f.subscribe("widgetCreated",h.hitch(this,function(a){a.id===c&&(d.remove(),b.resolve(a))}));
f.publish("openWidget",c);return b},_tryLoadWidgetConfig:function(c){var a=new g;if(c.config&&h.isObject(c.config))return a.resolve(c.config),a;if(c.config){if(require.cache["url:"+c.config])return a.resolve(b.parse(require.cache["url:"+c.config])),a;a=r.processUrlInAppConfig(c.config);a=a.split("/");a[a.length-1]=encodeURIComponent(a[a.length-1]);a=a.join("/");return t(a,{handleAs:"json"})}return this._tryLoadResource(c,"config").then(function(a){c.isDefaultConfig=!0;return a})},_upgradeWidgetConfig:function(c,
a){var b=new g,e=c.manifest.version,n=c.version,d;if(e===n)return b.resolve(a),b;if(!1===c.hasVersionManager)return c.version=e,b.resolve(a),b;require(r.getRequireConfig(),[c.amdFolder+"VersionManager"],h.hitch(this,function(f){f=new f;var x=f.getVersionIndex(n),g=f.getVersionIndex(e);if(x>g)b.reject("Bad widget version number, "+c.name+","+n);else try{d=f.upgrade(a,n,e),c.version=e,b.resolve(d)}catch(J){console.log("Read widget ["+c.name+"] old config error,"+J.stack),b.resolve(a)}}));return b},
loadWidgetStyle:function(c){var b="widget/style/"+c.uri,e=new g,b=this._replaceId(b);return a.byId(b)?(e.resolve("load"),e):r.loadStyleLink(b,c.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(c){var b="widget/style/"+c.uri+"/setting",e=new g,b=this._replaceId(b);return a.byId(b)?(e.resolve("load"),e):r.loadStyleLink(b,c.settingStyleFile)},loadWidgetConfig:function(c){c=require(r.getRequireConfig()).toUrl(c.configFile);if(require.cache["url:"+c]){var a=
new g;a.resolve(b.parse(require.cache["url:"+c]));return a}return t(c,{handleAs:"json"})},loadWidgetI18n:function(c){var a=new g;require(r.getRequireConfig(),["dojo/i18n!"+c.i18nFile],function(c){a.resolve(c)});return a},loadWidgetSettingI18n:function(c){var a=new g;require(r.getRequireConfig(),["dojo/i18n!"+c.settingI18nFile],function(c){a.resolve(c)});return a},loadWidgetTemplate:function(c){var a=new g;require(r.getRequireConfig(),["dojo/text!"+c.templateFile],function(c){a.resolve(c)});r.checkError(c.templateFile,
a);return a},loadWidgetSettingTemplate:function(c){var a=new g;require(r.getRequireConfig(),["dojo/text!"+c.settingTemplateFile],function(c){a.resolve(c)});r.checkError(c.settingTemplateFile,a);return a},removeWidgetStyle:function(c){a.destroy(this._replaceId("widget/style/"+c.uri))},removeWidgetSettingStyle:function(c){a.destroy(this._replaceId("widget/style/"+c.uri+"/setting"))},getControllerWidgets:function(){return d.filter(this.loaded,function(c){return c.isController})},getOffPanelWidgets:function(){return d.filter(this.loaded,
function(c){return!c.inPanel})},getOnScreenOffPanelWidgets:function(){return d.filter(this.loaded,function(c){return c.isOnScreen&&!c.inPanel})},closeOtherWidgetsInTheSameGroup:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;for(var a=0;a<this.loaded.length;a++)this.loaded[a].gid===c.gid&&this.loaded[a].id!==c.id&&this.closeWidget(this.loaded[a])},closeAllWidgetsInGroup:function(c){for(var a=0;a<this.loaded.length;a++)this.loaded[a].gid===c&&this.closeWidget(this.loaded[a])},
_mergeAgolConfig:function(c){var a=this.appConfig._appData.values,b="widgets["+c.id+"]",e;for(e in a){var n=e.replace(/\//g,"_").indexOf(b+"_config");0<=n&&r.template.setConfigValue(c,e.replace(/\//g,"_").substr(n,e.length).replace(b,"widget"),a[e])}},_onUserSignIn:function(c){d.forEach(this.loaded,function(a){a.onSignIn(c)},this)},_onUserSignOut:function(){d.forEach(this.loaded,function(c){c.onSignOut()},this)},_activeWidget:function(c){if(this.activeWidget){if(this.activeWidget.id===c.id){!1===
this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&a.setStyle(this.activeWidget.domNode,"zIndex",101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&a.setStyle(c.domNode,"zIndex","zIndex"in c.position?c.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=c;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&a.setStyle(this.activeWidget.domNode,
"zIndex",101),this.activeWidget.onActive(),f.publish("widgetActived",c))},_onClickWidget:function(c,b){var e=l(".jimu-widget",c.domNode);if(0<e.length)for(var n=0;n<e.length;n++)if(b.target===e[n]||a.isDescendant(b.target,e[n]))return;this._activeWidget(c)},_onMoveStart:function(c){d.forEach(this.loaded,function(a){a.domNode===c.node&&this._activeWidget(a)},this)},_onAppConfigLoaded:function(c){this.appConfig=c=h.clone(c);v.setPortalUrl(c.portalUrl)},_onSceneViewLoaded:function(c){this.sceneView=
c},_onSceneViewChanged:function(c){this.sceneView=c},_onAppConfigChanged:function(c,a,b,e){var n=h.clone(c);this.appConfig=n;d.forEach(this.loaded,function(c){c&&(c.onAppConfigChanged(n,a,b,e),"widgetChange"===a&&this._onConfigChanged(b.id,b.config,e))},this)},_onConfigChanged:function(c,a){if(c=this.getWidgetById(c))c.onConfigChanged(a),h.mixin(c.config,a)},_onActionTriggered:function(c){if("map"!==c.elementId&&"app"!==c.elementId){var a=this.getWidgetById(c.elementId);if(a)a.onAction(c.action,c.data);
else this.missedActions.push({id:c.elementId,action:{name:c.action,data:c.data}});d.forEach(this.getControllerWidgets(),function(a){if(a.widgetIsControlled(c.elementId))a.onAction(c.action,{widgetId:c.elementId,data:c.data})},this)}},_postWidgetStartup:function(c){c.started=!0;r.setVerticalCenter(c.domNode);e.after(c,"resize",h.hitch(this,r.setVerticalCenter,c.domNode));this.openWidget(c);var a=v.getPortalCredential(this.appConfig.portalUrl);if(a)c.onSignIn(a);else c.onSignOut();this._triggerMissedAction(c)},
_triggerMissedAction:function(c){this.missedActions.forEach(function(a){if(a.id===c.id)c.onAction(a.action.name,a.action.data)})},_remove:function(c){return d.some(this.loaded,function(a,b){if(a.id===c)return this.loaded.splice(b,1),!0},this)},_tryLoadResource:function(c,a){var b,e=new g;if("config"===a)b=c.amdFolder+"config.json",c.configFile=b,b="hasConfig";else if("style"===a)b=c.amdFolder+"css/style.css",c.styleFile=b,b="hasStyle";else if("i18n"===a)b=c.amdFolder+"nls/strings.js",c.i18nFile=c.isRemote?
b:c.amdFolder+"nls/strings",b="hasLocale";else if("template"===a)b=c.amdFolder+"Widget.html",c.templateFile=b,b="hasUIFile";else if("settingTemplate"===a)b=c.amdFolder+"setting/Setting.html",c.settingTemplateFile=b,b="hasSettingUIFile";else if("settingI18n"===a)b=c.amdFolder+"setting/nls/strings.js",c.settingI18nFile=c.isRemote?b:c.amdFolder+"setting/nls/strings",b="hasSettingLocale";else if("settingStyle"===a)b=c.amdFolder+"setting/css/style.css",c.settingStyleFile=b,b="hasSettingStyle";else return e;
c[b]?function(){var b;if("config"===a)b=this.loadWidgetConfig(c);else if("style"===a)b=this.loadWidgetStyle(c);else if("i18n"===a)b=this.loadWidgetI18n(c);else if("template"===a)b=this.loadWidgetTemplate(c);else if("settingTemplate"===a)b=this.loadWidgetSettingTemplate(c);else if("settingStyle"===a)b=this.loadWidgetSettingStyle(c);else if("settingI18n"===a)b=this.loadWidgetSettingI18n(c);else return e;b.then(function(c){e.resolve(c)},function(b){console.error("Load widget resource error. resource:",
a);console.error(b);new q({message:window.jimuNls.loadWidgetResourceError+": "+c.uri});e.reject(b)})}.apply(this):e.resolve(null);return e},_replaceId:function(c){return c.replace(/\//g,"_").replace(/\./g,"_")},_onDestroyWidget:function(c){"closed"!==c.state&&this.closeWidget(c);this._removeWidget(c);console.log("destroy widget ["+c.uri+"].")},_onDestroyWidgetSetting:function(c){this.removeWidgetSettingStyle(c)},_removeWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;
this.activeWidget&&this.activeWidget.id===c.id&&(this.activeWidget=null);this._remove(c.id);0===this.getWidgetsByName(c.name).length&&this.removeWidgetStyle(c)}});w.getInstance=function(c){null===n&&(n=new w(c),window._widgetManager=n);return n};return w})},"jimu/tokenUtils":function(){define("require dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/request esri/core/urlUtils esri/identity/IdentityManager esri/identity/OAuthInfo jimu/portalUrlUtils jimu/utils".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q){"function"!==typeof f.getAll&&(f.getAll=function(a){var b=[];(a=f(a))&&b.push(a);return b});u={portalUrl:null,cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){return q.isInConfigOrPreviewWindow()},isStringStartWith:function(a,b){return a.substr(0,b.length)===b},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(a){(a=v.getStandardPortalUrl(a))&&(a+=
"/");this.portalUrl=a},getPortalUrl:function(){return this.portalUrl},isWebTierPortal:function(a){var n=new g,c=v.getStandardPortalUrl(a);a=c+"/sharing";var d=v.setHttpsProtocol(c+"/sharing/generateToken?f\x3djson"),f=v.setHttpsProtocol(a);e.get(d,{jsonp:"callback"}).then(h.hitch(this,function(a){a.token?(this.webTierPortalUrls.push(c),this.removeWabAuthCookie(),b.id.getCredential(f).then(h.hitch(this,function(b){function f(c){var a=c.creationTime||(new Date).getTime(),b=c.expires;0<a&&0<b&&b>a&&
setTimeout(function(){e.get(d,{jsonp:"callback"}).then(function(a){a.token&&(c.token=a.token,c.expires=a.expires,c.creationTime=(new Date).getTime(),c.refreshServerTokens(),f(c))},function(c){console.error(c)})},.8*(b-a))}b.token||(b.token=a.token);b.expires||(b.expires=a.expires);var g=q.getEsriConfigRequestObject(),x=t.canUseXhr(b.server,!0);-1<x&&g.corsEnabledServers.splice(x,1);this._pushCorsEnabledServerInfo({host:v.getServerByUrl(c),withCredentials:!0});n.resolve(!0);f(b)}),h.hitch(this,function(){n.resolve(!0)}))):
n.resolve(!1)}),h.hitch(this,function(c){console.error(c);n.reject(c)}));return n},addAuthorizedCrossOriginDomains:function(a){if(a&&0<a.length)for(var b=0;b<a.length;b++)this.addWithCredentialDomain(a[b])},addWithCredentialDomain:function(a){if(a&&"string"===typeof a){var b=q.getEsriConfigRequestObject().corsEnabledServers,c=v.getServerByUrl(a);(a=v.getServerWithProtocol(a))||(a="http://"+c);a=t.canUseXhr(a,!0);-1<a&&b.splice(a,1);this._pushCorsEnabledServerInfo({host:c,withCredentials:!0})}},_pushCorsEnabledServerInfo:function(a){if(a){var b=
q.getEsriConfigRequestObject(),c=b.corsEnabledServers,e="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");if("object"===typeof a&&"string"===typeof a.host){for(var n in a.host)a[n]="function"===typeof a.host[n]?function(){return a.host[n].apply(a.host,arguments)}:a.host[n];a.length=a.host.length;d.forEach(e,
function(c){"function"===typeof a.host[c]&&(a[c]=function(){return a.host[c].apply(a.host,arguments)})});a.withCredentials&&b.webTierAuthServers&&0>b.webTierAuthServers.indexOf(a.host)&&b.webTierAuthServers.push(a.host)}c.push(a)}},tryRegisterCredential:function(a){return this.isValidCredential(a)?d.some(b.id.credentials,h.hitch(this,function(b){return a.token===b.token}))?!1:(b.id.credentials.push(a),!0):!1},registerToken:function(a){var e=v.getSharingUrl(this.portalUrl);b.id.findCredential(e)&&
d.some(b.id.credentials,h.hitch(this,function(c,a){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,c))return b.id.credentials.splice(a,1),!0}));return this._getTokenInfo(a).then(function(c){b.id.registerToken(c)})},_getTokenInfo:function(a){var b=v.getPortalSelfInfoUrl(this.portalUrl);return e.get(b+("?f\x3djson\x26token\x3d"+a),{jsonp:"callback"}).then(h.hitch(this,function(c){if(c.user)return{server:v.getSharingUrl(this.portalUrl),ssl:c.allSSL,token:a,userId:c.user.username};throw Error(window.jimuNls.urlParams.invalidToken);
}),function(c){console.error(c);throw Error(window.jimuNls.urlParams.validateTokenError);})},_isInvalidPortalUrl:function(a){return a&&"string"===typeof a&&h.trim(a)},signInPortal:function(a){var e=new g;if(this._isInvalidPortalUrl(a)){a=v.getStandardPortalUrl(a);var c=v.getSharingUrl(a),n=this.getPortalCredential(a);n?setTimeout(h.hitch(this,function(){e.resolve(n)}),0):e=b.id.getCredential(c)}else setTimeout(h.hitch(this,function(){e.reject("Invalid portalurl.")}),0);return e},_loadPortalSelfInfo:function(a){a=
v.getPortalSelfInfoUrl(a);var b=new g;l(a,{responseType:"json",query:{f:"json"},callbackParamName:"callback"}).then(h.hitch(this,function(c){b.resolve(c.data)}),h.hitch(this,function(c){b.reject(c)}));return b},registerOAuthInfo:function(a,e){if(!a||"string"!==typeof a||!e||"string"!==typeof e)return null;var c=b.id.findOAuthInfo(a);c||(c=window.location.protocol+"//"+window.location.host+p.toUrl("jimu")+"/oauth-callback.html",c=new r({appId:e,expiration:20160,portalUrl:a,authNamespace:"/",popup:!0,
popupCallbackUrl:c}),b.id.registerOAuthInfos([c]));c.appId=e;return c},signOutAll:function(){var a=v.getStandardPortalUrl(this.portalUrl),e=!!b.id.findCredential(a+"/sharing/rest");window.appInfo.isRunInPortal?this.removeEsriAuthCookieStorage():this.removeWabAuthCookie();b.id.destroyCredentials();b.id._oAuthHash=null;e&&this._publishCurrentPortalUserSignOut(a)},userHaveSignInPortal:function(a){return!!this.getPortalCredential(h.trim(a||""))},isValidCredential:function(a){var b=!1;if(a){var b=a.token,
c=a.server,e=a.scope,b=b&&"string"===typeof b&&h.trim(b),c=c&&"string"===typeof c&&h.trim(c),e="portal"===e||"server"===e,n=!0;a.expires&&(a=parseInt(a.expires,10),n=(new Date).getTime(),n=a>n);b=b&&c&&e&&n}return b},isValidPortalCredentialOfPortalUrl:function(a,b){var c=!1;this.isValidCredential(b)&&(c="portal"===b.scope,a=v.isSameServer(a,b.server),c=c&&a);return c},getPortalCredential:function(a){var e=null;a=h.trim(a||"");if(!a)return null;a=v.getStandardPortalUrl(a);return e=this._filterPortalCredential(a,
b.id.credentials)},saveAndRegisterCookieToCredential:function(a){a=h.clone(a);a.referer=window.location.host;a.scope="portal";a.isAdmin=!!a.isAdmin;this.saveWabCookie(a);var e=a.server+"/sharing/rest";a.server=e;b.id.registerToken(a);return b.id.findCredential(e,a.userId)},registerAuth2Hash:function(a){a=h.clone(a);var b=1E3*parseInt(a.expires_in,10),b=(new Date).getTime()+b,c=v.getStandardPortalUrl(a.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,server:c,
token:a.access_token,expires:b,userId:a.username,scope:"portal",isAdmin:!!a.isAdmin})},saveWabCookie:function(a){this.removeCookie("wab_auth");f("wab_auth",k.stringify(a),{expires:new Date(a.expires),path:"/"})},removeWabAuthCookie:function(){this.removeCookie("wab_auth")},removeEsriAuthCookieStorage:function(){this.removeCookie("esri_auth");window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(a,
b){var c=null;b&&0<b.length&&(b=d.filter(b,h.hitch(this,function(c){return this.isValidPortalCredentialOfPortalUrl(a,c)})),0<b.length&&(c=b[b.length-1]));return c},_removePortalCredential:function(a){var e=h.trim(a||"");if(e){e=v.getStandardPortalUrl(e);for(a=d.filter(b.id.credentials,h.hitch(this,function(c){return this.isValidPortalCredentialOfPortalUrl(e,c)}));0<a.length;)a[0].destroy(),a.splice(0,1);b.id.credentials=d.filter(b.id.credentials,h.hitch(this,function(c){return!this.isValidPortalCredentialOfPortalUrl(e,
c)}))}},getUserIdByToken:function(a,e){var c=new g;if(a&&"string"===typeof a&&e&&"string"===typeof e){var n=v.getStandardPortalUrl(e);e=d.filter(b.id.credentials,h.hitch(this,function(c){var b=c.token===a&&c.userId;c=v.isSameServer(n,c.server);return b&&c}));if(0<e.length){var f=e[0];setTimeout(h.hitch(this,function(){c.resolve(f.userId)}),0);return c}e=v.getCommunitySelfUrl(n);l(e,{responseType:"json",query:{f:"json"},callbackParamName:"callback"}).then(h.hitch(this,function(a){a=a&&a.data;c.resolve(a&&
a.username||"")}),h.hitch(this,function(a){console.error(a);c.reject("fail to get userId by token")}))}else setTimeout(h.hitch(this,function(){c.reject("invalid parameters")}),0);return c},xtGetCredentialFromCookie:function(a){var e=f("wab_auth"),c=null;if(e)try{c=k.parse(e)}catch(x){console.error(x)}if(!c||"object"!==typeof c||!v.isSameServer(a,c.server)||window.location.host!==c.referer)return null;c.expires=parseInt(c.expires,10);e=(new Date).getTime();if(!(c.expires>e))return this.removeCookie("wab_auth"),
null;a+="/sharing/rest";c.server=a;(e=b.id.findCredential(a))||b.id.registerToken(c);return e=b.id.findCredential(a)},removeCookie:function(a){var b=this.getCookiePath();q.removeCookie(a,b)},_getDomainsByServerName:function(a){var b=a.split("."),c=b.length;return d.map(b,h.hitch(this,function(a,e){a=b.slice(e,c);var n="",f=a.length-1;d.forEach(a,h.hitch(this,function(c,a){n+=c;a!==f&&(n+=".")}));return n}))},_publishCurrentPortalUserSignIn:function(a){if(this.isValidCredential(a))try{m.publish("userSignIn",
a)}catch(w){console.error(w)}},_publishAnyUserSignIn:function(a){if(this.isValidCredential(a))try{m.publish("anyUserSignIn",a)}catch(w){console.error(w)}},_publishCurrentPortalUserSignOut:function(a){try{m.publish("userSignOut",a)}catch(w){console.error(w)}},_signInSuccess:function(a){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,a)&&this._publishCurrentPortalUserSignIn(a),this._publishAnyUserSignIn(a)}catch(w){console.error(w)}},_bindEvents:function(){a.after(b.id,"signIn",h.hitch(this,
function(b,e){console.log(e[1]);a.after(b,"callback",h.hitch(this,function(c,a){this._signInSuccess(a[0],!1)}));return b}))},isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var a=window.parent;if(a){var e=a.esri&&a.esri.id;if(e){b.id=e;p.module.deps.some(h.hitch(this,function(c){return"esri/identity/IdentityManager"===c.mid?(c.result=e,!0):!1}));var c=q.getEsriConfigRequestObject(),a=a.esriConfig.defaults.io;c.corsEnabledServers=
a.corsEnabledServers;c.webTierAuthServers=a.webTierAuthServers;c._processedCorsServers=a._processedCorsServers;c.corsStatus=a.corsStatus}}}this._bindEvents();this._started=!0}}};u.startup();return u})},"jimu/portalUrlUtils":function(){define(["dojo/_base/lang","jimu/shared/basePortalUrlUtils"],function(p,h){var d=p.clone(h);d.declaredClass="jimu.portalUrlUtils";d.getPortalUrlFromLocation=function(){return d.getPortalServerFromLocation()+d.getDeployContextFromLocation()};d.getPortalSignInUrlFromLocation=
function(){return d.getPortalUrlFromLocation()+"home/signin.html"};d.getPortalServerFromLocation=function(){return window.location.protocol+"//"+window.location.host};d.getDeployContextFromLocation=function(){var a=window.location.href.split("?")[0],d=a.indexOf("/home/");0>d&&(d=a.indexOf("/apps/"));a=a.substring(a.indexOf(window.location.host)+window.location.host.length+1,d);"/"!==a&&(a="/"+a+"/");return a};d.getRestBaseUrlFromLocation=function(){return window.location.protocol+"//"+window.location.host+
d.getDeployContextFromLocation()+"sharing/rest/"};return d})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup".split(" "),function(p,h,d,a,g,f){return p(f,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,postMixInProperties:function(){this.content=this.message},_createTitleNode:function(){this.titleLabel&&(this.titleNode=d.create("div",
{"class":"title"},this.domNode),this.titleLabeNode=d.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode),this.closeBtnNode=d.create("div",{"class":"close-btn jimu-float-trailing"},this.titleNode),this.own(g(this.closeBtnNode,"click",h.hitch(this,this.close))))},_preProcessing:function(){0===this.buttons.length&&this.buttons.push({label:window.jimuNls.common.ok,key:a.ENTER,onClick:h.hitch(this,this.close)})},_increaseZIndex:function(){d.setStyle(this.domNode,
"zIndex",501);d.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase jimu/utils".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,t){var u=0;return p(l,{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",titleLabel:"",content:null,container:null,buttons:[],enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,
autoHeight:!1,maxHeight:800,maxWidth:1024,constructor:function(){this.buttons=[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},postCreate:function(){this._preProcessing();this.inherited(arguments);this._initDomNode();this._positioning();a.place(this.domNode,this.container);setTimeout(h.hitch(this,function(){this._moveToMiddle()}),50);this.own(f(window,"resize",h.hitch(this,function(){this._fixedHeight||this.autoHeight?(this._calculatePosition(),
this._moveToMiddle()):this._positioning()})));this.overlayNode=a.create("div",{"class":"jimu-overlay"},this.container);this._increaseZIndex();g.animateProperty({node:this.domNode,properties:{opacity:1},duration:200}).play();this.domNode.focus()},_preProcessing:function(){"number"===typeof this.height&&(this._fixedHeight=!0,this.autoHeight=!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=a.create("div",{"class":"title"},this.domNode);this.titleLabeNode=a.create("span",
{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode);this.closeBtnNode=a.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing"},this.titleNode);var b=null,b="ontouchstart"in document?m.press:"click";this.own(f(this.closeBtnNode,b,h.hitch(this,this.close)))},_initDomNode:function(){this._createTitleNode();this.contentContainerNode=a.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?this.contentContainerNode.innerHTML=
this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&a.place(this.content,this.contentContainerNode));this.buttonContainer=a.create("div",{"class":"button-container"},this.domNode);0===this.buttons.length&&a.setStyle(this.buttonContainer,"display","none");for(var b=this.buttons.length-1;-1<b;b--)this._createButton(this.buttons[b]),this.buttons[b].disable&&this.disableButton(b)},_limitButtonsMaxWidth:function(){var b=
this.enabledButtons.length;if(0!==b){var e=a.getContentBox(this.buttonContainer),f=a.getMarginExtents(this.enabledButtons[0]),n=a.getPadBorderExtents(this.enabledButtons[0]),g=0,n=8===k("ie")?n.l+n.r:0,g=(e.w-(f.l+f.r+n)*b)/b;0<g&&(d.forEach(this.enabledButtons,h.hitch(this,function(c){a.setStyle(c,"maxWidth",g+"px")})),d.forEach(this.disabledButtons,h.hitch(this,function(c){a.setStyle(c,"maxWidth",g+"px")})))}},_moveableNode:function(e,d){this.moveable&&(this.moveable.destroy(),this.moveable=null);
var g=a.getMarginBox(this.container);g.l=g.l-e+d;g.w+=2*(e-d);this.moveable=new b.boxConstrainedMoveable(this.domNode,{box:g,handle:this.titleNode||this.contentContainerNode,within:!0});this.own(f(this.moveable,"Moving",h.hitch(this,this.onMoving)));this.own(f(this.moveable,"MoveStop",h.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===e("#header").length?{t:0,l:0,w:0,h:0}:a.getMarginBox("header")},_getFooterBox:function(){return 0===e(".footer",this.container).length?{t:0,l:0,w:0,
h:0}:a.getMarginBox(e(".footer",this.container)[0])},_calculatePosition:function(){var b=a.getContentBox(this.container),e=this._getHeaderBox(),d=this._getFooterBox(),d=b.h-e.h-d.h-40,n=0;n=this._fixedHeight?this.height:this.autoHeight?d-200:this.height=d>this.maxHeight?this.maxHeight:d;d=(d-n)/2+e.h+20;d=d<e.h?e.h:d;this.width=this.width||this.maxWidth;a.setStyle(this.domNode,{left:(b.w-this.width)/2+"px",top:d+"px",width:this.width+"px"})},_calculateHeight:function(){this.autoHeight?(a.setStyle(this.domNode,
"height","auto"),a.addClass(this.contentContainerNode,"content-static"),0===this.buttons.length&&a.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(a.setStyle(this.domNode,"height",this.height+"px"),a.addClass(this.contentContainerNode,"content-absolute"),a.addClass(this.buttonContainer,"button-container-absolute"),0===this.buttons.length&&a.setStyle(this.contentContainerNode,{bottom:"15px"}));this._moveableNode(this.width,100)},_moveToMiddle:function(){if(this.autoHeight){var b=a.getMarginBox(this.domNode),
e=a.getContentBox(this.container),d=this._getHeaderBox(),n=this._getFooterBox(),n=e.h-d.h-n.h-40,f=0,f=b.h||n-200,b=(n-f)/2+d.h+20,b=b<d.h?d.h:b;a.setStyle(this.domNode,{left:(e.w-this.width)/2+"px",top:b+"px",width:this.width+"px"})}},_positioning:function(){this._calculatePosition();this._calculateHeight()},_increaseZIndex:function(){a.setStyle(this.domNode,"zIndex",u+200+1);a.setStyle(this.overlayNode,"zIndex",u+200);u++},setTitleLabel:function(a){this.titleNode.innerHTML=t.stripHTML(a)},onMoving:function(b){a.setStyle(b.node,
"opacity",.9)},onMoveStop:function(b){a.setStyle(b.node,"opacity",1)},close:function(){if(!this.onClose||!1!==this.onClose()){var b=this.domNode.parentNode,e=h.clone(this.domNode);a.setStyle(this.domNode,"display","none");a.destroy(this.overlayNode);this.destroy();this.moveable.destroy();a.place(e,b);g.animateProperty({node:e,properties:{opacity:0},duration:200,onEnd:function(){a.destroy(e)}}).play()}},addButton:function(a){this._createButton(a)},_createButton:function(b){var e=" ";b.classNames&&
0<b.classNames.length&&"function"===typeof b.classNames.join&&(e+=b.classNames.join(" "));var d=a.create("div",{"class":"jimu-btn jimu-float-trailing jimu-trailing-margin1 "+e,innerHTML:b.label,title:b.title},this.buttonContainer);this.enabledButtons.unshift(d);e=a.create("div",{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+e,title:b.title,innerHTML:b.label,style:{display:"none"}},this.buttonContainer);this.disabledButtons.unshift(e);this.own(f(d,"click",h.hitch(this,
function(a){if(b.onClick)b.onClick(a);else this.close()})))},setButtonProps:function(b,e){"number"===typeof b&&isFinite(b)||(e=b,b=0);if(e&&0!==this.enabledButtons.length)for(var d in e)"title"===d?(a.setAttr(this.enabledButtons[b],"title",e[d]),a.setAttr(this.disabledButtons[b],"title",e[d])):"label"===d&&(a.setProp(this.enabledButtons[b],"innerHTML",e[d]),a.setProp(this.disabledButtons[b],"innerHTML",e[d]))},enableButton:function(b){"number"===typeof b&&isFinite(b)&&b<this.enabledButtons.length?
(a.setStyle(this.enabledButtons[b],"display","inline-block"),a.setStyle(this.disabledButtons[b],"display","none")):(d.forEach(this.enabledButtons[b],h.hitch(this,function(b){a.setStyle(b,"display","inline-block")})),d.forEach(this.disabledButtons[b],h.hitch(this,function(b){a.setStyle(b,"display","none")})))},disableButton:function(b){"number"===typeof b&&isFinite(b)&&b<this.disabledButtons.length?(a.setStyle(this.disabledButtons[b],"display","inline-block"),a.setStyle(this.enabledButtons[b],"display",
"none")):(d.forEach(this.disabledButtons,h.hitch(this,function(b){a.setStyle(b,"display","inline-block")})),d.forEach(this.enabledButtons,h.hitch(this,function(b){a.setStyle(b,"display","none")})))},showButton:function(a){this.enableButton(a)},hideButton:function(b){"number"===typeof b&&isFinite(b)&&b<this.disabledButtons.length?(a.setStyle(this.disabledButtons[b],"display","none"),a.setStyle(this.enabledButtons[b],"display","none")):(d.forEach(this.disabledButtons,h.hitch(this,function(b){a.setStyle(b,
"display","none")})),d.forEach(this.enabledButtons,h.hitch(this,function(b){a.setStyle(b,"display","none")})))}})})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),function(p,h,d,a,g,f){a=p("dojo.dnd.move.constrainedMoveable",f,{constraints:function(){},within:!1,constructor:function(a,d){d||(d={});this.constraints=d.constraints;this.within=d.within},onFirstMove:function(a){var d=this.constraintBox=this.constraints.call(this,
a);d.r=d.l+d.w;d.b=d.t+d.h;this.within&&(a=h.getMarginSize(a.node),d.r-=a.w,d.b-=a.h)},onMove:function(a,d){var e=this.constraintBox,b=a.node.style;this.onMoving(a,d);d.l=d.l<e.l?e.l:e.r<d.l?e.r:d.l;d.t=d.t<e.t?e.t:e.b<d.t?e.b:d.t;b.left=d.l+"px";b.top=d.t+"px";this.onMoved(a,d)}});g=p("dojo.dnd.move.boxConstrainedMoveable",a,{box:{},constructor:function(a,d){var e=d&&d.box;this.constraints=function(){return e}}});p=p("dojo.dnd.move.parentConstrainedMoveable",a,{area:"content",constructor:function(a,
f){var e=f&&f.area;this.constraints=function(){var a=this.node.parentNode,f=d.getComputedStyle(a),g=h.getMarginBox(a,f);if("margin"==e)return g;var k=h.getMarginExtents(a,f);g.l+=k.l;g.t+=k.t;g.w-=k.w;g.h-=k.h;if("border"==e)return g;k=h.getBorderExtents(a,f);g.l+=k.l;g.t+=k.t;g.w-=k.w;g.h-=k.h;if("padding"==e)return g;k=h.getPadExtents(a,f);g.l+=k.l;g.t+=k.t;g.w-=k.w;g.h-=k.h;return g}}});return{constrainedMoveable:a,boxConstrainedMoveable:g,parentConstrainedMoveable:p}})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager"],
function(p){function h(){this.versions=[{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",upgrader:function(d){return d},compatible:!0},{version:"2.0",description:"The version for Online 4.1.",upgrader:function(d){return d},compatible:!0},{version:"2.0.1",description:"The version for Developer Edition 2.0.",upgrader:function(d){var a=null,g=0,f=d.widgetOnScreen.widgets;if(f&&0<f.length)for(g=0;g<f.length;g++)a=f[g],"widgets/Viz/Widget"===a.uri&&(a.uri="widgets/3DFx/Widget",
a.name="3DFx");if((f=d.widgetPool.widgets)&&0<f.length)for(g=0;g<f.length;g++)a=f[g],"widgets/Viz/Widget"===a.uri&&(a.uri="widgets/3DFx/Widget",a.name="3DFx");return d},compatible:!0},{version:"2.1",description:"The version for Online 4.2.",upgrader:function(d){return d},compatible:!0},{version:"2.2",description:"The version for Online 4.3.",upgrader:function(d){return d},compatible:!0},{version:"2.3",description:"The version for Online 4.4.",upgrader:function(d){return d},compatible:!0},{version:"2.4",
description:"The version for Online 5.1.",upgrader:function(d){return d},compatible:!0},{version:"2.5",description:"The version for Online 5.2.",upgrader:function(d){return d},compatible:!0},{version:"2.6",description:"The version for Online 5.3.",upgrader:function(d){return d},compatible:!0},{version:"2.7",description:"The version for Online 5.4.",upgrader:function(d){(function(){function a(a){var f=0,g=0;if(d[a].widgets)for(f=0;f<d[a].widgets.length;f++)if("widgets/Environment/Widget"===d[a].widgets[f].uri){d[a].widgets[f].uri=
"widgets/Daylight/Widget";break}if(d[a].groups)for(f=0;f<d[a].groups.length;f++)for(var m=d[a].groups[f],g=0;g<m.widgets.length;g++)if("widgets/Environment/Widget"===m.widgets[g].uri){m.widgets[g].uri="widgets/Daylight/Widget";break}}a("widgetOnScreen");a("widgetPool")})();return d},compatible:!0},{version:"2.8",description:"The version for Online 6.1.",upgrader:function(d){return d},compatible:!0}];this.isCompatible=function(d,a){d=this.getVersionIndex(d);a=this.getVersionIndex(a);for(d+=1;d<=a;d++)if(!1===
this.versions[d].compatible)return!1;return!0}}h.prototype=new p;return h.prototype.constructor=h})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=[];this.upgrade=function(p,h,d){h=this.getVersionIndex(h);d=this.getVersionIndex(d);if(h>=d)throw Error("New version should higher than old version.");for(h+=1;h<=d;h++)this.versions[h].upgrader&&(p=this.versions[h].upgrader(p));return p};this.getVersionIndex=function(p){p=this.fixVersion(p);var h,d;for(d=
0;d<this.versions.length;d++)this.versions[d].version===p&&(h=d);null===p&&(h=-1);void 0===h&&(h=this.versions.length-1);return h};this.fixVersion=function(p){return p?p:null}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./appConfigResourceUtils ./portalUrlUtils ./AppStateManager esri/identity/IdentityManager esri/core/urlUtils".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c){var x=null,z;z=p(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(c,a){this._removeHash(c);this.urlParams=c||{};this.widgetManager=l.getInstance();h.mixin(this,a)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(h.hitch(this,function(c){var a=this.checkConfig(c);if(a)throw a;this.rawAppConfig=h.clone(c);n.getInstance().setRawAppConfig(this.rawAppConfig);
c=this._upgradeAppConfig(c);this._processAfterTryLoad(c);this.appConfig=c;if(this.urlParams.id)return this.loadWidgetsManifest(c).then(h.hitch(this,function(){return this._upgradeAllWidgetsConfig(c)})).then(h.hitch(this,function(c){return this.insertAppIdtoResourceUrlofAppConfig(c,this.urlParams.id)})).then(h.hitch(this,function(){this._configLoaded=!0;c.title&&(document.title=window.isBuilder?b.stripHTML(c.title)+" - Web AppBuilder for ArcGIS":b.stripHTML(c.title));this._readAndSetSharedTheme(c);
return this.getAppConfig()}));u.setPortalUrl(c.portalUrl);return this._proesssWebTierAndSignin(c).then(h.hitch(this,function(){return this.urlParams.appid?window.appInfo.isRunInPortal?this._getAppConfigFromTemplateAppId(c.portalUrl,this.urlParams.appid).then(h.hitch(this,function(c){this._tryUpdateAppConfigByLocationUrl(c);return this._processInPortalAppProtocol(c)})):this._processNotInPortalAppProtocol(c).then(h.hitch(this,function(c){return this._getAppDataAddTemplateDataFromTemplateAppId(c.portalUrl,
this.urlParams.appid).then(h.hitch(this,function(a){a.appData.appConfig&&(c=a.appData.appConfig);c._appData=a.appData;c.templateConfig=a.templateData;c.isTemplateApp=!0;return c}))})):this._processNotInPortalAppProtocol(c)})).then(h.hitch(this,function(c){this._processAfterTryLoad(c);this.appConfig=c;return c.map.itemId?c:r.getDefaultWebScene(c.portalUrl).then(function(a){c.map.itemId=a;return c})})).then(h.hitch(this,function(c){return this.loadWidgetsManifest(c)})).then(h.hitch(this,function(c){return c._appData?
c._appData.values&&c._appData.values.webmap?r.getPortal(c.portalUrl).getItemById(c._appData.values.webmap).then(h.hitch(this,function(a){return b.template.mergeTemplateAppConfigToAppConfig(c,c._appData,a)})):b.template.mergeTemplateAppConfigToAppConfig(c,c._appData):c})).then(h.hitch(this,function(){return this._upgradeAllWidgetsConfig(c)})).then(h.hitch(this,function(c){return c._wabAppId?this.processResourceInAppConfigForConfigLoader(c,this.urlParams):c.appItemId&&-1<window.JSON.stringify(c).indexOf("${itemId}")?
this.insertAppIdtoResourceUrlofAppConfig(c,c.appItemId):c})).then(h.hitch(this,function(){this.appConfig=c;this._configLoaded=!0;c.title&&(document.title=b.stripHTML(c.title));this._readAndSetSharedTheme(c);return this.getAppConfig()}))}),h.hitch(this,function(c){this.showError(c)}))},processResourceInAppConfigForConfigLoader:function(c,a){var b=c.portalUrl,e=c.appItemId,d=a.appid,n=new k,f=h.clone(c);this.insertAppIdtoResourceUrlofAppConfig(f,d).then(function(){if("config"===a.mode){var g=this.getResourceUrlsOfAppConfig(c).result;
0!==g.length?r.getItemResources(b,d).then(function(c){if(0===c.length)return g=g.map(function(c){return{resUrl:c}}),v.AddResourcesToItemForAppSave(b,g,e,d).then(function(){n.resolve(f)},function(c){console.warn("Add resource to template based app error:"+c.message||c);n.resolve(f)});n.resolve(f)},function(c){console.warn("Get resource of template based item error:"+c.message||c);n.resolve(f)}):n.resolve(f)}else n.resolve(f)}.bind(this),function(c){console.warn("Insert appId to resource url of appConfig error:"+
c.message||c);n.resolve(f)});return n},getResourceUrlsOfAppConfig:function(c){var a={test:function(c){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items/.test(c)},func:h.hitch(this,function(c){return c.value})};return b.processItemResourceOfAppConfig(c,a)},insertAppIdtoResourceUrlofAppConfig:function(c,a){function e(c){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items/.test(c)}function d(c,a){var b=a.obj,e=a.key,d={obj:b,key:e};"number"===typeof a.i?(d.i=a.i,d.value=b[e][a.i]):d.value=b[e];
a=d;c=f.processItemIdAndTokenOfResources(a.value,c);b=a.obj;e=a.key;"number"===typeof a.i?b[e][a.i]=c:b[e]=c;return!0}var n=c.portalUrl,f=this;return r.getPortal(n).getItemById(a).then(h.hitch(this,function(f){f={test:e,func:h.hitch(this,d,{appId:a,isPublic:"public"===f.access,portalUrl:n})};return b.processItemResourceOfAppConfig(c,f).appConfig}))},processItemIdAndTokenOfResources:function(c,a){0<c.indexOf("${itemId}")&&(c=c.replace("${itemId}",a.appId));/(\?|\&)token=.+/.test(c)&&(c=c.replace(/(\?|\&)token=.+/,
""));a.isPublic||(a=u.getPortalCredential(a.portalUrl))&&(c+="?token\x3d"+a.token);return c},getAppConfig:function(){var c=h.clone(this.appConfig);c.getConfigElementById=function(c){return b.getConfigElementById(this,c)};c.getConfigElementsByName=function(c){return b.getConfigElementsByName(this,c)};c.visitElement=function(c){b.visitElement(this,c)};this._addAuthorizedCrossOriginDomains(this.portalSelf,c);return c},_addAuthorizedCrossOriginDomains:function(c,a){c&&c.authorizedCrossOriginDomains&&
u.addAuthorizedCrossOriginDomains(c.authorizedCrossOriginDomains);a&&a.authorizedCrossOriginDomains&&u.addAuthorizedCrossOriginDomains(a.authorizedCrossOriginDomains)},checkConfig:function(c){return(c=this._getRepeatedId(c))?"repeated id:"+c:null},processProxy:function(a){var e=b.getEsriConfigRequestObject();e.alwaysUseProxy=a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.alwaysUseProxy;e.proxyUrl="";e.proxyRules=[];a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.url&&(e.proxyUrl=a.httpProxy.url);a.httpProxy&&
a.httpProxy.useProxy&&a.httpProxy.rules&&d.forEach(a.httpProxy.rules,function(a){c.addProxyRule(a)})},addNeedValues:function(c){this._processNoUriWidgets(c);this._processEmptyGroups(c);this._addElementId(c);this._processWidgetJsons(c)},showError:function(c){a.create("div",{"class":"app-error",innerHTML:b.sanitizeHTML(c.message)},document.body)},_tryLoadConfig:function(){if(this.urlParams.config)return this.configFile=this.urlParams.config,e(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(h.hitch(this,
function(c){u.setPortalUrl(c.portalUrl);return this.urlParams.token?u.registerToken(this.urlParams.token).then(function(){return c}):c}));if(this.urlParams.id){window.appInfo.isRunInPortal=!0;var c=q.getPortalUrlFromLocation(),a=new k;u.setPortalUrl(c);var b;this.urlParams.token?b=u.registerToken(this.urlParams.token):(b=new k,b.resolve());b.then(h.hitch(this,function(){r.getPortal(c).loadSelfInfo().then(h.hitch(this,function(b){this.portalSelf=b;b.allSSL&&"http:"===window.location.protocol?(window.location.href=
q.setHttpsProtocol(window.location.href),a.reject()):this._processSignIn(c).then(h.hitch(this,function(){this._getAppConfigFromAppId(c,this.urlParams.id).then(h.hitch(this,function(c){this._tryUpdateAppConfigByLocationUrl(c);return this._processInPortalAppProtocol(c)})).then(function(c){a.resolve(c)},function(c){a.reject(c)})}))}))}),h.hitch(this,function(c){this.showError(c)}));return a}this.configFile="config.json";return e(this.configFile,{handleAs:"json"}).then(h.hitch(this,function(c){u.setPortalUrl(c.portalUrl);
return this.urlParams.token?u.registerToken(this.urlParams.token).then(function(){return c}):c}))},_upgradeAppConfig:function(c){var a=window.wabVersion,b=c.wabVersion;if(a===b)return c;var e=this.versionManager.getVersionIndex(b),d=this.versionManager.getVersionIndex(a);if(e>d)throw Error("Bad version number, "+b);c=this.versionManager.upgrade(c,b,a);c.wabVersion=a;c.isUpgraded=!0;return c},_upgradeAllWidgetsConfig:function(c){var a=new k,b=[];if(!c.isUpgraded)return a.resolve(c),a;delete c.isUpgraded;
t.visitElement(c,h.hitch(this,function(c){c.uri&&(c.config?(c=this.widgetManager.tryLoadWidgetConfig(c),b.push(c)):c.version=c.manifest.version)}));m(b).then(h.hitch(this,function(){a.resolve(c)}),function(c){a.reject(c)});return a},_processAfterTryLoad:function(c){this._setPortalUrl(c);this._tryUpdateAppConfigByLocationUrl(c);this._processUrlParams(c);this.addNeedValues(c);this.processProxy(c);w.tokenValidity=10080;return c},_readAndSetSharedTheme:function(c){c.theme.sharedTheme||(c.theme.sharedTheme=
{useHeader:!1,useLogo:!1},c.theme.sharedTheme.isPortalSupport=this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?!0:!1);c.theme.sharedTheme.useHeader&&(c.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(c.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},c.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text):console.error("Portal does not support sharedTheme."));c.theme.sharedTheme.useLogo&&
(c.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(c.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",!c.logoLink&&this.portalSelf.portalProperties.sharedTheme.logo.link&&(c.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link)):(console.error("Portal does not support sharedTheme, use default logo."),c.logo="images/app-logo.png"))},_tryUpdateAppConfigByLocationUrl:function(c){if(!(this.urlParams.config&&
-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var a=q.getPortalUrlFromLocation(),a=q.getStandardPortalUrl(a);q.isOnline(a)&&(a=q.updateUrlProtocolByOtherUrl(a,c.portalUrl),c.map.portalUrl&&q.isSamePortalUrl(c.portalUrl,c.map.portalUrl)&&(c.map.portalUrl=a),c.portalUrl=a,c.httpProxy&&c.httpProxy.url&&(c.httpProxy.url=q.getPortalProxyUrl(a)))}},_processWidgetJsons:function(c){t.visitElement(c,function(c,a){a.isWidget&&c.uri&&b.processWidgetSetting(c)})},_processNoUriWidgets:function(c){var a=
0;t.visitElement(c,function(c,b){b.isWidget&&!c.uri&&(a++,c.placeholderIndex=a)})},_processEmptyGroups:function(c){var a=0;c.widgetOnScreen.groups&&d.forEach(c.widgetOnScreen.groups,function(c){if(!c.widgets||c.widgets&&0===c.widgets.length)a++,c.placeholderIndex=a})},_addElementId:function(c){var a=0,b;t.visitElement(c,function(c){if(c.id){c.id=c.id.replace(/\//g,"_");var e=c.id.lastIndexOf("_");-1<e&&(b=c.id.substr(e+1),a=Math.max(a,b))}});t.visitElement(c,function(c){c.id||(a++,c.id=c.uri?c.uri.replace(/\//g,
"_")+"_"+a:"_"+a)})},_setPortalUrl:function(c){if(c.portalUrl){var a=q.getPortalUrlFromLocation(),b=q.isOnline(a);q.isSamePortalUrl(c.portalUrl,a)||b||(window.appInfo.isRunInPortal=!1)}else window.isXT&&f("wab_portalurl")?c.portalUrl=f("wab_portalurl"):(window.appInfo.isRunInPortal=!0,c.portalUrl=q.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(c,a){c.portalUrl=q.setProtocol(c.portalUrl,a);c.map.portalUrl&&(c.map.portalUrl=q.setProtocol(c.map.portalUrl,a));c.httpProxy&&(c.httpProxy.url=
q.setProtocol(c.httpProxy.url,a),c.httpProxy&&c.httpProxy.rules&&d.forEach(c.httpProxy.rules,h.hitch(this,function(c){c.proxyUrl=q.setProtocol(c.proxyUrl,a)})))},_processInPortalAppProtocol:function(c){var a=new k,b=r.getPortal(c.portalUrl),e=h.hitch(this,function(b){if("https:"===window.location.protocol)this._changePortalUrlProtocol(c,"https");else{if(b){window.location.href=q.setHttpsProtocol(window.location.href);a.reject();return}this._changePortalUrlProtocol(c,"http")}this._checkLocale();a.resolve(c)});
b.loadSelfInfo().then(h.hitch(this,function(a){this.portalSelf=a;"private"===a.access?(a=0===c.portalUrl.toLowerCase().indexOf("https://"),e(a)):e(a.allSSL)}),h.hitch(this,function(c){a.reject(c)}));return a},_processNotInPortalAppProtocol:function(c){var a=new k;c.portalUrl?r.getPortal(c.portalUrl).loadSelfInfo().then(h.hitch(this,function(b){this.portalSelf=b;var e="https:"===window.location.protocol;(b.allSSL||e)&&this._changePortalUrlProtocol(c,"https");0!==c.portalUrl.toLowerCase().indexOf("https://")||
e||u.isInConfigOrPreviewWindow()?a.resolve(c):(window.location.href=q.setHttpsProtocol(window.location.href),a.reject())}),h.hitch(this,function(c){a.reject(c)})):a.resolve(c);return a},_proesssWebTierAndSignin:function(c){var a=new k,b=!1,e=c.portalUrl;this._processWebTier(c).then(h.hitch(this,function(c){b=c;return r.getPortal(e).loadSelfInfo()})).then(h.hitch(this,function(c){this.portalSelf=c;return this._processSignIn(e,b)})).then(h.hitch(this,function(){a.resolve()}),function(c){a.reject(c)});
return a},_processWebTier:function(c){var a=new k,b=c.portalUrl;c.isWebTier?(u.addAuthorizedCrossOriginDomains([b]),u.isWebTierPortal(b).then(h.hitch(this,function(){var e=u.getPortalCredential(b);e&&e.ssl&&"http:"===window.location.protocol&&!u.isInConfigOrPreviewWindow()?window.location.href=q.setHttpsProtocol(window.location.href):a.resolve(c.isWebTier)}),h.hitch(this,function(c){a.reject(c)}))):a.resolve(!1);return a},_processSignIn:function(c,a){var b=new k,e=r.getPortal(c),d=q.getSharingUrl(c);
window.appInfo.isRunInPortal?(a=w.checkSignInStatus(d),a.always(h.hitch(this,function(){b.resolve()}))):(u.isInBuilderWindow()||u.isInConfigOrPreviewWindow()||!this.portalSelf.supportsOAuth||!this.rawAppConfig.appId||a||u.registerOAuthInfo(c,this.rawAppConfig.appId),a=w.checkSignInStatus(d),a.always(h.hitch(this,function(){u.xtGetCredentialFromCookie(c);e.loadSelfInfo().then(h.hitch(this,function(c){this.portalSelf=c;this._checkLocale();b.resolve()}))})));return b},_checkLocale:function(){if(!u.isInConfigOrPreviewWindow()){var c=
this.portalSelf.user&&this.portalSelf.user.culture||g.locale,c=c.toLowerCase();!this.urlParams.locale&&b.isLocaleChanged(g.locale,c)&&(f("wab_app_locale",c),window.location.reload())}},_getAppConfigFromTemplateAppId:function(c,a){var b=r.getPortal(c);return this._getWabAppIdAndDataFromTemplateAppId(c,a).then(h.hitch(this,function(a){var e=a.appId,d=a.appData;return m([this._getAppConfigFromAppId(c,e),b.getItemData(d.source)]).then(h.hitch(this,function(c){var a;d.appConfig?(a=d.appConfig,delete d.appConfig):
a=c[0];a=this._upgradeAppConfig(a);c=c[1];a._appData=d;a._wabAppId=e;a.templateConfig=c;a.isTemplateApp=!0;return a}))}))},_getAppDataAddTemplateDataFromTemplateAppId:function(c,a){var b=r.getPortal(c);return b.getItemData(a).then(function(c){return b.getItemData(c.source).then(function(a){return{appData:c,templateData:a}})})},_getWabAppIdAndDataFromTemplateAppId:function(a,b){var e=new k,d=r.getPortal(a);d.getItemData(b).then(h.hitch(this,function(a){d.getItemById(a.source).then(h.hitch(this,function(b){b=
c.urlToObject(b.url);e.resolve({appId:b.query.id,appData:a})}))}),function(c){e.reject(c)});return e},_getAppConfigFromAppId:function(c,a){return r.getPortal(c).getItemData(a)},_removeHash:function(c){for(var a in c)c[a]&&(c[a]=c[a].replace("#",""))},loadWidgetsManifest:function(c){function a(a,d,n){function f(b){return a.loadWidgetManifest(b).then(function(c){return c},function(a){console.log("Widget failed to load, it is removed.",b.name);a.stack?console.error(a.stack):console.log(a);e(c,b)})}return d.itemId?
r.getPortal(n).getItemById(d.itemId).then(function(a){var n;n=b.isEsriDomain(a.url)?!0:u.getPortalCredential(c.portalUrl)?!0:!1;if(n)return d.uri=b.widgetJson.getUriFromItem(a),f(d);console.log("Widget is not useable, it is removed.",d.name);e(c,d)}):f(d)}function e(c,a){function b(b){c[b]&&c[b].widgets&&(c[b].widgets=c[b].widgets.filter(function(c){if(a)return c.id!==a.id;c.uri&&!c.manifest&&console.error("Widget is removed because it is not loaded successfully.",c.uri);return c.manifest}));c[b]&&
c[b].groups&&c[b].groups.forEach(function(c){c.widgets&&(c.widgets=c.widgets.filter(function(c){if(a)return c.id!==a.id;c.uri&&!c.manifest&&console.error("Widget is removed because it is not loaded successfully.",c.uri);return c.manifest}))})}b("widgetOnScreen");b("widgetPool")}var d=[],n=new k;c._buildInfo&&c._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(h.hitch(this,function(e){t.visitElement(c,h.hitch(this,function(n){n.widgets||!n.uri&&!n.itemId||(n.uri&&e[n.uri]?(this._addNeedValuesForManifest(e[n.uri],
n.uri),b.widgetJson.addManifest2WidgetJson(n,e[n.uri])):d.push(a(this.widgetManager,n,c.portalUrl)))}));m(d).then(function(){n.resolve(c)})})):(t.visitElement(c,h.hitch(this,function(b){b.widgets||!b.uri&&!b.itemId||d.push(a(this.widgetManager,b,c.portalUrl))})),m(d).then(function(){n.resolve(c)}));setTimeout(function(){n.isResolved()||(e(c),n.resolve(c))},6E4);return n},_addNeedValuesForManifest:function(c,a){h.mixin(c,b.getUriInfo(a));b.addManifestProperies(c);b.processManifestLabel(c,g.locale)},
_loadMergedWidgetManifests:function(){return e(window.appInfo.appPath+"widgets/widgets-manifest.json",{handleAs:"json"})},_getRepeatedId:function(c){var a=[],b;t.visitElement(c,function(c){if(0<a.indexOf(c.id))return b=c.id,!0;a.push(c.id)});return b},_processUrlParams:function(c){var a=this.urlParams.itemid||this.urlParams.webmap;a&&c.map.itemId!==a&&(c.map.mapOptions&&b.deleteMapOptions(c.map.mapOptions),c.map.itemId=a);this.urlParams.mode&&(c.mode=this.urlParams.mode);c.map.mapOptions||(c.map.mapOptions=
{});this.urlParams.scale&&(c.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||this.urlParams.zoom)c.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});z.getInstance=function(c,a){null===x?x=new z(c,a):(x.urlParams=c,x.options=a);return x};return z})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json esri/request ./utils ./portalUrlUtils ./tokenUtils".split(" "),function(p,
h,d,a,g,f,k,m,e,b,l){var t=p([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(a){this.portalUrl=b.getStandardPortalUrl(a);this.selfUrl=b.getPortalSelfInfoUrl(a)},loadSelfInfo:function(){var a=new g,b={query:{f:"json"},responseType:"json",callbackParamName:"callback",cacheBust:!0};this.isValidCredential()&&(b.query.token=this.credential.token);m(this.selfUrl,b).then(h.hitch(this,function(c){c=c.data;var b=c.user;delete c.user;
h.mixin(this,c);c.user=b;a.resolve(c)}),h.hitch(this,function(c){console.error(c);a.reject(c)}));return a},_checkCredential:function(){var a=l.isValidCredential(this.credential);a||this.clearCredentialAndUser();return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=l.getPortalCredential(this.portalUrl))},signIn:function(){var a=new g;this.updateCredential();this.isValidCredential()?setTimeout(h.hitch(this,
function(){a.resolve(this.credential)}),0):a=l.signInPortal(this.portalUrl);return a},haveSignIn:function(){return l.userHaveSignInPortal(this.portalUrl)},clearCredentialAndUser:function(){this.user=this.credential=null},getUser:function(){this.updateCredential();var a=new g;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(h.hitch(this,function(){this.user.updateCredential();a.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(h.hitch(this,
function(b){this.user=b;a.resolve(this.user)}),h.hitch(this,function(b){console.error(b);a.reject(b)})):l.getUserIdByToken(this.credential.token,this.portalUrl).then(h.hitch(this,function(b){this.credential.userId=b;this._getUser(this.credential.userId).then(h.hitch(this,function(c){this.user=c;a.resolve(this.user)}),h.hitch(this,function(c){console.error(c);a.reject(c)}))}),h.hitch(this,function(b){console.error(b);a.reject(b)})):setTimeout(h.hitch(this,function(){a.reject("credential is null.")}),
0);return a},queryItems:function(a){this.updateCredential();var e=new g,c=b.getBaseSearchUrl(this.portalUrl),n={f:"json"};a&&(n=h.mixin(n,a));this.isValidCredential()&&(n.token=this.credential.token);n.sortField||n.sortOrder||(n.sortField="title",n.sortOrder="asc");m(c,{responseType:"json",query:n,callbackParamName:"callback"}).then(h.hitch(this,function(c){c=c.data;c.results=d.map(c.results,h.hitch(this,function(c){c.portalUrl=this.portalUrl;c.credential=this.credential;c.portal=this;return new v(c)}));
e.resolve(c)}),h.hitch(this,function(c){console.error(c);e.reject(c)}));return e},getItemData:function(a){this.updateCredential();a=b.getItemDataUrl(this.portalUrl,a);var e={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(e.query.token=this.credential.token);var c=new g;m(a,e).then(h.hitch(this,function(a){c.resolve(a.data)}),h.hitch(this,function(a){c.reject(a)}));return c},getItemById:function(a){var e=new g;this.updateCredential();a=b.getItemUrl(this.portalUrl,
a);var c={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(c.query.token=this.credential.token);m(a,c).then(h.hitch(this,function(c){c=c.data;c.portalUrl=this.portalUrl;c.credential=this.credential;c.portal=this;c=new v(c);e.resolve(c)}),h.hitch(this,function(c){console.error(c);e.reject(c)}));return e},getAppById:function(a){var e=new g;this.updateCredential();this.isValidCredential()?(a=b.getAppIdUrl(this.portalUrl,a),m(a,{responseType:"json",query:{f:"json",
token:this.credential.token}}).then(h.hitch(this,function(c){e.resolve(c.data)}),h.hitch(this,function(c){e.reject(c)}))):setTimeout(h.hitch(this,function(){e.reject("token is null.")}),0);return e},queryGroups:function(a){this.updateCredential();var e=new g,c=b.getBaseGroupUrl(this.portalUrl),f={f:"json"};a&&(f=h.mixin(f,a));this.isValidCredential()&&(f.token=this.credential.token);m(c,{responseType:"json",query:f,callbackParamName:"callback"}).then(h.hitch(this,function(c){c=c.data;c.results=d.map(c.results,
h.hitch(this,function(c){c.portalUrl=this.portalUrl;c.credential=this.credential;c.portal=this;return new r(c)}));e.resolve(c)}),h.hitch(this,function(c){console.error(c);e.reject(c)}));return e},registerApp:function(a,e,c){var d=new g;this.updateCredential();if(this.isValidCredential()){var f=this.credential&&this.credential.token,n=b.getOAuth2Url(this.portalUrl);m(n+"/registerApp",{query:{itemId:a,appType:e,redirect_uris:k.stringify(c),token:f,f:"json"},responseType:"json",method:"post"}).then(h.hitch(this,
function(c){d.resolve(c.data)}),h.hitch(this,function(c){d.reject(c)}))}else setTimeout(h.hitch(this,function(){d.reject("token is null.")}),0);return d},createAndRegisterApp:function(a){var b=new g;this.updateCredential();this.isValidCredential()?this.getUser().then(h.hitch(this,function(c){c.addItem({title:"Web AppBuilder for ArcGIS",type:"Web Mapping Application",text:"",snippet:"",tags:"Registered App for OAuth"},"").then(h.hitch(this,function(c){c.success?this.registerApp(c.id,"browser",a).then(h.hitch(this,
function(c){b.resolve(c)}),h.hitch(this,function(c){console.error(c);b.reject(c)})):b.reject("create app failed")}),h.hitch(this,function(c){console.error(c);b.reject(c)}))}),h.hitch(this,function(c){console.error(c);b.reject(c)})):setTimeout(h.hitch(this,function(){b.reject("token is null.")}),0);return b},_getUser:function(a){this.updateCredential();var e=new g;a=b.getUserUrl(this.portalUrl,a);var c={query:{f:"json"},responseType:"json",callbackParamName:"callback"};this.isValidCredential()&&(c.query.token=
this.credential&&this.credential.token);m(a,c).then(h.hitch(this,function(c){c=c.data;c.portalUrl=this.portalUrl;c.credential=this.credential;c.portal=this;this.user=new u(c);e.resolve(this.user)}),h.hitch(this,function(c){console.error(c);e.reject(c)}));return e},getItemResources:function(a,e,c){c||(c=100);a=b.getStandardPortalUrl(a);a=b.getItemResourceUrl(a,e);return m({url:a,content:{f:"json",num:c}}).then(function(c){if(c&&c.resources)return c.resources})},addResource:function(a,e,c,d,f){a=b.getStandardPortalUrl(a);
var n=this.getPortal(a),g=new FormData;g.append("file",c,d);g.append("fileName",d);g.append("f","json");var l="";f?(g.append("resourcesPrefix",f),l=f+"/"+d):l=d;return n.getItemById(e,!0).then(function(c){c=b.getUserContentItemUrl(a,c.owner,e);return m({url:c+"/addResources",form:g}).then(function(c){var e="";c&&c.success&&(e=b.getItemResourceUrl(a,"${itemId}",l));return e},function(c){console.error(c.message||c);return c})})},removeResources:function(a,e,c,d){var f={resource:d?d+"/"+c:c,f:"json"};
a=b.getStandardPortalUrl(a);return this.getPortal(a).getItemById(e,!0).then(function(c){c=b.getUserContentItemUrl(a,c.owner,e);return m({url:c+"/removeResources",content:f},{usePost:!0}).then(function(c){return c},function(c){console.error(c.message||c);return c})})}}),u=p([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&h.mixin(this,a)},_checkCredential:function(){var a=l.isValidCredential(this.credential);a||(this.credential=null);return a},
isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getGroups:function(){var a=[];this.groups&&(a=d.map(this.groups,h.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this.portal;return new r(a)})));return a},getItemsByKeywords:function(a,b){return this.portal.queryItems({start:b||1,num:100,q:"owner:"+
this.username+' AND typekeywords:"'+a+'"'})},getContent:function(){this.updateCredential();var a=b.getUserContentUrl(this.portalUrl,this.username),e={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential&&(e.query.token=this.credential.token);var c=new g;m(a,e).then(h.hitch(this,function(a){c.resolve(a.data)}),h.hitch(this,function(a){c.reject(a)}));return c},getTags:function(){this.updateCredential();var a=b.getUserTagsUrl(this.portalUrl,this.username),e={responseType:"json",
query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(e.query.token=this.credential.token);var c=new g;m(a,e).then(h.hitch(this,function(a){c.resolve(a.data)}),h.hitch(this,function(a){c.reject(a)}));return c},addItem:function(a,e){this.updateCredential();var c=new g;if(this.isValidCredential()){var d={f:"json",token:this.credential.token};a&&(d=h.mixin(d,a));a=b.getAddItemUrl(this.portalUrl,this.username,e);m(a,{responseType:"json",callbackParamName:"callback",query:d,method:"post"}).then(h.hitch(this,
function(a){c.resolve(a.data)}),h.hitch(this,function(a){console.error(a);c.reject(a)}))}else setTimeout(h.hitch(this,function(){c.reject("token is null.")}),0);return c},deleteItem:function(a){this.updateCredential();var e=new g;this.isValidCredential()?(a=b.getDeleteItemUrl(this.portalUrl,this.username,a),m(a,{query:{token:this.credential.token,f:"json"},responseType:"json",method:"post"}).then(h.hitch(this,function(c){e.resolve(c.data)}),h.hitch(this,function(c){e.reject(c)}))):setTimeout(h.hitch(this,
function(){e.reject("token is null.")}),0);return e},getItemById:function(a,e){this.updateCredential();var c=new g;e=b.getUserItemsUrl(this.portalUrl,this.username,e);var d={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(d.query.token=this.credential.token);m(e+"/"+a,d).then(h.hitch(this,function(a){a=a.data;a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;a=new v(a);c.resolve(a)}),h.hitch(this,function(a){console.error(a);c.reject(a)}));
return c},shareItem:function(a,e,c){this.updateCredential();var d=new g;this.isValidCredential()?(e=b.shareItemUrl(this.portalUrl,this.username,e,c),c={responseType:"json",callbackParamName:"callback",query:{f:"json",token:this.credential.token},method:"post"},a&&(a.content&&!a.query&&(a.query=a.content),c.query=h.mixin(c.query,a)),m(e,c).then(h.hitch(this,function(c){d.resolve(c.data)}),h.hitch(this,function(c){console.error(c);d.reject(c)}))):setTimeout(h.hitch(this,function(){d.reject("token is null.")}),
0);return d},updateItem:function(a,e){this.updateCredential();var c=new g;this.isValidCredential()?this.portal.getItemById(a).then(h.hitch(this,function(d){var f={f:"json",token:this.credential.token};e&&(f=h.mixin(f,e));d=b.getUpdateItemUrl(this.portalUrl,this.username,a,d.ownerFolder);m(d,{responseType:"json",callbackParamName:"callback",timeout:1E5,query:f,method:"post"}).then(h.hitch(this,function(a){c.resolve(a.data)}),h.hitch(this,function(a){console.error(a);c.reject(a)}))}),h.hitch(this,function(a){console.error(a);
c.reject(a)})):setTimeout(h.hitch(this,function(){c.reject("token is null.")}),0);return c},isAdminRole:function(){return"org_admin"===this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===this.role}}),r=p([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&h.mixin(this,a)},_checkCredential:function(){var a=
l.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(a){a.q="group:"+this.id+" AND "+a.q;return this.portal.queryItems(a)}}),v=p([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,
token:null,constructor:function(a){a&&h.mixin(this,a);this.itemUrl=b.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&this.thumbnail&&this.itemUrl&&(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=b.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=b.getUserProfilePageUrl(this.portalUrl,
this.owner))},_checkCredential:function(){var a=l.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getItemData:function(){return this.portal.getItemData(this.id)}}),q={portals:[],webMapQueryStr:" "+e.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+e.getItemQueryStringByTypes(["Web Scene"])+
" ",_findPortal:function(a){for(var e=0;e<this.portals.length;e++){var c=this.portals[e];if(b.isSamePortalUrl(a,c.portalUrl))return c.updateCredential(),c}return null},getPortal:function(a){if(!a||"string"!==typeof a||!h.trim(a))return null;a=b.getStandardPortalUrl(a);var e=this._findPortal(a);e||(e=new t(a),e.credential=l.getPortalCredential(e.portalUrl),e.updateCredential(),this.portals.push(e));return e},getPortalSelfInfo:function(a){return this.getPortal(a).loadSelfInfo()},getBasemapGalleryGroup:function(a){return this._getPortalSelfGroup(a,
"basemapGalleryGroupQuery")},getTemplatesGroup:function(a){return this._getPortalSelfGroup(a,"templatesGroupQuery")},getUnits:function(b){var e="english",c="",d=new g;this.getPortal(b).getUser().then(h.hitch(this,function(b){b&&b.units?e=b.units:(c=a.locale,e=c.startWith("en")?"english":"metric");d.resolve(e)}),h.hitch(this,function(f){console.warn(f);this.getPortalSelfInfo(b).then(h.hitch(this,function(b){var e=null;b&&b.units?e=b.units:(c=b&&b.culture||a.locale,e=c.startWith("en")?"english":"metric");
d.resolve(e)}),h.hitch(this,function(b){console.warn(b);c=a.locale;e=c.startWith("en")?"english":"metric";d.resolve(e)}))}));return d.promise},_getPortalSelfGroup:function(a,b){var c=new g,e=this.getPortal(a);e||setTimeout(h.hitch(this,function(){c.reject()}),0);this.getPortalSelfInfo(a).then(h.hitch(this,function(a){e.queryGroups({f:"json",q:a[b]}).then(h.hitch(this,function(a){0<a.results.length?(a=a.results[0],a.portalUrl=e.portalUrl,a.credential=e.credential,a.portal=e,a=new r(a),c.resolve(a)):
c.reject("Can't find portal self group.")}),h.hitch(this,function(a){console.error(a);c.reject(a)}))}),h.hitch(this,function(a){console.error(a);c.reject(a)}));return c},getWebMapsFromBasemapGalleryGroup:function(a){var b=new g;this.getBasemapGalleryGroup(a).then(h.hitch(this,function(c){c?c.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(h.hitch(this,function(c){b.resolve(c)}),h.hitch(this,function(c){console.error(c);b.reject(c)})):b.reject()}),h.hitch(this,function(c){console.error(c);
b.reject(c)}));return b},getDefaultWebScene:function(a){var b=new g,c=this.getPortal(a);c.getUser().then(h.hitch(this,function(a){c.queryItems({start:1,num:1,f:"json",q:this.webSceneQueryStr+' AND owner:"'+a.username+'" ',sortField:"numViews",sortOrder:"desc"}).then(h.hitch(this,function(c){c=c.results;c=d.filter(c,h.hitch(this,function(c){return c.type&&"web scene"===c.type.toLowerCase()}));0<c.length?b.resolve(c[0].id):b.resolve(null)}),h.hitch(this,function(c){b.reject(c)}))}),h.hitch(this,function(){b.reject("not sign in")}));
return b},getDefaultWebMap:function(a){var b=new g;this.getPortalSelfInfo(a).then(h.hitch(this,function(c){var e=c.defaultBasemap&&c.defaultBasemap.id;e?b.resolve(e):this._getDefaultWebMapByBasemapGallery(a,c).then(h.hitch(this,function(c){c?b.resolve(c):this._getMostNumViewsWebMap(a).then(h.hitch(this,function(c){c?b.resolve(c):b.reject()}),h.hitch(this,function(c){console.error(c);b.reject(c)}))}),h.hitch(this,function(c){console.error(c);b.reject(c)}))}),h.hitch(this,function(c){console.error(c);
b.reject(c)}));return b},_getDefaultWebMapByBasemapGallery:function(a,b){var c=new g,e=this.getPortal(a),f=b.defaultBasemap&&b.defaultBasemap.title;e.queryGroups({f:"json",q:b.basemapGalleryGroupQuery}).then(h.hitch(this,function(a){a=a.results;0<a.length?e.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+a[0].id+" AND title:"+f}).then(h.hitch(this,function(a){a=a.results;a=d.filter(a,h.hitch(this,function(c){return c.type&&"web map"===c.type.toLowerCase()}));0<a.length?c.resolve(a[0].id):
(console.log("Can't find web map under basemapGalleryGroupQuery."),e.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+f}).then(h.hitch(this,function(a){a=a.results;a=d.filter(a,h.hitch(this,function(c){return c.type&&"web map"===c.type.toLowerCase()}));if(0<a.length){var b=a[0];e.getItemData(b.id).then(h.hitch(this,function(a){a&&(a.operationalLayers||a.baseMap||a.version)?c.resolve(b.id):c.resolve(null)}),h.hitch(this,function(){c.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),
c.resolve(null)}),h.hitch(this,function(a){console.error(a);c.reject(a)})))}),h.hitch(this,function(a){console.error(a);c.reject(a)})):(console.log("Can't find group by basemapGalleryGroupQuery."),c.resolve(null))}),h.hitch(this,function(a){console.error(a);c.reject(a)}));return c},_getMostNumViewsWebMap:function(a){var b=new g;this.getPortal(a).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(h.hitch(this,
function(c){c=c.results;c=d.filter(c,h.hitch(this,function(c){return c.type&&"web map"===c.type.toLowerCase()}));0<c.length?b.resolve(c[0].id):b.reject("Can't find most-num-views web map.")}),h.hitch(this,function(c){console.error(c);b.reject(c)}));return b}};f.subscribe("userSignOut",function(a){(a=q._findPortal(a))&&a.clearCredentialAndUser()});return q})},"jimu/appConfigResourceUtils":function(){define(["dojo/Deferred","dojo/promise/all","jimu/portalUtils","jimu/utils"],function(p,h,d,a){return{AddResourcesToItemForAppSave:function(g,
f,k,m){f=f||[];if(0===f.length){var e=new p;e.resolve(f);return e}f=f.map(function(b){var e=b.resUrl.split("resources/")[1],d=new p;b.b64?(b=a.b64toBlob(b.b64),d.resolve({blob:b,fileName:e.split("/")[1],prefixName:e.split("/")[0]})):(b=b.resUrl,0<b.indexOf("${itemId}")&&(b=b.replace("${itemId}",k)),a.resourcesUrlToBlob(b).then(function(a){d.resolve({blob:a,fileName:e.split("/")[1],prefixName:e.split("/")[0]},function(a){console.error(a.message||a);d.reject(a)})}));return d});return h(f).then(function(a){if(a instanceof
Array&&0<a.length)return a=a.map(function(a){var b=k;m&&(b=m);return d.addResource(g,b,a.blob,a.fileName,a.prefixName)}.bind(this)),h(a).then(function(a){return a})}.bind(this))}}})},"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/geometry/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),function(p,h,d,a,g,f,k,m,e){var b=null,l=p(null,{rawAppConfig:null,mapMd5:null,appStateKey:null,setRawAppConfig:function(a){this.rawAppConfig=
a},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var b=a.stringify(this.rawAppConfig.map);this.mapMd5=m(b)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var a=new d,b={};if(e.isInConfigOrPreviewWindow()||!this.rawAppConfig||!this.rawAppConfig.map)return a.resolve(b),a;var l=this._getAppStateKey(),m=k.get(l);m&&m.appStateMd5===this._getAppStateMd5()?
(l=m.map&&m.map.extent,m=m.map&&m.map.layers,l&&(b.extent=new g(l.xmin,l.ymin,l.xmax,l.ymax,new f(l.spatialReference))),m&&(b.layers=m)):k.remove(l);a.resolve(b);return a},saveWabAppState:function(a,b){if(a&&!e.isInConfigOrPreviewWindow()){var d=this._getAppStateKey(),f={extent:{xmin:a.extent.xmin,xmax:a.extent.xmax,ymin:a.extent.ymin,ymax:a.extent.ymax,spatialReference:{wkid:a.extent.spatialReference.wkid,wkt:a.extent.spatialReference.wkt}},layers:{}};b&&b.traversalLayerInfosOfWebmap&&b.traversalLayerInfosOfWebmap(h.hitch(this,
function(a){f.layers[a.id]={visible:a.isShowInMap()}}));k.set(d,{map:f,appStateMd5:this._getAppStateMd5()})}}});l.getInstance=function(a){null===b&&(b=new l);b.urlParams=a;return b};return l})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/query dojo/Deferred dojo/promise/all dojo/debounce require ./MapManager ./utils".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,t,u){var r=null,v;v=p([a],{constructor:function(a,e){this.own(g.subscribe("appConfigLoaded",
h.hitch(this,this._onAppConfigLoaded)));this.own(g.subscribe("appConfigChanged",h.hitch(this,this._onAppConfigChanged)));this.own(g.subscribe("sceneViewLoaded",h.hitch(this,this._onSceneViewLoaded)));this.own(g.subscribe("sceneViewChanged",h.hitch(this,this._onSceneViewChanged)));this.own(g.subscribe("beforeSceneViewDestory",h.hitch(this,this._onBeforeSceneViewDestroy)));this.own(g.subscribe("builder/actionTriggered",h.hitch(this,this._onActionTriggered)));this.own(g.subscribe("openWidget",h.hitch(this,
this._onOpenWidgetRequest)));this.own(f(window,"resize",b(h.hitch(this,this.resize),200)));this.id=e},postCreate:function(){this.containerNode=this.domNode},sceneView:null,mapId:"map",mapDiv:null,layoutManager:null,animTime:500,resize:function(){this.layoutManager&&this.layoutManager.resize()},_onAppConfigLoaded:function(a){this.appConfig=h.clone(a);this._loadLayoutManager(this.appConfig).then(h.hitch(this,function(a){this.layoutManager=a;this.layoutManager.onEnter(this.appConfig,this.mapId).then(h.hitch(this,
function(){this.mapDiv=this.layoutManager.getMapDiv();this._loadMap(this.mapId);this.appConfig.theme&&this._loadTheme(this.appConfig.theme)}))}))},_loadLayoutManager:function(a){a=a.layoutDefinition?a.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager";var b=new m;l([a],h.hitch(this,function(a){a=a.getInstance();this.sceneView&&a.setSceneView(this.sceneView);b.resolve(a)}));return b},_loadMap:function(){this.mapManager=t.getInstance({appConfig:this.appConfig,urlParams:this.urlParams},
this.mapId);this.mapManager.showMap()},_onSceneViewLoaded:function(a){this.sceneView=a;this.layoutManager.setSceneView(a);this.layoutManager.loadAndLayout(this.appConfig)},_loadTheme:function(a){var b=new m;l(["themes/"+a.name+"/main"],h.hitch(this,function(){e([this._loadThemeCommonStyle(a),this._loadThemeCurrentStyle(a)]).then(h.hitch(this,function(){this._addCustomStyle(a);this.layoutManager.onThemeLoad();b.resolve()}))}));return b},_loadThemeCommonStyle:function(a){d.addClass(this.domNode,a.name);
return u.loadStyleLink(this._getThemeCommonStyleId(a),"themes/"+a.name+"/common.css")},_loadThemeCurrentStyle:function(a){d.addClass(this.domNode,a.styles[0]);return u.loadStyleLink(this._getThemeCurrentStyleId(a),"themes/"+a.name+"/styles/"+a.styles[0]+"/style.css")},_addCustomStyle:function(a){var b=h.getObject("customStyles",!1,a);if(b){var e=".jimu-main-background{background-color: ${mainBackgroundColor} !important;}";(a=this._getFixedThemeStyles(a))&&(e+=a);e=h.replace(e,b,/\$\{([^\}]+)\}/g);
b=d.create("style",{type:"text/css"});try{b.appendChild(document.createTextNode(e))}catch(c){b.styleSheet.cssText=e}b.setAttribute("source","custom");document.head.appendChild(b)}},_getFixedThemeStyles:function(a){var b=".esriPopup .titlePane {background-color: ${mainBackgroundColor} !important;}";"PlateauTheme"===a.name?b+=".jimu-widget-header-controller .jimu-title, .jimu-widget-header-controller .jimu-subtitle{color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller .links .jimu-link{color: ${mainBackgroundColor} !important;}.jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate.vertical .operation{background-color: ${mainBackgroundColor} !important;}.jimu-preload-widget-icon-panel \x3e .jimu-panel-title, .jimu-foldable-panel \x3e .jimu-panel-title, .jimu-title-panel \x3e .title{color: ${mainBackgroundColor} !important;}.jimu-panel{border-color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller{border-bottom-color: ${mainBackgroundColor} !important;}.jimu-tab\x3e.control\x3e.tab{color: ${mainBackgroundColor} !important; border-color: ${mainBackgroundColor} !important}":
"BillboardTheme"===a.name?b+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation, .jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important;}.jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important;}":"BoxTheme"===a.name?b+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate, .jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important;}":
"TabTheme"===a.name?b+=".tab-widget-frame .title-label{color: ${mainBackgroundColor} !important;}":"DashboardTheme"===a.name?b+=".jimu-widget-dnd-header{background-color: ${mainBackgroundColor} !important;}":"DartTheme"===a.name&&(b+=".jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important;}");return b},_onAppConfigChanged:function(a,b,e){a=h.clone(a);switch(b){case "themeChange":this._onThemeChange(a);break;case "styleChange":this._onStyleChange(a);break;case "layoutChange":this._onLayoutChange(a);
break;case "widgetChange":this._onWidgetChange(a,e);break;case "groupChange":this._onGroupChange(a,e);break;case "widgetPoolChange":this._onWidgetPoolChange(a,e);break;case "resetConfig":this._onResetConfig(a);break;case "loadingPageChange":this._onLoadingPageChange(a,e);break;case "layoutDefinitionChange":this._onLayoutDefinitionChange(a,e);break;case "onScreenGroupsChange":this._onOnScreenGroupsChange(a,e);break;case "onScreenOrderChange":this._onOnScreenOrderChange(a,e)}this.appConfig=a},_onSceneViewChanged:function(a){this.sceneView=
a;this.layoutManager.setSceneView(a);this.layoutManager.loadAndLayout(this.appConfig)},_onBeforeSceneViewDestroy:function(){this.layoutManager.destroyOnScreenWidgetsAndGroups()},_onActionTriggered:function(a){this.layoutManager.onActionTriggered(a)},_onWidgetChange:function(a,b){this.layoutManager.onWidgetChange(a,b)},_onGroupChange:function(a,b){this.layoutManager.onGroupChange(a,b)},_onWidgetPoolChange:function(a,b){this.layoutManager.onWidgetPoolChange(a,b)},_onLayoutDefinitionChange:function(a,
b){this.layoutManager.onLayoutDefinitionChange(a,b)},_onOnScreenGroupsChange:function(a,b){this.layoutManager.onOnScreenGroupsChange(a,b)},_onOnScreenOrderChange:function(a,b){this.layoutManager.onOnScreenOrderChange(a,b)},_onThemeChange:function(a){this.layoutManager.destroyOnScreenWidgetsAndGroups();this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();e([this._loadLayoutManager(a),this._loadTheme(a.theme)]).then(h.hitch(this,
function(b){var e=b[0];this.layoutManager.name!==e.name?(this.layoutManager.onLeave(),e.onEnter(a,this.mapId).then(h.hitch(this,function(){this.layoutManager=e;this.layoutManager.loadAndLayout(a)}))):this.layoutManager.loadAndLayout(a)}))},_onResetConfig:function(a){var b=this.appConfig;g.publish("appConfigChanged",a,"mapChange",a);this.appConfig=b;this._loadLayoutManager(a).then(h.hitch(this,function(a){this.layoutManager=a;this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);
this._removeCustomStyle();this._loadTheme(this.appConfig.theme)}))},_onLoadingPageChange:function(a,b){"backgroundColor"in b?d.setStyle(jimuConfig.loadingId,"background-color",a.loadingPage.backgroundColor):"backgroundImage"in b?(a=a.loadingPage.backgroundImage,a.visible&&a.uri?(d.setStyle(jimuConfig.loadingImageId,"background-image","url('"+a.uri+"')"),d.setStyle(jimuConfig.loadingImageId,"width",a.width+"px"),d.setStyle(jimuConfig.loadingImageId,"height",a.height+"px")):(d.setStyle(jimuConfig.loadingImageId,
"background-image","url('')"),d.setStyle(jimuConfig.loadingImageId,"width","0px"),d.setStyle(jimuConfig.loadingImageId,"height","0px"))):"loadingGif"in b&&(a=a.loadingPage.loadingGif,a.visible&&a.uri?(d.setStyle(jimuConfig.loadingGifId,"background-image","url('"+a.uri+"')"),d.setStyle(jimuConfig.loadingGifId,"width",a.width+"px"),d.setStyle(jimuConfig.loadingGifId,"height",a.height+"px")):(d.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),d.setStyle(jimuConfig.loadingGifId,"width",
"0px"),d.setStyle(jimuConfig.loadingGifId,"height","0px")))},_onStyleChange:function(a){this._removeThemeCurrentStyle(this.appConfig.theme);this._loadThemeCurrentStyle(a.theme);this._removeCustomStyle();this._addCustomStyle(a.theme)},_onLayoutChange:function(a){this.layoutManager.onLayoutChange(a)},_removeThemeCommonStyle:function(a){d.removeClass(this.domNode,a.name);d.destroy(this._getThemeCommonStyleId(a))},_removeThemeCurrentStyle:function(a){d.removeClass(this.domNode,a.styles[0]);d.destroy(this._getThemeCurrentStyleId(a))},
_removeCustomStyle:function(){k('style[source\x3d"custom"]',document.head).forEach(function(a){d.destroy(a)})},_getThemeCommonStyleId:function(a){return"theme_"+a.name+"_style_common"},_getThemeCurrentStyleId:function(a){return"theme_"+a.name+"_style_"+a.styles[0]},_doPostLoad:function(){l(["dynamic-modules/postload"])},_onOpenWidgetRequest:function(a){this.layoutManager.openWidget(a)}});v.getInstance=function(a,b){null===r&&(r=new v(a,b),window._layoutManager=r);return r};return v})},"dojo/debounce":function(){define([],
function(){return function(p,h){var d;return function(){d&&clearTimeout(d);var a=this,g=arguments;d=setTimeout(function(){p.apply(a,g)},h)}}})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/on dojo/keys esri/geometry/Extent esri/geometry/Point ./utils ./dijit/LoadingShelter ./AppStateManager ./WebSceneLoader esri/Viewpoint".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,t,u,r){var v=null,q=p(null,{appConfig:null,mapDivId:"",map:null,
previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,constructor:function(a,b){this.appConfig=a.appConfig;this.urlParams=a.urlParams;this.id=this.mapDivId=b;this.appStateManager=t.getInstance(this.urlParams);g.subscribe("appConfigChanged",h.hitch(this,this.onAppConfigChanged));g.subscribe("changeMapPosition",h.hitch(this,this.onChangeMapPosition));g.subscribe("syncViewpoint",h.hitch(this,this.onSyncViewpoint));f(window,"resize",h.hitch(this,this.onWindowResize));
f(window,"beforeunload",h.hitch(this,this.onBeforeUnload))},showMap:function(){this._showMap(this.appConfig)},_showMap:function(a){console.time("Load Map");this.loading=new l;this.loading.placeAt(this.mapDivId);this.loading.startup();a.map["3D"]?a.map.itemId?this._show3DWebScene(a):console.log("No webscene found. Please set map.itemId in config.json."):a.map.itemId?this._show2DWebMap(a):console.log("No webmap found. Please set map.itemId in config.json.")},onBeforeUnload:function(){this.appStateManager.saveWabAppState(this.map,
this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(a){a&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&this._mapMobileInfoWindow.destroy(),this.isMobileInfoWindow=!1);window.appInfo.isRunInMobile&&!this.isMobileInfoWindow?this.isMobileInfoWindow=!0:!window.appInfo.isRunInMobile&&this.isMobileInfoWindow&&
(this.isMobileInfoWindow=!1)},onChangeMapPosition:function(a){var b=h.clone(this.mapPosition);h.mixin(b,a);this.setMapPosition(b)},setMapPosition:function(e){this.mapPosition=e;e=b.getPositionStyle(e);a.setStyle(this.mapDivId,e);this.map&&this.map.resize&&this.map.resize()},getMapPosition:function(){return this.mapPosition},onSyncViewpoint:function(a){this.sceneView&&(this.sceneView.viewpoint=a.clone())},_visitConfigMapLayers:function(a,b){d.forEach(a.map.basemaps,function(c,a){c.isOperationalLayer=
!1;b(c,a)},this);d.forEach(a.map.operationallayers,function(c,a){c.isOperationalLayer=!0;b(c,a)},this)},_destroySceneView:function(){if(this.sceneView)try{this.sceneView.destroy()}catch(n){console.error(n)}this.sceneView=null;window._sceneView=null},_show3DWebScene:function(a){var b=a.map.portalUrl,c=a.map.itemId;this._destroySceneView();u.createMap(this.mapDivId,b,c).then(h.hitch(this,function(c){this._publishSceneViewEvent(c);if(a.map.mapOptions&&(c=a.map.mapOptions.initialState)&&c.viewpoint)try{var b=
r.fromJSON(c.viewpoint);b&&(this.sceneView.map.initialViewProperties.viewpoint=b,this.sceneView.viewpoint=b.clone())}catch(A){console.error(A)}}),h.hitch(this,function(){this.loading&&this.loading.destroy();g.publish("mapCreatedFailed")}))},_publishSceneViewEvent:function(a){window._sceneView=a;console.timeEnd("Load Map");this.loading&&this.loading.destroy();this.sceneView?(this.sceneView=a,console.log("sceneView changed"),g.publish("sceneViewChanged",this.sceneView)):(this.sceneView=a,console.log("sceneView loaded"),
g.publish("sceneViewLoaded",this.sceneView))},_show2DWebMap:function(e){e.map.mapOptions||(e.map.mapOptions={});var f=this._processMapOptions(e.map.mapOptions)||{};f.isZoomSlider=!1;b.createWebMap(e.map.portalUrl,e.map.itemId,this.mapDivId,{mapOptions:f,bingMapsKey:e.bingMapsKey,usePopupManager:!0}).then(h.hitch(this,function(c){var b=c.map;b.hideZoomSlider();b.infoWindow.resize(270,316);b.itemId=e.map.itemId;b.itemInfo=c.itemInfo;b.webMapResponse=c;b.enableSnapping({snapKey:k.copyKey});a.setStyle(b.root,
"zIndex",0);b._initialExtent=b.extent;d.forEach("extent center marker find query scale level".split(" "),function(c){},this);this._publishMapEvent(b)}),h.hitch(this,function(){this.loading&&this.loading.destroy();g.publish("mapCreatedFailed")}))},_processMapOptions:function(a){if(a)return a.lods||delete a.lods,a.lods&&0===a.lods.length&&delete a.lods,a=h.clone(a),a.extent&&(a.extent=new m(a.extent)),a.center&&!h.isArrayLike(a.center)&&(a.center=new e(a.center)),a},onAppConfigChanged:function(a,b,
c){this.appConfig=a;"mapChange"===b?this._recreateMap(a):"mapOptionsChange"===b&&c.initialState&&(a=c.initialState.viewpoint)&&(this.sceneView.map.initialViewProperties.viewpoint=r.fromJSON(a),this.sceneView.animateTo(r.fromJSON(a)))},_recreateMap:function(a){this.sceneView&&(g.publish("beforeSceneViewDestory",this.sceneView),this._destroySceneView());this._showMap(a)},disableWebMapPopup:function(){},enableWebMapPopup:function(){}});q.getInstance=function(a,b){null===v&&(v=new q(a,b));return v};return q})},
"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(p,h,d,a,g){return p([h,d],{baseClass:"jimu-loading-shelter",declaredClass:"jimu.dijit.LoadingShelter",templateString:a,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&g.setStyle(this.domNode,
"display","none");g.setStyle(this.domNode,{width:"100%",height:"100%"});this.loadingImg.src=require.toUrl("jimu")+"/images/loading2.gif";this.showLoading||g.setStyle(this.imgDiv,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(a){this.domNode&&this.hidden&&("string"===typeof a&&(this.textNode.innerHTML=a),g.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(g.setStyle(this.domNode,"display",
"none"),this.hidden=!0)}})})},"jimu/WebSceneLoader":function(){define("dojo/Deferred dojo/_base/lang dojo/_base/array dojo/_base/html dojo/promise/all esri/kernel esri/WebScene esri/views/SceneView esri/portal/Portal esri/portal/PortalItem esri/core/sniff ./utils ./portalUtils ./portalUrlUtils".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,t,u,r){return{createMap:function(b,e,d){var f=new p;l("esri-webgl")?f=this._createMap(b,e,d):(f.reject("The browser doesn't support webgl."),(b=h.getObject("webSceneLoader.webglSupportTip",
!1,window.jimuNls))||(b="3D web apps aren't supported in your browser."),a.create("div",{"class":"app-error",innerHTML:b},document.body));return f},_createMap:function(a,d,f){t.getEsriConfig().portalUrl=r.getStandardPortalUrl(d);var l=new p,c=[];e._default=null;var n=new k({portalItem:new b({id:f})}),q=new m({map:n,container:a,constraints:{collision:{enabled:!1},tilt:{max:179.99}}});c.push(n);c.push(q);d=u.getPortal(d);c.push(d.getItemById(f));c.push(d.getItemData(f));g(c).then(h.hitch(this,function(c){q.popup&&
(q.popup.closeOnViewChangeEnabled=!0);n.id=a;n.itemId=f;n.itemInfo={item:c[2],itemData:c[3]};this._handleLocalScene(q);l.resolve(q)}),h.hitch(this,function(c){console.error(c);l.reject(c)}));return l},_handleLocalScene:function(a){try{a.viewingMode&&"local"===a.viewingMode.toLowerCase()&&(h.setObject("constraints.collision.enabled",!1,a),h.setObject("constraints.tilt.max",179.99,a))}catch(q){console.error(q)}},_handleAttribution:function(b){try{if("4.0"!==f.version){var e=b.ui&&b.ui._components;e&&
0<e.length&&d.some(e,function(b){return(b=b&&b._widget)&&"esri.widgets.Attribution"===b.declaredClass?(b.domNode.parentNode.style.width="100%",a.create("span",{innerHTML:"Powered by Esri","class":"esri-attribution-powered-by"},b.domNode),!0):!1})}}catch(n){console.error(n)}}}})},"esri/WebScene":function(){define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/tsSupport/paramHelper dojo/has dojo/_base/lang ./kernel ./Map ./Viewpoint ./core/Collection ./core/Error ./core/JSONSupport ./core/Loadable ./core/Logger ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/Extent ./geometry/HeightModelInfo ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./geometry/support/jsonUtils ./portal/Portal ./portal/PortalItem ./support/webSceneUtils ./webscene/ApplicationProperties ./webscene/Environment ./webscene/InitialViewProperties ./webscene/Presentation ./webscene/Version".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x,z,A,y,B,E,C,G,J,F,I,H,K,L){var M=v.getLogger("esri.WebScene"),V=new L.default(1,10);return function(e){function f(c){c=e.call(this)||this;c.applicationProperties=null;c.clippingArea=null;c.clippingEnabled=!1;c.heightModelInfo=null;c.sourceVersion=null;c.supportsHeightModelInfo=!0;c.presentation=null;c.initialViewProperties=null;c.portalItem=null;c.resourceInfo=null;c.authoringApp=null;c.authoringAppVersion=null;c._isAuthoringAppSetByUser=!1;c._isAuthoringAppVersionSetByUser=
!1;return c}d(f,e);f.prototype.initialize=function(){this.when().catch(function(c){M.error("#load()","Failed to load web scene",c)});if(this.resourceInfo){var c=void 0;try{c=this._validateJSON(this.resourceInfo)}catch(N){this.addResolvingPromise(q.reject(N));return}this.read(c);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}};f.prototype.getDefaults=function(c){return k.mixin(this.inherited(arguments),{presentation:{},initialViewProperties:{}})};
f.prototype.writeClippingArea=function(c,a){a.clippingArea||(a.clippingArea={});a.clippingArea.geometry=c.toJSON()};f.prototype.readClippingEnabled=function(c,a){return a.clippingArea?!!a.clippingArea.clip:!1};f.prototype.writeClippingEnabled=function(c,a){this.clippingArea&&(a.clippingArea||(a.clippingArea={}),a.clippingArea.clip=c)};f.prototype.writeLayers=function(c,a,b,e){var d=this,f=k.mixin({},e,{layerContainerType:"operational-layers"});c=c.filter(function(c){return d.verifyWriteLayer(c,f)}).map(function(c){return c.write(null,
f)}).filter(function(c){return!!c});a[b]=c.toArray()};f.prototype.verifyWriteLayer=function(c,a){return c.write?!0:(a&&a.messages&&a.messages.push(new t("layer:unsupported","Layers ("+c.title+", "+c.id+") of type '"+c.declaredClass+"' cannot be persisted in web scenes",{layer:c})),!1)};f.prototype.readSourceVersion=function(c,a){c=a.version.split(".");a=c[1];return new L.default(parseInt(c[0],10),parseInt(a,10))};f.prototype.writeSourceVersion=function(c,a,b){a[b]=V.major+"."+V.minor};Object.defineProperty(f.prototype,
"authoringApp",{set:function(c){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",c)},enumerable:!0,configurable:!0});f.prototype.writeAuthoringApp=function(c,a){a.authoringApp=c&&this._isAuthoringAppSetByUser?c:"ArcGIS API for JavaScript"};Object.defineProperty(f.prototype,"authoringAppVersion",{set:function(c){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",c)},enumerable:!0,configurable:!0});f.prototype.writeAuthoringAppVersion=function(c,a){a.authoringAppVersion=
c&&this._isAuthoringAppVersionSetByUser?c:m.version};f.prototype.writeGround=function(c,a,b,e){a[b]=c?c.write(null,e):{layers:[]}};f.prototype.readInitialViewProperties=function(c,a){c={};a.initialState&&a.initialState.environment&&(c.environment=I.fromJSON(a.initialState.environment));a.spatialReference&&(c.spatialReference=y.fromJSON(a.spatialReference));c.viewingMode=a.viewingMode||"global";a.initialState&&a.initialState.viewpoint&&(c.viewpoint=b.fromJSON(a.initialState.viewpoint));return new H(c)};
f.prototype.writeInitialViewProperties=function(c,a,b,e){c&&(b={},c.environment&&(b.environment=c.environment.write({},e)),c.viewpoint&&(b.viewpoint=c.viewpoint.write({},e)),0!==Object.keys(b).length&&(a.initialState=b),a.spatialReference=c.spatialReference?c.spatialReference.write({},e):y.WebMercator.toJSON(),a.viewingMode=null!=c.viewingMode?c.viewingMode:"global")};f.prototype.load=function(){this.addResolvingPromise(this._loadFromSource());return this.when()};f.prototype.read=function(c,a){var b=
this;a=k.mixin({},a,{origin:"web-scene"});var e=this._isAuthoringAppVersionSetByUser,d=this._isAuthoringAppSetByUser,f=arguments;x.readLoadable(this,c,function(a){return b.inherited(f,[c,a])},a);d||(this._isAuthoringAppSetByUser=!1);e||(this._isAuthoringAppVersionSetByUser=!1);if(c.baseMap&&Array.isArray(c.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){var e=c.baseMap.elevationLayers.map(function(c){return{id:c.id}}),g=this.presentation.slides,l=function(c,a){return c.visibleLayers.some(function(c){return c.id===
a})},n=e.filter(function(c){return!g.some(function(a){return l(a,c.id)})});g.forEach(function(c){c.visibleLayers.addMany(n)})}return this};f.prototype._writeBasemapElevationLayers=function(c){var a=c.ground&&c.ground.layers;!c.baseMap&&a&&a.length&&(c.baseMap={title:"Basemap",baseMapLayers:[]});c.baseMap&&(c.baseMap.elevationLayers=k.clone(a))};f.prototype.write=function(c,a){if("loaded"!==this.loadStatus){var b=new t("webscene:not-loaded","Web scene must be loaded before it can be serialized");M.error("#toJSON()",
"Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus);throw b;}a=k.mixin({},a,{origin:"web-scene"});b=this.inherited(arguments,[c,a]);this._writeBasemapElevationLayers(b);return b};f.prototype.save=function(a){var b=this;if(!this.portalItem)return M.error("save(): requires the .portalItem property to be set"),q.reject(new t("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"));if("Web Scene"!==this.portalItem.type)return q.reject(new t("webscene:portal-item-wrong-type",
'Portal item needs to have type "Web Scene"'));var e,d;return this.load().then(function(){return b._loadObjectsWithLayers()}).then(function(){e=b._enableVerifyItemRelativeUrls({origin:"web-scene",url:b.portalItem.itemUrl&&n.urlToObject(b.portalItem.itemUrl),messages:[],portal:b.portalItem.portal||C.getDefault(),writtenProperties:[],blockedRelativeUrls:[]});d=b.write(null,e);return b._verifySave(d,e,a).then(function(){b._updateTypeKeywords(b.portalItem);return b.portalItem.update({data:d})})}).then(function(){c.updateOrigins(e);
return q.resolve(b.portalItem)})};f.prototype.saveAs=function(a,b){var e=this;if(!a)return M.error("saveAs(portalItem): requires a portal item parameter"),q.reject(new t("webscene:portal-item-required","saveAs requires a portal item to save to"));if(a.type&&"Web Scene"!==a.type||a.id)return q.reject(new t("webscene:portal-item-already-exists","WebScene can only saveAs to a new and empty portal item"));var d=a.portal||C.getDefault(),f,g;return this.load().then(function(){return e._loadObjectsWithLayers()}).then(function(){f=
e._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:d,writtenProperties:[],blockedRelativeUrls:[]});g=e.write(null,f);return e._verifySaveAs(g,f,b).then(function(){return d._signIn()})}).then(function(){a.type="Web Scene";a.portal=d;e._updateTypeKeywords(a);return d.user.addItem({item:a,folder:b&&b.folder,data:g})}).then(function(){e.portalItem=a;u.prototype.read.call(e,{version:g.version,authoringApp:g.authoringApp,authoringAppVersion:g.authoringAppVersion},{name:"web-scene",
url:a.itemUrl&&n.urlToObject(a.itemUrl)});c.updateOrigins(f);return q.resolve(a)})};f.prototype._verifySave=function(c,a,b,e){void 0===e&&(e=!1);var d=a.messages.filter(function(c){return"error"===c.type}).map(function(c){return new t(c.name,c.message,c.details)});a.blockedRelativeUrls&&(d=d.concat(a.blockedRelativeUrls.map(function(c){return new t("url:unsupported","Relative url '"+c+"' is not supported in Web Scene")})));b&&b.ignoreUnsupported&&(d=d.filter(function(c){return"layer:unsupported"!==
c.name&&"symbol:unsupported"!==c.name&&"symbol-layer:unsupported"!==c.name&&"property:unsupported"!==c.name}));b&&b.strictSchemaValidationEnabled||(d=d.filter(function(c){return"web-document-write:property-required"!==c.name}));var f=b&&b.strictSchemaValidationEnabled;return(f?q.create(function(c){return p(["./webscene/validator"],c)}).then(function(a){a=a.validate(c);if(0<a.length){var b="webscene did not validate:\n"+a.join("\n");M.error((e?"saveAs":"save")+"(): "+b)}return a.map(function(c){return new t("webscene:schema-validation",
c)})}).then(function(c){return f&&0<c.length?(c=J.createSchemaValidationError(c.concat(d)),q.reject(c)):d}):q.resolve(d)).then(function(c){if(0<c.length)return q.reject(new t("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:c}))})};f.prototype._verifySaveAs=function(c,a,b){return this.canSaveAs(a)?q.reject(J.createCopyError()):this._verifySave(c,a,b,!0)};f.prototype.verifySaveAs=function(c){var a=this._enableVerifyItemRelativeUrls({origin:"web-scene",
messages:[]}),b=this.write(null,a);return this._verifySaveAs(b,a,c)};f.prototype.canSaveAs=function(c){c||(c=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write(null,c));return c.verifyItemRelativeUrls&&0<c.verifyItemRelativeUrls.writtenUrls.length};f.prototype.updateFrom=function(c,a){void 0===a&&(a={});a.environmentExcluded||(this.initialViewProperties.environment=I.prototype.clone.apply(c.environment));a.viewpointExcluded||(this.initialViewProperties.viewpoint=c.viewpoint.clone());
this.initialViewProperties.spatialReference=c.spatialReference.clone();this.initialViewProperties.viewingMode=c.viewingMode;c.clippingArea?c.clippingArea!==this.clippingArea&&(this.clippingArea=c.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1;c.heightModelInfo&&(this.heightModelInfo=c.heightModelInfo.clone());c.map===this&&c.allLayerViews.forEach(function(c){c.layer.visible=c.visible})};f.prototype._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,
{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()};f.prototype._readAndLoadFromJSON=function(c,a){c=this._validateJSON(c,a&&a.url&&a.url.path);this.read(c,a);return this._loadFromJSON(c,a)};f.prototype._extractOperationalLayers=function(c){var a=this,b=[];if(!this.sourceVersion.supportsGround&&c.baseMap&&Array.isArray(c.baseMap.elevationLayers))for(var e=0,d=c.baseMap.elevationLayers;e<d.length;e++)b.push(d[e]);var f=[],g=function(c){c.layers&&
(c.layers=c.layers.filter(g));return"ArcGISTiledElevationServiceLayer"===c.layerType?(a.sourceVersion.supportsGround||f.push(c),!1):!0};return{operationalLayers:c.operationalLayers?c.operationalLayers.filter(g):[],operationalElevationLayers:f,basemapElevationLayers:b}};f.prototype._loadFromJSON=function(c,a){var b=this,e=new l;return this._validateSpatialReference().then(function(){return b._validateHeightModelInfo()}).then(function(){return q.create(function(c){return p(["./portal/support/layersCreator"],
c)})}).then(function(d){var f=b._extractOperationalLayers(c),g=f.operationalLayers,l=f.operationalElevationLayers,f=f.basemapElevationLayers,n=[],x={context:k.mixin({},a,{layerContainerType:"operational-layers"})};b.portalItem&&(x.context.portal=b.portalItem.portal||C.getDefault());if(0<f.length){var m=k.mixin({},x,{context:k.mixin({},x.context,{layerContainerType:"ground"})});m.defaultLayerType="ArcGISTiledElevationServiceLayer";n.push.apply(n,d.populateOperationalLayers(b.ground.layers,f,m))}0<
l.length&&(m=k.mixin({},x,{context:k.mixin({},x.context,{layerContainerType:"ground"})}),m.defaultLayerType="ArcGISTiledElevationServiceLayer",n.push.apply(n,d.populateOperationalLayers(e,l,m)));g&&0<g.length&&n.push.apply(n,d.populateOperationalLayers(b.layers,g,x));return q.eachAlways(n).then(function(){})}).then(function(){return b._loadObjectsWithLayers()}).then(function(){b.ground.layers.addMany(e)})};f.prototype._loadObjectsWithLayers=function(){var c=[];this.ground&&c.push(this.ground.load());
this.basemap&&c.push(this.basemap.load());this.presentation.slides.forEach(function(a){a.basemap&&c.push(a.basemap.load())});return q.eachAlways(c).then(function(){})};f.prototype._loadFromItem=function(c){var a=this;return c.load().catch(function(c){throw new t("webscene:load-portal-item","Failed to load portal item",{error:c});}).then(function(){if("Web Scene"!==c.type)throw new t("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:c.type});}).then(function(){return c.fetchData()}).then(function(b){a.resourceInfo=
b;return a._readAndLoadFromJSON(b,{origin:"web-scene",url:n.urlToObject(c.itemUrl),portal:c.portal||C.getDefault()})})};f.prototype._validateSpatialReference=function(){var c=this.initialViewProperties,a=this._sceneSpatialReference,b;if("local"!==c.viewingMode){if(!a.isWGS84&&!a.isWebMercator)return q.reject(new t("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator or WGS84 GCS are supported",{spatialReference:a,viewingMode:c.viewingMode}));
b=function(c){return!c||c.isWGS84||c.isWebMercator}}else{if(a.isGeographic)return q.reject(new t("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:a,viewingMode:c.viewingMode}));b=function(c){return!c||c.equals(a)}}var e=function(c){return c&&(c.camera&&c.camera.position&&c.camera.position.spatialReference||c.targetGeometry&&c.targetGeometry.spatialReference)},d=e(c.viewpoint);
return d&&!b(d)?q.reject(new t("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:d,sceneSpatialReference:a,viewingMode:c.viewingMode})):(d=this.presentation.slides.find(function(c){return!b(e(c.viewpoint))}))?(d=e(d.viewpoint),q.reject(new t("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",
{slideSpatialReference:d,sceneSpatialReference:a,viewingMode:c.viewingMode}))):q.resolve()};f.prototype._validateHeightModelInfo=function(){var c=B.validateWebSceneError(this.heightModelInfo,this._sceneSpatialReference);return c?q.reject(c):q.resolve()};f.prototype._validateJSON=function(c,a){void 0===a&&(a=null);c=this._sanitizeJSON(c,a);a=L.default.parse(c.version,"webscene");V.validate(a);c.version=a.major+"."+a.minor;1===a.major&&2>=a.minor&&(c.spatialReference=y.WebMercator.toJSON());return c};
f.prototype._sanitizeJSON=function(c,a){void 0===a&&(a=null);return{version:c.version||"",baseMap:c.baseMap,ground:c.ground,operationalLayers:c.operationalLayers,authoringApp:c.authoringApp||"",authoringAppVersion:c.authoringAppVersion||"",viewingMode:c.viewingMode||"global",presentation:c.presentation&&K.sanitizeJSON(c.presentation)||{},initialState:c.initialState,spatialReference:c.spatialReference||y.WebMercator.toJSON(),heightModelInfo:c.heightModelInfo||null,clippingArea:c.clippingArea,applicationProperties:c.applicationProperties}};
f.prototype._updateTypeKeywords=function(c){"local"===this.initialViewProperties.viewingMode?c.typeKeywords?-1===c.typeKeywords.indexOf("ViewingMode-Local")&&c.typeKeywords.push("ViewingMode-Local"):c.typeKeywords=["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&c.typeKeywords&&(c.typeKeywords=c.typeKeywords.filter(function(c){return"ViewingMode-Local"!==c}));c.typeKeywords&&(c.typeKeywords=c.typeKeywords.filter(function(c,a,b){return b.indexOf(c)===a}))};Object.defineProperty(f.prototype,
"_sceneSpatialReference",{get:function(){return this.initialViewProperties.spatialReference||y.WebMercator},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"_verifyItemRelativeRootPath",{get:function(){return this.portalItem&&this.portalItem.itemUrl?n.urlToObject(this.portalItem.itemUrl).path:null},enumerable:!0,configurable:!0});f.prototype._enableVerifyItemRelativeUrls=function(c){var a=this._verifyItemRelativeRootPath;a&&(c.verifyItemRelativeUrls={rootPath:a,writtenUrls:[]});
return c};f.fromJSON=function(c){if(!c)throw new t("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:c})};f.VERSION=V;a([w.property({type:F,json:{write:!0}})],f.prototype,"applicationProperties",void 0);a([w.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],f.prototype,"basemap",void 0);a([w.property({type:z,json:{read:{source:"clippingArea.geometry",reader:E.fromJSON},write:{target:"clippingArea.geometry"}}})],f.prototype,"clippingArea",
void 0);a([w.writer("clippingArea")],f.prototype,"writeClippingArea",null);a([w.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],f.prototype,"clippingEnabled",void 0);a([w.reader("clippingEnabled",["clippingArea"])],f.prototype,"readClippingEnabled",null);a([w.writer("clippingEnabled")],f.prototype,"writeClippingEnabled",null);a([w.property({type:A,json:{write:!0}})],f.prototype,"heightModelInfo",void 0);a([w.property({json:{write:{target:"operationalLayers"}}})],f.prototype,"layers",
void 0);a([w.writer("layers")],f.prototype,"writeLayers",null);a([w.property({readOnly:!0,type:L.default,json:{type:String,write:{allowNull:!0,target:"version",isRequired:!0}}})],f.prototype,"sourceVersion",void 0);a([w.reader("sourceVersion",["version"])],f.prototype,"readSourceVersion",null);a([w.writer("sourceVersion")],f.prototype,"writeSourceVersion",null);a([w.property({type:String,json:{write:{allowNull:!0}}})],f.prototype,"authoringApp",null);a([w.writer("authoringApp")],f.prototype,"writeAuthoringApp",
null);a([w.property({type:String,json:{write:{allowNull:!0}}})],f.prototype,"authoringAppVersion",null);a([w.writer("authoringAppVersion")],f.prototype,"writeAuthoringAppVersion",null);a([w.property({json:{write:{isRequired:!0,allowNull:!0,enabled:!0}}})],f.prototype,"ground",void 0);a([w.writer("ground")],f.prototype,"writeGround",null);a([w.property({type:K,json:{write:function(c,a,b,e){c.slides&&0<c.slides.length&&(a.presentation=c.write(null,e))}}})],f.prototype,"presentation",void 0);a([w.property({type:H})],
f.prototype,"initialViewProperties",void 0);a([w.reader("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],f.prototype,"readInitialViewProperties",null);a([w.writer("initialViewProperties",{"initialState.environment":{type:I},spatialReference:{type:y},viewingMode:{type:String},"initialState.viewpoint":{type:b}})],f.prototype,"writeInitialViewProperties",null);a([w.property({type:G})],f.prototype,"portalItem",void 0);a([w.property()],f.prototype,
"resourceInfo",void 0);a([g(0,w.cast(G))],f.prototype,"saveAs",null);a([w.property()],f.prototype,"_sceneSpatialReference",null);a([w.property()],f.prototype,"_verifyItemRelativeRootPath",null);return f=a([w.subclass("esri.WebScene")],f)}(w.declared(e,r,u))})},"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../MultiOriginJSONSupport"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});h.updateOrigins=function(a){a&&a.writtenProperties&&a.writtenProperties.forEach(function(a){var f=
a.target;a.newOrigin&&a.oldOrigin!==a.newOrigin&&f.isInstanceOf(d)&&f.updateOrigin(a.propName,a.newOrigin)})}})},"esri/support/webSceneUtils":function(){define(["require","exports","../core/Error"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});h.createCopyError=function(){return new d("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")};h.isCopyError=function(a){return a&&"webscene:failed-to-copy-embedded-resources"===a.name};
h.createSchemaValidationError=function(a){return new d("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:a})};h.isSchemaValidationError=function(a){return a&&"webscene:schema-validation"===a.name}})},"esri/webscene/ApplicationProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators ./applicationProperties/Viewing".split(" "),
function(p,h,d,a,g,f,k){return function(g){function e(a){a=g.call(this,a)||this;a.viewing=null;return a}d(e,g);b=e;e.prototype.clone=function(){return new b({viewing:this.viewing?this.viewing.clone():null})};a([f.property({type:k,json:{write:!0}})],e.prototype,"viewing",void 0);return e=b=a([f.subclass("esri.webscene.ApplicationProperties")],e);var b}(f.declared(g))})},"esri/webscene/applicationProperties/Viewing":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ./Search".split(" "),
function(p,h,d,a,g,f,k){return function(g){function e(a){a=g.call(this,a)||this;a.search=null;return a}d(e,g);b=e;e.prototype.clone=function(){return new b({search:this.search?this.search.clone():null})};a([f.property({type:k,json:{write:!0}})],e.prototype,"search",void 0);return e=b=a([f.subclass("esri.webscene.applicationProperties.Viewing")],e);var b}(f.declared(g))})},"esri/webscene/applicationProperties/Search":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Collection ../../core/JSONSupport ../../core/accessorSupport/decorators ./SearchLayer".split(" "),
function(p,h,d,a,g,f,k,m){var e=g.ofType(m);return function(b){function f(a){a=b.call(this,a)||this;a.enabled=!1;a.hintText=null;a.layers=new e;return a}d(f,b);g=f;f.prototype.clone=function(){return new g({enabled:this.enabled,hintText:this.hintText,layers:this.layers?this.layers.clone():null})};a([k.property({type:Boolean,json:{write:!0}})],f.prototype,"enabled",void 0);a([k.property({type:String,json:{write:!0}})],f.prototype,"hintText",void 0);a([k.property({type:e,json:{write:{enabled:!0,isRequired:!0}}})],
f.prototype,"layers",void 0);return f=g=a([k.subclass("esri.webscene.applicationProperties.Search")],f);var g}(k.declared(f))})},"esri/webscene/applicationProperties/SearchLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./SearchLayerField".split(" "),function(p,h,d,a,g,f,k,m){return function(e){function b(a){a=e.call(this,a)||this;
a.field=null;a.id=null;a.subLayer=null;return a}d(b,e);g=b;b.prototype.clone=function(){return new g({field:this.field?this.field.clone():null,id:this.id,subLayer:this.subLayer})};a([f.property({type:m,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"field",void 0);a([f.property({type:String,json:{write:{enabled:!0,isRequired:!0}}})],b.prototype,"id",void 0);a([f.property({type:k.Integer,json:{write:!0}})],b.prototype,"subLayer",void 0);return b=g=a([f.subclass("esri.webscene.applicationProperties.SearchLayer")],
b);var g}(f.declared(g))})},"esri/webscene/applicationProperties/SearchLayerField":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../layers/support/fieldType".split(" "),function(p,h,d,a,g,f,k){return function(g){function e(a){a=g.call(this,a)||this;a.exactMatch=!1;a.name=null;a.type=null;return a}d(e,g);b=e;e.prototype.clone=function(){return new b({exactMatch:this.exactMatch,
type:this.type,name:this.name})};a([f.property({type:Boolean,json:{write:!0}})],e.prototype,"exactMatch",void 0);a([f.property({type:String,json:{write:!0}})],e.prototype,"name",void 0);a([f.property({type:String,json:{read:k.kebabDict.read,write:k.kebabDict.write}})],e.prototype,"type",void 0);return e=b=a([f.subclass("esri.webscene.applicationProperties.SearchLayerField")],e);var b}(f.declared(g))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators ./Lighting".split(" "),
function(p,h,d,a,g,f,k){return function(g){function e(a){a=g.call(this,a)||this;a.lighting=new k;return a}d(e,g);b=e;e.prototype.clone=function(){return new b({lighting:k.prototype.clone.call(this.lighting)})};e.sanitizeJSON=function(a){return{lighting:a.lighting?k.sanitizeJSON(a.lighting):(new k).toJSON()}};a([f.property({type:k,json:{write:!0}})],e.prototype,"lighting",void 0);return e=b=a([f.subclass("esri.webscene.Environment")],e);var b}(f.declared(g))})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),
function(p,h,d,a,g,f){return function(g){function k(a){a=g.call(this,a)||this;a.date=null;a.directShadowsEnabled=!1;a.displayUTCOffset=null;return a}d(k,g);e=k;k.prototype.readDate=function(a,e){return null!=e.datetime&&new Date(e.datetime)||null};k.prototype.writeDate=function(a,e,d){e[d]=a.getTime()};k.prototype.readDirectShadowsEnabled=function(a,e){return!!e.directShadows};k.prototype.writedirectShadowsEnabled=function(a,e,d){a&&(e[d]=a)};k.prototype.writeDisplayUTCOffset=function(a,e){null!=
a&&(e.displayUTCOffset=a)};k.prototype.clone=function(){return new e({date:null!=this.date?new Date(this.date.getTime()):null,directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null})};k.sanitizeJSON=function(a){var b={datetime:a.datetime};void 0!==a.directShadows&&(b.directShadows=!!a.directShadows);void 0!==a.displayUTCOffset&&(b.displayUTCOffset=a.displayUTCOffset);return b};a([f.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],
k.prototype,"date",void 0);a([f.reader("date",["datetime"])],k.prototype,"readDate",null);a([f.writer("date")],k.prototype,"writeDate",null);a([f.property({type:Boolean,json:{write:{target:"directShadows"}}})],k.prototype,"directShadowsEnabled",void 0);a([f.reader("directShadowsEnabled",["directShadows"])],k.prototype,"readDirectShadowsEnabled",null);a([f.writer("directShadowsEnabled")],k.prototype,"writedirectShadowsEnabled",null);a([f.property({type:Number,json:{write:!0}})],k.prototype,"displayUTCOffset",
void 0);a([f.writer("displayUTCOffset")],k.prototype,"writeDisplayUTCOffset",null);return k=e=a([f.subclass("esri.webscene.Lighting")],k);var e}(f.declared(g))})},"esri/webscene/InitialViewProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Viewpoint ../core/Accessor ../core/accessorSupport/decorators ../geometry/SpatialReference ./Environment".split(" "),function(p,h,d,a,g,f,k,m,e){return function(b){function f(a){a=b.call(this,
a)||this;a.environment=new e;a.spatialReference=null;a.viewpoint=null;return a}d(f,b);t=f;Object.defineProperty(f.prototype,"viewingMode",{set:function(a){"local"!==a&&"global"!==a||this._set("viewingMode",a)},enumerable:!0,configurable:!0});f.prototype.clone=function(){return new t({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})};a([k.property({type:e,
json:{write:{isRequired:!0}}})],f.prototype,"environment",void 0);a([k.property({type:m})],f.prototype,"spatialReference",void 0);a([k.property()],f.prototype,"viewingMode",null);a([k.property({type:g,json:{write:{isRequired:!0}}})],f.prototype,"viewpoint",void 0);return f=t=a([k.subclass("esri.webscene.InitialViewProperties")],f);var t}(k.declared(f))})},"esri/webscene/Presentation":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/accessorSupport/decorators ./Slide".split(" "),
function(p,h,d,a,g,f,k,m,e){var b=g.ofType(e);return function(g){function l(a){a=g.call(this,a)||this;a.slides=new b;return a}d(l,g);Object.defineProperty(l.prototype,"slides",{set:function(a){this._set("slides",f.referenceSetter(a,this._get("slides"),b))},enumerable:!0,configurable:!0});l.prototype.clone=function(){return new this.constructor({slides:this.slides.clone()})};l.sanitizeJSON=function(a){return{slides:void 0!==a.slides&&Array.isArray(a.slides)?a.slides.filter(function(a){return a&&!!a.viewpoint}).map(function(a){return e.sanitizeJSON(a)}):
[]}};a([m.property({type:b,json:{write:!0}}),m.cast(f.castForReferenceSetter)],l.prototype,"slides",null);return l=a([m.subclass("esri.webscene.Presentation")],l)}(m.declared(k))})},"esri/webscene/Slide":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/_base/lang dojo/promise/all ../Basemap ../Viewpoint ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/lang ../core/Logger ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../support/basemapUtils ../views/3d/lib/glMatrix ./Environment ./Lighting ./support/Description ./support/Thumbnail ./support/Title".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x,z,A,y){var B=0,E=function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.id="";return a}d(b,c);e=b;b.prototype.clone=function(){return new e({id:this.id})};a([v.property({type:String,json:{write:!0}})],b.prototype,"id",void 0);return b=e=a([v.subclass()],b);var e}(v.declared(l)),C=e.ofType(E),G=u.getLogger("esri.webscene.Slide");return function(l){function u(a){a=l.call(this,a)||this;a._currentAnimation=null;a.id=Date.now().toString(16)+
"-slide-"+B++;a.title=new y.default;a.description=new z.default;a.thumbnail=new A.default;a.viewpoint=null;a.basemap=null;a.environment=new c;a.visibleLayers=new C;return a}d(u,l);u.prototype.castTitle=function(c){return"string"===typeof c?new y.default({text:c}):q.ensureType(y.default,c)};u.prototype.castDescription=function(c){return"string"===typeof c?new z.default({text:c}):q.ensureType(z.default,c)};u.prototype.castThumbnail=function(c){return"string"===typeof c?new A.default({url:c}):q.ensureType(A.default,
c)};u.prototype.castBasemap=function(c){return n.ensureType(c)};Object.defineProperty(u.prototype,"visibleLayers",{set:function(c){this._set("visibleLayers",b.referenceSetter(c,this._get("visibleLayers"),C))},enumerable:!0,configurable:!0});u.prototype.castVisibleLayers=function(c){return c&&"function"===typeof c.map?c.map(function(c){if("string"===typeof c)return{id:c};if(c.id)return{id:c.id};G.warn('Invalid visible layer, expected { id }, Layer or "id"');return c}):c};u.prototype.clone=function(){return new this.constructor({id:this.id,
title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null})};u.prototype._updateVisibleLayersFrom=function(c){var a=this,b=[];return r.eachAlways(this._allLayers(c.map).map(function(a){return c.whenLayerView(a).then(function(c){c.visible&&
b.push(new E({id:c.layer.id}))})}).toArray()).then(function(){a.visibleLayers.removeAll();a.visibleLayers.addMany(b)})};u.prototype.updateFrom=function(c,a){var b=this;a=g.mixin({screenshot:g.mixin({format:"jpeg",quality:80,width:120,height:75},a&&a.screenshot)},a);return c.when(function(){b.viewpoint=c.viewpoint.clone();b.environment.lighting=x.prototype.clone.apply(c.environment.lighting);b.basemap=c.map.basemap&&c.map.basemap.clone()||null;return b._updateVisibleLayersFrom(c)}).then(function(){return c.takeScreenshot(a.screenshot)}).then(function(c){b.thumbnail=
new A.default({url:c.dataURL});return b})};u.prototype.applyTo=function(c,a){var b=this,e=g.mixin({animate:!0},a);return this._applyBasemap(c).then(function(){return f([b._applyViewpoint(c,e),b._applyLayerVisibility(c,e)])}).then(function(){return b})};u.prototype._applyBasemap=function(c){var a=this;return this.basemap?this.basemap.load().always(function(){c.map.basemap=n.clonePreservingTiledLayers(a.basemap,c.map.basemap)}):r.resolve()};u.prototype._allLayers=function(c){var a=new e;this._collectLayers(c,
a);this._collectLayers(c.ground,a);return a};u.prototype._collectLayers=function(c,a){var b=this;c.layers.forEach(function(c){a.add(c);c.layers&&b._collectLayers(c,a)})};u.prototype._applyLayerVisibility=function(c,a){var b=this;if(this.visibleLayers){var e=this._allLayers(c.map);if(a.applyToLayerViews)return r.eachAlways(e.map(function(a){return c.whenLayerView(a).then(function(c){c.visible=b.visibleLayers.some(function(a){return a.id===c.layer.id})})}).toArray());e.forEach(function(c){return c.visible=
b.visibleLayers.some(function(a){return a.id===c.id})});return r.resolve()}};u.prototype._applyViewpoint=function(c,a){if(this.viewpoint){this.viewpoint.camera.fov=c.camera.fov;if(a.animate){if(this.get("environment.lighting.date"))return this._animateToLighting(c,a);c.environment.lighting=this.environment.lighting.clone();return c.goTo(this.viewpoint,a)}c.viewpoint=this.viewpoint;c.environment.lighting=this.environment.lighting.clone()}return r.resolve()};u.prototype._animateToLighting=function(c,
a){var b=this,e;"global"===c.viewingMode&&(e=this._animateLightingWithCamera(c));this._currentAnimation&&(this._currentAnimation.cancel(),this._currentAnimation=null);c.environment.lighting.cameraTrackingEnabled=!1;c.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled;null!=this.environment.lighting.displayUTCOffset&&(c.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);var d=c.goTo(this.viewpoint,a);this._currentAnimation=d;this._currentAnimation.always(function(){e&&
e.remove();b._currentAnimation===d&&(c.environment.lighting.cameraTrackingEnabled=!0)});this._currentAnimation.then(function(){c.environment.lighting=b.environment.lighting.clone()});return this._currentAnimation};u.prototype._getTime=function(c){var a=c.getTime();c=3600*c.getUTCHours()+60*c.getUTCMinutes()+c.getUTCSeconds();return[a,c]};u.prototype._setTime=function(c,a,b){c.setTime(a);c.setUTCHours(b/3600);c.setUTCMinutes(b%3600/60);c.setUTCSeconds(b%3600%60);return c};u.prototype._animateLightingWithCamera=
function(c){var a=this,b=w.vec3d,e=this._getTime(new Date(c.environment.lighting.date.toString())),d=e[0],f=e[1],e=this._getTime(this.environment.lighting.date),g=e[0],n=e[1],l=c.renderCoordsHelper,k=[0,0,0];l.toRenderCoords(c.camera.position,k);var x=[0,0,0];l.toRenderCoords(this.viewpoint.camera.position,x);var q=[0,0,0],m=new Date;return c.watch("camera",function(e){l.toRenderCoords(e.position,q);e=b.dist2(k,q);var r=b.dist2(x,q),v=0;0!==e+r&&(v=e/(e+r));c.environment.lighting.date=a._setTime(m,
d+(g-d)*v,f+(n-f)*v)})};u.createFrom=function(c,a){return(new this).updateFrom(c,a)};u.sanitizeJSON=function(a){var b;b=void 0!==a.visibleLayers&&Array.isArray(a.visibleLayers)?t.clone(a.visibleLayers):[];b={id:a.id||"",title:a.title||{text:""},thumbnail:a.thumbnail||{url:""},viewpoint:a.viewpoint,baseMap:a.baseMap,visibleLayers:b};void 0!==a.description&&(b.description=a.description);void 0!==a.environment&&(b.environment=c.sanitizeJSON(a.environment));return b};a([v.property({type:String,json:{write:{isRequired:!0}}})],
u.prototype,"id",void 0);a([v.property({type:y.default,json:{write:{isRequired:!0}}})],u.prototype,"title",void 0);a([v.cast("title")],u.prototype,"castTitle",null);a([v.property({type:z.default,json:{write:{overridePolicy:function(c){return{enabled:!(!c||!c.text)}}}}})],u.prototype,"description",void 0);a([v.cast("description")],u.prototype,"castDescription",null);a([v.property({type:A.default,json:{write:{isRequired:!0}}})],u.prototype,"thumbnail",void 0);a([v.cast("thumbnail")],u.prototype,"castThumbnail",
null);a([v.property({type:m,json:{write:{isRequired:!0}}})],u.prototype,"viewpoint",void 0);a([v.property({type:k,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],u.prototype,"basemap",void 0);a([v.cast("basemap")],u.prototype,"castBasemap",null);a([v.property({type:C,json:{write:{isRequired:!0}}})],u.prototype,"visibleLayers",null);a([v.cast("visibleLayers")],u.prototype,"castVisibleLayers",null);a([v.property({type:c,json:{write:!0}})],u.prototype,"environment",void 0);return u=a([v.subclass("esri.webscene.Slide")],
u)}(v.declared(l))})},"esri/webscene/support/Description":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(p,h,d,a,g,f){Object.defineProperty(h,"__esModule",{value:!0});p=function(g){function k(){var a=null!==g&&g.apply(this,arguments)||this;a.text="";return a}d(k,g);e=k;k.prototype.clone=function(){return new e({text:this.text})};a([f.property({type:String,
json:{write:!0}})],k.prototype,"text",void 0);return k=e=a([f.subclass("esri.webscene.support.Description")],k);var e}(f.declared(g));h.default=p})},"esri/webscene/support/Thumbnail":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(p,h,d,a,g,f){Object.defineProperty(h,"__esModule",{value:!0});p=function(g){function k(){var a=null!==g&&g.apply(this,arguments)||
this;a.url="";return a}d(k,g);e=k;k.prototype.clone=function(){return new e({url:this.url})};a([f.property({type:String,json:{write:{isRequired:!0}}})],k.prototype,"url",void 0);return k=e=a([f.subclass("esri.webscene.support.Thumbnail")],k);var e}(f.declared(g));h.default=p})},"esri/webscene/support/Title":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(p,
h,d,a,g,f){Object.defineProperty(h,"__esModule",{value:!0});p=function(g){function k(){var a=null!==g&&g.apply(this,arguments)||this;a.text="";return a}d(k,g);e=k;k.prototype.clone=function(){return new e({text:this.text})};a([f.property({type:String,json:{write:{isRequired:!0}}})],k.prototype,"text",void 0);return k=e=a([f.subclass("esri.webscene.support.Title")],k);var e}(f.declared(g));h.default=p})},"esri/webscene/Version":function(){define(["require","exports","../core/tsSupport/extendsHelper",
"../core/Version"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});p=function(a){function f(d,f){return a.call(this,d,f,"webscene")||this}d(f,a);Object.defineProperty(f.prototype,"supportsGround",{get:function(){return this.since(1,8)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"supportsVisibleElevationLayersInSlides",{get:function(){return this.lessThan(1,8)},enumerable:!0,configurable:!0});return f}(a.Version);h.Version=p;h.default=p})},"esri/core/Version":function(){define(["require",
"exports","./Error"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function a(a,d,k){void 0===k&&(k="");this.major=a;this.minor=d;this._context=k}a.prototype.lessThan=function(a,d){return this.major<a||a===this.major&&this.minor<d};a.prototype.since=function(a,d){return!this.lessThan(a,d)};a.prototype.validate=function(a){if(this.major!==a.major)throw new d((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+
"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:a});};a.prototype.clone=function(){return new a(this.major,this.minor,this._context)};a.parse=function(g,f){void 0===f&&(f="");var k=g.split("."),m=k[0],k=k[1],e=/^\s*\d+\s*$/;if(!m||!m.match||!m.match(e))throw new d((f&&f+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:g});if(!k||!k.match||!k.match(e))throw new d((f&&f+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",
{version:g});g=parseInt(m,10);m=parseInt(k,10);return new a(g,m,f)};return a}();h.Version=p})},"esri/views/SceneView":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/dom dojo/when ../Camera ../geometry ../Graphic ../Viewpoint ../core/Error ../core/Handles ../core/Logger ../core/promiseUtils ../core/scheduling ../core/sniff ../core/watchUtils ../core/accessorSupport/decorators ../core/accessorSupport/watch ../geometry/HeightModelInfo ../geometry/support/scaleUtils ../geometry/support/webMercatorUtils ./BreakpointsOwner ./DOMContainer ./View ./ViewAnimation ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/GraphicsView3D ./3d/layers/graphics/Deconflictor ./3d/lib/glMatrix ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/projectionUtils ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Selector ./support/screenshotUtils ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x,z,A,y,B,E,C,G,J,F,I,H,K,L,M,V,S,Z,R,N,D,P,O,Q,T,da,U,aa,X,ba,ea,W,ca,ka,ga){var ia=u.getLogger("esri.views.SceneView");p=function(u){function h(c){c=u.call(this)||this;c._layerViewsUpdatingHandles={};c._clippingArea=null;c._internallyReady=!1;c._userClippingArea=null;c._initialDefaultSpatialReference=null;c._defaults={};c._externallySet={environment:!1};c._stageHandles=new t;c._graphicsView=null;c._surfaceReadyWatchHandle=null;c._updateUpdatingMonitorsHandle=
null;c._mapLayersChangeHandle=null;c._updateDrawingOrderHandle=null;c._stageFrameTask=null;c.onViewExtentUpdateHandle=null;c.resourceController=new T(c);c.deconflictor=new K(c);c.renderSpatialReference=null;c.sharedSymbolResources=null;c.basemapTerrain=null;c.elevationProvider=null;c.camera=null;c.canvas=null;c.center=null;c.constraints=new G.default;c.extent=null;c.fullOpacity=1;c.map=null;c.screenSizePerspectiveEnabled=!0;c.state=null;c.scale=null;c.isHeightModelInfoRequired=!0;c.type="3d";c.ui=
new ka;c.updating=!1;c.updatingPercentage=0;c.viewpoint=null;c.zoom=null;c.highlightOptions=new N;n.when(c,"ready",c._viewReadyHandler.bind(c));c._evaluateUpdating=c._evaluateUpdating.bind(c);c.watch("map",function(c){c&&c.load&&c.load()});c.inputManager=new I({view:c});c.stateManager=new V.ViewStateManager({view:c});return c}d(h,u);h.prototype.getDefaults=function(c){var a=this.inherited(arguments);a.environment||c.environment||(this._defaults.environment=new J.default,a.environment=this._defaults.environment);
return a};h.prototype.initialize=function(){var c=this;this.environmentManager=new F.default({view:this});this._updateUpdatingMonitorsHandle=this.allLayerViews.on("change",this._updateUpdatingMonitors.bind(this));this._updateUpdatingMonitors({added:this.allLayerViews.toArray(),removed:[]});n.whenNot(this,"ready",this._viewUnreadyHandler.bind(this));this.resourceController.getMemoryEvents().on("updating-changed",function(){return c._evaluateUpdating()});n.init(this.qualitySettings,"gpuMemoryLimit",
function(a){c.resourceController&&c.resourceController.setMaxGpuMemory(a)});n.init(Z,"SCENEVIEW_LOCKING_LOG",function(a){c.defaultsFromMap.logDebugInformation=a})};h.prototype.destroy=function(){this.activeTool=null;c.dispatchTarget(this);this.environmentManager.destroy();this._disposeGraphicsView();this._updateUpdatingMonitorsHandle.remove();this._updateUpdatingMonitorsHandle=null;this._stageHandles.remove();this.inputManager&&(this.inputManager.destroy(),this._set("inputManager",null))};Object.defineProperty(h.prototype,
"activeTool",{set:function(c){if(c&&!this.ready)ia.error("#activeTool\x3d","cannot set active tool while view is not ready");else{var a=this._get("activeTool");c!==a&&(a&&a.deactivate(),this._set("activeTool",c),c&&c.activate())}},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"clippingArea",{get:function(){if("global"===this.viewingMode)return null;if(this._userClippingArea)return this._userClippingArea;var c=this.get("map.clippingEnabled"),a=this.get("map.clippingArea");if(!c||
!a)return this._clippingArea=null;if(!(a instanceof m.Extent))return ia.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(A.canProject(a.spatialReference,this.spatialReference))a=A.project(a,this.spatialReference);else return ia.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;return this._clippingArea&&a&&this._clippingArea.equals(a)?this._clippingArea:this._clippingArea=a},set:function(c){this.ready&&
"global"===this.viewingMode&&c?ia.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=c,this.notifyChange("clippingArea"))},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"dataExtent",{get:function(){var c=[],a=this.spatialReference||m.SpatialReference.WGS84,b=this.clippingArea;b&&(b=A.project(b,a));var e=function(e){e&&(e=A.project(e,a))&&(b&&(e=e.intersection(b)),e&&c.push(e))},d=this._get("basemapTerrain");d&&d.spatialReference&&
e(new m.Extent({xmin:d.extent[0],ymin:d.extent[1],zmin:0,xmax:d.extent[2],ymax:d.extent[3],zmax:0,spatialReference:d.spatialReference}));this.map&&this.map.allLayers.forEach(function(c){e(c.fullExtent)});return 0<c.length?(d=c.reduce(function(c,a){return c.union(a)}),d.hasZ?(d.zmin=Math.min(0,d.zmin),d.zmax=Math.max(0,d.zmax)):(d.zmin=0,d.zmax=0),d):new m.Extent({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:a})},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"environment",
{set:function(c){c!==this._defaults.environment&&(this._externallySet.environment=!0);c?c instanceof J.default?this._set("environment",c):c instanceof ga?this.environment.lighting=c.lighting:c.declaredClass?this._set("environment",c):this._set("environment",new J.default(c)):this._set("environment",new J.default)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"groundExtent",{get:function(){var c=this._get("basemapTerrain");if(c&&c.spatialReference){var a=c.extent;return new m.Extent({xmin:a[0],
ymin:a[1],xmax:a[2],ymax:a[3],spatialReference:c.spatialReference})}return new m.Extent({spatialReference:this.spatialReference||m.SpatialReference.WGS84})},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"initialExtentRequired",{get:function(){return!this.stateManager.hasInitialView},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"interacting",{get:function(){return!!this.state&&this.state.interacting},enumerable:!0,configurable:!0});h.prototype._mapSetter=function(c){c!==
this._get("map")&&(this._mapLayersChangeHandle&&(this._mapLayersChangeHandle.remove(),this._mapLayersChangeHandle=null),c&&(this._mapLayersChangeHandle=c.allLayers.on("change",this.notifyChange.bind(this,"dataExtent"))),this.inherited(arguments))};Object.defineProperty(h.prototype,"qualityProfile",{get:function(){return this._get("qualityProfile")||R.getDefaultProfile()},set:function(c){R.isValidProfile(c)&&(R.apply(c,this.qualitySettings),this._set("qualityProfile",c))},enumerable:!0,configurable:!0});
Object.defineProperty(h.prototype,"resolution",{get:function(){return null!=this.spatialReference?z.getResolutionForScale(this.scale,this.spatialReference):0},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"heightModelInfo",{get:function(){var c=this.getDefaultHeightModelInfo();return null!=c?x.deriveUnitFromSR(c,this.spatialReference):null},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"viewingMode",{get:function(){var c=this.get("map.initialViewProperties.viewingMode"),
a=this.spatialReference;c||(c=!a||a.isWebMercator||a.isWGS84?"global":"local");return c},set:function(c){this._internallyReady?ia.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(c)?this._override("viewingMode",c):void 0===c&&this._clearOverride("viewingMode")},enumerable:!0,configurable:!0});h.prototype.on=function(c,a,b){var e=this.inputManager.viewEvents.register(c,a,b);return e?e:this.inherited(arguments)};h.prototype.hasEventListener=function(c){return this.inherited(arguments)||
this.inputManager&&this.inputManager.viewEvents.hasHandler(c)};h.prototype.toMap=function(c,a,b){if(!this.ready)return ia.error("#toMap()","Scene view cannot be used before it is ready"),null;var e;"number"===typeof c?(e=c,c=a):(e=c.x,c=c.y,b=a);a=this._stage.pick([e,this.height-c]).getMinResult();return this._computeMapPointFromIntersectionResult(a,b)};h.prototype.toScreen=function(c,a,b,e){if(!this.ready)return ia.error("#toScreen()","Scene view cannot be used before it is ready"),null;"number"===
typeof c?("object"===typeof b&&(e=b),P.vectorToVector([c,a,"number"===typeof b?b:0],this.spatialReference,ha,this.renderSpatialReference)):(P.pointToVector(c,ha,this.renderSpatialReference),e=a);return this.engineToScreen(ha,e)};h.prototype.pixelSizeAt=function(c,a){if(!this.ready)return ia.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if("number"===typeof c){if(c=this._stage.pick([c,this.height-a]).getMinResult(),!c.getIntersectionPoint(ha))return 0}else if(c instanceof
m.Point)P.pointToVector(c,ha,this.renderSpatialReference);else if(c=this._stage.pick([c.x,this.height-c.y]).getMinResult(),!c.getIntersectionPoint(ha))return 0;return this.state.camera.computePixelSizeAt(ha)};h.prototype.hitTest=function(c,a){if(!this.ready)return ia.error("#hitTest()","Scene view cannot be used before it is ready"),null;var b,e;"number"===typeof c?(b=c,e=a):(b=c.x,e=c.y);var d=this._stage.pick([b,this.height-e],null,!0);c=d.getMinResult();var g=this._computeMapPointFromIntersectionResult(c),
n;switch(c.targetType){case "None":n=null;break;case "StageObject":n=this._getGraphicFromStageObject(c.target,c.triangleNr);break;case "StagePoint":n=f(this._getGraphicFromStagePoint(c.target))}return f(n).catch(function(){return null}).then(function(c){var a=[];(c||g)&&a.push({mapPoint:g,graphic:c});c={screenPoint:new m.ScreenPoint({x:b,y:e}),results:a};Z.SCENEVIEW_HITTEST_RETURN_SELECTOR&&(c.selector=d);return c})};h.prototype.goTo=function(c,a){return this.stateManager.goTo(c,a)};h.prototype.takeScreenshot=
function(c){var a=this;if(this.ready)return c=W.adjustScreenshotSettings(c,this),r.create(function(b){a._stage.requestScreenCapture(c,function(c){v.schedule(function(){b(c)})})});ia.error("#takeScreenshot()","Scene view cannot be used before it is ready")};h.prototype.destroyLayerViews=function(){for(var c in this._layerViewsUpdatingHandles)this._layerViewsUpdatingHandles[c].remove();this._layerViewsUpdatingHandles={};this.stateManager.deinit();this._disposeSurface();this.inherited(arguments);this._stage&&
(this._stage.dispose(),this._stage=null,this._stageHandles.remove());this._set("canvas",null);this.deconflictor.destroy();this.deconflictor=null;this.resourceController.destroy();this.resourceController=null};h.prototype.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||this.get("defaultsFromMap.isSpatialReferenceDone")&&this._initialDefaultSpatialReference||null};h.prototype.validate=function(){var c=
ca.check();q("safari")&&9>q("safari")&&(c=new l("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:q("safari")}));return c?(ia.warn("#validate()",c.message),r.reject(c)):r.resolve()};h.prototype.isSpatialReferenceSupported=function(c,a,b){var e=c.isGeographic,d=c.isWebMercator,f=c.isWGS84,g="local"===this.viewingMode,n=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));
if(n){if(g&&e)return b&&b("Layer "+a.id+" is ignored because it is GCS and viewing mode is local"),!1;if(!g&&!d&&!f)return b&&b("Layer "+a.id+" is ignored because its spatial reference is not supported in global viewing mode"),!1}else if(e&&!f)return b&&b("Layer "+a.id+" is ignored because its spatial reference is geographic but not WGS84"),!1;if(a)if(X.isTiledLayer(a)){if(e=void 0,n?n=X.getTiledLayerInfo(a,c,this.viewingMode):(n=X.getTiledLayerInfo(a,c,"global"),null==n.tileInfo&&(n=X.getTiledLayerInfo(a,
c,"local"))),e=null!=n.tileInfo,!e)return b&&b("Layer "+a.id+" is ignored because it is tiled but\n            its tiling scheme is not supported or compatible with the viewing mode"),!1}else if((f||d)&&!g)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=c),n||this._internallyReady||(this.viewingMode="global",b&&b("Viewing mode locked to global due to reprojectable layer "+a.id)),b&&b("Layer "+a.id+" is ignored because it supports server-side reprojection"),
!1;return!0};h.prototype.engineToScreen=function(c,a){var b=L.vec3d.create();this.state.camera.projectPoint(c,b);c=b[0];var e=this.height-b[1],b=b[2];return a?(a.x=c,a.y=e,a.z=b,a):new m.ScreenPoint({x:c,y:e,z:b})};h.prototype.flushDisplayModifications=function(){this._stage.processDirty()};h.prototype.getDrawingOrder=function(c){return this.allLayerViews.findIndex(function(a){return a.layer&&a.layer.uid===c})};h.prototype.getViewForGraphic=function(c){return c.layer?this.allLayerViews.find(function(a){return a.layer===
c.layer}):this._graphicsView};h.prototype.whenViewForGraphic=function(c){return c.layer?this.whenLayerView(c.layer):r.resolve(this._graphicsView)};h.prototype._computeMapPointFromIntersectionResult=function(c,a){if(c.getIntersectionPoint(ha)){a=this._computeMapPointFromVec3d(ha,a);var b=this._get("basemapTerrain");"terrain"===c.intersector&&b&&(c=b.getElevation(a),null!==c&&(a.z=c));return a}return null};h.prototype._computeMapPointFromVec3d=function(c,a){var b=this.spatialReference||m.SpatialReference.WGS84;
P.vectorToVector(c,this.renderSpatialReference,c,b)||(b=m.SpatialReference.WGS84,P.vectorToVector(c,this.renderSpatialReference,c,b));a?(a.x=c[0],a.y=c[1],a.z=c[2],a.spatialReference=b):a=new m.Point(c,b);return a};h.prototype._getGraphicFromStageObject=function(c,a){var b=c.getMetadata();if(null!=b&&null!=b.layerUid){if(b.layerUid===this._graphicsView.mockLayerId)return this._graphicsView.getGraphicsFromStageObject(c,a);if(b=this.map.findLayerByUid(b.layerUid))return this.whenLayerView(b).then(function(b){if(b&&
null!=b.getGraphicsFromStageObject&&!b.suspended)return b.getGraphicsFromStageObject(c,a)})}return null};h.prototype._getGraphicFromStagePoint=function(c){var a=this._computeMapPointFromVec3d(c.point),a=new e(a);c=c.metadata.layerUid;null!=c&&a.set("layer",this.map.findLayerByUid(c));return a};h.prototype._viewingModeToManifold=function(c){switch(c){case "global":return"spherical";case "local":return"planar"}};h.prototype._initBasemapTerrain=function(c){this._disposeBasemapTerrain();this._set("basemapTerrain",
new aa(this,this._viewingModeToManifold(c)));this._set("elevationProvider",new S({view:this}));this.elevationProvider.register("ground",this.basemapTerrain)};h.prototype._initGlobe=function(c){this._initCoordinateSystem();this._initState();this._stage.setViewParams({backgroundColor:[0,0,0,0],maxFarNearRatio:0,frustumCullingEnabled:!1});this._initBasemapTerrain(c);this._set("pointsOfInterest",new U.default({view:this}));this._initStateManager()};h.prototype._initCoordinateSystem=function(){if(this.spatialReference){var c=
this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(c)||this._set("mapCoordsHelper",new D.default(this.map,c));var a="global"===this.viewingMode,c=a?P.SphericalECEFSpatialReference:c;c!==this.renderSpatialReference&&(this.renderSpatialReference=c,this._set("renderCoordsHelper",Q.createRenderCoordsHelper(a?"global":"local",c)),this._stage&&this._stage.setIntersectTolerance(ea.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",
null),this._set("renderCoordsHelper",null),this.renderSpatialReference=null};h.prototype._evaluateUpdating=function(){var c=0,a=0,b=!1;this.allLayerViews.forEach(function(e){e.updating&&(b=!0,e=e.updatingPercentage,null!=e&&(++a,c+=e))});if(this._graphicsView&&this._graphicsView.updating||this.resourceController&&this.resourceController.isUpdating())b=!0;b!==this.updating&&this._set("updating",b);c=0!==a?c/a:b?100:0;this.updatingPercentage!==c&&this._set("updatingPercentage",c)};h.prototype._updateUpdatingMonitors=
function(c){for(var a=0;a<c.removed.length;a++){var b=c.removed[a],e=this._layerViewsUpdatingHandles[b.uid];e&&(delete this._layerViewsUpdatingHandles[b.uid],b.destroyed||e.remove())}for(a=0;a<c.added.length;a++)b=c.added[a],b.destroyed||(e=b.watch(["updating","updatingPercentage"],this._evaluateUpdating),this._layerViewsUpdatingHandles[b.uid]=e);this._evaluateUpdating()};h.prototype._pickRay=function(c,a,b,e,d,f,g){return this._stage?this._stage.pickRay(c,a,b,e,d,f,g):null};h.prototype._pickRayWithBeginPoint=
function(c,a,b,e,d){this._stage&&this._stage.pickRayWithBeginPoint(c,a,b,e,d)};h.prototype._disposeSurface=function(){var c=function(c){c&&c.remove();return null};this._stageFrameTask=c(this._stageFrameTask);this._updateDrawingOrderHandle=c(this._updateDrawingOrderHandle);this.onViewExtentUpdateHandle=c(this.onViewExtentUpdateHandle);this._mapLayersChangeHandle=c(this._mapLayersChangeHandle);this.pointsOfInterest&&(this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null));this._disposeBasemapTerrain();
this.environmentManager&&this.environmentManager.disposeRendering()};h.prototype._disposeBasemapTerrain=function(){var c=this._get("basemapTerrain");c&&(c.destroy(),this._set("basemapTerrain",null))};h.prototype._initStage=function(){var c=this,a={};a.renderContext=this.renderContext;a.deactivatedWebGLExtensions=this.deactivatedWebGLExtensions;a.viewingMode=this.viewingMode;this.renderCanvas&&(a.canvas=this.renderCanvas);this._stage=new ba(this.viewingMode,g.byId(this.surface),a);this._stageHandles.add(n.init(this.qualitySettings,
"antialiasingEnabled",function(){c._stage.setRenderParams({antialiasingEnabled:c.qualitySettings.antialiasingEnabled})}));a=function(){c._stage.setRenderParams({defaultHighlightOptions:N.toEngineOptions(c.highlightOptions)})};this._stageHandles.add(this.watch(["highlightOptions","highlightOptions.color","highlightOptions.haloOpacity","highlightOptions.fillOpacity"],a));a();this.renderCoordsHelper&&this._stage.setIntersectTolerance(ea.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",
this._stage.getCanvas());this._stageFrameTask=v.addFrameTask(this._stage.getFrameTask())};h.prototype._initSurface=function(){this._initStage();this._initGlobe(this.viewingMode);this.sharedSymbolResources=new da.default({stage:this._stage,viewingMode:this.viewingMode,resourceController:this.resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})};h.prototype._initGraphicsView=function(){var c=this;this._surfaceReadyWatchHandle=n.whenTrueOnce(this,"basemapTerrain.ready",function(){c._graphicsView=
new H({view:c,graphics:c.graphics});c._surfaceReadyWatchHandle=null;c._layerViewsUpdatingHandles[c._graphicsView.mockLayerId]=n.init(c._graphicsView,"updating",c._evaluateUpdating)})};h.prototype._disposeGraphicsView=function(){this._surfaceReadyWatchHandle&&(this._surfaceReadyWatchHandle.remove(),this._surfaceReadyWatchHandle=null);if(this._graphicsView){var c=this._graphicsView.mockLayerId;this._layerViewsUpdatingHandles[c].remove();delete this._layerViewsUpdatingHandles[c];this._graphicsView.destroy();
this._graphicsView=null}};h.prototype._initState=function(){this._set("state",new M.default({viewingMode:this.viewingMode,spatialReference:this.spatialReference}))};h.prototype._initStateManager=function(){this.stateManager.init()};h.prototype._viewReadyHandler=function(c,a){a||("global"===this.viewingMode&&(this._clippingArea=null),this._internallyReady=!0,this._initSurface(),this._initGraphicsView(),!this._externallySet.environment&&(c=this.get("map.initialViewProperties.environment"))&&(this.environment=
c),this._updateDrawingOrderHandle=this.allLayerViews.on("change",this._updateDrawingOrder.bind(this)),this._updateDrawingOrder(),this.environmentManager.updateReadyChange(!0))};h.prototype._viewUnreadyHandler=function(c,a){a&&(this.activeTool&&(this.activeTool.deactivate(),this._set("activeTool",null)),this._initialDefaultSpatialReference=null,this.environmentManager.updateReadyChange(!1),this._disposeGraphicsView(),this._internallyReady=!1,this.stateManager.deinit(),this._disposeSurface(),this.state.destroy(),
this._set("state",null),this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null),this._stage&&(this._stage.dispose(),this._stage=null,this._stageHandles.remove()),this._set("canvas",null))};h.prototype._updateDrawingOrder=function(){var c=this.allLayerViews.length-1;this.allLayerViews.forEach(function(a,b){null!=a.drawingOrder&&(a.drawingOrder=c-b)})};a([w.property({value:null})],h.prototype,"activeTool",null);a([w.property({type:C,readOnly:!0,aliasOf:"state.animation"})],
h.prototype,"animation",void 0);a([w.property({readOnly:!0})],h.prototype,"basemapTerrain",void 0);a([w.property({readOnly:!0})],h.prototype,"elevationProvider",void 0);a([w.property({type:k,aliasOf:"stateManager.camera"})],h.prototype,"camera",void 0);a([w.property({readOnly:!0})],h.prototype,"canvas",void 0);a([w.property({type:m.Point,aliasOf:"stateManager.center"})],h.prototype,"center",void 0);a([w.property({type:m.Extent,dependsOn:["map.clippingArea","map.clippingEnabled","viewingMode"]})],
h.prototype,"clippingArea",null);a([w.property({type:G.default})],h.prototype,"constraints",void 0);a([w.property({type:m.Extent,dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0})],h.prototype,"dataExtent",null);a([w.property({value:null})],h.prototype,"environment",null);a([w.property()],h.prototype,"environmentManager",void 0);a([w.property({type:m.Extent,aliasOf:"stateManager.extent"})],h.prototype,"extent",void 0);a([w.property({type:m.ScreenPoint,readOnly:!0,aliasOf:"stateManager.screenCenter"})],
h.prototype,"screenCenter",void 0);a([w.property({aliasOf:"stateManager.frustum"})],h.prototype,"frustum",void 0);a([w.property({type:Number,readOnly:!0})],h.prototype,"fullOpacity",void 0);a([w.property({type:m.Extent,dependsOn:["basemapTerrain.extent"],readOnly:!0})],h.prototype,"groundExtent",null);a([w.property({type:Boolean,dependsOn:["stateManager.hasInitialView"]})],h.prototype,"initialExtentRequired",null);a([w.property({type:Boolean,dependsOn:["state.interacting"],readOnly:!0})],h.prototype,
"interacting",null);a([w.property()],h.prototype,"map",void 0);a([w.property({readOnly:!0})],h.prototype,"mapCoordsHelper",void 0);a([w.property({aliasOf:"stateManager.padding"})],h.prototype,"padding",void 0);a([w.property({type:U.default,readOnly:!0})],h.prototype,"pointsOfInterest",void 0);a([w.property({type:Boolean})],h.prototype,"screenSizePerspectiveEnabled",void 0);a([w.property({constructOnly:!0})],h.prototype,"deactivatedWebGLExtensions",void 0);a([w.property({constructOnly:!0})],h.prototype,
"renderCanvas",void 0);a([w.property({readOnly:!0})],h.prototype,"state",void 0);a([w.property({readOnly:!0})],h.prototype,"inputManager",void 0);a([w.property({readOnly:!0})],h.prototype,"stateManager",void 0);a([w.property()],h.prototype,"qualityProfile",null);a([w.property({type:O,get:function(){var c=this._get("qualitySettings");c||(c=new O,R.apply(this.qualityProfile,c));return c}})],h.prototype,"qualitySettings",void 0);a([w.property({dependsOn:["viewingMode"]})],h.prototype,"ready",void 0);
a([w.property({readOnly:!0})],h.prototype,"renderCoordsHelper",void 0);a([w.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],h.prototype,"resolution",null);a([w.property({type:Number,aliasOf:"stateManager.scale"})],h.prototype,"scale",void 0);a([w.property()],h.prototype,"heightModelInfo",null);a([w.property({dependsOn:["map.initialViewProperties.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],h.prototype,"spatialReference",void 0);a([w.property({type:Boolean})],
h.prototype,"isHeightModelInfoRequired",void 0);a([w.property()],h.prototype,"type",void 0);a([w.property({type:ka})],h.prototype,"ui",void 0);a([w.property({type:Boolean,readOnly:!0})],h.prototype,"updating",void 0);a([w.property({type:Number,readOnly:!0})],h.prototype,"updatingPercentage",void 0);a([w.property({type:String,dependsOn:["map.initialViewProperties.viewingMode","spatialReference"]})],h.prototype,"viewingMode",null);a([w.property({type:b,aliasOf:"stateManager.viewpoint"})],h.prototype,
"viewpoint",void 0);a([w.property({type:Number,aliasOf:"stateManager.zoom"})],h.prototype,"zoom",void 0);a([w.property({type:N})],h.prototype,"highlightOptions",void 0);return h=a([w.subclass("esri.views.SceneView")],h)}(w.declared(B,E,y));var ha=L.vec3d.create();return p})},"esri/views/BreakpointsOwner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/dom-class ../core/Accessor ../core/ArrayPool ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./DOMContainer".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t){var u={widthBreakpoint:{getValue:function(a){var b=a.viewSize[0];a=a.breakpoints;var e=this.values;return b<=a.xsmall?e.xsmall:b<=a.small?e.small:b<=a.medium?e.medium:b<=a.large?e.large:e.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},
heightBreakpoint:{getValue:function(a){var b=a.viewSize[1];a=a.breakpoints;var e=this.values;return b<=a.xsmall?e.xsmall:b<=a.small?e.small:b<=a.medium?e.medium:b<=a.large?e.large:e.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},
orientation:{getValue:function(a){a=a.viewSize;var b=this.values;return a[1]>=a[0]?b.portrait:b.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},r={xsmall:544,small:768,medium:992,large:1200};return function(k){function q(){var a=null!==k&&k.apply(this,arguments)||this;a._breakpointsHandles=new e;a.breakpoints=r;a.orientation=null;a.widthBreakpoint=null;a.heightBreakpoint=null;return a}
d(q,k);q.prototype.initialize=function(){this._breakpointsHandles.add([b.init(this,["breakpoints","size"],this._updateClassNames)])};q.prototype.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)};q.prototype._updateClassNames=function(){if(this.container){var a=m.acquire(),b=m.acquire(),c=!1,e,d,f;for(e in u)d=this[e],f=u[e].getValue({viewSize:this.size,breakpoints:this.breakpoints}),d!==f&&(c=!0,this[e]=f,b.push(u[e].valueToClassName[d]),
a.push(u[e].valueToClassName[f]));c&&(this._applyClassNameChanges(a,b),m.release(a),m.release(b))}};q.prototype._applyClassNameChanges=function(a,b){var c=this.container;c&&(f.remove(c,b),f.add(c,a))};q.prototype._removeActiveClassNames=function(){var a=this.container;if(a)for(var b in u)f.remove(a,u[b].valueToClassName[this[b]])};a([l.property({set:function(a){var b=this._get("breakpoints");if(a!==b){b=(b=a)&&b.xsmall<b.small&&b.small<b.medium&&b.medium<b.large;if(!b){var c=JSON.stringify(r,null,
2);console.warn("provided breakpoints are not valid, using defaults:"+c)}a=b?a:r;this._set("breakpoints",g({},a))}}})],q.prototype,"breakpoints",void 0);a([l.property()],q.prototype,"orientation",void 0);a([l.property()],q.prototype,"widthBreakpoint",void 0);a([l.property()],q.prototype,"heightBreakpoint",void 0);return q=a([l.subclass("esri.views.BreakpointsOwner")],q)}(l.declared(k,t))})},"esri/views/DOMContainer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/dom dojo/dom-construct dojo/on ../core/Accessor ../core/Evented ../core/Handles ../core/scheduling ../core/watchUtils ../core/accessorSupport/decorators ./PopupManager ./overlay/ViewOverlay ../widgets/Popup".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q){var n=[0,0];return function(e){function c(){var c=e.call(this)||this;c._domHandles=new b;c._freqInfo={freq:16,time:750};c._overlayRenderTaskHandle=null;c.height=0;c.popup=new q({view:c});c.position=null;c.resizing=!1;c.root=null;c.surface=null;c.suspended=!0;c.ui=null;c.userContent=null;c.width=0;c.watch("cursor",function(a){var b=c.surface;b&&b.setAttribute("data-cursor",a)});c.watch("interacting",function(a){var b=c.surface;b&&b.setAttribute("data-interacting",
a.toString())});c._focusEvent=c._focusEvent.bind(c);c._blurEvent=c._blurEvent.bind(c);return c}d(c,e);c.prototype.initialize=function(){this.watch("ui",this._handleUIChange);this._wireUI(this.ui)};c.prototype.destroy=function(){this.ui.destroy();this.popup&&!this.popup.destroyed&&this.popup.destroy();this.container=null;this._domHandles.destroy()};Object.defineProperty(c.prototype,"container",{set:function(c){var a=this,b=this._get("container");if(b!==c){this._domHandles.remove("dom-size");this._stopMeasuring();
if(b){var e=this.surface;e&&(e.removeEventListener("focus",this._focusEvent),e.removeEventListener("blur",this._blurEvent));b.classList.remove("esri-view");this.popupManager.destroy();this._set("popupManager",null);this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null);this.overlay.destroy();this._set("overlay",null);f.destroy(this.root);this._set("root",null);f.destroy(this.userContent);this._set("userContent",null)}if(c){c.classList.add("esri-view");
b=document.createElement("div");for(b.className="esri-view-user-storage";c.hasChildNodes();)b.appendChild(c.firstChild);c.appendChild(b);b=document.createElement("div");b.className="esri-view-root";c.insertBefore(b,c.firstChild);this._set("root",b);var d=document.createElement("div");d.className="esri-view-surface";d.setAttribute("role","application");d.tabIndex=0;d.addEventListener("focus",this._focusEvent);d.addEventListener("blur",this._blurEvent);g.setSelectable(d,!1);b.appendChild(d);this._set("surface",
d);e=new v;b.appendChild(e.surface);this._set("overlay",e);e.watch("needsRender",function(c){c&&!a._overlayRenderTaskHandle?a._overlayRenderTaskHandle=l.addFrameTask({render:function(){a.overlay.render()}}):a._overlayRenderTaskHandle&&(a._overlayRenderTaskHandle.remove(),a._overlayRenderTaskHandle=null)});this._forceReadyCycle();this._domHandles.add(t.init(this,"size",function(c){var a=c[1];d.classList.toggle("esri-view-surface--inset-outline",c[0]>=document.body.clientWidth||a>=document.body.clientHeight)}),
"dom-size");this._set("container",c);this._startMeasuring();c=new r({enabled:!0,view:this});this._set("popupManager",c)}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"focused",{get:function(){return document.activeElement===this.surface},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"size",{get:function(){return[this.width,
this.height]},enumerable:!0,configurable:!0});c.prototype.blur=function(){this.surface&&this.surface.blur()};c.prototype.focus=function(){this.surface&&this.surface.focus()};c.prototype.pageToContainer=function(c,a,b){var e=this.position;c-=e[0];a-=e[1];b?(b[0]=c,b[1]=a):b=[c,a];return b};c.prototype.containerToPage=function(c,a,b){var e=this.position;c+=e[0];a+=e[1];b?(b[0]=c,b[1]=a):b=[c,a];return b};c.prototype._handleUIChange=function(c,a){a&&(this._domHandles.remove("ui"),a.destroy());c&&this._wireUI(c);
this._set("ui",c)};c.prototype._wireUI=function(c){this._domHandles.remove("ui");c&&(c.view=this,this._domHandles.add([t.init(this,"root",function(a){c.container=a?f.create("div",null,a):null}),t.init(this,"popup",function(a,b){b&&(c.remove(b,"popup"),b!==a&&b.destroy());a&&(a.view=c.view,c.add(a,{key:"popup",position:"manual"}))})],"ui"))};c.prototype._focusEvent=function(c){this.notifyChange("focused");this.emit("focus",{native:c})};c.prototype._blurEvent=function(c){this.notifyChange("focused");
this.emit("blur",{native:c})};c.prototype._stopMeasuring=function(){this._domHandles.remove("measuring");this._get("resizing")&&this._set("resizing",!1)};c.prototype._startMeasuring=function(){var c=this,a=this._freqInfo;a.freq=16;a.time=750;this._domHandles.add([k(window,"resize",function(){a.freq=16;a.time=750}),l.addFrameTask({prepare:function(a){var b=c._measure(),e=c._freqInfo;e.time+=a.deltaTime;b&&(e.freq=16,c._get("resizing")||c._set("resizing",!0));e.time<e.freq||(e.time=0,c._position()||
b?e.freq=16:e.freq=Math.min(750,2*e.freq),!b&&512<=e.freq&&c._get("resizing")&&c._set("resizing",!1))}})],"measuring");this._measure();this._position()};c.prototype._measure=function(){var c=this.container,a=c?c.clientWidth:0,b=c?c.clientHeight:0;if(0===a||0===b||"hidden"===window.getComputedStyle(c).visibility)return this.suspended||this._set("suspended",!0),!1;var c=this.width,e=this.height;if(a===c&&b===e)return this.suspended&&this._set("suspended",!1),!1;this._set("width",a);this._set("height",
b);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:c,oldHeight:e,width:a,height:b});return!0};c.prototype._position=function(){var c=this.container,a=this.position,b=(c.ownerDocument||window.document).defaultView,c=c.getBoundingClientRect();n[0]=c.left+b.pageXOffset;n[1]=c.top+b.pageYOffset;return a&&n[0]===a[0]&&n[1]===a[1]?!1:(this._set("position",n.slice()),!0)};a([u.property({value:null,cast:function(c){return g.byId(c)}})],c.prototype,"container",null);a([u.property({readOnly:!0,
dependsOn:["surface"]})],c.prototype,"focused",null);a([u.property({readOnly:!0})],c.prototype,"height",void 0);a([u.property({type:q})],c.prototype,"popup",void 0);a([u.property({type:r})],c.prototype,"popupManager",void 0);a([u.property({type:v})],c.prototype,"overlay",void 0);a([u.property({readOnly:!0})],c.prototype,"position",void 0);a([u.property({readOnly:!0})],c.prototype,"resizing",void 0);a([u.property({readOnly:!0})],c.prototype,"root",void 0);a([u.property({value:null,dependsOn:["width",
"height"],readOnly:!0})],c.prototype,"size",null);a([u.property({readOnly:!0})],c.prototype,"surface",void 0);a([u.property({readOnly:!0})],c.prototype,"suspended",void 0);a([u.property()],c.prototype,"ui",void 0);a([u.property({readOnly:!0})],c.prototype,"userContent",void 0);a([u.property({readOnly:!0})],c.prototype,"width",void 0);return c=a([u.subclass("esri.views.DOMContainer")],c)}(u.declared(m,e))})},"esri/views/overlay/ViewOverlay":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators maquette".split(" "),
function(p,h,d,a,g,f,k,m,e){return function(b){function f(){var a=null!==b&&b.apply(this,arguments)||this;a.items=new k;a._callbacks=new Map;a._projector=e.createProjector();a._hiddenProjector=e.createProjector();return a}d(f,b);Object.defineProperty(f.prototype,"needsRender",{get:function(){return 0<this.items.length},enumerable:!0,configurable:!0});f.prototype.initialize=function(){var a=this,b=document.createElement("div");b.className="esri-overlay-surface";g.setSelectable(b,!1);this._set("surface",
b);this._hiddenSurface=document.createElement("div");this._hiddenSurface.setAttribute("style","visibility: hidden;");b.appendChild(this._hiddenSurface);this._itemsChangeHandle=this.items.on("change",function(b){b.added.map(function(b){var e=function(){return b.render()};a._callbacks.set(b,e);a._projector.append(a.surface,e)});b.removed.map(function(b){var e=a._projector.detach(a._callbacks.get(b));a.surface.removeChild(e.domNode);a._callbacks.delete(b)})})};f.prototype.addItem=function(a){this.items.add(a)};
f.prototype.removeItem=function(a){this.items.remove(a)};f.prototype.destroy=function(){this.items.removeAll();this._itemsChangeHandle.remove();this._projector=this._callbacks=null};f.prototype.render=function(){this._projector.renderNow()};f.prototype.computeBoundingRect=function(a){var b=this._hiddenSurface,e=this._hiddenProjector,d=null,f=function(){return d=a.render()};e.append(b,f);e.renderNow();var g={left:0,top:0,right:0,bottom:0};if(d&&d.domNode){var k=d.domNode.getBoundingClientRect();g.left=
k.left;g.top=k.top;g.right=k.right;g.bottom=k.bottom}for(e.detach(f);b.firstChild;)b.removeChild(b.firstChild);return g};f.prototype.overlaps=function(a,b){a=this.computeBoundingRect(a);b=this.computeBoundingRect(b);return Math.max(a.left,b.left)<=Math.min(a.right,b.right)&&Math.max(a.top,b.top)<=Math.min(a.bottom,b.bottom)};a([m.property({readOnly:!0})],f.prototype,"surface",void 0);a([m.property({readOnly:!0})],f.prototype,"items",void 0);a([m.property({readOnly:!0,dependsOn:["items.length"]})],
f.prototype,"needsRender",null);return f=a([m.subclass("esri.views.overlay.ViewOverlay")],f)}(m.declared(f))})},"maquette/dist/maquette.umd":function(){(function(p,h){"object"===typeof exports&&"undefined"!==typeof module?h(exports):"function"===typeof define&&define.amd?define(["exports"],h):h(p.maquette={})})(this,function(p){var h=[],d=function(c,a){var b={};Object.keys(c).forEach(function(a){b[a]=c[a]});a&&Object.keys(a).forEach(function(c){b[c]=a[c]});return b},a=function(c,a){return c.vnodeSelector!==
a.vnodeSelector?!1:c.properties&&a.properties?c.properties.key!==a.properties.key?!1:c.properties.bind===a.properties.bind:!c.properties&&!a.properties},g=function(c){if("string"!==typeof c)throw Error("Style values must be strings");},f=function(c,b,e,d){var f=c[b];if(""!==f.vnodeSelector){var g=f.properties;if(!(g&&(void 0===g.key?g.bind:g.key)))for(g=0;g<c.length;g++)if(g!==b&&a(c[g],f))throw Error(e.vnodeSelector+" had a "+f.vnodeSelector+" child "+("added"===d?d:"removed")+", but there is now more than one. You must add unique key properties to make them distinguishable.");
}},k=[],m=!1,e=function(c){(c.children||[]).forEach(e);c.properties&&c.properties.afterRemoved&&c.properties.afterRemoved.apply(c.properties.bind||c.properties,[c.domNode])},b=function(){m=!1;k.forEach(e);k.length=0},l=function(c){k.push(c);m||(m=!0,"undefined"!==typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(b,{timeout:16}):setTimeout(b,16))},t=function(c){var a=c.domNode;if(c.properties){var b=c.properties.exitAnimation;if(b){a.style.pointerEvents="none";b(a,function(){a.parentNode&&
(a.parentNode.removeChild(a),l(c))},c.properties);return}}a.parentNode&&(a.parentNode.removeChild(a),l(c))},u=function(c,a,b){if(a)for(var e=b.eventHandlerInterceptor,d=Object.keys(a),f=d.length,n=function(f){f=d[f];var n=a[f];if("className"===f)throw Error('Property "className" is not supported, use "class".');if("class"===f)n.split(/\s+/).forEach(function(a){return c.classList.add(a)});else if("classes"===f){var k=Object.keys(n),l=k.length;for(f=0;f<l;f++){var x=k[f];n[x]&&c.classList.add(x)}}else if("styles"===
f)for(k=Object.keys(n),l=k.length,f=0;f<l;f++){var x=k[f],q=n[x];q&&(g(q),b.styleApplyer(c,x,q))}else"key"!==f&&null!==n&&void 0!==n&&(k=typeof n,"function"===k?0===f.lastIndexOf("on",0)&&(e&&(n=e(f,n,c,a)),"oninput"===f&&function(){var c=n;n=function(a){c.apply(this,[a]);a.target["oninput-value"]=a.target.value}}(),c[f]=n):"string"===k&&"value"!==f&&"innerHTML"!==f?"http://www.w3.org/2000/svg"===b.namespace&&"href"===f?c.setAttributeNS("http://www.w3.org/1999/xlink",f,n):c.setAttribute(f,n):c[f]=
n)},k=0;k<f;k++)n(k)},r=function(c,a,b){var e=a.children;if(e)for(var d=0;d<e.length;d++)v(e[d],c,void 0,b);a.text&&(c.textContent=a.text);u(c,a.properties,b);a.properties&&a.properties.afterCreate&&a.properties.afterCreate.apply(a.properties.bind||a.properties,[c,b,a.vnodeSelector,a.properties,a.children])},v=function(c,a,b,e){var f,g=0,n=c.vnodeSelector,k=a.ownerDocument;if(""===n)f=c.domNode=k.createTextNode(c.text),void 0!==b?a.insertBefore(f,b):a.appendChild(f);else{for(var l=0;l<=n.length;++l){var x=
n.charAt(l);if(l===n.length||"."===x||"#"===x)x=n.charAt(g-1),g=n.slice(g,l),"."===x?f.classList.add(g):"#"===x?f.id=g:("svg"===g&&(e=d(e,{namespace:"http://www.w3.org/2000/svg"})),void 0!==e.namespace?f=c.domNode=k.createElementNS(e.namespace,g):(f=c.domNode=c.domNode||k.createElement(g),"input"===g&&c.properties&&void 0!==c.properties.type&&f.setAttribute("type",c.properties.type)),void 0!==b?a.insertBefore(f,b):f.parentNode!==a&&a.appendChild(f)),g=l+1}r(f,c,e)}},q,n=function(c,a,b){a&&a.split(" ").forEach(function(a){return c.classList.toggle(a,
b)})};q=function(c,b,e){var k=c.domNode;if(c===b)return!1;var l=!1;if(""===b.vnodeSelector){if(b.text!==c.text)return c=k.ownerDocument.createTextNode(b.text),k.parentNode.replaceChild(c,k),b.domNode=c,!0;b.domNode=k}else{0===b.vnodeSelector.lastIndexOf("svg",0)&&(e=d(e,{namespace:"http://www.w3.org/2000/svg"}));c.text!==b.text&&(l=!0,void 0===b.text?k.removeChild(k.firstChild):k.textContent=b.text);b.domNode=k;var x;x=c.children;var m=b.children,r=e;if(x===m)x=!1;else{x=x||h;for(var m=m||h,u=x.length,
z=m.length,w=0,A=0,y=!1;A<z;){var E=w<u?x[w]:void 0,C=m[A];if(void 0!==E&&a(E,C))y=q(E,C,r)||y,w++;else{b:{var E=x,B=C;if(""!==B.vnodeSelector)for(var p=w+1;p<E.length;p++)if(a(E[p],B)){E=p;break b}E=-1}if(0<=E){for(;w<E;w++)t(x[w]),f(x,w,b,"removed");y=q(x[E],C,r)||y;w=E+1}else v(C,k,w<u?x[w].domNode:void 0,r),C.properties&&(E=C.properties.enterAnimation)&&E(C.domNode,C.properties),f(m,A,b,"added")}A++}if(u>w)for(;w<u;w++)t(x[w]),f(x,w,b,"removed");x=y}l=x||l;x=c.properties;m=b.properties;r=e;if(m){u=
!1;z=Object.keys(m);A=z.length;for(y=0;y<A;y++)if(E=z[y],C=m[E],w=x[E],"class"===E)w!==C&&(n(k,w,!1),n(k,C,!0));else if("classes"===E)for(var B=k.classList,p=Object.keys(C),G=p.length,E=0;E<G;E++){var Q=p[E],T=!!C[Q];T!==!!w[Q]&&(u=!0,T?B.add(Q):B.remove(Q))}else if("styles"===E)for(B=Object.keys(C),p=B.length,E=0;E<p;E++)G=B[E],Q=C[G],Q!==w[G]&&(u=!0,Q?(g(Q),r.styleApplyer(k,G,Q)):r.styleApplyer(k,G,""));else C||"string"!==typeof w||(C=""),"value"===E?(B=k[E],B!==C&&(k["oninput-value"]?B===k["oninput-value"]:
C!==w)&&(k[E]=C,k["oninput-value"]=void 0),C!==w&&(u=!0)):C!==w&&(w=typeof C,"function"===w&&r.eventHandlerInterceptor||("string"===w&&"innerHTML"!==E?"http://www.w3.org/2000/svg"===r.namespace&&"href"===E?k.setAttributeNS("http://www.w3.org/1999/xlink",E,C):"role"===E&&""===C?k.removeAttribute(E):k.setAttribute(E,C):k[E]!==C&&(k[E]=C),u=!0));x=u}else x=void 0;l=x||l;b.properties&&b.properties.afterUpdate&&b.properties.afterUpdate.apply(b.properties.bind||b.properties,[k,e,b.vnodeSelector,b.properties,
b.children])}l&&b.properties&&b.properties.updateAnimation&&b.properties.updateAnimation(k,b.properties,c.properties);return!1};var w=function(c,a){return{getLastRender:function(){return c},update:function(b){if(c.vnodeSelector!==b.vnodeSelector)throw Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");var e=c;c=b;q(e,b,a)},domNode:c.domNode}},c={namespace:void 0,performanceLogger:function(){},eventHandlerInterceptor:void 0,
styleApplyer:function(c,a,b){c.style[a]=b}},x={create:function(a,b){b=d(c,b);v(a,document.createElement("div"),void 0,b);return w(a,b)},append:function(a,b,e){e=d(c,e);v(b,a,void 0,e);return w(b,e)},insertBefore:function(a,b,e){e=d(c,e);v(b,a.parentNode,a,e);return w(b,e)},merge:function(a,b,e){e=d(c,e);b.domNode=a;r(a,b,e);return w(b,e)},replace:function(a,b,e){e=d(c,e);v(b,a.parentNode,a,e);a.parentNode.removeChild(a);return w(b,e)}},z=function(c,a,b){for(var e=0,d=a.length;e<d;e++){var f=a[e];
Array.isArray(f)?z(c,f,b):null!==f&&void 0!==f&&!1!==f&&("string"===typeof f&&(f={vnodeSelector:"",properties:void 0,children:void 0,text:f.toString(),domNode:null}),b.push(f))}},A;A=Array.prototype.find?function(c,a){return c.find(a)}:function(c,a){return c.filter(a)[0]};var y=function(c,a){var b=c;a.forEach(function(c){b=b&&b.children?A(b.children,function(a){return a.domNode===c}):void 0});return b},B=function(c,a,b){var e=function(e){b("domEvent",e);var d=a(),f;f=e.currentTarget;for(var g=d.domNode,
n=[];f!==g;)n.push(f),f=f.parentNode;f=n;f.reverse();d=y(d.getLastRender(),f);c.scheduleRender();var k;d&&(k=d.properties["on"+e.type].apply(d.properties.bind||this,arguments));b("domEventProcessed",e);return k};return function(c,a,b,d){return e}};p.dom=x;p.h=function(c,a,b){if(Array.isArray(a))b=a,a=void 0;else if(a&&("string"===typeof a||a.hasOwnProperty("vnodeSelector"))||b&&("string"===typeof b||b.hasOwnProperty("vnodeSelector")))throw Error("h called with invalid arguments");var e,d;void 0!==
b&&1===b.length&&"string"===typeof b[0]?e=b[0]:b&&(d=[],z(c,b,d),0===d.length&&(d=void 0));return{vnodeSelector:c,properties:a,children:d,text:""===e?void 0:e,domNode:null}};p.createProjector=function(a){var b,e=d(c,a),f=e.performanceLogger,g=!0,n,k=!1,l=[],m=[],q=function(c,a,d){var g;e.eventHandlerInterceptor=B(b,function(){return g},f);g=c(a,d(),e);l.push(g);m.push(d)},r=function(){n=void 0;if(g){g=!1;f("renderStart",void 0);for(var c=0;c<l.length;c++){var a=m[c]();f("rendered",void 0);l[c].update(a);
f("patched",void 0)}f("renderDone",void 0);g=!0}};return b={renderNow:r,scheduleRender:function(){n||k||(n=requestAnimationFrame(r))},stop:function(){n&&(cancelAnimationFrame(n),n=void 0);k=!0},resume:function(){k=!1;g=!0;b.scheduleRender()},append:function(c,a){q(x.append,c,a)},insertBefore:function(c,a){q(x.insertBefore,c,a)},merge:function(c,a){q(x.merge,c,a)},replace:function(c,a){q(x.replace,c,a)},detach:function(c){for(var a=0;a<m.length;a++)if(m[a]===c)return m.splice(a,1),l.splice(a,1)[0];
throw Error("renderFunction was not found");}}};p.createCache=function(){var c,a;return{invalidate:function(){c=a=void 0},result:function(b,e){if(c)for(var d=0;d<b.length;d++)c[d]!==b[d]&&(a=void 0);a||(a=e(),c=b);return a}}};p.createMapping=function(c,a,b){var e=[],d=[];return{results:d,map:function(f){for(var g=f.map(c),n=d.slice(),k=0,l=0;l<f.length;l++){var x=f[l],m=g[l];if(m===e[k])d[l]=n[k],b(x,n[k],l),k++;else{for(var q=!1,r=1;r<e.length+1;r++){var v=(k+r)%e.length;if(e[v]===m){d[l]=n[v];b(f[l],
n[v],l);k=v+1;q=!0;break}}q||(d[l]=a(x,l))}}d.length=f.length;e=g}}};Object.defineProperty(p,"__esModule",{value:!0})})},"esri/widgets/Popup":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/dom-geometry dojo/i18n!./Popup/nls/Popup dojo/keys ../core/Handles ../core/lang ../core/Logger ../core/watchUtils ../core/accessorSupport/decorators ./Feature ./Spinner ./Widget ./Popup/PopupViewModel ../widgets/support/widgetUtils ./support/widget".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c){function x(c,a){return void 0===a?"esri-popup__"+c:"esri-popup__"+c+"-"+a}var z=p.toUrl("./Popup/images/default-action.svg"),A={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},y=l.getLogger("esri.widgets.Popup");return function(l){function q(c){c=l.call(this)||this;c._blurContainer=!1;c._containerNode=null;c._mainContainerNode=null;c._featureMenuNode=null;c._focusContainer=!1;c._focusDockButton=!1;c._focusFeatureMenuButton=!1;c._focusFirstFeature=
!1;c._handles=new e;c._displayActionTextLimit=2;c._pointerOffsetInPx=16;c._spinner=null;c.actions=null;c.alignment="auto";c.autoCloseEnabled=null;c.content=null;c.collapsed=!1;c.collapseEnabled=!0;c.dockEnabled=!1;c.featureCount=null;c.features=null;c.featureNavigationEnabled=!0;c.highlightEnabled=null;c.location=null;c.featureWidgets=[];c.promises=null;c.selectedFeature=null;c.selectedFeatureIndex=null;c.selectedFeatureWidget=null;c.spinnerEnabled=!0;c.title=null;c.updateLocationEnabled=null;c.view=
null;c.viewModel=new n;c.visible=null;return c}d(q,l);q.prototype.postInitialize=function(){var c=this;this._addSelectedFeatureIndexHandle();this.own(t.watch(this,"viewModel.screenLocation",function(){return c._positionContainer()}),t.watch(this,["viewModel.visible","dockEnabled"],function(){return c._toggleScreenLocationEnabled()}),t.watch(this,"viewModel.screenLocation",function(a,b){!!a!==!!b&&c.reposition()}),t.watch(this,"viewModel.features",function(a){return c._createFeatureWidgets(a)}),t.watch(this,
"viewModel.view.padding viewModel.view.size viewModel.visible viewModel.waitingForResult viewModel.location alignment".split(" "),function(){return c.reposition()}),t.watch(this,"spinnerEnabled",function(a){return c._spinnerEnabledChange(a)}),t.watch(this,"viewModel.view.size",function(a,b){return c._updateDockEnabledForViewSize(a,b)}),t.watch(this,"viewModel.view",function(a,b){return c._viewChange(a,b)}),t.watch(this,"viewModel.view.ready",function(a,b){return c._viewReadyChange(a,b)}),t.watch(this,
["viewModel.waitingForResult","viewModel.location"],function(){return c._displaySpinner()}),t.watch(this,["featureWidgets","viewModel.selectedFeatureIndex"],function(){return c._updateFeatureWidget()}),t.watch(this,"selectedFeatureWidget.viewModel.title",function(a){return c._setTitleFromFeatureWidget(a)}),t.watch(this,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],function(){return c._setContentFromFeatureWidget()}),t.on(this,"viewModel","trigger-action",
function(a){return c._zoomToAction(a)}))};q.prototype.destroy=function(){this._destroyFeatureWidgets();this._destroySpinner();this._handles&&this._handles.destroy();this._handles=null};Object.defineProperty(q.prototype,"currentAlignment",{get:function(){return this._getCurrentAlignment()},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"currentDockPosition",{get:function(){return this._getCurrentDockPosition()},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"dockOptions",
{get:function(){return this._get("dockOptions")||A},set:function(c){var a=g({},A),b=this.get("viewModel.view.breakpoints"),e={};b&&(e.width=b.xsmall,e.height=b.xsmall);c=g({},a,c);a=g({},a.breakpoint,e);e=c.breakpoint;!0===e?c.breakpoint=a:"object"===typeof e&&(c.breakpoint=g({},a,e));this._set("dockOptions",c);this._setCurrentDockPosition();this.reposition()},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"featureMenuOpen",{get:function(){return this.viewModel.visible?this._get("featureMenuOpen"):
!1},set:function(c){this._set("featureMenuOpen",!!c)},enumerable:!0,configurable:!0});q.prototype.blur=function(){this.visible||y.warn("Popup cannot be blurred while visible is false");this._blurContainer=!0;this.scheduleRender()};q.prototype.clear=function(){};q.prototype.close=function(){this.visible=!1};q.prototype.focus=function(){this.visible||y.warn("Popup cannot be focused while visible is false");this._focusContainer=!0;this.scheduleRender()};q.prototype.next=function(){return null};q.prototype.open=
function(c){this._handles.remove("selected-index");this.set({featureMenuOpen:c?!!c.featureMenuOpen:!1});this.viewModel.open(c);this._addSelectedFeatureIndexHandle()};q.prototype.previous=function(){return null};q.prototype.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};q.prototype.triggerAction=function(c){return null};q.prototype.render=function(){var a=this.collapsed,e=this.collapseEnabled,d=this.dockEnabled,f=this.actions,g=this.featureMenuOpen,n=
this.featureNavigationEnabled,l=this.featureWidgets,q=this.visible,m=this.viewModel,r=m.content,v=m.featureCount,t=m.pendingPromisesCount,u=m.selectedFeatureIndex,h=m.title,m=1<v&&n,n=1<v&&g,z=e&&!n&&a,a=f&&f.length,A=m&&this._getPageText(v,u),y=this._renderContent(),B=w.isRtl(),E=this.get("selectedFeatureWidget")?this.get("selectedFeatureWidget.viewModel.waitingForContent")||this.get("selectedFeatureWidget.viewModel.content"):y,p=d?k.undock:k.dock,v=this.currentAlignment,f=this.currentDockPosition,
t=t?c.tsx("div",{key:x("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":k.loading,title:k.loading},c.tsx("span",{"aria-hidden":"true",class:c.join("esri-popup__icon","esri-icon-loading-indicator","esri-rotating")})):null,U=(aa={},aa["esri-icon-layer-list"]=!n,aa["esri-icon-close"]=n,aa),aa=c.tsx("span",{"aria-hidden":"true",class:"esri-popup__icon",classes:U}),U=(X={},X["esri-icon-right-triangle-arrow"]=B,X["esri-popup__pagination-previous-icon--rtl"]=B,
X["esri-icon-left-triangle-arrow"]=!B,X["esri-popup__pagination-previous-icon"]=!B,X),X=c.tsx("span",{"aria-hidden":"true",class:"esri-popup__icon",classes:U}),U=c.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:c.join("esri-popup__button","esri-popup__pagination-previous"),"aria-label":k.previous,title:k.previous},X),X=(ba={},ba["esri-icon-left-triangle-arrow"]=B,ba["esri-popup__pagination-next-icon--rtl"]=B,ba["esri-icon-right-triangle-arrow"]=
!B,ba["esri-popup__pagination-next-icon"]=!B,ba),ba=c.tsx("span",{"aria-hidden":"true",class:"esri-popup__icon",classes:X}),B=c.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:c.join("esri-popup__button","esri-popup__pagination-next"),"aria-label":k.next,title:k.next},ba),X=w.cssTransition("enter","esri-popup--feature-updated"),ba=this.id+"-feature-menu",g=c.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,
afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:c.join("esri-popup__button","esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":ba,"aria-expanded":g,"aria-label":k.menu,title:k.menu},aa),A=c.tsx("div",{class:"esri-popup__pagination-page-text"},A),g=m?c.tsx("div",{class:"esri-popup__navigation-buttons",enterAnimation:X},U,A,B,t||g):null,A=this._wouldDockTo(),A=(ea={},ea["esri-icon-minimize"]=d,ea["esri-popup__icon--dock-icon"]=!d,
ea["esri-icon-dock-right"]=!d&&("top-right"===A||"bottom-right"===A),ea["esri-icon-dock-left"]=!d&&("top-left"===A||"bottom-left"===A),ea["esri-icon-maximize"]=!d&&"top-center"===A,ea["esri-icon-dock-bottom"]=!d&&"bottom-center"===A,ea),ea=c.tsx("span",{"aria-hidden":"true",classes:A,class:"esri-popup__icon"}),ea=this.get("dockOptions.buttonEnabled")?c.tsx("div",{role:"button","aria-label":p,title:p,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,
afterUpdate:this._focusDockButtonNode,class:c.join("esri-popup__button","esri-popup__button--dock")},ea):null,e=e&&h&&(E||a||m),p=(W={},W["esri-popup__header-title--button"]=e,W),A=e?z?k.expand:k.collapse:"",W=this.id+"-popup-title",h=h?c.tsx("h2",{class:"esri-popup__header-title",key:h,enterAnimation:X,id:W,role:e?"button":"heading","aria-label":A,title:A,classes:p,bind:this,tabIndex:e?0:-1,onclick:this._toggleCollapsed,onkeydown:this._toggleCollapsed,innerHTML:h}):null,e=c.tsx("span",{"aria-hidden":"true",
class:c.join("esri-popup__icon","esri-icon-close")}),e=c.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:"esri-popup__button","aria-label":k.close,title:k.close},e),e=c.tsx("header",{class:"esri-popup__header"},h,c.tsx("div",{class:"esri-popup__header-buttons"},ea,e)),ea=this.id+"-popup-content",r=E&&!z?c.tsx("article",{key:r,enterAnimation:X,id:ea,class:"esri-popup__content"},y):null,y=!z&&("bottom-left"===v||"bottom-center"===v||"bottom-right"===v||
"top-left"===f||"top-center"===f||"top-right"===f),z=!z&&("top-left"===v||"top-center"===v||"top-right"===v||"bottom-left"===f||"bottom-center"===f||"bottom-right"===f),E=n?null:c.tsx("div",{key:x("actions"),class:"esri-popup__actions"},this._renderActions()),p=c.tsx("section",{key:x("navigation"),class:"esri-popup__navigation"},g),m=m||a?c.tsx("div",{key:x("feature-buttons"),class:"esri-popup__feature-buttons"},E,p):null,u=this._renderFeatureMenuNode(l,u,n,ba),l=b.substitute({total:l.length},k.selectedFeatures),
ba=c.tsx("section",{key:x("menu"),class:"esri-popup__feature-menu"},c.tsx("h2",{class:"esri-popup__feature-menu-header"},l),c.tsx("nav",{class:"esri-popup__feature-menu-viewport",afterCreate:this._featureMenuViewportNodeUpdated,afterUpdate:this._featureMenuViewportNodeUpdated},u)),l=d?null:c.tsx("div",{key:x("pointer"),class:"esri-popup__pointer",role:"presentation"},c.tsx("div",{class:c.join("esri-popup__pointer-direction","esri-popup--shadow")})),u=this.get("selectedFeature.layer.title"),a=this.get("selectedFeature.layer.id"),
E=(ka={},ka["esri-popup--shadow"]=d,ka),d=(ca={},ca["esri-popup--aligned-top-center"]=q&&"top-center"===v,ca["esri-popup--aligned-bottom-center"]=q&&"bottom-center"===v,ca["esri-popup--aligned-top-left"]=q&&"top-left"===v,ca["esri-popup--aligned-bottom-left"]=q&&"bottom-left"===v,ca["esri-popup--aligned-top-right"]=q&&"top-right"===v,ca["esri-popup--aligned-bottom-right"]="bottom-right"===v,ca["esri-popup--is-docked"]=q&&d,ca["esri-popup--shadow"]=q&&!d,ca["esri-popup--is-docked-top-left"]=q&&"top-left"===
f,ca["esri-popup--is-docked-top-center"]=q&&"top-center"===f,ca["esri-popup--is-docked-top-right"]=q&&"top-right"===f,ca["esri-popup--is-docked-bottom-left"]=q&&"bottom-left"===f,ca["esri-popup--is-docked-bottom-center"]=q&&"bottom-center"===f,ca["esri-popup--is-docked-bottom-right"]=q&&"bottom-right"===f,ca["esri-popup--feature-menu-open"]=q&&n,ca),ca=y?ba:null,ka=z?ba:null,n=y?m:null,v=z?m:null,ca=c.tsx("div",{class:c.join("esri-popup__main-container","esri-widget"),classes:E,tabIndex:-1,role:"dialog",
"aria-labelledby":h?W:"","aria-describedby":r?ea:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},n,ca,e,r,v,ka);return c.tsx("div",{key:x("base"),class:"esri-popup",role:"presentation",classes:d,"data-layer-title":u,"data-layer-id":a,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},q?[ca,l]:null);var aa,X,ba,ea,W,ka,ca};q.prototype._featureMenuOpenChanged=function(c){c?this._focusFirstFeature=
!0:this._focusFeatureMenuButton=!0};q.prototype._setTitleFromFeatureWidget=function(c){this.selectedFeatureWidget&&(this.viewModel.title=c||"")};q.prototype._setContentFromFeatureWidget=function(){var c=this.selectedFeatureWidget;c&&(this.viewModel.content=c)};q.prototype._handleFeatureMenuKeyup=function(c){c.keyCode===m.ESCAPE&&(c.stopPropagation(),this.featureMenuOpen=!1)};q.prototype._handleFeatureMenuItemKeyup=function(c){var a=c.keyCode,b=this._featureMenuNode,e=this.get("features.length"),d=
c.currentTarget["data-feature-index"];b&&(b=b.querySelectorAll("li"),a===m.UP_ARROW?(c.stopPropagation(),b[(d-1+e)%e].focus()):a===m.DOWN_ARROW?(c.stopPropagation(),b[(d+1+e)%e].focus()):a===m.HOME?(c.stopPropagation(),b[0].focus()):a===m.END&&(c.stopPropagation(),b[b.length-1].focus()))};q.prototype._handleMainKeyup=function(c){var a=c.keyCode;a===m.LEFT_ARROW&&(c.stopPropagation(),this.previous());a===m.RIGHT_ARROW&&(c.stopPropagation(),this.next())};q.prototype._zoomToAction=function(c){c.action&&
"zoom-to"===c.action.id&&this.viewModel.zoomToLocation()};q.prototype._spinnerEnabledChange=function(c){this._destroySpinner();c&&(c=this.get("viewModel.view"),this._createSpinner(c))};q.prototype._displaySpinner=function(){var c=this._spinner;if(c){var a=this.viewModel,b=a.location;a.waitingForResult?c.show({location:b}):c.hide()}};q.prototype._getIconStyles=function(c){return{"background-image":c?"url("+c+")":""}};q.prototype._renderAction=function(a,e,d,f){var g=this,n=t.watch(a,["id","className",
"title","image","visible"],function(){return g.scheduleRender()});this._handles.add(n,f);n=this.get("selectedFeature.attributes");"zoom-to"===a.id&&(a.title=k.zoom,this._handles.add(t.init(this,"view.animation.state",function(b){a.className="waiting-for-target"===b?c.join("esri-popup__icon","esri-icon-loading-indicator","esri-rotating"):c.join("esri-popup__icon","esri-icon-zoom-in-magnifying-glass")}),f));f=a.title;var l=a.className,q=a.image||l?a.image:z;f=f&&n?b.substitute(n,f):f;l=l&&n?b.substitute(n,
l):l;n=q&&n?b.substitute(n,q):q;q=l||"esri-popup__icon";l=(m={},m["esri-popup__action-image"]=!!n,m);m=(r={},r["esri-disabled"]=-1!==q.indexOf("esri-icon-loading-indicator"),r);d=d<=this._displayActionTextLimit?c.tsx("span",{key:x("action-text-"+e+"-"+a.uid),class:"esri-popup__action-text"},f):null;return a.visible?c.tsx("div",{key:x("action-"+e+"-"+a.uid),role:"button",tabIndex:0,title:f,"aria-label":f,classes:m,class:c.join("esri-popup__button","esri-popup__action"),bind:this,"data-action-index":e,
onclick:this._triggerAction,onkeydown:this._triggerAction},c.tsx("span",{key:x("action-icon-"+e+"-"+a.uid+"-"+q),"aria-hidden":"true",class:q,classes:l,styles:this._getIconStyles(n)}),d):null;var m,r};q.prototype._renderActions=function(){var c=this;this._handles.remove("actions");var a=this.actions;if(a){var b=a.length;return a.toArray().map(function(a,e){return c._renderAction(a,e,b,"actions")})}};q.prototype._addSelectedFeatureIndexHandle=function(){var c=this,a=t.watch(this,"viewModel.selectedFeatureIndex",
function(a,b){return c._selectedFeatureIndexUpdated(a,b)});this._handles.add(a,"selected-index")};q.prototype._selectedFeatureIndexUpdated=function(c,a){var b=this.featureMenuOpen;this.featureCount&&b&&c!==a&&-1!==c&&(this.featureMenuOpen=!1)};q.prototype._updateFeatureWidget=function(){var c=this.featureWidgets[this.viewModel.selectedFeatureIndex]||null;c&&!c.contentEnabled&&(c.contentEnabled=!0);this._set("selectedFeatureWidget",c)};q.prototype._destroyFeatureWidgets=function(){this.featureWidgets.forEach(function(c){return c.destroy()});
this._set("featureWidgets",[])};q.prototype._createFeatureWidgets=function(c){var a=this.featureWidgets.slice(0),b=this.get("viewModel.view"),e=[];c.forEach(function(c,d){if(c){var f=null;a.some(function(b,e){b&&b.graphic===c&&(f=b,a.splice(e,1));return!!f});e[d]=f||new r({contentEnabled:!1,graphic:c,view:b})}});a.forEach(function(c){return c&&c.destroy()});this._set("featureWidgets",e)};q.prototype._isScreenLocationWithinView=function(c,a){return-1<c.x&&-1<c.y&&c.x<=a.width&&c.y<=a.height};q.prototype._isOutsideView=
function(c){var a=c.popupHeight,b=c.popupWidth,e=c.screenLocation,d=c.side;c=c.view;if(isNaN(b)||isNaN(a)||!c||!e)return!1;var f=c.padding;return"right"===d&&e.x+b/2>c.width-f.right||"left"===d&&e.x-b/2<f.left||"top"===d&&e.y-a<f.top||"bottom"===d&&e.y+a>c.height-f.bottom?!0:!1};q.prototype._determineCurrentAlignment=function(){var c=this._pointerOffsetInPx,a=this._containerNode,b=this._mainContainerNode,e=this.viewModel,d=e.screenLocation,e=e.view;if(!d||!e||!a)return"top-center";if(!this._isScreenLocationWithinView(d,
e))return this._get("currentAlignment")||"top-center";var g=b?window.getComputedStyle(b,null):null,b=g?parseInt(g.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,g=g?parseInt(g.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0,n=f.getContentBox(a),a=n.w+c,n=Math.max(n.h,b,g)+c,c=this._isOutsideView({popupHeight:n,popupWidth:a,screenLocation:d,side:"right",view:e}),b=this._isOutsideView({popupHeight:n,popupWidth:a,screenLocation:d,side:"left",view:e}),g=this._isOutsideView({popupHeight:n,
popupWidth:a,screenLocation:d,side:"top",view:e}),d=this._isOutsideView({popupHeight:n,popupWidth:a,screenLocation:d,side:"bottom",view:e});return b?g?"bottom-right":"top-right":c?g?"bottom-left":"top-left":g?d?"top-center":"bottom-center":"top-center"};q.prototype._getCurrentAlignment=function(){var c=this.alignment;return this.dockEnabled?null:"auto"===c?this._determineCurrentAlignment():"function"===typeof c?c.call(this):c};q.prototype._setCurrentAlignment=function(){this._set("currentAlignment",
this._getCurrentAlignment())};q.prototype._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())};q.prototype._getDockPosition=function(){var c=this.get("dockOptions.position");return"auto"===c?this._determineCurrentDockPosition():"function"===typeof c?c.call(this):c};q.prototype._getCurrentDockPosition=function(){return this.dockEnabled?this._getDockPosition():null};q.prototype._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};
q.prototype._renderFeatureMenuItemNode=function(a,b,e,d){var f=b===e;d=(g={},g["esri-popup__feature-menu-item--selected"]=f,g);g=f?c.tsx("span",{key:x("feature-menu-selected-feature-"+e),title:k.selectedFeature,"aria-label":k.selectedFeature,class:"esri-icon-check-mark"}):null;a=c.tsx("span",{innerHTML:a.title||k.untitled});return c.tsx("li",{role:"menuitem",tabIndex:-1,key:x("feature-menu-feature-"+e),classes:d,class:"esri-popup__feature-menu-item",bind:this,"data-feature-index":b,onkeyup:this._handleFeatureMenuItemKeyup,
onclick:this._selectFeature,onkeydown:this._selectFeature},c.tsx("span",{class:"esri-popup__feature-menu-title"},a,g));var g};q.prototype._renderFeatureMenuNode=function(a,b,e,d){var f=this;return 1<a.length?c.tsx("ol",{class:"esri-popup__feature-menu-list",id:d,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},a.map(function(c,a){return f._renderFeatureMenuItemNode(c,a,b,e)})):null};q.prototype._determineCurrentDockPosition=
function(){var c=this.get("viewModel.view"),a=w.isRtl()?"top-left":"top-right";if(!c)return a;var b=c.padding||{left:0,right:0,top:0,bottom:0},b=c.width-b.left-b.right;return(c=c.get("breakpoints"))&&b<=c.xsmall?"bottom-center":a};q.prototype._renderContent=function(){var a=this.get("viewModel.content");if("string"===typeof a)return c.tsx("div",{key:a,innerHTML:a});if(c.isWidget(a))return c.tsx("div",{key:a},a.render());if(a instanceof HTMLElement)return c.tsx("div",{key:a,bind:a,afterCreate:this._attachToNode});
if(c.isWidgetBase(a))return c.tsx("div",{key:a,bind:a.domNode,afterCreate:this._attachToNode})};q.prototype._attachToNode=function(c){c.appendChild(this)};q.prototype._positionContainer=function(c){void 0===c&&(c=this._containerNode);c&&(this._containerNode=c);if(c){var a=this.viewModel.screenLocation,b=f.getContentBox(c);if(a=this._calculatePositionStyle(a,b))c.style.top=a.top,c.style.left=a.left,c.style.bottom=a.bottom,c.style.right=a.right}};q.prototype._calculateFullWidth=function(c){var a=this.currentAlignment,
b=this._pointerOffsetInPx;return"top-left"===a||"bottom-left"===a||"top-right"===a||"bottom-right"===a?c+b:c};q.prototype._calculateAlignmentPosition=function(c,a,b,e){var d=this.currentAlignment,f=this._pointerOffsetInPx;e/=2;var g=b.height-a;b=b.width-c;var n=this.view.padding;if("bottom-center"===d)return{top:a+f-n.top,left:c-e-n.left};if("top-left"===d)return{bottom:g+f-n.bottom,right:b+f-n.right};if("bottom-left"===d)return{top:a+f-n.top,right:b+f-n.right};if("top-right"===d)return{bottom:g+
f-n.bottom,left:c+f-n.left};if("bottom-right"===d)return{top:a+f-n.top,left:c+f-n.left};if("top-center"===d)return{bottom:g+f-n.bottom,left:c-e-n.left}};q.prototype._calculatePositionStyle=function(c,a){var b=this.view;if(b){if(this.dockEnabled)return{left:"",top:"",right:"",bottom:""};if(c&&a&&(a=this._calculateFullWidth(a.w),c=this._calculateAlignmentPosition(c.x,c.y,b,a)))return{top:void 0!==c.top?c.top+"px":"auto",left:void 0!==c.left?c.left+"px":"auto",bottom:void 0!==c.bottom?c.bottom+"px":
"auto",right:void 0!==c.right?c.right+"px":"auto"}}};q.prototype._viewChange=function(c,a){c&&a&&(this.close(),this.clear())};q.prototype._viewReadyChange=function(c,a){c?(c=this.get("viewModel.view"),this._wireUpView(c)):a&&(this.close(),this.clear())};q.prototype._wireUpView=function(c){this._destroySpinner();c&&(this.spinnerEnabled&&this._createSpinner(c),this._setDockEnabledForViewSize(this.dockOptions))};q.prototype._dockingThresholdCrossed=function(c,a,b){var e=c[0];c=c[1];var d=a[0];a=a[1];
var f=b.width;b=b.height;return e<=f&&d>f||e>f&&d<=f||c<=b&&a>b||c>b&&a<=b};q.prototype._updateDockEnabledForViewSize=function(c,a){if(c&&a){var b=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},e=b.left+b.right,d=b.top+b.bottom,b=[],f=[];b[0]=c[0]-e;b[1]=c[1]-d;f[0]=a[0]-e;f[1]=a[1]-d;c=this.dockOptions;this._dockingThresholdCrossed(b,f,c.breakpoint)&&this._setDockEnabledForViewSize(c);this._setCurrentDockPosition()}};q.prototype._focusDockButtonNode=function(c){this._focusDockButton&&
(this._focusDockButton=!1,c.focus())};q.prototype._mainContainerNodeUpdated=function(c){this._mainContainerNode=c;this._focusContainer?(this._focusContainer=!1,c.focus()):this._blurContainer&&(this._blurContainer=!1,c.blur())};q.prototype._featureMenuNodeUpdated=function(c){(this._featureMenuNode=c)&&this._focusFirstFeature&&(this._focusFirstFeature=!1,c=c.querySelectorAll("li"),c.length&&c[0].focus())};q.prototype._focusFeatureMenuButtonNode=function(c){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=
!1,c.focus())};q.prototype._featureMenuViewportNodeUpdated=function(c){c&&(c.scrollTop=0)};q.prototype._toggleScreenLocationEnabled=function(){var c=this.dockEnabled,a=this.viewModel;a&&(a.screenLocationEnabled=this.visible&&!c)};q.prototype._shouldDockAtCurrentViewSize=function(c){c=c.breakpoint;var a=this.get("viewModel.view.ui"),b=a.width,a=a.height;if(isNaN(b)||isNaN(a))return!1;b=c.hasOwnProperty("width")&&b<=c.width;c=c.hasOwnProperty("height")&&a<=c.height;return b||c};q.prototype._setDockEnabledForViewSize=
function(c){c.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(c))};q.prototype._getPageText=function(c,a){return b.substitute({index:a+1,total:c},k.pageText)};q.prototype._destroySpinner=function(){var c=this._spinner,a=this.view;c&&(a&&a.ui.remove(this._spinner,"popup-spinner"),c.destroy(),this._spinner=null)};q.prototype._createSpinner=function(c){c&&(this._spinner=new v({view:c}),c.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))};q.prototype._toggleCollapsed=function(){this.collapsed=
!this.collapsed};q.prototype._close=function(){this.close();this.view&&this.view.focus()};q.prototype._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled;this._focusDockButton=!0;this.scheduleRender()};q.prototype._toggleFeatureMenu=function(){var c=!this.featureMenuOpen;this._featureMenuOpenChanged(c);this.featureMenuOpen=c};q.prototype._triggerAction=function(c){this.viewModel.triggerAction(c.currentTarget["data-action-index"])};q.prototype._selectFeature=function(c){c=c.currentTarget["data-feature-index"];
isNaN(c)||(this.viewModel.selectedFeatureIndex=c)};q.prototype._next=function(){this.next()};q.prototype._previous=function(){this.previous()};a([u.aliasOf("viewModel.actions"),c.renderable()],q.prototype,"actions",void 0);a([u.property()],q.prototype,"alignment",void 0);a([u.aliasOf("viewModel.autoCloseEnabled")],q.prototype,"autoCloseEnabled",void 0);a([u.aliasOf("viewModel.content"),c.renderable()],q.prototype,"content",void 0);a([u.property(),c.renderable()],q.prototype,"collapsed",void 0);a([u.property(),
c.renderable()],q.prototype,"collapseEnabled",void 0);a([u.property({readOnly:!0,dependsOn:["dockEnabled","alignment"]}),c.renderable()],q.prototype,"currentAlignment",null);a([u.property({readOnly:!0,dependsOn:["viewModel.view.ready","dockEnabled","dockOptions"]}),c.renderable()],q.prototype,"currentDockPosition",null);a([u.property(),c.renderable()],q.prototype,"dockOptions",null);a([u.property(),c.renderable()],q.prototype,"dockEnabled",void 0);a([u.aliasOf("viewModel.featureCount"),c.renderable()],
q.prototype,"featureCount",void 0);a([u.property({dependsOn:["viewModel.visible"]}),c.renderable()],q.prototype,"featureMenuOpen",null);a([u.aliasOf("viewModel.features"),c.renderable()],q.prototype,"features",void 0);a([u.property(),c.renderable()],q.prototype,"featureNavigationEnabled",void 0);a([u.aliasOf("viewModel.highlightEnabled")],q.prototype,"highlightEnabled",void 0);a([u.aliasOf("viewModel.location"),c.renderable()],q.prototype,"location",void 0);a([u.property({readOnly:!0}),c.renderable()],
q.prototype,"featureWidgets",void 0);a([u.aliasOf("viewModel.promises")],q.prototype,"promises",void 0);a([u.aliasOf("viewModel.selectedFeature"),c.renderable()],q.prototype,"selectedFeature",void 0);a([u.aliasOf("viewModel.selectedFeatureIndex"),c.renderable()],q.prototype,"selectedFeatureIndex",void 0);a([u.property({readOnly:!0}),c.renderable()],q.prototype,"selectedFeatureWidget",void 0);a([u.property()],q.prototype,"spinnerEnabled",void 0);a([u.aliasOf("viewModel.title"),c.renderable()],q.prototype,
"title",void 0);a([u.aliasOf("viewModel.updateLocationEnabled")],q.prototype,"updateLocationEnabled",void 0);a([u.aliasOf("viewModel.view")],q.prototype,"view",void 0);a([u.property({type:n}),c.renderable("viewModel.screenLocation viewModel.screenLocationEnabled viewModel.state viewModel.pendingPromisesCount viewModel.promiseCount viewModel.waitingForResult".split(" ")),c.vmEvent(["triggerAction","trigger-action"])],q.prototype,"viewModel",void 0);a([u.aliasOf("viewModel.visible"),c.renderable()],
q.prototype,"visible",void 0);a([u.aliasOf("viewModel.clear")],q.prototype,"clear",null);a([u.aliasOf("viewModel.next")],q.prototype,"next",null);a([u.aliasOf("viewModel.previous")],q.prototype,"previous",null);a([u.aliasOf("viewModel.triggerAction")],q.prototype,"triggerAction",null);a([c.accessibleHandler()],q.prototype,"_toggleCollapsed",null);a([c.accessibleHandler()],q.prototype,"_close",null);a([c.accessibleHandler()],q.prototype,"_toggleDockEnabled",null);a([c.accessibleHandler()],q.prototype,
"_toggleFeatureMenu",null);a([c.accessibleHandler()],q.prototype,"_triggerAction",null);a([c.accessibleHandler()],q.prototype,"_selectFeature",null);a([c.accessibleHandler()],q.prototype,"_next",null);a([c.accessibleHandler()],q.prototype,"_previous",null);return q=a([u.subclass("esri.widgets.Popup")],q)}(u.declared(q))})},"esri/widgets/Feature":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Feature/nls/Feature dojo/keys ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Feature/FeatureViewModel ./Feature/support/attachmentUtils ./support/uriUtils ./support/widget".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r){function v(a,b){return void 0===b?"esri-feature__"+a:"esri-feature__"+a+"-"+b}return function(b){function n(a){a=b.call(this)||this;a._chartMap=new Map;a._activeMediaMap=new Map;a._chartRequirePromise=null;a._refreshTimers=new Map;a._mediaInfo=new Map;a.contentEnabled=null;a.graphic=null;a.title=null;a.view=null;a.viewModel=new l;return a}d(n,b);n.prototype.postInitialize=function(){var a=this;this.own(m.init(this,"viewModel.content",function(){return a._setupMediaRefreshTimers()}))};
n.prototype.destroy=function(){this._clearMediaRefreshTimers();this._activeMediaMap.clear();this._activeMediaMap=null;this._cancelChartModules();this._destroyCharts()};n.prototype.render=function(){var a=r.tsx("div",{key:v("loading-container"),class:"esri-feature__loading-container"},r.tsx("span",{class:r.join("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")})),a=this.viewModel.waitingForContent?a:this._renderContent();return r.tsx("div",{class:"esri-feature"},r.tsx("div",
{class:"esri-feature__size-container"},r.tsx("div",{class:"esri-feature__main-container"},a)))};n.prototype.goToMedia=function(a,c){this._setContentElementMedia(a,c)};n.prototype.nextMedia=function(a){this._pageContentElementMedia(a,"next")};n.prototype.previousMedia=function(a){this._pageContentElementMedia(a,"previous")};n.prototype._cancelChartModules=function(){this._chartRequirePromise&&this._chartRequirePromise.cancel()};n.prototype._destroyChart=function(a){var c=this._chartMap.get(a);c&&(c.chart.destroy(),
c.tooltip.destroy());this._chartMap.delete(a)};n.prototype._destroyCharts=function(){this._chartMap.forEach(function(a){a.chart.destroy();a.tooltip.destroy()});this._chartMap.clear()};n.prototype._renderContent=function(){this._destroyCharts();var a=this.viewModel.content;if("string"===typeof a)return r.tsx("div",{key:v("content-string"),innerHTML:a});if(r.isWidget(a))return r.tsx("div",{key:v("content-widget")},a.render());if(a instanceof HTMLElement)return r.tsx("div",{key:v("content-html-element"),
bind:a,afterCreate:this._attachToNode});if(r.isWidgetBase(a))return r.tsx("div",{key:v("content-dijit"),bind:a.domNode,afterCreate:this._attachToNode});if(Array.isArray(a))return a.length?r.tsx("div",{key:v("content-content-elements")},a.map(this._renderContentElement,this)):null};n.prototype._renderContentElement=function(a,c){switch(a.type){case "attachments":return this._renderAttachments(a,c);case "fields":return this._renderFields(a,c);case "media":return this._renderMedia(a,c);case "text":return this._renderText(a,
c);default:return null}};n.prototype._renderAttachmentInfo=function(a){var c=a.attachmentInfo,b=a.supportsResizeAttachments,e=c.contentType;a=c.name;var d=c.url,f=b&&t.isSupportedImage(e),n=-1===d.indexOf("?")?"?":"\x26",e=f?""+d+n+"w\x3d48":t.getIconPath(e),f=(k={},k["esri-feature__attachment-item-mask--icon"]=!f,k),k=(l={},l["esri-feature__attachments-image--resizable"]=b,l);return r.tsx("li",{class:"esri-feature__attachments-item",key:c},r.tsx("a",{class:"esri-feature__attachments-item-link",href:d,
target:"_blank"},r.tsx("div",{classes:f,class:"esri-feature__attachment-item-mask"},r.tsx("img",{alt:a,classes:k,class:"esri-feature__attachments-image",title:a,src:e}),r.tsx("span",{class:"esri-feature__attachments-image-overlay"},r.tsx("span",{"aria-hidden":"true",class:"esri-feature__attachments-link-icon esri-icon-link-external"}))),r.tsx("span",{class:"esri-feature__attachments-filename"},a||g.noTitle)));var k,l};n.prototype._renderAttachments=function(a,c){var b=this,e=a.displayType,d=(c=a.attachmentInfos)&&
c.length,f=this.get("graphic.layer.capabilities.operations.supportsResizeAttachments"),e=(n={},n["esri-feature__attachments--list"]="preview"!==e,n["esri-feature__attachments--preview"]="preview"===e,n);return d?r.tsx("div",{key:v("attachments-element"),class:r.join("esri-feature__attachments","esri-feature__content-element"),classes:e},r.tsx("div",{class:"esri-feature__attachments-title"},g.attach),r.tsx("ul",{class:"esri-feature__attachments-items"},c.map(function(c,e){return b._renderAttachmentInfo({attachmentInfo:c,
attachmentInfoIndex:e,supportsResizeAttachments:f,contentElement:a})}))):null;var n};n.prototype._forceLTR=function(a){return"\x26lrm;"+a};n.prototype._renderFieldInfo=function(a,c){var b=this.viewModel.formattedAttributes,e=b?b.content[c]||b.global:null,d=a.fieldName,b=a.label||d,e=e?null==e[d]?"":e[d]:"";a=!(!a.format||!a.format.dateFormat);e="number"!==typeof e||a?u.autoLink(e):this._forceLTR(e);a=(f={},f["esri-feature__field-data--date"]=a,f);return r.tsx("tr",{key:v("fields-element-info-row",
c)},r.tsx("th",{key:v("fields-element-info-row-header",c),class:"esri-feature__field-header",innerHTML:b}),r.tsx("td",{key:v("fields-element-info-row-data",c),class:"esri-feature__field-data",classes:a,innerHTML:e}));var f};n.prototype._renderFields=function(a,c){var b=this;return(a=a.fieldInfos)?r.tsx("div",{key:v("fields-element",c),class:r.join("esri-feature__fields","esri-feature__content-element")},r.tsx("table",{class:"esri-table",summary:g.fieldsSummary,key:v("fields-element-table",c)},r.tsx("tbody",
{key:v("fields-element-table-body",c)},a.map(function(a){return b._renderFieldInfo(a,c)})))):null};n.prototype._shouldOpenInNewTab=function(a){void 0===a&&(a="");return!/^(?:mailto:|tel:)/.test(a.trim().toLowerCase())};n.prototype._clearMediaRefreshTimers=function(){this._refreshTimers.forEach(function(a){return clearTimeout(a)});this._refreshTimers.clear()};n.prototype._clearMediaRefreshTimer=function(a){var c=this._refreshTimers.get(a);c&&(clearTimeout(c),this._refreshTimers.delete(a))};n.prototype._getImageSource=
function(a,c){var b=-1!==a.indexOf("?")?"\x26":"?";a=a.split("#");var e=a[1],e=void 0===e?"":e;return""+a[0]+b+"timestamp\x3d"+c+(e?"#":"")+e};n.prototype._setupMediaRefreshTimer=function(a){var c=this.get("viewModel.content");if(Array.isArray(c)&&(c=c[a])&&"media"===c.type){var b=this._activeMediaMap.get(a);isNaN(b)&&(b=0);(c=c.mediaInfos[b])&&"image"===c.type&&c.refreshInterval&&this._setRefreshTimeout(a,c)}};n.prototype._setupMediaRefreshTimers=function(){var a=this;this._clearMediaRefreshTimers();
var c=this.get("viewModel.content");Array.isArray(c)&&c.forEach(function(c,b){return a._setupMediaRefreshTimer(b)})};n.prototype._updateMediaInfoTimestamp=function(a,c){var b=Date.now();this._mediaInfo.set(c,{timestamp:b,sourceURL:this._getImageSource(a,b)});this.scheduleRender()};n.prototype._setRefreshTimeout=function(a,c){var b=this,e=c.refreshInterval,d=c.value;e&&(c=6E4*e,this._updateMediaInfoTimestamp(d.sourceURL,a),c=setInterval(function(){b._updateMediaInfoTimestamp(d.sourceURL,a)},c),this._refreshTimers.set(a,
c))};n.prototype._renderMediaInfoType=function(a,c){var b=a.value,e=a.title,e=void 0===e?"":e,d=a.type,f=a.refreshInterval,g=b.sourceURL,b=b.linkURL;if("image"===d)return a=this._shouldOpenInNewTab(b)?"_self":"_blank",g=(f=f?this._mediaInfo.get(c):null)?f.sourceURL:g,c=r.tsx("img",{alt:e,key:v("media-image-"+(f?f.timestamp:0),c),src:g}),(e=b?r.tsx("a",{title:e,href:b,target:a},c):null)?e:c;if(-1!==d.indexOf("chart"))return r.tsx("div",{key:v("chart",c),bind:this,"data-media-info":a,"data-content-element-index":c,
class:"esri-feature__media-chart",afterCreate:this._getChartDependencies,afterUpdate:this._getChartDependencies})};n.prototype._getChartDependencies=function(a){var c=this,b=a["data-media-info"],e=a["data-content-element-index"],d=b.value,f=d.theme||"Claro",g=b.type,n=f;"string"===typeof f&&(n=f.replace(/\./g,"/"));this._cancelChartModules();this._chartRequirePromise=k.create(function(c){return p(["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip","dojox/charting/themes/"+n],function(){for(var a=
[],b=0;b<arguments.length;b++)a[b]=arguments[b];return c(a)})}).then(function(b){c._renderChart(a,e,g,d,b[0],b[1],b[2]);c._chartRequirePromise=null})};n.prototype._renderChart=function(a,c,b,e,d,f,g){a=new d(a,{margins:{l:4,t:4,r:4,b:4}});g&&a.setTheme(g);switch(b){case "pie-chart":a.addPlot("default",{type:"Pie",labels:!1});a.addSeries("Series A",e.chartOptions);break;case "line-chart":a.addPlot("default",{type:"Markers"});a.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});
a.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});e.chartOptions.forEach(function(c,a){c.x=a+1});a.addSeries("Series A",e.chartOptions);break;case "column-chart":a.addPlot("default",{type:"Columns",gap:3});a.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});a.addSeries("Series A",e.chartOptions);break;case "bar-chart":a.addPlot("default",{type:"Bars",gap:3}),a.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),a.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,
minorLabels:!1}),a.addSeries("Series A",e.chartOptions)}b=new f(a);a.render();this._chartMap.set(c,{chart:a,tooltip:b})};n.prototype._renderMediaInfo=function(a,c){this._destroyChart(c);var b=this._renderMediaInfoType(a,c),e=a.title?r.tsx("div",{key:v("media-title",c),class:"esri-feature__media-item-title",innerHTML:a.title}):null;a=a.caption?r.tsx("div",{key:v("media-caption",c),class:"esri-feature__media-item-caption",innerHTML:a.caption}):null;return r.tsx("div",{key:v("media-container",c),class:"esri-feature__media-item-container"},
r.tsx("div",{key:v("media-item-container",c),class:"esri-feature__media-item"},b),e,a)};n.prototype._renderMediaStatsItem=function(a,c,b){b="chart"===b?r.join("esri-feature__media-chart-icon","esri-icon-chart"):r.join("esri-feature__media-image-icon","esri-icon-media");return r.tsx("li",{class:"esri-feature__media-image-summary"},r.tsx("span",{"aria-hidden":"true",class:b}),r.tsx("span",{class:"esri-feature__media-count","aria-label":a},"("+c+")"))};n.prototype._renderMediaPageButton=function(a,c){var b=
(a="previous"===a)?g.previous:g.next,e=a?r.join("esri-feature__button","esri-feature__media-previous"):r.join("esri-feature__button","esri-feature__media-next"),d=a?r.join("esri-feature__icon","esri-feature__media-previous-icon","esri-icon-left-triangle-arrow"):r.join("esri-feature__icon","esri-feature__media-next-icon","esri-icon-right-triangle-arrow"),f=a?r.join("esri-feature__icon","esri-feature__media-previous-icon--rtl","esri-icon-right-triangle-arrow"):r.join("esri-feature__icon","esri-feature__media-next-icon--rtl",
"esri-icon-left-triangle-arrow"),n=a?this._previousClick:this._nextClick;return r.tsx("div",{key:v(a?"previous":"next",c),title:b,tabIndex:0,role:"button",class:e,"data-content-element-index":c,bind:this,onkeydown:n,onclick:n},r.tsx("span",{"aria-hidden":"true",class:d}),r.tsx("span",{"aria-hidden":"true",class:f}),r.tsx("span",{class:"esri-icon-font-fallback-text"},b))};n.prototype._handleMediaKeyup=function(a){var c=a.currentTarget["data-content-element-index"],b=a.keyCode;b===f.LEFT_ARROW&&(a.stopPropagation(),
this.previousMedia(c));b===f.RIGHT_ARROW&&(a.stopPropagation(),this.nextMedia(c))};n.prototype._renderMedia=function(a,c){a=a.mediaInfos;var b=this._getMediaStats(a),e=b.total,d=(f={},f["esri-feature--media-pagination-visible"]=1<b.total,f),f=this._renderMediaStatsItem(g.numImages,b.images,"image"),b=this._renderMediaStatsItem(g.numCharts,b.charts,"chart"),n=this._renderMediaPageButton("previous",c),k=this._renderMediaPageButton("next",c),l=this._activeMediaMap.get(c);isNaN(l)&&(this._activeMediaMap.set(c,
0),l=0);return e?r.tsx("div",{key:v("media-element",c),"data-content-element-index":c,bind:this,onkeyup:this._handleMediaKeyup,class:r.join("esri-feature__media","esri-feature__content-element"),classes:d},r.tsx("ul",{class:"esri-feature__media-summary"},f,b),r.tsx("div",{key:v("media-element-container",c),class:"esri-feature__media-container"},n,this._renderMediaInfo(a[l],c),k)):null;var f};n.prototype._renderText=function(a,c){return a.text?r.tsx("div",{key:v("text-element",c),innerHTML:a.text,
class:r.join("esri-feature__text","esri-feature__content-element")}):null};n.prototype._attachToNode=function(a){a.appendChild(this)};n.prototype._getMediaStats=function(a){var c=0,b=0;a.forEach(function(a){a=a.type;"image"===a?c++:-1!==a.indexOf("chart")&&b++});return{total:b+c,images:c,charts:b}};n.prototype._setContentElementMedia=function(a,c){this._clearMediaRefreshTimer(a);var b=this.viewModel.content;(b=(b=b&&b[a])&&b.mediaInfos)&&b.length&&(this._activeMediaMap.set(a,(c+b.length)%b.length),
this._setupMediaRefreshTimer(a),this.scheduleRender())};n.prototype._pageContentElementMedia=function(a,c){c="previous"===c?-1:1;c=this._activeMediaMap.get(a)+c;this._setContentElementMedia(a,c)};n.prototype._previousClick=function(a){this.previousMedia(a.currentTarget["data-content-element-index"])};n.prototype._nextClick=function(a){this.nextMedia(a.currentTarget["data-content-element-index"])};a([e.aliasOf("viewModel.contentEnabled")],n.prototype,"contentEnabled",void 0);a([e.aliasOf("viewModel.graphic")],
n.prototype,"graphic",void 0);a([e.aliasOf("viewModel.title")],n.prototype,"title",void 0);a([e.aliasOf("viewModel.view")],n.prototype,"view",void 0);a([e.property({type:l}),r.renderable(["viewModel.waitingForContent","viewModel.content"])],n.prototype,"viewModel",void 0);a([r.accessibleHandler()],n.prototype,"_previousClick",null);a([r.accessibleHandler()],n.prototype,"_nextClick",null);return n=a([e.subclass("esri.widgets.Feature")],n)}(e.declared(b))})},"esri/widgets/Widget":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/dom dojo/_base/lang ../core/Accessor ../core/ArrayPool ../core/Collection ../core/Evented ../core/Handles ../core/Logger ../core/watchUtils ../core/accessorSupport/decorators maquette".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v){var q=t.getLogger("esri.widgets.Widget"),n=0;return function(b){function c(c,a){c=b.call(this)||this;c._attached=!1;c.destroyed=!1;c.domNode=null;c.iconClass="esri-icon-checkbox-unchecked";c.visible=!0;c._internalHandles=new l;c.render=c.render.bind(c);return c}d(c,b);c.prototype.normalizeCtorArgs=function(c,a){c=f.mixin({},c);a&&(c.container=a);return c};c.prototype.initialize=function(){var c=this;this._internalHandles.add(this._renderableProps.map(function(a){return u.init(c,
a,function(c,b){var d=this;e.isCollection(b)&&this._internalHandles.remove(this.declaredClass+":"+a+"-collection-change-event-listener");e.isCollection(c)&&(c=c.on("change",function(){return d.scheduleRender()}),this._internalHandles.add(c,this.declaredClass+":"+a+"-collection-change-event-listener"));this.scheduleRender()})}));this._delegatedEventNames.length&&this._internalHandles.add(u.init(this,"viewModel",function(){c._get("viewModel")&&c._internalHandles.remove("delegated-events");c._delegatedEventNames.map(function(a){return c.viewModel.on(a,
function(b){c.emit(a,b)})})}),"delegated-events");this.postInitialize();this._internalHandles.add(u.whenOnce(this,"container",function(a){return c._attach(a)}))};c.prototype.postInitialize=function(){};c.prototype.destroy=function(){this.destroyed||(this.viewModel&&this.viewModel.destroy(),this._detach(this.container),this._internalHandles.destroy(),this._set("destroyed",!0))};c.prototype.startup=function(){q.warn("Widget.startup() is deprecated and no longer needed")};Object.defineProperty(c.prototype,
"container",{set:function(c){this._get("container")||this._set("container",c)},enumerable:!0,configurable:!0});c.prototype.castContainer=function(c){return g.byId(c)};Object.defineProperty(c.prototype,"id",{get:function(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+n++},set:function(c){c&&this._set("id",c)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"label",{get:function(){return this.declaredClass.split(".").pop()},enumerable:!0,configurable:!0});
c.prototype.scheduleRender=function(){this._projector.scheduleRender()};c.prototype.on=function(c,a){var b=this.inherited(arguments);this._internalHandles.add(b);return b};c.prototype.classes=function(c){for(var a=m.acquire(),b=0;b<arguments.length;b++){var e=arguments[b],d=typeof e;if("string"===d)a.push(e);else if(Array.isArray(e))a.push.apply(a,e);else if("object"===d)for(var f in e)e[f]&&a.push(f)}b=a.join(" ");m.release(a);return b};c.prototype.own=function(c){1<arguments.length&&(c=Array.prototype.slice.call(arguments));
this._internalHandles.add(c)};c.prototype.renderNow=function(){this._projector.renderNow()};c.prototype._attach=function(c){c&&(this._projector.merge(c,this.render),this._attached=!0)};c.prototype._detach=function(c){c&&this._attached&&(this._projector.detach(this.render),c.parentNode&&c.parentNode.removeChild(c),this._attached=!1)};a([r.shared(v.createProjector())],c.prototype,"_projector",void 0);a([r.shared([])],c.prototype,"_renderableProps",void 0);a([r.shared([])],c.prototype,"_delegatedEventNames",
void 0);a([r.property({value:null})],c.prototype,"container",null);a([r.cast("container")],c.prototype,"castContainer",null);a([r.property({readOnly:!0})],c.prototype,"destroyed",void 0);a([r.property({aliasOf:"container"})],c.prototype,"domNode",void 0);a([r.property({readOnly:!0})],c.prototype,"iconClass",void 0);a([r.property({dependsOn:["container"]})],c.prototype,"id",null);a([r.property({readOnly:!0})],c.prototype,"label",null);a([r.property()],c.prototype,"viewModel",void 0);a([r.property()],
c.prototype,"visible",void 0);return c=a([r.subclass("esri.widgets.Widget")],c)}(r.declared(k,b))})},"esri/widgets/Feature/FeatureViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper dojo/i18n!dojo/cldr/nls/number ../../Graphic ../../core/date ../../core/Error ../../core/Handles ../../core/lang ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../support/arcadeUtils ./support/featureUtils ./support/RelatedFeatures ../support/widget".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c){function x(c,a){return c&&"feature"===c.type?c.getField(a):null}function z(c){return c.replace(/[\u00A0-\u99999<>\&]/gim,function(c){return"\x26#"+c.charCodeAt(0)+";"})}var A=t.getLogger("esri.widgets.FeatureViewModel"),y=/^\s*expression\//i,B=new e("cancelled-query","cancelled feature query"),E=m.getFormat("short-date-short-time"),C="DateFormat"+E;return function(e){function g(c){c=e.call(this)||this;c._handles=new b;c._featurePromise=void 0;c._layerDateFields=
[];c.content=null;c.contentEnabled=!0;c.formattedAttributes=null;c.title="";c.view=null;return c}d(g,e);g.prototype.destroy=function(){this._clear();this._handles.destroy();this.graphic=this.view=this._handles=null};Object.defineProperty(g.prototype,"graphic",{get:function(){return this._get("graphic")||null},set:function(c){if(c){var a=n.getSourceLayer(c);this._layerDateFields=a?this._getDateFields(a):[]}this._set("graphic",c);this._graphicChanged(c)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"waitingForContent",{get:function(){var c=this._featurePromise;return c?!c.isFulfilled():!1},enumerable:!0,configurable:!0});g.prototype._clear=function(){this._cancelFeatureQuery();this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};g.prototype._graphicChanged=function(c){var a=this,b=this._handles;b&&(b.remove("graphic"),this._clear(),c&&(b.add(r.watch(this,["graphic.popupTemplate.title","graphic.popupTemplate.content","graphic.popupTemplate.fieldInfos","contentEnabled"],
function(){a._graphicChanged(a.graphic)}),"graphic"),this._featurePromise=this._queryFeature().then(function(){a.notifyChange("waitingForContent")}).catch(function(c){a.notifyChange("waitingForContent");c!==B&&A.log("error","error loading template",c);throw c;}),this.notifyChange("waitingForContent")))};g.prototype._cancelFeatureQuery=function(){var c=this._featurePromise;c&&!c.isFulfilled()&&c.cancel(B)};g.prototype._compileContent=function(a,b){var e=this;if(a&&(a.nodeName||a&&c.isWidgetBase(a)||
c.isWidget(a)))return a;if("string"===typeof a)return this._compileText({type:"text",text:a}).text;if(Array.isArray(a))return a.map(function(c,a){a=(a=b&&b[a])&&a.value;var d=c.type;if("attachments"===d)return e._compileAttachments(c,a);if("fields"===d)return e._compileFields(c);if("media"===d)return e._compileMedia(c);if("text"===d)return e._compileText(c)});a&&A.warn("invalid content type.")};g.prototype._compileFields=function(c){var a=this,b=this.graphic;c=l.clone(c);var e=b.get("popupTemplate.expressionInfos"),
b=c.fieldInfos?void 0:b.get("popupTemplate.fieldInfos"),b=c.fieldInfos||l.clone(b),d=[];b&&b.forEach(function(c){var b=c.fieldName.toLowerCase();if(!c.hasOwnProperty("visible")||c.visible)b=a._isExpressionField(b)?a._getExpressionInfo(e,b):null,c.label=b?b.title:c.label,d.push(c)});c.fieldInfos=d;return c};g.prototype._setImageValue=function(c,a,b){var e=c.linkURL;c.sourceURL=l.substitute(a,this._fixTokens(c.sourceURL,b));c.sourceURL&&e&&(c.linkURL=(""+l.substitute(a,this._fixTokens(e,b))).trim())};
g.prototype._compileMedia=function(c){var a=this,b=this._layerDateFields,e=this.graphic;c=l.clone(c);var d=c.mediaInfos||[],f=e.attributes,g=n.getSourceLayer(e),k=this.formattedAttributes.global,q={dateFormat:{properties:b,formatter:C}};c.mediaInfos=d.map(function(c){if(c=l.clone(c)){var b=c.value,e=c.type,d=c.title?a._processFieldsInLinks(a._fixTokens(c.title,g),f):"",n=c.caption?a._processFieldsInLinks(a._fixTokens(c.caption,g),f):"";c.title=d?(""+l.substitute(k,d,q)).trim():"";c.caption=n?(""+
l.substitute(k,n,q)).trim():"";if("image"===e)return a._setImageValue(b,k,g),c;if("pie-chart"===e||"line-chart"===e||"column-chart"===e||"bar-chart"===e)return a._setChartValue(b,k,g),c}});return c};g.prototype._compileText=function(c){var a=this._layerDateFields,b=this.graphic;if((c=l.clone(c))&&c.text){var e=n.getSourceLayer(b),d=b.attributes,b=this.formattedAttributes.global,a={dateFormat:{properties:a,formatter:C}},e=this._processFieldsInLinks(this._fixTokens(c.text,e),d);c.text=(""+l.substitute(b,
e,a)).trim()}return c};g.prototype._compileTitle=function(){var c=this._layerDateFields,a=this.graphic,b=a.get("popupTemplate.title"),e=a.attributes,d=n.getSourceLayer(a),c={dateFormat:{properties:c,formatter:C}},f=this.formattedAttributes.global;return"function"===typeof b?b.call(null,{graphic:a}):"string"===typeof b&&b?(a=this._processFieldsInLinks(this._fixTokens(b,d),e),(""+l.substitute(f,a,c)).trim()):""};g.prototype._getExpressionInfo=function(c,a){if(this._isExpressionField(a)){var b=a.replace(y,
"").toLowerCase(),e;c.some(function(c){if(c.name.toLowerCase()===b)return e=c,!0});return e}};g.prototype._fixTokens=function(c,a){return c.replace(/(\{([^\{\r\n]+)\})/g,function(c,b,e){return(c=x(a,e))?"{"+c.name+"}":b})};g.prototype._encodeAttributes=function(c){var a=c?l.clone(c):{};Object.keys(a).forEach(function(c){var b=a[c];"string"===typeof b&&(b=encodeURIComponent(b).replace(/\'/g,"\x26apos;"),a[c]=b)});return a};g.prototype._formatAttributesToFieldInfos=function(c,a,b){var e=this,d=l.clone(this._layerDateFields);
c.forEach(function(f){var g=e._getFixedFieldName(f.fieldName,a);f.fieldName=g;b[g]=e._formatValue(b[g],{fieldInfos:c,fieldName:g,layer:a});d&&f.format&&f.format.dateFormat&&(f=d.indexOf(g),-1<f&&d.splice(f,1))})};g.prototype._getArcadeViewingMode=function(c){return c&&"local"===c.viewingMode?"localScene":"globalScene"};g.prototype._getViewInfo=function(){var c=this.view;if(c){var a="3d"===c.type?this._getArcadeViewingMode(c):"map";return q.getViewInfo({viewingMode:a,scale:c.scale,spatialReference:c.spatialReference})}};
g.prototype._formatAttributes=function(c,a,b){var e=this,d=this.graphic,f=d.attributes,g=n.getSourceLayer(d),k=f?l.clone(f):{};a&&a.forEach(function(c){var a="expression/"+c.name;c=b.get(c.name);var f=e._getViewInfo();c=q.executeFunction(c,q.createExecContext(d,f));k[a]="string"===typeof c?z(c):c});this.addRelatedFeatureAttributes(k);c&&this._formatAttributesToFieldInfos(c,g,k);if(g){var m=g.typeIdField;f&&Object.keys(f).forEach(function(c){if(!e.isRelatedField(c)){var a=f[c];l.isDefined(a)&&(a=e._getDomainName(c,
a),l.isDefined(a)?k[c]=a:c===m&&(a=e._getTypeName(),l.isDefined(a)&&(k[c]=a)))}})}return k};g.prototype._formatValue=function(c,a){var b={dateFormat:{properties:this._layerDateFields,formatter:C}},e=a.fieldName,d=this._getFieldInfo(a.fieldInfos,e),g=l.clone(d),d=a.preventPlacesFormatting;(a=x(a.layer,e))&&"date"===a.type&&(a=g.format||{},a.dateFormat=a.dateFormat||"short-date-short-time",g.format=a);e=g&&g.format;if(!l.isDefined(c)||!g||!l.isDefined(e))return c;var n=[],g=e.hasOwnProperty("places")||
e.hasOwnProperty("digitSeparator");a=e.hasOwnProperty("digitSeparator")?e.digitSeparator:!0;d=l.isDefined(e.places)&&(!d||0<e.places);g&&d&&n.push("places: "+Number(e.places));d=g?d?"NumberFormat("+n.join(",")+")":"NumberFormat":e.dateFormat?"DateFormat"+(m.getFormat(e.dateFormat)||E):void 0;if(!d)return c;c=l.substitute({myKey:c},"{myKey:"+d+"}",b)||"";return g&&!a&&f.group?c.replace(new RegExp("\\"+f.group,"g"),""):c};g.prototype._getDomainName=function(c,a){var b=this.graphic,e=n.getSourceLayer(b);
return e&&"feature"===e.type?(c=e.getFieldDomain(c,{feature:b}))&&"coded-value"===c.type?c.getName(a):null:null};g.prototype._getFieldInfo=function(c,a){if(c&&c.length&&a){var b=a.toLowerCase(),e=void 0;c.some(function(c){if(c.fieldName&&c.fieldName.toLowerCase()===b)return e=c,!0});return e}};g.prototype._getTypeName=function(){var c=this.graphic,a=n.getSourceLayer(c);if(a&&"feature"===a.type&&(c=a.getFeatureType(c)))return c.name};g.prototype._processFieldsInLinks=function(c,a){var b=this._encodeAttributes(a),
e=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/ig;return c?c.replace(e,function(c,e,d){e=(""+(e||d)).trim();return l.substitute(e&&"{"===e[0]?a:b,c)}):c};g.prototype._compileAttachments=function(c,a){c=l.clone(c);if(!a)return c;c.attachmentInfos=a;return c};g.prototype._queryAttachments=function(){var c=this.graphic,a=n.getSourceLayer(c);return a?(a="scene"===a.type&&a.associatedLayer?a.associatedLayer:a)&&"feature"===a.type?a.queryFeatureAttachments(c):u.resolve([]):u.resolve([])};g.prototype._queryContentElements=
function(c){var a=this;if(!Array.isArray(c))return u.resolve();var b={};c.forEach(function(c,e){"attachments"===c.type&&(c=a._queryAttachments())&&(b[e]=c)});return Object.keys(b).length?u.eachAlways(b):u.resolve()};g.prototype._getContent=function(){var c=this.graphic;if(!this.contentEnabled)return u.resolve();var a=c.get("popupTemplate.content"),c="function"===typeof a?a.call(null,{graphic:c}):a;return u.isThenable(c)?c:u.resolve(c)};g.prototype._queryFeature=function(){var c=this;return this._getContent().then(function(a){return c._checkForRelatedFeatures(a).then(function(){c._set("formattedAttributes",
c._createFormattedAttributes(a));c._set("title",c._compileTitle());return c._queryContentElements(a).then(function(b){b=c._compileContent(a,b);c._set("content",b||null);return b})})})};g.prototype._isExpressionField=function(c){return y.test(c)};g.prototype._createCompiledExpressionDictionary=function(c){var a=new Map;if(!c)return a;c.forEach(function(c){return a.set(c.name,q.createFunction(c.expression))});return a};g.prototype._getDateFields=function(c){return(c=c.fields)?c.filter(function(c){return"date"===
c.type}).map(function(c){return c.name}):[]};g.prototype._createFormattedAttributes=function(c){var a=this,b=this.graphic,e=b.get("popupTemplate.fieldInfos"),d=b.get("popupTemplate.expressionInfos"),f=this._createCompiledExpressionDictionary(d),g={global:this._formatAttributes(e,d,f),content:[]};Array.isArray(c)&&c.forEach(function(c,b){"fields"===c.type&&c.fieldInfos&&(g.content[b]=a._formatAttributes(c.fieldInfos,d,f))});return g};g.prototype._getAllFieldInfos=function(c){var a=[],b=this.graphic.get("popupTemplate.fieldInfos");
b&&a.push.apply(a,b);if(!c||!Array.isArray(c))return a;c.forEach(function(c){a.push.apply(a,c&&c.fieldInfos)});return a};g.prototype._checkForRelatedFeatures=function(c){var a=this.graphic;c=this._getAllFieldInfos(c);return this.queryRelatedInfos(a,c)};g.prototype._getChartOption=function(c,a,b,e,d){var f=n.getSourceLayer(this.graphic),g=a.normalizeField;a=a.tooltipField;g=g?this.isRelatedField(g)?b[this.getRelatedFieldInfo(g).fieldName]:b[g]:null;c=parseFloat(b[c]);var k=void 0===c?null:c&&g?c/g:
c;c={y:k,tooltip:""+k};if(!a)return c;if(this.isRelatedField(a))return e=this.getRelatedFieldInfo(a).fieldName,b=b[e],d=this._formatValue(k,{fieldInfos:d,fieldName:b,layer:f,preventPlacesFormatting:!!g}),c.tooltip=b+":"+d,c;b=this._getFieldInfo(d,e);e=this._getFixedFieldName(e,f);d=this._formatValue(k,{fieldInfos:d,fieldName:a,layer:f,preventPlacesFormatting:!!g});c.tooltip=(b?b.fieldName:e)+":"+d;return c};g.prototype._getFixedFieldName=function(c,a){return(a=x(a,c))?a.name:c};g.prototype._getFixedFieldNames=
function(c,a){var b=this;return c&&c.map(function(c){return b._getFixedFieldName(c,a)})};g.prototype._setChartValue=function(c,a,b){var e=this,d=this.graphic,f=this.relatedInfoCount,g=c.fields,n=c.normalizeField;c.fields=this._getFixedFieldNames(g,b);n&&(c.normalizeField=this._getFixedFieldName(n,b));if(g.some(function(c){return!!(l.isDefined(a[c])||e.isRelatedField(c)&&f)})){var k=d.get("popupTemplate.fieldInfos");c.chartOptions=c.chartOptions||[];g.forEach(function(b){e.isRelatedField(b)?c.chartOptions=
c.chartOptions.concat(e._getRelatedChartInfos(k,b,c,a)):(b=e._getChartOption(b,c,a,b,k),c.chartOptions.push(b))})}};g.prototype._getRelatedChartInfos=function(c,a,b,e){var d=this,f=[];e=this.getRelatedFieldInfo(a);var g=e.fieldName,n=this.getRelatedInfo(e.layerId);if(!n)return f;e=n.relatedFeatures;n=n.relation;if(!n||!e)return f;n=n.cardinality;e.forEach(function(e){var n=e.attributes;n&&Object.keys(n).forEach(function(e){e===g&&f.push(d._getChartOption(e,b,n,a,c))})});return"one-to-many"===n||"many-to-many"===
n?f:[f[0]]};a([v.property({readOnly:!0})],g.prototype,"content",void 0);a([v.property()],g.prototype,"contentEnabled",void 0);a([v.property({readOnly:!0})],g.prototype,"formattedAttributes",void 0);a([v.property({type:k})],g.prototype,"graphic",null);a([v.property({readOnly:!0})],g.prototype,"title",void 0);a([v.property()],g.prototype,"view",void 0);a([v.property({readOnly:!0})],g.prototype,"waitingForContent",null);return g=a([v.subclass("esri.widgets.FeatureViewModel")],g)}(v.declared(w))})},"esri/widgets/Feature/support/featureUtils":function(){define(["require",
"exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});h.getSourceLayer=function(d){if(d)return d.get("sourceLayer")||d.get("layer")}})},"esri/widgets/Feature/support/RelatedFeatures":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../request ../../../core/Accessor ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../tasks/QueryTask ../../../tasks/support/Query ../../../tasks/support/StatisticDefinition ./featureUtils".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r){var v=new Map,q=m.getLogger("esri.widgets.Popup.support.RelatedFeatures");return function(f){function n(c){c=f.call(this)||this;c.relatedInfoCount=null;c.relatedInfos=new Map;return c}d(n,f);n.prototype.destroy=function(){this.relatedInfos.clear()};n.prototype.addRelatedFeatureAttributes=function(c){var a=this;this.relatedInfos.forEach(function(b){return a._addRelatedFeatureAttribute(c,b)})};n.prototype.getRelatedFieldInfo=function(c){if(-1===c.indexOf("relationships/"))return null;
c=c.split("/").slice(1);return{layerId:c[0],fieldName:c[1]}};n.prototype.getRelatedInfo=function(c){return this.relatedInfos.get(c.toString())};n.prototype.isRelatedField=function(c){void 0===c&&(c="");return c?-1!==c.indexOf("relationships/"):!1};n.prototype.queryRelatedInfos=function(c,a){var b=this;this.relatedInfos.clear();var d=r.getSourceLayer(c);if(!d)return e.resolve();var f=a.filter(function(c){return c&&b.isRelatedField(c.fieldName)});if(!f||!f.length)return e.resolve();this._createRelatedInfos(a,
d);return this._queryLayerInfos(d,a).then(function(a){b._updateRelatedInfoLayerInfos(a);return b._queryRelatedFeatureMap(c).then(function(c){Object.keys(c).forEach(function(a){b._setRelatedFeatures(c[a],a.toString())});return c})})};n.prototype._addRelatedFeatureAttribute=function(c,a){var b=this;c&&a&&("one-to-one"===a.relation.cardinality&&a.relatedFeatures&&a.relatedFeatures.forEach(function(e){return b._addAttributesFromFeature(c,e,a)}),a.relatedStatsFeatures&&a.relatedStatsFeatures.forEach(function(e){return b._addAttributesFromFeature(c,
e,a)}))};n.prototype._updateRelatedInfoLayerInfo=function(c,a){if(c=c.value)this.getRelatedInfo(a).layerInfo=c.data};n.prototype._updateRelatedInfoLayerInfos=function(c){var a=this;Object.keys(c).forEach(function(b){return a._updateRelatedInfoLayerInfo(c[b],b.toString())})};n.prototype._addAttributesFromFeature=function(c,a,b){var e=this;c&&a&&b&&Object.keys(a.attributes).forEach(function(d){var f=e._relatedFieldInfoToString({layerId:b.relation.id.toString(),fieldName:d});c[f]=a.attributes[d]})};
n.prototype._relatedFieldInfoToString=function(c){return c?"relationships/"+c.layerId+"/"+c.fieldName:""};n.prototype._createRelatedInfoForFieldInfo=function(c,a){var b=this.getRelatedFieldInfo(c.fieldName);if(b){var e=b.layerId,b=b.fieldName;e&&(a=this.getRelatedInfo(e)||this._createRelatedInfo(e,a))&&(a.relatedFields.push(b),c.statisticType&&(c=new u({statisticType:c.statisticType,onStatisticField:b,outStatisticFieldName:b}),a.outStatistics.push(c)))}};n.prototype._createRelatedInfos=function(c,
a){var b=this;c.forEach(function(c){return b._createRelatedInfoForFieldInfo(c,a)})};n.prototype._queryRelatedFeatureMap=function(c){var a=this,b={};this.relatedInfos.forEach(function(e,d){b[d]=a._queryRelatedLayerFeatures(c,e)});return e.eachAlways(b)};n.prototype._queryLayerInfos=function(c,a){var b=this,d={};this.relatedInfos.forEach(function(a,f){a=a.relation;if(!a)return f=new k("relation-required","A relation is required on a layer to retrieve related records."),q.error(f),e.reject(f);a=a.relatedTableId;
if(!a)return f=new k("A related table ID is required on a layer to retrieve related records."),q.error(f),e.reject(f);a=c.url+"/"+a;var g=v.get(a),n=g?g:b._queryLayerInfo(a);g||v.set(a,n);d[f]=n});return e.eachAlways(d)};n.prototype._queryLayerInfo=function(c){return g(c,{query:{f:"json"},callbackParamName:"callback"})};n.prototype._queryRelatedLayerFeatures=function(c,a){var b=r.getSourceLayer(c).layerId.toString(),d=a.layerInfo,f=a.queryTask,g=a.relation;if(b=this._getDestinationRelation(d,b)){var g=
g.keyField,n=b.keyField,b="string"===this._getDestinationFieldType(d,b)?n+"\x3d'"+c.attributes[g]+"'":n+"\x3d"+c.attributes[g];c=f.execute(new t({where:b,outFields:a.relatedFields}));a=a.outStatistics&&0<a.outStatistics.length&&d.supportsStatistics?f.execute(new t({where:b,outFields:a.relatedFields,outStatistics:a.outStatistics})):null;return e.eachAlways({features:c,statsFeatures:a?a:e.resolve()})}return e.resolve()};n.prototype._setRelatedFeatures=function(c,a){if(a=this.getRelatedInfo(a)){var b=
c.value;b&&(c=b.features,b=b.statsFeatures,c=c&&c.value,a.relatedFeatures=c?c.features:[],c=b&&b.value,a.relatedStatsFeatures=c?c.features:[])}};n.prototype._getRelation=function(c,a){if("feature"!==a.type)return null;var b=null;a.relationships.some(function(a){if(a.id===parseInt(c,10))return b=a,!0});return b};n.prototype._createRelatedInfo=function(c,a){var b=this._getRelation(c,a);if(b){a=a.url+"/"+b.relatedTableId;var e=new l({url:a}),b={url:a,queryTask:e,relation:b,relatedFields:[],outStatistics:[]};
this.relatedInfos.set(c,b);return b}};n.prototype._getDestinationRelation=function(c,a){var b;c&&c.relationships&&c.relationships.some(function(c){if(""+c.relatedTableId===a)return b=c,!0});return b};n.prototype._getDestinationFieldType=function(c,a){var b=void 0;c.fields.some(function(c){if(c.name===a.keyField)return b=-1!==["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(c.type)?"number":"string",!0});return b};a([b.aliasOf("relatedInfos.size")],
n.prototype,"relatedInfoCount",void 0);a([b.property()],n.prototype,"relatedInfos",void 0);return n=a([b.subclass("esri.widgets.Popup.support.RelatedFeatures")],n)}(b.declared(f))})},"esri/widgets/support/widget":function(){define("require exports ./decorators ./jsxFactory ./widgetUtils ../Widget".split(" "),function(p,h,d,a,g,f){function k(a){for(var e in a)h.hasOwnProperty(e)||(h[e]=a[e])}Object.defineProperty(h,"__esModule",{value:!0});k(d);k(a);k(g);h.isWidget=function(a){return a&&a instanceof
f};h.isWidgetBase=function(a){return a&&"function"===typeof a.postMixInProperties&&"function"===typeof a.buildRendering&&"function"===typeof a.postCreate&&"function"===typeof a.startup}})},"esri/widgets/support/decorators":function(){define(["require","exports","./decorators/accessibleHandler","./decorators/renderable","./decorators/vmEvent"],function(p,h,d,a,g){function f(a){for(var d in a)h.hasOwnProperty(d)||(h[d]=a[d])}Object.defineProperty(h,"__esModule",{value:!0});f(d);f(a);f(g)})},"esri/widgets/support/decorators/accessibleHandler":function(){define(["require",
"exports","dojo/keys"],function(p,h,d){function a(a){return function(f){for(var g=[],m=1;m<arguments.length;m++)g[m-1]=arguments[m];m=f.type;if(f instanceof KeyboardEvent||"keyup"===m||"keydown"===m||"keypress"===m){if(f.keyCode===d.ENTER||f.keyCode===d.SPACE)f.preventDefault(),f.target.click()}else a.call.apply(a,[this,f].concat(g))}}Object.defineProperty(h,"__esModule",{value:!0});h.accessibleHandler=function(){return function(d,f){return{value:a(d[f])}}}})},"esri/widgets/support/decorators/renderable":function(){define(["require",
"exports","./propUtils"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});h.renderable=function(a){var g="string"===typeof a?d.splitProps(a):a;return function(a,k){a._renderableProps||(a._renderableProps=[]);a=a._renderableProps;g?a.push.apply(a,d.normalizePropNames(g,k)):a.push(k)}}})},"esri/widgets/support/decorators/propUtils":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});h.splitProps=function(d){return d.split(",").map(function(a){return a.trim()})};
h.normalizePropNames=function(d,a){return d.map(function(d){d=0===d.indexOf(a)?d:a+"."+d;return d})}})},"esri/widgets/support/decorators/vmEvent":function(){define(["require","exports","./propUtils"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});h.vmEvent=function(a){return function(g){g._delegatedEventNames||(g._delegatedEventNames=[]);var f=Array.isArray(a)?a:d.splitProps(a);g._delegatedEventNames=g._delegatedEventNames.concat(f)}}})},"esri/widgets/support/jsxFactory":function(){define(["require",
"exports","maquette-jsx"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});h.tsx=d.jsx})},"maquette-jsx/dist/maquette-jsx.umd":function(){(function(p,h){"object"===typeof exports&&"undefined"!==typeof module?h(exports):"function"===typeof define&&define.amd?define(["exports"],h):h(p.maquetteCssTransitions={})})(this,function(p){var h=function(a,d){for(var f=0,g=a.length;f<g;f++){var m=a[f];Array.isArray(m)?h(m,d):null!==m&&void 0!==m&&!1!==m&&(m.hasOwnProperty("vnodeSelector")||(m=
{vnodeSelector:"",properties:void 0,children:void 0,text:m.toString(),domNode:null}),d.push(m))}},d=function(a,d){for(var f=[],g=2;g<arguments.length;g++)f[g-2]=arguments[g];if(1===f.length&&"string"===typeof f[0])return{vnodeSelector:a,properties:d||void 0,children:void 0,text:f[0],domNode:null};g=[];h(f,g);return{vnodeSelector:a,properties:d||void 0,children:g,text:void 0,domNode:null}};p.jsx=d;p.enableGlobalJsx=function(){window.jsx=d};Object.defineProperty(p,"__esModule",{value:!0})})},"esri/widgets/support/widgetUtils":function(){define(["require",
"exports","dojo/has","../../core/Logger","maquette-css-transitions"],function(p,h,d,a,g){Object.defineProperty(h,"__esModule",{value:!0});a.getLogger("esri.widgets.support.widgetUtils");h.join=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];return a.join(" ")};h.isRtl=function(){return"rtl"===document.dir};h.storeNode=function(a){this[a.getAttribute("data-node-ref")]=a};h.cssTransition=function(a,d){return("enter"===a?g.createEnterCssTransition:g.createExitCssTransition)(d)}})},
"maquette-css-transitions/dist/maquette-css-transitions.umd":function(){(function(p,h){"object"===typeof exports&&"undefined"!==typeof module?h(exports):"function"===typeof define&&define.amd?define(["exports"],h):h(p.maquetteCssTransitions={})})(this,function(p){var h,d,a=function(a){if("WebkitTransition"in a.style)h="webkitTransitionEnd",d="webkitAnimationEnd";else if("transition"in a.style)h="transitionend",d="animationend";else throw Error("Your browser is not supported!");};p.createEnterCssTransition=
function(g,f){void 0===f&&(f=g+"-active");return function(k){h||a(k);var m=!1,e=function(a){m||(m=!0,k.removeEventListener(h,e),k.removeEventListener(d,e),k.classList.remove(g),k.classList.remove(f))};k.classList.add(g);k.addEventListener(h,e);k.addEventListener(d,e);requestAnimationFrame(function(){k.classList.add(f)})}};p.createExitCssTransition=function(g,f){void 0===f&&(f=g+"-active");return function(k,m){h||a(k);var e=!1,b=function(a){e||(e=!0,k.removeEventListener(h,b),k.removeEventListener(d,
b),m())};k.classList.add(g);k.addEventListener(h,b);k.addEventListener(d,b);requestAnimationFrame(function(){k.classList.add(f)})}};Object.defineProperty(p,"__esModule",{value:!0})})},"esri/widgets/Feature/support/attachmentUtils":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});var d=p.toUrl("../../../themes/base/images/files/");h.isSupportedImage=function(a){a=a.toLowerCase();return"image/bmp"===a||"image/emf"===a||"image/exif"===a||"image/gif"===
a||"image/x-icon"===a||"image/jpeg"===a||"image/png"===a||"image/tiff"===a||"image/x-wmf"===a};h.getIconPath=function(a){return"text/plain"===a?d+"text-32.svg":"application/pdf"===a?d+"pdf-32.svg":"text/csv"===a?d+"csv-32.svg":"application/gpx+xml"===a?d+"gpx-32.svg":"application/x-dwf"===a?d+"cad-32.svg":"application/postscript"===a||"application/json"===a||"text/xml"===a||"model/vrml"===a?d+"code-32.svg":"application/x-zip-compressed"===a||"application/x-7z-compressed"===a||"application/x-gzip"===
a||"application/x-tar"===a||"application/x-gtar"===a||"application/x-bzip2"===a||"application/gzip"===a||"application/x-compress"===a||"application/x-apple-diskimage"===a||"application/x-rar-compressed"===a||"application/zip"===a?d+"zip-32.svg":-1!==a.indexOf("image/")?d+"image-32.svg":-1!==a.indexOf("audio/")?d+"sound-32.svg":-1!==a.indexOf("video/")?d+"video-32.svg":-1!==a.indexOf("msexcel")||-1!==a.indexOf("ms-excel")||-1!==a.indexOf("spreadsheetml")?d+"excel-32.svg":-1!==a.indexOf("msword")||
-1!==a.indexOf("ms-word")||-1!==a.indexOf("wordprocessingml")?d+"word-32.svg":-1!==a.indexOf("powerpoint")||-1!==a.indexOf("presentationml")?d+"report-32.svg":d+"generic-32.svg"}})},"esri/widgets/support/uriUtils":function(){define(["require","exports","dojo/i18n!./nls/uriUtils","../../core/lang"],function(p,h,d,a){function g(a){var d=null;f.some(function(e){e.pattern.test(a)&&(d=e);return!!d});return d}Object.defineProperty(h,"__esModule",{value:!0});var f=[{id:"http",pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,
target:"_blank",label:d.view},{id:"tel",pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"mailto",pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"arcgis-appstudio-player",pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:d.openInApp,appName:"App Studio Player"},{id:"arcgis-collector",pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:d.openInApp,appName:"Collector"},{id:"arcgis-explorer",pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:d.openInApp,
appName:"Explorer"},{id:"arcgis-navigator",pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:d.openInApp,appName:"Navigator"},{id:"arcgis-survey123",pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:d.openInApp,appName:"Survey123"},{id:"arcgis-trek2there",pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:d.openInApp,appName:"Trek2There"},{id:"arcgis-workforce",pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:d.openInApp,appName:d.workforce},{id:"iform",pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,
label:d.openInApp,appName:"iForm"},{id:"flow",pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:d.openInApp,appName:"FlowFinity"},{id:"lfmobile",pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:d.openInApp,appName:"Laserfische"},{id:"mspbi",pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:d.openInApp,appName:"Microsoft Power Bi"}];h.autoLink=function(d){if("string"!==typeof d||!d)return d;var f=g(d);if(!f)return d;var e=d.match(f.pattern),e=a.substitute({appName:f.appName,hierPart:e&&e[2]},f.label);return d.replace(f.pattern,
"\x3ca "+(f.target?'target\x3d"'+f.target+'"':"")+'" href\x3d"$1"\x3e'+e+"\x3c/a\x3e")}})},"esri/widgets/Spinner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./support/AnchorElementViewModel ./support/widget".split(" "),function(p,h,d,a,g,f,k,m,e,b){return function(l){function m(a){a=l.call(this)||this;a._animationDelay=500;a._animationPromise=null;a.location=
null;a.view=null;a.visible=!1;a.viewModel=new e;return a}d(m,l);m.prototype.postInitialize=function(){var a=this;this.own([f.watch(this,"visible",function(b){return a._visibleChange(b)})])};m.prototype.destroy=function(){this._cancelAnimationPromise()};m.prototype.show=function(a){var b=this,e=a.location;a=a.promise;e&&(this.viewModel.location=e);this.visible=!0;a&&a.always(function(){return b.hide()})};m.prototype.hide=function(){this.visible=!1};m.prototype.render=function(){var a=this.visible,
e=!!this.viewModel.screenLocation,a=(d={},d["esri-spinner--start"]=a&&e,d["esri-spinner--finish"]=!a&&e,d),d=this._getPositionStyles();return b.tsx("div",{class:"esri-spinner",classes:a,styles:d});var d};m.prototype._cancelAnimationPromise=function(){this._animationPromise&&(this._animationPromise.cancel(),this._animationPromise=null)};m.prototype._visibleChange=function(a){var b=this;a?this.viewModel.screenLocationEnabled=!0:(this._cancelAnimationPromise(),this._animationPromise=g.after(this._animationDelay).then(function(){b.viewModel.screenLocationEnabled=
!1;b._animationPromise=null}))};m.prototype._getPositionStyles=function(){var a=this.viewModel,b=a.screenLocation,a=a.view;if(!a||!b)return{};a=a.padding;return{left:b.x-a.left+"px",top:b.y-a.top+"px"}};a([k.aliasOf("viewModel.location")],m.prototype,"location",void 0);a([k.aliasOf("viewModel.view")],m.prototype,"view",void 0);a([k.property(),b.renderable()],m.prototype,"visible",void 0);a([k.property({type:e}),b.renderable(["viewModel.screenLocation","viewModel.screenLocationEnabled"])],m.prototype,
"viewModel",void 0);return m=a([k.subclass("esri.widgets.Spinner")],m)}(k.declared(m))})},"esri/widgets/support/AnchorElementViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),function(p,h,d,a,g,f,k,m,e,b){return function(f){function g(){var a=f.call(this)||this;a._anchorHandles=
new k;a.location=null;a.screenLocation=null;a.screenLocationEnabled=!1;a.view=null;a._anchorHandles.add([e.watch(a,"screenLocationEnabled,location,view.size",function(){return a._updateScreenPointAndHandle()}),e.watch(a,"view, view.ready",function(){return a._wireUpView()})]);return a}d(g,f);g.prototype.destroy=function(){this.view=null;this._anchorHandles&&this._anchorHandles.destroy();this._viewpointHandle=this._anchorHandles=null};g.prototype._wireUpView=function(){var a=this;this._anchorHandles.remove("view");
this._viewpointHandle=null;if(this.get("view.ready")){this._setScreenLocation();var b=this.view,b=m.pausable(b,"3d"===b.type?"camera":"viewpoint",function(){return a._viewpointChange()});this._anchorHandles.add(b,"view");this._viewpointHandle=b;this._toggleWatchingViewpoint()}};g.prototype._viewpointChange=function(){this._setScreenLocation();this.emit("view-change")};g.prototype._updateScreenPointAndHandle=function(){this._setScreenLocation();this._toggleWatchingViewpoint()};g.prototype._toggleWatchingViewpoint=
function(){var a=this._viewpointHandle,b=this.screenLocationEnabled;a&&(this.location&&b?a.resume():a.pause())};g.prototype._setScreenLocation=function(){var a=this.location,b=this.view,e=this.screenLocationEnabled,d=this.get("view.ready"),a=e&&a&&d?b.toScreen(a):null;this._set("screenLocation",a)};a([b.property()],g.prototype,"location",void 0);a([b.property({readOnly:!0})],g.prototype,"screenLocation",void 0);a([b.property()],g.prototype,"screenLocationEnabled",void 0);a([b.property()],g.prototype,
"view",void 0);return g=a([b.subclass("esri.widgets.support.AnchorElementViewModel")],g)}(b.declared(g,f))})},"esri/widgets/Popup/PopupViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/Collection ../../core/Error ../../core/Handles ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/Point ../../geometry/support/webMercatorUtils ../../support/Action ../support/AnchorElementViewModel".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v){function q(a,c){return c.allLayerViews.find(function(c){return c.layer===a})}p=new r({id:"zoom-to"});var n=new (f.ofType(r))([p]);return function(v){function c(c){c=v.call(this)||this;c._handles=new m;c._originalActions=null;c._pendingPromises=new Set;c.actions=n;c.goToOptions=null;c.autoCloseEnabled=!1;c.content=null;c.highlightEnabled=!0;c.title=null;c.updateLocationEnabled=!1;c.view=null;c.visible=!1;c.zoomFactor=4;return c}d(c,v);c.prototype.initialize=
function(){this._handles.add([this.on("view-change",this._autoClose),b.watch(this,["highlightEnabled","selectedFeature","visible","view"],this._highlightFeature),b.watch(this,"selectedFeature.popupTemplate.actions",this._getSelectedFeatureActions),b.watch(this,"selectedFeature.popupTemplate.overwriteActions",this._getSelectedFeatureActions)])};c.prototype.destroy=function(){this._handles.destroy();this._handles=null;this._pendingPromises.clear();this.view=null};Object.defineProperty(c.prototype,"featureCount",
{get:function(){return this.features.length},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"features",{get:function(){return this._get("features")||[]},set:function(c){c=c||[];this._set("features",c);var a=this.pendingPromisesCount,b=this.selectedFeatureIndex,e=this.promiseCount&&c.length;e&&a&&-1===b?this.selectedFeatureIndex=0:e&&-1!==b||(this.selectedFeatureIndex=c.length?0:-1)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"location",{get:function(){return this._get("location")||
null},set:function(c){var a=this.get("location"),b=this.get("view.spatialReference.isWebMercator");c&&c.get("spatialReference.isWGS84")&&b&&(c=u.geographicToWebMercator(c));this._set("location",c);c!==a&&this._centerAtLocation()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"pendingPromisesCount",{get:function(){return this._pendingPromises.size},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"waitingForResult",{get:function(){return 0<this.pendingPromisesCount&&
0===this.featureCount},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"promiseCount",{get:function(){return this.promises.length},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"promises",{get:function(){return this._get("promises")||[]},set:function(c){var a=this,b=this._get("promises");b&&b.forEach(function(c){c&&"function"===typeof c.cancel&&c.cancel()});this._pendingPromises.clear();this.features=[];Array.isArray(c)&&c.length?(this._set("promises",c),c=c.slice(0),
c.forEach(function(c){a._pendingPromises.add(c);var b=function(b){a._pendingPromises.has(c)&&(a._pendingPromises.delete(c),a.notifyChange("pendingPromisesCount"),a._updateFeatures(c,b))};c.then(b,b)})):this._set("promises",[]);this.notifyChange("pendingPromisesCount")},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"selectedFeature",{get:function(){var c=this.selectedFeatureIndex;if(-1===c)return null;c=this.features[c];if(!c)return null;this.updateLocationEnabled&&(this.location=
this._getPointFromGeometry(c.geometry));return c},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"selectedFeatureIndex",{get:function(){var c=this._get("selectedFeatureIndex");return"number"===typeof c?c:-1},set:function(c){var a=this.featureCount;c=isNaN(c)||-1>c||!a?-1:(c+a)%a;this._set("selectedFeatureIndex",c)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});
c.prototype.centerAtLocation=function(){var c=this.location,a=this.view;return c&&a?a.goTo({target:c,scale:a.scale},this.goToOptions):e.reject(new k(this.declaredClass+"::Cannot center at location without a location and view."))};c.prototype.clear=function(){this.set({promises:[],features:[],content:null,title:null,location:null})};c.prototype.open=function(c){this.set(g({visible:!1},{updateLocationEnabled:!1,promises:[]},c));this._setVisibleWhenContentExists()};c.prototype.triggerAction=function(c){(c=
this.actions.getItemAt(c))&&this.emit("trigger-action",{action:c})};c.prototype.next=function(){this.selectedFeatureIndex+=1;return this};c.prototype.previous=function(){--this.selectedFeatureIndex;return this};c.prototype.zoomToLocation=function(){var c=this,a=this.location,b=this.selectedFeature,d=this.view,f=this.zoomFactor;if(!a||!d)return e.reject(new k(this.declaredClass+"::Cannot zoom to location without a location and view."));var f=d.scale/f,g=this.get("selectedFeature.geometry"),n=b&&"3d"===
d.type,a=(n=g||n)?b:a,l=n&&g&&"point"===g.type&&this._isScreenSize(b);return d.goTo({target:a,scale:l?f:void 0},this.goToOptions).then(function(){l&&"point"===g.type&&(c.location=g)})};c.prototype._setVisibleWhenContentExists=function(){var c=this,a=this._handles,e=this.promiseCount;a.remove("pendingVisible");e?(e=b.init(this,"pendingPromisesCount",function(b){c.featureCount&&(c.set("visible",!0),a.remove("pendingVisible"));b||a.remove("pendingVisible")}),a.add(e,"pendingVisible")):this.set("visible",
!0)};c.prototype._autoClose=function(){this.autoCloseEnabled&&(this.visible=!1)};c.prototype._isScreenSize=function(c){var a=this.view;if("3d"!==a.type||"esri.Graphic"!==c.declaredClass)return!0;if((a=a.getViewForGraphic(c))&&a.whenGraphicBounds){var b=!1;a.whenGraphicBounds(c,{useViewElevation:!0}).then(function(c){b=!c||!c.boundingBox||c.boundingBox[0]===c.boundingBox[3]&&c.boundingBox[1]===c.boundingBox[4]&&c.boundingBox[2]===c.boundingBox[5]});return b}return!0};c.prototype._getSelectedFeatureActions=
function(){this._originalActions&&(this.actions=this._originalActions,this._originalActions=null);var c=this.actions.filter(function(c){return!c.temporary}),a=this.get("selectedFeature.popupTemplate");a&&a.overwriteActions&&(this._originalActions=c);this.actions=this._getNewActions(a,c)};c.prototype._getNewActions=function(c,a){if(!c||!c.actions)return a;var b=c.actions;b.forEach(function(c){c.temporary=!0});return c.overwriteActions?b:a.concat(b)};c.prototype._getPointFromGeometry=function(c){return c?
"point"===c.type?c:"extent"===c.type?c.center:"polygon"===c.type?c.centroid:"multipoint"===c.type||"polyline"===c.type?c.extent.center:null:null};c.prototype._centerAtLocation=function(){var c=this.location,a=this.updateLocationEnabled,b=this.get("view.extent");a&&b&&c&&!b.contains(c)&&this.centerAtLocation()};c.prototype._highlightFeature=function(){this._handles.remove("highlight");var c=this.selectedFeature,a=this.highlightEnabled,b=this.view,e=this.visible;c&&b&&a&&e&&(a=c.layer)&&(b=q(a,b))&&
"function"===typeof b.highlight&&(a=a.objectIdField,e=c.attributes,c=b.highlight(e&&e[a]||c,{}),this._handles.add(c,"highlight"))};c.prototype._updateFeatures=function(c,a){var b=this.features;c&&a&&a.length&&!(!this._validatePromise(c)||a instanceof k||a instanceof Error)&&(b.length?(c=a.filter(function(c){return-1===b.indexOf(c)}),this.features=b.concat(c)):this.features=a)};c.prototype._validatePromise=function(c){return c&&(!c.isCanceled||!c.isCanceled())};a([l.property({type:f.ofType(r)})],c.prototype,
"actions",void 0);a([l.property()],c.prototype,"goToOptions",void 0);a([l.property()],c.prototype,"autoCloseEnabled",void 0);a([l.property()],c.prototype,"content",void 0);a([l.property({readOnly:!0,dependsOn:["features"]})],c.prototype,"featureCount",null);a([l.property()],c.prototype,"features",null);a([l.property()],c.prototype,"highlightEnabled",void 0);a([l.property({type:t})],c.prototype,"location",null);a([l.property({readOnly:!0,dependsOn:["promises"]})],c.prototype,"pendingPromisesCount",
null);a([l.property({readOnly:!0,dependsOn:["featureCount","pendingPromisesCount"]})],c.prototype,"waitingForResult",null);a([l.property({readOnly:!0,dependsOn:["promises"]})],c.prototype,"promiseCount",null);a([l.property()],c.prototype,"promises",null);a([l.property({value:null,readOnly:!0,dependsOn:["features","selectedFeatureIndex","updateLocationEnabled"]})],c.prototype,"selectedFeature",null);a([l.property({value:-1})],c.prototype,"selectedFeatureIndex",null);a([l.property({readOnly:!0,dependsOn:["view.ready"]})],
c.prototype,"state",null);a([l.property()],c.prototype,"title",void 0);a([l.property()],c.prototype,"updateLocationEnabled",void 0);a([l.property()],c.prototype,"view",void 0);a([l.property()],c.prototype,"visible",void 0);a([l.property()],c.prototype,"zoomFactor",void 0);a([l.property()],c.prototype,"centerAtLocation",null);a([l.property()],c.prototype,"clear",null);a([l.property()],c.prototype,"triggerAction",null);a([l.property()],c.prototype,"next",null);a([l.property()],c.prototype,"previous",
null);a([l.property()],c.prototype,"zoomToLocation",null);return c=a([l.subclass("esri.widgets.Popup.PopupViewModel")],c)}(l.declared(v))})},"esri/views/3d/constraints/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ./AltitudeConstraint ./ClipDistanceConstraint ./CollisionConstraint ./TiltConstraint".split(" "),function(p,h,d,a,g,f,k,m,e,b){Object.defineProperty(h,
"__esModule",{value:!0});p=function(g){function l(){var a=null!==g&&g.apply(this,arguments)||this;a.tilt=new b.default;a.altitude=new k.default;a.clipDistance=new m.default;a.collision=new e.default;return a}d(l,g);a([f.property({type:b.default})],l.prototype,"tilt",void 0);a([f.property({type:k.default})],l.prototype,"altitude",void 0);a([f.property({type:m.default})],l.prototype,"clipDistance",void 0);a([f.property({type:e.default})],l.prototype,"collision",void 0);return l=a([f.subclass("esri.views.3d.constraints.Constraints")],
l)}(f.declared(g));h.Constraints=p;h.default=p})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/kernel ../../../core/Accessor ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),function(p,h,d,a,g,f,k,m){Object.defineProperty(h,"__esModule",{value:!0});p=function(e){function b(){var a=null!==e&&e.apply(this,arguments)||this;a.min=m.AltitudeDefault.min;
a.max=m.AltitudeDefault.max;return a}d(b,e);Object.defineProperty(b.prototype,"mode",{get:function(){g.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.","","4.6");return"manual"},set:function(a){g.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",
"","4.6")},enumerable:!0,configurable:!0});a([k.property({type:Number})],b.prototype,"min",void 0);a([k.property({type:Number})],b.prototype,"max",void 0);return b=a([k.subclass("esri.views.3d.constraints.AltitudeConstraint")],b)}(k.declared(f));h.AltitudeConstraint=p;h.default=p})},"esri/views/3d/state/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Logger ../../../core/accessorSupport/decorators ../support/earthUtils ../support/mathUtils".split(" "),
function(p,h,d,a,g,f,k,m,e){Object.defineProperty(h,"__esModule",{value:!0});var b=f.getLogger("esri.views.3d.state.Constraints");p=function(f){function g(a){a=f.call(this)||this;a.collision=new t;a.distance=Infinity;a.minimumPoiDistance=4;return a}d(g,f);Object.defineProperty(g.prototype,"altitude",{get:function(){return"local"===this.mode?null:this._get("altitude")||null},set:function(a){"local"===this.mode?b.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",a)},enumerable:!0,
configurable:!0});g.prototype.clampAltitude=function(a){return this.altitude?e.clamp(a,this.altitude.min,this.altitude.max):a};g.prototype.clampTilt=function(a,b){if(!this.tilt)return b;a=this.tilt(a);return e.clamp(b,a.min,a.max)};g.prototype.clampDistance=function(a){return Math.min(a,this.distance)};g.prototype.createDefaultTilt=function(){return"local"===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()};g.prototype.createConstantMaxTilt=function(a){return function(b,e){void 0===
e&&(e=l);e.min=h.TiltDefault.min;e.max=a;return e}};g.prototype.createDefaultTiltLocal=function(){var a=e.makePiecewiseLinearFunction([[4E3,h.TiltDefault.max],[1E4,e.deg2rad(88)],[6E6,e.deg2rad(88)]]);return function(b,e){void 0===e&&(e=l);e.min=h.TiltDefault.min;e.max=a(b);return e}};g.prototype.createDefaultTiltGlobal=function(){var a=e.makePiecewiseLinearFunction([[4E3,h.TiltDefault.max],[5E4,e.deg2rad(88)],[6E6,e.deg2rad(88)],[2E7,h.TiltDefault.min]]);return function(b,e){void 0===e&&(e=l);e.min=
h.TiltDefault.min;e.max=a(b);return e}};a([k.property()],g.prototype,"altitude",null);a([k.property({readOnly:!0})],g.prototype,"collision",void 0);a([k.property()],g.prototype,"distance",void 0);a([k.property({readOnly:!0})],g.prototype,"minimumPoiDistance",void 0);a([k.property()],g.prototype,"tilt",void 0);a([k.property({constructOnly:!0})],g.prototype,"mode",void 0);return g=a([k.subclass("esri.views.3d.state.Constraints")],g)}(k.declared(g));h.Constraints=p;h.AltitudeDefault={min:-m.earthRadius,
max:4*m.earthRadius};h.TiltDefault={min:e.deg2rad(.5),max:e.deg2rad(179.5)};var l={min:0,max:0},t=function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a.enabled=!0;a.elevationMargin=5;return a}d(e,b);a([k.property({type:Boolean})],e.prototype,"enabled",void 0);a([k.property({type:Number})],e.prototype,"elevationMargin",void 0);return e=a([k.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],e)}(k.declared(g));h.default=p})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(p,h,d,a,g,f){Object.defineProperty(h,"__esModule",{value:!0});p=function(g){function k(){var a=null!==g&&g.apply(this,arguments)||this;a.mode="auto";return a}d(k,g);Object.defineProperty(k.prototype,"near",{get:function(){return this._get("near")},set:function(a){this._set("near",a);a>=this._get("far")&&(this.far=a+1E-9);this.mode="manual"},enumerable:!0,configurable:!0});k.prototype.castNear=function(a){return Math.max(1E-8,a)};Object.defineProperty(k.prototype,"far",{get:function(){return this._get("far")},
set:function(a){this._set("far",a);a<=this._get("near")&&(this.near=a-1E-9);this.mode="manual"},enumerable:!0,configurable:!0});k.prototype.castFar=function(a){return Math.max(1E-8,a)};k.prototype.autoUpdate=function(a,b){"auto"===this.mode&&(this._get("near")!==a&&this._set("near",a),this._get("far")!==b&&this._set("far",b))};a([f.property({type:Number,value:1E-8})],k.prototype,"near",null);a([f.cast("near")],k.prototype,"castNear",null);a([f.property({type:Number,value:1E-8})],k.prototype,"far",
null);a([f.cast("far")],k.prototype,"castFar",null);a([f.property({type:String})],k.prototype,"mode",void 0);return k=a([f.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],k)}(f.declared(g));h.ClipDistanceConstraint=p;h.default=p})},"esri/views/3d/constraints/CollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(p,h,
d,a,g,f){Object.defineProperty(h,"__esModule",{value:!0});p=function(g){function k(){var a=null!==g&&g.apply(this,arguments)||this;a.enabled=!0;return a}d(k,g);a([f.property()],k.prototype,"enabled",void 0);return k=a([f.subclass("esri.views.3d.constraints.CollisionConstraint")],k)}(f.declared(g));h.CollisionConstraint=p;h.default=p})},"esri/views/3d/constraints/TiltConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../state/Constraints ../support/mathUtils".split(" "),
function(p,h,d,a,g,f,k,m){Object.defineProperty(h,"__esModule",{value:!0});var e=m.rad2deg(k.TiltDefault.min),b=m.rad2deg(k.TiltDefault.max);p=function(g){function k(){var a=null!==g&&g.apply(this,arguments)||this;a.mode="auto";return a}d(k,g);Object.defineProperty(k.prototype,"max",{get:function(){return this._get("max")},set:function(a){this._set("max",a);this.mode="manual"},enumerable:!0,configurable:!0});k.prototype.castMax=function(a){return m.clamp(a,e,b)};k.prototype.autoUpdate=function(a){"auto"===
this.mode&&this._get("max")!==a&&this._set("max",a)};a([f.property({type:String})],k.prototype,"mode",void 0);a([f.property({type:Number,value:b})],k.prototype,"max",null);a([f.cast("max")],k.prototype,"castMax",null);return k=a([f.subclass("esri.views.3d.constraints.TiltConstraint")],k)}(f.declared(g));h.TiltConstraint=p;h.default=p})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ./SceneViewAtmosphere ./SceneViewLighting ../../../webscene/Environment ../../../webscene/Lighting".split(" "),
function(p,h,d,a,g,f,k,m,e){Object.defineProperty(h,"__esModule",{value:!0});p=function(b){function l(){var a=null!==b&&b.apply(this,arguments)||this;a.atmosphere=new f.default;a.atmosphereEnabled=!0;a.starsEnabled=!0;return a}d(l,b);m=l;Object.defineProperty(l.prototype,"lighting",{set:function(a){if(a)if(this.lighting)null!=a.date&&(this.lighting.date=a.date),null!=a.defaultDate&&(this.lighting.defaultDate=a.defaultDate),null!=a.displayUTCOffset&&(this.lighting.displayUTCOffset=a.displayUTCOffset),
this.lighting.directShadowsEnabled=a.directShadowsEnabled,null!=a.ambientOcclusionEnabled&&(this.lighting.ambientOcclusionEnabled=a.ambientOcclusionEnabled),null!=a.cameraTrackingEnabled&&(this.lighting.cameraTrackingEnabled=a.cameraTrackingEnabled);else if(a instanceof k.default)this._set("lighting",a);else if(a instanceof e){var b={directShadowsEnabled:a.directShadowsEnabled};null!=a.date&&(b.date=a.date);null!=a.displayUTCOffset&&(b.displayUTCOffset=a.displayUTCOffset);null!=a.defaultDate&&(b.defaultDate=
a.defaultDate);this._set("lighting",new k.default(b))}else this._set("lighting",new k.default(a));else this.lighting||this._set("lighting",new k.default)},enumerable:!0,configurable:!0});l.prototype.clone=function(){return new m({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled})};a([g.property({type:f.default,json:{read:!1}})],l.prototype,"atmosphere",void 0);a([g.property({type:Boolean,json:{read:!1}})],l.prototype,
"atmosphereEnabled",void 0);a([g.property({type:Boolean,json:{read:!1}})],l.prototype,"starsEnabled",void 0);a([g.property()],l.prototype,"lighting",null);return l=m=a([g.subclass("esri.views.3d.environment.SceneViewEnvironment")],l);var m}(g.declared(m));h.SceneViewEnvironment=p;h.default=p})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(p,h,d,a,g,f){Object.defineProperty(h,"__esModule",{value:!0});p=function(g){function k(){return null!==g&&g.apply(this,arguments)||this}d(k,g);Object.defineProperty(k.prototype,"quality",{set:function(a){-1!==["low","high"].indexOf(a)&&this._set("quality",a)},enumerable:!0,configurable:!0});k.prototype.clone=function(){return new this.constructor({quality:this.quality})};a([f.property({type:String,value:"low"})],k.prototype,"quality",null);return k=a([f.subclass("esri.views.3d.environment.SceneViewAtmosphere")],
k)}(f.declared(g));h.SceneViewAtmosphere=p;h.default=p})},"esri/views/3d/environment/SceneViewLighting":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Evented ../../../core/accessorSupport/decorators ../../../webscene/Lighting".split(" "),function(p,h,d,a,g,f,k){Object.defineProperty(h,"__esModule",{value:!0});p=function(g){function k(a){a=g.call(this)||this;a.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};
a.cameraTrackingEnabled=!0;a.ambientOcclusionEnabled=!1;var b=(new Date).getFullYear(),b=new Date("March 15, "+b+" 12:00:00 UTC");a._set("defaultDate",b);a._set("date",b);return a}d(k,g);Object.defineProperty(k.prototype,"defaultDate",{get:function(){return new Date(this._get("defaultDate").getTime())},set:function(a){var b=this._get("date")===this._get("defaultDate");a=new Date(a.getTime());this._set("defaultDate",a);b&&this._set("date",a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,
"date",{set:function(a){null!=a&&(this._set("date",new Date(a.getTime())),this.positionTimezoneInfo.autoUpdated=!1,this._emitDateWillChange())},enumerable:!0,configurable:!0});k.prototype.autoUpdate=function(a,e){var d=this._calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=e.hours;this.positionTimezoneInfo.minutes=e.minutes;this.positionTimezoneInfo.seconds=e.seconds;e=null;null!=a&&(this.positionTimezoneInfo.autoUpdated=!0,e=this.date&&this.date.getTime(),this._set("date",
new Date(a.getTime())),this._emitDateWillChange());var f=this._calculateTimezoneOffset(this.positionTimezoneInfo);d!==f&&(b.target=this,b.timezoneOffset=f,this.emit("timezone-will-change",b));if(null!=a)return e!==a.getTime()};k.prototype._calculateTimezoneOffset=function(a){return Math.round(a.hours+a.minutes/60+a.seconds/3600)};k.prototype._emitDateWillChange=function(){e.target=this;m.setTime(this._get("date").getTime());e.date=m;this.emit("date-will-change",e)};a([f.property({type:Boolean})],
k.prototype,"cameraTrackingEnabled",void 0);a([f.property({type:Boolean})],k.prototype,"ambientOcclusionEnabled",void 0);a([f.property({type:Date})],k.prototype,"defaultDate",null);a([f.property({type:Date})],k.prototype,"date",null);return k=a([f.subclass("esri.views.3d.environment.SceneViewLighting")],k)}(f.declared(k,g));h.SceneViewLighting=p;var m=new Date,e={target:null,date:null},b={target:null,timezoneOffset:0};h.default=p})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Evented ../../../core/Handles ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./EnvironmentRenderer ../lib/glMatrix ../support/earthUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w){Object.defineProperty(h,"__esModule",{value:!0});var c=[.5773502691896258,-.5773502691896258,.5773502691896258];p=function(f){function g(c){c=f.call(this)||this;c.referencePointUpdateDelay=200;c.referencePointUpdateInterval=3E3;c.referencePointUpdateDistThreshold=1E6;c._referencePosUpdateQuery=null;c._referencePosMapCoordsRequested=null;c._viewHandles=new k;c._preserveAbsoluteDateTime=!1;c._trackingEnabled=!1;c._viewConnected=!1;c._referencePosResetPreserveAbsoluteTime=
!1;c._referencePosUpdateTimer=null;c._referencePosWGS84=null;c._referencePosMapCoords=null;c._mainLight=new w.MainLight;c._ambientLight=new w.AmbientLight;c._moonLight=new w.FillLight;c._environmentRenderer=null;c._resetReferencePosition();return c}d(g,f);g.prototype.destroy=function(){this._viewHandles.destroy();this.disposeRendering()};Object.defineProperty(g.prototype,"updating",{get:function(){return!this.noReferencePositionQueries&&(!!this._referencePosUpdateQuery||!!this._referencePosMapCoordsRequested)},
enumerable:!0,configurable:!0});g.prototype.updateReadyChange=function(c){c&&!this._viewConnected?(this._viewConnected=!0,this.connectView(this.view)):!c&&this._viewConnected&&(this._viewConnected=!1,this.disconnectView(this.view))};g.prototype.disposeRendering=function(){this._environmentRenderer&&(this._environmentRenderer.destroy(),this._environmentRenderer=null);this._resetReferencePosition(!0)};g.prototype.connectView=function(c){this._environmentRenderer=new r({view:c});this._viewHandles.add([e.on(this.view,
"environment.lighting","date-will-change",this._lightingDateHandler.bind(this)),this.view.watch("interacting,stationary",this._interactingStationaryHandler.bind(this)),this.view.watch("environment.lighting.directShadowsEnabled,environment.lighting.ambientOcclusionEnabled",this._updateRenderParamsHandler.bind(this)),this.view.watch("spatialReference",this._spatialReferenceHandler.bind(this)),e.init(this.view,"viewingMode",this._viewingModeHandler.bind(this)),e.init(this.view,"environment.lighting.cameraTrackingEnabled",
this._updateCameraTracking.bind(this),!0),this.watch("noReferencePositionQueries",this._cameraHandler.bind(this,null))]);this._updateRenderParamsHandler();this._updateLightParams();this._cameraHandler()};g.prototype._updateCameraTracking=function(c){if(this._trackingEnabled=c)c=e.init(this,"view.state.camera",this._cameraHandler.bind(this,null),!0),this._viewHandles.add(c,"camera");else{if(c=this.get("view.environment.lighting"))c.positionTimezoneInfo.autoUpdated=!1;this._viewHandles.remove("camera")}};
g.prototype.disconnectView=function(c){this.disposeRendering();this._viewHandles.removeAll()};g.prototype._lightingDateHandler=function(c){if(c=c.date){var a=this.view.environment.lighting;if(!a.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;var b=this.view.spatialReference;if(!(b.isWGS84||b.isWebMercator||(b=this.view.camera.position,this._referencePosMapCoords&&this._referencePosMapCoords.equals(b)))){this._requestReferencePositionUpdate(b);return}this._preupdateTracking(c);
this._referencePosWGS84&&(b=q.positionToTimezone(this._referencePosWGS84,z),a.autoUpdate(null,b),this._trackingEnabled&&(a.positionTimezoneInfo.autoUpdated=!0))}this._updateLightParams(c)}};g.prototype._preupdateTracking=function(c){!this._trackingEnabled&&this.get("view.environment.lighting.cameraTrackingEnabled")&&this._cameraHandler(c)};g.prototype._cameraHandler=function(c){void 0===c&&(c=null);if(this.view.ready){var a=this.view.camera;if(a){var b=this.view.spatialReference;b.isWGS84||b.isWebMercator?
this._cameraHandlerGlobal(a,c):this._cameraHandlerLocal(a,c)}}};g.prototype._cameraHandlerGlobal=function(c,a){c=c.position;this._referencePosWGS84||(this._referencePosWGS84=new l({spatialReference:t.WGS84}));c.spatialReference.isWebMercator?u.webMercatorToGeographic(c,!1,this._referencePosWGS84):(this._referencePosWGS84.x=c.x,this._referencePosWGS84.y=c.y);this._referencePosWGS84.z=c.z;this._autoUpdateTimezone(c,a)||this._updateLightParams(a)};g.prototype._cameraHandlerLocal=function(c,a){c=c.position;
(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(c))&&this._requestReferencePositionUpdate(c,!0);this.view.mapCoordsHelper&&this._referencePosWGS84&&(this._referencePosWGS84.z=c.z*this.view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};g.prototype._interactingStationaryHandler=function(){!this.view.interacting&&this.view.stationary&&this._executePendingReferencePositionUpdate()};g.prototype._updateLightParams=function(a){void 0===
a&&(a=null);var b=this.view.environment.lighting;a=a||b.date;var b=this.view._stage,e;this._referencePosWGS84?(e=n.computeColorAndIntensity(a,this._referencePosWGS84),n.computeDirection(a,this._referencePosWGS84,this.view.viewingMode,e.diffuse.direction)):e={diffuse:{color:[1,1,1],intensity:.55,direction:c},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0};v.vec3d.scale(e.diffuse.color,e.diffuse.intensity*Math.PI,this._mainLight.intensity);v.vec3d.negate(e.diffuse.direction,this._mainLight.direction);
v.vec3d.scale(e.ambient.color,e.ambient.intensity,this._ambientLight.intensity);v.vec3d.lerp(A,y,e.globalFactor,this._moonLight.intensity);v.vec3d.scale(this._moonLight.intensity,(1-.5*e.globalFactor)*(1-.4*e.noonFactor*(1-e.globalFactor)));v.vec3d.set(e.diffuse.direction,this._moonLight.direction);b.setLighting({lights:[this._mainLight,this._ambientLight,this._moonLight],globalFactor:e.globalFactor,groundLightingFactor:1-e.noonFactor});this._updateRenderParamsHandler()};g.prototype._autoUpdateTimezone=
function(c,a){void 0===a&&(a=null);if(!this.view.get("environment.lighting.cameraTrackingEnabled"))return!1;var b=x;b.setTime((a||this.view.environment.lighting.date).getTime());c=q.positionToTimezone(c,z);var e=this.view.environment.lighting.positionTimezoneInfo;if(!e.autoUpdated)e=c;else if(e.hours===c.hours&&e.minutes===c.minutes&&e.seconds===c.seconds)return!1;var d=b.getUTCHours()-(c.hours-e.hours),f=b.getUTCMinutes()-(c.minutes-e.minutes),e=b.getUTCSeconds()-(c.seconds-e.seconds);b.setUTCHours(d);
b.setUTCMinutes(f);b.setUTCSeconds(e);return a?!1:this.view.environment.lighting.autoUpdate(b,c)};g.prototype._updateRenderParamsHandler=function(){var c=this.view._stage,a=!0;this._referencePosWGS84&&(a=n.computeShadowsEnabled(this._referencePosWGS84,this.view.viewingMode));c&&c.setRenderParams({shadowMap:this.view.environment.lighting.directShadowsEnabled&&a,ssao:this.view.environment.lighting.ambientOcclusionEnabled})};g.prototype._spatialReferenceHandler=function(){this._resetReferencePosition()};
g.prototype._viewingModeHandler=function(){this._resetReferencePosition()};g.prototype._resetReferencePosition=function(c){void 0===c&&(c=!1);this._cancelReferencePosUpdates();this._referencePosWGS84=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;c||this.notifyChange("updating")};g.prototype._requestReferencePositionUpdate=function(c,a){var b=this;void 0===a&&(a=!1);if(this.view.mapCoordsHelper.canProject()&&!this.noReferencePositionQueries&&
(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(c):this._referencePosMapCoordsRequested=c.clone(),this._referencePosResetPreserveAbsoluteTime=!!a,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&!this.view.interacting&&this.view.stationary)){var e=this._referencePosUpdateQuery=m.after(this.referencePointUpdateDelay).then(function(){if(b._referencePosUpdateQuery===e)return b._doReferencePositionUpdateQuery(function(){return b._referencePosUpdateQuery!==
e})}).always(function(){b._referencePosUpdateQuery===e&&(b._referencePosUpdateQuery=null,b._referencePosUpdateTimer||b._executePendingReferencePositionUpdate(),b.notifyChange("updating"))}),d=this._referencePosUpdateTimer=m.after(this.referencePointUpdateInterval).then(function(){b._referencePosUpdateTimer===d&&(b._referencePosUpdateTimer=null,b._referencePosUpdateQuery||b._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};g.prototype._doReferencePositionUpdateQuery=function(c){var a=
this;this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;return this.view.mapCoordsHelper.toGeographic(this._referencePosMapCoords).then(function(b){if(!c()&&!isNaN(b[0])&&!isNaN(b[1])){var e=a._referencePosMapCoords.z*
a.view.mapCoordsHelper.unitInMeters;a._referencePosWGS84?(a._referencePosWGS84.x=b[0],a._referencePosWGS84.y=b[1],a._referencePosWGS84.z=e):a._referencePosWGS84=new l({x:b[0],y:b[1],z:e,spatialReference:t.WGS84});a._referencePosChanged()}})};g.prototype._executePendingReferencePositionUpdate=function(){var c=this._referencePosMapCoordsRequested;c&&this._requestReferencePositionUpdate(c,this._referencePosResetPreserveAbsoluteTime)};g.prototype._referencePosChanged=function(){this._preserveAbsoluteDateTime?
this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84)||this._updateLightParams()};g.prototype._exceedsReferencePosDistThreshold=function(c){return this._referencePosMapCoords?(c=this._referencePosMapCoords.distance(c),this.view.mapCoordsHelper&&(c*=this.view.mapCoordsHelper.unitInMeters),c>this.referencePointUpdateDistThreshold):!0};g.prototype._cancelReferencePosUpdates=function(){this._referencePosUpdateTimer=this._referencePosUpdateQuery=null};g.FIXED_LIGHT_DIRECTION=c;a([b.property({type:Boolean,
dependsOn:["noReferencePositionQueries"],readOnly:!0})],g.prototype,"updating",null);a([b.property()],g.prototype,"noReferencePositionQueries",void 0);a([b.property({constructOnly:!0})],g.prototype,"view",void 0);a([b.property()],g.prototype,"_environmentRenderer",void 0);return g=a([b.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],g)}(b.declared(g,f));h.SceneViewEnvironmentManager=p;var x=new Date,z={hours:0,minutes:0,seconds:0},A=v.vec3d.createFrom(.22,.22,.33),y=v.vec3d.createFrom(.22,
.22,.22);h.default=p})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("../../../core/watchUtils ../support/ExternalRenderer ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars ../webgl-engine/lib/RenderSlot".split(" "),function(p,h,d,a,g,f,k){return h.createSubclass({declaredClass:"esri.views.3d.environment.EnvironmentRenderer",properties:{view:{},viewingMode:{dependsOn:["view.viewingMode"],get:function(){return this.get("view.viewingMode")||"global"}},atmosphereQuality:{dependsOn:["view.environment.atmosphereEnabled",
"view.environment.atmosphere.quality"],get:function(){return this.get("view.environment.atmosphereEnabled")?this.get("view.environment.atmosphere.quality")||"none":"none"}},starsEnabled:{dependsOn:["view.environment.starsEnabled"],get:function(){return this.get("view.environment.starsEnabled")||!1}},transparent:{dependsOn:["view.basemapTerrain.opacity","view.basemapTerrain.wireframe"],get:function(){var a=this.get("view.basemapTerrain");return a&&a._renderer.isTransparent()}},_atmosphere:{},_stars:{},
needsRender:{dependsOn:["_stars.needsRender","_atmosphere.needsRender"],get:function(){return!!(this._needsRender||this._atmosphere&&this._atmosphere.needsRender||this._stars&&this._stars.needsRender)}}},constructor:function(){this._slots=[k.POSTPROCESSING_ATMOSPHERE_OPAQUE,k.POSTPROCESSING_ATMOSPHERE_TRANSPARENT];this._stars=this._atmosphere=this._atmosphereReadyPromise=this._AtmosphereClass=null;this._needsRender=!0;this.notifyChange("needsRender")},initialize:function(){this.view._stage.addExternalRenderer(this._slots,
this);this._basemapTerrainHandle=p.when(this.view,"basemapTerrain",this._updateBasemapTerrain.bind(this))},destroy:function(){this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null);this._stars&&(this._stars.destroy(),this._stars=null);this._basemapTerrainHandle&&this._basemapTerrainHandle.remove();this.view&&(this.view._stage.removeExternalRenderer(this),this.view=null)},setup:function(a){this.watch("viewingMode,atmosphereQuality,transparent,visible",this._updateAtmosphere.bind(this));
this._updateAtmosphere();this.watch("starsEnabled,transparent,visible",this._updateStars.bind(this));this._updateStars();this.watch("view.basemapTerrain.loaded",function(){this._needsRender=!0;this.notifyChange("needsRender")}.bind(this))},resetNeedsRender:function(){this._atmosphere&&(this._atmosphere.resetNeedsRender?this._atmosphere.resetNeedsRender():this._atmosphere.didRender&&(this._atmosphere.needsRender=!1,this._atmosphere.didRender=!1));this._stars&&(this._stars.resetNeedsRender?this._stars.resetNeedsRender():
this._stars.didRender&&(this._stars.needsRender=!1,this._stars.didRender=!1));this.didRender&&(this.didRender=this._needsRender=!1,this.notifyChange("needsRender"))},render:function(a){if(!this.get("view.basemapTerrain.loaded")&&"global"===this.viewingMode)return!1;if(!this._stars&&!this._atmosphere)return!0;this._stars&&this._stars.render(a);this._atmosphere&&this._atmosphere.render(a);return this._stars&&this._stars.didRender||this._atmosphere&&this._atmosphere.didRender},_updateStars:function(){var a=
this._getSimpleAtmosphereSlot();this.starsEnabled&&!this._stars?(this._stars=new f({view:this.view,slot:a}),this._stars.initializeRenderContext(this.renderContext)):!this.starsEnabled&&this._stars?(this._stars.destroy(),this._stars=null):this._stars&&(this._stars.slot=a);this._needsRender=!0;this.notifyChange("needsRender")},_updateAtmosphere:function(){var a=this._getSimpleAtmosphereSlot();this._atmosphere&&(this._atmosphere.slot=a);if(this._updateAtmosphereClass(this.renderContext)){this._needsRender=
!0;this.notifyChange("needsRender");var e=function(){this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null)}.bind(this);if(this._AtmosphereClass){this._atmosphereReadyPromise&&(this._atmosphereReadyPromise.cancel(),this._atmosphereReadyPromise=null);var b=new this._AtmosphereClass({view:this.view,slot:a});b.initializeRenderContext(this.renderContext);this._atmosphere?this._atmosphereReadyPromise=b.when(function(){e();this._atmosphereReadyPromise=null;this._atmosphere=b}.bind(this)):
this._atmosphere=b;b.when(this._updateBasemapTerrain.bind(this))}else e(),this._updateBasemapTerrain()}},_updateAtmosphereClass:function(f){var e=this._AtmosphereClass;"none"===this.atmosphereQuality?this._AtmosphereClass=null:"high"===this.atmosphereQuality&&!this.transparent&&a.isSupported(f)?this._AtmosphereClass="local"===this.viewingMode?d:a:this._AtmosphereClass="local"===this.viewingMode?d:g;return this._AtmosphereClass!==e},_getSimpleAtmosphereSlot:function(){return this.transparent&&"global"===
this.viewingMode?k.POSTPROCESSING_ATMOSPHERE_TRANSPARENT:k.POSTPROCESSING_ATMOSPHERE_OPAQUE},_updateBasemapTerrain:function(){var d=this.get("view.basemapTerrain");d&&(d.velvetOverground=!(!this._AtmosphereClass||this._AtmosphereClass===a))}})})},"esri/views/3d/support/ExternalRenderer":function(){define("../../../core/declare ../../../core/Accessor ../../../core/Promise dojo/Deferred dojo/aspect dojo/_base/lang".split(" "),function(p,h,d,a,g,f){return p([h,d],{"-chains-":f.mixin(h._meta.chains,{setup:"after",
initializeRenderContext:"after",uninitializeRenderContext:"before"}),properties:{gl:{readOnly:!0,get:function(){return this._gl}},needsRender:{value:!0},visible:{value:!0}},constructor:function(){this.didRender=!1;this.renderContext=null;this.watch("visible",function(){this.needsRender=!0}.bind(this));this._contextDfd=new a},initialize:function(){this.addResolvingPromise(this._contextDfd.promise);g.around(this,"render",function(a){return function(){return this.isRejected()?this.didRender=!0:this.isResolved()?
!this.visible||a.apply(this,arguments)?this.didRender=!0:!1:!1}.bind(this)}.bind(this));this.when(function(){this.destroyed||this.setup(this.renderContext)}.bind(this))},needsRender:!0,visible:!0,initializeRenderContext:function(a){this.renderContext=a;this._contextDfd.resolve()},uninitializeRenderContext:function(a){},setup:function(a){},render:function(a){return!1}})})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("dojo/text!./materials/SimpleAtmosphereMaterial.xml dojo/Deferred ../support/ExternalRenderer ../lib/glMatrix ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/Texture ../webgl-engine/lib/Util ../webgl-engine/lib/GLTextureRep ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ./resources/SimpleAtmosphereTexture ../../webgl/Program ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/DefaultVertexAttributeLocations".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v){var q=a.vec2d,n=a.vec3d,w=a.mat4d,c=m.VertexAttrConstants,x=w.create();return d.createSubclass({declaredClass:"esri.views.3d.environment.PanoramicAtmosphere",properties:{view:{},needsRender:{value:!1},slot:{value:l.BACKGROUND,set:function(c){this.needsRender=!0;this._set("slot",c)}}},constructor:function(){this._renderData={texV:q.create(),silCircleCenter:n.create(),silCircleV1:n.create(),silCircleV2:n.create()};this._textureRep=this._texture=null;this.slot=
l.BACKGROUND},initialize:function(){this._textureDfd=new h;this.addResolvingPromise(this._textureDfd.promise)},destroy:function(){this._textureRep&&(this._texture&&(this._textureRep.release("SimpleAtmosphere"),this._textureRep.getTexture("SimpleAtmosphere").unload()),this._textureRep=null);this._program&&(this._program.dispose(),this._program=null);this._textureDfd&&(this._textureDfd.cancel(),this._textureDfd=null)},initializeRenderContext:function(c){this._textureRep=new e({SimpleAtmosphere:new k(t,
"SimpleAtmosphere",{wrapClamp:!0})},c.programRep,function(){return this.view.state.camera.viewport}.bind(this),c.rctx);this._texture=this._textureRep.aquire("SimpleAtmosphere",void 0,function(c){this._texture=c.getGLTexture();this._textureDfd.resolve();this._textureDfd=null}.bind(this))},setup:function(c){var a=this._createGeometryData(),b=this.renderContext.rctx;this._renderer=new g(a,r.Pos3,null,b);c.shaderSnippets.vsSimpleAtmosphere||c.shaderSnippets._parse(p);this._program=new u(b,c.shaderSnippets.vsSimpleAtmosphere,
c.shaderSnippets.fsSimpleAtmosphere,v.Default3D,["PANORAMIC"])},render:function(c){if(c.slot!==this.slot||c.pass!==b.MATERIAL||!this._textureRep.getIsLoaded("SimpleAtmosphere"))return!1;var a=this.renderContext.rctx,e=a.gl,d=this._program;a.bindProgram(d);a.bindTexture(this._texture);d.setUniform1i("tex",0);d.setUniformMatrix4fv("proj",c.camera.projectionMatrix);w.toRotationMat(c.camera.viewMatrix,x);d.setUniformMatrix4fv("view",x);d.setUniform4f("color",1,1,1,1);d.setUniform3fv("lightDirection",
c.lightingData.direction);a.setDepthTestEnabled(!0);a.setFaceCullingEnabled(!0);a.setDepthFunction(e.LEQUAL);a.setBlendingEnabled(!0);a.setDepthWriteEnabled(!1);this._renderer.render(this._program);a.setDepthWriteEnabled(!0);a.setBlendingEnabled(!1);a.setDepthFunction(e.LESS);a.setFaceCullingEnabled(!1);return!0},_createGeometryData:function(){for(var a=f.createPolySphereGeometry(1,2),b=a.indices[c.POSITION],e=0;e<b.length;e+=3){var d=b[e];b[e]=b[e+2];b[e+2]=d}b=a.getVertexAttr();d=b[c.NORMAL].data;
for(e=0;e<d.length;e++)d[e]=-d[e];return{indices:a.indices,vertexAttr:b}}})})},"esri/views/3d/webgl-engine/lib/GeometryRenderer":function(){define("require exports ./DefaultVertexAttributeLocations ./Util ../materials/internal/MaterialUtil ../../../webgl/BufferObject ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),function(p,h,d,a,g,f,k,m){return function(){function e(b,e,t,u){this._drawMode=4;this._count=b.indices[a.VertexAttrConstants.POSITION].length;var l=new Float32Array(this._count*
k.getStride(e)/4);t?t(b,void 0,void 0,null,e,l,0):g.fillInterleaved(b,void 0,void 0,null,e,l,0);this._rctx=u;this._vao=new m(u,d.Default3D,{geometry:e},{geometry:f.createVertex(u,35044,l)})}e.prototype.enablePointRendering=function(a){this._drawMode=a?0:4};e.prototype.render=function(a){var b=this._rctx;b.bindVAO(this._vao);k.assertCompatibleVertexAttributeLocations(this._vao,a);b.drawArrays(this._drawMode,0,this._count)};return e}()})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["require",
"exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});h.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,instanceColor:3,size:4,auxpos1:5,symbolColor:5,componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12}})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["require","exports","./gl-matrix"],function(p,h,d){function a(c,a){if(!c)throw c=Error("dummy"),c.stack&&console.log(c.stack),new M(a);}function g(c,
a,b){return c<a?a:c>b?b:c}function f(c){return c/180*Math.PI}function k(c){return 180*c/Math.PI}function m(c,a,b){d.mat4d.multiply(a,c,v);d.mat4d.inverse(v);for(c=0;8>c;++c)d.mat4d.multiplyVec4(v,q[c],n),d.vec3d.set3(n[0]/n[3],n[1]/n[3],n[2]/n[3],b[c])}function e(a,b,e,f){d.vec3d.subtract(a,b,c);d.vec3d.subtract(e,b,x);d.vec3d.cross(x,c,f);d.vec3d.normalize(f);f[3]=-d.vec3d.dot(f,a)}function b(c,a,b,e){var d=6378137/Math.sqrt(1-h.ECCENTRICITY_SQUARED*Math.pow(Math.sin(c),2)),f=Math.cos(c);e[0]=(d+
b)*Math.cos(a)*f;e[1]=(d*(1-h.ECCENTRICITY_SQUARED)+b)*Math.sin(c);e[2]=-(d+b)*Math.sin(a)*f}function l(c){for(var a in c)return a}function t(c,a){c[12]=a[0];c[13]=a[1];c[14]=a[2]}function u(c,a){void 0===a&&(a=0);for(var b=0,e=0;4>e;e++)b+=c[a+e]*R[e];return b}function r(c){return c-Math.floor(c)}Object.defineProperty(h,"__esModule",{value:!0});var v=d.mat4d.create(),q=[d.vec4d.createFrom(-1,-1,-1,1),d.vec4d.createFrom(1,-1,-1,1),d.vec4d.createFrom(1,1,-1,1),d.vec4d.createFrom(-1,1,-1,1),d.vec4d.createFrom(-1,
-1,1,1),d.vec4d.createFrom(1,-1,1,1),d.vec4d.createFrom(1,1,1,1),d.vec4d.createFrom(-1,1,1,1)],n=d.vec4d.create(),w=[d.vec3d.create(),d.vec3d.create(),d.vec3d.create(),d.vec3d.create(),d.vec3d.create(),d.vec3d.create(),d.vec3d.create(),d.vec3d.create()],c=d.vec3d.create(),x=d.vec3d.create(),z=d.vec3d.create(),A=d.vec3d.create(),y=d.vec3d.create(),B=d.vec3d.create(),E=d.vec3d.create(),C=d.vec3d.create(),G=d.vec3d.create(),J=d.vec3d.create(),F=d.vec3d.create(),I=d.vec3d.create(),H=d.vec3d.create(),
K=d.vec3d.create(),L=d.vec3d.createFrom(0,0,0),M=function(){function c(c){this.message=c}c.prototype.toString=function(){return"AssertException: "+this.message};return c}();h.AssertException=M;h.EARTH_RADIUS=6378137;h.METER2FEET=3.28084;h.ECCENTRICITY_SQUARED=.0066943799901414;h.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex"};
h.assert=a;h.verify=function(c,a){c||(console.log("Verify failed: "+a),console.log(Error("dummy").stack))};h.isPowerOfTwo=function(c){return 0===(c&c-1)};h.lerp=function(c,a,b){return c+(a-c)*b};h.clamp=g;h.encodeInt16=function(c){return g(Math.round(32767*c),-32767,32767)};h.encodeNormal=function(c,a){var b=Math.abs(c[0]),e=Math.abs(c[1]),d=1/(b+e+Math.abs(c[2])),b=b*d,e=e*d,d=Math.min(c[2]*d,0);a[0]=V(c[0])*(b-d);a[1]=V(c[1])*(e-d)};var V="function"===typeof Math.sign?Math.sign:function(c){return+(0<
c)-+(0>c)||0};h.fallbackIfUndefined=function(c,a){return void 0===c?a:c};h.hex2rgb=function(c){c=Math.floor(c);return[(c>>16&255)/255,(c>>8&255)/255,(c&255)/255]};h.rgb2hex=function(c){var a=g(Math.round(255*c[0]),0,255),b=g(Math.round(255*c[1]),0,255);c=g(Math.round(255*c[2]),0,255);return"0x"+((a<<16)+(b<<8)+c).toString(16)};h.dec2hex=function(c){c=c.toString(16);return"00000000".substr(0,8-c.length)+c};h.deg2rad=f;h.rad2deg=k;h.azimuthElevationAngle2Direction=function(c,a){c=1.5*Math.PI-c;a=.5*
Math.PI-a;return[Math.cos(c)*Math.sin(a),Math.cos(a),Math.sin(c)*Math.sin(a)]};h.rayPlane=function(c,a,b,e){var f=d.vec3d.dot(b,a);if(0===f)return!1;b=-(d.vec3d.dot(b,c)+b[3])/f;d.vec3d.add(c,d.vec3d.scale(a,b,e),e);return!0};h.raySphere=function(a,b,e,f,g){e=e||L;var n=d.vec3d.subtract(a,e,c);e=d.vec3d.dot(b,b);var k=2*d.vec3d.dot(b,n);f=d.vec3d.dot(n,n)-f*f;f=k*k-4*e*f;if(0>f)return!1;n=Math.sqrt(f);f=(-k-n)/(2*e);e=(-k+n)/(2*e);if(0>f||e<f&&0<e)f=e;return 0<f?(d.vec3d.add(a,d.vec3d.scale(b,f,K),
g),!0):!1};h.rayTriangle3D=function(c,a,b,e,f,g,n,k,l){void 0===l&&(l=d.vec3d.create());var q=e[n]-b[g],m=e[n+1]-b[g+1],r=e[n+2]-b[g+2];e=f[k]-b[g];n=f[k+1]-b[g+1];f=f[k+2]-b[g+2];var x=a[1]*f-n*a[2],v=a[2]*e-f*a[0],t=a[0]*n-e*a[1];k=q*x+m*v+r*t;if(-1E-5<k&&1E-5>k)return!1;k=1/k;var u=c[0]-b[g],h=c[1]-b[g+1];c=c[2]-b[g+2];l[1]=k*(u*x+h*v+c*t);if(0>l[1]||1<l[1])return!1;b=h*r-m*c;c=c*q-r*u;q=u*m-q*h;l[2]=k*(a[0]*b+a[1]*c+a[2]*q);if(0>l[2]||1<l[1]+l[2])return!1;l[0]=k*(e*b+n*c+f*q);return!0};h.rayBoxTest=
function(c,a,b,e){var d,f=(b[0]-c[0])/a[0],g=(e[0]-c[0])/a[0];f>g&&(d=f,f=g,g=d);var n=(b[1]-c[1])/a[1],k=(e[1]-c[1])/a[1];n>k&&(d=n,n=k,k=d);if(f>k||n>g)return!1;n>f&&(f=n);k<g&&(g=k);b=(b[2]-c[2])/a[2];c=(e[2]-c[2])/a[2];b>c&&(d=b,b=c,c=d);if(f>c||b>g)return!1;c<g&&(g=c);return 0>g?!1:!0};h.rayRay2D=function(c,a,b,e,f,g){void 0===g&&(g=d.vec2d.create());var n=(e[f]-b[f])*(a[0]-c[0])-(e[0]-b[0])*(a[f]-c[f]);if(0===n)return!1;b=((e[0]-b[0])*(c[f]-b[f])-(e[f]-b[f])*(c[0]-b[0]))/n;g[0]=c[0]+b*(a[0]-
c[0]);g[1]=c[f]+b*(a[f]-c[f]);return!0};h.matrix2frustum=m;h.matrix2frustumPlanes=function(c,a,b,d){void 0===d&&(d=b,b=w);m(c,a,b);e(b[4],b[0],b[3],d[0]);e(b[1],b[5],b[6],d[1]);e(b[4],b[5],b[1],d[2]);e(b[3],b[2],b[6],d[3]);e(b[0],b[1],b[2],d[4]);e(b[5],b[4],b[7],d[5])};h.point2plane=e;h.planeDistance=function(c,a){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]};h.project=function(c,b,e,f,g){g||(g=c);n[0]=c[0];n[1]=c[1];n[2]=c[2];n[3]=1;d.mat4d.multiplyVec4(b,n);2<g.length&&(g[2]=-n[2]);d.mat4d.multiplyVec4(e,
n);a(0!==n[3]);g[0]=n[0]/n[3];g[1]=n[1]/n[3];g[2]=n[2]/n[3];g[0]=(.5*g[0]+.5)*f[2]+f[0];g[1]=(.5*g[1]+.5)*f[3]+f[1]};h.geodeticToGeocentricLatidude=function(c){return Math.atan((1-h.ECCENTRICITY_SQUARED)*Math.tan(c))};h.latLon2positionWGS84Ellipsoid=b;h.pos2latLon=function(c,a){var b=d.vec3d.length(c);a[0]=Math.asin(g(c[1]/b,-1,1));a[1]=(0>c[2]?1:-1)*Math.acos(g(c[0]/(Math.cos(a[0])*b),-1,1));a[0]=k(a[0]);a[1]=k(a[1]);a[2]=b};h.pos2latLonWGS84Ellipsoid=function(c,a){var b=c[0],e=-c[2],d=c[1],f=Math.sqrt(Math.pow(6378137,
2)*(1-h.ECCENTRICITY_SQUARED));c=Math.sqrt(Math.pow(b,2)+Math.pow(e,2));var g=Math.atan2(6378137*d,f*c),b=Math.atan2(e,b),e=Math.atan2(d+Math.pow(Math.sqrt((Math.pow(6378137,2)-Math.pow(f,2))/Math.pow(f,2)),2)*f*Math.pow(Math.sin(g),3),c-6378137*h.ECCENTRICITY_SQUARED*Math.pow(Math.cos(g),3));c=c/Math.cos(e)-6378137/Math.sqrt(1-h.ECCENTRICITY_SQUARED*Math.pow(Math.sin(e),2))+h.EARTH_RADIUS;a[0]=e;a[1]=b;a[2]=c};h.computeGlobeTransformation=function(c,a,e){var g=f(c[0]);c=f(c[1]);b(g,c,a,z);d.mat4d.translate(e,
z);d.mat4d.rotateY(e,.5*Math.PI+c);d.mat4d.rotateX(e,.5*Math.PI-g);return e};h.readUInt16=function(c,a){return c[a]+(c[a+1]<<8)};h.readUInt32=function(c,a){return c[a]+(c[a+1]<<8)+(c[a+2]<<16)+(c[a+3]<<24)};h.setIfDefined=function(c,a,b){void 0!==a[c]&&(b[c]=a[c])};h.array2object=function(c,a){var b={};if(void 0!==a)for(var e=0;e<c.length;e++){var d=c[e];b[a(d)]=d}else for(a=0;a<c.length;a++)d=c[a],b[d]=d;return b};h.object2array=function(c){var a=[],b;for(b in c)a.push(c[b]);return a};h.mergeObjects=
function(c,a,b){void 0===b&&(b={});if(b!==c)for(var e in c)b[e]=c[e];if(b!==a)for(var d in a)b[d]=a[d];return b};h.subtractObjects=function(c,a){var b={},e;for(e in c)void 0===a[e]&&(b[e]=c[e]);return b};h.intersectObjects=function(c,a){var b={},e;for(e in c)void 0!==a[e]&&(b[e]=c[e]);return b};h.getFirstObjectKey=l;h.getFirstObjectValue=function(c){return c[l(c)]};h.objectEmpty=function(c){for(var a in c)return!1;return!0};h.arraysEqual=function(c,a){if(c.length!==a.length)return!1;for(var b=0,e=
c.length;b<e;++b)if(c[b]!==a[b])return!1;return!0};var S=0;h.arrayRemove=function(c,a){for(var b=Math.max(0,S-5),e=Math.min(b+10,c.length),d=-1;b<e;++b)if(c[b]===a){d=b;break}if(-1===d&&(d=c.indexOf(a),-1===d))return null;c[d]=c[c.length-1];c.pop();S=d;return a};h.byteBuffer2base64image=function(c,b,e,d,f){var g=4*b;a(c.length===g*e,"buffer length must match image resolution");var n=document.createElement("canvas");n.width=b;n.height=e;var k=n.getContext("2d");b=k.getImageData(0,0,b,e);for(var l=
b.data,q=0;q<e;++q)for(var m=q*g,r=(e-1-q)*g,x=0;x<g;++x)l[m++]=c[r++];k.putImageData(b,0,0);return n.toDataURL(d,f)};h.cround=function(c){return Math.round(100*c)/100};h.logWithBase=function(c,a){return Math.log(c)/Math.log(a)};h.setMatrixTranslation=t;h.setMatrixTranslation3=function(c,a,b,e){c[12]=a;c[13]=b;c[14]=e};h.getMatrixTranslation=function(c,a){void 0===a&&(a=d.vec3d.create());a[0]=c[12];a[1]=c[13];a[2]=c[14];return a};h.createTranslationMatrix=function(c,a){c=d.mat4d.identity(c);t(c,a);
return c};h.isTranslationMatrix=function(c){return 1===c[0]&&0===c[1]&&0===c[2]&&0===c[3]&&0===c[4]&&1===c[5]&&0===c[6]&&0===c[7]&&0===c[8]&&0===c[9]&&1===c[10]&&0===c[11]&&1===c[15]};h.fovx2fovy=function(c,a,b){return 2*Math.atan(b*Math.tan(.5*c)/a)};h.fovy2fovx=function(c,a,b){return 2*Math.atan(a*Math.tan(.5*c)/b)};h.fovx2fovd=function(c,a,b){return 2*Math.atan(Math.sqrt(a*a+b*b)*Math.tan(.5*c)/a)};h.fovy2fovd=function(c,a,b){return 2*Math.atan(Math.sqrt(a*a+b*b)*Math.tan(.5*c)/b)};h.fovd2fovx=
function(c,a,b){return 2*Math.atan(a*Math.tan(.5*c)/Math.sqrt(a*a+b*b))};h.fovd2fovy=function(c,a,b){return 2*Math.atan(b*Math.tan(.5*c)/Math.sqrt(a*a+b*b))};h.nextHighestPowerOfTwo=function(c){--c;for(var a=1;32>a;a<<=1)c|=c>>a;return c+1};h.nextHighestPowerOfTen=function(c){return Math.pow(10,Math.ceil(Math.LOG10E*Math.log(c)))};h.lineLineDistanceSquared3D=function(c,a,b,e,f){A[0]=c[0]-b[0];A[1]=c[1]-b[1];A[2]=c[2]-b[2];y[0]=e[0]-b[0];y[1]=e[1]-b[1];y[2]=e[2]-b[2];if(1E-4>Math.abs(y[0])&&1E-4>Math.abs(y[1])&&
1E-4>Math.abs(y[2]))return f.success=!1,f;B[0]=a[0]-c[0];B[1]=a[1]-c[1];B[2]=a[2]-c[2];if(1E-4>Math.abs(B[0])&&1E-4>Math.abs(B[1])&&1E-4>Math.abs(B[2]))return f.success=!1,f;a=A[0]*y[0]+A[1]*y[1]+A[2]*y[2];e=y[0]*B[0]+y[1]*B[1]+y[2]*B[2];var n=A[0]*B[0]+A[1]*B[1]+A[2]*B[2],k=y[0]*y[0]+y[1]*y[1]+y[2]*y[2],l=(B[0]*B[0]+B[1]*B[1]+B[2]*B[2])*k-e*e;if(1E-4>Math.abs(l))return f.success=!1,f;n=g((a*e-n*k)/l,0,1);a=g((a+e*n)/k,0,1);E[0]=c[0]+n*B[0];E[1]=c[1]+n*B[1];E[2]=c[2]+n*B[2];C[0]=b[0]+a*y[0];C[1]=
b[1]+a*y[1];C[2]=b[2]+a*y[2];c=d.vec3d.dist2(E,C);f.success=!0;f.dist2=c;f.pa=E;f.pb=C;return f};h.pointLineSegmentDistanceSquared2D=function(c,a,b){I[0]=a[0]-c[0];I[1]=a[1]-c[1];I[2]=0;H[0]=b[0]-c[0];H[1]=b[1]-c[1];H[2]=0;K[0]=b[0];K[1]=b[1];K[2]=0;a=d.vec2d.dot(H,I);b=d.vec2d.dot(I,I);a=g(a/b,0,1);F[0]=I[0]*a;F[1]=I[1]*a;G[0]=c[0]+F[0];G[1]=c[1]+F[1];d.vec2d.subtract(K,G,J);c=d.vec2d.dot(J,J);a=d.vec2d.dot(H,H);b=d.vec2d.dot(I,I);var e=d.vec2d.dot(F,F);if(e>a||e>b)c=Number.MAX_VALUE;return c};h.packFloatRGBA=
function(c,a,b){void 0===b&&(b=0);c=g(c,0,N);for(var e=0;4>e;e++)a[b+e]=Math.floor(256*r(c*Z[e]))};h.unpackFloatRGBA=u;var Z=[1,256,65536,16777216],R=[1/256,1/65536,1/16777216,1/4294967296],N=u(new Uint8ClampedArray([255,255,255,255]))})},"esri/views/3d/webgl-engine/lib/gl-matrix":function(){define([],function(){var p={};(function(h,d){d(h,!0);d(h,!1)})(p,function(h,d){var a={};(function(){if("undefined"!=typeof Float32Array){var c=new Float32Array(1),b=new Int32Array(c.buffer);a.invsqrt=function(a){c[0]=
a;b[0]=1597463007-(b[0]>>1);var e=c[0];return e*(1.5-.5*a*e*e)}}else a.invsqrt=function(c){return 1/Math.sqrt(c)}})();var g=Array;"undefined"!=typeof Float32Array&&(g=d?Float32Array:Array);var f={create:function(c){var a=new g(3);c?(a[0]=c[0],a[1]=c[1],a[2]=c[2]):a[0]=a[1]=a[2]=0;return a},createFrom:function(c,a,b){var e=new g(3);e[0]=c;e[1]=a;e[2]=b;return e},set:function(c,a){a[0]=c[0];a[1]=c[1];a[2]=c[2];return a},set3:function(c,a,b,e){e[0]=c;e[1]=a;e[2]=b;return e},add:function(c,a,b){if(!b||
c===b)return c[0]+=a[0],c[1]+=a[1],c[2]+=a[2],c;b[0]=c[0]+a[0];b[1]=c[1]+a[1];b[2]=c[2]+a[2];return b},subtract:function(c,a,b){if(!b||c===b)return c[0]-=a[0],c[1]-=a[1],c[2]-=a[2],c;b[0]=c[0]-a[0];b[1]=c[1]-a[1];b[2]=c[2]-a[2];return b},multiply:function(c,a,b){if(!b||c===b)return c[0]*=a[0],c[1]*=a[1],c[2]*=a[2],c;b[0]=c[0]*a[0];b[1]=c[1]*a[1];b[2]=c[2]*a[2];return b},max:function(c,a,b){b[0]=Math.max(c[0],a[0]);b[1]=Math.max(c[1],a[1]);b[2]=Math.max(c[2],a[2]);return b},min:function(c,a,b){b[0]=
Math.min(c[0],a[0]);b[1]=Math.min(c[1],a[1]);b[2]=Math.min(c[2],a[2]);return b},negate:function(c,a){a||(a=c);a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];return a},scale:function(c,a,b){if(!b||c===b)return c[0]*=a,c[1]*=a,c[2]*=a,c;b[0]=c[0]*a;b[1]=c[1]*a;b[2]=c[2]*a;return b},normalize:function(c,a){a||(a=c);var b=c[0],e=c[1];c=c[2];var d=Math.sqrt(b*b+e*e+c*c);if(!d)return a[0]=0,a[1]=0,a[2]=0,a;if(1===d)return a[0]=b,a[1]=e,a[2]=c,a;d=1/d;a[0]=b*d;a[1]=e*d;a[2]=c*d;return a},cross:function(c,a,b){b||(b=c);
var e=c[0],d=c[1];c=c[2];var f=a[0],g=a[1];a=a[2];b[0]=d*a-c*g;b[1]=c*f-e*a;b[2]=e*g-d*f;return b},length:function(c){var a=c[0],b=c[1];c=c[2];return Math.sqrt(a*a+b*b+c*c)},length2:function(c){var a=c[0],b=c[1];c=c[2];return a*a+b*b+c*c},dot:function(c,a){return c[0]*a[0]+c[1]*a[1]+c[2]*a[2]},direction:function(c,a,b){b||(b=c);var e=c[0]-a[0],d=c[1]-a[1];c=c[2]-a[2];a=Math.sqrt(e*e+d*d+c*c);if(!a)return b[0]=0,b[1]=0,b[2]=0,b;a=1/a;b[0]=e*a;b[1]=d*a;b[2]=c*a;return b},lerp:function(c,a,b,e){e||(e=
c);e[0]=c[0]+b*(a[0]-c[0]);e[1]=c[1]+b*(a[1]-c[1]);e[2]=c[2]+b*(a[2]-c[2]);return e},dist:function(c,a){var b=a[0]-c[0],e=a[1]-c[1];c=a[2]-c[2];return Math.sqrt(b*b+e*e+c*c)},dist2:function(c,a){var b=a[0]-c[0],e=a[1]-c[1];c=a[2]-c[2];return b*b+e*e+c*c}},k=null,m=new g(4);f.unproject=function(c,a,b,e,d){d||(d=c);k||(k=v.create());var f=k;m[0]=2*(c[0]-e[0])/e[2]-1;m[1]=2*(c[1]-e[1])/e[3]-1;m[2]=2*c[2]-1;m[3]=1;v.multiply(b,a,f);if(!v.inverse(f))return null;v.multiplyVec4(f,m);if(0===m[3])return null;
d[0]=m[0]/m[3];d[1]=m[1]/m[3];d[2]=m[2]/m[3];return d};var e=f.createFrom(1,0,0),b=f.createFrom(0,1,0),l=f.createFrom(0,0,1);f.rotationTo=function(c,a,d){d||(d=q.create());var g=f.dot(c,a),k=f.create();if(1<=g)q.set(n,d);else if(-.999999>g)f.cross(e,c,k),1E-6>k.length&&f.cross(b,c,k),1E-6>k.length&&f.cross(l,c,k),f.normalize(k),q.fromAxisAngle(k,Math.PI,d);else{var g=Math.sqrt(2*(1+g)),m=1/g;f.cross(c,a,k);d[0]=k[0]*m;d[1]=k[1]*m;d[2]=k[2]*m;d[3]=.5*g;q.normalize(d)}1<d[3]?d[3]=1:-1>d[3]&&(d[3]=-1);
return d};var t=f.create(),u=f.create();f.project=function(c,a,b,e){e||(e=c);f.direction(a,b,t);f.subtract(c,a,u);c=f.dot(t,u);f.scale(t,c,e);f.add(e,a,e)};f.str=function(c){return"["+c[0]+", "+c[1]+", "+c[2]+"]"};var r={create:function(c){var a=new g(9);c?(a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[8]=c[8]):a[0]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=0;return a},createFrom:function(c,a,b,e,d,f,n,k,l){var q=new g(9);q[0]=c;q[1]=a;q[2]=b;q[3]=e;q[4]=d;q[5]=f;
q[6]=n;q[7]=k;q[8]=l;return q},determinant:function(c){var a=c[3],b=c[4],e=c[5],d=c[6],f=c[7],g=c[8];return c[0]*(g*b-e*f)+c[1]*(-g*a+e*d)+c[2]*(f*a-b*d)},inverse:function(c,a){var b=c[0],e=c[1],d=c[2],f=c[3],g=c[4],n=c[5],k=c[6],l=c[7];c=c[8];var q=c*g-n*l,m=-c*f+n*k,v=l*f-g*k,t=b*q+e*m+d*v;if(!t)return null;t=1/t;a||(a=r.create());a[0]=q*t;a[1]=(-c*e+d*l)*t;a[2]=(n*e-d*g)*t;a[3]=m*t;a[4]=(c*b-d*k)*t;a[5]=(-n*b+d*f)*t;a[6]=v*t;a[7]=(-l*b+e*k)*t;a[8]=(g*b-e*f)*t;return a},multiply:function(c,a,b){b||
(b=c);var e=c[0],d=c[1],f=c[2],g=c[3],n=c[4],k=c[5],l=c[6],q=c[7];c=c[8];var m=a[0],r=a[1],v=a[2],t=a[3],x=a[4],u=a[5],h=a[6],w=a[7];a=a[8];b[0]=m*e+r*g+v*l;b[1]=m*d+r*n+v*q;b[2]=m*f+r*k+v*c;b[3]=t*e+x*g+u*l;b[4]=t*d+x*n+u*q;b[5]=t*f+x*k+u*c;b[6]=h*e+w*g+a*l;b[7]=h*d+w*n+a*q;b[8]=h*f+w*k+a*c;return b},multiplyVec2:function(c,a,b){b||(b=a);var e=a[0];a=a[1];b[0]=e*c[0]+a*c[3]+c[6];b[1]=e*c[1]+a*c[4]+c[7];return b},multiplyVec3:function(c,a,b){b||(b=a);var e=a[0],d=a[1];a=a[2];b[0]=e*c[0]+d*c[3]+a*
c[6];b[1]=e*c[1]+d*c[4]+a*c[7];b[2]=e*c[2]+d*c[5]+a*c[8];return b},set:function(c,a){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];a[6]=c[6];a[7]=c[7];a[8]=c[8];return a},identity:function(a){a||(a=r.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},transpose:function(a,b){if(!b||a===b){b=a[1];var c=a[2],e=a[5];a[1]=a[3];a[2]=a[6];a[3]=b;a[5]=a[7];a[6]=c;a[7]=e;return a}b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=
a[8];return b},toMat4:function(a,b){b||(b=v.create());b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"}},v={create:function(a){var c=new g(16);4===arguments.length?(c[0]=arguments[0],c[1]=arguments[1],c[2]=arguments[2],c[3]=arguments[3],c[4]=arguments[4],c[5]=arguments[5],c[6]=arguments[6],
c[7]=arguments[7],c[8]=arguments[8],c[9]=arguments[9],c[10]=arguments[10],c[11]=arguments[11],c[12]=arguments[12],c[13]=arguments[13],c[14]=arguments[14],c[15]=arguments[15]):a&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);return c},createFrom:function(a,b,e,d,f,n,k,l,q,m,r,v,t,u,h,w){var c=new g(16);c[0]=a;c[1]=b;c[2]=e;c[3]=d;c[4]=f;c[5]=n;c[6]=k;c[7]=l;c[8]=q;c[9]=m;
c[10]=r;c[11]=v;c[12]=t;c[13]=u;c[14]=h;c[15]=w;return c},createFromMatrixRowMajor:function(a){var c=new g(16);c[0]=a[0];c[4]=a[1];c[8]=a[2];c[12]=a[3];c[1]=a[4];c[5]=a[5];c[9]=a[6];c[13]=a[7];c[2]=a[8];c[6]=a[9];c[10]=a[10];c[14]=a[11];c[3]=a[12];c[7]=a[13];c[11]=a[14];c[15]=a[15];return c},createFromMatrix:function(a){var c=new g(16);c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=
a[15];return c},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},setRowMajor:function(a,b){b[0]=a[0];b[4]=a[1];b[8]=a[2];b[12]=a[3];b[1]=a[4];b[5]=a[5];b[9]=a[6];b[13]=a[7];b[2]=a[8];b[6]=a[9];b[10]=a[10];b[14]=a[11];b[3]=a[12];b[7]=a[13];b[11]=a[14];b[15]=a[15];return b},identity:function(a){a||(a=v.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=
1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},transpose:function(a,b){if(!b||a===b){b=a[1];var c=a[2],e=a[3],d=a[6],f=a[7],g=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=b;a[6]=a[9];a[7]=a[13];a[8]=c;a[9]=d;a[11]=a[14];a[12]=e;a[13]=f;a[14]=g;return a}b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=a[9];b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b},determinant:function(a){var c=
a[0],b=a[1],e=a[2],d=a[3],f=a[4],g=a[5],n=a[6],k=a[7],l=a[8],q=a[9],m=a[10],r=a[11],v=a[12],t=a[13],u=a[14];a=a[15];return v*q*n*d-l*t*n*d-v*g*m*d+f*t*m*d+l*g*u*d-f*q*u*d-v*q*e*k+l*t*e*k+v*b*m*k-c*t*m*k-l*b*u*k+c*q*u*k+v*g*e*r-f*t*e*r-v*b*n*r+c*t*n*r+f*b*u*r-c*g*u*r-l*g*e*a+f*q*e*a+l*b*n*a-c*q*n*a-f*b*m*a+c*g*m*a},inverse:function(a,b){b||(b=a);var c=a[0],e=a[1],d=a[2],f=a[3],g=a[4],n=a[5],k=a[6],l=a[7],q=a[8],m=a[9],r=a[10],v=a[11],t=a[12],u=a[13],h=a[14];a=a[15];var x=c*n-e*g,w=c*k-d*g,p=c*l-f*
g,N=e*k-d*n,D=e*l-f*n,P=d*l-f*k,O=q*u-m*t,Q=q*h-r*t,T=q*a-v*t,da=m*h-r*u,U=m*a-v*u,aa=r*a-v*h,X=x*aa-w*U+p*da+N*T-D*Q+P*O;if(!X)return null;X=1/X;b[0]=(n*aa-k*U+l*da)*X;b[1]=(-e*aa+d*U-f*da)*X;b[2]=(u*P-h*D+a*N)*X;b[3]=(-m*P+r*D-v*N)*X;b[4]=(-g*aa+k*T-l*Q)*X;b[5]=(c*aa-d*T+f*Q)*X;b[6]=(-t*P+h*p-a*w)*X;b[7]=(q*P-r*p+v*w)*X;b[8]=(g*U-n*T+l*O)*X;b[9]=(-c*U+e*T-f*O)*X;b[10]=(t*D-u*p+a*x)*X;b[11]=(-q*D+m*p-v*x)*X;b[12]=(-g*da+n*Q-k*O)*X;b[13]=(c*da-e*Q+d*O)*X;b[14]=(-t*N+u*w-h*x)*X;b[15]=(q*N-m*w+r*x)*
X;return b},toRotationMat:function(a,b){b||(b=v.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},toMat3:function(a,b){b||(b=r.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b},toInverseMat3:function(a,b){var c=a[0],e=a[1],d=a[2],f=a[4],g=a[5],n=a[6],k=a[8],l=a[9];a=a[10];var q=a*g-n*l,m=-a*f+n*k,v=l*f-g*k,t=c*q+
e*m+d*v;if(!t)return null;t=1/t;b||(b=r.create());b[0]=q*t;b[1]=(-a*e+d*l)*t;b[2]=(n*e-d*g)*t;b[3]=m*t;b[4]=(a*c-d*k)*t;b[5]=(-n*c+d*f)*t;b[6]=v*t;b[7]=(-l*c+e*k)*t;b[8]=(g*c-e*f)*t;return b},multiply:function(a,b,e){e||(e=a);var c=a[0],d=a[1],f=a[2],g=a[3],n=a[4],k=a[5],l=a[6],q=a[7],m=a[8],r=a[9],v=a[10],t=a[11],u=a[12],h=a[13],x=a[14];a=a[15];var w=b[0],z=b[1],p=b[2],D=b[3],P=b[4],O=b[5],Q=b[6],T=b[7],da=b[8],U=b[9],aa=b[10],X=b[11],ba=b[12],ea=b[13],W=b[14];b=b[15];e[0]=w*c+z*n+p*m+D*u;e[1]=w*
d+z*k+p*r+D*h;e[2]=w*f+z*l+p*v+D*x;e[3]=w*g+z*q+p*t+D*a;e[4]=P*c+O*n+Q*m+T*u;e[5]=P*d+O*k+Q*r+T*h;e[6]=P*f+O*l+Q*v+T*x;e[7]=P*g+O*q+Q*t+T*a;e[8]=da*c+U*n+aa*m+X*u;e[9]=da*d+U*k+aa*r+X*h;e[10]=da*f+U*l+aa*v+X*x;e[11]=da*g+U*q+aa*t+X*a;e[12]=ba*c+ea*n+W*m+b*u;e[13]=ba*d+ea*k+W*r+b*h;e[14]=ba*f+ea*l+W*v+b*x;e[15]=ba*g+ea*q+W*t+b*a;return e},multiplyVec3:function(a,b,e){e||(e=b);var c=b[0],d=b[1];b=b[2];e[0]=a[0]*c+a[4]*d+a[8]*b+a[12];e[1]=a[1]*c+a[5]*d+a[9]*b+a[13];e[2]=a[2]*c+a[6]*d+a[10]*b+a[14];return e},
multiplyVec4:function(a,b,e){e||(e=b);var c=b[0],d=b[1],f=b[2];b=b[3];e[0]=a[0]*c+a[4]*d+a[8]*f+a[12]*b;e[1]=a[1]*c+a[5]*d+a[9]*f+a[13]*b;e[2]=a[2]*c+a[6]*d+a[10]*f+a[14]*b;e[3]=a[3]*c+a[7]*d+a[11]*f+a[15]*b;return e},translate:function(a,b,e){var c=b[0],d=b[1];b=b[2];var f,g,n,k,l,q,m,r,v,t,u,h;if(!e||a===e)return a[12]=a[0]*c+a[4]*d+a[8]*b+a[12],a[13]=a[1]*c+a[5]*d+a[9]*b+a[13],a[14]=a[2]*c+a[6]*d+a[10]*b+a[14],a[15]=a[3]*c+a[7]*d+a[11]*b+a[15],a;f=a[0];g=a[1];n=a[2];k=a[3];l=a[4];q=a[5];m=a[6];
r=a[7];v=a[8];t=a[9];u=a[10];h=a[11];e[0]=f;e[1]=g;e[2]=n;e[3]=k;e[4]=l;e[5]=q;e[6]=m;e[7]=r;e[8]=v;e[9]=t;e[10]=u;e[11]=h;e[12]=f*c+l*d+v*b+a[12];e[13]=g*c+q*d+t*b+a[13];e[14]=n*c+m*d+u*b+a[14];e[15]=k*c+r*d+h*b+a[15];return e},scale:function(a,b,e){var c=b[0],d=b[1];b=b[2];if(!e||a===e)return a[0]*=c,a[1]*=c,a[2]*=c,a[3]*=c,a[4]*=d,a[5]*=d,a[6]*=d,a[7]*=d,a[8]*=b,a[9]*=b,a[10]*=b,a[11]*=b,a;e[0]=a[0]*c;e[1]=a[1]*c;e[2]=a[2]*c;e[3]=a[3]*c;e[4]=a[4]*d;e[5]=a[5]*d;e[6]=a[6]*d;e[7]=a[7]*d;e[8]=a[8]*
b;e[9]=a[9]*b;e[10]=a[10]*b;e[11]=a[11]*b;e[12]=a[12];e[13]=a[13];e[14]=a[14];e[15]=a[15];return e},maxScale:function(a){return Math.max(Math.max(Math.sqrt(a[0]*a[0]+a[4]*a[4]+a[8]*a[8]),Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])),Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))},rotate:function(a,b,e,d){var c=e[0],f=e[1];e=e[2];var g=Math.sqrt(c*c+f*f+e*e),n,k,l,q,m,r,v,t,u,h,x,w,z,A,p,P,O,Q,T,da;if(!g)return null;1!==g&&(g=1/g,c*=g,f*=g,e*=g);n=Math.sin(b);k=Math.cos(b);l=1-k;b=a[0];g=a[1];q=a[2];m=a[3];
r=a[4];v=a[5];t=a[6];u=a[7];h=a[8];x=a[9];w=a[10];z=a[11];A=c*c*l+k;p=f*c*l+e*n;P=e*c*l-f*n;O=c*f*l-e*n;Q=f*f*l+k;T=e*f*l+c*n;da=c*e*l+f*n;c=f*e*l-c*n;f=e*e*l+k;d?a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=b*A+r*p+h*P;d[1]=g*A+v*p+x*P;d[2]=q*A+t*p+w*P;d[3]=m*A+u*p+z*P;d[4]=b*O+r*Q+h*T;d[5]=g*O+v*Q+x*T;d[6]=q*O+t*Q+w*T;d[7]=m*O+u*Q+z*T;d[8]=b*da+r*c+h*f;d[9]=g*da+v*c+x*f;d[10]=q*da+t*c+w*f;d[11]=m*da+u*c+z*f;return d},rotateX:function(a,b,e){var c=Math.sin(b);b=Math.cos(b);var d=
a[4],f=a[5],g=a[6],n=a[7],k=a[8],l=a[9],q=a[10],m=a[11];e?a!==e&&(e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]):e=a;e[4]=d*b+k*c;e[5]=f*b+l*c;e[6]=g*b+q*c;e[7]=n*b+m*c;e[8]=d*-c+k*b;e[9]=f*-c+l*b;e[10]=g*-c+q*b;e[11]=n*-c+m*b;return e},rotateY:function(a,b,e){var c=Math.sin(b);b=Math.cos(b);var d=a[0],f=a[1],g=a[2],n=a[3],k=a[8],l=a[9],q=a[10],m=a[11];e?a!==e&&(e[4]=a[4],e[5]=a[5],e[6]=a[6],e[7]=a[7],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]):e=a;e[0]=
d*b+k*-c;e[1]=f*b+l*-c;e[2]=g*b+q*-c;e[3]=n*b+m*-c;e[8]=d*c+k*b;e[9]=f*c+l*b;e[10]=g*c+q*b;e[11]=n*c+m*b;return e},rotateZ:function(a,b,e){var c=Math.sin(b);b=Math.cos(b);var d=a[0],f=a[1],g=a[2],n=a[3],k=a[4],l=a[5],q=a[6],m=a[7];e?a!==e&&(e[8]=a[8],e[9]=a[9],e[10]=a[10],e[11]=a[11],e[12]=a[12],e[13]=a[13],e[14]=a[14],e[15]=a[15]):e=a;e[0]=d*b+k*c;e[1]=f*b+l*c;e[2]=g*b+q*c;e[3]=n*b+m*c;e[4]=d*-c+k*b;e[5]=f*-c+l*b;e[6]=g*-c+q*b;e[7]=n*-c+m*b;return e},frustum:function(a,b,e,d,f,g,n){n||(n=v.create());
var c=b-a,k=d-e,l=g-f;n[0]=2*f/c;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=2*f/k;n[6]=0;n[7]=0;n[8]=(b+a)/c;n[9]=(d+e)/k;n[10]=-(g+f)/l;n[11]=-1;n[12]=0;n[13]=0;n[14]=-(g*f*2)/l;n[15]=0;return n},perspective:function(a,b,e,d,f){a=e*Math.tan(a*Math.PI/360);b*=a;return v.frustum(-b,b,-a,a,e,d,f)},ortho:function(a,b,e,d,f,g,n){n||(n=v.create());var c=b-a,k=d-e,l=g-f;n[0]=2/c;n[1]=0;n[2]=0;n[3]=0;n[4]=0;n[5]=2/k;n[6]=0;n[7]=0;n[8]=0;n[9]=0;n[10]=-2/l;n[11]=0;n[12]=-(a+b)/c;n[13]=-(d+e)/k;n[14]=-(g+f)/l;n[15]=
1;return n},lookAt:function(a,b,e,d){d||(d=v.create());var c,f,g,n,k,l,q,m,r=a[0],t=a[1];a=a[2];g=e[0];n=e[1];f=e[2];q=b[0];e=b[1];c=b[2];if(r===q&&t===e&&a===c)return v.identity(d);b=r-q;e=t-e;q=a-c;m=1/Math.sqrt(b*b+e*e+q*q);b*=m;e*=m;q*=m;c=n*q-f*e;f=f*b-g*q;g=g*e-n*b;(m=Math.sqrt(c*c+f*f+g*g))?(m=1/m,c*=m,f*=m,g*=m):g=f=c=0;n=e*g-q*f;k=q*c-b*g;l=b*f-e*c;(m=Math.sqrt(n*n+k*k+l*l))?(m=1/m,n*=m,k*=m,l*=m):l=k=n=0;d[0]=c;d[1]=n;d[2]=b;d[3]=0;d[4]=f;d[5]=k;d[6]=e;d[7]=0;d[8]=g;d[9]=l;d[10]=q;d[11]=
0;d[12]=-(c*r+f*t+g*a);d[13]=-(n*r+k*t+l*a);d[14]=-(b*r+e*t+q*a);d[15]=1;return d},fromRotationTranslation:function(a,b,e){e||(e=v.create());var c=a[0],d=a[1],f=a[2],g=a[3],n=c+c,k=d+d,l=f+f;a=c*n;var q=c*k,c=c*l,m=d*k,d=d*l,f=f*l,n=g*n,k=g*k,g=g*l;e[0]=1-(m+f);e[1]=q+g;e[2]=c-k;e[3]=0;e[4]=q-g;e[5]=1-(a+f);e[6]=d+n;e[7]=0;e[8]=c+k;e[9]=d-n;e[10]=1-(a+m);e[11]=0;e[12]=b[0];e[13]=b[1];e[14]=b[2];e[15]=1;return e},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+
a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"}},q={create:function(a){var c=new g(4);a?(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3]):c[0]=c[1]=c[2]=c[3]=0;return c},createFrom:function(a,b,e,d){var c=new g(4);c[0]=a;c[1]=b;c[2]=e;c[3]=d;return c},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},identity:function(a){a||(a=q.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}},n=q.identity();q.calculateW=function(a,b){var c=a[0],
e=a[1],d=a[2];if(!b||a===b)return a[3]=-Math.sqrt(Math.abs(1-c*c-e*e-d*d)),a;b[0]=c;b[1]=e;b[2]=d;b[3]=-Math.sqrt(Math.abs(1-c*c-e*e-d*d));return b};q.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};q.inverse=function(a,b){var c=a[0],e=a[1],d=a[2],f=a[3],c=(c=c*c+e*e+d*d+f*f)?1/c:0;if(!b||a===b)return a[0]*=-c,a[1]*=-c,a[2]*=-c,a[3]*=c,a;b[0]=-a[0]*c;b[1]=-a[1]*c;b[2]=-a[2]*c;b[3]=a[3]*c;return b};q.conjugate=function(a,b){if(!b||a===b)return a[0]*=-1,a[1]*=-1,a[2]*=-1,a;b[0]=-a[0];
b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};q.length=function(a){var c=a[0],b=a[1],e=a[2];a=a[3];return Math.sqrt(c*c+b*b+e*e+a*a)};q.normalize=function(a,b){b||(b=a);var c=a[0],e=a[1],d=a[2];a=a[3];var f=Math.sqrt(c*c+e*e+d*d+a*a);if(0===f)return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b;f=1/f;b[0]=c*f;b[1]=e*f;b[2]=d*f;b[3]=a*f;return b};q.add=function(a,b,e){if(!e||a===e)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a[3]+=b[3],a;e[0]=a[0]+b[0];e[1]=a[1]+b[1];e[2]=a[2]+b[2];e[3]=a[3]+b[3];return e};q.multiply=function(a,
b,e){e||(e=a);var c=a[0],d=a[1],f=a[2];a=a[3];var g=b[0],n=b[1],k=b[2];b=b[3];e[0]=c*b+a*g+d*k-f*n;e[1]=d*b+a*n+f*g-c*k;e[2]=f*b+a*k+c*n-d*g;e[3]=a*b-c*g-d*n-f*k;return e};q.multiplyVec3=function(a,b,e){e||(e=b);var c=b[0],d=b[1],f=b[2];b=a[0];var g=a[1],n=a[2];a=a[3];var k=a*c+g*f-n*d,l=a*d+n*c-b*f,q=a*f+b*d-g*c,c=-b*c-g*d-n*f;e[0]=k*a+c*-b+l*-n-q*-g;e[1]=l*a+c*-g+q*-b-k*-n;e[2]=q*a+c*-n+k*-g-l*-b;return e};q.scale=function(a,b,e){if(!e||a===e)return a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a;e[0]=a[0]*b;
e[1]=a[1]*b;e[2]=a[2]*b;e[3]=a[3]*b;return e};q.toMat3=function(a,b){b||(b=r.create());var c=a[0],e=a[1],d=a[2],f=a[3],g=c+c,n=e+e,k=d+d;a=c*g;var l=c*n,c=c*k,q=e*n,e=e*k,d=d*k,g=f*g,n=f*n,f=f*k;b[0]=1-(q+d);b[1]=l+f;b[2]=c-n;b[3]=l-f;b[4]=1-(a+d);b[5]=e+g;b[6]=c+n;b[7]=e-g;b[8]=1-(a+q);return b};q.toMat4=function(a,b){b||(b=v.create());var c=a[0],e=a[1],d=a[2],f=a[3],g=c+c,n=e+e,k=d+d;a=c*g;var l=c*n,c=c*k,q=e*n,e=e*k,d=d*k,g=f*g,n=f*n,f=f*k;b[0]=1-(q+d);b[1]=l+f;b[2]=c-n;b[3]=0;b[4]=l-f;b[5]=1-
(a+d);b[6]=e+g;b[7]=0;b[8]=c+n;b[9]=e-g;b[10]=1-(a+q);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};q.slerp=function(a,b,e,d){d||(d=a);var c=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3],f,g;if(1<=Math.abs(c))return d!==a&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3]),d;f=Math.acos(c);g=Math.sqrt(1-c*c);if(.001>Math.abs(g))return d[0]=.5*a[0]+.5*b[0],d[1]=.5*a[1]+.5*b[1],d[2]=.5*a[2]+.5*b[2],d[3]=.5*a[3]+.5*b[3],d;c=Math.sin((1-e)*f)/g;e=Math.sin(e*f)/g;d[0]=a[0]*c+b[0]*e;d[1]=a[1]*c+b[1]*e;d[2]=a[2]*c+
b[2]*e;d[3]=a[3]*c+b[3]*e;return d};q.fromRotationMatrix=function(a,b){b||(b=q.create());var c=a[0]+a[4]+a[8],e;if(0<c)e=Math.sqrt(c+1),b[3]=.5*e,e=.5/e,b[0]=(a[7]-a[5])*e,b[1]=(a[2]-a[6])*e,b[2]=(a[3]-a[1])*e;else{e=q.fromRotationMatrix.s_iNext=q.fromRotationMatrix.s_iNext||[1,2,0];c=0;a[4]>a[0]&&(c=1);a[8]>a[3*c+c]&&(c=2);var d=e[c],f=e[d];e=Math.sqrt(a[3*c+c]-a[3*d+d]-a[3*f+f]+1);b[c]=.5*e;e=.5/e;b[3]=(a[3*f+d]-a[3*d+f])*e;b[d]=(a[3*d+c]+a[3*c+d])*e;b[f]=(a[3*f+c]+a[3*c+f])*e}return b};r.toQuat4=
q.fromRotationMatrix;(function(){var a=r.create();q.fromAxes=function(c,b,e,d){a[0]=b[0];a[3]=b[1];a[6]=b[2];a[1]=e[0];a[4]=e[1];a[7]=e[2];a[2]=c[0];a[5]=c[1];a[8]=c[2];return q.fromRotationMatrix(a,d)}})();q.identity=function(a){a||(a=q.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};q.fromAngleAxis=function(a,b,e){e||(e=q.create());a*=.5;var c=Math.sin(a);e[3]=Math.cos(a);e[0]=c*b[0];e[1]=c*b[1];e[2]=c*b[2];return e};q.toAngleAxis=function(c,b){b||(b=c);var e=c[0]*c[0]+c[1]*c[1]+c[2]*c[2];0<e?(b[3]=
2*Math.acos(c[3]),e=a.invsqrt(e),b[0]=c[0]*e,b[1]=c[1]*e,b[2]=c[2]*e):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};q.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};var w={create:function(a){var c=new g(4);a?(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3]):c[0]=c[1]=c[2]=c[3]=0;return c},createFrom:function(a,b,e,d){var c=new g(4);c[0]=a;c[1]=b;c[2]=e;c[3]=d;return c},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},identity:function(a){a||(a=w.create());a[0]=1;a[1]=0;a[2]=
0;a[3]=1;return a},transpose:function(a,b){if(!b||a===b)return b=a[1],a[1]=a[2],a[2]=b,a;b[0]=a[0];b[1]=a[2];b[2]=a[1];b[3]=a[3];return b},determinant:function(a){return a[0]*a[3]-a[2]*a[1]},inverse:function(a,b){b||(b=a);var c=a[0],e=a[1],d=a[2];a=a[3];var f=c*a-d*e;if(!f)return null;f=1/f;b[0]=a*f;b[1]=-e*f;b[2]=-d*f;b[3]=c*f;return b},multiply:function(a,b,e){e||(e=a);var c=a[0],d=a[1],f=a[2];a=a[3];e[0]=c*b[0]+d*b[2];e[1]=c*b[1]+d*b[3];e[2]=f*b[0]+a*b[2];e[3]=f*b[1]+a*b[3];return e},rotate:function(a,
b,e){e||(e=a);var c=a[0],d=a[1],f=a[2];a=a[3];var g=Math.sin(b);b=Math.cos(b);e[0]=c*b+d*g;e[1]=c*-g+d*b;e[2]=f*b+a*g;e[3]=f*-g+a*b;return e},multiplyVec2:function(a,b,e){e||(e=b);var c=b[0];b=b[1];e[0]=c*a[0]+b*a[1];e[1]=c*a[2]+b*a[3];return e},scale:function(a,b,e){e||(e=a);var c=a[1],d=a[2],f=a[3],g=b[0];b=b[1];e[0]=a[0]*g;e[1]=c*b;e[2]=d*g;e[3]=f*b;return e},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}};d=d?"":"d";h["glMath"+d]=a;h["vec2"+d]={create:function(a){var c=new g(2);
a?(c[0]=a[0],c[1]=a[1]):(c[0]=0,c[1]=0);return c},createFrom:function(a,b){var c=new g(2);c[0]=a;c[1]=b;return c},add:function(a,b,e){e||(e=b);e[0]=a[0]+b[0];e[1]=a[1]+b[1];return e},subtract:function(a,b,e){e||(e=b);e[0]=a[0]-b[0];e[1]=a[1]-b[1];return e},multiply:function(a,b,e){e||(e=b);e[0]=a[0]*b[0];e[1]=a[1]*b[1];return e},divide:function(a,b,e){e||(e=b);e[0]=a[0]/b[0];e[1]=a[1]/b[1];return e},scale:function(a,b,e){e||(e=a);e[0]=a[0]*b;e[1]=a[1]*b;return e},dist:function(a,b){var c=b[0]-a[0];
a=b[1]-a[1];return Math.sqrt(c*c+a*a)},dist2:function(a,b){var c=b[0]-a[0];a=b[1]-a[1];return c*c+a*a},set:function(a,b){b[0]=a[0];b[1]=a[1];return b},set2:function(a,b,e){e[0]=a;e[1]=b;return e},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];return b},normalize:function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1];0<c?(c=Math.sqrt(c),b[0]=a[0]/c,b[1]=a[1]/c):b[0]=b[1]=0;return b},cross:function(a,b,e){a=a[0]*b[1]-a[1]*b[0];if(!e)return a;e[0]=e[1]=0;e[2]=a;return e},length:function(a){var c=a[0];
a=a[1];return Math.sqrt(c*c+a*a)},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]},direction:function(a,b,e){e||(e=a);var c=a[0]-b[0];a=a[1]-b[1];b=c*c+a*a;if(!b)return e[0]=0,e[1]=0,e[2]=0,e;b=1/Math.sqrt(b);e[0]=c*b;e[1]=a*b;return e},lerp:function(a,b,e,d){d||(d=a);d[0]=a[0]+e*(b[0]-a[0]);d[1]=a[1]+e*(b[1]-a[1]);return d},str:function(a){return"["+a[0]+", "+a[1]+"]"}};h["vec3"+d]=f;h["vec4"+d]={create:function(a){var c=new g(4);a?(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3]):(c[0]=0,c[1]=0,c[2]=0,c[3]=
0);return c},createFrom:function(a,b,e,d){var c=new g(4);c[0]=a;c[1]=b;c[2]=e;c[3]=d;return c},add:function(a,b,e){e||(e=b);e[0]=a[0]+b[0];e[1]=a[1]+b[1];e[2]=a[2]+b[2];e[3]=a[3]+b[3];return e},subtract:function(a,b,e){e||(e=b);e[0]=a[0]-b[0];e[1]=a[1]-b[1];e[2]=a[2]-b[2];e[3]=a[3]-b[3];return e},multiply:function(a,b,e){e||(e=b);e[0]=a[0]*b[0];e[1]=a[1]*b[1];e[2]=a[2]*b[2];e[3]=a[3]*b[3];return e},divide:function(a,b,e){e||(e=b);e[0]=a[0]/b[0];e[1]=a[1]/b[1];e[2]=a[2]/b[2];e[3]=a[3]/b[3];return e},
scale:function(a,b,e){e||(e=a);e[0]=a[0]*b;e[1]=a[1]*b;e[2]=a[2]*b;e[3]=a[3]*b;return e},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},set4:function(a,b,e,d,f){f[0]=a;f[1]=b;f[2]=e;f[3]=d;return f},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b},lerp:function(a,b,e,d){d||(d=a);d[0]=a[0]+e*(b[0]-a[0]);d[1]=a[1]+e*(b[1]-a[1]);d[2]=a[2]+e*(b[2]-a[2]);d[3]=a[3]+e*(b[3]-a[3]);return d},
str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}};h["mat2"+d]=w;h["mat3"+d]=r;h["mat4"+d]=v;h["quat4"+d]=q});return p})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("require exports ../../../support/aaBoundingBox ../../lib/ComponentUtils ../../lib/gl-matrix ../../lib/screenSizePerspectiveUtils ../../lib/Util ../../../../webgl/Util".split(" "),function(p,h,d,a,g,f,k,m){function e(a,c,b,e,d,f){if(void 0===d||3!==f)for(d=0;d<f;++d)b[e+d]=a[c+d];else{var g=
a[c],n=a[c+1];a=a[c+2];b[e]=d[0]*g+d[4]*n+d[8]*a+d[12];b[e+1]=d[1]*g+d[5]*n+d[9]*a+d[13];b[e+2]=d[2]*g+d[6]*n+d[10]*a+d[14]}return f}function b(a,c,b,e,d,f){for(var g=a.length,n=0;n<g;++n){for(var k=b*a[n],l=0;l<b;++l)e[d+l]=c[k+l];d+=f}}function l(a,c,b,e,d,f){e=new Uint8Array(e);d*=4;f*=4;var g=a.length;if(4===b)for(b=0;b<g;++b){var n=4*a[b];e[d]=c[n];e[d+1]=c[n+1];e[d+2]=c[n+2];e[d+3]=c[n+3];d+=f}else if(3===b)for(b=0;b<g;++b)n=3*a[b],e[d]=c[n],e[d+1]=c[n+1],e[d+2]=c[n+2],e[d+3]=255,d+=f}function t(a,
b,e,f,g){var n=r(b,e,z);d.setMin(c,a.getBBMin());d.setMax(c,a.getBBMax());if(v(c,b,n,f)){var n=a.getPrimitiveIndices(),k=a.getIndices(),l=a.getPosition(),q=n?n.length:k.length/3;if(1E4<q&&(a=a.getChildren(),void 0!==a)){for(n=0;8>n;++n)void 0!==a[n]&&t(a[n],b,e,f,g);return}u(b,e,0,q,k,l,n,g)}}function u(a,c,b,e,d,f,n,k){var l=f.data,q=f.offsetIdx;f=f.strideIdx;var m=a[0],r=a[1];a=a[2];var v=c[0]-m,t=c[1]-r;for(c=c[2]-a;b<e;b++){var u=n?n[b]:b,h=q+f*d[3*u],w=q+f*d[3*u+1],x=q+f*d[3*u+2],z=l[h],p=l[h+
1],C=l[h+2],h=l[w]-z,G=l[w+1]-p,w=l[w+2]-C,J=l[x]-z,F=l[x+1]-p,x=l[x+2]-C,H=t*x-F*c,I=c*J-x*v,K=v*F-J*t,L=h*H+G*I+w*K,z=m-z,M=r-p,V=a-C,p=M*w-G*V,C=V*h-w*z,qa=z*G-h*M;if(L>A){H=z*H+M*I+V*K;if(0>H||H>L)continue;I=v*p+t*C+c*qa;if(0>I||H+I>L)continue}else if(L<-A){H=z*H+M*I+V*K;if(0<H||H<L)continue;I=v*p+t*C+c*qa;if(0<I||H+I<L)continue}else continue;L=(J*p+F*C+x*qa)/L;0<=L&&(H=y,g.vec3d.set3(h,G,w,B),g.vec3d.set3(J,F,x,E),h=g.vec3d.normalize(g.vec3d.cross(B,E,H)),k(L,h,u))}}function r(a,c,b){return g.vec3d.set3(1/
(c[0]-a[0]),1/(c[1]-a[1]),1/(c[2]-a[2]),b)}function v(a,c,b,e){var d=(a[0]-e-c[0])*b[0],f=(a[3]+e-c[0])*b[0],g=Math.min(d,f),d=Math.max(d,f),f=(a[1]-e-c[1])*b[1],n=(a[4]+e-c[1])*b[1],g=Math.max(g,Math.min(f,n)),d=Math.min(d,Math.max(f,n));if(g>d)return!1;f=(a[2]-e-c[2])*b[2];a=(a[5]+e-c[2])*b[2];g=Math.max(g,Math.min(f,a));d=Math.min(d,Math.max(f,a));return g<=d}function q(a,c){c=c?q(c):{};for(var b in a){var e=a[b];e&&e.forEach&&(e=n(e));null==e&&b in c||(c[b]=e)}return c}function n(a){var c=[];
a.forEach(function(a){return c.push(a)});return c}Object.defineProperty(h,"__esModule",{value:!0});var w=g.mat4d.create(),c=d.create(),x=k.VertexAttrConstants;h.IDENTITY=g.mat4d.identity();h.fill=e;h.fillColor=function(a,c,b,e,d){for(var f=0;f<d;++f)b[e+f]=a[c+f];return d};h.fillInterleaved=function(a,c,e,d,f,g,n,k){for(var q=m.getStride(f)/4,r=0;r<f.length;r++){var v=f[r],t=n+v.offset/4,v=v.name,u=a.vertexAttr[v];if(null!=u&&(null==k||null!=k[v]))switch(v){case "uv0":b(a.indices[v],u.data,u.size,
g,t,q);break;case "region":for(var v=a.indices[v],h=u.data,w=u.size,u=q,z=new Uint16Array(g.buffer),t=2*t,u=2*u,A=v.length,y=0;y<A;++y){for(var B=w*v[y],E=0;E<w;++E)z[t+E]=h[B+E];t+=u}break;case "color":if(d&&d.color)if(v=a.indices[v],h=u.data,w=d.color,y=u.size,u=q,z=new Uint8Array(g.buffer),t*=4,u*=4,A=v.length,4===y)for(y=0;y<A;++y)B=4*v[y],z[t]=h[B]*w[0],z[t+1]=h[B+1]*w[1],z[t+2]=h[B+2]*w[2],z[t+3]=h[B+3]*w[3],t+=u;else{if(3===y)for(E=255*w[3],y=0;y<A;++y)B=3*v[y],z[t]=h[B]*w[0],z[t+1]=h[B+1]*
w[1],z[t+2]=h[B+2]*w[2],z[t+3]=E,t+=u}else l(a.indices[v],u.data,u.size,g.buffer,t,q);break;case "symbolColor":l(a.indices[v],u.data,u.size,g.buffer,t,q);break;default:if(w=v===x.POSITION?c:v===x.NORMAL?e:void 0,void 0!==w&&3===u.size)for(v=a.indices[v],h=u.data,u=g,z=q,A=v.length,y=0;y<A;++y){var p=3*v[y],B=h[p],E=h[p+1],p=h[p+2];u[t]=w[0]*B+w[4]*E+w[8]*p+w[12];u[t+1]=w[1]*B+w[5]*E+w[9]*p+w[13];u[t+2]=w[2]*B+w[6]*E+w[10]*p+w[14];t+=z}else b(a.indices[v],u.data,u.size,g,t,q)}}};h.triangleVertexArrayToWireframeLines=
function(a,c,b,d){for(b=Math.floor(b/3)-1;0<=b;b--){var f=c+3*b*d,g=c+6*b*d+5*d;e(a,f,a,g,null,d);g-=d;e(a,f+d,a,g,null,d);g-=d;e(a,f+d,a,g,null,d);g-=d;e(a,f+2*d,a,g,null,d);g-=d;e(a,f+2*d,a,g,null,d);g-=d;e(a,f,a,g,null,d)}};h.intersectTriangleGeometry=function(b,e,f,g,n,l,q){k.assert("triangle"===b.data.primitiveType);e=e.componentVisibilities;g=g.tolerance;var m=b.getBoundingInfo();if(1<b.getComponentCount()){if(f=r(n,l,z),d.setMin(c,m.getBBMin()),d.setMax(c,m.getBBMax()),v(c,n,f,g))for(var h=
b.data,m=b.getComponentCount(),w=h.getIndices(x.POSITION),A=h.getAttribute(x.POSITION),h=h.componentOffsets,y=0;y<m;y++)if(a.getVisibility(e,y)){var B=b.getComponentAABB(y,c);v(B,n,f,g)&&u(n,l,h[y]/3,h[y+1]/3,w,A,void 0,q)}}else a.getVisibility(e,0)&&t(m,n,l,g,q)};var z=g.vec3d.create(),A=Math.pow(2,-52),y=g.vec3d.create(),B=g.vec3d.create(),E=g.vec3d.create();h.transformToWorld=function(a,c,b){return g.vec4d.set4(a[0]-c[0],a[1]-c[1],a[2]-c[2],1,b)};h.transformToView=function(a,c,b,e){g.mat4d.translate(b,
c,w);b=w;return g.mat4d.multiplyVec4(b,a,e)};h.transformToProjection=function(a,c,b,e){e[0]=a[0]+b[0];e[1]=a[1]+b[1];e[2]=a[2]+b[2];e[3]=a[3];return g.mat4d.multiplyVec4(c,e)};h.transformToNDC=function(a,c){return g.vec4d.scale(a,1/Math.abs(a[3]),c)};h.applyScreenSizePerspectiveScale=function(a,c,b,e,d){return f.scale(a,e,b,d)};h.verticalOffsetAtDistance=function(a,c,b,e,d){var g=b.screenLength||0;d&&(g=f.scale(g,e,c,d));return k.clamp(g*Math.tan(.5*a.fovY)/(.5*a.fullHeight)*c,b.minWorldLength||0,
null!=b.maxWorldLength?b.maxWorldLength:Infinity)};h.aquireIfNotUndefined=function(a,c,b){if(void 0!==a)return c.aquire(a,b)};h.releaseIfNotUndefined=function(a,c){void 0!==a&&c.release(a)};var C=g.mat4.create();h.bindView=function(a,c,b){g.mat4d.translate(c,a,C);b.setUniform3fv("localOrigin",a);b.setUniformMatrix4fv("view",C)};h.bindCamPos=function(a,c,b){b.setUniform3f("camPos",c[3]-a[0],c[7]-a[1],c[11]-a[2])};h.bindVerticalOffset=function(a,c,b){if(a){var e=c.fovY;c=c.viewport[3];var d=void 0;
void 0===d&&(d=G);d.screenLength=a.screenLength;d.perDistance=Math.tan(.5*e)/(.5*c);d.minWorldLength=a.minWorldLength;d.maxWorldLength=a.maxWorldLength;a=d;b.setUniform4f("verticalOffset",a.screenLength,a.perDistance,a.minWorldLength,a.maxWorldLength)}};h.bindScreenSizePerspective=function(a,c,b){void 0===b&&(b="screenSizePerspectiveAlignment");if(a){var e=a.parameters;c.setUniform4f(b,e.divisor,e.offset,e.minPixelSize,a.paddingPixelsOverride)}};h.copyParameters=q;h.updateParameters=function(a,c){var b=
!1,e;for(e in c){var d=c[e];void 0!==d&&(b=!0,Array.isArray(d)?a[e]=d.slice():a[e]=d)}return b};h.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var G={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}})},"esri/views/3d/support/aaBoundingBox":function(){define(["require","exports","../../../geometry/Extent","./aaBoundingRect"],function(p,h,d,a){function g(a){return a[0]>=a[3]?0:a[3]-a[0]}function f(a){return a[1]>=a[4]?0:a[4]-a[1]}function k(a){return a[2]>=a[5]?0:a[5]-a[2]}function m(a){return 6===
a.length}Object.defineProperty(h,"__esModule",{value:!0});h.create=function(a){void 0===a&&(a=h.ZERO);return[a[0],a[1],a[2],a[3],a[4],a[5]]};h.fromExtent=function(a){return[a.xmin,a.ymin,a.zmin,a.xmax,a.ymax,a.zmax]};h.toExtent=function(a,b){return isFinite(a[2])||isFinite(a[5])?new d({xmin:a[0],xmax:a[3],ymin:a[1],ymax:a[4],zmin:a[2],zmax:a[5],spatialReference:b}):new d({xmin:a[0],xmax:a[3],ymin:a[1],ymax:a[4],spatialReference:b})};h.fromMinMax=function(a,b){return[a[0],a[1],a[2],b[0],b[1],b[2]]};
h.expand=function(e,b,d){void 0===d&&(d=e);var f=b.declaredClass;"esri.geometry.Extent"===f?(d[0]=Math.min(e[0],b.xmin),d[1]=Math.min(e[1],b.ymin),d[3]=Math.max(e[3],b.xmax),d[4]=Math.max(e[4],b.ymax),b.hasZ&&(d[2]=Math.min(e[2],b.zmin),d[5]=Math.max(e[5],b.zmax))):"esri.geometry.Point"===f?(d[0]=Math.min(e[0],b.x),d[1]=Math.min(e[1],b.y),d[3]=Math.max(e[3],b.x),d[4]=Math.max(e[4],b.y),b.hasZ&&(d[2]=Math.min(e[2],b.z),d[5]=Math.max(e[5],b.z))):m(b)?(d[0]=Math.min(e[0],b[0]),d[1]=Math.min(e[1],b[1]),
d[2]=Math.min(e[2],b[2]),d[3]=Math.max(e[3],b[3]),d[4]=Math.max(e[4],b[4]),d[5]=Math.max(e[5],b[5])):a.is(b)?(d[0]=Math.min(e[0],b[0]),d[1]=Math.min(e[1],b[1]),d[3]=Math.max(e[3],b[2]),d[4]=Math.max(e[4],b[3])):Array.isArray(b)&&(2===b.length?(d[0]=Math.min(e[0],b[0]),d[1]=Math.min(e[1],b[1]),d[3]=Math.max(e[3],b[0]),d[4]=Math.max(e[4],b[1])):3===b.length&&(d[0]=Math.min(e[0],b[0]),d[1]=Math.min(e[1],b[1]),d[2]=Math.min(e[2],b[2]),d[3]=Math.max(e[3],b[0]),d[4]=Math.max(e[4],b[1]),d[5]=Math.max(e[5],
b[2])));return d};h.expandBuffer=function(a,b,d,f,g){void 0===g&&(g=a);var e=a[0],k=a[1],l=a[2],n=a[3],m=a[4];a=a[5];for(var c=0;c<f;c++)e=Math.min(e,b[d+3*c]),k=Math.min(k,b[d+3*c+1]),l=Math.min(l,b[d+3*c+2]),n=Math.max(n,b[d+3*c]),m=Math.max(m,b[d+3*c+1]),a=Math.max(a,b[d+3*c+2]);g[0]=e;g[1]=k;g[2]=l;g[3]=n;g[4]=m;g[5]=a;return g};h.allFinite=function(a){for(var b=0;6>b;b++)if(!isFinite(a[b]))return!1;return!0};h.width=g;h.depth=f;h.height=k;h.center=function(a,b){void 0===b&&(b=[0,0,0]);b[0]=a[0]+
g(a)/2;b[1]=a[1]+f(a)/2;b[2]=a[2]+k(a)/2;return b};h.size=function(a,b){void 0===b&&(b=[0,0,0]);b[0]=g(a);b[1]=f(a);b[2]=k(a);return b};h.containsPoint=function(a,b){return b[0]>=a[0]&&b[1]>=a[1]&&b[2]>=a[2]&&b[0]<=a[3]&&b[1]<=a[4]&&b[2]<=a[5]};h.containsPointWithMargin=function(a,b,d){return b[0]>=a[0]-d&&b[1]>=a[1]-d&&b[2]>=a[2]-d&&b[0]<=a[3]+d&&b[1]<=a[4]+d&&b[2]<=a[5]+d};h.contains=function(a,b){return b[0]>=a[0]&&b[1]>=a[1]&&b[2]>=a[2]&&b[3]<=a[3]&&b[4]<=a[4]&&b[5]<=a[5]};h.intersects=function(a,
b){return Math.max(b[0],a[0])<=Math.min(b[3],a[3])&&Math.max(b[1],a[1])<=Math.min(b[4],a[4])&&Math.max(b[2],a[2])<=Math.min(b[5],a[5])};h.offset=function(a,b,d,f,g){void 0===g&&(g=a);g[0]=a[0]+b;g[1]=a[1]+d;g[2]=a[2]+f;g[3]=a[3]+b;g[4]=a[4]+d;g[5]=a[5]+f;return g};h.setMin=function(a,b,d){void 0===d&&(d=a);d[0]=b[0];d[1]=b[1];d[2]=b[2];d!==a&&(d[3]=a[3],d[4]=a[4],d[5]=a[5]);return d};h.setMax=function(a,b,d){void 0===d&&(d=a);d[3]=b[0];d[4]=b[1];d[5]=b[2];d!==a&&(d[0]=a[0],d[1]=a[1],d[2]=a[2]);return a};
h.set=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a};h.toRect=function(e,b){b||(b=a.create());b[0]=e[0];b[1]=e[1];b[2]=e[3];b[3]=e[4];return b};h.fromRect=function(a,b){a[0]=b[0];a[1]=b[1];a[3]=b[2];a[4]=b[3];return a};h.is=m;h.isPoint=function(a){return 0===g(a)&&0===f(a)&&0===k(a)};h.equals=function(a,b,d){if(null==a||null==b)return a===b;if(!m(a)||!m(b))return!1;if(d)for(var e=0;e<a.length;e++){if(!d(a[e],b[e]))return!1}else for(e=0;e<a.length;e++)if(a[e]!==
b[e])return!1;return!0};h.POSITIVE_INFINITY=[-Infinity,-Infinity,-Infinity,Infinity,Infinity,Infinity];h.NEGATIVE_INFINITY=[Infinity,Infinity,Infinity,-Infinity,-Infinity,-Infinity];h.ZERO=[0,0,0,0,0,0]})},"esri/views/3d/support/aaBoundingRect":function(){define(["require","exports","./mathUtils"],function(p,h,d){function a(a){return a[0]>=a[2]?0:a[2]-a[0]}function g(a){return a[1]>=a[3]?0:a[3]-a[1]}function f(a){return 4===a.length}Object.defineProperty(h,"__esModule",{value:!0});h.create=function(a){void 0===
a&&(a=h.ZERO);return[a[0],a[1],a[2],a[3]]};h.fromExtent=function(a){return[a.xmin,a.ymin,a.xmax,a.ymax]};h.expand=function(a,d,e){void 0===e&&(e=a);var b=d.declaredClass;"esri.geometry.Extent"===b?(e[0]=Math.min(a[0],d.xmin),e[1]=Math.min(a[1],d.ymin),e[2]=Math.max(a[2],d.xmax),e[3]=Math.max(a[3],d.ymax)):"esri.geometry.Point"===b?(e[0]=Math.min(a[0],d.x),e[1]=Math.min(a[1],d.y),e[2]=Math.max(a[2],d.x),e[3]=Math.max(a[3],d.y)):f(d)?(e[0]=Math.min(a[0],d[0]),e[1]=Math.min(a[1],d[1]),e[2]=Math.max(a[2],
d[2]),e[3]=Math.max(a[3],d[3])):!Array.isArray(d)||2!==d.length&&3!==d.length||(e[0]=Math.min(a[0],d[0]),e[1]=Math.min(a[1],d[1]),e[2]=Math.max(a[2],d[0]),e[3]=Math.max(a[3],d[1]));return e};h.allFinite=function(a){for(var d=0;4>d;d++)if(!isFinite(a[d]))return!1;return!0};h.width=a;h.height=g;h.center=function(d,f){void 0===f&&(f=[0,0]);f[0]=d[0]+a(d)/2;f[1]=d[1]+g(d)/2;return f};h.containsPoint=function(a,d){return d[0]>=a[0]&&d[1]>=a[1]&&d[0]<=a[2]&&d[1]<=a[3]};h.containsPointWithMargin=function(a,
d,e){return d[0]>=a[0]-e&&d[1]>=a[1]-e&&d[0]<=a[2]+e&&d[1]<=a[3]+e};h.intersects=function(a,d){return Math.max(d[0],a[0])<=Math.min(d[2],a[2])&&Math.max(d[1],a[1])<=Math.min(d[3],a[3])};h.contains=function(a,d){return d[0]>=a[0]&&d[2]<=a[2]&&d[1]>=a[1]&&d[3]<=a[3]};h.intersection=function(a,f,e){void 0===e&&(e=a);var b=f[0],g=f[1],k=f[2];f=f[3];e[0]=d.clamp(a[0],b,k);e[1]=d.clamp(a[1],g,f);e[2]=d.clamp(a[2],b,k);e[3]=d.clamp(a[3],g,f);return e};h.offset=function(a,d,e,b){void 0===b&&(b=a);b[0]=a[0]+
d;b[1]=a[1]+e;b[2]=a[2]+d;b[3]=a[3]+e;return b};h.setMin=function(a,d,e){void 0===e&&(e=a);e[0]=d[0];e[1]=d[1];e!==a&&(e[2]=a[2],e[3]=a[3]);return e};h.setMax=function(a,d,e){void 0===e&&(e=a);e[2]=d[0];e[3]=d[1];e!==a&&(e[0]=a[0],e[1]=a[1]);return a};h.set=function(a,d){a[0]=d[0];a[1]=d[1];a[2]=d[2];a[3]=d[3];return a};h.is=f;h.isPoint=function(d){return(0===a(d)||!isFinite(d[0]))&&(0===g(d)||!isFinite(d[1]))};h.equals=function(a,d,e){if(null==a||null==d)return a===d;if(!f(a)||!f(d))return!1;if(e)for(var b=
0;b<a.length;b++){if(!e(a[b],d[b]))return!1}else for(b=0;b<a.length;b++)if(a[b]!==d[b])return!1;return!0};h.POSITIVE_INFINITY=[-Infinity,-Infinity,Infinity,Infinity];h.NEGATIVE_INFINITY=[Infinity,Infinity,-Infinity,-Infinity];h.ZERO=[0,0,0,0]})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["require","exports","../../../../core/arrayUtils"],function(p,h,d){function a(a,b){if(null!=a){var c=a.isVisibleBit,e=a.data,d=8*e.BYTES_PER_ELEMENT;return b<e.length*d?u(c,e,b,d):!a.isVisibleBit}return!0}
function g(a){return null===a.component?-1:a.component}function f(b,e,c,d,f){a(e,d)&&k(b,e,c,c[d],c[d+1]-1,f)}function k(a,b,c,e,d,f){c=(b=0<a.length?a[a.length-1]:null)?b.range[1]:-1;var g=b?b.options:null;c>=e||(c+1===e&&g===f?b.range[1]=d:a.push({range:[e,d],options:f}))}function m(a){void 0===a&&(a=!0);return{isVisibleBit:!a,data:new Uint32Array(0)}}function e(a,b){return l(a,b,!0)}function b(a,b){return l(a,b,!1)}function l(a,b,c){var e=!1;a=a||v;e=a.isVisibleBit;a=a.data;b=r(b);var d=8*a.BYTES_PER_ELEMENT,
f=a.length*d;c=c===e;if(0===a.length||0===b)e=!c;else if(f<b&&!c)e=!0;else{for(var g=q[d],f=q[0],n=0;n<a.length-1;n++)if(e=!c&&a[n]!==g||c&&a[n]!==f)return e;e=a.length-1;b=q[(b-1)%d+1];e=!c&&(a[e]&b)!==b||c&&(a[e]&b)!==f}return e}function t(a){return 0<a.length}function u(a,b,c,e){var d=c/e|0;return 0!==(b[d]&1<<c-d*e)===a}function r(a){return Math.max(0,a.length-1)}Object.defineProperty(h,"__esModule",{value:!0});h.updateVisibility=function(a,b,c,e){if(c<r(b)){null==a&&(a=m());var d=a.isVisibleBit,
f=a.data,g=8*f.BYTES_PER_ELEMENT,n=c/g|0,k=c-g*n;b=(r(b)-1)/g|0;var l=f;e=e===d;c<l.length*g||!e||(c=Math.max(n+1,Math.ceil(1.5*l.length)),c=Math.min(c,b+1),f=new Uint32Array(c),f.set(l));n<f.length&&(f[n]=f[n]&~(1<<k)|(e?1:0)<<k);a.data=f}return a};h.getVisibility=a;h.hideAllComponents=function(a){if(null==a)a=m(!1);else{a.isVisibleBit=!0;for(var b=0;b<a.data.length;b++)a.data[b]=0}return a};h.unhideAllComponents=function(a){var b;if(null!=a)for(b=a,b.isVisibleBit=!1,a=0;a<b.data.length;a++)b.data[a]=
0;return b};h.generateVisibleIndexRanges=function(a,b){var c;if(a)if(t(b))if(0===a.data.length)c=[],b=[[b[0],b[b.length-1]-1]],c=a.isVisibleBit?c:b;else{c=[];for(var e=a.isVisibleBit,d=a.data,f=8*d.BYTES_PER_ELEMENT,g=d.length*f,n=r(b),k=!1,l=0;l<g&&l<n;l++){var q=u(e,d,l,f);if(q!==k){var m=b[l];q?c.push([m,0]):(k=c[c.length-1],k[1]=m-1);k=q}}a=!a.isVisibleBit;n>g&&a&&!k?c.push([b[g],b[n]-1]):k&&(k=c[c.length-1],k[1]=b[a?n:Math.min(n,g)]-1)}else c=[],c=a.isVisibleBit?c:null;else c=null;return c};
h.addHighlight=function(a,b,c,e){a=a||[];b={component:b,options:c,id:e};a.push(b);b=g(b);for(c=a.length-1;0<c&&b<g(a[c-1]);)e=[a[c],a[c-1]],a[c-1]=e[0],a[c]=e[1],--c;return a};h.removeHighlight=function(a,b){return a?(a=a.filter(function(a){return a.id!==b}),0===a.length?null:a):a};h.generateHighlightedIndexRanges=function(a,e,c){if(e){if(t(c)){for(var d=c[0],g=c[c.length-1]-1,n=[],l=!b(a,c),q=0;q<e.length;++q){var m=e[q].options,v=e[q].component;if(null!==v)f(n,a,c,v,m);else if(l)k(n,a,c,d,g,m);
else for(v=0;v<r(c);++v)f(n,a,c,v,m)}return 0<n.length?n:null}var l=!a||!a.isVisibleBit;return l?e.map(function(a){return{range:null,options:a.options}}):null}return null};h.defaultVisibilities=m;h.isAllVisible=function(a,e){return!b(a,e)};h.isAllHidden=function(a,b){return!e(a,b)};h.hasVisible=e;h.hasHidden=b;var v=m();h.createOffsets=function(a){return Array.isArray(a)?new Uint32Array(a):a};h.hasComponent=function(a,b){return b<r(a)};h.hasComponents=t;var q=[];for(p=0;65>p;p++)q.push(Math.pow(2,
p)-1);h.componentCount=r;h.componentFind=function(a,b){a=d.binaryIndexOf(a,b,!0);return 0<=a?a:null}})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["require","exports","./Util"],function(p,h,d){function a(a){return Math.abs(a*a*a)}function g(b,e,d,f){void 0===f&&(f=l);var g=d.parameters;d=d.paddingPixelsOverride;f.scale=Math.min(g.divisor/(e-g.offset),1);f.factor=a(b);f.minPixelSize=g.minPixelSize;f.paddingPixels=d;return f}function f(a,b){return 0===a?b.minPixelSize:
b.minPixelSize*(1+2*b.paddingPixels/a)}function k(a,b){return Math.max(d.lerp(a*b.scale,a,b.factor),f(a,b))}function m(a,b,e){a=g(a,b,e);a.minPixelSize=0;a.paddingPixels=0;return k(1,a)}Object.defineProperty(h,"__esModule",{value:!0});h.getSettings=function(a){return new e(a,h.defaultDescription)};h.getLabelSettings=function(a){var d=h.defaultDescription.curvatureDependent;return new e(a,{curvatureDependent:{min:{curvature:d.min.curvature,tiltAngle:d.min.tiltAngle,scaleFallOffFactor:b.curvatureDependent.min.scaleFallOffFactor},
max:{curvature:d.max.curvature,tiltAngle:d.max.tiltAngle,scaleFallOffFactor:b.curvatureDependent.max.scaleFallOffFactor}},scaleStart:h.defaultDescription.scaleStart,scaleFallOffRange:h.defaultDescription.scaleFallOffRange,minPixelSize:b.minPixelSize})};h.perspectiveFactor=a;h.scaleFactor=g;h.applyScaleFactor=k;h.applyScaleFactorVec2=function(a,b,e){void 0===e&&(e=[0,0]);var g=Math.min(Math.max(b.scale,f(a[1],b)/a[1]),1);e[0]=d.lerp(a[0]*g,a[0],b.factor);e[1]=d.lerp(a[1]*g,a[1],b.factor);return e};
h.precomputeScale=m;h.precomputeScaleFactor=function(a,b,e,d){d.scale=m(a,b,e);d.factor=0;d.minPixelSize=e.parameters.minPixelSize;d.paddingPixels=e.paddingPixelsOverride;return d};h.applyPrecomputedScaleFactorVec2=function(a,b,e){void 0===e&&(e=[0,0]);b=Math.min(Math.max(b.scale,f(a[1],b)/a[1]),1);e[0]=a[0]*b;e[1]=a[1]*b;return e};h.scale=function(a,b,e,d){return k(a,g(b,e,d))};var e=function(){function a(a,b,e,d){void 0===e&&(e={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0});
this.viewingMode=a;this.description=b;this.parameters=e;this._paddingPixelsOverride=d;"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}Object.defineProperty(a.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||
this.parameters.paddingPixels},enumerable:!0,configurable:!0});a.prototype.update=function(a){if(this.parameters&&this.parameters.camera.fovY===a.fovY&&this.parameters.camera.distance===a.distance)return!1;this.calculateParameters(a,this.parameters);return!0};a.prototype.overridePadding=function(b){return b!==this.paddingPixelsOverride?new a(this.viewingMode,this.description,this.parameters,b):this};a.prototype.calculateParameters=function(a,b){var e=this.description,d=e.scaleStart,c=e.scaleFallOffRange,
e=e.minPixelSize,f=a.fovY,g=a.distance,k=this.calculateCurvatureDependentParameters(a),l=this.coverageCompensation(a,k),q=k.tiltAngle,k=k.scaleFallOffFactor,g=Math.sin(q)*g,q=.5*Math.PI-q-f*(.5-d*l),d=g/Math.cos(q),c=(d-g/Math.cos(q+f*c*l)*k)/(1-k);b.camera.fovY=a.fovY;b.camera.distance=a.distance;b.offset=c;b.divisor=d-c;b.minPixelSize=e;return b};a.prototype.calculateCurvatureDependentParametersLocal=function(a,b){void 0===b&&(b=t);b.tiltAngle=this.description.curvatureDependent.min.tiltAngle;b.scaleFallOffFactor=
this.description.curvatureDependent.min.scaleFallOffFactor;return b};a.prototype.calculateCurvatureDependentParametersGlobal=function(a,b){void 0===b&&(b=t);var e=this.description.curvatureDependent;a=1+a.distance/u;var f=[e.min.curvature,e.max.curvature],c=f[0];a=d.clamp((Math.sqrt(a*a-1)-c)/(f[1]-c),0,1);f=[e.min,e.max];e=f[0];f=f[1];b.tiltAngle=d.lerp(e.tiltAngle,f.tiltAngle,a);b.scaleFallOffFactor=d.lerp(e.scaleFallOffFactor,f.scaleFallOffFactor,a);return b};a.prototype.surfaceCoverageCompensationLocal=
function(a,b){return(a.fovY-b.tiltAngle)/a.fovY};a.prototype.surfaceCoverageCompensationGlobal=function(a,b){var e=u*u;b=b.tiltAngle+.5*Math.PI;var d=a.fovY;a=a.distance;a=a*a+e-2*Math.cos(b)*a*u;var c=Math.sqrt(a);return(Math.acos(Math.sqrt(a-e)/c)-Math.asin(u/(c/Math.sin(b)))+.5*d)/d};return a}();h.defaultDescription={curvatureDependent:{min:{curvature:d.deg2rad(10),tiltAngle:d.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:d.deg2rad(70),tiltAngle:d.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,
scaleFallOffRange:.65,minPixelSize:0};var b={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};h.copyParameters=function(a,b){b.camera.distance=a.camera.distance;b.camera.fovY=a.camera.fovY;b.divisor=a.divisor;b.offset=a.offset;b.minPixelSize=a.minPixelSize;return b};var l={scale:0,factor:0,minPixelSize:0,paddingPixels:0},t={tiltAngle:0,scaleFallOffFactor:0},u=6378137})},"esri/views/webgl/Util":function(){define(["require","exports","../../core/tsSupport/assignHelper",
"../../core/Error"],function(p,h,d,a){return function(){function g(){}g.vertexCount=function(a,d){return a.vertexBuffers[d].size/g.getStride(a.layout[d])};g.getStride=function(a){return a[0].stride};g.getBytesPerElement=function(a){switch(a){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw Error("Unknown data type");}};g.addDescriptor=function(a,d,m,e,b,l){var f=g.getBytesPerElement(e);if(0<a.length){var k=
a[0].stride,r=k+f*m;a.forEach(function(a){return a.stride=r});a.push({name:d,count:m,type:e,offset:k,stride:r,normalized:b,divisor:l})}else a.push({name:d,count:m,type:e,offset:0,stride:f*m,normalized:b,divisor:l})};g.assertCompatibleVertexAttributeLocations=function(a,d){(a=a.locations===d.locations)||console.error("VertexAttributeLocations are incompatible");return a};g.hasAttribute=function(a,d){for(var f=0;f<a.length;f++)if(a[f].name===d)return!0;return!1};g.findAttribute=function(a,d){for(var f=
0;f<a.length;f++)if(a[f].name===d)return a[f];return null};g.copyFramebufferToTexture=function(a,d,g,e,b){void 0===b&&(b=0);var f=a.getBoundFramebufferObject(),k=a.getBoundTexture(0);a.bindFramebuffer(d);a.bindTexture(g,0);a.gl.copyTexImage2D(a.gl.TEXTURE_2D,b,g.descriptor.pixelFormat,e[0],e[1],e[2],e[3],0);a.gl.flush();a.bindFramebuffer(f);a.bindTexture(k,0)};g.assert=function(d,g){if(!d)throw new a(g);};g.setBaseInstanceOffset=function(a,g){var f={},e;for(e in a)f[e]=a[e].map(function(a){return a.divisor?
d({},a,{baseInstance:g}):a});return f};return g}()})},"esri/views/webgl/BufferObject":function(){define(["require","exports"],function(p,h){return function(){function d(a,g,f,k,m){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=void 0;this._context=a;this._bufferType=g;this._usage=f;this._id=d._nextId++;this._glName=this._context.gl.createBuffer();k&&this.setData(k,m)}d.createIndex=function(a,g,f,k){return new d(a,34963,g,f,k)};d.createVertex=
function(a,g,f){return new d(a,34962,g,f)};Object.defineProperty(d.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"usage",{get:function(){return this._usage},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"bufferType",{get:function(){return this._bufferType},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"indexType",{get:function(){return this._indexType},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"byteSize",{get:function(){return 34962===this._bufferType?this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!0,configurable:!0});d.prototype.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=
null),this._context=null)};d.prototype.setData=function(a,d){if(a){if("number"===typeof a){if(0>a&&console.error("Buffer size cannot be negative!"),34963===this._bufferType&&d)switch(this._indexType=d,this._size=a,d){case 5123:a*=2;break;case 5125:a*=4}}else d=a.byteLength,a instanceof Uint16Array&&(d/=2,this._indexType=5123),a instanceof Uint32Array&&(d/=4,this._indexType=5125),this._size=d;d=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferData(this._bufferType,
a,this._usage);this._context.bindVAO(d)}};d.prototype.setSubData=function(a,d,f,k){void 0===d&&(d=0);void 0===f&&(f=0);if(a){(0>d||d>=this._size)&&console.error("offset is out of range!");var g=d,e=f,b=k,l=a.byteLength;a instanceof Uint16Array&&(l/=2,g*=2,e*=2,b*=2);a instanceof Uint32Array&&(l/=4,g*=4,e*=4,b*=4);void 0===k&&(k=l-1);f>=k&&console.error("end must be bigger than start!");d+f-k>this._size&&console.error("An attempt to write beyond the end of the buffer!");d=this._context.getBoundVAO();
this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferSubData(this._bufferType,g,(a instanceof ArrayBuffer?a:a.buffer).slice(e,b));this._context.bindVAO(d)}};d._nextId=0;return d}()})},"esri/views/webgl/VertexArrayObject":function(){define(["require","exports"],function(p,h){return function(){function d(a,g,f,k,m){this._locations=this._layout=this._glName=this._context=null;this._indexBuffer=this._buffers=void 0;this._initialized=!1;this._context=a;this._layout=f;this._buffers=
k;this._locations=g;m&&(this._indexBuffer=m);this._id=d._nextId++}Object.defineProperty(d.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexBuffers",{get:function(){return this._buffers},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"size",{get:function(){var a=this;return Object.keys(this._buffers).reduce(function(d,f){return d+a._buffers[f].size},this._indexBuffer?this._indexBuffer.size:0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});d.prototype.dispose=function(a){void 0===
a&&(a=!0);if(this._context){var d=this._context.capabilities.vao;d&&this._glName&&(d.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(a){for(var f in this._buffers)this._buffers[f].dispose(),delete this._buffers[f];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}this._context=null}};d.prototype.initialize=function(){if(!this._initialized){var a=this._context.capabilities.vao;if(a){var d=a.createVertexArray();
a.bindVertexArray(d);this._bindLayout();a.bindVertexArray(null);this._glName=d}this._initialized=!0}};d.prototype.bind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};d.prototype._bindLayout=function(){var a=this._buffers,d=!!this._context.capabilities.vao,f=this._layout,k=this._indexBuffer;a||console.error("Vertex buffer dictionary is empty!");var m=this._context.gl,e,b,l=0,t;for(t in a)for((e=a[t])||
console.error("Vertex buffer is uninitialized!"),(b=f[t])||console.error("Vertex element descriptor is empty!"),this._context.bindBuffer(e),l=0;l<b.length;++l){e=b[l];var u=this._locations[e.name],r=e.baseInstance?e.baseInstance*e.stride:0;void 0===u&&console.error("There is no location for vertex attribute '"+e.name+"' defined.");e.baseInstance&&!e.divisor&&console.error("Vertex attribute '"+e.name+"' uses baseInstanceOffset without divisor.");if(4>=e.count){if(m.enableVertexAttribArray(u),m.vertexAttribPointer(u,
e.count,e.type,e.normalized,e.stride,e.offset+r),e.divisor&&0<e.divisor){var v=this._context.capabilities.instancing;v&&v.vertexAttribDivisor(u,e.divisor)}}else if(16===e.count&&5126===e.type)for(var q=0;4>q;q++)m.enableVertexAttribArray(u+q),m.vertexAttribPointer(u+q,4,e.type,e.normalized,e.stride,e.offset+16*q+r),e.divisor&&0<e.divisor&&(v=this._context.capabilities.instancing)&&v.vertexAttribDivisor(u+q,e.divisor);else console.error("Unsupported vertex attribute element count: "+e.count)}k&&(d?
m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,k.glName):this._context.bindBuffer(k))};d.prototype.unbind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(null):this._unbindLayout()};d.prototype._unbindLayout=function(){var a=this._buffers,d=this._layout,f=this._locations,k=this._context;a||console.error("Vertex buffer dictionary is empty!");var m=k.gl,e,b,l,t=0,u=0,r;for(r in a){(e=a[r])||console.error("Vertex buffer is uninitialized!");b=d[r];t=0;for(u=b.length;t<u;++t)l=
b[t],m.disableVertexAttribArray(f[l.name]);k.unbindBuffer(e.bufferType)}(a=this._indexBuffer)&&k.unbindBuffer(a.bufferType)};d._nextId=0;return d}()})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define(["./GeometryData","./BufferVectorMath","./Util","./gl-matrix"],function(p,h,d,a){function g(a,b,e,d,g){if(Math.abs(f.dot(b,a))>g)return!1;f.cross(a,b,e);f.normalize(e);f.cross(e,a,d);f.normalize(d);return!0}var f=a.vec3,k=a.vec4,m=a.vec3d,e=d.VertexAttrConstants,b=h.Vec3Compact,l=m.create(),
t=m.create(),u={createSphereGeometry:function(a,b,g,n,k,c,l){a=a||50;n=void 0!==n?n:-Math.PI;k=void 0!==k?k:2*Math.PI;c=void 0!==c?c:.5*-Math.PI;l=void 0!==l?l:Math.PI;var q=Math.max(3,Math.floor(b)||8),m=Math.max(2,Math.floor(g)||6),r=(q+1)*(m+1);g=new Float32Array(3*r);b=new Float32Array(3*r);var r=new Float32Array(2*r),v,t,u=[],h=f.create(),w=0;for(t=0;t<=m;t++){var x=[],I=t/m,H=c+I*l,K=Math.cos(H);for(v=0;v<=q;v++){var L=v/q,M=n+L*k,V=Math.cos(M)*K*a,S=Math.sin(H)*a,M=-Math.sin(M)*K*a;g[3*w]=
V;g[3*w+1]=S;g[3*w+2]=M;f.set3(V,S,M,h);f.normalize(h);b[3*w]=h[0];b[3*w+1]=h[1];b[3*w+2]=h[2];r[2*w]=L;r[2*w+1]=I;x.push(w);++w}u.push(x)}a=new Uint32Array(2*q*(m-1)*3);for(t=w=0;t<m;t++)for(v=0;v<q;v++)n=u[t][v],k=u[t][v+1],c=u[t+1][v+1],l=u[t+1][v],0===t?(a[w++]=n,a[w++]=c,a[w++]=l):t===m-1?(a[w++]=n,a[w++]=k,a[w++]=c):(a[w++]=n,a[w++]=k,a[w++]=c,a[w++]=c,a[w++]=l,a[w++]=n);d.assert(w===a.length);q={};q[e.POSITION]=a;q[e.NORMAL]=a;q[e.UV0]=a;m={};m[e.POSITION]={size:3,data:g};m[e.NORMAL]={size:3,
data:b};m[e.UV0]={size:2,data:r};return new p(m,q)},createPolySphereGeometry:function(a,d,f){function g(e,d){e>d&&(e=d+(d=e,0));var f=e.toString()+"."+d.toString();if(l[f])return l[f];var g=c.length;c.length+=3;b.add(c,3*e,c,3*d,c,g);b.scale(c,g,a/b.length(c,g));g/=3;return l[f]=g}var k,c;f?(c=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],f=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]):(f=a*(1+Math.sqrt(5))/2,c=[-a,f,0,a,f,0,-a,-f,0,a,-f,0,0,-a,f,0,a,f,0,-a,-f,0,a,-f,f,0,-a,f,0,a,-f,0,-a,-f,0,a],
f=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);for(k=0;k<c.length;k+=3)b.scale(c,k,a/b.length(c,k));var l={};for(k=0;k<d;k++){for(var q=f.length,m=new Uint32Array(4*q),r=0;r<q;r+=3){var v=f[r],t=f[r+1],u=f[r+2],h=g(v,t),J=g(t,u),F=g(u,v),I=4*r;m[I]=v;m[I+1]=h;m[I+2]=F;m[I+3]=t;m[I+4]=J;m[I+5]=h;m[I+6]=u;m[I+7]=F;m[I+8]=J;m[I+9]=h;m[I+10]=J;m[I+11]=F}f=m;l={}}d=new Float32Array(c);for(k=0;k<d;k+=3)b.normalize(d,
k);c=new Float32Array(c);k={};k[e.POSITION]=f;k[e.NORMAL]=f;f={};f[e.POSITION]={size:3,data:c};f[e.NORMAL]={size:3,data:d};return new p(f,k)},createPointGeometry:function(a,b,d,f,g,c,k){var n=new Float32Array(3);n[0]=b?b[0]:0;n[1]=b?b[1]:0;n[2]=b?b[2]:0;b=new Float32Array(3);b[0]=a?a[0]:0;b[1]=a?a[1]:0;b[2]=a?a[2]:1;if(null==c)a=new Float32Array(2),a[0]=0,a[1]=0;else{a=new Float32Array(c.length);for(var l=0;l<c.length;l++)a[l]=c[l]}c=new Uint8Array(4);c[0]=d?255*d[0]:255;c[1]=d?255*d[1]:255;c[2]=
d?255*d[2]:255;c[3]=d&&3<d.length?255*d[3]:255;d=new Float32Array(2);d[0]=null!=f&&2==f.length?f[0]:1;d[1]=null!=f&&2==f.length?f[1]:1;if(null!=g){var q=new Float32Array(4);q[0]=g[0];q[1]=g[1];q[2]=g[2];q[3]=g[3]}if(null!=k){var m=new Float32Array(4);m[0]=k[0];m[1]=k[1];m[2]=k[2];m[3]=k[3]}l=new Uint32Array(1);l[0]=0;f={};f[e.POSITION]=l;f[e.NORMAL]=l;f[e.UV0]=l;f[e.COLOR]=l;f[e.SIZE]=l;null!=g&&(f[e.AUXPOS1]=l);null!=k&&(f[e.AUXPOS2]=l);l={};l[e.POSITION]={size:3,data:n};l[e.NORMAL]={size:3,data:b};
l[e.UV0]={size:a.length,data:a};l[e.COLOR]={size:4,data:c};l[e.SIZE]={size:2,data:d};null!=g&&(l[e.AUXPOS1]={size:4,data:q});null!=k&&(l[e.AUXPOS2]={size:4,data:m});return new p(l,f,p.DefaultOffsets,"point")},createPointArrayGeometry:function(a,b){for(var d=new Float32Array(3*a.length),f=new Float32Array(b?3*a.length:3),g=new Uint32Array(a.length),c=new Uint32Array(a.length),k=0;k<a.length;k++)d[3*k]=a[k][0],d[3*k+1]=a[k][1],d[3*k+2]=a[k][2],b&&(f[3*k]=b[k][0],f[3*k+1]=b[k][1],f[3*k+2]=b[k][2]),g[k]=
k,c[k]=0;b||(f[0]=0,f[1]=1,f[2]=0);a=new Float32Array(2);a[0]=0;a[1]=0;k={};k[e.POSITION]=g;k[e.NORMAL]=b?g:c;k[e.UV0]=c;b={};b[e.POSITION]={size:3,data:d};b[e.NORMAL]={size:3,data:f};b[e.UV0]={size:2,data:a};return new p(b,k,p.DefaultOffsets,"point")},createTriangleGeometry:function(){var a=new Float32Array(9);a[0]=0;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=100;a[6]=100;a[7]=0;a[8]=0;var b=new Uint32Array(3);b[0]=0;b[1]=1;b[2]=2;var d=new Float32Array(3);d[0]=0;d[1]=1;d[2]=0;var f=new Uint32Array(3);f[0]=
0;f[1]=0;f[2]=0;var g=new Float32Array(2);g[0]=0;g[1]=0;var c=new Uint32Array(3);c[0]=0;c[1]=0;c[2]=0;var k={};k[e.POSITION]=b;k[e.NORMAL]=f;k[e.UV0]=c;b={};b[e.POSITION]={size:3,data:a};b[e.NORMAL]={size:3,data:d};b[e.UV0]={size:2,data:g};return new p(b,k)},createSquareGeometry:function(a){var b,d,f=new Float32Array(12);if(a)for(b=0;4>b;b++)for(d=0;3>d;d++)f[3*b+d]=a[b][d];else f[0]=-1,f[1]=-1,f[2]=0,f[3]=1,f[4]=-1,f[5]=0,f[6]=1,f[7]=1,f[8]=0,f[9]=-1,f[10]=1,f[11]=0;d=new Uint32Array(6);d[0]=0;d[1]=
1;d[2]=2;d[3]=2;d[4]=3;d[5]=0;a=new Float32Array(3);a[0]=0;a[1]=0;a[2]=1;var g=new Uint32Array(6);for(b=0;6>b;b++)g[b]=0;b=new Float32Array(8);b[0]=0;b[1]=0;b[2]=1;b[3]=0;b[4]=1;b[5]=1;b[6]=0;b[7]=1;var c=new Uint8Array(4);c[0]=255;c[1]=255;c[2]=255;c[3]=255;var k={};k[e.POSITION]=d;k[e.NORMAL]=g;k[e.UV0]=d;k[e.COLOR]=g;d={};d[e.POSITION]={size:3,data:f};d[e.NORMAL]={size:3,data:a};d[e.UV0]={size:2,data:b};d[e.COLOR]={size:4,data:c};return new p(d,k)},createBoxGeometry:function(){var a,b,d=[[-.5,
-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],f=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],g=[0,0,1,0,1,1,0,1],c=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],k=Array(36);for(a=0;6>a;a++)for(b=0;6>b;b++)k[6*a+b]=a;var l=Array(36);for(a=0;6>a;a++)l[6*a+0]=0,l[6*a+1]=1,l[6*a+2]=2,l[6*a+3]=2,l[6*a+4]=3,l[6*a+5]=0;return function(a){var b;Array.isArray(a)||(a=[a,a,a]);var n=new Float32Array(24);for(b=0;8>b;b++)n[3*b]=d[b][0]*
a[0],n[3*b+1]=d[b][1]*a[1],n[3*b+2]=d[b][2]*a[2];a={};a[e.POSITION]=new Uint32Array(c);a[e.NORMAL]=new Uint32Array(k);a[e.UV0]=new Uint32Array(l);b={};b[e.POSITION]={size:3,data:n};b[e.NORMAL]={size:3,data:new Float32Array(f)};b[e.UV0]={size:2,data:new Float32Array(g)};return new p(b,a)}}(),createDiamondGeometry:function(){var a=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],b=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],d=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,
4,3,0],f=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];return function(g){var c;Array.isArray(g)||(g=[g,g,g]);var k=new Float32Array(18);for(c=0;6>c;c++)k[3*c]=a[c][0]*g[0],k[3*c+1]=a[c][1]*g[1],k[3*c+2]=a[c][2]*g[2];g={};g[e.POSITION]=new Uint32Array(d);g[e.NORMAL]=new Uint32Array(f);c={};c[e.POSITION]={size:3,data:k};c[e.NORMAL]={size:3,data:new Float32Array(b)};return new p(c,g)}}(),createTetrahedronGeometry:function(){var a=f.createFrom(-.5,0,-.5),b=f.createFrom(.5,0,-.5),d=f.createFrom(0,
0,.5),g=f.createFrom(0,.5,0),k=f.create(),c=f.create(),l=f.create(),m=f.create(),t=f.create();f.subtract(a,g,k);f.subtract(a,b,c);f.cross(k,c,l);f.normalize(l,l);f.subtract(b,g,k);f.subtract(b,d,c);f.cross(k,c,m);f.normalize(m,m);f.subtract(d,g,k);f.subtract(d,a,c);f.cross(k,c,t);f.normalize(t,t);var u=[a,b,d,g],h=[0,-1,0,l[0],l[1],l[2],m[0],m[1],m[2],t[0],t[1],t[2]],E=[0,1,2,3,1,0,3,2,1,3,0,2],C=[0,0,0,1,1,1,2,2,2,3,3,3];return function(a){var c;Array.isArray(a)||(a=[a,a,a]);var b=new Float32Array(12);
for(c=0;4>c;c++)b[3*c]=u[c][0]*a[0],b[3*c+1]=u[c][1]*a[1],b[3*c+2]=u[c][2]*a[2];a={};a[e.POSITION]=new Uint32Array(E);a[e.NORMAL]=new Uint32Array(C);c={};c[e.POSITION]={size:3,data:b};c[e.NORMAL]={size:3,data:new Float32Array(h)};return new p(c,a)}}(),createConeGeometry:function(a,b,d,g){var k=0,c=f.createFrom(0,k,0),n=f.createFrom(0,k+a,0),l=f.createFrom(0,-1,0),q=f.createFrom(0,1,0);g&&(k=a,n=f.createFrom(0,0,0),c=f.createFrom(0,k,0),l=f.createFrom(0,1,0),q=f.createFrom(0,-1,0));var c=[n,c],l=[l,
q],q=d+2,m=0,n=Math.sqrt(a*a+b*b);if(g)for(g=d-1;0<=g;g--)m=2*Math.PI/d*g,r=f.createFrom(Math.cos(m)*b,k,Math.sin(m)*b),c.push(r),m=f.createFrom(a*Math.cos(m)/n,-b/n,a*Math.sin(m)/n),l.push(m);else for(g=0;g<d;g++){var m=2*Math.PI/d*g,r=f.createFrom(Math.cos(m)*b,k,Math.sin(m)*b);c.push(r);m=f.createFrom(a*Math.cos(m)/n,b/n,a*Math.sin(m)/n);l.push(m)}a=new Uint32Array(6*(d+2));d=new Uint32Array(6*(d+2));k=b=0;for(g=3;g<c.length;g++)a[b++]=1,a[b++]=g-1,a[b++]=g,d[k++]=0,d[k++]=0,d[k++]=0;a[b++]=c.length-
1;a[b++]=2;a[b++]=1;d[k++]=0;d[k++]=0;d[k++]=0;for(g=3;g<c.length;g++)a[b++]=g,a[b++]=g-1,a[b++]=0,d[k++]=g,d[k++]=g-1,d[k++]=1;a[b++]=0;a[b++]=2;a[b++]=c.length-1;d[k++]=1;d[k++]=2;d[k++]=l.length-1;k=1;Array.isArray(k)||(k=[k,k,k]);b=new Float32Array(3*q);for(g=0;g<q;g++)b[3*g]=c[g][0]*k[0],b[3*g+1]=c[g][1]*k[1],b[3*g+2]=c[g][2]*k[2];c=new Float32Array(3*q);for(g=0;g<q;g++)c[3*g]=l[g][0],c[3*g+1]=l[g][1],c[3*g+2]=l[g][2];l={};l[e.POSITION]=a;l[e.NORMAL]=d;q={};q[e.POSITION]={size:3,data:b};q[e.NORMAL]=
{size:3,data:c};return new p(q,l)},createCylinderGeometry:function(a,b,d,g,k,c){g||(g=f.createFrom(1,0,0));k||(k=f.createFrom(0,0,0));c=void 0===c?!0:c;var l=f.create();f.normalize(g,l);g=f.create();f.scale(l,Math.abs(a),g);var n=f.create();f.scale(g,-.5,n);f.add(n,k);var q=f.createFrom(0,1,0);Math.abs(.2>1-f.dot(l,q))&&f.set3(0,0,1,q);var m=f.create();f.cross(l,q,m);f.normalize(m);f.cross(m,l,q);var t=2*d+(c?2:0),r=d+(c?2:0);k=new Float32Array(3*t);a=new Float32Array(3*r);var v=new Float32Array(2*
t),u=new Uint32Array(3*d*(c?4:2)),h=new Uint32Array(3*d*(c?4:2));c&&(k[3*(t-2)+0]=n[0],k[3*(t-2)+1]=n[1],k[3*(t-2)+2]=n[2],v[2*(t-2)]=0,v[2*(t-2)+1]=0,k[3*(t-1)+0]=k[3*(t-2)+0]+g[0],k[3*(t-1)+1]=k[3*(t-2)+1]+g[1],k[3*(t-1)+2]=k[3*(t-2)+2]+g[2],v[2*(t-1)]=1,v[2*(t-1)+1]=1,a[3*(r-2)+0]=-l[0],a[3*(r-2)+1]=-l[1],a[3*(r-2)+2]=-l[2],a[3*(r-1)+0]=l[0],a[3*(r-1)+1]=l[1],a[3*(r-1)+2]=l[2]);var l=function(a,c,b){u[a]=c;h[a]=b},w,I,H=0,K=f.create(),L=f.create();for(w=0;w<d;w++)I=2*Math.PI/d*w,f.scale(q,Math.sin(I),
K),f.scale(m,Math.cos(I),L),f.add(K,L),a[3*w+0]=K[0],a[3*w+1]=K[1],a[3*w+2]=K[2],f.scale(K,b),f.add(K,n),k[3*w+0]=K[0],k[3*w+1]=K[1],k[3*w+2]=K[2],v[2*w+0]=w/d,v[2*w+1]=0,k[3*(w+d)+0]=k[3*w+0]+g[0],k[3*(w+d)+1]=k[3*w+1]+g[1],k[3*(w+d)+2]=k[3*w+2]+g[2],v[2*(w+d)+0]=w/d,v[2*w+1]=1,I=(w+1)%d,l(H++,w,w),l(H++,w+d,w),l(H++,I,I),l(H++,I,I),l(H++,w+d,w),l(H++,I+d,I);if(c){for(w=0;w<d;w++)I=(w+1)%d,l(H++,t-2,r-2),l(H++,w,r-2),l(H++,I,r-2);for(w=0;w<d;w++)I=(w+1)%d,l(H++,w+d,r-1),l(H++,t-1,r-1),l(H++,I+d,
r-1)}b={};b[e.POSITION]=u;b[e.NORMAL]=h;b[e.UV0]=u;d={};d[e.POSITION]={size:3,data:k};d[e.NORMAL]={size:3,data:a};d[e.UV0]={size:2,data:v};return new p(d,b)},createTubeGeometry:function(a,b,e,f,g){e=e||10;f=null!=f?f:!0;d.assert(1<a.length);for(var c=[],k=[],l=0;l<e;l++){c.push([0,-l-1,-((l+1)%e)-1]);var n=l/e*2*Math.PI;k.push([Math.cos(n)*b,Math.sin(n)*b])}return u.createPathExtrusionGeometry(k,a,[[0,0,0]],c,f,g)},createPathExtrusionGeometry:function(a,b,l,n,t,c){var q,r=a.length,v=new Float32Array(b.length*
r*3+(6*l.length||0)),u=new Float32Array(b.length*r+(2*l.length||0)),h=new Float32Array(b.length*r*3+(l?6:0)),w=0,C=0,G=0,J=(b.length-1)*r*6+6*n.length,F=new Uint32Array(J),J=new Uint32Array(J),I=0,H=0,K=f.create(),L=f.create(),M=f.create(),V=f.create();f.create();var S=f.create();f.create();f.create();var Z=f.create(),R=f.create(),N=f.create(),D=f.create(),P=f.create();f.create();f.create();var O=f.create(),Q=f.create(),T=f.create(),da=k.create();f.set3(0,1,0,D);f.subtract(b[1],b[0],L);f.normalize(L);
t?(f.add(b[0],c,N),f.normalize(N,M)):f.set3(0,0,1,M);g(L,M,S,M,.99619469809)||g(L,D,S,M,.99619469809)||g(L,D,S,M,.99619469809);f.set(M,V);f.set(S,Q);for(q=0;q<l.length;q++)f.scale(S,l[q][0],Z),f.scale(M,l[q][2],N),f.add(Z,N),f.add(Z,b[0]),v[w++]=Z[0],v[w++]=Z[1],v[w++]=Z[2],u[G++]=0;h[C++]=-L[0];h[C++]=-L[1];h[C++]=-L[2];for(q=0;q<n.length;q++)F[I++]=0<n[q][0]?n[q][0]:-n[q][0]-1+l.length,F[I++]=0<n[q][1]?n[q][1]:-n[q][1]-1+l.length,F[I++]=0<n[q][2]?n[q][2]:-n[q][2]-1+l.length,J[H++]=0,J[H++]=0,J[H++]=
0;var U=l.length;q=l.length-1;for(var aa,X=0;X<b.length;X++){aa=!1;if(0<X){f.set(L,K);X<b.length-1?(f.subtract(b[X+1],b[X],L),f.normalize(L)):aa=!0;f.add(K,L,P);f.normalize(P);f.add(b[X-1],V,O);da[0]=P[0];da[1]=P[1];da[2]=P[2];da[3]=-m.dot(P,b[X]);if(d.rayPlane(O,K,da,N))f.subtract(N,b[X]),f.normalize(N,M),f.cross(P,M,S),f.normalize(S);else{var ba=P,ea=Q,W=D,ca=S,ka=M;g(ba,V,ca,ka,.99619469809)||g(ba,ea,ca,ka,.99619469809)||g(ba,W,ca,ka,.99619469809)}f.set(M,V);f.set(S,Q)}t&&(f.add(b[X],c,N),f.normalize(N,
T));for(ba=0;ba<r;ba++)if(f.scale(S,a[ba][0],Z),f.scale(M,a[ba][1],N),f.add(Z,N),f.normalize(Z,R),h[C++]=R[0],h[C++]=R[1],h[C++]=R[2],t?u[G++]=f.dot(Z,T):u[G++]=Z[2],f.add(Z,b[X]),v[w++]=Z[0],v[w++]=Z[1],v[w++]=Z[2],!aa)for(ea=(ba+1)%r,F[I++]=U+ba,F[I++]=U+r+ba,F[I++]=U+ea,F[I++]=U+ea,F[I++]=U+r+ba,F[I++]=U+r+ea,ea=0;6>ea;ea++)J[H++]=F[I-6+ea]-q;U+=r}aa=b[b.length-1];for(q=0;q<l.length;q++)f.scale(S,l[q][0],Z),f.scale(M,l[q][1],N),f.add(Z,N),f.add(Z,aa),v[w++]=Z[0],v[w++]=Z[1],v[w++]=Z[2],u[G++]=
0;a=C/3;h[C++]=L[0];h[C++]=L[1];h[C++]=L[2];r=U-r;for(q=0;q<n.length;q++)F[I++]=0<=n[q][0]?U+n[q][0]:-n[q][0]-1+r,F[I++]=0<=n[q][2]?U+n[q][2]:-n[q][2]-1+r,F[I++]=0<=n[q][1]?U+n[q][1]:-n[q][1]-1+r,J[H++]=a,J[H++]=a,J[H++]=a;n={};n[e.POSITION]=F;n[e.NORMAL]=J;F={};F[e.POSITION]={size:3,data:v};F.zOffset={size:1,data:u};F[e.NORMAL]={size:3,data:h};return new p(F,n)},createPolylineGeometry:function(a,b){d.assert(1<a.length,"createPolylineGeometry(): polyline needs at least 2 points");d.assert(3===a[0].length,
"createPolylineGeometry(): malformed vertex");d.assert(void 0===b||b.length===a.length,"createPolylineGeometry: need same number of points and normals");d.assert(void 0===b||3===b[0].length,"createPolylineGeometry(): malformed normal");for(var f=new Float32Array(3*a.length),g=new Uint32Array(2*(a.length-1)),k=0,c=0,l=0;l<a.length;l++){for(var m=0;3>m;m++)f[k++]=a[l][m];0<l&&(g[c++]=l-1,g[c++]=l)}k={};c={};k[e.POSITION]=g;c[e.POSITION]={size:3,data:f};if(b){for(var f=new Float32Array(3*b.length),t=
0,l=0;l<a.length;l++)for(m=0;3>m;m++)f[t++]=b[l][m];k[e.NORMAL]=g;c[e.NORMAL]={size:3,data:f}}return new p(c,k,p.DefaultOffsets,"line")},addVertexColors:function(a,b){var d,f=b||[1,1,1,1];b=new Uint8Array(4);b[0]=255*f[0];b[1]=255*f[1];b[2]=255*f[2];b[3]=255*(3<f.length?f[3]:1);var f={},g=a.getVertexAttr();for(d in g)f[d]=g[d];f[e.COLOR]={size:4,data:b};b={};for(d in a.indices)b[d]=a.indices[d];b[e.COLOR]=new Uint32Array(b[e.POSITION].length);return a=new p(f,b,a.componentOffsets,a.primitiveType)},
addNormals:function(a){var b=a.getVertexAttr();a=a.indices;for(var e=h.Vec3Compact.subtract,d=new Float32Array(a.position.length/3*3),f=b.position.data,c=0,g=a.position,k=new Uint32Array(g.length),r=0;r<g.length;r+=3){e(f,3*g[r],f,3*g[r+2],t,0);e(f,3*g[r],f,3*g[r+1],l,0);m.cross(l,t);m.normalize(l);var u=c/3;d[c++]=l[0];d[c++]=l[1];d[c++]=l[2];k[r]=u;k[r+1]=u;k[r+2]=u}b.normal={size:3,data:d};a.normal=k},cgToGIS:function(a){var b=a.getVertexAttr();a=b.position.data;var b=b.normal.data,e,d;if(b)for(e=
0;e<b.length;e+=3)d=b[e+1],b[e+1]=-b[e+2],b[e+2]=d;if(a)for(e=0;e<a.length;e+=3)d=a[e+1],a[e+1]=-a[e+2],a[e+2]=d}};return u})},"esri/views/3d/webgl-engine/lib/GeometryData":function(){define(["require","exports","./ComponentUtils","./geometryDataUtils","./Util"],function(p,h,d,a,g){return function(){function f(k,m,e,b){void 0===m&&(m=f.DefaultIndices);void 0===e&&(e=f.DefaultOffsets);void 0===b&&(b="triangle");this.preinterleaved=!1;var l={},t;for(t in k){var u=k[t],r=u.size;l[t]={data:u.data,size:r,
offsetIdx:0,strideIdx:r}}if(m===f.DefaultIndices){m=g.getFirstObjectValue(l);k=a.generateDefaultIndexArray(m.data.length/m.size);m={};for(var v in l)m[v]=k}this._id=a.getNewId();this._vertexAttributes=l;this._indices=m;this._componentOffsets=d.createOffsets(e);this._primitiveType=b}Object.defineProperty(f.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,
configurable:!0});Object.defineProperty(f.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"indexCount",{get:function(){return g.getFirstObjectValue(this._indices).length},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"primitiveType",{get:function(){return this._primitiveType},
enumerable:!0,configurable:!0});f.prototype.getVertexAttr=function(){return this.vertexAttributes};f.prototype.toRenderData=function(){return{id:this._id.toString(),preinterleaved:!1,indices:this._indices,vertexAttr:this._vertexAttributes}};f.prototype.getIndices=function(a){return this._indices[a]};f.prototype.getAttribute=function(a){return this._vertexAttributes[a]};f.prototype.estimateGpuMemoryUsage=function(){var a=0;this._indices.position&&(a+=12*this._indices.position.length);this._indices.normal&&
(a+=12*this._indices.normal.length);this._indices.uv0&&(a+=8*this._indices.uv0.length);this._indices.color&&(a+=4*this._indices.color.length);return a};f.DefaultIndices={};f.DefaultOffsets=new Uint32Array(0);return f}()})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});var d=1,a=null;h.generateDefaultIndexArray=function(f){if(f>d||null==a){for(;f>d;)d*=2;a=new Uint32Array(d);for(var g=0;g<d;g++)a[g]=
g}return new Uint32Array(a.buffer,0,f)};var g=0;h.getNewId=function(){return g++}})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("require exports ../../../../core/Logger ../../../3d/support/imageUtils ./DDSUtil ./DefaultVertexBufferLayouts ./gl-matrix ./glUtil3D ./IdGen ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,t,u){function r(e,c,d,f,g,k,l){l=!1!==l;a.requestImage(c).then(function(a){b.assert(1<=a.width&&
1<=a.height);d.samplingMode=l?9987:9729;d.hasMipmap=l;!l&&33071===d.wrapMode||b.isPowerOfTwo(a.width)&&b.isPowerOfTwo(a.height)?(d.width=a.width,d.height=a.height,a=new t(e,d,a)):a=v(e,a,d,f,g);e.bindTexture(a);k(a)}).catch(function(a){var b=200<c.length?c.slice(0,100)+"..."+c.slice(c.length-100):c;q.error("Failed to load image from uri",b,a);k(null)})}function v(a,c,e,d,g){var k=b.nextHighestPowerOfTwo(c.width),q=b.nextHighestPowerOfTwo(c.height);b.assert(k!==c.width||q!==c.height);e.width=k;e.height=
q;var r=new t(a,e),v=l.createWithAttachments(a,r,{colorTarget:0,depthStencilTarget:0});c=new t(a,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!!e.flipped,maxAnisotropy:8,preMultiplyAlpha:e.preMultiplyAlpha},c);a.bindFramebuffer(v);void 0===g&&(g=a.getViewport(),g=[g.x,g.y,g.width,g.height]);a.setViewport(0,0,k,q);d=d.get("texOnly");k=n.identity();a.bindProgram(d);d.setUniformMatrix4fv("model",k);d.setUniformMatrix4fv("view",k);d.setUniformMatrix4fv("proj",k);
d.setUniform4f("color",1,1,1,1);d.setUniform1i("tex",0);d=m.createQuadVAO(a,f.Pos3Tex);a.bindTexture(c,0);a.bindVAO(d);a.setDepthTestEnabled(!1);a.setBlendingEnabled(!1);a.drawArrays(5,0,u.vertexCount(d,"geometry"));a.setDepthTestEnabled(!0);a.bindFramebuffer(null);a.setViewport(g[0],g[1],g[2],g[3]);d.dispose(!0);c.dispose();a.bindFramebuffer(null);v.detachColorTexture();v.dispose();e.hasMipmap&&r.generateMipmap();return r}var q=d.getLogger("esri.views.3d.webgl-engine.lib.Texture"),n=k.mat4d;return function(){function a(c,
b,e){this.data=c;this.id=a.idGen.gen(b);this.unloadFunc=void 0;this.params=e||{};this.params.wrapClamp=this.params.wrapClamp||!1;this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1;this.estimatedTexMemRequiredMB=a.estimateTexMemRequiredMB(this.data,this.params)}a.estimateTexMemRequiredMB=function(a,b){return null==a?0:a instanceof ArrayBuffer||a instanceof Uint8Array?a.byteLength/1E6:a instanceof
Image||a instanceof ImageData||a instanceof HTMLCanvasElement?(b.mipmap?4/3:1)*a.width*a.height*4/1E6:(b.mipmap?4/3:1)*b.width*b.height*4/1E6||0};a.prototype.getEstimatedTexMemRequiredMB=function(){return this.estimatedTexMemRequiredMB};a.prototype.dispose=function(){this.data=void 0};a.prototype.deferredLoading=function(){return"string"===typeof this.data};a.prototype.getWidth=function(){return this.params.width};a.prototype.getHeight=function(){return this.params.height};a.prototype.initializeThroughUpload=
function(c,e,d,f,k){var l=this.data;e.flipped=!this.params.noUnpackFlip;e.samplingMode=this.params.mipmap?9987:9729;e.hasMipmap=this.params.mipmap;e.wrapMode=this.params.wrapClamp?33071:10497;e.preMultiplyAlpha=this.params.preMultiplyAlpha;if("string"===typeof l)r(c,l,e,d,f,k,this.params.mipmap);else{if(l instanceof Image||l instanceof ImageData||l instanceof HTMLCanvasElement)this.params.width=l.width,this.params.height=l.height,!this.params.mipmap&&this.params.wrapClamp||b.isPowerOfTwo(l.width)&&
b.isPowerOfTwo(l.height)?(e.width=l.width,e.height=l.height,e=new t(c,e,l)):e=v(c,l,e,d,f);else if(l instanceof ArrayBuffer&&this.params.encoding===a.DDS_ENCODING)e=g.createDDSTexture(c,e,l,this.params.mipmap);else if(l instanceof Uint8Array&&this.params.encoding===a.DDS_ENCODING)e=g.createDDSTexture(c,e,l.buffer,this.params.mipmap);else if(l instanceof Uint8Array)b.assert(0<this.params.width&&0<this.params.height),e.pixelFormat=1===this.params.components?6409:6408,e.width=this.params.width,e.height=
this.params.height,e=new t(c,e,l);else{if(null!==l)throw console.warn("Unsupported image data"),Error("Unsupported image data");e=new t(c,e,null)}c.bindTexture(e);k(e)}this.data=void 0};a.prototype.setUnloadFunc=function(a){this.unloadFunc=a};a.prototype.unload=function(){void 0!==this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)};a.createEmpty=function(c){void 0===c&&(c="emptyTexture");return new a(new Uint8Array([0,0,0,0]),c,{width:1,height:1,wrapClamp:!0})};a.idGen=new e;a.DDS_ENCODING=
"image/vnd-ms.dds";return a}()})},"esri/views/3d/support/imageUtils":function(){define(["require","exports","../../../request"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});h.dataURItoBlob=function(a){var d=atob(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];for(var f=new ArrayBuffer(d.length),k=new Uint8Array(f),m=0;m<d.length;m++)k[m]=d.charCodeAt(m);return new Blob([f],{type:a})};h.requestImage=function(a){return d(a,{responseType:"image",allowImageDataAccess:!0}).then(function(a){return a.data})}})},
"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["require","exports","../../../webgl/Texture"],function(p,h,d){function a(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}Object.defineProperty(h,"__esModule",{value:!0});var g=a("DXT1"),f=a("DXT3"),k=a("DXT5");h.createDDSTexture=function(a,e,b,l){var m=new Int32Array(b,0,31);if(542327876!==m[0])return console.error("Invalid magic number in DDS header"),null;if(!(m[20]&4))return console.error("Unsupported format, must contain a FourCC code"),
null;var u=m[21],r;switch(u){case g:u=8;r=33776;break;case f:u=16;r=33778;break;case k:u=16;r=33779;break;default:return console.error("Unsupported FourCC code:",String.fromCharCode(u&255,u>>8&255,u>>16&255,u>>24&255)),null}var v=1;m[2]&131072&&!1!==l&&(v=Math.max(1,m[7]));l=m[4];var q=m[3],n=m[1]+4,h,c;e.samplingMode=1<v?9987:9729;e.hasMipmap=1<v;e.width=m[4];e.height=m[3];e=new d(a,e);a.bindTexture(e);for(m=0;;++m){m<v&&(c=Math.floor((l+3)/4)*Math.floor((q+3)/4)*u,h=new Uint8Array(b,n,c));a.gl.compressedTexImage2D(a.gl.TEXTURE_2D,
m,r,l,q,0,h);n+=c;if(1===l&&1===q||1===v)break;l=Math.max(1,l>>1);q=Math.max(1,q>>1)}return e}})},"esri/views/webgl/Texture":function(){define(["require","exports"],function(p,h){return function(){function d(a,g,f){this._glName=this._context=null;this._id=-1;this._desc=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;this._boundToUnits=new Set;this._context=a;this._desc={pixelFormat:g.pixelFormat,internalFormat:g.internalFormat,dataType:g.dataType,target:g.target?g.target:3553,samplingMode:g.samplingMode?
g.samplingMode:9729,wrapMode:g.wrapMode?g.wrapMode:10497,maxAnisotropy:g.maxAnisotropy,flipped:void 0!==g.flipped?g.flipped:!1,hasMipmap:void 0!==g.hasMipmap?g.hasMipmap:!1,level:void 0!==g.level?g.level:0,unpackAlignment:g.unpackAlignment?g.unpackAlignment:4,width:g.width,height:g.height,preMultiplyAlpha:void 0!==g.preMultiplyAlpha?g.preMultiplyAlpha:!1};this._id=++d._nextId;this.setData(f)}Object.defineProperty(d.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});d.prototype.dispose=function(){var a=this;if(this._context){if(this._glName){var d=this._context.gl;this._boundToUnits.forEach(function(d){a._context.bindTexture(null,d)});d.deleteTexture(this._glName);this._glName=null}this._context=null}};d.prototype.resize=function(a,d){var f=this._desc;if(f.width!==a||f.height!==
d)f.width=a,f.height=d,this.setData(null)};d.prototype.setData=function(a){var g=this._context.gl;this._glName||(this._glName=g.createTexture());void 0===a&&(a=null);null===a&&(this._desc.width=this._desc.width||4,this._desc.height=this._desc.height||4);var f=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var k=this._desc;d._validateTexture(k);g.pixelStorei(g.UNPACK_ALIGNMENT,k.unpackAlignment);g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,k.flipped?1:0);g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
k.preMultiplyAlpha);if(a instanceof ImageData||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement)k.width&&k.height&&console.assert(a.width===k.width&&a.height===k.height),g.texImage2D(g.TEXTURE_2D,k.level,k.internalFormat?k.internalFormat:k.pixelFormat,k.pixelFormat,k.dataType,a),void 0===this._desc.width&&(this._desc.width=a.width),void 0===this._desc.height&&(this._desc.height=a.height);else{null!=k.width&&null!=k.height||console.error("Width and height must be specified!");
var m=k.internalFormat?k.internalFormat:k.pixelFormat,e=k.pixelFormat;g.DEPTH24_STENCIL8&&m===g.DEPTH_STENCIL&&(m=g.DEPTH24_STENCIL8);g.texImage2D(g.TEXTURE_2D,k.level,m,k.width,k.height,0,e,k.dataType,a)}k.hasMipmap&&this.generateMipmap();d._applySamplingMode(g,this._desc);d._applyWrapMode(g,this._desc);d._applyAnisotropicFilteringParameters(this._context,this._desc);this._context.bindTexture(f,0)};d.prototype.updateData=function(a,d,f,k,m,e){e||console.error("An attempt to use uninitialized data!");
this._glName||console.error("An attempt to update uninitialized texture!");var b=this._context.gl,g=this._desc,t=this._context.getBoundTexture(0);this._context.bindTexture(this,0);(0>d||0>f||k>g.width||m>g.height||d+k>g.width||f+m>g.height)&&console.error("An attempt to update out of bounds of the texture!");e instanceof ImageData||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement?(console.assert(e.width===k&&e.height===m),b.texSubImage2D(b.TEXTURE_2D,a,
d,f,g.pixelFormat,g.dataType,e)):b.texSubImage2D(b.TEXTURE_2D,a,d,f,k,m,g.pixelFormat,g.dataType,e);this._context.bindTexture(t,0)};d.prototype.generateMipmap=function(){var a=this._desc;a.hasMipmap||(a.hasMipmap=!0,d._validateTexture(a));9729===a.samplingMode?(this._samplingModeDirty=!0,a.samplingMode=9985):9728===a.samplingMode&&(this._samplingModeDirty=!0,a.samplingMode=9984);a=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var g=this._context.gl;g.generateMipmap(g.TEXTURE_2D);
this._context.bindTexture(a,0)};d.prototype.setSamplingMode=function(a){a!==this._desc.samplingMode&&(this._desc.samplingMode=a,d._validateTexture(this._desc),this._samplingModeDirty=!0)};d.prototype.setWrapMode=function(a){a!==this._desc.wrapMode&&(this._desc.wrapMode=a,d._validateTexture(this._desc),this._wrapModeDirty=!0)};d.prototype.applyChanges=function(){var a=this._context.gl,g=this._desc;this._samplingModeDirty&&(d._applySamplingMode(a,g),this._samplingModeDirty=!1);this._wrapModeDirty&&
(d._applyWrapMode(a,g),this._wrapModeDirty=!1)};d.prototype.setBoundToUnit=function(a,d){d?this._boundToUnits.add(a):this._boundToUnits.delete(a)};d._isPowerOfTwo=function(a){return 0===(a&a-1)};d._validateTexture=function(a){(0>a.width||0>a.height)&&console.error("Negative dimension parameters are not allowed!");d._isPowerOfTwo(a.width)&&d._isPowerOfTwo(a.height)||(33071!==a.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),a.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};
d._applySamplingMode=function(a,d){var f=d.samplingMode;if(9985===f||9987===f)f=9729;else if(9984===f||9986===f)f=9728;a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,f);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,d.samplingMode)};d._applyWrapMode=function(a,d){a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,d.wrapMode);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,d.wrapMode)};d._applyAnisotropicFilteringParameters=function(a,d){if(null!=d.maxAnisotropy){var f=a.capabilities.textureFilterAnisotropic;
f&&(a=a.gl,a.texParameterf(a.TEXTURE_2D,f.TEXTURE_MAX_ANISOTROPY,d.maxAnisotropy))}};d._nextId=0;return d}()})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});h.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}];h.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}];h.Pos3Col=
[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];h.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];h.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("require exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),
function(p,h,d,a,g,f,k){Object.defineProperty(h,"__esModule",{value:!0});h.createQuadVAO=function(f,e){void 0===e&&(e=a.Pos2);var b=e===a.Pos3Tex?new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]):new Float32Array([-1,-1,1,-1,-1,1,1,1]);return new k(f,d.Default3D,{geometry:e},{geometry:g.createVertex(f,35044,b)})};h.createEmptyTexture=function(a){return new f(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:4,height:4})}})},"esri/views/3d/webgl-engine/lib/IdGen":function(){define(["require",
"exports"],function(p,h){return function(){function d(){this._count=0}d.prototype.gen=function(a){null==a&&(a="a");return a+"_"+this._count++};return d}()})},"esri/views/webgl/FramebufferObject":function(){define(["require","exports","./Texture"],function(p,h,d){return function(){function a(g,f,k,m){this._colorAttachment=this._stencilAttachment=this._depthAttachment=this._glName=this._context=null;this._initialized=!1;this._context=g;this._desc={colorTarget:f.colorTarget,depthStencilTarget:f.depthStencilTarget,
width:f.width,height:f.height,multisampled:f.multisampled};this._id=a._nextId++;k&&(g=void 0,k instanceof d?(this._colorAttachment=k,g=k.descriptor):(g=k,this._colorAttachment=new d(this._context,g)),0!==this._desc.colorTarget&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),a._validateTextureDimensions(g,this._desc));m&&(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),
k=void 0,m instanceof d?(this._depthStencilTexture=m,k=this._depthStencilTexture.descriptor):(k=m,this._depthStencilTexture=new d(this._context,k)),a._validateTextureDimensions(k,this._desc))}a.create=function(d,f){return new a(d,f)};a.createWithAttachments=function(d,f,k,m){return new a(d,k,f,m)};Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof d?this._colorAttachment:null},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._desc.width},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this._context&&this._glName&&(this._disposeColorAttachment(),this._disposeDepthStencilAttachments(),this._context.gl.deleteFramebuffer(this._glName),this._glName=null)};a.prototype.attachColorTexture=function(d){if(d){a._validateTextureDimensions(d.descriptor,this._desc);this._disposeColorAttachment();if(this._initialized){this._context.bindFramebuffer(this);
var f=this._context.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,d.glName,0)}this._colorAttachment=d}};a.prototype.detachColorTexture=function(){var a=void 0;if(this._colorAttachment instanceof d){a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var f=this._context.gl;this._context.gl.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,null,0)}this._colorAttachment=null}return a};a.prototype.attachDepthStencilTexture=function(d){if(d){var f=
d.descriptor;34041!==f.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");34042!==f.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");a._validateTextureDimensions(f,this._desc);4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);
this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),f=this._context.gl,f.framebufferTexture2D(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.TEXTURE_2D,d.glName,0));this._depthStencilTexture=d}};a.prototype.detachDepthStencilTexture=function(){var a=this._depthStencilTexture;if(a&&this._initialized){this._context.bindFramebuffer(this);var d=this._context.gl;this._context.gl.framebufferTexture2D(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.TEXTURE_2D,null,0)}this._depthStencilTexture=
null;return a};a.prototype.copyToTexture=function(a,d,k,m,e,b,l){(0>a||0>d||0>e||0>b)&&console.error("Offsets cannot be negative!");(0>=k||0>=m)&&console.error("Copy width and height must be greater than zero!");var f=this._desc,g=l.descriptor;3553!==l.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");(a+k>f.width||d+m>f.height||e+k>g.width||b+m>g.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");f=this._context;f.bindTexture(l);
f.bindFramebuffer(this);f.gl.copyTexSubImage2D(3553,0,e,b,a,d,k,m)};a.prototype.readPixels=function(a,d,k,m,e,b,l){(0>=k||0>=m)&&console.error("Copy width and height must be greater than zero!");l||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(a,d,k,m,e,b,l)};a.prototype.resize=function(g,f){var k=this._desc;if(k.width!==g||k.height!==f)if(this._initialized)k.width=g,k.height=f,this._colorAttachment instanceof d?(m=this._colorAttachment,
k=m.descriptor,k.width=g,k.height=f,this._colorAttachment.dispose(),this._colorAttachment=new d(this._context,k),a._validateTextureDimensions(m.descriptor,this._desc)):this._colorAttachment&&this._disposeColorAttachment(),null!=this._depthStencilTexture?(k=this._depthStencilTexture.descriptor,k.width=g,k.height=f,this._depthStencilTexture.dispose(),this._depthStencilTexture=new d(this._context,k)):(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments(),this._context.getBoundFramebufferObject()===
this&&this._context.bindFramebuffer(null),this._initialized=!1;else{k.width=g;k.height=f;if(this._colorAttachment instanceof d){var m=this._colorAttachment;m.resize(g,f)}this._depthStencilTexture&&this._depthStencilTexture.resize(g,f)}};a.prototype.initialize=function(){if(this._initialized)return!1;var a=this._context.gl;this._glName&&a.deleteFramebuffer(this._glName);var f=a.createFramebuffer(),k=this._desc;a.bindFramebuffer(a.FRAMEBUFFER,f);if(!this._colorAttachment)if(0===k.colorTarget)this._colorAttachment=
new d(this._context,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:k.width,height:k.height});else{var m=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,m);a.renderbufferStorage(a.RENDERBUFFER,a.RGBA4,k.width,k.height);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,m);this._colorAttachment=m}this._colorAttachment instanceof d&&a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this._colorAttachment.glName,0);
switch(k.depthStencilTarget){case 1:case 3:m=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,m);var e=1===k.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT;a.renderbufferStorage(a.RENDERBUFFER,1===k.depthStencilTarget?a.DEPTH_COMPONENT16:a.DEPTH_STENCIL,k.width,k.height);a.framebufferRenderbuffer(a.FRAMEBUFFER,e,a.RENDERBUFFER,m);this._depthAttachment=m;break;case 2:m=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,m);a.renderbufferStorage(a.RENDERBUFFER,a.STENCIL_INDEX8,
k.width,k.height);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,m);this._stencilAttachment=m;break;case 4:this._depthStencilTexture||(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new d(this._context,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:k.width,height:k.height})),
a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,this._depthStencilTexture.glName,0)}a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=f;return this._initialized=!0};a.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof d){var a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var f=this._context.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,
f.TEXTURE_2D,null,0)}a.dispose()}else this._colorAttachment instanceof WebGLRenderbuffer&&(a=this._colorAttachment,f=this._context.gl,this._initialized&&(this._context.bindFramebuffer(this),f.framebufferRenderbuffer(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(a));this._colorAttachment=null};a.prototype._disposeDepthStencilAttachments=function(){var a=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);
var d=this._context.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,1===this._desc.depthStencilTarget?d.DEPTH_ATTACHMENT:d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,null)}a.deleteRenderbuffer(this._depthAttachment);this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),d=this._context.gl,d.framebufferRenderbuffer(d.FRAMEBUFFER,d.STENCIL_ATTACHMENT,d.RENDERBUFFER,null)),a.deleteRenderbuffer(this._stencilAttachment),this._stencilAttachment=null);this._depthStencilTexture&&
(this._initialized&&(this._context.bindFramebuffer(this),a=this._context.gl,a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};a._validateTextureDimensions=function(a,d){console.assert(0<=a.width&&0<=a.height);3553!==a.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==d.width&&0<=d.width&&void 0!==d.height&&0<=d.height?d.width===a.width&&d.height===a.height||console.error("Color attachment texture must match the framebuffer's!"):
(d.width=a.width,d.height=a.height)};a._nextId=0;return a}()})},"esri/views/3d/webgl-engine/lib/GLTextureRep":function(){define(["require","exports","../../../../core/Logger","./Util","../../../webgl/Texture"],function(p,h,d,a,g){var f=d.getLogger("esri.views.3d.webgl-engine.lib.GLTextureRep"),k=function(){function d(a){this._glTexture=null;this._refCount=0;this._glTexture=a}d.prototype.incRefCnt=function(){++this._refCount};d.prototype.decRefCnt=function(){--this._refCount;a.assert(0<=this._refCount)};
d.prototype.getRefCnt=function(){return this._refCount};d.prototype.setGLTexture=function(a){this._glTexture=a};d.prototype.getGLTexture=function(){return this._glTexture};return d}();return function(){function d(a,b,d,f){this.NUM_PARALLEL=8;this.textures=a;this._programRepository=b;this.getViewportToRestore=d;this._rctx=f;this.NUM_PARALLEL=8;this.id2textureRef={};this.loading={};this._queue=[];this.listeners=[];this.maxMaxAnisotropy=(this.afExt=f.capabilities.textureFilterAnisotropic)?f.parameters.maxMaxAnisotropy:
1;this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy);this._needsRender=!0;this._fallbackTextureData=new Uint8Array(256);this._fallbackTextureTransparentData=new Uint8Array(256);for(a=0;a<this._fallbackTextureData.length;++a)this._fallbackTextureData[a]=255,this._fallbackTextureTransparentData[a]=0!==(a+1)%4?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8}}d.prototype.resetNeedsRender=function(){this._needsRender=!1};
d.prototype.needsRender=function(){return this._needsRender};d.prototype.aquire=function(e,b,d){var l=this,m=this.id2textureRef[e];if(null==m){var r=this.textures[e];a.assert(void 0!==r);r.setUnloadFunc(this._unload.bind(this));b=!0===b;var v=this._createGLTextureDescription(r),m=new k(null);a.assert(null==this.id2textureRef[e]);this.id2textureRef[e]=m;if(r.initializeThroughRender)e=r.initializeThroughRender(this._rctx,v),m.setGLTexture(e),d&&d(m);else if(r.deferredLoading())this.getLoadingCount()<
this.NUM_PARALLEL?this._loadImage(e,v,d):this._queue.push([e,v,d]);else try{r.initializeThroughUpload(this._rctx,v,this._programRepository,this.getViewportToRestore(),function(a){m.setGLTexture(a);l._needsRender=!0;d&&d(m)})}catch(q){f.error("#aquire","Error loading texture: "+q.toString())}null==m.getGLTexture()&&m.setGLTexture(b?new g(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData):new g(this._rctx,this._fallbackTextureDesc,this._fallbackTextureData));this._needsRender=
!0}m.incRefCnt();return m};d.prototype.release=function(e){e=this.id2textureRef[e];void 0!==e&&(e.decRefCnt(),a.assert(0<=e.getRefCnt()))};d.prototype.getLoadingCount=function(){return Object.keys(this.loading).length};d.prototype.getIsLoaded=function(a){if(null==this.id2textureRef[a]||void 0!==this.loading[a])return!1;for(var b=0;b<this._queue.length;++b)if(this._queue[b][0]===a)return!1;return!0};d.prototype.addTextureListener=function(e){a.assert(-1===this.listeners.indexOf(e));this.listeners.push(e)};
d.prototype.removeTextureListener=function(e){e=this.listeners.indexOf(e);a.assert(-1!==e);this.listeners.splice(e,1)};d.prototype.getTexture=function(a){return this.textures[a]};d.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy};d.prototype._unload=function(a){var b=this.id2textureRef[a];void 0!==b&&((b=b.getGLTexture())&&b.dispose(),delete this.id2textureRef[a]);this.next(a)};d.prototype._createGLTextureDescription=function(a){return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&
a.params&&a.params.mipmap&&!a.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:a.params&&a.params.wrapClamp?33071:void 0}};d.prototype.next=function(a){if(a in this.loading){delete this.loading[a];var b=Object.keys(this.id2textureRef),e=Object.keys(this.loading);this.listeners.forEach(function(d){d(a,b,e)});this.processQueue()}};d.prototype._loadImage=function(e,b,d){var f=this;a.assert(null==this.loading[e]);this.loading[e]=!0;var g=this.textures[e];a.assert(void 0!==g);setTimeout(function(){var a=
f.id2textureRef[e];a&&a.getRefCnt()&&g.initializeThroughUpload(f._rctx,b,f._programRepository,f.getViewportToRestore(),function(b){f.next(e);f._needsRender=!0;a&&a.getRefCnt()&&(a.setGLTexture(b),d&&d(a))})},0)};d.prototype.processQueue=function(){for(var a=[],b=0;b<this._queue.length;++b){var d=this._queue[b][0],f=this.id2textureRef[d];void 0!==f&&(0===f.getRefCnt()?(f.getGLTexture().dispose(),delete this.id2textureRef[d]):a.push(this._queue[b]))}this._queue=a;a=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,
this._queue.length);for(b=0;b<a;++b)this._loadImage(this._queue[b][0],this._queue[b][1],this._queue[b][2]);this._queue.splice(0,a)};return d}()})},"esri/views/3d/webgl-engine/lib/RenderPass":function(){define(["require","exports"],function(p,h){var d;p=d||(d={});p[p.MATERIAL=0]="MATERIAL";p[p.MATERIAL_DEPTH=1]="MATERIAL_DEPTH";p[p.MATERIAL_NORMAL=2]="MATERIAL_NORMAL";p[p.MATERIAL_DEPTH_SHADOWMAP=3]="MATERIAL_DEPTH_SHADOWMAP";p[p.MATERIAL_HIGHLIGHT=4]="MATERIAL_HIGHLIGHT";p[p.MAX_PASS=5]="MAX_PASS";
return d})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["require","exports"],function(p,h){var d;p=d||(d={});p[p.BACKGROUND=0]="BACKGROUND";p[p.INTERNAL_MATERIAL=1]="INTERNAL_MATERIAL";p[p.STENCIL_MATERIAL=2]="STENCIL_MATERIAL";p[p.OPAQUE_TERRAIN=3]="OPAQUE_TERRAIN";p[p.OPAQUE_MATERIAL=4]="OPAQUE_MATERIAL";p[p.OPAQUE_EXTERNAL=5]="OPAQUE_EXTERNAL";p[p.TRANSPARENT_MATERIAL=6]="TRANSPARENT_MATERIAL";p[p.TRANSPARENT_EXTERNAL=7]="TRANSPARENT_EXTERNAL";p[p.TRANSPARENT_TERRAIN=8]="TRANSPARENT_TERRAIN";
p[p.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS";p[p.POSTPROCESSING_HIGHLIGHT=10]="POSTPROCESSING_HIGHLIGHT";p[p.POSTPROCESSING_ATMOSPHERE_OPAQUE=11]="POSTPROCESSING_ATMOSPHERE_OPAQUE";p[p.POSTPROCESSING_ATMOSPHERE_TRANSPARENT=12]="POSTPROCESSING_ATMOSPHERE_TRANSPARENT";p[p.POSTPROCESSING_EXTERNAL=13]="POSTPROCESSING_EXTERNAL";p[p.HUDMATERIAL1=14]="HUDMATERIAL1";p[p.HUDMATERIAL2=15]="HUDMATERIAL2";p[p.LINE_CALLOUTS=16]="LINE_CALLOUTS";p[p.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH";p[p.MAX_SLOTS=
18]="MAX_SLOTS";return d})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define([],function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/webgl/Program":function(){define(["require","exports","dojo/has","./ShaderTranspiler"],function(p,h,d,a){return function(){function d(a,g,m,e,b){void 0===b&&(b={});this._glName=this._context=null;this._locations={};this._id=void 0;this._initialized=!1;this._fShader=this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};
this._nameToUniformMatrix4={};a||console.error("RenderingContext isn't initialized!");0===g.length&&console.error("Shaders source should not be empty!");this._context=a;this._vertexShaderSource=g;this._fragmentShaderSource=m;if(Array.isArray(b))for(a=0;a<b.length;a++)this._defines[b[a]]="1";else this._defines=b;this._id=d._nextId++;this._locations=e}Object.defineProperty(d.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"glName",{get:function(){return this._glName},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});d.prototype.getDefine=function(a){return this._defines[a]};d.prototype.dispose=function(){if(this._context){var a=this._context.gl;this._vShader&&(a.deleteShader(this._vShader),this._vShader=null);this._fShader&&(a.deleteShader(this._fShader),this._fShader=null);this._glName&&(a.deleteProgram(this._glName),this._glName=null);this._context=null}};d.prototype.initialize=
function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var a=this._context.gl,d=a.createProgram();a.attachShader(d,this._vShader);a.attachShader(d,this._fShader);for(var g in this._locations)a.bindAttribLocation(d,this._locations[g],g);a.linkProgram(d);a.getProgramParameter(d,a.LINK_STATUS)||console.error("Could not initialize shader\nVALIDATE_STATUS: "+a.getProgramParameter(d,
a.VALIDATE_STATUS)+", gl error ["+a.getError()+"]infoLog: "+a.getProgramInfoLog(d));this._glName=d;this._initialized=!0}};d.prototype.getUniformLocation=function(a){this.initialize();void 0===this._nameToUniformLocation[a]&&(this._nameToUniformLocation[a]=this._context.gl.getUniformLocation(this._glName,a));return this._nameToUniformLocation[a]};d.prototype.hasUniform=function(a){return null!==this.getUniformLocation(a)};d.prototype.getAttribLocation=function(a){this.initialize();void 0===this._nameToAttribLocation[a]&&
(this._nameToAttribLocation[a]=this._context.gl.getAttribLocation(this._glName,a));return this._nameToAttribLocation[a]};d.prototype.setUniform1i=function(a,d){var f=this._nameToUniform1[a];if(void 0===f||d!==f)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(a),d),this._nameToUniform1[a]=d};d.prototype.setUniform1f=function(a,d){var f=this._nameToUniform1[a];if(void 0===f||d!==f)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(a),
d),this._nameToUniform1[a]=d};d.prototype.setUniform1fv=function(a,g){var f=this._nameToUniform2[a];void 0!==f&&d._arraysEqual(g,f)||(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(a),g),void 0===f?this._nameToUniform2[a]=new Float32Array(g):f.set(g))};d.prototype.setUniform2f=function(a,d,g){var e=this._nameToUniform2[a];if(void 0===e||d!==e[0]||g!==e[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(a),d,g),void 0===e?this._nameToUniform2[a]=
new Float32Array([d,g]):(e[0]=d,e[1]=g)};d.prototype.setUniform2fv=function(a,g){var f=this._nameToUniform2[a];void 0!==f&&d._arraysEqual(g,f)||(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(a),g),void 0===f?this._nameToUniform2[a]=new Float32Array(g):f.set(g))};d.prototype.setUniform3f=function(a,d,g,e){var b=this._nameToUniform3[a];if(void 0===b||d!==b[0]||g!==b[1]||e!==b[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(a),
d,g,e),void 0===b?this._nameToUniform3[a]=new Float32Array([d,g,e]):(b[0]=d,b[1]=g,b[2]=e)};d.prototype.setUniform3fv=function(a,g){var f=this._nameToUniform3[a];void 0!==f&&d._arraysEqual(g,f)||(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(a),g),void 0===f?this._nameToUniform3[a]=new Float32Array(g):f.set(g))};d.prototype.setUniform4f=function(a,d,g,e,b){var f=this._nameToUniform4[a];if(void 0===f||d!==f[0]||g!==f[1]||e!==f[2]||b!==f[3])this._context.bindProgram(this),
this._context.gl.uniform4f(this.getUniformLocation(a),d,g,e,b),void 0===f?this._nameToUniform4[a]=new Float32Array([d,g,e,b]):(f[0]=d,f[1]=g,f[2]=e,f[3]=b)};d.prototype.setUniform4fv=function(a,g){var f=this._nameToUniform4[a];void 0!==f&&d._arraysEqual(g,f)||(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(a),g),void 0===f?this._nameToUniform4[a]=new Float32Array(g):f.set(g))};d.prototype.setUniformMatrix3fv=function(a,g,m){void 0===m&&(m=!1);var e=this._nameToUniformMatrix3[a];
void 0!==e&&(9===e.length?d._matrix3Equal(e,g):d._arraysEqual(g,e))||(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(a),m,g),void 0===e?this._nameToUniformMatrix3[a]=new Float32Array(g):e.set(g))};d.prototype.setUniformMatrix4fv=function(a,g,m){void 0===m&&(m=!1);var e=this._nameToUniformMatrix4[a];void 0!==e&&(16===e.length?d._matrix4Equal(e,g):d._arraysEqual(g,e))||(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(a),
m,g),void 0===e?this._nameToUniformMatrix4[a]=new Float32Array(g):e.set(g))};d._padToThree=function(a){var d=a.toString();1E3>a&&(d=("  "+a).slice(-3));return d};d.prototype._addLineNumbers=function(a){var f=2;return a.replace(/\n/g,function(){return"\n"+d._padToThree(f++)+":"})};d.prototype._loadShader=function(d){var f=35633===d,g=f?this._vertexShaderSource:this._fragmentShaderSource,e;e="";for(var b in this._defines)e+="#define "+b+" "+this._defines[b]+"\n";e+=g;"webgl2"===this._context.contextVersion&&
(e=a.transpileShader(e,f?"vertex":"fragment"));f=this._context.gl;d=f.createShader(d);f.shaderSource(d,e);f.compileShader(d);f.getShaderParameter(d,f.COMPILE_STATUS)||(console.error(f.getShaderInfoLog(d)),console.error(this._addLineNumbers(e)),"webgl2"===this._context.contextVersion&&(console.log("Shader source before transpilation:"),console.log(g)));return d};d._matrix4Equal=function(a,d){return a[0]===d[0]&&a[1]===d[1]&&a[2]===d[2]&&a[3]===d[3]&&a[4]===d[4]&&a[5]===d[5]&&a[6]===d[6]&&a[7]===d[7]&&
a[8]===d[8]&&a[9]===d[9]&&a[10]===d[10]&&a[11]===d[11]&&a[12]===d[12]&&a[13]===d[13]&&a[14]===d[14]&&a[15]===d[15]};d._matrix3Equal=function(a,d){return a[0]===d[0]&&a[1]===d[1]&&a[2]===d[2]&&a[3]===d[3]&&a[4]===d[4]&&a[5]===d[5]&&a[6]===d[6]&&a[7]===d[7]&&a[8]===d[8]};d._arraysEqual=function(a,d){if(a.length!==d.length)return!1;for(var f=0;f<a.length;++f)if(a[f]!==d[f])return!1;return!0};d._nextId=0;return d}()})},"esri/views/webgl/ShaderTranspiler":function(){define(["require","exports","./reservedWordsGLSL3",
"./lib/glsl-tokenizer/string"],function(p,h,d,a){function g(a){return a.map(function(a){return"eof"!==a.type?a.data:""}).join("")}function f(a,b,d,g){g=g||d;for(var e=0;e<a.length;e++){var l=a[e];if("ident"===l.type&&l.data===d)return g in b?b[g]++:b[g]=0,f(a,b,g+"_"+b[g],g)}return d}function k(a,b,d){void 0===d&&(d="afterVersion");var e={data:"\n",type:"whitespace"},f=function(b){return b<a.length?/[^\r\n]$/.test(a[b].data):!1},g=function(a){for(var b=-1,c=0,e=-1,f=0;f<a.length;f++){var g=a[f];"preprocessor"===
g.type&&(g.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++c:g.data.match(/\#endif\s*.*/)&&--c);("afterVersion"===d||"afterPrecision"===d)&&"preprocessor"===g.type&&/^#version/.test(g.data)&&(e=Math.max(e,f));if("afterPrecision"===d&&"keyword"===g.type&&"precision"===g.data){a:{for(g=f;g<a.length;g++){var l=a[g];if("operator"===l.type&&";"===l.data)break a}g=null}if(null===g)throw Error("precision statement not followed by any semicolons!");e=Math.max(e,g)}b<e&&0===c&&(b=f)}return b+1}(a);f(g-1)&&a.splice(g++,
0,e);for(var l=0;l<b.length;l++){var k=b[l];a.splice(g++,0,k)}f(g-1)&&f(g)&&a.splice(g,0,e)}Object.defineProperty(h,"__esModule",{value:!0});var m=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];h.transpileShader=function(e,b){e=a(e);var l;a:{l="100";var t="300 es";void 0===l&&(l="100");void 0===t&&(t="300 es");for(var h=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,r=0;r<e.length;r++){var v=e[r];if("preprocessor"===v.type){var q=h.exec(v.data);
if(q)if(h=q[1].replace(/\s\s+/g," "),h===t){l=h;break a}else if(h===l){v.data="#version "+t;break a}else throw Error("unknown glsl version: "+h);}}e.splice(0,0,{type:"preprocessor",data:"#version "+t},{type:"whitespace",data:"\n"});l=null}if("300 es"===l)throw Error("shader is already glsl 300 es");h=v=null;r={};q={};for(l=0;l<e.length;++l)switch(t=e[l],t.type){case "keyword":"vertex"===b&&"attribute"===t.data?t.data="in":"varying"===t.data&&(t.data="vertex"===b?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(t.data.trim())&&
(t.data=t.data.replace(/(2D|Cube|EXT)/g,""));if("fragment"===b&&"gl_FragColor"===t.data){if(!v){var v=f(e,r,"fragColor"),n=void 0;void 0===n&&(n="lowp");k(e,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:n},{type:"whitespace",data:" "},{type:"keyword",data:"vec4"},{type:"whitespace",data:" "},{type:"ident",data:v},{type:"operator",data:";"}],"afterPrecision")}t.data=v}else"fragment"===b&&"gl_FragDepthEXT"===t.data&&(h||(h=f(e,r,"gl_FragDepth")),t.data=h);break;case "ident":if(0<=
d.indexOf(t.data)){if(n="vertex"===b)a:{for(n=l-1;0<=n;n--){var w=e[n];if("whitespace"!==w.type&&"block-comment"!==w.type)if("keyword"===w.type){if("attribute"===w.data||"in"===w.data){n=!0;break a}}else break}n=!1}if(n)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");t.data in q||(q[t.data]=f(e,r,t.data));t.data=q[t.data]}}for(l=e.length-1;0<=l;--l)t=e[l],"preprocessor"===t.type&&((b=t.data.match(/\#extension\s+(.*)\:/))&&b[1]&&0<=m.indexOf(b[1].trim())&&
(b=e[l+1],e.splice(l,b&&"whitespace"===b.type?2:1)),(b=t.data.match(/\#ifdef\s+(.*)/))&&b[1]&&0<=m.indexOf(b[1].trim())&&(t.data="#if 1"),(b=t.data.match(/\#ifndef\s+(.*)/))&&b[1]&&0<=m.indexOf(b[1].trim())&&(t.data="#if 0"));return g(e)}})},"esri/views/webgl/reservedWordsGLSL3":function(){define(["require","exports"],function(p,h){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/string":function(){define(["./index"],function(p){"use strict;";return function(h){var d=p(),a=[],a=a.concat(d(h));return a=a.concat(d(null))}})},"esri/views/webgl/lib/glsl-tokenizer/index":function(){define(["./lib/literals","./lib/operators","./lib/builtins"],function(p,h,d){"use strict;";var a="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");return function(){function g(b){b.length&&w.push({type:a[r],
data:b,position:z,line:c,column:x})}function f(){n=n.length?[]:n;if("/"===q&&"*"===v)return z=u+t-1,r=0,q=v,t+1;if("/"===q&&"/"===v)return z=u+t-1,r=1,q=v,t+1;if("#"===v)return r=2,z=u+t,t;if(/\s/.test(v))return r=9,z=u+t,t;A=/\d/.test(v);y=/[^\w_]/.test(v);z=u+t;r=A?4:y?3:9999;return t}function k(){if(("\r"===v||"\n"===v)&&"\\"!==q)return g(n.join("")),r=999,t;n.push(v);q=v;return t+1}function m(){if("."===q&&/\d/.test(v))return r=5,t;if("/"===q&&"*"===v)return r=0,t;if("/"===q&&"/"===v)return r=
1,t;if("."===v&&n.length){for(;e(n););r=5;return t}if(";"===v||")"===v||"("===v){if(n.length)for(;e(n););g(v);r=999;return t+1}var a=2===n.length&&"\x3d"!==v;if(/[\w_\d\s]/.test(v)||a){for(;e(n););r=999;return t}n.push(v);q=v;return t+1}function e(a){var c=0,b,e;do{b=h.indexOf(a.slice(0,a.length+c).join(""));e=h[b];if(-1===b){if(0<c--+a.length)continue;e=a.slice(0,1).join("")}g(e);z+=e.length;n=n.slice(e.length);return n.length}while(1)}function b(){if("."===v||/[eE]/.test(v))return n.push(v),r=5,
q=v,t+1;if("x"===v&&1===n.length&&"0"===n[0])return r=11,n.push(v),q=v,t+1;if(/[^\d]/.test(v))return g(n.join("")),r=999,t;n.push(v);q=v;return t+1}function l(){"f"===v&&(n.push(v),q=v,t+=1);if(/[eE]/.test(v)||"-"===v&&/[eE]/.test(q))return n.push(v),q=v,t+1;if(/[^\d]/.test(v))return g(n.join("")),r=999,t;n.push(v);q=v;return t+1}var t=0,u=0,r=999,v,q,n=[],w=[],c=1,x=0,z=0,A=!1,y=!1,B="",E;return function(a){w=[];if(null!==a){a=a.replace?a.replace(/\r\n/g,"\n"):a;t=0;B+=a;for(E=B.length;v=B[t],t<
E;){a=t;switch(r){case 0:"/"===v&&"*"===q?(n.push(v),g(n.join("")),r=999):(n.push(v),q=v);t+=1;break;case 1:t=k();break;case 2:t=k();break;case 3:t=m();break;case 4:t=b();break;case 11:/[^a-fA-F0-9]/.test(v)?(g(n.join("")),r=999):(n.push(v),q=v,t+=1);break;case 5:t=l();break;case 9999:if(/[^\d\w_]/.test(v)){var e=n.join("");r=-1<p.indexOf(e)?8:-1<d.indexOf(e)?7:6;g(n.join(""));r=999}else n.push(v),q=v,t+=1;break;case 9:/[^\s]/g.test(v)?(g(n.join("")),r=999):(n.push(v),q=v,t+=1);break;case 999:t=f()}if(a!==
t)switch(B[a]){case "\n":x=0;++c;break;default:++x}}u+=t;B=B.slice(t);return w}n.length&&g(n.join(""));r=10;g("(eof)");return w}}})},"esri/views/webgl/lib/glsl-tokenizer/lib/literals":function(){define([],function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/lib/operators":function(){define([],function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})},"esri/views/webgl/lib/glsl-tokenizer/lib/builtins":function(){define([],function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})},
"esri/views/3d/environment/RealisticAtmosphere":function(){define("dojo/text!./materials/RealisticAtmosphereMaterial.xml ../../../core/watchUtils ../../../core/Handles ../support/ExternalRenderer ../lib/glMatrix ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/OffscreenRenderingHelper ../support/earthUtils ../../webgl/Program ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/DefaultVertexAttributeLocations".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r){var v=l.earthRadius,q=g.vec3d,n=g.vec2d,w=g.vec4d;g=.02*Math.PI;l=.004*Math.PI;var c=q.createFrom(1/Math.pow(.65,4),1/Math.pow(.57,4),1/Math.pow(.475,4)),x=q.create(c);q.scale(x,g);q.add(x,q.createFrom(l,l,l));var z=(1- -.99999*-.99999)/(2+-.99999*-.99999)*1.5;a=a.createSubclass({declaredClass:"esri.views.3d.environment.RealisticAtmosphere",properties:{view:{},planar:{value:!1,set:function(a){a=!!a;a!==this.planar&&this._update();this._set("planar",a)}},needsRender:{value:!1}},
constructor:function(){this._handles=new d;this._lowerElevationBoundRadius=0;this._earthRadius=v;this._renderer=this._skyPlanarProgram=this._skyProgram=this._hazePlanarProgram=this._hazeProgram=null;this._renderData={texDepth:n.create(),v3CameraPos:q.create(),v3CameraUp:q.create(),v3CameraRight:q.create(),v3CameraDir:q.create(),halfSizeNearPlane:n.create(),v2CameraCenterOffset:n.create(),v4SphereComp:w.create(),v4AtmosParams1:w.create(),v4AtmosParams2:w.create(),v4AtmosParams3:w.create(),v3InvWavelength:c,
v3InvWavelengthScaled:x,v4Radii:w.create(),fScale:0,fScaleDepth:.25,fLowerAlphaBlendBound:0,fScaleOverScaleDepth:0,fOneOverScaleDepth:0,fScaleDepthBlue:.05,fOneOverScaleDepthBlue:20,fScaleOverScaleDepthBlue:0,g:-.99999,g2:-.99999*-.99999,fMiePhaseCoefficients:z,showTest:0,nearFar:n.create()};this._updateRadius(v);this._hazeSlot=e.POSTPROCESSING_ATMOSPHERE_TRANSPARENT;this._skySlot=e.POSTPROCESSING_ATMOSPHERE_OPAQUE},destroy:function(){this._handles&&(this._handles.destroy(),this._handles=null);this._hazeProgram&&
(this._hazeProgram.dispose(),this._hazeProgram=null);this._hazePlanarProgram&&(this._hazePlanarProgram.dispose(),this._hazePlanarProgram=null);this._skyProgram&&(this._skyProgram.dispose(),this._skyProgram=null);this._skyPlanarProgram&&(this._skyPlanarProgram.dispose(),this._skyPlanarProgram=null)},setup:function(a){var c=k.createSquareGeometry([[-1,-1,1],[1,-1,1],[1,1,1],[-1,1,1]]).toRenderData(),b=this.renderContext.rctx;this._renderer=new f(c,u.Pos3Tex,null,b);c=this._update.bind(this);this._handles.add(h.init(this,
"view.state.camera",c,!0));var c=this._updateElevation.bind(this),e=function(){this._updateElevation({tile:this.view.basemapTerrain.rootTiles[0]})}.bind(this),d=this._updateVisibleElevationBounds.bind(this);this._handles.add(h.on(this,"view.basemapTerrain","elevation-change",c,e));this._handles.add(h.on(this,"view.basemapTerrain","elevation-bounds-change",d,d));a.shaderSnippets.fsRealisticAtmosphere||a.shaderSnippets._parse(p);this._hazeProgram=new t(b,a.shaderSnippets.vsRealisticAtmosphere,a.shaderSnippets.fsRealisticAtmosphere,
r.Default3D,["HAZE"]);this._skyProgram=new t(b,a.shaderSnippets.vsRealisticAtmosphere,a.shaderSnippets.fsRealisticAtmosphere,r.Default3D);this._hazePlanarProgram=new t(b,a.shaderSnippets.vsRealisticAtmosphere,a.shaderSnippets.fsRealisticAtmosphere,r.Default3D,["HAZE","PLANAR"]);this._skyPlanarProgram=new t(b,a.shaderSnippets.vsRealisticAtmosphere,a.shaderSnippets.fsRealisticAtmosphere,r.Default3D,["PLANAR"])},render:function(a){if(a.slot!==this._hazeSlot&&a.slot!==this._skySlot||a.pass!==m.MATERIAL||
a.slot==this._hazeSlot&&a.options.earlyOcclusionPixelDraw)return!1;var c,b=this.renderContext.rctx,e=b.gl,d=a.offscreenRenderingHelper,f=!1;if(a.slot===this._hazeSlot){c=this.planar?this._hazePlanarProgram:this._hazeProgram;b.bindProgram(c);b.setBlendFunctionSeparate(e.ONE,e.ONE_MINUS_SRC_COLOR,e.ZERO,e.ONE);d.detachDepthTextureFromBuffer();var f=!0,g=d.getDepthTexture();b.bindTexture(g,0);c.setUniform1i("tDepth",0);c.setUniform4fv("v4SphereComp",this._renderData.v4SphereComp)}a.slot===this._skySlot&&
(c=this.planar?this._skyPlanarProgram:this._skyProgram,b.bindProgram(c),b.setBlendFunctionSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),b.setDepthFunction(e.LEQUAL),c.setUniform4fv("v4SphereComp",this._renderData.v4SphereComp),c.setUniform4fv("v4AtmosParams3",this._renderData.v4AtmosParams3));c.setUniform3fv("v3InvWavelength",this._renderData.v3InvWavelength);c.setUniform3fv("v3InvWavelengthScaled",this._renderData.v3InvWavelengthScaled);c.setUniform3fv("v3LightDir",a.lightingData.direction);
c.setUniform3fv("v3CameraPos",this._renderData.v3CameraPos);c.setUniform3fv("v3CameraUp",this._renderData.v3CameraUp);c.setUniform3fv("v3CameraRight",this._renderData.v3CameraRight);c.setUniform3fv("v3CameraDir",this._renderData.v3CameraDir);c.setUniform2fv("nearFar",this._renderData.nearFar);c.setUniform2fv("halfSizeNearPlane",this._renderData.halfSizeNearPlane);c.setUniform2fv("v2CameraCenterOffset",this._renderData.v2CameraCenterOffset);c.setUniform4fv("v4Radii",this._renderData.v4Radii);c.setUniform4fv("v4AtmosParams1",
this._renderData.v4AtmosParams1);c.setUniform4fv("v4AtmosParams2",this._renderData.v4AtmosParams2);c.setUniform1f("showTest",this._renderData.showTest);f?b.setDepthTestEnabled(!1):b.setDepthTestEnabled(!0);b.setBlendingEnabled(!0);b.setDepthWriteEnabled(!1);this._renderer.render(c);b.setDepthFunction(e.LESS);b.setDepthWriteEnabled(!0);b.setBlendingEnabled(!1);b.setBlendFunctionSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA);f&&d.restoreDepthTextureToBuffer();return!0},_setEnableTestImage:function(a){this._renderData.showTest=
a?1:0;this.needsRender=!0},_adjustRadiusForTesselation:function(a){return a*Math.cos(Math.PI/Math.pow(2,4)/16)},_normalizeRadius:function(a){a=this._adjustRadiusForTesselation(a);return Math.max(v-1E4,Math.min(a,v))},_updateElevation:function(a){0===a.tile.lij[0]&&(a=this._adjustRadiusForTesselation(v+a.tile.elevationBounds[0]),a!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=a,this._earthRadius=-1,this._updateVisibleElevationBounds()))},_updateVisibleElevationBounds:function(){var a=
this._adjustRadiusForTesselation(v+this.view.basemapTerrain.getElevationBounds()[0]);return 0>this._earthRadius||a<this._earthRadius?this._updateRadius(a):!1},_updateRadius:function(a){this._earthRadius=a;var c=a*a,b=a/10*10.25,e=b*b,d=1/(b-a),f=d/.25,g=d/.05,l=.3*(b-a)+a,k=1/(b-l),n=this._renderData;w.set4(d,.25,f,4,n.v4AtmosParams1);w.set4(-.99999,.05,g,20,n.v4AtmosParams2);w.set4(-.99999*-.99999,z,l,k,n.v4AtmosParams3);w.set4(a,c,b,e,n.v4Radii);n.fScale=d;n.fLowerAlphaBlendBound=l;n.fScaleOverScaleDepth=
f;n.fScaleOverScaleDepthBlue=g;this._update();return!0},_update:function(a){if(a=a||this.get("view.state.camera")){q.negate(a.viewForward,this._renderData.v3CameraDir);q.set(a.viewUp,this._renderData.v3CameraUp);q.set(a.viewRight,this._renderData.v3CameraRight);if(this.planar){var c=this.view.renderCoordsHelper;this._renderData.fCameraHeight=c.getAltitude(a.eye)/c.unitInMeters+v}else this._renderData.fCameraHeight=q.length(a.eye);this._renderData.fCameraHeight2=this._renderData.fCameraHeight*this._renderData.fCameraHeight;
this._renderData.fC=this._renderData.fCameraHeight2-this._renderData.v4Radii[3];this._renderData.fCSur=this._renderData.fCameraHeight2-this._renderData.v4Radii[1];this._renderData.v4SphereComp=w.createFrom(this._renderData.fCameraHeight,this._renderData.fCameraHeight2,this._renderData.fC,this._renderData.fCSur);q.set(a.eye,this._renderData.v3CameraPos);n.set2(Math.tan(a.fovX/2)/(a.width/a.fullWidth),Math.tan(a.fovY/2)/(a.height/a.fullHeight),this._renderData.halfSizeNearPlane);n.set2((a.padding[3]+
a.width/2)/a.fullWidth-.5,(a.padding[2]+a.height/2)/a.fullHeight-.5,this._renderData.v2CameraCenterOffset);n.set2(a.near,a.far,this._renderData.nearFar);this.needsRender=!0}}});a.isSupported=function(a){return b.supportsDepthTexture(a.rctx)};return a})},"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":function(){define("require exports dojo/text!../materials/internal/offscreen.xml ./DefaultVertexAttributeLocations ./glUtil3D ./Util ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(p,h,d,a,g,f,k,m,e,b){var l={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},t={target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:0,height:0},u=[0,0,0,0],r=[0,0,0,1];return function(){function h(a,b){this._intermediateTexture=this._hudVisibilityTexture=null;this._enabled=!1;this.height=this.width=0;this._programRep=a;this._rctx=b;this.height=this.width=null}h.prototype.enable=function(){if(!this.getEnableState()){var a=
this._rctx;this._enabled=!0;this.framebuffer=k.createWithAttachments(a,l,{colorTarget:0,depthStencilTarget:a.capabilities.depthTexture?4:3});this.quadVAO=g.createQuadVAO(a)}};h.prototype.disable=function(){this.getEnableState()&&(this._enabled=!1,this.framebuffer.dispose(),this.quadVAO.dispose(!0),this._depthStencilTextureCached=this.quadVAO=this.framebuffer=null)};h.prototype.setEnableState=function(a){a?this.enable():this.disable()};h.prototype.getEnableState=function(){return this._enabled};h.prototype.getColorTexture=
function(){return this.framebuffer.colorTexture};h.prototype.getDepthTexture=function(){return h.supportsDepthTexture(this._rctx)?this.framebuffer.depthStencilTexture||this._depthStencilTextureCached:null};h.prototype.getHUDVisibilityTexture=function(){return this._hudVisibilityTexture};h.supportsDepthTexture=function(a){return a.capabilities.depthTexture};h.prototype.initializeFrame=function(a){f.assert(this.getEnableState());var b=this._rctx,e=b.gl;a=a.fullViewport;this.width=a[2];this.height=a[3];
this.framebuffer.resize(this.width,this.height);b.bindFramebuffer(this.framebuffer);b.setClearStencil(0);b.setClearColor(0,0,0,1);b.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT|e.STENCIL_BUFFER_BIT)};h.prototype.renderSeparateColor=function(a,b,e){void 0===e&&(e=u);var c=this._rctx,d=c.gl;a.resize(this.width,this.height);var f=this.framebuffer.detachColorTexture();this.framebuffer.attachColorTexture(a);c.bindFramebuffer(this.framebuffer);c.setClearColor(e[0],e[1],e[2],Math.max(1E-13,e[3]));c.clear(d.COLOR_BUFFER_BIT);
b();d.flush();this.framebuffer.detachColorTexture();this.framebuffer.attachColorTexture(f)};h.prototype.renderSeparateAndComposite=function(a,b,d){void 0===b&&(b=u);void 0===d&&(d="none");this._intermediateTexture||(this._intermediateTexture=new e(this._rctx,l));this.renderSeparateColor(this._intermediateTexture,a);this.composite(this._intermediateTexture,this.framebuffer,d)};h.prototype.renderHUDVisibility=function(a){this._hudVisibilityTexture||(this._hudVisibilityTexture=new e(this._rctx,t));this.renderSeparateColor(this._hudVisibilityTexture,
a,r)};h.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};h.prototype.getFramebuffer=function(){return this.framebuffer};h.prototype.detachDepthTextureFromBuffer=function(){this._depthStencilTextureCached=this.framebuffer.depthStencilTexture;this.framebuffer.detachDepthStencilTexture()};h.prototype.restoreDepthTextureToBuffer=function(){this.framebuffer.attachDepthStencilTexture(this._depthStencilTextureCached);this._depthStencilTextureCached=null};h.prototype.composite=
function(a,e,d){void 0===a&&(a=this.framebuffer.colorTexture);void 0===e&&(e=null);void 0===d&&(d="none");var c=this._rctx,f=this._programRep.get("offscreenProgram");c.bindFramebuffer(e);c.setDepthTestEnabled(!1);c.bindProgram(f);f.setUniform1i("tex",1);c.bindTexture(a,1);switch(d){case "none":c.setBlendingEnabled(!1);break;case "alpha":c.setBlendingEnabled(!0);c.setBlendFunction(770,771);break;case "premultiplied-alpha":c.setBlendingEnabled(!0),c.setBlendFunction(1,771)}c.bindVAO(this.quadVAO);c.drawArrays(5,
0,b.vertexCount(this.quadVAO,"geometry"));c.setDepthTestEnabled(!0);c.setBlendingEnabled(!1)};h.loadShaders=function(b,e,f){b._parse(d);b=new m(f,b.vsOffscreenRenderer,b.fsOffscreenRenderer,a.Default3D);e.add("offscreenProgram",b)};return h}()})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("dojo/text!./materials/SimpleAtmosphereMaterial.xml dojo/Deferred ../../../core/watchUtils ../support/ExternalRenderer ../lib/glMatrix ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/Texture ../webgl-engine/lib/Util ../webgl-engine/lib/GLTextureRep ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ./resources/SimpleAtmosphereTexture ../support/earthUtils ../../webgl/Program ../webgl-engine/lib/DefaultVertexAttributeLocations".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v){var q=u.earthRadius,n=g.vec3d,w=g.vec2d,c=g.mat4d,x=m.VertexAttrConstants,z=(q-1E4)/q,A=(q+3E5)/q,y=-1E4/3E5,B=1-y;return a.createSubclass({declaredClass:"esri.views.3d.environment.SimpleAtmosphere",properties:{view:{},needsRender:{value:!1},slot:{value:l.BACKGROUND,set:function(a){this.needsRender=!0;this._set("slot",a)}}},constructor:function(){this._renderData={texV:w.create(),silCircleCenter:n.create(),silCircleV1:n.create(),silCircleV2:n.create()};this._textureRep=
this._texture=null},initialize:function(){this._textureDfd=new h;this.addResolvingPromise(this._textureDfd.promise)},destroy:function(){this._currentViewChangedHandle&&(this._currentViewChangedHandle.remove(),this._currentViewChangedHandle=null);this._textureRep&&(this._texture&&(this._textureRep.release("SimpleAtmosphere"),this._textureRep.getTexture("SimpleAtmosphere").unload()),this._textureRep=null);this._program&&(this._program.dispose(),this._program=null);this._textureDfd&&(this._textureDfd.cancel(),
this._textureDfd=null)},initializeRenderContext:function(a){this._textureRep=new e({SimpleAtmosphere:new k(t,"SimpleAtmosphere",{wrapClamp:!0})},a.programRep,function(){return this.view.state.camera.viewport}.bind(this),a.rctx);this._texture=this._textureRep.aquire("SimpleAtmosphere",void 0,function(a){this._texture=a.getGLTexture();this._textureDfd.resolve();this._textureDfd=null}.bind(this))},setup:function(a){var c=this._createRibbonGeometryData();this._renderer=new f(c,[{name:"position",count:3,
type:5126,offset:0,stride:12,normalized:!1}],null,a.rctx);this._currentViewChangedHandle=d.init(this,"view.state.camera",this._update.bind(this),!0);a.shaderSnippets.vsSimpleAtmosphere||a.shaderSnippets._parse(p);this._program=new r(a.rctx,a.shaderSnippets.vsSimpleAtmosphere,a.shaderSnippets.fsSimpleAtmosphere,v.Default3D)},render:function(a){if(a.slot!==this.slot||a.pass!==b.MATERIAL)return!1;var c=this.renderContext.rctx,e=c.gl,d=this._program;c.bindProgram(d);d.setUniform4f("color",1,1,1,1);d.setUniformMatrix4fv("proj",
a.camera.projectionMatrix);d.setUniformMatrix4fv("view",a.camera.viewMatrix);d.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter);d.setUniform3fv("silCircleV1",this._renderData.silCircleV1);d.setUniform3fv("silCircleV2",this._renderData.silCircleV2);d.setUniform2fv("texV",this._renderData.texV);c.bindTexture(this._texture,0);d.setUniform1i("tex",0);d.setUniform3fv("lightDirection",a.lightingData.direction);c.setDepthTestEnabled(!0);c.setDepthFunction(e.LEQUAL);c.setBlendingEnabled(!0);
c.setDepthWriteEnabled(!1);this._renderer.render(d);c.setBlendingEnabled(!1);c.setDepthWriteEnabled(!0);c.setDepthFunction(e.LESS);return!0},_update:function(a){var c=n.create(),b=n.create(),e=n.create(),d=this.view.renderCoordsHelper.getAltitude(a.eye);n.scale(a.eye,(q+50)/n.length(a.eye),e);this._computeSilhouetteCircle(e,a.center,a.up,q);n.add(this._renderData.silCircleCenter,this._renderData.silCircleV2,c);n.scale(c,A,b);var e=this._computeScreenRimWidth(e,a.up,c,b),f=0,g=1,l=1;50>d?(f=.001953125,
g=.1015625):500>d?(l=(d-50)/450,f=.001953125*(1-l)+.001953125*l,g=.1015625*(1-l)+.21875*l):5E3>d?(l=(d-500)/4500,f=.001953125*(1-l)+.001953125*l,g=.21875*(1-l)+.51171875*l):5E4>d&&(l=(d-5E3)/45E3,f=.001953125*(1-l)+.001953125*l,g=.51171875*(1-l)+.4140625*l);d=y+f*B;l=y+e*g*B;50<n.length(a.eye)-q&&(this._computeSilhouetteCircle(a.eye,a.center,a.up,q),n.add(this._renderData.silCircleCenter,this._renderData.silCircleV2,c),n.scale(c,A,b),a=this._computeScreenRimWidth(a.eye,a.up,c,b),a=m.clamp((a-1.5)/
(e-1.5),0,1),d=y+a*f*B,l=y+m.lerp(1,e*g,a)*B);w.set2(d,l,this._renderData.texV);this.needsRender=!0},_computeSilhouetteCircle:function(a,c,b,e){var d=n.length(a),f=e*Math.sqrt(d*d-e*e)/d,g=this._renderData.silCircleV1,l=this._renderData.silCircleV2;n.scale(a,Math.sqrt(e*e-f*f)/d,this._renderData.silCircleCenter);n.cross(a,c,g);1>n.length2(g)&&n.cross(a,b,g);n.scale(g,f/n.length(g));n.cross(g,a,l);n.scale(l,f/n.length(l));return f},_computeScreenRimWidth:function(a,b,e,d){var f=c.create();c.lookAt(a,
e,b,f);a=this.view.state.camera;m.project(e,f,a.projectionMatrix,a.viewport);m.project(d,f,a.projectionMatrix,a.viewport);return n.dist(e,d)/a.height},_createRibbonGeometryData:function(){for(var a=new Float32Array(768),c=new Uint32Array(768),b=0;128>b;b++){var e=6*b;a[e+0]=b;a[e+1]=z;a[e+2]=0;a[e+3]=b;a[e+4]=A;a[e+5]=1;var d=2*b,f=127===b?0:d+2;c[e+0]=d;c[e+1]=d+1;c[e+2]=f+1;c[e+3]=f+1;c[e+4]=f;c[e+5]=d}b={};b[x.POSITION]=c;c={};c[x.POSITION]={size:3,data:a};return{indices:b,vertexAttr:c}}})})},
"esri/views/3d/environment/Stars":function(){define("dojo/text!./materials/StarMaterial.xml require ../../../request ../../../core/watchUtils ../../../core/promiseUtils ../../../core/Error ../../../core/Logger ../lib/glMatrix ../support/ExternalRenderer ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../../webgl/Program ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Util".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n){var w=m.mat4d;m=m.mat3d;var c=l.VertexAttrConstants,x="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),z=k.getLogger("esri.views.3d.environment.Stars"),A=m.toMat4(m.createFrom(1,0,0,0,.9174771405229186,.39778850739794974,0,-.39778850739794974,.9174771405229186)),y=m.toMat4(m.createFrom(1,0,0,0,.9174771405229186,-.39778850739794974,
0,.39778850739794974,.9174771405229186)),B=null;return e.createSubclass({properties:{view:{},numBinaryFloats:{value:2},numBinaryUInt8:{value:1},bytesPerStar:{value:9},needsRender:{value:!1},slot:{value:r.BACKGROUND,set:function(a){this.needsRender=!0;this._set("slot",a)}}},constructor:function(){this._renderData={model:w.identity()};this.slot=r.BACKGROUND;this._vertexBufferLayout=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:20,
normalized:!1},{name:"size",count:1,type:5126,offset:16,stride:20,normalized:!1}]},initialize:function(){this._loadDataPromise=this._loadBrightStarCatalogue();this.addResolvingPromise(this._loadDataPromise)},destroy:function(){this._loadDataPromise.isFulfilled()||this._loadDataPromise.cancel("Atmosphere has been removed.");this._dateHandle&&(this._dateHandle.remove(),this._dateHandle=null);this._program&&(this._program.dispose(),this._program=null)},setup:function(c){this._numStars=this._starData.byteLength/
this.bytesPerStar;var e=new Float32Array(this._starData,0,this._numStars*this.numBinaryFloats),d=new Uint8Array(this._starData,this._numStars*this.numBinaryFloats*4,this._numStars*this.numBinaryUInt8),e=this._createStarGeometryData(e,d);this._renderer=new b(e,this._vertexBufferLayout,this._fillInterleaved,c.rctx);this._renderer.enablePointRendering(!0);this._dateHandle=a.init(this,"view.environment.lighting.date",this._update.bind(this));c.shaderSnippets.vertexShaderStar||c.shaderSnippets._parse(p);
this._program=new v(c.rctx,c.shaderSnippets.vertexShaderStar,c.shaderSnippets.fragmentShaderStar,q.Default3D)},render:function(a){if(a.slot!==this.slot||a.pass!==u.MATERIAL)return!1;var c=this.renderContext.rctx,b=c.gl,e=this._program;c.bindProgram(e);e.setUniformMatrix4fv("view",a.camera.viewMatrix);e.setUniformMatrix4fv("proj",a.camera.projectionMatrix);e.setUniform4fv("viewport",a.camera.fullViewport);e.setUniformMatrix4fv("model",this._renderData.model);c.setDepthTestEnabled(!0);c.setDepthFunction(b.LEQUAL);
c.setBlendingEnabled(!0);c.setBlendFunctionSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);c.setDepthWriteEnabled(!1);this._renderer.render(e);c.setBlendingEnabled(!1);c.setDepthWriteEnabled(!0);c.setDepthFunction(b.LESS);return!0},_fillInterleaved:function(a,b,e,d,f,g,l){var k=n.getStride(f);e=k/4;var q=t.fill,m=a.indices[c.POSITION],r=a.vertexAttr[c.POSITION].data;d=l+n.findAttribute(f,"position").offset/4;for(var h=0;h<m.length;++h){var v=3*m[h];q(r,v,g,d,b,3);d+=e}b=a.indices[c.COLOR];
m=a.vertexAttr[c.COLOR].data;d=l+n.findAttribute(f,"color").offset;r=new Uint8Array(g.buffer);for(h=0;h<b.length;++h)v=4*b[h],q(m,v,r,d,null,4),d+=k;k=a.indices[c.SIZE];a=a.vertexAttr[c.SIZE].data;d=l+n.findAttribute(f,"size").offset/4;for(h=0;h<k.length;++h)g[d]=a[k[h]],d+=e},_computeDayDuration:function(a){var c=new Date(a.getFullYear(),0,1,11,58,56),b=new Date(a.getFullYear()+1,0,1,11,58,55);return(a-c)/(b-c)},_update:function(a){if(a){var c=a.getHours()/12,b=a.getMinutes()/60*(2/24),e=a.getSeconds()/
60*(2/1440),c=(c+b+e-.9972222)%2;a=2*this._computeDayDuration(a);b=w.create(y);w.rotateZ(b,-a*Math.PI);w.multiply(A,b,b);w.rotateZ(b,-c*Math.PI);this._renderData.model=b;this.needsRender=!0}},_hexToRGB:function(a){return[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)]},_unpackUint8Attributes:function(a){return 192<=a?[2.9,a-192]:160<=a?[2.5,a-160]:128<=a?[2,a-128]:96<=a?[1.5,a-96]:64<=a?[1,a-64]:32<=a?[.7,a-32]:[.4,a]},_createStarGeometryData:function(a,
b){for(var e=new Float32Array(3*this._numStars),d=new Uint8Array(4*this._numStars),f=new Float32Array(this._numStars),g=new Uint32Array(this._numStars),l=0;l<this._numStars;l++){var k=2*l,n=3*l,q=4*l,m=a[k+0],k=a[k+1];e[n+0]=-Math.cos(m)*Math.sin(k);e[n+1]=-Math.sin(m)*Math.sin(k);e[n+2]=-Math.cos(k);n=this._unpackUint8Attributes(b[l]);m=this._hexToRGB(x[n[1]]);d[q+0]=255*m[0];d[q+1]=255*m[1];d[q+2]=255*m[2];d[q+3]=255;f[l]=n[0];g[l]=l}a={};a[c.POSITION]=g;a[c.NORMAL]=g;a[c.UV0]=g;a[c.COLOR]=g;a[c.SIZE]=
g;g={};g[c.POSITION]={size:3,data:e};g[c.COLOR]={size:4,data:d};g[c.SIZE]={size:1,data:f};return{indices:a,vertexAttr:g}},_verifyStartData:function(a){if(!a)throw new f("stars:no-data-received","Failed to create stars because star catalogue is missing");a=a.byteLength/this.bytesPerStar;if(0!==a%1||5E4<a||5E3>a)throw new f("stars:invalid-data","Failed to create stars because star catalogue data is invalid");},_loadBrightStarCatalogue:function(){return B?(this._starData=B,g.resolve()):d(h.toUrl("./resources/stars.wsv"),
{responseType:"array-buffer",failOk:!0}).then(function(a){a=a.data;this._verifyStartData(a);this._starData=B=a}.bind(this)).catch(function(a){z.error("loadBrightStarCatalogue",a.message);throw a;})}})})},"esri/views/3d/support/sunUtils":function(){define(["./mathUtils","../lib/glMatrix","../lib/SunCalc"],function(p,h,d){var a=h.vec3d,g=h.mat4d,f=p.lerp,k=g.identity(),m={azimuth:0,altitude:0},e={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},
global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:Math.PI/3,altitude:Math.PI/3}}},b={ambient:{color:a.create(),intensity:0},diffuse:{color:a.create(),intensity:0,direction:a.create()}},l={settings:e,computeDirection:function(b,e,f,q){q||(q=a.create());var n=g.identity(k);if("global"===f)d.getPosition(b,0,0,m),a.set3(0,0,-1,q),g.rotateX(n,-m.azimuth),g.rotateY(n,-m.altitude);else{var r=l.settings.planarDirection;f=r.globalAngles;
r=(Math.abs(e.z)-r.localAltitude)/(r.globalAltitude-r.localAltitude);r=p.clamp(r,0,1);1>r?(d.getPosition(b,e.y,e.x,m),m.azimuth=(1-r)*m.azimuth+r*f.azimuth,m.altitude=(1-r)*m.altitude+r*f.altitude):(m.azimuth=f.azimuth,m.altitude=f.altitude);a.set3(0,-1,0,q);g.rotateZ(n,-m.azimuth);g.rotateX(n,-m.altitude)}g.multiplyVec3(n,q);return q},computeShadowsEnabled:function(a,b){return"global"===b?!0:Math.abs(a.z)<l.settings.planarDirection.localAltitude},computeColorAndIntensity:function(g,k){var m,q,n,
r=k.z;q=l.settings;a.set3(1,1,1,b.ambient.color);b.ambient.intensity=q.global.ambient;a.set3(1,1,1,b.diffuse.color);b.diffuse.intensity=q.global.diffuse;r=(Math.abs(r)-q.local.altitude)/(q.global.altitude-q.local.altitude);r=p.clamp(r,0,1);b.globalFactor=r;k=d.getTimes(g,k.y,k.x);if(1>r){q=g.valueOf();var c,h;k.polarException===d.POLAR_EXCEPTION.MIDNIGHT_SUN?(c=q-36E5*(g.getHours()+48)-6E4*g.getMinutes(),h=c+432E6):k.polarException===d.POLAR_EXCEPTION.POLAR_NIGHT?(c=q-2,h=q-1):(c=k.sunrise.valueOf(),
h=k.sunset.valueOf());var u=h-c;n=c+u/2;var A=u/4;m=n-A;var A=n+A,y=.06*u,u=c-y/2;c+=y/2;var B=h-y/2,E=h+y/2;h=e.local;var C=[.01,h.ambientAtNight],G=[.8,.8,1],J=[.01,.01,.01],F=[h.diffuseAtTwilight,h.ambientAtTwilight],I=[1,.75,.75],H=[.8,.8,1],K=[.9*h.diffuseAtNoon,h.ambientAtNoon],L=[1,.98,.98],M=[.98,.98,1],V=[h.diffuseAtNoon,h.ambientAtNoon],S=[1,1,1],Z=[1,1,1];h=[0,0];var R=[0,0],y=[0,0];q<u||q>E?(h=C,R=J,y=G):q<c?(y=c-u,h=t(q-u,y,C,F),R=t(q-u,y,J,I),y=t(q-u,y,G,H)):q<m?(y=m-c,h=t(q-c,y,F,K),
R=t(q-c,y,I,L),y=t(q-c,y,H,M)):q<n?(y=n-m,h=t(q-m,y,K,V),R=t(q-m,y,L,S),y=t(q-m,y,M,Z)):q<A?(y=A-n,h=t(q-n,y,V,K),R=t(q-n,y,S,L),y=t(q-n,y,Z,M)):q<B?(y=B-A,h=t(q-A,y,K,F),R=t(q-A,y,L,I),y=t(q-A,y,M,H)):q<E&&(y=E-B,h=t(q-B,y,F,C),R=t(q-B,y,I,J),y=t(q-B,y,H,G));q=h[0];n=R;m=h[1];a.lerp(y,b.ambient.color,r,b.ambient.color);b.ambient.intensity=f(m,b.ambient.intensity,r);a.lerp(n,b.diffuse.color,r,b.diffuse.color);b.diffuse.intensity=f(q,b.diffuse.intensity,r)}r=g.valueOf();k.polarException===d.POLAR_EXCEPTION.MIDNIGHT_SUN?
(g=r-36E5*(g.getHours()+48)-6E4*g.getMinutes(),k=g+432E6):k.polarException===d.POLAR_EXCEPTION.POLAR_NIGHT?(g=r-2,k=r-1):(g=k.sunrise.valueOf(),k=k.sunset.valueOf());g=1-p.clamp(Math.abs(r-(g+(k-g)/2))/432E5,0,1);b.noonFactor=g;return b}},t=function(a,b,e,d){for(var f=[],g=0;g<e.length;g++)f[g]=(d[g]-e[g])*a/b+e[g];return f};return l})},"esri/views/3d/lib/SunCalc":function(){define([],function(){function p(a){return new Date(864E5*(a+.5-2440588))}function h(a,b){return v(l(a)*t(c)-u(b)*l(c),t(a))}
function d(a,b){return r(l(b)*t(c)+t(b)*l(c)*l(a))}function a(a,c,b){return v(l(a),t(a)*l(c)-u(b)*t(c))}function g(a,c,b){return r(l(c)*l(b)+t(c)*t(b)*t(a))}function f(a){return n*(1.9148*l(a)+.02*l(2*a)+3E-4*l(3*a))}function k(a,c){a=n*(357.5291+.98560028*a);var e=f(a);a=a+e+102.9372*n+b;c||(c={dec:0,ra:0});c.dec=d(a,0);c.ra=h(a,0);return c}function m(a,c,b){return 2451545+a+.0053*l(c)-.0069*l(2*b)}function e(a){var c=n*(134.963+13.064993*a),b=n*(93.272+13.22935*a);a=n*(218.316+13.176396*a)+6.289*
n*l(c);b=5.128*n*l(b);c=385001-20905*t(c);return{ra:h(a,b),dec:d(a,b),dist:c}}var b=Math.PI,l=Math.sin,t=Math.cos,u=Math.tan,r=Math.asin,v=Math.atan2,q=Math.acos,n=b/180,w={dec:0,ra:0},c=23.4397*n,x={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(c,b,e,d){e=n*-e;b*=n;var f=c.valueOf()/864E5-.5+2440588-2451545;c=k(f,w);e=n*(280.16+360.9856235*f)-e-c.ra;d||(d={azimuth:0,altitude:0});d.azimuth=a(e,b,c.dec);d.altitude=g(e,b,c.dec);return d}},z=[[-.83,"sunrise","sunset"]];
x.addTime=function(a,c,b){z.push([a,c,b])};x.getTimes=function(a,c,e){function g(a){var c=r,e=w;a=q((l(a)-l(c)*l(e))/(t(c)*t(e)));return m(9E-4+(a+k)/(2*b)+h,v,u)}var k=n*-e,r=n*c,h=Math.round(a.valueOf()/864E5-.5+2440588-2451545-9E-4-k/(2*b));a=9E-4+(0+k)/(2*b)+h;var v=n*(357.5291+.98560028*a);c=f(v);var u=v+c+102.9372*n+b,w=d(u,0);a=m(a,v,u);c={solarNoon:p(a),nadir:p(a-.5),polarException:x.POLAR_EXCEPTION.NORMAL};var y,A,B,V;e=0;for(y=z.length;e<y;e+=1)A=z[e],B=g(A[0]*n),V=a-(B-a),c[A[1]]=p(V),
c[A[2]]=p(B);c.polarException=function(a){a=(l(a)-l(r)*l(w))/(t(r)*t(w));return-1>a?x.POLAR_EXCEPTION.MIDNIGHT_SUN:1<a?x.POLAR_EXCEPTION.POLAR_NIGHT:x.POLAR_EXCEPTION.NORMAL}(z[0][0]*n);return c};x.getMoonPosition=function(c,b,d){d=n*-d;b*=n;var f=c.valueOf()/864E5-.5+2440588-2451545;c=e(f);d=n*(280.16+360.9856235*f)-d-c.ra;f=g(d,b,c.dec);f+=.017*n/u(f+10.26*n/(f+5.1*n));return{azimuth:a(d,b,c.dec),altitude:f,distance:c.dist}};x.getMoonFraction=function(a){var c=a.valueOf()/864E5-.5+2440588-2451545;
a=k(c);c=e(c);a=q(l(a.dec)*l(c.dec)+t(a.dec)*t(c.dec)*t(a.ra-c.ra));a=v(149598E3*l(a),c.dist-149598E3*t(a));return(1+t(a))/2};return x})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["require","exports","../../lib/glMatrix"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});var a=d.vec3d;p=function(){return function(d,f,k){void 0===d&&(d=a.create());void 0===f&&(f=a.createFrom(.57735,.57735,.57735));void 0===k&&(k=!0);this.intensity=d;this.direction=f;this.castShadows=
k}}();h.MainLight=p;p=function(){return function(d,f){void 0===d&&(d=a.create());void 0===f&&(f=a.createFrom(.57735,.57735,.57735));this.intensity=a.create();this.direction=a.create();this.intensity=d;this.direction=f}}();h.FillLight=p;p=function(){return function(d){void 0===d&&(d=a.create());this.intensity=d}}();h.AmbientLight=p;p=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();h.SphericalHarmonicsLight=p})},"esri/views/3d/input/SceneInputManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/KeyPan ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/ViewEvents ../../input/handlers/PreventContextMenu".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x,z,A){p=function(g){function h(){var a=null!==g&&g.apply(this,arguments)||this;a._handles=new f;return a}d(h,g);h.prototype.initialize=function(){var a=this;this.viewEvents=new z.ViewEvents(this.view);this._handles.add([k.whenNot(this.view,"ready",function(){return a._disconnect()}),k.when(this.view,"ready",function(){return a._connect()})])};h.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this._disconnect()};
Object.defineProperty(h.prototype,"primaryDragAction",{get:function(){return this._get("primaryDragAction")},set:function(a){"pan"!==a&&"rotate"!==a||a===this._get("primaryDragAction")||(this._set("primaryDragAction",a),this._updateMode())},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"mode",{get:function(){return this._get("mode")},set:function(a){"default"!==a&&"pro"!==a||a===this._get("mode")||(this._set("mode",a),this._updateMode())},enumerable:!0,configurable:!0});h.prototype._disconnect=
function(){this.viewEvents.disconnect();this._source&&(this._source.destroy(),this._source=null);this._inputManager&&(this._inputManager.destroy(),this._inputManager=null)};h.prototype._connect=function(){var a=this.view;this._source=new c.BrowserEventSource(this.view.surface);var d=new x.InputManager(this._source);this._inputManager=d;d.installHandlers("prevent-context-menu",[new A.PreventContextMenu]);this._modeDragPan=new r.PinchAndPanNavigation(a,"primary");this._modeDragRotate=new b.DragRotate(a,
"secondary","center");this._modeDragZoom=new l.DragZoom(a,"tertiary");d.installHandlers("navigation",[new v.PointerDownCancelAnimation(a),new e.DoubleClickZoom(a),new t.KeyPan(a,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j"}),new u.MouseWheelZoom(a),new n.SingleKeyResetTilt(a,"p"),new q.SingleKeyResetHeading(a,"n"),new b.DragRotate(a,"primary","eye",["b"]),new b.DragRotate(a,"secondary","center",["b"]),new r.PinchAndPanNavigation(a,"tertiary",["b"]),this._modeDragRotate,
this._modeDragZoom,this._modeDragPan,new w.TwoFingerTilt(a)]);this.viewEvents.connect(d);this._updateMode()};h.prototype._updateMode=function(){var a=this.primaryDragAction,a=y.get(this.mode).get(a);this._modeDragPan&&(this._modeDragPan.pointerAction=a.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=a.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=a.zoom)};a([m.property()],h.prototype,"view",void 0);a([m.property({value:"pan"})],h.prototype,"primaryDragAction",null);
a([m.property({value:"default"})],h.prototype,"mode",null);a([m.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],h.prototype,"latestPointerType",void 0);a([m.property()],h.prototype,"_inputManager",void 0);return h=a([m.subclass("esri.views.3d.input.SceneInputManager")],h)}(m.declared(g));var y=new Map;h=new Map;g=new Map;h.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});h.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});g.set("pan",{pan:"primary",rotate:"tertiary",
zoom:"secondary"});g.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});y.set("default",h);y.set("pro",g);return p})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../state/helpers/PickingHelper ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(p,h,d,a,g,f,k,m){Object.defineProperty(h,
"__esModule",{value:!0});p=function(e){function b(a,b){var d=e.call(this,!0)||this;d.view=a;d.pickingHelper=new f.PickingHelper(a);d.registerIncoming("double-click",b,function(a){return d.handleDoubleClick(a)});return d}d(b,e);b.prototype.handleDoubleClick=function(b){var e=b.data;if(m.eventMatchesPointerAction(e,"primary")){var d=this.view.state.isGlobal?new a.ZoomStepController(this.view,this.pickingHelper,"animation"):new g.ZoomStepController(this.view,this.pickingHelper,"animation");this.view.state.switchCameraController(d);
d.zoomStep(Math.log(.5)/Math.log(.6),[e.x,this.view.height-e.y]);b.stopPropagation()}};return b}(k.InputHandler);h.DoubleClickZoom=p})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ../PointToPointAnimationController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),function(p,h,d,a,g,f,k,m,e){Object.defineProperty(h,
"__esModule",{value:!0});p=function(b){function f(a,e,d){e=b.call(this,a.state,e,"interaction"===d?null:void 0)||this;e.view=a;e.mode=d;e.zoomLocation=g.vec3d.create();e.tmpCamera=new m;e.panAxis=g.vec3d.create();e.tmpViewDir=g.vec3d.create();e.targetOnSphere=g.vec3d.create();e.tmpCenter=g.vec3d.create();e.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new m,interactionDirection:null};e.sphere={center:g.vec3d.create(),radius:0};return e}d(f,b);Object.defineProperty(f.prototype,
"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});f.prototype.zoomStep=function(a,b){if(this.active){var e=this.view.state,d=this.constraintOptions.interactionStartCamera;this.animation.finished?d.copyFrom(e.camera):this.animation.cameraAt(1,d);d=!1;0<a&&this.pickingHelper.pickPointInScreen(b,this.zoomLocation)&&(d=!0);this.tmpCamera.copyFrom(e.camera);d?this.pickingHelper.pickRaySegment(this.tmpCamera.eye,this.tmpCamera.center,this.tmpCenter)&&(this.tmpCamera.center=
this.tmpCenter):this.pickingHelper.pickRaySegment(this.tmpCamera.eye,this.tmpCamera.center,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:g.vec3d.set(this.tmpCamera.center,this.zoomLocation);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,b);this.begin(this.tmpCamera)}};f.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:e.outExpo}};f.prototype.updateCamera=function(b,e,d,f){this.sphere.radius=g.vec3d.length(d);g.vec3d.subtract(b.center,b.eye,
this.tmpViewDir);var l=g.vec3d.length(this.tmpViewDir),n=l*e;1>=e&&4>n&&(n=4,e=n/l);1E-6>Math.abs(l-n)||(l=g.vec3d.length(b.center),this.sphere.radius!==l&&g.vec3d.scale(b.center,(this.sphere.radius+e*(l-this.sphere.radius))/l),g.vec3d.scale(this.tmpViewDir,-e),g.vec3d.add(b.center,this.tmpViewDir,b.eye),a.applyAll(this.view,b,this.constraintOptions),1E-12<g.vec3d.dist2(d,b.center)&&k.intersectSphereFromScreenPoint(this.sphere,b,f,this.targetOnSphere)&&(e=k.rotationAndAxisFromPoints(d,this.targetOnSphere,
this.panAxis),k.applyRotation(b,this.sphere.center,this.panAxis,e)),a.applySurfaceCollision(this.view,b))};return f}(f.PointToPointAnimationController);h.ZoomStepController=p})},"esri/views/3d/camera/constraintUtils":function(){define("require exports ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../lib/glMatrix ../../animation/easing ./constraintUtils/tilt ./constraintUtils/altitude ./constraintUtils/distance ./constraintUtils/surfaceCollision".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u){Object.defineProperty(h,"__esModule",{value:!0});h.applyTilt=b.apply;h.tiltError=b.error;h.applyAltitude=l.apply;h.altitudeError=l.error;h.applyDistance=t.apply;h.distanceError=t.error;h.applySurfaceCollision=u.apply;h.applyAll=function(b,e,c,d){void 0===c&&(c=v);void 0===d&&(d=e);var g=!1;d!==e&&d.copyFrom(e);d.markViewDirty();d.computeUp(b.state.mode);for(e=0;e<q;e++){for(var l=0,k=0,n=r;k<n.length;k++){var m=n[k];if(a.hasConstraintType(c.selection,m.type)){var h=
Math.abs(m.error(b,d,c));m.apply(b,d,c)&&(g=!0,l+=h)}}if(0===l)break}e=a.hasConstraintType(c.selection,8);c=4===c.interactionType?1:0;e&&f.apply(b,d,c)&&(g=!0);g&&d.computeUp(b.state.mode);return g};h.pixelDistanceToInteractionFactor=function(a,b){a="number"===typeof a?a:m.vec2d.dist(a,b);return e.inOutCubic(Math.min(1,a/150))};var r=[{type:1,error:function(a,b,c){return k.error(a,b,c)*b.distance},apply:k.apply},{type:2,error:d.error,apply:d.apply},{type:4,error:g.error,apply:g.apply}],v={selection:15,
interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null},q=5})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("require exports ./common ../../lib/glMatrix ../../support/intersectionUtils ../../support/mathUtils".split(" "),function(p,h,d,a,g,f){function k(a,b,g){void 0===g&&(g=d.defaultApplyOptions);var l;l=a.state.constraints.altitude;l=a.state.isGlobal&&l?2===g.interactionType&&d.hasConstraintType(g.selection,1)?!1:!0:!1;if(!l)return 0;var n=
a.state.constraints.altitude;l=e;l.min=n.min;l.max=n.max;var m=g.interactionType;if(0!==m){var n=l.min,c=l.max,r=g.interactionStartCamera;g=g.interactionFactor;var m=2===m||1===m,h=k(a,r),r=0===h?0:a.renderCoordsHelper.getAltitude(r.eye);l.min=n;l.max=c;d.adjustRangeForInteraction(h,r,m,g,.05*r,l)}a=a.renderCoordsHelper.getAltitude(b.eye);a=f.clamp(a,l.min,l.max)-a;return 1E-6>=Math.abs(a)?0:a}function m(b,e,d,f){b.renderCoordsHelper.worldUpAtPosition(e.eye,f);a.vec3d.scale(f,d);return f}Object.defineProperty(h,
"__esModule",{value:!0});h.apply=function(e,r,h,q){void 0===h&&(h=d.defaultApplyOptions);void 0===q&&(q=r);q!==r&&q.copyFrom(r);var n=k(e,r,h);if(0===n)return!1;var v=e.renderCoordsHelper,c=v.getAltitude(r.eye)+n;e=d.interactionDirectionTowardsConstraintMinimization(e,r,h.interactionDirection,m(e,r,f.sign(n),l),b);h=a.vec3d.set(r.viewForward,t);v.intersectManifold(r.eye,e,c,q.eye)||v.setAltitude(c,q.eye);g.closestPointOnRay(r.eye,h,r.center,r.center);q.markViewDirty();return!0};h.error=k;var e={min:0,
max:0},b=a.vec3d.create(),l=a.vec3d.create(),t=a.vec3d.create()})},"esri/views/3d/camera/constraintUtils/common":function(){define(["require","exports","../../lib/glMatrix","../../support/mathUtils"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});h.hasConstraintType=function(a,d){return 0!==(a&d)};h.adjustRangeForInteraction=function(a,d,k,m,e,b){0!==a&&(k?(b.min=Math.min(b.min,d),b.max=Math.max(b.max,d)):null!=m?(b.min-=Math.max(0,(d-b.min)*(1-m)),b.max+=Math.max(0,(d-b.max)*
(1-m))):e&&(b.min-=Math.max(0,d-b.min-e),b.max+=Math.max(0,d-b.max-e)))};h.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null};h.interactionDirectionTowardsConstraintMinimization=function(g,f,k,m,e){k||(k=f.viewForward);d.vec3d.set(k,e);d.vec3d.scale(e,a.sign(d.vec3d.dot(k,m)));return e}})},"esri/views/3d/support/intersectionUtils":function(){define(["../lib/glMatrix"],function(p){function h(d,f,e,b){b.clip[0]=0;b.clip[1]=e?
b.len:Number.MAX_VALUE;for(e=0;e<d.length;e++){var g;var k=d[e],m=f;g=b;var r=a.dot(k,g.dir),m=-a.dot(m,k)-k[3];0>m&&0<=r?g=!1:-1E-6<r&&1E-6>r?g=!0:!(0>m||0>r)||0>m&&0>r?(m/=r,0<r?m<g.clip[1]&&(g.clip[1]=m):m>g.clip[0]&&(g.clip[0]=m),g=g.clip[0]<=g.clip[1]):g=!0;if(!g)return!1}return!0}function d(d,f,e,b){d?(e&&b&&(g.len=a.dist(f,e)),a.set(d,g.dir)):b?(g.len=a.dist(f,e),a.scale(a.subtract(e,f,g.dir),1/g.len)):a.normalize(a.subtract(e,f,g.dir));return g}var a=p.vec3d;p=p.vec2d;var g={dir:a.create(),
len:0,clip:p.create()},f={planeSphere:function(a,d,e){return a[0]*d[0]+a[1]*d[1]+a[2]*d[2]+a[3]<e},frustumSphere:function(a,d,e){for(var b=0;6>b;b++)if(!f.planeSphere(a[b],d,e))return!1;return!0},frustumRay:function(a,f,e,b){e=d(b,f,e,!1);return h(a,f,null,e)},frustumPoint:function(d,f){for(var e=0;6>e;e++){var b=d[e];if(0>-a.dot(f,b)-b[3])return!1}return!0},frustumLineSegment:function(a,f,e,b){b=d(b,f,e,!0);return h(a,f,e,b)},closestPointOnRay:function(d,f,e,b){e=a.dot(f,a.subtract(e,d,b));a.add(d,
a.scale(f,e,b),b);return b}};return f})},"esri/views/3d/camera/constraintUtils/distance":function(){define(["require","exports","./common","../../lib/glMatrix","../../webgl-engine/lib/Util"],function(p,h,d,a,g){function f(b,e,g){void 0===g&&(g=d.defaultApplyOptions);if(!b.state.isLocal)return 0;var l=b.state.constraints.distance;if(!b.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===l)return 0;k.min=0;k.max=l;var l=k,q=g.interactionType;if(0!==q){var n=l.min,m=l.max,c=g.interactionStartCamera;
g=g.interactionFactor;var q=1===q||4===q,r=f(b,c),c=0===r?0:a.vec3d.dist(c.eye,b.pointsOfInterest.surfaceOrigin.renderLocation);l.min=n;l.max=m;d.adjustRangeForInteraction(r,c,q,g,.05*c,l)}b=a.vec3d.dist(e.eye,b.pointsOfInterest.surfaceOrigin.renderLocation);b=k.max-b;return-1E-6<=b?0:b}Object.defineProperty(h,"__esModule",{value:!0});h.error=f;h.apply=function(k,h,r,v){void 0===r&&(r=d.defaultApplyOptions);void 0===v&&(v=h);v!==h&&v.copyFrom(h);var q=f(k,h,r);if(0===q)return!1;var n=k.pointsOfInterest.surfaceOrigin,
q=a.vec3d.dist(h.eye,k.pointsOfInterest.surfaceOrigin.renderLocation)+q,t=a.vec3d.set(h.eye,m);r=d.interactionDirectionTowardsConstraintMinimization(k,h,r.interactionDirection,a.vec3d.direction(k.pointsOfInterest.surfaceOrigin.renderLocation,h.eye,l),b);return g.raySphere(h.eye,r,n.renderLocation,q,v.eye)?(h=a.vec3d.subtract(v.eye,t,e),a.vec3d.add(v.center,h),v.markViewDirty(),h=k.renderCoordsHelper.getAltitude(v.center),k.renderCoordsHelper.intersectManifold(v.eye,v.viewForward,h,v.center),v.markViewDirty(),
!0):!1};var k={min:0,max:0},m=a.vec3d.create(),e=a.vec3d.create(),b=a.vec3d.create(),l=a.vec3d.create()})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["require","exports","../intersectionUtils","../../lib/glMatrix"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});h.apply=function(f,k,m,e){void 0===m&&(m=0);void 0===e&&(e=k);var b=f.state.constraints;k!==e&&e.copyFrom(k);if(!b.collision.enabled)return!1;var l=d.surfaceElevationBelowEye(f,k);k=f.renderCoordsHelper.getAltitude(k.eye);
b=b.collision.elevationMargin;if(k-l>=b)return!1;a.vec3d.subtract(e.center,e.eye,g);f.renderCoordsHelper.setAltitude(l+b,e.eye);1===m&&a.vec3d.add(e.eye,g,e.center);e.markViewDirty();return!0};var g=a.vec3d.create()})},"esri/views/3d/camera/intersectionUtils":function(){define("require exports ../../../geometry/Point ../lib/glMatrix ../support/aaBoundingRect ../support/earthUtils ../webgl-engine/lib/Selector".split(" "),function(p,h,d,a,g,f,k){function m(b,d,g,l){void 0===l&&(l=a.vec3d.create());
var n=e[b.viewingMode];n||(n=new k(b.viewingMode),n.enableBackfacesTerrain=!b.state.isGlobal,n.enableInvisibleTerrain=!0,e[b.viewingMode]=n);b._stage.pickRay(d,g,null,null,null,null,n);if((n=n.getMinResult())&&n.getIntersectionPoint(l))return l;n=a.vec3d.direction(g,d,u);if(!b.renderCoordsHelper.intersectManifold(d,n,0,l))if("global"===b.viewingMode){b=l;var n=a.vec3d.dot(d,d),c=f.earthRadius*f.earthRadius,n=n>c?Math.sqrt(n-c)/3:1;a.vec3d.subtract(g,d,b);a.vec3d.scale(b,n/a.vec3d.length(b),b);a.vec3d.add(b,
d)}else g!==l&&a.vec3d.set(g,l);return l}Object.defineProperty(h,"__esModule",{value:!0});h.eyeWithinExtent=function(a,e,d,f){return a.renderCoordsHelper.fromRenderCoords(e.eye,b,f)&&g.containsPoint(d,b)};h.surfaceElevationBelowEye=function(a,b){return a.renderCoordsHelper.fromRenderCoords(b.eye,t,a.basemapTerrain.spatialReference)?a.basemapTerrain.getElevation(t)||0:0};h.cameraOnContentAlongViewDirection=function(b,e,d,f){var g=b.state.camera.copy();e&&(g.eye=e);d&&(g.center=d);f&&(g.up=f);m(b,g.eye,
g.center,l);d=b.state.constraints;f=d.minimumPoiDistance;a.vec3d.dist2(g.eye,l)<f&&(e=d.collision.enabled,a.vec3d.set(g.viewForward,u),a.vec3d.scale(u,f),e?a.vec3d.subtract(l,u,g.eye):a.vec3d.add(g.eye,u,l),b=b.renderCoordsHelper,f=b.getAltitude(g.eye),d=d.collision.elevationMargin,e&&f<d&&(a.vec3d.subtract(l,g.eye,u),b.setAltitude(d,g.eye),a.vec3d.add(g.eye,u,l)));g.center=l;return g};h.contentAlongViewDirection=m;var e={},b=a.vec3d.create(),l=a.vec3d.create(),t=new d,u=a.vec3d.create()})},"esri/views/3d/webgl-engine/lib/Selector":function(){define("require exports dojo/has ./gl-matrix ./Object3D ./PerformanceTimer".split(" "),
function(p,h,d,a,g,f){var k=a.vec3d.create(),m=a.vec3d.create();p=function(){function d(d,f,g,l,k,n,m,c){void 0===c&&(c=!1);this.dir=a.vec3d.create();this.normalDir=null;this.minResult=new e;this.maxResult=new e;this.transform=a.mat4d.create();this._transformInverse=new b({value:this.transform},a.mat4d.inverse,a.mat4d.create);this._transformInverseTranspose=new b(this._transformInverse,a.mat4d.transpose,a.mat4d.create);this._transformTranspose=new b({value:this.transform},a.mat4d.transpose,a.mat4d.create);
this._transformInverseRotation=new b({value:this.transform},a.mat4d.toInverseMat3,a.mat3d.create);this.enableTerrain=this.enableHUDSelection=!0;this.enableInvisibleTerrain=!1;this.enableBackfacesTerrain=!0;this.performanceInfo={queryDuration:0,numObjectsTested:0};this.viewingMode=d||"global";this.intersectObject=this.intersectObject.bind(this);this.init(f,g,l,k,n,m,c)}d.prototype.init=function(b,e,d,f,g,l,k){e&&d&&a.vec3d.subtract(d,e,this.dir);this.minResult.init(e,d);this.maxResult.init(e,d);this.numObjectsTested=
0;this.point=f;this.camera=g;this.isSelection=k;this.layers=b;this.p0=e;this.p1=d;this.hudResults=[];null==l&&(l=1E-5);this.tolerance=l;if(this.layers)for(b=0;b<this.layers.length;++b)if(e=this.layers[b],d=e.getSpatialQueryAccelerator?e.getSpatialQueryAccelerator():void 0)d.forEachAlongRay(this.p0,this.dir,this.intersectObject);else for(e=e.getObjects(),d=0;d<e.length;++d)this.intersectObject(e[d])};Object.defineProperty(d.prototype,"transformInverse",{get:function(){return this._transformInverse.value},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"transformInverseTranspose",{get:function(){return this._transformInverseTranspose.value},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"transformInverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"transformTranspose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0});d.prototype.getDirection=
function(){this.normalDir||(this.normalDir=a.vec3d.create(),a.vec3d.normalize(this.dir,this.normalDir));return this.normalDir};d.prototype.intersectObject=function(b){var d=this;this.numObjectsTested++;for(var f=b.id,g=b.getGeometryRecords(),l=b.objectTransformation,n,h=0;h<g.length;h++){var c=g[h],t=c.geometry,z=c.materials,p=c.instanceParameters;p.hidden||(n=t.id,a.mat4d.set(l,this.transform),a.mat4d.multiply(this.transform,c.getShaderTransformation()),this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),
this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate(),a.mat4d.multiplyVec3(this.transformInverse,this.p0,k),a.mat4d.multiplyVec3(this.transformInverse,this.p1,m),z[0].intersect(t,p,this.transform,this,k,m,function(a,c,g,l,k,q){0<=a&&(k?(k=new e,k.init(d.p0,d.p1),k.set(b,f,a,c,l,q,n,g),d.hudResults.push(k)):((null==d.minResult.priority||l>=d.minResult.priority)&&(null==d.minResult.dist||a<d.minResult.dist)&&d.minResult.set(b,f,a,c,l,null,n,g),(null==d.maxResult.priority||
l>=d.maxResult.priority)&&(null==d.maxResult.dist||a>d.maxResult.dist)&&d.maxResult.set(b,f,a,c,l,null,n,g)))},c.customTransformation))}};d.prototype.getMinResult=function(){return this.minResult};d.prototype.getMaxResult=function(){return this.maxResult};d.prototype.getHudResults=function(){return this.hudResults};d.DEFAULT_TOLERANCE=1E-5;return d}();var e=function(){function b(b,e){this.normal=a.vec3d.create();this.init(b,e)}b.prototype.getIntersectionPoint=function(b){if(null==this.dist)return!1;
a.vec3d.lerp(this.p0,this.p1,this.dist,b);return!0};b.prototype.set=function(b,e,d,f,l,k,m,c){this.dist=d;a.vec3d.set(f,this.normal);this.targetType=b?b instanceof g?"StageObject":"StagePoint":"None";this.target=b;this.name=e;this.priority=l;this.center=k?a.vec3d.create(k):null;this.geometryId=m;this.triangleNr=c};b.prototype.copyFrom=function(b){this.p0=b.p0;this.p1=b.p1;this.dist=b.dist;this.targetType=b.targetType;this.target=b.target;this.name=b.name;this.priority=b.priority;this.center=b.center?
a.vec3d.create(b.center):null;this.geometryId=b.geometryId;this.triangleNr=b.triangleNr;this.intersector=b.intersector;a.vec3d.set(b.normal,this.normal)};b.prototype.setIntersector=function(a){this.intersector=a};b.prototype.init=function(a,b){this.dist=void 0;this.targetType="None";this.priority=this.name=this.target=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="stage";this.p0=a;this.p1=b};return b}(),b=function(){function a(a,b,e){this.original=a;this.update=b;this.dirty=
!0;this.transform=e()}a.prototype.invalidate=function(){this.dirty=!0};Object.defineProperty(a.prototype,"value",{get:function(){this.dirty&&(this.update(this.original.value,this.transform),this.dirty=!1);return this.transform},enumerable:!0,configurable:!0});return a}();return p})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("require exports ./ComponentUtils ./GeometryRecord ./gl-matrix ./HighlightUtils ./IdGen ./ModelContentType ./Util".split(" "),function(p,h,d,a,g,f,k,m,e){var b=
e.assert,l=g.mat4d,t=g.vec3d,u=l.identity();p=function(){function e(a){void 0===a&&(a={});this._bvObjectSpace=new r;this._bvWorldSpace=new r;this._bvDirty=!0;this._hasVolatileTransformation=!1;this.id=e._idGen.gen(a.idHint);this.name=a.name;this.castShadow=null!=a.castShadow?a.castShadow:!0;this.metadata=a.metadata;this.objectTransformation=l.identity();this._initializeGeometryRecords(a.geometries,a.materials,a.transformations)}e.prototype._initializeGeometryRecords=function(e,d,f){if(Array.isArray(e)){b(d.length===
e.length,"Object3D: materials don't match geometries");b(f.length===e.length,"Object3D: transformations don't match geometries");this.geometryRecords=Array(e.length);this.geometries=e.slice();for(var c=0;c<e.length;c++)b(Array.isArray(d[c]),"Object3D: materials parameter must be array of array"),this.geometryRecords[c]=new a(e[c],d[c].slice(),l.create(f[c]),{});this._hasVolatileTransformation=!1}else this.geometryRecords=[],this.geometries=[]};Object.defineProperty(e.prototype,"parentLayer",{get:function(){return this._parentLayer},
set:function(a){b(null==this._parentLayer||null==a,"Object3D can only be added to a single Layer");this._parentLayer=a},enumerable:!0,configurable:!0});e.prototype.getParentLayer=function(){return this.parentLayer};e.prototype.addParentLayer=function(a){this.parentLayer=a};e.prototype.removeParentLayer=function(a){this.parentLayer=null};e.prototype.getNumGeometryRecords=function(){return this.geometryRecords.length};e.prototype.getFirstGeometryIndex=function(a){a=this.geometries.indexOf(a);b(-1<a,
"Object3D.getFirstGeometryIndex: geometry not found");return a};e.prototype.findGeometryRecords=function(a){for(var b=[],e=0;e<this.geometries.length;e++)this.geometries[e]===a&&b.push(this.geometryRecords[e]);return b};e.prototype.getGeometryRecord=function(a){b(0<=a&&a<this.geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range");return this.geometryRecords[a]};e.prototype.getGeometryRecords=function(){return this.geometryRecords};e.prototype.addGeometry=function(e,d,f,c,g,
k){void 0===f&&(f=u);b(Array.isArray(d),"Object3D.addGeometry: materials must be array");this.geometries.push(e);e=new a(e,d.slice(),l.create(f),c||{},g,k);this.geometryRecords.push(e);this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.customTransformation});this._notifyDirty("objGeometryAdded",e);this._invalidateBoundingVolume();return e};e.prototype.hasGeometry=function(a){return-1<this.geometries.indexOf(a)};e.prototype.removeGeometry=function(a){var b=this.geometryRecords.splice(a,
1)[0];this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.customTransformation});this.geometries.splice(a,1);this._notifyDirty("objGeometryRemoved",b);this._invalidateBoundingVolume();return b};e.prototype.removeAllGeometries=function(){for(;0<this.getNumGeometryRecords();)this.removeGeometry(0)};e.prototype.geometryVertexAttrsUpdated=function(a){this._notifyDirty("vertexAttrsUpdated",this.geometryRecords[a]);this._invalidateBoundingVolume()};e.prototype.areAllComponentsHidden=
function(){for(var a=0,b=this.geometryRecords;a<b.length;a++){var e=b[a],c=e.instanceParameters.componentVisibilities,e=e.geometry.getData().componentOffsets;if(!d.isAllHidden(c,e))return!1}return!0};e.prototype.areAllComponentsVisible=function(){for(var a=0,b=this.geometryRecords;a<b.length;a++){var e=b[a],c=e.instanceParameters.componentVisibilities,e=e.geometry.getData().componentOffsets;if(!d.isAllVisible(c,e))return!1}return!0};e.prototype.hasComponents=function(){for(var a=!1,b=0;b<this.geometries.length&&
!(a=this.geometries[b].getData(),a=d.hasComponents(a.componentOffsets));b++);return a};e.prototype.setComponentVisibility=function(a,b,e){var c=a.instanceParameters.componentVisibilities,f=a.geometry.getData().componentOffsets;b=d.updateVisibility(c,f,b,e);a.instanceParameters.componentVisibilities=b;this._notifyDirty("visibilityChanged",a)};e.prototype.setHidden=function(a,b){a.instanceParameters.hidden=!!b;this._notifyDirty("visibilityChanged",a)};e.prototype.isHidden=function(a){return!!a.instanceParameters.hidden};
e.prototype.getComponentVisibility=function(a,b){return d.getVisibility(a.instanceParameters.componentVisibilities,b)};e.prototype.hideAllComponents=function(){for(var a=0,b=this.geometryRecords;a<b.length;a++){var e=b[a],c=d.hideAllComponents(e.instanceParameters.componentVisibilities);e.instanceParameters.componentVisibilities=c}this._notifyDirty("visibilityChanged")};e.prototype.unhideAllComponents=function(){for(var a=0,b=this.geometryRecords;a<b.length;a++){var e=b[a],c=d.unhideAllComponents(e.instanceParameters.componentVisibilities);
e.instanceParameters.componentVisibilities=c}this._notifyDirty("visibilityChanged")};e.prototype._setComponentHighlight=function(a,b,e,c){b=d.addHighlight(a.instanceParameters.componentHighlights,b,e,c);a.instanceParameters.componentHighlights=b};e.prototype.setComponentHighlight=function(a,b,e){var c=f.generateHighlightId();this._setComponentHighlight(a,b,e,c);this._notifyDirty("componentHighlightChanged");return c};e.prototype.highlightAllComponents=function(a){for(var b=f.generateHighlightId(),
e=0,c=this.geometryRecords;e<c.length;e++)this._setComponentHighlight(c[e],null,a,b);this._notifyDirty("componentHighlightChanged");return b};e.prototype.removeHighlights=function(a){for(var b=0,e=this.geometryRecords;b<e.length;b++){var c=e[b].instanceParameters,f=d.removeHighlight(c.componentHighlights,a);c.componentHighlights=f}this._notifyDirty("componentHighlightChanged")};e.prototype.getComponentFromTriangleNr=function(a,e){b(0<=a&&a<this.geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");
a=this.geometryRecords[a].geometry.getData().componentOffsets;return d.componentFind(a,3*e)};e.prototype.setGeometryTransformation=function(e,d){b(0<=e&&e<this.geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var f=this.geometryRecords[e];d=new a(f.geometry,f.materials,l.create(d),f.instanceParameters);this.geometryRecords[e]=d;this._notifyDirty("objGeometryReplaced",[f,d]);this._invalidateBoundingVolume()};e.prototype.getObjectTransformation=function(){return l.create(this.objectTransformation)};
e.prototype.setObjectTransformation=function(a){l.set(a,this.objectTransformation);this._invalidateBoundingVolume();this._notifyDirty("objTransformation")};e.prototype.getCombinedStaticTransformation=function(a,b){b=b||l.create();l.multiply(this.objectTransformation,a.getStaticTransformation(),b);return b};e.prototype.getCombinedShaderTransformation=function(a,b){b=b||l.create();l.multiply(this.objectTransformation,a.getShaderTransformation(),b);return b};e.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation};
e.prototype.getCastShadow=function(){return this.castShadow};e.prototype.setCastShadow=function(a){this.castShadow=a};e.prototype.getMetadata=function(){return this.metadata};e.prototype.getName=function(){return this.name};e.prototype.getBBMin=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin};e.prototype.getBBMax=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax};e.prototype.getCenter=function(a){this._validateBoundingVolume();
return a?this._bvObjectSpace.center:this._bvWorldSpace.center};e.prototype.getBSRadius=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius};e.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var a=0;a<this.geometryRecords.length;++a){var b=this.geometries[a],e=this.geometryRecords[a],b=b.getBoundingInfo();this._calculateTransformedBoundingVolume(b,
this._bvObjectSpace,e.getShaderTransformation());this._calculateTransformedBoundingVolume(b,this._bvWorldSpace,this.getCombinedShaderTransformation(e))}t.lerp(this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5,this._bvObjectSpace.center);t.lerp(this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5,this._bvWorldSpace.center);for(var e=t.create(),c=t.create(),d=this._getScaleFactor(this.objectTransformation),a=0;a<this.geometryRecords.length;++a){var b=this.geometries[a],f=this.geometryRecords[a].getShaderTransformation(),
g=this._getScaleFactor(f),b=b.getBoundingInfo();l.multiplyVec3(f,b.getCenter(),e);f=t.dist(e,this._bvObjectSpace.center);b=b.getBSRadius()*g;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,f+b);l.multiplyVec3(this.objectTransformation,e,c);g=t.dist(c,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,g+b*d)}this._bvDirty=!1}};e.prototype._calculateTransformedBoundingVolume=function(a,b,e){var c=a.getBBMin();a=a.getBBMax();for(var d=t.create(),
f=t.create(),g=-1;3>g;++g){t.set(c,d);t.set(a,f);-1<g&&(d[g]=a[g],f[g]=c[g]);l.multiplyVec3(e,d);l.multiplyVec3(e,f);for(var k=0;3>k;++k)b.bbMin[k]=Math.min(b.bbMin[k],d[k],f[k]),b.bbMax[k]=Math.max(b.bbMax[k],d[k],f[k])}};e.prototype._getScaleFactor=function(a){return Math.max(Math.max(Math.sqrt(a[0]*a[0]+a[4]*a[4]+a[8]*a[8]),Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])),Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))};e.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0;this._parentLayer&&
this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace)};e.prototype._notifyDirty=function(a,b,e,c){this._parentLayer&&(e=e||m.OBJECT,this._parentLayer.notifyDirty(a,b,e,c||this))};e._idGen=new k;return e}();var r=function(){function a(){this.bbMin=t.create();this.bbMax=t.create();this.center=t.create();this.bsRadius=0}a.prototype.init=function(){t.set3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.bbMin);t.set3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.bbMax);
t.set3(0,0,0,this.center);this.bsRadius=0};a.prototype.getCenter=function(){return this.center};a.prototype.getBSRadius=function(){return this.bsRadius};return a}();return p})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define(["require","exports","./IdGen"],function(p,h,d){return function(){function a(d,f,k,m,e,b){this.id=a._idGen.gen(d.id);this.geometry=d;this.materials=f;this.transformation=k;this.instanceParameters=m;this.origin=e;this.customTransformation=b}a.prototype.getStaticTransformation=
function(){return this.transformation};a.prototype.getShaderTransformation=function(){return this.customTransformation?this.customTransformation(this.transformation):this.transformation};a._idGen=new d;return a}()})},"esri/views/3d/webgl-engine/lib/HighlightUtils":function(){define(["require","exports","./IdGen"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});var a=new d;h.generateHighlightId=function(){return a.gen("highlight")}})},"esri/views/3d/webgl-engine/lib/ModelContentType":function(){define(["require",
"exports"],function(p,h){return function(){function d(){}d.LAYER="layers";d.OBJECT="objects";d.GEOMETRY="geometries";d.MATERIAL="materials";d.TEXTURE="textures";return d}()})},"esri/views/3d/webgl-engine/lib/PerformanceTimer":function(){define(["require","exports","./Performance"],function(p,h,d){return function(){function a(a){this._filterSampleIndex=0;this._lastTime=NaN;this._numMeasurements=this._totalTime=0;this._filterSamples=Array(a);this.reset();this._filterSize=a}a.prototype.reset=function(){for(var a=
this._filterSampleIndex=0;a<this._filterSize;a++)this._filterSamples[a]=NaN};a.prototype.start=function(){this._tsStart=d.now()};a.prototype.stop=function(){this._lastTime=d.now()-this._tsStart;this._totalTime+=this._lastTime;this._numMeasurements++;this._filterSize&&(this._filterSamples[this._filterSampleIndex]=this._lastTime,this._filterSampleIndex=(this._filterSampleIndex+1)%this._filterSize);return this._lastTime};a.prototype.getLast=function(){return this._lastTime};a.prototype.getLastFiltered=
function(){for(var a=0,d=0;d<this._filterSamples.length;d++)a+=this._filterSamples[d];return a/this._filterSamples.length};a.prototype.getAverage=function(){return this._totalTime/this._numMeasurements};a.prototype.getTotal=function(){return this._totalTime};a.prototype.getNumMeasurements=function(){return this._numMeasurements};return a}()})},"esri/views/3d/webgl-engine/lib/Performance":function(){define(["require","exports","../../../../core/now"],function(p,h,d){return{now:d}})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("require exports ./common ../../lib/glMatrix ../../state/utils/viewUtils ../../support/earthUtils ../../support/mathUtils".split(" "),
function(p,h,d,a,g,f,k){function m(a,b,f,l){void 0===f&&(f=d.defaultApplyOptions);void 0===l&&(l=d.defaultApplyOptions);if(3===f.interactionType||!a.state.constraints.tilt)return 0;var n=g.viewAngle(a.renderCoordsHelper,b.center,b.eye);b=a.state.constraints.tilt(b.distance,u);if(0!==f.interactionType){var c=f.interactionStartCamera,q=f.interactionFactor,h=b.min,r=b.max,v=m(a,c,d.defaultApplyOptions,f),p=0===v?0:g.viewAngle(a.renderCoordsHelper,c.center,c.eye);b.min=h;b.max=r;2===f.interactionType?
(d.hasConstraintType(f.selection,2)&&e(a,c,b),d.adjustRangeForInteraction(v,p,!0,q,t,b)):d.adjustRangeForInteraction(v,p,!1,q,t,b)}2===l.interactionType&&d.hasConstraintType(l.selection,2)&&e(a,l.interactionStartCamera,b);a=k.clamp(n,b.min,b.max);n-=a;return 1E-6>=Math.abs(n)?0:n}function e(b,e,d){if(!b.state.isLocal){var g=b.state.constraints;if(g.altitude){b=a.vec3d.length2(e.center);var l=Math.sqrt(b);e=e.distance;var c=g.altitude.min+f.earthRadius,g=g.altitude.max+f.earthRadius,c=(c*c-e*e-b)/
(-2*l*e);d.min=Math.max(d.min,Math.min(Math.PI-k.acos((g*g-e*e-b)/(-2*l*e)),d.max));d.max=Math.min(d.max,Math.PI-k.acos(c))}}}Object.defineProperty(h,"__esModule",{value:!0});h.apply=function(e,f,g,k){void 0===g&&(g=d.defaultApplyOptions);void 0===k&&(k=f);f!==k&&k.copyFrom(f);e=m(e,f,g);if(0===e)return!1;a.mat4d.identity(l);a.mat4d.rotate(l,-e,f.viewRight);a.vec3d.subtract(f.center,f.eye,b);a.mat4d.multiplyVec3(l,b);a.vec3d.subtract(f.center,b,k.eye);a.mat4d.multiplyVec3(l,k.up);k.markViewDirty();
return!0};h.error=m;var b=a.vec3d.create(),l=a.mat4d.create(),t=k.deg2rad(5),u={min:0,max:0}})},"esri/views/3d/state/utils/viewUtils":function(){define(["require","exports","../../lib/glMatrix","../../support/mathUtils"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});h.viewAngle=function(k,m,e){k.worldUpAtPosition(m,g);d.vec3d.subtract(e,m,f);k=d.vec3d.length(f);return 0===k?0:a.acos(d.vec3d.dot(f,g)/k)};var g=d.vec3d.create(),f=d.vec3d.create()})},"esri/views/animation/easing":function(){define(["require",
"exports"],function(p,h){function d(a){return a}function a(a){var d=2*(a-Math.sqrt((a-1)*a)),f=d/2/a;return function(e){return e<f?a*e*e:d*e-d+1}}function g(a,d){return function(f){return f<d?d*a(f/d):1-a((1-f)/(1-d))*(1-d)}}Object.defineProperty(h,"__esModule",{value:!0});h.linear=d;h.inQuad=function(a){return a*a};h.outQuad=function(a){return 1-h.inQuad(1-a)};h.inOutQuad=function(a){return.5>a?h.inQuad(2*a)/2:(h.outQuad(2*(a-.5))+1)/2};h.inCubic=function(a){return a*a*a};h.outCubic=function(a){return 1-
h.inCubic(1-a)};h.inOutCubic=function(a){return.5>a?h.inCubic(2*a)/2:(h.outCubic(2*(a-.5))+1)/2};h.inQuart=function(a){return a*a*a*a};h.outQuart=function(a){return 1-h.inQuart(1-a)};h.inOutQuart=function(a){return.5>a?h.inQuart(2*a)/2:(h.outQuart(2*(a-.5))+1)/2};h.inQuint=function(a){return a*a*a*a*a};h.outQuint=function(a){return 1-h.inQuint(1-a)};h.inOutQuint=function(a){return.5>a?h.inQuint(2*a)/2:(h.outQuint(2*(a-.5))+1)/2};h.inSine=function(a){return-Math.cos(a*Math.PI/2)+1};h.outSine=function(a){return 1-
h.inSine(1-a)};h.inOutSine=function(a){return.5>a?h.inSine(2*a)/2:(h.outSine(2*(a-.5))+1)/2};h.inExpo=function(a){return Math.pow(2,10*(a-1))};h.outExpo=function(a){return 1-h.inExpo(1-a)};h.inOutExpo=function(a){return.5>a?h.inExpo(2*a)/2:(h.outExpo(2*(a-.5))+1)/2};h.inCirc=function(a){return-(Math.sqrt(1-a*a)-1)};h.outCirc=function(a){return 1-h.inCirc(1-a)};h.inOutCirc=function(a){return.5>a?h.inCirc(2*a)/2:(h.outCirc(2*(a-.5))+1)/2};h.inCoastQuad=g(a(1),1);h.outCoastQuad=g(a(1),0);h.inOutCoastQuad=
g(a(1),.5);h.inCoastCubic=g(a(2),1);h.outCoastCubic=g(a(2),0);h.inOutCoastCubic=g(a(2),.5);h.inCoastQuart=g(a(3),1);h.outCoastQuart=g(a(3),0);h.inOutCoastQuart=g(a(3),.5);h.inCoastQuint=g(a(4),1);h.outCoastQuint=g(a(4),0);h.inOutCoastQuint=g(a(4),.5);h.named={linear:d,"in-quad":h.inQuad,"out-quad":h.outQuad,"in-out-quad":h.inOutQuad,"in-cubic":h.inCubic,"out-cubic":h.outCubic,"in-out-cubic":h.inOutCubic,"in-quart":h.inQuart,"out-quart":h.outQuart,"in-out-quart":h.inOutQuart,"in-quint":h.inQuint,"out-quint":h.outQuint,
"in-out-quint":h.inOutQuint,"in-sine":h.inSine,"out-sine":h.outSine,"in-out-sine":h.inOutSine,"in-expo":h.inExpo,"out-expo":h.outExpo,"in-out-expo":h.inOutExpo,"in-circ":h.inCirc,"out-circ":h.outCirc,"in-out-circ":h.inOutCirc}})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../animation/pointToPoint/Animation ../../lib/glMatrix ./AnimationController ../../webgl-engine/lib/Camera".split(" "),function(p,
h,d,a,g,f,k){Object.defineProperty(h,"__esModule",{value:!0});p=function(b){function f(e,d,f){f=b.call(this,f)||this;f.viewState=e;f.pickingHelper=d;f.hasTarget=!1;f.animation=new a.default(f.viewState.mode);return f}d(f,b);f.prototype.begin=function(a,b){this.hasTarget=!0;b=this.animationSettings(b);m.copyFrom(this.viewState.camera);this.pickingHelper.pickRaySegment(m.eye,m.center,e)&&(m.center=e);this.animation.update(m,a,b);this.animation.finished&&this.finish()};f.prototype.finish=function(){this.animation.currentTime=
this.animation.time;b.prototype.finish.call(this)};Object.defineProperty(f.prototype,"steppingFinished",{get:function(){return this.hasTarget&&this.animation.finished},enumerable:!0,configurable:!0});f.prototype.stepController=function(a,e){b.prototype.stepController.call(this,a,e);this.hasTarget&&this.animation.step(a,e)};f.prototype.onControllerEnd=function(a){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,a),this.animation.currentTime=this.animation.time);
b.prototype.onControllerEnd.call(this,a)};f.prototype.animationSettings=function(a){void 0===a&&(a={});return{apex:{maximumDistance:this.viewState.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},speedFactor:a.speedFactor,duration:a.duration,maxDuration:a.maxDuration,easing:a.easing}};return f}(f.AnimationController);h.PointToPointAnimationController=p;var m=new k,e=g.vec3d.create()})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Camera ../../lib/glMatrix ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),
function(p,h,d,a,g,f,k){Object.defineProperty(h,"__esModule",{value:!0});var m=g.vec3d,e=m.create();p=function(){function b(b){this.currentTime=0;this.animation=new k.Animation(function(){return new a.default(b)});this._current=new a.default(b)}Object.defineProperty(b.prototype,"finished",{get:function(){return this.currentTime>=this.animation.time},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"time",{get:function(){return this.animation.time},enumerable:!0,configurable:!0});
b.prototype.update=function(a,b,d){var f=this.animation.definition.source,g=this.animation.definition.target,l=m.subtract(b.center,a.center,e),k=m.length(l);1E-5<=k?(l[0]/=k,l[1]/=k,l[2]/=k):(l[0]=0,l[1]=1,l[0]=0);m.set(l,f.lookAtDirection);m.set(l,g.lookAtDirection);f.copyFromRenderCamera(a);g.copyFromRenderCamera(b);this._current.copyFrom(f);this.animation.update(f,g,d);this.currentTime=0;a.almostEquals(b,5E-4,!0)&&(this.currentTime=this.animation.time)};b.prototype.cameraAt=function(a,b){a=this.animation.cameraAt(a,
this._current);b||(b=new f);a.copyToRenderCamera(b);return b};b.prototype.step=function(a,b){this.finished||(this.currentTime+=a,this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,b)};return b}();h.Animation=p;h.default=p})},"esri/views/3d/animation/pointToPoint/Camera":function(){define(["require","exports","../../lib/glMatrix","../../support/mathUtils"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});var g=a.angle,f=a.lerp,
k=a.slerp,m=d.vec3d,e=d.mat3d,b=m.create(),l=m.create(),t=m.create(),u=m.create(),r=m.create(),v=m.create(),q=m.createFrom(0,0,1),n=m.createFrom(0,1,0),w=m.createFrom(1,0,0),c=e.create();p=function(){function a(a){void 0===a&&(a="global");this.viewingMode=a;this.center=m.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=m.create(n)}a.prototype.pixelsPerPanAtZoom=function(a){return this.size/2/(this._zoomToPanScale*a)};a.prototype.zoomAtPixelsPerPan=function(a){return this.size/2/(this._zoomToPanScale*
a)};a.prototype.pixelsPerRotateAtZoom=function(a){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};a.prototype.compareTo=function(a,c){c||(c={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if("global"===this.viewingMode){var b=m.length(this.center),e=m.length(a.center),b=(b+e)/2;c.pan=g(this.center,a.center)*b}else c.pan=m.dist(this.center,a.center);b=Math.abs(a.yaw-this.yaw);b>=Math.PI&&(b=2*Math.PI-b);c.rotate=Math.max(b,Math.abs(a.pitch-this.pitch));c.sourceZoom=this.distance;c.targetZoom=
a.distance;return c};a.prototype.interpolate=function(a,c,b){"global"===this.viewingMode?k(a.center,c.center,b.pan,this.center):m.lerp(a.center,c.center,b.pan,this.center);this.distance=f(a.distance,c.distance,b.zoom);this.pitch=f(a.pitch,c.pitch,b.rotate);a=a.yaw;c=c.yaw;Math.abs(c-a)>=Math.PI&&(a+=2*(a<c?1:-1)*Math.PI);this.yaw=f(a,c,b.rotate)};a.prototype.copyFrom=function(a){m.set(a.center,this.center);this.pitch=a.pitch;this.yaw=a.yaw;this.distance=a.distance;m.set(a.lookAtDirection,this.lookAtDirection);
this.size=a.size;this.copyFromCommon(a);this.viewingMode=a.viewingMode};a.prototype.copyFromRenderCamera=function(a){var b=this._lookAtOrientation(a.center,c);m.set(a.center,this.center);e.multiplyVec3(b,m.subtract(a.center,a.eye,u));e.multiplyVec3(b,a.up,r);this.distance=m.length(u);u[0]/=this.distance;u[1]/=this.distance;u[2]/=this.distance;this.pitch=this._eyeUpToPitch(u,r);this.yaw=this._eyeUpToYaw(u,r);this.size=Math.sqrt(a.width*a.width+a.height*a.height);this.copyFromCommon(a)};a.prototype.copyFromCommon=
function(a){this.fov=a.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};a.prototype.copyToRenderCamera=function(a){var b=this._lookAtOrientation(this.center,c);e.transpose(b);this._axisAngleVec3(w,this.pitch-Math.PI/2,n,u);this._axisAngleVec3(q,this.yaw,u);this._axisAngleVec3(w,this.pitch-Math.PI/2,q,r);this._axisAngleVec3(q,this.yaw,r);m.scale(u,this.distance);e.multiplyVec3(b,u);e.multiplyVec3(b,r);a.center=this.center;a.eye=m.subtract(this.center,u,u);a.up=r};a.prototype._axisAngleVec3=function(a,
c,e,d){void 0===d&&(d=e);var f=Math.cos(c);c=Math.sin(c);m.scale(e,f,b);m.scale(m.cross(a,e,l),c);m.scale(a,(1-f)*m.dot(a,e),t);return m.add(m.add(b,l,d),t,d)};a.prototype._lookAtOrientation=function(a,c){this._upAtLookAt(a,t);m.normalize(m.cross(this.lookAtDirection,t,b));0===b[0]&&0===b[1]&&0===b[2]&&m.set(w,b);m.normalize(m.cross(t,b,l));c||(c=e.create());c[0]=b[0];c[1]=l[0];c[2]=t[0];c[3]=b[1];c[4]=l[1];c[5]=t[1];c[6]=b[2];c[7]=l[2];c[8]=t[2];return c};a.prototype._upAtLookAt=function(a,c){return"local"===
this.viewingMode?m.set(q,c):m.normalize(a,c)};a.prototype._eyeUpToPitch=function(a,c){return Math.PI-g(q,a)};a.prototype._eyeUpToYaw=function(a,c){.5>Math.abs(c[2])?(m.set(c,v),0<a[2]&&m.scale(v,-1)):m.set(a,v);return g(w,m.normalize(m.cross(v,q,l)),q)};return a}();h.default=p})},"esri/views/3d/webgl-engine/lib/Camera":function(){define(["require","exports","./gl-matrix","./Util"],function(p,h,d,a){function g(a,b){var e=b[0]-a[0],d=b[1]-a[1],c=b[2]-a[2];a=b[3]-a[3];return e*e+d*d+c*c+a*a}function f(a,
b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function k(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]}var m=d.vec3d,e=d.vec4d,b=d.mat4d;p=function(){function d(a,d,f){this._viewUp=m.create();this._viewForward=m.create();this._viewRight=m.create();this._viewport=e.create();this._padding=e.create();this._fov=55/180*Math.PI;this._near=0;this._far=1E3;this._viewDirty=!0;this._viewMatrix=b.create();this._projectionDirty=!0;this._projectionMatrix=b.create();this._viewProjectionDirty=
!0;this._viewProjectionMatrix=b.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=b.create();this._frustumPlanesDirty=!0;this._frustumPlanes=[e.create(),e.create(),e.create(),e.create(),e.create(),e.create()];this._fullViewport=null;this.aboveGround=!0;this._eye=m.create(a);this._center=m.create(d);this._up=void 0!==f?m.create(f):m.create([0,0,1]);this._padding=e.create()}Object.defineProperty(d.prototype,"eye",{get:function(){return this._eye},set:function(a){this._compareAndSetView(a,
this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"center",{get:function(){return this._center},set:function(a){this._compareAndSetView(a,this._center)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"up",{get:function(){return this._up},set:function(a){this._compareAndSetView(a,this._up)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"viewMatrix",{get:function(){this._ensureViewClean();return this._viewMatrix},set:function(a){b.set(a,
this._viewMatrix);this._viewDirty=!1;this._frustumPlanesDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"viewForward",{get:function(){this._ensureViewClean();return this._viewForward},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"viewUp",{get:function(){this._ensureViewClean();return this._viewUp},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"viewRight",{get:function(){this._ensureViewClean();
return this._viewRight},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"near",{get:function(){return this._near},set:function(a){this._near!==a&&(this._near=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"far",{get:function(){return this._far},set:function(a){this._far!==a&&(this._far=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"viewport",{get:function(){return this._viewport},set:function(a){this.x=a[0];this.y=a[1];this.width=a[2];this.height=a[3]},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"x",{get:function(){return this._viewport[0]},set:function(a){a+=this._padding[3];this._viewport[0]!==a&&(this._viewport[0]=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"y",{get:function(){return this._viewport[1]},
set:function(a){a+=this._padding[2];this._viewport[1]!==a&&(this._viewport[1]=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"width",{get:function(){return this._viewport[2]},set:function(a){this._viewport[2]!==a&&(this._viewport[2]=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"height",{get:function(){return this._viewport[3]},
set:function(a){this._viewport[3]!==a&&(this._viewport[3]=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(a){this.width=a-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},
set:function(a){this.height=a-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"fullViewport",{get:function(){this._fullViewport||(this._fullViewport=e.create());this._fullViewport[0]=this._viewport[0]-this._padding[3];this._fullViewport[1]=this._viewport[1]-this._padding[2];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"aspect",
{get:function(){return this.width/this.height},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"padding",{get:function(){return this._padding},set:function(a){if(this._padding[0]!==a[0]||this._padding[1]!==a[1]||this._padding[2]!==a[2]||this._padding[3]!==a[3])this._viewport[0]+=a[3]-this._padding[3],this._viewport[1]+=a[2]-this._padding[2],this._viewport[2]-=a[1]+a[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=a[0]+a[2]-(this._padding[0]+this._padding[2]),e.set(a,this._padding),
this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"viewProjectionMatrix",{get:function(){this._viewProjectionDirty&&(b.multiply(this.projectionMatrix,this.viewMatrix,this._viewProjectionMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var a=this.width,e=this.height,
d=this.near*Math.tan(this.fovY/2),c=d*this.aspect;b.frustum(-c*(1+2*this._padding[3]/a),c*(1+2*this._padding[1]/a),-d*(1+2*this._padding[2]/e),d*(1+2*this._padding[0]/e),this.near,this.far,this._projectionMatrix);this._projectionDirty=!1}return this._projectionMatrix},set:function(a){b.set(a,this._projectionMatrix);this._projectionDirty=!1;this._frustumPlanesDirty=this._viewProjectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"fov",{get:function(){return this._fov},
set:function(a){this._fov=a;this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"fovX",{get:function(){return a.fovd2fovx(this._fov,this.width,this.height)},set:function(b){this._fov=a.fovx2fovd(b,this.width,this.height);this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"fovY",{get:function(){return a.fovd2fovy(this._fov,
this.width,this.height)},set:function(b){this._fov=a.fovy2fovd(b,this.width,this.height);this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"distance",{get:function(){return m.dist(this._center,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"frustumPoints",{get:function(){return this.computeFrustumPoints()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"frustumPlanes",
{get:function(){this._frustumPlanesDirty&&(this._frustumPlanes=this._computeFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1);return this._frustumPlanes},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"viewInverseTransposeMatrix",{get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=b.create()),b.inverse(this.viewMatrix,this._viewInverseTransposeMatrix),b.transpose(this._viewInverseTransposeMatrix),
this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"perPixelRatio",{get:function(){return Math.tan(this.fovX/2)/this.width},enumerable:!0,configurable:!0});d.prototype.copyFrom=function(a){m.set(a._eye,this._eye);m.set(a._center,this._center);m.set(a._up,this._up);e.set(a._viewport,this._viewport);e.set(a._padding,this._padding);this._near=a._near;this._far=a._far;this._fov=a._fov;this.aboveGround=a.aboveGround;
a._viewDirty?this._viewDirty=!0:(b.set(a._viewMatrix,this._viewMatrix),m.set(a._viewRight,this._viewRight),m.set(a._viewUp,this._viewUp),m.set(a._viewForward,this._viewForward),this._viewDirty=!1);a._projectionDirty?this._projectionDirty=!0:(b.set(a._projectionMatrix,this._projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=!0;a._frustumPlanesDirty?this._frustumPlanesDirty=!0:(a.copyFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1);a._viewInverseTransposeMatrixDirty?
this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?b.set(a._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=b.create(a._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);a._fullViewport?this._fullViewport?e.set(a._fullViewport,this._fullViewport):this._fullViewport=e.create(a._fullViewport):this._fullViewport=null;return this};d.prototype.copyViewFrom=function(a){this.eye=a.eye;this.center=a.center;this.up=a.up};
d.prototype.copy=function(){var a=new d;a.copyFrom(this);return a};d.prototype.equivalent=function(a){return f(this._eye,a._eye)&&f(this._center,a._center)&&f(this._up,a._up)&&k(this._viewport,a._viewport)&&k(this._padding,a._padding)&&this._near===a._near&&this._far===a._far&&this._fov===a._fov};d.prototype.almostEquals=function(a,b,e){void 0===e&&(e=!1);b=m.dist(this._eye,this._center)*(b||5E-4);b*=b;e?(m.direction(a._center,a._eye,u),m.direction(this._center,this._eye,r),e=1E-10):(m.set(a._center,
u),m.set(this._center,r),e=b);return m.dist2(a._eye,this._eye)<b&&m.dist2(u,r)<e&&.001>Math.abs(a._fov-this._fov)&&.5>g(a._padding,this._padding)&&.5>g(a._viewport,this._viewport)};d.prototype.markViewDirty=function(){this._viewProjectionDirty=this._frustumPlanesDirty=this._viewDirty=!0};d.prototype.computePixelSizeAt=function(a){return this.computePixelSizeAtDist(m.dist(a,this._eye))};d.prototype.computePixelSizeAtDist=function(a){return 2*a*Math.tan(this.fovX/2)/this.width};d.prototype.computeDistanceFromRadius=
function(a,b){return a/Math.tan(Math.min(this.fovX,this.fovY)/(2*(b||1)))};d.prototype.copyFrustumPlanes=function(a){if(!a){a=Array(6);for(var b=0;6>b;++b)a[b]=e.create()}for(var d=this.frustumPlanes,b=0;6>b;b++)e.set(d[b],a[b]);return a};d.prototype.computeFrustumPoints=function(b){if(!b){b=Array(8);for(var e=0;8>e;++e)b[e]=m.create()}a.matrix2frustum(this.viewMatrix,this.projectionMatrix,b);return b};d.prototype.setGLViewport=function(a){var b=this.viewport,e=this.padding;a.setViewport(b[0]-e[3],
b[1]-e[2],b[2]+e[1]+e[3],b[3]+e[0]+e[2])};d.prototype.applyProjection=function(e,d,f){void 0===f&&(f=!1);e!==l&&m.set(e,l);l[3]=1;f&&(d[2]=-l[2]);b.multiplyVec4(this.projectionMatrix,l);m.scale(l,1/Math.abs(l[3]));e=this.fullViewport;d[0]=a.lerp(0,e[0]+e[2],.5+.5*l[0]);d[1]=a.lerp(0,e[1]+e[3],.5+.5*l[1]);f||(d[2]=.5*(l[2]+1));return d};d.prototype.projectPoint=function(e,d){l[0]=e[0];l[1]=e[1];l[2]=e[2];l[3]=1;b.multiplyVec4(this.viewProjectionMatrix,l);m.scale(l,1/Math.abs(l[3]));e=this.fullViewport;
d[0]=a.lerp(0,e[0]+e[2],.5+.5*l[0]);d[1]=a.lerp(0,e[1]+e[3],.5+.5*l[1]);d[2]=.5*(l[2]+1);return d};d.prototype.unprojectPoint=function(a,e,d){void 0===d&&(d=!1);if(d)return console.error("Camera.unprojectPoint() not yet implemented for linear Z"),null;b.multiply(this.projectionMatrix,this.viewMatrix,t);if(!b.inverse(t))return null;d=this.fullViewport;l[0]=2*(a[0]-d[0])/d[2]-1;l[1]=2*(a[1]-d[1])/d[3]-1;l[2]=2*a[2]-1;l[3]=1;b.multiplyVec4(t,l);if(0===l[3])return null;e[0]=l[0]/l[3];e[1]=l[1]/l[3];e[2]=
l[2]/l[3];return e};d.prototype.computeUp=function(a){"global"===a?this.computeUpGlobal():this.computeUpLocal()};d.prototype.computeUpGlobal=function(){m.subtract(this.center,this.eye,u);var a=m.length(this.center);1>a?(m.set3(0,0,1,this.up),this.markViewDirty()):Math.abs(m.dot(u,this.center))>.9999*m.length(u)*a||(m.cross(u,this.center,this.up),m.cross(this.up,u,this.up),m.normalize(this.up),this.markViewDirty())};d.prototype.computeUpLocal=function(){m.direction(this.center,this.eye,u);.9999>=Math.abs(u[2])&&
(m.scale(u,u[2]),m.set3(-u[0],-u[1],1-u[2],this.up),m.normalize(this.up),this.markViewDirty())};d.prototype._compareAndSetView=function(a,b){f(a,b)||(m.set(a,b),this._viewProjectionDirty=this._frustumPlanesDirty=this._viewDirty=!0)};d.prototype._computeFrustumPlanes=function(b){if(!b){b=Array(6);for(var d=0;6>d;++d)b[d]=e.create()}a.matrix2frustumPlanes(this.viewMatrix,this.projectionMatrix,b);return b};d.prototype._ensureViewClean=function(){this._viewDirty&&(b.lookAt(this._eye,this._center,this._up,
this._viewMatrix),m.set3(-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10],this._viewForward),m.set3(this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9],this._viewUp),m.set3(this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8],this._viewRight),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};return d}();var l=e.create(),t=b.create(),u=m.create(),r=m.create();return p})},"esri/views/animation/pointToPoint/Animation":function(){define("require exports ../easing ./Definition ./Settings ./apex/Path".split(" "),
function(p,h,d,a,g,f){Object.defineProperty(h,"__esModule",{value:!0});var k={zoom:0,pan:0,rotate:0};p=function(){function m(e){this.createCamera=e;this.time=0;this.definition=new a.Definition(e);this.path=new f.Path}m.prototype.update=function(a,b,d){this.definition.update(a,b,d);this.path.update(this.definition,d);this.time=this._applyTimeSettings(this.path.time,d);this.settings=d};m.prototype.cameraAt=function(a,b){b||(b=this.createCamera());a=Math.min(Math.max(0,a),1);a=this.settings.easing?this.normalizedEasing(this.settings.easing,
a,1E3*this.time):1<=this.time?this.normalizedEasing(d.inOutCoastQuad,a):this.normalizedEasing(d.outExpo,a);a=this.path.interpolateComponentsAt(a,k);b.interpolate(this.definition.source,this.definition.target,a);return b};m.prototype.normalizedEasing=function(a,b,d){d=a(0);var e=a(1);return(a(b)-d)/(e-d)};m.prototype._applyTimeSettings=function(a,b){var e=null!=b.speedFactor?b.speedFactor:1;null!=b.duration?a=b.duration:null!=b.speedFactor&&(a/=e);return a=Math.min(Math.max(null!=b.minDuration?b.minDuration:
g.defaultSettings.minDuration/e,a),null!=b.maxDuration?b.maxDuration:g.defaultSettings.maxDuration/e)};return m}();h.Animation=p;h.default=p})},"esri/views/animation/pointToPoint/Definition":function(){define(["require","exports","./Settings"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function a(a){this.createCamera=a;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:d.defaultSettings.desiredScreenFlow};this.source=a();this.target=
a()}a.prototype.clone=function(){var d=new a(this.createCamera);d.copyFrom(this);return d};a.prototype.copyFrom=function(a){this.update(a.source,a.target,a.settings)};a.prototype.update=function(a,f,k){this.source!==a&&this.source.copyFrom(a);this.target!==f&&this.target.copyFrom(f);this.settings.desiredScreenFlow=null!=k.desiredScreenFlow?k.desiredScreenFlow:d.defaultSettings.desiredScreenFlow;this.compared=this.source.compareTo(this.target,this.compared);this.desiredPixelFlow=this.settings.desiredScreenFlow*
this.target.size;this.halfWindowSize=this.target.size/2};a.prototype.halfWindowPanAtZoom=function(a){a=this.target.pixelsPerPanAtZoom(a);return this.halfWindowSize/a};Object.defineProperty(a.prototype,"hasZoom",{get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasPan",{get:function(){return 1E-9<this.compared.pan},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasRotate",{get:function(){return 1E-9<
this.compared.rotate},enumerable:!0,configurable:!0});return a}();h.Definition=p;h.default=p})},"esri/views/animation/pointToPoint/Settings":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});h.defaultSettings={desiredScreenFlow:2,minDuration:.5,maxDuration:8}})},"esri/views/animation/pointToPoint/apex/Path":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../easing ../Path ../Segment ./planning".split(" "),function(p,
h,d,a,g,f,k){Object.defineProperty(h,"__esModule",{value:!0});p=function(g){function e(a,e){var b=g.call(this)||this;b._preallocSegments=[new f.default,new f.default,new f.default];b.update(a,e);return b}d(e,g);e.prototype.update=function(a,e){if(a){this.definition?this.definition.copyFrom(a):this.definition=a.clone();var b=null;e&&e.apex&&(b=k.optimalDistance(a,e.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==b?this._updateWithoutApex():this._updateWithApex(b,
e.apex)}};e.prototype.segmentInterpolateComponentsAt=function(b,e,d){d=b.interpolateComponentsAt(e,d);b===this._ascensionSegment?d.zoom=a.outQuad(d.zoom):b===this._descensionSegment&&(d.zoom=a.inQuad(d.zoom));return d};e.prototype._updateWithApex=function(a,e){var b=this._preallocSegments,d=b[0],f=b[1],b=b[2],g=null!=e.ascensionFactor?e.ascensionFactor:.5;e=Math.min(1-g,null!=e.ascensionFactor?e.descensionFactor:.5);var k=1-g-e;d.definition?d.definition.copyFrom(this.definition):d.definition=this.definition.clone();
d.definition.compared.targetZoom=a;d.definition.compared.pan=this.definition.compared.pan*g;d.definition.compared.rotate=this.definition.compared.rotate*g;d.update();this._ascensionSegment=d;this.segments.push(d);0<k&&(f.definition?f.definition.copyFrom(this.definition):f.definition=this.definition.clone(),f.definition.copyFrom(this.definition),f.definition.compared.sourceZoom=a,f.definition.compared.targetZoom=a,f.definition.compared.pan=this.definition.compared.pan*k,f.definition.compared.rotate=
this.definition.compared.rotate*k,f.update(),this.segments.push(f));b.definition?b.definition.copyFrom(this.definition):b.definition=this.definition.clone();b.definition.compared.sourceZoom=a;b.definition.compared.pan=this.definition.compared.pan*e;b.definition.compared.rotate=this.definition.compared.rotate*e;b.update();this._descensionSegment=b;this.segments.push(b)};e.prototype._updateWithoutApex=function(){var a=this._preallocSegments[0];a.update(this.definition);this.segments.push(a)};return e}(g.default);
h.Path=p;h.default=p})},"esri/views/animation/pointToPoint/Path":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function d(){this.segments=[]}Object.defineProperty(d.prototype,"time",{get:function(){return this.segments.reduce(function(a,d){return a+d.time},0)},enumerable:!0,configurable:!0});d.prototype.interpolateComponentsAt=function(a,d){a=Math.min(Math.max(a,0),1);a*=this.time;for(var f=0,g=0,m=this.definition,e=0;e<this.segments.length;e++){var b=
this.segments[e],l=b.definition;if(a<=b.time||e===this.segments.length-1)return d=this.segmentInterpolateComponentsAt(b,a/b.time,d),d.pan=m.hasPan?(f+l.compared.pan*d.pan)/m.compared.pan:1,d.rotate=m.hasRotate?(g+l.compared.rotate*d.rotate)/m.compared.rotate:1,a=d.zoom*(l.compared.targetZoom-l.compared.sourceZoom)+l.compared.sourceZoom,f=this.segments[0].definition.compared.sourceZoom,g=this.segments[this.segments.length-1].definition.compared.targetZoom,d.zoom=m.hasZoom?(a-f)/(g-f):1,d;a-=b.time;
f+=l.compared.pan;g+=l.compared.rotate}};d.prototype.segmentInterpolateComponentsAt=function(a,d,f){return a.interpolateComponentsAt(d,f)};return d}();h.Path=p;h.default=p})},"esri/views/animation/pointToPoint/Segment":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function d(a){a&&this.update(a)}d.prototype.update=function(a){a&&(this.definition?this.definition.copyFrom(a):this.definition=a.clone());this._updatePrecomputedVariables();
this._updatePixelFlow()};d.prototype._updatePrecomputedVariables=function(){var a=this.definition,d=a.compared,f=d.sourceZoom,k=d.targetZoom;this._sl=f>k?1:-1;this._panPixelsAtSource=d.pan*a.source.pixelsPerPanAtZoom(f);a=(a.source.pixelsPerRotateAtZoom(f)+a.target.pixelsPerRotateAtZoom(k))/2;this._rotatePixels=d.rotate*a};d.prototype._updatePixelFlow=function(){var a=this.definition.compared.sourceZoom,d=this.definition.compared.targetZoom,f=this.definition.hasZoom,k=this.definition.hasPan,m=this.definition.hasRotate,
e,b;e=k&&f?(d/a-1)/(-1/(this._sl*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource):0;b=f&&m?Math.log(a/d)/Math.LN2*this._sl*this.definition.halfWindowSize/this._rotatePixels:0;this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;a=this.definition.desiredPixelFlow;f&&k&&m?(d=e+b+e*b,this._zoomPixelFlow=e*b/d*a,this._panPixelFlow=b/d*a,this._rotatePixelFlow=e/d*a):f&&k?(d=1+e,this._zoomPixelFlow=e/d*a,this._panPixelFlow=1/d*a):f&&m?(d=1+b,this._zoomPixelFlow=b/d*a,this._rotatePixelFlow=
1/d*a):k&&m?(e=this._panPixelsAtSource/this._rotatePixels,d=1+e,this._panPixelFlow=e/d*a,this._rotatePixelFlow=1/d*a):k?this._panPixelFlow=a:f?this._zoomPixelFlow=a:m&&(this._rotatePixelFlow=a);this.time=m?this.rotateTime:f?this.zoomTime:k?this.panTime:0};Object.defineProperty(d.prototype,"zoomTime",{get:function(){return this.definition.hasZoom?Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._sl*this.definition.halfWindowSize/this._zoomPixelFlow:0},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"panTime",{get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){var a=-1/(this._sl*this.definition.halfWindowSize)*Math.LN2;return Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*a+1)/(a*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"rotateTime",{get:function(){return this.definition.hasRotate?
this._rotatePixels/this._rotatePixelFlow:0},enumerable:!0,configurable:!0});d.prototype._interpolateComponentsZoom=function(a){if(this.definition.hasZoom){var d=this.definition.compared.sourceZoom,f=this.definition.compared.targetZoom;return(d*Math.pow(d/f,-a)-d)/(f-d)}return a};d.prototype._interpolateComponentsPan=function(a){if(this.definition.hasPan&&this.definition.hasZoom){var d=-1/(this._sl*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*
(Math.pow(2,d*a*this.time)-1)/(d*Math.LN2)}return a};d.prototype._interpolateComponentsRotate=function(a){return a};d.prototype.interpolateComponentsAt=function(a,d){a=Math.min(Math.max(a,0),1);var f=this._interpolateComponentsZoom(a),g=this._interpolateComponentsPan(a);a=this._interpolateComponentsRotate(a);d?(d.zoom=f,d.pan=g,d.rotate=a):d={zoom:f,pan:g,rotate:a};return d};return d}();h.Segment=p;h.default=p})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["require","exports",
"./functions"],function(p,h,d){function a(a,d){var f=Math.max(a.compared.sourceZoom,a.compared.targetZoom);a=a.source.zoomAtPixelsPerPan(a.desiredPixelFlow/a.compared.pan)/2;return a<f?null!=d.maximumDistance?f+(d.maximumDistance-f)/2:1.5*f:d.maximumDistance?Math.min(d.maximumDistance,a):a}Object.defineProperty(h,"__esModule",{value:!0});h.optimalDistance=function(g,f){var k=a(g,f),m={ascensionFactor:null!=f.ascensionFactor?f.ascensionFactor:.5,descensionFactor:null!=f.descensionFactor?f.descensionFactor:
.5},e=0===m.ascensionFactor,b=0===m.descensionFactor,l=e?d.tAscensionZoomOnly:d.tAscensionZoomPan,h=e?d.dtAscensionZoomOnly:d.dtAscensionZoomPan,u=e?d.ddtAscensionZoomOnly:d.ddtAscensionZoomPan,r=b?d.tDescensionZoomOnly:d.tDescensionZoomPan,v=b?d.dtDescensionZoomOnly:d.dtDescensionZoomPan,q=b?d.ddtDescensionZoomOnly:d.ddtDescensionZoomPan,e=function(a){return l(g,m,a)+d.tPanion(g,m,a)+r(g,m,a)},b=function(a){return h(g,m,a)+d.dtPanion(g,m,a)+v(g,m,a)},n=function(a){return u(g,m,a)+d.ddtPanion(g,m,
a)+q(g,m,a)},w=e(k),c=d.tBaseLine(g),x=f.maximumIterations||20,z=null!=f.maximumDistance?f.maximumDistance:Infinity;for(f=0;f<x;f++){var p=(b(k)+1E-6)/n(k);if(isNaN(p)||k>=z&&0>p){if(!isFinite(z))return null;k=z;w=e(k);break}k-=p;if(k<g.compared.sourceZoom||k<g.compared.targetZoom)return null;p=e(k);if(.005>=Math.abs(p-w)/w)break;w=p}return w>.7*c?null:k<g.compared.sourceZoom||k<g.compared.targetZoom?null:k}})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["require","exports"],
function(p,h){Object.defineProperty(h,"__esModule",{value:!0});h.tAscensionZoomPan=function(d,a,g){var f=d.halfWindowPanAtZoom(g-d.compared.sourceZoom);return-d.halfWindowSize*(a.ascensionFactor*Math.LN2*d.compared.pan+f)*Math.log(d.compared.sourceZoom/g)/(d.desiredPixelFlow*Math.LN2*f)};h.dtAscensionZoomPan=function(d,a,g){var f=1/g,k=Math.log(d.compared.sourceZoom*f),m=1/d.desiredPixelFlow,e=1/Math.LN2;g-=d.compared.sourceZoom;var b=1/g;a=(a.ascensionFactor*Math.LN2*d.compared.pan+d.halfWindowPanAtZoom(g))/
d.halfWindowPanAtZoom(1);return d.halfWindowSize*f*m*e*b*a-d.halfWindowSize*k*m*e*b+d.halfWindowSize*k*m*e*a/(g*g)};h.ddtAscensionZoomPan=function(d,a,g){var f=g-d.compared.sourceZoom,k=1/f,m=1/g,e=Math.log(d.compared.sourceZoom*m);a=(a.ascensionFactor*Math.LN2*d.compared.pan+d.halfWindowPanAtZoom(f))/d.halfWindowPanAtZoom(1);return d.halfWindowSize*k*(-2*k*m*a+2*k*e+2*m-2*e*a/(f*f)-a/(g*g))/(d.desiredPixelFlow*Math.LN2)};h.tAscensionZoomOnly=function(d,a,g){return-d.halfWindowSize*Math.log(d.compared.sourceZoom/
g)/(d.desiredPixelFlow*Math.LN2)};h.dtAscensionZoomOnly=function(d,a,g){return d.halfWindowSize/(g*d.desiredPixelFlow*Math.LN2)};h.ddtAscensionZoomOnly=function(d,a,g){return-d.halfWindowSize/(g*g*d.desiredPixelFlow*Math.LN2)};h.tPanion=function(d,a,g){return-d.compared.pan*d.halfWindowSize*(a.ascensionFactor+a.descensionFactor-1)/(d.desiredPixelFlow*d.halfWindowPanAtZoom(g))};h.dtPanion=function(d,a,g){return d.compared.pan*d.halfWindowSize*(a.ascensionFactor+a.descensionFactor-1)/(d.desiredPixelFlow*
d.halfWindowPanAtZoom(g*g))};h.ddtPanion=function(d,a,g){return-2*d.compared.pan*d.halfWindowSize*(a.ascensionFactor+a.descensionFactor-1)/(d.desiredPixelFlow*d.halfWindowPanAtZoom(g*g*g))};h.tDescensionZoomPan=function(d,a,g){return d.halfWindowSize*(-d.halfWindowPanAtZoom(g)-a.descensionFactor*Math.LN2*d.compared.pan+d.halfWindowPanAtZoom(d.compared.targetZoom))*Math.log(g/d.compared.targetZoom)/(d.desiredPixelFlow*Math.LN2*d.halfWindowPanAtZoom(-g+d.compared.targetZoom))};h.dtDescensionZoomPan=
function(d,a,g){var f=Math.log(g/d.compared.targetZoom),k=1/d.desiredPixelFlow,m=1/Math.LN2,e=-g+d.compared.targetZoom,b=1/e;a=(-d.halfWindowPanAtZoom(g)-a.descensionFactor*Math.LN2*d.compared.pan+d.halfWindowPanAtZoom(d.compared.targetZoom))/d.halfWindowPanAtZoom(1);return-d.halfWindowSize*f*k*m*b+d.halfWindowSize*f*k*m*a/(e*e)+d.halfWindowSize*k*m*b*a/g};h.ddtDescensionZoomPan=function(d,a,g){var f=g-d.compared.targetZoom,k=1/f,m=1/g,e=Math.log(g/d.compared.targetZoom);a=(d.halfWindowPanAtZoom(g)+
a.descensionFactor*Math.LN2*d.compared.pan-d.halfWindowPanAtZoom(d.compared.targetZoom))/d.halfWindowPanAtZoom(1);return d.halfWindowSize*k*(-2*k*m*a-2*k*e+2*m+2*e*a/(f*f)-a/(g*g))/(d.desiredPixelFlow*Math.LN2)};h.tDescensionZoomOnly=function(d,a,g){return d.halfWindowSize*Math.log(g/d.compared.targetZoom)/(d.desiredPixelFlow*Math.LN2)};h.dtDescensionZoomOnly=function(d,a,g){return d.halfWindowSize/(g*d.desiredPixelFlow*Math.LN2)};h.ddtDescensionZoomOnly=function(d,a,g){return-d.halfWindowSize/(g*
g*d.desiredPixelFlow*Math.LN2)};h.tBaseLine=function(d){var a=Math.LN2*d.compared.pan,g=d.halfWindowPanAtZoom(d.compared.sourceZoom-d.compared.targetZoom),f=d.halfWindowSize*Math.log(d.compared.sourceZoom/d.compared.targetZoom)/(d.desiredPixelFlow*Math.LN2*g);return d.compared.sourceZoom<=d.compared.targetZoom?f*(a-g):f*(a+g)}})},"esri/views/3d/state/controllers/AnimationController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../ViewAnimation","./CameraController"],
function(p,h,d,a,g){Object.defineProperty(h,"__esModule",{value:!0});p=function(f){function k(d){void 0===d&&(d=new a);var e=f.call(this)||this;e.viewAnimation=d;return e}d(k,f);Object.defineProperty(k.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"asyncResult",{get:function(){return this._asyncResult},set:function(a){this._asyncResult&&this._asyncResult.reject();this._asyncResult=a;if(this.state===g.State.Finished||this.state===g.State.Stopped)this._asyncResult=
null,this.state===g.State.Finished?a.resolve():a.reject()},enumerable:!0,configurable:!0});k.prototype.onControllerStart=function(a){var e=this;f.prototype.onControllerStart.call(this,a);this.viewAnimation&&this.viewAnimation.always(function(){e.updateStateFromViewAnimation()})};k.prototype.updateStateFromViewAnimation=function(){!this.viewAnimation||this.state!==g.State.Ready&&this.state!==g.State.Running||(this.viewAnimation.state===a.State.FINISHED?this.finish():this.viewAnimation.state===a.State.STOPPED&&
(this.state=g.State.Stopped))};k.prototype.onControllerEnd=function(a){this.viewAnimation&&(this.viewAnimation.done||(this.state===g.State.Finished?this.viewAnimation.finish():this.state===g.State.Stopped&&this.viewAnimation.stop()));this._asyncResult&&(this.state===g.State.Finished?this._asyncResult.resolve():this._asyncResult.reject());f.prototype.onControllerEnd.call(this,a)};k.prototype.finish=function(){this.finishController()};return k}(g.CameraController);h.AnimationController=p})},"esri/views/3d/state/controllers/CameraController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators".split(" "),
function(p,h,d,a,g,f){Object.defineProperty(h,"__esModule",{value:!0});var k;(function(a){a.Ready="ready";a.Rejected="rejected";a.Running="running";a.Stopped="stopped";a.Finished="finished"})(k=h.State||(h.State={}));p=function(g){function e(){var a=null!==g&&g.apply(this,arguments)||this;a.state=k.Ready;return a}d(e,g);Object.defineProperty(e.prototype,"active",{get:function(){return this.state===k.Running},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"isInteractive",{get:function(){return!1},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"canStop",{get:function(){return!1},enumerable:!0,configurable:!0});e.prototype.stopController=function(){return this.canStop?(this.state=k.Stopped,!0):!1};e.prototype.finishController=function(){this.state=k.Finished};e.prototype.onControllerStart=function(a){this.state=k.Running};e.prototype.onControllerEnd=function(a){};e.prototype.stepController=function(a,e){};Object.defineProperty(e.prototype,"steppingFinished",{get:function(){return!1},
enumerable:!0,configurable:!0});a([f.property({readOnly:!0,dependsOn:["state"]})],e.prototype,"active",null);a([f.property()],e.prototype,"state",void 0);return e=a([f.subclass()],e)}(f.declared(g));h.CameraController=p})},"esri/views/3d/state/utils/navigationUtils":function(){define(["require","exports","../../lib/glMatrix","./primitiveIntersectionUtils","../../support/mathUtils"],function(p,h,d,a,g){function f(c,e,d,f,g){void 0===g&&(g=!1);var l=y;a.createRay(e,d,l,g);return a.intersectSphere(c,
l,f)?!0:(b(c,l,f),!1)}function k(c,b,e,d){var f=y;a.createRay(b,e,f,!0);return a.intersectSphere(c,f,d)}function m(a,c,b){d.vec3d.cross(a,c,b);a=d.vec3d.dot(a,c)/(d.vec3d.length(a)*d.vec3d.length(c));return-g.acos(a)}function e(a,c,b,e){var f=w;d.mat4d.identity(f);d.mat4d.rotate(f,e,b);d.vec3d.subtract(a.eye,c);d.mat4d.multiplyVec3(f,a.eye,a.eye);d.vec3d.add(a.eye,c);d.vec3d.subtract(a.center,c);d.mat4d.multiplyVec3(f,a.center,a.center);d.vec3d.add(a.center,c);d.mat4d.multiplyVec3(f,a.up,a.up);a.markViewDirty()}
function b(a,c,b){var e=x,f=z,l=n;d.vec3d.subtract(c.origin,a.center,f);d.vec3d.cross(f,c.direction,e);d.vec3d.cross(e,f,b);d.vec3d.scale(b,1/d.vec3d.length(b)*a.radius);a=-g.asin(a.radius/d.vec3d.length(c.origin));d.mat4d.identity(l);d.mat4d.rotate(l,a,e);d.mat4d.multiplyVec3(l,b)}function l(a,c){d.vec3d.set3(0,0,0,c);for(var b=0;b<a.length;b++)d.vec3d.add(c,a[b]);d.vec3d.scale(c,1/a.length)}Object.defineProperty(h,"__esModule",{value:!0});h.Earth={center:d.vec3d.create(),radius:6378137};h.normalizeCoordinate=
function(a,c,b){b[0]=c[0]/a.fullWidth;b[1]=c[1]/a.fullHeight;return b};h.sphereOrSilhouettePointFromScreenPoint=f;h.intersectSphereFromScreenPoint=k;h.rotationAndAxisFromPoints=m;h.rotationFromPointsAroundAxis=function(a,c,b){var e=x,f=z,g=A;d.vec3d.set(a,f);d.vec3d.set(c,g);a=d.vec3d.dot(f,b);c=d.vec3d.dot(g,b);d.vec3d.scale(b,a,e);d.vec3d.subtract(f,e);d.vec3d.normalize(f);d.vec3d.scale(b,c,e);d.vec3d.subtract(g,e);d.vec3d.normalize(g);a=d.vec3d.dot(f,g);d.vec3d.cross(b,f,e);b=d.vec3d.dot(g,e);
return Math.atan2(b,a)};h.setPlane=function(a,c,b){d.vec3d.set(c,b.normal);b.d=-d.vec3d.dot(c,a)};h.setPlaneD=function(a,c){c.d=-d.vec3d.dot(c.normal,a)};h.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;return a};h.applyRotation=e;h.closestPointOnSphereSilhouette=b;h.intersectPlaneFromScreenPoint=function(c,b,e,d){var f=y;a.createRay(b,e,f);return a.intersectPlane(c,f,d)};h.applyZoomToPoint=function(a,b,e,f){var g=c;e=1-e;d.vec3d.subtract(b,a.eye,g);
var l=d.vec3d.length(g),k=l*(1-e);0<=e&&k<f&&(k=f,e=-(k-l)/l);1E-6>Math.abs(l-k)||(d.vec3d.scale(g,e),d.vec3d.add(a.eye,g),d.vec3d.lerp(a.center,b,e))};h.applyZoomOnSphere=function(a,b,e){d.vec2d.set2(b.padding[3]+b.width/2,b.padding[2]+b.height/2,t);k(a,b,t,b.center);d.vec3d.subtract(b.center,b.eye,c);a=d.vec3d.length(c);1E-6>Math.abs(a-a*e)||(d.vec3d.scale(c,e),d.vec3d.subtract(b.center,c,b.eye),b.markViewDirty())};var t=d.vec2d.create();h.navPointToScreenPoint=function(a,c,b){d.vec2d.set2(c.x,
a.fullHeight-c.y,b)};h.centroidOnSphere=function(a,c,b){l(c,b);d.vec3d.normalize(b);d.vec3d.scale(b,a)};h.centroid=l;var u;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(u=h.PanMode||(h.PanMode={}));h.VerticalPanTresholds={Elevation:3E4,Angle:8/180*Math.PI};h.pickPointAndInitSphere=function(a,c,b,e){var g=d.vec3d.create(),l={center:d.vec3d.create(),radius:0},n=!0;a.pickPointInScreen(b,g)?l.radius=d.vec3d.length(g):(l.radius=d.vec3d.length(c.center),l.radius<.9*h.Earth.radius&&
(l.radius=h.Earth.radius),l.radius=Math.max(d.vec3d.length(c.center),.9*h.Earth.radius),e?f(l,c,b,g):n=k(l,c,b,g));return{sphere:l,scenePickPoint:n?g:null}};h.decidePanMode=function(a,c,b){if(d.vec3d.length(a.eye)-h.Earth.radius<h.VerticalPanTresholds.Elevation){if(c.radius>d.vec3d.length(a.eye))return u.Vertical;d.vec3d.normalize(d.vec3d.subtract(a.eye,b,r));return Math.abs(.5*Math.PI-Math.acos(d.vec3d.dot(b,r)/d.vec3d.length(b)))<h.VerticalPanTresholds.Angle?u.Vertical:u.Horizontal}return u.Horizontal};
var r=d.vec3d.create();h.applyPanPlanar=function(a,c,b){d.vec3d.subtract(b,c,v);d.vec3d.subtract(a.eye,v);d.vec3d.subtract(a.center,v);a.markViewDirty()};var v=d.vec3d.create();h.applyPanSpherical=function(a,c,b,d){b=m(b,d,q);e(c,a.center,q,b)};var q=d.vec3d.create(),n=d.mat4d.create(),w=d.mat4d.create(),c=d.vec3d.create(),x=d.vec3d.create(),z=d.vec3d.create(),A=d.vec3d.create(),y={origin:d.vec3d.create(),direction:d.vec3d.create()}})},"esri/views/3d/state/utils/primitiveIntersectionUtils":function(){define(["require",
"exports","../../lib/glMatrix"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});h.createRay=function(f,g,m,e){void 0===e&&(e=!1);d.vec3d.set3(g[0],g[1],0,a);e?d.vec3d.set(f.eye,m.origin):d.vec3d.unproject(a,f.viewMatrix,f.projectionMatrix,f.fullViewport,m.origin);a[2]=1;d.vec3d.unproject(a,f.viewMatrix,f.projectionMatrix,f.fullViewport,m.direction);d.vec3d.subtract(m.direction,m.origin,m.direction);d.vec3d.normalize(m.direction)};h.intersectSphere=function(a,k,m){var e=d.vec3d.subtract(k.origin,
a.center,g),b=d.vec3d.dot(k.direction,k.direction),f=2*d.vec3d.dot(k.direction,e);a=d.vec3d.dot(e,e)-a.radius*a.radius;a=f*f-4*b*a;if(0>a)return!1;e=Math.sqrt(a);a=(-f-e)/(2*b);b=(-f+e)/(2*b);if(0>a||b<a&&0<b)a=b;return 0<a?(d.vec3d.add(k.origin,d.vec3d.scale(k.direction,a,m),m),!0):!1};h.intersectPlane=function(a,g,m){var e=d.vec3d.dot(a.normal,g.direction);if(0===e)return!1;a=-(d.vec3d.dot(a.normal,g.origin)+a.d)/e;if(0>a)return!1;d.vec3d.add(g.origin,d.vec3d.scale(g.direction,a,m),m);return!0};
var a=d.vec3d.create(),g=d.vec3d.create()})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),function(p,h,d,a,g,f,k,m){Object.defineProperty(h,"__esModule",{value:!0});p=function(e){function b(a,b,d){b=e.call(this,a.state,b,"interaction"===d?null:void 0)||
this;b.view=a;b.mode=d;b.zoomLocation=g.vec3d.create();b.tmpCamera=new k;b.tmpRayDir=g.vec3d.create();b.tmpCenter=g.vec3d.create();b.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new k,interactionDirection:null};return b}d(b,e);Object.defineProperty(b.prototype,"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});b.prototype.zoomStep=function(a,b){if(this.active){var e=this.view.state,d=this.constraintOptions.interactionStartCamera;
this.animation.finished?d.copyFrom(e.camera):this.animation.cameraAt(1,d);this.tmpCamera.copyFrom(e.camera);0<a?(this.pickingHelper.pickPointInScreen(b,this.zoomLocation)||this.pickingHelper.pickFreePointInScreen(b,this.zoomLocation),this.pickingHelper.pickRaySegment(this.tmpCamera.eye,this.tmpCamera.center,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.pickingHelper.pickRaySegment(this.tmpCamera.eye,this.tmpCamera.center,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:g.vec3d.set(this.tmpCamera.center,
this.zoomLocation);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,b);this.begin(this.tmpCamera)}};b.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:m.outExpo}};b.prototype.updateCamera=function(b,e,d,f){g.vec3d.subtract(d,b.eye,this.tmpRayDir);f=g.vec3d.length(this.tmpRayDir);var l=f*e;1>=e&&4>l&&(l=4,e=l/f);1E-6>Math.abs(f-l)||(g.vec3d.scale(this.tmpRayDir,e),g.vec3d.subtract(d,this.tmpRayDir,b.eye),g.vec3d.lerp(b.center,d,1-e),a.applyAll(this.view,this.tmpCamera,
this.constraintOptions))};return b}(f.PointToPointAnimationController);h.ZoomStepController=p})},"esri/views/3d/state/helpers/PickingHelper":function(){define(["require","exports","../../camera/intersectionUtils","../../lib/glMatrix","../../webgl-engine/lib/Selector"],function(p,h,d,a,g){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function f(d){this.view=d;this.tmpR0=a.vec3d.create();this.tmpR1=a.vec3d.create();this.tmpSelector=new g(this.view.viewingMode)}f.prototype.pickPointInScreen=
function(a,d){return this.pickedIntersectionPoint(this.pickInScreen(a,!1),d)};f.prototype.pickFreePointFromSegment=function(f,g,e){a.vec3d.set(f,this.tmpR0);a.vec3d.set(g,this.tmpR1);a.vec3d.subtract(this.tmpR1,this.tmpR0);a.vec3d.normalize(this.tmpR1);var b=this.view.dataExtent;f=Math.max(b.xmax-b.xmin,b.ymax-b.ymin,8*Math.max(b.xmax-b.xmin,b.ymax-b.ymin));g=this.view.state.camera;var l=Math.max(0,b.xmin-g.eye[0],g.eye[0]-b.xmax),b=Math.max(0,b.ymin-g.eye[1],g.eye[1]-b.ymax),l=Math.sqrt(l*l+b*b),
b=this.view.renderCoordsHelper.getAltitude(g.eye);g=d.surfaceElevationBelowEye(this.view,g);g=f/Math.max(1,Math.pow(Math.max(0,Math.log(f/(Math.abs(b-g)+Number.MIN_VALUE))),2));g=Math.max(g,Math.min(l,f));a.vec3d.scale(this.tmpR1,g);a.vec3d.add(this.tmpR0,this.tmpR1,e)};f.prototype.pickFreePointInScreen=function(a,d){this.view._pickRayWithBeginPoint(a,void 0,this.view.state.camera.viewMatrix,this.tmpR0,this.tmpR1);this.pickFreePointFromSegment(this.tmpR0,this.tmpR1,d)};f.prototype.pickRaySegment=
function(a,d,e){return this.pickedIntersectionPoint(this.view._pickRay(a,d,null,null,null,null,this.tmpSelector),e)};f.prototype.pickInScreen=function(d,f){this.view._pickRayWithBeginPoint(d,void 0,this.view.state.camera.viewMatrix,this.tmpR0,this.tmpR1);f&&a.vec3d.set(this.view.state.camera.eye,this.tmpR0);return this.view._pickRay(this.tmpR0,this.tmpR1,d,d,null,null,this.tmpSelector)};f.prototype.pickedIntersectionPoint=function(a,d){return a?a.getMinResult().getIntersectionPoint(d):!1};return f}();
h.PickingHelper=p})},"esri/views/input/InputHandler":function(){define(["require","exports","../../core/Logger","./EventMatch"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});var g=d.getLogger("esri.views.input.InputHandler");p=function(){function d(a){this._manager=null;this._incoming={};this._outgoing={};this._outgoingEventTypes=this._incomingEventTypes=this._incomingEventMatches=null;this._hasSideEffects=a}Object.defineProperty(d.prototype,"incomingEventMatches",{get:function(){if(!this._incomingEventMatches){this._incomingEventMatches=
[];for(var a in this._incoming)for(var b=0,d=this._incoming[a];b<d.length;b++)this._incomingEventMatches.push(d[b].match)}return this._incomingEventMatches},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"incomingEventTypes",{get:function(){this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(function(a){return a.eventType}));return this._incomingEventTypes},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"outgoingEventTypes",{get:function(){this._outgoingEventTypes||
(this._outgoingEventTypes=Object.keys(this._outgoing));return this._outgoingEventTypes},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"hasSideEffects",{get:function(){return this._hasSideEffects},enumerable:!0,configurable:!0});d.prototype.onInstall=function(a){var b=this;this._manager?g.error("This InputHandler has already been registered with an InputManager"):(a.setEventCallback(function(a){return b._handleEvent(a)}),a.setUninstallCallback(function(){return b._onUninstall()}),
this._manager=a)};d.prototype.onUninstall=function(){};d.prototype.registerIncoming=function(e,b,d){var g=this;"function"===typeof b?(d=b,b=[]):b=b||[];e="string"===typeof e?new a.EventMatch(e,b):e;var l=function(){g._incomingEventTypes=null;g._incomingEventMatches=null};b=function(a){var b=g._incoming[a.match.eventType];b&&(a=b.indexOf(a),b.splice(a,1),l(),g._manager&&g._manager.updateDependencies())};d=new f(e,d,{onPause:b,onRemove:b,onResume:function(a){var b=g._incoming[a.match.eventType];b&&
-1===b.indexOf(a)&&(b.push(a),l(),g._manager&&g._manager.updateDependencies())}});b=this._incoming[e.eventType];b||(b=[],this._incoming[e.eventType]=b);b.push(d);l();this._manager&&this._manager.updateDependencies();return d};d.prototype.registerOutgoing=function(a){var b=this;if(this._outgoing[a])throw Error("There is already a callback registered for this outgoing InputEvent: "+a);var e=new k(a,{onEmit:function(a,e,d,f){b._manager.emit(a.eventType,e,d,f)},onRemove:function(a){delete b._outgoing[a.eventType];
b._manager.updateDependencies()}});this._outgoing[a]=e;this._outgoingEventTypes=null;this._manager&&this._manager.updateDependencies();return e};d.prototype.startCapturingPointer=function(a){this._manager.setPointerCapture(a,!0)};d.prototype.stopCapturingPointer=function(a){this._manager.setPointerCapture(a,!1)};d.prototype._onUninstall=function(){this._manager?(this.onUninstall(),this._manager=null):g.error("This InputHandler is not registered with an InputManager")};d.prototype._handleEvent=function(a){var b=
this._incoming[a.type];if(b)for(var e=0;e<b.length;e++){var d=b[e];if(d.match.matches(a)&&(d.callback(a),a.shouldStopPropagation()))break}};return d}();h.InputHandler=p;var f=function(){function a(a,b,d){this.match=a;this._callback=b;this._handler=d}a.prototype.pause=function(){this._handler.onPause(this)};a.prototype.resume=function(){this._handler.onResume(this)};a.prototype.remove=function(){this._handler.onRemove(this)};Object.defineProperty(a.prototype,"callback",{get:function(){return this._callback},
enumerable:!0,configurable:!0});return a}(),k=function(){function a(a,b){this.eventType=a;this._removed=!1;this._handler=b}a.prototype.emit=function(a,b,d){if(!this._removed)this._handler.onEmit(this,a,b,d)};a.prototype.remove=function(){this._removed=!0;this._handler.onRemove(this)};return a}()})},"esri/views/input/EventMatch":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function d(a,d){void 0===d&&(d=[]);this.eventType=a;this.keyModifiers=
d}d.prototype.matches=function(a){if(a.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;a=a.modifiers;for(var d=0,f=this.keyModifiers;d<f.length;d++)if(!a.has(f[d]))return!1;return!0};return d}();h.EventMatch=p})},"esri/views/input/handlers/support":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});h.eventMatchesPointerAction=function(d,a){switch(a){case "primary":return"touch"===d.pointerType||0===d.button;case "secondary":return"touch"!==
d.pointerType&&2===d.button;case "tertiary":return"touch"!==d.pointerType&&1===d.button}};h.eventMatchesMousePointerAction=function(d,a){if("touch"===d.pointerType)return!1;switch(a){case "primary":return 0===d.button;case "secondary":return 2===d.button;case "tertiary":return 1===d.button}}})},"esri/views/3d/input/handlers/DragRotate":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/RotateController ../../state/helpers/PickingHelper ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(p,h,d,a,g,f,k){Object.defineProperty(h,"__esModule",{value:!0});p=function(f){function e(a,e,d,k){var b=f.call(this,!0)||this;b.view=a;b.pointerAction=e;b.pivotPoint=d;b.pickingHelper=new g.PickingHelper(a);b.registerIncoming("drag",k,function(a){return b.handleDrag(a)});return b}d(e,f);e.prototype.handleDrag=function(b){var e=b.data;if(!(1<e.pointers.size)&&k.eventMatchesMousePointerAction(b.data,this.pointerAction)){var d=[e.center.x,this.view.height-e.center.y];switch(e.action){case "start":this.cameraController=
new a.RotateController(this.view,this.pickingHelper,this.pivotPoint);this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":this.cameraController.update(d);break;case "end":this.cameraController.end(),this.cameraController=null}b.stopPropagation()}};return e}(f.InputHandler);h.DragRotate=p})},"esri/views/3d/state/controllers/RotateController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../camera/constraintUtils ../../lib/glMatrix ../../state/Constraints ./InteractiveController ../../state/utils/navigationUtils ../../support/mathUtils".split(" "),
function(p,h,d,a,g,f,k,m,e){Object.defineProperty(h,"__esModule",{value:!0});p=function(b){function l(a,e,d){var f=b.call(this)||this;f.view=a;f.pickingHelper=e;f.pivot=d;f.lastPoint=g.vec2d.create();f.tmpWorldUp=g.vec3d.create();f.tmpViewDir=g.vec3d.create();f.tmpRotCurPoint=g.vec2d.create();f.tmpTransf=g.mat4d.create();f.tmpAxis=g.vec3d.create();f.pivotPos=g.vec3d.create();f.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null};
f.rotScale="center"===d?3:1.5;return f}d(l,b);l.prototype.begin=function(a){if(this.active){switch(this.pivot){case "eye":g.vec3d.set(this.beginCamera.eye,this.pivotPos);this.constraintOptions.interactionType=3;this.constraintOptions.selection=0;break;case "center":this.pickingHelper.pickRaySegment(this.beginCamera.eye,this.beginCamera.center,this.pivotPos)||(this.view.state.isLocal?this.pickingHelper.pickFreePointFromSegment(this.beginCamera.eye,this.beginCamera.center,this.pivotPos):g.vec3d.set(this.beginCamera.center,
this.pivotPos)),this.beginCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;m.normalizeCoordinate(this.beginCamera,a,this.lastPoint)}};l.prototype.update=function(b){if(this.active){var e;switch(this.pivot){case "eye":e=this.currentCamera.center;break;case "center":this.currentCamera.center=this.pivotPos,e=this.currentCamera.eye}this.applyRotation(this.currentCamera,b,e,this.pivotPos);
a.applyAll(this.view,this.currentCamera,this.constraintOptions)}};l.prototype.end=function(){this.active&&this.finishController()};l.prototype.applyRotation=function(a,b,d,l){this.view.renderCoordsHelper.worldUpAtPosition(l,this.tmpWorldUp);m.normalizeCoordinate(a,b,this.tmpRotCurPoint);b=(this.tmpRotCurPoint[1]-this.lastPoint[1])*this.rotScale;var k=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;g.vec3d.subtract(d,l,this.tmpViewDir);var n=g.vec3d.length(this.tmpViewDir),n=e.acos(g.vec3d.dot(this.tmpViewDir,
this.tmpWorldUp)/n);if("eye"===this.pivot){var h=.5*Math.PI-n,c=.495*Math.PI;b=h-Math.max(-c,Math.min(c,h+-.5*b))}b=e.clamp(b+n,f.TiltDefault.min,f.TiltDefault.max)-n;g.mat4d.identity(this.tmpTransf);g.vec3d.cross(a.up,this.tmpViewDir,this.tmpAxis);"center"===this.pivot&&(k=-k);g.mat4d.rotate(this.tmpTransf,k,this.tmpWorldUp);g.mat4d.rotate(this.tmpTransf,b,this.tmpAxis);g.mat4d.multiplyVec3(this.tmpTransf,this.tmpViewDir);g.vec3d.add(l,this.tmpViewDir,d);g.mat4d.multiplyVec3(this.tmpTransf,a.up);
g.vec2d.set(this.tmpRotCurPoint,this.lastPoint);a.markViewDirty()};return l}(k.InteractiveController);h.RotateController=p})},"esri/views/3d/state/controllers/InteractiveController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./CameraController","../../webgl-engine/lib/Camera"],function(p,h,d,a,g){Object.defineProperty(h,"__esModule",{value:!0});p=function(a){function f(){var d=null!==a&&a.apply(this,arguments)||this;d.beginCamera=new g;d.currentCamera=new g;
return d}d(f,a);Object.defineProperty(f.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});f.prototype.stepController=function(d,e){a.prototype.stepController.call(this,d,e);e.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(e)};f.prototype.onControllerStart=function(d){a.prototype.onControllerStart.call(this,d);this.beginCamera.copyFrom(d);this.currentCamera.copyFrom(d)};f.prototype.onControllerEnd=function(d){d.copyViewFrom(this.currentCamera);a.prototype.onControllerEnd.call(this,
d)};return f}(a.CameraController);h.InteractiveController=p})},"esri/views/3d/input/handlers/DragZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../state/helpers/PickingHelper ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(p,h,d,a,g,f,k,m){Object.defineProperty(h,"__esModule",{value:!0});p=function(e){function b(a,b,d){var g=e.call(this,
!0)||this;g.view=a;g.pointerAction=b;g.pickingHelper=new f.PickingHelper(a);g.registerIncoming("drag",d,function(a){return g.handleDrag(a)});return g}d(b,e);b.prototype.handleDrag=function(b){var e=b.data;if(!(1<e.pointers.size)&&m.eventMatchesMousePointerAction(b.data,this.pointerAction)){var d=[e.center.x,this.view.height-e.center.y];switch(e.action){case "start":this.cameraController=this.view.state.isGlobal?new a.ZoomController(this.view,this.pickingHelper):new g.ZoomController(this.view,this.pickingHelper);
this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":this.cameraController.update(d);break;case "end":this.cameraController.end(),this.cameraController=null}b.stopPropagation()}};return b}(k.InputHandler);h.DragZoom=p})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ../InteractiveController ../../utils/navigationUtils".split(" "),
function(p,h,d,a,g,f,k){Object.defineProperty(h,"__esModule",{value:!0});p=function(f){function e(a,e){var b=f.call(this)||this;b.view=a;b.pickingHelper=e;b.pickPoint=g.vec3d.create();b.tmpP0=g.vec3d.create();b.panAxis=g.vec3d.create();b.tmpRayDir=g.vec3d.create();b.targetOnSphere=g.vec3d.create();b.dragBeginPoint=g.vec2d.create();b.normalizedAnchorPoint=g.vec2d.create();b.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null};b.sphere=
{center:g.vec3d.create(),radius:0};b.hasPickPoint=!1;return b}d(e,f);e.prototype.begin=function(a){this.active&&(g.vec2d.set(a,this.dragBeginPoint),k.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),a=k.pickPointAndInitSphere(this.pickingHelper,this.beginCamera,a,!1),this.hasPickPoint=!!a.scenePickPoint,this.pickPoint=a.scenePickPoint,this.sphere=a.sphere,this.constraintOptions.interactionStartCamera=this.beginCamera)};e.prototype.update=function(b){if(this.active){this.currentCamera.eye=
this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;g.vec3d.subtract(this.currentCamera.center,this.currentCamera.eye,this.tmpRayDir);var e=g.vec3d.length(this.tmpRayDir);k.normalizeCoordinate(this.currentCamera,b,this.tmpP0);var d=12*(this.tmpP0[1]-this.normalizedAnchorPoint[1]),f=e*Math.pow(2,d),m=this.view.state.constraints.minimumPoiDistance;0>d&&f<m&&(f=m);1E-6>Math.abs(e-f)||(this.hasPickPoint&&f<e&&(d=1-(1-f/e)*(1-this.sphere.radius/
g.vec3d.length(this.currentCamera.center)),g.vec3d.scale(this.currentCamera.center,d)),g.vec3d.scale(this.tmpRayDir,-f/e),g.vec3d.add(this.currentCamera.center,this.tmpRayDir,this.currentCamera.eye),this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.dragBeginPoint,b),a.applyAll(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(k.sphereOrSilhouettePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere,!0),b=k.rotationAndAxisFromPoints(this.pickPoint,
this.targetOnSphere,this.panAxis),k.applyRotation(this.currentCamera,this.sphere.center,this.panAxis,b)),a.applySurfaceCollision(this.view,this.currentCamera))}};e.prototype.end=function(){this.active&&this.finishController()};return e}(f.InteractiveController);h.ZoomController=p})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ../InteractiveController ../../utils/navigationUtils ../../../support/mathUtils".split(" "),
function(p,h,d,a,g,f,k,m){Object.defineProperty(h,"__esModule",{value:!0});p=function(e){function b(a,b){var d=e.call(this)||this;d.view=a;d.pickingHelper=b;d.tmpP=g.vec3d.create();d.tmpN=g.vec3d.create();d.tmpP0=g.vec3d.create();d.tmpPoi=g.vec3d.create();d.tmpRayDir=g.vec3d.create();d.dragBeginPoint=g.vec2d.create();d.normalizedAnchorPoint=g.vec2d.create();d.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:g.vec3d.create()};d.plane=
{normal:g.vec3d.create(),d:0};return d}d(b,e);b.prototype.begin=function(a){this.active&&(g.vec2d.set(a,this.dragBeginPoint),k.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),this.pickingHelper.pickPointInScreen(a,this.tmpP)||this.pickingHelper.pickFreePointInScreen(a,this.tmpP),g.vec3d.normalize(g.vec3d.subtract(this.beginCamera.eye,this.beginCamera.center,this.tmpN)),0>this.tmpN[1]&&g.vec3d.negate(this.tmpN),k.setPlane(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=
this.beginCamera)};b.prototype.update=function(b){if(this.active){k.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||g.vec3d.set(this.currentCamera.center,this.tmpPoi);k.normalizeCoordinate(this.currentCamera,b,this.tmpP0);var e=4*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);g.vec2d.set(this.tmpP0,this.normalizedAnchorPoint);g.vec3d.subtract(this.tmpPoi,this.currentCamera.eye,this.tmpRayDir);var d=g.vec3d.length(this.tmpRayDir),f=d*(1-e);g.vec3d.set(this.tmpRayDir,
this.constraintOptions.interactionDirection);g.vec3d.scale(this.constraintOptions.interactionDirection,m.sign(e)/d);var l=this.view.state.constraints.minimumPoiDistance;0<=e&&f<l&&(f=l,e=-(f-d)/d);1E-6>Math.abs(d-f)||(g.vec3d.scale(this.tmpRayDir,e),g.vec3d.add(this.currentCamera.eye,this.tmpRayDir),g.vec3d.lerp(this.currentCamera.center,this.tmpPoi,e),this.currentCamera.center[2]=this.tmpPoi[2]>this.beginCamera.center[2]?Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):Math.min(this.beginCamera.center[2],
this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.dragBeginPoint,b),a.applyAll(this.view,this.currentCamera,this.constraintOptions))}};b.prototype.end=function(){this.active&&this.finishController()};return b}(f.InteractiveController);h.ZoomController=p})},"esri/views/3d/input/handlers/KeyPan":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../state/controllers/global/PanContinuousController",
"../../../input/InputHandler"],function(p,h,d,a,g){Object.defineProperty(h,"__esModule",{value:!0});p=function(f){function g(d,e,b){var g=f.call(this,!0)||this;g.view=d;g.keyToDirection=(k={},k[e.left]=a.Direction.LEFT,k[e.right]=a.Direction.RIGHT,k[e.forward]=a.Direction.FORWARD,k[e.backward]=a.Direction.BACKWARD,k[e.up]=a.Direction.UP,k[e.down]=a.Direction.DOWN,k);d.state.isGlobal&&(g.registerIncoming("key-down",b,function(a){return g.handleKeyDown(a)}),g.registerIncoming("key-up",b,function(a){return g.handleKeyUp(a)}));
return g;var k}d(g,f);g.prototype.handleKeyDown=function(d){if(!d.data.repeat){var e=this.keyToDirection[d.data.key];null!=e&&(this.cameraController&&this.cameraController.active||(this.cameraController=new a.PanContinuousController(this.view),this.view.state.switchCameraController(this.cameraController)),this.cameraController.active&&this.handleKey(d,e,!0))}};g.prototype.handleKeyUp=function(a){var e=this.keyToDirection[a.data.key];null!=e&&this.cameraController&&this.cameraController.active&&this.handleKey(a,
e,!1)};g.prototype.handleKey=function(a,e,b){b?this.cameraController.addDirection(e):this.cameraController.removeDirection(e);a.stopPropagation()};return g}(g.InputHandler);h.KeyPan=p})},"esri/views/3d/state/controllers/global/PanContinuousController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ../CameraController ../../../support/earthUtils ../../../support/mathUtils".split(" "),function(p,h,d,a,g,f,k,m){Object.defineProperty(h,
"__esModule",{value:!0});h.Direction={LEFT:1,RIGHT:2,FORWARD:4,BACKWARD:8,UP:16,DOWN:32};var e=g.vec3d,b=g.mat4d;p=function(f){function g(a){var d=f.call(this)||this;d.view=a;d.directionStatus=0;d.direction=e.create();d.tmpAxis=e.create();d.radiusChange=0;d.velocity=0;d.tmpP1=e.create();d.tmpTransf=b.create();return d}d(g,f);Object.defineProperty(g.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});g.prototype.addDirection=function(a){0===this.directionStatus&&e.set3(0,
0,0,this.direction);this.directionStatus&a||(this.directionStatus|=a,a&(h.Direction.LEFT|h.Direction.RIGHT|h.Direction.FORWARD|h.Direction.BACKWARD)?(this.computePanAxis(a,this.tmpAxis),e.add(this.direction,this.tmpAxis)):(a=this.directionStatus&(h.Direction.UP|h.Direction.DOWN),this.radiusChange=a===h.Direction.UP?1:a===h.Direction.DOWN?-1:0),this.velocity=this.computePanVelocity())};g.prototype.removeDirection=function(a){this.directionStatus&=~a;0===this.directionStatus&&this.active?this.finishController():
a&(h.Direction.LEFT|h.Direction.RIGHT|h.Direction.FORWARD|h.Direction.BACKWARD)?(this.computePanAxis(a,this.tmpAxis),e.subtract(this.direction,this.tmpAxis),.01>e.length(this.direction)&&e.set3(0,0,0,this.direction)):(a=this.directionStatus&(h.Direction.UP|h.Direction.DOWN),this.radiusChange=a===h.Direction.UP?1:a===h.Direction.DOWN?-1:0)};g.prototype.stepController=function(d,g){f.prototype.stepController.call(this,d,g);d*=this.velocity;var k=!1;if(0<Math.abs(this.radiusChange)){var k=1+d*this.radiusChange,
l=g.viewForward,n=e.normalize(g.center,this.tmpP1);(-.999<e.dot(l,n)||0>this.radiusChange)&&e.scale(g.center,k);e.scale(g.eye,k);this.velocity=this.computePanVelocity();k=!0}.01<e.length2(this.direction)&&(b.identity(this.tmpTransf),b.rotate(this.tmpTransf,d,this.direction),b.multiplyVec3(this.tmpTransf,g.eye),b.multiplyVec3(this.tmpTransf,g.center),b.multiplyVec3(this.tmpTransf,g.up),k=!0);k&&a.applyAll(this.view,g,{selection:14,interactionType:4,interactionStartCamera:this.view.state.camera,interactionFactor:null,
interactionDirection:null})};g.prototype.computePanAxis=function(a,b){var d=this.view.state.camera;e.subtract(d.center,d.eye,b);e.cross(b,d.up);if(a===h.Direction.LEFT||a===h.Direction.RIGHT)e.normalize(b),e.cross(b,d.center);a!==h.Direction.RIGHT&&a!==h.Direction.FORWARD||e.negate(b);e.normalize(b)};g.prototype.computePanVelocity=function(){var a=.5*Math.abs(e.length(this.view.state.camera.eye)-k.earthRadius),a=m.clamp(a,1,2*k.earthRadius);return m.acos(1-a*a/(2*k.earthRadius*k.earthRadius))};return g}(f.CameraController);
h.PanContinuousController=p})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../state/helpers/PickingHelper ../../../input/InputHandler".split(" "),function(p,h,d,a,g,f,k){Object.defineProperty(h,"__esModule",{value:!0});p=function(k){function e(a,e){var b=k.call(this,!0)||this;b.view=a;b.pickingHelper=new f.PickingHelper(a);
b.registerIncoming("mouse-wheel",e,function(a){return b.handleMouseWheel(a)});return b}d(e,k);e.prototype.handleMouseWheel=function(b){var e=b.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new a.ZoomStepController(this.view,this.pickingHelper,"interaction"):new g.ZoomStepController(this.view,this.pickingHelper,"interaction"),this.view.state.switchCameraController(this.cameraController));this.cameraController.zoomStep(-1/60*e.deltaY,[e.x,
this.view.height-e.y]);b.stopPropagation()};return e}(k.InputHandler);h.MouseWheelZoom=p})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../state/helpers/PickingHelper ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(p,h,d,a,g,f,k,m){Object.defineProperty(h,"__esModule",{value:!0});
p=function(e){function b(a,b,d){var g=e.call(this,!0)||this;g.view=a;g.pointerAction=b;g.lastEndTimestamp=0;g.lastTimestamp=0;g.pickingHelper=new f.PickingHelper(a);g.registerIncoming("drag",d,function(a){return g.handleDrag(a)});return g}d(b,e);b.prototype.handleDrag=function(a){if("mouse"!==a.data.pointerType||m.eventMatchesMousePointerAction(a.data,this.pointerAction)){var b=a.timestamp-this.lastEndTimestamp,b=this.momentum&&this.momentum.active&&40>b;switch(a.data.action){case "start":case "update":if(b)break;
this.controller&&this.controller.active?2<a.data.timestamp-this.lastTimestamp&&(this.controller.update(a.data),this.lastTimestamp=a.timestamp):this.startController(a);break;case "end":case "removed":this.endController(a,!0);break;case "added":this.endController(a,!1),this.startController(a)}a.stopPropagation()}};b.prototype.endController=function(a,b){this.controller&&this.controller.active&&(this.lastEndTimestamp=a.timestamp,a=this.controller.end(a.data),b&&a&&(this.momentum=a,this.view.state.switchCameraController(this.momentum)));
this.controller=null};b.prototype.startController=function(a){this.controller=this.createController();this.view.state.switchCameraController(this.controller);this.controller.begin(a.data);this.lastTimestamp=a.timestamp};b.prototype.createController=function(){return this.view.state.isGlobal?new a.PinchAndPanController(this.view,this.pickingHelper):new g.PinchAndPanController(this.view,this.pickingHelper)};return b}(k.InputHandler);h.PinchAndPanNavigation=p})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../input/util ../../../lib/glMatrix ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c){Object.defineProperty(h,"__esModule",{value:!0});p=function(k){function h(a,b){var e=k.call(this)||this;e.view=a;e.pickingHelper=b;e.smoothRotation=new g.ExponentialFalloff(.05);e.rotationAxis=f.vec3d.create();e.panningPlane={normal:f.vec3d.create(),d:0};e.smoothScaling=new g.ExponentialFalloff(.05);e.zoomCenterScreen=f.vec2d.create();e.zoomMomentumEstimator=new c.ZoomMomentumEstimator;e.rotationMomentumEstimator=new w.RotationMomentumEstimator;e.panSphericalMomentumEstimator=
new n.PanSphericalMomentumEstimator;e.panPlanarMomentumEstimator=new q.PanPlanarMomentumEstimator;e.adjustedSphere={center:f.vec3d.create(),radius:0};e.tmp2d=f.vec2d.create();e.tmp3d=f.vec3d.create();e.beginScreenPoint=f.vec2d.create();e.beginScenePoint=f.vec3d.create();e.screenPickPoint=f.vec2d.create();e.panMode=r.PanMode.Horizontal;e.tmpInteractionDirection=f.vec3d.create();e.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new v,interactionDirection:null};
return e}d(h,k);h.prototype.begin=function(a){if(this.active){this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.smoothRotation.reset();u.navPointToScreenPoint(this.currentCamera,a.center,this.screenPickPoint);f.vec2d.set(this.screenPickPoint,this.beginScreenPoint);var c=u.pickPointAndInitSphere(this.pickingHelper,this.beginCamera,this.screenPickPoint,!0);this.scenePickPoint=c.scenePickPoint;this.sphere=c.sphere;f.vec3d.set(this.scenePickPoint,this.beginScenePoint);
this.panMode=u.decidePanMode(this.beginCamera,this.sphere,this.scenePickPoint);if(this.panMode===r.PanMode.Vertical){f.vec3d.set(this.beginCamera.viewForward,this.panningPlane.normal);f.vec3d.normalize(this.panningPlane.normal);f.vec3d.negate(this.panningPlane.normal);u.setPlane(this.scenePickPoint,this.panningPlane.normal,this.panningPlane);c=f.vec3d.create();f.vec3d.set3(this.screenPickPoint[0],this.currentCamera.fullHeight,0,c);var b=f.vec3d.create(),e=f.vec3d.length(this.beginCamera.eye);this.adjustedSphere.radius=
e<this.sphere.radius?e-100:this.sphere.radius;u.sphereOrSilhouettePointFromScreenPoint(this.adjustedSphere,this.beginCamera,c,b);this.beginCamera.projectPoint(b,c);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],.9*c[1]);this.pickingHelper.pickPointInScreen(this.screenPickPoint,this.scenePickPoint)&&u.setPlane(this.scenePickPoint,this.panningPlane.normal,this.panningPlane);u.navPointToScreenPoint(this.currentCamera,a.center,this.tmp2d);u.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,
this.tmp2d,this.beginScenePoint)}this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};h.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var c=1<a.pointers.size;this.panMode===r.PanMode.Horizontal?(c&&this.zoomSpherical(a),this.panningSpherical(a),c&&this.rotateSpherical(a)):(c&&this.zoomPlanar(a),this.panningPlanar(a),c&&this.rotatePlanar(a));this.currentCamera.markViewDirty()}};h.prototype.end=function(a){a.pointers.size===this.pointerCount&&
this.update(a);this.finishController();if(a=this.zoomMomentumEstimator.evaluateMomentum())return this.panMode===r.PanMode.Horizontal?new t.ZoomSphericalMomentumController(this.view,a,this.zoomCenterScreen,this.beginScenePoint,this.sphere.radius):new l.ZoomPlanarMomentumController(this.view,a,this.beginScenePoint);if(a=this.rotationMomentumEstimator.evaluateMomentum())return new b.RotationMomentumController(this.view,a,this.sphere.center,this.rotationAxis);if(this.panMode===r.PanMode.Horizontal){if(a=
this.panSphericalMomentumEstimator.evaluateMomentum())return new e.PanSphericalMomentumController(this.view,a)}else if(a=this.panPlanarMomentumEstimator.evaluateMomentum())return new m.PanPlanarMomentumController(this.view,a);return null};h.prototype.zoomSpherical=function(c){var b=this.beginRadius/c.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(c.radius,40),120);this.smoothScaling.update(b);u.applyZoomOnSphere(this.sphere,this.currentCamera,this.smoothScaling.value);u.navPointToScreenPoint(this.currentCamera,
c.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*c.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(c.radius-this.beginRadius);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};h.prototype.panningSpherical=function(c){u.navPointToScreenPoint(this.currentCamera,c.center,this.tmp2d);u.sphereOrSilhouettePointFromScreenPoint(this.sphere,this.currentCamera,this.tmp2d,
this.tmp3d);u.applyPanSpherical(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d);this.panSphericalMomentumEstimator.add(this.tmp2d,this.tmp3d,.001*c.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.screenPickPoint,this.tmp2d);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};h.prototype.rotateSpherical=function(c){f.vec3d.normalize(this.scenePickPoint,this.rotationAxis);var b=this.smoothRotation.value,
e=u.normalizeRotationDelta(c.angle-b),b=b+e;this.smoothRotation.gain=.00125*Math.min(Math.max(c.radius,40),120);this.smoothRotation.update(b);e=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(e,.001*c.timestamp);u.applyRotation(this.currentCamera,this.sphere.center,this.rotationAxis,e);this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(c.radius*b);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};
h.prototype.panningPlanar=function(c){u.navPointToScreenPoint(this.currentCamera,c.center,this.tmp2d);u.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,this.tmp2d,this.tmp3d)&&(u.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(this.tmp2d,this.tmp3d,.001*c.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.beginScreenPoint,this.tmp2d),this.constraintOptions.interactionDirection=
this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),a.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};h.prototype.zoomPlanar=function(c){var b=this.beginRadius/c.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(c.radius,40),120);this.smoothScaling.update(b);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*c.timestamp);u.applyZoomToPoint(this.currentCamera,this.beginScenePoint,
this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(c.radius-this.beginRadius);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};h.prototype.rotatePlanar=function(c){f.vec3d.set(this.beginScenePoint,this.rotationAxis);var b=this.smoothRotation.value,e=c.angle-b,e=u.normalizeRotationDelta(e);this.smoothRotation.gain=.00125*Math.min(Math.max(c.radius,
40),120);this.smoothRotation.update(b+e);b=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(b,.001*c.timestamp);u.applyRotation(this.currentCamera,this.sphere.center,this.rotationAxis,b);this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(c.radius*b);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};return h}(k.InteractiveController);h.PinchAndPanController=p})},"esri/views/3d/input/util":function(){define(["require",
"exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function d(a){this._gain=a}d.prototype.reset=function(a){this._value=a};Object.defineProperty(d.prototype,"gain",{set:function(a){this._gain=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"value",{get:function(){return void 0===this._value?0:this._value},enumerable:!0,configurable:!0});d.prototype.update=function(a){this._value=void 0===this._value?a:this._gain*a+(1-this._gain)*this._value};
return d}();h.ExponentialFalloff=p})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","../../../lib/glMatrix","./MomentumController"],function(p,h,d,a,g){Object.defineProperty(h,"__esModule",{value:!0});p=function(f){function g(d,e){d=f.call(this,d,4)||this;d.momentum=e;d.tmpPan=a.vec3d.create();return d}d(g,f);g.prototype.momentumStep=function(d,e){d=this.momentum.value(d);a.vec3d.scale(this.momentum.direction,
d,this.tmpPan);a.vec3d.subtract(e.eye,this.tmpPan);a.vec3d.subtract(e.center,this.tmpPan);e.markViewDirty();this.constraintOptions.interactionDirection=this.tmpPan};return g}(g.MomentumController);h.PanPlanarMomentumController=p})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),function(p,h,d,a,g,f){Object.defineProperty(h,
"__esModule",{value:!0});p=function(g){function k(a,b){b=g.call(this)||this;b.view=a;b.beginCamera=new f;b.elapsedTimeSec=0;b.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new f,interactionDirection:null};return b}d(k,g);Object.defineProperty(k.prototype,"steppingFinished",{get:function(){return this.momentum.isFinished(this.elapsedTimeSec)},enumerable:!0,configurable:!0});k.prototype.onControllerStart=function(a){this.beginCamera.copyFrom(a);this.constraintOptions.interactionStartCamera=
this.beginCamera;g.prototype.onControllerStart.call(this,a)};k.prototype.stepController=function(e,b){b.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=e;this.momentumStep(this.elapsedTimeSec,b);a.applyAll(this.view,b,this.constraintOptions)};return k}(g.AnimationController);h.MomentumController=p})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","./MomentumController","../../utils/navigationUtils"],
function(p,h,d,a,g){Object.defineProperty(h,"__esModule",{value:!0});var f=[0,0,0];p=function(a){function k(e,b){e=a.call(this,e,4)||this;e.momentum=b;return e}d(k,a);k.prototype.momentumStep=function(a,b){a=this.momentum.value(a);g.applyRotation(b,f,this.momentum.axis,a)};return k}(a.MomentumController);h.PanSphericalMomentumController=p})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/glMatrix ./MomentumController ../../utils/navigationUtils".split(" "),
function(p,h,d,a,g,f){Object.defineProperty(h,"__esModule",{value:!0});p=function(g){function k(e,b,d,f){e=g.call(this,e,2)||this;e.momentum=b;e.axis=a.vec3d.create();e.center=a.vec3d.create();a.vec3d.set(f,e.axis);a.vec3d.set(d,e.center);return e}d(k,g);k.prototype.momentumStep=function(a,b){a=this.momentum.value(a);f.applyRotation(b,this.center,this.axis,a)};return k}(g.MomentumController);h.RotationMomentumController=p})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/glMatrix ./MomentumController ../../utils/navigationUtils".split(" "),
function(p,h,d,a,g,f){Object.defineProperty(h,"__esModule",{value:!0});p=function(g){function k(e,b,d){e=g.call(this,e,1)||this;e.momentum=b;e.zoomCenter=a.vec3d.create();a.vec3d.set(d,e.zoomCenter);e.constraintOptions.interactionDirection=a.vec3d.create();return e}d(k,g);k.prototype.momentumStep=function(e,b){a.vec3d.set(b.eye,this.constraintOptions.interactionDirection);e=this.momentum.valueDelta(0,e);f.applyZoomToPoint(b,this.zoomCenter,e,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionDirection=
a.vec3d.direction(this.constraintOptions.interactionDirection,b.eye)};return k}(g.MomentumController);h.ZoomPlanarMomentumController=p})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/glMatrix ./MomentumController ../../utils/navigationUtils".split(" "),function(p,h,d,a,g,f,k){Object.defineProperty(h,"__esModule",{value:!0});p=function(f){function e(a,
e,d,k,m){a=f.call(this,a,1)||this;a.momentum=e;a.screenCenter=g.vec2d.create();a.sceneCenter=g.vec3d.create();a.tmpSceneCenter=g.vec3d.create();a.tmpZoomAxis=g.vec3d.create();a.sphere={center:g.vec3d.create(),radius:0};g.vec2d.set(d,a.screenCenter);g.vec3d.set(k,a.sceneCenter);a.sphere.radius=m;return a}d(e,f);e.prototype.momentumStep=function(b,e){b=this.momentum.valueDelta(0,b);k.applyZoomOnSphere(this.sphere,e,b);this.constraintOptions.interactionType=1;a.applyAll(this.view,e,this.constraintOptions);
k.sphereOrSilhouettePointFromScreenPoint(this.sphere,e,this.screenCenter,this.tmpSceneCenter);b=k.rotationAndAxisFromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxis);k.applyRotation(e,this.sphere.center,this.tmpZoomAxis,b);this.constraintOptions.interactionType=4};return e}(f.MomentumController);h.ZoomSphericalMomentumController=p})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/lib/glMatrix ./FilteredFiniteDifference ./Momentum".split(" "),
function(p,h,d,a,g,f){Object.defineProperty(h,"__esModule",{value:!0});var k=function(a){function e(b,e,d,f,g){b=a.call(this,b,e,d)||this;b.sceneVelocity=f;b.direction=g;return b}d(e,a);e.prototype.value=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,b)};return e}(f.Momentum);h.PanPlanarMomentum=k;p=function(){function d(e,b,d){void 0===e&&(e=300);void 0===b&&(b=12);void 0===d&&(d=.84);this.minimumInitialVelocity=e;this.stopVelocity=b;this.friction=d;this.time=
new g.FilteredFiniteDifference(.6);this.screen=[new g.FilteredFiniteDifference(.4),new g.FilteredFiniteDifference(.4)];this.scene=[new g.FilteredFiniteDifference(.6),new g.FilteredFiniteDifference(.6),new g.FilteredFiniteDifference(.6)];this.tmpDirection=a.vec3d.create()}d.prototype.add=function(a,b,d){this.time.hasLastValue&&.015>this.time.computeDelta(d)||(this.screen[0].update(a[0]),this.screen[1].update(a[1]),this.scene[0].update(b[0]),this.scene[1].update(b[1]),this.scene[2].update(b[2]),this.time.update(d))};
d.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};d.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,b=this.screen[1].filteredDelta,a=Math.sqrt(a*a+b*b)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};d.prototype.createMomentum=function(e,
b,d){a.vec3d.set3(this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta,this.tmpDirection);var f=a.vec3d.length(this.tmpDirection);0<f&&a.vec3d.scale(this.tmpDirection,1/f);return new k(e,b,d,f/this.time.filteredDelta,this.tmpDirection)};return d}();h.PanPlanarMomentumEstimator=p})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function d(a){this.gain=
a}d.prototype.update=function(a){if(this.hasLastValue){var d=this.computeDelta(a);this.updateDelta(d)}this.lastValue=a};d.prototype.reset=function(){this.filteredDelta=this.lastValue=void 0};Object.defineProperty(d.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!0,configurable:!0});d.prototype.computeDelta=function(a){return a-
this.lastValue};d.prototype.updateDelta=function(a){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*a:a};return d}();h.FilteredFiniteDifference=p})},"esri/views/navigation/Momentum":function(){define(["require","exports","../../core/tsSupport/extendsHelper"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function a(a,d,k){this._initialVelocity=a;this._stopVelocity=d;this._friction=k;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/
this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(a.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0});a.prototype.isFinished=function(a){return a>this.duration};Object.defineProperty(a.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});a.prototype.value=function(a){return this.valueFromInitialVelocity(this._initialVelocity,a)};a.prototype.valueDelta=function(a,d){var f=this.value(a);return this.value(a+
d)-f};a.prototype.valueFromInitialVelocity=function(a,d){d=Math.min(d,this.duration);var f=1-this.friction;return a*(Math.pow(f,d)-1)/Math.log(f)};return a}();h.Momentum=p})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/lib/glMatrix ../../views/3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),function(p,h,d,a,g,f,k,m){Object.defineProperty(h,"__esModule",{value:!0});
var e=function(a){function b(b,e,d,f,g){b=a.call(this,b,e,d)||this;b.angularVelocity=f;b.axis=g;return b}d(b,a);b.prototype.value=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.angularVelocity,b)};return b}(m.Momentum);h.PanSphericalMomentum=e;p=function(){function b(b,e,d){void 0===b&&(b=300);void 0===e&&(e=12);void 0===d&&(d=.84);this.minimumInitialVelocity=b;this.stopVelocity=e;this.friction=d;this.tmpAxis=a.vec3d.create();this.time=new f.FilteredFiniteDifference(.3);this.screen=
[new f.FilteredFiniteDifference(.4),new f.FilteredFiniteDifference(.4)];this.angle=new k.FilteredValue(.6);this.axis=a.vec3d.create();this.lastScene=a.vec3d.create()}b.prototype.add=function(b,e,d){if(this.time.hasLastValue){if(.01>this.time.computeDelta(d))return;var f=g.rotationAndAxisFromPoints(this.lastScene,e,this.tmpAxis);1E-5>a.vec3d.length2(this.tmpAxis)?f=0:a.vec3d.normalize(this.tmpAxis,this.axis);this.angle.update(f);a.vec3d.set(e,this.lastScene)}this.screen[0].update(b[0]);this.screen[1].update(b[1]);
this.time.update(d)};b.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle.reset();this.time.reset()};b.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,b=this.screen[1].filteredDelta,a=Math.sqrt(a*a+b*b)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};b.prototype.createMomentum=function(a,b,d){return new e(a,b,
d,this.angle.filteredValue/this.time.filteredDelta,this.axis)};return b}();h.PanSphericalMomentumEstimator=p})},"esri/views/navigation/FilteredValue":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function d(a){this.gain=a}d.prototype.update=function(a){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*a:a};d.prototype.reset=function(){this.filteredValue=void 0};Object.defineProperty(d.prototype,
"hasFilteredValue",{get:function(){return void 0!==this.filteredValue},enumerable:!0,configurable:!0});return d}();h.FilteredValue=p})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./MomentumEstimator"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});p=function(a){function f(d,f,e,b){void 0===d&&(d=3);void 0===f&&(f=.01);void 0===e&&(e=.95);void 0===b&&(b=12);return a.call(this,d,f,e,b)||this}d(f,
a);f.prototype.add=function(d,f){if(this.value.hasLastValue){var e=this.value.lastValue;for(d-=e;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;d=e+d}a.prototype.add.call(this,d,f)};return f}(a.MomentumEstimator);h.RotationMomentumEstimator=p})},"esri/views/navigation/MomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/support/mathUtils ./FilteredFiniteDifference ./Momentum".split(" "),function(p,h,d,a,g,f){Object.defineProperty(h,"__esModule",{value:!0});
p=function(){function d(a,e,b,d){void 0===a&&(a=2.5);void 0===e&&(e=.01);void 0===b&&(b=.95);void 0===d&&(d=12);this.minimumInitialVelocity=a;this.stopVelocity=e;this.friction=b;this.maxVelocity=d;this.value=new g.FilteredFiniteDifference(.8);this.time=new g.FilteredFiniteDifference(.3)}d.prototype.add=function(a,e){if(this.time.hasLastValue){if(.01>this.time.computeDelta(e))return;if(this.value.hasFilteredDelta){var b=this.value.computeDelta(a);0>this.value.filteredDelta*b&&this.value.reset()}}this.time.update(e);
this.value.update(a)};d.prototype.reset=function(){this.value.reset();this.time.reset()};d.prototype.evaluateMomentum=function(){if(!this.value.hasFilteredDelta)return null;var d=this.value.filteredDelta/this.time.filteredDelta,d=a.clamp(d,-this.maxVelocity,this.maxVelocity);return Math.abs(d)<this.minimumInitialVelocity?null:this.createMomentum(d,this.stopVelocity,this.friction)};d.prototype.createMomentum=function(a,e,b){return new f.Momentum(a,e,b)};return d}();h.MomentumEstimator=p})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["require",
"exports","../../core/tsSupport/extendsHelper","./Momentum","./MomentumEstimator"],function(p,h,d,a,g){Object.defineProperty(h,"__esModule",{value:!0});var f=function(a){function f(e,b,d){return a.call(this,e,b,d)||this}d(f,a);f.prototype.value=function(e){e=a.prototype.value.call(this,e);return Math.exp(e)};f.prototype.valueDelta=function(e,b){var d=a.prototype.value.call(this,e);e=a.prototype.value.call(this,e+b);return Math.exp(e-d)};return f}(a.Momentum);h.ZoomMomentum=f;p=function(a){function g(e,
b,d,f){void 0===e&&(e=2.5);void 0===b&&(b=.01);void 0===d&&(d=.95);void 0===f&&(f=12);return a.call(this,e,b,d,f)||this}d(g,a);g.prototype.add=function(e,b){a.prototype.add.call(this,Math.log(e),b)};g.prototype.createMomentum=function(a,b,d){return new f(a,b,d)};return g}(g.MomentumEstimator);h.ZoomMomentumEstimator=p})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../input/util ../../../lib/glMatrix ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v){Object.defineProperty(h,"__esModule",{value:!0});var q;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(q=h.PanMode||(h.PanMode={}));var n=f.vec3d.createFrom(0,0,1),w=16/180*Math.PI;p=function(c){function k(a,b){var e=c.call(this)||this;e.view=a;e.pickingHelper=b;e.rotationValueSmooth=new g.ExponentialFalloff(.05);e.scalingValueSmooth=new g.ExponentialFalloff(.05);e.planeHorizontal={normal:f.vec3d.create(),d:0};e.planeVertical={normal:f.vec3d.create(),
d:0};e.rotationMomentumEstimator=new r.RotationMomentumEstimator;e.panMomentumEstimator=new u.PanPlanarMomentumEstimator(300,12,.9);e.zoomMomentumEstimator=new v.ZoomMomentumEstimator;e.beginCenter=f.vec3d.create();e.tmpPoints=[];e.beginCenterScreen=f.vec2d.create();e.tmpCentroid3d=f.vec3d.create();e.tmpCentroid2d=f.vec2d.create();e.tmp2d=f.vec2d.create();e.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new t,interactionDirection:null};return e}d(k,c);
k.prototype.begin=function(a){if(this.active){this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();l.navPointToScreenPoint(this.beginCamera,a.center,this.beginCenterScreen);this.planeHorizontal.d=0;f.vec3d.set(n,this.planeHorizontal.normal);var c=f.vec3d.create();this.pickingHelper.pickPointInScreen(this.beginCenterScreen,c)||this.pickingHelper.pickFreePointInScreen(this.beginCenterScreen,c);var b=f.vec3d.create();
f.vec3d.negate(this.beginCamera.viewForward,b);var e=f.vec3d.create();f.vec3d.set(n,e);var d=f.vec3d.dot(b,e);this.panMode=Math.asin(0>d?-d:d)>=w?q.Horizontal:q.Vertical;l.setPlaneD(c,this.planeHorizontal);0>f.vec3d.dot(this.planeHorizontal.normal,this.beginCamera.eye)+this.planeHorizontal.d&&(f.vec3d.negate(this.planeHorizontal.normal),this.planeHorizontal.d*=-1);this.panMode===q.Vertical?(f.vec3d.scale(e,d),f.vec3d.subtract(b,e,this.planeVertical.normal),f.vec3d.normalize(this.planeVertical.normal),
l.setPlaneD(c,this.planeVertical),this.computePlanePoints(a.pointers,this.planeVertical,this.beginCamera,this.tmpPoints)):this.computePlanePoints(a.pointers,this.planeHorizontal,this.beginCamera,this.tmpPoints);l.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};k.prototype.update=function(c){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var b=1<c.pointers.size,e=this.panMode===q.Horizontal?this.planeHorizontal:this.planeVertical,
d=this.beginCenter;if(b){var f=this.beginRadius/c.radius,g=.001875*Math.min(Math.max(c.radius,40),120);this.scalingValueSmooth.gain=g;this.scalingValueSmooth.update(f);l.applyZoomToPoint(this.currentCamera,d,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*c.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(Math.abs(c.radius-this.beginRadius));
a.applyAll(this.view,this.currentCamera,this.constraintOptions)}this.computePlanePoints(c.pointers,e,this.currentCamera,this.tmpPoints);l.centroid(this.tmpPoints,this.tmpCentroid3d);l.navPointToScreenPoint(this.currentCamera,c.center,this.tmpCentroid2d);l.applyPanPlanar(this.currentCamera,d,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*c.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.beginCenterScreen,
this.tmpCentroid2d);a.applyAll(this.view,this.currentCamera,this.constraintOptions);b&&(b=this.planeHorizontal.normal,e=this.rotationValueSmooth.value,f=l.normalizeRotationDelta(c.angle-e),g=.00125*Math.min(Math.max(c.radius,40),120),this.rotationValueSmooth.gain=g,this.rotationValueSmooth.update(e+f),g=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(g,.001*c.timestamp),l.applyRotation(this.currentCamera,d,b,g),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=
a.pixelDistanceToInteractionFactor(Math.abs(c.radius*g)),a.applyAll(this.view,this.currentCamera,this.constraintOptions));this.currentCamera.markViewDirty()}};k.prototype.end=function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();return(a=this.zoomMomentumEstimator.evaluateMomentum())?new b.ZoomPlanarMomentumController(this.view,a,this.beginCenter):(a=this.rotationMomentumEstimator.evaluateMomentum())?new e.RotationMomentumController(this.view,a,this.beginCenter,this.planeHorizontal.normal):
(a=this.panMomentumEstimator.evaluateMomentum())?new m.PanPlanarMomentumController(this.view,a):null};k.prototype.computePlanePoints=function(a,c,b,e){e.length=a.size;var d=this.tmp2d,g=0;a.forEach(function(a){l.navPointToScreenPoint(b,a,d);void 0===e[g]&&(e[g]=f.vec3d.create());l.intersectPlaneFromScreenPoint(c,b,d,e[g]);g+=1});return e};return k}(k.InteractiveController);h.PinchAndPanController=p})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["require","exports",
"../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});p=function(a){function f(d,f){var e=a.call(this,!0)||this;e.view=d;e.registerIncoming("pointer-down",f,function(a){return e.view.state.stopActiveCameraController()});return e}d(f,a);return f}(a.InputHandler);h.PointerDownCancelAnimation=p})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper",
"./SingleKey"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});p=function(a){function f(d,f,e){e=a.call(this,"esri.views.3d.input.handlers.SingleKeyResetHeading",f,e)||this;e.view=d;e.key=f;return e}d(f,a);f.prototype.activate=function(){this.view.goTo({heading:0})};return f}(a.SingleKey);h.SingleKeyResetHeading=p})},"esri/views/3d/input/handlers/SingleKey":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(p,
h,d,a){Object.defineProperty(h,"__esModule",{value:!0});p=function(a){function f(d,f,e){var b=a.call(this,!0)||this;b.key=f;b.registerIncoming("key-down",e,function(a){return b._handleKeyDown(a)});return b}d(f,a);f.prototype._handleKeyDown=function(a){a.data.key===this.key&&(this.activate(),a.stopPropagation())};return f}(a.InputHandler);h.SingleKey=p})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./SingleKey"],
function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});p=function(a){function f(d,f,e){e=a.call(this,"esri.views.3d.input.handlers.SingleKeyResetTilt",f,e)||this;e.view=d;e.key=f;return e}d(f,a);f.prototype.activate=function(){this.view.goTo({tilt:0})};return f}(a.SingleKey);h.SingleKeyResetTilt=p})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/RotateController ../../state/helpers/PickingHelper ../../../input/InputHandler".split(" "),
function(p,h,d,a,g,f){Object.defineProperty(h,"__esModule",{value:!0});p=function(f){function k(a,b){void 0===b&&(b=!1);var e=f.call(this,!0)||this;e.view=a;e.invert=b;e.pickingHelper=new g.PickingHelper(a);e.registerIncoming("vertical-two-finger-drag",function(a){return e.handleTwoFinger(a)});return e}d(k,f);k.prototype.handleTwoFinger=function(e){var b=[0,-e.data.delta*(this.invert?-1:1)];switch(e.data.action){case "begin":this.cameraController=new a.RotateController(this.view,this.pickingHelper,
"center");this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(b);break;case "update":this.cameraController.update(b);break;case "end":this.cameraController.end(),this.cameraController=null}};return k}(f.InputHandler);h.TwoFingerTilt=p})},"esri/views/input/BrowserEventSource":function(){define(["require","exports","dojo/sniff","../../core/libs/pep/pep","./keys"],function(p,h,d,a,g){Object.defineProperty(h,"__esModule",{value:!0});var f=d("trident"),k=d("edge"),
m=d("chrome"),e=d("ff"),b=d("safari");p=function(){function d(b){this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._element=b;a.applyLocal(b);b.getAttribute("tabindex")||b.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,
"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._initialCssTouchAction=b.style.touchAction;b.style.touchAction="none";this._element.addEventListener("keydown",this._preventAltKeyDefault)}d.prototype.destroy=function(){var a=this;this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(function(b){a._element.releasePointerCapture(b)});this._activePointerCaptures=null;this._element.style.touchAction=this._initialCssTouchAction;this._element.removeEventListener("keydown",
this._preventAltKeyDefault)};Object.defineProperty(d.prototype,"onEventReceived",{set:function(a){this._callback=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"activeEvents",{set:function(a){var b=this,e;for(e in this._active)a&&a.has(e)||(this._element.removeEventListener(l[e],this._active[e]),delete this._active[e]);a&&a.forEach(function(a){if(!b._active[a]&&l[a]){var e=(b._eventHandlers[a]||b._handleDefault).bind(b,a);b._element.addEventListener(l[a],e);b._active[a]=e}})},
enumerable:!0,configurable:!0});d.prototype.setPointerCapture=function(a,b){b?(this._element.setPointerCapture(a.pointerId),this._activePointerCaptures.add(a.pointerId)):(this._element.releasePointerCapture(a.pointerId),this._activePointerCaptures.delete(a.pointerId))};d.prototype._updateNormalizedPointerLikeEvent=function(a,b){var e=this._element.getBoundingClientRect();b.x=a.clientX-Math.round(e.left);b.y=a.clientY-Math.round(e.top);return b};d.prototype._handleKey=function(a,b){var e=g.eventKey(b);
e&&"key-up"===a&&this._keyDownState.delete(e);b={native:b,key:e,repeat:e&&this._keyDownState.has(e)};e&&"key-down"===a&&this._keyDownState.add(b.key);this._callback(a,b)};d.prototype._handlePointer=function(a,b){b=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0,pointerType:b.pointerType,button:b.button,buttons:b.buttons});this._callback(a,b)};d.prototype._handlePointerPreventDefault=function(a,b){var e=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0,pointerType:b.pointerType,
button:b.button,buttons:b.buttons});b.preventDefault();this._callback(a,e)};d.prototype._handleMouseWheel=function(a,d){d.preventDefault();var g=d.deltaY;switch(d.deltaMode){case 0:if(f||k)g=g/document.documentElement.clientHeight*600;break;case 1:g*=30;break;case 2:g*=900}f||k?g*=.7:m||b?g*=.6:e&&(g*=1.375);var l=Math.abs(g);100<l&&(g=g/l*200/(1+Math.exp(-.02*(l-100))));d=this._updateNormalizedPointerLikeEvent(d,{native:d,x:0,y:0,deltaY:g});this._callback(a,d)};d.prototype._handlePointerCaptureLost=
function(a,b){this._activePointerCaptures.delete(b.pointerId);this._handleDefault(a,b)};d.prototype._handleDefault=function(a,b){var e={native:b};b.preventDefault();this._callback(a,e)};d.prototype._preventAltKeyDefault=function(a){"Alt"===a.key&&a.preventDefault()};return d}();h.BrowserEventSource=p;var l={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture",
"context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave"}})},"esri/core/libs/pep/pep":function(){define(function(){function p(a,c){c=c||Object.create(null);var e=document.createEvent("Event");e.initEvent(a,c.bubbles||!1,c.cancelable||!1);a=2;for(var d;a<b.length;a++)d=b[a],e[d]=c[d]||l[a];e.buttons=c.buttons||0;a=0;a=c.pressure?c.pressure:e.buttons?.5:0;e.x=e.clientX;e.y=e.clientY;e.pointerId=c.pointerId||0;e.width=c.width||0;e.height=c.height||0;e.pressure=a;e.tiltX=
c.tiltX||0;e.tiltY=c.tiltY||0;e.pointerType=c.pointerType||"";e.hwTimestamp=c.hwTimestamp||0;e.isPrimary=c.isPrimary||!1;return e}function h(){this.array=[];this.size=0}function d(a,c,b,e){this.addCallback=a.bind(e);this.removeCallback=c.bind(e);this.changedCallback=b.bind(e);y&&(this.observer=new y(this.mutationWatcher.bind(this)))}function a(a){return"body /shadow-deep/ "+g(a)}function g(a){return'[touch-action\x3d"'+a+'"]'}function f(a){return"{ -ms-touch-action: "+a+"; touch-action: "+a+"; touch-action-delay: none; }"}
function k(){if(G){E.forEach(function(c){String(c)===c?(C+=g(c)+f(c)+"\n",J&&(C+=a(c)+f(c)+"\n")):(C+=c.selectors.map(g)+f(c.rule)+"\n",J&&(C+=c.selectors.map(a)+f(c.rule)+"\n"))});var c=document.createElement("style");c.textContent=C;document.head.appendChild(c)}}function m(a){if(!n.pointermap.has(a))throw a=Error("InvalidPointerId"),a.name="InvalidPointerId",a;}function e(a){if(!a.ownerDocument.contains(a))throw a=Error("InvalidStateError"),a.name="InvalidStateError",a;}var b="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget pageX pageY".split(" "),
l=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],t=window.Map&&window.Map.prototype.forEach?Map:h;h.prototype={set:function(a,c){if(void 0===c)return this.delete(a);this.has(a)||this.size++;this.array[a]=c},has:function(a){return void 0!==this.array[a]},delete:function(a){this.has(a)&&(delete this.array[a],this.size--)},get:function(a){return this.array[a]},clear:function(){this.size=this.array.length=0},forEach:function(a,c){return this.array.forEach(function(b,e){a.call(c,b,e,this)},this)}};var u=
"bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget buttons pointerId width height pressure tiltX tiltY pointerType hwTimestamp isPrimary type target currentTarget which pageX pageY timeStamp".split(" "),r=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],v={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},q="undefined"!==typeof SVGElementInstance,n={pointermap:new t,eventMap:Object.create(null),
captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(a,c){var b=c.events;b&&(b.forEach(function(a){c[a]&&(this.eventMap[a]=c[a].bind(c))},this),this.eventSources[a]=c,this.eventSourceList.push(c))},register:function(a){for(var c=this.eventSourceList.length,b=0,e;b<c&&(e=this.eventSourceList[b]);b++)e.register.call(e,a)},unregister:function(a){for(var c=this.eventSourceList.length,b=0,e;b<c&&(e=this.eventSourceList[b]);b++)e.unregister.call(e,
a)},contains:function(a,c){try{return a.contains(c)}catch(aa){return!1}},down:function(a){a.bubbles=!0;this.fireEvent("pointerdown",a)},move:function(a){a.bubbles=!0;this.fireEvent("pointermove",a)},up:function(a){a.bubbles=!0;this.fireEvent("pointerup",a)},enter:function(a){a.bubbles=!1;this.fireEvent("pointerenter",a)},leave:function(a){a.bubbles=!1;this.fireEvent("pointerleave",a)},over:function(a){a.bubbles=!0;this.fireEvent("pointerover",a)},out:function(a){a.bubbles=!0;this.fireEvent("pointerout",
a)},cancel:function(a){a.bubbles=!0;this.fireEvent("pointercancel",a)},leaveOut:function(a){this.out(a);this.propagate(a,this.leave,!1)},enterOver:function(a){this.over(a);this.propagate(a,this.enter,!0)},eventHandler:function(a){if(!a._handledByPE){var c=a.type;(c=this.eventMap&&this.eventMap[c])&&c(a);a._handledByPE=!0}},listen:function(a,c){c.forEach(function(c){this.addEvent(a,c)},this)},unlisten:function(a,c){c.forEach(function(c){this.removeEvent(a,c)},this)},addEvent:function(a,c){a.addEventListener(c,
this.boundHandler)},removeEvent:function(a,c){a.removeEventListener(c,this.boundHandler)},makeEvent:function(a,c){this.captureInfo[c.pointerId]&&(c.relatedTarget=null);a=new p(a,c);c.preventDefault&&(a.preventDefault=c.preventDefault);a._target=a._target||c.target;return a},fireEvent:function(a,c){a=this.makeEvent(a,c);return this.dispatchEvent(a)},cloneEvent:function(a){for(var c=Object.create(null),b,e=0;e<u.length;e++)b=u[e],c[b]=a[b]||r[e],q&&("target"===b||"relatedTarget"===b)&&c[b]instanceof
SVGElementInstance&&(c[b]=c[b].correspondingUseElement);a.preventDefault&&(c.preventDefault=function(){a.preventDefault()});return c},getTarget:function(a){var c=this.captureInfo[a.pointerId];if(!c)return a._target;if(a._target===c||!(a.type in v))return c},propagate:function(a,c,b){for(var e=a.target,d=[];!e.contains(a.relatedTarget)&&e!==document;)d.push(e),e=e.parentNode;b&&d.reverse();d.forEach(function(b){a.target=b;c.call(this,a)},this)},setCapture:function(a,c){this.captureInfo[a]&&this.releaseCapture(a);
this.captureInfo[a]=c;var b=new p("gotpointercapture");b.pointerId=a;this.implicitRelease=this.releaseCapture.bind(this,a);document.addEventListener("pointerup",this.implicitRelease);document.addEventListener("pointercancel",this.implicitRelease);b._target=c;this.asyncDispatchEvent(b)},releaseCapture:function(a){var c=this.captureInfo[a];if(c){var b=new p("lostpointercapture");b.pointerId=a;this.captureInfo[a]=void 0;document.removeEventListener("pointerup",this.implicitRelease);document.removeEventListener("pointercancel",
this.implicitRelease);b._target=c;this.asyncDispatchEvent(b)}},dispatchEvent:function(a){var c=this.getTarget(a);if(c)return c.dispatchEvent(a)},asyncDispatchEvent:function(a){requestAnimationFrame(this.dispatchEvent.bind(this,a))}};n.boundHandler=n.eventHandler.bind(n);var w={shadow:function(a){if(a)return a.shadowRoot||a.webkitShadowRoot},canTarget:function(a){return a&&!!a.elementFromPoint},targetingShadow:function(a){a=this.shadow(a);if(this.canTarget(a))return a},olderShadow:function(a){var c=
a.olderShadowRoot;!c&&(a=a.querySelector("shadow"))&&(c=a.olderShadowRoot);return c},allShadows:function(a){var c=[];for(a=this.shadow(a);a;)c.push(a),a=this.olderShadow(a);return c},searchRoot:function(a,c,b){if(a){var e=a.elementFromPoint(c,b),d;for(d=this.targetingShadow(e);d;){if(a=d.elementFromPoint(c,b))return e=this.targetingShadow(a),this.searchRoot(e,c,b)||a;d=this.olderShadow(d)}return e}},owner:function(a){for(;a.parentNode;)a=a.parentNode;a.nodeType!==Node.DOCUMENT_NODE&&a.nodeType!==
Node.DOCUMENT_FRAGMENT_NODE&&(a=document);return a},findTarget:function(a){var c=a.clientX,b=a.clientY;a=this.owner(a.target);a.elementFromPoint(c,b)||(a=document);return this.searchRoot(a,c,b)}},c=Array.prototype.forEach.call.bind(Array.prototype.forEach),x=Array.prototype.map.call.bind(Array.prototype.map),z=Array.prototype.slice.call.bind(Array.prototype.slice),A=Array.prototype.filter.call.bind(Array.prototype.filter),y=window.MutationObserver||window.WebKitMutationObserver,B={subtree:!0,childList:!0,
attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};d.prototype={watchSubtree:function(a){this.observer&&w.canTarget(a)&&this.observer.observe(a,B)},enableOnSubtree:function(a){this.watchSubtree(a);a===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(a)},installNewSubtree:function(a){c(this.findElements(a),this.addElement,this)},findElements:function(a){return a.querySelectorAll?a.querySelectorAll("[touch-action]"):[]},removeElement:function(a){this.removeCallback(a)},
addElement:function(a){this.addCallback(a)},elementChanged:function(a,c){this.changedCallback(a,c)},concatLists:function(a,c){return a.concat(z(c))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(a){return a.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(a){var c=x(a,this.findElements,this);c.push(A(a,this.isElement));return c.reduce(this.concatLists,[])},
mutationWatcher:function(a){a.forEach(this.mutationHandler,this)},mutationHandler:function(a){"childList"===a.type?(this.flattenMutationTree(a.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(a.removedNodes).forEach(this.removeElement,this)):"attributes"===a.type&&this.elementChanged(a.target,a.oldValue)}};var E=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],C="",G=window.PointerEvent||window.MSPointerEvent,J=!window.ShadowDOMPolyfill&&
document.head.createShadowRoot,F=n.pointermap,I=[1,4,2,8,16],H=!1;try{H=1===(new MouseEvent("test",{buttons:1})).buttons}catch(da){}var K={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(a){n.listen(a,this.events)},unregister:function(a){n.unlisten(a,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(a){var c=this.lastTouches,b=a.clientX;a=a.clientY;for(var e=0,d=c.length,f;e<d&&(f=c[e]);e++){var g=Math.abs(a-f.y);
if(25>=Math.abs(b-f.x)&&25>=g)return!0}},prepareEvent:function(a){var c=n.cloneEvent(a),b=c.preventDefault;c.preventDefault=function(){a.preventDefault();b()};c.pointerId=this.POINTER_ID;c.isPrimary=!0;c.pointerType=this.POINTER_TYPE;return c},prepareButtonsForMove:function(a,c){var b=F.get(this.POINTER_ID);a.buttons=0!==c.which&&b?b.buttons:0;c.buttons=a.buttons},mousedown:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=F.get(this.POINTER_ID),b=this.prepareEvent(a);H||(b.buttons=I[b.button],
c&&(b.buttons|=c.buttons),a.buttons=b.buttons);F.set(this.POINTER_ID,a);c&&0!==c.buttons?n.move(b):n.down(b)}},mousemove:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=this.prepareEvent(a);H||this.prepareButtonsForMove(c,a);c.button=-1;F.set(this.POINTER_ID,a);n.move(c)}},mouseup:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=F.get(this.POINTER_ID),b=this.prepareEvent(a);if(!H){var e=I[b.button];b.buttons=c?c.buttons&~e:0;a.buttons=b.buttons}F.set(this.POINTER_ID,a);b.buttons&=
~I[b.button];0===b.buttons?n.up(b):n.move(b)}},mouseover:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=this.prepareEvent(a);H||this.prepareButtonsForMove(c,a);c.button=-1;F.set(this.POINTER_ID,a);n.enterOver(c)}},mouseout:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=this.prepareEvent(a);H||this.prepareButtonsForMove(c,a);c.button=-1;n.leaveOut(c)}},cancel:function(a){a=this.prepareEvent(a);n.cancel(a);this.deactivateMouse()},deactivateMouse:function(){F.delete(this.POINTER_ID)}},
L=n.captureInfo,M=w.findTarget.bind(w),V=w.allShadows.bind(w),S=n.pointermap,Z,R={events:["touchstart","touchmove","touchend","touchcancel"],register:function(a){Z.enableOnSubtree(a)},unregister:function(a){},elementAdded:function(a){var c=a.getAttribute("touch-action"),b=this.touchActionToScrollType(c);b&&(a._scrollType=b,n.listen(a,this.events),V(a).forEach(function(a){a._scrollType=b;n.listen(a,this.events)},this))},elementRemoved:function(a){a._scrollType=void 0;n.unlisten(a,this.events);V(a).forEach(function(a){a._scrollType=
void 0;n.unlisten(a,this.events)},this)},elementChanged:function(a,c){var b=a.getAttribute("touch-action"),e=this.touchActionToScrollType(b);c=this.touchActionToScrollType(c);e&&c?(a._scrollType=e,V(a).forEach(function(a){a._scrollType=e},this)):c?this.elementRemoved(a):e&&this.elementAdded(a)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(a){var c=this.scrollTypes;if("none"===a)return"none";if(a===
c.XSCROLLER)return"X";if(a===c.YSCROLLER)return"Y";if(c.SCROLLER.exec(a))return"XY"},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(0===S.size||1===S.size&&S.has(1))this.firstTouch=a.identifier,this.firstXY={X:a.clientX,Y:a.clientY},this.scrolling=!1,this.cancelResetClickCount()},removePrimaryPointer:function(a){a.isPrimary&&(this.firstXY=this.firstTouch=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var a=
function(){this.clickCount=0;this.resetId=null}.bind(this);this.resetId=setTimeout(a,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(a){var c=0;if("touchstart"===a||"touchmove"===a)c=1;return c},touchToPointer:function(a){var c=this.currentTouchEvent,b=n.cloneEvent(a),e=b.pointerId=a.identifier+2;b.target=L[e]||M(b);b.bubbles=!0;b.cancelable=!0;b.detail=this.clickCount;b.button=0;b.buttons=this.typeToButtons(c.type);b.width=a.radiusX||a.webkitRadiusX||
0;b.height=a.radiusY||a.webkitRadiusY||0;b.pressure=a.force||a.webkitForce||.5;b.isPrimary=this.isPrimaryTouch(a);b.pointerType=this.POINTER_TYPE;b.altKey=c.altKey;b.ctrlKey=c.ctrlKey;b.metaKey=c.metaKey;b.shiftKey=c.shiftKey;var d=this;b.preventDefault=function(){d.scrolling=!1;d.firstXY=null;c.preventDefault()};return b},processTouches:function(a,c){var b=a.changedTouches;this.currentTouchEvent=a;a=0;for(var e;a<b.length;a++)e=b[a],c.call(this,this.touchToPointer(e))},shouldScroll:function(a){if(this.firstXY){var c;
c=a.currentTarget._scrollType;if("none"===c)c=!1;else if("XY"===c)c=!0;else{a=a.changedTouches[0];var b="Y"===c?"X":"Y";c=Math.abs(a["client"+c]-this.firstXY[c])>=Math.abs(a["client"+b]-this.firstXY[b])}this.firstXY=null;return c}},findTouch:function(a,c){for(var b=0,e=a.length,d;b<e&&(d=a[b]);b++)if(d.identifier===c)return!0},vacuumTouches:function(a){var c=a.touches;if(S.size>=c.length){var b=[];S.forEach(function(a,e){1===e||this.findTouch(c,e-2)||b.push(a.out)},this);b.forEach(this.cancelOut,
this)}},touchstart:function(a){this.vacuumTouches(a);this.setPrimaryTouch(a.changedTouches[0]);this.dedupSynthMouse(a);this.scrolling||(this.clickCount++,this.processTouches(a,this.overDown))},overDown:function(a){S.set(a.pointerId,{target:a.target,out:a,outTarget:a.target});n.enterOver(a);n.down(a)},touchmove:function(a){this.scrolling||(this.shouldScroll(a)?(this.scrolling=!0,this.touchcancel(a)):(a.preventDefault(),this.processTouches(a,this.moveOverOut)))},moveOverOut:function(a){var c=S.get(a.pointerId);
if(c){var b=c.out,e=c.outTarget;n.move(a);b&&e!==a.target&&(b.relatedTarget=a.target,a.relatedTarget=e,b.target=e,a.target?(n.leaveOut(b),n.enterOver(a)):(a.target=e,a.relatedTarget=null,this.cancelOut(a)));c.out=a;c.outTarget=a.target}},touchend:function(a){this.dedupSynthMouse(a);this.processTouches(a,this.upOut)},upOut:function(a){this.scrolling||(n.up(a),n.leaveOut(a));this.cleanUpPointer(a)},touchcancel:function(a){this.processTouches(a,this.cancelOut)},cancelOut:function(a){n.cancel(a);n.leaveOut(a);
this.cleanUpPointer(a)},cleanUpPointer:function(a){S.delete(a.pointerId);this.removePrimaryPointer(a)},dedupSynthMouse:function(a){var c=K.lastTouches;a=a.changedTouches[0];this.isPrimaryTouch(a)&&(a={x:a.clientX,y:a.clientY},c.push(a),c=function(a,c){c=a.indexOf(c);-1<c&&a.splice(c,1)}.bind(null,c,a),setTimeout(c,2500))}};Z=new d(R.elementAdded,R.elementRemoved,R.elementChanged,R);var N=n.pointermap,D=window.MSPointerEvent&&"number"===typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,P={events:"MSPointerDown MSPointerMove MSPointerUp MSPointerOut MSPointerOver MSPointerCancel MSGotPointerCapture MSLostPointerCapture".split(" "),
register:function(a){n.listen(a,this.events)},unregister:function(a){n.unlisten(a,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(a){var c=a;D&&(c=n.cloneEvent(a),c.pointerType=this.POINTER_TYPES[a.pointerType]);return c},cleanup:function(a){N.delete(a)},MSPointerDown:function(a){N.set(a.pointerId,a);a=this.prepareEvent(a);n.down(a)},MSPointerMove:function(a){a=this.prepareEvent(a);n.move(a)},MSPointerUp:function(a){var c=this.prepareEvent(a);n.up(c);this.cleanup(a.pointerId)},
MSPointerOut:function(a){a=this.prepareEvent(a);n.leaveOut(a)},MSPointerOver:function(a){a=this.prepareEvent(a);n.enterOver(a)},MSPointerCancel:function(a){var c=this.prepareEvent(a);n.cancel(c);this.cleanup(a.pointerId)},MSLostPointerCapture:function(a){a=n.makeEvent("lostpointercapture",a);n.dispatchEvent(a)},MSGotPointerCapture:function(a){a=n.makeEvent("gotpointercapture",a);n.dispatchEvent(a)}},O,Q;window.navigator.msPointerEnabled?(O=function(a){m(a);e(this);0!==n.pointermap.get(a).buttons&&
this.msSetPointerCapture(a)},Q=function(a){m(a);this.msReleasePointerCapture(a)}):(O=function(a){m(a);e(this);0!==n.pointermap.get(a).buttons&&n.setCapture(a,this)},Q=function(a){m(a);n.releaseCapture(a,this)});var T=window.PointerEvent||window.MSPointerEvent;return{dispatcher:n,Installer:d,PointerEvent:p,PointerMap:t,targetFinding:w,applyGlobal:function(){k();window.PointerEvent||(window.PointerEvent=p,window.navigator.msPointerEnabled?(Object.defineProperty(window.navigator,"maxTouchPoints",{value:window.navigator.msMaxTouchPoints,
enumerable:!0}),n.registerSource("ms",P)):(n.registerSource("mouse",K),void 0!==window.ontouchstart&&n.registerSource("touch",R)),n.register(document));window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:O},releasePointerCapture:{value:Q}})},applyLocal:function(a){T||(window.PointerEvent||(window.navigator.msPointerEnabled?n.registerSource("ms",P):(n.registerSource("mouse",K),void 0!==window.ontouchstart&&n.registerSource("touch",
R)),n.register(document)),window.Element&&!Element.prototype.setPointerCapture&&(a.setPointerCapture=O.bind(a),a.releasePointerCapture=Q.bind(a)),a.getAttribute("touch-action")||a.setAttribute("touch-action","none"))}}})},"esri/views/input/keys":function(){define(["require","exports","../../core/sniff"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});h.primaryKey="Meta";var a={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",
38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(p=48;58>p;p++)a[p]=String.fromCharCode(p);for(p=1;25>p;p++)a[111+p]="F"+p;for(p=65;91>p;p++)a[p]=[String.fromCharCode(p+32),String.fromCharCode(p)];var g={Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Esc:"Escape"};h.eventKey=function(d){if(void 0!==d.key)return g[d.key]||d.key;var f=a[d.keyCode];return Array.isArray(f)?d.shiftKey?f[1]:f[0]:f};h.isSystemModifier=function(a){switch(a){case "Ctrl":case "Alt":case "Shift":case "Meta":case "Primary":return!0}}})},
"esri/views/input/InputManager":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Logger ../../core/now ../../core/accessorSupport/decorators ./keys ./recognizers ./handlers/LatestPointerType".split(" "),function(p,h,d,a,g,f,k,m,e,b,l){Object.defineProperty(h,"__esModule",{value:!0});var t=f.getLogger("esri.views.input.InputManager");p=function(f){function g(a,b){a=f.call(this)||this;a._pointerCaptures=new Map;
a._nameToGroup={};a._handlers=[];a._currentPropagation=null;a._sourceEvents=new Set;a._keyModifiers=new Set;a._activeKeyModifiers=new Set;a.primaryKey=e.primaryKey;a.latestPointerType="mouse";a._installRecognizers();return a}d(g,f);g.prototype.normalizeCtorArgs=function(a,e){this._browserEvents=a;this._browserEvents.onEventReceived=this._onEventReceived.bind(this);this._recognizers=e;this._recognizers||(this._recognizers=b.defaults.map(function(a){return new a}));return{}};g.prototype.destroy=function(){for(var a=
0,b=Object.keys(this._nameToGroup);a<b.length;a++)this.uninstallHandlers(b[a])};g.prototype.installHandlers=function(a,b){var e=this;if(this._nameToGroup[a])t.error("There is already an InputHandler group registered under the name `"+a+"`");else if(0===b.length)t.error("Can't register a group of zero handlers");else{var c={name:a,handlers:b.map(function(a,c){return{handler:a,active:!0,removed:!1,priorityIndex:0,eventCallback:null,uninstallCallback:null}})};this._nameToGroup[a]=c;a=function(a){var b=
c.handlers[a];d._handlers.push(b);b.handler.onInstall({updateDependencies:function(){e.updateDependencies()},emit:function(a,c,d,f){e._emitInputEvent(b.priorityIndex,a,c,d,f)},setPointerCapture:function(a,d){e._setPointerCapture(c,b,a,d)},setEventCallback:function(a){b.eventCallback=a},setUninstallCallback:function(a){b.uninstallCallback=a}})};var d=this;for(b=c.handlers.length-1;0<=b;b--)a(b);this.updateDependencies()}};g.prototype.uninstallHandlers=function(a){var b=this._nameToGroup[a];b?(b.handlers.forEach(function(a){a.removed=
!0;a.uninstallCallback()}),delete this._nameToGroup[a],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):t.error("There is no InputHandler group registered under the name `"+a+"`")};g.prototype.hasHandlers=function(a){return void 0!==this._nameToGroup[a]};g.prototype.updateDependencies=function(){var a=new Set,b=new Set;this._handlersPriority=[];for(var d=this._handlers.length-1;0<=d;d--){var c=this._handlers[d];c.priorityIndex=
d;this._handlersPriority.push(c)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(d=this._handlersPriority.length-1;0<=d;d--){c=this._handlersPriority[d];c.priorityIndex=d;var f=c.handler.hasSideEffects;if(!f)for(var g=0,k=c.handler.outgoingEventTypes;g<k.length;g++)if(a.has(k[g])){f=!0;break}if(f)for(g=0,k=c.handler.incomingEventMatches;g<k.length;g++){var l=k[g];a.add(l.eventType);for(var m=0,l=l.keyModifiers;m<l.length;m++){var h=l[m];e.isSystemModifier(h)||b.add(h)}}c.active=
f}this._sourceEvents=a;this._keyModifiers=b;0<this._pointerCaptures.size&&this._sourceEvents.add("pointer-capture-lost");0<this._keyModifiers.size&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up"));this._browserEvents&&(this._browserEvents.activeEvents=this._sourceEvents)};g.prototype._setLatestPointerType=function(a){this._set("latestPointerType",a)};g.prototype._onEventReceived=function(a,b){"pointer-capture-lost"===a&&this._pointerCaptures.delete(b.native.pointerId);this._updateKeyModifiers(a,
b);this._emitInputEventFromSource(a,b,b.native.timestamp)};g.prototype._updateKeyModifiers=function(a,b){var e=this;if(b){var c=!1,d=function(){if(!c){var a=new Set;e._activeKeyModifiers.forEach(function(c){a.add(c)});e._activeKeyModifiers=a;c=!0}},f=function(a,c){c&&!e._activeKeyModifiers.has(a)?(d(),e._activeKeyModifiers.add(a)):!c&&e._activeKeyModifiers.has(a)&&(d(),e._activeKeyModifiers.delete(a))};if("key-down"===a||"key-up"===a){var g=b.key;this._keyModifiers.has(g)&&f(g,"key-down"===a)}a=b.native;
f("Alt",!(!a||!a.altKey));f("Ctrl",!(!a||!a.ctrlKey));f("Shift",!(!a||!a.shiftKey));f("Meta",!(!a||!a.metaKey));f("Primary",this._activeKeyModifiers.has(this.primaryKey))}};g.prototype._installRecognizers=function(){var a=this;this._latestPointerTypeHandler=new l.LatestPointerType(function(b){return a._setLatestPointerType(b)});0<this._recognizers.length&&this.installHandlers("default",this._recognizers);this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler])};g.prototype._setPointerCapture=
function(a,b,e,c){a=a.name+"-"+b.priorityIndex;b=this._pointerCaptures.get(e.pointerId)||new Set;this._pointerCaptures.set(e.pointerId,b);c?(b.add(a),1===b.size&&this._browserEvents&&this._browserEvents.setPointerCapture(e,!0)):b.has(a)&&(b.delete(a),0===b.size&&(this._pointerCaptures.delete(e.pointerId),this._browserEvents&&this._browserEvents.setPointerCapture(e,!1)))};g.prototype._garbageCollectRemovedHandlers=function(){this._handlers=this._handlers.filter(function(a){return!a.removed});this.updateDependencies()};
g.prototype._emitInputEventFromSource=function(a,b,e){this._emitInputEvent(0,a,b,e)};g.prototype._emitInputEvent=function(a,b,e,c,d){c=void 0!==c?c:this._currentPropagation?this._currentPropagation.timestamp:k();b=new u(b,e,c,d||this._activeKeyModifiers);this._currentPropagation?this._currentPropagation.addedEvents.push(b):this._doNewPropagation(a,b)};g.prototype._doNewPropagation=function(a,b){for(a=this._currentPropagation={events:[b],addedEvents:[],currentHandler:this._handlersPriority[a],needsHandlerGarbageCollect:!1,
timestamp:b.timestamp};a.currentHandler;){if(a.currentHandler.removed)a.needsHandlerGarbageCollect=!0;else{b=a.events;var e=[];a.addedEvents=[];for(var c=0;c<b.length;c++){var d=b[c];a.currentHandler.active&&a.currentHandler.eventCallback(d);d.shouldStopPropagation()||e.push(d)}a.events=e.concat(a.addedEvents)}a.currentHandler=this._handlersPriority[a.currentHandler.priorityIndex+1]}a.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers();this._currentPropagation=null};g.prototype._compareHandlerPriority=
function(a,b){if(a.handler.hasSideEffects!==b.handler.hasSideEffects)return a.handler.hasSideEffects?1:-1;for(var e=0,c=a.handler.incomingEventMatches;e<c.length;e++)for(var d=c[e],f=function(a){if(d.eventType!==a.eventType)return"continue";var c=d.keyModifiers.filter(function(c){return-1!==a.keyModifiers.indexOf(c)});if(c.length===d.keyModifiers.length!==(c.length===a.keyModifiers.length))return{value:d.keyModifiers.length>a.keyModifiers.length?-1:1}},g=0,k=b.handler.incomingEventMatches;g<k.length;g++){var l=
f(k[g]);if("object"===typeof l)return l.value}return a.priorityIndex>b.priorityIndex?-1:1};g.prototype._sortHandlersPriority=function(a){for(var b=[],e=0;e<a.length;e++){for(var c=a[e],d=0;d<b.length&&0<=this._compareHandlerPriority(c,b[d]);)d++;b.splice(d,0,c)}return b};a([m.property({readOnly:!0})],g.prototype,"latestPointerType",void 0);return g=a([m.subclass("esri.views.input.InputManager")],g)}(m.declared(g));h.InputManager=p;var u=function(){function a(a,b,e,d){this.type=a;this.data=b;this.timestamp=
e;this.modifiers=d;this._stopPropagation=!1}a.prototype.stopPropagation=function(){this._stopPropagation=!0};a.prototype.shouldStopPropagation=function(){return this._stopPropagation};return a}()})},"esri/views/input/recognizers":function(){define("require exports ./recognizers/Drag ./recognizers/PointerClickHoldAndDrag ./recognizers/SingleAndDoubleClick ./recognizers/VerticalTwoFingerDrag".split(" "),function(p,h,d,a,g,f){Object.defineProperty(h,"__esModule",{value:!0});h.defaults=[a.PointerClickHoldAndDrag,
g.SingleAndDoubleClick,d.Drag,f.VerticalTwoFingerDrag]})},"esri/views/input/recognizers/Drag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler","./support"],function(p,h,d,a,g){function f(a){var b=[];a.forEach(function(a){b.push(a.event)});return g.fitCircleLSQ(b)}function k(a){var b=f(a),d=0;a.forEach(function(a){for(var f=e(a,b),f=f-a.lastAngle;f>Math.PI;)f-=2*Math.PI;for(;f<-Math.PI;)f+=2*Math.PI;f=a.lastAngle+f;a.lastAngle=f;d+=f-a.initialAngle});
d/=a.size||1;return{angle:d,radius:b.radius,center:b.center}}function m(a){var b=new Map;a.forEach(function(a,e){return b.set(e,a.event)});return b}function e(a,e){a=a.event;return Math.atan2(a.y-e.center.y,a.x-e.center.x)}Object.defineProperty(h,"__esModule",{value:!0});p=function(a){function b(){var b=a.call(this,!1)||this;b.startStateModifiers=new Set;b.activePointerMap=new Map;b.isDragging=!1;b.drag=b.registerOutgoing("drag");b.registerIncoming("pointer-drag",b.handlePointerDrag.bind(b));b.registerIncoming("pointer-up",
b.handlePointerUpAndPointerLost.bind(b));b.registerIncoming("pointer-capture-lost",b.handlePointerUpAndPointerLost.bind(b));return b}d(b,a);b.prototype.createPayload=function(a,b,e,d){return{action:a,pointerType:this.pointerType,button:this.mouseButton,buttons:b.buttons,timestamp:d,pointers:m(this.activePointerMap),pointer:b,angle:e.angle,radius:e.radius,center:e.center}};b.prototype.addPointer=function(a){var b=a.native.pointerId,d=k(this.activePointerMap).angle;a={event:a,initialAngle:0,lastAngle:0};
this.activePointerMap.set(b,a);b=e(a,f(this.activePointerMap));a.initialAngle=b;a.lastAngle=b;this.updatePointerAngles(d)};b.prototype.updatePointer=function(a){if(!a||null!=a.x||null!=a.y){var b=this.activePointerMap.get(a.native.pointerId);b?b.event=a:this.addPointer(a)}};b.prototype.removePointer=function(a){var b=k(this.activePointerMap).angle;this.activePointerMap.delete(a);this.updatePointerAngles(b)};b.prototype.updatePointerAngles=function(a){var b=k(this.activePointerMap);this.activePointerMap.forEach(function(d){d.initialAngle=
e(d,b)-a;d.lastAngle=e(d,b)-a})};b.prototype.emitEvent=function(a,b,e){var d=k(this.activePointerMap);this.drag.emit(this.createPayload(a,b,d,e),void 0,this.startStateModifiers)};b.prototype.handlePointerUpAndPointerLost=function(a){var b=a.data.native.pointerId,e=a.timestamp;this.activePointerMap.get(b)&&(1===this.activePointerMap.size?(this.updatePointer(a.data),this.emitEvent("end",a.data,e),this.isDragging=!1,this.removePointer(b)):(this.removePointer(b),this.emitEvent("removed",a.data,a.timestamp)))};
b.prototype.handlePointerDrag=function(a){var b=a.data,e=b.currentEvent,d=a.timestamp;switch(b.action){case "start":case "update":this.isDragging?this.activePointerMap.has(e.native.pointerId)?(this.updatePointer(e),this.emitEvent("update",e,d)):(this.addPointer(e),this.emitEvent("added",e,d)):(this.updatePointer(e),this.pointerType=a.data.startEvent.pointerType,this.mouseButton=a.data.startEvent.button,this.startStateModifiers=a.modifiers,this.isDragging=!0,this.emitEvent("start",e,d))}};return b}(a.InputHandler);
h.Drag=p;(function(a){a[a.Left=0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right";a[a.Back=3]="Back";a[a.Forward=4]="Forward";a[a.Undefined=-1]="Undefined"})(h.Button||(h.Button={}))})},"esri/views/input/recognizers/support":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});h.manhattanDistance=function(d,a){return Math.abs(a.x-d.x)+Math.abs(a.y-d.y)};h.euclideanDistance=function(d,a){var g=a.x-d.x;d=a.y-d.y;return Math.sqrt(g*g+d*d)};h.fitCircleLSQ=
function(d,a){a?(a.radius=0,a.center.x=0,a.center.y=0):a={radius:0,center:{x:0,y:0}};if(0===d.length)return a;if(1===d.length)return a.center.x=d[0].x,a.center.y=d[0].y,a;if(2===d.length){var g=d[0];d=d[1];var f=[d.x-g.x,d.y-g.y],k=f[0],f=f[1];a.radius=Math.sqrt(k*k+f*f)/2;a.center.x=(g.x+d.x)/2;a.center.y=(g.y+d.y)/2;return a}for(var m=0,e=0,b=0;b<d.length;b++)m+=d[b].x,e+=d[b].y;for(var m=m/d.length,e=e/d.length,l=d.map(function(a){return a.x-m}),h=d.map(function(a){return a.y-e}),u=g=a=0,r=0,v=
k=0,b=f=0;b<l.length;b++){var q=l[b],n=h[b],w=q*q,c=n*n;a+=w;g+=c;u+=q*n;r+=w*q;k+=c*n;v+=q*c;f+=n*w}b=a;l=u;h=g;r=.5*(r+v);k=.5*(k+f);f=b*h-u*l;v=(r*h-k*l)/f;k=(b*k-u*r)/f;return{radius:Math.sqrt(v*v+k*k+(a+g)/d.length),center:{x:v+m,y:k+e}}}})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler","./support"],function(p,h,d,a,g){Object.defineProperty(h,"__esModule",{value:!0});h.DefaultParameters=
{maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilTouchDrag:6,holdDelay:500};p=function(a){function f(d,e,b,f){void 0===d&&(d=h.DefaultParameters.maximumClickDelay);void 0===e&&(e=h.DefaultParameters.movementUntilMouseDrag);void 0===b&&(b=h.DefaultParameters.movementUntilTouchDrag);void 0===f&&(f=h.DefaultParameters.holdDelay);var g=a.call(this,!1)||this;g.maximumClickDelay=d;g.movementUntilMouseDrag=e;g.movementUntilTouchDrag=b;g.holdDelay=f;g._pointerState=new Map;g._pointerDrag=g.registerOutgoing("pointer-drag");
g._immediateClick=g.registerOutgoing("immediate-click");g._pointerHold=g.registerOutgoing("hold");g.registerIncoming("pointer-down",g._handlePointerDown.bind(g));g.registerIncoming("pointer-up",g._handlePointerUpOrLost.bind(g));g.registerIncoming("pointer-capture-lost",g._handlePointerUpOrLost.bind(g));g._moveHandle=g.registerIncoming("pointer-move",g._handlePointerMove.bind(g));g._moveHandle.pause();return g}d(f,a);f.prototype.onUninstall=function(){this._pointerState.forEach(function(a){0!==a.holdTimeout&&
(clearTimeout(a.holdTimeout),a.holdTimeout=0)});a.prototype.onUninstall.call(this)};f.prototype._handlePointerDown=function(a){var e=this,b=a.data,d=b.native.pointerId,f=0;0===this._pointerState.size&&(f=setTimeout(function(){var b=e._pointerState.get(d);b&&(b.isDragging||(e._pointerHold.emit(b.previousEvent,void 0,a.modifiers),b.holdEmitted=!0),b.holdTimeout=0)},this.holdDelay));f={startEvent:b,previousEvent:b,startTimestamp:a.timestamp,isDragging:!1,downButton:b.native.button,holdTimeout:f,modifiers:new Set};
this._pointerState.set(d,f);this.startCapturingPointer(b.native);this._moveHandle.resume();1<this._pointerState.size&&this.startDragging(a)};f.prototype._createPointerDragData=function(a,e,b){return{action:a,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:b}};f.prototype._handlePointerMove=function(a){var e=a.data,b=this._pointerState.get(e.native.pointerId);b&&(b.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",b,e),void 0,b.modifiers):g.euclideanDistance(e,
b.startEvent)>("touch"===e.native.pointerType?this.movementUntilTouchDrag:this.movementUntilMouseDrag)&&this.startDragging(a),b.previousEvent=e)};f.prototype.startDragging=function(a){var e=this,b=a.data,d=b.native.pointerId;this._pointerState.forEach(function(f){0!==f.holdTimeout&&(clearTimeout(f.holdTimeout),f.holdTimeout=0);f.isDragging||(f.modifiers=a.modifiers,f.isDragging=!0,d===f.startEvent.native.pointerId?e._pointerDrag.emit(e._createPointerDragData("start",f,b)):e._pointerDrag.emit(e._createPointerDragData("start",
f,f.previousEvent),a.timestamp))})};f.prototype._handlePointerUpOrLost=function(a){var e=a.data,b=e.native.pointerId,d=this._pointerState.get(b);d&&(0!==d.holdTimeout&&clearTimeout(d.holdTimeout),d.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",d,e),void 0,d.modifiers):d.downButton===e.native.button&&a.timestamp-d.startTimestamp<=this.maximumClickDelay&&!d.holdEmitted&&this._immediateClick.emit(e),this._pointerState.delete(b),this.stopCapturingPointer(e.native),0===this._pointerState.size&&
this._moveHandle.pause())};return f}(a.InputHandler);h.PointerClickHoldAndDrag=p})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler","./support"],function(p,h,d,a,g){Object.defineProperty(h,"__esModule",{value:!0});h.DefaultParameters={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};p=function(a){function f(d,e,b,f){void 0===d&&(d=
h.DefaultParameters.maximumDoubleClickDelay);void 0===e&&(e=h.DefaultParameters.maximumDoubleClickDistance);void 0===b&&(b=h.DefaultParameters.maximumDoubleTouchDelay);void 0===f&&(f=h.DefaultParameters.maximumDoubleTouchDistance);var g=a.call(this,!1)||this;g.maximumDoubleClickDelay=d;g.maximumDoubleClickDistance=e;g.maximumDoubleTouchDelay=b;g.maximumDoubleTouchDistance=f;g._pointerState=new Map;g._click=g.registerOutgoing("click");g._doubleClick=g.registerOutgoing("double-click");g.registerIncoming("immediate-click",
g._handleImmediateClick.bind(g));return g}d(f,a);f.prototype.onUninstall=function(){this._pointerState.forEach(function(a){0!==a.doubleClickTimeout&&(clearTimeout(a.doubleClickTimeout),a.doubleClickTimeout=0)})};f.prototype._pointerId=function(a){a=a.native;return"mouse"===a.pointerType?a.pointerId+":"+a.button:""+a.pointerType};f.prototype._handleImmediateClick=function(a){var e=a.data,b=this._pointerId(e),d=this._pointerState.get(b);if(d){clearTimeout(d.doubleClickTimeout);d.doubleClickTimeout=
0;var f="touch"===e.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;g.manhattanDistance(d.event.data,e)>f?(this._doubleClickTimeoutExceeded(b),this._startClick(a)):(this._doubleClick.emit(e,void 0,d.event.modifiers),this._pointerState.delete(b))}else this._startClick(a)};f.prototype._startClick=function(a){var e=this,b=this._pointerId(a.data);this._pointerState.set(b,{event:a,doubleClickTimeout:setTimeout(function(){return e._doubleClickTimeoutExceeded(b)},"touch"===
a.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)})};f.prototype._doubleClickTimeoutExceeded=function(a){var e=this._pointerState.get(a);this._click.emit(e.event.data,void 0,e.event.modifiers);e.doubleClickTimeout=0;this._pointerState.delete(a)};return f}(a.InputHandler);h.SingleAndDoubleClick=p})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../DragEventSeparator","../InputHandler"],
function(p,h,d,a,g){Object.defineProperty(h,"__esModule",{value:!0});p=function(f){function g(d,e){void 0===d&&(d=20);void 0===e&&(e=40);var b=f.call(this,!1)||this;b._threshold=d;b._maxDelta=e;b.state="ready";b.emittedArtificalEnd2=!1;b._vertical=b.registerOutgoing("vertical-two-finger-drag");b._artificalDrag=b.registerOutgoing("drag");b.dragEventSeparator=new a.DragEventSeparator({start:function(a,e){return b.observeStart(a,e)},update:function(a,e,d){return b.observeUpdate(a,e,d)},end:function(a,
e){return b.observeEnd(a,e)}});b.registerIncoming("drag",function(a){return b.dragEventSeparator.handle(a)});return b}d(g,f);Object.defineProperty(g.prototype,"failed",{get:function(){return"failed"===this.state},enumerable:!0,configurable:!0});g.prototype.observeStart=function(a,e){1===a&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:e.data.button,buttons:e.data.buttons,pointerType:e.data.pointerType,timestamp:e.data.timestamp,pointers:e.data.pointers,
pointer:e.data.pointer,angle:e.data.angle,radius:e.data.radius,center:e.data.center,artifical:!0}),e.stopPropagation());this.state=2===a?"ready":"failed"};g.prototype.observeUpdate=function(a,e,b){"failed"!==this.state&&2===a&&("active"===this.state?(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"update"}),e.stopPropagation()):this.checkMovementWithinLimits(e.data,b.data)?this.checkVerticalThresholdReached(e.data,b.data)&&(this.state="active",this.emittedArtificalEnd2=
!0,this._thresholdReachedCenter=e.data.center,this._artificalDrag.emit({action:"end",button:e.data.button,buttons:e.data.buttons,pointerType:e.data.pointerType,timestamp:e.data.timestamp,pointers:e.data.pointers,pointer:e.data.pointer,angle:e.data.angle,radius:e.data.radius,center:e.data.center,artifical:!0}),this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),e.stopPropagation()):this.state="failed")};g.prototype.observeEnd=function(a,e){"active"===this.state&&
(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",e.stopPropagation())};g.prototype.checkMovementWithinLimits=function(a,e){var b=-Infinity,d=Infinity,f=-Infinity,g=Infinity;e.pointers.forEach(function(a){b=Math.max(b,a.x);d=Math.min(d,a.x);f=Math.max(f,a.y);g=Math.min(g,a.y)});var k=-Infinity,h=Infinity,m=-Infinity,n=Infinity;a.pointers.forEach(function(a){k=Math.max(k,a.x);h=Math.min(h,a.x);m=Math.max(m,a.y);n=Math.min(n,a.y)});return Math.abs(a.center.x-
e.center.x)<this._threshold&&Math.abs(k-h-(b-d))<=this._maxDelta&&Math.abs(m-n-(f-g))<=this._maxDelta};g.prototype.checkVerticalThresholdReached=function(a,e){var b=Math.abs(a.center.y-e.center.y);a.pointers.forEach(function(a,d){d=e.pointers.get(d);b=Math.min(b,Math.abs(a.y-d.y))});return b>=this._threshold};return g}(g.InputHandler);h.VerticalTwoFingerDrag=p})},"esri/views/input/DragEventSeparator":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});
p=function(){function d(a){this.callbacks=a;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=function(){return!0})}d.prototype.handle=function(a){var d=a.data,f=d.pointers.size;switch(d.action){case "start":this.currentCount=f;this.emitStart(a);break;case "added":this.emitEnd(this.previousEvent);this.currentCount=f;this.emitStart(a);break;case "update":this.emitUpdate(a);break;case "removed":this.startEvent&&this.emitEnd(this.previousEvent);this.currentCount=f;this.emitStart(a);
break;case "end":this.emitEnd(a),this.currentCount=0}this.previousEvent=a};d.prototype.emitStart=function(a){this.startEvent=a;this.callbacks.condition(this.currentCount,a)&&this.callbacks.start(this.currentCount,a,this.startEvent)};d.prototype.emitUpdate=function(a){this.callbacks.condition(this.currentCount,a)&&this.callbacks.update(this.currentCount,a,this.startEvent)};d.prototype.emitEnd=function(a){this.callbacks.condition(this.currentCount,a)&&this.callbacks.end(this.currentCount,a,this.startEvent);
this.startEvent=null};return d}();h.DragEventSeparator=p})},"esri/views/input/handlers/LatestPointerType":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});p=function(a){function f(d){var f=a.call(this,!0)||this;f._onChange=d;f._value="mouse";f.registerIncoming("pointer-down",function(a){f._setValue("touch"===a.data.native.pointerType?"touch":"mouse")});f._moveHandler=f.registerIncoming("pointer-move",
function(a){f._setValue("touch"===a.data.native.pointerType?"touch":"mouse")});f._moveHandler.pause();return f}d(f,a);f.prototype._setValue=function(a){a!==this._value&&("touch"===a?this._moveHandler.resume():this._moveHandler.pause(),this._value=a,this._onChange(a))};return f}(a.InputHandler);h.LatestPointerType=p})},"esri/views/input/ViewEvents":function(){define("require exports ../../core/tsSupport/extendsHelper ../../geometry/ScreenPoint ../3d/support/mathUtils ./InputHandler".split(" "),function(p,
h,d,a,g,f){function k(a){return!!e[a]}function m(a){for(var b=0;b<a.length;b++)if(!k(a[b]))return!1;return!0}Object.defineProperty(h,"__esModule",{value:!0});var e={click:!0,"double-click":!0,"immediate-click":!0,hold:!0,drag:!0,"key-down":!0,"key-up":!0,"pointer-down":!0,"pointer-move":!0,"pointer-up":!0,"pointer-drag":!0,"mouse-wheel":!0,"pointer-enter":!0,"pointer-leave":!0},b;(function(a){a[a.Left=0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right"})(b||(b={}));p=function(){function a(a){this.handlers=
new Map;this.counter=0;this.handlerCounts=new Map;this.view=a;this.inputManager=null}a.prototype.connect=function(a){var b=this;a&&this.disconnect();this.inputManager=a;this.handlers.forEach(function(a,e){return b.inputManager.installHandlers(e,[a])})};a.prototype.disconnect=function(){var a=this;this.inputManager&&this.handlers.forEach(function(b,e){return a.inputManager.uninstallHandlers(e)});this.inputManager=null};a.prototype.destroy=function(){this.disconnect();this.handlers.clear();this.view=
null};a.prototype.register=function(a,b,e){var d=this,f=Array.isArray(a)?a:a.split(",");if(!m(f))return f.some(k)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;a=Array.isArray(b)?b:[];e=Array.isArray(b)?e:b;var g=this.createUniqueGroupName();b=new l(this.view,f,a,e);this.handlers.set(g,b);for(e=0;e<f.length;e++){a=f[e];var c=this.handlerCounts.get(a)||0;this.handlerCounts.set(a,c+1)}this.inputManager&&this.inputManager.installHandlers(g,
[b]);return{remove:function(){return d.removeHandler(g,f)}}};a.prototype.hasHandler=function(a){return!!this.handlerCounts.get(a)};a.prototype.removeHandler=function(a,b){if(this.handlers.has(a)){this.handlers.delete(a);for(var e=0;e<b.length;e++){var d=b[e],f=this.handlerCounts.get(d);void 0===f?console.error("Trying to remove handler for event that has no handlers registered: ",d):1===f?this.handlerCounts.delete(d):this.handlerCounts.set(d,f-1)}}this.inputManager&&this.inputManager.uninstallHandlers(a)};
a.prototype.createUniqueGroupName=function(){this.counter+=1;return"viewEvents_"+this.counter};return a}();h.ViewEvents=p;var l=function(b){function e(a,e,d,f){var g=b.call(this,!0)||this;g.view=a;for(a=0;a<e.length;a++)switch(e[a]){case "click":g.registerIncoming("click",d,function(a){return f(g.wrapClick(a))});break;case "double-click":g.registerIncoming("double-click",d,function(a){return f(g.wrapDoubleClick(a))});break;case "immediate-click":g.registerIncoming("immediate-click",d,function(a){return f(g.wrapImmediateClick(a))});
break;case "hold":g.registerIncoming("hold",d,function(a){return f(g.wrapHold(a))});break;case "drag":g.registerIncoming("drag",d,function(a){return f(g.wrapDrag(a))});break;case "key-down":g.registerIncoming("key-down",d,function(a){return f(g.wrapKeyDown(a))});break;case "key-up":g.registerIncoming("key-up",d,function(a){return f(g.wrapKeyUp(a))});break;case "pointer-down":g.registerIncoming("pointer-down",d,function(a){return f(g.wrapPointer(a,"pointer-down"))});break;case "pointer-move":g.registerIncoming("pointer-move",
d,function(a){return f(g.wrapPointer(a,"pointer-move"))});break;case "pointer-up":g.registerIncoming("pointer-up",d,function(a){return f(g.wrapPointer(a,"pointer-up"))});break;case "pointer-drag":g.registerIncoming("pointer-drag",d,function(a){return f(g.wrapPointerDrag(a))});break;case "mouse-wheel":g.registerIncoming("mouse-wheel",d,function(a){return f(g.wrapMouseWheel(a))});break;case "pointer-enter":g.registerIncoming("pointer-enter",d,function(a){return f(g.wrapPointer(a,"pointer-enter"))});
break;case "pointer-leave":g.registerIncoming("pointer-leave",d,function(a){return f(g.wrapPointer(a,"pointer-leave"))})}return g}d(e,b);e.prototype.wrapClick=function(b){var e=b.data,d=e.x,f=e.y;return{type:"click",pointerType:e.pointerType,button:e.button,buttons:e.buttons,x:d,y:f,native:e.native,timestamp:b.timestamp,screenPoint:new a(d,f),mapPoint:this.view.toMap(d,f),stopPropagation:function(){return b.stopPropagation()}}};e.prototype.wrapDoubleClick=function(a){var b=a.data,e=b.x,d=b.y;return{type:"double-click",
pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:e,y:d,native:b.native,timestamp:a.timestamp,mapPoint:this.view.toMap(e,d),stopPropagation:function(){return a.stopPropagation()}}};e.prototype.wrapImmediateClick=function(a){var b=a.data,e=b.x,d=b.y;return{type:"immediate-click",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:e,y:d,native:b.native,timestamp:a.timestamp,mapPoint:this.view.toMap(e,d),stopPropagation:function(){return a.stopPropagation()}}};e.prototype.wrapHold=
function(a){var b=a.data,e=b.x,d=b.y;return{type:"hold",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:e,y:d,native:b.native,timestamp:a.timestamp,mapPoint:this.view.toMap(e,d),stopPropagation:function(){return a.stopPropagation()}}};e.prototype.wrapDrag=function(a){var b=a.data,e=b.center,d=e.x,e=e.y,f=b.action,c=b.pointerType,k=b.button;"start"===f&&(this.latestDragStart=b);var l=b.pointer.native,h=a.timestamp;return{type:"drag",action:f,x:d,y:e,origin:{x:this.latestDragStart.center.x,
y:this.latestDragStart.center.y},pointerType:c,button:k,buttons:b.buttons,radius:b.radius,angle:g.rad2deg(b.angle),native:l,timestamp:h,stopPropagation:function(){return a.stopPropagation()}}};e.prototype.wrapKeyDown=function(a){var b=a.data;return{type:"key-down",key:b.key,repeat:b.repeat,native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};e.prototype.wrapKeyUp=function(a){var b=a.data;return{type:"key-up",key:b.key,native:b.native,timestamp:a.timestamp,
stopPropagation:function(){return a.stopPropagation()}}};e.prototype.wrapPointer=function(a,b){var e=a.data,d=e.native;return{type:b,x:e.x,y:e.y,pointerId:d.pointerId,pointerType:d.pointerType,button:e.button,buttons:e.buttons,native:d,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};e.prototype.wrapPointerDrag=function(a){var b=a.data.currentEvent,e=a.data.startEvent.native;return{type:"pointer-drag",x:b.x,y:b.y,pointerId:e.pointerId,pointerType:e.pointerType,button:a.data.startEvent.button,
buttons:b.buttons,action:a.data.action,origin:{x:a.data.startEvent.x,y:a.data.startEvent.y},native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};e.prototype.wrapMouseWheel=function(a){var b=a.data;return{type:"mouse-wheel",x:b.x,y:b.y,deltaY:b.deltaY,native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};return e}(f.InputHandler)})},"esri/views/input/handlers/PreventContextMenu":function(){define(["require","exports",
"../../../core/tsSupport/extendsHelper","../InputHandler"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});p=function(a){function f(){var d=a.call(this,!0)||this;d.registerIncoming("context-menu",function(a){a.data.native.preventDefault()});return d}d(f,a);return f}(a.InputHandler);h.PreventContextMenu=p;h.default=p})},"esri/views/3d/layers/GraphicsView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/promiseUtils ../../../core/accessorSupport/decorators ./graphics/Graphics3DCore ./graphics/Graphics3DElevationAlignment ./graphics/Graphics3DSpatialIndex ../../layers/GraphicsView".split(" "),
function(p,h,d,a,g,f,k,m,e,b){return function(b){function l(){var a=null!==b&&b.apply(this,arguments)||this;a.graphicsCore=null;a.spatialIndex=null;a.elevationAlignment=null;a.supportsDraping=!0;a._overlayUpdating=!1;a._eventHandles=[];return a}d(l,b);Object.defineProperty(l.prototype,"graphics",{set:function(a){a!==this.loadedGraphics&&(this.loadedGraphics=a);this._set("graphics",a)},enumerable:!0,configurable:!0});l.prototype.initialize=function(){var a=this;this.mockLayerId="__sceneView.graphics-"+
Date.now().toString(16);this.spatialIndex=new e;this.spatialIndex.whenLoaded().then(function(){return a.deferredInitialize()})};l.prototype.deferredInitialize=function(){var a=this;if(!this.destroyed){this.loadedGraphics=this.graphics;this.graphicsCore=new k;this.elevationAlignment=new m;var b={id:this.mockLayerId,uid:this.mockLayerId};this.spatialIndex.initialize(this,b,this.view.spatialReference,this.graphicsCore);this.elevationAlignment.initialize(this,function(b,e,d){a.spatialIndex.intersects(b,
e,d)},this.graphicsCore,this.view.elevationProvider);this.graphicsCore.initialize(this,b,this.elevationAlignment,null,this.spatialIndex,null,null,null,null,this.view.basemapTerrain);this._eventHandles.push(this.view.watch("clippingArea",function(){return a.updateClippingExtent()}));this.updateClippingExtent();this.view.resourceController.registerIdleFrameWorker(this,{needsUpdate:this._needsIdleUpdate,idleFrame:this._idleUpdate})}};l.prototype.destroy=function(){this._eventHandles.forEach(function(a){return a.remove()});
this._eventHandles=null;this.view.resourceController.deregisterIdleFrameWorker(this);this.spatialIndex&&(this.spatialIndex.destroy(),this.spatialIndex=null);this.elevationAlignment&&(this.elevationAlignment.destroy(),this.elevationAlignment=null);this.graphicsCore&&(this.graphicsCore.destroy(),this.graphicsCore=null);this.loadedGraphics=null};l.prototype.getGraphicsFromStageObject=function(a,b){var e=a.getMetadata().graphicId,d=null;this.loadedGraphics&&this.loadedGraphics.some(function(a){return a.uid===
e?(d=a,!0):!1});return g.create(function(a,b){null!==d?a(d):b()})};l.prototype.whenGraphicBounds=function(a,b){var e=this;return this.spatialIndex?this.spatialIndex.whenLoaded().then(function(){return e.graphicsCore?e.graphicsCore.whenGraphicBounds(a,b):g.reject()}):g.reject()};l.prototype._needsIdleUpdate=function(){return this.elevationAlignment.needsIdleUpdate()};l.prototype._idleUpdate=function(a){this.elevationAlignment.idleUpdate(a)};l.prototype._notifySuspendedChange=function(){};l.prototype._notifyDrapedDataChange=
function(){this.view.basemapTerrain&&this.view.basemapTerrain.overlayManager.setOverlayDirty()};l.prototype._evaluateUpdatingState=function(){if(this.elevationAlignment){var a;a=0+this.elevationAlignment.numNodesUpdating();a+=this.graphicsCore.numNodesUpdating();this.updating=a=(a=(a=0<a||this._overlayUpdating)||this.spatialIndex.isUpdating())||this.graphicsCore.needsIdleUpdate()}else this.updating=!1};l.prototype.updateClippingExtent=function(){this.graphicsCore.setClippingExtent(this.view.clippingArea,
this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()};a([f.property()],l.prototype,"graphics",null);a([f.property()],l.prototype,"loadedGraphics",void 0);a([f.property({value:!0})],l.prototype,"updating",void 0);a([f.property({value:!1})],l.prototype,"suspended",void 0);return l=a([f.subclass("esri.views.3d.layers.GraphicsView3D")],l)}(f.declared(b))})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper dojo/Deferred ../../../../core/arrayUtils ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../geometry/Extent ../../../../geometry/Point ../../../../renderers/UniqueValueRenderer ../../../../renderers/support/diffUtils ../../../../renderers/support/rendererConversion ../../../../symbols/LabelSymbol3D ../../../../symbols/TextSymbol ../../../../symbols/WebStyleSymbol ../../../../symbols/support/symbolConversion ../../../../symbols/support/unitConversionUtils ./ElevationQuery ./featureExpressionInfoUtils ./Graphics3DGraphic ./Graphics3DOwner ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./graphicUtils ../../lib/glMatrix ../../support/aaBoundingBox ../../support/mathUtils ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/FloatingBoxLocalOriginFactory ../../webgl-engine/lib/Layer ../../webgl-engine/lib/Util".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x,z,A,y,B,E,C,G,J,F,I,H,K,L,M,V){function S(a){(a=a.elevationInfo&&a.elevationInfo.unit)&&!x.supportsUnit(a)&&N.warn("elevationInfo.unit","'"+a+"' is not a valid unit")}p=J.vec3d;var Z=new t,R=p.create(),N=m.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");return function(){function h(a){void 0===a&&(a=!0);this.elevationFeatureExpressionEnabled=a;this.graphics={};this.graphicsDrapedIds={};this.graphicsBySymbol={};this.graphicsKeys=[];this.symbols=
{};this.graphicsWithoutSymbol={};this.computedExtent=null;this.symbolCreationContext=new B.Graphics3DSymbolCreationContext;this.hasDraped=!1;this.updatingGraphicIds=new Set;this.graphicTransformFunc=this.onComputedExtentChange=this.stage=this.labelStageLayer=this.stageLayer=this.tilingSchemeHandle=this.lastFastUpdate=null;this.eventHandles=[];this.sharedSymbolResourcesOwnerHandle=this.highlights=this.elevationQueryView=this.elevationQueryService=this.labeling=this.spatialIndex=this.scaleVisibility=
this.elevation=this.layer=this.layerView=this.viewSR=null;this.whenGraphics3DGraphicRequests={}}h.prototype.initialize=function(a,c,e,d,f,g,k,l,n,m){var q=this;this.layerView=a;this.layer=c;this.viewSR=a.view.spatialReference;this.elevation=e;this.scaleVisibility=d;this.spatialIndex=f;this.labeling=g;this.highlights=k;this.onComputedExtentChange=l;this.graphicTransformFunc=n;var r=this.layerView.view;this.elevationQueryService=new z.ElevationQuery(this.viewSR,function(){return r.map.ground},{maximumAutoTileRequests:4});
this.elevationQueryView=new z.ElevationQueryView(this.viewSR,r.basemapTerrain);this.initializeStage(r,this.layer.uid);this.symbolCreationContext.sharedResources=r.sharedSymbolResources;this.sharedSymbolResourcesOwnerHandle=r.sharedSymbolResources.addGraphicsOwner(this);this.symbolCreationContext.renderer=this.layer.renderer;this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataSupplier=r.sharedSymbolResources.streamDataSupplier;this.symbolCreationContext.renderSpatialReference=
r.renderSpatialReference;this.symbolCreationContext.renderCoordsHelper=r.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.layerView=this.layerView;this.symbolCreationContext.layerOrder=0;this.symbolCreationContext.localOriginFactory=h.createLocalOriginFactory();this.symbolCreationContext.elevationProvider=r.elevationProvider;S(this.layer);c=A.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=
A.createContext(c,this.viewSR,N);r.deconflictor.addGraphicsOwner(this);this.symbolCreationContext.screenSizePerspectiveEnabled=r.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.tilingSchemeHandle=b.when(m,"tilingScheme",function(a){a.spatialReference.equals(q.symbolCreationContext.overlaySR)||(q.symbolCreationContext.overlaySR=m.spatialReference,q.recreateAllGraphics())});this.eventHandles.push(this.layerView.watch("suspended",function(){return q.suspendedChange()}));this.eventHandles.push(this.layerView.watch("layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled",
function(){q.symbolCreationContext.screenSizePerspectiveEnabled=r.screenSizePerspectiveEnabled&&q.layer.screenSizePerspectiveEnabled;q.recreateAllGraphics()}));this.eventHandles.push(b.on(a,"loadedGraphics","change",function(a){return q.graphicsCollectionChanged(a)},function(){q.clearSymbolsAndGraphics();q.graphicsCollectionChanged({added:q.layerView.loadedGraphics.toArray(),removed:[]})}));this.validateRenderer(this.layer.renderer)};h.prototype.destroy=function(){var a=this;this.layerView.view.deconflictor.removeGraphicsOwner(this);
this.clear();if(this.stage){var c=[this.stageLayer.id];this.labelStageLayer&&c.push(this.labelStageLayer.id);this.stage.removeFromViewContent(c);c.forEach(function(c){return a.stage.remove(K.ModelContentType.LAYER,c)});this.stage=this.labelStageLayer=this.stageLayer=null}this.tilingSchemeHandle&&(this.tilingSchemeHandle.remove(),this.tilingSchemeHandle=null);this.eventHandles.forEach(function(a){return a.remove()});this.layerView=this.labeling=this.scaleVisibility=this.viewSR=this.onComputedExtentChange=
this.eventHandles=null;for(var b in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[b].reject(new k("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null;this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null)};h.prototype.clear=function(){var a=!1,c;for(c in this.graphics){var b=this.graphics[c],a=a||b.isDraped();b.destroy()}this.graphics={};this.graphicsKeys=
null;for(var e in this.symbols)(c=this.symbols[e])&&c.destroy();this.symbols={};this.graphicsBySymbol={};this.graphicsWithoutSymbol={};this.hasDraped=!1;a&&this.layerView._notifyDrapedDataChange()};h.prototype.initializeStage=function(a,c){this.stage=a._stage;this.stageLayer=new M(c,{isPickable:!this.layerView.suspended},c);this.stage.add(K.ModelContentType.LAYER,this.stageLayer);a=[this.stageLayer.id];this.labeling&&(this.labelStageLayer=new M(c,{isPickable:!1},c+"_labels"),this.stage.add(K.ModelContentType.LAYER,
this.labelStageLayer),a.push(this.labelStageLayer.id));this.stage.addToViewContent(a)};h.prototype.setDrawingOrder=function(a){this.symbolCreationContext.layerOrder=a;var c={},b={},e;for(e in this.graphics)this.graphics[e].setDrawOrder(a,c,b);for(var d in b)(b=this.symbols[d])&&b.setDrawOrder(a,c);V.objectEmpty(c)||(this.stage.getTextureGraphicsRenderer().updateRenderOrder(c),this.layerView._notifyDrapedDataChange())};h.prototype.suspendedChange=function(){!0===this.layerView.suspended?(this.stageLayer.isPickable=
!1,this.hideAllGraphics()):!1===this.layerView.suspended&&(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility())};h.prototype.getGraphics3DGraphics=function(){return this.graphics};h.prototype.getGraphics3DGraphicById=function(a){return this.graphics[a]};h.prototype.getGraphics3DGraphicsKeys=function(){null===this.graphicsKeys&&(this.graphicsKeys=Object.keys(this.graphics));return this.graphicsKeys};h.prototype.labelsEnabled=function(){return!(!this.labeling||!this.labeling.layerLabelsEnabled())};
h.prototype.getSymbolUpdateType=function(){var a=0,c=0,b=0,e;for(e in this.symbols){var d=this.symbols[e];d&&(d=d.getFastUpdateStatus(),a+=d.loading,b+=d.fast,c+=d.slow)}return 0<a?"unknown":0<=b&&0===c?"fast":0<=c&&0===b?"slow":"mixed"};h.prototype.numNodesUpdating=function(){return this.updatingGraphicIds.size};h.prototype.needsIdleUpdate=function(){return!!this.lastFastUpdate&&500<performance.now()-this.lastFastUpdate};h.prototype.idleUpdate=function(a){a.done()||(this.lastFastUpdate&&(this.labeling&&
this.labeling.updateLabelingInfo(),this.lastFastUpdate=null),this.layerView._evaluateUpdatingState())};h.prototype.whenGraphics3DGraphic=function(a){var c=this.graphics[a.uid];if(c)return e.resolve(c);c=this.whenGraphics3DGraphicRequests[a.uid];c||(c=new g,this.whenGraphics3DGraphicRequests[a.uid]=c);return c.promise};h.prototype.boundsForGraphics3DGraphic=function(c,b){return a(this,void 0,void 0,function(){var a,e,f,g,k,l,n,h,m,q;return d(this,function(d){switch(d.label){case 0:return a=this.layerView.view.spatialReference,
e=this.layerView.view.renderSpatialReference,f=this.layerView.view.basemapTerrain.spatialReference,g=function(c,b,d){return H.bufferToBuffer(c,e,b,c,a,b,d)},k=function(c,b,e){return H.bufferToBuffer(c,f,b,c,a,b,e)},l=b&&b.useViewElevation?this.elevationQueryView:this.elevationQueryService,[4,c.getProjectedBoundingBox(g,k,l)];case 1:n=d.sent();if(!n)return[2,null];h=n.boundingBox;n.requiresDrapedElevation&&(m=this.symbolCreationContext.elevationProvider)&&(F.center(h,R),Z.x=R[0],Z.y=R[1],Z.z=void 0,
Z.spatialReference=a,q=m.getElevation(Z)||0,h[2]=Math.min(h[2],q),h[5]=Math.max(h[5],q));return[2,{boundingBox:h,screenSpaceObjects:n.screenSpaceObjects}]}})})};h.prototype.whenGraphicBounds=function(a,c){var e=this;return b.whenOnce(this.layerView,"loadedGraphics").then(function(){var c=e.layerView.layer&&e.layerView.layer.objectIdField,b=e.layerView.loadedGraphics.find(function(b){return b===a||c&&b.attributes&&a.attributes&&b.attributes[c]===a.attributes[c]?!0:!1});if(b)return e.whenGraphics3DGraphic(b);
throw new k("internal:graphic-not-part-of-view","Graphic is not part of this view");}).then(function(a){return e.boundsForGraphics3DGraphic(a,c)})};h.prototype.graphicsCollectionChanged=function(a){var c=this.graphicTransformFunc?this.graphicTransformFunc(a.added):a.added;this.add(c);this.remove(a.removed)};h.prototype.graphicUpdateHandler=function(a){var c=this.graphics[a.graphic.uid];if(c)switch(a.property){case "visible":c.setVisibilityFlag(0,a.newValue)&&(c.isDraped()&&this.layerView._notifyDrapedDataChange(),
this.labeling&&this.layerView.view.deconflictor.setDirty())}};h.prototype.beginGraphicUpdate=function(a){this.updatingGraphicIds.add(a.uid);"symbolsUpdating"in this.layerView&&!this.layerView.get("symbolsUpdating")&&this.layerView.set("symbolsUpdating",!0);this.layerView._evaluateUpdatingState()};h.prototype.endGraphicUpdate=function(a){a&&this.updatingGraphicIds.delete(a.uid);"symbolsUpdating"in this.layerView&&this.layerView.get("symbolsUpdating")&&0===this.updatingGraphicIds.size&&(this.layerView.view.flushDisplayModifications(),
this.layerView.set("symbolsUpdating",!1));this.layerView._evaluateUpdatingState()};h.prototype.expandComputedExtent=function(a){var c,b,e,d,f,g;if("point"===a.type)c=b=a.x,e=d=a.y,a.z&&(f=g=a.z);else if("polygon"===a.type||"polyline"===a.type||"multipoint"===a.type){g=a.extent;if(!g)return;c=g.xmin;b=g.xmax;e=g.ymin;d=g.ymax;f=g.zmin;g=g.zmax}var k=this.viewSR,n=h.tmpVec;!a.spatialReference.equals(k)&&H.xyzToVector(c,e,0,a.spatialReference,n,k)&&(c=n[0],e=n[1],H.xyzToVector(b,d,0,a.spatialReference,
n,k),b=n[0],d=n[1]);if(I.isFinite(c)&&I.isFinite(b)&&I.isFinite(e)&&I.isFinite(d)){(k=this.computedExtent)?(c<k.xmin&&(k.xmin=c),b>k.xmax&&(k.xmax=b),e<k.ymin&&(k.ymin=e),d>k.ymax&&(k.ymax=d)):this.computedExtent=k=new l(c,e,b,d,a.spatialReference);if(I.isFinite(f)&&!I.isFinite(g)){if(null==k.zmin||f<k.zmin)k.zmin=f;if(null==k.zmax||g>k.zmax)k.zmax=g}this.onComputedExtentChange&&this.onComputedExtentChange()}};h.prototype.updateHasDraped=function(){this.hasDraped=!1;for(var a in this.graphicsDrapedIds)if(this.graphicsDrapedIds.hasOwnProperty(a)){this.hasDraped=
!0;break}};h.prototype.elevationInfoChange=function(){S(this.layer);var a=A.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=A.createContext(a,this.viewSR,N);this.labeling&&this.labeling.elevationInfoChange();this.layer.renderer!==this.symbolCreationContext.renderer&&this.rendererChange(this.layer.renderer);for(var c in this.graphicsBySymbol){var b=this.symbols[c],a=this.graphicsBySymbol[c];if(b&&b.layerPropertyChanged("elevationInfo",
a)){for(var e in a){var d=a[e],b=d.graphic,d=d._labelGraphics;this.elevation&&this.elevation.markGraphicElevationDirty(b.uid);for(var f=0;f<d.length;f++){var g=d[f];g.graphics3DSymbolLayer.updateGraphicElevationContext(b,g)}}this.layerView._evaluateUpdatingState()}else this._recreateSymbol(c)}};h.prototype.clearSymbolsAndGraphics=function(){this.clear();this.elevation&&this.elevation.clear();this.labeling&&this.labeling.clear()};h.prototype.recreateAllGraphics=function(){this.clearSymbolsAndGraphics();
this.computedExtent=null;this.onComputedExtentChange&&this.onComputedExtentChange();this.layerView.loadedGraphics&&this.layerView.view.basemapTerrain.tilingScheme&&this.add(this.layerView.loadedGraphics.toArray())};h.prototype._recreateSymbol=function(a){var c=this.graphicsBySymbol[a],b=[],e=!1,d;for(d in c){var f=c[d];f.isDraped()&&(delete this.graphicsDrapedIds[d],e=!0);b.push(f.graphic);f.destroy();delete this.graphics[d]}this.graphicsBySymbol[a]={};(c=this.symbols[a])&&c.destroy();delete this.symbols[a];
this.updateHasDraped();e&&this.layerView._notifyDrapedDataChange();this.add(b)};h.prototype.add=function(a){if(this.layerView.view.basemapTerrain&&this.layerView.view.basemapTerrain.tilingScheme){for(var c=a.length,b=Array(c),e=Array(c),d=Array(c),f=!1,g=0;g<c;g++){var k=a[g],l=k.geometry;if(l)if(this.expandComputedExtent(l),l=this.layerView.getRenderingInfo?this.layerView.getRenderingInfo(k):{symbol:k.symbol},this.graphicsWithoutSymbol[k.uid]=k,l&&l.symbol){if(e[g]=l.symbol,d[g]=l,l=this.getOrCreateGraphics3DSymbol(e[g],
l.renderer))b[g]=l,this.beginGraphicUpdate(k)}else f||(f=!0,N.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render"))}for(g=0;g<c;g++)this.waitForSymbol(b[g],e[g],a[g],d[g])}};h.prototype.waitForSymbol=function(a,c,b,e){var d=this;a&&a.then(function(){d.createGraphics3DGraphic(a,b,e);d.endGraphicUpdate(b);d.labeling&&d.layerView.view.deconflictor.setDirty()},function(){d.endGraphicUpdate(b)})};h.prototype.remove=function(a){for(var c=!1,b=a.length,e=0;e<b;e++){var d=a[e].uid,
f=this.graphics[d];if(f){f.isDraped()&&(delete this.graphicsDrapedIds[d],c=!0);var g=f.graphics3DSymbol.symbol.id;f.destroy();delete this.graphics[d];delete this.graphicsBySymbol[g][d];delete this.graphicsWithoutSymbol[d];this.graphicsKeys=null}}this.updateHasDraped();c&&this.layerView._notifyDrapedDataChange();this.layerView.view.deconflictor.setDirty()};h.prototype.hasLabelingContext=function(a){if(a instanceof q||a instanceof n){var c=this.symbolCreationContext.layer;return c.labelingInfo?c.labelingInfo.some(function(c){return c.symbol===
a}):!1}return!1};h.prototype.hasValidSymbolCreationContext=function(a){return a instanceof q&&!this.hasLabelingContext(a)?(N.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};h.prototype.createGraphics3DSymbol=function(a,b){if(!this.hasValidSymbolCreationContext(a))return null;a=c.to3D(a,!0,!1,this.hasLabelingContext(a));if(a.symbol){var e=void 0;b&&b.backgroundFillSymbol&&(b=c.to3D(b.backgroundFillSymbol,!1,!0),b.symbol&&
(e=b.symbol.symbolLayers));return E.make(a.symbol,this.symbolCreationContext,e)}a.error&&N.error(a.error.message);return null};h.prototype.getOrCreateGraphics3DSymbol=function(a,c){var b=this,e=this.symbols[a.id];void 0===e&&(e=a instanceof w?new C(a,function(a){return b.createGraphics3DSymbol(a,c)}):this.createGraphics3DSymbol(a,c),this.symbols[a.id]=e);return e};h.prototype.createGraphics3DGraphic=function(a,c,b){delete this.graphicsWithoutSymbol[c.uid];if(!this.symbols[a.symbol.id])this.add([c]);
else if(!this.graphics[c.uid]){b=a.createGraphics3DGraphic(c,b);this.graphics[c.uid]=b;this.graphicsKeys=null;this.graphicsBySymbol[a.symbol.id]||(this.graphicsBySymbol[a.symbol.id]={});this.graphicsBySymbol[a.symbol.id][c.uid]=b;b.initialize(this.stageLayer,this.stage);b.isDraped()&&(this.hasDraped=this.graphicsDrapedIds[c.uid]=!0,this.layerView._notifyDrapedDataChange());b.centroid=null;"point"!==c.geometry.type&&b instanceof y&&(b.centroid=G.computeCentroid(c.geometry,this.viewSR));a=this.scaleVisibility&&
this.scaleVisibility.scaleRangeActive();this.spatialIndex&&this.spatialIndex.shouldAddToSpatialIndex(c,b,a)&&this.spatialIndex.addGraphicToSpatialIndex(c,b);this.labeling&&this.labeling.layerLabelsEnabled()&&this.labeling.createLabelsForGraphic(c,b);a&&this.scaleVisibility.updateGraphicScaleVisibility(c,b);b.setVisibilityFlag(0,c.visible&&!this.layerView.suspended);if(a=this.whenGraphics3DGraphicRequests[c.uid])delete this.whenGraphics3DGraphicRequests[c.uid],a.resolve(b);this.highlights&&this.highlights.graphicCreated(b)}};
h.prototype.rendererChange=function(a){var c=this.symbolCreationContext.renderer;if(a!==c){this.validateRenderer(a);var b=r.diff(c,a);this.updateUnchangedSymbolMappings(b,a,c);this.symbolCreationContext.renderer=a;b&&("complete"===b.type?this.recreateAllGraphics():"partial"===b.type&&(this.applyRendererDiff(b,a,c)?this.volatileGraphicsUpdated():this.recreateAllGraphics()))}};h.prototype.diffHasSymbolChange=function(a){for(var c in a.diff)switch(c){case "visualVariables":break;case "defaultSymbol":break;
case "uniqueValueInfos":break;case "authoringInfo":case "fieldDelimiter":delete a.diff[c];break;default:return!0}return!1};h.prototype.applySymbolSetDiff=function(a,c,b,e){e=!1;a=a||[];c=c||[];for(var d=[],f=0;f<c.length;f++){var g=c[f],k=this.graphicsBySymbol[g.id],l;for(l in k){var n=k[l],h=n.graphic;if(g!==b.defaultSymbol||b.getSymbol(h)!==b.defaultSymbol)n.isDraped()&&(delete this.graphicsDrapedIds[l],e=!0),a.length||b.defaultSymbol?d.push(h):this.graphicsWithoutSymbol[l]=h,n.destroy(),this.highlights&&
this.highlights.graphicDeleted(this.graphics[l]),delete k[l],delete this.graphics[l],this.graphicsKeys=null}if(void 0===k||0===Object.keys(k).length)delete this.graphicsBySymbol[g.id],(k=this.symbols[g.id])&&k.destroy(),delete this.symbols[g.id]}if(a.length||d.length){for(l in this.graphicsWithoutSymbol)d.push(this.graphicsWithoutSymbol[l]);this.graphicsWithoutSymbol={};this.add(d)}this.updateHasDraped();e&&this.layerView._notifyDrapedDataChange();this.layerView.view.deconflictor.setDirty()};h.prototype.applyUniqueValueRendererDiff=
function(a,c,b){var e=a.diff.defaultSymbol,d=a.diff.uniqueValueInfos;if(e||d){var f=d?d.added.map(function(a){return a.symbol}):[],g=d?d.removed.map(function(a){return a.symbol}):[];if(d)for(var k=0;k<d.changed.length;k++)f.push(d.changed[k].newValue.symbol),g.push(d.changed[k].oldValue.symbol);e?(b.defaultSymbol&&g.push(b.defaultSymbol),c.defaultSymbol&&f.push(c.defaultSymbol)):b.defaultSymbol&&f.length&&g.push(c.defaultSymbol);this.applySymbolSetDiff(f,g,c,b);delete a.diff.defaultSymbol;delete a.diff.uniqueValueInfos;
return!0}return!1};h.prototype.calculateUnchangedSymbolMapping=function(a,c,b){if(c instanceof u&&b instanceof u)if(!a){if(b&&b.defaultSymbol)return[{oldId:b.defaultSymbol.id,newId:c.defaultSymbol.id}]}else if("partial"===a.type){var e=a.diff;a=e.defaultSymbol;var e=e.uniqueValueInfos,d=void 0,d=e?e.unchanged.map(function(a){return{oldId:a.oldValue.symbol.id,newId:a.newValue.symbol.id}}):b.uniqueValueInfos.map(function(a,b){return{oldId:a.symbol.id,newId:c.uniqueValueInfos[b].symbol.id}});!a&&b.defaultSymbol&&
d.push({oldId:b.defaultSymbol.id,newId:c.defaultSymbol.id});return d}return[]};h.prototype.updateUnchangedSymbolMappings=function(a,c,b){var e=0;for(a=this.calculateUnchangedSymbolMapping(a,c,b);e<a.length;e++)if(b=a[e],c=b.oldId,b=b.newId,c&&c!==b){var d=this.graphicsBySymbol[c];delete this.graphicsBySymbol[c];void 0!==d&&(this.graphicsBySymbol[b]=d);d=this.symbols[c];delete this.symbols[c];void 0!==d&&(this.symbols[b]=d,d.symbol.id=b)}};h.prototype.applyRendererDiff=function(a,c,b){var e=!1;if(this.diffHasSymbolChange(a))return!1;
if(c instanceof u&&b instanceof u&&this.applyUniqueValueRendererDiff(a,c,b)&&0===Object.keys(a.diff).length)return!0;for(var d in this.graphicsBySymbol)if(b=this.symbols[d]){var f=this.graphicsBySymbol[d];if(!b.applyRendererDiff(a,c,f))return!1;if(!e)for(var g in f)if(f[g].isDraped()){this.layerView._notifyDrapedDataChange();e=!0;break}}return!0};h.prototype.opacityChange=function(){var a=!1,c;for(c in this.graphicsBySymbol){var b=this.symbols[c];if(b){var e=this.graphicsBySymbol[c];b.layerPropertyChanged("opacity");
if(!a)for(var d in e)if(e[d].isDraped()){this.layerView._notifyDrapedDataChange();a=!0;break}}}};h.prototype.setClippingExtent=function(a,c){var b=this.symbolCreationContext.clippingExtent,e=[];H.extentToBoundingRect(a,e,c)?this.symbolCreationContext.clippingExtent=[e[0],e[1],-Infinity,e[2],e[3],Infinity]:this.symbolCreationContext.clippingExtent=null;return!f.equals(this.symbolCreationContext.clippingExtent,b)};h.prototype.forEachGraphics3DGraphic=function(a){var c=this;if(this.layerView.loadedGraphics){var b=
!1,e=!1;this.layerView.loadedGraphics.forEach(function(d){var f=c.getGraphics3DGraphicById(d.uid);f&&a(f,d)&&(b=!0,e=e||f.isDraped())});b&&this.layerView.view.deconflictor.setDirty();e&&this.layerView._notifyDrapedDataChange()}};h.prototype.updateAllGraphicsVisibility=function(){var a=this;this.forEachGraphics3DGraphic(function(c,b){var e=c.setVisibilityFlag(0,b.visible),d=!1;a.scaleVisibility&&(d=a.scaleVisibility.updateGraphicScaleVisibility(b,c));return e||d})};h.prototype.hideAllGraphics=function(){this.forEachGraphics3DGraphic(function(a){return a.setVisibilityFlag(0,
!1)})};h.prototype.validateRenderer=function(a){(a=v.validateTo3D(a))&&N.warn("Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView",a.message)};h.prototype.volatileGraphicsUpdated=function(){this.labeling&&(this.lastFastUpdate=performance.now());this.stageLayer.invalidateSpatialQueryAccelerator();this.stageLayer.shaderTransformationChanged();this.layerView._evaluateUpdatingState()};h.createLocalOriginFactory=function(){return new L(5E6,
16)};h.prototype.snapshotInternals=function(){var a=this;return{graphics:Object.keys(this.graphics).sort(),symbols:Object.keys(this.symbols).sort(),graphicsBySymbol:Object.keys(this.graphicsBySymbol).sort().map(function(c){return{symbolId:c,graphics:Object.keys(a.graphicsBySymbol[c]).sort()}}),graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),graphicsDrapedIds:Object.keys(this.graphicsDrapedIds).sort()}};h.tmpVec=J.vec3d.create();return h}()})},"esri/core/tsSupport/generatorHelper":function(){define([],
function(){return function(p,h){function d(b){return function(e){return a([b,e])}}function a(a){if(f)throw new TypeError("Generator is already executing.");for(;g;)try{if(f=1,k&&(m=k[a[0]&2?"return":a[0]?"throw":"next"])&&!(m=m.call(k,a[1])).done)return m;if(k=0,m)a=[0,m.value];switch(a[0]){case 0:case 1:m=a;break;case 4:return g.label++,{value:a[1],done:!1};case 5:g.label++;k=a[1];a=[0];continue;case 7:a=g.ops.pop();g.trys.pop();continue;default:if(!(m=g.trys,m=0<m.length&&m[m.length-1])&&(6===a[0]||
2===a[0])){g=0;continue}if(3===a[0]&&(!m||a[1]>m[0]&&a[1]<m[3]))g.label=a[1];else if(6===a[0]&&g.label<m[1])g.label=m[1],m=a;else if(m&&g.label<m[2])g.label=m[2],g.ops.push(a);else{m[2]&&g.ops.pop();g.trys.pop();continue}}a=h.call(p,g)}catch(l){a=[6,l],k=0}finally{f=m=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var g={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},f,k,m,e;return e={next:d(0),"throw":d(1),"return":d(2)},"function"===typeof Symbol&&(e[Symbol.iterator]=
function(){return this}),e}})},"esri/core/tsSupport/awaiterHelper":function(){define(["dojo/Deferred","dojo/when"],function(p,h){return function(d,a,g,f){function k(a){try{e(f.next(a))}catch(t){b.reject(t)}}function m(a){try{e(f["throw"](a))}catch(t){b.reject(t)}}function e(a){a.done?h(a.value).then(b.resolve,b.reject):h(a.value).then(k,m)}var b=new p;e((f=f.apply(d,a||[])).next());return b.promise}})},"esri/renderers/support/rendererConversion":function(){define(["require","exports","../../core/Error",
"../../symbols/support/symbolConversion"],function(p,h,d,a){function g(a,e){if(!e)return null;e=Array.isArray(e)?e:[e];if(0<e.length){var b=e.map(function(a){return a.details.symbol.type||a.details.symbol.declaredClass}).filter(function(a){return!!a});b.sort();var f=[];b.forEach(function(a,e){0!==e&&a===b[e-1]||f.push(a)});return new d("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+f.join(", ")+") which are not supported in 3D",{renderer:a,symbolErrors:e})}return null}
function f(d){var e=d.uniqueValueInfos.map(function(b){return a.to3D(b.symbol).error}).filter(function(a){return!!a}),b=a.to3D(d.defaultSymbol);b.error&&e.unshift(b.error);return g(d,e)}function k(d){var e=d.classBreakInfos.map(function(b){return a.to3D(b.symbol).error}).filter(function(a){return!!a}),b=a.to3D(d.defaultSymbol);b.error&&e.unshift(b.error);return g(d,e)}Object.defineProperty(h,"__esModule",{value:!0});h.validateTo3D=function(h){return h?"simple"===h.type?g(h,a.to3D(h.symbol).error):
"unique-value"===h.type?f(h):"class-breaks"===h.type?k(h):new d("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+(h.type||h.declaredClass)+"'",{renderer:h}):null}})},"esri/symbols/support/unitConversionUtils":function(){define(["require","exports","../../renderers/support/utils"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});h.supportsUnit=function(a){return null!=d.meterIn[a]};h.getMetersPerUnit=function(a){return 1/(d.meterIn[a]||1)}})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper dojo/Deferred dojo/_base/lang ../../../../geometry ../../../../core/promiseUtils ../../../../core/scheduling".split(" "),
function(p,h,d,a,g,f,k,m,e){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function b(a,b){this.spatialReference=a;this.elevationProvider=b;this.point=new k.Point;this.point.spatialReference=a}b.prototype.queryElevation=function(b,e){return a(this,void 0,void 0,function(){return d(this,function(a){this.point.x=b;this.point.y=e;return[2,m.resolve(this.elevationProvider&&this.elevationProvider.getElevation(this.point)||0)]})})};return b}();h.ElevationQueryView=p;p=function(){function b(a,
b,e){this.spatialReference=a;this._getElevationQueryProvider=b;this._queries=[];this._isScheduled=!1;this._queryOptions=f.mixin({},e,{ignoreInvisibleLayers:!0})}b.prototype.queryElevation=function(b,e){return a(this,void 0,void 0,function(){var a;return d(this,function(d){a=new g;this._queries.push({x:b,y:e,result:a});this._scheduleDoQuery();return[2,a.promise]})})};b.prototype._scheduleDoQuery=function(){var a=this;this._isScheduled||(e.schedule(function(){return a._doQuery()}),this._isScheduled=
!0)};b.prototype._doQuery=function(){return a(this,void 0,void 0,function(){var a,b,e,f,g,h,n;return d(this,function(d){switch(d.label){case 0:this._isScheduled=!1;a=this._queries;this._queries=[];b=a.map(function(a){return[a.x,a.y]});e=new k.Multipoint({points:b,spatialReference:this.spatialReference});f=this._getElevationQueryProvider();if(!f)return a.forEach(function(a,b){return a.result.reject()}),[2];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,f.queryElevation(e,this._queryOptions)];case 2:return g=
d.sent(),[3,4];case 3:return h=d.sent(),a.forEach(function(a){return a.result.reject(h)}),[2];case 4:return n=g.geometry.points,a.forEach(function(a,b){return a.result.resolve(n[b][2])}),[2]}})})};return b}();h.ElevationQuery=p})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["require","exports","../../../../arcade/Feature","../../../../support/arcadeUtils"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});h.createContext=function(d,f,k){var g=null;
d=d&&d.expression;"string"===typeof d&&(g="0"===d?0:null,null!=g?g={cachedResult:g}:(g=a.createSyntaxTree(d),a.dependsOnView(g)?(null!=k&&k.error("Expressions containing '$view' are not supported on ElevationInfo"),g={cachedResult:0}):g={arcade:{func:a.createFunction(g),context:a.createExecContext(null,{sr:f})}}));return g};h.createFeature=function(a){return d.createFromGraphic(a)};h.setContextFeature=function(d,f){null!=d&&null==d.cachedResult&&a.updateExecContext(d.arcade.context,f)};h.execute=
function(d){if(null!=d){if(null!=d.cachedResult)return d.cachedResult;var f=d.arcade,f=a.executeFunction(f.func,f.context);"number"!==typeof f&&(f=d.cachedResult=0);return f}return 0};h.extractExpressionInfo=function(a,d){void 0===d&&(d=!1);var f=(a=a&&a.featureExpressionInfo)&&a.expression;d||"0"===f||(a=null);return a};h.zeroContext={cachedResult:0}})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/ObjectPool ./featureExpressionInfoUtils ../../support/aaBoundingBox ../../support/aaBoundingRect".split(" "),
function(p,h,d,a,g,f,k,m,e){var b=new f(Array,function(a){return m.set(a,m.ZERO)},null,10,5),l=e.create();return function(){function f(a,b,e){this.addedToSpatialIndex=!1;this._labelGraphics=[];this._auxiliaryGraphics=[];for(var d=Array(2),f=0;f<d.length;f++)d[f]=Array(3);this._visibilityFlags=d;this._featureExpressionFeature=null;this.graphics3DSymbol=b;this.graphic=a;this._graphics=e;this._featureExpressionFeature=k.createFeature(a)}f.prototype.initialize=function(a,b){var e=this;this._layer=a;this._stage=
b;this.forEachSymbolLayerGraphic(function(d){d.initialize(a,b);d.setVisibility(e.isVisible())})};f.prototype.destroy=function(){this.forEachRenderedGraphic(function(a){return a.destroy()});this._graphics.length=0;this._labelGraphics.length=0;this._auxiliaryGraphics.length=0};f.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(a){return a.destroy()});this._labelGraphics.length=0};f.prototype.addLabelGraphic=function(a,b,e){this._labelGraphics.push(a);a.initialize(b,e);a.setVisibility(this.isVisible(1))};
f.prototype.addAuxiliaryGraphic=function(a){this._auxiliaryGraphics.push(a);this._layer&&(a.initialize(this._layer,this._stage),a.setVisibility(this.isVisible()))};f.prototype.isDraped=function(){var a=!1;this.forEachSymbolLayerGraphic(function(b){b.isDraped()&&(a=!0)});return a};f.prototype.setDrawOrder=function(a,b,e){var d=this;e[this.graphics3DSymbol.symbol.id]=!0;this.forEachSymbolLayerGraphic(function(f,g){f.setDrawOrder(a+(1-(1+g)/d._graphics.length),b,e)})};f.prototype.areVisibilityFlagsSet=
function(a,b,e){void 0===e&&(e=0);e=this._visibilityFlags[e];if(null!=a)return e[a];a=!0;for(var d=0;d<e.length;d++)if(d!==b){var f=e[d];a=a&&(null==f||!0===f)}return a};f.prototype.isVisible=function(a){void 0===a&&(a=0);for(var b=!0,e=0;e<=a;e++)for(var d=this._visibilityFlags[e],f=0;f<d.length;f++)var g=d[f],b=b&&(null==g||!0===g);return b};f.prototype.setVisibilityFlag=function(a,b,e){void 0===e&&(e=0);var d=this.isVisible(e);this._visibilityFlags[e][a]=b;var f=this.isVisible(e);if(d!==f){if(1===
e)this.forEachLabelGraphic(function(a){return a.setVisibility(f)});else{this.forEachSymbolLayerGraphic(function(a){return a.setVisibility(f)});var g=this.isVisible(1);this.forEachLabelGraphic(function(a){return a.setVisibility(g)})}return!0}return!1};f.prototype.getBSRadius=function(){var a=0;this.forEachSymbolLayerGraphic(function(b){a=Math.max(a,b.getBSRadius())});return a};f.prototype.getCenterObjectSpace=function(){return this._graphics[0].getCenterObjectSpace()};f.prototype.getProjectedBoundingBox=
function(f,k,h,q){return a(this,void 0,void 0,function(){var n=this;return d(this,function(r){switch(r.label){case 0:return q||(q={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),q.boundingBox?m.set(q.boundingBox,m.NEGATIVE_INFINITY):q.boundingBox=m.create(m.NEGATIVE_INFINITY),q.requiresDrapedElevation=!1,[4,g.forEach(this._graphics,function(c){return a(n,void 0,void 0,function(){var a,e,g;return d(this,function(d){switch(d.label){case 0:if(!c)return[2];a=c.isDraped()?k:f;e=b.acquire();
return[4,c.getProjectedBoundingBox(a,h,e,q.screenSpaceObjects)];case 1:return g=d.sent(),isFinite(g[2])&&isFinite(g[5])||(q.requiresDrapedElevation=!0),g&&m.expand(q.boundingBox,e),b.release(e),[2]}})})})];case 1:return r.sent(),m.allFinite(q.boundingBox)||e.allFinite(m.toRect(q.boundingBox,l))?[2,q]:[2,null]}})})};f.prototype.needsElevationUpdates=function(){for(var a=0,b=this._graphics;a<b.length;a++){var e=b[a];if(e&&e.needsElevationUpdates)return!0}a=0;for(b=this._labelGraphics;a<b.length;a++)if((e=
b[a])&&e.needsElevationUpdates)return!0;return!1};f.prototype.alignWithElevation=function(a,b){var e=this;this.forEachRenderedGraphic(function(d){d.alignWithElevation(a,b,e._featureExpressionFeature)})};f.prototype.addHighlight=function(a,b){this.forEachSymbolLayerGraphic(function(e){return e.addHighlight(a,b)})};f.prototype.removeHighlight=function(a){this.forEachSymbolLayerGraphic(function(b){return b.removeHighlight(a)})};f.prototype.forEachGraphicList=function(a,b){a.forEach(function(a,e){return a&&
b(a,e)})};f.prototype.forEachSymbolLayerGraphic=function(a){this.forEachGraphicList(this._graphics,a);this.forEachGraphicList(this._auxiliaryGraphics,a)};f.prototype.forEachLabelGraphic=function(a){this.forEachGraphicList(this._labelGraphics,a)};f.prototype.forEachRenderedGraphic=function(a){this.forEachSymbolLayerGraphic(a);this.forEachLabelGraphic(a)};return f}()})},"esri/core/asyncUtils":function(){define(["require","exports","./tsSupport/generatorHelper","./tsSupport/awaiterHelper","./promiseUtils"],
function(p,h,d,a,g){Object.defineProperty(h,"__esModule",{value:!0});h.forEach=function(f,k,h){return a(this,void 0,void 0,function(){return d(this,function(a){switch(a.label){case 0:return[4,g.eachAlways(f.map(function(a,e){return k.apply(h,[a,e])}))];case 1:return a.sent(),[2]}})})};h.map=function(f,k,h){return a(this,void 0,void 0,function(){var a;return d(this,function(b){switch(b.label){case 0:return[4,g.eachAlways(f.map(function(a,b){return k.apply(h,[a,b])}))];case 1:return a=b.sent(),[2,a.map(function(a){return a.value})]}})})}})},
"esri/views/3d/layers/graphics/Graphics3DOwner":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});p=function(){return function(){this.featureExpressionInfoContext=this.localOriginFactory=this.layerView=this.layer=this.overlaySR=this.renderCoordsHelper=this.renderSpatialReference=this.clippingExtent=this.layerOrderDelta=this.layerOrder=this.stage=this.renderer=this.elevationProvider=this.streamDataSupplier=this.sharedResources=null;this.screenSizePerspectiveEnabled=
!0}}();h.Graphics3DSymbolCreationContext=p})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["require","exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});h.make=function(g,f,k){var h;switch(g.type){case "point-3d":h=d;break;default:h=a}return new h(g,f,k)}})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./Graphics3DCalloutSymbolLayerFactory",
"./Graphics3DSymbol"],function(p,h,d,a,g){return function(f){function g(d,e,b){d=f.call(this,d,e,b)||this;d.calloutSymbolLayer=null;d.symbol.hasVisibleCallout()&&(d.calloutSymbolLayer=a.make(d.symbol,e));return d}d(g,f);g.prototype.destroy=function(){f.prototype.destroy.call(this)};g.prototype.createGraphics3DGraphic=function(a,e,b){b=f.prototype.createGraphics3DGraphic.call(this,a,e,b);this.calloutSymbolLayer&&(a=this.createCalloutGraphic(a,e))&&b.addAuxiliaryGraphic(a);return b};g.prototype.layerPropertyChanged=
function(a,e){var b=this;return f.prototype.layerPropertyChanged.call(this,a,e)?this.calloutSymbolLayer?this.calloutSymbolLayer.layerPropertyChanged(a,e,function(a){var e=0;for(a=a._auxiliaryGraphics;e<a.length;e++){var d=a[e];if(d.graphics3DSymbolLayer===b.calloutSymbolLayer)return d}}):!0:!1};g.prototype.createCalloutGraphic=function(a,e){return this.calloutSymbolLayer.createGraphics3DGraphic(a,{renderer:e.renderer,symbol:e.symbol,needsOffsetAdjustment:e.needsOffsetAdjustment,translation:[0,0,0],
centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null})};return g}(g)})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["require","exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(p,h,d,a,g){Object.defineProperty(h,"__esModule",{value:!0});var f=d.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");h.make=
function(d,e){if(!a.isCalloutSupport(d))return f.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+d.type+"' does not support callouts"),null;if(!d.callout)return null;var b=k[d.callout.type];return b?new b(d,e):(f.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+d.callout.type),null)};var k={line:g}})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ./ElevationAligners ./Graphics3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r){var v=u.VertexAttrConstants;p=function(e){function n(a,c){a=e.call(this,a,null,c,!0)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return a}d(n,e);n.prototype.destroy=function(){e.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(b.ModelContentType.MATERIAL,this._material.id),this._material=null)};n.prototype._prepareResources=function(){var a=this._getStageIdHint();this._createMaterialsAndAddToStage(this._context.stage,
a);this.resolve()};n.prototype.perInstanceMaterialParameters=function(a){var c=this.materialParameters;c.screenOffset=a.screenOffset||[0,0];c.centerOffsetUnits=a.centerOffsetUnits||"world";return c};Object.defineProperty(n.prototype,"materialParameters",{get:function(){var c=this.symbolContainer,b=c.callout,e=a.toUnitRGBA(b.color);e[3]*=this._getLayerOpacity();var d=g.pt2px(b.size||0),f=null;if(c.verticalOffset)var f=c.verticalOffset,k=f.minWorldLength,l=f.maxWorldLength,f={screenLength:g.pt2px(f.screenLength),
minWorldLength:k||0,maxWorldLength:null!=l?l:Infinity};b=b.border&&b.border.color?a.toUnitRGBA(b.border.color):null;k="object"===c.symbolLayers.getItemAt(0).type;return{color:e,size:d,verticalOffset:f,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:b,occlusionTest:!k,shaderPolygonOffset:k?0:void 0,depthHUDAlignStart:"label-3d"===c.type}},enumerable:!0,configurable:!0});
n.prototype._createMaterialsAndAddToStage=function(a,c){this._material=new r(this.materialParameters,c+"_lineCallout_common");a.add(b.ModelContentType.MATERIAL,this._material)};n.prototype._defaultElevationInfoNoZ=function(){return c};n.prototype.createGraphics3DGraphic=function(a,c){null!=c.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=c.needsOffsetAdjustment);var b=this.getGraphicElevationContext(a,c.elevationOffset||0),e=c.symbol,d="on-the-ground"===this._elevationContext.mode&&
!e.symbolLayers.some(function(a){return"object"===a.type||"text"===a.type});if("label-3d"!==e.type&&d)return null;e=this._getGeometryCentroid(a);return null===e?null:this._createAs3DShape(a,e,b,c,"graphic"+a.uid,a.uid)};n.prototype.layerPropertyChanged=function(a,c,b){switch(a){case "opacity":return this.layerOpacityChanged(c,b);case "elevationInfo":return this.layerElevationInfoChanged(c,b)}return!1};n.prototype.layerOpacityChanged=function(a,c){this._material.setParameterValues(this.materialParameters);
return!0};n.prototype.layerElevationInfoChanged=function(a,c){var b=this._elevationContext.mode;this._updateElevationContext();var e=this._elevationContext.mode;if(b!==e&&("on-the-ground"===b||"on-the-ground"===e))return!1;for(var d in a)b=a[d],(e=c(b))&&this.updateGraphicElevationContext(b.graphic,e);return!0};n.prototype.getGraphicElevationContext=function(a,c){void 0===c&&(c=0);a=e.prototype.getGraphicElevationContext.call(this,a);a.addOffsetRenderUnits(c);return a};n.prototype.updateGraphicElevationContext=
function(a,c){a=this.getGraphicElevationContext(a,c.metadata.elevationOffset);c.elevationContext.set(a);c.needsElevationUpdates=m.needsElevationUpdates2D(a.mode)};n.prototype.createVertexData=function(a){var c=a.translation;a=a.centerOffset;if(!c&&!a)return q;c=c?{size:3,data:[c[0],c[1],c[2]]}:q[v.POSITION];a=a?{size:4,data:[a[0],a[1],a[2],a[3]]}:q[v.AUXPOS1];return b={},b[v.POSITION]=c,b[v.NORMAL]=q[v.NORMAL],b[v.AUXPOS1]=a,b;var b};n.prototype.getOrCreateMaterial=function(a,c){var b=this.perInstanceMaterialParameters(a),
e=r.uniqueMaterialIdentifier(b);if(e===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(a.materialCollection){var d=a.materialCollection.getMaterial(e);d||(d=new r(b,c+"_lineCallout_shared"),a.materialCollection.addMaterial(e,d));return{material:d,isUnique:!1}}d=new r(b,c+"_lineCallout_unique");return{material:d,isUnique:!0}};n.prototype._createAs3DShape=function(a,c,b,e,d,g){a=new t(this.createVertexData(e),w,t.DefaultOffsets,"point");a=[new l(a,d)];var n=this.getOrCreateMaterial(e,
d);d=m.createStageObjectForPoint.call(this,c,a,[[n.material]],null,null,b,d,this._context.layer.uid,g,!0);if(null===d)return null;g=new k(this,d.object,a,n.isUnique?[n.material]:null,null,f.perObjectElevationAligner,b);g.metadata={elevationOffset:e.elevationOffset||0};g.alignedTerrainElevation=d.terrainElevation;g.needsElevationUpdates=m.needsElevationUpdates2D(b.mode);m.extendPointGraphicElevationContext(g,c,this._context.elevationProvider);return g};return n}(e);var q=(n={},n[v.POSITION]={size:3,
data:[0,0,0]},n[v.NORMAL]={size:3,data:[0,0,1]},n[v.AUXPOS1]={size:4,data:[0,0,0,1]},n),n=new Uint32Array([0]),w=(x={},x[v.POSITION]=n,x[v.NORMAL]=n,x[v.AUXPOS1]=n,x),c={mode:"relative-to-ground",offset:0},n,x;return p})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("require exports ../../../../geometry/Point ./Graphics3DSymbolCommonCode ./graphicUtils ../../lib/glMatrix ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),function(p,
h,d,a,g,f,k,m,e){Object.defineProperty(h,"__esModule",{value:!0});var b=e.VertexAttrConstants;p=f.vec3d;var l=new d,t=p.create(),u=p.create(),r=p.create(),v={verticalDistanceToGround:0,terrainElevation:0};h.perVertexElevationAligner=function(e,d,f,c){l.spatialReference=f.spatialReference;for(var g=e.getGeometryRecords(),n=g.length,m="absolute-height"!==d.mode,q=0,w=0;w<n;w++){var p=g[w].geometry,C=g[w].getShaderTransformation(),G=p.getData();u[0]=C[12];u[1]=C[13];u[2]=C[14];p.invalidateBoundingInfo();
for(var C=G.getVertexAttr(),G=C[b.POSITION],p=G.data,C=C.mapPos.data,G=G.size,J=p.length/G,F=0,I=0,H=!1,K=0,L=0;L<J;L++){l.x=C[I++];l.y=C[I++];l.z=C[I++];r[0]=p[F];r[1]=p[F+1];r[2]=p[F+2];var M=a.computeElevation(f,l,d,c,m?v:null);m&&(K+=v.terrainElevation);t[0]=p[F]+u[0];t[1]=p[F+1]+u[1];t[2]=p[F+2]+u[2];c.setAltitude(M,t);p[F]=t[0]-u[0];p[F+1]=t[1]-u[1];p[F+2]=t[2]-u[2];if(k.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS)H=!0;else if(M=h.updateThresholdInMeters/c.unitInMeters,Math.abs(r[0]-p[F])>=M||
Math.abs(r[1]-p[F+1])>=M||Math.abs(r[2]-p[F+2])>=M)H=!0;F+=G}q+=K/J;H&&e.geometryVertexAttrsUpdated(w)}return q/n};h.perObjectElevationAligner=function(b,e,d,c,f){var l=e.centerPointInElevationSR,n=0;f=0;if(b.metadata.usesVerticalDistanceToGround)n=a.computeElevation(d,l,e,c,v),g.updateVertexAttributeAuxpos1w(b,v.verticalDistanceToGround),f=v.terrainElevation;else{var q="absolute-height"!==e.mode,n=a.computeElevation(d,l,e,c,q?v:null);q&&(f=v.terrainElevation)}e=b.getObjectTransformation();d=[e[12],
e[13],e[14]];k.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(t[0]=l.x,t[1]=l.y,t[2]=n,m.computeLinearTransformation(l.spatialReference,t,e,c.spatialReference)&&b.setObjectTransformation(e)):c.setAltitudeOfTransformation(n,e);c=h.updateThresholdInMeters/c.unitInMeters;(Math.abs(e[12]-d[0])>=c||Math.abs(e[13]-d[1])>=c||Math.abs(e[14]-d[2])>=c)&&b.setObjectTransformation(e);return f};h.updateThresholdInMeters=.01;h.iterativeUpdatesEnabled=!0})},"esri/views/3d/layers/graphics/Graphics3DSymbolCommonCode":function(){define("require exports ../../../../geometry/Point ../../../../geometry/support/coordsUtils ../../../../geometry/support/triangulationUtils ../../../../symbols/callouts/calloutUtils ./graphicUtils ../../lib/glMatrix ../../support/projectionUtils ../../webgl-engine/lib/Object3D".split(" "),
function(p,h,d,a,g,f,k,m,e,b){function l(a,c,b,e,d){var f=0,g=c.z||0,k=0,k=b.mode;e=b.calculateOffsetRenderUnits(e);b=b.featureExpressionInfoContext;"on-the-ground"===k?(f=k=a.getElevation(c,"ground")||0,d&&(d.verticalDistanceToGround=0,d.terrainElevation=k)):"relative-to-ground"===k?(k=a.getElevation(c,"ground")||0,f=e,null==b&&(f+=g),d&&(d.verticalDistanceToGround=f,d.terrainElevation=k),f+=k):"relative-to-scene"===k?(k=a.getElevation(c,"scene")||0,f=e,d&&(d.verticalDistanceToGround=f,d.terrainElevation=
k),f+=k):"absolute-height"===k&&(f=e,null==b&&(f+=g),d&&(k=a.getElevation(c,"ground")||0,d.verticalDistanceToGround=f-k,d.terrainElevation=k));return f}function t(a,c){a=g.pathsToTriangulationInfo(a,c);return{vertexData:a.position,polygons:a.polygons,outlines:a.outlines}}function u(a,c,b,e,d){c*=3;e*=3;for(var f=0;f<d;++f)b[e++]=a[c++],b[e++]=a[c++],b[e++]=a[c++]}function r(a,c,b,d,f,g,k){return e.bufferToBuffer(a,b,c,d,g,f,k)}function v(a,c,b){e.pointToVector(a,c,b)}function q(a,c){return!(a[0]>
c[3]||a[0]<c[0]||a[1]>c[4]||a[1]<c[1])}function n(a,c){return!(c[0]>a[3]||c[3]<a[0]||c[1]>a[4]||c[4]<a[1])}Object.defineProperty(h,"__esModule",{value:!0});p=m.mat4d;var w=m.vec3d.create(),c=p.identity(),x=new d({x:0,y:0,z:0,spatialReference:null});h.createStageObjectForPoint=function(a,d,f,g,n,h,m,r,t,u,x){var p=d?d.length:0,y=this._context.clippingExtent;v(a,w,this._context.elevationProvider.spatialReference);if(y&&!q(w,y))return null;v(a,w,this._context.renderSpatialReference);y=this._context.localOriginFactory.getOrigin(w);
m=new b({castShadow:!1,metadata:{layerUid:r,graphicId:t,usesVerticalDistanceToGround:!!u},idHint:m});for(r=0;r<p;r++)m.addGeometry(d[r],f[r],g?g[r]:c,n,y,x);d=this._context.renderSpatialReference;g=this._context.elevationProvider;n=this._context.renderCoordsHelper;f=0;var A;m.metadata.usesVerticalDistanceToGround?(f=l(g,a,h,n,z),k.updateVertexAttributeAuxpos1w(m,z.verticalDistanceToGround),A=z.terrainElevation):(x="absolute-height"!==h.mode,f=l(g,a,h,n,x?z:null),x&&(A=z.terrainElevation));h=m.getObjectTransformation();
w[0]=a.x;w[1]=a.y;w[2]=f;e.computeLinearTransformation(a.spatialReference,w,h,d)?m.setObjectTransformation(h):console.warn("Could not locate symbol object properly, it might be misplaced");return{object:m,terrainElevation:A}};h.extendPointGraphicElevationContext=function(a,c,b){a=a.elevationContext;b=b.spatialReference;v(c,w,b);a.centerPointInElevationSR=new d({x:w[0],y:w[1],z:c.hasZ?w[2]:0,spatialReference:b})};h.placePointOnPolyline=function(c){var b=c.paths[0];if(!b||0===b.length)return null;b=
a.getPointOnPath(b,a.getPathLength(b)/2);return new d({x:b[0],y:b[1],z:b[2],spatialReference:c.spatialReference})};h.placePointOnPolygon=function(a){return k.computeCentroid(a)};h.computeElevation=l;h.getSingleSizeDriver=function(a,c){void 0===c&&(c=0);return isFinite(a[c])?a[c]:null};h.copyPathData=t;h.copyVertices=u;h.chooseOrigin=function(a,c,b,e){c=Math.floor(c+(b-1)/2);e[0]=a[3*c+0];e[1]=a[3*c+1];e[2]=a[3*c+2]};h.subtractCoordinates=function(a,c,b,e){c*=3;for(var d=0;d<b;++d)a[c++]-=e[0],a[c++]-=
e[1],a[c++]-=e[2]};h.setZ=function(a,c,b,e){c*=3;for(var d=0;d<b;++d)a[c+2]=e,c+=3};h.offsetZ=function(a,c,b,e){c*=3;for(var d=0;d<b;++d)a[c+2]+=e,c+=3};h.scaleZ=function(a,c,b,e){c*=3;for(var d=0;d<b;++d)a[c+2]*=e,c+=3};h.flatArrayToArrayOfArrays=function(a,c,b){var e=[];c*=3;for(var d=0;d<b;++d)e.push([a[c++],a[c++],a[c++]]);return e};h.reproject=r;h.reprojectPoint=v;h.getGeometryVertexData3D=function(a,c,b,e,d,f,g){var k=d.spatialReference;a=t(a,c);c=a.vertexData;var l=c.length/3,n=new Float64Array(c.length),
h=!0;b.equals(k)?u(c,0,n,0,c.length):h=r(c,0,b,n,0,k,l);var m=b=0,q=g.mode,v=0,w=0,p=0;f=g.calculateOffsetRenderUnits(f);g=g.featureExpressionInfoContext;x.spatialReference=d.spatialReference;b*=3;for(var m=3*m,z=0;z<l;++z)x.x=n[b+0],x.y=n[b+1],x.z=n[b+2],"on-the-ground"===q?(w=v=d.getElevation(x)||0,p+=v):"relative-to-ground"===q?(v=d.getElevation(x)||0,w=v+f,null==g&&(w+=x.z),p+=v):"relative-to-scene"===q?(v=d.getElevation(x,"scene")||0,w=v+f,p+=v):"absolute-height"===q&&(w=f,null==g&&(w+=x.z)),
c[m+0]=n[b+0],c[m+1]=n[b+1],c[m+2]=w,b+=3,m+=3;d=p/l;k.equals(e)||r(c,0,k,c,0,e,l);return{geometryData:a,vertexData:c,eleVertexData:n,terrainElevation:d,projectionSuccess:h}};h.getGeometryVertexDataDraped=function(a,c,b){a=t(a,!1);var d=a.vertexData,f=d.length/3,g=!0;c.equals(b)||(g=e.bufferToBuffer(d,c,0,d,b,0,f));return{geometryData:a,vertexData:d,projectionSuccess:g}};h.computeBoundingBox=function(a,c,b,e){e[0]=Number.MAX_VALUE;e[1]=Number.MAX_VALUE;e[2]=Number.MAX_VALUE;e[3]=-Number.MAX_VALUE;
e[4]=-Number.MAX_VALUE;e[5]=-Number.MAX_VALUE;c*=3;for(var d=0;d<b;++d){var f=a[c++],g=a[c++],k=a[c++];f<e[0]&&(e[0]=f);g<e[1]&&(e[1]=g);k<e[2]&&(e[2]=k);f>e[3]&&(e[3]=f);g>e[4]&&(e[4]=g);k>e[5]&&(e[5]=k)}return e};h.pointInBox2D=q;h.boxesIntersect2D=n;h.boundingBoxClipped=function(a,c){return c?!n(a,c):!1};h.needsElevationUpdates2D=function(a){return"relative-to-ground"===a||"relative-to-scene"===a};h.needsElevationUpdates3D=function(a){return"absolute-height"!==a};h.needsOffsetAdjustment=function(a,
c,b,e){if(!1===c.needsOffsetAdjustment||!1===c.supportsOffsetAdjustment||"on-the-ground"===a.mode)return!1;if(0===a.meterUnitOffset){if(!0===c.needsOffsetAdjustment)return!0;if(f.isCalloutSupport(e)&&e.hasVisibleVerticalOffset())return!1;if("relative-to-ground"===a.mode&&(!b.hasZ||a.featureExpressionInfoContext)||"relative-to-scene"===a.mode)return!0}return!1};var z={verticalDistanceToGround:0,terrainElevation:0}})},"esri/views/3d/layers/graphics/graphicUtils":function(){define(["require","exports",
"../../../../geometry","../../../../geometry/support/webMercatorUtils","../../lib/glMatrix"],function(p,h,d,a,g){function f(b,e){var f=b.spatialReference;f.equals(e)||(f.isWebMercator&&e.wkid===d.SpatialReference.WGS84.wkid?a.webMercatorToGeographic(b,!1,b):e.isWebMercator&&f.wkid===d.SpatialReference.WGS84.wkid&&a.geographicToWebMercator(b,!1,b))}function k(a){if(Array.isArray(a)){for(var b=0;b<a.length;b++)if(!k(a[b]))return!1;return!0}return null==a||0<=a}Object.defineProperty(h,"__esModule",{value:!0});
var m=g.vec4d,e=g.mat4d,b=[1,1,1];h.computeCentroid=function(a,b){if("extent"===a.type)return a.center;if("polygon"===a.type)return a.centroid;if("mesh"===a.type)return a.extent.center;for(var e=0,g=0,k=0,l=a.hasZ,n=0,h=0,c=a.paths;h<c.length;h++){for(var m=c[h],t=0,p=m;t<p.length;t++){var y=p[t],e=e+y[0],g=g+y[1];l&&(k+=y[2])}n+=m.length}a=new d.Point({x:e/n,y:g/n,z:l?k/n:void 0,spatialReference:a.spatialReference});b&&f(a,b);return a};h.convertToSR=f;h.enlargeExtent=function(a,b,e){if(a){b||(b=
m.create());var d=.5*a.width*(e-1);e=.5*a.height*(e-1);a.width<1E-7*a.height?d+=e/20:a.height<1E-7*a.width&&(e+=d/20);m.set4(a.xmin-d,a.ymin-e,a.xmax+d,a.ymax+e,b);return b}return null};h.updateVertexAttributeAuxpos1w=function(a,b){for(var e=0;e<a.geometries.length;++e){var d=a.geometries[e].data.vertexAttributes.auxpos1;d&&d.data[3]!==b&&(d.data[3]=b,a.geometryVertexAttrsUpdated(e))}};h.mixinColorAndOpacity=function(a,b){var e=[1,1,1,1];null!=a&&(e[0]=a[0],e[1]=a[1],e[2]=a[2]);null!==b&&void 0!==
b?e[3]=b:null!=a&&3<a.length&&(e[3]=a[3]);return e};h.overrideColor=function(a,b,e,d,f,g){void 0===g&&(g=[0,0,0,0]);for(var k=0;3>k;++k)g[k]=a&&null!=a[k]?a[k]:e&&null!=e[k]?e[k]:f[k];g[3]=null!=b?b:null!=d?d:f[3];return g};h.computeObjectScale=function(a,e,d,f){void 0===a&&(a=b);void 0===f&&(f=1);var g=Array(3);if(null==e||null==d)g[0]=1,g[1]=1,g[2]=1;else{for(var k=void 0,l=0,h=2;0<=h;h--){var c=a[h],m=void 0,r=null!=c,t=0===h&&!k&&!r,u=d[h];"symbolValue"===c||t?m=0!==u?e[h]/u:1:r&&"proportional"!==
c&&isFinite(c)&&(m=0!==u?c/u:1);null!=m&&(k=g[h]=m,l=Math.max(l,Math.abs(m)))}for(h=2;0<=h;h--)null==g[h]?g[h]=k:0===g[h]&&(g[h]=.001*l)}for(h=2;0<=h;h--)g[h]/=f;return g};h.computeSizeWithResourceSize=function(a,b){var e=b.width,d=b.depth,f=b.height;b=b.isPrimitive?10:1;if(null==e&&null==f&&null==d)return[b*a[0],b*a[1],b*a[2]];for(var e=[e,d,f],g,d=0;3>d;d++)if(f=e[d],null!=f){g=f/a[d];break}for(d=0;3>d;d++)null==e[d]&&(e[d]=a[d]*g);return e};h.validateSymbolLayerSize=function(a){null!=a.isPrimitive&&
(a=[a.width,a.depth,a.height]);return k(a)?null:"Symbol sizes may not be negative values"};h.computeObjectRotation=function(a,b,d,f){void 0===f&&(f=e.identity());a=a||0;b=b||0;d=d||0;0!==a&&e.rotateZ(f,-a/180*Math.PI,f);0!==b&&e.rotateX(f,b/180*Math.PI,f);0!==d&&e.rotateY(f,d/180*Math.PI,f);return f}})},"esri/views/3d/support/debugFlags":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(p,h,d,a,g,f){return new (function(g){function k(){var a=null!==g&&g.apply(this,arguments)||this;a.SCENEVIEW_HITTEST_RETURN_SELECTOR=!1;a.SCENEVIEW_LOCKING_LOG=!1;a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1;a.HIGHLIGHTS_VISUALIZE_BLOCKS=!1;a.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;a.DECONFLICTOR_SHOW_OUTLINES=!1;a.DECONFLICTOR_SHOW_GRID=!1;a.LABELS_SHOW_BORDER=!1;a.OVERLAY_DRAW_TEST_TEXTURE=!1;a.OVERLAY_SHOW_CENTER=!1;a.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=!1;a.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES=
!1;a.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1;a.DRAW_MESH_GEOMETRY_NORMALS=!1;return a}d(k,g);a([f.property()],k.prototype,"SCENEVIEW_HITTEST_RETURN_SELECTOR",void 0);a([f.property()],k.prototype,"SCENEVIEW_LOCKING_LOG",void 0);a([f.property()],k.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0);a([f.property()],k.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0);a([f.property()],k.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);a([f.property()],k.prototype,"DECONFLICTOR_SHOW_OUTLINES",
void 0);a([f.property()],k.prototype,"DECONFLICTOR_SHOW_GRID",void 0);a([f.property()],k.prototype,"LABELS_SHOW_BORDER",void 0);a([f.property()],k.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0);a([f.property()],k.prototype,"OVERLAY_SHOW_CENTER",void 0);a([f.property()],k.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",void 0);a([f.property()],k.prototype,"DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES",void 0);a([f.property()],k.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0);
a([f.property()],k.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);return k=a([f.subclass()],k)}(f.declared(g)))})},"esri/views/3d/layers/graphics/Graphics3DGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ../../lib/glMatrix ../../support/aaBoundingBox ../../webgl-engine/Stage".split(" "),function(p,h,d,a,g,f,k,
m,e,b){p=m.vec3d;var l=m.mat4d,t=[0,0,0];m=function(){function d(a,b,c,e,f,g,l,h){this._addedToStage=!1;this.alignedTerrainElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.uniqueMaterials=e;this.uniqueGeometries=c;this.uniqueTextures=f;this.stageObject=b;this.elevationAligner=g;this.elevationContext=new k(l);this.stageLayer=this.stage=null;this._visible=!1;this.visibilityMode=null!=h?h:d.VisibilityModes.HIDE_FACERANGE}d.prototype.initialize=function(a,e){this.stageLayer=
a;this.stage=e;if(this.uniqueMaterials)for(a=0;a<this.uniqueMaterials.length;a++)e.add(b.ModelContentType.MATERIAL,this.uniqueMaterials[a]);if(this.uniqueGeometries)for(a=0;a<this.uniqueGeometries.length;a++)e.add(b.ModelContentType.GEOMETRY,this.uniqueGeometries[a]);if(this.uniqueTextures)for(a=0;a<this.uniqueTextures.length;a++)e.add(b.ModelContentType.TEXTURE,this.uniqueTextures[a]);e.add(b.ModelContentType.OBJECT,this.stageObject)};d.prototype.isDraped=function(){return!1};d.prototype.setVisibility=
function(a){if(null!=this.stage)return this._visible!==a?((this._visible=a)?this._addedToStage?this.stageObject.unhideAllComponents():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===d.VisibilityModes.HIDE_FACERANGE?this.stageObject.hideAllComponents():(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1),(a=this.stage.view.getEdgeView())&&a.hasObject(this.stageObject)&&a.updateObjectVisibility(this.stageObject,this._visible),!0):!1};d.prototype.destroy=
function(){var a=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var e=0;e<this.uniqueMaterials.length;e++)a.remove(b.ModelContentType.MATERIAL,this.uniqueMaterials[e].id);if(this.uniqueGeometries)for(e=0;e<this.uniqueGeometries.length;e++)a.remove(b.ModelContentType.GEOMETRY,this.uniqueGeometries[e].id);if(this.uniqueTextures)for(e=0;e<this.uniqueTextures.length;e++)a.remove(b.ModelContentType.TEXTURE,this.uniqueTextures[e].id)}a.remove(b.ModelContentType.OBJECT,this.stageObject.id);this._addedToStage&&
(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);(a=this.stage.view.getEdgeView())&&a.hasObject(this.stageObject)&&a.removeObject(this.stageObject);this._visible=!1;this.stage=this.stageLayer=null};d.prototype.alignWithElevation=function(a,b,c){this.elevationAligner&&(f.setContextFeature(this.elevationContext.featureExpressionInfoContext,c),a=this.elevationAligner(this.stageObject,this.elevationContext,a,b),null!=a&&(this.alignedTerrainElevation=a))};d.prototype.setDrawOrder=
function(a,b,c){};d.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()};d.prototype.getCenterObjectSpace=function(){return this.stageObject.getCenter(!0)};d.prototype.getBoundingBoxObjectSpace=function(a){var b=this.stageObject;a||(a=e.create());e.setMin(a,b.getBBMin(!0));e.setMax(a,b.getBBMax(!0));return a};d.prototype.getProjectedBoundingBox=function(b,d,c,f){return g(this,void 0,void 0,function(){var g,k,n,h,m,q,w,x;return a(this,function(a){switch(a.label){case 0:g=this.getBoundingBoxObjectSpace(c);
k=v;n=e.isPoint(g)?1:k.length;for(h=0;h<n;h++)m=k[h],r[0]=g[m[0]],r[1]=g[m[1]],r[2]=g[m[2]],l.multiplyVec3(this.stageObject.objectTransformation,r),u[3*h+0]=r[0],u[3*h+1]=r[1],u[3*h+2]=r[2];if(!b(u,0,n))return[3,6];e.set(g,e.NEGATIVE_INFINITY);q=null;this.calculateRelativeScreenBounds&&(q=this.calculateRelativeScreenBounds());for(h=0;h<3*n;h+=3){for(w=0;3>w;w++)g[w]=Math.min(g[w],u[h+w]),g[w+3]=Math.max(g[w+3],u[h+w]);q&&f.push({location:u.slice(h,h+3),screenSpaceBoundingRect:q})}if(!d)return[3,5];
e.center(g,t);if("absolute-height"===this.elevationContext.mode)return[3,5];x=void 0;a.label=1;case 1:return a.trys.push([1,3,,4]),[4,d.queryElevation(t[0],t[1])];case 2:return x=a.sent(),[3,4];case 3:return a.sent(),x=null,[3,4];case 4:null!=x&&e.offset(g,0,0,-this.alignedTerrainElevation+x),a.label=5;case 5:return[2,g];case 6:return[2,null]}})})};d.prototype.addHighlight=function(a,b){b=this.stageObject.highlightAllComponents(b);a.addObject(this.stageObject,b)};d.prototype.removeHighlight=function(a){a.removeObject(this.stageObject)};
d.VisibilityModes={REMOVE_OBJECT:0,HIDE_FACERANGE:1};return d}();var u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=p.create(),v=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return m})},"esri/views/3d/layers/graphics/Graphics3DGraphicElevationContext":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./ElevationContext"],function(p,h,d,a){return function(a){function f(d){d=a.call(this,d)||this;d.centerPointInElevationSR=null;return d}d(f,
a);return f}(a)})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["require","exports","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(p,h,d,a){return function(){function g(a){a?this.set(a):this.setDefaults()}Object.defineProperty(g.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"unit",{get:function(){return this._unit},enumerable:!0,configurable:!0});
g.prototype.setUnit=function(a){this._unit=a;this._metersPerElevationInfoUnit=d.getMetersPerUnit(a)};g.prototype.setDefaults=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this.featureExpressionInfoContext=null;this.hasOffsetAdjustment=!1;this.setUnit("meters")};g.prototype.set=function(a){this.mode=a.mode;this._meterUnitOffset=a._meterUnitOffset||0;this._renderUnitOffset=a._renderUnitOffset||0;this.featureExpressionInfoContext=a.featureExpressionInfoContext;this.hasOffsetAdjustment=
a.hasOffsetAdjustment;this.setUnit(a.unit)};g.prototype.setOffsetMeters=function(a){this._meterUnitOffset=a;this._renderUnitOffset=0};g.prototype.setOffsetElevationInfoUnits=function(a){this._meterUnitOffset=a*this._metersPerElevationInfoUnit;this._renderUnitOffset=0};g.prototype.setOffsetRenderUnits=function(a){this._meterUnitOffset=0;this._renderUnitOffset=a};g.prototype.addOffsetRenderUnits=function(a){this._renderUnitOffset+=a};g.prototype.mixinApi=function(a){null!=a.mode&&(this.mode=a.mode);
null!=a.unit&&this.setUnit(a.unit);null!=a.offset&&this.setOffsetElevationInfoUnits(a.offset)};g.prototype.calculateOffsetRenderUnits=function(d){var f=this._meterUnitOffset,g=this.featureExpressionInfoContext;null!=g&&(f+=a.execute(g)*this._metersPerElevationInfoUnit);return f/d.unitInMeters+this._renderUnitOffset};return g}()})},"esri/views/3d/webgl-engine/Stage":function(){define("require exports ./lib/Camera ./lib/gl-matrix ./lib/ModelContentType ./lib/Selector ./lib/Util ./lighting/Lightsources ./parts/Model ./parts/View".split(" "),
function(p,h,d,a,g,f,k,m,e,b){p=a.vec2d;h=a.vec2;var l=a.vec3d;a=function(){function a(a,d,g){this._intersectTolerance=f.DEFAULT_TOLERANCE;this._viewContent=[];this._externalIntersectionHandlers=[];this.container=d;this.viewingMode=a;this.model=new e;this.view=new b(d,this,this.model.getDirtySet(),g);this._validateHUDSelector=new f(this.viewingMode);this._validateHUDSelector.enableHUDSelection=!1;this.view.setLighting({lights:[new m.MainLight(l.createFrom(.7,.7,.7)),new m.AmbientLight(l.createFrom(.3,
.3,.3))],groundLightingFactor:.5,globalFactor:.5})}a.prototype.setNeedsRender=function(){this.view.setNeedsRender()};a.prototype.dispose=function(){this.view.dispose();this.model=this.view=null};a.prototype.frame=function(a,b){void 0===b&&(b=0);var e=Math.max(1E-6,a.getBSRadius());b=Math.max(2,b+2);b*=e;var e=this.getCamera(),c=l.create(e.viewForward);l.scale(c,-(1.5*b/Math.tan(e.fov)));l.set(a.getCenter(),e.center);l.add(e.center,c,e.eye);e=new d(e.eye,e.center,e.up);this.setCamera(e)};a.prototype.beginMod=
function(){a.DebugSettings.fineGrainedContentValidation&&this.model.validateContent()};a.prototype.endMod=function(b){void 0===b&&(b=!1);a.DebugSettings.fineGrainedContentValidation&&!b&&this.model.validateContent()};a.prototype.add=function(a,b){this.model.add(a,b);"function"===typeof b.addParentStage&&b.addParentStage(this)};a.prototype.remove=function(a,b){a=this.model.remove(a,b);"function"===typeof a.removeParentStage&&a.removeParentStage(this);return a};a.prototype.notifyDirty=function(a,b,
e,c){this.model.notifyDirty(a,b,e,c)};a.prototype.processDirty=function(){var b=this.model.getDirtySet(),e=b.getDirtyMaterials();if(b.hasDirtyGeometryRecords()||e){a.DebugSettings.endFrameContentValidation&&this.model.validateContent();a.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));var d=b.getAddRemoveUpdateListFilteredByLayers(this._viewContent,!0);(0<d[0].length+d[1].length+d[2].length||e)&&this.view.modify(d[0],d[1],d[2],e);a.DebugSettings.logDirtySet&&
(console.log("RGs add: "+d[0].map(function(a){return a.uniqueName})),console.log("RGs remove: "+d[1].map(function(a){return a.uniqueName})));b.getAddRemoveUpdateList(!0);b.clearDirtyMaterials();this.view.setNeedsRender()}};a.prototype.processDirtyLayer=function(a){var b=this.model.getDirtySet(),e=b.getDirtyMaterials();a=b.getAddRemoveUpdateListFilteredByLayers([a],!0);(0<a[0].length+a[1].length+a[2].length||e)&&this.view.modify(a[0],a[1],a[2],e);b.clearDirtyMaterials();this.view.setNeedsRender()};
a.prototype.get=function(a,b){return this.model.get(a,b)};a.prototype.getAll=function(a){return this.model.getAll(a)};a.prototype.addTextureListener=function(a){this.view.addTextureListener(a)};a.prototype.removeTextureListener=function(a){this.view.removeTextureListener(a)};a.prototype.getContainer=function(){return this.container};a.prototype.getCamera=function(){return this.view.getCamera()};a.prototype.setCamera=function(a){this.view.setCamera(a)};a.prototype.getViewParams=function(a){return this.view.getViewParams(a)};
a.prototype.setViewParams=function(a){this.view.setViewParams(a)};a.prototype.getLayers=function(){return this.model.getAll(g.LAYER)};a.prototype.setLighting=function(a){this.view.setLighting(a)};a.prototype.getCanvas=function(){return this.view.getCanvas()};a.prototype.setRenderParams=function(a){this.view.setRenderParams(a)};a.prototype.getRenderParams=function(){return this.view.getRenderParams()};a.prototype.has=function(a){return this.view.has(a)};a.prototype.getViewContent=function(){return this._viewContent.slice(0)};
a.prototype.setViewContent=function(a){var b=k.array2object(this._viewContent),e=k.array2object(a),c=k.subtractObjects(e,b),b=k.subtractObjects(b,e);this.processDirty();e=this.model.getDirtySet();c=e.getResidentRenderGeometriesFilteredByLayers(k.object2array(c));b=e.getResidentRenderGeometriesFilteredByLayers(k.object2array(b));this.view.modify(c,b,[]);this._viewContent=a.slice(0)};a.prototype.addToViewContent=function(a){for(var b=[],e=0;e<a.length;e++)-1===this._viewContent.indexOf(a[e])&&b.push(a[e]);
0<a.length&&(this.processDirty(),a=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(b),this.view.modify(a,[],[]),this._viewContent.push.apply(this._viewContent,b))};a.prototype.removeFromViewContent=function(a){this.processDirty();for(var b=this.model.getDirtySet(),e=this._viewContent,c=[],d=0;d<a.length;d++){var f=e.indexOf(a[d]);-1<f&&(e[f]=e[e.length-1],e.pop(),c.push(a[d]))}a=b.getResidentRenderGeometriesFilteredByLayers(c);this.view.modify([],a,[])};a.prototype.getViewFrustumObjects=
function(){return this.view.getFrustumObjects()};a.prototype.getLocalOrigin=function(a,b,e){return this.model.getOrigin(a,b,e)};a.prototype.getFrameTask=function(){return this.view.getFrameTask()};a.prototype.requestScreenCapture=function(a,b){this.view.requestScreenCapture(a,b)};a.prototype.getAllTexturesLoaded=function(){return this.view.getAllTexturesLoaded()};a.prototype.getTextureLoaded=function(a){return this.view.getTextureLoaded(a)};a.prototype.addExternalRenderer=function(a,b){"function"===
typeof b.intersect&&this._externalIntersectionHandlers.push(b);return this.view.addExternalRenderer(a,b)};a.prototype.removeExternalRenderer=function(a){var b=this._externalIntersectionHandlers.indexOf(a);-1<b&&this._externalIntersectionHandlers.splice(b,1);return this.view.removeExternalRenderer(a)};a.prototype.getContentDebugStrings=function(a){return this.model.formatDebugInfo(a)};a.prototype.getRenderStats=function(){return this.view.getCombinedStats()};a.prototype.getRenderStatString=function(a){var b=
this.getRenderStats(),e="";if(a){var e=e+"\x3ctable\x3e",c;for(c in b)e+="\x3ctr\x3e\x3ctd\x3e"+c+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Math.round(b[c])+"\x3c/td\x3e\x3c/tr\x3e";e+="\x3c/table\x3e"}else for(c in b)e+=c+": "+b[c]+"\n";return e};a.prototype.pick=function(a,b,e,c){var d=l.create(),f=l.create();this.view.getPickRay(a,d,f);return this.pickRay(d,f,a,a,b,e,c)};a.prototype.pickRayWithBeginPoint=function(a,b,e,c,d){this.view.pickRayWithBeginPoint(a,b,e,c,d)};a.prototype.pickRay=
function(a,b,d,c,g,k,h){c=this.view.getCamera();d||(d=t,c.projectPoint(b,d));var n;if(g){n=Array(g.length);for(var m=0;m<n.length;m++)n[m]=this.model.get(e.ContentType.LAYER,g[m])}else{n=[];g=this.getViewContent();for(var q=this.model.getAll(e.ContentType.LAYER),m=0;m<g.length;m++){var v=q[g[m]];v&&v.isPickable&&n.push(v)}}h?h.init(n,a,b,d,c,this._intersectTolerance,k):h=new f(this.viewingMode,n,a,b,d,c,this._intersectTolerance,k);for(m=0;m<this._externalIntersectionHandlers.length;m++)this._externalIntersectionHandlers[m].intersect(h,
a,b,d);if(h.getHudResults().length){m=h.getHudResults();m.sort(function(a,c){return c.dist-a.dist});b=m[m.length-1];g=u;c.projectPoint(b.center,g);g[0]=Math.round(g[0]);g[1]=Math.round(g[1]);q=r;this.view.getPickRay(g,a,q);d=l.dist(b.center,a)/l.dist(a,q)*.99;this._validateHUDSelector.init(n,a,q,g,c,this._intersectTolerance,k);for(m=0;m<this._externalIntersectionHandlers.length;m++)this._externalIntersectionHandlers[m].intersect(this._validateHUDSelector,a,q,g);a=this._validateHUDSelector.getMinResult();
(null==a.dist||d<=a.dist)&&h.getMinResult().copyFrom(b)}return h};a.prototype.getIntersectTolerance=function(){return this._intersectTolerance};a.prototype.setIntersectTolerance=function(a){void 0===a&&(a=1E-5);this._intersectTolerance=a};a.prototype.getTextureGraphicsRenderer=function(){return this.view.getTextureGraphicsRenderer()};a.DebugSettings={fineGrainedContentValidation:!1,endFrameContentValidation:!1,logDirtySet:!1};a.ModelContentType=g;return a}();var t=p.create(),u=h.create(),r=l.create();
return a})},"esri/views/3d/webgl-engine/parts/Model":function(){define("require exports dojo/string ../lib/gl-matrix ../lib/ModelContentType ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util".split(" "),function(p,h,d,a,g,f,k,m){var e=m.assert,b=a.vec3d,l=a.mat4d,t=m.logWithBase;return function(){function a(){this.dirtySet=new f(this);this._uniqueIdx=0;this._id2origin={};this.content={};for(var a in g)this.content[g[a]]={}}a.prototype.getAll=function(a){a=this.content[a];e(void 0!==a);return a};
a.prototype.get=function(a,b){return this.getAll(a)[b]};a.prototype.add=function(a,b){var d=this.content[a];e(void 0!==d);var f=b.id;e(null==d[f],"Model/Stage already contains object to be added");d[f]=b;a===g.LAYER&&this.notifyDirty(a,b,"layerAdded")};a.prototype.remove=function(a,b){var d=this.content[a];e(void 0!==d);var f=d[b];e(void 0!==f,"Model/Stage doesn't contain object to be removed");delete d[b];a===g.TEXTURE&&f.unload();a===g.LAYER&&this.notifyDirty(a,f,"layerRemoved");return f};a.prototype.getDirtySet=
function(){return this.dirtySet};a.prototype.notifyDirty=function(a,b,e,d){this.dirtySet.handleUpdate(b,e,d)};a.prototype.getOrigin=function(a,e,d){void 0===d&&(d=10);var f=0;e=e*d/1E4;1<e&&(f=Math.ceil(t(e,2)));e=1E4*Math.pow(2,f);d=Math.round(a[0]/e);var g=Math.round(a[1]/e);a=Math.round(a[2]/e);var f=f+"_"+d+"_"+g+"_"+a,c=this._id2origin[f];null==c&&(c={vec3:b.createFrom(d*e,g*e,a*e),id:f},this._id2origin[f]=c);return c};a.prototype.getGeometryRenderGeometries=function(a,b,e){var d=a.id,f=b.geometry,
c=f.getData(),g=!!f.singleUse,h=b.materials,m=b.instanceParameters,r=a.getCombinedStaticTransformation(b),q=l.maxScale(r),t=b.origin,f=f.getBoundingInfo(),u=b.id,v=this._uniqueIdx++;a=new k(c,f,h[0],r,b.customTransformation,q,a.getCastShadow(),g,d,u,v);a.origin=t||this.getOrigin(a.center,a.bsRadius);a.instanceParameters=m;e.push(a)};a.prototype.updateRenderGeometryTransformation=function(a,b,e){a.getCombinedStaticTransformation(b,e.transformation);e.updateTransformation(e.transformation)};a.prototype.formatDebugInfo=
function(a){var b=[];if(a){b[0]="\x3ctable\x3e";for(var e in g)a=g[e],b[0]+="\x3ctr\x3e\x3ctd\x3e"+a+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Object.keys(this.getAll(a)).length+"\x3c/td\x3e\x3c/tr\x3e";b[0]+="\x3c/table\x3e";b[1]=this.dirtySet.formatDebugInfo(!0)}else{b[0]="";for(e in g)a=g[e],b[0]+=d.pad(String(Object.keys(this.getAll(a)).length),6," ")+" "+a+", ";b[1]=this.dirtySet.formatDebugInfo(!1)}return b};a.prototype.validateContent=function(){var a=this.getAll(g.OBJECT),b;for(b in a)this.validateObject(a[b]);
var a=this.getAll(g.LAYER),e;for(e in a)this.validateLayer(a[e]);e=this.getAll(g.MATERIAL);for(var d in e)this.validateMaterial(e[d])};a.prototype.validateObject=function(a){a=a.geometryRecords;for(var b=0;b<a.length;++b){var d=a[b];e(null!=this.get(g.GEOMETRY,d.geometry.id));e(1===d.materials.length,"object materials do not match geometry groups");e(null!=this.get(g.MATERIAL,d.materials[0].id))}};a.prototype.validateLayer=function(a){a=a.getObjects();for(var b=0;b<a.length;++b){var d=this.get(g.OBJECT,
a[b].id);e(null!=d)}};a.prototype.validateMaterial=function(a){a=a.getAllTextureIds();for(var b=0;b<a.length;++b){var d=this.get(g.TEXTURE,a[b]);e(null!=d)}};a.ContentType=g;return a}()})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define(["require","exports","./ModelContentType","./Util"],function(p,h,d,a){var g=a.objectEmpty,f=a.assert;return function(){function a(a){this._residentGeomRecords={};this._dirtyGeomRecords={};this._dirtyMaterials={};this._model=a}Object.defineProperty(a.prototype,
"residentLayerCount",{get:function(){return Object.keys(this._residentGeomRecords).length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"residentObjectCount",{get:function(){var a=0,e;for(e in this._residentGeomRecords)a+=Object.keys(this._residentGeomRecords[e]).length;return a},enumerable:!0,configurable:!0});a.prototype._getResidentGeometryRecords=function(){return this._residentGeomRecords};a.prototype._getDirtyGeometryRecords=function(){return this._dirtyGeomRecords};a.prototype.getDirtyMaterials=
function(){return g(this._dirtyMaterials)?null:this._dirtyMaterials};a.prototype.clearDirtyMaterials=function(){this._dirtyMaterials={}};a.prototype.hasDirtyGeometryRecords=function(){for(var a in this._dirtyGeomRecords)for(var e in this._dirtyGeomRecords[a]){var b=this._dirtyGeomRecords[a][e];if(b&&!g(b))return!0}return!1};a.prototype.handleUpdate=function(a,e,b){f(this[e],"ModelDirtySet doesn't know how to process "+e);return this[e](a,b)};a.prototype.shaderTransformationChanged=function(a){if(a=
this._residentGeomRecords[a.id])for(var e in a){var b=this._model.content[d.OBJECT][e];if(b&&b.hasVolativeTransformation()){var b=a[e],f;for(f in b)for(var g=0,k=b[f][1];g<k.length;g++)k[g].shaderTransformationChanged()}}};a.prototype.getAddRemoveUpdateList=function(a){return this.getAddRemoveUpdateListFilteredByLayers(Object.keys(this._dirtyGeomRecords),a)};a.prototype.getAddRemoveUpdateListFilteredByLayers=function(a,e){for(var b=[],k=[],h=[],m=0;m<a.length;m++){var r=a[m];if(r in this._dirtyGeomRecords){for(var v in this._dirtyGeomRecords[r]){var q=
this._dirtyGeomRecords[r][v];if(q){var n=this._createObjectRecordObjIfNonexistent(this._residentGeomRecords,r,v),w;for(w in q){var c=q[w],x=c[0],p=c[1],c=c[2],A=p&2&&c&1;if(p&4||A){var y=n[w];y?k.push.apply(k,y[1]):4===p&&f(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");e&&y&&delete n[w]}if(p&1||A){var y=[x,[]],B=this._model.get(d.OBJECT,v);this._model.getGeometryRenderGeometries(B,x,y[1]);b.push.apply(b,y[1]);e&&(n[w]=y)}if(p&2&&!A)if(y=n[w],B=this._model.get(d.OBJECT,v),y){p=
y[1];A=p.length;if(c&16)for(y=0;y<A;y++){var E=p[y];this._model.updateRenderGeometryTransformation(B,x,E)}for(y=0;y<A;y++)E=p[y],h.push({renderGeometry:E,updateType:c})}else f(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}g(n)&&delete this._residentGeomRecords[r][v]}}g(this._residentGeomRecords[r])&&delete this._residentGeomRecords[r]}e&&delete this._dirtyGeomRecords[r]}return[b,k,h]};a.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(Object.keys(this._residentGeomRecords))};
a.prototype.getResidentRenderGeometriesFilteredByLayers=function(a){for(var e=[],b=0;b<a.length;b++){var d=a[b];if(d in this._residentGeomRecords)for(var f in this._residentGeomRecords[d]){var g=this._residentGeomRecords[d][f];if(g)for(var k in g)e.push.apply(e,g[k][1])}}return e};a.prototype.visibilityChanged=function(a,e,b){if(null!=e)this._componentPropertyChanged(a,e,b,2);else{e=0;for(var d=a.getGeometryRecords();e<d.length;e++)this._componentPropertyChanged(a,d[e],b,2)}};a.prototype.componentHighlightChanged=
function(a,e,b){if(null!=e)this._componentPropertyChanged(a,e,b,32);else{e=0;for(var d=a.getGeometryRecords();e<d.length;e++)this._componentPropertyChanged(a,d[e],b,32)}};a.prototype.vertexAttrsUpdated=function(a,e,b){this._updateOrCreateDirtyRecord(a,e,b,2,0,0,2,5,4)};a.prototype.matChanged=function(a){this._dirtyMaterials[a.id]=!0};a.prototype.layerAdded=function(a){for(var e=a.getObjects(),b=0;b<e.length;b++)this.layObjectAdded(a,e[b])};a.prototype.layerRemoved=function(a){for(var e=a.getObjects(),
b=0;b<e.length;b++)this.layObjectRemoved(a,e[b])};a.prototype.layObjectAdded=function(a,e){a=a.id;for(var b=e.getGeometryRecords(),d=0;d<b.length;d++)this.objGeometryAdded(e,b[d],a)};a.prototype.layObjectRemoved=function(a,e){a=a.id;for(var b=e.getGeometryRecords(),d=0;d<b.length;d++)this.objGeometryRemoved(e,b[d],a)};a.prototype.layObjectReplaced=function(a,e){this.layObjectRemoved(a,e[0]);this.layObjectAdded(a,e[1])};a.prototype.objDirty=function(a,e){e=e||this._getParentLayerId(a);var b=this._createObjectRecordObjIfNonexistent(this._residentGeomRecords,
e,a.id),d;for(d in b)this._updateOrCreateDirtyRecord(a,b[d][0],e,2,0,2,0,5,1)};a.prototype.objTransformation=function(a,e){e=e||this._getParentLayerId(a);var b=this._createObjectRecordObjIfNonexistent(this._residentGeomRecords,e,a.id),d;for(d in b)this._updateOrCreateDirtyRecord(a,b[d][0],e,2,0,0,2,5,16)};a.prototype.objGeometryAdded=function(a,e,b){this._updateOrCreateDirtyRecord(a,e,b,1,4,0,0,0)};a.prototype.objGeometryRemoved=function(a,e,b){this._updateOrCreateDirtyRecord(a,e,b,4,1,2,0,0)};a.prototype.objGeometryReplaced=
function(a,e){this.objGeometryRemoved(a,e[0]);this.objGeometryAdded(a,e[1])};a.prototype.objGeometryTransformation=function(a,e){this.objGeometryReplaced(a,e)};a.prototype._componentPropertyChanged=function(a,e,b,d){this._updateOrCreateDirtyRecord(a,e,b,2,0,0,2,5,d)};a.prototype._updateOrCreateDirtyRecord=function(a,e,b,d,g,k,h,v,q){b=b||this._getParentLayerId(a);var l=e.id;a=this._createObjectRecordObjIfNonexistent(this._dirtyGeomRecords,b,a.id);(b=a[l])?(e=b[1],e&g?delete a[l]:e&k?(b[1]=d,b[2]=
q):e&h?b[2]|=q:e&v||f(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")):a[l]=[e,d,q]};a.prototype._createObjectRecordObjIfNonexistent=function(a,e,b){a[e]||(a[e]={});a[e][b]||(a[e][b]={});return a[e][b]};a.prototype._getParentLayerId=function(a){return a.parentLayer.id};a.prototype.formatDebugInfo=function(a){var e=["ADD","UPD",void 0,"REM"];if(a)return"";a="";for(var b in this._dirtyGeomRecords)for(var d in this._dirtyGeomRecords[b]){var f=this._dirtyGeomRecords[b][d];if(f){0<a.length&&(a+=
"\n");a+=b+"."+d;var g=[],k;for(k in f){var h=f[k][1];g[h]||(g[h]=[]);g[h].push(f[k][0].geometry.id)}for(f=0;f<g.length;f++)if(g[f])for(a+=" "+e[f-1]+": ",h=0;h<g[f].length;h++)a+=g[f][h]+", "}}return a};return a}()})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define(["require","exports","./gl-matrix"],function(p,h,d){var a=d.vec3d,g=d.mat4d;return function(){function d(d,f,e,b,g,h,u,r,v,q,n){this.shaderTransformationDirty=!0;this.data=d.toRenderData();this.componentOffsets=d.componentOffsets;
this.boundingInfo=f;this.material=e;this.origin=null;this.center=a.create();this.bsRadius=0;this.transformation=null;this.calculateShaderTransformation=g;b&&this.updateTransformation(b,h);this.castShadow=u;this.singleUse=r;this.name=v;this.uniqueName=q;this.idx=n;this.canBeMerged=!0;this.instanceParameters={}}d.prototype.updateTransformation=function(a,d){this.transformation=a;this.shaderTransformationDirty=!0;this.bsRadius=this.getBoundingSphere(a,d,this.center)};d.prototype.shaderTransformationChanged=
function(){this.shaderTransformationDirty=!0};d.prototype.getBoundingSphere=function(a,d,e){d=d||g.maxScale(a);g.multiplyVec3(a,this.boundingInfo.getCenter(),e);return this.boundingInfo.getBSRadius()*d};Object.defineProperty(d.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0});d.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||
(this.shaderTransformation=g.create()),g.set(this.calculateShaderTransformation(this.transformation),this.shaderTransformation),this.shaderTransformationDirty=!1),this.shaderTransformation):this.transformation};return d}()})},"esri/views/3d/webgl-engine/parts/View":function(){define("require exports ../../../../core/Logger ../../../../core/sniff ../lib/gl-matrix ../lib/GLMaterialRep ../lib/GLTextureRep ../lib/HighlightHelper ../lib/OffscreenRenderingHelper ../lib/ProgramRepository ../lib/RenderOccludedHelper ../lib/ShaderSnippets ../lib/SSAOHelperObscurance ../lib/TextureRenderer ../lib/tracer ../lighting/Lightsources ../materials/repository ./Model ./Viewport ../../../support/screenshotUtils ../../../webgl/context-util ../../../webgl/RenderingContext".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x,z,A){var y=g.vec3d,B=g.vec4d,E=d.getLogger("esri.views.3d.webgl-engine.parts.View");return function(){function d(a,b,d,e){var g=this;this._backgroundColor=B.createFrom(1,1,1,1);this._lightDirection=y.createFrom(0,1,0);this._didRender=!1;this._idleSuspend=this._needsRender=!0;this._shouldRender=!1;this._screenCaptureQueue=[];this._container=a;this._stage=b;this._initializeContext(e);this._initializeShaders(e);this._textureRep=new k(b.getAll(w.ContentType.TEXTURE),
this._programRepository,function(){return g._viewport.getCamera().viewport},this._rctx);this._materialRep=new f(this._textureRep,this._programRepository);this._viewport=new c(this._programRepository,this._materialRep,this._textureRep,this._rctx);this._initializeViewportCamera();this._textureRenderer=new r(this._rctx,this._canvas,this._programRepository,this._materialRep,this._textureRep,d);this._initializeFrameTask()}Object.defineProperty(d.prototype,"isLoadingResources",{get:function(){return this._viewport.isLoadingResources},
enumerable:!0,configurable:!0});d.prototype._initializeFrameTask=function(){var a=this;this._frameTask={preRender:function(){v.begin();a._stage.processDirty();a.needsRender()?(a._shouldRender=!0,a._viewport.getCamera().setGLViewport(a._rctx),a._rctx.setClearColor.apply(a._rctx,a._backgroundColor),a._rctx.clear(16640)):a._shouldRender=!1},render:function(){a._shouldRender&&(a._didRender=!0,a._viewport.render(a._lightDirection,null))},postRender:function(){v.end()},update:function(){a._performScreenCaptures();
a.resetNeedsRender()}}};d.prototype._initializeViewportCamera=function(){var a=this._container.getBoundingClientRect(),c=this._viewport.getCamera();c.viewport[2]=a.width;c.viewport[3]=a.height;this._viewport.setCamera(c)};d.prototype._initializeContext=function(c){this._canvas=c.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var b=z.createContextOrErrorHTML(this._canvas,{alpha:c.alpha||!1,antialias:!1,
depth:!0,stencil:null==c.stencil?!0:c.stencil},c.renderContext);this._gl=v.instrumentContext(b);this._rctx=new A(this._gl,{disabledExtensions:c.deactivatedWebGLExtensions});!c.alpha&&this._rctx.contextAttributes.alpha&&E.error("WebGL context has alpha channel even though no alpha channel was requested");11<=a("safari")&&(this._container.style.backgroundColor="black");this._container.appendChild(this._canvas)};d.prototype._initializeShaders=function(a){this._shaderSnippets=new t({fsprecisionf:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\nprecision highp sampler2D;\n#else\nprecision mediump float;\nprecision mediump sampler2D;\n#endif\n",
vsprecisionf:"\nprecision highp float;\nprecision highp sampler2D;\n",viewingMode:"global"===a.viewingMode?"#define VIEWING_MODE_GLOBAL 1 \n":" #define VIEWING_MODE_LOCAL 1 \n"});this._programRepository=new b;n.initializeShaders(this._shaderSnippets,this._programRepository,this._rctx);m.loadShaders(this._shaderSnippets,this._programRepository,this._rctx);l.loadShaders(this._shaderSnippets,this._programRepository,this._rctx);u.loadShaders(this._shaderSnippets,this._programRepository,this._rctx);e.loadShaders(this._shaderSnippets,
this._programRepository,this._rctx)};d.prototype.dispose=function(){this._viewport.dispose();this._viewport=null;this._textureRenderer.dispose();this._textureRenderer=null;this._programRepository.dispose();this._programRepository=null;this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._gl=this._canvas=this._container=null};d.prototype.getCombinedStats=function(){return this._viewport.getCombinedStats()};d.prototype.setNeedsRender=function(){this._didRender=!1;this._needsRender=
!0};d.prototype.resetNeedsRender=function(){this._didRender&&(this._didRender=this._needsRender=!1);this._viewport.resetNeedsRender();this._textureRep.resetNeedsRender()};d.prototype.needsRender=function(){return this._needsRender||!this._idleSuspend||this._viewport.needsRender()||this._textureRep.needsRender()};d.prototype.getFrameTask=function(){return this._frameTask};d.prototype.setLighting=function(a){y.set3(0,0,0,this._lightDirection);for(var c=0,b=a.lights;c<b.length;c++){var d=b[c];if(d instanceof
q.MainLight){y.negate(d.direction,this._lightDirection);break}}this._viewport.setLighting(a);this._needsRender=!0};d.prototype.getEdgeView=function(){return this._viewport.getEdgeView()};d.prototype.getMainLightDirection=function(){return this._lightDirection};d.prototype.getViewParams=function(a){var c=this._viewport.getViewParams(a);if(!a||a.backgroundColor)c.backgroundColor=this._backgroundColor;return c};d.prototype.setViewParams=function(a){this._needsRender=!0;a.backgroundColor&&(this._backgroundColor=
a.backgroundColor);this._viewport.setViewParams(a)};d.prototype.setRenderParams=function(a){this._needsRender=!0;void 0!==a.idleSuspend&&(this._idleSuspend=!!a.idleSuspend);this._viewport.setRenderParams(a)};d.prototype.getRenderParams=function(){var a=this._viewport.getRenderParams();a.anisotropicFiltering=this._textureRep.getMaxAnisotropy();a.idleSuspend=this._idleSuspend;return a};Object.defineProperty(d.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0});
d.prototype.has=function(a){return"s3tc"===a?!!this._rctx.capabilities.compressedTextureS3TC:"standardDerivatives"===a?!!this._rctx.capabilities.standardDerivatives:"shaderTextureLOD"===a?!!this._rctx.capabilities.shaderTextureLOD:"instancedRendering"===a?!!this._rctx.capabilities.instancing:!1};d.prototype.getFrustumObjects=function(){return this._viewport.getFrustumObjects()};d.prototype.modify=function(a,c,b,d){this._viewport.modify(a,c,b,d)};d.prototype.setCamera=function(a){this._viewport.setCamera(a)};
d.prototype.getCamera=function(){return this._viewport.getCamera()};d.prototype.getPickRay=function(a,c,b){this._viewport.getPickRay(a,c,b)};d.prototype.pickRayWithBeginPoint=function(a,c,b,d,e){this._viewport.pickRayWithBeginPoint(a,c,b,d,e)};d.prototype.getCanvas=function(){return this._canvas};d.prototype.getTextureGraphicsRenderer=function(){return this._textureRenderer};d.prototype.requestScreenCapture=function(a,c){this._screenCaptureQueue.push({settings:a||{},callback:c});this._needsRender=
!0};d.prototype.getAllTexturesLoaded=function(){return 0===this._textureRep.getLoadingCount()};d.prototype.getTextureLoaded=function(a){return this._textureRep.getIsLoaded(a)};d.prototype.addTextureListener=function(a){this._textureRep.addTextureListener(a)};d.prototype.removeTextureListener=function(a){this._textureRep.removeTextureListener(a)};d.prototype.addExternalRenderer=function(a,c){return this._viewport.addExternalRenderer(a,c)?(c.initializeRenderContext({rctx:this._rctx,gl:this._rctx.gl,
shaderSnippets:this._shaderSnippets,programRep:this._programRepository,textureRep:this._textureRep}),!0):!1};d.prototype.removeExternalRenderer=function(a){return this._viewport.removeExternalRenderer(a)?(a.uninitializeRenderContext({rctx:this._rctx,gl:this._rctx.gl}),!0):!1};d.prototype._performScreenCaptures=function(){if(0!==this._screenCaptureQueue.length){for(var a=0;a<this._screenCaptureQueue.length;a++){var c=this._screenCaptureQueue[a],b=0,d=0,e=this._canvas.width,f=this._canvas.height,g=
this._canvas.width,k=this._canvas.height,l=c.settings.area;l&&(b=l.x,d=l.y,e=l.width,f=l.height);void 0!==c.settings.width&&void 0!==c.settings.height?(l=c.settings.width/c.settings.height,f*l<e?(l*=f,b+=Math.floor((e-l)/2),e=Math.floor(l)):(l=e/l,d+=Math.floor((f-l)/2),f=Math.floor(l)),g=c.settings.width,k=c.settings.height):(g=e,k=f);var h=this._canvas,l=null;if(0!==b||0!==d||e!==this._canvas.width||f!==this._canvas.height||g!==this._canvas.width||k!==this._canvas.height){this._resizeCanvas||(this._resizeCanvas=
document.createElement("canvas"));this._resizeCanvas.width=g;this._resizeCanvas.height=k;var n=this._resizeCanvas.getContext("2d"),l=new Uint8Array(e*f*4);this._gl.readPixels(b,this._canvas.height-(d+f),e,f,6408,5121,l);b=n.getImageData(0,0,g,k);x.resampleHermite(l,e,f,b.data,g,k,!0);n.putImageData(b,0,0);h=this._resizeCanvas;n=null}e={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"}[c.settings.format?c.settings.format.toLowerCase():"png"];f=1;void 0!==c.settings.quality&&(f=c.settings.quality/
100);e={dataURL:h.toDataURL(e,f),x:0,y:0,width:g,height:k};c.settings.returnByteBuffer&&(e.data=l);c.callback(e)}this._screenCaptureQueue=[]}};return d}()})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define(["require","exports","./Util"],function(p,h,d){var a=function(){function a(a){this.refCnt=0;this.glMaterial=a}a.prototype.incRefCnt=function(){++this.refCnt};a.prototype.decRefCnt=function(){--this.refCnt;d.assert(0<=this.refCnt)};a.prototype.getRefCnt=function(){return this.refCnt};
a.prototype.getGLMaterial=function(){return this.glMaterial};return a}();return function(){function d(a,d){this.textureRep=a;this.programRep=d;this.id2glMaterialRef={}}d.prototype.aquire=function(a){return this.aquireExt(a,"color")};d.prototype.aquireDepthShadowMap=function(a){return this.aquireExt(a,"depthShadowMap")};d.prototype.aquireDepth=function(a){return this.aquireExt(a,"depth")};d.prototype.aquireNormal=function(a){return this.aquireExt(a,"normal")};d.prototype.aquireHighlight=function(a){return this.aquireExt(a,
"highlight")};d.prototype.aquireExt=function(d,g){var f=d.id+"_"+g,e=this.id2glMaterialRef[f];null==e?(d=(e=d.getGLMaterials()[g])?new e(d,this.programRep,this.textureRep):void 0,e=new a(d),this.id2glMaterialRef[f]=e):d=e.getGLMaterial();e.incRefCnt();d&&this.increaseProgramReferences(d);return d};d.prototype.release=function(a){this.releaseExt(a,"color")};d.prototype.releaseDepth=function(a){this.releaseExt(a,"depth")};d.prototype.releaseNormal=function(a){this.releaseExt(a,"normal")};d.prototype.releaseDepthShadowMap=
function(a){this.releaseExt(a,"depthShadowMap")};d.prototype.releaseHighlight=function(a){this.releaseExt(a,"highlight")};d.prototype.releaseExt=function(a,d){a=a+"_"+d;d=this.id2glMaterialRef[a];d.decRefCnt();if(0===d.getRefCnt()){if(d=d.getGLMaterial())this.decreaseProgramReferences(d),d.dispose();delete this.id2glMaterialRef[a]}};d.prototype.updateMaterialParameters=function(a){var d=this.id2glMaterialRef[a+"_color"];d&&d.getGLMaterial()&&this.updateParamsForMat(d.getGLMaterial());(d=this.id2glMaterialRef[a+
"_depth"])&&d.getGLMaterial()&&this.updateParamsForMat(d.getGLMaterial());(d=this.id2glMaterialRef[a+"_depthShadowMap"])&&d.getGLMaterial()&&this.updateParamsForMat(d.getGLMaterial());(d=this.id2glMaterialRef[a+"_normal"])&&d.getGLMaterial()&&this.updateParamsForMat(d.getGLMaterial());(a=this.id2glMaterialRef[a+"_highlight"])&&a.getGLMaterial()&&this.updateParamsForMat(a.getGLMaterial())};d.prototype.updateParamsForMat=function(a){a.updateParameters&&a.updateParameters()};d.prototype.increaseProgramReferences=
function(a){a=a.getPrograms();for(var d=0;d<a.length;d++)this.programRep.increaseRefCount(a[d])};d.prototype.decreaseProgramReferences=function(a){a=a.getPrograms();for(var d=0;d<a.length;d++)this.programRep.decreaseRefCount(a[d])};return d}()})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("require exports dojo/text!../materials/internal/highlight.xml ../../support/debugFlags ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./gl-matrix ./glUtil3D ./Util ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r){var v=k.vec4d;return function(){function k(a,b,c){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};this.blur1Fbo=this.blur0Fbo=this.quadVAO=null;this._rctx=c;this.viewportToRestore=v.create();this.programRep=a;this.defaultOptions={color:new Float32Array([1,0,1,1]),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05}}k.prototype._gridUpdateResources=
function(a,d){var c=this._rctx,e=this._grid,k=!1;null===e.coverageMipmap&&(e.coverageMipmap=[a],k=!0);if(e.viewportWidth!==a.width||e.viewportHeight!==a.height)k=!0,e.viewportWidth=a.width,e.viewportHeight=a.height;e.coverageMipmap[0]=a;e.cellPixelSize!==d&&(e.cellPixelSize=d,k=!0);if(k){for(d=1;d<e.coverageMipmap.length;d++)e.coverageMipmap[d].dispose();e.mipmapLevels=Math.ceil(Math.log(e.cellPixelSize)*Math.LOG2E);e.coverageMipmap.length=e.mipmapLevels+1;for(d=0;d<e.mipmapLevels;d++)k=e.coverageMipmap[d],
k=l.createWithAttachments(c,{target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(k.width/2),height:Math.ceil(k.height/2)},{colorTarget:0,depthStencilTarget:0,width:Math.ceil(k.width/2),height:Math.ceil(k.height/2)}),e.coverageMipmap[d+1]=k}var k=Math.ceil(a.height/e.cellPixelSize),h=Math.ceil(a.width/e.cellPixelSize);if(!e.vao||e.verticalCellCount!==k||e.horizontalCellCount!==h){e.verticalCellCount=k;e.horizontalCellCount=h;a=k+1;d=h+1;for(var k=1/k,h=1/h,
n=new Float32Array(24*a*d),m=0,q=0;q<a;q++)for(var t=0;t<d;t++)n[m+0]=(t-.5)*h*2-1,n[m+1]=(q-.5)*k*2-1,n[m+2]=t*h,n[m+3]=q*k,n[m+4]=(t+.5)*h*2-1,n[m+5]=(q-.5)*k*2-1,n[m+6]=t*h,n[m+7]=q*k,n[m+8]=(t-.5)*h*2-1,n[m+9]=(q+.5)*k*2-1,n[m+10]=t*h,n[m+11]=q*k,n[m+12]=(t-.5)*h*2-1,n[m+13]=(q+.5)*k*2-1,n[m+14]=t*h,n[m+15]=q*k,n[m+16]=(t+.5)*h*2-1,n[m+17]=(q-.5)*k*2-1,n[m+18]=t*h,n[m+19]=q*k,n[m+20]=(t+.5)*h*2-1,n[m+21]=(q+.5)*k*2-1,n[m+22]=t*h,n[m+23]=q*k,m+=24;e.vao&&e.vao.dispose(!0);e.vao=new r(c,g.Default3D,
{geometry:f.Pos2Tex},{geometry:b.createVertex(c,35044,n)})}};k.prototype._gridComputeMipmap=function(){var a=this._rctx,b=this._grid,c=this.programRep.get("conservative-downsample");a.bindVAO(this.quadVAO);for(var d=0;d<b.mipmapLevels;d++){a.bindFramebuffer(b.coverageMipmap[d+1]);a.bindTexture(b.coverageMipmap[d].colorTexture,0);var e=b.coverageMipmap[d+1].width,f=b.coverageMipmap[d+1].height;a.bindProgram(c);c.setUniform1i("tex",0);c.setUniform2f("invFramebufferDim",1/e,1/f);a.setViewport(0,0,e,
f);a.drawArrays(5,0,u.vertexCount(this.quadVAO,"geometry"))}};Object.defineProperty(k.prototype,"profilingCallback",{get:function(){return a.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(a){return console.log(a)}:null},enumerable:!0,configurable:!0});k.prototype.getIsSupported=function(){return!0};k.prototype.setEnableState=function(a){a?this.enable():this.disable()};k.prototype.getEnableState=function(){return null!==this.blur0Fbo};k.prototype.enable=function(){this.quadVAO=m.createQuadVAO(this._rctx);
var a={colorTarget:0,depthStencilTarget:0,width:0,height:0},b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=l.createWithAttachments(this._rctx,b,a);this.blur1Fbo=l.createWithAttachments(this._rctx,b,a)};k.prototype.disable=function(){this.getEnableState()&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.blur1Fbo=this.blur0Fbo=this.quadVAO=null)};k.prototype.getHighlightFBO=function(){return this.blur0Fbo};
k.prototype.render=function(b,d,c){var f=!a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,g=a.HIGHLIGHTS_VISUALIZE_BLOCKS,k=this._rctx;e.assert(this.getEnableState());v.set(b.fullViewport,this.viewportToRestore);b=Math.ceil(c.width/1);var l=Math.ceil(c.height/1);this.blur0Fbo.resize(b,l);this.blur1Fbo.resize(b,l);k.bindVAO(this.quadVAO);k.setDepthWriteEnabled(!1);k.setDepthTestEnabled(!1);k.setBlendingEnabled(!1);var h=null,n=h=null,m=null;if(f){var r=this._grid;this._gridUpdateResources(c,32);this._gridComputeMipmap();
n=r.vao;m=4;h=this.programRep.get("highlight-blur-grid-5");k.bindProgram(h);k.bindTexture(r.coverageMipmap[r.mipmapLevels].colorTexture,1);h.setUniform1i("coverageTex",1)}else n=this.quadVAO,m=5,h=this.programRep.get("highlight-blur-5"),k.bindProgram(h);k.bindVAO(n);k.bindFramebuffer(this.blur0Fbo);k.setViewport(0,0,b,l);k.setClearColor(0,0,0,0);k.clear(k.gl.COLOR_BUFFER_BIT);h.setUniform1i("tex",0);k.bindTexture(c.colorTexture,0);h.setUniform2f("blurSize",1/b,0);k.drawArrays(m,0,u.vertexCount(n,
"geometry"));k.bindFramebuffer(this.blur1Fbo);k.clear(k.gl.COLOR_BUFFER_BIT);k.bindTexture(this.blur0Fbo.colorTexture,0);h.setUniform2f("blurSize",0,1/l);k.drawArrays(m,0,u.vertexCount(n,"geometry"));k.bindFramebuffer(d);k.setBlendingEnabled(!0);k.setBlendFunctionSeparate(770,771,1,771);k.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);f?(h=this.programRep.get(g?"highlight-apply-grid-debug":"highlight-apply-grid"),k.bindProgram(h),
h.setUniform1i("coverageTex",2),k.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,2)):(h=this.programRep.get("highlight-apply"),k.bindProgram(h));h.setUniform1i("tex",0);k.bindTexture(this.blur1Fbo.colorTexture,0);h.setUniform1i("origin",1);k.bindTexture(c.colorTexture,1);h.setUniform4fv("color",this.defaultOptions.color);h.setUniform1f("outlineSize",8.6);h.setUniform1f("blurSize",.4);h.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,
this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded);k.drawArrays(m,0,u.vertexCount(n,"geometry"));k.bindVAO(null);k.setDepthWriteEnabled(!0);k.setDepthTestEnabled(!0);k.setBlendingEnabled(!1)};k.prototype.setDefaultOptions=function(a){this.defaultOptions=a};k.loadShaders=function(a,b,c){a._parse(d);for(var e=0,f=["3","5","7","9"];e<f.length;e++){var k=f[e];b.add("highlight-blur-"+k,new t(c,a.vsHighlightBlurFastGaussian,a.fsHighlightBlurFastGaussian,g.Default3D,{GAUSSIAN_SAMPLES:k}));
b.add("highlight-blur-grid-"+k,new t(c,a.vsHighlightBlurFastGaussian,a.fsHighlightBlurFastGaussian,g.Default3D,{GAUSSIAN_SAMPLES:k,GRID_OPTIMIZATION:"true"}))}b.add("highlight-apply",new t(c,a.vsHighlightApply,a.fsHighlightApply,g.Default3D));b.add("highlight-apply-grid",new t(c,a.vsHighlightApply,a.fsHighlightApply,g.Default3D,["GRID_OPTIMIZATION"]));b.add("highlight-apply-grid-debug",new t(c,a.vsHighlightApply,a.fsHighlightApply,g.Default3D,["GRID_OPTIMIZATION","GRID_DEBUG"]));b.add("conservative-downsample",
new t(c,a.vsConservativeDownsample,a.fsConservativeDownsample,g.Default3D))};return k}()})},"esri/views/3d/webgl-engine/lib/ProgramRepository":function(){define(["require","exports","./Util"],function(p,h,d){return function(){function a(){this.shaderVariators={};this._nextId=0;this._programsByName={};this._namesById=[];this._programRefCount=[];this._commonUniforms={model:[],modelNormal:[],lightDirection:[],proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}a.prototype.dispose=
function(){for(var a in this._programsByName)this._programsByName[a].dispose();this._programRefCount=this._namesById=this._programsByName=null};a.prototype.add=function(a,f){d.assert(null==this._programsByName[a]);this._programsByName[a]=f;this._namesById[f.id]=a};a.prototype.get=function(a){return this._programsByName[a]};a.prototype.addShaderVariations=function(a,d){this.shaderVariators[a]=d};a.prototype.getShaderVariations=function(a){return this.shaderVariators[a]};a.prototype.getShaderVariationsProgram=
function(a,d,k,h,e){return(a=this.getShaderVariations(a))&&a.getProgram(d,k,h,e)};a.prototype.getProgramsUsingUniform=function(a){return this._commonUniforms[a]||[]};a.prototype.increaseRefCount=function(a){var d=a.id;this._programRefCount[d]?this._programRefCount[d]++:(this._programRefCount[d]=1,this._findCommonUniforms(a))};a.prototype.decreaseRefCount=function(a){var d=a.id;1<this._programRefCount[d]?this._programRefCount[d]--:(this._forgetCommonUniforms(a),this._programRefCount[d]=0)};a.prototype._getNextId=
function(){return this._nextId++};a.prototype._findCommonUniforms=function(a){for(var f in this._commonUniforms)a.hasUniform(f)&&(d.assert(-1===this._commonUniforms[f].indexOf(a),"common uniforms of program have already been determined"),this._commonUniforms[f].push(a))};a.prototype._forgetCommonUniforms=function(a){for(var d in this._commonUniforms){var g=this._commonUniforms[d],h=g.indexOf(a);-1<h&&(g[h]=g[g.length-1],g.pop())}};return a}()})},"esri/views/3d/webgl-engine/lib/RenderOccludedHelper":function(){define("require exports dojo/text!../materials/internal/occluded.xml ./DefaultVertexAttributeLocations ./gl-matrix ./glUtil3D ./Util ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/Util".split(" "),
function(p,h,d,a,g,f,k,m,e,b){var l=g.vec4d;return function(){function g(a,b,d){this._quadVAO=null;this._rctx=d;this._colorFBO=void 0;this._viewportToRestore=l.create();this.programRep=a}Object.defineProperty(g.prototype,"colorFBO",{get:function(){return this._colorFBO},enumerable:!0,configurable:!0});g.prototype.setEnableState=function(a){a?this.enable():this.disable()};g.prototype.getEnableState=function(){return void 0!==this._colorFBO};g.prototype.enable=function(){this._quadVAO=f.createQuadVAO(this._rctx);
this._colorFBO=m.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1})};g.prototype.disable=function(){this.getEnableState()&&(this._quadVAO.dispose(!0),this._quadVAO=void 0,this._colorFBO.dispose(),this._colorFBO=void 0)};g.prototype.setupFBOs=function(a){k.assert(this.getEnableState());this._viewportToRestore=a=a.fullViewport;this._width=a[2];this._height=a[3];this._rctx.setViewport(0,
0,this._width,this._height)};g.prototype.prepareColorPass=function(){k.assert(this.getEnableState());var a=this._rctx,b=a.gl;this._colorFBO.resize(this._width,this._height);a.bindFramebuffer(this._colorFBO);a.setClearColor(0,0,0,0);a.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT)};g.prototype.finish=function(a){var b=this._rctx;b.bindFramebuffer(a);b.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])};g.prototype.apply=function(){var a=
this._rctx,d=this.programRep.get("render-occluded-apply");a.bindProgram(d);a.bindVAO(this._quadVAO);a.bindTexture(this._colorFBO.colorTexture,0);d.setUniform1i("occludedColorMap",0);a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunction(770,771);a.drawArrays(5,0,b.vertexCount(this._quadVAO,"geometry"));a.bindVAO(null);a.setDepthWriteEnabled(!0);a.setDepthTestEnabled(!0);a.setBlendingEnabled(!1)};g.loadShaders=function(b,f,g){b._parse(d);f.add("render-occluded-apply",
new e(g,b.vsRenderOccludedApply,b.fsRenderOccludedApply,a.Default3D))};return g}()})},"esri/views/3d/webgl-engine/lib/ShaderSnippets":function(){define(["require","exports","dojox/xml/parser","./Util"],function(p,h,d,a){return function(){function g(d){var f=a.VertexAttrConstants,g;for(g in f)this[f[g]]=a.VertexAttrConstants[g];if(d)for(var e in d)this[e]=d[e]}g.prototype._parse=function(f){f=d.parse(f).getElementsByTagName("snippet");for(var g=/\$[a-zA-Z0-9_]+[ \t]*/,h=/[\$\s]+/g,e=0;e<f.length;e++){var b=
f[e].getAttribute("name");a.assert(null==this[b]);for(var l=f[e].textContent;;){var t=l.match(g);if(null==t)break;var u=this[t[0].replace(h,"")];a.assert(void 0!==u);l=l.replace(t[0],u)}this[b]=l}};return g}()})},"dojox/xml/parser":function(){define(["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/window","dojo/_base/sniff"],function(p){p.getObject("xml.parser",!0,dojox);dojox.xml.parser.parse=function(h,d){var a=p.doc,g;d=d||"text/xml";if(h&&p.trim(h)&&"DOMParser"in p.global){g=
(new DOMParser).parseFromString(h,d);h=g.documentElement;if("parsererror"==h.nodeName&&"http://www.mozilla.org/newlayout/xml/parsererror.xml"==h.namespaceURI){if(a=h.getElementsByTagNameNS("http://www.mozilla.org/newlayout/xml/parsererror.xml","sourcetext")[0])a=a.firstChild.data;throw Error("Error parsing text "+h.firstChild.data+" \n"+a);}return g}if("ActiveXObject"in p.global){a=function(a){return"MSXML"+a+".DOMDocument"};a=["Microsoft.XMLDOM",a(6),a(4),a(3),a(2)];p.some(a,function(a){try{g=new ActiveXObject(a)}catch(m){return!1}return!0});
if(h&&g&&(g.async=!1,g.loadXML(h),h=g.parseError,0!==h.errorCode))throw Error("Line: "+h.line+"\nCol: "+h.linepos+"\nReason: "+h.reason+"\nError Code: "+h.errorCode+"\nSource: "+h.srcText);if(g)return g}else if(a.implementation&&a.implementation.createDocument){if(h&&p.trim(h)&&a.createElement){d=a.createElement("xml");d.innerHTML=h;var f=a.implementation.createDocument("foo","",null);p.forEach(d.childNodes,function(a){f.importNode(a,!0)});return f}return a.implementation.createDocument("","",null)}return null};
dojox.xml.parser.textContent=function(h,d){if(1<arguments.length)return dojox.xml.parser.replaceChildren(h,(h.ownerDocument||p.doc).createTextNode(d)),d;if(void 0!==h.textContent)return h.textContent;var a="";h&&p.forEach(h.childNodes,function(d){switch(d.nodeType){case 1:case 5:a+=dojox.xml.parser.textContent(d);break;case 3:case 2:case 4:a+=d.nodeValue}});return a};dojox.xml.parser.replaceChildren=function(h,d){var a=[];p.isIE&&p.forEach(h.childNodes,function(d){a.push(d)});dojox.xml.parser.removeChildren(h);
p.forEach(a,p.destroy);p.isArray(d)?p.forEach(d,function(a){h.appendChild(a)}):h.appendChild(d)};dojox.xml.parser.removeChildren=function(h){for(var d=h.childNodes.length;h.hasChildNodes();)h.removeChild(h.firstChild);return d};dojox.xml.parser.innerXML=function(h){return h.innerXML?h.innerXML:h.xml?h.xml:"undefined"!=typeof XMLSerializer?(new XMLSerializer).serializeToString(h):null};return dojox.xml.parser})},"esri/views/3d/webgl-engine/lib/SSAOHelperObscurance":function(){define("require exports dojo/text!../materials/internal/ssao.xml ../../../../core/Logger ../../support/imageUtils ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./gl-matrix ./glUtil3D ./Util ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q){var n=m.vec3d,w=m.vec4d,c=a.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelperObscurance");p=function(){function a(a,c,b,d){this._enabled=!1;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=w.create();this._rctx=b;this._programRep=a;this._requestRender=d;this._emptyTexture=e.createEmptyTexture(b)}a.prototype.dispose=function(){this._emptyTexture.dispose();this._emptyTexture=null};a.prototype.getIsSupported=function(){var a=
this._rctx,c=-1!==a.parameters.versionString.indexOf("WebGL 0.93"),b=-1!==a.parameters.versionString.indexOf("WebGL 0.94");return a.capabilities.standardDerivatives&&!(c||b)};a.prototype.setEnableState=function(a){a?this.enable():this.disable()};a.prototype.getEnableState=function(){return this._enabled};a.prototype.enable=function(){var a=this;if(!this.getEnableState())if(this.getIsSupported()){this._enabled=!0;var b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,
height:0},d={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=t.createWithAttachments(this._rctx,b,d);this._blur0FBO=t.createWithAttachments(this._rctx,b,d);this._blur1FBO=t.createWithAttachments(this._rctx,b,d);g.requestImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAqf0lEQVR42gTBB5ydB2EY8G/v8b7v7Xnv9mmcdFp3WpasZUuWFzZgDJgkhgwoSdM2JbTNjzZA06ZNgaRJWtKSEgjDGNuA8UYeWpZkbZ10uj3efu977317j/7/4De/8ef9vCow2VUGGHzRhuQ+t08GvhZb+jy85wOu/68JzwtQSCZedpsvC8SL6NJNNwZoHMaZiMoCrjrPATpGJFxvRCYMKqTCBsyVw8h5B6ROArU3+8HOGLe3Ay+UABow3D4wEcfOakDbjh2h594mikMNcI62ISNzIius0bfeN+QHrv+L7M53FHq1XC29breFgmCjwPHQ/fo88OIg9kvDdQPhB93G8yk6DtRYFT64fR/jQn0NIcIgYHylyFjVHPBboCB7HQ5sXuoZqQCHqKUjtvKNpvxkivqlZe514DOA/Keethib6OkOw204MMTjY3HX8VIGFeITgBEApGRFY3hyKyPeRWK/NNa2huJeLKzBJAimiY7ZQbAh0HwPEP9jxHhs6he37z8+KWqdeD7TCttNwgHftJpfzCq/iOJbKrxap2Ymet8zwVEoNReE7T4aI6t2mBuO4Meyh3vHAeK2+KvLzWHEgSCJpgR5EvP7QPFLyeDWWrqc1iVz6LwPI7GEpOEExCwzVZwtKtDGyzRW5tGyz5WA7HLtfrOIHp9T9kXQB1z7E10eYMytTs5QOuci8E+YIk9W/roj5nxvjVVLaM+30x/09CPGIdQlfsOe/WqxoS9Sf5bVv+drIqyP6uNrQMxFGDPSt1PurVE/UcuV9ci35bmCPTiIjsuZZjZCePj01iMbKBYa7UyVIDI+MDMSAV7sw6CSjKEG0IqwXhEkVtFwFJQ9D3q9q2RE8xEzuxvCN0Bq0pAFH7IMZEW3/zQU6rQ8Dw1bqPE2XCxtht8B/Hsg/yzu3CUcGdb6PW6QCVRs7bYKDwDQfYefmmJO2O/d4LyOzns2kA3kt7Bxrn1ZZ4hlYFs+uYpAnNDyDI36VE+6wLadkEwTwQIdYovCIM8SEVS24D+ktuqjWIT4yWFEN/zEfsqIWkFfKQsW8DNVyLEDKWwZ6ew8x5ojpAmh7DbTuiCGFcW/DXl5hO7Y/BztDCbwqtMaxcanBq59oBYuVIAM2o2twXHduUpDjChd7xinXHoB5OKsvd/jlrN+SnHoir0dn1hWWSbrDzj0Nd6x3PUb1LYyVIpv9AHW9sPW+aEhU8peULyaAG12TddDnq0zVg5S+vfnVLQBwjt3PcU9k0feDfAkCjohqkfBRgeVfcx1xYcTzRYoNbVPbCQ/mmC66x3pMpN7IPDeT7a2+TYYDYj41QNoEoGVQhPLlIPb8k2yMZlM2gNIiEu4nfIZFKeDW08qY9ds2wLoLWIt2yJuYrXnWhNbytRVs1sHIw6qhoE/sYJsJArzFLNdUzxalSOyF3oIBU2ttqZFumoEj6XoZVOHKWSJDoGe+WGZmObQuA4f+uap/u15hOEW1LveusgkSWNvivQRRg7bAQWcd+wUcmN/DTkr6XeHmX/pVnYkebSt/RBNP8PhsXnqFhfUu/ozIH++g98KYa+EnqoRZtFucB/WVPy5MoJEyH+RgSeFoTuDS3Rjpi7Iog/+N2aD7N9oJkprVsWpNOqZ5JsMfDKSID//tUCyQrANUm4Q/czDP1mKVTo2lrM6uuJh9RV3pMc1ylB/5zpYs3EWgR87+hDYZY06VIzFYd+HxTY9FyARG0RytMQAJujsU3Pz/qPlwVVI99+KBosYv4qQOzQP4WWCfPVd5eSjvPMmAkY0LFL9lX5vMfDKgtMADu3pCrNLctVht8XYBr6KRvBkWte8jafxscvmLE7tITB4IxDf4GJ/7YdtklZdgOO6z62Bj4ADitP0UfcQAiwSnoEgw44j+mCCpjb7zL2IcBSOYLS5ArdRgU/EJrsgnLhuAgv6ylO+fTYJZMPiFVUt4bafDNpq8gW2/+Wc1LSVejMjel0a5Yg2kUT1DzSmbB3aGVsieORVfXAq7vYkeQUZKUHxZlufMOFKsneeaJYoxjH4j6q2BObSoPx+o2RkzKti/lyb2uC7h60bB4z9maJ4tnFpvw/fQ8zfJ3IAAiSE6G2X40l/PFI+xGgcAjM+/31BL8p1KGRn8kFaztzEFxsAfOxjR910VTxaqsh6/z5RGNebzyWtoossscYHUPKL91d9BhtQTclREMGf6PoMnmDJ6orHxKl7RZO9DwAIBqRCqlbTHs8hf0fa/1ZcPuxk/I42xYnbafCqgGGatSnGPUaE/1azHhdzw/rok76dX+vslH00lkxaRKfW/wwn3mJTQOH5bu/vzgMJNnTuAvJMFL3p9f90ttxSrfnxNusCI0spKhX0O7XBAHcouivCT56YhuFE+A4vrQr7VfSfeXbsbpt4rbhpwuNPNBagcd8A6DO4PgSzeDQ6lGlIevQ2yGyG3fn49mPgnTNJZqVuLwC8E3FFyBozgL47rtOWlrXOd1s/dRPjgYmLAzl2dWFOGk+bW+PStap2Xm/ERvzJdDYd4fd16N3x3ooL/FzJ8PEPT4H4WRk5ygiRK97yrjHU5p/69gdFfUdLiDlYG0NeFYyjRmZNdLM6mDPgwceejmpR8ek2Pm02WQ3ZqW5nCDTpL9931LtJdladOI0oZjCwoGICD1xZV4cYZxIgzhjekCf9wh4+jDU5IjvsdEm/12T6e0aJ5YqnS7ROWkWBX3FAnboqd7c6kAcAxZwBS3bSAZcH0F6pV/7AkfvSEzW3fzrp1VvQjkL3wetuK7N/CV692ve/zNVq5KYktPLl/CMDhNzFjT6ZOIK3RgxqBaLxgL8Aoc+F8MeP7gFuRpXbCDtlAbL10NvMh/tsocPBVQx9SFIIiN0CNzcipYWwz5GmjGWiarABr7U30U+uUNtF9/saPWDaKnox3JOtzsKvq1INHtwgug+a9C8U+XIiPGGIWaCNg7RE1WFxot+t3g22M6JFGzGOpSzmpS+ODP4Q6RwuwVKDW0f8olQHYv4Iwf51NAr0mmJoXL1TpxX/Jwq9m3b+wiCKtLfiNrWV4I/5xBkDPvnpZ+Q8EN/Czdf1bA+T5A6JpRxP74kwUm8y12j7Jd+fsDMtag5nJvLUigJjbnooZikOBpxD6T+Nk7Ln0kFZlhujYcHz/L1UK05AHRt+gErP4E4f5gKsX+O8TCsbUG1hHj2+vX3Ng7bL0R3a5KytLaPmeay0xND+gBfUj9Phq/2xfYKS87H3ta1Qso4H9Ca6X0hoMdy/IXM7QuhIVg9ZbI2oBRhk6xpX8qoHNrL9POGnrNERY9igV1x61qKLAvFcGoiRcch1N+k7LK/5D0D3eIobCG4s2iADwB67+vJqtk0Tc1TMkgQLKKRG4Bl48I3u2FQq/lO3XbK9g21Br2Wrcyobb2DqyLVhQbWbiwX3JdQGgLjIbjStUiveYGF6IpjdMZj6eyO1pSwXCSByV38TzEY2/VEpeAXdtABk0qq9aZB+cGf+ukGgq26f4iAJfso+9b38L3dfnIImHIwH4TRyf4e78yxS+Uxq6TugN4xw5XDxOoluqXYDJhgyxre24BJr10njnXjpWcTtWbdv4aXNbXQq03s36vFSR1oz9oxk321YuwoQdbNCsfy3tHAmMcnpdcCnnvFu3ffTYs/Ph90bPfqToDdPLPaNcCKivoo0Rwkqbsk1bPVbJpYxGIKUfXH4pK6H8fghaPY13icA4JO+NLuCpoYlHDM9EB75+kNH/n6o9zE+TRnBkkL8xiqWY+Q9ZzaAg4+fLzZjhNfw3w/gUQRFiPz+fPeS0b8aFIJGPC+rr24QY6gIO9YVpEO6A2aaeyYdXRMVVLdKluURo78cBmBt9EtRzeNaKwWKt2E84X3D5pkIp/iAp5BlCgOpbCJAGniU3QBwNA46JmID4zirCmjDcPth6PehZa+zDdAvOqltgXj53q4T5ealBjQn4yoLHxl7ENmhUxeNvsVRYwtikoW6UeUxgr9EMFvwiR9UeuVRYKur4GLqMtLds4H9c7GxNSJGLKubjwZ8TGOXLmgCr4e5uEw7XWCj+lNk1wMUOZOC/mXXfhLtvOu24Kyd7Rq3dEnkuAFo8DA4pyLpJ0zioo44oRxXdESQO1rq81ulq3WDJXbt3ADVNIjWg2a/R+JYnI2PeepVLB6LPzi5eMUa2/jvGWrYA0pIsd2Ax6mPHbLgJuQbN3uQNGGu19WDg/3b6lAnBRn9N3KlQsrLj5LkBOCnwk7P3pLX1ljdnh8cnPPerTvbJmSkWHISCPCTNYii/Dg4JrjaCNS+3DAPRwm9DyJkalkLQz4YsGNLFveiCyw6cE4MzvjUgRAl0jAQclYHdAaYaFVABepI4sP/oeepxPi9oGlSi3tpWIX0FzAOuE71y02MAmdQrbkGPmClGtJGKw+fOHi4cTrPd5qF/4KGkWmwqPqRP9fyB03ZL2FMBtc/W3/43eT17zGJUY+tBegRFjLJktlYf8TKpkmzJai8GvczudWw+UeEPcTZGuLLoFGDpv5YDH7ZFo4P1jmZ3TCjEotNcBqm155Pjm3NzFEKWKF7KcVY72eG4IF507vbNnbj9CwxsimhPW5KBT/cwpfvy/YzvJdcA+6n/B0d85Em9Jpj0SJ6LewBcL7Fw//+NzPSGw1uSqy9jfTmcJuyMzyA57DcJ7BZOkbPIcUXsDPjoMXY/keYYLd0Rax9ZOgJqJzTsb8onXqy1r3kKf8mbdIKVceTSXiiGi4/HR7Pt5tt27+BzW2VM1tj6lqIToB4087XR9bgOfSFKyGf5eeM2J0YhpmrH9/Uu2+28qDSL1av08BUz/i2dTounIci36M4SXJfQvpHifh6TOnD1lTMejVlfZUXf66md5FwdmEaOG1150HxOMK+gQNbgOZs0N1/lb7CJLdA8ILbK7RYCYPhDrXAb+xLMG4f8mFkDpBeyS5+tXLxfxPxJxjk++79i5TfpbnAivqN+HcMfaKsuVEQwkWRTQ6/a5BboYuIP2CsCo3BHucNjYkXfHt7YLxqKU/w4c/bdMrAM0RpawTOtWVdL3+l+Mr9a6KGHjzCdL+Pcs82YJuhXDZ2rh2NZcStekK3eqM4bjnwp/7yMa1OFl1OV3t6QPCo35w0tr2V7Copy7J1Es2x8Vv/HFIPufBxivtOv7nfIH2UelqlYzTdYMRhlOaizWtwONQqix3wIN5egwKRjEqW/h7rM7j0/YG2BRMfQkYeQJUQeo9nCmVps09F9focPDhOOXQUQMjU5dVeslBdgwfdev4kpssy+ovCLglTwJ6SUOXLRMTn3S0pz10x5bTC15u11cl30Nk9Jrzr0xP8nKHV48h0J54cVJqaeI9qlm1gjOB1k0QhXwFP2ObcgC+t0r1ti6P/KzA/SXo/IN0SMFjq9ZuIrLr9A1akw429QOUM5B5UEmUvRmTAe60bM1yWrYMPpCFXI/q4RWB0CWq9rGRvUP6uaKQ/IG34bkpJkt3ViM6N0IEnJx4orp2D+v9I4duJatlZ7BHsJdqYiWJ5E3tNwoeEVCoY2xmtrCoYT1IXAPjUwBP+UKQvs1zFNa06XEMiWsMnUtTlALgZWDlM1hWo28GbMfiUPvgdt/o7pfRflcM/cqANpekRiR1c1GDZum7sabObAKJGAiHtLqegHQC9DUL/UQuHsMQHtHGasfv6lruN/s+g4LNBZ8IJFEA+CQPYmvAjW3wuu8Em2BOLwXwZlFGfMPA9gYvg7ivh8mmQV+jMZCwMKS/nJW8SwW8HazdipRdLct7AJkj40MeOWg3QPwIrXSSc0ovjYScZv/py9VCo137HQyowz7J1BdefseFZXLWQTNmHRNUYHKOArrc1Ld3Tuhw9+iusRlGgUILvkENzEP00tfai71AkRVocwA0+urjxvsVO2au4HpYHBLzTXC5UGH9S7qA+0j8DO6I9fVCSn0La27FII/Qbem53DIga6BQMqMD2zzG2vQobkLxi4skm+av45lv9+w+7UIYVvifAu/74qdQWePGbEC300M0D1rtJrtekESHiIQhLqFk1c20F3oyQ/1MLh3NF2TCvWlpMoB11+RF/m885P9EFQfa2INC4bf0oSDykNB1c7ThJKog6qH/NiRykcxtxc2BiNWPBGQs03Gqy95X23pK3XS3Id6JoO1j/fb+rDEHXOWYCdF5p3D/MD/9Mrf9+0tmM5+43b29zk5/TG88Wc7/BuItg64CzAGDFRsPDYMwC4GPHTsRewpMoEvw7U5wNabW1NhdM5YstTBJvmeCl7EufAXYGheRUrgK3lAcnaBjUtvX7A1YCYrVzG4BI+Fs3u211IAOjITr3qxz1iQhYAzxcC97nqQcC/gNJ/ksGu21JMSvl4BgZhY+tDS2kbAZC/0+j2RmMSIBqxviUr8mBMw5m0irMJ0A6wqp4q7OS54rtv3SYfwE31V4hYBefEWo9yP7E3S6Ry/zAdvd68APdrcHzIBj1kQVNtfTmSN4Y1lvHcX/BxRMGVgizNziT1a+NL4f1ZGrBBLkAbTppStCqqHPLZhyPiDx3SKmtw205TO2WxMEQqkULr7vCn91BzmndvbHWFAu8GiSrgAZyZNMScbS5iAArlhrh5G4HedwL/wH2E6v+bbD1O455A4uBvlNoAUNKwqPsjk9+loTuhkiXwuigelze5UHCb/AJNKw2cc+G4CfE/Z0ZwVsDXSAOfr9R/gpL/ghGMJOL8BA2mOuKNInxFF6AW/7uErMW8sNkEBOBtXXXEbm30CCTJbxe6EOIbec+RTjqvdUflOP7AfgnkC8nhSIm3neEOmts61kCO/o2RP02eqWjJjzYn3A/WgFSoyAwj64gKr0H3nFCK7pZt2FDmwwcSqB3YBMgY3HXWDAoBqr9PHSGIeh/l/QZXZpL2wpO7AylAwZ87Pce3z6xUVvn4SNt0I8zpte4alIJpNWn8cjfSE4UKTvooupk8qPXRvFrmj6smvX17qSIX9baO7HYIjg6IqOvJIEg3tVQ9qyR25F2fx7JpzrMHwCdjgkYRexElPxR1RDICwMQssAVuoCZADE5CJ9ZJS8LV/rUdEFDlFhrI1yQ+/EEZmII9DDLO54bQvrj5cmbQPfa7cH/UOQXdKzucZ2IOklamgTnaRQuwQ/+x1PS39leFqUqIMbQ9x6YH8xs9TiGTviU6lvwehYNuM1i85I+gNg8DiEuTIIk2iOce93t0LQ0udyF6JpSw2dw9G1nJVmKfxT36xJryH6PzgQR9qRD1Mm5e37Mygzm/LbTyeGse9tUbxKBlqB2FtLmQgRT0XuwlEeSNxcWvzw98AE28vXwWr2FlIrAWsXu9Qf2Q3c/wgIo6RZJ5GQlejmceYZfebOaO8nDj/iTnf8s2C9IEEsxD0K57+JXP2Utf9NInQAnGuzKs458w4LXRbgQ9GaWxz4G11+LwAVYeMNM7iHu6gv4qVhtn2OYKeKRJRdJHF61unu1ms8j/2aR7OYTz6aWX1mXRDFnB7aepsLG4BHvkkwVYqa/DYsRNiB3CDPZ2q5Kr5L8oC6j5ULS3/jzu6tf88tQ1tTXmBhfdwgUwXDbbt33gD8woaq7sVQiLnSMXLTtZzY89fkny98x1N8pSu8ETpNAIhg/T8GIQvlae9NA9hx0Nc/krzNurU+PlTodk7+HO9MBugPzcYk8hFtQfN/X7klPxXMLqKf25wcIYKZhb/Htf+L1Uc18kw5jZOGML5c98ZDc5yHfzmVjvWqAh2URb7rTpwH7Z5Z+n7SJeCIdOVzgdwzy80P8Hd9okBHiZ/rd9S+Vrvw4zFlirKiTK6TcVpw1zP5HqVhBXt6RhPfu3IsNMMHfNPSZVSonE3UuRpsMiGM3OJSv93QnDntYsYtdGVuljAmJA47Bndeazv44WQHWORbVjGCIspejDdhnQEoI5OYlcXg5yt52/BHhWJF2Rgxn5H7RStg/JEAf9XnV5j1UAfm2Iy+qgJmEmxTPRFm9jxx0wK5FwlHNEHBPdTZ53Mfs/p00dG2Ren4MbqsBCHPX40CcaD98IfZyAX/LGkYN+CRygtyrER/0WGlb84sVrjlknK7HuCRx0us3BOkONLiBYUCABPNb+cChaP1nBEzlW6DhhQp4wS7EaP8jKzkYuZbKviVem6ZHQsCk7QpfziL22v/or/9J1/1wUns39AYhbg+CwWbwRuSzsQTe07J0eMfvMWHVtaiDsBwCaUJapcqMVu/+bgG9YOOvJ0rvKPZQBrhYhc4Z5hMKxupj1xvFyWmg1W5N56lDJHzoDx/cuAshRzC4RgMiLb4Q2pN8r9bnJc+XUvwe3YZ5fcMVHyusfcuXdpv27i51WA0lbuZsfK3s5de9lWW9zXCCmTWIWhI18QtJZ9RNj1RbAC/ACLbCUo/Cit3JZCjjtKR+f5zdBJtOH2uWGr47tDtauNpKbom3Vu6n4oxtJhFDmzaT2pc62ZPu0gKZ4cnId/Bp195CRRtJRKMX3+4KNbD9NDEARUw+Dj82NV0k8VggVL8EZM8rwKmwWWb4ZiA9mmtNR/6rbulcqybAyYcAajMrvmsCHZJlu0CItUtWhsU38uDA04ET8wqzujLFgSgRRzt+kXEaAKwDm59pL/0Y4byu6kKl7cTK+UR9vb7pvG1tF02qxaRg1uiHnx+g7wOFJdw86CMbIvQEdeeHfeLxFBSPJn5VXZvyXLVsJVZjFpf/G5N9TGEn4xIAIx1aZlnqNx48+fxpszhYt1rUyHKHyqS/reuRCO8KEKE/+p90d4cP7dOZGBZrAe4Q2Cr6VoWFGp7KU8jzB6QbTf++mX28Qt7b0RpHxG638hMdZDlOSXXCsLeIhHkEgDBnDc48xzage9HPIxbGocP0yslbVL0Ed92bnx3d/O9vKImgbfPx20LzQCP7f6r+b/H2tmDTlvc+6g0PHKeaeAe5lUU2I63NVlYI5Hba+5RBXfNRT+s/tQ4/PTEt6013TMhfYY1q4O1CPEUaPZSt/QOqj9rMG3KYH1yhRG/UXcb6yZcW8U+k+wPZPCgBlgpNu8Kf+VLERKyNT9vbszywFAMfMpx9lkOsgwtg4j67egVCDgb+ZEV+Y3qxbUuniUxWX3sxPzIPegZS/ka7kue5Y0IwTZu5WqyB9RSCfE3Uwk57704/vV7o8av3lyOVAoQ+jppahwoMNvpxOGpVqrkEMMvAXy4/1nLZ7CXbF+Kq4DobenxfVH8/pClZz8kcJjJSt/V/IWS/l38JjraIQDwVzDZtH9eDrv81QfiKDZ1jLt12E1ftzmRWhx30rpGsWMCynxugBxI8c3BRcxANJ0r34OFhMkV49Gt40u53T1vkZujkMataE3APzs1g0F8IXsmQDntQsdKFNf6iGH8VLQGmiW3JPBuidQduZTq7OqgW5JykjNnmiYjhbLj8+P7cqCWZYZRrkQTaRDf45QL5RUW9XKQDYn5MF6gY8ryV/nXW3qQrGXcQEKwbvgo4z6HJe/l20BOgwI4GgQJQVMNVFiLM3ZsX3olzj1B2we3+Guo/EO8csQZWY33MdXWPW08uYR5nM+10sH+4/+NzncE/GNbn6voapCiKV4hwCWxfwQ78q7g/B6aP81fbEJ+wCzml/1fZcKYdX5lgUa+LB/huzhEU6bsC/HuPnLhb8Wg6ni/HtV9Ygzwe4IyOGaVdivTDbEOW8wcpQLHx/7eC3Zi8sy8oXu5DhE+kw1u06LV7AqFiBTzxumkfMOCJAaDW1i2H8GXwYpRK1uBaofc2xGWoiG1SfQOZZd0xdeJz8d58GK/YijySB0J9Q+cPTWd/fav6mWhmSO8Q1NbxYhNAcb578XuSsC1uvGTGXkoqnwE2LrPE4WXsNmR+dr37NhPqTXwkhI99/qiruLWDhPRfke3BzfdO0Ym4QFzArH8aMPeu75kh1CseVwnsv8eZgrp91VD2VNU2J07EI+ZuhsZro1D0FpfMsrN9T7l9p9GKTy9r7nBy5t7G3PJk57ic3KRV0fbnLkfXYjF0cMEtFJzX6tUctEsk76FuiYm6EKzekXpHANhG2gts8KgF2qDT9Ady9p3FJLXcvD25D//CQrhEA4ctzFtu/O1u7KgeZ1Lgehq0AnjThaOUIIg7oyTm6DQFQGxYkfvTSD5z57MAe02y8MhnHbc3kWCVWgQS5KFidDa1hijkDgK9HylNiIkH7XUrO8mGx+CxPLJ6RBdr/s20MPBsaIkt9iU5tym3LEP0dJx732kMJwDPoVwVGRLds0r/XgQ5tHsywG8kAgXM0DB7PeFzbWyWa93IoiNSjCBLB+zoOu2+108JuNch6SnYLid74PzEj7llBoIHpx7hDqyxHrF/GasXOcNsJUiWOCPPptVgZcrbrM+/gYSTsRQGWXfwbi+2QpryYDX91ZRFe+c74jbKkPWQeYJdeasX+669/9kssmTPRZwQeXKLpE1E+wMyRDnkcUh+wZGLtPCR7U1wokVAtb7GMvgxlM9qyhlaafSIiZSV2vD+PkAeQIjhlvNRwBAevJgfJOo8qbpPQ2lV3ymUV1TQolwR8JBjKHETgw/91SRAJYKWvUwY46fq3dmcPUTKvlFYHq4cWmVrkV/zqAmy8WLPDahcp4/cpPwdQXMEimgoAXgeHsB/4wcD4WgpYL2kvse//ZIdm06Q86YrrHN/K2SfRJ33m8q3c8ZOC98HW3tg6JanGyYpF7dQgLGiKVfQ9BSfnsWrmyqiJkSrmImzcgVGKVKYrTVWN7tf6d09g6JtyFuSLqhgFsKE9Fy0wFs608u58BMfHhXUar/Ce5muvzisF6JoXe2fcbJTln4mpowiRCwa1bKE6YQTUT9l2z2PjQjcg7OFOC2z8RtLwKey7nwpOL7UIOmIcqMA0iv93CeLhhdhHK4m+WVcKc6sqRqPbXLI16EKsbTpOrc4BMRmvPYq2zwSQVf6zmEllfa8DyVodxwKuwDoOxBniJSY0GaSTDsOqaQq/TpWPIHx64a5xoLT7VUtdG8H8OA3t0HiED0CijKwqttKb740UfZbUfUqGDsNpefiSl7rr/f83Q50h3RzmP+FgiNLqYstIw1HsxCxO+NEcqIwD1RLyafv9PRS1ILpg6J3x9QLGncu4++SB34Fv9pKDJ2lVkflsOoIdszZhLGgK6yT3sT6qIAYAGSBuEik+gu6XOLEgRo4G9MPE8n3jPXHO7aczYZ1+58G+f9MLf5MHd1ldxDeLWLZJoN9pgofnfxs6YhJmWY95DHASjIJ7z4lgpx/SPVFkL0J+49CDoRHdmCHKHKzSLUtPev6OAMuUMQEEHouvSjVNk/k3u7co8aJ+6ADVeEupccQgcHC7UHvmhdNBOLdkMUixyPyK5y5ExMa1LU8oJ3sOnIx+RekN9rAOLaHYPY+Mg+Y7XM8dkgU5p0NAOF36Npi5F2nrS0C9fUadVLAZStsYtK4z94LmF/r8P5vHAT/Fou9Tm8cbjNGvPSpfGe9jhgGmhEpo965JlCczvY8rexaSSe7OVjwZnN2Ob0XkI0+vIwpbCs8lTFWA3WPBZ+j2YdrQXUIbCB4f3E+ES1oGFtWgKXRWKbVP8KnH6tCcoS3ie6H7TTq8e/HEl2l9buU/IptFZByo+5URfMLrQ3UGn29p2sMOyh5u9PYYuA+tOC9Dtsn0O61GrW8Vd1aH6ESfgC5Jg/P8EeGoNSrO1RuOKZ6QOKuKyDdGpj3XS1dR40xjXig7TSGmF9BUEK49IG27ZCocDx5yYHgIKBh8yjbftWO9QPkIibON4Mkgr6TQvea8SNccZVMwuqhXXh1GcPOknL/us4J3nxgC/7gSJD6ZPnuEYD5h5xabgNFEADolRV4z8cp5UeJB0vLK0bCTjKuGoBUQPwToZ9JDn5+w5NxIp4QtgLQBtgfDq1Oc+biHviY+Jm56YXtd9rtk2tlOP76Fb93EUwCcuET2W7HdYPAfxuz11rhA9bgJiSxErg86pGuTrrkL8nelqi1o1VcikcTFPFpXBsQkF9hrfTG5MedxuuME2ltj2r/X8zXK+ZOiW1l5EdKm0wYA6zzCzH/b+cGOyASKNKByGzhU+dk/DSiX2v6GbD0sUznKsJdgSIpDB5vsOUmpSXMKxhQJdBh2zQB9Uga2d7mF1i5Z8Pb/mg0GVkuNZFeFdf6/sQsRJ50cShX0xvFi14EdTAyK5xklct0uG9dU9Ly1BB7e4OdFA2kzjJ4+m4cGSTZsV7nWyCf6oBZWxqinVt+YsTvf6sQA1rUNjuKCtq0KP8EGoOrnXterJwiZH5WDOMJ9wiaTF4E1V6uuU/1KwyzJ+H1nMWLaG9MzrZDB0QJOUnUSxKEth9LU1tb7gYILPvJutypcbbUg/cb8KOPnEjRaCOkwJVQYECuiICK6u6V6FnMA4Qdf4LKiO9CPrEHjf0QCB60rN/YDmrSfSJweSDouFYaper4DVl9KMj8Qq4nhIkrzSCV1VtB8Pv6oXTxphryWz16RTVKqPbbKq9zbQasDtcKWRE9WvP3FNcsICp2kRWQCpSzS+z4+Er1rJgNglbTAWRqrATd8ElRNLkfMfFJWHPwNMPW7vUSOpc9im7UGfizlYOdvT787XWsxMF36s1xPyQov0uMDNuh7HVeyHWziyzKJnJFH1zyJG7twS5yiydQvr+9XtYK/mjNWUEdhgM3TJsWQEK3aaE+HqwUhLE1b65h42a1E3HMqoXuC4BzlnNuEIgryVdgYucd4NsTHd+tf+jBWV+6h6kT2CgOBmdI7gEfBrIYkOCO9tZGY+K770tcEjoG+l/rLT2tDByN06xhRUokM4Ltw8U/fNh/ydTjO4JddSFJ0n6Z9SMiz3lreKURYDM2Z+Szp9+zXvKr6SE29NRrJAGbmRjkSxi3sOErHFrB10tJ2uuT+/tem+j2qexl1P1B2DlgxMa8kS4WHKFWv0vqTQxY7YqnQN8jE+lmv3woeUknMmJciOh8HaLQ2A4uHN+oXYqBkyrckpNz2iLo5vZD/nuEEs/JWzZsCcp2U8YtsPcGQNdIOqvcZRD40+RjBs4WmDr7pU77XhyaIrC93dqsR+qa8BHQOWj4Bu7/Ha59bpCbhRoXY5nTHcgXGvNW2VGXpouirMtJDL3cggbY4AV6rYdtSbnCb2FR0Z3oEVYPa38SZH/o+79XTKl48AVc9BeBWAJbggJXJboVa3PUkSLquk/t1LtVD19MizUfx5LVJ+bJeSq5krVfq1glKB5TIifOV/Do4YI96WDkPPZoWbriIDEdfqy828yhXsnn3/Q6xwJvxVRu4ckHYGnN8zaBRAdlIQwaphWujvdJ4yQCnsPlge7wXDKQuPB5N5wTIyBk/4aw/x/R8SmxQAIM6p4hOxgaYEqGMRpnHcImrDOAMzoXe5VuTKeSPwTmd9FAoKsDOcbGwJsRslfufhCPDSOeWxn4MGty5kg1UIKiP9KtE0xsFPeMLKY0a93YsRVF6su0Tt99uEIYYhogYODAIeFhKqEoyScLyLpjtsnsKTisrwea2HklEPbCjoHgxYi/aPGvA4ZvW8U1dmnMPBgKzwPWT0KUDrRhLPZrT5vB4pMbfon/pNjubIqSAql2YwbQQ66PYVPKvacgMpbKeSS7HSboMBqsLqOFLRlY6bT9QfjaHB7bGfcHQrij1HeGzjphnmbYO359jhvWcLnotM4nsaKU84N3l6nyqRVAQ2K1lrzE659W4Y8ff/hhirkxkgauyvgHNf5Azu8xxk+geLrsjEjx7wK9Z5DodQgqFhp5dO0L4xmvV4M0Y0SFL0OEAVJhhZCKKOnUEM+8TXV/ijaeWGRfwFcNXeQQ4Y7jPytH+ZKzujr6KtApadQaVPlBtAUtg9thT+0kGoo/CvMwOHLTWLuQAvZKzCXc2eFg388gR0yblNUY5JXJ0oFq8N6Et7LKFG367qbWxTUnt3vgemDfAeCT3iMX9+ixihTYoJQGQduFd2K61cIwIDy42PwyyfBAlB69X7pGJWNsTubeIzIBLt1b4a6OQB8ptWFIGIquvVlHu0wqhWx6QJPCQW+8z2h0mDaBT+D9Wddq+oAV60yhIgprTSh7klj8n15U6kkIEZluuJjvLpLZU1QoduLnoIodg37XTJlN/Y0gfKIMzYFZ03d5Wt7iluXVifzY6pDCEoLJ9wOz5Hy6CR/+zuPZFZd4t60NpSxXp6rd3nWq2NfD+YRwSdCNRPK6Lu8LkjZpvlgn+wl0xjLLDD1ixtN0kEMsMAhr8NFsCh6wXAOvrUOc0oEDDrlq9fZH0o8qXnYcv+cXGJweDpW6T2+Lt5q9nFKfv5/JnuxsfcdFm4RMa+wwv/5WLaaPCuv93AxVUQE4R4hKhMQ0H+TkXrcoWciBXUUSWJatVI4SzzvRkzb5PRI+wBz2lOju72rUh1j7mdyWptDkPB/q48dgfBzSCRDyLK/iwy+4+Ndx/I5XmXXV5dlkcnObFaHFJvI5aKgJzGYQ6qpcZ4zooB37BkE9QnAQ5rfxPDVE0hJ2oN6rBryoUXU3OiuuHV/IygkyxwkqeK+YUcsBo5CdWKXw1IC1oZd3U4uKEx93sE1J80d0cKwYmHeqt4jBHVC3p84ObsRrrlbAlJtJcKYXRdj/HwATFUYLcKM1oAAAAABJRU5ErkJggg\x3d\x3d").then(function(c){a._noiseTexture=
new r(a._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:E,height:E},c);a._requestRender()})}else c.warn("SSAO is not supported for this browser or hardware")};a.prototype.disable=function(){this.getEnableState()&&(this._enabled=!1,this._quadVAO&&this._quadVAO.dispose(!0),this._noiseTexture&&this._noiseTexture.dispose(),this._blur1FBO.dispose(),this._blur0FBO.dispose(),this._ssaoFBO.dispose(),this._ssaoFBO=this._blur0FBO=this._blur1FBO=this._noiseTexture=this._quadVAO=null)};a.prototype.setAttenuation=
function(a){this._attenuation=a};a.prototype.getAttenuation=function(){return this._attenuation};a.prototype.setRadius=function(a){this._radius=a};a.prototype.getRadius=function(){return this._radius};a.prototype.getFilterRadius=function(){return 4};a.prototype.setSamples=function(a){this._samples=a};a.prototype.getSamples=function(){return this._samples};a.prototype.computeSSAO=function(a,c,d,f){if(this._noiseTexture){b.assert(this.getEnableState());var g=this._rctx,k=d.width,l=d.height,h=k/this._BLUR_F,
m=l/this._BLUR_F;this._ssaoFBO.resize(k,l);this._blur0FBO.resize(h,m);this._blur1FBO.resize(h,m);h=1*k;m=1*l;g.bindFramebuffer(this._ssaoFBO);w.set(a.fullViewport,this._viewportToRestore);g.setViewport(0,0,k,l);var q=this._programRep.get(8>=this._samples?"ssao8":16>=this._samples?"ssao16":32>=this._samples?"ssao32":"ssao64"),r=this._programRep.get("blur"),t=a.projectionMatrix;x[0]=-2/(h*t[0]);x[1]=-2/(m*t[5]);x[2]=(1-t[2])/t[0];x[3]=(1+t[6])/t[5];t=0===t[11];q.setUniform2f("rnmScale",k/E,l/E);q.setUniform3fv("pSphere",
8>=this._samples?z:16>=this._samples?A:32>=this._samples?y:B);g.bindProgram(q);q.setUniform1f("numSpiralTurns",this._samples<C.length?C[this._samples]:5779);q.setUniform4fv("projInfo",new Float32Array(x));k=1/a.computePixelSizeAtDist(1);q.setUniform1f("projScale",1*k);q.setUniform2f("screenDimensions",h,m);t?(q.setUniform2f("nearFar",a.near,a.far),q.setUniform2f("zScale",0,-1)):(q.setUniform2f("nearFar",a.near,a.far),q.setUniform2f("zScale",1,0));var u=2*this._radius,l=n.dist(a.eye,a.center),u=20*
a.computePixelSizeAtDist(l),u=Math.max(.1,u);q.setUniform1f("radius",u);q.setUniform1f("intensity",4*this._attenuation/Math.pow(u,6));q.setUniform1i("rnm",0);q.setUniform1i("normalMap",1);q.setUniform1i("depthMap",2);g.bindTexture(this._noiseTexture,0);g.bindTexture(f.colorTexture,1);g.bindTexture(d.colorTexture,2);d=e.createQuadVAO(this._rctx);g.bindVAO(d);g.drawArrays(5,0,v.vertexCount(d,"geometry"));g.bindTexture(this._ssaoFBO.colorTexture,0);g.setViewport(0,0,h/this._BLUR_F,m/this._BLUR_F);g.bindFramebuffer(this._blur0FBO);
r.setUniform2f("screenDimensions",h,m);r.setUniform1i("tex",0);r.setUniform1i("normalMap",1);r.setUniform1i("depthMap",2);r.setUniform2f("blurSize",0,1*this._BLUR_F/m);r.setUniform1i("radius",4);r.setUniform1f("g_BlurFalloff",.08);r.setUniform2f("nearFar",a.near,a.far);5E4<l&&(k=Math.max(0,k-(l-5E4)));r.setUniform1f("projScale",k);t?r.setUniform2f("zScale",0,-1):r.setUniform2f("zScale",1,0);g.drawArrays(5,0,v.vertexCount(d,"geometry"));r.setUniform2f("blurSize",1*this._BLUR_F/h,0);g.bindFramebuffer(this._blur1FBO);
g.bindTexture(this._blur0FBO.colorTexture,0);g.drawArrays(5,0,v.vertexCount(d,"geometry"));g.bindFramebuffer(c);g.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}};a.prototype.setUniforms=function(a){var c=this.getEnableState()&&this._noiseTexture,b=this._rctx;b.bindTexture(c?this._blur1FBO.colorTexture:this._emptyTexture,6);b.setActiveTexture(0);a.setUniform1i("ssaoTex",6);c?a.setUniform4f("viewportPixelSz",this._viewportToRestore[0],
this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):a.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};a.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("viewportPixelSz");for(var c=0;c<a.length;c++)this.setUniforms(a[c])};a.prototype.drawQuad=function(a){b.assert(this.getEnableState());var c=this._programRep.get("showDepth");this._debugQuadVAO||(this._debugQuadVAO=new q(this._rctx,f.Default3D,{geometry:k.Pos2Tex},{geometry:l.createVertex(this._rctx,35044,G)}));var d=this._rctx;
d.setDepthTestEnabled(!1);c.setUniformMatrix4fv("proj",new Float32Array(a));c.setUniform1i("depthTex",0);d.bindTexture(this._ssaoFBO.colorTexture,0);d.bindVAO(this._debugQuadVAO);d.drawArrays(5,0,v.vertexCount(this._debugQuadVAO,"geometry"));d.setDepthTestEnabled(!0)};a.loadShaders=function(a,c,e){b.assert(null==a.samples);a._parse(d);var g=new u(e,a.vertexShaderShowDepth,a.fragmentShaderShowDepth,f.Default3D),k=a.createFsSSAOSrcObscurance,l=new u(e,a.vsUVQuad,k,f.Default3D,{NUM_TAP_SAMPLES:"8"}),
h=new u(e,a.vsUVQuad,k,f.Default3D,{NUM_TAP_SAMPLES:"16"}),n=new u(e,a.vsUVQuad,k,f.Default3D,{NUM_TAP_SAMPLES:"32"}),k=new u(e,a.vsUVQuad,k,f.Default3D,{NUM_TAP_SAMPLES:"64"});a=new u(e,a.vsUVQuad,a.fsBlurEdgeAware,f.Default3D,{RADIUS:(4).toString()});c.add("showDepth",g);c.add("ssao8",l);c.add("ssao16",h);c.add("ssao32",n);c.add("ssao64",k);c.add("blur",a)};return a}();var x=w.create(),z=new Float32Array([.186937,0,0,.677503,0,0,-.782832,.128424,.557187,.248064,.460317,-.659755,.062892,.918659,
.312829,-.241031,-.814826,.224206,-.642866,.132138,-.45016,.145727,-.590568,-.626141,.005017,-.002234,.012668]),A=new Float32Array([.186937,0,0,.700542,0,0,-.864858,-.481795,-.111713,-.624773,.102853,-.730153,-.387172,.260319,.007229,-.222367,-.642631,-.707697,-.01336,-.014956,.169662,.122575,.1544,-.456944,-.177141,.85997,-.42346,-.131631,.814545,.524355,-.779469,.007991,.624833,.308092,.209288,.35969,.359331,-.184533,-.377458,.192633,-.482999,-.065284,.233538,.293706,-.055139,.417709,-.386701,.442449,
-.301656,-.836426,.408344]),y=new Float32Array([.837372,0,0,.723531,-.467287,.034157,.169582,-.31169,-.881801,.696236,.455215,-.204568,-.304514,.528086,.626381,-.053116,.222507,.037523,.199755,.311291,.916799,-.681552,-.516264,.501792,-.37127,.021088,.737477,-.029503,.209188,-.95298,-.573731,.009962,-.154202,-.257345,-.905958,.282747,.370779,.527867,-.669424,-.601758,-.191278,-.708243,.271796,.782684,.535565,-.006867,-.015312,-.017276,.419958,.265628,.233036,-.543898,.554747,-.174055,-.079242,.053475,
-.099539,.372042,-.339267,-.357362,.015781,-.011352,.042707,-.340564,-.272507,-.067725,.799249,-.127948,.586808,.450015,.01965,-.416454,-.506524,.323229,.206546,-.087316,-.311097,.466049,.146374,-.34528,-.045904,-.152614,-.926686,-.287529,-.665726,-.032904,.246643,.248703,.637193,-.062541,-.073706,.495925,-.315143,.05946,-.116042,.075586]),B=new Float32Array([.186937,0,0,.605726,-.313457,-.097616,.003541,.781245,.283011,-.225029,-.373279,.274442,-.047511,.04992,-.226365,.627629,-.623617,-.463628,
.133094,-.318299,.528128,.262035,.100234,-.09012,.178335,-.426972,-.666048,-.27306,-.207352,.05514,-.613649,-.063395,.060608,-.283391,-.41382,-.087565,.136768,.506126,.484137,-.593808,-.344603,.453164,.675326,.124799,-.697865,-.33502,.411337,-.09337,-.15271,.002908,-.063582,.366733,-.699739,.401148,-.519536,-.585625,-.508413,.106482,-.428709,-.260221,.012847,-.118806,.016962,-.188182,.49945,.452364,.586617,.722539,-.23302,.111295,.202827,.066695,-.036503,.315842,.896467,-.039109,-.270116,-.080062,
.613435,.508787,.538656,-.352275,.566869,-.666275,.887876,-.138341,-.434135,-.444711,.269156,.119506,-.029457,-.077316,.754474,.274125,-.13876,-.37082,-.73268,.332723,.568545,-.203992,.878922,-.430778,.541154,-.546752,.11786,-3.93E-4,-.083318,.059333,-.341406,-.117017,-.318568,-.262425,-.457913,.848753,.89229,-.30157,.322416,.742328,.032262,.643827,.048091,-.078044,-.49908,.064858,.549944,-.796252,-.230688,.88978,-.010153,.397241,-.27645,.405666,-.46593,.131187,-.600166,.333834,-.078219,.73837,-.870169,
-.411658,-.222175,-.492421,.741454,.293757,-.591244,.389112,-.388324,.792346,.578552,.088459,-.121858,-.437241,-.472535,-.374835,.302427,.721264,.057485,.204085,-.126575,.510325,.481492,-.579888,-.29411,-.82136,.156404,-.819717,-.042466,.456573,.079884,.07019,.179002,.220279,.970222,-.088025,-.299911,-.234627,-.820794,.912112,.243306,.317869,.241336,.161841,-.721568,.301135,-.635993,-.0939,-.514731,-.089673,.850964,-.905087,.314604,-.098397]),E=64,C=[1,1,1,2,3,2,5,2,3,2,3,3,5,5,3,4,7,5,5,7,9,8,5,
5,7,7,7,8,5,8,11,12,7,10,13,8,11,8,7,14,11,11,13,12,13,19,17,13,11,18,19,11,11,14,17,21,15,16,17,18,13,17,11,17,19,18,25,18,19,19,29,21,19,27,31,29,21,18,17,29,31,31,23,18,25,26,25,23,19,34,19,27,21,25,39,29,17,21,27,29],G=new Float32Array([0,0,0,0,512,0,1,0,0,512,0,1,512,512,1,1]);return p})},"esri/views/3d/webgl-engine/lib/TextureRenderer":function(){define("require exports ../../support/debugFlags ./Camera ./ComponentUtils ./DefaultVertexBufferLayouts ./gl-matrix ./glUtil3D ./HighlightUtils ./Renderer ./RenderPass ./Util ../lighting/Lightsources ../materials/internal/TexOnlyGLMaterial ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n){var w=k.vec3d,c=k.vec4d,x=k.mat4d;p=function(){function a(a,d,e,f,g,k){var l=this;this._acquiredTextures={};this._clearColor=c.createFrom(0,0,0,0);this._id2origin={};this._uniqueIdx=0;this._rctx=a;this._canvas=d;this._programRep=e;this._textureRep=g;this._modelDirtySet=k;this._renderer=new b(e,f,g,this._rctx,!0);this._renderer.onHasHighlightsChanged=function(a){if(l.onHasHighlightsChanged)l.onHasHighlightsChanged(a)};this._renderer.setLighting({lights:[new u.AmbientLight(w.createFrom(1,
1,1))],groundLightingFactor:1,globalFactor:0})}a.prototype.dispose=function(){for(var a in this._acquiredTextures)this._acquiredTextures[a].fbo.dispose(),this._textureRep.release(a);this._acquiredTextures=null;this._renderer.dispose();this._renderer=null};a.prototype.addRenderGeometries=function(a){var c=this;a.forEach(function(a){null==a.origin&&(a.origin=c.getOrigin(a.center,a.bsRadius));a.idx=c._uniqueIdx++});this._renderer.modify(a,[])};a.prototype.removeRenderGeometries=function(a){this._renderer.modify([],
a)};a.prototype.updateRenderGeometries=function(a,c){a=a.map(function(a){return{renderGeometry:a,updateType:c}});this._renderer.modify([],[],a,{})};a.prototype.updateRenderOrder=function(a){0<Object.keys(a).length&&this._renderer.modifyRenderOrder(a)};a.prototype.setBackgroundColor=function(a){this._clearColor=a};a.prototype.addRenderGeometryHighlight=function(a,c){var b=a.instanceParameters,d=e.generateHighlightId();b.componentHighlights=g.addHighlight(b.componentHighlights,null,c,d);this.updateRenderGeometries([a],
32);return d};a.prototype.removeRenderGeometryHighlight=function(a,c){var b=a.instanceParameters;b.componentHighlights=g.removeHighlight(b.componentHighlights,c);this.updateRenderGeometries([a],32)};a.prototype.isEmpty=function(){return this._renderer.isEmpty()};a.prototype.processDirtyMaterials=function(){var a=this._modelDirtySet.getDirtyMaterials();a&&this._renderer.modify([],[],[],a);this._modelDirtySet.clearDirtyMaterials()};Object.defineProperty(a.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},
enumerable:!0,configurable:!0});a.prototype.draw=function(a,c){return this.drawPass(l.MATERIAL,a,c)};a.prototype.drawHighlights=function(a,c){return this.drawPass(l.MATERIAL_HIGHLIGHT,a,c)};a.prototype.drawPass=function(a,c,b){if(this.isEmpty()&&!d.OVERLAY_DRAW_TEST_TEXTURE)return!1;this.processDirtyMaterials();if(a===l.MATERIAL_HIGHLIGHT&&!this.hasHighlights||!b.views.some(function(a){return a.extent[0]!==a.extent[2]&&a.extent[1]!==a.extent[3]}))return!1;var e=c.id,f,g=this._rctx,k=g.gl;if(this._acquiredTextures[e])f=
this._acquiredTextures[e].fbo;else{f=this._textureRep.aquire(e).getGLTexture();f=v.createWithAttachments(this._rctx,f,{colorTarget:0,depthStencilTarget:0});var h=Object.keys(this._acquiredTextures).length;this._acquiredTextures[e]={texture:c,fbo:f,idx:h}}c=b.width;h=b.height;if(f.width!==c||f.height!==h)f.resize(c,h),f.colorTexture.setSamplingMode(9729);A.near=1;A.far=1E4;g.bindFramebuffer(f);g.setDepthTestEnabled(!1);g.setBlendFunctionSeparate(770,771,1,771);g.setClearColor.apply(g,this._clearColor);
g.clear(k.COLOR_BUFFER_BIT);this._renderer.setPixelRatio(b.pixelRatio||1);for(k=0;k<b.views.length;k++)f=b.views[k],A.viewport=f.viewport,x.ortho(0,f.extent[2]-f.extent[0],0,f.extent[3]-f.extent[1],A.near,A.far,A.projectionMatrix),x.identity(A.viewMatrix),x.translate(A.viewMatrix,[-f.extent[0],-f.extent[1],0]),A.setGLViewport(this._rctx),d.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(c,h,z[this._acquiredTextures[e].idx%z.length]),this._renderer.renderGeometryPass(a,A);g.setDepthTestEnabled(!0);
g.setBlendFunctionSeparate(770,771,1,771);g.bindFramebuffer(null);g.setViewport(0,0,this._canvas.width,this._canvas.height);return!0};a.prototype._drawTestTexture=function(a,c,b){var d=this._rctx,e=d.gl;if(!this._testPatternMat){for(var g=new Uint8Array(a*c*4),k=0,l=0;l<c;l++)for(var h=0;h<a;h++){var t=Math.floor(h/10),u=Math.floor(l/10);2>t||2>u||10*t>a-20||10*u>c-20?(g[k++]=255,g[k++]=255,g[k++]=255,g[k++]=255):(g[k++]=255,g[k++]=255,g[k++]=255,t&1&&u&1?g[k++]=h&1^l&1?0:255:g[k++]=t&1^u&1?0:128)}a=
new q(d,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:a,height:c},g);this._testPatternMat=new r(this._programRep,a,[1,1,1,1],!0,e.ALWAYS);this._testPatternBindParams={proj:x.identity(),view:x.identity(),nearFar:[-1,1],origin:[0,0,0],viewInvTransp:null,viewport:null,lightingData:null,fovY:0};this._quadVAO=m.createQuadVAO(d,f.Pos3Tex)}this._testPatternMat.setColor([b[0],b[1],b[2],1]);this._testPatternMat.bind(d,this._testPatternBindParams);this._testPatternMat.bindView(d,this._testPatternBindParams);
d.bindVAO(this._quadVAO);d.drawArrays(5,0,n.vertexCount(this._quadVAO,"geometry"));this._testPatternMat.release(d)};a.prototype.getOrigin=function(a,c){var b=0;c=10*c/1E4;1<c&&(b=Math.ceil(t.logWithBase(c,2)));c=1E4*Math.pow(2,b);var d=Math.round(a[0]/c),e=Math.round(a[1]/c);a=Math.round(a[2]/c);var b=b+"_"+d+"_"+e+"_"+a,f=this._id2origin[b];null==f&&(f={vec3:w.createFrom(d*c,e*c,a*c),id:b},this._id2origin[b]=f);return f};return a}();var z=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],A=new a;return p})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("require exports ./ComponentUtils ./DefaultVertexAttributeLocations ./ExternalRendererContainer ./Float32ArrayList ./FxaaRenderPass ./gl-matrix ./HighlightTextureHelper ./InstanceBufferData ./IntervalUtilities ./LinearDepthTextureHelper ./NormalTextureHelper ./RenderContext ./RenderPass ./RenderSlot ./SmaaRenderPass ./StencilRenderingHelper ./Util ./edgeRendering/EdgeView ../lighting/SceneLighting ../materials/HUDMaterial ../../../webgl/BufferObject ../../../webgl/Profiling ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x,z,A,y,B,E,C,G){function J(a){return a.instanceParameters.hidden?[]:d.generateVisibleIndexRanges(a.instanceParameters.componentVisibilities,a.componentOffsets)}function F(a,c,b){var d=a.origin.vec3;V(O,-d[0],-d[1],-d[2]);S.multiply(O,a.transformation,c);S.inverse(c,b);S.transpose(b)}function I(a,c,b){for(var d in a){var e=a[d];c(d,e);for(var f in e.origin2data)b(f,e.origin2data[f])}}function H(a){return!1===a.preinterleaved?M(a.indices).length:a.indexCount}
var K=c.assert,L=c.objectEmpty,M=c.getFirstObjectValue,V=c.setMatrixTranslation3;p=m.vec2d;var S=m.mat4d,Z=S.identity();m=function(){function c(a,c,b,d,f){this._lighting=new z.SceneLighting;this._mat2DataMerged={};this._mat2DataInstanced={};this._mat2DataPreinterleaved={};this._renderOrder=[];this._externalRenderers=new g;this._renderContext=new r;this._isRendering=!1;this._highlights=[];this._pixelRatio=1;this._threshold=1535;this._needsRender=!0;this._fallbackDepthStencilTexture=null;this._stats=
new R;this._edgeView=void 0;this.ssaoEnabled=!1;this.renderOptions={antialiasing:"smaa",earlyOcclusionPixelDraw:!1};this._programRep=a;this._materialRep=c;this._orderedRendering=f;this._rctx=d;this._fxaaPass=new k(d);this._smaaPass=new n(d);this._renderContext.lightingData=this._lighting.getOld();d.setDepthTestEnabled(!0);d.setFaceCullingEnabled(!0);d.setBlendingEnabled(!1);d.setBlendFunctionSeparate(770,771,1,771);this._bindParameters={view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,lightingData:null,
viewport:null,framebufferTex:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null,instanceParameters:null,depthFBO:null,normalFBO:null};this._linearDepthTextureHelper=new t(d);this._normalTextureHelper=new u(d);this._highlightTextureHelper=new e(d);this._stencilRenderingHelper=new w(d);this._initializeFramebufferTexture()}c.prototype._initializeFramebufferTexture=function(){var a=this._rctx.gl,a=this._rctx.contextAttributes.alpha?a.RGBA:a.RGB,c=new E(this._rctx,{target:3553,pixelFormat:a,
dataType:5121,samplingMode:9728,wrapMode:33071,width:4,height:4});this._framebuffer={format:a,texture:c}};c.prototype.dispose=function(){var a=this,c=function(c){a._releaseMaterials(c)},b=function(a,c){if(c.type===D.Preinterleaved)for(var b in c.instances)c.instances[b].vao.dispose(!0);else c.vao.dispose(!0)};I(this._mat2DataMerged,c,b);I(this._mat2DataInstanced,c,b);I(this._mat2DataPreinterleaved,c,b);this._mat2DataPreinterleaved=this._mat2DataInstanced=this._mat2DataMerged=null;this._framebuffer.texture.dispose();
this._framebuffer.texture=null;this._linearDepthTextureHelper.getEnableState()&&this._linearDepthTextureHelper.disable();this._normalTextureHelper.getEnableState()&&this._normalTextureHelper.disable();this._highlightTextureHelper.getEnableState()&&this._highlightTextureHelper.setEnableState(!1);this._stencilRenderingHelper.getEnableState()&&this._stencilRenderingHelper.setEnableState(!1);this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=
null)};Object.defineProperty(c.prototype,"isLoadingResources",{get:function(){return"smaa"===this.renderOptions.antialiasing&&this._smaaPass.isLoadingResources},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"edgeView",{get:function(){void 0===this._edgeView&&(this._edgeView=x.EdgeView.isSupported(this._rctx)?new x.EdgeView(this._rctx,this._programRep):null);return this._edgeView},enumerable:!0,configurable:!0});c.prototype.setLighting=function(a){this._lighting.set(a)};c.prototype.setPixelRatio=
function(a){this._pixelRatio=a;this._needsRender=!0};c.prototype.getPixelRatio=function(){return this._pixelRatio};c.prototype.addExternalRenderer=function(a,c){this._externalRenderers.addRenderer(a,c);return!0};c.prototype.removeExternalRenderer=function(a){this._externalRenderers.removeRenderer(a);return!0};c.prototype.getExternalRenderers=function(){return this._externalRenderers};c.prototype.resetNeedsRender=function(){this._needsRender=!1;this._externalRenderers.resetNeedsRender()};c.prototype.needsRender=
function(){return this._needsRender||this._externalRenderers.needsRender()};c.prototype.getCombinedStats=function(){var a=this;this._stats.VBOallocatedSize=0;this._stats.VBOoptimalSize=0;this._stats.VBOusedSize=0;var c=function(){},b=function(c,b){if(b.type===D.Preinterleaved)for(var d in b.instances)c=b.instances[d].vao.size,a._stats.VBOallocatedSize+=c/4,a._stats.VBOusedSize+=c/4,a._stats.VBOoptimalSize+=c/4;else a._stats.VBOallocatedSize+=b.buffer.getArray().length,a._stats.VBOusedSize+=b.buffer.getSize(),
a._stats.VBOoptimalSize+=b.optimalCount};I(this._mat2DataMerged,c,b);I(this._mat2DataInstanced,c,b);I(this._mat2DataPreinterleaved,c,b);this._stats.VBOallocatedSize*=.00390625;this._stats.VBOusedSize*=.00390625;this._stats.VBOoptimalSize*=.00390625;return this._stats};c.prototype._addHighlight=function(a){var c=this._getInstance(a);if(null===c)console.error("No instance found for RenderGeometry {name: '"+a.name+"', uniqueName: '"+a.uniqueName+"'}");else if(this._highlights.push(c),this._orderedRendering&&
this._sortHighlightsByRenderOrder(),this._needsRender=!0,this.onHasHighlightsChanged)this.onHasHighlightsChanged(this.hasHighlights)};c.prototype._removeHighlight=function(a){var c=this._highlights.length;this._highlights=this._highlights.filter(function(c){return c.uniqueName!==a.uniqueName});if(c!==this._highlights.length){if(this.onHasHighlightsChanged)this.onHasHighlightsChanged(this.hasHighlights);this._needsRender=!0}};Object.defineProperty(c.prototype,"hasHighlights",{get:function(){return 0<
this._highlights.length},enumerable:!0,configurable:!0});c.prototype._renderHUDVisibility=function(a){var c=this,b=A.shouldRenderVisibilityDuringRenderPass(a.pass),d=a.offscreenRenderingHelper&&a.offscreenRenderingHelper.getEnableState();b&&d&&a.offscreenRenderingHelper.renderHUDVisibility(function(){c._renderInternalSlot(q.OCCLUSION_PIXELS,a)})};c.prototype.renderGeometrySlotsPt1=function(a){this._externalRenderers.render(q.INTERNAL_MATERIAL,a);this._renderInternalSlot(q.STENCIL_MATERIAL,a);this._externalRenderers.render(q.OPAQUE_TERRAIN,
a);this._renderInternalSlot(q.OPAQUE_MATERIAL,a);this._externalRenderers.render(q.OPAQUE_EXTERNAL,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep);this._externalRenderers.render(q.POSTPROCESSING_ATMOSPHERE_OPAQUE,this._renderContext);this._renderInternalSlot(q.TRANSPARENT_MATERIAL,a);this.renderOptions.earlyOcclusionPixelDraw&&(this._renderHUDVisibility(a),this._renderInternalSlot(q.LINE_CALLOUTS,this._renderContext));this._externalRenderers.render(q.TRANSPARENT_EXTERNAL,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep)};
c.prototype.renderGeometrySlotsPt2=function(a){this._externalRenderers.render(q.TRANSPARENT_TERRAIN,a)};c.prototype.renderGeometrySlots=function(a){this.renderGeometrySlotsPt1(a);this.renderGeometrySlotsPt2(a)};c.prototype._renderHighlights=function(a,c,b){var d=!!b&&b.getEnableState()&&(this.hasHighlights||this._externalRenderers.needsHighlight());this._highlightTextureHelper.setEnableState(d);if(d){d=null;b.profilingCallback&&(d=B.startMeasurement(this._renderContext.rctx));this._highlightTextureHelper.setupFBOs(a);
this._highlightTextureHelper.prepareHighlightPass();this.renderGeometryPass(v.MATERIAL_HIGHLIGHT,a,null,null);this._rctx.clear(this._rctx.gl.DEPTH_BUFFER_BIT);this._renderInternalSlot(q.LINE_CALLOUTS_HUD_DEPTH,this._renderContext);this._renderInternalSlot(q.HUDMATERIAL1,this._renderContext);this._renderInternalSlot(q.HUDMATERIAL2,this._renderContext);this._highlightTextureHelper.finish(c);var e=this._highlightTextureHelper.getHighlightFBO();b.render(a,c,e);null!==d&&b.profilingCallback&&d.stop(function(a){b.profilingCallback&&
b.profilingCallback(a)})}};c.prototype._needsRenderOccluded=function(a){for(var c in this._mat2DataInstanced){var b=this._mat2DataInstanced[c][0];if(b&&b.renderOccluded&&b.beginSlot(a)&&b.isVisible())return!0}return!1};c.prototype._renderOccluded=function(a,c,b){if(c&&b&&b.getEnableState()){var d=this._needsRenderOccluded(q.OPAQUE_MATERIAL)||this._needsRenderOccluded(q.TRANSPARENT_MATERIAL);d!==c.getEnableState()&&c.setEnableState(d);d&&(d=this._renderContext,c.setupFBOs(a),c.prepareColorPass(),d.pass=
v.MATERIAL,d.renderOccludedOnly=!0,this._renderInternalSlot(q.OPAQUE_MATERIAL,d),this._renderInternalSlot(q.TRANSPARENT_MATERIAL,d),d.renderOccludedOnly=!1,c.finish(b.getFramebuffer()),c.apply())}};c.prototype._renderUnordered=function(a,c,b,d){var e=this,f=this._rctx;this._isRendering=!0;this._stats.reset();this._updateGlobalUniforms(a.projectionMatrix);this._renderContext.pass=v.MATERIAL;this._renderContext.camera=a;this._renderContext.shadowMap=c;this._renderContext.ssaoHelper=d.ssao;this._renderContext.offscreenRenderingHelper=
d.offscreenRendering;this._renderContext.stencilRenderingHelper=this._stencilRenderingHelper;this._renderContext.depth=this._linearDepthTextureHelper.getDepthFBO();this._renderContext.normals=this._normalTextureHelper.getNormalFBO();this._renderContext.highlight=this._highlightTextureHelper.getHighlightFBO();this._renderContext.options=this.renderOptions;this._renderContext.rctx=this._rctx;this._renderContext.lightingData=this._lighting.getOld();d.offscreenRendering.setEnableState(!0);d.offscreenRendering.initializeFrame(a);
this._externalRenderers.render(q.BACKGROUND,this._renderContext);this.renderGeometrySlotsPt1(this._renderContext);this._edgeView&&(c=null,this._edgeView.profilingCallback&&(c=B.startMeasurement(this._renderContext.rctx)),d.offscreenRendering.renderSeparateAndComposite(function(){e._edgeView.render(a,e._bindParameters)},void 0,this._edgeView.compositingMode),c&&c.stop(function(a){e._edgeView&&e._edgeView.profilingCallback&&e._edgeView.profilingCallback(a)}));this.renderGeometrySlotsPt2(this._renderContext);
this._externalRenderers.render(q.POSTPROCESSING_ATMOSPHERE_TRANSPARENT,this._renderContext);this._externalRenderers.render(q.POSTPROCESSING_EXTERNAL,this._renderContext);this.renderOptions.earlyOcclusionPixelDraw||(this._renderHUDVisibility(this._renderContext),this._renderInternalSlot(q.LINE_CALLOUTS,this._renderContext));this._renderOccluded(a,d.renderOccluded,d.offscreenRendering);c=this.renderOptions.antialiasing;"smaa"===c&&this._smaaPass.loadResources(function(){e._needsRender=!0});"smaa"===
c&&this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:d.offscreenRendering.getColorTexture()},null)):"fxaa"===c&&this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:d.offscreenRendering.getColorTexture()},null)):(d.offscreenRendering.composite(),this._fxaaPass.disable(),this._smaaPass.disable());f.bindFramebuffer(null);this._renderContext.framebufferTex=d.offscreenRendering.getColorTexture();this._renderInternalSlot(q.LINE_CALLOUTS_HUD_DEPTH,
this._renderContext);this._renderInternalSlot(q.HUDMATERIAL1,this._renderContext);this._renderInternalSlot(q.HUDMATERIAL2,this._renderContext);this._renderHighlights(a,b,d.highlight);this._isRendering=!1};c.prototype._renderGeometryPassOrderedHighlight=function(a){this._renderInternalHighlights(this._highlights)};c.prototype._renderGeometryPassOrderedMaterial=function(a){for(var c=null,b=0;b<this._renderOrder.length;b++){var d=this._renderOrder[b][1];if(d.instanced){var e=d.instanced||d.merged,f=
e[a.pass];f&&f.isVisible()&&(this._renderInternalInstanced(e,f,this._bindParameters,Infinity),c=null)}d.merged&&(e=d.merged,(f=e[a.pass])&&f.isVisible()&&(d=f.getProgram(),d!==c&&(d.setUniformMatrix4fv("model",Z),d.hasUniform("modelNormal")&&d.setUniformMatrix4fv("modelNormal",Z)),c=d,this._renderInternalMerged(e,f,this._bindParameters,Infinity)))}};c.prototype._renderGeometryPassOrdered=function(a){var c=a.camera;this._bindParameters.view=c.viewMatrix;this._bindParameters.proj=c.projectionMatrix;
this._bindParameters.viewInvTransp=c.viewInverseTransposeMatrix;P[0]=c.near;P[1]=c.far;this._bindParameters.nearFar=P;this._bindParameters.lightingData=this._lighting.getOld();this._bindParameters.viewport=c.fullViewport;this._bindParameters.framebufferTex=this._framebuffer.texture;this._bindParameters.pixelRatio=this._pixelRatio;this._bindParameters.instanceParameters=void 0;this._bindParameters.depthFBO=this._linearDepthTextureHelper.getDepthFBO();this._bindParameters.normalFBO=this._normalTextureHelper.getNormalFBO();
a.isHighlightPass?this._renderGeometryPassOrderedHighlight(a):this._renderGeometryPassOrderedMaterial(a)};c.prototype._renderOrdered=function(a,c){this._stats.reset();this.renderGeometryPass(a,c)};c.prototype.render=function(a,c,b){this._orderedRendering?this._renderOrdered(v.MATERIAL,a):this._renderUnordered(a,b.shadowMap,c,b)};c.prototype.renderAuxiliaryBuffers=function(a,c,b){var d=b.ssao;b=b.shadowMap;var e=this.ssaoEnabled||this._externalRenderers.needsLinearDepth();this._linearDepthTextureHelper.setEnableState(e);
e&&(this._linearDepthTextureHelper.setupFBOs(a),this._linearDepthTextureHelper.prepareDepthPass(),this.renderGeometryPass(v.MATERIAL_DEPTH,a,b,d),this._linearDepthTextureHelper.finish(c));this._normalTextureHelper.setEnableState(this.ssaoEnabled);this.ssaoEnabled&&(this._normalTextureHelper.setupFBOs(a),this._normalTextureHelper.prepareNormalPass(),this.renderGeometryPass(v.MATERIAL_NORMAL,a,b,d),this._normalTextureHelper.finish(c));this.ssaoEnabled&&d.computeSSAO(a,c,this._linearDepthTextureHelper.getDepthFBO(),
this._normalTextureHelper.getNormalFBO());d.bindAll(this._programRep)};c.prototype.renderGeometryPass=function(a,c,b,d){this._isRendering=!0;this._updateGlobalUniforms(c.projectionMatrix);this._renderContext.pass=a;this._renderContext.camera=c;this._renderContext.shadowMap=b;this._renderContext.ssaoHelper=d;this._renderContext.depth=this._linearDepthTextureHelper.getDepthFBO();this._renderContext.normals=this._normalTextureHelper.getNormalFBO();this._renderContext.rctx=this._rctx;this._orderedRendering?
this._renderGeometryPassOrdered(this._renderContext):this._renderGeometryPassUnordered(this._renderContext);this._isRendering=!1};c.prototype._renderGeometryPassUnordered=function(a){this.renderGeometrySlots(a)};c.prototype._renderInternalHighlights=function(a,c){void 0===c&&(c=null);for(var b=0;b<a.length;++b){var d=a[b],e=d.matData[v.MATERIAL_HIGHLIGHT];e&&(null===c||e.beginSlot(c))&&e.isVisible()&&this._renderInternalHighlight(d,this._bindParameters,v.MATERIAL_HIGHLIGHT)}};c.prototype._renderInternalSlotOccluded=
function(a,c){for(var b in this._mat2DataInstanced){var d=this._mat2DataInstanced[b],e=d[c.pass];e&&e.renderOccluded&&e.beginSlot(a)&&e.isVisible()&&this._renderInternalInstanced(d,e,this._bindParameters,a)}};c.prototype._renderInternalSlotMaterial=function(a,c){for(var b in this._mat2DataInstanced){var d=this._mat2DataInstanced[b],e=d[c.pass];e&&e.beginSlot(a)&&e.isVisible()&&this._renderInternalInstanced(d,e,this._bindParameters,a)}for(var d=this._programRep.getProgramsUsingUniform("model"),e=this._programRep.getProgramsUsingUniform("modelNormal"),
f=0;f<d.length;f++){var g=d[f];g.setUniformMatrix4fv("model",Z);-1<e.indexOf(g)&&g.setUniformMatrix4fv("modelNormal",Z)}for(b in this._mat2DataMerged)d=this._mat2DataMerged[b],(e=d[c.pass])&&e.beginSlot(a)&&e.isVisible()&&this._renderInternalMerged(d,e,this._bindParameters,a);for(b in this._mat2DataPreinterleaved)d=this._mat2DataPreinterleaved[b],(e=d[c.pass])&&e.beginSlot(a)&&e.isVisible()&&this._renderInternalPreinterleaved(d,e,this._bindParameters,a);a===q.STENCIL_MATERIAL&&this._stencilRenderingHelper.finish()};
c.prototype._renderInternalSlotHighlights=function(a,c){this._renderInternalHighlights(this._highlights,a)};c.prototype._renderInternalSlot=function(a,c){this._bindParameters.view=c.camera.viewMatrix;this._bindParameters.proj=c.camera.projectionMatrix;this._bindParameters.viewInvTransp=c.camera.viewInverseTransposeMatrix;this._bindParameters.cameraAboveGround=c.camera.aboveGround;this._bindParameters.fovY=c.camera.fovY;this._bindParameters.poiDistance=c.camera.distance;P[0]=c.camera.near;P[1]=c.camera.far;
var b=this._renderContext.offscreenRenderingHelper;this._bindParameters.nearFar=P;this._bindParameters.lightingData=this._lighting.getOld();this._bindParameters.viewport=c.camera.fullViewport;this._bindParameters.framebufferTex=b?b.getColorTexture():null;this._bindParameters.shadowMap=c.shadowMap;this._bindParameters.shadowMappingEnabled=!!c.shadowMap&&c.shadowMap.getEnableState();this._bindParameters.ssaoEnabled=!!c.ssaoHelper&&c.ssaoHelper.getEnableState();this._bindParameters.pixelRatio=this._pixelRatio;
this._bindParameters.instanceParameters=void 0;this._bindParameters.depthFBO=this._linearDepthTextureHelper.getDepthFBO();this._bindParameters.hudVisibilityTexture=b?b.getHUDVisibilityTexture():null;c.isHighlightPass?this._renderInternalSlotHighlights(a,c):c.renderOccludedOnly?this._renderInternalSlotOccluded(a,c):this._renderInternalSlotMaterial(a,c)};c.prototype._renderInternalInstanced=function(a,c,b,d){var e=this._rctx,f=e.gl,g=!1,k=c.getDrawMode(e),l=e.capabilities.instancing,h;for(h in a.origin2data){var n=
a.origin2data[h];b.origin=n.origin;d===q.STENCIL_MATERIAL&&(this._stencilRenderingHelper.setEnableState(!0),this._stencilRenderingHelper.prepareStencilWritePass());var m=!1;if(c.instanced)for(var r in n.perGeometryDataInfo){var t=n.perGeometryDataInfo[r];g||(c.bind(e,b),g=!0);e.bindVAO(t.vao);var u=c.getProgram();C.assertCompatibleVertexAttributeLocations(t.vao,u);m||(c.bindView(e,b),m=!0);var u=t.to-t.from,v=t.refCount;k===f.TRIANGLES&&(this._stats.trianglesRendered+=v*u/3);l.drawArraysInstanced(k,
t.from,u,v);this._stats.drawCallsAngleInstanced++;this._stats.instancesDrawnAngle+=v}else{var t=n.instances,w;for(w in t)u=t[w],v=u.displayedIndexRange,v&&0===v.length||(g||(c.bind(e,b),g=!0),m||(e.bindVAO(n.vao),c.bindView(e,b),m=!0),c.bindInstance(e,u),this._stats.drawCallsInstanced++,k===f.TRIANGLES&&(this._stats.trianglesRendered+=(u.to-u.from)/3),v?this._drawArraysFaceRange(v,u.from,k):e.drawArrays(k,u.from,u.to-u.from))}}e.bindVAO(null);g&&c.release(e,b)};c.prototype._renderInternalHighlight=
function(a,c,b){var d=this._rctx,e=d.gl;b=a.matData[b];var f=b.getDrawMode(d),g=a.instance,k=g.highlightedIndexRange,l=this._renderContext.offscreenRenderingHelper,l=(l?l.getDepthTexture():null)||this._getFallbackDepthTexture(),h=b.getProgram(),n=d.capabilities.instancing;c.origin=a.originData.origin;if(b.instanced&&a.type===D.Instanced)for(a=a.instancedVAO,b.bind(d,c),d.bindVAO(a),C.assertCompatibleVertexAttributeLocations(a,h),b.bindView(d,c),a=0;a<k.length;a++){var m=k[a],q=m.range?m.range[0]+
g.from:g.from,m=m.range?m.range[1]-m.range[0]+1:g.to-g.from;d.bindTexture(l,5);h.setUniform1i("depthTex",5);h.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]);n.drawArraysInstanced(f,q,m,1);f===e.TRIANGLES&&(this._stats.trianglesRendered+=1*m/3);this._stats.drawCallsHighlight++}else if(a.type===D.Instanced&&b.instanced)console.error("_renderInternalHighlight: incompatible instance type");else{b.bind(d,c);b.bindView(d,c);n=null;switch(a.type){case D.Merged:q=
a.originData;d.bindVAO(q.vao);h.setUniformMatrix4fv("model",Z);break;case D.Instanced:q=a.originData;d.bindVAO(q.vao);b.bindInstance(d,g);break;case D.Preinterleaved:q=a.originData,a=q.instances[a.uniqueName].vao,d.bindVAO(a),b.bindInstance(d,g),n=a.indexBuffer&&a.indexBuffer.indexType}for(a=0;a<k.length;a++){m=k[a];q=m.range?m.range[0]+g.from:g.from;m=m.range?m.range[1]-m.range[0]+1:g.to-g.from;d.bindTexture(l,5);b.getProgram().setUniform1i("depthTex",5);h.setUniform4f("highlightViewportPixelSz",
0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]);if(n){var r=C.getBytesPerElement(n);d.drawElements(f,m,n,q*r)}else d.drawArrays(f,q,m);f===e.TRIANGLES&&(this._stats.trianglesRendered+=m/3);this._stats.drawCallsHighlight++}}d.bindVAO(null);b.release(d,c)};c.prototype._drawArraysFaceRange=function(a,c,b){for(var d=this._rctx,e=0;e<a.length;e++){var f=a[e];d.drawArrays(b,f[0]+c,f[1]-f[0]+1)}this._stats.drawCallsFragmented+=a.length-1};c.prototype._drawElementsFaceRange=function(a,
c,b,d){for(var e=this._rctx,f=C.getBytesPerElement(d),g=0;g<a.length;g++){var k=a[g];e.drawElements(b,k[1]-k[0]+1,d,(k[0]+c)*f)}this._stats.drawCallsFragmented+=a.length-1};c.prototype._renderInternalMerged=function(a,c,b,d){var e=this._rctx,f=e.gl,g=!1,k;for(k in a.origin2data){var l=a.origin2data[k];b.origin=l.origin;d===q.STENCIL_MATERIAL&&(this._stencilRenderingHelper.setEnableState(!0),this._stencilRenderingHelper.prepareStencilWritePass());if(!l.displayedIndexRange||0!==l.displayedIndexRange.length){g||
(c.bind(e,b),g=!0);var h=c.getProgram();e.bindVAO(l.vao);C.assertCompatibleVertexAttributeLocations(l.vao,h);c.bindView(e,b);this._stats.drawCallsMerged++;h=c.getDrawMode(e);h===f.TRIANGLES&&(this._stats.trianglesRendered+=l.vao.vertexBuffers.geometry.size/3);l.displayedIndexRange?this._drawArraysFaceRange(l.displayedIndexRange,0,h):e.drawArrays(h,0,C.vertexCount(l.vao,"geometry"))}}g&&c.release(e,b)};c.prototype._renderInternalPreinterleaved=function(a,c,b,d){var e=this._rctx,f=e.gl,g=!1,k=c.getDrawMode(e),
l;for(l in a.origin2data){var h=a.origin2data[l];b.origin=h.origin;var n=!1;d===q.STENCIL_MATERIAL&&(this._stencilRenderingHelper.setEnableState(!0),this._stencilRenderingHelper.prepareStencilWritePass());for(var m in h.instances){var r=h.instances[m],t=r.instance,u=r.vao,r=t.displayedIndexRange;if(!r||0!==r.length){g||(c.bind(e,b),g=!0);var v=c.getProgram();C.assertCompatibleVertexAttributeLocations(u,v);e.bindVAO(u);n||(c.bindView(e,b),n=!0);c.bindInstance(e,t);this._stats.drawCallsPreinterleaved++;
k===f.TRIANGLES&&(this._stats.trianglesRendered+=(t.to-t.from)/3);u=u.indexBuffer&&u.indexBuffer.indexType;r?u?this._drawElementsFaceRange(r,t.from,k,u):this._drawArraysFaceRange(r,t.from,k):u?(r=C.getBytesPerElement(u),e.drawElements(k,t.to-t.from,u,t.from*r)):e.drawArrays(k,t.from,t.to-t.from)}}}e.bindVAO(null);g&&c.release(e,b)};c.prototype._updateGlobalUniforms=function(a){for(var c=this._programRep.getProgramsUsingUniform("proj"),b=0;b<c.length;b++)c[b].setUniformMatrix4fv("proj",a);if(this._lighting){c=
this._programRep.getProgramsUsingUniform("lightingMainDirection");for(b=0;b<c.length;b++)this._lighting.setUniforms(c[b]);c=this._programRep.getProgramsUsingUniform("lightDirection");for(b=0;b<c.length;b++)this._lighting.setUniforms(c[b])}};c.prototype.print=function(){var a=Object.keys(this._mat2DataMerged).length,c=Object.keys(this._mat2DataInstanced).length,b=Object.keys(this._mat2DataPreinterleaved).length;console.log("number of materials (merged/instanced/preinterleaved): "+a+"/"+c+"/"+b);var d=
0;I(this._mat2DataMerged,function(){},function(a,c){d+=Object.keys(c.instances).length});var e=0;I(this._mat2DataInstanced,function(){},function(a,c){e+=Object.keys(c.instances).length});var f=0;I(this._mat2DataPreinterleaved,function(){},function(a,c){f+=Object.keys(c.instances).length});console.log("number of instances (merged/instanced/preinterleaved): "+d+"/"+e+"/"+f)};c.prototype.isEmpty=function(){for(var a in this._mat2DataInstanced){var c=this._mat2DataInstanced[a],b;for(b in c.origin2data)if(!L(c.origin2data[b].instances))return!1}for(a in this._mat2DataMerged)for(b in c=
this._mat2DataMerged[a],c.origin2data)if(!L(c.origin2data[b].instances))return!1;for(a in this._mat2DataPreinterleaved)for(b in c=this._mat2DataPreinterleaved[a],c.origin2data)if(!L(c.origin2data[b].instances))return!1;return!0};c.prototype.modify=function(a,c,b,d){this._isRendering&&console.warn("Renderer.modify called while rendering");var e=[],f=[],g=[];this._classifyRenderGeometry(a,e,f,g);a=[];var k=[],l=[];this._classifyRenderGeometry(c,a,k,l);var h={};b&&this._performUpdates(b,h);b=[];this._modifyMerged(e,
a,b,h);this._modifyInstanced(f,k,b);this._modifyPreinterleaved(g,l,b);this._updateMergedFaceranges(h);this._releaseMaterials(b);e=this._highlights.length;if(c&&0<c.length&&0<e&&(this._highlights=this._highlights.filter(function(a){return!c.some(function(c){return c.uniqueName===a.uniqueName})}),e!==this._highlights.length&&this.onHasHighlightsChanged))this.onHasHighlightsChanged(this.hasHighlights);this._updateHighlightVAOs();this._modifyMaterials(d);this._needsRender=!0};c.prototype._classifyRenderGeometry=
function(a,c,b,d){for(var e=0;e<a.length;e++){var f=a[e];if(1<=H(f.data))switch(this._getType(f)){case D.Merged:c.push(f);break;case D.Instanced:b.push(f);break;case D.Preinterleaved:d.push(f)}}};c.prototype._performUpdates=function(a,c){for(var b=0;b<a.length;b++){var d=a[b],e=d.updateType,d=d.renderGeometry,f=this._getType(d)===D.Merged;if(1<=H(d.data)){e&2&&this._updateFaceranges(d,c);if(e&32){var g=this._getInstance(d);g&&this._updateHighlightFaceranges(d,g.instance)}e&4||f&&e&16?this._updateVertexAttributes(d,
!f):!f&&e&16&&this._updateInstanceTransformation(d)}}};c.prototype._updateFaceranges=function(a,c){var b=a.material.id,d=a.origin.id,e=this._getType(a),f;if(e===D.Preinterleaved){var g=this._getOriginData(e,b,d);f=g.instances[a.uniqueName].instance}else g=this._getOriginData(e,b,d),(f=g.instances[a.uniqueName])&&e===D.Merged&&(c[this._modifiedMergedFacerangesKey(b,d)]=g);f&&(f.displayedIndexRange=J(a),this._updateHighlightFaceranges(a,f))};c.prototype._updateHighlightFaceranges=function(a,c){if(c){var b=
c.highlightedIndexRange,e;e=a.instanceParameters.hidden?[]:d.generateHighlightedIndexRanges(a.instanceParameters.componentVisibilities,a.instanceParameters.componentHighlights,a.componentOffsets);(c.highlightedIndexRange=e)&&!b?this._addHighlight(a):!e&&b&&this._removeHighlight(a)}};c.prototype._updateMergedFaceranges=function(a){for(var c in a){var b=a[c];b.displayedIndexRange=[];var d=b.instances,e=!0,f;for(f in d){var g=d[f];g.displayedIndexRange?(b.displayedIndexRange.push.apply(b.displayedIndexRange,
l.offsetIntervals(g.displayedIndexRange,g.from)),e=!1):b.displayedIndexRange.push([g.from,g.to-1])}b.displayedIndexRange=e?null:l.mergeIntervals(b.displayedIndexRange)}};c.prototype._updateVertexAttributes=function(a,c){var b=a.material,d=b.id,e=a.origin.id,f=C.getStride(b.getVertexBufferLayout())/4,g=this._getType(a);if(g===D.Preinterleaved)console.error("Updating Preinterleaved geometry not supported");else{var g=this._getOriginData(g,d,e),d=g.instances[a.uniqueName],e=g.buffer.getArray(),g=g.vao,
k,l;c||(F(a,Q,T),k=Q,l=T);b.fillInterleaved(a.data,k,l,a.instanceParameters,e,d.from*f);K(d.from+b.getOutputAmount(H(a.data))/f===d.to,"material VBO layout has changed");g.vertexBuffers.geometry.setSubData(e,d.from*f*4,d.from*f*4,d.to*f*4)}};c.prototype._updateInstanceTransformation=function(a){var c=this._getType(a),b=a.material.id,d=a.origin.id;c===D.Preinterleaved?(c=this._getOriginData(c,b,d),d=c.instances[a.uniqueName].instance,F(a,d.transformation,d.transformationNormal)):(c=this._getOriginData(c,
b,d),d=c.instances[a.uniqueName],c=c.perGeometryDataInfo[a.data.id],b=c.instanceBufferData,F(a,d.transformation,d.transformationNormal),b&&(a=b.getSlot(a.idx),b.fill(a,0,d.transformation),b.fill(a,16,d.transformationNormal),a=4*b.getOffset(a),d=C.getStride(c.vao.layout.instance),c.vao.vertexBuffers.instance.setSubData(b.getArray(),a,a,a+d)))};c.prototype._modifyMerged=function(c,b,d,e){var g=this._rctx,k=D.Merged;c=this._compMat2delta(c,b,k);b=this._mat2DataMerged;for(var l in c){var h=c[l],n;for(n in h){var m=
h[n],q=m.optimalCount,r=m.material,t=r.getVertexBufferLayout(),u=C.getStride(t)/4,v=b[l];if(null==v){K(0<q);var w=r.renderPriority,v=this._initializeMatData(r);b[l]=v;this._orderedRendering&&this._insertIntoRenderOrder(v,w,"merged")}w=v.origin2data[n];null==w&&(K(0<q),w={type:k,instances:{},vao:new G(g,a.Default3D,{geometry:t},{geometry:y.createVertex(g,35044)}),buffer:new f(q),optimalCount:0,origin:m.origin},v.origin2data[n]=w);if(0<q){var t=w.buffer.getSize(),x=w.buffer.getArray(),v=q<m.sparseCount/
2,p=w.buffer.resize(v?q:m.sparseCount),z=m.toRemove;if(v||p){for(var t=0,A=w.buffer.getArray(),v=0;v<z.length;++v)p=w.instances[z[v].uniqueName],w.optimalCount-=(p.to-p.from)*u,delete w.instances[z[v].uniqueName];var v={},E;for(E in w.instances)p=w.instances[E],K(null==v[p.from]),v[p.from]=p;for(var B in v){var p=v[B],U=p.from*u,aa=p.to*u;A.set(x.subarray(U,aa),t);p.from=t/u;t+=aa-U;p.to=t/u}K(t===w.optimalCount)}else for(v=0;v<z.length;++v)p=z[v].uniqueName,K(void 0!==w.instances[p]),U=w.instances[p].from*
u,aa=w.instances[p].to*u,w.buffer.erase(U,aa),delete w.instances[p],w.optimalCount-=aa-U;V(O,-m.origin[0],-m.origin[1],-m.origin[2]);x=m.toAdd;m=!1;for(v=0;v<x.length;++v)z=x[v],U=z.data,S.multiply(O,z.transformation,Q),S.inverse(Q,T),S.transpose(T),p=t,r.fillInterleaved(U,Q,T,z.instanceParameters,w.buffer.getArray(),t),U=r.getOutputAmount(H(U)),A=p+U,K(null==w.instances[z.uniqueName]),aa=J(z),p=new N(z.name,p/u,A/u,aa,void 0,void 0,z.idx),w.instances[z.uniqueName]=p,this._updateHighlightFaceranges(z,
p),aa&&(m=!0),w.optimalCount+=U,t+=U;K(w.optimalCount===q);q=new Float32Array(w.buffer.getArray().buffer,0,w.buffer.getSize());w.vao.vertexBuffers.geometry.setData(q);if(m||w.displayedIndexRange)e[this._modifiedMergedFacerangesKey(l,n)]=w}else K(0===q),w.vao.dispose(!0),w.vao=null,delete v.origin2data[n],0===Object.keys(v.origin2data).length&&(d.push(l),delete b[l],this._orderedRendering&&this._removeFromRenderOrder(v,"merged"))}}};c.prototype._modifyInstanced=function(c,d,e){var g=this._rctx,k=D.Instanced;
c=this._compMat2delta(c,d,k);d=this._mat2DataInstanced;for(var l in c){var h=c[l],n;for(n in h){var m=h[n];if(0===m.optimalCount)m=d[l],m.origin2data[n].vao.dispose(!0),delete m.origin2data[n],0===Object.keys(m.origin2data).length&&(e.push(l),delete d[l],this._orderedRendering&&this._removeFromRenderOrder(m,"instanced"));else{var q=m.material,r=d[l];if(null==r){var t=q.renderPriority,r=this._initializeMatData(q);d[l]=r;this._orderedRendering&&this._insertIntoRenderOrder(r,t,"instanced")}var u=q.getVertexBufferLayout(),
w=r[v.MATERIAL].instanced?q.getInstanceBufferLayout():void 0,x=w&&C.findAttribute(w,"instanceColor"),p=w&&C.findAttribute(w,"instanceFeatureAttribute"),z=C.getStride(u)/4,t=r.origin2data[n];null==t&&(t={type:k,instances:{},vao:new G(g,a.Default3D,{geometry:u},{geometry:y.createVertex(g,35044)}),buffer:new f(m.optimalCount),optimalCount:0,perGeometryDataInfo:{},origin:m.origin},r.origin2data[n]=t);var r=t.buffer.getSize(),A=t.buffer.getArray(),E=m.optimalCount<m.sparseCount/2,B=t.buffer.resize(E?m.optimalCount:
m.sparseCount),Q;for(Q in m.perGeometryDelta){var T=t.perGeometryDataInfo[Q];if(T&&T.instanceBufferData){var U=m.perGeometryDelta[Q].removeCount;0<U&&T.instanceBufferData.prepareFree(U)}}var aa=m.toRemove;if(E||B){for(E=0;E<aa.length;++E){B=aa[E];delete t.instances[B.uniqueName];Q=B.data.id;var F=T=t.perGeometryDataInfo[Q];0===--F.refCount&&null==m.dataId2refCount[Q]?(t.optimalCount-=(F.to-F.from)*z,delete t.perGeometryDataInfo[Q]):T.instanceBufferData&&T.instanceBufferData.free(B.idx)}var r=0,E=
t.buffer.getArray(),B={},P;for(P in t.perGeometryDataInfo)F=t.perGeometryDataInfo[P],K(null==B[F.from]),B[F.from]=F;for(var da in B)F=B[da],U=F.from*z,T=F.to*z,E.set(A.subarray(U,T),r),F.from=r/z,r+=T-U,F.to=r/z;for(var I in t.instances)U=t.instances[I],U.from=t.perGeometryDataInfo[U.dataId].from,U.to=t.perGeometryDataInfo[U.dataId].to}else for(E=0;E<aa.length;++E)B=aa[E],delete t.instances[B.uniqueName],Q=B.data.id,T=t.perGeometryDataInfo[Q],0===--T.refCount&&null==m.dataId2refCount[Q]?(U=T.from*
z,T=T.to*z,t.buffer.erase(U,T),t.optimalCount-=T-U,delete t.perGeometryDataInfo[Q]):T.instanceBufferData&&T.instanceBufferData.free(B.idx);V(O,-m.origin[0],-m.origin[1],-m.origin[2]);for(Q in m.perGeometryDelta)(T=t.perGeometryDataInfo[Q])&&T.instanceBufferData&&(E=m.perGeometryDelta[Q].addCount,0<E&&T.instanceBufferData.prepareAllocate(E));A=m.toAdd;for(E=0;E<A.length;++E)if(B=A[E],U=B.data,Q=U.id,T=t.perGeometryDataInfo[Q],null==T?(q.fillInterleaved(U,void 0,void 0,void 0,t.buffer.getArray(),r),
aa=q.getOutputAmount(H(U)),U=r/z,r+=aa,T=r/z,t.optimalCount+=aa,T={refCount:1,from:U,to:T,vao:null,instanceBufferData:null},w&&(U=C.getStride(w)/4,T.vao=new G(g,a.Default3D,{geometry:u,instance:w},{geometry:t.vao.vertexBuffers.geometry,instance:y.createVertex(g,35044)}),T.instanceBufferData=new b(U,m.perGeometryDelta[Q].addCount)),t.perGeometryDataInfo[Q]=T):++T.refCount,K(T.from*z<=t.buffer.getSize()&&T.to*z<=t.buffer.getSize()),U=S.create(),S.multiply(O,B.transformation,U),aa=J(B),U=new N(B.name,
T.from,T.to,aa,U,B.instanceParameters,B.idx,Q),t.instances[B.uniqueName]=U,this._updateHighlightFaceranges(B,U),T=T.instanceBufferData)aa=T.allocate(B.idx),T.fill(aa,0,U.transformation),T.fill(aa,16,U.transformationNormal),x&&T.fill(aa,x.offset/4,B.instanceParameters.color),p&&T.fill(aa,p.offset/4,B.instanceParameters.featureAttribute);K(t.optimalCount===m.optimalCount);q=new Float32Array(t.buffer.getArray().buffer,0,t.buffer.getSize());t.vao.vertexBuffers.geometry.setData(q);for(Q in t.perGeometryDataInfo)if(u=
t.perGeometryDataInfo[Q],u.vao&&(q=u.vao.vertexBuffers.instance))w=m.perGeometryDelta[Q],0<w.addCount+w.removeCount&&(u=u.instanceBufferData.compact(),q.setData(u))}}}};c.prototype._modifyPreinterleaved=function(c,b,d){for(var e=this._rctx,f=D.Preinterleaved,g=this._mat2DataPreinterleaved,k=0;k<c.length;k++){var l=c[k],h=l.material,n=h.id,m=l.origin.id,q=l.origin.vec3,r=g[n];null==r&&(r=this._initializeMatData(h),g[n]=r);n=r.origin2data[m];null==n&&(n={type:f,origin:q,count:0,instances:{}},r.origin2data[m]=
n);V(O,-q[0],-q[1],-q[2]);r=S.create();S.multiply(O,l.transformation,r);q=J(l);m=l.data;m.preinterleaved?null==m.vertexData?K(!1,"Trying to re-add preinterleaved geometry data which is no longer available."):(r=new N(l.name,0,m.indexCount,q,r,l.instanceParameters,l.idx,m.id),q=m.indexData?y.createIndex(e,35044,m.indexData):null,h=h.getVertexBufferLayout(),h=new G(e,a.Default3D,{geometry:h},{geometry:y.createVertex(e,35044)},q),h.vertexBuffers.geometry.setData(m.vertexData),m.vertexData=null,n.count+=
1,n.instances[l.uniqueName]={instance:r,vao:h},this._updateHighlightFaceranges(l,r)):K(!1,"Non-interleaved render geometry processed as pre-interleaved")}for(c=0;c<b.length;c++)l=b[c],q=l.origin,h=l.material,n=h.id,m=q.id,l=l.uniqueName,r=g[n],e=r.origin2data[m],e.instances[l].vao.dispose(),delete e.instances[l],--e.count,0===e.count&&delete r.origin2data[m],0===Object.keys(r.origin2data).length&&(d.push(n),delete g[n])};c.prototype._compMat2delta=function(a,c,b){var d={};this._updateMat2delta(a,
!0,b,d);this._updateMat2delta(c,!1,b,d);return d};c.prototype._updateMat2delta=function(a,c,b,d){b=b===D.Instanced;for(var e=0;e<a.length;e++){var f=a[e],g=f.origin,k=f.material,l=k.id,h=b?this._mat2DataInstanced[l]:this._mat2DataMerged[l],h=h&&h.origin2data[g.id],n=d[l];null==n&&(n={},d[l]=n);l=n[g.id];if(null==l){l={optimalCount:null==h?0:h.optimalCount,sparseCount:null==h?0:h.buffer.getSize(),material:k,toAdd:[],toRemove:[],perGeometryDelta:null,origin:g.vec3};if(b){var m={};if(void 0!==h)for(var r in h.perGeometryDataInfo)m[r]=
h.perGeometryDataInfo[r].refCount;l.dataId2refCount=m;l.perGeometryDelta={}}n[g.id]=l}g=k.getOutputAmount(H(f.data));b?(k=f.data.id,h=l.perGeometryDelta[k],h||(h={addCount:0,removeCount:0},l.perGeometryDelta[k]=h),c?(h.addCount++,null==l.dataId2refCount[k]&&(l.dataId2refCount[k]=0),1===++l.dataId2refCount[k]&&(l.optimalCount+=g,l.sparseCount+=g),l.toAdd.push(f)):(h.removeCount++,0===--l.dataId2refCount[k]&&(delete l.dataId2refCount[k],l.optimalCount-=g),l.toRemove.push(f))):c?(l.optimalCount+=g,l.sparseCount+=
g,l.toAdd.push(f)):(l.optimalCount-=g,l.toRemove.push(f))}};c.prototype._getType=function(a){if(a.data.preinterleaved)return D.Preinterleaved;var c=!1,b=H(a.data),c=(c=(c=c||!1===a.material.canBeMerged)||a.material.instanced)||!0===a.material.renderOccluded;a.singleUse||(c=c||b>this._threshold);return c?D.Instanced:D.Merged};c.prototype._getTargetMat2Data=function(a){switch(a){case D.Merged:return this._mat2DataMerged;case D.Instanced:return this._mat2DataInstanced;case D.Preinterleaved:return this._mat2DataPreinterleaved}};
c.prototype._getOriginData=function(a,c,b){return this._getTargetMat2Data(a)[c].origin2data[b]};c.prototype._modifiedMergedFacerangesKey=function(a,c){return a+"_"+c};c.prototype._insertIntoRenderOrder=function(a,c,b){for(var d=a[v.MATERIAL].materialId,e=this._renderOrder.length,f=0;f<e&&this._renderOrder[f][0]>=c;){var g=this._renderOrder[f][1];if(g.id===d){K(!g[b],"matData for type already exists");g[b]=a;return}f++}d={id:d,instanced:null,merged:null};d[b]=a;this._renderOrder.splice(f,0,[c,d])};
c.prototype._removeFromRenderOrder=function(a,c){var b=a[v.MATERIAL].materialId;for(a=0;this._renderOrder[a][1].id!==b;)a++;b=this._renderOrder[a][1];b[c]=null;b.instanced||b.merged||this._renderOrder.splice(a,1)};c.prototype._sortHighlightsByRenderOrder=function(){this._highlights.sort(function(a,c){a=a.matData[v.MATERIAL].renderPriority;c=c.matData[v.MATERIAL].renderPriority;return a>c?-1:c>a?1:0})};c.prototype._updateRenderOrder=function(a,c){for(var b=c.length,d=0;d<b&&c[d][1].id!==a;)d++;if(d<
b){a=c[d][1];a=(a.merged||a.instanced)[v.MATERIAL].renderPriority;var e=c[d][0];if(a!==c[d][0])for(c[d][0]=a,e=a>e?-1:1,d+=e;-1<d&&d<b&&e*c[d][0]>e*a;){var f=c[d];c[d]=c[d-e];c[d-e]=f;d+=e}}};c.prototype._modifyMaterials=function(a){for(var c in a)this._materialRep.updateMaterialParameters(c)};c.prototype.modifyRenderOrder=function(a){if(this._orderedRendering){for(var c in a)this._updateRenderOrder(c,this._renderOrder);this._sortHighlightsByRenderOrder();this._needsRender=!0}};c.prototype._initializeMatData=
function(a){var c={origin2data:{}};c[v.MATERIAL]=this._materialRep.aquire(a);c[v.MATERIAL_DEPTH_SHADOWMAP]=this._materialRep.aquireDepthShadowMap(a);c[v.MATERIAL_NORMAL]=this._materialRep.aquireNormal(a);c[v.MATERIAL_DEPTH]=this._materialRep.aquireDepth(a);c[v.MATERIAL_HIGHLIGHT]=this._materialRep.aquireHighlight(a);return c};c.prototype._releaseMaterials=function(a){if(Array.isArray(a))for(var c=0;c<a.length;c++)this._materialRep.release(a[c]),this._materialRep.releaseDepthShadowMap(a[c]),this._materialRep.releaseNormal(a[c]),
this._materialRep.releaseDepth(a[c]),this._materialRep.releaseHighlight(a[c]);else this._materialRep.release(a),this._materialRep.releaseDepthShadowMap(a),this._materialRep.releaseNormal(a),this._materialRep.releaseDepth(a),this._materialRep.releaseHighlight(a)};c.prototype._getInstance=function(a){var c=a.uniqueName,b=a.material.id,d=this._getType(a),b=this._getTargetMat2Data(d)[b];if(!b)return null;a=b.origin2data[a.origin.id];if(!a)return null;var e;return(e=a.type===D.Preinterleaved?a.instances[c].instance:
a.instances[c])?{type:d,uniqueName:c,instance:e,matData:b,originData:a,instancedVAO:null,instancedVAOBaseInstance:null}:null};c.prototype._createBaseInstanceVAO=function(a){var c=this._rctx,b=a.instance,d=a.originData;if(a.type===D.Instanced&&d.perGeometryDataInfo){var d=d.perGeometryDataInfo[b.dataId],e=d.instanceBufferData;e&&(d=d.vao,b=e.getSlot(b.idx),a.instancedVAOBaseInstance!==b&&(e=C.setBaseInstanceOffset(d.layout,b),a.instancedVAO=new G(c,d.locations,e,d.vertexBuffers,d.indexBuffer),a.instancedVAOBaseInstance=
b))}};c.prototype._updateHighlightVAOs=function(){for(var a=0;a<this._highlights.length;++a)this._createBaseInstanceVAO(this._highlights[a])};c.prototype._getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new E(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255])));return this._fallbackDepthStencilTexture};return c}();var R=function(){function a(){this.reset()}a.prototype.reset=
function(){this.VBOusedSize=this.VBOoptimalSize=this.VBOallocatedSize=this.instancesDrawnAngle=this.drawCallsHighlight=this.drawCallsFragmented=this.drawCallsPreinterleaved=this.drawCallsMerged=this.drawCallsAngleInstanced=this.drawCallsInstanced=this.trianglesRendered=0};return a}(),N=function(){return function(a,c,b,d,e,f,g,k){this.name=a;this.from=c;this.to=b;this.displayedIndexRange=d;this.transformation=e;this.instanceParameters=f;this.idx=g;this.dataId=k;null!=e&&(this.transformationNormal=
S.create(),S.set(e,this.transformationNormal),S.inverse(this.transformationNormal,this.transformationNormal),S.transpose(this.transformationNormal,this.transformationNormal))}}(),D;(function(a){a[a.Merged=0]="Merged";a[a.Instanced=1]="Instanced";a[a.Preinterleaved=2]="Preinterleaved"})(D||(D={}));var P=p.create(),O=S.identity(),Q=S.create(),T=S.create();return m})},"esri/views/3d/webgl-engine/lib/ExternalRendererContainer":function(){define(["require","exports","./RenderSlot"],function(p,h,d){return function(){function a(){this.renderersChanged=
!1;this.renderers=[];this.slots=[];for(var a=0;a<d.MAX_SLOTS;++a)this.slots[a]=[]}a.prototype.addRenderer=function(a,d){this.renderers.push(d);for(var f=0;f<a.length;++f)this.slots[a[f]].push(d);this.renderersChanged=!0};a.prototype.removeRenderer=function(a){this.renderers=this.renderers.filter(function(d){return d!==a});for(var d=0;d<this.slots.length;++d)this.slots[d]=this.slots[d].filter(function(d){return d!==a});this.renderersChanged=!0};a.prototype.render=function(a,d){d.slot=a;var f=0;for(a=
this.slots[a];f<a.length;f++){var g=a[f];g.render(d)&&(g.didRender=!0)}};a.prototype.needsRender=function(){if(this.renderersChanged)return!0;for(var a=0,d=this.renderers;a<d.length;a++)if(d[a].needsRender)return!0;return!1};a.prototype.needsHighlight=function(){for(var a=0,d=this.renderers;a<d.length;a++)if(d[a].needsHighlight)return!0;return!1};a.prototype.needsLinearDepth=function(){for(var a=0,d=this.renderers;a<d.length;a++)if(d[a].needsLinearDepth)return!0;return!1};a.prototype.resetNeedsRender=
function(){this.renderersChanged=!1;for(var a=0,d=this.renderers;a<d.length;a++){var k=d[a];k.resetNeedsRender?k.resetNeedsRender():k.didRender&&(k.needsRender=!1,k.didRender=!1)}};return a}()})},"esri/views/3d/webgl-engine/lib/Float32ArrayList":function(){define(["require","exports","./Util"],function(p,h,d){return function(){function a(a){null==a?a=16:65536>a&&(a=d.nextHighestPowerOfTwo(a));this.array=new Float32Array(a);this.size=0}a.prototype.resize=function(a,d){void 0===d&&(d=!1);this.size=
a;var f;if(this.size>this.array.length){for(a=this.array.length||1;a<this.size;)a*=2;f=new Float32Array(a);d&&f.set(this.array);this.array=f;return!0}if(this.size<=this.array.length/2){a=this.array.length;for(f=2*this.size;a>=f;)a=Math.floor(a/2);f=new Float32Array(a);d&&f.set(this.array.subarray(0,a));this.array=f;return!0}return!1};a.prototype.append=function(a){var d=this.size;this.resize(this.size+a.length,!0);this.array.set(a,d)};a.prototype.erase=function(a,d){for(;a<d;++a)this.array[a]=0};
a.prototype.getArray=function(){return this.array};a.prototype.getSize=function(){return this.size};return a}()})},"esri/views/3d/webgl-engine/lib/FxaaRenderPass":function(){define(["require","exports","../../../webgl/BufferObject","../../../webgl/Program","../../../webgl/VertexArrayObject"],function(p,h,d,a,g){return function(){function f(a){this.isEnabled=!1;this.vertexAttributeLocations={position:0};this.vertexBufferLayout=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=
a}f.prototype.enable=function(){if(!this.isEnabled){var f=this.rctx;this.program=new a(f,"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate \x3d (position + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(position, -1, 1);\n      }","\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x \x3d pos.x + float(off.x) * rcpFrame.x;\n        float y \x3d pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -\x3e actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN \x3d FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN \x3d FxaaLuma(rgbN);\n        float lumaW \x3d FxaaLuma(rgbW);\n        float lumaM \x3d FxaaLuma(rgbM);\n        float lumaE \x3d FxaaLuma(rgbE);\n        float lumaS \x3d FxaaLuma(rgbS);\n        float rangeMin \x3d min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax \x3d max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range \x3d rangeMax - rangeMin;\n        if (range \x3c max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL \x3d rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL \x3d (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL \x3d abs(lumaL - lumaM);\n        float blendL \x3d max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL \x3d min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL +\x3d (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *\x3d vec3(1.0/9.0);\n        float lumaNW \x3d FxaaLuma(rgbNW);\n        float lumaNE \x3d FxaaLuma(rgbNE);\n        float lumaSW \x3d FxaaLuma(rgbSW);\n        float lumaSE \x3d FxaaLuma(rgbSE);\n        float edgeVert \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan \x3d edgeHorz \x3e\x3d edgeVert;\n        float lengthSign \x3d horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN \x3d lumaW;\n          lumaS \x3d lumaE;\n        }\n        float gradientN \x3d abs(lumaN - lumaM);\n        float gradientS \x3d abs(lumaS - lumaM);\n        lumaN \x3d (lumaN + lumaM) * 0.5;\n        lumaS \x3d (lumaS + lumaM) * 0.5;\n        if (gradientN \x3c gradientS)\n        {\n          lumaN \x3d lumaS;\n          lumaN \x3d lumaS;\n          gradientN \x3d gradientS;\n          lengthSign *\x3d -1.0;\n        }\n        vec2 posN;\n        posN.x \x3d pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y \x3d pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *\x3d FXAA_SEARCH_THRESHOLD;\n        vec2 posP \x3d posN;\n        vec2 offNP \x3d horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN \x3d lumaN;\n        float lumaEndP \x3d lumaN;\n        bool doneN \x3d false;\n        bool doneP \x3d false;\n        posN +\x3d offNP * vec2(-1.0, -1.0);\n        posP +\x3d offNP * vec2( 1.0,  1.0);\n        for(int i \x3d 0; i \x3c FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN \x3d FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP \x3d FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN \x3d doneN || (abs(lumaEndN - lumaN) \x3e\x3d gradientN);\n          doneP \x3d doneP || (abs(lumaEndP - lumaN) \x3e\x3d gradientN);\n          if(doneN \x26\x26 doneP) { break; }\n          if(!doneN) {\n            posN -\x3d offNP;\n          }\n          if(!doneP) {\n            posP +\x3d offNP;\n          }\n        }\n        float dstN \x3d horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP \x3d horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN \x3d dstN \x3c dstP;\n        lumaEndN \x3d directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) \x3c 0.0) \x3d\x3d ((lumaEndN - lumaN) \x3c 0.0)) {\n          lengthSign \x3d 0.0;\n        }\n        float spanLength \x3d (dstP + dstN);\n        dstN \x3d directionN ? dstN : dstP;\n        float subPixelOffset \x3d (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF \x3d texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord \x3d fCoordinate;\n        // if (screenCoord.x \x3c 0.5) {\n          color.rgb \x3d FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x \x3c 0.501 \x26\x26 screenCoord.x \x3e 0.499) {\n        //   color.rgb \x3d vec3(1,0,0);\n        // } else {\n        //   color \x3d texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a \x3d 1.0;\n        gl_FragColor \x3d color;\n      }",
this.vertexAttributeLocations);var h=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new g(f,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new d(f,34962,35044,h)});this.isEnabled=!0}};f.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)};f.prototype.render=function(a,d){this.enable();var e=this.rctx;e.bindVAO(this.vao);e.bindFramebuffer(d);var b=0,f=0;null!=d?(b=d.descriptor.width,f=d.descriptor.height):
(b=e.gl.canvas.width,f=e.gl.canvas.height);e.bindProgram(this.program);e.bindTexture(a.colorTexture,0);this.program.setUniform1i("uColorTexture",0);this.program.setUniform2f("uRcpFrameDimension",1/b,1/f);e.setFaceCullingEnabled(!1);e.drawArrays(4,0,3)};return f}()})},"esri/views/3d/webgl-engine/lib/HighlightTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject"],function(p,h,d,a){return function(){function g(a){this._rctx=a;this.height=this.width=this.viewportToRestore=
this.fbo2=this.fbo=null}g.prototype.setEnableState=function(a){a!==this.getEnableState()&&(a?this.enable():this.disable())};g.prototype.getEnableState=function(){return null!==this.fbo};g.prototype.getHighlightFBO=function(){return this.fbo};g.prototype.getBlurFBO=function(){return this.fbo2};g.prototype.enable=function(){d.assert(!this.getEnableState());this.fbo=a.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:0,height:0},{colorTarget:0,
depthStencilTarget:1})};g.prototype.disable=function(){d.assert(this.getEnableState());this.fbo.dispose();this.fbo=null};g.prototype.setupFBOs=function(a){d.assert(this.getEnableState());this.viewportToRestore=a=a.fullViewport;this.width=a[2];this.height=a[3];this._rctx.setViewport(0,0,this.width,this.height)};g.prototype.prepareHighlightPass=function(){d.assert(this.getEnableState());var a=this._rctx,g=a.gl;this.fbo.resize(this.width,this.height);a.bindFramebuffer(this.fbo);a.setClearColor(0,0,0,
0);a.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT)};g.prototype.finish=function(a){var d=this._rctx;d.bindFramebuffer(a);d.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])};return g}()})},"esri/views/3d/webgl-engine/lib/InstanceBufferData":function(){define(["require","exports","./Util"],function(p,h,d){return function(){function a(a,f){null==f&&(f=4);var g=d.nextHighestPowerOfTwo(f*a);this.array=new Float32Array(g);this.zeroItem=
new Float32Array(a);this.endSlot=0;this.perInstanceDataSize=a;this.emptySlots=[];this.emptySlotsIdx=0;this.id2slot={};this.slot2id=Array(f)}a.prototype.prepareFree=function(a){this.emptySlots.length+=a};a.prototype.free=function(a){a=this.id2slot[a];null!=a&&(this.emptySlots[this.emptySlotsIdx++]=a,this.slot2id[a]=void 0)};a.prototype.prepareAllocate=function(a){a-=this.emptySlotsIdx;0<a&&this._resizeArray((this.endSlot+a)*this.perInstanceDataSize)};a.prototype.allocate=function(a){var d;d=0<this.emptySlotsIdx?
this.emptySlots[--this.emptySlotsIdx]:this.endSlot++;this.id2slot[a]=d;this.slot2id[d]=a;return d};a.prototype.getSlot=function(a){return this.id2slot[a]};a.prototype.getOffset=function(a){return a*this.perInstanceDataSize};a.prototype.getArray=function(){return this.array};a.prototype.fill=function(a,d,k){this.array.set(k,a*this.perInstanceDataSize+d)};a.prototype.compact=function(){if(0<this.emptySlotsIdx){this.emptySlots.length=this.emptySlotsIdx;for(this.emptySlots.sort(function(a,b){return a-
b});0<this.emptySlotsIdx&&this.emptySlots[this.emptySlotsIdx-1]===this.endSlot;)this.emptySlotsIdx--,this.endSlot--;for(;0<this.emptySlotsIdx;){this.emptySlotsIdx--;var a=this.endSlot-1,d=this.emptySlots[this.emptySlotsIdx],k=a*this.perInstanceDataSize,h=d*this.perInstanceDataSize;this.array.set(this.array.subarray(k,k+this.perInstanceDataSize),h);this.array.set(this.zeroItem,k);k=this.slot2id[a];this.slot2id[a]=void 0;this.slot2id[d]=k;this.id2slot[k]=d;this.endSlot--}}this._resizeArray(this.endSlot*
this.perInstanceDataSize);this.emptySlots.length=0;return this.array};a.prototype._resizeArray=function(a){var d;if(a>this.array.length){for(d=this.array.length||1;d<a;)d*=2;a=new Float32Array(d);a.set(this.array);this.array=a}else if(a<=this.array.length/2){d=this.array.length;for(a*=2;d>=a;)d/=2;a=new Float32Array(d);a.set(this.array.subarray(0,d));this.array=a}};return a}()})},"esri/views/3d/webgl-engine/lib/IntervalUtilities":function(){define(["require","exports"],function(p,h){return function(){function d(){}
d.copyIntervals=function(a){for(var d=[],f=0;f<a.length;f++){var k=a[f];d.push([k[0],k[1]])}return d};d.convertFaceToIndexRange=function(a,d){for(var f=0;f<a.length;f++){var g=a[f];g[0]*=d;g[1]=g[1]*d+(d-1)}};d.sortIntervals=function(a){return a.sort(function(a,d){return a[0]===d[0]?a[1]>d[1]?1:a[1]<d[1]?-1:0:a[0]>d[0]?1:a[0]<d[0]?-1:0})};d.intersectIntervals=function(a,d){if(0>=a.length)return[];for(var f=[],g=0;g<a.length;g++){var h=a[g];h[1]<d[0]||h[0]>d[1]||(h=[h[0],h[1]],h[0]<d[0]&&(h[0]=d[0]),
h[1]>d[1]&&(h[1]=d[1]),f.push(h))}return f};d.mergeIntervals=function(a){if(0>=a.length)return[];var d=[];a=this.sortIntervals(a);d.push(a[0]);for(var f=1;f<a.length;f++){var k=d[d.length-1];k[1]+1<a[f][0]?d.push(a[f]):k[1]<a[f][1]&&(k[1]=a[f][1],d.pop(),d.push(k))}return d};d.invertIntervals=function(a,d){for(var f=[],g=0,h=0;h<a.length;h++){var e=a[h];e[0]>g&&f.push([g,e[0]-1]);g=e[1]+1}g<=d&&f.push([g,d]);return f};d.offsetIntervals=function(a,d){for(var f=[],g=0;g<a.length;g++){var h=a[g];f.push([h[0]+
d,h[1]+d])}return f};return d}()})},"esri/views/3d/webgl-engine/lib/LinearDepthTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject"],function(p,h,d,a){return function(){function g(a){this._rctx=a;this._depthFBO=void 0;this.height=this.width=this.viewportToRestore=null}g.prototype.setEnableState=function(a){a!==this.getEnableState()&&(a?this.enable():this.disable())};g.prototype.getEnableState=function(){return void 0!==this._depthFBO};g.prototype.getDepthFBO=
function(){return this._depthFBO};g.prototype.enable=function(){d.assert(!this.getEnableState());this._depthFBO=a.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:3})};g.prototype.disable=function(){d.assert(this.getEnableState());this._depthFBO.dispose();this._depthFBO=void 0};g.prototype.setupFBOs=function(a){d.assert(this.getEnableState());this.viewportToRestore=a=a.fullViewport;this.width=
a[2];this.height=a[3];this._rctx.setViewport(0,0,this.width,this.height)};g.prototype.prepareDepthPass=function(){d.assert(this.getEnableState());var a=this._rctx,g=a.gl;this._depthFBO.resize(this.width,this.height);a.bindFramebuffer(this._depthFBO);a.setClearStencil(0);a.setClearColor(0,0,0,0);a.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT|g.STENCIL_BUFFER_BIT);a.setBlendingEnabled(!1)};g.prototype.finish=function(a){var d=this._rctx;d.bindFramebuffer(a);d.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],
this.viewportToRestore[2],this.viewportToRestore[3])};return g}()})},"esri/views/3d/webgl-engine/lib/NormalTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject"],function(p,h,d,a){return function(){function g(a){this.rctx=a;this.normalFBO=void 0;this.height=this.width=this.viewportToRestore=null}g.prototype.setEnableState=function(a){a!==this.getEnableState()&&(a?this.enable():this.disable())};g.prototype.getEnableState=function(){return void 0!==this.normalFBO};
g.prototype.getNormalFBO=function(){return this.normalFBO};g.prototype.enable=function(){d.assert(!this.getEnableState());this.normalFBO=a.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1})};g.prototype.disable=function(){d.assert(this.getEnableState());this.normalFBO.dispose();this.normalFBO=void 0};g.prototype.setupFBOs=function(a){d.assert(this.getEnableState());this.viewportToRestore=
a=a.viewport;this.width=a[2];this.height=a[3];this.rctx.setViewport(0,0,this.width,this.height)};g.prototype.prepareNormalPass=function(){d.assert(this.getEnableState());var a=this.rctx,g=a.gl;this.normalFBO.resize(this.width,this.height);a.bindFramebuffer(this.normalFBO);a.setClearColor(0,0,0,0);a.clear(g.COLOR_BUFFER_BIT|g.DEPTH_BUFFER_BIT)};g.prototype.finish=function(a){var d=this.rctx;d.bindFramebuffer(a);d.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],
this.viewportToRestore[3])};return g}()})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["require","exports","./RenderPass","./RenderSlot"],function(p,h,d,a){return function(){function g(){this.normals=this.lightingData=this.highlight=this.depth=this.camera=null;this.pass=d.MATERIAL;this.shadowMap=null;this.slot=a.BACKGROUND;this.options=this.rctx=this.framebufferTex=this.stencilRenderingHelper=this.offscreenRenderingHelper=this.ssaoHelper=null;this.renderOccludedOnly=!1}Object.defineProperty(g.prototype,
"isHighlightPass",{get:function(){return this.pass===d.MATERIAL_HIGHLIGHT},enumerable:!0,configurable:!0});return g}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../support/imageUtils ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(p,h,d,a,g,f,k,m){var e=null;return function(){function b(a){this.isEnabled=this._isLoadingResources=!1;this.vertexAttributeLocations=
{vPosition:0};this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}b.prototype.loadResources=function(a){var b=this;return e?!0:(this._isLoadingResources=!0,p(["./SmaaRenderPassData"],function(d){e=d;b._isLoadingResources=!1;a&&a()}),!1)};Object.defineProperty(b.prototype,"isLoadingResources",{get:function(){return this._isLoadingResources},enumerable:!0,configurable:!0});b.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;
var b=this.rctx;this.programEdgeDetect=new f(b,e.edgeDetectShader.vertex,e.edgeDetectShader.fragment,this.vertexAttributeLocations);this.programBlendWeights=new f(b,e.blendWeightShader.vertex,e.blendWeightShader.fragment,this.vertexAttributeLocations);this.programBlur=new f(b,e.blurShader.vertex,e.blurShader.fragment,this.vertexAttributeLocations);var d=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new m(b,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new a(b,34962,35044,
d)});this.tmpFramebufferEdges=g.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.tmpFramebufferBlend=g.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.textureArea=this.loadTextureFromBase64(e.areaTexture,9729,6407);this.textureSearch=this.loadTextureFromBase64(e.searchTexure,
9728,6409);return this.isEnabled=!0};b.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=
null,this.isEnabled=!1)};b.prototype.render=function(a,b){this.enable();var d=this.rctx,e=0,f=0;null!=b?(e=b.descriptor.width,f=b.descriptor.height):(e=d.gl.canvas.width,f=d.gl.canvas.height);d.bindVAO(this.vao);d.setFaceCullingEnabled(!0);d.setCullFace(1029);d.setFrontFace(2305);d.setBlendingEnabled(!1);d.setDepthTestEnabled(!1);d.setViewport(0,0,e,f);this.tmpFramebufferEdges.resize(e,f);d.bindFramebuffer(this.tmpFramebufferEdges);d.setClearColor(0,0,0,1);d.clear(d.gl.COLOR_BUFFER_BIT);d.bindProgram(this.programEdgeDetect);
d.bindTexture(a.colorTexture,0);this.programEdgeDetect.setUniform1i("tColor",0);this.programEdgeDetect.setUniform4f("uResolution",1/e,1/f,e,f);d.drawArrays(4,0,3);this.tmpFramebufferBlend.resize(e,f);d.bindFramebuffer(this.tmpFramebufferBlend);d.setClearColor(0,0,1,1);d.clear(d.gl.COLOR_BUFFER_BIT);d.bindProgram(this.programBlendWeights);this.programBlendWeights.setUniform4f("uResolution",1/e,1/f,e,f);d.bindTexture(this.textureSearch,1);this.programBlendWeights.setUniform1i("tSearch",1);d.bindTexture(this.textureArea,
2);this.programBlendWeights.setUniform1i("tArea",2);d.bindTexture(this.tmpFramebufferEdges.colorTexture,3);this.programBlendWeights.setUniform1i("tEdges",3);d.drawArrays(4,0,3);d.bindFramebuffer(b);d.setClearColor(0,1,0,1);d.clear(d.gl.COLOR_BUFFER_BIT);d.bindProgram(this.programBlur);this.programBlur.setUniform4f("uResolution",1/e,1/f,e,f);d.bindTexture(a.colorTexture,0);this.programBlur.setUniform1i("tColor",0);d.bindTexture(this.tmpFramebufferBlend.colorTexture,1);this.programBlur.setUniform1i("tBlendWeights",
1);d.drawArrays(4,0,3);d.setDepthTestEnabled(!0)};b.prototype.loadTextureFromBase64=function(a,b,e){var f=new k(this.rctx,{pixelFormat:e,dataType:5121,wrapMode:33071,samplingMode:b},null);d.requestImage(a).then(function(a){f.resize(a.width,a.height);f.setData(a)});return f};return b}()})},"esri/views/3d/webgl-engine/lib/StencilRenderingHelper":function(){define(["require","exports","./Util"],function(p,h,d){return function(){function a(a){this._enabled=!1;this._rctx=a}a.prototype.enable=function(){this._enabled=
!0;this._rctx.setStencilTestEnabled(!0)};a.prototype.disable=function(){this._enabled=!1;this._rctx.setStencilTestEnabled(!1)};a.prototype.getIsSupported=function(){return!!this._rctx.contextAttributes.stencil};a.prototype.setEnableState=function(a){a?this.enable():this.disable()};a.prototype.getEnableState=function(){return this._enabled};a.prototype.prepareStencilWritePass=function(){d.assert(this.getEnableState());var a=this._rctx;a.setStencilFunction(519,1,255);a.setStencilOp(7680,7680,7681);
a.setStencilWriteMask(255)};a.prototype.finish=function(){if(this.getEnableState()){var a=this._rctx;a.setStencilFunction(519,0,0);a.setStencilOp(7680,7680,7680)}};a.prototype.enableStencilRead=function(){this.getEnableState()&&this._rctx.setStencilFunction(517,1,255)};a.prototype.disableStencilRead=function(){this.getEnableState()&&this._rctx.setStencilFunction(519,0,0)};return a}()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/arrayUtils ../../../lib/glMatrix ../../../support/meshProcessing ../../../support/buffer/BufferView ../../../support/buffer/InterleavedLayout ../../../support/buffer/typedArrayUtil ../localOriginHelper ../LocalOriginManager ../PreinterleavedGeometryData ../RegularGridLocalOriginFactory ../Util ../TextureBackedBuffer/BufferManager ./EdgeRenderer ./RibbonEdgeRenderer ./strokes".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function h(a,c){this.rctx=a;this.programRepository=c;this.debugSettings={antialiasing:!0,receiveShadows:!0};this.profilingCallback=null;this.gpuMemoryUsage=0;this.geometries=new Map;this.renderers=new Map;this.localOrigins=new l.LocalOriginManager(new u(1E4));this.tmpModelPosition=g.vec3d.create();this.tmpCameraPosition=g.vec3d.create();this.componentColorManager=new v.BufferManager(this.rctx)}
h.isSupported=function(a){return!!a.capabilities.instancing};h.prototype.computeModelTransformWithLocalOrigin=function(a,c,d){a.getCombinedStaticTransformation(c,d);c.origin?this.localOrigins.register(c.origin):(a=g.vec3d.set3(d[12],d[13],d[14],this.tmpModelPosition),c.origin=this.localOrigins.aquire(a));b.applyToModelMatrix(c.origin.vec3,d);return d};h.prototype.selectIndexData=function(a,c){if(c){c=e.slice(c);for(var b=0;b<c.length;b++)c[b]=a[c[b]];return c}return a};h.prototype.assignPerComponentAttributes=
function(a,c,b,d){for(var e=[],f=this.componentColorManager.getBuffer(c.length),g=!1,k=null,l=null,h=null,n=0;n<c.length;n++){var m=c[n],q=m.color,r=255*q[0],t=255*q[1],v=255*q[2],u=255*q[3],q=f.aquireIndex();e.push({index:q,material:m});f.textureBuffer.setData(q,r,t,v,u);t=b[n];r=b[n+1];null!=k&&k!==m.size&&(g=!0);null!=h&&h!==m.extensionLength&&(g=!0);null!=l&&l!==m.type&&(g=!0);k=m.size;l=m.type;h=m.extensionLength;m=void 0;switch(l){case "solid":m=0;break;case "sketch":m=1}if(d)for(;t<r;t++)v=
d[t],a.colorIndexBuffer.set(v,q),a.lineWidthBuffer.set(v,k),a.extensionsBuffer.set(v,h),a.typeBuffer.set(v,m);else for(;t<r;t++)a.colorIndexBuffer.set(t,q),a.lineWidthBuffer.set(t,k),a.extensionsBuffer.set(t,h),a.typeBuffer.set(t,m)}return{components:e,componentColorBuffer:f,requiresUberRenderer:g}};h.prototype.extractEdgeInformation=function(a,b){a=f.deduplicate(a.buffer,a.stride/4);b=this.selectIndexData(a.indices,b);var d=f.computeNeighbors(b,a.uniqueCount);return{faces:b,neighbors:d,vertices:c.createView(a.buffer)}};
h.prototype.addGeometryNonPreinterleaved=function(a,c,b,d,e){var f=b.getAttribute("position"),k=this.computeModelTransformWithLocalOrigin(a,d,g.mat4d.create());d=d.origin;b={position:f,indices:b.getIndices("position"),modelTransform:k,origin:d};a=this.addNonPreinterleaved(a,b,e);this.geometries.set(c,a)};h.prototype.addNonPreinterleaved=function(a,b,d){for(var e=b.position,f=e.data.length/e.strideIdx,g=new k.BufferViewVec3f64((new Float64Array(3*f)).buffer),l=0;l<f;l++)g.set(l,0,e.data[e.offsetIdx+
l*e.strideIdx+0]),g.set(l,1,e.data[e.offsetIdx+l*e.strideIdx+1]),g.set(l,2,e.data[e.offsetIdx+l*e.strideIdx+2]);e=c.createBuffer(g.count);for(l=0;l<g.count;l++)e.position.set(l,0,g.get(l,0)),e.position.set(l,1,g.get(l,1)),e.position.set(l,2,g.get(l,2));var l=this.assignPerComponentAttributes({colorIndexBuffer:e.componentIndex,lineWidthBuffer:e.lineWidth,typeBuffer:e.type,extensionsBuffer:e.extensions},[d],[0,e.componentIndex.count]),g=l.components,l=l.componentColorBuffer,f=this.extractEdgeInformation(e,
b.indices),h={modelTransform:b.modelTransform,origin:b.origin,componentBuffer:l};b=this.getRendererInfo(d);e=b.renderer;d=e.createInstance(h,f,d);a={renderInstance:d,object:a,visible:!0,components:g,componentColorBuffer:l,distanceToCamera:0};this.gpuMemoryUsage+=d.gpuMemoryUsage;b.objects.add(a);return{objectData:a,renderer:e}};h.prototype.addGeometryPreinterleaved=function(a,b,d,e,f){var l=d.getAttribute("position");if(l&&l.data instanceof Float32Array){for(var h=this.computeModelTransformWithLocalOrigin(a,
e,g.mat4d.create()),n=e.origin,m=d.getIndices("position"),l=new k.BufferViewVec3f(l.data.buffer,4*l.offsetIdx,4*l.strideIdx),q=c.createBuffer(l.count),r=0;r<l.count;r++)q.position.set(r,0,l.get(r,0)),q.position.set(r,1,l.get(r,1)),q.position.set(r,2,l.get(r,2));r=this.assignPerComponentAttributes({colorIndexBuffer:q.componentIndex,lineWidthBuffer:q.lineWidth,extensionsBuffer:q.extensions,typeBuffer:q.type},f,d.componentOffsets,m);d=r.components;l=r.componentColorBuffer;r=r.requiresUberRenderer;m=
this.extractEdgeInformation(q,m);h={modelTransform:h,origin:n,componentBuffer:l};q=r?null:f[0];f=this.getRendererInfo(q);n=f.renderer;h=n.createInstance(h,m,q);a={renderInstance:h,object:a,visible:!a.isHidden(e),components:d,componentColorBuffer:l,distanceToCamera:0};this.gpuMemoryUsage+=h.gpuMemoryUsage;this.geometries.set(b,{renderer:n,objectData:a});f.objects.add(a)}else console.warn("Geometry has no float32 `position` attribute, skipping it.")};h.prototype.addObject=function(a,c,b){if(b&&b.mergeGeometries&&
1<a.geometries.length)this.addObjectMergedGeometries(a,c);else for(b=0;b<a.geometries.length;b++){var d=a.geometries[b],e=a.geometryRecords[b];e.materials[0].supportsEdges&&(d.data instanceof t?this.addGeometryPreinterleaved(a,d,d.data,e,c):this.addGeometryNonPreinterleaved(a,d,d.data,e,c[0]))}};h.prototype.addObjectMergedGeometries=function(a,c){for(var b=new Map,d=0,e=null,f=null,k=null,l=0;l<a.geometries.length;l++){var h=a.geometries[l],n=a.geometryRecords[l],m=n.materials[0];if(m.supportsEdges){if(h.data instanceof
t)return console.error("Cannot merge geometries with pre interleaved geometry data"),this.addObject(a,c);if(!f)f=n.transformation;else if(!r.arraysEqual(f,n.transformation))return console.error("Cannot merge geometries with differing geometry transforms"),this.addObject(a,c);if(!k&&n.origin)k=n;else if(k&&n.origin&&k.origin.id!==n.origin.id)return console.error("Cannot merge geometries with differing origins"),this.addObject(a,c);h=h.data.getIndices("position");d+=h?h.length:0;if(h&&null==e||e===
Uint16Array)e=h instanceof Uint16Array?Uint16Array:Uint32Array}}d=d?new e(d):null;e=[];for(l=f=0;l<a.geometries.length;l++)if(h=a.geometries[l],m=a.geometryRecords[l].materials[0],m.supportsEdges){m=h.data.getAttribute("position");h=h.data.getIndices("position");n=b.get(m.data);if(null==n){for(var n=e.length/3,q=m.offsetIdx;q<m.data.length;q+=m.strideIdx)e.push(m.data[q+0]),e.push(m.data[q+1]),e.push(m.data[q+2]);b.set(m.data,n)}if(h)for(m=0;m<h.length;m++)d[f++]=n+h[m]}l=k||a.geometryRecords[0];
b=this.computeModelTransformWithLocalOrigin(a,l,g.mat4d.create());k=l.origin;for(l=0;l<a.geometryRecords.length;l++)a.geometryRecords[l].origin=k;c=this.addNonPreinterleaved(a,{position:{data:e,offsetIdx:0,strideIdx:3},indices:d,modelTransform:b,origin:k},c[0]);this.geometries.set(a.geometries[0],c)};h.prototype.hasObject=function(a){return this.geometries.has(a.geometries[0])};h.prototype.updateComponentColor=function(a,c,b){for(var d=0;d<a.geometries.length;d++){var e=this.geometries.get(a.geometries[d]);
if(!e)break;e=e.objectData;e.componentColorBuffer.textureBuffer.setData(e.components[c].index,255*b[0],255*b[1],255*b[2],255*b[3])}};h.prototype.updateComponentOpacity=function(a,c,b){for(var d=0;d<a.geometries.length;d++){var e=this.geometries.get(a.geometries[d]);if(!e)break;e=e.objectData;e.componentColorBuffer.textureBuffer.setDataElement(e.components[c].index,3,255*b)}};h.prototype.updateObjectVisibility=function(a,c){for(var b=0;b<a.geometries.length;b++){var d=this.geometries.get(a.geometries[b]);
if(!d)break;d.objectData.visible=c}};h.prototype.getComponentMaterial=function(a,c){if(a=this.geometries.get(a.geometries[0]))return a.objectData.components[c].material};h.prototype.removeObject=function(a){for(var c=0;c<a.geometries.length;c++){var b=a.geometries[c],d=this.geometries.get(b);d&&(this.removeGeometry(d),this.geometries.delete(b))}};h.prototype.removeGeometry=function(a){var c=a.objectData,b=this.renderers.get(a.renderer.key);b.objects.delete(a.objectData);this.localOrigins.release(c.renderInstance.origin);
a.renderer.disposeInstance(c.renderInstance);this.gpuMemoryUsage-=c.renderInstance.gpuMemoryUsage;for(var d=0,e=c.components;d<e.length;d++)c.componentColorBuffer.releaseIndex(e[d].index);0===b.objects.size&&(this.renderers.delete(b.renderer.key),a.renderer.dispose())};h.prototype.removeAll=function(){var a=this;this.geometries.forEach(function(c){a.removeGeometry(c)});this.geometries.clear()};h.prototype.createSolidEdgeMaterial=function(a){return d({},x,a,{type:"solid"})};h.prototype.createSketchEdgeMaterial=
function(a){return d({},z,a,{type:"sketch"})};h.prototype.estimateLengthAtDistance=function(a,c,b){return b/a.fullWidth*c*2*Math.tan(.5*a.fovX)};h.prototype.render=function(a,c){var b=this;this.localOrigins.updateViewMatrices(c.view);this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();var d=c.view,e=0;this.geometries.forEach(function(a){e+=a.objectData.renderInstance.averageEdgeLength});var f={distanceFalloffFactor:e/this.geometries.size*40,minimumEdgeLength:this.estimateLengthAtDistance(a,
1,3.5)};(a=this.rctx.capabilities.blendMinMax)?(this.rctx.setDepthWriteEnabled(!1),this.rctx.setBlendingEnabled(!0),this.rctx.setBlendEquationSeparate(32774,a.MAX),this.rctx.setBlendFunctionSeparate(1,0,1,1)):(this.rctx.setDepthWriteEnabled(!0),this.rctx.setBlendingEnabled(!1));this.rctx.setDepthTestEnabled(!0);this.rctx.setDepthFunction(515);this.updateObjectCameraDistances(c);this.renderers.forEach(function(a){var d=a.renderer;a=a.objects;d.begin(c);b.renderEdges(d,a,c,f);b.renderSilhouettes(d,
a,c,f);d.end(c)});this.rctx.setDepthWriteEnabled(!0);this.rctx.setDepthFunction(513);this.rctx.setBlendEquationSeparate(32774,32774);this.rctx.setBlendFunctionSeparate(1,0,1,1);c.view=d};Object.defineProperty(h.prototype,"compositingMode",{get:function(){return"alpha"},enumerable:!0,configurable:!0});h.prototype.updateObjectCameraDistances=function(a){var c=this;a=a.viewInvTransp;g.vec3d.set3(a[3],a[7],a[11],this.tmpCameraPosition);this.renderers.forEach(function(a){a.objects.forEach(function(a){a.distanceToCamera=
g.vec3d.dist(a.object.getCenter(),c.tmpCameraPosition)})})};h.prototype.findLowerBoundIndex=function(c,b){var d=a.binaryIndexOf(c,b,!0);return-1===d?b<c[0]?0:c.length:d};h.prototype.computeEdgeCount=function(a,c,b){return a.length-this.findLowerBoundIndex(a,c*b.minimumEdgeLength)};h.prototype.renderEdges=function(a,c,b,d){var e=this;a.bindEdges(b,d);c.forEach(function(c){if(c.visible){var f=e.computeEdgeCount(c.renderInstance.edgeLoD.lengths,c.distanceToCamera,d);b.view=e.localOrigins.getViewMatrix(c.renderInstance.origin);
a.renderEdges(c.renderInstance,b,f)}})};h.prototype.renderSilhouettes=function(a,c,b,d){var e=this;a.bindSilhouettes(b,d);c.forEach(function(c){if(c.visible){var f=e.computeEdgeCount(c.renderInstance.silhouetteLoD.lengths,c.distanceToCamera,d);b.view=e.localOrigins.getViewMatrix(c.renderInstance.origin);a.renderSilhouettes(c.renderInstance,b,f)}})};h.prototype.rendererClassCreator=function(a){var c=this.debugSettings,b=c.antialiasing,c=c.receiveShadows;this.strokesTexture||(this.strokesTexture=w.generateStrokesTexture(this.rctx));
var e={antialiasing:b,receiveShadows:c,strokesTexture:this.strokesTexture};return a?{create:function(a,c,b){return new n.default(a,c,b,d({},e,{uber:!1}))},key:n.default.getKey(a)}:{create:function(a,c,b){return new n.default(a,c,null,d({},e,{uber:!0}))},key:n.default.getKey(a)}};h.prototype.getRendererInfo=function(a){var c=this.rendererClassCreator(a),b=this.renderers.get(c.key);if(b)return b;a=c.create(this.rctx,this.programRepository,a);b=new Set;a={renderer:a,objects:b};this.renderers.set(c.key,
a);return a};h.loadShaders=function(a,c,b){q.default.loadShaders(a,c,b);n.default.loadShaders(a,c,b)};h.prototype.getGpuMemoryUsage=function(){return this.gpuMemoryUsage/1048576};return h}();h.EdgeView=p;var c=m.newLayout().vec3f("position").u16("componentIndex").u8("lineWidth").u8("type").i8("extensions").vec2u8("_padding",{glPadding:!0}).u8("_padding2",{glPadding:!0}),x={color:g.vec4d.createFrom(0,0,0,.2),size:1,extensionLength:0},z={color:g.vec4d.createFrom(0,0,0,.2),size:1,extensionLength:0}})},
"esri/views/3d/support/meshProcessing":function(){define(["require","exports","../webgl-engine/lib/Util"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});h.computeNeighbors=function(a,d){for(var f=a.length/3,g=new Uint32Array(d+1),e=new Uint32Array(d+1),b=function(a,c){a<c?g[a+1]++:e[c+1]++},l=0;l<f;l++){var h=a[3*l],u=a[3*l+1],r=a[3*l+2];b(h,u);b(u,r);b(r,h)}for(l=u=h=0;l<d;l++)r=g[l+1],b=e[l+1],g[l+1]=h,e[l+1]=u,h+=r,u+=b;for(var v=new Uint32Array(6*f),q=g[d],b=function(a,c,b){if(a<
c){var d=g[a+1]++;v[2*d]=c;v[2*d+1]=b}else d=e[c+1]++,v[2*q+2*d]=a,v[2*q+2*d+1]=b},l=0;l<f;l++)h=a[3*l],u=a[3*l+1],r=a[3*l+2],b(h,u,l),b(u,r,l),b(r,h,l);h=function(a,c){var b=2*a;a=c-a;for(c=1;c<a;c++){var d=v[b+2*c],e=v[b+2*c+1],f=c-1;for(f;0<=f&&v[b+2*f]>d;f--)v[b+2*f+2]=v[b+2*f],v[b+2*f+3]=v[b+2*f+1];v[b+2*f+2]=d;v[b+2*f+3]=e}};for(l=0;l<d;l++)h(g[l],g[l+1]),h(q+e[l],q+e[l+1]);for(var n=new Int32Array(3*f),w=function(c,b){return c===a[3*b]?0:c===a[3*b+1]?1:c===a[3*b+2]?2:-1},f=function(a,c){a=
w(a,c);n[3*c+a]=-1},h=function(a,c,b,d){a=w(a,c);n[3*c+a]=d;b=w(b,d);n[3*d+b]=c},l=0;l<d;l++){for(var u=g[l],r=g[l+1],b=e[l],c=e[l+1];u<r&&b<c;){var x=v[2*u],p=v[2*q+2*b];x===p?(h(l,v[2*u+1],p,v[2*q+2*b+1]),u++,b++):x<p?(f(l,v[2*u+1]),u++):(f(p,v[2*q+2*b+1]),b++)}for(;u<r;)f(l,v[2*u+1]),u++;for(;b<c;)p=v[2*q+2*b],f(p,v[2*q+2*b+1]),b++}return n};var a=null;h.deduplicate=function(g,f,k,h,e){void 0===k&&(k=0);void 0===h&&(h=0);void 0===e&&(e=g.byteLength/(4*f));g=new Uint32Array(g,h,e*f);h=new Uint32Array(e);
var b=Math.floor(1.1*e)+1;if(null==a||a.length<2*b)a=new Uint32Array(d.nextHighestPowerOfTwo(2*b));for(var l=0;l<2*b;l++)a[l]=0;for(var m=0,u=0!==k?Math.ceil(7.84*1.96/(k*k)*k*(1-k)):e,l=0;l<e;l++){if(l===u){var r=1-m/l;if(r+1.96*Math.sqrt(r*(1-r)/l)<k)return null;u*=2}for(var r=l*f,v,q=v=0;q<f;q++)v=g[r+q]+v|0,v=v+(v<<11)+(v>>>2)|0;v>>>=0;for(var q=v%b,n=m;0!==a[2*q+1];){if(a[2*q]===v){var w=a[2*q+1]-1,c=w*f;a:{for(var x=0;x<f;x++)if(g[r+x]!==g[c+x]){c=!1;break a}c=!0}if(c){n=h[w];break}}q++;q>=
b&&(q-=b)}n===m&&(a[2*q]=v,a[2*q+1]=l+1,m++);h[l]=n}if(0!==k&&1-m/e<k)return null;k=new Uint32Array(f*m);for(l=m=0;l<e;l++)if(h[l]===m){b=g;u=l*f;r=k;v=m*f;q=f;for(n=0;n<q;n++)r[v+n]=b[u+n];m++}return{buffer:k.buffer,indices:h,uniqueCount:m}}})},"esri/views/3d/support/buffer/BufferView":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./internals/Mat4 ./internals/Single ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(p,h,d,a,g,f,k,m){Object.defineProperty(h,
"__esModule",{value:!0});p=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Float32Array,b,d,e)||this}d(b,a);b.ElementType="f32";return b}(g.BufferViewSingle);h.BufferViewFloat=p;p=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Float32Array,b,d,e)||this}d(b,a);b.ElementType="f32";return b}(f.BufferViewVec2);h.BufferViewVec2f=p;p=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Float32Array,b,d,e)||this}d(b,a);b.ElementType="f32";return b}(k.BufferViewVec3);
h.BufferViewVec3f=p;p=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Float32Array,b,d,e)||this}d(b,a);b.ElementType="f32";return b}(m.BufferViewVec4);h.BufferViewVec4f=p;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Float32Array,b,d,e)||this}d(b,a);b.ElementType="f32";return b}(a.BufferViewMat4);h.BufferViewMat4f=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Float64Array,b,d,e)||this}d(b,a);b.ElementType="f64";return b}(g.BufferViewSingle);
h.BufferViewFloat64=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Float64Array,b,d,e)||this}d(b,a);b.ElementType="f64";return b}(f.BufferViewVec2);h.BufferViewVec2f64=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Float64Array,b,d,e)||this}d(b,a);b.ElementType="f64";return b}(k.BufferViewVec3);h.BufferViewVec3f64=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Float64Array,b,d,e)||this}d(b,a);b.ElementType="f64";return b}(m.BufferViewVec4);
h.BufferViewVec4f64=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Uint8Array,b,d,e)||this}d(b,a);b.ElementType="u8";return b}(g.BufferViewSingle);h.BufferViewUint8=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Uint8Array,b,d,e)||this}d(b,a);b.ElementType="u8";return b}(f.BufferViewVec2);h.BufferViewVec2u8=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Uint8Array,b,d,e)||this}d(b,a);b.ElementType="u8";return b}(k.BufferViewVec3);
h.BufferViewVec3u8=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Uint8Array,b,d,e)||this}d(b,a);b.ElementType="u8";return b}(m.BufferViewVec4);h.BufferViewVec4u8=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Uint16Array,b,d,e)||this}d(b,a);b.ElementType="u16";return b}(g.BufferViewSingle);h.BufferViewUint16=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Uint16Array,b,d,e)||this}d(b,a);b.ElementType="u16";return b}(f.BufferViewVec2);
h.BufferViewVec2u16=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Uint16Array,b,d,e)||this}d(b,a);b.ElementType="u16";return b}(k.BufferViewVec3);h.BufferViewVec3u16=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Uint16Array,b,d,e)||this}d(b,a);b.ElementType="u16";return b}(m.BufferViewVec4);h.BufferViewVec4u16=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Uint32Array,b,d,e)||this}d(b,a);b.ElementType="u32";return b}(g.BufferViewSingle);
h.BufferViewUint32=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Uint32Array,b,d,e)||this}d(b,a);b.ElementType="u32";return b}(f.BufferViewVec2);h.BufferViewVec2u32=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Uint32Array,b,d,e)||this}d(b,a);b.ElementType="u32";return b}(k.BufferViewVec3);h.BufferViewVec3u32=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Uint32Array,b,d,e)||this}d(b,a);b.ElementType="u32";return b}(m.BufferViewVec4);
h.BufferViewVec4u32=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Int8Array,b,d,e)||this}d(b,a);b.ElementType="i8";return b}(g.BufferViewSingle);h.BufferViewInt8=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Int8Array,b,d,e)||this}d(b,a);b.ElementType="i8";return b}(f.BufferViewVec2);h.BufferViewVec2i8=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Int8Array,b,d,e)||this}d(b,a);b.ElementType="i8";return b}(k.BufferViewVec3);
h.BufferViewVec3i8=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Int8Array,b,d,e)||this}d(b,a);b.ElementType="i8";return b}(m.BufferViewVec4);h.BufferViewVec4i8=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Int16Array,b,d,e)||this}d(b,a);b.ElementType="i16";return b}(g.BufferViewSingle);h.BufferViewInt16=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Int16Array,b,d,e)||this}d(b,a);b.ElementType="i16";return b}(f.BufferViewVec2);
h.BufferViewVec2i16=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Int16Array,b,d,e)||this}d(b,a);b.ElementType="i16";return b}(k.BufferViewVec3);h.BufferViewVec3i16=a;a=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Int16Array,b,d,e)||this}d(b,a);b.ElementType="i16";return b}(m.BufferViewVec4);h.BufferViewVec4i16=a;g=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Int32Array,b,d,e)||this}d(b,a);b.ElementType="i32";return b}(g.BufferViewSingle);
h.BufferViewInt32=g;f=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Int32Array,b,d,e)||this}d(b,a);b.ElementType="i32";return b}(f.BufferViewVec2);h.BufferViewVec2i32=f;k=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Int32Array,b,d,e)||this}d(b,a);b.ElementType="i32";return b}(k.BufferViewVec3);h.BufferViewVec3i32=k;m=function(a){function b(b,d,e){void 0===d&&(d=0);return a.call(this,Int32Array,b,d,e)||this}d(b,a);b.ElementType="i32";return b}(m.BufferViewVec4);
h.BufferViewVec4i32=m})},"esri/views/3d/support/buffer/internals/Mat4":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function d(a,d,f,k){void 0===f&&(f=0);a=this.TypedArrayConstructor=a;void 0===k&&(k=4*a.BYTES_PER_ELEMENT);this.data=new a(d,0===d.byteLength?0:f);this.elementStride=k/a.BYTES_PER_ELEMENT}d.prototype.getMat=function(a,d){a*=this.elementStride;for(var f=0;16>f;f++)d[f]=this.data[a+f];return d};d.prototype.setMat=function(a,
d){a*=this.elementStride;for(var f=0;16>f;f++)this.data[a+f]=d[f]};d.prototype.get=function(a,d){return this.data[a*this.elementStride+d]};d.prototype.set=function(a,d,f){this.data[a*this.elementStride+d]=f};Object.defineProperty(d.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});d.ElementCount=16;return d}();h.BufferViewMat4=p})},"esri/views/3d/support/buffer/internals/Single":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function d(a,d,f,k){void 0===f&&(f=0);a=this.TypedArrayConstructor=
a;void 0===k&&(k=a.BYTES_PER_ELEMENT);this.data=new a(d,0===d.byteLength?0:f);this.elementStride=k/a.BYTES_PER_ELEMENT}d.prototype.get=function(a){return this.data[a*this.elementStride]};d.prototype.set=function(a,d){this.data[a*this.elementStride]=d};Object.defineProperty(d.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});
Object.defineProperty(d.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});d.ElementCount=1;return d}();h.BufferViewSingle=p})},"esri/views/3d/support/buffer/internals/Vec2":function(){define(["require","exports","../../../lib/glMatrix"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});
p=function(){function a(a,d,k,h){void 0===k&&(k=0);a=this.TypedArrayConstructor=a;void 0===h&&(h=2*a.BYTES_PER_ELEMENT);this.data=new a(d,0===d.byteLength?0:k);this.elementStride=h/a.BYTES_PER_ELEMENT}a.prototype.getVec=function(a,f){return d.vec2d.set2(this.data[a*this.elementStride],this.data[a*this.elementStride+1],f)};a.prototype.setVec=function(a,d){this.data[a*this.elementStride]=d[0];this.data[a*this.elementStride+1]=d[1]};a.prototype.get=function(a,d){return this.data[a*this.elementStride+
d]};a.prototype.set=function(a,d,k){this.data[a*this.elementStride+d]=k};Object.defineProperty(a.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"stride",{get:function(){return this.elementStride*
this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});a.ElementCount=2;return a}();h.BufferViewVec2=p})},"esri/views/3d/support/buffer/internals/Vec3":function(){define(["require","exports","../../../lib/glMatrix"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function a(a,d,k,h){void 0===k&&(k=0);a=this.TypedArrayConstructor=a;void 0===h&&(h=3*a.BYTES_PER_ELEMENT);this.data=new a(d,0===d.byteLength?0:k);this.elementStride=h/a.BYTES_PER_ELEMENT}
a.prototype.getVec=function(a,f){return d.vec3d.set3(this.data[a*this.elementStride],this.data[a*this.elementStride+1],this.data[a*this.elementStride+2],f)};a.prototype.setVec=function(a,d){this.data[a*this.elementStride]=d[0];this.data[a*this.elementStride+1]=d[1];this.data[a*this.elementStride+2]=d[2]};a.prototype.get=function(a,d){return this.data[a*this.elementStride+d]};a.prototype.set=function(a,d,k){this.data[a*this.elementStride+d]=k};Object.defineProperty(a.prototype,"count",{get:function(){return Math.ceil(this.data.length/
this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});a.ElementCount=3;return a}();h.BufferViewVec3=p})},"esri/views/3d/support/buffer/internals/Vec4":function(){define(["require",
"exports","../../../lib/glMatrix"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function a(a,d,k,h){void 0===k&&(k=0);a=this.TypedArrayConstructor=a;void 0===h&&(h=4*a.BYTES_PER_ELEMENT);this.data=new a(d,0===d.byteLength?0:k);this.elementStride=h/a.BYTES_PER_ELEMENT}a.prototype.getVec=function(a,f){return d.vec4d.set4(this.data[a*this.elementStride],this.data[a*this.elementStride+1],this.data[a*this.elementStride+2],this.data[a*this.elementStride+3],f)};a.prototype.setVec=
function(a,d){this.data[a*this.elementStride]=d[0];this.data[a*this.elementStride+1]=d[1];this.data[a*this.elementStride+2]=d[2];this.data[a*this.elementStride+3]=d[3]};a.prototype.get=function(a,d){return this.data[a*this.elementStride+d]};a.prototype.set=function(a,d,k){this.data[a*this.elementStride+d]=k};Object.defineProperty(a.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"buffer",{get:function(){return this.data.buffer},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});a.ElementCount=4;return a}();h.BufferViewVec4=p})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["require","exports","./BufferView"],function(p,h,d){Object.defineProperty(h,
"__esModule",{value:!0});var a=function(){function a(a,d){this.layout=a;this.buffer="number"===typeof d?new ArrayBuffer(d*a.stride):d;d=0;for(var e=a.fieldNames;d<e.length;d++){var b=e[d],f=a.fields.get(b);this[b]=new f.constructor(this.buffer,f.offset,this.stride)}}Object.defineProperty(a.prototype,"stride",{get:function(){return this.layout.stride},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"count",{get:function(){return this.buffer.byteLength/this.stride},enumerable:!0,configurable:!0});
a.prototype.slice=function(d,f){return new a(this.layout,this.buffer.slice(d*this.stride,f*this.stride))};return a}(),g=function(){function f(){this.stride=0;this.fields=new Map;this.fieldNames=[]}f.prototype.vec2f=function(a,f){this.fields.set(a,{size:8,constructor:d.BufferViewVec2f,offset:this.stride,optional:f});this.stride+=8;this.fieldNames.push(a);return this};f.prototype.vec3f=function(a,f){this.fields.set(a,{size:12,constructor:d.BufferViewVec3f,offset:this.stride,optional:f});this.stride+=
12;this.fieldNames.push(a);return this};f.prototype.vec4f=function(a,f){this.fields.set(a,{size:16,constructor:d.BufferViewVec4f,offset:this.stride,optional:f});this.stride+=16;this.fieldNames.push(a);return this};f.prototype.mat4f=function(a,f){this.fields.set(a,{size:64,constructor:d.BufferViewMat4f,offset:this.stride,optional:f});this.stride+=64;this.fieldNames.push(a);return this};f.prototype.vec4u8=function(a,f){this.fields.set(a,{offset:this.stride,size:4,optional:f,constructor:d.BufferViewVec4u8});
this.stride+=4;this.fieldNames.push(a);return this};f.prototype.u8=function(a,f){this.fields.set(a,{offset:this.stride,size:1,optional:f,constructor:d.BufferViewUint8});this.stride+=1;this.fieldNames.push(a);return this};f.prototype.u16=function(a,f){this.fields.set(a,{offset:this.stride,size:2,optional:f,constructor:d.BufferViewUint16});this.stride+=2;this.fieldNames.push(a);return this};f.prototype.i8=function(a,f){this.fields.set(a,{offset:this.stride,size:1,optional:f,constructor:d.BufferViewInt8});
this.stride+=1;this.fieldNames.push(a);return this};f.prototype.vec2i8=function(a,f){this.fields.set(a,{offset:this.stride,size:2,optional:f,constructor:d.BufferViewVec2i8});this.stride+=2;this.fieldNames.push(a);return this};f.prototype.vec2i16=function(a,f){this.fields.set(a,{offset:this.stride,size:4,optional:f,constructor:d.BufferViewVec2i16});this.stride+=4;this.fieldNames.push(a);return this};f.prototype.vec2u8=function(a,f){this.fields.set(a,{offset:this.stride,size:2,optional:f,constructor:d.BufferViewVec2u8});
this.stride+=2;this.fieldNames.push(a);return this};f.prototype.vec4u16=function(a,f){this.fields.set(a,{offset:this.stride,size:8,optional:f,constructor:d.BufferViewVec4u16});this.stride+=8;this.fieldNames.push(a);return this};f.prototype.u32=function(a,f){this.fields.set(a,{offset:this.stride,size:4,optional:f,constructor:d.BufferViewUint32});this.stride+=4;this.fieldNames.push(a);return this};f.prototype.createBuffer=function(d){return new a(this,d)};f.prototype.createView=function(d){return new a(this,
d)};f.prototype.clone=function(){var a=new f;a.stride=this.stride;a.fields=new Map;this.fields.forEach(function(d,e){return a.fields.set(e,d)});a.fieldNames=this.fieldNames.slice();a.BufferType=this.BufferType;return a};return f}();h.InterleavedLayout=g;h.newLayout=function(){return new g}})},"esri/views/3d/support/buffer/typedArrayUtil":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});h.forEach=function(d,a){if(d.forEach)d.forEach(a);else for(var g=
0;g<d.length;g++)a(d[g],g,d)};h.slice=function(d,a,g){if(d.slice)return d.slice(a,g);void 0===a?a=0:(0>a&&(a+=d.length),a=Math.min(d.length,Math.max(0,a)));void 0===g?g=d.length:(0>g&&(g+=d.length),g=Math.min(d.length,Math.max(0,g)));g=Math.max(0,g-a);for(var f=new d.constructor(g),k=0;k<g;k++)f[k]=d[a+k];return f}})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});h.applyToModelMatrix=function(d,
a){var g=-d[0],f=-d[1];d=-d[2];var k=a[3],h=a[7],e=a[11],b=a[15];a[0]+=k*g;a[1]+=k*f;a[2]+=k*d;a[4]+=h*g;a[5]+=h*f;a[6]+=h*d;a[8]+=e*g;a[9]+=e*f;a[10]+=e*d;a[12]+=b*g;a[13]+=b*f;a[14]+=b*d};h.applyToViewMatrix=function(d,a){var g=d[0],f=d[1];d=d[2];a[12]+=g*a[0]+f*a[4]+d*a[8];a[13]+=g*a[1]+f*a[5]+d*a[9];a[14]+=g*a[2]+f*a[6]+d*a[10];a[14]+=g*a[3]+f*a[7]+d*a[11]}})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["require","exports","./gl-matrix","./localOriginHelper"],function(p,
h,d,a){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function g(a){this.factory=a;this.originData=new Map}g.prototype.aquire=function(a){return this.register(this.factory.getOrigin(a))};g.prototype.register=function(a){var f=this.originData.get(a.id);if(f)return f.refCount++,f.origin;this.originData.set(a.id,{refCount:1,viewMatrix:d.mat4d.identity(),origin:a});return a};g.prototype.release=function(a){var d=this.originData.get(a.id);d&&(d.refCount--,0===d.refCount&&this.originData.delete(a.id))};
g.prototype.updateViewMatrices=function(f){this.originData.forEach(function(g){d.mat4d.set(f,g.viewMatrix);a.applyToViewMatrix(g.origin.vec3,g.viewMatrix)})};g.prototype.getViewMatrix=function(a){return this.originData.get(a.id).viewMatrix};return g}();h.LocalOriginManager=p})},"esri/views/3d/webgl-engine/lib/PreinterleavedGeometryData":function(){define(["require","exports","./ComponentUtils","./geometryDataUtils","../../../webgl/Util"],function(p,h,d,a,g){function f(a){switch(a){case 5120:return Int8Array;
case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw Error("Unhandled data type: "+a);}return function(){function k(h,e,b,l,t){void 0===b&&(b=null);void 0===l&&(l=k.DefaultOffsets);void 0===t&&(t=k.DefaultIndices);this.preinterleaved=!0;this.primitiveType="triangle";this._positionData=null;var m=g.getStride(e)/4,m=h.length/m;(this._hasDefaultIndices=t===k.DefaultIndices)&&(t=
a.generateDefaultIndexArray(m));for(var m={},r=0;r<e.length;r++){var v=e[r],q=new (f(v.type))(h.buffer),n=g.getBytesPerElement(v.type);m[v.name]={data:q,size:v.count,offsetIdx:v.offset/n,strideIdx:v.stride/n}}b&&(this._positionData=b,m.position={data:b.data,size:3,offsetIdx:0,strideIdx:3});this._id=a.getNewId();this._vertexData=h;this._vertexAttributes=m;this._layout=e;this._indexData=t;this._componentOffsets=d.createOffsets(l);this._gpuMemoryUsage=h.byteLength+(this._hasDefaultIndices?0:t.byteLength)}
Object.defineProperty(k.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0});k.prototype.toRenderData=function(){var a={id:this._id.toString(),preinterleaved:!0,indexData:this._hasDefaultIndices?null:this._indexData,indexCount:this._indexData.length,
vertexData:this._vertexData,layout:this._layout};this._indexData=this._vertexData=null;this._vertexAttributes={position:this._vertexAttributes.position};return a};k.prototype.getIndices=function(a){return"position"===a&&this._positionData?this._positionData.indices:this._indexData};k.prototype.getAttribute=function(a){return this._vertexAttributes[a]};k.prototype.estimateGpuMemoryUsage=function(){return this._gpuMemoryUsage};k.DefaultOffsets=new Uint32Array(0);k.DefaultIndices=new Uint32Array(0);
return k}()})},"esri/views/3d/webgl-engine/lib/RegularGridLocalOriginFactory":function(){define(["require","exports"],function(p,h){return function(){function d(a){this._gridSize=a;this._origins={}}d.prototype.getOrigin=function(a){var g=this._gridSize,f=Math.round(a[0]/g),k=Math.round(a[1]/g);a=Math.round(a[2]/g);var g=""+d.ORIGIN_PREFIX+f+"/"+k+"/"+a,h=this._origins[g];if(!h){var h=this._gridSize,e=d.OFFSET,h={id:g,vec3:[f*h+e,k*h+e,a*h+e]};this._origins[g]=h}return h};d.ORIGIN_PREFIX="rg_";d.OFFSET=
1.11;return d}()})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["require","exports","./ManagedTextureBackedBuffer"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function a(a){this.rctx=a;this.buffers=[]}a.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(a){return 0===a.activeCount?(a.dispose(),!1):!0})};a.prototype.getBuffer=function(a){for(var f=0,g=this.buffers;f<g.length;f++){var h=g[f];if(h.availableCount>=
a)return h}if(!(a>d.MAX_INDEX_COUNT))return a=new d.ManagedTextureBackedBuffer(this.rctx),this.buffers.push(a),a};a.prototype.updateTextures=function(){for(var a=0,d=this.buffers;a<d.length;a++)d[a].textureBuffer.updateTexture()};return a}();h.BufferManager=p})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["require","exports","./SimpleIndexManager","./TextureBackedBuffer"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});h.MAX_INDEX_COUNT=
65536;p=function(){function g(f){this.indexManager=new d.SimpleIndexManager(h.MAX_INDEX_COUNT);this.textureBuffer=new a.TextureBackedBuffer(f)}g.prototype.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};Object.defineProperty(g.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0});
g.prototype.aquireIndex=function(){var a=this.indexManager.aquire();this.textureBuffer.resizeToFit(a);return a};g.prototype.releaseIndex=function(a){this.indexManager.release(a)};return g}();h.ManagedTextureBackedBuffer=p})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function d(a){this.maxCount=a;this._nextIndex=0;this.recycledIndices=[]}Object.defineProperty(d.prototype,
"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0});d.prototype.aquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();if(this.availableCount)return this._nextIndex++};d.prototype.release=function(a){this.recycledIndices.push(a)};return d}();h.SimpleIndexManager=
p})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["require","exports","../../../support/buffer/BufferView","../../../../webgl/Texture"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function g(f){this.rctx=f;this.textureWidth=4096;this.dirty=!0;this.texture=new a(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1});this.data=new d.BufferViewVec4u8(new ArrayBuffer(4*
this.textureWidth))}g.prototype.dispose=function(){this.texture.dispose();this.data=this.texture=void 0};g.prototype.setData=function(a,d,g,e,b){this.dirty=!0;this.data.set(a,0,d);this.data.set(a,1,g);this.data.set(a,2,e);this.data.set(a,3,b)};g.prototype.setDataElement=function(a,d,g){this.dirty=!0;this.data.set(a,d,g)};g.prototype.resizeToFit=function(a){a>=this.data.count&&(a=new d.BufferViewVec4u8(new ArrayBuffer(Math.ceil((a+1)/this.textureWidth)*this.textureWidth*4)),a.typedBuffer.set(this.data.typedBuffer),
this.data=a)};g.prototype.updateTexture=function(){if(this.dirty){var a=this.texture.descriptor.width;this.data.count>a*this.texture.descriptor.height&&this.texture.resize(a,this.data.count/a);this.texture.setData(this.data.typedBuffer);this.dirty=!1}};g.prototype.bind=function(a,d){this.rctx.bindTexture(this.texture,d.unit);a.setUniform1i(d.tex,d.unit);a.setUniform2f(d.invDim,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return g}();h.TextureBackedBuffer=p})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("require exports ../../../../../core/tsSupport/assignHelper dojo/text!./EdgeRendererUtils.xml ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./edgePreprocessing ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject".split(" "),
function(p,h,d,a,g,f,k,m,e){Object.defineProperty(h,"__esModule",{value:!0});var b=f.newLayout().vec2u8("sidenessAtt");h.glVertexLayout=g.glLayout(b);p=function(){function f(a,d,e){this.rctx=a;this.programRepository=d;this.key=e;this.depthBiasZ=-4E-4;this.depthBiasXY=.5;a=b.createBuffer(4);for(d=0;4>d;d++)a.sidenessAtt.set(d,0,0===d||3===d?0:1),a.sidenessAtt.set(d,1,0===d||1===d?0:1);this.verticesBufferObject=m.createVertex(this.rctx,35044,a.buffer)}f.prototype.dispose=function(){for(var a in this.programs){var b=
this.programs[a];b&&(this.programRepository.decreaseRefCount(b),this.programs[a]=null)}this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null)};f.prototype.createInstance=function(a,b,f){b=k.extractEdges(b,this.edgeBufferWriters.default.writer,this.edgeBufferWriters.silhouette.writer);var g=b.averageEdgeLength,l=null,n=null,r=0;0<b.edge.lodInfo.lengths.length&&(l=new e(this.rctx,h.attributeLocations,{vertices:h.glVertexLayout,instances:this.edgeBufferWriters.default.glLayout},
{vertices:this.verticesBufferObject,instances:m.createVertex(this.rctx,35044,b.edge.instancesData.buffer)}),r+=l.size);0<b.silhouette.lodInfo.lengths.length&&(n=new e(this.rctx,h.attributeLocations,{vertices:h.glVertexLayout,instances:this.edgeBufferWriters.silhouette.glLayout},{vertices:this.verticesBufferObject,instances:m.createVertex(this.rctx,35044,b.silhouette.instancesData.buffer)}),r+=n.size);return d({},a,{edgeVAO:l,silhouetteVAO:n,material:f,averageEdgeLength:g,gpuMemoryUsage:r,edgeLoD:b.edge.lodInfo,
silhouetteLoD:b.silhouette.lodInfo})};f.prototype.disposeInstance=function(a){a.edgeVAO&&(a.edgeVAO.vertexBuffers.instances.dispose(),a.edgeVAO.dispose(!1),a.edgeVAO=null);a.silhouetteVAO&&(a.silhouetteVAO.vertexBuffers.instances.dispose(),a.silhouetteVAO.dispose(!1),a.silhouetteVAO=null)};f.prototype.addProgram=function(a,b){this.programs||(this.programs={});this.programs[a]=b;this.programRepository.increaseRefCount(b)};f.loadShaders=function(b,d,e){b.EdgeRendererUtils_readComponentColor||b._parse(a)};
return f}();h.EdgeRenderer=p;h.attributeLocations={position0:0,componentIndex:1,position1:2,packedAttributes:3,normalA:4,normalB:5,normal:6,variantOffset:7,variantStroke:8,variantExtension:9,extensionDirection:10,sidenessAtt:11};h.componentColorBindParameters={tex:"uComponentColorTex",invDim:"uComponentColorTexInvDim",unit:2};h.default=p})},"esri/views/3d/support/buffer/glUtil":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});h.glLayout=function(a,
g){void 0===g&&(g=0);var f=a.stride;return a.fieldNames.filter(function(d){d=a.fields.get(d).optional;return!(d&&d.glPadding)}).map(function(k){var h=a.fields.get(k),e=h.constructor.ElementCount;var b=d[h.constructor.ElementType];if(!b)throw Error("BufferType not supported in WebGL");return{name:k,stride:f,count:e,type:b,offset:h.offset,normalized:h.optional&&!!h.optional.glNormalized,divisor:g}})};var d={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("require exports ../../../../../core/arrayUtils ../../../lib/glMatrix ../../../support/mathUtils ../../../support/buffer/typedArrayUtil".split(" "),
function(p,h,d,a,g,f){function k(d,e){var f=Math.acos(d.cosAngle),g=b.fwd,k=b.ortho;a.vec3d.normalize(a.vec3d.direction(d.position0,d.position1,g));d=0<a.vec3d.dot(a.vec3d.cross(d.faceNormal0,d.faceNormal1,k),g)?-1:1;return f*d>e}function m(a){var b=a.faces.length/3,d=a.faces;a=a.neighbors;for(var e=0,f=0;f<b;f++)var g=a[3*f+0],c=a[3*f+1],k=a[3*f+2],h=d[3*f+0],l=d[3*f+1],m=d[3*f+2],e=e+(-1===g||h<l?1:0),e=e+(-1===c||l<m?1:0),e=e+(-1===k||m<h?1:0);for(var e=new Uint32Array(4*e),t=0,f=0;f<b;f++){g=
a[3*f+0];c=a[3*f+1];k=a[3*f+2];h=d[3*f+0];l=d[3*f+1];m=d[3*f+2];if(-1===g||h<l)e[t++]=h,e[t++]=l,e[t++]=f,e[t++]=g;if(-1===c||l<m)e[t++]=l,e[t++]=m,e[t++]=f,e[t++]=c;if(-1===k||m<h)e[t++]=m,e[t++]=h,e[t++]=f,e[t++]=k}return e}function e(b){var d=b.faces.length/3,e=b.vertices.position;b=b.faces;for(var f=l.v0,g=l.v1,k=l.v2,c=new Float32Array(3*d),h=0;h<d;h++){var m=b[3*h+1],t=b[3*h+2];e.getVec(b[3*h+0],f);e.getVec(m,g);e.getVec(t,k);a.vec3d.subtract(g,f);a.vec3d.subtract(k,f);a.vec3d.normalize(a.vec3d.cross(g,
k,f));c[3*h+0]=f[0];c[3*h+1]=f[1];c[3*h+2]=f[2]}return c}Object.defineProperty(h,"__esModule",{value:!0});h.extractEdges=function(h,l,v,q){void 0===q&&(q=t);var n=h.vertices.position,r=h.vertices.componentIndex,c=h.vertices.lineWidth,u=h.vertices.type,p=h.vertices.extensions,A=g.deg2rad(q.anglePlanar);q=g.deg2rad(q.angleSignificantEdge);q=Math.cos(q);var y=Math.cos(A),B=b.edge,E=B.position0,C=B.position1,G=B.faceNormal0,J=B.faceNormal1,F=e(h),I=m(h);h=I.length/4;var H=l.allocate(h),K=0,L=v.allocate(h),
M=0,V=0,S=0,Z=d.range(0,h),R=new Float32Array(h);f.forEach(R,function(c,b,d){n.getVec(I[4*b+0],E);n.getVec(I[4*b+1],C);d[b]=a.vec3d.dist(E,C)});Z.sort(function(a,c){return R[c]-R[a]});for(var N=[],D=[],P=0;P<h;P++){var O=Z[P],Q=R[O],T=I[4*O+0],da=I[4*O+1],U=I[4*O+2],O=I[4*O+3],aa=4294967295===O;n.getVec(T,E);n.getVec(da,C);if(aa)a.vec3d.set3(F[3*U+0],F[3*U+1],F[3*U+2],G),a.vec3d.set(G,J),B.componentIndex=r.get(T),B.cosAngle=a.vec3d.dot(G,J),B.lineWidth=c.get(T),B.type=u.get(T),B.extensions=p.get(T);
else if(a.vec3d.set3(F[3*U+0],F[3*U+1],F[3*U+2],G),a.vec3d.set3(F[3*O+0],F[3*O+1],F[3*O+2],J),B.componentIndex=r.get(T),B.cosAngle=a.vec3d.dot(G,J),B.lineWidth=c.get(T),B.type=u.get(T),B.extensions=p.get(T),B.cosAngle>y)continue;V+=Q;S++;aa||B.cosAngle<q?(l.write(H,K++,B),N.push(Q)):k(B,A)&&(v.write(L,M++,B),D.push(Q))}return{edge:{instancesData:l.trim(H,K),lodInfo:{lengths:N.reverse()}},silhouette:{instancesData:v.trim(L,M),lodInfo:{lengths:D.reverse()}},averageEdgeLength:V/S}};var b={edge:{position0:a.vec3d.create(),
position1:a.vec3d.create(),faceNormal0:a.vec3d.create(),faceNormal1:a.vec3d.create(),componentIndex:0,cosAngle:0,lineWidth:0,type:0,extensions:0},ortho:a.vec3d.create(),fwd:a.vec3d.create()},l={v0:a.vec3d.create(),v1:a.vec3d.create(),v2:a.vec3d.create()},t={anglePlanar:4,angleSignificantEdge:35}})},"esri/views/3d/webgl-engine/lib/edgeRendering/RibbonEdgeRenderer":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper dojo/text!./RibbonEdgeRenderer.xml ../../../lib/glMatrix ../../../support/mathUtils ../ShaderVariations ../Util ./EdgeRenderer ./ribbonEdgeBufferWriters".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l){Object.defineProperty(h,"__esModule",{value:!0});p=function(h){function r(a,b,e,c){a=h.call(this,a,b,r.getKey(e))||this;a.tmpViewToWorldNormalMatrix=f.mat3d.create();b=c.strokesTexture.variants;a.settings=d({},u,r.materialSettings(e),c);e=d({},a.settings,{variants:b});a.edgeBufferWriters={default:{writer:new l.RibbonDefaultEdgeBufferWriter(e),glLayout:l.RibbonDefaultEdgeBufferWriter.glLayout},silhouette:{writer:new l.RibbonSilhouetteBufferWriter(e),glLayout:l.RibbonSilhouetteBufferWriter.glLayout}};
a.createPrograms();return a}a(r,h);r.prototype.begin=function(a){};r.prototype.bindEdges=function(a,b){this.bind(this.programs.edge,a,b)};r.prototype.bindSilhouettes=function(a,b){this.bind(this.programs.silhouette,a,b)};r.prototype.bind=function(a,b,d){this.rctx.bindProgram(a);a.setUniformMatrix4fv("uProj",b.proj);a.setUniform2f("uDepthBias",this.depthBiasXY,this.depthBiasZ);a.setUniform2f("uPixelToNDC",2/b.viewport[2],2/b.viewport[3]);a.setUniform2f("uNDCToPixel",b.viewport[2]/2,b.viewport[3]/2);
a.setUniform1f("uDistanceFalloffFactor",d.distanceFalloffFactor);a.setUniform2f("uViewportDimInv",1/b.viewport[2],1/b.viewport[3])};r.prototype.renderEdges=function(a,b,d){this.render(this.programs.edge,a,a.edgeVAO,b,d)};r.prototype.renderSilhouettes=function(a,b,d){this.render(this.programs.silhouette,a,a.silhouetteVAO,b,d)};r.prototype.numberOfPrimitives=function(a){return a.edgeLoD.lengths.length+(a.silhouetteLoD?a.silhouetteLoD.lengths.length:0)};r.prototype.render=function(a,b,d,c,e){d&&(this.setUniforms(a,
b,c),a=this.rctx,a.bindVAO(d),a.capabilities.instancing.drawArraysInstanced(6,0,4,e))};r.prototype.setUniforms=function(a,d,g){d.componentBuffer.textureBuffer.bind(a,b.componentColorBindParameters);a.setUniformMatrix4fv("uView",g.view);a.setUniformMatrix4fv("uModel",d.modelTransform);var c=g.viewInvTransp,k=f.mat4d.toMat3(c,this.tmpViewToWorldNormalMatrix);a.setUniform3f("uCameraPosition",c[3],c[7],c[11]);a.setUniformMatrix3fv("uViewToWorldNormalMatrix",k);this.settings.uber||(a.setUniform1i("uLineWidth",
Math.round(d.material.size)),a.setUniform1i("uExtensionLength",Math.round(e.clamp(d.material.extensionLength,0,255))));(this.settings.uber||"sketch"===d.material.type)&&this.setSketchUniforms(a);a.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(g.fovY/2)/(g.viewport[3]/2));a.setUniform3fv("uLocalOrigin",d.origin.vec3);this.shadowsEnabled&&g.shadowMappingEnabled&&g.shadowMap.bindView(a,d.origin.vec3)};r.prototype.setSketchUniforms=function(a){var b=this.settings.strokesTexture,d=b.texture;this.rctx.bindTexture(d,
0);a.setUniform1i("uStrokesTexture",0);a.setUniform2f("uStrokesTextureScale",1/d.descriptor.width,1/d.descriptor.height);a.setUniform1f("uStrokesLog2Resolution",k.log2(b.resolution));a.setUniform1f("uStrokesNormalizationScale",b.normalizationScale);a.setUniform1f("uStrokesAmplitude",b.amplitude);a.setUniform1f("uStrokeVariants",b.variants)};Object.defineProperty(r.prototype,"shadowsEnabled",{get:function(){var a="smooth"===this.settings.lighting||"flat"===this.settings.lighting;return this.settings.receiveShadows&&
(this.settings.uber||a)},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"ssaoEnabled",{get:function(){var a="smooth"===this.settings.lighting||"flat"===this.settings.lighting;return this.settings.receiveSSAO&&(this.settings.uber||a)},enumerable:!0,configurable:!0});r.prototype.end=function(a){};r.prototype.getDefines=function(a){return[a.silhouette,this.settings.antialiasing&&!!this.rctx.capabilities.blendMinMax,this.shadowsEnabled,this.ssaoEnabled,"smooth"===this.settings.lighting&&
!this.settings.uber,"flat"===this.settings.lighting&&!this.settings.uber,"emissive"===this.settings.lighting&&!this.settings.uber,"sketch"===this.settings.lighting&&!this.settings.uber,this.settings.pressure,this.settings.uber]};r.prototype.createPrograms=function(){this.addProgram("edge",this.programRepository.getShaderVariationsProgram(t,this.getDefines({silhouette:!1}),void 0,void 0,b.attributeLocations));this.addProgram("silhouette",this.programRepository.getShaderVariationsProgram(t,this.getDefines({silhouette:!0}),
void 0,void 0,b.attributeLocations))};r.materialSettings=function(a){return a?"solid"===a.type?{lighting:"emissive"}:"sketch"===a.type?{lighting:"sketch"}:{lighting:"smooth"}:{}};r.loadShaders=function(a,b,d){a.fsRibbonEdge||a._parse(g);b.getShaderVariations(t)||(a=new m("ribbonEdge",["vsRibbonEdge","fsRibbonEdge"],null,b,a,d),a.addDefine("Silhouette","SILHOUETTE"),a.addDefine("AntiAliasing","ANTIALIASING"),a.addDefine("ReceiveShadows","RECEIVE_SHADOWS"),a.addDefine("AmbientOcclusion","RECEIVE_SSAO"),
a.addDefine("SmoothLighting","SMOOTH_LIGHTING"),a.addDefine("FlatLighting","FLAT_LIGHTING"),a.addDefine("EmissiveLighting","EMISSIVE_LIGHTING"),a.addDefine("Sketch","SKETCH"),a.addDefine("Pressure","PRESSURE"),a.addDefine("Uber","UBER"),b.addShaderVariations(t,a))};r.getKey=function(a,b){if(!a)return"ribbon-uber";b=d({},u,this.materialSettings(a),b);return"ribbon-s:"+a.size+"-e:"+a.extensionLength+"-aa:"+b.antialiasing+"-sh:"+b.receiveShadows+"-l:"+b.lighting};return r}(b.EdgeRenderer);h.RibbonEdgeRenderer=
p;var t="ribbon-edge-shader-variations",u={antialiasing:!0,lighting:"smooth",receiveShadows:!0,receiveSSAO:!0,uber:!0,pressure:!0,strokesTexture:null};h.default=p})},"esri/views/3d/webgl-engine/lib/ShaderVariations":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/_base/lang ./DefaultVertexAttributeLocations ./Util ../../../webgl/Program".split(" "),function(p,h,d,a,g,f,k){return function(){function d(a,b,d,g,k,h){this.variables=[];this.sealed=!1;this.programCache=
{};f.assert(2===b.length,"you must specify shader snippet prefixes for vertex and fragment shaders");this.programNamePrefix=a;this.shaderSnippetPrefixes=b;this.baseDefines=d;this.programRep=g;this.snippets=k;this.rctx=h;this.baseDefines=d?d.slice():[]}d.prototype.addDefine=function(a,b,d,g){f.assert(!this.sealed,"you cannot add another variable after the first program has been generated");f.assert(!!a,"you must specify a program name suffix");this.variables.push({programNameSuffixes:["",a],shaderNameSuffixes:g||
a,defineStr:b,affectsShaderTypes:d||[!0,!0]})};d.prototype.addBinaryShaderSnippetSuffix=function(a,b,d){f.assert(!this.sealed,"you cannot add another variable after the first program has been generated");f.assert(!!a,"you must specify a program name suffix");this.variables.push({programNameSuffixes:["",a],shaderSnippetSuffixes:["",b],affectsShaderTypes:d||[!0,!0]})};d.prototype.addNaryShaderSnippetSuffix=function(a,b){f.assert(!this.sealed,"you cannot add another variable after the first program has been generated");
var d=a.map(function(a){f.assert(null!=a.value,"value must always be specified");return a.value});this.variables.push({values:d,programNameSuffixes:a.map(function(a,b){return null!=a.programNameSuffix?a.programNameSuffix:d[b]}),shaderSnippetSuffixes:a.map(function(a,b){return null!=a.shaderSnippetSuffix?a.shaderSnippetSuffix:d[b]}),affectsShaderTypes:b||[!0,!0]})};d.prototype.getShaderVariation=function(d){f.assert(d.length===this.variables.length,"you must specify a value for each variable");for(var b=
this.programNamePrefix,e=a.clone(this.shaderSnippetPrefixes),g=a.clone(this.shaderSnippetPrefixes),k=a.clone(this.baseDefines),h=0;h<this.variables.length;h++){var m=this.variables[h],q=d[h],n=void 0;m.values?(n=m.values.indexOf(q.toString()),f.assert(0<=n,"invalid value "+q+" for variable "+h)):n=q?1:0;b+=m.programNameSuffixes[n];for(q=0;2>q;q++)m.affectsShaderTypes[q]&&(m.shaderSnippetSuffixes&&(e[q]+=m.shaderSnippetSuffixes[n],g[q]+=m.shaderSnippetSuffixes[n]),m.defineStr&&n&&(k.push(m.defineStr),
g[q]+=m.shaderNameSuffixes))}return{programName:b,shaderSnippetNames:e,shaderNames:g,defines:k}};d.prototype.getProgram=function(a,b,d,h){void 0===b&&(b=this.snippets);void 0===d&&(d=this.rctx);void 0===h&&(h=g.Default3D);this.sealed=!0;var e=a.reduce(function(a,b){return a+b.toString()},"");if(this.programCache[e])return this.programCache[e];a=this.getShaderVariation(a);var l=this.programRep.get(a.programName);if(l)return l;var m=a.shaderSnippetNames[0],l=b[m];f.assert(null!=l,"shader snippet '"+
m+"' does not exist");m=a.shaderSnippetNames[1];b=b[m];f.assert(null!=b,"shader snippet '"+m+"' does not exist");l=new k(d,l,b,h,a.defines);this.programCache[e]=l;this.programRep.add(a.programName,l);return l};return d}()})},"esri/views/3d/webgl-engine/lib/edgeRendering/ribbonEdgeBufferWriters":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../lib/glMatrix ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ../Util".split(" "),
function(p,h,d,a,g,f,k,m){Object.defineProperty(h,"__esModule",{value:!0});p=k.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").vec2u8("packedAttributes").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("_padding",{glPadding:!0});var e=function(){function a(a){this.settings=a}a.prototype.write=function(a,c,d){var e=b;e[0]=d.position0[0];e[1]=d.position0[1];e[2]=d.position0[2];e[3]=d.position1[0];e[4]=d.position1[1];e[5]=
d.position1[2];t[0]=5381;for(e=0;e<l.length;e++)t[0]=31*t[0]+l[e];u.reseed(t[0]);var e=u.randomRangeInt(0,255),f=u.randomRangeInt(0,this.settings.variants-1),g=u.randomFloat(),g=-(1-Math.min(g/.7,1))+Math.max(0,g-.7)/(1-.7),g=255*(Math.pow(Math.abs(g),1.2)*(0>g?-1:1)*.5+.5);a.position0.setVec(c,d.position0);a.position1.setVec(c,d.position1);a.componentIndex.set(c,d.componentIndex);if(this.settings.uber){var k=d.type|m.clamp(d.lineWidth,0,127)<<1;a.packedAttributes.set(c,0,k);a.packedAttributes.set(c,
1,Math.round(m.clamp(d.extensions,0,255)))}a.variantOffset.set(c,e);a.variantStroke.set(c,f);a.variantExtension.set(c,g)};a.prototype.trim=function(a,c){return a.slice(0,c)};return a}();h.RibbonCommonBufferWriter=e;var b=new Float32Array(6),l=new Uint32Array(b.buffer),t=new Uint32Array(1),u=new (function(){function a(a){void 0===a&&(a=1);this.seed=a}a.prototype.randomFloat=function(){return this.step()/a.LARGE_PRIME};a.prototype.randomRangeInt=function(a,c){c-=a;return Math.round(a+this.randomFloat()*
c)};a.prototype.reseed=function(a){this.seed=a};a.prototype.step=function(){return this.seed=this.seed*a.SMALL_PRIME%a.LARGE_PRIME};a.LARGE_PRIME=2147483647;a.SMALL_PRIME=16807;return a}()),r=p.clone().vec3f("normal");d=function(){function a(a){this.commonWriter=new e(a)}a.prototype.allocate=function(a){return r.createBuffer(a)};a.prototype.write=function(a,c,b){this.commonWriter.write(a,c,b);b=g.vec3d.normalize(g.vec3d.add(b.faceNormal0,b.faceNormal1,q));a.normal.setVec(c,b)};a.prototype.trim=function(a,
c){return this.commonWriter.trim(a,c)};a.Layout=r;a.glLayout=f.glLayout(r,1);return a}();h.RibbonDefaultEdgeBufferWriter=d;var v=p.clone().vec3f("normalA").vec3f("normalB");p=function(){function a(a){this.commonWriter=new e(a)}a.prototype.allocate=function(a){return v.createBuffer(a)};a.prototype.write=function(a,c,b){this.commonWriter.write(a,c,b);a.normalA.setVec(c,b.faceNormal0);a.normalB.setVec(c,b.faceNormal1)};a.prototype.trim=function(a,c){return this.commonWriter.trim(a,c)};a.Layout=v;a.glLayout=
f.glLayout(v,1);return a}();h.RibbonSilhouetteBufferWriter=p;var q=g.vec3d.create()})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../support/mathUtils ../Util ../../../../webgl/Texture".split(" "),function(p,h,d,a,g,f){function k(a,d){if(!a)return null;var b=a.length/2,f=m*b,b=Array(b),g=0;d=1===d;for(var k=0;k<a.length;k+=2){var h=(a[k]+a[k+1])/2;d?b[g++]=Math.min(f,1-(1-h)*e):b[g++]=Math.min(f,h*e)}return b}
Object.defineProperty(h,"__esModule",{value:!0});h.generateStrokesTexture=function(b){for(var d=h.strokesDefinition.resolution,e=d/2,m=new Uint8Array(4*d*d),r=4*d*e,e=h.strokesDefinition.amplitude,v=2*e,q=4*d,n=a.log2(d)+1,w=h.strokesDefinition.strokes.length,c=(n-1)*w*q,p=0,z=h.strokesDefinition.strokes;p<z.length;p++){for(var A=z[p],y=A.distance,A=A.pressure,B=c,E=0;E<n;E++){0!==E&&(y=k(y,0),A=k(A,1));for(var C=0;C<h.strokesDefinition.resolution;C++){var G=A?A[C%A.length]:1;g.packFloatRGBA((y?y[C%
y.length]/v:0)+.5,m,B);g.packFloatRGBA(G,m,B+r);B+=4}B-=q*(w+1)}c+=q}b=new f(b,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:d,height:d,wrapMode:10497},m);return{resolution:d,texture:b,normalizationScale:v,amplitude:e,variants:w}};var m=.1,e=.8;h.strokesDefinition={amplitude:3,resolution:256,strokes:[{distance:[-.6961162015478699,-.7508257847868736,-.7997644035343595,-.8411953082523799,-.8738519340397198,-.8970963967771677,-.9109829928296007,-.9162137655979228,-.913998038008873,
-.9058487287407682,-.8933444036444794,-.8779096104840396,-.8607330031871834,-.8427618841891984,-.8247524699147402,-.8073531358680022,-.7909248019784956,-.7753873769984032,-.7603079682885866,-.7451570753750201,-.72953628421473,-.7132936332651814,-.6966376038276425,-.6801873579730909,-.6651646885582179,-.6530405721292875,-.6448456493620996,-.6407587649558054,-.6402752648324058,-.6426081247616191,-.6467892798861155,-.6517876939017704,-.6564214500631184,-.6591297660130438,-.6582403353507722,-.6522943079243422,
-.6402700413580501,-.6217439483799877,-.5969540879850209,-.5667516958600565,-.532453359664937,-.4956433568176743,-.457950808711389,-.4208098420413061,-.385385346003145,-.35260172580383686,-.3232107010185183,-.2978725847118794,-.27695918418612697,-.2603742018803116,-.24761539682660305,-.23801550870761135,-.23096639865977125,-.22604102685851557,-.2231257623245813,-.22249840660465858,-.22504735531166142,-.23191379259836598,-.24379727533380569,-.26054572309090623,-.2813232462004144,-.30502450536082876,
-.3303821728839333,-.3560779043522023,-.3806373872247088,-.40221418490478766,-.4188817061374711,-.42895905137743484,-.43123200771248316,-.42511170718063274,-.4106982730549805,-.38873650627114026,-.36047554335439197,-.3274652362197369,-.29131817559902384,-.25348989183393966,-.2151967327092758,-.17741004903599694,-.14090600412037024,-.1063483412587225,-.07410945698001503,-.044118672378244295,-.015951099802502755,.010916444965542782,.036881001419378445,.06209865148024396,.08636830862208067,.10907947425703635,
.12901871699286838,.14472203031677566,.15516376054503545,.16016796069700223,.16024043344463235,.15616832699447325,.14891983390619146,.13952736031983337,.12917678206927985,.11943678255476131,.11199277019987819,.10832294498072548,.10947497269773176,.11590526964669157,.12741565312832392,.1432015951821991,.16199958190938568,.18228404326135772,.2024891641459956,.2212474437606281,.23746248517494073,.2502786934217669,.25901191840777127,.2630673564983701,.26213870969785813,.2563886366292518,.24638587024246705,
.23286356337725955,.2164954355478299,.19777489460206799,.17688213870073688,.15360524289480804,.12712029173231887,.09634872305394937,.06065157497048401,.020239655196603645,-.023993780563490774,-.07088653441845982,-.11911374654625106,-.16729782788434266,-.2139057379918765,-.25703537703294804,-.2947077940399854,-.3251929968609723,-.3472308364514586,-.36018951030215973,-.3641290709261046,-.3597570023428457,-.34828776327813316,-.33123911449904375,-.31019418136319715,-.2865817993289998,-.2615946482489633,
-.236183803676154,-.21110900989582898,-.1870219308461114,-.16428653929977188,-.14282556286393555,-.12220869293612036,-.10190877484399907,-.08152949600121595,-.06092074311674489,-.04029258092423649,-.0202654757895524,-.0020622288080149875,.01284549065262186,.023426686103591887,.02950251759971534,.03157802975241231,.03044104788586144,.0270607962339795,.022469648631901595,.01785097108069833,.014767085199741903,.014891906511742548,.019685945554555384,.03017254034261918,.046777105129965024,.06926392424437611,
.09678469158407277,.12802621522941338,.1614079614984547,.19530479015696733,.2282866912633974,.2591929358812741,.28710324103959806,.3112699010512504,.33103644973510993,.34603471296276767,.35636437310942437,.362530784932968,.3652040405981043,.3649948293009557,.3623324709082918,.35733262748293093,.3497193102271303,.33860575693216766,.3228522838378354,.3017607540301376,.27548464510364956,.24486128262301665,.21099754465555753,.17516246604681074,.1386763324211321,.10301569615294226,.07002959461759928,.04164763973142238,
.019554226087304727,.004967585130847052,-.0015188321151153872,0,.008784976417960721,.02359322574150391,.04288175239902803,.06504542598599172,.08863678394498675,.11244814794441083,.1355174234048041,.157078266314284,.17647728358407044,.19335291971807023,.2077871380480143,.22021649994825387,.2311761926611775,.24107552293526968,.2500830349230496,.25801022680133956,.26425923237356896,.26762922426256575,.26666869526022685,.26036431068946286,.2485521884467231,.2317498736859337,.21075600008193984,.18655025769644473,
.16017660860078986,.13283250636119293,.10609819612543658,.08167059416898725,.06103931684347108,.045263318072760184,.034810138919663,.029492576130770387,.028517094314567948,.030631217840932812,.03432041281838627,.03802985073949838,.040402923307320426,.04035399127997508,.03703804637367447,.029781323276349858,.017999176314233978,.0013952203182848733,-.019858229550996698,-.04518304361893244,-.07383692764322247,-.10513726324072648,-.13858196496366015,-.17398234851501582,-.21154200587882066,-.25207662611112647,
-.2966565969366647,-.3459126955910849,-.39962585029709197,-.4568943864055129,-.5165475064143137,-.5772518620346987,-.6376217091435763],pressure:[.996633071726222,.9947738679099977,.9928798384595328,.9909563560792033,.9890090717800587,.9870438806476063,.9850668842305685,.9830843499300339,.9811026678233311,.9791283054057823,.9771677607751055,.9752275148166334,.9733139829718654,.971433467187512,.9695921086466863,.9677958418780128,.9660503508221645,.9643610274089325,.9627329331618455,.9611707643022523,
.9596788207715574,.9582609795299922,.9569206724241511,.955660868844833,.9544840633229551,.9533922681359144,.9523870109212649,.9514693372204399,.9506398178039001,.9498985605618655,.9492452266829126,.9486790507872501,.9481988646333425,.9478031239764171,.9474899381258253,.9472570986220648,.9471020701670287,.9470219856643075,.9470136989277632,.9470738439147639,.9471988931026557,.9473852147599654,.9476291286519952,.9479269594850699,.9482750871694335,.9486699928008218,.949108299154246,.9495868044731994,
.9501025084375019,.9506526294076754,.9512346123669349,.9518461312352751,.9524851878533398,.9531502812428171,.9538403701147599,.9545547774554046,.9552930880906448,.9560550443879164,.9568404449513421,.9576490507814228,.9584805027958907,.9593342538703069,.9602095176899668,.9611052357493661,.96202006283709,.9629523703503057,.9639002658422147,.9648616263640609,.9658341424626808,.9668153690243617,.9678027764396628,.968793799667633,.9697858863592619,.9707765370643373,.9717633337940663,.9727439546733231,
.9737161733133598,.9746778425338373,.9756268631116501,.9765611456037372,.9774786948426197,.9783778139471927,.9792571749849625,.9801158915714986,.9809537691466981,.9817713582682308,.9825698003727413,.9833506594657514,.9841157534292189,.9848669889577633,.9856062039798974,.9863350212867441,.987054716954081,.9877661069736776,.9884694552730791,.9891644059664273,.989849942214706,.9905243734627036,.99118535205457,.9918299193166491,.9924545801569844,.9930554041330952,.9936281539388622,.9941684440642525,.9946719022057059,
.9951343307940307,.995551868254632,.9959211428189224,.9962394115456439,.9965046775758727,.9967157792012401,.996872372748931,.9969745803042854,.9970227561810501,.997017419542337,.9969591942466283,.9968487544532554,.996686780775214,.9964739316491749,.9962108342152981,.9958980983522688,.9955363565985895,.9951263315271344,.9946689307594084,.9941653682573589,.9936173088767006,.9930270314793629,.9923975647360177,.9917325035342212,.9910357753101586,.990311602972271,.9895644802700436,.98879914350209,.988020539788174,
.9872337921904392,.9864441620266478,.9856570087714055,.9848777479889387,.984111807781895,.9833645842738553,.9826413966679451,.981947442439469,.9812877532263828,.9806671519774584,.9800902119041126,.9795612177583292,.9790841299262595,.9786625517856397,.9782997007258958,.9779983831737636,.9777609739055654,.977589399861252,.9774851286062997,.9774491615169585,.9774820316936363,.9775838065377626,.9777540948606951,.9779920584725561,.9782964342776146,.9786655707198935,.9790974582949677,.9795897593834183,
.9801398405016262,.980744803388273,.9814014780720497,.9821064251759908,.9828560098326315,.9836464661523481,.9844739509252712,.9853345957618281,.9862245574637764,.9871400659674667,.988077468976114,.9890332722172925,.9900041741548722,.9909870939738691,.9919791917563586,.9929778799809873,.9939808258015823,.9949859478135121,.9959915096394044,.9969962839745582,.9979995100966227,.9990007937017172,1,.9990028547396802,.9980077083105606,.9970145498547733,.9960235053933111,.995034908416511,.9940493532219995,
.9930677296452887,.9920912388299182,.9911213906813999,.9901599845940833,.9892090758861786,.9882709310834514,.9873479757207249,.9864427386546457,.985557796983226,.9846957255402645,.9838590545801073,.9830502387059289,.9822716393493677,.9815255222173065,.9808140701275083,.9801394106095564,.97950365028055,.9789087864554966,.9783564992098928,.9778480768189026,.9773843393478058,.9769653847136214,.9765905319353396,.9762584721775238,.9759674341784768,.9757153504222335,.9755000200869989,.975319264952099,.9751710745735805,
.9750537374008981,.9749659649086903,.9749070112676386,.9748767505277215,.9748757203652921,.9749051372958465,.9749668823592721,.9750634571484471,.9751979110920252,.9753737420321358,.9755947733071422,.9758650116970392,.9761884916455175,.9765691120661909,.9770104727009618,.9775157173632646,.9780873914176021,.9787273204859289,.9794365168199681,.9802151913589024,.9810631004790579,.9819797735574649,.982964573982656,.9840167525792434,.9851354949571217,.986319958047006,.9875692912061472,.9888826376592722,
.9902591126906825,.9916977559212371,.9931974561710386,.9947568487918733,.996374186906707,.998047193478224,.9997729175820746,.99845238604403]},{distance:[2.1145614822294623,2.070562918356685,2.0218767812691407,1.9687733534728056,1.911604058107433,1.8507954929128902,1.786840343814669,1.7202855030586606,1.651717892836639,1.5817486426851746,1.5109963752359716,1.4400704110842164,1.369554704827077,1.2999932706802666,1.2318777522505837,1.165637646036529,1.101633514376288,1.0401533352375323,.981410195568371,
.925527087450261,.8725412431220276,.8224383399025108,.7751799441066878,.7307185912833756,.6890015307639337,.6499665941471815,.613533878907834,.5795845237307394,.5479449254894699,.5184026399518129,.49073167000363277,.4647196761640856,.4401928976306203,.41703518211444257,.395198669310002,.37470486599841246,.3556343362568435,.33810892702421547,.322271195359932,.3082598525301872,.29618341890479705,.2861031594845781,.27802902933708495,.271932214676766,.26774003052938,.2653154113209759,.26445140329011474,
.2648815948915828,.26630253196207343,.26840207518687986,.2708868127181926,.27350208500612627,.27603857819693856,.278323781912714,.2802030193956061,.2815120370209969,.28205222057498724,.2816056543108775,.27995099239182275,.2768586446486144,.2720905052330951,.26540953674983514,.25660173865117974,.24551084500063003,.2320791618693705,.2163514214333464,.19845637698094842,.17860525243506453,.15708898093078927,.1342719978573279,.11058251106628747,.08649976396542125,.06253927824915773,.03923642417284168,
.01712903029783097,-.003260133335663773,-.02144016439649188,-.03696735044413535,-.04945832954707441,-.058600517946845176,-.06415861814021095,-.06597715277806249,-.06398243213580723,-.0581968915158213,-.048731134608650195,-.0357483236994961,-.01943766508657596,0,.022355693718919878,.04740836354074229,.07491718881745024,.10460137488518428,.13612572964402603,.16911819165863062,.20319692639083042,.23799942848634015,.27320931665666426,.3085771178448735,.34393248898526374,.3791867035939803,.41432553147861517,
.44939364346239363,.48447220339158453,.5196515254698639,.5550019886770884,.5905542960386785,.6262927601009005,.6621652837088728,.6980758764572166,.7338620148107312,.7692873210137101,.8040515274929081,.8378168350653944,.8702385657461855,.9009926212411425,.929795532302007,.9564125080707929,.9806514375271693,1.002343860524502,1.0213169040780101,1.037367950617396,1.0502793389270608,1.0598341418138895,1.0658115821903422,1.0679873557875803,1.0661441881599507,1.060095142177868,1.0497194506110186,1.0350004114883102,
1.0160258495747416,.9929691812072535,.9660877368827762,.9357200551591125,.9022799159548959,.866247248049862,.8281562358984907,.788581126924277,.7481203878404024,.7073799648692163,.6669564589471636,.6274210283072403,.589304777201376,.5530862857045759,.5191817905416575,.4879383530252971,.45963016186647376,.43445617793757707,.41252488058202497,.3938585518831832,.37842743025350123,.3661771027618108,.3570435338400524,.35095675866333276,.3478367011258692,.34758480789245705,.3500627754175405,.35507672014041225,
.36239303576095727,.37176370848155016,.38295366522291197,.39576572995204384,.41005965345674544,.4257628010771272,.44287123701065007,.4614394297813891,.4815626149033538,.5033566695535229,.5269336777784737,.5523755098022484,.5797166869547387,.6089402670569886,.639990336830911,.6727668729287217,.707105208397686,.7427705137717541,.7794682290687314,.8168664933932096,.8546245294373293,.8924200953119759,.9299695601882063,.9670345593678915,1.0034135237192656,1.038922790451041,1.0733692811028857,1.1065258129188178,
1.1381462583028654,1.167981520578999,1.195774826546591,1.2212615629393615,1.2441789678810773,1.2642882046349608,1.2814091612828138,1.2954613851665742,1.3064680277816199,1.314537523024402,1.3198621111769684,1.3227151420495775,1.323444935080515,1.322465346927112,1.3202433918579701,1.317284439220649,1.3141156611224223,1.311268510084795,1.3092610620718441,1.3085810605154589,1.3096704421152081,1.3129120203689344,1.3186188996038541,1.3270278074855764,1.3382964019204509,1.3525011458687421,1.3696228149336247,
1.3895543028743584,1.4121360852785658,1.4371825940927923,1.464496493731233,1.4938720544531006,1.52509109826322,1.5579151992129157,1.5920653817619899,1.627207617802154,1.662970515070472,1.6989729353772778,1.7348532315482172,1.7702960336151463,1.8050530236326685,1.8389551483426692,1.8719150968833491,1.903920171890729,1.935016686707291,1.9652876406442996,1.994825702911334,2.0237042293009395,2.051957478794356,2.079573852784881,2.1065058303327806,2.1326624410678834,2.1578865849899262,2.181947675521755,
2.2045515737176036,2.2253669230725945,2.2440557867784925,2.260301099454599,2.2738267193469195,2.2844054907926727,2.2918532695700176,2.296009928946292,2.29671134222448,2.293764108435334,2.286960321625104,2.2760934272936013,2.260953726972252,2.241328798196994,2.2170140748107823,2.187835706340252,2.15368604200145],pressure:[.9866018149203939,.9891496105622892,.9917450254304312,.994380728144874,.997049007868631,.9997418209453748,.9975491578601124,.9948324800354412,.992116864499552,.9894111359450569,.9867241610586309,
.9840647833795766,.9814417575898498,.9788636840487775,.9763389443918268,.9738756390047715,.9714815271624753,.9691639705855494,.9669298811190113,.9647856731756599,.9627372215144043,.9607898248416784,.9589481756339813,.9572163364833446,.9555977231670616,.9540950945403603,.9527105492478817,.9514455291488751,.9503008292538646,.9492766138790013,.9483724386400609,.9475872778325141,.9469195566785281,.946367187867121,.945927611770684,.9455978576161193,.9453748262934796,.9452555159667924,.9452368966618673,
.9453157618049671,.945488608939161,.9457515554370848,.9461002923865536,.9465300772037712,.9470357630747104,.9476118611694557,.9482526298227899,.9489521836028577,.9497046144412692,.9505041167815508,.9513451089949079,.952222338833685,.9531308281820547,.9540656897072954,.9550221915745875,.9559958687853909,.956982615159602,.9579787540708916,.9589810878267332,.9599869269549192,.9609941017137626,.9620009588385185,.9630063468583004,.9640095932833449,.9650104766171781,.9660091955604136,.9670063370273939,
.9680028437875745,.9689999817653555,.9699993072443971,.9710026477622776,.9720120843481687,.9730299038045503,.9740585412971816,.9751005173499331,.9761583697984022,.9772345821570197,.9783315107943619,.9794513141888807,.980595883943932,.9817666973874425,.9829646078829425,.9841897438661644,.9854414656074116,.9867184375831489,.9880186519169296,.9893393924438391,.9906772241255606,.9920280112958411,.9933869630498338,.994748703313429,.9961073624343546,.9974566865277754,.9987901602895227,.9998988614327514,
.9986170183352492,.9973708108378998,.9961664730185051,.9950098574651497,.9939063369277107,.9928607271737389,.9918772348189594,.9909594387944449,.9901103171200186,.9893322890498594,.9886272768436233,.9879967939533503,.9874420559769108,.9869641090387211,.9865639688825478,.986242762505089,.98600176423896,.9858420100272737,.9857641009517827,.9857682511817658,.9858543525456029,.9860220408360633,.9862707566331871,.9865997932012541,.9870083242926067,.9874954054928327,.9880599440582666,.9887006339834253,
.9894158552155466,.9902035383986648,.991060999148639,.9919847484854623,.9929703324246981,.9940125294289117,.9951056125575274,.9962433980651921,.9974192816246905,.9986262798407575,.9998570767097921,.9988959254022277,.9976405507696177,.9963847918828266,.9951367482328917,.9939045630024187,.9926963584057241,.9915201704538491,.9903838839406923,.9892951684538845,.9882614162079131,.9872896824773426,.9863866293750465,.985558473674694,.984810939319179,.9841492151883344,.983577918621467,.9831010651045374,.9827220444398878,
.982443603620109,.9822678365288552,.9821961804920624,.9822294196050328,.9823676946660356,.9826105193577241,.9829567979888036,.9834048417805731,.9839523970962888,.9845966807308286,.9853344191161331,.9861619087304412,.9870752984376677,.988070817501658,.9891446598093735,.9902928384076222,.9915110651862782,.9927946658762894,.9941385336388945,.9955371217973742,.9969844738046907,.9984742863809899,1,.9984450903713243,.9968677121270904,.9952744875371956,.9936718096996381,.9920657341886374,.9904620311699777,
.9888663654132979,.9872842280734382,.9857208217175755,.9841809646163039,.9826690162289506,.9811888240324205,.9797436904734493,.978336357769347,.9769690075873053,.9756432723106258,.9743602546343546,.973120552577456,.9719242875854831,.970771134141817,.9696603501130615,.9685908078301525,.9675610265631437,.9665692075105425,.9656132726398041,.9646909086550918,.9637996170298007,.9629367704503152,.9620996752254871,.9612856382968633,.9604920365276005,.9597163850525094,.9589564050463465,.9582101711019176,
.9574763220889313,.9567541644578996,.9560437189485653,.9553456527608639,.9546612616523787,.953992512315859,.9533420602024139,.9527132391897694,.9521100246493983,.9515369722336489,.9509991353902433,.9505019648931585,.9500511800084429,.9496526079574786,.9493120452984944,.9490351304446004,.9488272231801915,.948693296156923,.9486378431343829,.9486648082553625,.9487775399697185,.9489787723424316,.9492706354090938,.9496546949961987,.9501320210378708,.9507032819418675,.9513688610450911,.952128989722337,
.9529838903492442,.9539339208784796,.9549796128832014,.9561212867711385,.9573588552085929,.958691869915316,.9601195840424478,.96164101527107,.9632550024576982,.9649602484409767,.9667553419146738,.9686387520874259,.970608791178629,.9726635415977706,.9748007468438836,.9770176676381271,.979310911748267,.9816762653393807,.9841085488280269]},{distance:[-.5230021157043929,-.5245024963030356,-.5252482392394429,-.5252224060435445,-.5244111493860191,-.5228039092809582,-.5203935828442765,-.5171766647283622,
-.5131533557072674,-.5083276372945535,-.5027073107312092,-.49630399917593304,-.48913311245561186,-.4812137742802222,-.4725687123831397,-.4632241126041283,-.4532094384770349,-.44255721840658213,-.4313028030081218,-.41948409563096856,-.4071412594810413,-.39431640509422633,-.3810532621816436,-.3673968400668945,-.3533930810599513,-.33908851116092603,-.3245298924594718,-.3097638814936703,-.29483669765918563,-.2797938055200011,-.2646796145722719,-.24953719966009036,-.23440804484447297,-.21933181309374522,
-.2043461437041973,-.18948635949607937,-.17478373259298494,-.16026411922971517,-.14594894022940763,-.13185636374865378,-.11800235378287921,-.10440155000676468,-.09106795686850047,-.07801543196184502,-.0652579750323369,-.05280982907344697,-.04068541347947299,-.028899115901942912,-.017464974176693265,-.006396282430014749,.004294843687151301,.014597880420145315,.02450350794366568,.034002592837129086,.043086560543327046,.051748060735316403,.059981555596032465,.06778380432267,.07515422577395736,.08209512882223552,
.08861180724474077,.09471250262190112,.10040824451189068,.10571258202125366,.11064122474019633,.11521161386461554,.11944244623553868,.12335317506953591,.12696351142333373,.130292958879218,.13336055573481959,.1361847358653384,.13878302130536557,.1411717762630611,.1433660804959504,.14537973255524822,.1472253891202342,.14891484181355907,.1504594275027359,.15187049257328689,.1531585077289891,.15433092239584728,.1553915155824131,.15634035494621257,.15717478588044176,.15788962845973276,.1584765887223744,
.15892385881330218,.15921598078641408,.15933398609998167,.15925580599478978,.15895693155867752,.15841128727698334,.15759226908479146,.15647388808154217,.1550319546792952,.15324523537183338,.15109651565550714,.1485735078052315,.14566955089659128,.14238406215840704,.13872271241212042,.13469726632194218,.130325010714683,.12562804274741163,.12063241122008023,.11536708395993156,.10986279781508967,.10415085634263166,.09826194355932832,.09222502311592012,.08606692168271418,.07981430657634309,.07349475835825003,
.06713662375829427,.06076884890214029,.05442083672669851,.048122325062597227,.04190328018443651,.0357937997708771,.029824019210239416,.024024015988190983,.01842370838397589,.013052746699166562,.007940397518807485,.003115423800601008,-.0013940343657616594,-.005560625432242117,-.009358366464557288,-.012763237007910877,-.015753471952247217,-.018309816401984202,-.02041576146555374,-.02205775727056919,-.023225399743714015,-.023911587992750505,-.024112649487433163,-.023828430651235633,-.02306235094002873,
-.021821418989192154,-.020116209948220554,-.01796080368183528,-.015372684088500038,-.012372600360217229,-.008984391570597994,-.005234776520604251,-.0011531112826504153,.0032288826458526376,.007877416247791147,.012756953255624703,.017830548790608636,.023060202147690778,.028407219343962453,.033832580964865966,.03929731083303928,.04476284108819312,.05019136939978286,.05554620178941827,.06079196972625234,.06589464921370536,.0708217208022332,.07554236755981908,.08002764748630703,.08425075820616851,.08818874571388213,
.09182388786148654,.0951428413756783,.09813546909062548,.10079373215553605,.10311075415553106,.10508008157252507,.10669515118698736,.10794896358461115,.10883395172180982,.10934202487772016,.10946476152228007,.10919371979023917,.10852083139087054,.10743884382593671,.10594174840781045,.10402441363610238,.10168159526381704,.09890834200277265,.09570069911940748,.09205633917977918,.08797509244997215,.08345935801651405,.07851438430060997,.07314841489142226,.06737270224974173,.06120139764131999,.054651330529839226,
.0477416945416923,.04049366001438237,.0329299351071356,.02507429856452753,.016951127572997826,.00858494382659547,0,-.008780072629196445,-.017732536628801754,-.026835724611088074,-.03606910583433229,-.04541323336583333,-.054849566033077335,-.06436016402945485,-.07392726223744317,-.08353280066729643,-.0931593151615562,-.10279209882606705,-.11241987671519085,-.12203488125814421,-.13163190572052036,-.14120815685849314,-.15076389919051802,-.16030291518899406,-.16983270536403366,-.17936441493991118,-.1889124906522445,
-.19849408758283069,-.20812825832602494,-.21783485267957758,-.22763312055109808,-.23754048409021172,-.24757141530277327,-.25773640844148665,-.2680411073844964,-.2784856401232931,-.2890642008264259,-.2997649059624766,-.3105699354550246,-.3214559536849835,-.33239478926366123,-.3433543377644385,-.3542996388432084,-.3651940691031959,-.37600058522020424,-.3866829486082416,-.39720686195915,-.40754041860827417,-.41765215447999626,-.427510001708245,-.4370814584440855,-.44633377477477887,-.45523411080817866,
-.46374967041431403,-.4718478158245648,-.4794961691756422,-.48666270711806536,-.49331585383227317,-.4994245763284779,-.5049584839305334,-.5098879315942181,-.5141841325569381,-.5178193144018676,-.5207669075813892],pressure:[.8306272633087632,.8228571076572637,.8153000224609548,.8079838851020156,.8009361011210492,.7941833830030056,.7877515296677573,.7816652094740008,.7759477495699525,.770620934400103,.7657048161032419,.7612175394133187,.7571751835028695,.7535916229911725,.7504784100796043,.7478446794793895,
.7456970774675764,.7440397160518524,.7428741528506376,.7421993969091074,.7420119402820105,.7423058148281223,.7430726732865105,.7443018933488548,.7459807031117409,.7480943259943952,.7506261429462197,.7535578695493137,.7568697454475048,.7605407334077464,.7645487252435035,.7688707518031628,.773483194248789,.7783619939197723,.7834828581892628,.7888215304941855,.7943549265743916,.8000620814033437,.8059237261051776,.8119217425461789,.8180386863267316,.8242573930286576,.8305606774466032,.8369311306465468,
.8433510151811057,.8498022547502866,.8562665110903451,.8627253379330171,.86916039950769,.875553739247583,.8818880830851048,.888147146963997,.8943155601410728,.9003784870642859,.906321946820671,.9121332794798509,.917801568611746,.9233179989843753,.9286761324324326,.9338720889876022,.9389046249045825,.9437751040577974,.948487364168275,.9530474842850134,.9574634647204375,.961744835051232,.9659022096695618,.9699468135356936,.9738900030821558,.9777428123469353,.9815156165956411,.9852178918578764,.9888579607190948,
.9924428357365057,.995978194502314,.9994684956769921,.9970827613929034,.9936726382119915,.990298232296132,.9869561038487373,.9836428333808174,.9803566647105523,.9770979520563435,.9738692042943523,.9706746158528428,.967519989315871,.9644130463294933,.9613636424985745,.958383848866657,.9554878937203887,.9526919668010134,.950013896122789,.9474727150342134,.9450881434969897,.942880012449173,.9408676632967224,.9390693558740655,.9375017175690735,.9361792637708016,.9351140155256978,.9343152345329298,.9337892888355972,
.9335396722537141,.9335672049097944,.9338703131806108,.9344453870349423,.9352872185553254,.9363894937495745,.9377453058507775,.9393476567947157,.9411899131910545,.9432659202313483,.9455689250834624,.9480909497750494,.9508227710608106,.953753912461762,.9568726280109225,.9601658808296828,.9636193205125501,.9672172637207003,.9709426823589302,.974777203257478,.9787011224579527,.9826934361013292,.986731888650128,.9907930378761077,.9948523348446512,.9988842427262797,.9971374225691321,.9932391289602219,
.9894473986087092,.985788582057273,.9822886274699182,.9789728478327465,.9758656890951467,.9729905023065344,.9703693228289245,.9680226596788103,.965969297972104,.9642261173135049,.9628079287879259,.9617273329790645,.9609946011624249,.9606175815017696,.960601631724653,.9609495793707947,.9616617103036402,.962735785758106,.9641670877741124,.9659484924440864,.9680705699911336,.9705217103007491,.9732882721600339,.9763547541210889,.9797039846054822,.9833173286094813,.9871749081591465,.991255832021221,.995538366239873,
1,.9953823887447714,.990632331010032,.9857735678303545,.9808297866037201,.9758234904977154,.9707750414591048,.9657030337020568,.9606248326143578,.9555570707824004,.9505160598642948,.9455181077348077,.9405797358369736,.9357177962251985,.9309494918645408,.9262923072972971,.9217638597699658,.9173816833253194,.9131629602176328,.9091242153260362,.9052810040381926,.9016479821690183,.898239275300488,.8950681487540328,.8921465291037196,.889484568210462,.8870902710510747,.8849692046475397,.8831243013132237,
.8815557648966109,.8802610838639934,.8792351500750384,.8784704771324049,.877957507398665,.8776849923449298,.8776404270004013,.8778105160806752,.8781816470445274,.8787403440060298,.8794736762277192,.8803695959244717,.8814171823588509,.882606772701165,.8839299648017747,.8853794827626573,.8869489028248166,.8886322443763066,.8904234385493537,.892315752238722,.8943023468485682,.8963779260282129,.8985391908846717,.9007848954710846,.903115391711105,.9055325684849259,.9080401810946777,.9106440863994827,.913352345798788,
.9161751893819156,.9191248428992848,.9222152273307168,.9254615473053227,.9288797483724874,.9324858479253182,.9362953179043332,.9403225047148771,.9445800909584874,.9490786287629377,.9538261704339563,.958828016403189,.9640865935518256,.9696014693451538,.9753694992576356,.9813850971534366,.9876406110557286,.9941267804963657,.9991667532650987,.9922509161551649,.9851366828333391,.9778346047329646,.9703546813166875,.9627074231467382,.9549044669023731,.9469585849692052,.9388836845154047,.9306948166066128,
.9224081923039349,.9140412018176374,.9056124323475037,.8971416802470795,.8886499535820267,.8801594619544029,.8716935915448706,.8632768645673531,.8549348806500352,.84669422767966,.8385823593736481]},{distance:[.21608462359966324,.17985330091326251,.1429808911510531,.1055608990485295,.06769156195654308,.029475280704593432,-.008982005424617745,-.047571493378292584,-.08618223354200721,-.12470188153971729,-.1630174760080388,-.20101623317870315,-.2385863487024183,-.2756177969056899,-.31200311759671007,
-.3476381806309835,-.3824229187118804,-.4162620193320637,-.44906556735114994,-.48074963044202146,-.5112367805085022,-.5404565451633492,-.5683457844378438,-.5948489890507773,-.619918497772055,-.643514632650122,-.665605752108519,-.6861682231307964,-.70518631492145,-.7226520175316642,-.7385647899524452,-.7529312430867978,-.7657647638020963,-.7770850869221135,-.7869178225367683,-.7952939971772472,-.8022502122394455,-.8078287345280064,-.8120766422715775,-.8150448636826926,-.8167872288550904,-.8173595390451198,
-.81681866085376,-.8152216566815507,-.8126249665022558,-.8090836589496726,-.8046507714578934,-.7993767593673089,-.7933090722746143,-.7864918723943664,-.7789659044125087,-.7707685823365151,-.7619359573027238,-.7525061070713175,-.7425193689295806,-.732017792798141,-.7210445760669126,-.7096434845647199,-.6978582556269457,-.685731975053429,-.673306418356378,-.6606213483983281,-.6477137663261998,-.6346171203247604,-.6213604865557256,-.6079677478792072,-.5944568075410152,-.580838885803034,-.5671179563140921,
-.553290388400328,-.5393449229148207,-.5252630013680049,-.5110193736805249,-.4965831081546308,-.4819190417830187,-.4669896684107442,-.4517574362126394,-.4361873981165894,-.4202501308146268,-.4039247081139521,-.3871995180761134,-.3700708828387643,-.3525435277375217,-.33463059852258953,-.3163502735491748,-.2977250417422422,-.2787837773898456,-.259563427582968,-.24011009760771904,-.22047950695166404,-.20073682053411152,-.18095589025687436,-.1612179697354456,-.14160998899735625,-.12222249509890584,-.1031473783061852,
-.08447551124382408,-.06629443001995244,-.048686181827635566,-.0317254531885488,-.015478077363084652,0,.01466313784540868,.028475593171839897,.04141083932028716,.05345054509250119,.06458310555448282,.07480180109961787,.0841026869190254,.09248233273544293,.09993554859570014,.1064544296118029,.11203254886176456,.11666697384081715,.12035745594387859,.12310553585642109,.12491374120552817,.12578495442393156,.12572202689183104,.12472770928386157,.12280495748684922,.1199576585121826,.11619180179215521,.11151709866464038,
.1059490275090425,.09951125492632196,.09223835574954459,.0841780808626203,.07538839183189922,.065933670167164,.055884138293318064,.04531547788343576,.034308381623327,.022948041762769156,.011323579798992067,-4.725774162141483E-4,-.012345368972990212,-.02419781163259621,-.03593174432104124,-.047448597137837556,-.05865017617908769,-.06943945516265232,-.0797213646793401,-.08940356988195652,-.09839722756470104,-.10661771387604857,-.11398531434302797,-.12042586845442393,-.1258713617426863,-.13026045910428968,
-.13353897398873252,-.13566026904831816,-.13658558485386701,-.136284294324511,-.13473408157132083,-.13192104489366646,-.12783972467375893,-.12249305432276139,-.11589208023247813,-.10805535065778654,-.09900847495407356,-.08878371714322564,-.07741954142734969,-.06496016708152436,-.05145573470319331,-.03696226299295097,-.02154029857174805,-.005253841370568668,.011830485494478571,.02964425365619322,.0481180343547038,.06718217994575687,.08676756790637752,.10680629002676473,.12723226751806904,.1479817723795876,
.16899383679035246,.19021053559210227,.21157713201511702,.23304202057988294,.25455480246749224,.27606295170998013,.29751164940360025,.31884440793147434,.3400037223243753,.3609317429035745,.381570971700728,.4018649892531914,.421759219717264,.4412017405140038,.46014413790951464,.4785424023284142,.4963578473908506,.5135580254874752,.5301176011938449,.5460191331241753,.5612537061136926,.5758213500175187,.5897311798885712,.6030011955778347,.6156576873120798,.6277342076130861,.6392700887085987,.6503085076385513,
.6608941275040408,.671070371347884,.6808764133574914,.6903441021856163,.6994970277017785,.7083517732497631,.7169173079648041,.7251948217177246,.7331809573465766,.7408683710764379,.7482434919176353,.755284666191498,.7619609039446538,.7682312567322345,.7740448243515958,.7793413576435593,.7840524024957969,.788103161637089,.7914151123452815,.793908384586598,.7955040592806892,.7961264260628995,.7957050782852255,.7941767320993252,.7914866720894065,.7875897461129868,.7824508558575007,.7760449160827012,.7683562834439595,
.7593776839731985,.7491086955134583,.7375538664737085,.7247205740833951,.7106167428901842,.6952485600257388,.6786195206915735,.6607346334622037,.6416024610005504,.6212343456855973,.5996435628623165,.5768445777136231,.5528524831738091,.5276826942395836,.5013509677300951,.4738738058283361,.4452692866492523,.415558345913795,.38476651110671806,.3529260639940504,.3200784847008931,.28627663451335467,.25158659508755604],pressure:[.5691853069271902,.5761598493086387,.5836549660102934,.5916573520448034,.6001508826342608,
.6091166464253608,.6185330073048972,.6283756948595924,.6386179231004783,.6492305366430691,.6601821831086752,.671439510097985,.6829673846938752,.6947291330845184,.7066867975679297,.7188014079121487,.7310332638074759,.7433422249637005,.7556880052800675,.7680304674515567,.7803299143732598,.7925473737652676,.8046448725621459,.8165856977910675,.828334640897044,.8398582227573012,.8511248969535365,.8621052292335775,.87277205148512,.8831005889556311,.8930685598756851,.9026562470694923,.9118465415578232,.9206249585669208,
.9289796267448683,.9369012645105497,.9443832946275551,.9514219246086814,.958015972695876,.9641666500055281,.969877329688016,.9751533048305506,.980001537895476,.9844304056209323,.9884494443726087,.9920691017867442,.9953005010651146,.9981552243794061,.9993548785423636,.9972178514572466,.99542175843976,.993954758638614,.9928047095247959,.9919584127707295,.9914016519524977,.9911194238220511,.9910961708694461,.9913160132529906,.9917629804187322,.992421243901537,.9932753532695826,.9943104768616842,.9955126478674181,
.9968690144860597,.99836809051787,1,.9982432933421748,.9963677837106009,.994377261967434,.9922732115434169,.9900547878881953,.9877188896460122,.9852603133654619,.982672015266634,.9799454878291936,.9770712502891903,.974039445602097,.9708405294543054,.9674660298926003,.9639093235251687,.9601658726706248,.9562329129523883,.9521096083055939,.9477975472265934,.9433024760349076,.9386346992408013,.9338081018429565,.9288391328799878,.9237458494286502,.9185470488941134,.9132615110442585,.9079073650469085,
.9025015909919765,.8970596601641208,.8915953137503946,.8861204757339449,.8806452924004764,.8751782880941458,.8697266245092423,.8642964487958301,.8588933140065609,.8535226539865908,.8481903106699366,.8429031227552255,.8376694633048203,.8324997194620253,.8274067193710991,.8224060852356061,.8175164920651409,.8127598137384923,.8081611402073383,.8037483546257409,.7995503371139331,.7955956688242404,.7919120365365417,.7885256878072128,.7854609327388127,.7827397128947081,.7803812564949162,.7784018369902248,
.776814649391961,.7756298153176305,.7748545236021089,.7744933085539024,.774548462577634,.7750205740522824,.7759091752015157,.7772132858730902,.7789304463089728,.7810555710203411,.7835808141436744,.7864955405844698,.7897863246004999,.7934369767912894,.7974286000789335,.8017396748609863,.8063461730961242,.8112217006554178,.8163376668445226,.8216634795832819,.8271667643274929,.8328136044410652,.8385688003832349,.8443961447719726,.8502587101275652,.8561191458948828,.8619399811933006,.8676839296526522,
.8733141926636808,.8787947574026184,.884090686080828,.8891683930196655,.8939959063543419,.8985431114240032,.9027819732028567,.906686735462446,.910234094720982,.9134033468359699,.9161764791106501,.918538190012956,.9204759186558265,.9219798607673199,.923042957079141,.9236608678883123,.9238320850823001,.9235580464146217,.9228430919037494,.9216942669990001,.9201210458884687,.9181350420369514,.9157497106250858,.9129800471956804,.9098422878469173,.9063536171341544,.9025318903324264,.8983953767777635,.8939625305899994,
.8892517941667604,.8842814384551524,.8790694580084111,.8736339403730646,.8679937957526065,.8621686978158929,.8561788339394514,.8500446571771394,.8437866418716297,.8374250425589985,.8309796546286788,.8244695747146323,.8179129590904861,.8113267794265044,.8047265770669956,.7981262193569987,.7915376642770159,.7849707424754298,.778432968431491,.7719293946406127,.7654625241065128,.7590322968077878,.7526361649951657,.746269270062079,.7399247302972876,.7335940441530112,.7272676079223305,.7209353401843857,
.7145873983936859,.7082149659703532,.7018110556257644,.6953707730753351,.6888910304064145,.6823707258358536,.6758112634531285,.6692183084851477,.6626022079449607,.6559770312632268,.6493595700087734,.6427683956848932,.6362230032549527,.6297430616751711,.6233477865403865,.6170554432362672,.6108829414420588,.6048454970530781,.5989565028286026,.5932275528905984,.5876685831118744,.5822881146472749,.5770935860664862,.572091757804684,.5672891711020842,.5626926422314712,.5583097716306931,.5541494466226621,
.5502223158132062,.5465412131295428,.5431215099368856,.5399813748850868,.5371419232114099,.53462723941573,.5324639621775302,.5306794982966765,.5293007393859444,.5283534815866524,.5278618983560898,.5278480623965962,.5283315372279409,.5293290574887453,.5308543149828084,.5329178647334012,.5355271618562389,.5386867359143759,.5423985046099122,.5466622232581835,.5514760418344251,.5568370630070936,.5627418189934147]},{distance:[-.8072011945926201,-.8101781789378402,-.8100819490250073,-.8068201103704006,
-.8003512140464928,-.7906883987123778,-.7779010417671035,-.7621142552830881,-.7435061846983948,-.7223031977197398,-.6987731775019942,-.6732172479084149,-.645960350480181,-.6173411554857449,-.5877018184805887,-.5573780875782919,-.526690226598082,-.49593514976010367,-.46537804365119384,-.4352270584351285,-.4056279369566598,-.37669273937946207,-.348522922519962,-.3212210129150559,-.29489150970207145,-.2696336152632359,-.24553038230198349,-.22265051570638542,-.20105218147527676,-.18076806436851875,-.16179305459434307,
-.1440794551992521,-.127539756456013,-.11205567506124686,-.09749124252513666,-.08370707972038513,-.07057107984634275,-.057965643620492946,-.04579234631640394,-.03396953649705481,-.022423779244509112,-.011101963391159542,0,.010841448503387863,.021335982439837753,.03134502423686286,.04068579840257286,.0491534388337459,.05655240185623167,.06273015066584714,.06760549251741227,.07118506251111661,.07356299586868115,.07490372313996857,.07541413209201292,.07530957898235036,.07478588038454065,.07403235446055628,
.07324823259644742,.0726394241768662,.07241505384851388,.0727845780852549,.0739548725466036,.07612699266769374,.07949209491659132,.08422092934121739,.09045147834372058,.09828144243539738,.1077624602577254,.11889606262702862,.13163186147706374,.1458680190144992,.16145365701790954,.17819342349255163,.19585407920660813,.21417279005106837,.23286671377534418,.25164340056086454,.27021149067883277,.2882910874337047,.30562125900672843,.3219644088236595,.3371133352144283,.35091608420734044,.36328235808398657,
.3741546225386897,.3834836688869757,.39121584531376796,.3972914386144367,.40165163291010353,.40424945606341767,.405048450361593,.404019667586327,.4011576798743891,.3964941440477321,.3901039357319329,.38210371052571157,.37264409931949904,.36189766528548883,.3500452324275396,.3372632968407081,.323715024240682,.3095468080958761,.2948916053536138,.2798780018221271,.26461813327128325,.2491784738174898,.23358312164573614,.21781145466430096,.20179007666419901,.18539906200816103,.16849313410300432,.15093554128426906,
.13263274850106388,.1135619109399641,.09378649724284494,.07345632737644492,.0527916992700862,.032054842125519956,.011514798754285627,-.008581591639872599,-.02799750956407243,-.04649042810293991,-.06381584695425035,-.07973106288596343,-.09399817084698497,-.10638691086210977,-.11667774921363519,-.12466627946697867,-.1301739689647381,-.13306024232270192,-.1332296269679238,-.13063713726253068,-.12529193887477036,-.11725902255065579,-.10665872256719783,-.09366403747724183,-.07849584023872902,-.06141619144694904,
-.04272008314074466,-.02272603249396199,-.0017660074633861211,.019824804455409795,.04171787942038441,.06360042745092942,.08518325418607409,.10620913864717063,.12647814517664635,.1458530010151366,.16423038195203626,.181517846923561,.19762218251474728,.21244852123725444,.22590763553428994,.23792681869999577,.24844811416168222,.25742454060023734,.2648350676970387,.2706968189683444,.2750695182237136,.2780525874551334,.279776064666882,.28038747540225495,.2800375208401146,.27886936097901394,.2770114037568443,
.2745728074284769,.2716458950912125,.26831463267388334,.2646424472408201,.26064346147994266,.2562867058025856,.25149508263924547,.24613888548594276,.24004374845489818,.23301273328434524,.22485773228142347,.21543315278414576,.20466426425294348,.192563701453918,.17923116509652937,.1648362537031285,.14959066967661555,.13371428137273444,.11740717135402118,.10086273864928852,.08428417480088374,.06788129529518239,.05186714451826968,.03645517983173757,.02185642505113139,.008276294582728938,-.0040894254835193156,
-.015065029779289918,-.024507205622974648,-.032312504698705335,-.03842308796550048,-.04283075649028967,-.04557896942330786,-.04676265819797182,-.04652577076357878,-.04505661219719492,-.042581178408700515,-.03935479788169144,-.03565249349370575,-.031758545295410945,-.027955771093150228,-.024515146478500616,-.021688310299507796,-.019703215334662738,-.018757102578389917,-.01899169428117753,-.02048684193316075,-.023289485013608058,-.02743816260305254,-.032975862308382564,-.03995172341425801,-.048414166097628386,
-.05840003427519208,-.06993601381691505,-.08304172081485,-.09771360799493986,-.11391106369447246,-.1315502196486286,-.15050543550985684,-.17061715045152862,-.19170397289165406,-.2135763978002242,-.2360494398435601,-.2589516777952574,-.282128671695019,-.30543942690027237,-.3287472861034805,-.3519320667579203,-.37491933183126214,-.39767716103420836,-.42021854939892794,-.4426095121676621,-.4649628875607328,-.4874172018243828,-.5101028326420941,-.5331073522898042,-.5564480842174437,-.5800565052730963,
-.6037782284297732,-.6273888918596129,-.6506227164530787,-.6732076294666526,-.6948942829550503,-.7154438664244314,-.734612371720981,-.7521543147253889,-.7678264893053004,-.7813909587774454,-.7926179517339738,-.8012889735871088],pressure:[.9895161204160292,.9840369169707215,.9784068120671994,.9726804932985318,.9669164911941968,.9611756349947668,.9555193564328459,.9500079206353288,.9446986702741492,.939644370359935,.9348917363391005,.9304802176887117,.9264410937819363,.9227969196335665,.919561337761559,
.9167392505148594,.9143273265177952,.9123147969019898,.9106841387391272,.9094087574718269,.9084538413232024,.9077827245489216,.9073619683549731,.9071641596931399,.9071685358709455,.9073598951494696,.9077266069755795,.9082605244033102,.9089570435873076,.9098118411066024,.9108179720492353,.9119642080127434,.913234664855292,.914609533110812,.9160665605279547,.9175828251774112,.9191360769467644,.9207055714734607,.9222724315523534,.9238188941216838,.9253266137756333,.9267785743666402,.9281647572521012,
.9294868784873791,.9307576026937193,.9319946677575254,.9332149421956271,.9344292780022139,.9356386786915559,.9368322233052442,.9379870443788852,.939070438451201,.9400440298447089,.9408693957558052,.9415139108562515,.9419559972406757,.942187975041144,.9422110354579915,.9420293359153966,.9416477810073915,.9410708251374598,.940302687590655,.9393494185232419,.9382229203268148,.9369459420711188,.935551295578087,.9340776914349957,.9325684486432844,.9310702853779718,.929631891800105,.9283023269617454,.9271293290111462,
.9261576614257422,.9254275502768614,.9249732858715628,.9248220581512397,.9249930805897455,.9254970390793739,.9263358819532268,.9275029600636553,.928983761999237,.9307571820364604,.9327963827533055,.935066633375772,.937526566646929,.9401346572009158,.9428541148608053,.9456554682305777,.9485169658472052,.9514232607322315,.9543631975494523,.9573295104039431,.9603186815570695,.9633274970641268,.966349987265947,.9693756358902814,.9723889116051327,.9753699381296339,.9782959545063858,.9811431280128201,.9838882592504097,
.9865099501789348,.9889888892029551,.9913070325240627,.993445877212312,.9953883812739592,.9971246839684085,.9986569305711684,.9999985986505425,.9988312521944703,.9978137984702864,.9969355924443742,.9961928360206964,.9955937088467133,.9951583924078183,.9949169503663974,.9949052983708871,.9951598157104113,.9957114427543419,.9965802856394443,.9977726000420989,.999285634128917,.9988866672170534,.9967516583028833,.9943170215531937,.9915912161548341,.9885857796289006,.9853195238885313,.9818232308407445,
.9781384833118625,.9743133849987378,.9704011654247371,.9664588589904201,.9625457650654404,.9587217561753422,.9550455133513582,.951572774723807,.9483546847076008,.9454363263954315,.9428555093092011,.9406418692401979,.9388163177469236,.9373908575079039,.9363687578434029,.9357450640224984,.9355073959954576,.9356366339368338,.9361046023720341,.9368749258471302,.937909392988946,.939173037766169,.9406369381556612,.9422788401478532,.9440820672669532,.9460335292603512,.9481236325255258,.9503463371768919,
.9526958918631189,.9551639436683559,.9577379114828771,.9604006269972256,.963131069677962,.9659058534180843,.968701003322356,.9714933004649385,.974261126910736,.9769848594942763,.9796461247969585,.9822260955240006,.9847073942749285,.9870797536471962,.9893447450320745,.9915149838875509,.99360824569994,.9956415145232984,.9976258269661501,.9995624313929609,.9985592968380168,.9967618860530656,.9950776662223739,.9935446134195047,.9922007326918585,.9910782210894934,.9901982249679258,.9895679961952346,.9891859254671472,
.9890474529763778,.9891472927276156,.9894806345549308,.9900429330659372,.9908278449949057,.9918232104795446,.9930060605339519,.9943434021475821,.9957963826908263,.9973215799258396,.9988722101499593,.9996004476445592,.9981454738888434,.9968106513272266,.9956408104786506,.9946762611412829,.9939513891961305,.9934934881368193,.9933218800939079,.9934473628493744,.9938719989790262,.9945892560141427,.9955847426595942,.9968374786035789,.998320759770587,1,.998166008160129,.9962186106712366,.9941943939325292,
.9921225961716582,.9900247011575644,.9879157485229189,.9858065416151759,.9837039449632268,.9816110215558327,.9795304900171568,.9774678225344304,.9754330461549756,.9734412111372113,.9715117205073772,.9696668693047304,.9679300310447354,.9663239518640189,.9648695816251543,.963585794275754,.9624902291460241,.9616010241710629,.9609348913960201,.9605013915779249,.9602981039288054,.9603112939498704,.9605216574254417,.9609101319272801,.9614630294901548,.9621763031749019,.9630578675480818,.9641276148536168,
.9654152871560456,.966956437706885,.9687870339401776,.9709375460720899,.9734275428083042,.9762626660438132,.9794394647019092,.9829510898696023,.9867892898877801,.9909453725848987,.9954097538860016,.9998303119388501,.9947949028772902]},{distance:[1.073477664775138,1.0760386269477948,1.0772833751128177,1.077182055008552,1.0757103220196158,1.0728496920663297,1.0685878450185085,1.0629188754607861,1.0558434862729706,1.047369121222384,1.0375100335840224,1.0262872886944052,1.0137286992901509,.9998686934649925,
.9847481160802282,.9684139654639925,.9509190682143664,.9323216958606523,.9126851280172328,.892077167467664,.8705696133269087,.8482376990329641,.8251595024038415,.8014153353530469,.777087121080172,.7522577666399095,.7270105387426533,.7014284504557945,.675593666162726,.6495869317050148,.6234870360931374,.5973703105358394,.5713101698223575,.5453767003117955,.5196362979569504,.4941513179529629,.46897925735872037,.44417203077689105,.41977605280537106,.395832457432434,.37237736141755995,.34944217185608545,
.3270539342903352,.3052357135988542,.28400699594592627,.2633840967607714,.2433805574399857,.22400751254003232,.20527400984618582,.18718726793470786,.16975285961011793,.1529747640040181,.13685394023969016,.12138578833698932,.10656018603774664,.0923621790695256,.07877270559615268,.0657693465805469,.05332710081015746,.04141918697099378,.03001787659260957,.019095360660303262,.008624649181414146,-.0014195027723571396,-.011059656581953181,-.0203147618745112,-.029199270292640245,-.037722331299907985,-.04588711687668223,
-.05369032899632287,-.061121989173093305,-.0681655289555867,-.07479812954966814,-.0809914046471566,-.08671245584433662,-.09192529835658969,-.09659263366536874,-.10067792325750391,-.10414769504127896,-.10697390926022887,-.10913460021148946,-.11061276038654855,-.11139673273861705,-.11148170635688492,-.11087519218784081,-.10959822768357541,-.10768216589748636,-.10516535006240912,-.10208999286932174,-.09849935065248527,-.0944352622283493,-.08993610231163918,-.08503518093188078,-.07975960355702294,-.07412959193437918,
-.06815825301898237,-.061851772648659264,-.05521000160057432,-.04822739401965692,-.04089425162988636,-.03319822135084727,-.025125989324254916,-.016665186736010473,-.007806573243022363,.0014539779695187383,.011113696912844806,.02116128577619958,.03157550847905055,.04232406828899915,.053362834734053455,.06463547439350137,.07607448788045645,.08760665311560345,.09915686257877021,.11064971573484378,.12201095799094674,.13316878339923716,.14405493994184487,.1546055807672842,.1647618112908522,.17446989071288355,
.1836810572984311,.1923509596845825,.20043869142813875,.2079054427492103,.21471280160012385,.2208207553130137,.2261860817544602,.23076564817815381,.23452034048065362,.237415799807977,.23942287277794616,.24051802420457175,.2406837056710489,.2399086736837872,.23818825164865703,.23552453053658462,.23192650384028646,.22741013325625553,.22199834244242755,.21572093718664465,.2086144513564886,.20072191906834985,.19209257459273565,.1827814825834171,.1728491022595211,.16236079016214539,.1513862470314593,.13999891518891483,
.12827533354638532,.1162944579861715,.10413695535183087,.09188447965137991,.07961893929623465,.06742176427888624,.0553731821304011,.04355151129892987,.03203248288794347,.020888714701842392,.01018942157426972,0,-.009618402748752808,-.01860926505337812,-.026921050504776,-.0345080300550179,-.04133117277971943,-.04735866019174506,-.05256577352098524,-.05693443692154365,-.06045270845608064,-.06311423086065249,-.06491765152754303,-.06586602497394378,-.06596621425251437,-.06522830990741912,-.06366508587596909,
-.061291510985926556,-.058124332338711615,-.05418174297670031,-.049483191704697616,-.04405068269883139,-.03791119965188483,-.031096566090152544,-.02364266455715791,-.015588634033110838,-.006976053892405409,.0021518844065643306,.011751220417819397,.02177808661674485,.0321895921877815,.04294472830872498,.05400528884114275,.06533679283176963,.0769093865970214,.08869869422696575,.10068657702737005,.1128617556661472,.1252202445029662,.13776554653566742,.15050856018293224,.1634671560818184,.17666539326593406,
.19013235924867744,.20390063709579143,.21800442366713224,.23247734571866824,.24735004316588682,.26264769360639983,.2783892627438348,.29458851506993666,.31125352009545565,.3283850598569682,.34597106207078926,.36398531105903664,.38239058191472075,.40114189782779275,.42018959226718966,.43948208666822564,.4589683146605129,.47859974360795593,.498331966919233,.518126046493839,.5379497108582336,.5577777711811133,.5775919899363193,.597380557959325,.617137220104669,.6368600953435288,.6565502428952157,.6762100311441541,
.6958413707320056,.7154438772785817,.7350130324878895,.7545384146306895,.7740020701656434,.7933770971207604,.8126265073586739,.8317024286008892,.8505457004681505,.8690868665590787,.8872515624225755,.9049642869252424,.9221499180958745,.938735064773304,.9546492713379788,.9698260145393293,.9842034360856629,.9977247613398907,1.01033836324964,1.021997441582979,1.0326593006238671,1.0422842235935894,1.050833959029148,1.058269936641575,1.0645516720544315,1.0696354598401288],pressure:[.8035566534221908,.8029066234486641,
.8029630561572387,.803747434752605,.8052691776994239,.807524775309436,.8104974008196729,.8141570351094792,.8184611150124896,.8233556842824448,.828776996058471,.8346534885371322,.8409080336527599,.8474603436052913,.8542294131538002,.8611358770976558,.8681041719412341,.8750644073440443,.8819537806577296,.8887166400509109,.8953046657466505,.9016781592166756,.9078070354637227,.9136713587155069,.9192613452528862,.9245767117028113,.929625483423786,.9344252099227054,.9390034022265139,.9433920112564534,.9476212523629397,
.9517144701879539,.955684736061796,.9595335160028396,.9632513456662574,.9668200663199139,.9702158202931442,.973412069206184,.976381983633263,.9790995330010462,.9815393460209157,.9836797610987347,.9855087543258854,.9870246509457911,.9882361956939822,.9891627228067309,.9898325999316611,.9902802212790599,.9905421439380419,.9906530831505598,.9906425308626776,.9905327269320474,.9903387908898023,.9900712394096691,.9897401354043482,.9893606841395273,.9889582187865704,.9885646858204582,.9882155460231378,
.9879519141807018,.9878221920104381,.9878817636644416,.9881899196025524,.9888037215448153,.9897700072594777,.9911236497523962,.9928897650473119,.9950826720020142,.997704811071042,.9992539147598233,.9958163310666864,.9920176819646543,.9879048040659654,.9835348252492453,.9789734495963855,.9742929128497912,.9695697123117857,.9648822274877861,.9603083519919108,.9559232379606738,.9517969546931031,.9479921629172136,.9445625735808956,.9415528947791242,.9389988665277486,.9369261042697703,.9353491364266406,
.9342709426749365,.9336830739604314,.9335664716029517,.9338928652075635,.9346237956173667,.935710440164409,.9370994125378094,.938739222857091,.9405856941185207,.9426056329635653,.9447784069384256,.9470954825081908,.9495583536497095,.952175568194123,.954959683198473,.9579249122293271,.9610859907813111,.9644582398380019,.9680543998437745,.9718785325373297,.9759250915489013,.9801785956957639,.9846131754861347,.9891938321619427,.9938793223432855,.9986266273294172,.9966047787965038,.9918497228198898,.9871355080698349,
.9824820087167215,.9779039569590948,.973415315426437,.9690351821277438,.9647930373931517,.9607254218323615,.9568729437841168,.9532824270388266,.9500084469939325,.947112824794365,.9446612523467875,.9427168516945913,.9413324435240579,.9405491292535046,.9403983992868811,.940900930726219,.9420653218140077,.9438872369307152,.9463490265053414,.9494198608653369,.9530563878567624,.9572038931659781,.9617979120602145,.9667662141270245,.9720310606894462,.977511619615681,.9831264153269125,.9887956933180382,.9944435880889297,
1,.9945979857230822,.9894060323985937,.9844723682375817,.979836495824286,.9755281996179322,.9715670111580619,.9679622082408038,.964713469709692,.9618120711918576,.9592396747839816,.9569678976930398,.9549638402657756,.9531962490423564,.9516406079347228,.9502825258703004,.9491190655339308,.9481580660399986,.947415905441548,.9469145047253487,.9466783156496014,.9467319533419737,.9470991143888094,.9478027158341983,.9488618451902852,.950285834064939,.9520735494940182,.9542133275520155,.9566828084087643,
.9594504985528346,.9624787847887566,.9657278060220879,.9691594669703013,.97274082940435,.97644615146003,.9802567670332982,.9841585800139179,.9881379273399028,.9921759953807803,.9962438471234566,.9996940503540469,.9956767139916779,.9917487716399241,.987962082385204,.9843754197683697,.9810513838022367,.978050254610212,.9754219865517988,.9732044575075752,.9714256676158786,.9701026910040449,.969240587516739,.9688317381974026,.9688556581406221,.9692793148837593,.9700579517602642,.9711363857414632,.9724507205973344,
.9739303910337996,.9755004338812023,.9770838700163186,.9786040764706536,.9799870474381955,.9811637424105402,.982072419973164,.9826601882860277,.9828830685455368,.9827059716144204,.9821038668186322,.9810627574723236,.9795801563131822,.9776649796884477,.9753367429809522,.9726241773936759,.9695662216838756,.9662122107041409,.9626160563816616,.9588297180403401,.9548977727969012,.9508537530988366,.9467185787184169,.9425010286724171,.9381998231089347,.9338066078393872,.9293090099765098,.9246929888417168,
.9199439339828734,.9150465969777082,.9099882732829045,.90476491636475,.8993820824815684,.893855271904327,.8882103957964731,.8824825291679266,.8767130366040575,.8709451115005371,.8652195144682289,.8595713713094872,.8540283507035986,.848610758108077,.8433338200861042,.8382120513685981,.8332651520021668,.828523244091681,.8240235372628884,.8198073214607214,.8159220980454146,.8124230975690607,.8093727635312831,.8068374215607792,.8048808715632836]}]}})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define(["require",
"exports","../../lib/glMatrix","./SphericalHarmonics"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});var g=d.vec3d,f=d.vec4d,k=g.create();p=function(){function d(){this._renderLighting={main:{intensity:g.create(),direction:g.createFrom(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}};this._shOrder=2;this._oldDirection=g.create();this._oldSpecular=f.create();this._oldDiffuse=f.create();this._oldAmbient=f.create()}d.prototype.setUniforms=function(a,b){void 0===
b&&(b=!1);b||a.getDefine("GROUND_NORMAL_SHADING")?a.setUniform1f("lightingFixedFactor",(1-this._info.groundLightingFactor)*(1-this._info.globalFactor)):a.setUniform1f("lightingFixedFactor",0);a.setUniform1f("lightingGlobalFactor",this._info.globalFactor);a.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction);a.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity);a.setUniform1f("ambientBoostFactor",.4);b=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?
a.setUniform3f("lightingAmbientSH0",b.r[0],b.g[0],b.b[0]):1===this._shOrder?(a.setUniform4f("lightingAmbientSH_R",b.r[0],b.r[1],b.r[2],b.r[3]),a.setUniform4f("lightingAmbientSH_G",b.g[0],b.g[1],b.g[2],b.g[3]),a.setUniform4f("lightingAmbientSH_B",b.b[0],b.b[1],b.b[2],b.b[3])):2===this._shOrder&&(a.setUniform3f("lightingAmbientSH0",b.r[0],b.g[0],b.b[0]),a.setUniform4f("lightingAmbientSH_R1",b.r[1],b.r[2],b.r[3],b.r[4]),a.setUniform4f("lightingAmbientSH_G1",b.g[1],b.g[2],b.g[3],b.g[4]),a.setUniform4f("lightingAmbientSH_B1",
b.b[1],b.b[2],b.b[3],b.b[4]),a.setUniform4f("lightingAmbientSH_R2",b.r[5],b.r[6],b.r[7],b.r[8]),a.setUniform4f("lightingAmbientSH_G2",b.g[5],b.g[6],b.g[7],b.g[8]),a.setUniform4f("lightingAmbientSH_B2",b.b[5],b.b[6],b.b[7],b.b[8]));a.setUniform3fv("lightDirection",this._oldDirection)};d.prototype.set=function(d){this._info=d;a.combineLights(d.lights,this._shOrder,this._renderLighting.main,this._renderLighting.sphericalHarmonics);g.negate(this._renderLighting.main.direction,this._oldDirection);d=1/
Math.PI;this._oldAmbient[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*d;this._oldAmbient[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*d;this._oldAmbient[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*d;this._oldAmbient[3]=1;this._oldDiffuse[0]=this._renderLighting.main.intensity[0]*d;this._oldDiffuse[1]=this._renderLighting.main.intensity[1]*d;this._oldDiffuse[2]=this._renderLighting.main.intensity[2]*d;this._oldDiffuse[3]=1;d=g.set(this._oldDiffuse,k);g.scale(d,
.4*this._info.globalFactor);g.add(this._oldAmbient,d)};Object.defineProperty(d.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0});d.prototype.getOld=function(){return{ambient:this._oldAmbient,diffuse:this._oldDiffuse,specular:this._oldSpecular,direction:this._oldDirection,helper:this}};return d}();h.SceneLighting=p})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("require exports ../../lib/glMatrix ../../support/mathUtils ../lib/LongVectorMath ./Lightsources".split(" "),
function(p,h,d,a,g,f){function k(a){return(a+1)*(a+1)}function m(c){return a.clamp(Math.floor(Math.sqrt(c)-1),0,2)}function e(a,c,b){var d=a[0],e=a[1];a=a[2];b=b||[];b.length=k(c);0<=c&&(b[0]=.28209479177);1<=c&&(b[1]=.4886025119*d,b[2]=.4886025119*a,b[3]=.4886025119*e);2<=c&&(b[4]=1.09254843059*d*e,b[5]=1.09254843059*e*a,b[6]=.31539156525*(3*a*a-1),b[7]=1.09254843059*d*a,b[8]=.54627421529*(d*d-e*e));return b}function b(a,c){a=k(a);c=c||{r:[],g:[],b:[]};c.r.length=c.g.length=c.b.length=a;for(var b=
0;b<a;b++)c.r[b]=c.g[b]=c.b[b]=0;return c}function l(a,b){for(var d=m(b.r.length),f=0;f<a.length;f++){var k=a[f];u.negate(k.direction,c);e(c,d,n);g.elementwiseProduct(n,x);g.scalarProduct(n,k.intensity[0],w);g.add(b.r,w);g.scalarProduct(n,k.intensity[1],w);g.add(b.g,w);g.scalarProduct(n,k.intensity[2],w);g.add(b.b,w)}return b}function t(a,b){e(c,0,n);for(var d=0;d<a.length;d++){var f=a[d];b.r[0]+=n[0]*x[0]*f.intensity[0]*4*Math.PI;b.g[0]+=n[0]*x[0]*f.intensity[1]*4*Math.PI;b.b[0]+=n[0]*x[0]*f.intensity[2]*
4*Math.PI}return b}Object.defineProperty(h,"__esModule",{value:!0});var u=d.vec3d;h.numberOfCoefficients=k;h.numberOfCoefficientsInBand=function(a){return 2*a+1};h.orderFromNumberOfCoefficients=m;h.computeCoefficients=e;h.initSHCoefficients=b;h.projectFillLights=l;h.projectAmbientLights=t;h.combineLights=function(a,c,d,e){b(c,e.sh);u.set3(0,0,0,d.intensity);var k=!1,h=r,n=v;c=q;h.length=0;n.length=0;for(var m=c.length=0;m<a.length;m++){var w=a[m];w instanceof f.MainLight&&!k?(u.set(w.direction,d.direction),
d.intensity[0]=w.intensity[0],d.intensity[1]=w.intensity[1],d.intensity[2]=w.intensity[2],d.castShadows=w.castShadows,k=!0):w instanceof f.MainLight||w instanceof f.FillLight?h.push(w):w instanceof f.AmbientLight?n.push(w):w instanceof f.SphericalHarmonicsLight&&c.push(w)}l(h,e.sh);t(n,e.sh);for(a=0;a<c.length;a++)w=c[a],g.add(e.sh.r,w.sh.r),g.add(e.sh.g,w.sh.g),g.add(e.sh.b,w.sh.b)};var r=[],v=[],q=[],n=[0],w=[0],c=u.create(),x=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,
.785398]})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});h.dotProduct=function(d,a){for(var g=0,f=0;f<d.length;f++)g+=d[f]*a[f];return g};h.elementwiseProduct=function(d,a,g){g=g||d;g.length=d.length;for(var f=0;f<d.length;f++)g[f]=d[f]*a[f];return g};h.scalarProduct=function(d,a,g){g=g||d;g.length=d.length;for(var f=0;f<d.length;f++)g[f]=d[f]*a;return g};h.add=function(d,a,g){g=g||d;g.length=
d.length;for(var f=0;f<d.length;f++)g[f]=d[f]+a[f];return g}})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./HUDMaterial.xml ../../support/aaBoundingRect ../lib/ComponentUtils ../lib/gl-matrix ../lib/GLMaterialTexture ../lib/Material ../lib/RenderPass ../lib/RenderSlot ../lib/screenSizePerspectiveUtils ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ../../../webgl/Util".split(" "),function(p,
h,d,a,g,f,k,m,e,b,l,t,u,r,v,q){function n(a,c){void 0===c&&(c=J);if(a.textureIsSignedDistanceField){var b=a.anchorPos;a=a.distanceFieldBoundingBox;var d=c;d[0]=b[0]*(a[2]-a[0])+a[0];d[1]=b[1]*(a[3]-a[1])+a[1]}else w.set(a.anchorPos,c);return c}var w=k.vec2d,c=k.vec3d,x=k.mat3d,z=k.mat4d,A={"bottom-left":[0,0],bottom:[.5,0],"bottom-right":[1,0],left:[0,.5],center:[.5,.5],right:[1,.5],"top-left":[0,1],top:[.5,1],"top-right":[1,1]},y=[{name:"position",count:3,type:5126,offset:0,stride:76,normalized:!1},
{name:"normal",count:3,type:5126,offset:12,stride:76,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:76,normalized:!1},{name:"color",count:4,type:5121,offset:32,stride:76,normalized:!1},{name:"size",count:2,type:5126,offset:36,stride:76,normalized:!1},{name:"auxpos1",count:4,type:5126,offset:44,stride:76,normalized:!1},{name:"auxpos2",count:4,type:5126,offset:60,stride:76,normalized:!1}],B={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,
1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,anchorPos:A.center,shaderPolygonOffset:1E-5,polygonOffset:!1,
textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1};p=function(e){function k(a,c){c=e.call(this,c)||this;c._textureDirty=!1;c.params=v.copyParameters(a,B);"string"===typeof c.params.anchorPos&&(c.params.anchorPos=A[c.params.anchorPos]);return c}d(k,e);k.prototype.dispose=function(){};k.prototype.getParameterValues=function(){var a=this.params;return{color:a.color,texCoordScale:a.texCoordScale,polygonOffset:a.polygonOffset,anchorPos:a.anchorPos,screenOffset:a.screenOffset,verticalOffset:a.verticalOffset,
screenSizePerspective:a.screenSizePerspective,screenSizePerspectiveAlignment:a.screenSizePerspectiveAlignment,shaderPolygonOffset:a.shaderPolygonOffset,textureIsSignedDistanceField:a.textureIsSignedDistanceField,outlineColor:a.outlineColor,outlineSize:a.outlineSize,distanceFieldBoundingBox:a.distanceFieldBoundingBox,vvSizeEnabled:a.vvSizeEnabled,vvSizeMinSize:a.vvSizeMinSize,vvSizeMaxSize:a.vvSizeMaxSize,vvSizeOffset:a.vvSizeOffset,vvSizeFactor:a.vvSizeFactor,vvColorEnabled:a.vvColorEnabled,vvColorValues:a.vvColorValues,
vvColorColors:a.vvColorColors,textureId:a.textureId,occlusionTest:a.occlusionTest,binaryHighlightOcclusion:a.binaryHighlightOcclusion,centerOffsetUnits:a.centerOffsetUnits,debugDrawBorder:a.debugDrawBorder,drawInSecondSlot:a.drawInSecondSlot}};k.prototype.setParameterValues=function(a){for(var c in a)"textureId"===c&&r.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[c]=a[c];this.notifyDirty("matChanged")};k.prototype.getParams=function(){return this.params};
k.prototype.getOutputAmount=function(a){return 114*a};k.prototype.getInstanceBufferLayout=function(){};k.prototype.getVertexBufferLayout=function(){return y};k.prototype.fillInterleaved=function(a,c,b,d,e,f){var g=4*f,k=a.indices[r.VertexAttrConstants.POSITION],h=a.vertexAttr[r.VertexAttrConstants.POSITION].data,l=f+q.findAttribute(y,r.VertexAttrConstants.POSITION).offset/4;for(d=0;d<k.length;++d){var n=3*k[d];v.fill(h,n,e,l,c,3);l+=19;v.fill(h,n,e,l,c,3);l+=19;v.fill(h,n,e,l,c,3);l+=19;v.fill(h,
n,e,l,c,3);l+=19;v.fill(h,n,e,l,c,3);l+=19;v.fill(h,n,e,l,c,3);l+=19}c=a.indices[r.VertexAttrConstants.NORMAL];h=a.vertexAttr[r.VertexAttrConstants.NORMAL].data;l=f+q.findAttribute(y,r.VertexAttrConstants.NORMAL).offset/4;for(d=0;d<c.length;++d)n=3*c[d],v.fill(h,n,e,l,b,3),l+=19,v.fill(h,n,e,l,b,3),l+=19,v.fill(h,n,e,l,b,3),l+=19,v.fill(h,n,e,l,b,3),l+=19,v.fill(h,n,e,l,b,3),l+=19,v.fill(h,n,e,l,b,3),l+=19;d=a.vertexAttr[r.VertexAttrConstants.UV0].data;null==d||3>=d.length?(b=n=0,c=this.params.texCoordScale[0],
h=this.params.texCoordScale[1]):(n=a.vertexAttr[r.VertexAttrConstants.UV0].data[0],b=a.vertexAttr[r.VertexAttrConstants.UV0].data[1],c=a.vertexAttr[r.VertexAttrConstants.UV0].data[2],h=a.vertexAttr[r.VertexAttrConstants.UV0].data[3]);c=Math.min(1.99999,c+1);h=Math.min(1.99999,h+1);l=f+q.findAttribute(y,r.VertexAttrConstants.UV0).offset/4;for(d=0;d<k.length;++d)e[l]=n,e[l+1]=b,l+=19,e[l]=c,e[l+1]=b,l+=19,e[l]=c,e[l+1]=h,l+=19,e[l]=c,e[l+1]=h,l+=19,e[l]=n,e[l+1]=h,l+=19,e[l]=n,e[l+1]=b,l+=19;k=a.indices[r.VertexAttrConstants.COLOR];
b=a.vertexAttr[r.VertexAttrConstants.COLOR].data;g+=q.findAttribute(y,r.VertexAttrConstants.COLOR).offset;c=new Uint8Array(e.buffer);for(d=0;d<k.length;++d)n=4*k[d],v.fillColor(b,n,c,g,4),g+=76,v.fillColor(b,n,c,g,4),g+=76,v.fillColor(b,n,c,g,4),g+=76,v.fillColor(b,n,c,g,4),g+=76,v.fillColor(b,n,c,g,4),g+=76,v.fillColor(b,n,c,g,4),g+=76;n=a.indices[r.VertexAttrConstants.SIZE];g=a.vertexAttr[r.VertexAttrConstants.SIZE].data;k=f+q.findAttribute(y,r.VertexAttrConstants.SIZE).offset/4;for(d=0;d<n.length;++d)b=
g[2*n[d]],c=g[2*n[d]+1],e[k]=b,e[k+1]=c,k+=19,e[k]=b,e[k+1]=c,k+=19,e[k]=b,e[k+1]=c,k+=19,e[k]=b,e[k+1]=c,k+=19,e[k]=b,e[k+1]=c,k+=19,e[k]=b,e[k+1]=c,k+=19;if(null!=a.indices[r.VertexAttrConstants.AUXPOS1]&&null!=a.vertexAttr[r.VertexAttrConstants.AUXPOS1])for(g=a.indices[r.VertexAttrConstants.AUXPOS1],k=a.vertexAttr[r.VertexAttrConstants.AUXPOS1].data,b=f+q.findAttribute(y,"auxpos1").offset/4,d=0;d<g.length;++d)n=4*g[d],v.fill(k,n,e,b,null,4),b+=19,v.fill(k,n,e,b,null,4),b+=19,v.fill(k,n,e,b,null,
4),b+=19,v.fill(k,n,e,b,null,4),b+=19,v.fill(k,n,e,b,null,4),b+=19,v.fill(k,n,e,b,null,4),b+=19;if(null!=a.indices[r.VertexAttrConstants.AUXPOS2]&&null!=a.vertexAttr[r.VertexAttrConstants.AUXPOS2])for(g=a.indices[r.VertexAttrConstants.AUXPOS2],a=a.vertexAttr[r.VertexAttrConstants.AUXPOS2].data,f+=q.findAttribute(y,"auxpos2").offset/4,d=0;d<g.length;++d)n=4*g[d],v.fill(a,n,e,f,null,4),f+=19,v.fill(a,n,e,f,null,4),f+=19,v.fill(a,n,e,f,null,4),f+=19,v.fill(a,n,e,f,null,4),f+=19,v.fill(a,n,e,f,null,4),
f+=19,v.fill(a,n,e,f,null,4),f+=19};k.prototype.intersect=function(a,b,d,e,g,k,h,l){if(e.isSelection&&e.enableHUDSelection&&!f.isAllHidden(b.componentVisibilities,a.data.componentOffsets)){var m=a.getData();a=this.params;g=b=1;z.toMat3(d,M);if(l){g=l(Z);b=g[0];g=g[5];l=M;k=l[0];var q=l[1],v=l[2],u=l[3],w=l[4],p=l[5],x=l[6],A=l[7],y=l[8],E=1/Math.sqrt(k*k+q*q+v*v),B=1/Math.sqrt(u*u+w*w+p*p),C=1/Math.sqrt(x*x+A*A+y*y);l[0]=k*E;l[1]=q*E;l[2]=v*E;l[3]=u*B;l[4]=w*B;l[5]=p*B;l[6]=x*C;l[7]=A*C;l[8]=y*C}l=
m.getVertexAttr()[r.VertexAttrConstants.POSITION];k=m.getVertexAttr()[r.VertexAttrConstants.SIZE];m=m.getVertexAttr()[r.VertexAttrConstants.NORMAL];r.assert(3<=l.size);q=e.point;v=e.camera;u=n(a);for(w=0;w<l.data.length/l.size;w++)p=w*l.size,c.set3(l.data[p],l.data[p+1],l.data[p+2],F),z.multiplyVec3(d,F,F),p=w*k.size,N[0]=k.data[p]*b,N[1]=k.data[p+1]*g,z.multiplyVec3(v.viewMatrix,F),p=w*m.size,c.set3(m.data[p],m.data[p+1],m.data[p+2],I),this.applyVerticalOffsetTransformation(F,I,M,v,G),v.applyProjection(F,
H),-1<H[0]&&(p=Math.floor(H[0]),A=Math.floor(H[1]),t.applyPrecomputedScaleFactorVec2(N,G.factor,N),p=p-R-(0<u[0]?N[0]*u[0]:0),x=p+N[0]+2*R,A=A-R-(0<u[1]?N[1]*u[1]:0),y=A+N[1]+2*R,a.textureIsSignedDistanceField&&(E=a.outlineSize/2,B=a.distanceFieldBoundingBox,p+=N[0]*B[0],A+=N[1]*B[1],x-=N[0]*(1-B[2]),y-=N[1]*(1-B[3]),p-=E,x+=E,A-=E,y+=E),q[0]>p&&q[0]<x&&q[1]>A&&q[1]<y&&(x=e.p0,A=e.p1,z.multiplyVec3(z.inverse(v.viewMatrix,V),F,L),H[0]=q[0],H[1]=q[1],v.unprojectPoint(H,F),p=c.negate(e.getDirection(),
c.create()),x=c.dist(x,F)/c.dist(x,A),h(x,p,-1,1,!0,L)))}};k.prototype.normalAndViewAngle=function(a,b,d,e){void 0===e&&(e=S);x.multiplyVec3(b,a,e.normal);z.multiplyVec3(d.viewInverseTransposeMatrix,e.normal);e.cosAngle=c.dot(K,D);return e};k.prototype.updateScaleInfo=function(a,c,b){c=this.params;c.screenSizePerspective?a.factor=t.precomputeScaleFactor(S.cosAngle,b,c.screenSizePerspective,a.factor):(a.factor.scale=1,a.factor.factor=0,a.factor.minPixelSize=0,a.factor.paddingPixels=0);c.screenSizePerspectiveAlignment?
(a.scaleAlignment=t.precomputeScale(S.cosAngle,b,c.screenSizePerspectiveAlignment),a.minPixelSizeAlignment=c.screenSizePerspectiveAlignment.parameters.minPixelSize):(a.scaleAlignment=a.factor.scale,a.minPixelSizeAlignment=a.factor.minPixelSize)};k.prototype.applyVerticalOffsetTransformation=function(a,b,d,e,f,g){var k=this.params;16===d.length&&(d=z.toMat3(d,M));if(!k.verticalOffset||!k.verticalOffset.screenLength)return f&&(k.screenSizePerspective||k.screenSizePerspectiveAlignment)?(e=this.normalAndViewAngle(b,
d,e),k=c.length(a),this.updateScaleInfo(f,e.cosAngle,k)):f&&(f.factor.scale=1,f.scaleAlignment=1),g?c.set(a,g):a;b=this.normalAndViewAngle(b,d,e);d=c.length(a);e=v.verticalOffsetAtDistance(e,d,k.verticalOffset,b.cosAngle,k.screenSizePerspectiveAlignment||k.screenSizePerspective);f&&this.updateScaleInfo(f,b.cosAngle,d);return c.add(a,c.scale(b.normal,e),g)};k.prototype.getGLMaterials=function(){return{color:E,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:C}};k.prototype.getAllTextureIds=
function(){return[this.params.textureId]};k.prototype.setTextureDirty=function(){this._textureDirty=!0};k.prototype.calculateRelativeScreenBounds=function(a,c,b){void 0===b&&(b=g.create());var d=this.params,e=b;void 0===e&&(e=J);w.set(d.anchorPos,e);e[0]*=-a[0];e[1]*=-a[1];e[0]+=d.screenOffset[0]*c;e[1]+=d.screenOffset[1]*c;b[2]=b[0]+a[0];b[3]=b[1]+a[1];return b};k.prototype.calculateAnchorPosForRendering=function(a){return n(this.params,a)};k.loadShaders=function(c,b,d){c._parse(a);var e=function(a){a.addDefine("OcclTest",
"OCCL_TEST");a.addDefine("SDF","SIGNED_DISTANCE_FIELD");a.addDefine("vvSize","VV_SIZE");a.addDefine("vvColor","VV_COLOR");a.addDefine("verticalOffset","VERTICAL_OFFSET");a.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");a.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN")},f=new u("hud",["vertexShaderHUD","fragmentShaderHUD"],null,b,c,d);e(f);f.addDefine("debugDrawBorder","DEBUG_DRAW_BORDER");b.addShaderVariations("hud-material-shader-variations",f);f=new u("hudHighlight",
["vertexShaderHUD","fragmentShaderHUDHighlight"],null,b,c,d);e(f);f.addDefine("binaryHighlightOcclusion","BINARY_HIGHLIGHT_OCCLUSION");b.addShaderVariations("hud-material-highlight-shader-variations",f);c=new u("hudOcclusionTestPixel",["vertexShaderOcclusionTestPixel","fragmentShaderSimple"],null,b,c,d);c.addDefine("verticalOffset","VERTICAL_OFFSET");c.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");c.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN");b.addShaderVariations("hud-material-occlusion-test-pixel-shader-variations",
c)};k.shouldRenderVisibilityDuringRenderPass=function(a){return a===b.MATERIAL||b.MATERIAL_HIGHLIGHT};return k}(e);m=function(a){function c(c,b,d){b=a.call(this,c,b,d,c.getParams().textureId)||this;b.params=v.copyParameters(c.getParams());b.selectProgram();b.selectSlot();return b}d(c,a);c.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?l.HUDMATERIAL2:l.HUDMATERIAL1};c.prototype.beginSlot=function(a){return a===this.mainSlot};c.prototype.getProgram=function(){return this.program};
c.prototype.updateParameters=function(){var a=this.material.getParams(),c=this.params;c.color=a.color;c.texCoordScale=a.texCoordScale;c.polygonOffset=a.polygonOffset;c.anchorPos=a.anchorPos;c.screenOffset=a.screenOffset;c.verticalOffset=a.verticalOffset;c.screenSizePerspective=a.screenSizePerspective;c.screenSizePerspectiveAlignment=a.screenSizePerspectiveAlignment;c.shaderPolygonOffset=a.shaderPolygonOffset;c.textureIsSignedDistanceField=a.textureIsSignedDistanceField;c.outlineColor=a.outlineColor;
c.outlineSize=a.outlineSize;c.vvSizeEnabled=a.vvSizeEnabled;c.vvSizeMinSize=a.vvSizeMinSize;c.vvSizeMaxSize=a.vvSizeMaxSize;c.vvSizeOffset=a.vvSizeOffset;c.vvSizeFactor=a.vvSizeFactor;c.vvColorEnabled=a.vvColorEnabled;c.vvColorValues=a.vvColorValues;c.vvColorColors=a.vvColorColors;this.updateTexture(a.textureId);this.selectProgram();this.selectSlot()};c.prototype.bindRender=function(a,c){var b=this.params,d=this.getProgram();this.bindTexture(a,d);d.setUniform1i("hudVisibilityTexture",1);a.bindTexture(c.hudVisibilityTexture,
1);a.setActiveTexture(0);d.setUniform4fv("overrideColor",b.color);d.setUniform1f("pixelRatio",c.pixelRatio);b.textureIsSignedDistanceField&&(d.setUniform4fv("outlineColor",b.outlineColor),d.setUniform1f("outlineSize",b.outlineSize));b.vvSizeEnabled&&(d.setUniform3fv("vvSizeMinSize",b.vvSizeMinSize),d.setUniform3fv("vvSizeMaxSize",b.vvSizeMaxSize),d.setUniform3fv("vvSizeOffset",b.vvSizeOffset),d.setUniform3fv("vvSizeFactor",b.vvSizeFactor));b.vvColorEnabled&&(d.setUniform1fv("vvColorValues",b.vvColorValues),
d.setUniform4fv("vvColorColors",b.vvColorColors));d.setUniform2fv("texScale",b.texCoordScale);d.setUniform2f("screenOffset",2*b.screenOffset[0],2*b.screenOffset[1]);d.setUniform2fv("anchorPos",n(b));b.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setBlendingEnabled(!0);a.setBlendFunction(1,771)};c.prototype.bindProjection=function(a,c){this.material._textureDirty&&(this.renderTexture(a),this.material._textureDirty=!1);var b=c.cameraAboveGround?1:-1,d=this.getProgram(),
e=this.params;a.bindProgram(d);d.setUniform1f("cameraGroundRelative",b);d.setUniform1f("polygonOffset",e.shaderPolygonOffset);d.setUniform4fv("viewport",c.viewport);v.bindVerticalOffset(e.verticalOffset,c,d);d.setUniformMatrix4fv("viewNormal",c.viewInvTransp);e.screenSizePerspective&&(v.bindScreenSizePerspective(e.screenSizePerspective,d,"screenSizePerspective"),v.bindScreenSizePerspective(e.screenSizePerspectiveAlignment||e.screenSizePerspective,d,"screenSizePerspectiveAlignment"))};c.prototype.releaseRender=
function(a){a.setPolygonOffsetFillEnabled(!1);a.setBlendFunction(770,771);a.setBlendingEnabled(!1)};c.prototype.bindView=function(a,c){a=c.origin;var b=this.getProgram();v.bindView(a,c.view,b);v.bindCamPos(a,c.viewInvTransp,b)};c.prototype.bindInstance=function(a,c){a=this.getProgram();a.setUniformMatrix4fv("model",c.transformation);a.setUniformMatrix4fv("modelNormal",c.transformationNormal)};c.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return c}(m);var E=function(a){function c(c,b,
d){c=a.call(this,c,b,d)||this;c.isOcclusionSlot=!1;return c}d(c,a);c.prototype.selectProgram=function(){var a=this.params;this.programOcclusionTestPixel=this.programRep.getShaderVariationsProgram("hud-material-occlusion-test-pixel-shader-variations",[!!a.verticalOffset,!!a.screenSizePerspective,"screen"===a.centerOffsetUnits]);this.program=this.programRep.getShaderVariationsProgram("hud-material-shader-variations",[a.occlusionTest,a.textureIsSignedDistanceField,!!a.vvSizeEnabled,!!a.vvColorEnabled,
!!a.verticalOffset,!!a.screenSizePerspective,"screen"===a.centerOffsetUnits,!!a.debugDrawBorder])};c.prototype.getDrawMode=function(a){a=a.gl;return this.isOcclusionSlot?a.POINTS:a.TRIANGLES};c.prototype.release=function(a){a.setDepthFunction(a.gl.LESS);this.isOcclusionSlot||this.releaseRender(a)};c.prototype.bind=function(a,c){var b=a.gl;this.bindProjection(a,c);var d=this.getProgram();a.setDepthTestEnabled(!0);a.setDepthFunction(b.LEQUAL);this.isOcclusionSlot?d.setUniform4f("color",1,1,1,1):(this.bindRender(a,
c),this.bindTexture(a,d))};c.prototype.getProgram=function(){return this.isOcclusionSlot?this.programOcclusionTestPixel:this.program};c.prototype.getPrograms=function(){return[this.programOcclusionTestPixel,this.program]};c.prototype.beginSlot=function(a){if(this.params.occlusionTest)return this.isOcclusionSlot=a===l.OCCLUSION_PIXELS,a===l.OCCLUSION_PIXELS||a===this.mainSlot;this.isOcclusionSlot=!1;return a===this.mainSlot};return c}(m),C=function(a){function c(){return null!==a&&a.apply(this,arguments)||
this}d(c,a);c.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getShaderVariationsProgram("hud-material-highlight-shader-variations",[a.occlusionTest,a.textureIsSignedDistanceField,!!a.vvSizeEnabled,!!a.vvColorEnabled,!!a.verticalOffset,!!a.screenSizePerspective,"screen"===a.centerOffsetUnits,a.binaryHighlightOcclusion])};c.prototype.bind=function(a,c){this.bindProjection(a,c);this.bindRender(a,c)};c.prototype.release=function(a){this.releaseRender(a)};return c}(m),
G={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},J=[0,0],F=c.create(),I=c.create(),H=c.create(),K=c.create(),L=c.create(),M=x.create(),V=z.create(),S={normal:K,cosAngle:0},Z=z.create();z.identity(Z);var R=1,N=[0,0],D=[0,0,1];return p})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./GLMaterial","../materials/internal/MaterialUtil"],function(p,h,d,a,g){return function(a){function f(d,
e,b,f,k){void 0===k&&(k=!1);d=a.call(this,d,e)||this;d.textureRep=b;d.textureId=f;d.initTransparent=k;d.glTextureRef=g.aquireIfNotUndefined(d.textureId,b,d.initTransparent);return d}d(f,a);f.prototype.dispose=function(){g.releaseIfNotUndefined(this.textureId,this.textureRep)};f.prototype.updateTexture=function(a){a!==this.textureId&&(g.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=a,this.glTextureRef=g.aquireIfNotUndefined(this.textureId,this.textureRep,this.initTransparent))};
f.prototype.renderTexture=function(a){(a=this.textureRep.getTexture(this.textureId))&&a.dirty&&a.redraw&&a.redraw()};f.prototype.bindTexture=function(a,d){null!=this.glTextureRef&&(d.setUniform1i("tex",0),a.bindTexture(this.glTextureRef.getGLTexture()))};f.prototype.bindTextureSize=function(a,d){null!=this.glTextureRef&&(a=this.glTextureRef.getGLTexture(),d.setUniform2f("texSize",a.descriptor.width,a.descriptor.height))};return f}(a)})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["require",
"exports"],function(p,h){return function(){function d(a,d){this.material=a;this.programRep=d}d.prototype.dispose=function(){};Object.defineProperty(d.prototype,"materialId",{get:function(){return this.material.id},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"renderOccluded",{get:function(){return this.material.renderOccluded},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"renderPriority",{get:function(){return this.material.renderPriority},enumerable:!0,configurable:!0});
d.prototype.isVisible=function(){return this.material.isVisible()};d.prototype.getPrograms=function(){return[this.getProgram()]};return d}()})},"esri/views/3d/webgl-engine/lib/Material":function(){define(["require","exports","./IdGen","./ModelContentType"],function(p,h,d,a){return function(){function g(a){this._parentStage=null;this._visible=!0;this._renderOccluded=!1;this._renderPriority=0;this.supportsEdges=!1;this.id=g._idGen.gen(a)}Object.defineProperty(g.prototype,"parentStage",{get:function(){return this._parentStage},
enumerable:!0,configurable:!0});g.prototype.addParentStage=function(a){this._parentStage=a};g.prototype.removeParentStage=function(a){this._parentStage=null};Object.defineProperty(g.prototype,"visible",{get:function(){return this._visible},set:function(a){a!==this._visible&&(this._visible=a,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(a){a!==this._renderOccluded&&(this._renderOccluded=
a,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(a){a!==this._renderPriority&&(this._renderPriority=a,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});g.prototype.isVisible=function(){return this._visible};g.prototype.notifyDirty=function(d){this.parentStage&&this.parentStage.notifyDirty(a.MATERIAL,this,d)};g._idGen=new d;return g}()})},"esri/views/webgl/Profiling":function(){define(["require",
"exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});h.startMeasurement=function(a){return(a=a.capabilities.disjointTimerQuery)?new d(a):null};h.getTimestamp=function(a,d,f){void 0===f&&(f=50);var g=a.capabilities.disjointTimerQuery;if(!g||0>=g.timestampBits())return null;var h=g.createQuery();g.createTimestamp(h);var e=function(){var a=g.resultAvailable(h),k=g.disjoint();a&&!k?(a=g.getResult(h),d(a/1E6)):k?d():setTimeout(e,f)};e()};h.supportsTimestamps=function(a){a=a.capabilities.disjointTimerQuery;
if(!a)return!1;a=a.timestampBits();console.log({bits:a});return 0<a};var d=function(){function a(a){this.timer=a;this.query=a.createQuery();this.timer.beginTimeElapsed(this.query)}a.prototype.stop=function(a,d){void 0===d&&(d=50);this.cb=a;this.checkInterval=d;this.timer.endTimeElapsed();this.checkQueryResult()};a.prototype.checkQueryResult=function(){var a=this.timer.resultAvailable(this.query),d=this.timer.disjoint();a&&!d?(a=this.timer.getResult(this.query),this.cb(a/1E6)):d?this.cb():setTimeout(this.checkQueryResult.bind(this),
this.checkInterval)};return a}()})},"esri/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial":function(){define("require exports dojo/text!./TexOnlyGLMaterial.xml ../../lib/DefaultVertexAttributeLocations ../../lib/gl-matrix ../../lib/RenderSlot ./MaterialUtil ../../../../webgl/Program".split(" "),function(p,h,d,a,g,f,k,m){var e=g.vec4d.createFrom(1,1,1,1);return function(){function b(a,b,d,e,f){this.program=a.get("texOnly");this.color=d;this.depthFunc=f;this.blend=e;this.texGLName=b}b.prototype.beginSlot=
function(a){return a===f.INTERNAL_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.setColor=function(a){this.color=a};b.prototype.bind=function(a,b){a.bindProgram(this.program);this.program.setUniformMatrix4fv("model",k.IDENTITY);this.program.setUniformMatrix4fv("proj",b.proj);this.program.setUniform4fv("color",void 0!==this.color?this.color:e);this.program.setUniform1i("tex",0);a.bindTexture(this.texGLName,0);this.blend&&(a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,
a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA));a.setDepthTestEnabled(!0);void 0!==this.depthFunc&&a.setDepthFunction(this.depthFunc)};b.prototype.release=function(a){void 0!==this.depthFunc&&a.setDepthFunction(513);this.blend&&a.setBlendingEnabled(!1)};b.prototype.bindView=function(a,b){k.bindView(b.origin,b.view,this.program)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};
b.loadShaders=function(b,e,f){b._parse(d);b=new m(f,b.vertexShaderTexOnly,b.fragmentShaderTexOnly,a.Default3D);e.add("texOnly",b)};return b}()})},"esri/views/3d/webgl-engine/lib/tracer":function(){define(["require","exports","./webgl-debug","../../../webgl/capabilities/isWebGL2Context"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});var g=null,f=[];h.enabled=!1;h.begin=function(){h.enabled&&(g=[])};h.trace=function(a){h.enabled&&null!=g&&g.push(a)};h.end=function(){if(h.enabled){var a=
g;g=null;a&&(f.forEach(function(d){return d(a)}),f.length=0);return a}};h.instrumentContext=function(f){return h.enabled?a.default(f)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),f):d.makeDebugContext(f,void 0,function(a,e){h.enabled&&g&&g.push("gl."+a+"("+d.glFunctionArgsToString(a,e)+")")}):f};h.request=function(a){f.push(a)}})},"esri/views/3d/webgl-engine/lib/webgl-debug":function(){define([],function(){function p(a){if(null==e){e={};b={};for(var d in a)"number"==typeof a[d]&&
(e[a[d]]=d,b[d]=a[d])}}function h(){if(null==e)throw"WebGLDebugUtils.init(ctx) not called";}function d(a){h();var b=e[a];return void 0!==b?"gl."+b:"/*UNKNOWN WebGL ENUM*/ 0x"+a.toString(16)+""}function a(a,e,f,g){a=m[a];if(void 0!==a&&(a=a[e],void 0!==a&&a[f])){if("object"===typeof a[f]&&void 0!==a[f].enumBitwiseOr){e=a[f].enumBitwiseOr;f=0;a=[];for(var k=0;k<e.length;++k){var h=b[e[k]];0!==(g&h)&&(f|=h,a.push(d(h)))}return f===g?a.join(" | "):d(g)}return d(g)}return null===g?"null":void 0===g?"undefined":
g.toString()}function g(a,b,d){a.__defineGetter__(d,function(){return b[d]});a.__defineSetter__(d,function(a){b[d]=a})}function f(b,e,k,h){function l(a,c){return function(){k&&k(c,arguments);var b=a[c].apply(a,arguments),d=h.getError();0!=d&&(m[d]=!0,e(d,c,arguments));return b}}h=h||b;p(b);e=e||function(c,b,e){for(var f="",g=e.length,k=0;k<g;++k)f+=(0==k?"":", ")+a(b,g,k,e[k]);c="WebGL error "+d(c)+" in "+b+"("+f+")";window.console&&window.console.error?window.console.error(c):window.console&&window.console.log&&
window.console.log(c)};var m={},n={},r;for(r in b)if("function"==typeof b[r])if("getExtension"!=r)n[r]=l(b,r);else{var c=l(b,r);n[r]=function(){var a=c.apply(b,arguments);return f(a,e,k,h)}}else g(n,b,r);n.getError=function(){for(var a in m)if(m.hasOwnProperty(a)&&m[a])return m[a]=!1,a;return b.NO_ERROR};return n}function k(a){var b=a.getParameter(a.MAX_VERTEX_ATTRIBS),d=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,d);for(var e=0;e<b;++e)a.disableVertexAttribArray(e),a.vertexAttribPointer(e,4,a.FLOAT,
!1,0,0),a.vertexAttrib1f(e,0);a.deleteBuffer(d);b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(e=0;e<b;++e)a.activeTexture(a.TEXTURE0+e),a.bindTexture(a.TEXTURE_CUBE_MAP,null),a.bindTexture(a.TEXTURE_2D,null);a.activeTexture(a.TEXTURE0);a.useProgram(null);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.disable(a.BLEND);a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);
a.blendColor(0,0,0,0);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.ONE,a.ZERO);a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(-1);a.colorMask(!0,!0,!0,!0);a.cullFace(a.BACK);a.depthFunc(a.LESS);a.depthMask(!0);a.depthRange(0,1);a.frontFace(a.CCW);a.hint(a.GENERATE_MIPMAP_HINT,a.DONT_CARE);a.lineWidth(1);a.pixelStorei(a.PACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);a.UNPACK_COLORSPACE_CONVERSION_WEBGL&&
a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL);a.polygonOffset(0,0);a.sampleCoverage(1,!1);a.scissor(0,0,a.canvas.width,a.canvas.height);a.stencilFunc(a.ALWAYS,0,4294967295);a.stencilMask(4294967295);a.stencilOp(a.KEEP,a.KEEP,a.KEEP);a.viewport(0,0,a.canvas.width,a.canvas.height);for(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);a.getError(););}var m={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,
2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},
generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,
1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},
drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},e=null,b=null;return{init:p,mightBeEnum:function(a){h();return void 0!==e[a]},glEnumToString:d,glFunctionArgToString:a,glFunctionArgsToString:function(b,d){for(var e="",f=d.length,g=0;g<f;++g)e+=(0==g?"":", ")+a(b,f,g,d[g]);return e},makeDebugContext:f,makeLostContextSimulatingCanvas:function(a){function b(a){return"function"==typeof a?a:function(c){a.handleEvent(c)}}function d(){for(var a=Object.keys(F),c=0;c<a.length;++c)delete F[a]}
function e(){++C;y||E==C&&a.loseContext()}function f(a,c){var b=a[c];return function(){e();if(!y)return b.apply(a,arguments)}}function h(a){return{statusMessage:a,preventDefault:function(){G=!0}}}function l(a){for(var b in a)"function"==typeof a[b]?c[b]=f(a,b):g(c,a,b);c.getError=function(){e();if(!y)for(var a;a=m.getError();)F[a]=!0;for(a in F)if(F[a])return delete F[a],a;return c.NO_ERROR};var d="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");
for(b=0;b<d.length;++b){var k=d[b];c[k]=function(c){return function(){e();if(y)return null;var b=c.apply(a,arguments);b.__webglDebugContextLostId__=A;B.push(b);return b}}(a[k])}d="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");
for(b=0;b<d.length;++b)k=d[b],c[k]=function(c){return function(){e();return y?null:c.apply(a,arguments)}}(c[k]);d="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(b=0;b<d.length;++b)k=d[b],c[k]=function(c){return function(){e();return y?!1:c.apply(a,arguments)}}(c[k]);c.checkFramebufferStatus=function(b){return function(){e();return y?c.FRAMEBUFFER_UNSUPPORTED:b.apply(a,arguments)}}(c.checkFramebufferStatus);c.getAttribLocation=function(c){return function(){e();
return y?-1:c.apply(a,arguments)}}(c.getAttribLocation);c.getVertexAttribOffset=function(c){return function(){e();return y?0:c.apply(a,arguments)}}(c.getVertexAttribOffset);c.isContextLost=function(){return y};return c}var m,c,p=[],z=[];c={};var A=1,y=!1,B=[],E=0,C=0,G=!1,J=0,F={};a.getContext=function(b){return function(){var d=b.apply(a,arguments);if(d instanceof WebGLRenderingContext){if(d!=m){if(m)throw"got different context";m=d;c=l(m)}return c}return d}}(a.getContext);(function(a){var c=a.addEventListener;
a.addEventListener=function(d,e,f){switch(d){case "webglcontextlost":p.push(b(e));break;case "webglcontextrestored":z.push(b(e));break;default:c.apply(a,arguments)}}})(a);a.loseContext=function(){if(!y){y=!0;E=0;for(++A;m.getError(););d();F[m.CONTEXT_LOST_WEBGL]=!0;var c=h("context lost"),b=p.slice();setTimeout(function(){for(var d=0;d<b.length;++d)b[d](c);0<=J&&setTimeout(function(){a.restoreContext()},J)},0)}};a.restoreContext=function(){y&&z.length&&setTimeout(function(){if(!G)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var a=0;a<B.length;++a){var c=B[a];c instanceof WebGLBuffer?m.deleteBuffer(c):c instanceof WebGLFramebuffer?m.deleteFramebuffer(c):c instanceof WebGLProgram?m.deleteProgram(c):c instanceof WebGLRenderbuffer?m.deleteRenderbuffer(c):c instanceof WebGLShader?m.deleteShader(c):c instanceof WebGLTexture&&m.deleteTexture(c)}k(m);y=!1;C=0;G=!1;for(var a=z.slice(),c=h("context restored"),b=0;b<a.length;++b)a[b](c)},0)};a.loseContextInNCalls=function(a){if(y)throw"You can not ask a lost contet to be lost";
E=C+a};a.getNumCalls=function(){return C};a.setRestoreTimeout=function(a){J=a};return a},resetToInitialState:k}})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});h.default=function(d){return window.WebGL2RenderingContext&&d instanceof WebGL2RenderingContext}})},"esri/views/3d/webgl-engine/materials/repository":function(){define("require exports dojo/text!./internal/hud.xml dojo/text!./internal/util.xml ../lib/edgeRendering/EdgeView ./CheckerBoardMaterial ./ColorMaterial ./DefaultMaterial ./HUDMaterial ./LineCalloutMaterial ./MeasurementArrowMaterial ./RibbonLineMaterial ./internal/BlendLayers ./internal/SimpleGLMaterial ./internal/TexOnlyGLMaterial".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v){Object.defineProperty(h,"__esModule",{value:!0});h.initializeShaders=function(h,n,w){h._parse(a);h._parse(d);r.loadShaders(h,n,w);v.loadShaders(h,n,w);m.loadShaders(h,n,w);e.loadShaders(h,n,w);b.loadShaders(h,n,w);t.loadShaders(h,n,w);u.loadShaders(h,n,w);k.loadShaders(h,n,w);l.loadShaders(h,n,w);g.EdgeView.loadShaders(h,n,w);f.loadShaders(h,n,w)}})},"esri/views/3d/webgl-engine/materials/CheckerBoardMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./CheckerBoardMaterial.xml ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ./internal/MaterialUtil".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l){var t=[{name:e.VertexAttrConstants.POSITION,count:3,type:5126,offset:0,stride:20,normalized:!1},{name:e.VertexAttrConstants.UV0,count:2,type:5126,offset:12,stride:20,normalized:!1}],u={size:[1,1],color1:[.75,.75,.75,1],color2:[.5,.5,.5,1],transparent:!1,polygonOffset:!1};p=function(e){function f(a,d){d=e.call(this,d)||this;d.canBeMerged=!1;d.params=b.copyParameters(a,u);return d}d(f,e);f.prototype.dispose=function(){};f.prototype.getParameterValues=function(){var a=
this.params;return{size:a.size,color1:a.color1,color2:a.color2,transparent:a.transparent,polygonOffset:a.polygonOffset}};f.prototype.setParameterValues=function(a){b.updateParameters(this.params,a)&&this.notifyDirty("matChanged")};f.prototype.getParams=function(){return this.params};f.prototype.getOutputAmount=function(a){return 5*a};f.prototype.getInstanceBufferLayout=function(){};f.prototype.getVertexBufferLayout=function(){return t};f.prototype.fillInterleaved=function(a,b,c,d,e,f){l.fillInterleaved(a,
b,c,d,t,e,f)};f.prototype.intersect=function(a,b,c,d,e,f,g,k){return l.intersectTriangleGeometry(a,b,c,d,e,f,g)};f.prototype.getGLMaterials=function(){return{color:r,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};f.prototype.getAllTextureIds=function(){return[]};f.loadShaders=function(b,d,c){b._parse(a);b=new m("checker-board",["vsCheckerBoard","fsCheckerBoard"],null,d,b,c);d.addShaderVariations("checker-board-material-shader-variations",b)};return f}(f);var r=function(a){function e(d,
e,c){c=a.call(this,d,e)||this;c.programRep=e;c.params=b.copyParameters(d.getParams());c.selectProgram();return c}d(e,a);e.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("checker-board-material-shader-variations",[])};e.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};e.prototype.beginSlot=function(a){return a===(this.params.transparent?k.TRANSPARENT_MATERIAL:k.OPAQUE_MATERIAL)};e.prototype.getProgram=
function(){return this.program};e.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};e.prototype.bind=function(a,b){b=this.program;a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(!1);a.setFaceCullingEnabled(!1);this.params.transparent&&(a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA));this.params.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-25));a.bindProgram(b);b.setUniform2fv("size",
this.params.size);b.setUniform4fv("color1",this.params.color1);b.setUniform4fv("color2",this.params.color2)};e.prototype.bindView=function(a,d){a=d.origin;var c=this.getProgram();b.bindView(a,d.view,c)};e.prototype.bindInstance=function(a,b){this.getProgram().setUniformMatrix4fv("model",b.transformation)};e.prototype.release=function(a){a.setDepthWriteEnabled(!0);this.params.transparent&&a.setBlendingEnabled(!1);this.params.polygonOffset&&a.setPolygonOffsetFillEnabled(!1)};return e}(g);return p})},
"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./ColorMaterial.xml ../lib/DefaultVertexBufferLayouts ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ../../../webgl/Util".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,t){var u=g.Pos3Col,r=t.getStride(u)/4,v={color:[1,1,1,1],transparent:!1,vertexColors:!1,polygonOffset:!1};p=function(b){function c(a,
c){c=b.call(this,c)||this;c.supportsEdges=!0;c.params=l.copyParameters(a,v);return c}d(c,b);c.prototype.getParams=function(){return this.params};c.prototype.getParameterValues=function(){return l.copyParameters(this.params)};c.prototype.setColor=function(a){this.params.color=a;this.notifyDirty("matChanged")};c.prototype.getColor=function(){return this.params.color};c.prototype.setTransparent=function(a){this.params.transparent=a;this.notifyDirty("matChanged")};c.prototype.getTransparent=function(){return this.params.transparent};
c.prototype.getOutputAmount=function(a){return a*r*1};c.prototype.getVertexBufferLayout=function(){return u};c.prototype.getInstanceBufferLayout=function(){};c.prototype.fillInterleaved=function(a,c,b,d,e,f,g){l.fillInterleaved(a,c,b,d,u,e,f,g)};c.prototype.intersect=function(a,c,b,d,e,f,g,k){l.intersectTriangleGeometry(a,c,b,d,e,f,g)};c.prototype.getGLMaterials=function(){return{color:q,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:n}};c.prototype.getAllTextureIds=function(){return[]};
c.loadShaders=function(c,b,d){c._parse(a);c=new e("colorMaterial",["vertexShaderColorMaterial","fragmentShaderColorMaterial"],null,b,c,d);c.addDefine("Color","VERTEXCOLORS");b.addShaderVariations("colorMaterial",c)};return c}(k);var q=function(a){function c(c,b,d){c=a.call(this,c,b)||this;c.updateParameters();return c}d(c,a);c.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};c.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("colorMaterial",
[this.params.vertexColors])};c.prototype.beginSlot=function(a){return a===(1>this.params.color[3]?m.TRANSPARENT_MATERIAL:m.OPAQUE_MATERIAL)};c.prototype.getProgram=function(){return this.program};c.prototype.bind=function(a,c){c=this.program;var b=this.params;a.bindProgram(c);c.setUniform4fv("eColor",b.color);a.setFaceCullingEnabled(!1);b.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(1,1));b.transparent&&(a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,
a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA));a.setDepthTestEnabled(!0)};c.prototype.release=function(a){var c=this.params;a.setPolygonOffsetFillEnabled(!1);c.transparent&&a.setBlendingEnabled(!1)};c.prototype.bindView=function(a,c){l.bindView(c.origin,c.view,this.program)};c.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",c.transformation)};c.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return c}(f),n=function(a){function c(c,b,d){c=a.call(this,c,b)||this;c.updateParameters();
return c}d(c,a);c.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};c.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("colorMaterial",[this.params.vertexColors])};c.prototype.beginSlot=function(a){return a===m.OPAQUE_MATERIAL};c.prototype.getProgram=function(){return this.program};c.prototype.bind=function(a,c){c=this.program;var b=this.params;a.bindProgram(c);c.setUniform4fv("eColor",b.color);a.setFaceCullingEnabled(!1);
b.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(1,1))};c.prototype.release=function(a){a.setPolygonOffsetFillEnabled(!1)};c.prototype.bindView=function(a,c){l.bindView(c.origin,c.view,this.program)};c.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",c.transformation)};c.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return c}(f);return p})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./DefaultMaterial.xml ../../layers/graphics/graphicUtils ../../support/buffer/glUtil ../../support/buffer/InterleavedLayout ../lib/DefaultVertexAttributeLocations ../lib/gl-matrix ../lib/GLMaterialTexture ../lib/Material ../lib/RenderSlot ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ../../../webgl/Program ../../../webgl/Util".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n){function w(a,c){var b=a.gl;(c.cullFace?"none"===c.cullFace:c.transparent)?a.setFaceCullingEnabled(!1):(a.setFaceCullingEnabled(!0),"front"===c.cullFace&&a.setCullFace(b.FRONT))}function c(a,c){var b=a.gl;(c.cullFace?"none"===c.cullFace:c.transparent)?a.setFaceCullingEnabled(!0):(a.setFaceCullingEnabled(!1),"front"===c.cullFace&&a.setCullFace(b.BACK))}function x(a,c){return a?t.TRANSPARENT_MATERIAL:c?t.STENCIL_MATERIAL:t.OPAQUE_MATERIAL}function z(a,c){var b=
c.vvSizeEnabled;c.vvSizeEnabled?(a.setUniform3fv("vvSizeMinSize",c.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",c.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",c.vvSizeOffset),a.setUniform3fv("vvSizeFactor",c.vvSizeFactor)):b&&a.setUniform3fv("vvSizeValue",c.vvSizeValue);b&&(a.setUniform3fv("vvSymbolAnchor",c.vvSymbolAnchor),g.computeObjectRotation(c.vvSymbolRotation[2],c.vvSymbolRotation[0],c.vvSymbolRotation[1],C.identity(P)),a.setUniformMatrix3fv("vvSymbolRotation",C.toMat3(P,D)));c.vvColorEnabled&&
(a.setUniform1fv("vvColorValues",c.vvColorValues),a.setUniform4fv("vvColorColors",c.vvColorColors))}function A(a,c){a.vvSizeEnabled=c.vvSizeEnabled;a.vvSizeMinSize=c.vvSizeMinSize;a.vvSizeMaxSize=c.vvSizeMaxSize;a.vvSizeOffset=c.vvSizeOffset;a.vvSizeFactor=c.vvSizeFactor;a.vvSizeValue=c.vvSizeValue;a.vvSymbolAnchor=c.vvSymbolAnchor;a.vvSymbolRotation=c.vvSymbolRotation}var y=e.vec3d,B=e.vec4d,E=e.mat3d,C=e.mat4d,G=r.assert;p=function(c){function b(a,d){d=c.call(this,d)||this;d.supportsEdges=!0;d.params=
v.copyParameters(a,L);d.instanced=!!a.instanced;d.vertexBufferLayout=b.getVertexBufferLayout(d.params);d.instanceBufferLayout=d.instanced?b.getInstanceBufferLayout(d.params):null;return d}d(b,c);b.prototype.isVisible=function(){var a=this.params;if(!c.prototype.isVisible.call(this)||0===a.layerOpacity)return!1;var b=M&&a.instanced,d=a.vertexColors,e=a.symbolColors,b=!!b&&-1<b.indexOf("color"),f=a.vvColorEnabled,g="replace"===a.colorMixMode,k=0<a.opacity,a=a.externalColor&&0<a.externalColor[3];return d&&
(b||f||e)?g?!0:k:d?g?a:k:b||f||e?g?!0:k:g?a:k};b.prototype.getParams=function(){return this.params};b.prototype.getParameterValues=function(){var a=this.params;return{textureId:a.textureId,ambient:a.ambient,diffuse:a.diffuse,specular:a.specular,externalColor:a.externalColor,colorMixMode:a.colorMixMode,opacity:a.opacity,layerOpacity:a.layerOpacity,transparent:a.transparent,polygonOffset:a.polygonOffset,atlasRegions:a.atlasRegions,flipV:a.flipV,doubleSided:a.doubleSided,doubleSidedType:a.doubleSidedType,
cullFace:a.cullFace,writeStencil:a.writeStencil,receiveSSAO:a.receiveSSAO,castShadows:a.castShadows,verticalOffset:a.verticalOffset,screenSizePerspective:a.screenSizePerspective,vvSizeEnabled:a.vvSizeEnabled,vvSizeMinSize:a.vvSizeMinSize,vvSizeMaxSize:a.vvSizeMaxSize,vvSizeOffset:a.vvSizeOffset,vvSizeFactor:a.vvSizeFactor,vvSizeValue:a.vvSizeValue,vvColorEnabled:a.vvColorEnabled,vvColorValues:a.vvColorValues,vvColorColors:a.vvColorColors,compressedNormals:a.compressedNormals,groundNormalShading:a.groundNormalShading,
vvSymbolAnchor:a.vvSymbolAnchor,vvSymbolRotation:a.vvSymbolRotation}};b.prototype.setParameterValues=function(a){var c=this.params,b;for(b in a)"textureId"===b&&G(c.textureId,"Can only change texture of material that already has a texture"),"castShadows"===b&&G(a.castShadows===c.castShadows,"Can not change shadow casting behavior."),c[b]=a[b];this.notifyDirty("matChanged")};b.prototype.getOutputAmount=function(a){var c=n.getStride(this.vertexBufferLayout)/4;return a*c};b.prototype.getVertexBufferLayout=
function(){return this.vertexBufferLayout};b.prototype.getInstanceBufferLayout=function(){return this.instanceBufferLayout};b.prototype.fillInterleaved=function(a,c,b,d,e,f,g){v.fillInterleaved(a,c,b,d,this.vertexBufferLayout,e,f,g)};b.prototype.intersect=function(a,c,b,d,e,f,g,k){if(null!==this.params.verticalOffset){k=d.camera;y.set3(b[12],b[13],b[14],aa);var h=y.subtract(aa,k.eye,X),l=y.length(h),n=y.scale(h,1/l),m=null,h=null;switch(d.viewingMode){case "global":h=y.normalize(aa,da);break;case "local":h=
y.set(T,da)}this.params.screenSizePerspective&&(m=y.dot(h,n));k=v.verticalOffsetAtDistance(k,l,this.params.verticalOffset,m,this.params.screenSizePerspective);y.scale(h,k);E.multiplyVec3(d.transformInverseRotation,h,U);e=y.subtract(e,U,O);f=y.subtract(f,U,Q)}v.intersectTriangleGeometry(a,c,b,d,e,f,g)};b.prototype.getGLMaterials=function(){return{color:J,depthShadowMap:this.params.castShadows?I:null,normal:H,depth:F,highlight:K}};b.prototype.getAllTextureIds=function(){var a=this.params,c=[];a.textureId&&
c.push(a.textureId);return c};b.loadShaders=function(c,b,d){c._parse(a);M=null!==d.capabilities.instancing;var e=new u("phong",["vsPhong","fsPhong"],null,b,c,d);e.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);e.addDefine("Color","VERTEXCOLORS");e.addDefine("symbolColor","SYMBOLVERTEXCOLORS");e.addDefine("FlipV","FLIPV");e.addDefine("DoubleSided","DOUBLESIDED");e.addDefine("WindingOrderDoubleSided","WINDINGORDERDOUBLESIDED");
e.addDefine("Instanced","INSTANCED");e.addDefine("InstColor","INSTANCEDCOLOR");e.addDefine("ReceiveShadows","RECEIVE_SHADOWS");e.addDefine("ReceiveSSAO","RECEIVE_SSAO");e.addDefine("vvSize","VV_SIZE");e.addDefine("vvColor","VV_COLOR");e.addDefine("VerticalOffset","VERTICAL_OFFSET");e.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");e.addDefine("groundNormalShading","GROUND_NORMAL_SHADING");e.addDefine("compressedNormals","COMPRESSED_NORMALS");e.addDefine("componentColor","COMPONENTCOLORS");
b.addShaderVariations(V,e);e=new u("depth",["vsDepth","fsDepth"],null,b,c,d);e.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);e.addDefine("FlipV","FLIPV");e.addDefine("Instanced","INSTANCED");e.addDefine("ShadowMap","BIAS_SHADOWMAP");e.addDefine("vvSize","VV_SIZE");e.addDefine("VerticalOffset","VERTICAL_OFFSET");e.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");b.addShaderVariations(S,e);e=new u("normal",
["vsNormal","fsNormal"],null,b,c,d);e.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);e.addDefine("FlipV","FLIPV");e.addDefine("Instanced","INSTANCED");e.addDefine("vvSize","VV_SIZE");e.addDefine("VerticalOffset","VERTICAL_OFFSET");e.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");e.addDefine("compressedNormals","COMPRESSED_NORMALS");b.addShaderVariations(Z,e);e=new u("highlight",["vsHighlight","fsHighlight"],
null,b,c,d);e.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);e.addDefine("FlipV","FLIPV");e.addDefine("Instanced","INSTANCED");e.addDefine("vvSize","VV_SIZE");e.addDefine("VerticalOffset","VERTICAL_OFFSET");e.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");b.addShaderVariations(R,e);var e=new q(d,c.vsDepth,c.fsDepth,m.Default3D,["BIAS_SHADOWMAP 1"]),f=new q(d,c.vsDepthTextured,c.fsDepthTextured,m.Default3D,
["BIAS_SHADOWMAP 1"]),g=new q(d,c.vsDepth,c.fsDepth,m.Default3D),k=new q(d,c.vsDepthTextured,c.fsDepthTextured,m.Default3D),h=new q(d,c.vsNormal,c.fsNormal,m.Default3D),l=new q(d,c.vsNormalTextured,c.fsNormalTextured,m.Default3D),n=new q(d,c.vsHighlight,c.fsHighlight,m.Default3D);c=new q(d,c.vsHighlightTextured,c.fsHighlightTextured,m.Default3D);b.add("depthShadowMap",e);b.add("depthTexturedShadowMap",f);b.add("depth",g);b.add("depthTextured",k);b.add("normal",h);b.add("normalTextured",l);b.add("highlight",
n);b.add("highlightTextured",c)};b.getVertexBufferLayout=function(a){var c=k.newLayout().vec3f("position");a.groundNormalShading||(c=a.compressedNormals?c.vec2i16("normalCompressed",{glNormalized:!0}):c.vec3f("normal"));a.textureId&&(c=c.vec2f("uv0"),a.atlasRegions&&(c=c.vec4u16("region")));a.vertexColors&&(c=c.vec4u8("color"));a.symbolColors&&(c=c.vec4u8("symbolColor"));a.componentIndices&&(c=c.u16("componentIndex").u16("_padding",{glPadding:!0}));return f.glLayout(c)};b.getInstanceBufferLayout=
function(a){var c=k.newLayout().mat4f("model").mat4f("modelNormal");a.instanced&&-1<a.instanced.indexOf("color")&&(c=c.vec4f("instanceColor"));a.instanced&&-1<a.instanced.indexOf("featureAttribute")&&(c=c.vec4f("instanceFeatureAttribute"));return f.glLayout(c,1)};return b}(l);var J=function(a){function b(c,b,d){b=a.call(this,c,b,d,c.getParams().textureId)||this;b.programs=[[null,null],[null,null]];b.params=v.copyParameters(c.getParams());b.slot=x(b.params.transparent,b.params.writeStencil);c=b.params;
b.texturing=c.textureId?c.atlasRegions?"AtlasTextured":"Textured":"none";d=M&&c.instanced;b.instanced=!!d;b.instancedColor=!!d&&-1<d.indexOf("color");b.pseudoInstancedColor=!M&&c.instanced&&-1<c.instanced.indexOf("color");b._loadPrograms();return b}d(b,a);b.prototype._loadPrograms=function(){this.programs[0][0]=this._loadProgram(!1,!1);this.programs[1][0]=this._loadProgram(!0,!1);this.params.receiveSSAO?(this.programs[0][1]=this._loadProgram(!1,!0),this.programs[1][1]=this._loadProgram(!0,!0),this.allPrograms=
this.programs[0].concat(this.programs[1])):(this.programs[0][1]=this.programs[0][0],this.programs[1][1]=this.programs[1][0],this.allPrograms=[this.programs[0][0],this.programs[1][0]])};b.prototype._loadProgram=function(a,c){var b=this.params;return this.programRep.getShaderVariationsProgram(V,[this.texturing,b.vertexColors,b.symbolColors,b.flipV,b.doubleSided&&"normal"===b.doubleSidedType,b.doubleSided&&"winding-order"===b.doubleSidedType,!!this.instanced,this.instancedColor,a,c,b.vvSizeEnabled,b.vvColorEnabled,
null!==b.verticalOffset,null!==b.screenSizePerspective,b.groundNormalShading,b.compressedNormals,null!=b.componentColorBuffer])};b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program||this.programs[0][0]};b.prototype.getPrograms=function(){return this.allPrograms};b.prototype.updateParameters=function(){var a=this.material.getParams(),c=this.params;c.ambient=a.ambient;c.diffuse=a.diffuse;c.specular=a.specular;c.externalColor=a.externalColor;
c.colorMixMode=a.colorMixMode;c.opacity=a.opacity;c.layerOpacity=a.layerOpacity;c.polygonOffset=a.polygonOffset;c.flipV=a.flipV;c.doubleSided=a.doubleSided;c.doubleSidedType=a.doubleSidedType;c.cullFace=a.cullFace;c.receiveSSAO=a.receiveSSAO;c.castShadows=a.castShadows;c.verticalOffset=a.verticalOffset;c.screenSizePerspective=a.screenSizePerspective;A(c,a);c.vvColorEnabled=a.vvColorEnabled;c.vvColorValues=a.vvColorValues;c.vvColorColors=a.vvColorColors;c.transparent!==a.transparent&&(this.slot=x(a.transparent,
a.writeStencil),c.transparent=a.transparent);c.compressedNormals=a.compressedNormals;c.groundNormalShading=a.groundNormalShading;this.updateTexture(a.textureId);a.atlasRegions&&(c.atlasRegions=a.atlasRegions);c.blendModeOneOne=a.blendModeOneOne;c.inverseWindingOrder=a.inverseWindingOrder;this._loadPrograms()};b.prototype.bind=function(a,c){var b=a.gl,d=this.params,e=this.program=this.programs[c.shadowMappingEnabled?1:0][c.ssaoEnabled?1:0];a.bindProgram(e);e.setUniform3fv("ambient",d.ambient);e.setUniform3fv("diffuse",
d.diffuse);e.setUniform3fv("specular",d.specular);e.setUniform4fv("externalColor",d.externalColor);e.setUniform1i("colorMixMode",v.colorMixModes[d.colorMixMode]);e.setUniform1f("opacity",d.opacity);e.setUniform1f("layerOpacity",d.layerOpacity);v.bindVerticalOffset(d.verticalOffset,c,e);v.bindScreenSizePerspective(d.screenSizePerspective,e);z(e,d);this.bindTexture(a,e);"AtlasTextured"===this.texturing&&this.bindTextureSize(a,e);a.setBlendFunctionSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);
d.inverseWindingOrder&&a.setFrontFace(b.CW);d.transparent?(a.setBlendingEnabled(!0),d.blendModeOneOne?(a.setBlendFunction(b.ONE,b.ONE),a.setDepthWriteEnabled(!1)):a.setBlendFunctionSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA)):a.setBlendingEnabled(!1);d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(2,2));w(a,d);a.setDepthTestEnabled(!0);d.componentIndices&&d.componentColorBuffer&&(d.componentColorBuffer.updateTexture(),d.componentColorBuffer.bind(e,
{tex:"uComponentColorTex",invDim:"uComponentColorTexInvDim",unit:1}))};b.prototype.release=function(a,b){b=a.gl;a.setPolygonOffsetFillEnabled(!1);c(a,this.params);a.setBlendingEnabled(!1);a.setBlendFunctionSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);a.setDepthWriteEnabled(!0);a.setFrontFace(b.CCW)};b.prototype.bindView=function(a,c){a=this.program=this.programs[c.shadowMappingEnabled?1:0][c.ssaoEnabled?1:0];var b=c.origin;v.bindView(b,c.view,a);v.bindCamPos(b,c.viewInvTransp,
a);c.shadowMappingEnabled&&c.shadowMap.bindView(a,b)};b.prototype.bindInstance=function(a,c){a=this.program;a.setUniformMatrix4fv("model",c.transformation);a.setUniformMatrix4fv("modelNormal",c.transformationNormal);c.instanceParameters&&this.pseudoInstancedColor&&(c=c.instanceParameters.color)&&(B.multiply(c,this.params.externalColor,N),a.setUniform4fv("externalColor",N))};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return b}(b),F=function(a){function b(c,b,d,e){void 0===e&&(e=!1);
d=a.call(this,c,b,d,c.getParams().textureId)||this;d.params=v.copyParameters(c.getParams());d.instanced=M&&!!d.params.instanced;d.texturing=n.hasAttribute(c.getVertexBufferLayout(),"uv0")?"Textured":"none";d.program=b.getShaderVariationsProgram(S,[d.texturing,d.params.flipV,d.instanced,e,d.params.vvSizeEnabled,null!==d.params.verticalOffset,null!==d.params.screenSizePerspective]);d.slot=x(d.params.transparent,d.params.writeStencil);return d}d(b,a);b.prototype.beginSlot=function(a){return a===this.slot};
b.prototype.getProgram=function(){return this.program};b.prototype.updateParameters=function(){var a=this.material.getParams(),c=this.params;c.cullFace=a.cullFace;c.inverseWindingOrder=a.inverseWindingOrder;c.flipV=a.flipV;A(c,a);this.updateTexture(a.textureId)};b.prototype.bind=function(a,c){var b=a.gl,d=this.program,e=this.params;a.bindProgram(d);d.setUniform2fv("nearFar",c.nearFar);e.inverseWindingOrder&&a.setFrontFace(b.CW);v.bindVerticalOffset(e.verticalOffset,c,d);v.bindScreenSizePerspective(e.screenSizePerspective,
d);z(d,e);this.bindTexture(a,d);w(a,e);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=a.gl,d=this.params;c(a,d);d.inverseWindingOrder&&a.setFrontFace(b.CCW)};b.prototype.bindView=function(a,c){a=this.program;var b=this.params;v.bindView(c.origin,c.view,a);b.screenSizePerspective&&v.bindCamPos(c.origin,c.viewInvTransp,a)};b.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",c.transformation)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return b}(b),
I=function(a){function c(c,b,d){return a.call(this,c,b,d,!0)||this}d(c,a);return c}(F),H=function(a){function b(c,b,d,e){void 0===e&&(e=!1);d=a.call(this,c,b,d,c.getParams().textureId)||this;d.params=v.copyParameters(c.getParams());d.instanced=M&&!!d.params.instanced;d.texturing=n.hasAttribute(c.getVertexBufferLayout(),"uv0")?"Textured":"none";d.program=b.getShaderVariationsProgram(Z,[d.texturing,d.params.flipV,d.instanced,d.params.vvSizeEnabled,null!==d.params.verticalOffset,null!==d.params.screenSizePerspective,
d.params.compressedNormals]);d.slot=x(d.params.transparent,d.params.writeStencil);return d}d(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.updateParameters=function(){var a=this.material.getParams(),c=this.params;c.cullFace=a.cullFace;c.inverseWindingOrder=a.inverseWindingOrder;c.flipV=a.flipV;A(c,a);this.updateTexture(a.textureId)};b.prototype.bind=function(a,c){var b=a.gl,d=this.program,e=this.params;a.bindProgram(d);
this.bindTexture(a,d);d.setUniformMatrix4fv("viewNormal",c.viewInvTransp);v.bindVerticalOffset(e.verticalOffset,c,d);v.bindScreenSizePerspective(e.screenSizePerspective,d);z(d,e);w(a,e);e.inverseWindingOrder&&a.setFrontFace(b.CW);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=a.gl,d=this.params;c(a,d);d.inverseWindingOrder&&a.setFrontFace(b.CCW)};b.prototype.bindView=function(a,c){a=this.program;var b=this.params;v.bindView(c.origin,c.view,a);b.screenSizePerspective&&v.bindCamPos(c.origin,
c.viewInvTransp,a)};b.prototype.bindInstance=function(a,c){a=this.program;a.setUniformMatrix4fv("model",c.transformation);a.setUniformMatrix4fv("modelNormal",c.transformationNormal)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return b}(b),K=function(a){function b(c,b,d,e){void 0===e&&(e=!1);d=a.call(this,c,b,d,c.getParams().textureId)||this;d.params=v.copyParameters(c.getParams());d.instanced=M&&!!d.params.instanced;d.texturing=n.hasAttribute(c.getVertexBufferLayout(),"uv0")?"Textured":
"none";d.program=b.getShaderVariationsProgram(R,[d.texturing,d.params.flipV,d.instanced,d.params.vvSizeEnabled,null!==d.params.verticalOffset,null!==d.params.screenSizePerspective]);d.slot=x(d.params.transparent,d.params.writeStencil);return d}d(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.updateParameters=function(){var a=this.material.getParams(),c=this.params;c.cullFace=a.cullFace;c.inverseWindingOrder=a.inverseWindingOrder;
c.flipV=a.flipV;A(c,a);this.updateTexture(a.textureId)};b.prototype.bind=function(a,c){var b=a.gl,d=this.program,e=this.params;a.bindProgram(d);this.bindTexture(a,d);v.bindVerticalOffset(e.verticalOffset,c,d);v.bindScreenSizePerspective(e.screenSizePerspective,d);z(d,e);w(a,e);e.inverseWindingOrder&&a.setFrontFace(b.CW);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=a.gl,d=this.params;c(a,d);d.inverseWindingOrder&&a.setFrontFace(b.CW)};b.prototype.bindView=function(a,c){a=this.program;
var b=this.params;v.bindView(c.origin,c.view,a);b.screenSizePerspective&&v.bindCamPos(c.origin,c.viewInvTransp,a)};b.prototype.bindInstance=function(a,c){a=this.program;a.setUniformMatrix4fv("model",c.transformation);a.setUniformMatrix4fv("modelNormal",c.transformationNormal)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return b}(b),L={textureId:void 0,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,blendModeOneOne:!1,
inverseWindingOrder:!1,vertexColors:!1,symbolColors:!1,componentIndices:!1,componentColorBuffer:null,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,compressedNormals:!1,groundNormalShading:!1,writeStencil:!1,receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,
0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotation:[0,0,0],transparent:!1,polygonOffset:!1,atlasRegions:!1},M,V="material",S="material-depth",Z="material-normal",R="material-highlight",N=B.create(),D=E.create(),P=C.create(),O=y.create(),Q=y.create(),T=y.createFrom(0,0,1),da=y.create(),U=y.create(),aa=y.create(),X=y.create();return p})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./LineCalloutMaterial.xml ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ../../../webgl/Util".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l){function t(a,c,b){3===b.length?a.setUniform4f(c,b[0],b[1],b[2],1):a.setUniform4fv(c,b)}var u=e.VertexAttrConstants,r=[{name:"position",count:3,type:5126,offset:0,stride:48,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:48,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:48,normalized:!1},{name:"auxpos1",count:4,type:5126,offset:32,stride:48,normalized:!1}],v={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,
0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world"};p=function(e){function c(a,d){d=e.call(this,d)||this;d.params=b.copyParameters(a,v);d._uniqueMaterialIdentifier=c.uniqueMaterialIdentifier(d.params);return d}d(c,e);Object.defineProperty(c.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0});c.prototype.dispose=function(){};c.prototype.getGLMaterials=function(){return{color:q,
depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};c.prototype.getAllTextureIds=function(){return[]};c.prototype.fillAttributeData=function(a,c,d,e,f,g){var k=a.indices[c];a=a.vertexAttr[c].data;if(k&&a)for(c=d+l.findAttribute(r,c).offset/4,d=0;d<k.length;d++)for(var h=e*k[d],n=0;6>n;n++)b.fill(a,h,g,c,f,e),c+=12};c.prototype.fillInterleaved=function(a,c,b,d,e,f,g){this.fillAttributeData(a,u.POSITION,f,3,c,e);this.fillAttributeData(a,u.NORMAL,f,3,b,e);this.fillAttributeData(a,u.AUXPOS1,
f,4,null,e);a=f+l.findAttribute(r,u.UV0).offset/4;c=0;for(b=n;c<b.length;c++)d=b[c],e[a+0]=d[0],e[a+1]=d[1],a+=12};c.prototype.getOutputAmount=function(a){return 288*a};c.prototype.getInstanceBufferLayout=function(){};c.prototype.getVertexBufferLayout=function(){return r};c.prototype.intersect=function(a,c,b,d,e,f,g,k){};c.prototype.getParameterValues=function(){var a=this.params;return{verticalOffset:a.verticalOffset,screenSizePerspective:a.screenSizePerspective,screenOffset:a.screenOffset,centerOffsetUnits:a.centerOffsetUnits,
color:[a.color[0],a.color[1],a.color[2],a.color[3]],size:a.size,borderColor:a.borderColor,occlusionTest:a.occlusionTest,shaderPolygonOffset:a.shaderPolygonOffset,depthHUDAlignStart:a.depthHUDAlignStart}};c.prototype.setParameterValues=function(a){b.updateParameters(this.params,a)&&(this._uniqueMaterialIdentifier=c.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))};c.uniqueMaterialIdentifier=function(a){return JSON.stringify({screenOffset:a.screenOffset||[0,0],centerOffsetUnits:a.centerOffsetUnits||
"world"})};c.loadShaders=function(c,b,d){c._parse(a);c=new m("lineCallout",["vertexShaderLineCallout","fragmentShaderLineCallout"],null,b,c,d);c.addDefine("occlTest","OCCL_TEST");c.addDefine("verticalOffset","VERTICAL_OFFSET");c.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");c.addDefine("depthHud","DEPTH_HUD");c.addDefine("depthHudAlignStart","DEPTH_HUD_ALIGN_START");c.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN");b.addShaderVariations("line-callout-material-shader-variations",
c)};return c}(f);var q=function(a){function c(c,b,d){c=a.call(this,c,b)||this;c.isRenderSlot=!0;c.updateParameters();return c}d(c,a);c.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};c.prototype.selectProgram=function(){var a=this.params;this.renderProgram=this.programRep.getShaderVariationsProgram("line-callout-material-shader-variations",[!!a.occlusionTest,!!a.verticalOffset,!!a.screenSizePerspective,!1,!!a.depthHUDAlignStart,"screen"===
a.centerOffsetUnits]);this.depthProgram=this.programRep.getShaderVariationsProgram("line-callout-material-shader-variations",[!!a.occlusionTest,!!a.verticalOffset,!!a.screenSizePerspective,!0,!!a.depthHUDAlignStart,"screen"===a.centerOffsetUnits])};c.prototype.beginSlot=function(a){switch(a){case k.LINE_CALLOUTS:return this.isRenderSlot=!0;case k.LINE_CALLOUTS_HUD_DEPTH:return this.isRenderSlot=!1,!0}return!1};Object.defineProperty(c.prototype,"program",{get:function(){return this.isRenderSlot?this.renderProgram:
this.depthProgram},enumerable:!0,configurable:!0});c.prototype.getProgram=function(){return this.program};c.prototype.getPrograms=function(){return[this.renderProgram,this.depthProgram]};c.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};c.prototype.bind=function(a,c){var d=c.cameraAboveGround?1:-1,e=this.program,f=this.params;a.bindProgram(e);e.setUniform1f("cameraGroundRelative",d);e.setUniform1f("polygonOffset",f.shaderPolygonOffset);e.setUniform4fv("viewport",c.viewport);e.setUniformMatrix4fv("viewNormal",
c.viewInvTransp);e.setUniform1i("hudVisibilityTexture",0);a.bindTexture(c.hudVisibilityTexture,0);t(e,"color",f.color);e.setUniform2f("screenOffset",f.screenOffset[0],f.screenOffset[1]);this.bindBorder(a,c);b.bindVerticalOffset(f.verticalOffset,c,e);this.bindSizing(a,c);b.bindScreenSizePerspective(f.screenSizePerspective,e);this.isRenderSlot?this.bindRender(a,c):this.bindHUDDepth(a,c)};c.prototype.bindRender=function(a,c){a.setBlendFunctionSeparate(1,771,770,771);a.setBlendingEnabled(!0);a.setDepthWriteEnabled(!1)};
c.prototype.bindHUDDepth=function(a,c){a.setColorMask(!1,!1,!1,!1);a.setDepthWriteEnabled(!0);a.setBlendingEnabled(!1);a.setDepthTestEnabled(!0)};c.prototype.bindView=function(a,c){a=this.program;b.bindView(c.origin,c.view,a);b.bindCamPos(c.origin,c.viewInvTransp,a)};c.prototype.bindInstance=function(a,c){a=this.program;a.setUniformMatrix4fv("model",c.transformation);a.setUniformMatrix4fv("modelNormal",c.transformationNormal)};c.prototype.release=function(a,c){this.isRenderSlot?this.releaseRender(a,
c):this.releaseHUDDepth(a,c)};c.prototype.releaseRender=function(a,c){a.setBlendingEnabled(!1);a.setBlendFunction(770,771);a.setDepthWriteEnabled(!0)};c.prototype.releaseHUDDepth=function(a,c){a.setColorMask(!0,!0,!0,!0)};c.prototype.bindSizing=function(a,c){a=this.program;var b=this.params;a.setUniform2f("pixelToNDC",2/c.viewport[2],2/c.viewport[3]);a.setUniform1f("lineSize",Math.ceil(b.size))};c.prototype.bindBorder=function(a,c){a=this.program;c=this.params;null!==c.borderColor?(t(a,"borderColor",
c.borderColor),a.setUniform1f("borderSize",1)):(a.setUniform4f("borderColor",0,0,0,0),a.setUniform1f("borderSize",0))};return c}(g),n=[[0,0],[1,0],[0,1],[1,0],[1,1],[0,1]];return p})},"esri/views/3d/webgl-engine/materials/MeasurementArrowMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./MeasurementArrowMaterial.xml ../lib/gl-matrix ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ../../../webgl/Util".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t){var u=g.vec3d,r=g.mat4d,v=[{name:b.VertexAttrConstants.POSITION,count:3,type:5126,offset:0,stride:36,normalized:!1},{name:b.VertexAttrConstants.NORMAL,count:3,type:5126,offset:12,stride:36,normalized:!1},{name:b.VertexAttrConstants.UV0,count:2,type:5126,offset:24,stride:36,normalized:!1},{name:b.VertexAttrConstants.AUXPOS1,count:1,type:5126,offset:32,stride:36,normalized:!1}],q={width:32,outlineSize:.2,outlineColor:[1,.5,0,1],stripeLength:1,stripeEvenColor:[1,1,1,
1],stripeOddColor:[1,.5,0,1],polygonOffset:!1};p=function(f){function g(a,c){c=f.call(this,c)||this;c.params=l.copyParameters(a,q);return c}d(g,f);g.prototype.dispose=function(){};g.prototype.getParameterValues=function(){var a=this.params;return{width:a.width,outlineSize:a.outlineSize,outlineColor:a.outlineColor,stripeLength:a.stripeLength,stripeEvenColor:a.stripeEvenColor,stripeOddColor:a.stripeOddColor,polygonOffset:a.polygonOffset}};g.prototype.setParameterValues=function(a){l.updateParameters(this.params,
a)&&this.notifyDirty("matChanged")};g.prototype.getParams=function(){return this.params};g.prototype.getOutputAmount=function(a){return 18*(a/2+1)};g.prototype.getInstanceBufferLayout=function(){};g.prototype.getVertexBufferLayout=function(){return v};g.prototype.fillInterleaved=function(a,d,e,f,g,k){f=a.vertexAttr[b.VertexAttrConstants.POSITION].data;var h=a.vertexAttr[b.VertexAttrConstants.NORMAL].data,n=f.length/3;(a=a&&a.indices&&a.indices.position)&&a.length!==2*(n-1)&&console.warn("MeasurementArrowMaterial does not support indices");
a=k+t.findAttribute(v,b.VertexAttrConstants.POSITION).offset/4;var m=k+t.findAttribute(v,b.VertexAttrConstants.NORMAL).offset/4,q=k+t.findAttribute(v,b.VertexAttrConstants.UV0).offset/4;k+=t.findAttribute(v,b.VertexAttrConstants.AUXPOS1).offset/4;for(var p=w,y=c,E=x,B=z,C=A,G=0,P=0;P<n;++P){var O=3*P;u.set3(f[O],f[O+1],f[O+2],p);P<n-1&&(O=3*(P+1),u.set3(f[O],f[O+1],f[O+2],y),u.set3(h[O],h[O+1],h[O+2],C),u.normalize(C),u.subtract(y,p,E),u.normalize(E),u.cross(C,E,B),u.normalize(B));O=u.dist(p,y);d&&
e&&(r.multiplyVec3(d,p),r.multiplyVec3(d,y),r.multiplyVec3(e,B));l.fill(p,0,g,a,void 0,3);a+=9;l.fill(p,0,g,a,void 0,3);a+=9;l.fill(B,0,g,m,void 0,3);m+=9;l.fill(B,0,g,m,void 0,3);m+=9;g[q]=G;g[q+1]=-1;q+=9;g[q]=G;g[q+1]=1;q+=9;P<n-1&&(G+=O)}for(P=0;P<n;++P)g[k]=G,k+=9,g[k]=G,k+=9};g.prototype.intersect=function(a,c,b,d,e,f,g,k){};g.prototype.getGLMaterials=function(){return{color:n,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};g.prototype.getAllTextureIds=function(){return[]};
g.loadShaders=function(c,b,d){c._parse(a);c=new e("measurement-arrow",["vsMeasurementArrow","fsMeasurementArrow"],null,b,c,d);b.addShaderVariations("measurement-arrow-material-shader-variations",c)};return g}(k);var n=function(a){function c(c,b,d){b=a.call(this,c,b)||this;b.params=l.copyParameters(c.getParams());b.selectProgram();return b}d(c,a);c.prototype.selectProgram=function(){this.program=this.programRep.getShaderVariationsProgram("measurement-arrow-material-shader-variations",[])};c.prototype.updateParameters=
function(){this.params=this.material.getParameterValues();this.selectProgram()};c.prototype.beginSlot=function(a){return a===m.OPAQUE_MATERIAL};c.prototype.getProgram=function(){return this.program};c.prototype.getDrawMode=function(a){return a.gl.TRIANGLE_STRIP};c.prototype.bind=function(a,c){c=this.program;a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(!0);a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!1);this.params.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));
a.bindProgram(c);c.setUniform1f("width",this.params.width);c.setUniform1f("outlineSize",this.params.outlineSize);c.setUniform4fv("outlineColor",this.params.outlineColor);c.setUniform1f("stripeLength",this.params.stripeLength);c.setUniform4fv("stripeEvenColor",this.params.stripeEvenColor);c.setUniform4fv("stripeOddColor",this.params.stripeOddColor)};c.prototype.bindView=function(a,c){a=c.origin;var b=this.getProgram();l.bindView(a,c.view,b)};c.prototype.bindInstance=function(a,c){this.getProgram().setUniformMatrix4fv("model",
c.transformation)};c.prototype.release=function(a){a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(!0);a.setBlendingEnabled(!1);this.params.polygonOffset&&a.setPolygonOffsetFillEnabled(!1)};return c}(f),w=u.create(),c=u.create(),x=u.create(),z=u.create(),A=u.create();f=r.create();r.identity(f);return p})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./RibbonLineMaterial.xml ../../../../core/Logger ../lib/ComponentUtils ../lib/DefaultVertexBufferLayouts ../lib/gl-matrix ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/ShaderVariations ../lib/Util ./internal/MaterialUtil ../../../webgl/Util".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v){var q=u.VertexAttrConstants,n=g.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");p=function(b){function e(a,c){c=b.call(this,c)||this;c.params=r.copyParameters(a,Z);"miter"!==c.params.join&&(c.params.miterLimit=0);c.numVertsAtJoin="wall"===c.params.type?2:4;c.numVertsAtCap=2;c.canBeMerged="screen"===c.params.type&&null==c.params.stippleLength;return c}d(e,b);e.prototype.setColor=function(a){this.params.color=a;this.notifyDirty("matChanged")};
e.prototype.getColor=function(){return this.params.color};e.prototype.dispose=function(){};e.prototype.getParams=function(){return this.params};e.prototype.getParameterValues=function(){var a=this.params;return{color:a.color,width:a.width,type:a.type,join:a.join,polygonOffset:a.polygonOffset,miterLimit:a.miterLimit,stippleLength:a.stippleLength}};e.prototype.setParameterValues=function(a){for(var c in a)u.assert("type"!==c,"RibbonLineMaterial: type cannot be changed after creation"),u.assert("stippleLength"!==
c||null!=a[c]===(null!=this.params[c]),"RibbonLineMaterial: stippleLength on/off cannot be changed after creation"),this.params[c]=a[c];"miter"!==this.params.join&&(this.params.miterLimit=0);this.notifyDirty("matChanged")};e.prototype.getOutputAmount=function(a){a=(a/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap;this.canBeMerged&&(a+=2);return a*v.getStride(N)/4};e.prototype.getInstanceBufferLayout=function(){};e.prototype.getVertexBufferLayout=function(){return"wall"===this.params.type?R:N};e.prototype.fillInterleaved=
function(a,c,b,d,e,f){b=a.vertexAttr[q.POSITION].data;d=a.vertexAttr[q.COLOR]?a.vertexAttr[q.COLOR].data:x;var g=a.vertexAttr[q.SIZE]?a.vertexAttr[q.SIZE].data:z;(a=a.indices&&a.indices[q.POSITION])&&a.length!==2*(b.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");"wall"===this.params.type?this.fillWithoutAuxpos(b,c,e,f):this.fillWithAuxpos(b,d,g,c,e,f)};e.prototype.intersect=function(a,c,b,d,e,g,k,h){if(d.isSelection&&!f.isAllHidden(c.componentVisibilities,a.data.componentOffsets))if(u.isTranslationMatrix(b)){c=
a.getData();a=c.getVertexAttr()[q.POSITION].data;c=c.getVertexAttr()[q.SIZE];g=d.camera;h=d.point;c=((c&&c.data[0])+this.params.width)/2+4;m.vec3d.set3(h[0]-c,h[1]+c,0,H[0]);m.vec3d.set3(h[0]+c,h[1]+c,0,H[1]);m.vec3d.set3(h[0]+c,h[1]-c,0,H[2]);m.vec3d.set3(h[0]-c,h[1]-c,0,H[3]);for(var l=0;4>l;l++)g.unprojectPoint(H[l],K[l]);u.point2plane(g.eye,K[0],K[1],L);u.point2plane(g.eye,K[1],K[2],M);u.point2plane(g.eye,K[2],K[3],V);u.point2plane(g.eye,K[3],K[0],S);e=Number.MAX_VALUE;for(l=0;l<a.length-5;l+=
3)if(A[0]=a[l]+b[12],A[1]=a[l+1]+b[13],A[2]=a[l+2]+b[14],y[0]=a[l+3]+b[12],y[1]=a[l+4]+b[13],y[2]=a[l+5]+b[14],!(0>u.planeDistance(A,L)&&0>u.planeDistance(y,L)||0>u.planeDistance(A,M)&&0>u.planeDistance(y,M)||0>u.planeDistance(A,V)&&0>u.planeDistance(y,V)||0>u.planeDistance(A,S)&&0>u.planeDistance(y,S))){g.projectPoint(A,C);g.projectPoint(y,G);if(0>C[2]&&0<G[2]){m.vec3d.subtract(A,y,B);var r=g.frustumPlanes,t=-(m.vec3d.dot(r[4],A)+r[4][3]),r=t/m.vec3d.dot(B,r[4]);m.vec3d.scale(B,r,B);m.vec3d.add(A,
B,A);g.projectPoint(A,C)}else if(0<C[2]&&0>G[2])m.vec3d.subtract(y,A,B),r=g.frustumPlanes,t=-(m.vec3d.dot(r[4],y)+r[4][3]),r=t/m.vec3d.dot(B,r[4]),m.vec3d.scale(B,r,B),m.vec3d.add(y,B,y),g.projectPoint(y,G);else if(0>C[2]&&0>G[2])continue;r=u.pointLineSegmentDistanceSquared2D(C,G,h);r<e&&(e=r,m.vec3d.set(A,J),m.vec3d.set(y,F))}b=d.p0;d=d.p1;e<c*c&&(a=u.lineLineDistanceSquared3D(J,F,b,d,I),c=Number.MAX_VALUE,a.success&&(m.vec3d.subtract(a.pa,b,E),a=m.vec3d.length(E),m.vec3d.scale(E,1/a),c=a/m.vec3d.dist(b,
d)),k(c,E))}else n.error("intersection assumes a translation-only matrix")};e.prototype.getGLMaterials=function(){return{color:w,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:c}};e.prototype.getAllTextureIds=function(){return[]};e.prototype.fillWithAuxpos=function(a,c,b,d,e,f){var g=a.length/3,k=a[0],h=a[1],l=a[2],n=0,m=f,r=v.getStride(this.getVertexBufferLayout())/4;this.canBeMerged&&(f+=r);d&&(k=d[0]*k+d[4]*h+d[8]*l+d[12],h=d[1]*k+d[5]*h+d[9]*l+d[13],l=d[2]*k+d[6]*h+d[10]*l+d[14]);
var q=k,t=h,u=l,p=a[3],w=a[4],x=a[5];d&&(p=d[0]*p+d[4]*w+d[8]*x+d[12],w=d[1]*p+d[5]*w+d[9]*x+d[13],x=d[2]*p+d[6]*w+d[10]*x+d[14]);for(var z=0;z<g;z++){var y=3*z;z<g-1&&(p=a[y+3],w=a[y+4],x=a[y+5],d&&(p=d[0]*p+d[4]*w+d[8]*x+d[12],w=d[1]*p+d[5]*w+d[9]*x+d[13],x=d[2]*p+d[6]*w+d[10]*x+d[14]));n+=Math.sqrt((q-k)*(q-k)+(t-h)*(t-h)+(u-l)*(u-l));e[f++]=q;e[f++]=t;e[f++]=u;e[f++]=n;e[f++]=0===z?-1.2:-1;e[f++]=k;e[f++]=h;e[f++]=l;e[f++]=p;e[f++]=w;e[f++]=x;e[f++]=c[0];e[f++]=c[1];e[f++]=c[2];e[f++]=c[3];e[f++]=
b[0];e[f++]=q;e[f++]=t;e[f++]=u;e[f++]=n;e[f++]=0===z?1.2:1;e[f++]=k;e[f++]=h;e[f++]=l;e[f++]=p;e[f++]=w;e[f++]=x;e[f++]=c[0];e[f++]=c[1];e[f++]=c[2];e[f++]=c[3];e[f++]=b[0];0<z&&z<g-1&&(e[f++]=q,e[f++]=t,e[f++]=u,e[f++]=n,e[f++]=-1.2,e[f++]=k,e[f++]=h,e[f++]=l,e[f++]=p,e[f++]=w,e[f++]=x,e[f++]=c[0],e[f++]=c[1],e[f++]=c[2],e[f++]=c[3],e[f++]=b[0],e[f++]=q,e[f++]=t,e[f++]=u,e[f++]=n,e[f++]=1.2,e[f++]=k,e[f++]=h,e[f++]=l,e[f++]=p,e[f++]=w,e[f++]=x,e[f++]=c[0],e[f++]=c[1],e[f++]=c[2],e[f++]=c[3],e[f++]=
b[0]);k=q;h=t;l=u;q=p;t=w;u=x}if(this.canBeMerged){for(z=m;z<m+r;z++)e[z]=e[z+r];a=f-r;for(z=0;z<r;z++)e[f++]=e[a++]}};e.prototype.fillWithoutAuxpos=function(a,c,b,d){for(var e=a.length/3,f=0,g=a[0],k=a[1],h=a[2],l,n,m,r=0;r<e;r++){var q=3*r;l=g;n=k;m=h;g=a[q];k=a[q+1];h=a[q+2];c&&(g=c[0]*g+c[4]*k+c[8]*h+c[12],k=c[1]*g+c[5]*k+c[9]*h+c[13],h=c[2]*g+c[6]*k+c[10]*h+c[14]);f+=Math.sqrt((g-l)*(g-l)+(k-n)*(k-n)+(h-m)*(h-m));b[d++]=g;b[d++]=k;b[d++]=h;b[d++]=f;b[d++]=-1;b[d++]=g;b[d++]=k;b[d++]=h;b[d++]=
f;b[d++]=1}};e.loadShaders=function(c,b,d){c._parse(a);var e=function(a){a.addDefine("Screen","SCREENSCALE");a.addDefine("Strip","STRIP");a.addDefine("Wall","WALL");a.addDefine("Stipple","STIPPLE")},f=new t("ribbon-line",["vsRibbonLine","fsRibbonLine"],null,b,c,d);e(f);b.addShaderVariations("ribbon-line-material-shader-variations",f);c=new t("ribbon-line",["vsRibbonLine","fsRibbonLineHighlight"],null,b,c,d);e(c);b.addShaderVariations("ribbon-line-material-highlight-shader-variations",c)};return e}(b);
var w=function(a){function c(c,b){var d=a.call(this,c,b)||this;d.params=r.copyParameters(c.getParams());delete d.params.join;d.program=b.getShaderVariationsProgram("ribbon-line-material-shader-variations",["screen"===d.params.type,"strip"===d.params.type,"wall"===d.params.type,null!=d.params.stippleLength]);return d}d(c,a);c.prototype.updateParameters=function(){var a=this.material.getParams(),c=this.params;c.polygonOffset=a.polygonOffset;c.color=a.color;c.width=a.width;c.miterLimit="miter"===a.join?
a.miterLimit:0;c.stippleLength=a.stippleLength};c.prototype.beginSlot=function(a){return a===l.TRANSPARENT_MATERIAL};c.prototype.getProgram=function(){return this.program};c.prototype.bind=function(a,c){var b=this.program,d=this.params;a.bindProgram(b);b.setUniform4fv("eColor",d.color);b.setUniform1f("miterLimit",d.miterLimit);b.setUniform1f("nearPlane",c.nearFar[0]);"screen"===d.type?(b.setUniform2fv("screenSize",[c.viewport[2],c.viewport[3]]),b.setUniform1f("extLineWidth",d.width*c.pixelRatio)):
b.setUniform1f("extLineWidth",d.width);null!=d.stippleLength&&b.setUniform1f("stippleLengthDoubleInv",d.stippleLength?1/(2*d.stippleLength):0);d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(1<=d.color[3])};c.prototype.release=function(a){this.params.polygonOffset&&a.setPolygonOffsetFillEnabled(!1);
a.setBlendingEnabled(!1);a.setDepthWriteEnabled(!0)};c.prototype.bindView=function(a,c){r.bindView(c.origin,c.view,this.program)};c.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",c.transformation)};c.prototype.getDrawMode=function(a){return a.gl.TRIANGLE_STRIP};return c}(e),c=function(a){function c(c,b){var d=a.call(this,c,b)||this;d.params=r.copyParameters(c.getParams());delete d.params.join;d.program=b.getShaderVariationsProgram("ribbon-line-material-highlight-shader-variations",
["screen"===d.params.type,"strip"===d.params.type,"wall"===d.params.type,null!=d.params.stippleLength]);return d}d(c,a);c.prototype.updateParameters=function(){var a=this.material.getParams(),c=this.params;c.polygonOffset=a.polygonOffset;c.color=a.color;c.width=a.width;c.miterLimit="miter"===a.join?a.miterLimit:0;c.stippleLength=a.stippleLength};c.prototype.beginSlot=function(a){return a===l.OPAQUE_MATERIAL};c.prototype.getProgram=function(){return this.program};c.prototype.bind=function(a,c){var b=
this.program,d=this.params;a.bindProgram(b);b.setUniform4fv("eColor",d.color);b.setUniform1f("miterLimit",d.miterLimit);b.setUniform1f("nearPlane",c.nearFar[0]);"screen"===d.type?(b.setUniform2fv("screenSize",[c.viewport[2],c.viewport[3]]),b.setUniform1f("extLineWidth",d.width*c.pixelRatio)):b.setUniform1f("extLineWidth",d.width);null!=d.stippleLength&&b.setUniform1f("stippleLengthDoubleInv",d.stippleLength?1/(2*d.stippleLength):0);d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,
-4));a.setFaceCullingEnabled(!1);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(1<=d.color[3])};c.prototype.release=function(a){this.params.polygonOffset&&a.setPolygonOffsetFillEnabled(!1);a.setDepthWriteEnabled(!0)};c.prototype.bindView=function(a,c){r.bindView(c.origin,c.view,this.program)};c.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",c.transformation)};c.prototype.getDrawMode=function(a){return a.gl.TRIANGLE_STRIP};return c}(e),x=[255,255,255,255],z=[0,0,0,
0],A=m.vec3d.create(),y=m.vec3d.create(),B=m.vec3d.create(),E=m.vec3d.create(),C=m.vec3d.create(),G=m.vec3d.create(),J=m.vec3d.create(),F=m.vec3d.create(),I={success:!1,dist2:0,pa:m.vec3d.create(),pb:m.vec3d.create()},H=[m.vec3d.create(),m.vec3d.create(),m.vec3d.create(),m.vec3d.create()],K=[m.vec3d.create(),m.vec3d.create(),m.vec3d.create(),m.vec3d.create()],L=m.vec4d.create(),M=m.vec4d.create(),V=m.vec4d.create(),S=m.vec4d.create(),Z={color:[1,1,1,1],width:0,type:"screen",join:"miter",miterLimit:5,
polygonOffset:!1,stippleLength:null},R=k.Pos3Tex,N=[{name:"position",count:3,type:5126,offset:0,stride:64,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:64,normalized:!1},{name:"auxpos1",count:3,type:5126,offset:20,stride:64,normalized:!1},{name:"auxpos2",count:3,type:5126,offset:32,stride:64,normalized:!1},{name:"color",count:4,type:5126,offset:44,stride:64,normalized:!1},{name:"size",count:1,type:5126,offset:60,stride:64,normalized:!1}];return p})},"esri/views/3d/webgl-engine/materials/internal/BlendLayers":function(){define(["require",
"exports","dojo/text!./BlendLayers.xml","../../lib/DefaultVertexAttributeLocations","../../../../webgl/Program"],function(p,h,d,a,g){return function(){function f(){}f.loadShaders=function(f,h,e){f._parse(d);f=new g(e,f.vertexShaderBlendLayers,f.fragmentShaderBlendLayers,a.Default3D);h.add("blendLayers",f)};return f}()})},"esri/views/3d/webgl-engine/materials/internal/SimpleGLMaterial":function(){define("require exports dojo/text!./SimpleGLMaterial.xml ../../lib/DefaultVertexAttributeLocations ../../lib/RenderSlot ./MaterialUtil ../../../../webgl/Program".split(" "),
function(p,h,d,a,g,f,k){return function(){function h(a,b,d,f){void 0===f&&(f=4);this.program=a.get("simple");this.color=b;this.depthFunc=d;this.drawMode=f}h.prototype.beginSlot=function(a){return a===g.INTERNAL_MATERIAL};h.prototype.getProgram=function(){return this.program};h.prototype.bind=function(a,b){a.bindProgram(this.program);this.program.setUniformMatrix4fv("model",f.IDENTITY);this.program.setUniformMatrix4fv("proj",b.proj);this.program.setUniform4fv("color",this.color);a.setBlendingEnabled(!0);
a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);a.setDepthTestEnabled(!0);void 0!==this.depthFunc&&a.setDepthFunction(this.depthFunc)};h.prototype.release=function(a){void 0!==this.depthFunc&&a.setDepthFunction(513);a.setBlendingEnabled(!1)};h.prototype.bindView=function(a,b){f.bindView(b.origin,b.view,this.program)};h.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};h.prototype.getDrawMode=function(a){return this.drawMode};
h.loadShaders=function(e,b,f){e._parse(d);e=new k(f,e.vertexShaderSimple,e.fragmentShaderSimple,a.Default3D);b.add("simple",e)};return h}()})},"esri/views/3d/webgl-engine/parts/Viewport":function(){define("require exports dojo/has ../lib/Camera ../lib/gl-matrix ../lib/PerformanceTimer ../lib/Util ./Visualizer".split(" "),function(p,h,d,a,g,f,k,m){var e=g.vec3;p=g.vec4d;var b=g.mat4d,l=[0,0],t=b.create(),u=[p.create(),p.create(),p.create(),p.create(),p.create(),p.create()];return function(){function d(b,
d,f,g){this._content={};this._frustumCullingEnabled=!0;this._maxFarNearRatio=2E4;this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,visualizerRenderTimer:null,viewportRenderTimer:null};this._needsRender=!0;this._rctx=g;this._gl=g.gl;this._visualizer=new m(b,d,f,this._rctx);this._camera=new a(e.createFrom(0,100,-100),e.createFrom(0,0,0))}Object.defineProperty(d.prototype,"isLoadingResources",{get:function(){return this._visualizer.isLoadingResources},enumerable:!0,configurable:!0});d.prototype.getCombinedStats=
function(){var a={},b=this._visualizer.getCombinedStats(),d;for(d in b)a[d]=b[d];a.renderGeometriesTotal=this._stats.renderGeometriesTotal;a.renderGeometriesVisible=this._stats.renderGeometriesVisible;void 0!==this._gl.getUsedTextureMemory&&(a.textureMemory=this._gl.getUsedTextureMemory());void 0!==this._gl.getUsedRenderbufferMemory&&(a.renderbufferMemory=this._gl.getUsedRenderbufferMemory());void 0!==this._gl.getUsedVBOMemory&&(a.VBOMemory=this._gl.getUsedVBOMemory());if(void 0!==this._gl.getUsedTextureMemoryStats){var b=
this._gl.getUsedTextureMemoryStats(),e;for(e in b)a["texMem type: "+e]=b[e]}return a};d.prototype.dispose=function(){this._visualizer.dispose();this._visualizer=null};d.prototype.setLighting=function(a){this._visualizer.setLighting(a)};d.prototype.getViewParams=function(a){var b=this._visualizer.getViewParams(a);if(!a||a.frustumCullingEnabled)b.frustumCullingEnabled=this._frustumCullingEnabled;if(!a||a.maxFarNearRatio)b.maxFarNearRatio=this._maxFarNearRatio;return b};d.prototype.setViewParams=function(a){void 0!==
a.frustumCullingEnabled&&(this._frustumCullingEnabled=a.frustumCullingEnabled);void 0!==a.maxFarNearRatio&&(this._maxFarNearRatio=-1===a.maxFarNearRatio?2E4:a.maxFarNearRatio);this._visualizer.setViewParams(a);this._needsRender=!0};d.prototype.setRenderParams=function(a){this._visualizer.setRenderParams(a)};d.prototype.getRenderParams=function(){return this._visualizer.getRenderParams()};d.prototype.getFrustumObjects=function(){var a={},b;for(b in this._content)a[this._content[b].name]=1;return a};
d.prototype.getEdgeView=function(){return this._visualizer.getEdgeView()};d.prototype.modify=function(a,b,d,e){this._visualizer.modify(a,b,d,e);this._content=this._visualizer.getContent()};d.prototype.getContent=function(){return this._content};d.prototype.setCamera=function(a){this._camera.copyFrom(a);this._updateNearFar();this._needsRender=!0};d.prototype.getCamera=function(){return this._camera};d.prototype.getPickRay=function(a,b,d){return this.pickRayWithBeginPoint(a,void 0,this._camera.viewMatrix,
b,d)};d.prototype.pickRayWithBeginPoint=function(a,b,d,e,c){return this._visualizer.getPickRay(a,b,this._camera,d,e,c)};d.prototype.addExternalRenderer=function(a,b){return this._visualizer.addExternalRenderer(a,b)};d.prototype.removeExternalRenderer=function(a){return this._visualizer.removeExternalRenderer(a)};d.prototype.getExternalRenderers=function(){return this._visualizer.getExternalRenderers()};d.prototype.render=function(a,b){this._updateNearFar();this._visualizer.render(this._camera,a,b)};
d.prototype.resetNeedsRender=function(){this._needsRender=!1;this._visualizer.resetNeedsRender()};d.prototype.needsRender=function(){return this._needsRender||this._visualizer.needsRender()};d.prototype._updateNearFar=function(){if(this._frustumCullingEnabled||0<this._maxFarNearRatio)l[1]=0,this._computeFrustumCullingAndNearFar(this._camera.eye,l),0<this._maxFarNearRatio&&0<l[1]&&(this._camera.far=l[1],this._camera.near=Math.max(l[0],this._camera.far/this._maxFarNearRatio))};d.prototype._computeFrustumCullingAndNearFar=
function(a,d){b.perspective(this._camera.fovY,this._camera.aspect,1,10,t);k.matrix2frustumPlanes(this._camera.viewMatrix,t,u);this._stats.renderGeometriesTotal=0;this._stats.renderGeometriesVisible=0;a=-Number.MAX_VALUE;var e=-Number.MAX_VALUE,f=u[0][0],c=u[0][1],g=u[0][2],h=u[0][3],l=u[1][0],m=u[1][1],r=u[1][2],q=u[1][3],v=u[2][0],p=u[2][1],J=u[2][2],F=u[2][3],I=u[3][0],H=u[3][1],K=u[3][2],L=u[3][3],M=u[4][0],V=u[4][1],S=u[4][2],Z=u[4][3],R=u[5][3],N;for(N in this._content){var D=this._content[N];
this._stats.renderGeometriesTotal++;var P=D.center,O=P[0],Q=P[1],P=P[2],D=D.bsRadius;f*O+c*Q+g*P+h>D||l*O+m*Q+r*P+q>D||v*O+p*Q+J*P+F>D||I*O+H*Q+K*P+L>D||(Q=M*O+V*Q+S*P,O=Q+D,Q=-Q+D,O>a&&(a=O),Q>e&&(e=Q),this._stats.renderGeometriesVisible++)}N=a!==-Number.MAX_VALUE;0<this._stats.renderGeometriesVisible&&N&&(d[0]=.99*Math.max(1-(a+Z),2),d[1]=1.01*Math.max(10+(e+R),d[0]+1))};return d}()})},"esri/views/3d/webgl-engine/parts/Visualizer":function(){define("require exports ../lib/gl-matrix ../lib/HighlightHelper ../lib/NearFarCalc ../lib/OffscreenRenderingHelper ../lib/Renderer ../lib/RenderOccludedHelper ../lib/RenderPass ../lib/ShadowMap ../lib/SSAOHelperObscurance ../lib/Util".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t){var u=d.vec3d,r=d.mat4d,v=t.assert;return function(){function d(d,e,c,h){this._drawSSAOMapDebugQuad=this._drawShadowMapDebugQuad=!1;this._needsRender=!0;this._content={};this._rctx=h;this._renderer=new k(d,e,c,this._rctx,!1);this._programRep=d;this._nearFarCalc=new g;this._helpers={shadowMap:new b(d,this._rctx),ssao:new l(d,c,this._rctx,this.setNeedsRender.bind(this)),highlight:new a(d,c,this._rctx),renderOccluded:new m(d,c,this._rctx),offscreenRendering:new f(d,
this._rctx)}}Object.defineProperty(d.prototype,"isLoadingResources",{get:function(){return this._renderer.isLoadingResources},enumerable:!0,configurable:!0});d.prototype.getCombinedStats=function(){return this._renderer.getCombinedStats()};d.prototype.dispose=function(){this._renderer.dispose();this._helpers.shadowMap.getEnableState()&&this._helpers.shadowMap.setEnableState(!1);this._helpers.shadowMap.dispose();this._helpers.ssao.getEnableState()&&this._helpers.ssao.setEnableState(!1);this._helpers.ssao.dispose();
this._helpers.highlight.getEnableState()&&this._helpers.highlight.setEnableState(!1);this._helpers.renderOccluded.getEnableState()&&this._helpers.renderOccluded.setEnableState(!1);this._helpers.offscreenRendering.getEnableState()&&this._helpers.offscreenRendering.setEnableState(!1)};d.prototype.setLighting=function(a){this._renderer.setLighting(a)};d.prototype.getViewParams=function(a){var b=a||{};if(!a||a.pixelRatio)b.pixelRatio=this._renderer.getPixelRatio();return b};d.prototype.setViewParams=
function(a){null!=a.pixelRatio&&this._renderer.setPixelRatio(a.pixelRatio)};d.prototype.setRenderParams=function(a){void 0!==a.shadowMapResolution&&!1===this._helpers.shadowMap.getEnableState()&&this._helpers.shadowMap.setTextureResolution(a.shadowMapResolution);void 0!==a.shadowMap&&a.shadowMap!==this._helpers.shadowMap.getEnableState()&&this._helpers.shadowMap.setEnableState(a.shadowMap);void 0!==a.shadowMapMaxCascades&&this._helpers.shadowMap.setMaxNumCascades(a.shadowMapMaxCascades);!0!==this._helpers.highlight.getEnableState()&&
this._helpers.highlight.setEnableState(!0);void 0!==a.ssao&&a.ssao!==this._helpers.ssao.getEnableState()&&this._helpers.ssao.setEnableState(a.ssao);void 0!==a.ssaoAttenuation&&this._helpers.ssao.setAttenuation(a.ssaoAttenuation);void 0!==a.ssaoRadius&&this._helpers.ssao.setRadius(a.ssaoRadius);void 0!==a.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter.");void 0!==a.ssaoSamples&&this._helpers.ssao.setSamples(a.ssaoSamples);void 0!==a.drawShadowMapDebugQuad&&
(this._drawShadowMapDebugQuad=a.drawShadowMapDebugQuad);void 0!==a.drawSSAODebugQuad&&(this._drawSSAOMapDebugQuad=a.drawSSAODebugQuad);this._helpers.ssao.getEnableState()?this._renderer.ssaoEnabled=!0:this._renderer.ssaoEnabled=!1;void 0!==a.offscreenRendering&&a.offscreenRendering!==this._helpers.offscreenRendering.getEnableState()&&this._helpers.offscreenRendering.setEnableState(a.offscreenRendering);void 0!==a.antialiasingEnabled&&(this._renderer.renderOptions.antialiasing=a.antialiasingEnabled?
"smaa":"none");void 0!==a.earlyOcclusionPixelDraw&&(this._renderer.renderOptions.earlyOcclusionPixelDraw=a.earlyOcclusionPixelDraw);void 0!==a.defaultHighlightOptions&&this._helpers.highlight.setDefaultOptions(a.defaultHighlightOptions);this._needsRender=!0};d.prototype.getRenderParams=function(){var a={};this._helpers.shadowMap.getIsSupported()&&(a.shadowMap=this._helpers.shadowMap.getEnableState(),a.shadowMapResolution=this._helpers.shadowMap.getTextureResolution(),a.shadowMapMaxCascades=this._helpers.shadowMap.getMaxNumCascades());
this._helpers.ssao.getIsSupported()&&(a.ssao=this._helpers.ssao.getEnableState(),a.ssaoAttenuation=this._helpers.ssao.getAttenuation(),a.ssaoRadius=this._helpers.ssao.getRadius(),a.ssaoFilterRadius=this._helpers.ssao.getFilterRadius(),a.ssaoSamples=this._helpers.ssao.getSamples());return a};d.prototype.modify=function(a,b,c,d){this._renderer.modify(a,b,c,d);for(d=0;d<b.length;++d)delete this._content[b[d].uniqueName];for(d=0;d<a.length;++d)this._content[a[d].uniqueName]=a[d];for(d=0;d<c.length;++d)v(this._content[c[d].renderGeometry.uniqueName]===
c[d].renderGeometry)};d.prototype.getContent=function(){return this._content};d.prototype.getPickRay=function(a,b,c,d,e,f){u.unproject(u.createFrom(a[0],a[1],0),d,c.projectionMatrix,c.fullViewport,e);u.unproject(u.createFrom(a[0],a[1],1),d,c.projectionMatrix,c.fullViewport,f)};d.prototype.getProjectionMatrix=function(a,b,c,d,e){b=t.fovx2fovy(b,a[2],a[3]);r.perspective(180*b/Math.PI,a[2]/a[3],c,d,e)};d.prototype.addExternalRenderer=function(a,b){return this._renderer.addExternalRenderer(a,b)};d.prototype.removeExternalRenderer=
function(a){return this._renderer.removeExternalRenderer(a)};d.prototype.getExternalRenderers=function(){return this._renderer.getExternalRenderers()};d.prototype.resetNeedsRender=function(){this._needsRender=!1;this._renderer.resetNeedsRender()};d.prototype.needsRender=function(){return this._needsRender||this._renderer.needsRender()};d.prototype.setNeedsRender=function(){this._needsRender=!0};d.prototype.render=function(a,b,c){var d=a.viewport,f;if(this._helpers.shadowMap.getEnableState()){f=this._nearFarCalc.calculateSceneNearFar(a,
this._content);this._helpers.shadowMap.prepare(a,b,this._content,f);b=this._helpers.shadowMap.getCascades();for(f=0;f<b.length;++f){var g=b[f];g.camera.setGLViewport(this._rctx);this._renderer.renderGeometryPass(e.MATERIAL_DEPTH_SHADOWMAP,g.camera)}this._helpers.shadowMap.finish(c);a.setGLViewport(this._rctx)}this._helpers.shadowMap.bindAll(this._programRep);this._renderer.renderAuxiliaryBuffers(a,c,this._helpers);this._renderer.render(a,c,this._helpers);this._drawShadowMapDebugQuad&&this._helpers.shadowMap.getEnableState()&&
(a=r.ortho(d[0],d[2],d[1],d[3],-1,1),this._helpers.shadowMap.drawDebugQuad(a));this._drawSSAOMapDebugQuad&&this._helpers.ssao.getEnableState()&&(a=r.ortho(d[0],d[2],d[1],d[3],-1,1),this._helpers.ssao.drawQuad(a))};d.prototype.getEdgeView=function(){return this._renderer.edgeView};return d}()})},"esri/views/3d/webgl-engine/lib/NearFarCalc":function(){define(["require","exports","./ComponentUtils","./gl-matrix","./Util"],function(p,h,d,a,g){p=a.vec3d;var f=a.vec4d,k=a.mat4d;a=function(){function a(){this._context=
{content:[],near:[],far:[],nearSpecial:[],farSpecial:[],bestNear:0,bestFar:0,bestNear2:0,bestFar2:0};this._boundingInfoHelper=new m}a.prototype._resetContext=function(){var a=this._context;a.content.length=0;a.near.length=0;a.far.length=0;a.nearSpecial.length=0;a.farSpecial.length=0;a.bestNear=Number.MAX_VALUE;a.bestFar=-Number.MAX_VALUE;return this._context};a.prototype.calculateSceneNearFar=function(a,b){var e=this._resetContext(),f=a.viewMatrix,g=f[2],c=f[6],k=f[10],h=f[14],m=0,r;for(r in b)if(f=
b[r],!d.isAllHidden(f.instanceParameters.componentVisibilities,f.componentOffsets)&&f.castShadow){var t=void 0,v=void 0;f.hasShaderTransformation?(t=f.getBoundingSphere(f.getShaderTransformation(),null,l),v=l):(t=f.bsRadius,v=f.center);var u=g*v[0]+c*v[1]+k*v[2]+h,v=u-t,t=u+t;e.content[m]=f;e.near[m]=-t;e.far[m]=-v;++m}if(0===m)return[e.bestNear,e.bestFar];for(b=0;b<m;++b)e.near[b]>e.bestFar&&(e.bestFar=e.near[b]),2<e.near[b]&&e.far[b]<e.bestNear&&(e.bestNear=e.far[b]);e.bestNear2=Math.max(.5*e.bestNear,
2);e.bestFar2=2*e.bestFar;for(b=c=g=0;b<m;++b)e.near[b]<e.bestNear&&(e.near[b]>=e.bestNear2?e.bestNear=e.near[b]:e.nearSpecial[g++]=b),e.far[b]>e.bestFar&&(e.far[b]<=e.bestFar2?e.bestFar=e.far[b]:e.farSpecial[c++]=b);if(0===g&&0===c)return[e.bestNear,e.bestFar];e.nearSpecial.length=g;e.farSpecial.length=c;e.nearSpecial.sort(function(a,c){return e.near[a]<e.near[c]?-1:e.near[a]>e.near[c]?1:0});e.farSpecial.sort(function(a,c){return e.far[a]<e.far[c]?1:e.far[a]>e.far[c]?-1:0});this._boundingInfoHelper.init(a,
e);for(b=0;b<g;++b)e.near[e.nearSpecial[b]]<e.bestNear&&(f=e.content[e.nearSpecial[b]],a=f.boundingInfo,this._boundingInfoHelper.includeNearBoundingInfoRec(a,f.getShaderTransformation()));for(b=0;b<c;++b)e.far[e.farSpecial[b]]>e.bestFar&&(f=e.content[e.farSpecial[b]],a=f.boundingInfo,this._boundingInfoHelper.includeFarBoundingInfoRec(a,f.getShaderTransformation()));return[e.bestNear,e.bestFar]};return a}();var m=function(){function a(){this._clippingHelper=new e;this._planes=[f.create(),f.create(),
f.create(),f.create(),f.create(),f.create()];this._viewProj=k.create();this._view=k.create()}a.prototype.init=function(a,b){this._context=b;k.set(a.viewMatrix,this._view);k.multiply(a.projectionMatrix,this._view,this._viewProj);a.copyFrustumPlanes(this._planes);this._clippingHelper.init(b)};a.prototype.includeNearBoundingInfoRec=function(a,b){var d=a.getBSRadius(),e=a.getCenter();k.multiplyVec3(b,e,l);var e=l[0],f=l[1],c=l[2],d=d*Math.sqrt(Math.max(Math.max(b[0]*b[0]+b[4]*b[4]+b[8]*b[8],b[1]*b[1]+
b[5]*b[5]+b[9]*b[9]),b[2]*b[2]+b[6]*b[6]+b[10]*b[10]));if(!(this._planes[0][0]*e+this._planes[0][1]*f+this._planes[0][2]*c+this._planes[0][3]>d||this._planes[1][0]*e+this._planes[1][1]*f+this._planes[1][2]*c+this._planes[1][3]>d||this._planes[2][0]*e+this._planes[2][1]*f+this._planes[2][2]*c+this._planes[2][3]>d||this._planes[3][0]*e+this._planes[3][1]*f+this._planes[3][2]*c+this._planes[3][3]>d||(e=this._view[2]*e+this._view[6]*f+this._view[10]*c+this._view[14],f=e+d,2>-(e-d)||-f>=this._context.bestNear)))if(-f>
this._context.bestNear2)this._context.bestNear=-f;else{if(100<d&&(d=a.getChildren(),void 0!==d)){for(a=0;8>a;++a)void 0!==d[a]&&this.includeNearBoundingInfoRec(d[a],b);return}this._clippingHelper.intersectFrustumAABB(this._viewProj,b,a.getBBMin(),a.getBBMax())}};a.prototype.includeFarBoundingInfoRec=function(a,b){var d=a.getBSRadius(),e=a.getCenter();k.multiplyVec3(b,e,l);var e=l[0],f=l[1],c=l[2],d=d*Math.sqrt(Math.max(Math.max(b[0]*b[0]+b[4]*b[4]+b[8]*b[8],b[1]*b[1]+b[5]*b[5]+b[9]*b[9]),b[2]*b[2]+
b[6]*b[6]+b[10]*b[10]));if(!(this._planes[0][0]*e+this._planes[0][1]*f+this._planes[0][2]*c+this._planes[0][3]>d||this._planes[1][0]*e+this._planes[1][1]*f+this._planes[1][2]*c+this._planes[1][3]>d||this._planes[2][0]*e+this._planes[2][1]*f+this._planes[2][2]*c+this._planes[2][3]>d||this._planes[3][0]*e+this._planes[3][1]*f+this._planes[3][2]*c+this._planes[3][3]>d||(e=this._view[2]*e+this._view[6]*f+this._view[10]*c+this._view[14]-d,-e<=this._context.bestFar)))if(-e<this._context.bestFar2)this._context.bestFar=
-e;else{if(100<d&&(d=a.getChildren(),void 0!==d)){for(a=0;8>a;++a)void 0!==d[a]&&this.includeFarBoundingInfoRec(d[a],b);return}this._clippingHelper.intersectFrustumAABB(this._viewProj,b,a.getBBMin(),a.getBBMax())}};return a}(),e=function(){function a(){this._clipP=Array(8);for(var a=0;8>a;++a)this._clipP[a]=f.create()}a.prototype.init=function(a){this._context=a};a.prototype.intersectFrustumAABB=function(a,d,e,f){k.multiply(a,d,t);for(a=0;8>a;++a){d=this._clipP[a];var g=0===a||3===a||4===a||7===a?
e[0]:f[0],c=0===a||1===a||4===a||5===a?e[1]:f[1],h=4>a?e[2]:f[2];d[0]=t[0]*g+t[4]*c+t[8]*h+t[12];d[1]=t[1]*g+t[5]*c+t[9]*h+t[13];d[2]=t[2]*g+t[6]*c+t[10]*h+t[14];d[3]=t[3]*g+t[7]*c+t[11]*h+t[15]}for(a=0;12>a;++a){e=this._clipTriangle(this._clipP[b[a][0]],this._clipP[b[a][1]],this._clipP[b[a][2]]);f=!0;for(d=0;d<e.length;++d)if(g=e[d][3],2<=g){f=!1;break}if(!f)for(d=0;d<e.length;++d)g=e[d][3],g<this._context.bestNear&&(this._context.bestNear=g),g>this._context.bestFar&&(this._context.bestFar=g)}};
a.prototype._inside=function(a,b){if(0===b)return a[0]>=-a[3];if(1===b)return a[1]>=-a[3];if(2===b)return a[0]<=a[3];if(3===b)return a[1]<=a[3];g.assert(!1)};a.prototype._intersect=function(a,b,d){var e=0;0===d?e=(-a[3]-a[0])/(b[0]-a[0]+b[3]-a[3]):1===d?e=(-a[3]-a[1])/(b[1]-a[1]+b[3]-a[3]):2===d?e=(a[3]-a[0])/(b[0]-a[0]-b[3]+a[3]):3===d&&(e=(a[3]-a[1])/(b[1]-a[1]-b[3]+a[3]));return f.lerp(a,b,e,f.create())};a.prototype._clipTriangle=function(a,b,d){a=[a,b,d];for(b=0;4>b;++b){d=a;a=[];for(var e=0;e<
d.length;++e){var f=d[e],c=d[(e+1)%d.length];this._inside(c,b)?(this._inside(f,b)||a.push(this._intersect(f,c,b)),a.push(c)):this._inside(f,b)&&a.push(this._intersect(f,c,b))}}return a};return a}(),b=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],l=p.create(),t=k.create();return a})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("./Camera ./Util ./gl-matrix ./glUtil3D ../../../../core/Logger ../../../webgl/Texture ../../../webgl/FramebufferObject ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/Util".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t){var u=d.vec2d,r=d.vec3d,v=d.vec4d,q=d.mat3d,n=d.mat4d,w=d.mat4,c=g.getLogger("esri.views.3d.webgl-engine.lib.ShadowMap");return function(d,g){function x(a,c){r.set3(a[c],a[c+3],a[c+6],va);return va}var z=g.gl,B,E=4096,C,G=a.createEmptyTexture(g),J=1,F=2,I=[0,0,0,0,0];this.dispose=function(){G.dispose();G=null};var H=function(){this.camera=new p;this.lightMat=n.create()},K=[],L,M,V;for(L=0;4>L;++L)K[L]=new H;this.getIsSupported=function(){return g.capabilities.standardDerivatives};
this.setTextureResolution=function(a){E=a};this.getTextureResolution=function(){return E};this.setMaxNumCascades=function(a){F=h.clamp(Math.floor(a),1,4)};this.getMaxNumCascades=function(){return F};this.setEnableState=function(a){a?this.enable():this.disable()};this.getEnableState=function(){return void 0!==B};this.getDepthTexture=function(){return B};this.enable=function(){this.getEnableState()||(this.getIsSupported()?(B=new f(g,{target:z.TEXTURE_2D,pixelFormat:z.RGBA,dataType:z.UNSIGNED_BYTE,wrapMode:z.CLAMP_TO_EDGE,
samplingMode:z.NEAREST,flipped:!0,width:E,height:E}),C=k.createWithAttachments(g,B,{colorTarget:0,depthStencilTarget:1,width:E,height:E})):c.warn("Shadow maps are not supported for this browser or hardware"))};this.disable=function(){this.getEnableState()&&C&&(C.dispose(),B=C=void 0)};var S=n.create(),Z=n.create(),R=v.create(),N=Array(8);for(L=0;8>L;++L)N[L]=v.create();var D=r.create(),P=r.create(),O=u.create(),Q=u.create(),T=u.create(),da=u.create(),U=u.create(),aa=n.create(),X=r.create();this.prepare=
function(a,c,b,d){h.assert(this.getEnableState());n.multiply(a.projectionMatrix,a.viewMatrix,S);var e=d[0],f=d[1];2>e&&(e=2);2>f&&(f=2);e>=f&&(e=2,f=4);J=Math.min(1+Math.floor(h.logWithBase(f/e,4)),F);b=Math.pow(f/e,1/J);for(d=0;d<J+1;++d)I[d]=e*Math.pow(b,d);n.inverse(S,Z);n.lookAt([0,0,0],[-c[0],-c[1],-c[2]],[0,1,0],aa);b=a.viewMatrix;a=a.projectionMatrix;for(d=0;d<J;++d){var k=K[d],e=-I[d],f=-I[d+1],e=(a[10]*e+a[14])/Math.abs(a[11]*e+a[15]),f=(a[10]*f+a[14])/Math.abs(a[11]*f+a[15]);h.assert(e<
f);for(M=0;8>M;++M)for(v.set4(0===M%4||3==M%4?-1:1,0===M%4||1==M%4?-1:1,4>M?e:f,1,R),n.multiplyVec4(Z,R,N[M]),V=0;3>V;++V)N[M][V]/=N[M][3];r.negate(N[0],X);n.translate(aa,X,k.camera.viewMatrix);for(M=0;8>M;++M)n.multiplyVec3(k.camera.viewMatrix,N[M]);r.set(N[0],D);r.set(N[0],P);for(M=1;8>M;++M)for(V=0;3>V;++V)D[V]=Math.min(D[V],N[M][V]),P[V]=Math.max(P[V],N[M][V]);D[2]-=200;P[2]+=200;k.camera.near=-P[2];k.camera.far=-D[2];e=1/N[0][3];f=1/N[4][3];h.assert(e<f);var l=e+Math.sqrt(e*f),m=Math.sin(Math.acos(b[2]*
c[0]+b[6]*c[1]+b[10]*c[2])),l=l/m,e=N,q=l,t=m,m=O,p=Q,w=T,y=da,l=U;u.set2(0,0,ga);for(var A=void 0,A=0;4>A;++A)u.add(ga,e[A],ga);u.scale(ga,.25);u.set2(0,0,ia);for(A=4;8>A;++A)u.add(ia,e[A],ia);u.scale(ia,.25);u.lerp(e[4],e[5],.5,ha[0]);u.lerp(e[5],e[6],.5,ha[1]);u.lerp(e[6],e[7],.5,ha[2]);u.lerp(e[7],e[4],.5,ha[3]);for(var B=0,G=u.dist2(ha[0],ga),A=1;4>A;++A){var H=u.dist2(ha[A],ga);H<G&&(G=H,B=A)}u.subtract(ha[B],e[B+4],ja);A=ja[0];ja[0]=-ja[1];ja[1]=A;u.subtract(ia,ga,qa);u.lerp(ja,qa,t);u.normalize(ja);
B=t=void 0;t=B=u.dot(u.subtract(e[0],ga,ma),ja);for(A=1;8>A;++A)G=u.dot(u.subtract(e[A],ga,ma),ja),G<t?t=G:G>B&&(B=G);u.set(ga,m);u.scale(ja,t-q,ma);u.add(m,ma,m);for(var H=-1,L=1,A=q=G=0;8>A;++A){u.subtract(e[A],m,ra);u.normalize(ra);var W=ja[0]*ra[1]-ja[1]*ra[0];0<W?W>H&&(H=W,G=A):W<L&&(L=W,q=A)}h.verify(0<H,"leftArea");h.verify(0>L,"rightArea");u.scale(ja,t,oa);u.add(oa,ga,oa);u.scale(ja,B,fa);u.add(fa,ga,fa);pa[0]=-ja[1];pa[1]=ja[0];p=h.rayRay2D(m,e[q],fa,u.add(fa,pa,ma),1,p);w=h.rayRay2D(m,e[G],
fa,ma,1,w);y=h.rayRay2D(m,e[G],oa,u.add(oa,pa,ma),1,y);e=h.rayRay2D(m,e[q],oa,ma,1,l);h.verify(p,"rayRay");h.verify(w,"rayRay");h.verify(y,"rayRay");h.verify(e,"rayRay");w=O;e=Q;m=da;y=U;l=k.camera.projectionMatrix;u.scale(u.subtract(m,y,la),.5);Y[0]=la[0];Y[1]=la[1];Y[2]=0;Y[3]=la[1];Y[4]=-la[0];Y[5]=0;Y[6]=la[0]*la[0]+la[1]*la[1];Y[7]=la[0]*la[1]-la[1]*la[0];Y[8]=1;Y[6]=-u.dot(x(Y,0),w);Y[7]=-u.dot(x(Y,1),w);w=u.dot(x(Y,0),m)+Y[6];p=u.dot(x(Y,1),m)+Y[7];A=u.dot(x(Y,0),y)+Y[6];y=u.dot(x(Y,1),y)+
Y[7];w=-(w+A)/(p+y);Y[0]+=Y[1]*w;Y[3]+=Y[4]*w;Y[6]+=Y[7]*w;w=1/(u.dot(x(Y,0),m)+Y[6]);p=1/(u.dot(x(Y,1),m)+Y[7]);Y[0]*=w;Y[3]*=w;Y[6]*=w;Y[1]*=p;Y[4]*=p;Y[7]*=p;Y[2]=Y[1];Y[5]=Y[4];Y[8]=Y[7];Y[7]+=1;w=u.dot(x(Y,1),e)+Y[7];p=u.dot(x(Y,2),e)+Y[8];A=u.dot(x(Y,1),m)+Y[7];y=u.dot(x(Y,2),m)+Y[8];w=-.5*(w/p+A/y);Y[1]+=Y[2]*w;Y[4]+=Y[5]*w;Y[7]+=Y[8]*w;w=u.dot(x(Y,1),e)+Y[7];p=u.dot(x(Y,2),e)+Y[8];A=-p/w;Y[1]*=A;Y[4]*=A;Y[7]*=A;l[0]=Y[0];l[1]=Y[1];l[2]=0;l[3]=Y[2];l[4]=Y[3];l[5]=Y[4];l[6]=0;l[7]=Y[5];l[8]=
0;l[9]=0;l[10]=1;l[11]=0;l[12]=Y[6];l[13]=Y[7];l[14]=0;l[15]=Y[8];k.camera.projectionMatrix[10]=2/(D[2]-P[2]);k.camera.projectionMatrix[14]=-(D[2]+P[2])/(D[2]-P[2]);n.multiply(k.camera.projectionMatrix,k.camera.viewMatrix,k.lightMat);e=E/2;k.camera.viewport[0]=0===d%2?0:e;k.camera.viewport[1]=0===Math.floor(d/2)?0:e;k.camera.viewport[2]=e;k.camera.viewport[3]=e}ca=void 0;I[J]=100*f;g.bindFramebuffer(C);g.bindTexture(null,7);g.setClearColor(1,1,1,1);g.clear(z.COLOR_BUFFER_BIT|z.DEPTH_BUFFER_BIT);g.setBlendingEnabled(!1)};
var ba=[];this.getCascades=function(){for(var a=0;a<J;++a)ba[a]=K[a];ba.length=J;return ba};this.finish=function(a){h.assert(this.getEnableState());g.bindFramebuffer(a)};this.bind=function(a){var c=this.getEnableState();g.bindTexture(c?B:G,7);g.bindProgram(a);a.setUniform1i("depthTex",7);a.setUniform1f("depthHalfPixelSz",c?.5/E:-1);a.setUniform1i("shadowMapNum",J);a.setUniform4f("shadowMapDistance",I[0],I[1],I[2],I[3])};this.bindAll=function(a){a=a.getProgramsUsingUniform("shadowMapDistance");for(var c=
0;c<a.length;c++)this.bind(a[c])};var ea=w.create(),W=new Float32Array(64),ca;this.bindView=function(a,c){if(this.getEnableState()){if(!ca||ca[0]!==c[0]||ca[1]!==c[1]||ca[2]!==c[2]){var b;ca=ca||r.create();r.set(c,ca);for(M=0;M<J;++M)for(w.translate(K[M].lightMat,c,ea),b=0;16>b;++b)W[16*M+b]=ea[b]}a.setUniformMatrix4fv("shadowMapMatrix",W)}};H=new Float32Array(16);H[0]=0;H[1]=0;H[2]=0;H[3]=0;H[4]=256;H[5]=0;H[6]=1;H[7]=0;H[8]=0;H[9]=256;H[10]=0;H[11]=1;H[12]=256;H[13]=256;H[14]=1;H[15]=1;var ka=new m(g,
b.Default3D,{geometry:l.Pos2Tex},{geometry:e.createVertex(g,z.STATIC_DRAW,H)});this.drawDebugQuad=function(a){h.assert(this.getEnableState());var c=d.get("showDepth");g.setDepthTestEnabled(!1);g.bindProgram(c);c.setUniformMatrix4fv("proj",a);c.setUniform1i("depthTex",0);g.bindTexture(B,0);g.bindVAO(ka);t.assertCompatibleVertexAttributeLocations(ka,c);g.drawArrays(z.TRIANGLE_STRIP,0,t.vertexCount(ka,"geometry"));g.setDepthTestEnabled(!0)};var ga=u.create(),ia=u.create(),ha=[u.create(),u.create(),u.create(),
u.create()],ja=u.create(),qa=u.create(),ma=u.create(),ra=u.create(),oa=u.create(),fa=u.create(),pa=u.create(),va=r.create(),la=u.create(),Y=q.create()}})},"esri/views/support/screenshotUtils":function(){define(["require","exports","dojo/_base/lang"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});h.adjustScreenshotSettings=function(a,g){a=d.mixin({format:"png",quality:100},a||{});var f,k;a.includePadding?(f=g.width,k=g.height):(f=g.width-g.padding.left-g.padding.right,k=g.height-
g.padding.top-g.padding.bottom);var h=f/k;void 0!==a.width&&void 0===a.height?a.height=a.width/h:void 0!==a.height&&void 0===a.width&&(a.width=h*a.height);void 0!==a.height&&(a.height=Math.floor(a.height));void 0!==a.width&&(a.width=Math.floor(a.width));a.area||a.includePadding||(a.area={x:g.padding.left,y:g.padding.top,width:f,height:k});return a};h.resampleHermite=function(a,d,f,k,h,e,b){void 0===b&&(b=!0);var g=d/h;f/=e;for(var m=Math.ceil(g/2),u=Math.ceil(f/2),r=0;r<e;r++)for(var v=0;v<h;v++){for(var q=
4*(v+(b?e-r-1:r)*h),n=0,p=0,c=0,x=0,z=0,A=0,y=0,B=(r+.5)*f,E=Math.floor(r*f);E<(r+1)*f;E++)for(var C=Math.abs(B-(E+.5))/u,G=(v+.5)*g,C=C*C,J=Math.floor(v*g);J<(v+1)*g;J++){var F=Math.abs(G-(J+.5))/m,n=Math.sqrt(C+F*F);-1<=n&&1>=n&&(n=2*n*n*n-3*n*n+1,0<n&&(F=4*(J+E*d),y+=n*a[F+3],c+=n,255>a[F+3]&&(n=n*a[F+3]/250),x+=n*a[F],z+=n*a[F+1],A+=n*a[F+2],p+=n))}k[q]=x/p;k[q+1]=z/p;k[q+2]=A/p;k[q+3]=y/c}}})},"esri/views/webgl/RenderingContext":function(){define(["require","exports","./enums","./capabilities/isWebGL2Context",
"./capabilities/load"],function(p,h,d,a,g){return function(){function f(d,f){this.gl=null;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=
513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._lineWidth=1;this._clearColor={r:0,g:0,b:0,a:0};this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=
null;this._activeTextureUnit=0;this._textureUnitMap={};this.contextVersion=a.default(d)?"webgl2":"webgl";this.gl=d;d instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=g.loadCapabilities(d,f);d=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:d[0],y:d[1],width:d[2],height:d[3]};d=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),
maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:d?this.gl.getParameter(d.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)};this.enforceState()}Object.defineProperty(f.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0});
f.prototype.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap={};this.gl=null};f.prototype.setBlendingEnabled=function(a){this._blendEnabled!==a&&(!0===a?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=a)};f.prototype.setBlendColor=function(a,d,e,b){if(a!==this._blendColorState.r||d!==this._blendColorState.g||e!==this._blendColorState.b||b!==this._blendColorState.a)this.gl.blendColor(a,d,e,b),this._blendColorState.r=
a,this._blendColorState.g=d,this._blendColorState.b=e,this._blendColorState.a=b};f.prototype.setBlendFunction=function(a,d){if(a!==this._blendFunctionState.srcRGB||d!==this._blendFunctionState.dstRGB)this.gl.blendFunc(a,d),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=a,this._blendFunctionState.dstRGB=d,this._blendFunctionState.dstAlpha=d};f.prototype.setBlendFunctionSeparate=function(a,d,e,b){if(this._blendFunctionState.srcRGB!==a||this._blendFunctionState.srcAlpha!==e||this._blendFunctionState.dstRGB!==
d||this._blendFunctionState.dstAlpha!==b)this.gl.blendFuncSeparate(a,d,e,b),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=e,this._blendFunctionState.dstRGB=d,this._blendFunctionState.dstAlpha=b};f.prototype.setBlendEquation=function(a){this._blendEquationState.mode!==a&&(this.gl.blendEquation(a),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=a)};f.prototype.setBlendEquationSeparate=function(a,d){if(this._blendEquationState.mode!==a||this._blendEquationState.modeAlpha!==
d)this.gl.blendEquationSeparate(a,d),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=d};f.prototype.setColorMask=function(a,d,e,b){if(this._colorMaskState.r!==a||this._colorMaskState.g!==d||this._colorMaskState.b!==e||this._colorMaskState.a!==b)this.gl.colorMask(a,d,e,b),this._colorMaskState.r=a,this._colorMaskState.g=d,this._colorMaskState.b=e,this._colorMaskState.a=b};f.prototype.setClearColor=function(a,d,e,b){if(this._clearColor.r!==a||this._clearColor.g!==d||this._clearColor.b!==
e||this._clearColor.a!==b)this.gl.clearColor(a,d,e,b),this._clearColor.r=a,this._clearColor.g=d,this._clearColor.b=e,this._clearColor.a=b};f.prototype.setFaceCullingEnabled=function(a){this._polygonCullingEnabled!==a&&(!0===a?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=a)};f.prototype.setPolygonOffsetFillEnabled=function(a){this._polygonOffsetFillEnabled!==a&&(!0===a?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),
this._polygonOffsetFillEnabled=a)};f.prototype.setPolygonOffset=function(a,d){if(this._polygonOffset[0]!==a||this._polygonOffset[1]!==d)this._polygonOffset[0]=a,this._polygonOffset[1]=d,this.gl.polygonOffset(a,d)};f.prototype.setCullFace=function(a){this._cullFace!==a&&(this.gl.cullFace(a),this._cullFace=a)};f.prototype.setFrontFace=function(a){this._frontFace!==a&&(this.gl.frontFace(a),this._frontFace=a)};f.prototype.setScissorTestEnabled=function(a){this._scissorTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.SCISSOR_TEST):
this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=a)};f.prototype.setScissorRect=function(a,d,e,b){if(this._scissorRect.x!==a||this._scissorRect.y!==d||this._scissorRect.width!==e||this._scissorRect.height!==b)this.gl.scissor(a,d,e,b),this._scissorRect.x=a,this._scissorRect.y=d,this._scissorRect.width=e,this._scissorRect.height=b};f.prototype.setDepthTestEnabled=function(a){this._depthTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=
a)};f.prototype.setClearDepth=function(a){this._clearDepth!==a&&(this.gl.clearDepth(a),this._clearDepth=a)};f.prototype.setDepthFunction=function(a){this._depthFunction!==a&&(this.gl.depthFunc(a),this._depthFunction=a)};f.prototype.setDepthWriteEnabled=function(a){this._depthWriteEnabled!==a&&(this.gl.depthMask(a),this._depthWriteEnabled=a)};f.prototype.setDepthRange=function(a,d){if(this._depthRange.zNear!==a||this._depthRange.zFar!==d)this.gl.depthRange(a,d),this._depthRange.zNear=a,this._depthRange.zFar=
d};f.prototype.setStencilTestEnabled=function(a){this._stencilTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=a)};f.prototype.setClearStencil=function(a){a!==this._clearStencil&&(this.gl.clearStencil(a),this._clearStencil=a)};f.prototype.setStencilFunction=function(a,d,e){if(this._stencilFunction.func!==a||this._stencilFunction.ref!==d||this._stencilFunction.mask!==e)this.gl.stencilFunc(a,d,e),this._stencilFunction.face=
1032,this._stencilFunction.func=a,this._stencilFunction.ref=d,this._stencilFunction.mask=e};f.prototype.setStencilFunctionSeparate=function(a,d,e,b){if(this._stencilFunction.face!==a||this._stencilFunction.func!==d||this._stencilFunction.ref!==e||this._stencilFunction.mask!==b)this.gl.stencilFuncSeparate(a,d,e,b),this._stencilFunction.face=a,this._stencilFunction.func=d,this._stencilFunction.ref=e,this._stencilFunction.mask=b};f.prototype.setStencilWriteMask=function(a){this._stencilWriteMask!==a&&
(this.gl.stencilMask(a),this._stencilWriteMask=a)};f.prototype.setStencilOp=function(a,d,e){if(this._stencilOperation.fail!==a||this._stencilOperation.zFail!==d||this._stencilOperation.zPass!==e)this.gl.stencilOp(a,d,e),this._stencilOperation.face=1032,this._stencilOperation.fail=a,this._stencilOperation.zFail=d,this._stencilOperation.zPass=e};f.prototype.setStencilOpSeparate=function(a,d,e,b){if(this._stencilOperation.face!==a||this._stencilOperation.fail!==d||this._stencilOperation.zFail!==e||this._stencilOperation.zPass!==
b)this.gl.stencilOpSeparate(a,d,e,b),this._stencilOperation.face=a,this._stencilOperation.face=a,this._stencilOperation.fail=d,this._stencilOperation.zFail=e,this._stencilOperation.zPass=b};f.prototype.setLineWidth=function(a){var d=this._lineWidth;this._lineWidth!==a&&(this.gl.lineWidth(a),this._lineWidth=a);return d};f.prototype.setActiveTexture=function(a){var f=this._activeTextureUnit;0<=a&&a!==this._activeTextureUnit&&(this.gl.activeTexture(d.BASE_TEXTURE_UNIT+a),this._activeTextureUnit=a);return f};
f.prototype.clear=function(a){a&&this.gl.clear(a)};f.prototype.drawArrays=function(a,d,e){this.gl.drawArrays(a,d,e)};f.prototype.drawElements=function(a,d,e,b){5123===e?this.gl.drawElements(a,d,e,b):5125===e&&this.gl.drawElements(a,d,e,b)};Object.defineProperty(f.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0});f.prototype.setViewport=function(a,d,e,b){var f=this._viewport;if(f.x!==a||f.y!==d||f.width!==e||f.height!==b)f.x=a,f.y=d,f.width=e,f.height=
b,this.gl.viewport(a,d,e,b)};f.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};f.prototype.bindProgram=function(a){a?this._activeShaderProgram!==a&&(a.initialize(),this.gl.useProgram(a.glName),this._activeShaderProgram=a):(this.gl.useProgram(null),this._activeShaderProgram=null)};f.prototype.bindTexture=function(a,d){void 0===d&&(d=0);-1===f._MAX_TEXTURE_IMAGE_UNITS&&(f._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));
(d>=f._MAX_TEXTURE_IMAGE_UNITS||0>d)&&console.error("Input texture unit is out of range of available units!");var e=this._textureUnitMap[d];this.setActiveTexture(d);null==a||null==a.glName?(null!=e&&(this.gl.bindTexture(e.descriptor.target,null),e.setBoundToUnit(d,!1)),this._textureUnitMap[d]=null):e&&e.id===a.id?a.applyChanges():(this.gl.bindTexture(a.descriptor.target,a.glName),a.setBoundToUnit(d,!0),a.applyChanges(),this._textureUnitMap[d]=a)};f.prototype.bindFramebuffer=function(a){a?this._activeFramebuffer!==
a&&(a.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.glName),this._activeFramebuffer=a):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null)};f.prototype.bindBuffer=function(a){a&&(34962===a.bufferType?this._activeVertexBuffer=f._bindBuffer(this.gl,a,a.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=f._bindBuffer(this.gl,a,a.bufferType,this._activeIndexBuffer))};f.prototype.unbindBuffer=function(a){34962===a?this._activeVertexBuffer=f._bindBuffer(this.gl,
null,a,this._activeVertexBuffer):this._activeIndexBuffer=f._bindBuffer(this.gl,null,a,this._activeIndexBuffer)};f.prototype.bindVAO=function(a){a?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===a.id||(a.bind(),this._activeVertexArrayObject=a):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};f.prototype.getBoundTexture=function(a){return this._textureUnitMap[a]};f.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer};
f.prototype.getBoundVAO=function(){return this._activeVertexArrayObject};f.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);for(var a=0;a<this.parameters.maxTextureImageUnits;a++)this.bindTexture(null,a);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);
this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,
this.gl.canvas.height)};f.prototype.enforceState=function(){var a=this.gl,f=this._capabilities.vao;f&&f.bindVertexArray(null);for(var e=0;e<this.parameters.maxVertexAttributes;e++)a.disableVertexAttribArray(e);this._activeVertexBuffer?a.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):a.bindBuffer(34962,null);this._activeIndexBuffer?a.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):a.bindBuffer(34963,null);if(f&&this._activeVertexArrayObject){if(f=
this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(f)}a.bindFramebuffer(a.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null);a.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);a.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);!0===this._blendEnabled?a.enable(this.gl.BLEND):a.disable(this.gl.BLEND);a.blendEquationSeparate(this._blendEquationState.mode,
this._blendEquationState.modeAlpha);a.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);a.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);a.clearDepth(this._clearDepth);a.clearStencil(this._clearStencil);a.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);a.cullFace(this._cullFace);a.depthFunc(this._depthFunction);
a.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST);a.depthMask(this._depthWriteEnabled);a.frontFace(this._frontFace);a.lineWidth(this._lineWidth);!0===this._polygonCullingEnabled?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE);a.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?a.enable(a.POLYGON_OFFSET_FILL):a.disable(a.POLYGON_OFFSET_FILL);a.scissor(this._scissorRect.x,
this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?a.enable(a.SCISSOR_TEST):a.disable(a.SCISSOR_TEST);a.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);a.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);!0===this._stencilTestEnabled?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST);a.stencilMask(this._stencilWriteMask);for(f=
0;f<this.parameters.maxTextureImageUnits;f++)a.activeTexture(d.BASE_TEXTURE_UNIT+f),a.bindTexture(3553,null),(e=this._textureUnitMap[f])&&a.bindTexture(e.descriptor.target,e.glName);a.activeTexture(d.BASE_TEXTURE_UNIT+this._activeTextureUnit);a.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)};f._bindBuffer=function(a,d,e,b){if(!d)return a.bindBuffer(e,null),null;if(b===d)return b;a.bindBuffer(e,d.glName);return d};f._MAX_TEXTURE_IMAGE_UNITS=-1;return f}()})},
"esri/views/webgl/enums":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});h.BASE_TEXTURE_UNIT=33984})},"esri/views/webgl/capabilities/load":function(){define("require exports ./DisjointTimerQuery ./Instancing ./isWebGL2Context ./VertexArrayObjects".split(" "),function(p,h,d,a,g,f){function k(a,d,b,f,h){if(f&&g.default(a))return!0;if(d[b])return!1;for(d=0;d<h.length;d++)if(a.getExtension(h[d]))return!0;return!1}Object.defineProperty(h,"__esModule",
{value:!0});h.loadCapabilities=function(h,e){e=e&&e.disabledExtensions||{};var b=a.load(h,e),l=f.load(h,e),m;m=e.compressedTextureS3TC?null:(m=h.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:m.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:m.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:m.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:m.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null;var u;u=e.textureFilterAnisotropic?null:(u=h.getExtension("EXT_texture_filter_anisotropic")||
h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:u.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:u.TEXTURE_MAX_ANISOTROPY_EXT}:null;var r=d.load(h,e),v;if(g.default(h))v=e.colorBufferFloat||!h.getExtension("EXT_color_buffer_float")?null:{R16F:h.R16F,RG16F:h.RG16F,RGBA16F:h.RGBA16F,R32F:h.R32F,RG32F:h.RG32F,RGBA32F:h.RGBA32F,R11F_G11F_B10F:h.R11F_G11F_B10F};else if(h instanceof WebGLRenderingContext){v=
!e.colorBufferFloat&&h.getExtension("EXT_color_buffer_half_float");var q=!e.colorBufferFloat&&h.getExtension("WEBGL_color_buffer_float");v=v||q?{RGBA16F:v?v.RGBA16F_EXT:void 0,RGBA32F:q?q.RGBA32F_EXT:void 0}:null}else v=void 0;q=g.default(h)?{MIN:h.MIN,MAX:h.MAX}:e.blendMinMax?null:(q=h.getExtension("EXT_blend_minmax"))?{MIN:q.MIN_EXT,MAX:q.MAX_EXT}:null;return{instancing:b,vao:l,compressedTextureS3TC:m,textureFilterAnisotropic:u,disjointTimerQuery:r,colorBufferFloat:v,blendMinMax:q,depthTexture:k(h,
e,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),standardDerivatives:k(h,e,"standardDerivatives",!0,["OES_standard_derivatives"]),shaderTextureLOD:k(h,e,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]),textureFloatLinear:k(h,e,"textureFloatLinear",!1,["OES_texture_float_linear"]),fragDepth:k(h,e,"fragDepth",!0,["EXT_frag_depth"])}}})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["require","exports","./isWebGL2Context"],function(p,
h,d){Object.defineProperty(h,"__esModule",{value:!0});h.load=function(a,g){if(g.disjointTimerQuery)return null;var f=a.getExtension("EXT_disjoint_timer_query")||a.getExtension("EXT_disjoint_timer_query_webgl2");return f?d.default(a)?{createQuery:function(){return a.createQuery()},resultAvailable:function(d){return a.getQueryParameter(d,a.QUERY_RESULT_AVAILABLE)},getResult:function(d){return a.getQueryParameter(d,a.QUERY_RESULT)},disjoint:function(){return a.getParameter(f.GPU_DISJOINT_EXT)},beginTimeElapsed:function(d){return a.beginQuery(f.TIME_ELAPSED_EXT,
d)},endTimeElapsed:function(){return a.endQuery(f.TIME_ELAPSED_EXT)},createTimestamp:function(a){return f.queryCounterEXT(a,f.TIMESTAMP_EXT)},timestampBits:function(){return a.getQuery(f.TIMESTAMP_EXT,f.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return f.createQueryEXT()},resultAvailable:function(a){return f.getQueryObjectEXT(a,f.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(a){return f.getQueryObjectEXT(a,f.QUERY_RESULT_EXT)},disjoint:function(){return a.getParameter(f.GPU_DISJOINT_EXT)},
beginTimeElapsed:function(a){return f.beginQueryEXT(f.TIME_ELAPSED_EXT,a)},endTimeElapsed:function(){return f.endQueryEXT(f.TIME_ELAPSED_EXT)},createTimestamp:function(a){return f.queryCounterEXT(a,f.TIMESTAMP_EXT)},timestampBits:function(){return f.getQueryEXT(f.TIMESTAMP_EXT,f.QUERY_COUNTER_BITS_EXT)}}:null}})},"esri/views/webgl/capabilities/Instancing":function(){define(["require","exports","./isWebGL2Context"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});h.load=function(a,
g){return d.default(a)?{drawArraysInstanced:a.drawArraysInstanced.bind(a),drawElementsInstanced:a.drawElementsInstanced.bind(a),vertexAttribDivisor:a.vertexAttribDivisor.bind(a)}:g.angleInstancedArrays?null:(a=a.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:a.drawArraysInstancedANGLE.bind(a),drawElementsInstanced:a.drawElementsInstancedANGLE.bind(a),vertexAttribDivisor:a.vertexAttribDivisorANGLE.bind(a)}:null}})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["require",
"exports","./isWebGL2Context"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});h.load=function(a,g){return d.default(a)?{createVertexArray:a.createVertexArray.bind(a),deleteVertexArray:a.deleteVertexArray.bind(a),bindVertexArray:a.bindVertexArray.bind(a)}:g.vao?null:(a=a.getExtension("OES_vertex_array_object")||a.getExtension("MOZ_OES_vertex_array_object")||a.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:a.createVertexArrayOES.bind(a),deleteVertexArray:a.deleteVertexArrayOES.bind(a),
bindVertexArray:a.bindVertexArrayOES.bind(a)}:null}})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/Logger ../../../../core/scheduling ./constants ./ElevationContext ./featureExpressionInfoUtils ./Graphics3DSymbolCommonCode ./graphicUtils ../../support/PromiseLightweight".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,t){function u(a,c){a=null!=a?c.attributes[a]:0;null!=a&&isFinite(a)||
(a=0);return a}var r=new m,v=g.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer"),q={mode:"on-the-ground",offset:0,unit:"meters"},n={mode:"absolute-height",offset:0,unit:"meters"};return function(g){function c(a,c,b,d){var e=g.call(this)||this;e._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};e.symbolContainer=a;e.symbol=c;e._context=b;e._symbolLayerOrder=b.layerOrder;e._symbolLayerOrderDelta=b.layerOrderDelta;e._elevationContext=new m;e._material=null;e._geometryCreationWarningHandle=
null;e._updateDrivenProperties(d);e._updateElevationContext();e._prepareResources();return e}d(c,g);c.prototype._logWarning=function(a){v.warn(a)};c.prototype._logGeometryCreationWarnings=function(a,c,b,d){var e=this;if(null==this._geometryCreationWarningHandle){var g=a.geometryData&&a.geometryData.polygons;d+=" geometry failed to be created";var h=null;a.projectionSuccess?!c.length||1===c.length&&!c[0].length?h=d+" (no "+b+" were defined)":Array.isArray(c)&&Array.isArray(c[0])?c.some(function(a){return 1===
a.length})?h=d+" ("+b+" should contain at least 2 vertices)":g&&0===g.length&&"rings"===b&&(h=d+" (filled "+b+" should use clockwise winding - try reversing the order of vertices)"):h=d+" ("+b+" should be defined as a 2D array)":h=d+" (failed to project geometry to view spatial reference)";h&&(this._geometryCreationWarningHandle=f.schedule(function(){return e._onNextTick()}),this._logWarning(h))}};c.prototype._onNextTick=function(){this._geometryCreationWarningHandle=null};c.prototype._getGeometryCentroid=
function(a){a=this._validateGeometry(a.geometry);switch(a.type){case "extent":return a.center;case "polyline":return b.placePointOnPolyline(a);case "polygon":return b.placePointOnPolygon(a);case "point":return a;case "mesh":return a.extent.center;default:return this._logWarning("unsupported geometry type: "+a.type),null}};c.prototype._validateGeometry=function(a){switch(a.type){case "point":if(null==a.x||null==a.y){this._logWarning("point coordinate is null - setting to default value");var c=a.clone();
c.x=a.x||0;c.y=a.y||0;return c}}return a};c.prototype._prepareResources=function(a){throw Error("This is an abstract base class");};c.prototype._defaultElevationInfoNoZ=function(){return q};c.prototype._defaultElevationInfoZ=function(){return n};c.prototype._updateElevationContext=function(){this._elevationContext.setDefaults();var a=this._context.layer.elevationInfo;a&&this._elevationContext.mixinApi(a);(a=this.symbol&&this.symbol.elevationInfo)&&this._elevationContext.mixinApi(a);this._elevationContext.featureExpressionInfoContext=
this._context.featureExpressionInfoContext};c.prototype.getGraphicElevationContext=function(a){var c=a.geometry.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ();r.setUnit(null!=this._elevationContext.unit?this._elevationContext.unit:c.unit);r.mode=this._elevationContext.mode||c.mode;r.setOffsetMeters(null!=this._elevationContext.meterUnitOffset?this._elevationContext.meterUnitOffset:c.offset);r.featureExpressionInfoContext=this._elevationContext.featureExpressionInfoContext;r.hasOffsetAdjustment=
!1;this._elevationOptions.supportsOnTheGround||"on-the-ground"!==r.mode||(r.mode="relative-to-ground",r.setOffsetMeters(0),r.featureExpressionInfoContext=e.zeroContext);c=e.createFeature(a);e.setContextFeature(r.featureExpressionInfoContext,c);b.needsOffsetAdjustment(r,this._elevationOptions,a.geometry,this.symbolContainer)&&(r.setOffsetRenderUnits(k.defaultIconElevationOffset),r.hasOffsetAdjustment=!0);return r};c.prototype._getDrapedZ=function(){return-2};c.prototype._updateDrivenProperties=function(a){var c=
{color:!1,opacity:!1,size:!1};!a&&(a=this._context.renderer)&&(c.color=!!a.colorInfo,c.size=!!a.sizeInfo,a.visualVariables&&a.visualVariables.forEach(function(a){switch(a.type){case "color":c.color=!0;if(a.colors)for(var b=0;b<a.colors.length;b++){var d=a.colors[b];d&&(Array.isArray(d)&&3<d.length&&255!==d[3]||void 0!==d.a&&255!==d.a)&&(c.opacity=!0)}if(a.stops)for(b=0;b<a.stops.length;b++)(d=a.stops[b].color)&&(Array.isArray(d)&&3<d.length&&255!==d[3]||void 0!==d.a&&255!==d.a)&&(c.opacity=!0);break;
case "opacity":c.opacity=!0;break;case "size":c.size=!0}}));this._drivenProperties=c};c.prototype._isPropertyDriven=function(a){return this._drivenProperties[a]};c.prototype._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var a=this._context.layer.opacity;return null==a?1:a};c.prototype._getMaterialOpacity=function(){var a;a=1*this._getLayerOpacity();var c=this.symbol&&this.symbol.material;c&&!this._isPropertyDriven("opacity")&&
c.color&&(a*=c.color.a);return a};c.prototype._getMaterialOpacityAndColor=function(){var c=this.symbol&&this.symbol.material,b=this._getMaterialOpacity(),c=!this._isPropertyDriven("color")&&c&&c.color?a.toUnitRGB(c.color):null;return l.mixinColorAndOpacity(c,b)};c.prototype._getVertexOpacityAndColor=function(a,c,b){var d=this._isPropertyDriven("color")?a.color:null;a=this._isPropertyDriven("opacity")?a.opacity:null;d=l.mixinColorAndOpacity(d,a);b&&(d[0]*=b,d[1]*=b,d[2]*=b,d[3]*=b);return c?new c(d):
d};c.prototype._getStageIdHint=function(){return this._context.layer.id+"_symbol"};c.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};c.prototype.setDrawOrder=function(a,c,b){this._material&&(this._material.renderPriority=a,b[this._material.id]=!0)};c.prototype.createGraphics3DGraphic=function(a,c){for(var b=2;b<arguments.length;b++);throw Error("This is an abstract base class");};c.prototype.destroy=function(){this._geometryCreationWarningHandle&&(this._geometryCreationWarningHandle.remove(),
this._geometryCreationWarningHandle=null)};c.prototype.layerPropertyChanged=function(a,c,b){return!1};c.prototype.applyRendererDiff=function(a,c,b,d){return!1};c.prototype._getFastUpdateAttrValues=function(a){if(!this._fastUpdates.enabled)return null;var c=this._fastUpdates.visualVariables,b=c.size?u(c.size.field,a):0;a=c.color?u(c.color.field,a):0;return[b,a,0,0]};return c}(t.Promise)})},"esri/views/3d/layers/graphics/constants":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,
"__esModule",{value:!0});h.defaultIconElevationOffset=1})},"esri/views/3d/support/PromiseLightweight":function(){(function(p){function h(a){this._callbacks=[];this._errbacks=[];this._cancelCallback=a;this._iserr=this._isdone=this._iscancelled=!1}function d(a,f){var g=new h;0===a.length?g.done.apply(g,f):a[0].apply(null,f).then(function(){a.splice(0,1);d(a,arguments).then(function(){g.done.apply(g,arguments)})});return g}h.prototype.cancel=function(a){this._callbacks=[];this._errbacks=[];this._iscancelled=
!0;this._cancelCallback&&this._cancelCallback(a)};h.prototype.then=function(a,d,h){var f;if(!this._iscancelled)return this._isdone?f=a.apply(h,this.result):this._iserr&&d?f=d.apply(h,this.result):(this._callbacks.push(function(){return a.apply(h,arguments)}),d&&this._errbacks.push(function(){return d.apply(h,arguments)})),f};h.prototype.done=function(){this.result=arguments;this._isdone=!0;for(var a=0;a<this._callbacks.length;a++)this._callbacks[a].apply(null,arguments);this._callbacks=[];this._errbacks=
[]};h.prototype.resolve=h.prototype.done;h.prototype.reject=function(){if(!this._iscancelled){this.result=arguments;this._iserr=!0;for(var a=0;a<this._errbacks.length;a++)this._errbacks[a].apply(null,arguments);this._callbacks=[];this._errbacks=[]}};h.prototype.isRejected=function(){return this._iserr};h.prototype.isFulfilled=function(){return this._isdone||this._iserr};h.prototype.isResolved=function(){return this._isdone};h.prototype.isCancelled=function(){return this._iscancelled};var a={Promise:h,
join:function(a){function d(a,d){return function(){d&&(l=!0);e+=1;b[a]=Array.prototype.slice.call(arguments);e===m&&(l?g.reject():g.done(b))}}for(var g=new h,m=a.length,e=0,b=[],l=!1,t=0;t<m;t++)a[t].then(d(t,!1),d(t,!0));0===a.length&&g.done();return g},chain:d};"function"===typeof define&&define.amd?define(function(){return a}):p.promise=a})(this)},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("require exports ./BoundingInfo ./ComponentUtils ./geometryDataUtils ./IdGen ./Util ./Util".split(" "),
function(p,h,d,a,g,f,k,m){return function(){function e(a,d,f){this.singleUse=!1;this.componentAABB=null;this.id=e.__idGen.gen(d);this.data=a;this.boundingInfo=f}e.prototype.getData=function(){return this.data};e.prototype.getComponentCount=function(){return a.componentCount(this.data.componentOffsets)};e.prototype.getComponentAABB=function(a,d){null==this.componentAABB&&(this.componentAABB=this._computeComponentAABB());for(var b=0;6>b;b++)d[b]=this.componentAABB[6*a+b];return d};e.prototype._computeComponentAABB=
function(){for(var a=this.getComponentCount(),d=new Float32Array(6*a),e=0;e<a;e++)this._calculateAABB(e,d,6*e);return d};e.prototype._calculateAABB=function(a,d,e){void 0===e&&(e=0);var b=this.data.getIndices(m.VertexAttrConstants.POSITION),f=this.data.getAttribute(m.VertexAttrConstants.POSITION),g=this.data.componentOffsets,h=g.length?g[a+1]:b.length,k=Infinity,l=Infinity,c=Infinity,t=-Infinity,p=-Infinity,A=-Infinity,y=f.offsetIdx,B=f.strideIdx;for(a=g.length?g[a]:0;a<h;a++)var E=y+B*b[a],g=f.data[E],
C=f.data[E+1],E=f.data[E+2],k=Math.min(k,g),l=Math.min(l,C),c=Math.min(c,E),t=Math.max(t,g),p=Math.max(p,C),A=Math.max(A,E);d?(d[e]=k,d[e+1]=l,d[e+2]=c,d[e+3]=t,d[e+4]=p,d[e+5]=A):d=[k,l,c,t,p,A];return d};e.prototype.calculateBoundingInfo=function(){var a=this.data.getIndices(m.VertexAttrConstants.POSITION),e=this.data.getAttribute(m.VertexAttrConstants.POSITION),f="triangle"===this.data.primitiveType?3:1;if(0===a.length)for(var a=new Uint32Array(f),h=0;h<f;++h)a[h]=h;h=a.length;k.assert(0===h%f);
h=g.generateDefaultIndexArray(h/f);return new d(h,f,a,e)};e.prototype.getBoundingInfo=function(){null==this.boundingInfo&&(this.boundingInfo=this.calculateBoundingInfo());return this.boundingInfo};e.prototype.invalidateBoundingInfo=function(){this.boundingInfo=null};e.__idGen=new f;return e}()})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["require","exports","./gl-matrix","./Util"],function(p,h,d,a){var g=d.vec3d;return function(){function d(d,f,e,b){a.assert(1<=d.length);a.assert(0===
e.length%f);a.assert(e.length>=d.length*f);a.assert(3===b.size||4===b.size);this.primitiveIndices=d;this.indices=e;this._position=b;this._numIndexPerPrimitive=f;var h=b.data,k=b.offsetIdx;b=b.strideIdx;var m=d.length,r=k+b*e[f*d[0]];this.bbMin=g.createFrom(h[r],h[r+1],h[r+2]);this.bbMax=g.create(this.bbMin);for(var v=0;v<m;++v)for(var q=f*d[v],n=0;n<f;++n)r=k+b*e[q+n],this.bbMin[0]=Math.min(h[r],this.bbMin[0]),this.bbMax[0]=Math.max(h[r],this.bbMax[0]),++r,this.bbMin[1]=Math.min(h[r],this.bbMin[1]),
this.bbMax[1]=Math.max(h[r],this.bbMax[1]),++r,this.bbMin[2]=Math.min(h[r],this.bbMin[2]),this.bbMax[2]=Math.max(h[r],this.bbMax[2]);this.center=g.create();this.bsRadius=0;g.lerp(this.bbMin,this.bbMax,.5,this.center);for(v=0;v<m;++v)for(q=f*d[v],n=0;n<f;++n){var r=k+b*e[q+n],p=h[r]-this.center[0],c=h[r+1]-this.center[1],r=h[r+2]-this.center[2];this.bsRadius=Math.max(p*p+c*c+r*r,this.bsRadius)}this.bsRadius=Math.sqrt(this.bsRadius)}d.prototype.getCenter=function(){return this.center};d.prototype.getBSRadius=
function(){return this.bsRadius};d.prototype.getBBMin=function(){return this.bbMin};d.prototype.getBBMax=function(){return this.bbMax};d.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};d.prototype.getIndices=function(){return this.indices};d.prototype.getPosition=function(){return this._position};d.prototype.getChildren=function(){if(this.children)return this.children;if(1<g.dist2(this.bbMin,this.bbMax)){for(var a=g.lerp(this.bbMin,this.bbMax,.5,g.create()),f=this.primitiveIndices.length,
e=new Uint8Array(f),b=Array(8),h=0;8>h;++h)b[h]=0;for(var h=this._position,t=h.data,u=h.offsetIdx,r=h.strideIdx,h=0;h<f;++h){for(var v=0,q=this._numIndexPerPrimitive*this.primitiveIndices[h],n=u+r*this.indices[q],p=t[n],c=t[n+1],x=t[n+2],z=1;z<this._numIndexPerPrimitive;++z){var n=u+r*this.indices[q+z],A=t[n],y=t[n+1],n=t[n+2];A<p&&(p=A);y<c&&(c=y);n<x&&(x=n)}p<a[0]&&(v|=1);c<a[1]&&(v|=2);x<a[2]&&(v|=4);e[h]=v;++b[v]}for(h=a=0;8>h;++h)0<b[h]&&++a;if(2>a)return;a=Array(8);for(h=0;8>h;++h)a[h]=0<b[h]?
new Uint32Array(b[h]):void 0;for(h=0;8>h;++h)b[h]=0;for(h=0;h<f;++h)v=e[h],a[v][b[v]++]=this.primitiveIndices[h];this.children=Array(8);for(h=0;8>h;++h)void 0!==a[h]&&(this.children[h]=new d(a[h],this._numIndexPerPrimitive,this.indices,this._position))}return this.children};return d}()})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DGraphic ./Graphics3DSymbolLayerFactory ../../support/PromiseLightweight".split(" "),
function(p,h,d,a,g,f){return function(f){function h(a,b,d){var e=f.call(this)||this;e.symbol=a;a=a.symbolLayers;d&&(a=d.concat(a));d=a.length;e.childGraphics3DSymbols=Array(a.length);e.childGraphics3DSymbolPromises=Array(a.length);for(var h=b.layerOrder,k=0,l=0,m=!1,n=function(a,c){c&&(this.childGraphics3DSymbols[a]=c,l++);k--;!this.isRejected()&&m&&1>k&&(0<l?this.resolve():this.reject())},p=0;p<d;p++){var c=a.getItemAt(p);!1!==c.enabled&&(b.layerOrder=h+(1-(1+p)/d),b.layerOrderDelta=1/d,c=g.make(e.symbol,
c,b,c._ignoreDrivers))&&(k++,e.childGraphics3DSymbolPromises[p]=c,c.then(n.bind(e,p,c),n.bind(e,p,null)))}b.layerOrder=h;m=!0;!e.isRejected()&&1>k&&e.resolve();return e}d(h,f);h.prototype.createGraphics3DGraphic=function(d,b,f){for(var e=Array(this.childGraphics3DSymbols.length),g=0;g<this.childGraphics3DSymbols.length;g++){var h=this.childGraphics3DSymbols[g];h&&(e[g]=h.createGraphics3DGraphic(d,b))}return new a(d,f||this,e)};h.prototype.layerPropertyChanged=function(a,b){for(var d=this.childGraphics3DSymbols.length,
e=function(d){var e=f.childGraphics3DSymbols[d],g=function(a){return a._graphics[d]};if(e&&!e.layerPropertyChanged(a,b,g))return{value:!1}},f=this,g=0;g<d;g++){var h=e(g);if("object"===typeof h)return h.value}return!0};h.prototype.applyRendererDiff=function(a,b,d){return this.isResolved()?this.childGraphics3DSymbols.reduce(function(e,f,g){return e&&(!f||f.applyRendererDiff(a,b,d,g))},!0):!1};h.prototype.getFastUpdateStatus=function(){var a=0,b=0,d=0;this.childGraphics3DSymbolPromises.forEach(function(e){e&&
!e.isFulfilled()?a++:e&&e.isFastUpdatesEnabled()?d++:e&&b++});return{loading:a,slow:b,fast:d}};h.prototype.setDrawOrder=function(a,b){for(var d=this.childGraphics3DSymbols.length,e=1/d,f=0;f<d;f++){var g=this.childGraphics3DSymbols[f];g&&g.setDrawOrder(a+(1-(1+f)/d),e,b)}};h.prototype.destroy=function(){this.isFulfilled()||this.reject();for(var a=0;a<this.childGraphics3DSymbolPromises.length;a++)this.childGraphics3DSymbolPromises[a]&&this.childGraphics3DSymbolPromises[a].destroy()};return h}(f.Promise)})},
"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("require exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer".split(" "),function(p,h,d,a,g,f,k,m,e,b,l){Object.defineProperty(h,"__esModule",{value:!0});var t=d.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");
h.make=function(a,b,d,e){var c=r[a.type]&&r[a.type][b.type]||u[b.type];return c?new c(a,b,d,e):(t.error("GraphicsLayerFactory#make","unknown symbol type "+b.type),null)};var u={icon:g,object:m,line:f,path:e,fill:b,extrude:a,text:l},r={"mesh-3d":{fill:k}}})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/earcut/earcut ../../../../geometry/Point ../../../../geometry/Polygon ./Graphics3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../support/edgeUtils ../../lib/glMatrix ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c){function x(a,c,b,d,e,f,g,h,k,l,n,m,r,q){var t=b.length/3,u=0;n+=2*d.count;var v=d.index,p=d.count,w=k,x=n;B.set(r,G);var z=0<m?1:-1,v=3*v,y=w;r=3*y;for(var E=w+p,w=3*E,C=0;C<p;++C)q&&(G[0]=a[v+0],G[1]=a[v+1],G[2]=a[v+2],B.normalize(G)),e[r+0]=a[v+0],e[r+1]=a[v+1],e[r+2]=a[v+2],f[r+0]=c[v+0],f[r+1]=c[v+1],f[r+2]=c[v+2],g[r+0]=-z*G[0],g[r+1]=-z*G[1],g[r+2]=-z*G[2],h[y]=0,e[w+0]=a[v+0]+m*G[0],e[w+1]=a[v+1]+m*G[1],e[w+2]=a[v+2]+m*G[2],f[w+0]=c[v+0],f[w+
1]=c[v+1],f[w+2]=c[v+2],g[w+0]=z*G[0],g[w+1]=z*G[1],g[w+2]=z*G[2],h[E]=m,r+=3,w+=3,v+=3,y+=1,E+=1;v=0;r=3*x;w=3*(x+t);r=3*(x+t);w=3*x;a=J;c=F;0>m&&(a=F,c=J);for(C=0;C<t;++C)l[r+0]=b[v+a[0]],l[r+1]=b[v+a[1]],l[r+2]=b[v+a[2]],l[w+0]=b[v+c[0]]+p,l[w+1]=b[v+c[1]]+p,l[w+2]=b[v+c[2]]+p,r+=3,w+=3,v+=3;k+=2*d.count;n=n+2*t-(2*d.count+2*t);A(e,f,h,g,u,d.pathLengths[0],d.count,k,l,n,m);k+=4*d.pathLengths[0];n+=2*d.pathLengths[0];u+=d.pathLengths[0];for(b=1;b<d.pathLengths.length;++b)A(e,f,h,g,u,d.pathLengths[b],
d.count,k,l,n,m),k+=4*d.pathLengths[b],n+=2*d.pathLengths[b],u+=d.pathLengths[b]}function z(a,c,b,d,e,f,g){d[f]=d[g];g*=3;f*=3;a[f+0]=a[g+0];a[f+1]=a[g+1];a[f+2]=a[g+2];c[f+0]=c[g+0];c[f+1]=c[g+1];c[f+2]=c[g+2];b[f+0]=e[0];b[f+1]=e[1];b[f+2]=e[2]}function A(a,c,b,d,e,f,g,h,k,l,n){var m=e,r=e+1,q=e+g,t=e+g+1,v=h,u=h+1,p=h+2*f;h=h+2*f+1;0>n&&(m=e+g+1,t=e);l*=3;for(var w=0;w<f;++w){w===f-1&&(0<n?(r=e,t=e+g):(r=e,m=e+g));var x=a,y=m,A=r,E=q,C=K,y=3*y,A=3*A,E=3*E;B.set3(x[y++],x[y++],x[y++],L);B.set3(x[A++],
x[A++],x[A++],M);B.set3(x[E++],x[E++],x[E++],V);B.subtract(M,L,S);B.subtract(V,L,Z);B.cross(Z,S,C);B.normalize(C,C);z(a,c,d,b,K,v,m);z(a,c,d,b,K,u,r);z(a,c,d,b,K,p,q);z(a,c,d,b,K,h,t);k[l++]=v;k[l++]=p;k[l++]=h;k[l++]=v;k[l++]=h;k[l++]=u;m++;r++;q++;t++;v+=2;u+=2;p+=2;h+=2}}var y=w.VertexAttrConstants,B=t.vec3d,E=t.mat4d,C=B.create(),G=B.create(),J=[0,2,1],F=[0,1,2],I=new g,H={verticalDistanceToGround:0,terrainElevation:0};p=function(e){function g(){var a=null!==e&&e.apply(this,arguments)||this;a._edgeStageObjects=
new Set;return a}d(g,e);g.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=b.validateSymbolLayerSize(this._getSymbolSize());if(a){this._logWarning(a);this.reject();return}}var a=this._getStageIdHint(),d=this._getMaterialOpacityAndColor(),e=B.create(d),d=d[3],e={diffuse:e,ambient:e,opacity:d,transparent:1>d||this._isPropertyDriven("opacity"),vertexColors:!0};this._material=new c(e,a+"_3dlinemat");this._context.stage.add(r.ModelContentType.MATERIAL,this._material);this.resolve()};
g.prototype.destroy=function(){e.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&this._context.stage.remove(r.ModelContentType.MATERIAL,this._material.id)};g.prototype.createGraphics3DGraphic=function(a,c){var b=this._validateGeometry(a.geometry);if("polygon"!==b.type&&"extent"!==b.type)return this._logWarning("unsupported geometry type for extrude symbol: "+b.type),null;var b="polygon"===b.type||"extent"===b.type?"rings":"paths",d="graphic"+a.uid,e=this._getVertexOpacityAndColor(c,
Float32Array,255),f=this.getGraphicElevationContext(a);return this._createAs3DShape(a,b,c,e,f,d,a.uid)};g.prototype.layerPropertyChanged=function(a,c,b){if("opacity"===a){c=this._getMaterialOpacity();b=1>c||this._isPropertyDriven("opacity");this._material.setParameterValues({opacity:c,transparent:b});if(0<this._edgeStageObjects.size){var d=this._context.stage.view.getEdgeView(),e=this._getLayerOpacity(),f=this.symbol.edges?this.symbol.edges.color.a:0;this._edgeStageObjects.forEach(function(a){d.updateComponentOpacity(a,
0,f*e)})}return!0}if("elevationInfo"===a){this._updateElevationContext();for(var g in c){var h=c[g];if(a=b(h))h=this.getGraphicElevationContext(h.graphic),a.needsElevationUpdates=m.needsElevationUpdates3D(h.mode),a.elevationContext.set(h)}return!0}return!1};g.prototype._getExtrusionSize=function(a){a=a.size&&this._isPropertyDriven("size")?m.getSingleSizeDriver(a.size,2):this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};g.prototype._getSymbolSize=function(){return this.symbol.size||
1};g.prototype._createAs3DShape=function(c,b,d,e,g,h,r){var q=this,t=c.geometry;"extent"===t.type&&(t=f.fromExtent(t));c=t[b];var p=t.hasZ,w=[],z=[],A=[],G=B.create(),O=Array(6),D=this._context.renderSpatialReference===u.SphericalECEFSpatialReference,F=this._getExtrusionSize(d),T=B.create();D||this._context.renderCoordsHelper.worldUpAtPosition(null,T);d=m.getGeometryVertexData3D(c,p,t.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,
g);this._logGeometryCreationWarnings(d,c,b,"ExtrudeSymbol3DLayer");if(0<c.length){var J=d.geometryData.polygons,P=d.eleVertexData,K=d.vertexData;b=K.length/3;var U=new Float64Array(18*b),L=new Float64Array(18*b),Q=new Float64Array(18*b),M=new Float64Array(6*b),da=0;b=function(c){var b=J[c],d=b.count,f=b.index;if(aa._context.clippingExtent&&(m.computeBoundingBox(P,f,d,O),m.boundingBoxClipped(O,aa._context.clippingExtent)))return"continue";var g=new Float64Array(P.buffer,3*f*U.BYTES_PER_ELEMENT,3*d),
k=b.holeIndices.map(function(a){return a-f}),g=a(g,k,3);if(0<g.length){m.chooseOrigin(K,f,d,G);var k=new Uint32Array(6*d+2*g.length),l=6*d,n=new Float64Array(U.buffer,3*da*U.BYTES_PER_ELEMENT,3*l),r=new Float64Array(L.buffer,3*da*L.BYTES_PER_ELEMENT,3*l),q=new Float64Array(Q.buffer,3*da*Q.BYTES_PER_ELEMENT,3*l),t=new Float64Array(M.buffer,1*da*M.BYTES_PER_ELEMENT,1*l);x(K,P,g,b,n,q,r,t,0,k,0,F,T,D);m.subtractCoordinates(n,0,l,G);da+=6*d;b=aa._createExtrudeGeometry(k,{positions:n,elevation:q,normals:r,
heights:t},e);c=new v(b,h+"path"+c);c.singleUse=!0;w.push(c);z.push([aa._material]);c=E.identity();E.translate(c,G,c);A.push(c)}};var aa=this;for(c=0;c<J.length;++c)b(c);if(0<w.length){r=new n({geometries:w,materials:z,transformations:A,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicId:r},idHint:h});var V=function(a){var c=q._context.stage.view.getEdgeView();if(c){c.removeObject(a);q._edgeStageObjects.delete(a);var b=l.createMaterial(c,q.symbol,q._getLayerOpacity());b&&(q._edgeStageObjects.add(a),
c.addObject(a,[b]))}};V(r);r=new k(this,r,w,null,null,function(a,c,b,d){var e=d.setAltitude;I.spatialReference=b.spatialReference;for(var f=a.getGeometryRecords(),g=f.length,h="absolute-height"!==c.mode,k=0,l=0;l<g;l++){var n=f[l].geometry,r=f[l].transformation,q=n.getData();N[0]=r[12];N[1]=r[13];N[2]=r[14];n.invalidateBoundingInfo();for(var q=q.getVertexAttr(),n=q[y.POSITION].data,r=q[y.SIZE].data,q=q.mapPos.data,t=n.length/3,v=0,u=0,p=!1,w=0,x=0;x<t;x++){I.x=q[u];I.y=q[u+1];I.z=q[u+2];R[0]=n[v];
R[1]=n[v+1];R[2]=n[v+2];var z=m.computeElevation(b,I,c,d,h?H:null);h&&(w+=H.terrainElevation);C[0]=n[v]+N[0];C[1]=n[v+1]+N[1];C[2]=n[v+2]+N[2];e(z+r[v/3],C);n[v]=C[0]-N[0];n[v+1]=C[1]-N[1];n[v+2]=C[2]-N[2];z=.01/d.unitInMeters;if(Math.abs(R[0]-n[v])>z||Math.abs(R[1]-n[v+1])>z||Math.abs(R[2]-n[v+2])>z)p=!0;u+=3;v+=3}p&&a.geometryVertexAttrsUpdated(l);k+=w/t}c=k/g;V(a);return c},g);r.alignedTerrainElevation=d.terrainElevation;r.needsElevationUpdates=m.needsElevationUpdates3D(g.mode);return r}}return null};
g.prototype._createExtrudeGeometry=function(a,c,b){for(var d=a.length,e=new Uint32Array(d),f=0;f<d;f++)e[f]=0;d={};f={};d[y.POSITION]=a;d[y.NORMAL]=a;d[y.COLOR]=e;f[y.POSITION]={size:3,data:c.positions};f[y.NORMAL]={size:3,data:c.normals};f[y.COLOR]={size:4,data:b};f[y.SIZE]={size:1,data:c.heights};c.elevation&&(f.mapPos={size:3,data:c.elevation},d.mapPos=a);return new q(f,d)};return g}(e);var K=B.create(),L=B.create(),M=B.create(),V=B.create(),S=B.create(),Z=B.create(),R=B.create(),N=B.create();
return p})},"esri/views/3d/layers/support/edgeUtils":function(){define(["require","exports","../../../../Color","../../../../core/screenUtils"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});h.createMaterial=function(g,f,h){f=f&&f.enabled&&f.edges;if(!f||0===f.color.a||0===h)return null;var k=d.toUnitRGBA(f.color);k[3]*=h;switch(f.type){case "solid":return g.createSolidEdgeMaterial({color:k,size:a.pt2px(f.size),extensionLength:a.pt2px(f.extensionLength)});case "sketch":return g.createSketchEdgeMaterial({color:k,
size:a.pt2px(f.size),extensionLength:a.pt2px(f.extensionLength)})}}})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/when dojo/_base/lang dojo/errors/CancelError ../../../../Color ../../../../core/Error ../../../../core/screenUtils ../../../../core/sniff ../../../../core/urlUtils ../../../../geometry/Polygon ../../../../symbols/support/symbolUtils ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./SignedDistanceFunctions ../support/FastSymbolUpdates ../../lib/glMatrix ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x,z,A,y,B,E,C,G,J,F){function I(a){return"cross"===a||"x"===a}function H(a){var c;"primitive:"===a.substring(0,10)&&(a=a.substring(10));switch(a){case D.PRIM_CIRCLE:c=x.computeSignedDistancefieldCicle(128,64);break;case D.PRIM_SQUARE:c=x.computeSignedDistancefieldSquare(128,64,!1);break;case D.PRIM_KITE:c=x.computeSignedDistancefieldSquare(128,64,!0);break;case D.PRIM_CROSS:c=x.computeSignedDistancefieldCrossAndX(128,64,!1);break;case D.PRIM_X:c=x.computeSignedDistancefieldCrossAndX(128,
64,!0)}return new J(c,"sdf_"+a,{mipmap:!1,wrapClamp:!0,width:128,height:128,components:4})}var K=A.vec3d;p=A.vec4d;var L=A.mat4d.identity(),M=[0,0,1],V=[0,0,0,0],S=[0,0,0],Z=[1,1,1],R="center bottom top left right bottom-left bottom-right top-left top-right".split(" "),N=[.25,.25,.75,.75],D={PRIM_CIRCLE:"circle",PRIM_SQUARE:"square",PRIM_CROSS:"cross",PRIM_X:"x",PRIM_KITE:"kite"},P=[64,64];w=function(h){function p(){var a=null!==h&&h.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!0,
supportsOnTheGround:!0};return a}d(p,h);p.prototype._prepareResources=function(){var a=this.symbol,b=Math.round(null!=a.size?e.pt2px(a.size):16);this._size=null;this._symbolTextureRatio=1;this._primitive=null;var d=this._getStageIdHint();if(!this._isPropertyDriven("size")){var f=c.validateSymbolLayerSize(b);if(f){this._logWarning(f);this.reject();return}}this._isPropertyDriven("size")&&64>b&&(b=64);var g=a.resource||{primitive:"circle",href:void 0},f={anchorPos:this._getAnchorPos(a)},h=this.symbolContainer;
if(this._hasVisibleVerticalOffset(h)){var h=h.verticalOffset,k=h.minWorldLength,l=h.maxWorldLength;f.verticalOffset={screenLength:e.pt2px(h.screenLength),minWorldLength:k||0,maxWorldLength:null!=l?l:Infinity}}this._context.screenSizePerspectiveEnabled&&(f.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);g.href?(this._outlineSize=this._getOutlineSize(a,null),f.color=this._getFillColor(a,null),f.outlineColor=this._getOutlineColor(a),f.outlineSize=this._outlineSize,
f.textureIsSignedDistanceField=!1,this._prepareImageResources(b,f,d)):(g=g.primitive||"circle",h="primitive:"+g,this._primitive=g,this._outlineSize=this._getOutlineSize(a,g),f.color=this._getFillColor(a,g),f.outlineColor=this._getOutlineColor(a),f.outlineSize=this._outlineSize,I(g)&&0===f.outlineSize?this.reject():(this.texture=this._context.sharedResources.textures.acquire(h,H),this._textureURI=h,f.textureIsSignedDistanceField=!0,f.distanceFieldBoundingBox=N,f.textureId=this.texture.id,this._size=
[b,b],this._symbolTextureRatio=2,this._createMaterialsAndAddToStage(f,this._context.stage,d),this.resolve()))};p.prototype._getOutlineSize=function(a,c){var b=0,b=a.outline&&null!=a.outline.size?e.pt2px(a.outline.size):I(c)?1.5:0;return Math.max(b,0)};p.prototype._getOutlineColor=function(a){var c=this._getLayerOpacity();if(a.outline&&null!=a.outline.color){var b=k.toUnitRGB(a.outline.color);return[b[0],b[1],b[2],a.outline.color.a*c]}return[0,0,0,c]};p.prototype._getFillColor=function(a,c){return I(c)?
V:this._getMaterialOpacityAndColor()};p.prototype._getAnchorPos=function(a){return-1<R.indexOf(a.anchor)?a.anchor:"center"};p.prototype._prepareImageResources=function(c,d,e){var g=this,h=u.getIconHref(this.symbolContainer,this.symbol);!b("esri-canvas-svg-support")&&l.isSVG(h)?(this._logWarning("IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)"),this.reject(new m("SVG Not Supported","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)"))):(a(this._context.sharedResources.textures.acquire(h,
null,c),function(a){if(!g.isRejected()){var b=a.params,f=b.width/b.height;g._size=c?1<f?[c,Math.round(c/f)]:[Math.round(c*f),c]:[b.width,b.height];d.textureId=a.id;g._createMaterialsAndAddToStage(d,g._context.stage,e);g.resolve()}},function(a){a instanceof f?g.reject():(a="IconSymbol3DLayer failed to load (Request for icon resource failed: "+h+")",g._logWarning(a),g.reject(new m("Request Failed",a)))}),this._textureURI=h)};p.prototype._createMaterialsAndAddToStage=function(a,c,b){this._fastUpdates=
z.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&g.mixin(a,this._fastUpdates.materialParameters);var d=g.mixin({},a);d.verticalOffset=null;d.screenSizePerspective=null;d.occlusionTest=!1;d.shaderPolygonOffset=0;this._drapedMaterial=new F(d,b+"_iconDraped");c.add(B.ModelContentType.MATERIAL,this._drapedMaterial);a.occlusionTest=!0;this._material=new F(a,b+"_icon");c.add(B.ModelContentType.MATERIAL,
this._material)};p.prototype.destroy=function(){h.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(B.ModelContentType.MATERIAL,this._material.id),this._material=null);this._drapedMaterial&&(this._context.stage.remove(B.ModelContentType.MATERIAL,this._drapedMaterial.id),this._drapedMaterial=null);this._textureURI&&(this._context.sharedResources.textures.release(this._textureURI),this._textureURI=null)};p.prototype._getGeometry=function(a){a=
this._validateGeometry(a.geometry);if("extent"===a.type)return n.placePointOnPolygon(t.fromExtent(a));if("polyline"===a.type)return n.placePointOnPolyline(a);if("polygon"===a.type)return n.placePointOnPolygon(a);if("point"===a.type)return a;this._logWarning("unsupported geometry type for icon symbol: "+a.type);return null};p.prototype._getScaleFactor=function(a){if(this._isPropertyDriven("size")&&a.size){for(var c=0;3>c;c++){var b=a.size[c];b&&"symbolValue"!==b&&"proportional"!==b&&(a.size[c]=e.pt2px(b))}c=
this._size[0]>this._size[1]?this._size[0]:this._size[1];if("symbolValue"!==a.size[0]){if(isFinite(+a.size[0]))return+a.size[0]/c;if(isFinite(+a.size[2]))return+a.size[2]/c}}return 1};p.prototype.createGraphics3DGraphic=function(a,c){var b=this._getGeometry(a);if(null===b)return null;var d="graphic"+a.uid,e=this._getVertexOpacityAndColor(c),f=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(f=this._getScaleFactor(c));f*=this._symbolTextureRatio;c=[this._size[0]*f,this._size[1]*
f];f=this.getGraphicElevationContext(a);return"on-the-ground"===f.mode?this._createAsOverlay(a,b,e,c,f,d,a.uid):this._createAs3DShape(a,b,e,c,f,d,a.uid)};p.prototype.layerPropertyChanged=function(a,c,b){if("opacity"===a)return c=this._getFillColor(this.symbol,this._primitive),this._drapedMaterial.setParameterValues({color:c}),this._material.setParameterValues({color:c}),c=this._getOutlineColor(this.symbol),this._drapedMaterial.setParameterValues({outlineColor:c}),this._material.setParameterValues({outlineColor:c}),
!0;if("elevationInfo"===a){a=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;if("on-the-ground"===a&&"on-the-ground"===d)return!0;if(a!==d&&("on-the-ground"===a||"on-the-ground"===d))return!1;a=n.needsElevationUpdates2D(d)||"absolute-height"===d;for(var e in c){var f=c[e];(d=b(f))&&!d.isDraped()&&(f=this.getGraphicElevationContext(f.graphic),d.needsElevationUpdates=a,d.elevationContext.set(f))}return!0}return!1};p.prototype.applyRendererDiff=function(a,
c,b,d){for(var e in a.diff)switch(e){case "visualVariables":if(z.updateFastSymbolUpdatesState(this._fastUpdates,c,this._fastVisualVariableConvertOptions()))this._material.setParameterValues(this._fastUpdates.materialParameters),this._drapedMaterial.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};p.prototype.setDrawOrder=function(a,c,b){this._drapedMaterial&&(this._drapedMaterial.renderPriority=a,b[this._drapedMaterial.id]=!0)};p.prototype._defaultElevationInfoNoZ=
function(){return O};p.prototype._createAs3DShape=function(a,c,b,d,e,f,g){var h=this,k=this._getFastUpdateAttrValues(a);a=k?function(a){return z.evaluateModelTransform(h._fastUpdates.materialParameters,k,a)}:null;b=C.createPointGeometry(M,null,b,d,Q,null,k);b=[new E(b,f)];f=n.createStageObjectForPoint.call(this,c,b,[[this._material]],null,null,e,f,this._context.layer.uid,g,!0,a);if(null===f)return null;var l=new q(this,f.object,b,null,null,r.perObjectElevationAligner,e);l.alignedTerrainElevation=
f.terrainElevation;l.needsElevationUpdates=n.needsElevationUpdates2D(e.mode)||"absolute-height"===e.mode;l.getScreenSize=this._createScreenSizeGetter(d,a);l.calculateRelativeScreenBounds=function(a){return h._material.calculateRelativeScreenBounds(l.getScreenSize(),1,a)};n.extendPointGraphicElevationContext(l,c,this._context.elevationProvider);return l};p.prototype._createAsOverlay=function(a,c,b,d,e,f,g){var h=this;this._drapedMaterial.renderPriority=this._symbolLayerOrder;g=K.create();y.pointToVector(c,
g,this._context.overlaySR);g[2]=this._getDrapedZ();if((c=this._context.clippingExtent)&&!n.pointInBox2D(g,c))return null;var k=this._getFastUpdateAttrValues(a);a=k?function(a){return z.evaluateModelTransform(h._fastUpdates.materialParameters,k,a)}:null;b=C.createPointGeometry(M,g,b,d,null,null,k);c=new G(b);c.material=this._drapedMaterial;c.center=g;c.bsRadius=0;c.transformation=L;c.name=f;c.uniqueName=f+"#"+b.id;var l=new v(this,[c],null,null,null,e);l.getScreenSize=this._createScreenSizeGetter(d,
a);l.calculateRelativeScreenBounds=function(a){return h._drapedMaterial.calculateRelativeScreenBounds(l.getScreenSize(),1,a)};return l};p.prototype._createScreenSizeGetter=function(a,c){var b=this._outlineSize+2;if(this._fastUpdates.enabled){var d=a[0]/this._symbolTextureRatio,e=a[1]/this._symbolTextureRatio;return function(a){void 0===a&&(a=Array(2));var f=c(L);a[0]=f[0]*d+b;a[1]=f[5]*e+b;return a}}var f=a[0]/this._symbolTextureRatio+b,g=a[1]/this._symbolTextureRatio+b;return function(a){void 0===
a&&(a=Array(2));a[0]=f;a[1]=g;return a}};p.prototype._supportsShaderVisualVariables=function(){return!0};p.prototype._fastVisualVariableConvertOptions=function(){var a=this._size[0]>this._size[1]?this._size[0]:this._size[1],c=[a,a,a],b=e.px2pt(1),a=a*b;return{modelSize:c,symbolSize:[a,a,a],unitInMeters:b,transformation:{anchor:S,scale:Z,rotation:S}}};p.prototype._hasVisibleVerticalOffset=function(a){return this.symbolContainer&&"point-3d"===this.symbolContainer.type&&this.symbolContainer.hasVisibleVerticalOffset()};
p.PRIMITIVE_SIZE=P;p.VALID_ANCHOR_STRINGS=R;return p}(w);var O={mode:"relative-to-ground",offset:0},Q=p.createFrom(0,0,0,1);return w})},"esri/symbols/support/symbolUtils":function(){define(["require","exports","../../core/sniff"],function(p,h,d){Object.defineProperty(h,"__esModule",{value:!0});h.isVolumetricSymbol=function(a){return(a=a&&a.symbolLayers)?a.some(function(a){a=a.type;return"object"===a||"path"===a||"extrude"===a}):!1};h.getIconHref=function(g,f){f=f.resource.href;return!d("esri-canvas-svg-support")&&
g.styleOrigin&&a.test(f)?f.replace(a,"/resource/png/$1.png"):f};var a=/\/resource\/(.*?)\.svg$/})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ./ElevationContext ../../support/aaBoundingBox ../../support/aaBoundingRect ../../webgl-engine/Stage".split(" "),function(p,h,d,a,g,f,k,m,e){p=function(){function d(a,b,d,e,g,c){this.needsElevationUpdates=
!1;this.graphics3DSymbolLayer=a;this.renderGeometries=b;this.uniqueMaterials=d;this.uniqueTextures=e;this.boundingBox=g;this.elevationContext=new f(c);this.stage=null;this._visible=!1}d.prototype.initialize=function(a,b){this.stage=b;if(this.uniqueMaterials)for(a=0;a<this.uniqueMaterials.length;a++)b.add(e.ModelContentType.MATERIAL,this.uniqueMaterials[a]);if(this.uniqueTextures)for(a=0;a<this.uniqueTextures.length;a++)b.add(e.ModelContentType.TEXTURE,this.uniqueTextures[a])};d.prototype.isDraped=
function(){return!0};d.prototype.setVisibility=function(a){if(null!=this.stage)return this._visible!==a?((this._visible=a)?this.stage.getTextureGraphicsRenderer().addRenderGeometries(this.renderGeometries):this.stage.getTextureGraphicsRenderer().removeRenderGeometries(this.renderGeometries),!0):!1};d.prototype.destroy=function(){if(this.stage){var a=this.stage;this._visible&&a.getTextureGraphicsRenderer().removeRenderGeometries(this.renderGeometries);this._visible=!1;if(this.uniqueMaterials)for(var b=
0;b<this.uniqueMaterials.length;b++)a.remove(e.ModelContentType.MATERIAL,this.uniqueMaterials[b].id);if(this.uniqueTextures)for(b=0;b<this.uniqueTextures.length;b++)a.remove(e.ModelContentType.TEXTURE,this.uniqueTextures[b].id);this.stage=null}};d.prototype.alignWithElevation=function(a,b,d){};d.prototype.setDrawOrder=function(a,b,d){var e=this;this.uniqueMaterials&&this.uniqueMaterials.forEach(function(d){d.renderPriority=a;e._visible&&(b[d.id]=!0)})};d.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(a,
b){return Math.max(a,b.bsRadius)},0)};d.prototype.getCenterObjectSpace=function(){return[0,0,0]};d.prototype.addHighlight=function(a,b){var d=this.stage.getTextureGraphicsRenderer();this.renderGeometries.forEach(function(e){var f=d.addRenderGeometryHighlight(e,b);a.addRenderGeometry(e,d,f)})};d.prototype.removeHighlight=function(a){this.renderGeometries.forEach(function(b){a.removeRenderGeometry(b)})};d.prototype.getProjectedBoundingBox=function(d,e,f,h){return g(this,void 0,void 0,function(){var g,
c,l;return a(this,function(a){switch(a.label){case 0:k.set(f,k.NEGATIVE_INFINITY);for(g=0;g<this.renderGeometries.length;g++)c=this.renderGeometries[g],this._getRenderGeometryProjectedBoundingRect(c,b,d,h),k.expand(f,b);if(!e)return[3,5];k.center(f,t);l=void 0;a.label=1;case 1:return a.trys.push([1,3,,4]),[4,e.queryElevation(t[0],t[1])];case 2:return l=a.sent(),[3,4];case 3:return a.sent(),l=null,[3,4];case 4:null!=l&&(f[2]=Math.min(f[2],l),f[5]=Math.max(f[5],l)),a.label=5;case 5:return[2,f]}})})};
d.prototype._getRenderGeometryProjectedBoundingRect=function(a,b,d,e){if(this.boundingBox)k.set(l,this.boundingBox);else{var f=a.center;a=a.bsRadius;l[0]=f[0]-a;l[1]=f[1]-a;l[2]=f[2]-a;l[3]=f[0]+a;l[4]=f[1]+a;l[5]=f[2]+a}d(l,0,2);this.calculateRelativeScreenBounds&&e.push({location:k.center(l),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return k.toRect(l,b)};return d}();var b=m.create(),l=[0,0,0,0,0,0],t=[0,0,0];return p})},"esri/views/3d/layers/graphics/SignedDistanceFunctions":function(){define(["require",
"exports","../../support/mathUtils"],function(p,h,d){function a(a){return a-Math.floor(a)}function g(e,b,g){e=d.clamp(e,0,.9999991);var h=a(e*f[0]),l=a(e*f[1]),m=a(e*f[2]);e=a(e*f[3]);b[g+0]=256*(h-h*k[0]);b[g+1]=256*(l-h*k[1]);b[g+2]=256*(m-l*k[2]);b[g+3]=256*(e-m*k[3])}Object.defineProperty(h,"__esModule",{value:!0});var f=[16777216,65536,256,1],k=[0,1/256,1/256,1/256],m=[1/16777216,1/65536,1/256,1];h.packFloat=g;h.unpackFloat=function(a,b){var d=a[b+1]/256,e=a[b+2]/256,f=a[b+3]/256;a=0+a[b+0]/
256*m[0];a+=d*m[1];a+=e*m[2];return a+=f*m[3]};h.computeSignedDistancefieldCicle=function(a,b){var d=new Uint8Array(4*a*a),e=a/2-.5;b/=2;for(var f=0;f<a;f++)for(var h=0;h<a;h++){var k=h+a*f,m=h-e,n=f-e,m=Math.sqrt(m*m+n*n)-b,m=m/a+.5;g(m,d,4*k)}return d};h.computeSignedDistancefieldSquare=function(a,b,d){d&&(b/=Math.SQRT2);for(var e=new Uint8Array(4*a*a),f=0;f<a;f++)for(var h=0;h<a;h++){var k=h-.5*(a-.5),l=f-.5*(a-.5),n=f*a+h;if(d)var m=(k+l)/Math.SQRT2,l=(l-k)/Math.SQRT2,k=m;k=Math.max(Math.abs(k),
Math.abs(l))-.5*b;k=k/a+.5;g(k,e,4*n)}return e};h.computeSignedDistancefieldCrossAndX=function(a,b,d){d&&(b*=Math.SQRT2);b*=.5;for(var e=new Uint8Array(4*a*a),f=0;f<a;f++)for(var h=0;h<a;h++){var k=h-.5*a+0,l=f-.5*a+0,n=f*a+h;if(d)var m=(k+l)/Math.SQRT2,l=(l-k)/Math.SQRT2,k=m;k=Math.abs(k);l=Math.abs(l);m=void 0;m=k>l?k>b?Math.sqrt((k-b)*(k-b)+l*l):l:l>b?Math.sqrt(k*k+(l-b)*(l-b)):k;m=m/a+.5;g(m,e,4*n)}return e}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define(["require","exports",
"../../../../renderers/support/utils","../graphics/graphicUtils","../../lib/glMatrix"],function(p,h,d,a,g){function f(a){return null!==a&&void 0!==a}function k(a){return"number"===typeof a}function m(a,c){a&&a.push(c)}function e(a,c,e,g,h){var l=a.minSize,n=a.maxSize;if(a.expression)return m(h,"Could not convert size info: expression not supported"),!1;if(a.useSymbolValue)return a=g.symbolSize[e],c.minSize[e]=a,c.maxSize[e]=a,c.offset[e]=c.minSize[e],c.factor[e]=0,c.type[e]=1,!0;if(f(a.field)){if(f(a.stops)){if(2===
a.stops.length&&k(a.stops[0].size)&&k(a.stops[1].size))return b(a.stops[0].size,a.stops[1].size,a.stops[0].value,a.stops[1].value,c,e),c.type[e]=1,!0;m(h,"Could not convert size info: stops only supported with 2 elements");return!1}if(k(l)&&k(n)&&f(a.minDataValue)&&f(a.maxDataValue))return b(l,n,a.minDataValue,a.maxDataValue,c,e),c.type[e]=1,!0;if(null!=d.meterIn[a.valueUnit])return c.minSize[e]=-Infinity,c.maxSize[e]=Infinity,c.offset[e]=0,c.factor[e]=1/d.meterIn[a.valueUnit],c.type[e]=1,!0;"unknown"===
a.valueUnit?m(h,"Could not convert size info: proportional size not supported"):m(h,"Could not convert size info: scale-dependent size not supported");return!1}if(!f(a.field)){if(a.stops&&a.stops[0]&&k(a.stops[0].size))return c.minSize[e]=a.stops[0].size,c.maxSize[e]=a.stops[0].size,c.offset[e]=c.minSize[e],c.factor[e]=0,c.type[e]=1,!0;if(k(l))return c.minSize[e]=l,c.maxSize[e]=l,c.offset[e]=l,c.factor[e]=0,c.type[e]=1,!0}m(h,"Could not convert size info: unsupported variant of sizeInfo");return!1}
function b(a,c,b,d,e,f){d=0<Math.abs(d-b)?(c-a)/(d-b):0;e.minSize[f]=0<d?a:c;e.maxSize[f]=0<d?c:a;e.offset[f]=a-b*d;e.factor[f]=d}function l(a,c,b,d){if(a.normalizationField||a.valueRepresentation)return m(d,"Could not convert size info: unsupported property"),null;var f=a.field;if(null!=f&&"string"!==typeof f)return m(d,"Could not convert size info: field is not a string"),null;if(!c.size)c.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!c.size.field)c.size.field=
a.field;else if(a.field!==c.size.field)return m(d,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(f=e(a,c.size,0,b,d))?c:null;case "height":return(f=e(a,c.size,2,b,d))?c:null;case "depth":return(f=e(a,c.size,1,b,d))?c:null;case "width-and-depth":return(f=e(a,c.size,0,b,d))&&e(a,c.size,1,b,d),f?c:null;case null:case void 0:case "all":return(f=(f=(f=e(a,c.size,0,b,d))&&e(a,c.size,1,b,d))&&e(a,c.size,2,b,d))?c:null;default:return m(d,'Could not convert size info: unknown axis "'+
a.axis+'""'),null}}function t(a,c,b){for(var d=0;3>d;++d){var e=c.unitInMeters;1===a.type[d]&&(e*=c.modelSize[d],a.type[d]=2);a.minSize[d]/=e;a.maxSize[d]/=e;a.offset[d]/=e;a.factor[d]/=e}if(0!==a.type[0])c=0;else if(0!==a.type[1])c=1;else if(0!==a.type[2])c=2;else return m(b,"No size axis contains a valid size or scale"),!1;for(d=0;3>d;++d)0===a.type[d]&&(a.minSize[d]=a.minSize[c],a.maxSize[d]=a.maxSize[c],a.offset[d]=a.offset[c],a.factor[d]=a.factor[c],a.type[d]=a.type[c]);return!0}function u(a,
c,b){a[4*c+0]=b.r/255;a[4*c+1]=b.g/255;a[4*c+2]=b.b/255;a[4*c+3]=b.a}function r(a,c,b){if(a.normalizationField)return m(b,"Could not convert color info: unsupported property"),null;if("string"===typeof a.field)if(a.stops){if(8<a.stops.length)return m(b,"Could not convert color info: too many color stops"),null;c.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};a=a.stops;for(b=0;8>b;++b){var d=a[Math.min(b,a.length-1)];c.color.values[b]=
d.value;u(c.color.colors,b,d.color)}}else if(a.colors){if(!f(a.minDataValue)||!f(a.maxDataValue))return m(b,"Could not convert color info: missing data values"),null;if(2!==a.colors.length)return m(b,"Could not convert color info: invalid colors array"),null;c.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};c.color.values[0]=a.minDataValue;u(c.color.colors,0,a.colors[0]);c.color.values[1]=a.maxDataValue;u(c.color.colors,1,a.colors[1]);
for(b=2;8>b;++b)c.color.values[b]=a.maxDataValue,u(c.color.colors,b,a.colors[1])}else return m(b,"Could not convert color info: missing stops or colors"),null;else if(a.stops&&0<=a.stops.length||a.colors&&0<=a.colors.length)for(a=a.stops&&0<=a.stops.length?a.stops[0].color:a.colors[0],c.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},b=0;8>b;b++)c.color.values[b]=Infinity,u(c.color.colors,b,a);else return m(b,"Could not convert color info: no field and no colors/stops"),
null;return c}function v(a,c,b,d){a=2===b&&"arithmetic"===a.rotationType;c.offset[b]=a?90:0;c.factor[b]=a?-1:1;c.type[b]=1}function q(a,c,b){if("string"!==typeof a.field)return m(b,"Could not convert rotation info: field is not a string"),null;if(!c.rotation)c.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(a.field)if(!c.rotation.field)c.rotation.field=a.field;else if(a.field!==c.rotation.field)return m(b,"Could not convert rotation info: multiple fields in use"),null;
switch(a.axis){case "tilt":return v(a,c.rotation,0,b),c;case "roll":return v(a,c.rotation,1,b),c;case null:case void 0:case "heading":return v(a,c.rotation,2,b),c;default:return m(b,'Could not convert rotation info: unknown axis "'+a.axis+'""'),null}}function n(a,c,b){if(!a)return null;var d=!c.supportedTypes||!!c.supportedTypes.size,e=!c.supportedTypes||!!c.supportedTypes.color,f=!c.supportedTypes||!!c.supportedTypes.rotation;return(a=a.reduce(function(a,g){if(!a)return a;if(g.valueExpression)return m(b,
"Could not convert visual variables: arcade expressions not supported"),null;switch(g.type){case "size":return d?l(g,a,c,b):a;case "color":return e?r(g,a,b):a;case "rotation":return f?q(g,a,b):a;default:return m(b,"Could not convert visual variables: unsupported type "+g.type),null}},{size:null,color:null,rotation:null}))&&a.size&&!t(a.size,c,b)?null:a}function w(a,c,b){if(!!a!==!!c||a&&a.field!==c.field)return!1;if(a&&"rotation"===b)for(b=0;3>b;b++)if(a.type[b]!==c.type[b]||a.offset[b]!==c.offset[b]||
a.factor[b]!==c.factor[b])return!1;return!0}function c(a,c){var b={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvSymbolAnchor:null,vvSymbolRotation:null},d=a&&null!=a.size;a&&a.size?(b.vvSizeEnabled=!0,b.vvSizeMinSize=a.size.minSize,b.vvSizeMaxSize=a.size.maxSize,b.vvSizeOffset=a.size.offset,b.vvSizeFactor=a.size.factor):a&&d&&(b.vvSizeValue=c.transformation.scale);a&&d&&(b.vvSymbolAnchor=
c.transformation.anchor,b.vvSymbolRotation=c.transformation.rotation);a&&a.color&&(b.vvColorEnabled=!0,b.vvColorValues=a.color.values,b.vvColorColors=a.color.colors);return b}Object.defineProperty(h,"__esModule",{value:!0});h.convertVisualVariables=n;h.initFastSymbolUpdatesState=function(a,b,d){return b&&a&&!a.disableFastUpdates?(a=n(a.visualVariables,d))?{enabled:!0,visualVariables:a,materialParameters:c(a,d),customTransformation:a&&null!=a.size}:{enabled:!1}:{enabled:!1}};h.updateFastSymbolUpdatesState=
function(a,b,d){if(!b||!a.enabled)return!1;var e=a.visualVariables;b=n(b.visualVariables,d);if(!(b&&w(e.size,b.size,"size")&&w(e.color,b.color,"color")&&w(e.rotation,b.rotation,"rotation")))return!1;a.visualVariables=b;a.materialParameters=c(b,d);a.customTransformation=b&&null!=b.size;return!0};h.getMaterialParams=c;var x;(function(c){var b=g.mat4d,d=g.vec3,e=b.create(),f=d.create();c.evaluateModelTransform=function(c,d,g){if(!c.vvSizeEnabled)return g;b.identity(e);b.multiply(g,e,e);a.computeObjectRotation(c.vvSymbolRotation[2],
c.vvSymbolRotation[0],c.vvSymbolRotation[1],e);if(c.vvSizeEnabled){for(g=0;3>g;++g){var h=c.vvSizeOffset[g]+d[0]*c.vvSizeFactor[g],k=g;var l=c.vvSizeMinSize[g],n=c.vvSizeMaxSize[g],h=h<l?l:h>n?n:h;f[k]=h}b.scale(e,f,e)}else b.scale(e,c.vvSizeValue,e);b.translate(e,c.vvSymbolAnchor,e);return e}})(x||(x={}));h.evaluateModelTransform=x.evaluateModelTransform})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../../../geometry/Polygon ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ../../lib/glMatrix ../../support/aaBoundingBox ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w){var c=u.vec3d,x=u.mat4d;return function(b){function h(){return null!==b&&b.apply(this,arguments)||this}d(h,b);h.prototype._prepareResources=function(){var a=this.symbol,c=this._isPropertyDriven("size")||this._isPropertyDriven("color")||this._isPropertyDriven("opacity"),a={idHint:this._getStageIdHint(),width:this._getWidth(a),color:this._getMaterialOpacityAndColor()};if(!this._isPropertyDriven("size")){var b=l.validateSymbolLayerSize(a.width);if(b){this._logWarning(b);
this.reject();return}}if(c||1.5<=a.width)this._isPropertyDriven("size")&&(a.width=0),this._material=t.createRibbonMaterial(a);else if(0<a.width)this._material=t.createNativeMaterial(a);else{this.reject();return}this._context.stage.add(v.ModelContentType.MATERIAL,this._material);this.resolve()};h.prototype._getWidth=function(c){return null!=c.size?a.pt2px(c.size):1};h.prototype.destroy=function(){b.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(v.ModelContentType.MATERIAL,
this._material.id),this._material=null)};h.prototype.createGraphics3DGraphic=function(c,b){var d=this._validateGeometry(c.geometry);if("polyline"!==d.type&&"polygon"!==d.type&&"extent"!==d.type)return this._logWarning("unsupported geometry type for line symbol: "+d.type),null;var d="polygon"===d.type||"extent"===d.type?"rings":"paths",f="graphic"+c.uid,g=this._getVertexOpacityAndColor(b,Float32Array,255),h=0;b.size&&this._isPropertyDriven("size")&&(h=e.getSingleSizeDriver(b.size),h=a.pt2px(h));b=
this.getGraphicElevationContext(c);return"on-the-ground"===b.mode?this._createAsOverlay(c,d,g,h,b,f):this._createAs3DShape(c,d,g,h,b,f,c.uid)};h.prototype.layerPropertyChanged=function(a,c,b){if("opacity"===a)return c=this._material.getColor(),this._material.setColor([c[0],c[1],c[2],this._getMaterialOpacity()]),!0;if("elevationInfo"===a){a=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;if(null==a||null==d)return!1;if("on-the-ground"===a&&"on-the-ground"===
d)return!0;if(a!==d&&("on-the-ground"===a||"on-the-ground"===d))return!1;a=e.needsElevationUpdates2D(d);for(var f in c){var g=c[f];(d=b(g))&&!d.isDraped()&&(g=g.graphic,d.needsElevationUpdates=a,d.elevationContext.set(this.getGraphicElevationContext(g)))}return!0}return!1};h.prototype._getOutlineGeometry=function(a,c){return c};h.prototype._getGeometry=function(a){a=this._validateGeometry(a.geometry);"extent"===a.type&&(a=g.fromExtent(a));return a};h.prototype._createAs3DShape=function(a,b,d,g,h,
k,l){var r=this._getGeometry(a),u=r.hasZ,v=r[b],p=this._getOutlineGeometry(r,v);a=[];var w=[],z=[],A=c.create(),y=Array(6),r=e.getGeometryVertexData3D(p,u,r.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,h);this._logGeometryCreationWarnings(r,v,b,"LineSymbol3DLayer");if(0<p.length){for(var v=r.geometryData.outlines,p=r.eleVertexData,u=r.vertexData,E=0;E<v.length;++E){var C=v[E];if(!(1>=C.count)){var B=C.index,G=C.count;if(this._context.clippingExtent&&
(e.computeBoundingBox(p,B,G,y),e.boundingBoxClipped(y,this._context.clippingExtent)))continue;e.chooseOrigin(u,B,G,A);e.subtractCoordinates(u,B,G,A);C=new Float64Array(p.buffer,3*B*p.BYTES_PER_ELEMENT,3*G);B=new Float64Array(u.buffer,3*B*u.BYTES_PER_ELEMENT,3*G);B=t.createPolylineGeometry(B,C,"rings"===b,d,g);B=new q(B,k+"path"+E);B.singleUse=!0;a.push(B);w.push([this._material]);B=x.identity();x.translate(B,A,B);z.push(B)}}if(0<a.length)return b=new n({geometries:a,materials:w,transformations:z,
castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicId:l},idHint:k}),b=new m(this,b,a,null,null,f.perVertexElevationAligner,h),b.alignedTerrainElevation=r.terrainElevation,b.needsElevationUpdates=e.needsElevationUpdates2D(h.mode),b}return null};h.prototype._createAsOverlay=function(a,b,d,f,g,h){var l=this._getGeometry(a);this._material.renderPriority=this._symbolLayerOrder;var n=l[b],m=this._getOutlineGeometry(l,n);a=[];var q=Array(6),u=r.create(r.NEGATIVE_INFINITY),v=c.create(),l=e.getGeometryVertexDataDraped(m,
l.spatialReference,this._context.overlaySR);this._logGeometryCreationWarnings(l,n,b,"LineSymbol3DLayer");if(0<m.length){n=l.vertexData;m=l.geometryData.outlines;for(l=0;l<m.length;++l){var p=m[l],z=p.index,p=p.count;e.computeBoundingBox(n,z,p,q);if(!e.boundingBoxClipped(q,this._context.clippingExtent)){r.expand(u,q);e.chooseOrigin(n,z,p,v);e.subtractCoordinates(n,z,p,v);e.setZ(n,z,p,this._getDrapedZ());p=new Float64Array(n.buffer,3*z*n.BYTES_PER_ELEMENT,3*p);z=x.identity();x.translate(z,v,z);var p=
t.createPolylineGeometry(p,null,"rings"===b,d,f),A=new w(p);A.material=this._material;A.center=[.5*(q[0]+q[3]),.5*(q[1]+q[4]),0];A.bsRadius=.5*Math.sqrt((q[3]-q[0])*(q[3]-q[0])+(q[4]-q[1])*(q[4]-q[1]));A.transformation=z;A.name=h;A.uniqueName=h+"#"+p.id;a.push(A)}}return new k(this,a,null,null,u,g)}return null};return h}(b)})},"esri/views/3d/layers/graphics/lineUtils":function(){define("require exports ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(p,h,d,a,g,f){function k(a){var b=a.length;return a[0]===a[b-3]&&a[1]===a[b-2]&&a[2]===a[b-1]}Object.defineProperty(h,"__esModule",{value:!0});var m=a.VertexAttrConstants;h.createRibbonMaterial=function(a){var b={width:a.width,color:a.color,miterLimit:a.miterLimit,polygonOffset:!0};"miter"===a.join||"bevel"===a.join?b.join=a.join:(b.join="miter",a.join&&console.warn("unsupported join type for line symbol: "+a.join));return new f(b,a.idHint+"_ribbonlinemat")};h.createNativeMaterial=function(a){return new g({color:a.color},
a.idHint+"_nativelinemat")};h.isClosed=k;h.createPolylineGeometry=function(a,b,f,g,h){var e,l,q;if(f=f&&!k(a)){f=new Float32Array(a.length+3);for(l=0;l<a.length;l++)f[l]=a[l];l=f.length;f[l-3]=a[0];f[l-2]=a[1];f[l-1]=a[2];e=a.length/3+1;l=new Uint32Array(2*(e-1));q=new Uint32Array(2*(e-1))}else e=a.length/3,l=new Uint32Array(2*(e-1)),q=new Uint32Array(2*(e-1)),f=a;a=new Float32Array(1);a[0]=h;for(var n=h=0,t=0;t<e-1;t++)l[h++]=t,l[h++]=t+1,q[n++]=0,q[n++]=0;h={};e={};h[m.POSITION]=l;h[m.COLOR]=q;
h[m.SIZE]=q;e[m.POSITION]={size:3,data:f,offsetIdx:0,strideIdx:3};e[m.COLOR]={size:4,data:g,offsetIdx:0,strideIdx:4};e[m.SIZE]={size:1,data:a,offsetIdx:0,strideIdx:1};b&&(h.mapPos=l,e.mapPos={size:3,data:b,offsetIdx:0,strideIdx:3});return new d(e,h,d.DefaultOffsets,"line")}})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Logger ../lib/ComponentUtils ../lib/DefaultVertexBufferLayouts ../lib/gl-matrix ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ./internal/MaterialUtil ../../../webgl/Util".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u){var r=l.VertexAttrConstants,v=f.Pos3,q=u.getStride(v)/4,n={color:[1,1,1,1]},w=a.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");p=function(a){function b(c,b){b=a.call(this,b)||this;b.params=t.copyParameters(c,n);b.canBeMerged=!0;return b}d(b,a);b.prototype.setColor=function(a){this.params.color=a;this.notifyDirty("matChanged")};b.prototype.getColor=function(){return this.params.color};b.prototype.getParameterValues=function(){return{color:this.params.color}};
b.prototype.getOutputAmount=function(a){return a*q};b.prototype.getInstanceBufferLayout=function(){};b.prototype.getVertexBufferLayout=function(){return v};b.prototype.fillInterleaved=function(a,c,b,d,e,f,g){b=a.vertexAttr[r.POSITION].data;if(c)for(g=b,b=S,d=0;d<g.length;d+=3){var h=g[d],k=g[d+1],l=g[d+2];b[d]=c[0]*h+c[4]*k+c[8]*l+c[12];b[d+1]=c[1]*h+c[5]*k+c[9]*l+c[13];b[d+2]=c[2]*h+c[6]*k+c[10]*l+c[14]}a=a.indices[r.POSITION];for(d=0;d<a.length;d++)c=3*a[d],e[f++]=b[c],e[f++]=b[c+1],e[f++]=b[c+
2]};b.prototype.intersect=function(a,c,b,d,e,f,h,n){if(d.isSelection&&!g.isAllHidden(c.componentVisibilities,a.data.componentOffsets))if(l.isTranslationMatrix(b)){c=a.getData().getVertexAttr().position.data;e=d.camera;f=d.point;k.vec3d.set3(f[0]-2,f[1]+2,0,I[0]);k.vec3d.set3(f[0]+2,f[1]+2,0,I[1]);k.vec3d.set3(f[0]+2,f[1]-2,0,I[2]);k.vec3d.set3(f[0]-2,f[1]-2,0,I[3]);for(n=0;4>n;n++)e.unprojectPoint(I[n],H[n]);l.point2plane(e.eye,H[0],H[1],K);l.point2plane(e.eye,H[1],H[2],L);l.point2plane(e.eye,H[2],
H[3],M);l.point2plane(e.eye,H[3],H[0],V);a=Number.MAX_VALUE;for(n=0;n<c.length-5;n+=3)if(z[0]=c[n]+b[12],z[1]=c[n+1]+b[13],z[2]=c[n+2]+b[14],A[0]=c[n+3]+b[12],A[1]=c[n+4]+b[13],A[2]=c[n+5]+b[14],!(0>l.planeDistance(z,K)&&0>l.planeDistance(A,K)||0>l.planeDistance(z,L)&&0>l.planeDistance(A,L)||0>l.planeDistance(z,M)&&0>l.planeDistance(A,M)||0>l.planeDistance(z,V)&&0>l.planeDistance(A,V))){e.projectPoint(z,E);e.projectPoint(A,C);if(0>E[2]&&0<C[2]){k.vec3d.subtract(z,A,y);var m=e.frustumPlanes,r=-(k.vec3d.dot(m[4],
z)+m[4][3]),m=r/k.vec3d.dot(y,m[4]);k.vec3d.scale(y,m,y);k.vec3d.add(z,y,z);e.projectPoint(z,E)}else if(0<E[2]&&0>C[2])k.vec3d.subtract(A,z,y),m=e.frustumPlanes,r=-(k.vec3d.dot(m[4],A)+m[4][3]),m=r/k.vec3d.dot(y,m[4]),k.vec3d.scale(y,m,y),k.vec3d.add(A,y,A),e.projectPoint(A,C);else if(0>E[2]&&0>C[2])continue;m=l.pointLineSegmentDistanceSquared2D(E,C,f);m<a&&(a=m,k.vec3d.set(z,G),k.vec3d.set(A,J))}b=d.p0;d=d.p1;4>a&&(a=l.lineLineDistanceSquared3D(G,J,b,d,F),c=Number.MAX_VALUE,a.success&&(k.vec3d.subtract(a.pa,
b,B),a=k.vec3d.length(B),k.vec3d.scale(B,1/a),c=a/k.vec3d.dist(b,d)),h(c,B))}else w.error("intersection assumes a translation-only matrix")};b.prototype.getGLMaterials=function(){return{color:c,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:x}};b.prototype.getAllTextureIds=function(){return[]};return b}(e);var c=function(a){function c(c,b,d){c=a.call(this,c,b)||this;c.program=b.get("simple");c.updateParameters();return c}d(c,a);c.prototype.updateParameters=function(){this.params=this.material.getParameterValues()};
c.prototype.beginSlot=function(a){return a===b.OPAQUE_MATERIAL};c.prototype.getProgram=function(){return this.program};c.prototype.bind=function(a,c){c=this.program;var b=this.params;a.bindProgram(c);c.setUniform4fv("color",b.color);a.setBlendingEnabled(1>b.color[3]);a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);a.setDepthTestEnabled(!0)};c.prototype.release=function(a){1>this.params.color[3]&&a.setBlendingEnabled(!1)};c.prototype.bindView=function(a,
c){t.bindView(c.origin,c.view,this.program)};c.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",c.transformation)};c.prototype.getDrawMode=function(a){return a.gl.LINES};return c}(m),x=function(a){function c(c,b,d){c=a.call(this,c,b)||this;c.program=b.get("highlight");return c}d(c,a);c.prototype.updateParameters=function(){};c.prototype.beginSlot=function(a){return a===b.OPAQUE_MATERIAL};c.prototype.getProgram=function(){return this.program};c.prototype.bind=function(a,
c){a.bindProgram(this.program);a.setDepthTestEnabled(!0)};c.prototype.release=function(a){};c.prototype.bindView=function(a,c){t.bindView(c.origin,c.view,this.program)};c.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",c.transformation)};c.prototype.getDrawMode=function(a){return a.gl.LINES};return c}(m),z=k.vec3d.create(),A=k.vec3d.create(),y=k.vec3d.create(),B=k.vec3d.create(),E=k.vec3d.create(),C=k.vec3d.create(),G=k.vec3d.create(),J=k.vec3d.create(),F={success:!1,
dist2:0,pa:k.vec3d.create(),pb:k.vec3d.create()},I=[k.vec3d.create(),k.vec3d.create(),k.vec3d.create(),k.vec3d.create()],H=[k.vec3d.create(),k.vec3d.create(),k.vec3d.create(),k.vec3d.create()],K=k.vec4d.create(),L=k.vec4d.create(),M=k.vec4d.create(),V=k.vec4d.create(),S=[];return p})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../geometry/support/MeshComponent ../../../../geometry/support/webMercatorUtils ../../../../geometry/support/meshUtils/projection ./ElevationAligners ./Graphics3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../lib/glMatrix ../../support/aaBoundingBox ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x,z,A,y,B,E){var C=y.VertexAttrConstants;p=function(g){function h(){var a=null!==g&&g.apply(this,arguments)||this;a._edgeStageObjects=new Set;a._materials={};a._textures={};return a}d(h,g);h.prototype._prepareResources=function(){q.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new E({color:[1,0,1,1]},"debugVertexNormal"),this._debugFaceNormalMaterial=new E({color:[0,1,1,1]},"debugFAceNormal"));this.resolve()};h.prototype.destroy=function(){g.prototype.destroy.call(this);
this.isFulfilled()||this.reject();for(var a in this._materials)this._context.stage.remove(w.ModelContentType.MATERIAL,this._materials[a].material.id);for(a in this._textures)this._context.stage.remove(w.ModelContentType.TEXTURE,this._textures[a].id);this._materials={};this._textures={}};h.prototype.createGraphics3DGraphic=function(a,c){var b=this._validateGeometry(a.geometry);if("mesh"!==b.type)return this._logWarning("unsupported geometry type for fill on mesh-3d symbol: "+b.type),null;var b="graphic"+
a.uid,d=this.getGraphicElevationContext(a);return this._createAs3DShape(a,c,d,b,a.uid)};h.prototype.layerPropertyChanged=function(a,c,d){if("opacity"===a){c=this._getLayerOpacity();for(var e in this._materials){d=this._materials[e];d.material.setParameterValues({layerOpacity:c});var f=d.material.getParameterValues();this._setMaterialTransparentParameter(f);d.material.setParameterValues({transparent:f.transparent})}if(0<this._edgeStageObjects.size){var g=this._context.stage.view.getEdgeView(),h=this._getLayerOpacity(),
k=this.symbol.edges?this.symbol.edges.color.a:0;this._edgeStageObjects.forEach(function(a){g.updateComponentOpacity(a,0,k*h)})}return!0}if("elevationInfo"===a){this._updateElevationContext();for(f in c)if(a=c[f],e=d(a))a=this.getGraphicElevationContext(a.graphic),e.needsElevationUpdates=b.needsElevationUpdates3D(a.mode),e.elevationContext.set(a);return!0}return!1};h.prototype._requiresVertexColors=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};h.prototype._colorUid=
function(a){a=a.material&&a.material.color;if(!a)return"-";if(a)switch(a.type){case "value":return a.value.toHex();case "image":return a.uid}};h.prototype._materialProperties=function(a,c){a=this._requiresVertexColors();var b=c.material&&c.material.color;c=this._colorUid(c);return{hasVertexColors:a,color:b,uid:"vc:"+a+",cmuid:"+c}};h.prototype._setInternalColorValueParameters=function(c,b){b.diffuse=a.toUnitRGB(c.value);b.opacity=c.value.a};h.prototype._setInternalColorImageParameters=function(a,
c,b){var d=a.url;if(d){var e=this._textures[a.uid];e||(e=new A(d,c+"_"+a.uid+"_tex",{mipmap:!0,wrapClamp:!1,noUnpackFlip:!0}),this._textures[a.uid]=e,this._context.stage.add(w.ModelContentType.TEXTURE,e));b.textureId=e.id}};h.prototype._setInternalMaterialParameters=function(a,c,b){if(a=a.material&&a.material.color)switch(a.type){case "value":this._setInternalColorValueParameters(a,b);break;case "image":this._setInternalColorImageParameters(a,c,b)}};h.prototype._setExternalMaterialParameters=function(c){if(this._isPropertyDriven("color"))c.externalColor=
J;else{var b=this.symbol.material?a.toUnitRGBA(this.symbol.material.color):J;c.externalColor=b}if(b=this.symbol.material&&this.symbol.material.colorMixMode)c.colorMixMode=b};h.prototype._getOrCreateMaterial=function(a,c){a=this._materialProperties(a,c);var b=this._materials[a.uid];if(b)return b.material;var b=this._getStageIdHint(),d={specular:F,symbolColors:a.hasVertexColors,ambient:F,diffuse:G,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:"none",layerOpacity:this._getLayerOpacity()};
this._setInternalMaterialParameters(c,b,d);this._setExternalMaterialParameters(d);this._setMaterialTransparentParameter(d);b=new B(d,b+"_"+a.uid+"_mat");c=c.material&&c.material.color&&"value"===c.material.color.type&&c.material.color.value;this._materials[a.uid]={geometryOpacity:c?c.a:1,material:b};this._context.stage.add(w.ModelContentType.MATERIAL,b);return b};h.prototype._setMaterialTransparentParameter=function(a){this._isPropertyDriven("opacity")&&(a.transparent=!0);a.transparent=1>a.layerOpacity||
1>a.opacity||a.externalColor&&1>a.externalColor[3]};h.prototype._addDebugNormals=function(a,b,d,e){var f=b.length,g=a.spatialReference.isWGS84?20015077/180:1,h=.1*Math.max(a.extent.width*g,a.extent.height*g,a.extent.zmax-a.extent.zmin),k=[],l=[];a=[];for(var g=[],n=0;n<f;n++)for(var m=b[n],q=m.data.getAttribute(C.POSITION),t=m.data.getAttribute(C.NORMAL),u=m.data.getIndices(C.POSITION),m=m.data.getIndices(C.NORMAL),q=q.data,t=t.data,v=0;v<u.length;v++){for(var p=3*u[v],w=3*m[v],z=0;3>z;z++)k.push(q[p+
z]);for(z=0;3>z;z++)k.push(q[p+z]+t[w+z]*h);l.push(l.length);l.push(l.length);if(0===v%3){this._calculateFaceNormal(q,u,v,M);this._getFaceVertices(q,u,v,H,K,L);r.vec3d.add(H,K);r.vec3d.add(H,L);r.vec3d.scale(H,1/3);for(z=0;3>z;z++)a.push(H[z]);for(z=0;3>z;z++)a.push(H[z]+M[z]*h);g.push(g.length);g.push(g.length)}}f=(A={},A[C.POSITION]={data:new Float64Array(k),size:3},A);A=(y={},y[C.POSITION]=new Uint32Array(l),y);y=new x(f,A,void 0,"line");y=new c(y,"debugVertexNormal");y.singleUse=!0;b.push(y);
d.push([this._debugVertexNormalMaterial]);e.push(r.mat4d.create(e[0]));f=(E={},E[C.POSITION]={data:new Float64Array(a),size:3},E);A=(B={},B[C.POSITION]=new Uint32Array(g),B);y=new x(f,A,void 0,"line");y=new c(y,"debugFaceNormal");y.singleUse=!0;b.push(y);d.push([this._debugFaceNormalMaterial]);e.push(r.mat4d.create(e[0]));var A,y,E,B};h.prototype._createAs3DShape=function(a,c,d,f,g){var h=this;a=a.geometry;if("mesh"!==a.type)return null;var k=this._createGeometryInfo(a,c,f);if(!k)return null;c=k.geometries;
var l=k.materials,n=k.transformations,k=k.objectTransformation;q.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(a,c,l,n);f=new z({geometries:c,materials:l,transformations:n,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicId:g},idHint:f});f.setObjectTransformation(k);var r=function(a){var c=h._context.stage.view.getEdgeView();if(c){c.removeObject(a);h._edgeStageObjects.delete(a);var b=t.createMaterial(c,h.symbol,h._getLayerOpacity());b&&(h._edgeStageObjects.add(a),c.addObject(a,
[b],{mergeGeometries:!0}))}};r(f);g=function(a,c,b,d,e){c=m.perObjectElevationAligner(a,c,b,d,e);r(a);return c};c=new e(this,f,c,null,null,g,d);c.needsElevationUpdates=b.needsElevationUpdates3D(d.mode);d=a.extent.center.clone();d.z=0;c.elevationContext.centerPointInElevationSR=d;c.alignedTerrainElevation=g(f,c.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper,this._context.featureExpressionInfoContext);return c};h.prototype._createComponentNormals=function(a,c,b,d){switch(b.shading||
"flat"){case "source":return this._createComponentNormalsSource(a,c,b,d);case "flat":return this._createComponentNormalsFlat(a,b,d);case "smooth":return this._createComponentNormalsSmooth(a,b,d)}};h.prototype._createComponentNormalsSource=function(a,c,b,d){if(!c)return this._createComponentNormalsFlat(a,b,d);b=!1;for(var e=0;e<d.length;e+=3){this._calculateFaceNormal(a,d,e,M);for(var f=0;3>f;f++){var g=3*d[e+f];H[0]=c[g+0];H[1]=c[g+1];H[2]=c[g+2];0>r.vec3d.dot(M,H)&&(c[g+0]=-c[g+0],c[g+1]=-c[g+1],
c[g+2]=-c[g+2],b=!0)}}return{normals:c,indices:d,didFlipNormals:b}};h.prototype._createComponentNormalsFlat=function(a,c,b){c=new Float32Array(b.length);for(var d=new Uint32Array(3*b.length),e=0;e<b.length;e+=3)for(var f=this._calculateFaceNormal(a,b,e,M),g=0;3>g;g++)c[e+g]=f[g],d[e+g]=e/3;return{normals:c,indices:d,didFlipNormals:!1}};h.prototype._createComponentNormalsSmooth=function(a,c,b){c={};for(var d=0;d<b.length;d+=3)for(var e=this._calculateFaceNormal(a,b,d,M),f=0;3>f;f++){var g=b[d+f],h=
c[g];h||(h={normal:r.vec3d.create(),count:0},c[g]=h);r.vec3d.add(h.normal,e);h.count++}a=new Float32Array(3*b.length);e=new Uint32Array(3*b.length);for(d=0;d<b.length;d++){g=b[d];h=c[g];1!==h.count&&(r.vec3d.normalize(r.vec3d.scale(h.normal,1/h.count)),h.count=1);for(f=0;3>f;f++)a[3*d+f]=h.normal[f];e[d]=d}return{normals:a,indices:e,didFlipNormals:!1}};h.prototype._getFaceVertices=function(a,c,b,d,e,f){var g=3*c[b+0],h=3*c[b+1];c=3*c[b+2];d[0]=a[g+0];d[1]=a[g+1];d[2]=a[g+2];e[0]=a[h+0];e[1]=a[h+1];
e[2]=a[h+2];f[0]=a[c+0];f[1]=a[c+1];f[2]=a[c+2]};h.prototype._calculateFaceNormal=function(a,c,b,d){this._getFaceVertices(a,c,b,H,K,L);r.vec3d.subtract(K,H);r.vec3d.subtract(L,H);r.vec3d.cross(K,L,H);r.vec3d.normalize(H,d);return d};h.prototype._getOrCreateComponents=function(a){return a.components?a.components:R};h.prototype._createPositionBuffer=function(a){var c=a.vertexAttributes.position,d=new Float64Array(c.length);b.reproject(a.vertexAttributes.position,0,a.spatialReference,d,0,this._context.renderSpatialReference,
c.length/3);return d};h.prototype._createNormalBuffer=function(a,c){var b=a.vertexAttributes.normal;if(!b)return null;if("local"===this._context.layerView.view.viewingMode)return b;var d=a.vertexAttributes.position,e=new Float32Array(b.length);return k.projectNormalToECEF(b,d,c,a.spatialReference,e)};h.prototype._createColorBuffer=function(a){if(this._requiresVertexColors()){a=this._getVertexOpacityAndColor(a);var c=this.symbol.material&&this.symbol.material.colorMixMode||null,b=new Uint8Array(4);
u.encodeSymbolColor(a,c,b);return b}return null};h.prototype._createColorIndices=function(a,c){a=new Uint32Array(c.length);for(c=0;c<a.length;c++)a[c]=0;return a};h.prototype._createBuffers=function(a,c){var b=a.vertexAttributes&&a.vertexAttributes.position;if(!b)return this._logWarning("Mesh geometry must contain position vertex attributes"),null;var d=a.vertexAttributes.normal,e=a.vertexAttributes.uv;if(d&&d.length!==b.length)return this._logWarning("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),
null;if(e&&e.length/2!==b.length/3)return this._logWarning("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;b=this._createPositionBuffer(a);c=this._createColorBuffer(c);d=this._createNormalBuffer(a,b);a=this._transformCenterLocal(a,b,d);return{positionBuffer:b,normalBuffer:d,uvBuffer:e,colorBuffer:c,objectTransformation:a}};h.prototype._transformCenterLocal=function(a,c,b){var d=a.extent.center,e=this._context.renderSpatialReference;I[0]=d.x;I[1]=d.y;I[2]=
0;d=r.mat4d.create();n.computeLinearTransformation(a.spatialReference,I,d,e);r.mat4d.inverse(d,V);for(a=0;a<c.length;a+=3)H[0]=c[a+0],H[1]=c[a+1],H[2]=c[a+2],r.mat4d.multiplyVec3(V,H),c[a+0]=H[0],c[a+1]=H[1],c[a+2]=H[2];if(b)for(r.mat4d.toMat3(d,S),r.mat3d.transpose(S,S),a=0;a<b.length;a+=3)H[0]=b[a+0],H[1]=b[a+1],H[2]=b[a+2],r.mat3d.multiplyVec3(S,H),b[a+0]=H[0],b[a+1]=H[1],b[a+2]=H[2];return d};h.prototype._validateFaces=function(a,c){a=a.vertexAttributes.position.length/3;if(c=c.faces){for(var b=
-1,d=0;d<c.length;d++){var e=c[d];e>b&&(b=e)}if(a<=b)return this._logWarning("Vertex index "+b+" is out of bounds of the mesh position buffer"),!1}else if(0!==a%3)return this._logWarning("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0};h.prototype._getOrCreateFaces=function(a,c){if(c.faces)return c.faces;a=new Uint32Array(a.vertexAttributes.position.length/3);for(c=0;c<a.length;c++)a[c]=c;return a};
h.prototype._isOutsideClippingArea=function(a){if(!this._context.clippingExtent)return!1;var c=a.vertexAttributes&&a.vertexAttributes.position;if(!c)return!1;var d=this._context.elevationProvider.spatialReference,e=c.length/3;a.spatialReference.equals(d)||(c=new Float64Array(c.length),b.reproject(a.vertexAttributes.position,0,a.spatialReference,c,0,d,e));b.computeBoundingBox(c,0,e,Z);return b.boundingBoxClipped(Z,this._context.clippingExtent)};h.prototype._createGeometryInfo=function(a,b,d){if(!f.canProject(a,
this._context.layerView.view.spatialReference))return this._logWarning("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(a))return null;var e=this._createBuffers(a,b);if(!e)return null;b=e.positionBuffer;for(var g=e.uvBuffer,h=e.colorBuffer,k=e.normalBuffer,e=e.objectTransformation,l=[],n=[],m=[],q=!1,t=0,u=this._getOrCreateComponents(a);t<u.length;t++){var v=u[t];if(!this._validateFaces(a,v))return null;var p=this._getOrCreateFaces(a,v);if(0!==p.length){var w=
this._createComponentNormals(b,k,v,p);w.didFlipNormals&&(q=!0);var z=(A={},A[C.POSITION]={size:3,data:b},A[C.NORMAL]={size:3,data:w.normals},A),w=(y={},y[C.POSITION]=p,y[C.NORMAL]=w.indices,y);h&&(z[C.SYMBOLCOLOR]={size:4,data:h},w[C.SYMBOLCOLOR]=this._createColorIndices(v,p));a.vertexAttributes.uv&&(z[C.UV0]={size:2,data:g},w[C.UV0]=p);p=new x(z,w);p=new c(p,d+"_mesh");p.singleUse=!0;l.push(p);n.push(r.mat4d.identity());m.push([this._getOrCreateMaterial(a,v)])}}q&&this._logWarning("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");
return{geometries:l,transformations:n,materials:m,objectTransformation:e};var A,y};return h}(l);var G=[1,1,1],J=[1,1,1,1],F=[0,0,0],I=r.vec3d.create(),H=r.vec3d.create(),K=r.vec3d.create(),L=r.vec3d.create(),M=r.vec3d.create(),V=r.mat4d.create(),S=r.mat3d.create(),Z=v.create(),R=[new g];return p})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});h.encodeSymbolColor=function(d,a,g){null==d||"ignore"===
a?(g[0]=255,g[1]=255,g[2]=255,g[3]=255):(g[0]=Math.floor(255*d[0]),g[1]=Math.floor(255*d[1]),g[2]=Math.floor(255*d[2]),d=Math.floor(85*d[3]),g[3]=0===d?0:"tint"===a?d:"replace"===a?d+85:d+170)}})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/_base/lang dojo/errors/CancelError ../../../../Color ../../../../core/screenUtils ../../../../symbols/ObjectSymbol3DLayer ./ElevationAligners ./Graphics3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./objectResourceUtils ../support/FastSymbolUpdates ../../lib/glMatrix ../../support/aaBoundingBox ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x,z){var A=q.mat4d,y=q.vec3d,B=[1,1,1],E=[1,1,1,1],C=[0,0,0];p=[-.5,-.5,-.5,.5,.5,.5];h=[-.5,-.5,0,.5,.5,1];var G={sphere:p,cube:p,cylinder:h,cone:h,"inverted-cone":h,tetrahedron:[-.5,-.5,0,.5,.5,.5],diamond:p},J=[w.ModelContentType.MATERIAL,w.ModelContentType.TEXTURE,w.ModelContentType.GEOMETRY];return function(h){function q(){return null!==h&&h.apply(this,arguments)||this}d(q,h);q.prototype._prepareResources=function(){var a=this.symbol,c=this._getStageIdHint();
if(!this._isPropertyDriven("size")){var b=u.validateSymbolLayerSize(this.symbol);if(b){this._logWarning(b);this.reject();return}}a.resource&&a.resource.href?this._prepareModelResources(a.resource.href,c):this._preparePrimitiveResources(a.resource?a.resource.primitive:"sphere",c)};q.prototype._preparePrimitiveResources=function(b,d){var e=this.symbol;if("sphere"===b)this._geometryData=x.createPolySphereGeometry(.5,2,!0);else if("cube"===b)this._geometryData=x.createBoxGeometry(1);else if("cylinder"===
b)this._geometryData=x.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);else if("cone"===b)this._geometryData=x.createConeGeometry(1,.5,15,!1),x.cgToGIS(this._geometryData);else if("inverted-cone"===b)this._geometryData=x.createConeGeometry(1,.5,15,!0),x.cgToGIS(this._geometryData);else if("tetrahedron"===b)this._geometryData=x.createTetrahedronGeometry(1),x.cgToGIS(this._geometryData);else if("diamond"===b)this._geometryData=x.createDiamondGeometry(1),x.cgToGIS(this._geometryData);else{this._logWarning("Unknown object symbol primitive: "+
b);this.reject();return}this._geometry=new c(this._geometryData,d);this._context.stage.add(w.ModelContentType.GEOMETRY,this._geometry);this._resourceBoundingBox=G[b];this._resourceSize=n.size(this._resourceBoundingBox);this._symbolSize=u.computeSizeWithResourceSize(this._resourceSize,e);b=this._getMaterialOpacity();b={specular:[0,0,0],opacity:b,transparent:1>b||this._isPropertyDriven("opacity"),instanced:["transformation"],ambient:B,diffuse:B};var g=this.symbolContainer;if("point-3d"===g.type&&g.verticalOffset){var g=
g.verticalOffset,h=g.minWorldLength,l=g.maxWorldLength;b.verticalOffset={screenLength:k.pt2px(g.screenLength),minWorldLength:h||0,maxWorldLength:null!=l?l:Infinity};b.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(b.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._isPropertyDriven("color")?b.externalColor=E:(e=e.material?f.toUnitRGBA(e.material.color):E,b.externalColor=e);this._fastUpdates=v.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),
this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(a.mixin(b,this._fastUpdates.materialParameters),b.instanced.push("featureAttribute")):this._hasPerInstanceColor()&&b.instanced.push("color");this._material=new z(b,d+"_objectmat");this._context.stage.add(w.ModelContentType.MATERIAL,this._material);this.resolve()};q.prototype._prepareModelResources=function(c,b){var d=this,e=["transformation"];b={materialParamsMixin:{instanced:e},idHint:b,streamDataSupplier:this._context.streamDataSupplier};
this._fastUpdates=v.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(a.mixin(b.materialParamsMixin,this._fastUpdates.materialParameters),e.push("featureAttribute")):this._hasPerInstanceColor()&&e.push("color");e=this.symbolContainer;if("point-3d"===e.type&&e.verticalOffset){var e=e.verticalOffset,f=e.minWorldLength,h=e.maxWorldLength;b.materialParamsMixin.verticalOffset={screenLength:k.pt2px(e.screenLength),
minWorldLength:f||0,maxWorldLength:null!=h?h:Infinity};b.materialParamsMixin.castShadows=!1}this._symbolLoaderPromise=r.fetch(c,b);this._symbolLoaderPromise.then(function(a){d._symbolLoaderPromise=null;if(!d.isRejected()){var c=d._context,b=a.stageResources,e=c.stage,f=d._getExternalColorParameters(d.symbol.material),g=d._getMaterialOpacity(),h=d._isPropertyDriven("opacity"),k=b[w.ModelContentType.MATERIAL];a.originalMaterialOpacities=Array(k.length);k.forEach(function(b,d){var e=b.getParameterValues();
b.setParameterValues(f);a.originalMaterialOpacities[d]=e.opacity;d=e.opacity*g;b.setParameterValues({opacity:d,transparent:1>d||h||e.transparent});c.screenSizePerspectiveEnabled&&b.setParameterValues({screenSizePerspective:c.sharedResources.screenSizePerspectiveSettings})});J.forEach(function(a){for(var c=b[a],d=0;c&&d<c.length;d++)e.add(a,c[d])});d._resourceBoundingBox=r.computeBoundingBox(a);d._resourceSize=n.size(d._resourceBoundingBox);d._pivotOffset=a.pivotOffset;d._symbolSize=u.computeSizeWithResourceSize(d._resourceSize,
d.symbol);d._i3sModel=a;v.updateFastSymbolUpdatesState(d._fastUpdates,d._context.renderer,d._fastVisualVariableConvertOptions())&&k.forEach(function(a){return a.setParameterValues(d._fastUpdates.materialParameters)});d.resolve()}},function(a){d._symbolLoaderPromise=null;if(!d.isFulfilled()){if(!(a instanceof g)){var c="ObjectSymbol3DLayer failed to load";a&&a.message&&(c+=" ("+a.message+")");d._logWarning(c)}d.reject()}})};q.prototype._forEachMaterial=function(a){this._i3sModel?this._i3sModel.stageResources[w.ModelContentType.MATERIAL].forEach(a):
a(this._material)};q.prototype._getExternalColorParameters=function(a){var c={};this._isPropertyDriven("color")?c.externalColor=E:a&&a.color?c.externalColor=f.toUnitRGBA(a.color):(c.externalColor=E,c.colorMixMode="ignore");return c};q.prototype.destroy=function(){h.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._symbolLoaderPromise&&this._symbolLoaderPromise.cancel();var a=this._context.stage;if(this._i3sModel){var c=this._i3sModel.stageResources;J.forEach(function(b){for(var d=
c[b],e=0;d&&e<d.length;e++)a.remove(b,d[e].id)})}else this._material&&a.remove(w.ModelContentType.MATERIAL,this._material.id),this._geometry&&a.remove(w.ModelContentType.GEOMETRY,this._geometry.id)};q.prototype._getGeometry=function(a){a=this._validateGeometry(a.geometry);return"polyline"===a.type?l.placePointOnPolyline(a):"polygon"===a.type?l.placePointOnPolygon(a):"extent"===a.type?a.center:"point"!==a.type?(this._logWarning("unsupported geometry type for object symbol: "+a.type),null):a};q.prototype.createGraphics3DGraphic=
function(a,c){var b=this._getGeometry(a);if(null===b)return null;var d="graphic"+a.uid,e=this.getGraphicElevationContext(a);return this._createAs3DShape(a,b,c,e,d,a.uid)};q.prototype.layerPropertyChanged=function(a,c,b){var d=this;if("opacity"===a){var e=this._isPropertyDriven("opacity");if(this._i3sModel){var f=this._getMaterialOpacity();this._i3sModel.stageResources[w.ModelContentType.MATERIAL].forEach(function(a,c){c=d._i3sModel.originalMaterialOpacities[c]*f;a.setParameterValues({opacity:c,transparent:1>
c||e})})}else c=this._getMaterialOpacity(),this._material.setParameterValues({opacity:c,transparent:1>c||e});return!0}if("elevationInfo"===a){this._updateElevationContext();for(var g in c){var h=c[g];if(a=b(h))h=this.getGraphicElevationContext(h.graphic),a.needsElevationUpdates=l.needsElevationUpdates3D(h.mode),a.elevationContext.set(h)}return!0}return!1};q.prototype.applyRendererDiff=function(a,c,b,d){var e=this,f;for(f in a.diff)switch(f){case "visualVariables":if(v.updateFastSymbolUpdatesState(this._fastUpdates,
c,this._fastVisualVariableConvertOptions()))this._forEachMaterial(function(a){return a.setParameterValues(e._fastUpdates.materialParameters)});else return!1;break;default:return!1}return!0};q.prototype._createAs3DShape=function(a,c,d,f,g,h){var k=this,n=null,m=null;if(a=this._getFastUpdateAttrValues(a))n=n||{},n.featureAttribute=a,m=function(a){return v.evaluateModelTransform(k._fastUpdates.materialParameters,n.featureAttribute,a)};!this._fastUpdates.enabled&&this._hasPerInstanceColor()&&(n=n||{},
n.color=u.mixinColorAndOpacity(d.color,d.opacity));a=this._context.layer.uid;var r=A.identity();this._applyObjectRotation(d,r);this._applyObjectRotation(this.symbol,r);this._applyObjectScale(d,r);this._applyAnchor(r);if(this._i3sModel){d=this._i3sModel.stageResources[w.ModelContentType.GEOMETRY];for(var q=this._i3sModel.materialsByComponent,t=Array(d.length),p=0;p<r.length;p++)t[p]=r;g=l.createStageObjectForPoint.call(this,c,d,q,t,n,f,g,a,h,null,m)}else g=l.createStageObjectForPoint.call(this,c,[this._geometry],
[[this._material]],[r],n,f,g,a,h,null,m);if(null===g)return null;if(this._fastUpdates.enabled){var x=v.getMaterialParams(this._fastUpdates.visualVariables,this._fastVisualVariableConvertOptions());this._forEachMaterial(function(a){return a.setParameterValues(x)})}g.object.setCastShadow(!0);h=new b(this,g.object,null,null,null,e.perObjectElevationAligner,f,b.VisibilityModes.REMOVE_OBJECT);h.alignedTerrainElevation=g.terrainElevation;h.needsElevationUpdates=l.needsElevationUpdates3D(f.mode);l.extendPointGraphicElevationContext(h,
c,this._context.elevationProvider);return h};q.prototype._applyObjectScale=function(a,c){this._fastUpdates.enabled&&this._fastUpdates.customTransformation||(a=this._isPropertyDriven("size")&&a.size?a.size:this._symbolSize,a=u.computeObjectScale(a,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters),1===a[0]&&1===a[1]&&1===a[2]||A.scale(c,a))};q.prototype._applyObjectRotation=function(a,c){if(!(this._fastUpdates.enabled&&this._fastUpdates.customTransformation&&a instanceof
m))return u.computeObjectRotation(a.heading,a.tilt,a.roll,c)};q.prototype._computeAnchor=function(){switch(this.symbol.anchor){case "center":return y.scale(n.center(this._resourceBoundingBox),-1);case "top":var a=n.center(this._resourceBoundingBox);return[-a[0],-a[1],-this._resourceBoundingBox[5]];case "bottom":return a=n.center(this._resourceBoundingBox),[-a[0],-a[1],-this._resourceBoundingBox[2]];default:return this._pivotOffset?y.scale(this._pivotOffset,-1,Array(3)):C}};q.prototype._applyAnchor=
function(a){if(!this._fastUpdates.enabled||!this._fastUpdates.customTransformation){var c=this._computeAnchor();c&&A.translate(a,c)}};q.prototype._hasPerInstanceColor=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};q.prototype._supportsShaderVisualVariables=function(){return this._context.stage.has("instancedRendering")?!0:!1};q.prototype._fastVisualVariableConvertOptions=function(){var a=this._resourceBoundingBox?n.size(this._resourceBoundingBox):B,c=this._resourceBoundingBox?
this._computeAnchor():C,b=this._context.renderCoordsHelper.unitInMeters,d=u.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,b);return{modelSize:a,symbolSize:this._symbolSize||B,unitInMeters:b,transformation:{anchor:c,scale:d,rotation:[this.symbol.tilt||0,this.symbol.roll||0,this.symbol.heading||0]}}};q.PRIMITIVE_BOUNDING_BOX=G;return q}(t)})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/Deferred dojo/sniff dojo/_base/lang dojo/errors/CancelError ../../../../request ../../../../core/Error ../../../../core/Logger ../../../../core/Version ../../lib/glMatrix ../../support/aaBoundingBox ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w){function c(a){return new e("","Request for object resource failed: "+a)}function x(a,c){var b,d,e=[],h=[],k=[],m=[],r=[],t=l.Version.parse(a.version||"1.0","wosr");A.validate(t);var t="meshsymbol_"+a.model.name,u=a.textureDefinitions,p={},x;for(x in u){var y=u[x];if(b=y.images[0].data){d=y.encoding+";base64,"+b;b="/textureDefinitions/"+x;var B={noUnpackFlip:!0,wrapClamp:!1};g("enable-feature:jkieboom/alpha-channel-usage")&&(B.wrapClamp=!0);d=new n(d,t,
B);r.push(d);p[b]={engineTexObj:d,alphaChannelUsage:"rgba"===y.channels?y.alphaChannelUsage||"transparency":"none"}}else z.warn("Externally referenced texture data is not yet supported")}x=a.model.geometries;u=a.materialDefinitions;for(y=0;y<x.length;y++){d=B=x[y];var R=d.params,N=R.topology;b=!0;R.vertexAttributes||(z.warn("Geometry must specify vertex attributes"),b=!1);switch(R.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:if(!R.faces)z.warn("Indexed geometries must specify faces"),
b=!1;else if(R.vertexAttributes)for(N in N=void 0,R.vertexAttributes){var D=R.faces[N];D&&D.values?(null!=D.valueType&&"UInt32"!==D.valueType&&(z.warn("Unsupported indexed geometry indices type '"+D.valueType+"', only UInt32 is currently supported"),b=!1),null!=D.valuesPerElement&&1!==D.valuesPerElement&&(z.warn("Unsupported indexed geometry values per element '"+D.valuesPerElement+"', only 1 is currently supported"),b=!1)):(z.warn("Indexed geometry does not specify face indices for '"+N+"' attribute"),
b=!1)}break;default:z.warn("Unsupported topology '"+N+"'"),b=!1}d.params.material||(z.warn("Geometry requires material"),b=!1);d=d.params.vertexAttributes;R=void 0;for(R in d)d[R].values||(z.warn("Geometries with externally defined attributes are not yet supported"),b=!1);if(b){d=B.params;b=d.material;d=d.texture;var N=B.params.vertexAttributes,R={},P;for(P in N)D=N[P],R[P]={data:D.values,size:D.valuesPerElement};k.push([]);N={};if("PerAttributeArray"===B.params.topology){for(var B=R.position.data.length/
R.position.size,D=new Uint32Array(B),O=0;O<B;O++)D[O]=O;var B=D,Q;for(Q in R)N[Q]=B}else for(var T in B.params.faces)N[T]=new Uint32Array(B.params.faces[T].values);B=d?p[d]:null;D=m[b]?m[b][d]:null;D||(D=b.substring(b.lastIndexOf("/")+1),D=u[D].params,1===D.transparency&&(D.transparency=0),D={ambient:D.diffuse,diffuse:D.diffuse,specular:[0,0,0],opacity:1-(D.transparency||0),transparent:0<D.transparency,textureId:B?B.engineTexObj.id:void 0,doubleSided:!0,cullFace:"none",flipV:!1,colorMixMode:D.externalColorMixMode||
"tint"},g("enable-feature:jkieboom/alpha-channel-usage")&&B&&("transparency"===B.alphaChannelUsage||"maskAndTransparency"===B.alphaChannelUsage)&&(D.transparent=!0),c&&c.materialParamsMixin&&f.mixin(D,c.materialParamsMixin),D=new w(D,t),m[b]||(m[b]={}),m[b][d]=D,h.push(D));k[y].push(D);b=new v(new q(R,N),t);e.push(b)}}return{stageResources:{textures:r,materials:h,geometries:e},materialsByComponent:k,pivotOffset:a.model.pivotOffset}}Object.defineProperty(h,"__esModule",{value:!0});var z=b.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),
A=new l.Version(1,1,"wosr");h.fetch=function(b,d){d=d||{};var e=d.streamDataSupplier;if(e){var f=e.request(b,"json"),g=new a(function(){return e.cancelRequest(f)});f.then(function(a,c){try{var b=x(c,d);return g.resolve(b)}catch(L){return g.reject(L)}},function(a){g.reject(a instanceof k?a:c(a))});return g.promise}var h=m(b),l=new a(function(){return h.cancel()});h.then(function(a){try{var c=x(a.data,d);return l.resolve(c)}catch(K){return l.reject(K)}},function(a){l.reject(a instanceof k?a:c(b))});
return l.promise};h.computeBoundingBox=function(a){a=a.stageResources[r.ModelContentType.GEOMETRY];for(var c=u.create(u.NEGATIVE_INFINITY),b=[0,0,0],d=[0,0,0],e=0;e<a.length;e++){var f=a[e].getBoundingInfo();t.vec3d.set(f.getBBMin(),b);t.vec3d.set(f.getBBMax(),d);for(f=0;3>f;++f)c[f]=Math.min(c[f],b[f]),c[f+3]=Math.max(c[f+3],d[f])}return c};h.createStageResources=x})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../geometry/Point ./Graphics3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../../../views/3d/lib/glMatrix ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q){function n(a,c,b,d){for(var e=a.getGeometryRecords(),g=e.length,h="absolute-height"!==c.mode,k=0,l=0;l<g;l++){var n=e[l].geometry,m=[e[l].transformation[12],e[l].transformation[13],e[l].transformation[14]],r=n.getData().getVertexAttr(),q=r[z.POSITION].data,t=r.zOffset.data,r=r.mapPos.data,u=r.length/3;x(q.length/3===u*E+2,"unexpected tube geometry");var v=0,p=0;y.spatialReference=b.spatialReference;for(var w=0,C=0;C<u;C++){y.x=r[3*C];y.y=r[3*C+1];y.z=r[3*
C+2];var G=f.computeElevation(b,y,c,d,h?B:null);h&&(w+=B.terrainElevation);var F=E;0!==C&&C!==u-1||F++;for(var J=0;J<F;J++)A[0]=q[v]+m[0],A[1]=q[v+1]+m[1],A[2]=q[v+2]+m[2],d.setAltitude(G+t[p],A),q[v]=A[0]-m[0],q[v+1]=A[1]-m[1],q[v+2]=A[2]-m[2],v+=3,p+=1;n.invalidateBoundingInfo()}a.geometryVertexAttrsUpdated(l);k+=w/u}return k/g}var w=e.vec3d,c=e.mat4d,x=v.assert;p=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}d(e,a);e.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=
m.validateSymbolLayerSize(this._getSymbolSize());if(a){this._logWarning(a);this.reject();return}}var a=this._getStageIdHint(),c=this._getMaterialOpacityAndColor(),b=w.create(c),c=c[3],b={diffuse:b,ambient:b,opacity:c,transparent:1>c||this._isPropertyDriven("opacity"),vertexColors:this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};this._material=new q(b,a+"_3dlinemat");this._context.stage.add(l.ModelContentType.MATERIAL,this._material);this.resolve()};e.prototype.destroy=function(){a.prototype.destroy.call(this);
this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(l.ModelContentType.MATERIAL,this._material.id),this._material=null)};e.prototype.createGraphics3DGraphic=function(a,c){var b=this._validateGeometry(a.geometry);if("polyline"!==b.type)return this._logWarning("unsupported geometry type for path symbol: "+b.type),null;var b="graphic"+a.uid,d=this.getGraphicElevationContext(a);return this._createAs3DShape(a,c,d,b,a.uid)};e.prototype.layerPropertyChanged=function(a,c,b){if("opacity"===
a)return c=this._getMaterialOpacity(),b=1>c||this._isPropertyDriven("opacity"),this._material.setParameterValues({opacity:c,transparent:b}),!0;if("elevationInfo"===a){this._updateElevationContext();for(var d in c){var e=c[d];if(a=b(e))e=this.getGraphicElevationContext(e.graphic),a.needsElevationUpdates=f.needsElevationUpdates3D(e.mode),a.elevationContext.set(e)}return!0}return!1};e.prototype._getPathSize=function(a){a=a.size&&this._isPropertyDriven("size")?f.getSingleSizeDriver(a.size):this._getSymbolSize();
return a/=this._context.renderCoordsHelper.unitInMeters};e.prototype._getSymbolSize=function(){return this.symbol.size||1};e.prototype._createAs3DShape=function(a,d,e,h,k){var l=a.geometry,m=l.hasZ,q=l.paths;a=[];var v=[],p=[],x=w.create(),z=this._context.renderSpatialReference===b.SphericalECEFSpatialReference,A=Array(6),y=this._getPathSize(d),l=f.getGeometryVertexData3D(q,m,l.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,e);
this._logGeometryCreationWarnings(l,q,"paths","PathSymbol3DLayer");if(0<q.length){for(var q=l.geometryData.outlines,m=l.eleVertexData,C=l.vertexData,B=0;B<q.length;++B){var G=q[B];if(!(1>=G.count)){var F=G.index,J=G.count;if(this._context.clippingExtent&&(f.computeBoundingBox(m,F,J,A),f.boundingBoxClipped(A,this._context.clippingExtent)))continue;f.chooseOrigin(C,F,J,x);f.subtractCoordinates(C,F,J,x);G=new Float64Array(m.buffer,3*F*m.BYTES_PER_ELEMENT,3*J);F=f.flatArrayToArrayOfArrays(C,F,J);F=u.createTubeGeometry(F,
.5*y,E,z,x);F.getVertexAttr().mapPos={size:3,data:G,offsetIdx:0,strideIdx:3};this._material.getParams().vertexColors&&(G=this._getVertexOpacityAndColor(d),F=u.addVertexColors(F,G));G=new t(F,h+"path"+B);G.singleUse=!0;a.push(G);v.push([this._material]);G=c.identity();c.translate(G,x,G);p.push(G)}}if(0<a.length)return d=new r({geometries:a,materials:v,transformations:p,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicId:k},idHint:h}),d=new g(this,d,a,null,null,n,e),d.alignedTerrainElevation=
l.terrainElevation,d.needsElevationUpdates=f.needsElevationUpdates3D(e.mode),d}return null};return e}(k);var z=v.VertexAttrConstants,A=w.create(),y=new a,B={verticalDistanceToGround:0,terrainElevation:0},E=10;return p})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ../../../../geometry/Polygon ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ../../lib/glMatrix ../../support/aaBoundingBox ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Util ../../webgl-engine/materials/ColorMaterial".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x,z,A,y){var B=A.VertexAttrConstants;p=v.vec3d;var E=v.mat4d;t=function(h){function t(){var a=null!==h&&h.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};return a}d(t,h);t.prototype._prepareResources=function(){this._prepareFillResources();this._prepareOutlineResources();this.resolve()};t.prototype._prepareFillResources=function(){var a=this._getStageIdHint(),c=this._getMaterialOpacityAndColor(),c=
{color:c,transparent:1>c[3]||this._isPropertyDriven("opacity"),polygonOffset:!1,vertexColors:!0};this._material=new y(c,a+"_colormat");this._context.stage.add(n.ModelContentType.MATERIAL,this._material)};t.prototype._prepareOutlineResources=function(){var a=this.symbol.outline;if(this._hasOutline=!!(a&&a.size&&0<a.size&&a.color))a={idHint:this._getStageIdHint()+"_outline",color:this._getOutlineColor(),width:g.pt2px(a.size)},this._outlineMaterial=1.5<=a.width?r.createRibbonMaterial(a):r.createNativeMaterial(a),
this._context.stage.add(n.ModelContentType.MATERIAL,this._outlineMaterial)};t.prototype.destroy=function(){h.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(n.ModelContentType.MATERIAL,this._material.id),this._material=null);this._outlineMaterial&&(this._context.stage.remove(n.ModelContentType.MATERIAL,this._outlineMaterial.id),this._outlineMaterial=null)};t.prototype.createGraphics3DGraphic=function(a,c){var b=this._validateGeometry(a.geometry);
if("polyline"!==b.type&&"polygon"!==b.type&&"extent"!==b.type)return this._logWarning("unsupported geometry type for fill symbol: "+b.type),null;b="graphic"+a.uid;c=this._getVertexOpacityAndColor(c,Uint8Array,255);var d=this.getGraphicElevationContext(a);return"on-the-ground"===d.mode?this._createAsOverlay(a,c,d,b):this._createAs3DShape(a,c,d,b,a.uid)};t.prototype.layerPropertyChanged=function(a,c,b){if("opacity"===a)return c=this._material.getColor(),b=this._getMaterialOpacity(),this._material.setColor([c[0],
c[1],c[2],b]),this._material.setTransparent(1>b),this._outlineMaterial&&(c=this._outlineMaterial.getColor(),this._outlineMaterial.setColor([c[0],c[1],c[2],this._getOutlineOpacity()])),!0;if("elevationInfo"===a){a=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;if(null==a||null==d)return!1;if("on-the-ground"===a&&"on-the-ground"===d)return!0;if(a!==d&&("on-the-ground"===a||"on-the-ground"===d))return!1;a=l.needsElevationUpdates2D(d);for(var e in c){var f=
c[e];(d=b(f))&&!d.isDraped()&&(f=f.graphic,d.needsElevationUpdates=a,d.elevationContext.set(this.getGraphicElevationContext(f)))}return!0}return!1};t.prototype.setDrawOrder=function(a,c,b){this._material&&(this._material.renderPriority=a+c/2,b[this._material.id]=!0);this._outlineMaterial&&(this._outlineMaterial.renderPriority=a,b[this._outlineMaterial.id]=!0)};t.prototype._createAs3DShape=function(a,c,d,e,f){var g=this._getPolyGeometry(a),h=g.hasZ;a=g.rings;var k=this._getOutlineGeometry(g,a),g=l.getGeometryVertexData3D(k,
h,g.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,d);F.idHint=e;F.color=c;F.data=g;var n;this._hasOutline&&(n=new g.vertexData.constructor(g.vertexData));F.outNum=0;F.outGeometries=[];F.outTransforms=[];F.outMaterials=[];this._createAs3DShapeFill(F);F.data.vertexData=n;this._createAs3DShapeOutline(F);this._logGeometryCreationWarnings(F.data,a,"rings","FillSymbol3DLayer");if(0===F.outNum)return null;c=new x({geometries:F.outGeometries,
materials:F.outMaterials,transformations:F.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicId:f},idHint:e});c=new b(this,c,F.outGeometries,null,null,m.perVertexElevationAligner,d);c.alignedTerrainElevation=g.terrainElevation;c.needsElevationUpdates=l.needsElevationUpdates2D(d.mode);return c};t.prototype._createAs3DShapeFill=function(a){for(var c=a.data.geometryData.polygons,b=a.data.eleVertexData,d=a.data.vertexData,e=function(e){var h=c[e];e=h.count;var k=h.index;if(g._context.clippingExtent&&
(l.computeBoundingBox(b,k,e,C),l.boundingBoxClipped(C,g._context.clippingExtent)))return"continue";var n=new Float64Array(b.buffer,3*k*b.BYTES_PER_ELEMENT,3*e),m=new Float64Array(d.buffer,3*k*d.BYTES_PER_ELEMENT,3*e),h=h.holeIndices.map(function(a){return a-k}),h=f(n,h,3);if(0===h.length)return"continue";l.chooseOrigin(d,k,e,G);l.subtractCoordinates(d,k,e,G);e=g._createFillGeometry(h,0,m,n,a.color);e=new w(e,a.idHint);e.singleUse=!0;n=E.identity();E.translate(n,G,n);a.outGeometries.push(e);a.outMaterials.push([g._material]);
a.outTransforms.push(n);a.outNum++},g=this,h=0;h<c.length;++h)e(h)};t.prototype._createAs3DShapeOutline=function(a){if(this._hasOutline)for(var c=a.data.geometryData.outlines,b=a.data.eleVertexData,d=a.data.vertexData,e=0;e<c.length;++e){var f=c[e],g=f.index,h=f.count;if(this._context.clippingExtent&&(l.computeBoundingBox(b,g,h,C),l.boundingBoxClipped(C,this._context.clippingExtent)))continue;l.chooseOrigin(d,g,h,G);l.subtractCoordinates(d,g,h,G);f=new Float64Array(b.buffer,3*g*b.BYTES_PER_ELEMENT,
3*h);g=new Float64Array(d.buffer,3*g*d.BYTES_PER_ELEMENT,3*h);g=r.createPolylineGeometry(g,f,a.isRings,J,0);g=new w(g,a.idHint+"outline"+e);g.singleUse=!0;f=E.identity();E.translate(f,G,f);a.outGeometries.push(g);a.outMaterials.push([this._outlineMaterial]);a.outTransforms.push(f);a.outNum++}};t.prototype._createAsOverlay=function(a,c,b,d){var f=this._getPolyGeometry(a);a=f.rings;var g=this._getOutlineGeometry(f,a);this._material.renderPriority=this._symbolLayerOrder+this._symbolLayerOrderDelta/2;
this._hasOutline&&(this._outlineMaterial.renderPriority=this._symbolLayerOrder);f=l.getGeometryVertexDataDraped(g,f.spatialReference,this._context.overlaySR);F.idHint=d;F.color=c;F.data=f;var h;this._hasOutline&&(h=new f.vertexData.constructor(f.vertexData));F.outNum=0;F.outGeometries=[];F.outBoundingBox=q.create(q.NEGATIVE_INFINITY);this._createAsOverlayFill(F);F.data.vertexData=h;this._createAsOverlayOutline(F);this._logGeometryCreationWarnings(F.data,a,"rings","FillSymbol3DLayer");return 0<F.outNum?
new e(this,F.outGeometries,null,null,F.outBoundingBox,b):null};t.prototype._createAsOverlayFill=function(a){for(var c=a.data.vertexData,b=a.data.geometryData.polygons,d=function(d){var g=b[d];d=g.count;var h=g.index,k=new Float64Array(c.buffer,3*h*c.BYTES_PER_ELEMENT,3*d),g=g.holeIndices.map(function(a){return a-h}),k=f(k,g,3);if(0===k.length)return"continue";l.computeBoundingBox(c,h,d,C);if(l.boundingBoxClipped(C,e._context.clippingExtent))return"continue";q.expand(a.outBoundingBox,C);l.chooseOrigin(c,
h,d,G);l.subtractCoordinates(c,h,d,G);l.setZ(c,h,d,e._getDrapedZ());d=E.identity();E.translate(d,G,d);k=e._createFillGeometry(k,h,c,null,a.color);g=new z(k);g.material=e._material;var n=C;g.center=[.5*(n[0]+n[3]),.5*(n[1]+n[4]),0];g.bsRadius=.5*Math.sqrt((n[3]-n[0])*(n[3]-n[0])+(n[4]-n[1])*(n[4]-n[1]));g.transformation=d;g.name=a.idHint;g.uniqueName=a.idHint+"#"+k.id;a.outGeometries.push(g);a.outNum++},e=this,g=0;g<b.length;++g)d(g)};t.prototype._createAsOverlayOutline=function(a){if(this._hasOutline)for(var c=
a.data.vertexData,b=a.data.geometryData.outlines,d=0;d<b.length;++d){var e=b[d],f=e.index,e=e.count;l.computeBoundingBox(c,f,e,C);if(!l.boundingBoxClipped(C,this._context.clippingExtent)){q.expand(a.outBoundingBox,C);l.chooseOrigin(c,f,e,G);l.subtractCoordinates(c,f,e,G);l.setZ(c,f,e,this._getDrapedZ());e=new Float64Array(c.buffer,3*f*c.BYTES_PER_ELEMENT,3*e);f=E.identity();E.translate(f,G,f);var e=r.createPolylineGeometry(e,null,!0,J,0),g=new z(e);g.material=this._outlineMaterial;var h=C;g.center=
[.5*(h[0]+h[3]),.5*(h[1]+h[4]),0];g.bsRadius=.5*Math.sqrt((h[3]-h[0])*(h[3]-h[0])+(h[4]-h[1])*(h[4]-h[1]));g.transformation=f;g.name=a.idHint+"outline";g.uniqueName=a.idHint+"outline#"+e.id;a.outGeometries.push(g);a.outNum++}}};t.prototype._getOutlineGeometry=function(a,c){return c};t.prototype._getOutlineOpacity=function(){return this._getLayerOpacity()*this.symbol.outline.color.a};t.prototype._getOutlineColor=function(){var c=this.symbol.outline.color,b=this._getOutlineOpacity();return u.mixinColorAndOpacity(a.toUnitRGB(c),
b)};t.prototype._getPolyGeometry=function(a){a=a.geometry;return"extent"===a.type?k.fromExtent(a):a};t.prototype._createFillGeometry=function(a,b,d,e,f){for(var g=a.length,h=new Uint32Array(g),k=new Uint32Array(g),l=0;l<g;l++)h[l]=a[l]+b,k[l]=0;a={};b={};a[B.POSITION]=h;a[B.COLOR]=k;b[B.POSITION]={size:3,data:d};b[B.COLOR]={size:4,data:f};e&&(b.mapPos={size:3,data:e},a.mapPos=h);return new c(b,a)};return t}(t);var C=q.create(),G=p.create(),J=new Float32Array([255,255,255,255]),F={idHint:null,color:null,
data:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};return t})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./Graphics3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v){var q=[1,1,1,1],n=[0,0,1],w={mode:"relative-to-ground",offset:0},c=[0,0,0,1];return function(b){function h(){var a=null!==b&&b.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return a}d(h,b);h.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=l.validateSymbolLayerSize(this._getTextSize());if(a){this._logWarning(a);this.reject();return}}this._anchor="center";this.resolve()};h.prototype.destroy=
function(){b.prototype.destroy.call(this);this.isFulfilled()||this.reject()};h.prototype.createGraphics3DGraphic=function(a,c,b,d){var e="polyline"===a.geometry.type,f=this._getGeometryCentroid(a);if(!f)return this._logWarning("unsupported geometry type for text symbol: "+a.geometry.type),null;var g=this._context.layer.id+"_label_"+a.uid,h=c.text||this.symbol.text;if(!h||1>h.length)return null;c&&null!=c.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=c.needsOffsetAdjustment);
var k=this.getGraphicElevationContext(a,c.elevationOffset||0);return this._createAs3DShape(this.symbol,f,h,k,g,a.uid,c,b,d,e)};h.prototype.getGraphicElevationContext=function(a,c){void 0===c&&(c=0);a=b.prototype.getGraphicElevationContext.call(this,a);a.addOffsetRenderUnits(c);return a};h.prototype.layerPropertyChanged=function(a,c,b){if("opacity"===a)this._logWarning("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");else if("elevationInfo"===a){this._updateElevationContext();
if(c)for(var d in c){a=c[d];var e=b(a);e&&this.updateGraphicElevationContext(a.graphic,e)}return!0}return!1};h.prototype.updateGraphicElevationContext=function(a,c){a=this.getGraphicElevationContext(a,c.metadata.elevationOffset);c.elevationContext.set(a);c.needsElevationUpdates=e.needsElevationUpdates2D(a.mode)||"absolute-height"===a.mode};h.prototype._defaultElevationInfoNoZ=function(){return w};h.prototype._createAs3DShape=function(b,d,h,l,p,w,x,z,I,H){var y=x.centerOffset||c,A=x.screenOffset||
[0,0],E=x.debugDrawBorder||!1,B=x.translation||[0,0,0],C=x.anchor||this._anchor||"center";this._anchor=C;var G=b.material?a.toUnitRGBA(b.material.color):q,F=b.halo&&b.halo.color&&0<b.halo.size,J=F?a.toUnitRGBA(b.halo.color):q,F=F?g.pt2px(b.halo.size):0,D=this._getTextSize(b);b=new r(h,{size:D,color:G,font:{family:b.font&&b.font.family?b.font.family:"Arial",weight:b.font&&b.font.weight?b.font.weight:"normal",style:b.font&&b.font.style?b.font.style:"normal"},halo:{size:F,color:J}},p);I=(G=I&&I.canHoldTextTexture(b))?
I.addTextTexture(b):null;var P;z?P=x:f.isCalloutSupport(this.symbolContainer)&&this.symbolContainer.hasVisibleVerticalOffset()&&(P=this.symbolContainer);A={textureId:G?I.texture.id:b.id,texCoordScale:G?[1,1]:b.getTexcoordScale(),occlusionTest:!0,screenOffset:A,anchorPos:C,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:x.centerOffsetUnits,debugDrawBorder:E,drawInSecondSlot:!0};P&&P.verticalOffset&&(P=P.verticalOffset,E=P.minWorldLength,C=P.maxWorldLength,A.verticalOffset={screenLength:g.pt2px(P.screenLength),
minWorldLength:E||0,maxWorldLength:null!=C?C:Infinity});this._context.screenSizePerspectiveEnabled&&(P=this._context.sharedResources,E=P.screenSizePerspectiveSettings,A.screenSizePerspective=P.screenSizePerspectiveSettingsLabels.overridePadding(F),A.screenSizePerspectiveAlignment=E);H&&(A.shaderPolygonOffset=1E-4);H=null;F=JSON.stringify(A);null!=z?(H=z.getMaterial(F),null==H?(H=new v(A,p),z.addMaterial(F,H)):G&&H.setTextureDirty()):H=new v(A,p);H=[H];F=[b.getTextWidth(),b.getTextHeight()];y=u.createPointGeometry(n,
B,void 0,F,y,I?I.uvMinMax:null);y=[new t(y,p)];p=e.createStageObjectForPoint.call(this,d,y,[H],null,null,l,p,this._context.layer.uid,w,!0);z=new m(this,p.object,y,null==z?H:null,G?null:[b],k.perObjectElevationAligner,l);z.alignedTerrainElevation=p.terrainElevation;z.needsElevationUpdates=e.needsElevationUpdates2D(l.mode)||"absolute-height"===l.mode;var O=G?b.getTextWidth():b.getWidth(),Q=G?b.getTextHeight():b.getHeight();z.getScreenSize=function(a){void 0===a&&(a=Array(2));a[0]=O;a[1]=Q;return a};
z.metadata={labelText:h,elevationOffset:x.elevationOffset||0};e.extendPointGraphicElevationContext(z,d,this._context.elevationProvider);return z};h.prototype._getTextSize=function(a){return g.pt2px((a||this.symbol).size)||12};return h}(b)})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define(["require","exports","./Texture","./Util","../../../webgl/Texture"],function(p,h,d,a,g){function f(){var a=document.createElement("canvas");a.width=512;a.height=512;return a}function k(a){return"rgb("+
a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+")"}function m(a){return"rgba("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+","+a[3]+")"}p=function(){function b(b,d,e,f){void 0===f&&(f=!0);this._idHint=e;this._text=b;this._textLines=b.split(/\r?\n/);this._params=d;this._haloSize=Math.round(this._params.halo.size);this._fillStyle=m(this._params.color);this._haloStyle=k(this._params.halo.color);this._textWidth=this._computeTextWidth();this._lineHeight=this._computeLineHeight();
this._textHeight=this._computeTextHeight();this._scaleFactor=f?Math.min(1,Math.min(2048/this._textWidth,2048/this._textHeight)):1;this._renderedWidth=Math.round(this._textWidth*this._scaleFactor);this._renderedHeight=Math.round(this._textHeight*this._scaleFactor);f&&a.assert(2048>=this._renderedWidth&&2048>=this._renderedHeight);this._width=a.nextHighestPowerOfTwo(this._renderedWidth);this._height=a.nextHighestPowerOfTwo(this._renderedHeight)}Object.defineProperty(b.prototype,"id",{get:function(){null==
this._id&&(this._id=d.idGen.gen(this._idHint));return this._id},enumerable:!0,configurable:!0});b.prototype.getParams=function(){return this._params};b.prototype.getText=function(){return this._text};b.prototype.deferredLoading=function(){return!1};b.prototype.getWidth=function(){return this._width};b.prototype.getHeight=function(){return this._height};b.prototype.getTextWidth=function(){return this._textWidth};b.prototype.getTextHeight=function(){return this._textHeight};b.prototype.getRenderedWidth=
function(){return this._renderedWidth};b.prototype.getRenderedHeight=function(){return this._renderedHeight};b.prototype.initializeThroughRender=function(a,b){var d=this._getTextCanvas();d.width=this._width;d.height=this._height;var e=d.getContext("2d");e.save();b.samplingMode=9987;b.wrapMode=33071;b.flipped=!0;b.preMultiplyAlpha=!0;b.hasMipmap=!0;this.renderText(this._renderedWidth,this._renderedHeight,e,0,this._height-this._renderedHeight);a=new g(a,b,d);e.restore();return a};b.prototype.getTexcoordScale=
function(){return[this._renderedWidth/this._width,this._renderedHeight/this._height]};b.prototype.setUnloadFunc=function(a){this._unloadFunc=a};b.prototype.unload=function(){this._unloadFunc&&(this._unloadFunc(this._id),this._unloadFunc=null)};b.prototype.renderText=function(a,b,d,f,g){void 0===f&&(f=0);void 0===g&&(g=0);b=this._lineHeight*this._scaleFactor;var h=this._haloSize,k=d.textAlign;a=("center"===k?.5*a:"right"===k?a:0)+h;d.save();var l=3>h;if(0<h){var k=h,c=this._getHaloCanvas();c.width=
Math.max(512,this._renderedWidth);c.height=Math.max(512,this._renderedHeight);var m=c.getContext("2d");m.clearRect(0,0,c.width,c.height);this._setFontProperties(m,this._params.size*this._scaleFactor);m.fillStyle=this._haloStyle;m.strokeStyle=this._haloStyle;m.lineJoin=l?"miter":"round";if(l)for(var r=0,t=this._textLines;r<t.length;r++){for(var l=t[r],v=0,u=e;v<u.length;v++){var p=u[v];m.fillText(l,a+h*p[0],h+h*p[1])}k+=b}else for(r=0,t=this._textLines;r<t.length;r++){l=t[r];v=2*h;for(u=0;5>u;u++)m.lineWidth=
(.6+.1*u)*v,m.strokeText(l,a,k);k+=b}d.globalAlpha=this._params.halo.color[3];d.drawImage(c,f,g);c.width=512;c.height=512;d.globalAlpha=1}this._setFontProperties(d,this._params.size*this._scaleFactor);k=g+h;g=0;for(h=this._textLines;g<h.length;g++)l=h[g],d.globalCompositeOperation="destination-out",d.fillStyle="rgb(0, 0, 0)",d.fillText(l,f+a,k),d.globalCompositeOperation="source-over",d.fillStyle=this._fillStyle,d.fillText(l,f+a,k),k+=b;d.restore()};b.preferredAtlasSize=function(){return 512};b.prototype._getTextCanvas=
function(){null==b._textCanvas2D&&(b._textCanvas2D=f());return b._textCanvas2D};b.prototype._getHaloCanvas=function(){null==b._haloCanvas2D&&(b._haloCanvas2D=f());return b._haloCanvas2D};b.prototype._setFontProperties=function(a,b){var d=this._params.font;a.font=d.style+" "+d.weight+" "+b+"px "+d.family;a.textAlign="left";a.textBaseline="top"};b.prototype._computeTextWidth=function(){var a=this._getTextCanvas().getContext("2d");this._setFontProperties(a,this._params.size);for(var b=0,d=0,e=this._textLines;d<
e.length;d++){var f=a.measureText(e[d]).width;f>b&&(b=f)}d=this._params.font;if("italic"===d.style||"oblique"===d.style||"string"===typeof d.weight&&("bold"===d.weight||"bolder"===d.weight)||"number"===typeof d.weight&&600<d.weight)b+=.3*a.measureText("A").width;b+=2*this._haloSize;return b=Math.round(b)};b.prototype._computeLineHeight=function(){return Math.floor(1.275*this._params.size+2*this._haloSize)};b.prototype._computeTextHeight=function(){return this._computeLineHeight()*this._textLines.length};
return b}();var e=[];for(h=0;360>h;h+=22.5)e.push([Math.cos(Math.PI*h/180),Math.sin(Math.PI*h/180)]);return p})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../support/PromiseLightweight"],function(p,h,d,a){return function(a){function f(d,f){var e=a.call(this)||this;e.symbol=null;e.graphics3DSymbol=null;e.symbol=d;d.fetchSymbol().then(function(a){if(e.isRejected())throw Error();e.graphics3DSymbol=f(a)}).then(function(){if(e.isRejected())throw Error();
e.graphics3DSymbol.then(function(){e.isRejected()||e.resolve()},function(a){e.isRejected()||e.reject(a)})}).catch(function(a){e.isRejected()||e.reject(a)});return e}d(f,a);f.prototype.createGraphics3DGraphic=function(a,d){return this.graphics3DSymbol.createGraphics3DGraphic(a,d,this)};f.prototype.layerPropertyChanged=function(a,d){return this.graphics3DSymbol.layerPropertyChanged(a,d)};f.prototype.applyRendererDiff=function(a,d,e){return this.graphics3DSymbol.applyRendererDiff(a,d,e)};f.prototype.getFastUpdateStatus=
function(){return this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};f.prototype.setDrawOrder=function(a,d){return this.graphics3DSymbol.setDrawOrder(a,d)};f.prototype.destroy=function(){this.isFulfilled()||this.reject();this.graphics3DSymbol&&this.graphics3DSymbol.destroy()};return f}(a.Promise)})},"esri/views/3d/webgl-engine/lib/FloatingBoxLocalOriginFactory":function(){define(["require","exports","./gl-matrix"],function(p,h,d){var a=d.vec3d;p=function(){function d(a,
d){this._origins=[];this._boxSize=a;this._maxNumOrigins=d}d.prototype.getOrigin=function(f){for(var h=this._origins.length,e,b=!1,k=Number.MAX_VALUE,t=0;t<h;t++){var u=this._origins[t];a.subtract(f,u.vec3,g);g[0]=Math.abs(g[0]);g[1]=Math.abs(g[1]);g[2]=Math.abs(g[2]);var r=g[0]+g[1]+g[2];r<k&&(e=u,k=r,b=g[0]<this._boxSize&&g[1]<this._boxSize&&g[2]<this._boxSize)}b||e&&null!=this._maxNumOrigins&&!(this._origins.length<this._maxNumOrigins)||(h=d.OFFSET,e={vec3:[f[0]+h,f[1]+h,f[2]+h],id:d.ORIGIN_PREFIX+
this._origins.length},this._origins.push(e));return e};d.OFFSET=1.11;d.ORIGIN_PREFIX="fb_";return d}();var g=a.create();return p})},"esri/views/3d/webgl-engine/lib/Layer":function(){define("require exports dojo/has ./gl-matrix ./IdGen ./ModelContentType ./Octree ./PerformanceTimer ./Util".split(" "),function(p,h,d,a,g,f,k,m,e){var b=a.vec3d;return function(){function a(d,e,f){this._parentStages=[];this._children=[];this.id=a._idGen.gen(f);this.name=d;e=e||{};this.group=e.group||"";this.isPickable=
null!=e.isPickable?e.isPickable:!0;this.translation=b.create(e.translation);this._extent=[b.createFrom(0,0,0),b.createFrom(1E3,1E3,1E3)];this._extentDirty=!0}a.prototype.getParentStages=function(){return this._parentStages};a.prototype.addParentStage=function(a){-1===this._parentStages.indexOf(a)&&this._parentStages.push(a)};a.prototype.removeParentStage=function(a){a=this._parentStages.indexOf(a);-1<a&&this._parentStages.splice(a,1)};a.prototype.getName=function(){return this.name};a.prototype.getGroup=
function(){return this.group};a.prototype.getTranslation=function(){return this.translation};a.prototype.getObjectIds=function(){return this._children.map(function(a){return a.id})};a.prototype.getObjects=function(){return this._children};a.prototype.getExtent=function(){this._updateExtent();return this._extent};a.prototype.addObject=function(a){this._children.push(a);a.addParentLayer(this);this.notifyDirty("layObjectAdded",a);this._invalidateExtent();this._spatialAccelerator&&this._spatialAccelerator.add(a)};
a.prototype.hasObject=function(a){return-1<this._children.indexOf(a)};a.prototype.removeObject=function(a){return null!=e.arrayRemove(this._children,a)?(a.removeParentLayer(this),this.notifyDirty("layObjectRemoved",a),this._invalidateExtent(),this._spatialAccelerator&&this._spatialAccelerator.remove(a),!0):!1};a.prototype.replaceObject=function(a,b){var d=this._children.indexOf(a);e.assert(-1<d,"Layer.replaceObject: layer doesn't contain specified object");this._children[d]=b;a.removeParentLayer(this);
b.addParentLayer(this);this.notifyDirty("layObjectReplaced",[a,b]);this._invalidateExtent();this._spatialAccelerator&&(this._spatialAccelerator.remove(a),this._spatialAccelerator.add(b))};a.prototype.notifyObjectBBChanged=function(a,b){this._spatialAccelerator&&this._spatialAccelerator.update(a,b)};a.prototype.getCenter=function(){this._updateExtent();var a=b.create();return b.lerp(this._extent[0],this._extent[1],.5,a)};a.prototype.getBSRadius=function(){this._updateExtent();return.5*b.dist(this._extent[0],
this._extent[1])};a.prototype.getSpatialQueryAccelerator=function(){if(this._spatialAccelerator)return this._spatialAccelerator;if(50<this._children.length)return this._createOctree(),this._spatialAccelerator};a.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)};a.prototype.invalidateSpatialQueryAccelerator=function(){this._spatialAccelerator=null};a.prototype.notifyDirty=function(a,b,d,e){d=d||f.LAYER;e=e||this;for(var g=0;g<this._parentStages.length;g++)this._parentStages[g].notifyDirty(d,
e,a,b)};a.prototype._createOctree=function(){for(var a=this.getExtent(),d=0,e=0;3>e;e++)d=Math.max(d,a[1][e]-a[0][e]);e=b.create();b.lerp(a[0],a[1],.5,e);this._spatialAccelerator=new k(e,1.2*d);this._spatialAccelerator.add(this._children)};a.prototype._invalidateExtent=function(){this._extentDirty=!0};a.prototype._updateExtent=function(){if(this._extentDirty)if(0===this._children.length)this._extent=[[0,0,0],[0,0,0]];else{var a=this._children[0];this._extent=[b.create(a.getBBMin()),b.create(a.getBBMax())];
for(a=0;a<this._children.length;++a)for(var d=this._children[a],e=d.getBBMin(),d=d.getBBMax(),f=0;3>f;++f)this._extent[0][f]=Math.min(this._extent[0][f],e[f]),this._extent[1][f]=Math.max(this._extent[1][f],d[f]);this._extentDirty=!1}};a._idGen=new g;return a}()})},"esri/views/3d/webgl-engine/lib/Octree":function(){define(["require","exports","./gl-matrix","./Util"],function(p,h,d,a){function g(a,b,d){d=d||a;d[0]=a[0]+b;d[1]=a[1]+b;d[2]=a[2]+b;return d}var f=d.vec3d;p=function(){function c(a,c,b){this._maximumObjectsPerNode=
10;this._maximumDepth=20;this._autoResize=!0;this._outsiders=[];b&&(void 0!==b.maximumObjectsPerNode&&(this._maximumObjectsPerNode=b.maximumObjectsPerNode),void 0!==b.maximumDepth&&(this._maximumDepth=b.maximumDepth),void 0!==b.autoResize&&(this._autoResize=b.autoResize));isNaN(a[0])||isNaN(a[1])||isNaN(a[2])||isNaN(c)?this._root=new k(null,f.createFrom(0,0,0),.5):this._root=new k(null,a,c/2)}Object.defineProperty(c.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"outsiders",{get:function(){return this._outsiders.slice()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"autoResize",{get:function(){return this._autoResize},enumerable:!0,configurable:!0});c.prototype.add=function(a){a=this._objectOrObjectsArray(a);this._grow(a);for(var c=k.acquire(),b=0;b<a.length;b++){var d=a[b];c.init(this._root);0===d.getBSRadius()||isNaN(d.getBSRadius())||!this._autoResize&&!this._fitsInsideTree(this._boundingSphereFromObject(d,r))?this._outsiders.push(d):
this._add(d,c)}k.release(c)};c.prototype.remove=function(c,b){c=this._objectOrObjectsArray(c);for(var d=k.acquire(),e=!0,f=0;f<c.length;f++){var e=c[f],g=this._boundingSphereFromObject(b||e,r);0===g.radius||isNaN(g.radius)||!this._autoResize&&!this._fitsInsideTree(g)?e=null!=a.arrayRemove(this._outsiders,e):(d.init(this._root),e=this._remove(e,g,d))}k.release(d);this._shrink();return e};c.prototype.update=function(a,c){this.remove(a,c);this.add(a)};c.prototype.forEachAlongRay=function(c,b,d){this._forEachTest(function(d){g(d.center,
2*-d.halfSize,l);g(d.center,2*d.halfSize,t);return a.rayBoxTest(c,b,l,t)},d)};c.prototype.forEachInBoundingBox=function(a,c,b){this._forEachTest(function(b){for(var d=2*b.halfSize,e=0;3>e;e++)if(b.center[e]+d<a[e]||b.center[e]-d>c[e])return!1;return!0},b)};c.prototype.forEachNode=function(a){this._forEachNode(this._root,function(c){return a(c.node,c.center,2*c.halfSize)})};c.prototype._forEachTest=function(a,c){this._outsiders.forEach(c);this._forEachNode(this._root,function(b){return a(b)?(b=b.node,
b.terminals.forEach(c),null!==b.residents&&b.residents.forEach(c),!0):!1})};c.prototype._forEachNode=function(a,c){a=k.acquire().init(a);for(var b=[a];0!==b.length;){a=b.pop();if(c(a)&&!a.isLeaf())for(var d=0;d<a.node.children.length;d++)a.node.children[d]&&b.push(k.acquire().init(a).advance(d));k.release(a)}};c.prototype._objectOrObjectsArray=function(a){Array.isArray(a)||(e[0]=a,a=e);return a};c.prototype._remove=function(c,b,d){u.length=0;d.advanceTo(b,function(a,c){u.push(a.node,c)})?(c=null!=
a.arrayRemove(d.node.terminals,c),d=0===d.node.terminals.length):(c=null!=a.arrayRemove(d.node.residents,c),d=0===d.node.residents.length);if(d)for(d=u.length-2;0<=d&&this._purge(u[d],u[d+1]);d-=2);return c};c.prototype._nodeIsEmpty=function(a){if(0!==a.terminals.length)return!1;if(null!==a.residents)return 0===a.residents.length;for(var c=0;c<a.children.length;c++)if(a.children[c])return!1;return!0};c.prototype._purge=function(a,c){0<=c&&(a.children[c]=null);return this._nodeIsEmpty(a)?(null===a.residents&&
(a.residents=[]),!0):!1};c.prototype._add=function(a,c){c.advanceTo(this._boundingSphereFromObject(a,r))?c.node.terminals.push(a):(c.node.residents.push(a),c.node.residents.length>this._maximumObjectsPerNode&&c.depth<this._maximumDepth&&this._split(c))};c.prototype._split=function(a){var c=a.node.residents;a.node.residents=null;for(var b=0;b<c.length;b++){var d=k.acquire().init(a);this._add(c[b],d);k.release(d)}};c.prototype._grow=function(a){if(0!==a.length&&this._autoResize&&(a=this._boundingSphereFromObjects(a,
this._boundingSphereFromObject,v),!isNaN(a.radius)&&0!==a.radius&&!this._fitsInsideTree(a)))if(this._nodeIsEmpty(this._root.node))f.set(a.center,this._root.center),this._root.halfSize=1.25*a.radius;else{var c=k.acquire();this._rootBoundsForRootAsSubNode(a,c);this._placingRootViolatesMaxDepth(c)?this._rebuildTree(a,c):this._growRootAsSubNode(c);k.release(c)}};c.prototype._rebuildTree=function(a,c){var b=this;f.set(c.center,q.center);q.radius=c.halfSize;a=this._boundingSphereFromObjects([a,q],function(a){return a},
n);c=k.acquire().init(this._root);this._root.initFrom(null,a.center,1.25*a.radius);this._forEachNode(c,function(a){b.add(a.node.terminals);null!==a.node.residents&&b.add(a.node.residents);return!0});k.release(c)};c.prototype._placingRootViolatesMaxDepth=function(a){var c=0;this._forEachNode(this._root,function(a){c=Math.max(c,a.depth);return!0});return c+Math.log(a.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth};c.prototype._rootBoundsForRootAsSubNode=function(a,c){var d=a.radius,e=a.center;
a=-Infinity;for(var f=this._root.center,g=this._root.halfSize,h=0;3>h;h++){var k=Math.max(0,Math.ceil((f[h]-g-(e[h]-d))/(2*g))),l=Math.max(0,Math.ceil((e[h]+d-(f[h]+g))/(2*g)))+1;a=Math.max(a,Math.pow(2,Math.ceil(Math.log(k+l)*Math.LOG2E)));w[h].min=k;w[h].max=l}for(h=0;3>h;h++)k=w[h].min,l=w[h].max,d=(a-(k+l))/2,k+=Math.ceil(d),l+=Math.floor(d),b[h]=f[h]-g-k*g*2+(l+k)*g;return c.initFrom(null,b,a*g,0)};c.prototype._growRootAsSubNode=function(a){var c=this._root.node;f.set(this._root.center,v.center);
v.radius=this._root.halfSize;this._root.init(a);a.advanceTo(v,null,!0);a.node.children=c.children;a.node.residents=c.residents;a.node.terminals=c.terminals};c.prototype._shrink=function(){if(this._autoResize)for(;;){var a=this._findShrinkIndex();if(-1===a)break;this._root.advance(a);this._root.depth=0}};c.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var a=null,c=this._root.node.children,b=0,d=0;d<c.length&&null==a;)b=d++,a=c[b];for(;d<
c.length;)if(c[d++])return-1;return b};c.prototype._fitsInsideTree=function(a){var c=this._root.center,b=this._root.halfSize,d=a.center;return a.radius<=b&&d[0]>=c[0]-b&&d[0]<=c[0]+b&&d[1]>=c[1]-b&&d[1]<=c[1]+b&&d[2]>=c[2]-b&&d[2]<=c[2]+b};c.prototype._boundingSphereFromObject=function(a,c){f.set(a.getCenter(),c.center);c.radius=a.getBSRadius();return c};c.prototype._boundingSphereFromObjects=function(a,c,b){if(1===a.length){var d=c(a[0],v);f.set(d.center,b.center);b.radius=d.radius}else{l[0]=Infinity;
l[1]=Infinity;l[2]=Infinity;t[0]=-Infinity;t[1]=-Infinity;t[2]=-Infinity;for(var e=0;e<a.length;e++){var d=c(a[e],v),g=l,h=d.center,k=d.radius;g[0]=Math.min(g[0],h[0]-k);g[1]=Math.min(g[1],h[1]-k);g[2]=Math.min(g[2],h[2]-k);g=t;h=d.center;d=d.radius;g[0]=Math.max(g[0],h[0]+d);g[1]=Math.max(g[1],h[1]+d);g[2]=Math.max(g[2],h[2]+d)}f.scale(f.add(l,t,b.center),.5);b.radius=Math.max(t[0]-l[0],t[1]-l[1],t[2]-l[2])/2}return b};return c}();var k=function(){function a(a,c,b,d){void 0===b&&(b=0);void 0===d&&
(d=0);this.center=f.create();this.initFrom(a,c,b,0)}a.prototype.init=function(a){return this.initFrom(a.node,a.center,a.halfSize,a.depth)};a.prototype.initFrom=function(c,b,d,e){void 0===c&&(c=null);void 0===d&&(d=this.halfSize);void 0===e&&(e=this.depth);this.node=c||a.createEmptyNode();b&&f.set(b,this.center);this.halfSize=d;this.depth=e;return this};a.prototype.advance=function(c){var b=this.node.children[c];b||(b=a.createEmptyNode(),this.node.children[c]=b);this.node=b;this.halfSize/=2;this.depth++;
c=m[c];this.center[0]+=c[0]*this.halfSize;this.center[1]+=c[1]*this.halfSize;this.center[2]+=c[2]*this.halfSize;return this};a.prototype.advanceTo=function(a,c,b){for(void 0===b&&(b=!1);;){if(this.isTerminalFor(a))return c&&c(this,-1),!0;if(this.isLeaf()&&!b)return c&&c(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var d=this._childIndex(a);c&&c(this,d);this.advance(d)}};a.prototype.isLeaf=function(){return null!=this.node.residents};a.prototype.isTerminalFor=function(a){return a.radius>this.halfSize/
2};a.prototype._childIndex=function(a){a=a.center;for(var c=this.center,b=0,d=0;3>d;d++)c[d]<a[d]&&(b|=1<<d);return b};a.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:[],residents:[]}};a.acquire=function(){if(0===this._pool.length)return new a;var c=this._pool[this._pool.length-1];this._pool.length--;return c};a.release=function(a){this._pool.push(a)};a._pool=[];return a}(),m=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,
1]],e=[null],b=f.create(),l=f.create(),t=f.create(),u=[],r={center:f.create(),radius:0},v={center:f.create(),radius:0},q={center:f.create(),radius:0},n={center:f.create(),radius:0},w=[{min:0,max:0},{min:0,max:0},{min:0,max:0}];return p})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define(["require","exports","../../../../core/throttle","../../support/aaBoundingRect"],function(p,h,d,a){return function(){function g(){this.dirtyExtent=a.create(a.NEGATIVE_INFINITY);this.numPendingSpatialIndexQueries=
0;this.elevationDirtyGraphicsQueue=[];this.elevationDirtyGraphicsSet={};this.elevationUpdateEventHandle=null;this.eventHandles=[];this.updateElevation=!1;this.graphicsCore=this.layerView=null;this.markDirtyThrottled=d.throttle(this.markDirty,100,this)}g.prototype.initialize=function(a,d,g,e){var b=this;this.layerView=a;this.graphicsCore=g;this.elevationProvider=e;this.getGraphicsInExtent=d;this.elevationUpdateEventHandle=e.on("elevation-change",function(a){return b.elevationUpdateHandler(a)});this.eventHandles.push(this.layerView.watch("suspended",
function(){return b.suspendedChange()}))};g.prototype.destroy=function(){this.elevationDirtyGraphicsSet=this.elevationDirtyGraphicsQueue=null;this.elevationUpdateEventHandle&&(this.elevationUpdateEventHandle.remove(),this.elevationUpdateEventHandle=null);this.eventHandles.forEach(function(a){return a.remove()});this.eventHandles=null;this.markDirtyThrottled.remove();this.getGraphicsInExtent=this.graphicsCore=this.layerView=null};g.prototype.clear=function(){this.elevationDirtyGraphicsSet={};this.elevationDirtyGraphicsQueue=
[]};g.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&this.markAllGraphicsElevationDirty()};g.prototype.isUpdating=function(){return 0<this.elevationDirtyGraphicsQueue.length||this.markDirtyThrottled.hasPendingUpdates()||0<this.numPendingSpatialIndexQueries};g.prototype.numNodesUpdating=function(){return this.elevationDirtyGraphicsQueue.length};g.prototype.needsIdleUpdate=function(){return this.elevationProvider&&
0<this.elevationDirtyGraphicsQueue.length};g.prototype.idleUpdate=function(a){if(!a.done()){var d=this.layerView.view,f=this.elevationDirtyGraphicsQueue.length;if(0<f){for(var e=this.graphicsCore.stageLayer.id,b=this.graphicsCore.labelStageLayer?this.graphicsCore.labelStageLayer.id:null,g=0,h=0,h=0;h<f;h++){var u=this.elevationDirtyGraphicsQueue[h],r=this.graphicsCore.graphics[u];r&&r.alignWithElevation(this.elevationProvider,d.renderCoordsHelper);delete this.elevationDirtyGraphicsSet[u];g++;if(20<=
g){d._stage.processDirtyLayer(e);null!=b&&d._stage.processDirtyLayer(b);if(a.done())break;g=0}}d._stage.processDirtyLayer(e);null!=b&&d._stage.processDirtyLayer(b);this.elevationDirtyGraphicsQueue.splice(0,h+1);d.deconflictor.setDirty();this.layerView._evaluateUpdatingState()}}};g.prototype.markAllGraphicsElevationDirty=function(){for(var a in this.graphicsCore.graphics)this.markGraphicElevationDirty(this.graphicsCore.graphics[a].graphic.uid);this.layerView._evaluateUpdatingState()};g.prototype.markGraphicElevationDirty=
function(a){this.elevationDirtyGraphicsSet[a]||(this.elevationDirtyGraphicsSet[a]=!0,this.elevationDirtyGraphicsQueue.push(a))};g.prototype.elevationUpdateHandler=function(d){var f=d.extent;this.layerView.suspended?this.updateElevation||(d=this.graphicsCore.computedExtent)&&f[2]>d.xmin&&f[0]<d.xmax&&f[3]>d.ymin&&f[1]<d.ymax&&(this.updateElevation=!0):(a.expand(this.dirtyExtent,f),this.spatialReference=d.spatialReference,this.markDirtyThrottled(),this.layerView._evaluateUpdatingState())};g.prototype.markDirty=
function(){var d=this,g=this.dirtyExtent;-Infinity===g[0]?this.markAllGraphicsElevationDirty():(this.numPendingSpatialIndexQueries++,this.getGraphicsInExtent(g,this.spatialReference,function(a,e){d.numPendingSpatialIndexQueries--;for(var b=0;b<e;b++){var f=a[b],g=d.graphicsCore.graphics[f];g&&g.needsElevationUpdates()&&d.markGraphicElevationDirty(f)}d.layerView._evaluateUpdatingState()}),this.layerView._evaluateUpdatingState());a.set(this.dirtyExtent,a.NEGATIVE_INFINITY)};return g}()})},"esri/core/throttle":function(){define(["require",
"exports"],function(p,h){function d(a,d,f,h){var g=null,e=1E3;"number"===typeof d?(e=d,h=f):(g=d,e=f);var b=0,k,t=function(){b=0;a.apply(h,k)};d=function(){for(var a=[],d=0;d<arguments.length;d++)a[d]=arguments[d];g&&g.apply(h,a);k=a;e?b||(b=setTimeout(t,e)):t()};d.remove=function(){b&&(clearTimeout(b),b=0)};d.forceUpdate=function(){b&&(clearTimeout(b),t())};d.hasPendingUpdates=function(){return!!b};return d}Object.defineProperty(h,"__esModule",{value:!0});h.throttle=d;h.default=d})},"esri/views/3d/layers/graphics/Graphics3DSpatialIndex":function(){define("require exports dojo/Deferred ../../../../geometry/SpatialReference ../../../../geometry/support/webMercatorUtils ../../../../processors/SpatialIndex".split(" "),
function(p,h,d,a,g,f){return function(){function h(){var a=this;this.spatialIndex=new f;this.spatialIndexNumPendingQueries=this.spatialIndexNumGraphics=0;this.graphicsCore=this.viewSR=this.layer=this.layerView=null;this._readyDfd=new d;var e=function(a){return a.workerClient&&a.workerClient.worker};if(e(this.spatialIndex))this._readyDfd.resolve();else this.spatialIndex.on("start",function(){e(a.spatialIndex)&&a._readyDfd.resolve()})}h.prototype.initialize=function(a,d,b,f){this.layerView=a;this.layer=
d;this.viewSR=b;this.graphicsCore=f};h.prototype.destroy=function(){this.spatialIndex&&(this.spatialIndex.destroy(),this.spatialIndex=null);this.graphicsCore=this.layerView=this.viewSR=null};h.prototype.numNodesUpdating=function(){return 0};h.prototype.isUpdating=function(){return 0<this.spatialIndexNumPendingQueries};h.prototype.hasGraphics=function(){return 0<this.spatialIndexNumGraphics};h.prototype.intersects=function(a,d,b){var e=this;this.hasGraphics()?(this.spatialIndexNumPendingQueries++,
this.spatialIndex.intersects(a,void 0,void 0,!0).then(function(a){e.spatialIndexNumPendingQueries--;b(a.results,a.results.length);e.layerView._evaluateUpdatingState()})):b([],0)};h.prototype.shouldAddToSpatialIndex=function(a,d,b){return b||d.needsElevationUpdates()};h.prototype.addGraphicsToSpatialIndex=function(a){if(this.layerView.loadedGraphics)for(var d=this.layerView.loadedGraphics.toArray(),b=d.length,f=0;f<b;f++){var g=d[f],h=this.graphicsCore.getGraphics3DGraphicById(g.uid);h&&!h.addedToSpatialIndex&&
this.shouldAddToSpatialIndex(g,h,a)&&this.addGraphicToSpatialIndex(g,h)}};h.prototype.serializeGeometry=function(a){return"mesh"===a.type?a.extent.toJSON():a.toJSON()};h.prototype.addGraphicToSpatialIndex=function(d,e){var b=d.geometry.spatialReference,f=this.viewSR,h={id:d.uid,geometry:null};if(b.equals(f))h.geometry=this.serializeGeometry(d.geometry);else{var k=void 0;if(b.wkid===a.WGS84.wkid&&f.isWebMercator)k=g.geographicToWebMercator(d.geometry);else if(b.isWebMercator&&f.wkid===a.WGS84.wkid)k=
g.webMercatorToGeographic(d.geometry);else return console.warn("Cannot convert graphic geometry to map spatial reference, elevation and scale updates are disabled"),!1;h.geometry=this.serializeGeometry(k)}this.spatialIndexNumGraphics++;this.spatialIndex.runProcess([h],this.layer.id);return e.addedToSpatialIndex=!0};h.prototype.whenLoaded=function(){return this._readyDfd.promise};return h}()})},"esri/processors/SpatialIndex":function(){define(["../core/declare","dojo/Deferred","dojo/_base/lang","./Processor",
"../workers/WorkerClient"],function(p,h,d,a,g){return p([a],{declaredClass:"esri.processors.SpatialIndex",index:null,indexType:"rtree",autostart:!1,constructor:function(a){a=a||{};var f=!1!==a.autostart;d.mixin(this,a);this.workerCallback=["./scripts/helpers","./scripts/indexInterface","./indexWorker"];if(!this.fetchWithWorker){var h=this;this.workerClient=new g("./mutableWorker",function(a){this.workerClient=a;this.workerCallback.push("./libs/"+this.indexType);this.workerClient.importScripts(this.workerCallback).then(function(){h._attachedSystem=
!0;f&&h.start()})}.bind(this))}this._featCache={}},destroy:function(){this.workerClient&&this.workerClient.terminate()},addLayer:function(a,d){if(a.graphics&&a.graphics.length||d||"feature"===a.type){var f=this.workerClient;if(!this._attachedSystem&&f.worker){var e=this;this.inherited(arguments,[a,!0]);f.importScripts("./libs/"+this.indexType).then(function(){e.runProcess(a.graphics,a.id);e._attachedSystem=!0})}else this.inherited(arguments,[a])}},unsetMap:function(){this.stop();this.workerClient.terminate();
this.fetchWithWorker||(this.workerClient=new g(this.workerCallback,function(){}));this.inherited(arguments);this.start()},removeLayer:function(a){this.inherited(arguments)},runProcess:function(a,d){if(a&&a.length){var f=this,e=this.workerClient,b=a[0]._graphicsLayer;d||0===d||(d=b?b.id:"rawFeatures_"+Object.keys(this._featCache).length);this._featCache[d]||(this._featCache[d]={});for(var g,h,k=[],r=a.length,v=b&&b.objectIdField;r--;)h=a[r],g=h.attributes&&v?h.attributes[v]:h.id,null!=g&&this._featCache[d][g]||
(this._featCache[d][g]=1,h.declaredClass?k.push({id:g,geometry:h.geometry.toJSON(!0),attributes:h.attributes}):k.push(h));0!==k.length&&(e.postMessage({insert:k,system:this.indexType,options:this.indexOptions,idField:b&&b.objectIdField,layerId:d}).then(function(a){b&&b.emit("process-end",{processor:f,results:{insert:a.insert}})}),b&&b.emit("process-start",{processor:this}))}},_sendFeaturesFromLayer:function(a,d){d=d.graphic;var f=this.workerClient,e=this,b=d.attributes[a.objectIdField];this._featCache[a.id]||
(this._featCache[a.id]={});this._featCache[a.id][b]||(this._featCache[a.id][b]=1,f.postMessage({insert:[{attributes:d.attributes,geometry:d.geometry.toJSON(!0)}],system:this.indexType,options:this.indexOptions,idField:a.objectIdField,layerId:a.id}).then(function(b){a.emit("process-end",{processor:e,results:{insert:b.insert}})}),a.emit("process-start",{processor:e}))},_notifyProcessStart:function(a,d){},_sendFeaturesFromTask:function(a,d){d=d.featureSet.features;var f=[],e=this.workerClient,b=this,
g=d.length,h,k;for(this._featCache[a.id]||(this._featCache[a.id]={});g--;)k=d[g],h=k.attributes[a.objectIdField],this._featCache[a.id][h]||(this._featCache[a.id][h]=1,f.push(k));e.postMessage({insert:f,system:this.indexType,options:this.indexOptions,idField:a.objectIdField,layerId:a.id}).then(function(d){a.emit("process-end",{processor:b,results:{insert:d.insert}})});a.emit("process-start",{processor:b})},get:function(){},intersects:function(a,d,g,e){return"rtree"!=this.indexType?(console.error("Index.intersects only works with rtree indexes"),
a=new h,a.reject({message:"Index.intersects only works with rtree indexes"}),a.promise):this.workerClient.postMessage({search:a,layerId:d,returnNode:g,onlyIds:e})},within:function(a,d,g){if("rtree"!=this.indexType)return console.error("Index.within only works with rtree indexes"),a=new h,a.reject({message:"Index.within only works with rtree indexes"}),a.promise},nearest:function(a){return"kdtree"!=this.indexType?(console.error("Index.nearest only works with kdtree indexes"),a=new h,a.reject({message:"Index.nearest only works with kdtree indexes"}),
a.promise):this.workerClient.postMessage({search:a})}})})},"esri/processors/Processor":function(){define("../core/sniff ../core/declare dojo/_base/lang dojo/_base/array dojo/Evented ../workers/RequestClient ../layers/GraphicsLayer".split(" "),function(p,h,d,a,g,f,k){return h([g],{declaredClass:"esri.processors.Processor",layers:null,results:null,passFeatures:!0,drawFeatures:!0,requireWorkerSupport:!0,fetchWithWorker:!1,workerCallback:null,workerClient:null,_started:null,_handlers:null,constructor:function(a){a=
a||{};d.mixin(this,a);p("esri-workers")||!1===this.requireWorkerSupport&&!1===a.requireWorkerSupport?(this._handlers={},this._notifyProcessStart=d.hitch(this,this._notifyProcessStart),this._sendFeaturesFromTask=d.hitch(this,this._sendFeaturesFromTask),this._sendFeaturesFromLayer=d.hitch(this,this._sendFeaturesFromLayer),!1!==a.autostart&&this.start()):(console.log("Browser doesn't support workers \x26 worker support is required for this processor"),this.addLayer=this.setMap=this.start=this.runProcess=
function(){},this._disabled=!0)},addLayer:function(a,e){var b=a._task,g=this._handlers[a.id]=[],h="complete";!1===this.drawFeatures&&(a._params.drawMode=!1);this.fetchWithWorker?(this.workerClient||(this.workerClient=f.getClient(this.workerCallback)),b.requestOptions={workerOptions:{worker:this.workerClient}},this.passFeatures&&g.push(b.on(h,d.partial(this._notifyProcessStart,a)))):this.passFeatures?(h=this.drawFeatures?"graphic-draw":"graphic-add",g.push(a.on(h,d.partial(this._sendFeaturesFromLayer,
a)))):g.push(b.on(h,d.partial(this._sendFeaturesFromTask,a)));!0!==e&&a.graphics&&this.runProcess(a.graphics,a.id)},removeLayer:function(d){a.forEach(this._handlers[d.id],function(a){a.remove()});delete this._handlers[d.id]},setMap:function(d){if(this.map)if(d!=this.map)this.unsetMap();else return;var e=this;a.forEach(this.layers,e.removeLayer);a.forEach(d.graphicsLayerIds,function(a){e.addLayer(d.findLayerById(a))});this._handlers.map=[d.on("layer-add",function(a){a=a.layer;a.isInstanceOf(k)&&e.addLayer(a)}),
d.on("layer-remove",function(a){a=a.layer;a.isInstanceOf(k)&&e.removeLayer(a)})];this.map=d},unsetMap:function(){this.map&&(a.forEach(this._handlers.map,function(a){a.remove()}),delete this._handlers.map,a.forEach(this.layers,this.removeLayer),this.map=null)},start:function(){this.map?this.setMap(this.map):this.layers&&(d.isArray(this.layers)||(this.layers=[this.layers]),a.forEach(this.layers,this.addLayer));this._started=!0;this.emit("start",{processor:this})},stop:function(){this._started=!1;for(var a in this._handlers)this._handlers.hasOwnProperty(a)&&
(this._handlers[a].remove(),delete this._handlers[a]);this.emit("stop",{processor:this})},runProcess:function(a,d){},_sendFeaturesFromTask:function(){},_sendFeaturesFromLayer:function(){},_notifyProcessStart:function(){}})})},"esri/workers/RequestClient":function(){define(["../core/declare","dojo/_base/xhr","../config","./WorkerClient"],function(p,h,d,a){function g(a,d){var b=new f;b.addWorkerCallback(a,d);k.unshift({id:d?a+"::"+d:a,client:b});k.length>m&&k.pop().client.terminate();return b}var f=
p([a],{declaredClass:"esri.workers.RequestClient",constructor:function(){this.setWorker(["./mutableWorker","./requestWorker"],function(){})},get:function(a){return this._send("GET",a)},post:function(a){return this._send("POST",a)},_send:function(a,d){d=h._ioSetArgs(d);d.xhr=null;var b=d.ioArgs,e=b.url;delete b.url;delete b.args;this.postMessage({method:a,url:e,options:b}).then(this._getSuccessHandler(d),this._getErrorHandler(d),this._getProgressHandler(d));return d},_addHeaderFunctions:function(a){a.getResponseHeader=
function(b){var d,e=a.headers;Object.keys(e).forEach(function(a){if(a.toLowerCase()==b.toLowerCase())return d=e[a],!1});return d};a.getAllResponseHeaders=function(){var b=[],d=a.headers;Object.keys(d).forEach(function(a){b.push(a+": "+d[a])});return b=b.join("\n")};return a},_getSuccessHandler:function(a){var b=this,d=a.ioArgs;return function(e){a.xhr=b._addHeaderFunctions(e);e=a.xhr.getResponseHeader("content-type");("xml"==d.handleAs||-1<e.indexOf("xml"))&&"string"==typeof a.xhr.response&&(a.xhr.response=
(new DOMParser).parseFromString(a.xhr.response,"text/xml"));a.resolve(a.xhr.response,a.xhr)}},_getErrorHandler:function(a){return function(b){a.reject(b)}},_getProgressHandler:function(a){return function(b){a.progress(b)}}}),k=[],m=d.request.maxWorkers,e=new f;f.getClient=function(a,d){if(a){var b;k.some(function(e){e.id==(d?a+"::"+d:a)&&(b=e.client);return!0});return b||g(a,d)}return e};f.setLimit=function(a){m=d.request.maxWorkers=a};return f})},"esri/workers/WorkerClient":function(){define("dojo/Evented ../core/declare dojo/Deferred dojo/_base/lang dojo/request ../core/sniff ../core/urlUtils require".split(" "),
function(p,h,d,a,g,f,k,m){var e=window.Blob||window.webkitBlob||window.mozBlob,b=window.URL||window.webkitURL||window.mozURL;return h([p],{declaredClass:"esri.workers.WorkerClient",worker:null,_queue:null,constructor:function(b,d){this._isIE=f("ie");this._queue={};this._acceptMessage=a.hitch(this,this._acceptMessage);this._errorMessage=a.hitch(this,this._errorMessage);b&&this.setWorker(b,function(a){this.worker=a;d(this)}.bind(this))},setWorker:function(a,d){if(a instanceof Array){var f=a;a=f.shift()}var g=
this._getUrl(a),g=k.normalize(g);a=!k.hasSameOrigin(g,location.href);var h;if(!1===g)return console.log("Can not resolve worker path"),!1;this.worker&&(h=this.worker,h.removeEventListener("message",this._acceptMessage,!1),h.removeEventListener("error",this._errorMessage,!1),h.terminate(),h=null);if(a){a=this._getUrl("./mutableWorker",!0);try{this._getRemoteText(a,function(a){a=b.createObjectURL(new e([a],{type:"text/javascript"}));d(this._createWorker(a,g))}.bind(this))}catch(q){try{a=k.getProxyUrl(a).path+
"?"+encodeURI(a),this._useProxy=!0,d(this._createWorker(a,f))}catch(n){return console.log("Can not create worker"),!1}}}else d(this._createWorker(g,f))},_createWorker:function(a,b){a=new Worker(a);a.addEventListener("message",this._acceptMessage,!1);a.addEventListener("error",this._errorMessage,!1);this.worker=a;b&&this.importScripts(b);return a},postMessage:function(a,b){if(a instanceof Array||"object"!=typeof a)a={data:a};var e=Math.floor(64E9*Math.random()).toString(36);a.msgId=e;e=this._queue[e]=
new d;this.worker?(b?this.worker.postMessage(a,b):this.worker.postMessage(a),this.emit("start-message",{target:this,message:a})):e.reject({message:"No worker was set."});return e.promise},terminate:function(){var a=Object.keys(this._queue);this.worker&&this.worker.terminate();for(var b=a.length-1;0<=b;b--)this._queue[a[b]].cancel("terminated"),delete this._queue[a[b]]},addWorkerCallback:function(b,e){var f=this._getUrl(b,!0);return!1===f?(e=new d,e.reject({message:"Could not load text from "+b}),
e.promise):this.postMessage({action:"add-callback",url:f,cbName:e||"main"}).then(a.hitch(this,function(a){a.target=this;this.emit("callback-added",a)}))},importScripts:function(b){Array.isArray(b)||(b=[b]);b=b.map(function(a){a=this._getUrl(a,!0);this._useProxy&&!k.hasSameOrigin(a,location.href)&&(a=k.getProxyUrl(a).path+"?"+encodeURI(a));return a},this);return this.postMessage({action:"import-script",url:b}).then(a.hitch(this,function(a){a.target=this;this.emit("scripts-imported",a)}))},_acceptMessage:function(a){var b=
a.data,d=b.msgId;if(b.status&&"debug"==b.status)console[b.showAs||"debug"](b);else if(d&&d in this._queue){var e=this._queue[d];"progress"==b.status?e.progress(a.data):("error"==b.status?e.reject(a.data):e.resolve(a.data),delete this._queue[d])}this.emit("message",{message:a.data,event:a,target:this})},_errorMessage:function(a){this.onerror||this.onError?this.onerror?this.onerror(a):this.onError(a):console.log("Worker Error: "+a.message+"\nIn "+a.filename+" on "+a.lineno)},_getUrl:function(a,b){if(!a)return console.error("can not resolve empty path"),
!1;a.match(/\.js$/)||(a+=".js");a=m.toUrl(a);return b?k.makeAbsolute(a):a},_getRemoteText:function(a,b){(a=this._getUrl(a))&&g.get(a,{sync:!1,handleAs:"text",headers:{"X-Requested-With":"","Content-Type":"text/plain"}}).then(function(a){b(a)})},_startBlobWorker:function(){var a=this._xdSource;a||(a=this._getUrl("./mutableWorker"),a=new e(["if(!self._mutable){importScripts('"+a+"');}"],{type:"text/javascript"}),a=this._xdSource=b.createObjectURL(a));try{return new Worker(a)}catch(t){return console.log(t.message),
!1}}})})},"esri/layers/GraphicsLayer":function(){define("require ../core/Accessor ../core/Collection ../core/promiseUtils ./Layer ./mixins/ScaleRangeLayer ../Graphic dojo/_base/lang".split(" "),function(p,h,d,a,g,f,k,m){var e=h.createSubclass({properties:{layer:null,layerView:null,graphics:null}});return g.createSubclass([f],{declaredClass:"esri.layers.GraphicsLayer",getDefaults:function(a){return m.mixin(this.inherited(arguments),{graphics:[]})},destroy:function(){this.removeAll()},_gfxHdl:null,
properties:{elevationInfo:null,graphics:{type:d.ofType(k),set:function(a){var b=this._get("graphics");b||(a.forEach(function(a){a.layer=this},this),this._gfxHdl=a.on("change",function(a){var b,d,e;e=a.added;for(b=0;d=e[b];b++)d.layer=this;e=a.removed;for(b=0;d=e[b];b++)d.layer=null}.bind(this)),this._set("graphics",a),b=a);b.removeAll();b.addMany(a)}},screenSizePerspectiveEnabled:!0,type:{readOnly:!0,value:"graphics"}},add:function(a){this.graphics.add(a);return this},addMany:function(a){this.graphics.addMany(a);
return this},removeAll:function(){this.graphics.removeAll();return this},createGraphicsController:function(b){return a.resolve(new e({layer:this,layerView:b.layerView,graphics:this.graphics}))},remove:function(a){this.graphics.remove(a)},removeMany:function(a){this.graphics.removeMany(a)},importLayerViewModule:function(b){switch(b.type){case "2d":return a.create(function(a){p(["../views/2d/layers/GraphicsLayerView2D"],a)});case "3d":return a.create(function(a){p(["../views/3d/layers/FeatureLayerView3D"],
a)})}},graphicChanged:function(a){this.emit("graphic-update",a)}})})},"esri/views/layers/GraphicsView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Graphic ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators".split(" "),function(p,h,d,a,g,f,k,m){return function(e){function b(){var a=null!==e&&e.apply(this,arguments)||this;a.graphics=null;a.renderer=null;a.view=null;return a}d(b,e);a([m.property({type:k.ofType(g)})],
b.prototype,"graphics",void 0);a([m.property()],b.prototype,"renderer",void 0);a([m.property()],b.prototype,"view",void 0);return b=a([m.subclass("esri.views.layers.GraphicsView")],b)}(m.declared(f))})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../../../core/Logger ../../../../core/watchUtils ./deconflictorDebug ../../lib/glMatrix ../../support/aaBoundingRect ../../support/PreallocArray ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/Util ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r){function v(a){return!!a&&"selection"===a.type}var q=m.vec2d;p=m.vec4d;var n=t.VertexAttrConstants,w=g.getLogger("esri.views.3d.graphics.Deconflictor"),c=p.create(),x=p.create(),z=p.create(),A=p.create(),y=q.create(),B=e.create(),E=e.create(),C=new Set,G=t.lerp,J=new b(100),F=new b(100),I=function(){function a(a,c){this.creator=a;this.disposer=c;this.list=[];this.currentIndex=0}a.prototype.alloc=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];
this.currentIndex>=this.list.length&&this.list.push(new this.creator(a));return this.list[this.currentIndex++]};a.prototype.freeAll=function(){for(var a=this.currentIndex,c=this.disposer,b=this.list;0<=--a;)c(b[a]);this.currentIndex=0};return a}(),H=function(){function a(){this.graphics3DGraphic=null;this.positions=[q.create(),q.create(),q.create(),q.create()];this.posView=this.yMax=this.yMin=this.xMax=this.xMin=0;this.graphicsOwner=null;this.graphicId=this.id=0}a.release=function(a){a.graphics3DGraphic=
null;a.graphicsOwner=null};return a}();g=function(){function d(c){var b=this;this.graphicsOwners=[];this.deconflictTimeoutId=0;this.handles=new a;this.graphicInfoPool=new I(H,H.release);this.nextGraphicInfoId=0;this.accBinsNumX=15;this.accBinsNumY=20;this.accBinsSizeY=this.accBinsSizeX=0;this.accBins=null;this.accNumTests=0;this.iconMarginFactor=-.1;this.view=c;this.handles.add([c.watch("state.camera",function(){return b.scheduleRun()}),f.whenNot(c,"ready",function(){return b.clearDeconflictTimeout()})])}
d.prototype.destroy=function(){this.handles.destroy();this.handles=null;this.clearDeconflictTimeout();this.graphicInfoPool.freeAll();this.view=this.graphicInfoPool=null};d.prototype.clearDeconflictTimeout=function(){this.deconflictTimeoutId&&(clearTimeout(this.deconflictTimeoutId),this.deconflictTimeoutId=0)};d.prototype.addGraphicsOwner=function(a){var c=this;this.graphicsOwners.push(a);this.setDirty();a.layer&&"function"===typeof a.layer.watch&&a.layer.watch("featureReduction",function(b,d){v(b)?
c.setDirty():v(d)&&(c._removeIconVisibilityFlags(a),c.setDirty())})};d.prototype.removeGraphicsOwner=function(a){a=this.graphicsOwners.indexOf(a);0<=a&&this.graphicsOwners.splice(a,1);this.setDirty()};d.prototype.setDirty=function(){this.scheduleRun(10)};d.prototype.initializeLabelVisibility=function(a){a.setVisibilityFlag(2,!1,1)};d.prototype.doesIntersectExistingPoly=function(a){var c=a.graphicId,b=a.positions;C.clear();for(var d=Math.floor(a.xMin/this.accBinsSizeX);d<=Math.floor(a.xMax/this.accBinsSizeX);d++)if(!(0>
d||d>=this.accBinsNumX))for(var e=Math.floor(a.yMin/this.accBinsSizeY);e<=Math.floor(a.yMax/this.accBinsSizeY);e++)if(!(0>e||e>=this.accBinsNumY)){var f=this.accBins[d][e],g=0;a:for(;g<f.length;g++){var h=f.data[g];if(h.graphicId!==c&&!C.has(h.id)){C.add(h.id);h=h.positions;this.accNumTests++;for(var k=0;2>k;k++){var l=0===k?b:h,n=0===k?h:b,m=0;b:for(;4>m;m++){var r=l[m],t=l[(m+1)%4],v=l[(m+2)%4];y[0]=t[0]-r[0];y[1]=t[1]-r[1];t=q.normalize(y);p=[-t[1],t[0]];t[0]=p[0];t[1]=p[1];r=t[0]*r[0]+t[1]*r[1];
v=t[0]*v[0]+t[1]*v[1]<r;for(p=0;4>p;p++){var u=n[p],u=t[0]*u[0]+t[1]*u[1];if(v&&u<r||!v&&u>r)continue b}continue a}}return!0}}}return!1;var p};d.prototype.initBins=function(a,c){if(null==this.accBins){this.accBins=[];for(var d=0;d<this.accBinsNumX;d++){this.accBins.push([]);for(var e=this.accBins[this.accBins.length-1],f=0;f<this.accBinsNumY;f++)e.push(new b(10))}}for(d=0;d<this.accBinsNumX;d++)for(f=0;f<this.accBinsNumY;f++)this.accBins[d][f].clear();this.accBinsSizeX=a/this.accBinsNumX;this.accBinsSizeY=
c/this.accBinsNumY;this.accNumTests=0};d.prototype.addToBins=function(a){for(var c=Math.floor(a.xMin/this.accBinsSizeX);c<=Math.floor(a.xMax/this.accBinsSizeX);c++)if(!(0>c||c>=this.accBinsNumX))for(var b=Math.floor(a.yMin/this.accBinsSizeY);b<=Math.floor(a.yMax/this.accBinsSizeY);b++)0>b||b>=this.accBinsNumY||this.accBins[c][b].push(a)};d.prototype.scheduleRun=function(a){var c=this;void 0===a&&(a=200);0===this.deconflictTimeoutId&&(this.deconflictTimeoutId=setTimeout(function(){return c.run()},
a))};d.prototype.run=function(){var a=this.view;this.clearDeconflictTimeout();if(a.ready){var c=a.state.camera;this.graphicInfoPool.freeAll();this.nextGraphicInfoId=0;var b=c.fullWidth,d=c.fullHeight;k.prepare(a);J.clear();F.clear();for(var a=!1,e=0;e<this.graphicsOwners.length;e++){var f=this.graphicsOwners[e];if(null!=f.getGraphics3DGraphics&&null!=f.getGraphics3DGraphicsKeys){var g=null!=f.labelsEnabled&&f.labelsEnabled(),h=v(f.layer?f.layer.featureReduction:null);if(g||h){a||(this.initBins(b,
d),a=!0);for(var l=f.getGraphics3DGraphics(),n=f.getGraphics3DGraphicsKeys(),m=0;m<n.length;m++){var r=l[n[m]];r.areVisibilityFlagsSet(void 0,2)&&(h&&this._collectGraphics(r,!1,f,c,J,this.iconMarginFactor),g&&this._collectGraphics(r,!0,f,c,F))}}}}J.sort(function(a,c){return c.posView-a.posView});F.sort(function(a,c){return c.posView-a.posView});this._deconflictVisibleObjects(J,!1);F.length&&this._deconflictVisibleObjects(F,!0);k.drawAccelerationStruct(this,J);k.drawAccelerationStruct(this,F)}else this.setDirty()};
d.prototype._collectGraphics=function(a,b,d,f,g,h){void 0===h&&(h=0);var k=b?a._labelGraphics:a._graphics,m=b?1:0;if(k.length){b=e.set(B,e.NEGATIVE_INFINITY);for(var q,t,v,p=0;p<k.length;p++){var y=k[p];if(y&&!y.isDraped()){var C=y.stageObject,F=C?C.getNumGeometryRecords():0;if(!(1>F)){var J=C.getGeometryRecord(0),I=J.materials[0];if(I instanceof u)if(1<F)w.warn("Graphic objects with more than 1 geometry record are not supported");else{F=J.geometry.getData().getVertexAttr();if(!t){t=C.getCenter();
v=J.origin.vec3;t=r.transformToWorld(t,v,c);t=r.transformToView(t,v,f.viewMatrix,x);I.applyVerticalOffsetTransformation(t,F[n.NORMAL].data,C.objectTransformation,f,K);C=F[n.AUXPOS1].data;F="screen"!==I.getParams().centerOffsetUnits;v=r.transformToProjection(t,f.projectionMatrix,F?C:[0,0,0],z);v=r.transformToNDC(v,A);F||(v[0]+=C[0]/f.fullWidth*2,v[1]+=C[1]/f.fullHeight*2);if(-1>v[0]||-1>v[1]||-1>v[2]||1<=v[0]||1<=v[1])break;q=t[2];a.areVisibilityFlagsSet(2,void 0,m)&&(q*=.7)}y=y.getScreenSize(L);l.applyPrecomputedScaleFactorVec2(y,
K.factor,y);I=e.offset(I.calculateRelativeScreenBounds(y,K.scaleAlignment,E),G(0,f.fullWidth,.5+.5*v[0]),G(0,f.fullHeight,.5+.5*v[1]));0!==h&&(y=h*Math.min(e.width(I),e.height(I)),I[0]-=y,I[1]-=y,I[2]+=y,I[3]+=y);e.expand(b,I)}}}}null!=q&&(f=this.graphicInfoPool.alloc(),f.id=this.nextGraphicInfoId++,f.graphicId=a.graphic.uid,f.xMin=b[0],f.yMin=b[1],f.xMax=b[2],f.yMax=b[3],f.positions[0][0]=b[0],f.positions[0][1]=b[1],f.positions[1][0]=b[0],f.positions[1][1]=b[3],f.positions[2][0]=b[2],f.positions[2][1]=
b[3],f.positions[3][0]=b[2],f.positions[3][1]=b[1],f.graphics3DGraphic=a,f.posView=q,f.graphicsOwner=d,g.push(f))}};d.prototype._deconflictVisibleObjects=function(a,c){for(var b=c?1:0,d=0;d<a.length;d++){var e=a.data[d],f=e.graphics3DGraphic,g=!(c&&!1===f.areVisibilityFlagsSet(2,void 0))&&!this.doesIntersectExistingPoly(e);g&&this.addToBins(e);f.setVisibilityFlag(2,g,b);k.drawPoly(e.positions,g?"green":"red")}};d.prototype._removeIconVisibilityFlags=function(a){if(null!=a.getGraphics3DGraphics&&null!=
a.getGraphics3DGraphicsKeys){var c=a.getGraphics3DGraphics(),b=0;for(a=a.getGraphics3DGraphicsKeys();b<a.length;b++)c[a[b]].setVisibilityFlag(2,void 0)}};return d}();var K={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},L=q.create();return g})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../lib/glMatrix","../../support/debugFlags"],function(p,h,d,a,g){function f(a,
d){if(m){var e=b.height,f=l;f.beginPath();f.lineWidth=1;f.strokeStyle=d;f.moveTo(a[0][0],e-a[0][1]);for(d=1;4>d;d++)f.lineTo(a[d][0],e-a[d][1]),f.stroke();f.lineTo(a[0][0],e-a[0][1]);f.stroke();f.closePath()}}Object.defineProperty(h,"__esModule",{value:!0});var k=a.vec2d,m=!1,e=!1,b,l;h.drawAccelerationStruct=function(a,b){if(e&&l){for(var d=l,g=[k.create(),k.create(),k.create(),k.create()],h=0,n=0;n<a.accBinsNumX;n++)for(var m=0;m<a.accBinsNumY;m++){var c=a.accBins[n][m],h=h+c.length,t=n*a.accBinsSizeX,
u=(n+1)*a.accBinsSizeX,p=m*a.accBinsSizeY,y=(m+1)*a.accBinsSizeY;g[0][0]=t;g[0][1]=p;g[1][0]=u;g[1][1]=p;g[2][0]=u;g[2][1]=y;g[3][0]=t;g[3][1]=y;d.fillText(c.length.toFixed(),t+5,p+15);f(g,"blue")}d.fillText("total totalShownLabels: "+h,70,40);d.fillText("total visible labels: "+b.length,70,50);d.fillText("total numTests: "+a.accNumTests,70,30)}};h.prepare=function(a){m=g.DECONFLICTOR_SHOW_OUTLINES;e=g.DECONFLICTOR_SHOW_GRID;if(m||e)null==b&&(b=document.createElement("canvas"),b.setAttribute("id",
"canvas2d"),a.surface.parentElement.style.position="relative",a.surface.parentElement.appendChild(b)),b.setAttribute("width",a.width+"px"),b.setAttribute("height",a.height+"px"),b.setAttribute("style","position:absolute;left:0px;top:0px;display:block;pointer-events:none;"),l=b.getContext("2d"),l.clearRect(0,0,a.width,a.height),l.font="8px Arial"};h.drawPoly=f})},"esri/views/3d/support/PreallocArray":function(){define(["../../../core/declare","./HeapSort"],function(p,h){return p([],{constructor:function(d,
a){this.data=Array(d);this.length=0;if(a){for(var g=0;g<d;g++)this.data[g]=a(g);this._allocator=a;this._hasAllocator=!0}else this._allocator=this._nullAllocator,this._hasAllocator=!1},_nullAllocator:function(){return null},grow:function(d){for(;this.data.length<d;)this.data.push(this._allocator(this.data.length))},next:function(){if(!this._hasAllocator)return null;this.data.length===this.length&&this.grow(2*this.length);return this.data[this.length++]},swap:function(d,a){var g=this.data[d];this.data[d]=
this.data[a];this.data[a]=g},push:function(d){this.data.length===this.length&&this.grow(2*this.length);this.data[this.length++]=d},pushArray:function(d){var a=this.length+d.length;a>=this.data.length&&this.grow(Math.max(2*this.length,a));for(a=0;a<d.length;a++)this.data[this.length++]=d[a]},pushEither:function(d){Array.isArray(d)?this.pushArray(d):this.push(d)},pop:function(){if(0===this.length)return null;var d=this.data[--this.length];this._hasAllocator||(this.data[this.length]=null);return d},
slice:function(d,a){void 0===a&&(a=this.length);return this.data.slice(d,a)},clear:function(){if(!this._hasAllocator)for(var d=0;d<this.length;d++)this.data[d]=null;this.length=0},peek:function(){return 0===this.length?null:this.data[this.length-1]},sort:function(d){h.sort(this.data,0,this.length,d);return this}})})},"esri/views/3d/support/HeapSort":function(){define([],function(){function p(d,a,g,f){for(var h=a,m=g>>>1,e=d[h-1];a<=m;){a=h<<1;a<g&&0>f(d[a-1],d[a])&&++a;var b=d[a-1];if(0>=f(b,e))break;
d[h-1]=b;h=a}d[h-1]=e}function h(d,a){return d<a?-1:d>a?1:0}return{sort:function(d,a,g,f){void 0===a&&(a=0);void 0===g&&(g=d.length);void 0===f&&(f=h);for(var k=g>>>1;k>a;k--)p(d,k,g,f);for(var m=a+1,k=g-1;k>a;k--)g=d[a],d[a]=d[k],d[k]=g,p(d,m,k,f);return d}}})},"esri/views/3d/state/ViewState":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../views/ViewAnimation ../lib/glMatrix ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/earthUtils ../support/Evented ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v){Object.defineProperty(h,"__esModule",{value:!0});p=function(c){function g(a){a=c.call(this,a)||this;a.propertiesPool=new r.default({camera:v},a);a.events=new u.Evented;a.updateQueue=new w;a.processingUpdates=!1;return a}d(g,c);g.prototype.destroy=function(){this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};g.prototype.normalizeCtorArgs=function(a){return{camera:this.createInitialCamera(a.viewingMode),mode:a.viewingMode,spatialReference:a.spatialReference,
constraints:new e.default({mode:a.viewingMode})}};Object.defineProperty(g.prototype,"animation",{get:function(){return this.cameraController instanceof b.AnimationController?this.cameraController.viewAnimation:null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"camera",{get:function(){return this._get("camera")},set:function(a){a!==q&&q.copyFrom(a);q.markViewDirty();q.computeUp(this.mode);n.camera=q;this.events.emit("before-camera-change",n);(a=this._get("camera"))&&a.equivalent(q)||
this._set("camera",this.propertiesPool.get("camera").copyFrom(q))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"isLocal",{get:function(){return"local"===this.mode},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"interacting",{get:function(){return!!this.cameraController&&this.cameraController.isInteractive},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"cameraController",{get:function(){return this._get("cameraController")},set:function(a){var c=this;this.stopActiveCameraController()?(a&&(a.watch("state",function(b){if(b===l.State.Finished||b===l.State.Stopped)c._set("cameraController",null),c.updateCamera(function(c){a.onControllerEnd(c)})},!0),a.onControllerStart(this.camera)),this._set("cameraController",a)):a&&(a.state=l.State.Rejected)},enumerable:!0,configurable:!0});g.prototype.switchCameraController=function(a){this.cameraController=a;return a.state!==
l.State.Rejected};g.prototype.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};g.prototype.cameraChanged=function(){this.updateCamera(function(){})};g.prototype.updateCamera=function(a){this.updateQueue.enqueue(a);this.processingUpdates||this.processUpdateQueue()};g.prototype.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var a=this.updateQueue.dequeue();q.copyFrom(this._get("camera"));
a(q);this.camera=q;this.processingUpdates=!1;this.processUpdateQueue()}};g.prototype.createInitialCamera=function(a){return"global"===a?new v(m.vec3d.createFrom(4*t.earthRadius,0,0),m.vec3d.createFrom(t.earthRadius,0,0),m.vec3d.createFrom(0,0,1)):new v(m.vec3d.createFrom(0,0,100),m.vec3d.createFrom(0,0,0),m.vec3d.createFrom(0,1,0))};a([f.property({readOnly:!0,type:k,dependsOn:["cameraController"]})],g.prototype,"animation",null);a([f.property({type:v})],g.prototype,"camera",null);a([f.property({constructOnly:!0})],
g.prototype,"constraints",void 0);a([f.property({readOnly:!0})],g.prototype,"events",void 0);a([f.property({readOnly:!0,dependsOn:["isLocal"]})],g.prototype,"isGlobal",null);a([f.property({readOnly:!0,dependsOn:["mode"]})],g.prototype,"isLocal",null);a([f.property({constructOnly:!0})],g.prototype,"mode",void 0);a([f.property({constructOnly:!0})],g.prototype,"spatialReference",void 0);a([f.property({readOnly:!0,dependsOn:["cameraController"]})],g.prototype,"interacting",null);a([f.property()],g.prototype,
"cameraController",null);return g=a([f.subclass()],g)}(f.declared(g));h.ViewState=p;var q=new v,n={camera:null},w=function(){function a(){this.data=[];this.length=this.ptr=0}a.prototype.enqueue=function(a){this.data.push(a);this.length++};a.prototype.dequeue=function(){if(0===this.length)return null;var a=this.data[this.ptr++];this.length--;0===this.length&&(this.ptr=this.data.length=0);return a};return a}();h.default=p})},"esri/views/3d/support/Evented":function(){define(["require","exports"],function(p,
h){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function d(){this._listeners={}}d.prototype.hasEventListener=function(a){return null!=this._listeners[a]&&0<this._listeners[a].size};d.prototype.on=function(a,d){var f=this;null==this._listeners[a]&&(this._listeners[a]=new Map);var g={};this._listeners[a].set(g,d);return{remove:function(){return f._listeners[a].delete(g)}}};d.prototype.emit=function(a,d){null!=this._listeners[a]&&this._listeners[a].forEach(function(a){return a(d)})};
return d}();h.Evented=p})},"esri/views/3d/support/PropertiesPool":function(){define(["require","exports","../../../core/ObjectPool","../../../core/accessorSupport/watch"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function g(f,g){var h=this;this.owner=g;this.properties={};this.afterDispatchHandle=null;for(var e in f)g=new d(f[e],null,null,2,2),this.properties[e]={pool:g,acquired:[]};this.afterDispatchHandle=a.afterDispatch(function(){return h.release()})}g.prototype.destroy=
function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);this.owner=null};g.prototype.get=function(a){var d=this.owner._get(a);a=this.properties[a];var f=a.pool.acquire();for(a.acquired.push(f);f===d;)a.acquired.push(f),f=a.pool.acquire();return f};g.prototype.release=function(){for(var d in this.properties){for(var g=this.properties[d],h=0,e=0,b=g.acquired;e<b.length;e++){var l=b[e];a.isValueInUse(l)?g.acquired[h++]=l:g.pool.release(l)}g.acquired.length=
h}};return g}();h.PropertiesPool=p;h.default=p})},"esri/views/3d/state/ViewStateManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/lang ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Error ../../../core/Handles ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/Extent ../../../geometry/Point ../../../geometry/ScreenPoint ../../../geometry/support/webMercatorUtils ../camera/constraintUtils ../camera/intersectionUtils ../lib/glMatrix ./ConstraintsManager ./Frustum ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ./helpers/PickingHelper ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../../animation/easing".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x,z,A,y,B,E,C,G,J,F,I,H){Object.defineProperty(h,"__esModule",{value:!0});var K=l.getLogger("esri.views.3d.state.ViewStateManager");p=function(h){function l(a){a=h.call(this)||this;a.propertiesPool=new J.default({frustum:y.default},a);a.handles=new b;a.cameraSetByUser=!1;a.internalSetOrder=[];a.immediateGoToPromise=null;a.animatedGoToPromise=null;a.ready=!1;return a}d(l,h);Object.defineProperty(l.prototype,"camera",{get:function(){return this.ready?G.internalToExternal(this.view,
this.view.state.camera):this._get("camera")},set:function(a){this.updatePropertyBeforeReady("camera",a)||this.setStateCamera(G.externalToInternal(this.view,a),{applyConstraints:!1})||K.error("#camera\x3d","Invalid camera",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"center",{get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(a){this.updatePropertyBeforeReady("center",a)||(a?this.isCompatible(a)?this.setStateCamera(this.centerToCamera(a),
{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.forceUpdate():K.error("#center\x3d","Invalid center",a):K.error("#center\x3d","Center has an incompatible spatial reference (center: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):K.error("#center\x3d","Center may not be null or undefined"))},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"extent",{get:function(){return this.ready?G.toExtent(this.view,null,
null,null,S):this._get("extent")},set:function(a){this.updatePropertyBeforeReady("extent",a)||(a?this.isCompatible(a)?this.setStateCamera(this.extentToCamera(a),{applyConstraints:!0})||K.error("#extent\x3d","Invalid extent",a):K.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):K.error("#extent\x3d","Extent may not be null or undefined"))},enumerable:!0,configurable:!0});
Object.defineProperty(l.prototype,"frustum",{get:function(){var a=this.propertiesPool.get("frustum");a.update(this.view.state.camera);return a},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"hasInitialView",{get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"scale",{get:function(){if(!this.ready)return this._get("scale");var a=this.view.pointsOfInterest.centerOnContent;return G.distanceToScale(this.view,
a.distance,a.location.latitude)},set:function(a){this.updatePropertyBeforeReady("scale",a)||this.setStateCamera(this.scaleToCamera(a),{applyConstraints:!0})||K.error("#scale\x3d","Invalid scale",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"padding",{get:function(){if(!this.ready)return this._get("padding");var a=this.view.state.camera.padding,c=this._get("padding");return null!==c&&c.top===a[0]&&c.right===a[1]&&c.bottom===a[2]&&c.left===a[3]?c:{top:a[0],right:a[1],bottom:a[2],
left:a[3]}},set:function(a){this.updatePropertyBeforeReady("padding",a)||(a?z.vec4d.set4(a.top||0,a.right||0,a.bottom||0,a.left||0,R):z.vec4d.set4(0,0,0,0,R),this.view.state.updateCamera(function(a){a.padding=R}))},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"screenCenter",{get:function(){var a=this.padding;return new n((this.view.width-(a.left+a.right))/2+a.left,(this.view.height-(a.top+a.bottom))/2+a.top)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"viewpoint",
{get:function(){return this.ready?F.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(a){if(!this.updatePropertyBeforeReady("viewpoint",a))if(a)if(this.isCompatible(a))this.setStateCamera(this.viewpointToCamera(a),{applyConstraints:!a.camera})||K.error("#viewpoint\x3d","Invalid viewpoint",a);else{var c=a.camera?a.camera.position:a.targetGeometry,c=c&&c.spatialReference;K.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(c?c.wkid:"none")+", view: "+
this.view.spatialReference.wkid+")",a)}else K.error("#viewpoint\x3d","Viewpoint may not be null or undefined")},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"zoom",{get:function(){return this.ready?G.scaleToZoom(this.view,this.scale):this._get("zoom")},set:function(a){this.updatePropertyBeforeReady("zoom",a)||this.setStateCamera(this.zoomToCamera(a),{applyConstraints:!0})||K.error("#zoom\x3d","Invalid zoom",a)},enumerable:!0,configurable:!0});l.prototype.initialize=function(){var a=
this;this.pickingHelper=new C.PickingHelper(this.view);this.handles.add(this.view.watch("state.camera",function(c){return a.cameraChangedSync(c)},!0),u.on(this.view,"state.events","before-camera-change",function(c){return a.beforeCameraChangeHandle(c.camera)}));this.handles.add(this.view.on("resize",function(c){return a.handleResize(c.width,c.height)}));this.handles.add(this.view.watch("state.cameraController",function(){a.cameraSetByUser=!0;a.handles.remove(N);a.cancelImmediateGoTo()}));this.handles.add(u.on(this.view,
"pointsOfInterest.events","camera-parameters-changed",function(){return a.notifyChange("scale")}))};l.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};l.prototype.init=function(){var a=this;this.constraintsManager=new A.default({view:this.view});this.handleResize(this.view.width,this.view.height);var c=this.getInitialProperties();this.cameraSetByUser=!1;this._set("ready",!0);for(var b=
0;b<c.length;b++){var d=c[b];this.set(d.name,d.value)}this.cameraSetByUser||((c=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(c)?this.setInitialView(c):"local"===this.view.state.mode&&this.handles.add(u.whenOnce(this.view.basemapTerrain,"ready",function(){a.handles.remove(N);a.setInitialView(a.view.groundExtent)}),N))};l.prototype.deinit=function(){this.ready&&(this._override("padding",this.padding),this.cancelImmediateGoTo(),this.cancelAnimatedGoTo(),
this._set("ready",!1),this._clearOverride("hasInitialView"),this.internalSetOrder.length=0,this.cameraSetByUser=!1,this.handles.remove(N),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};l.prototype.goTo=function(a,c){c=g.mixin({animate:!0},c);return c.animate?this.goToAnimated(a,c):this.goToImmediate(a,c)};l.prototype.debugSetCameraOnContent=function(){this.setStateCamera(x.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};l.prototype.step=
function(a){var c=this.view.state,b=c&&this.view.state.cameraController;b&&(c.updateCamera(function(c){b.stepController(a,c)}),b.steppingFinished&&b.finishController())};l.prototype.cancelImmediateGoTo=function(){var a=this.immediateGoToPromise;a&&(this.immediateGoToPromise=null,a.cancel())};l.prototype.cancelAnimatedGoTo=function(){var a=this.animatedGoToPromise;a&&(this.animatedGoToPromise=null,a.cancel())};l.prototype.getInitialProperties=function(){for(var a=this,c=new Set,b=[],d=0,e=M;d<e.length;d++){var f=
e[d],g=f.propertyName,f=f.overrides,h=c.has(g),k=this._isOverridden(g);!h&&k&&b.push({name:g,value:this._get(g)});this._clearOverride(g);(h||k)&&f.forEach(function(a){return c.add(a)})}return b.sort(function(c,b){c=a.internalSetOrder.indexOf(c.name);b=a.internalSetOrder.indexOf(b.name);return c<b?-1:c>b?1:0})};l.prototype.setInitialView=function(a){if(a&&!this.cameraSetByUser){var c={applyConstraints:!0};a instanceof f?c.applyConstraints=!1:a instanceof k?a.targetGeometry instanceof v?a=G.fromExtent(this.view,
a.targetGeometry,0,.5,{noReset:!0}):(a.camera&&(c.applyConstraints=!1),a=F.toCamera(this.view,a)):a=G.fromExtent(this.view,a,0,.5,{noReset:!0});this.setStateCamera(G.externalToInternal(this.view,a),c)}};l.prototype.updatePropertyBeforeReady=function(a,c){if(this.ready)return!1;this._override(a,c);var b=this.internalSetOrder.indexOf(a);-1!==b&&(this.internalSetOrder=this.internalSetOrder.splice(b,1));c&&(this.internalSetOrder.push(a),-1!==L.indexOf(a)&&this._override("hasInitialView",!0));return!0};
l.prototype.isCompatible=function(a){return a?a instanceof k?a.camera?this.isCompatible(a.camera):this.isCompatible(a.targetGeometry):a instanceof f?this.isCompatible(a.position):a.spatialReference&&w.canProject(a.spatialReference,this.view.spatialReference):!1};l.prototype.getPreservingHeadingTilt=function(a){void 0===a&&(a=V);this.cameraSetByUser?(a.heading=this.camera.heading,a.tilt=this.camera.tilt):(a.heading=0,a.tilt=.5);return a};l.prototype.centerPointAtDistanceToCamera=function(a,c,b){void 0===
b&&(b=Z);var d=this.getPreservingHeadingTilt();return(a=G.eyeHeadingTiltForCenterPointAtDistance(this.view,d.heading,d.tilt,a,c))?(b.copyFrom(this.view.state.camera),b.eye=a.eye,b.center=a.center,b.up=a.up,b):null};l.prototype.centerToCamera=function(a){var c=this.view.pointsOfInterest.centerOnContent;c.forceUpdate();return this.centerPointAtDistanceToCamera(a,c.distance)};l.prototype.extentToCamera=function(a){var c=this.getPreservingHeadingTilt();if(a=G.fromExtent(this.view,a,c.heading,c.tilt,S))return G.externalToInternal(this.view,
a)};l.prototype.scaleToCamera=function(a){var c=this.view.pointsOfInterest.centerOnContent;c.forceUpdate();var b=c.renderLocation;a=G.scaleToDistance(this.view,a,c.location.latitude);return this.centerPointAtDistanceToCamera(b,a)};l.prototype.zoomToCamera=function(a){return this.scaleToCamera(G.zoomToScale(this.view,a))};l.prototype.viewpointToCamera=function(a){return(a=F.toCamera(this.view,a))?G.externalToInternal(this.view,a):null};l.prototype.setStateCamera=function(a,b){var d=this;if(!a||!this.view.state.stopActiveCameraController())return!1;
this.cameraSetByUser=!0;this.cancelImmediateGoTo();this.view.state.updateCamera(function(e){e.copyFrom(a);b.applyConstraints&&c.applyAll(d.view,e)});b.applyConstraints||(this.view.state.cameraController=new E.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:a}));return!0};l.prototype.handleResize=function(a,c){var b=this.view.canvas;!b||b.width===a&&b.height===c||(b.width=a,b.height=c);this.view.state&&(b=this.view.state.camera,b.fullWidth!==a||b.fullHeight!==c)&&(Z.copyFrom(b),
Z.fullWidth=a,Z.fullHeight=c,this.view.state.camera=Z)};l.prototype.beforeCameraChangeHandle=function(a){this.updateCameraAboveGround(a)};l.prototype.cameraChangedSync=function(a){a&&this.view._stage&&this.view._stage.setCamera(a)};l.prototype.updateCameraAboveGround=function(a){var c=this.view.basemapTerrain,b=this.view.renderCoordsHelper.getAltitude(a.eye),c=c&&c.spatialReference?x.surfaceElevationBelowEye(this.view,a):0;a.aboveGround=b>=c};l.prototype.createGoToCamera=function(a){var c=this;return u.whenOnce(this,
"ready",null,!0).then(function(){return F.create(c.view,a)}).then(function(b){var d=!!(a instanceof k&&a.camera||a instanceof f),g=b.camera;if(!c.isCompatible(g))throw b=(b=g.position)&&b.spatialReference,new e("goto:incompatible-spatialreference","Resulting camera has an incompatible spatial reference (camera: "+(b?b.wkid:"none")+", view: "+c.view.spatialReference.wkid+")",{camera:g});g=G.externalToInternal(c.view,g);if(!g)throw new e("goto:invalid-camera","Resulting camera is invalid");return{viewpoint:b,
camera:g,isFullySpecified:d}})};l.prototype.cancellableGoTo=function(a){var c=this,b;return t.create(function(c,d){b={resolve:c,reject:d};a.asyncResult=b},function(){c.view.state.cameraController===a&&a.active&&a.asyncResult===b&&a.stopController()})};l.prototype.goToImmediate=function(a,c){var b=this;this.cancelAnimatedGoTo();this.cancelImmediateGoTo();var d=this.createGoToCamera(a).then(function(a){b.immediateGoToPromise===d&&(b.immediateGoToPromise=null);b.setStateCamera(a.camera,{applyConstraints:!a.isFullySpecified})}).catch(function(a){b.immediateGoToPromise===
d&&(b.immediateGoToPromise=null);a instanceof e&&a.message&&K.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));throw a;});return this.immediateGoToPromise=d};l.prototype.goToAnimatedBeforeReady=function(a,c){var b=this;this.cancelAnimatedGoTo();var d=u.whenOnce(this.view,"ready").then(function(){if(d===b.animatedGoToPromise)return b.animatedGoToPromise=null,b.goToAnimated(a,c);throw new e("view:goto-cancelled","Cancelled");});return this.animatedGoToPromise=
d};l.prototype.goToAnimated=function(a,b){var d=this;this.cancelAnimatedGoTo();if(!this.ready)return this.goToAnimatedBeforeReady(a,b);var f=this.view.state.cameraController,g;f instanceof B.PointToPointAnimationController&&(f.updateStateFromViewAnimation(),f.active&&(g=f));null==g&&(g=new B.PointToPointAnimationController(this.view.state,this.pickingHelper));var h=g.viewAnimation;a=this.createGoToCamera(a);var k=a.then(function(a){return a.viewpoint});h.update(k);if(g!==f&&!this.view.state.switchCameraController(g))return h.stop(),
K.error("#goTo()","Cannot start an animation while interacting"),t.reject(new e("view:goto-cannot-interrupt","Cannot start an animation while interacting"));var l=h.target,n=function(){return d.view.state.cameraController===g&&g.viewAnimation.target===l&&g.active};a.then(function(a){var e=a.viewpoint,f=a.camera;a=a.isFullySpecified;if(n()){g.viewAnimation.update(e);l=g.viewAnimation.target;var k;a?(k=new E.SurfaceCollisionCorrectionController({view:d.view,desiredCamera:f}),c.applySurfaceCollision(d.view,
f,1)):c.applyAll(d.view,f);g.begin(f,d.internalAnimateOptions(b));return h.when().then(function(){var a=d.view.state.cameraController;k&&(a&&a.active?a instanceof B.PointToPointAnimationController&&a.viewAnimation.target===l&&(d.view.state.cameraController=k):g.viewAnimation.target===l&&(d.view.state.cameraController=k))})}}).catch(function(a){a instanceof e&&a.message&&K.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));if(n())throw d.view.state.cameraController.stopController(),
a;});return this.cancellableGoTo(g)};l.prototype.internalAnimateOptions=function(a){var c={};a&&(null!=a.speedFactor&&(c.speedFactor=a.speedFactor),null!=a.duration&&(c.duration=a.duration/1E3),null!=a.maxDuration&&(c.maxDuration=a.maxDuration/1E3),null!=a.easing&&(c.easing="string"===typeof a.easing?H.named[a.easing]:a.easing));return c};a([r.property({type:f,dependsOn:["view.state.camera","ready"]})],l.prototype,"camera",null);a([r.property({type:q,dependsOn:["view.pointsOfInterest.centerOnContent.location",
"ready"]})],l.prototype,"center",null);a([r.property({type:v,dependsOn:["view.state.camera","ready"]})],l.prototype,"extent",null);a([r.property({readOnly:!0,dependsOn:["view.state.camera","ready"]})],l.prototype,"frustum",null);a([r.property({readOnly:!0,dependsOn:["view.map.initialViewProperties.viewpoint"]})],l.prototype,"hasInitialView",null);a([r.property({readOnly:!0,type:Boolean})],l.prototype,"ready",void 0);a([r.property({dependsOn:["view.pointsOfInterest.centerOnContent.distance","ready"],
type:Number})],l.prototype,"scale",null);a([r.property({dependsOn:["view.state.camera","ready"]})],l.prototype,"padding",null);a([r.property({readOnly:!0,dependsOn:["view.width","view.height","padding"]})],l.prototype,"screenCenter",null);a([r.property({constructOnly:!0})],l.prototype,"view",void 0);a([r.property({type:k,dependsOn:["camera","ready"]})],l.prototype,"viewpoint",null);a([r.property({type:Number,dependsOn:["scale"]})],l.prototype,"zoom",null);return l=a([r.subclass("esri.views.3d.state.ViewStateManager")],
l)}(r.declared(m));h.ViewStateManager=p;var L="camera viewpoint extent scale center zoom".split(" "),M=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"center",overrides:[]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],V={heading:0,tilt:0},S=new f,Z=new I,R=z.vec4d.create(),N="pending-initial-view";h.default=p})},
"esri/views/3d/state/ConstraintsManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils ./NearFarHeuristic ./SurfaceCollisionConstraint ../support/mathUtils".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,t,u){Object.defineProperty(h,"__esModule",{value:!0});p=function(g){function h(a){var b=
g.call(this)||this;b.handles=new f;b.nearFarHeuristic=l.createNearFarHeuristic(a.view.state.mode,a.view.basemapTerrain,a.view.renderCoordsHelper.spatialReference);return b}d(h,g);h.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],function(){return a.handleClipDistanceNearFarChanged()}),this.view.watch("constraints.clipDistance.mode",function(){return a.handleClipDistanceModeChanged()}),this.view.state.events.on("before-camera-change",
function(b){return a.cameraUpdateNearFar(b.camera)}),this.view.watch("dataExtent",function(){return a.updateNearFar()},!0)],"clipDistance");this.handles.add([this.view.watch(["constraints.altitude.min","constraints.altitude.max"],function(){return a.handleAltitudeMinMaxChanged()},!0)],"altitude");this.handles.add([this.view.watch("constraints.tilt.max",function(){return a.handleTiltMaxChanged()},!0),this.view.watch("constraints.tilt.mode",function(){return a.handleTiltModeChanged()},!0),this.view.watch("state.camera",
function(){return a.tiltAutoUpdateMax()},!0)],"tilt");this.handles.add([this.view.watch("constraints.collision.enabled",function(){return a.handleCollisionEnabledChanged()},!0)],"collision");this.view.state.isLocal&&this.handles.add(k.init(this.view,"dataExtent",function(b){return a.updateLocalSurfaceDistance(b)}));this.updateNearFar();"local"!==this.view.state.mode&&this.updateAltitude();this.updateTilt();this.updateCollision();this._set("surfaceCollisionConstraint",new t.default({view:this.view}))};
h.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))};h.prototype.handleClipDistanceNearFarChanged=function(){var a=this,b=this.view.constraints&&this.view.constraints.clipDistance;b&&"auto"!==b.mode&&this.view.state.updateCamera(function(c){a.cameraUpdateNearFarManual(c,b);return!0})};h.prototype.handleClipDistanceModeChanged=function(){this.updateNearFar()};
h.prototype.updateNearFar=function(){var a=this;this.view.state.updateCamera(function(b){a.cameraUpdateNearFar(b);return!0})};h.prototype.cameraUpdateNearFar=function(a){var b=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(b?b.mode:"auto")?this.cameraUpdateNearFarManual(a,b):this.cameraUpdateNearFarAuto(a,b)};h.prototype.cameraUpdateNearFarAuto=function(a,d){var c=this.nearFarHeuristic.compute(a.eye,a.center,this.view.dataExtent,b.surfaceElevationBelowEye(this.view,a),r),e=
c.distance,f=c.maxFarNearRatio,c=c.minNearDistance;e/f>c?(a.far=e,a.near=a.far/f):(a.near=c,a.far=a.near*f);d&&d.autoUpdate(a.near,a.far)};h.prototype.cameraUpdateNearFarManual=function(a,b){b&&(a.near=b.near,a.far=b.far)};h.prototype.handleCollisionEnabledChanged=function(){this.updateCollision()};h.prototype.updateCollision=function(){var a=this.view.constraints&&this.view.constraints.collision,b=this.view.state.constraints.collision,a=a?a.enabled:!1;a!==b.enabled&&(b.enabled=a)&&this.reapplyConstraints(8)};
h.prototype.handleAltitudeMinMaxChanged=function(){this.updateAltitude()};h.prototype.updateAltitude=function(){var a=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=a&&"local"!==this.view.state.mode?{min:a.min,max:a.max}:null;this.reapplyConstraints()};h.prototype.handleTiltModeChanged=function(){this.updateTilt()};h.prototype.handleTiltMaxChanged=function(){var a=this.view.constraints&&this.view.constraints.tilt;a&&"auto"!==a.mode&&(this.updateTiltManual(a),
this.reapplyConstraints())};h.prototype.updateTilt=function(){var a=this.view.constraints&&this.view.constraints.tilt;"manual"===(a?a.mode:"auto")?this.updateTiltManual(a):this.updateTiltAuto(a);this.reapplyConstraints()};h.prototype.updateTiltManual=function(a){var b=this.view.state.constraints;b.tilt=b.createConstantMaxTilt(u.deg2rad(a.max))};h.prototype.updateTiltAuto=function(a){a=this.view.state.constraints;a.tilt=a.createDefaultTilt();this.tiltAutoUpdateMax()};h.prototype.tiltAutoUpdateMax=
function(){var a=this.view.constraints&&this.view.constraints.tilt;if(a&&"auto"===a.mode){var b=this.view.state.constraints;b.tilt&&(b=b.tilt(this.view.state.camera.distance).max,a.autoUpdate(u.rad2deg(b)))}};h.prototype.updateLocalSurfaceDistance=function(a){var b=Math.max(a.width,a.height);0>=b||(a.hasZ&&(b=Math.max(b,a.zmax-a.zmin)),a=this.view.state,b=3*b/Math.atan(a.camera.fov/2),b!==a.constraints.distance&&(a.constraints.distance=b))};h.prototype.reapplyConstraints=function(a){var b=this;void 0===
a&&(a=15);this.view.state.updateCamera(function(c){return e.applyAll(b.view,c,{selection:a,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null})})};a([m.property({constructOnly:!0})],h.prototype,"view",void 0);a([m.property({readOnly:!0})],h.prototype,"surfaceCollisionConstraint",void 0);return h=a([m.subclass("esri.views.3d.state.ConstraintsManager")],h)}(m.declared(g));h.ConstraintsManager=p;var r={distance:0,maxFarNearRatio:0,minNearDistance:0};h.default=
p})},"esri/views/3d/state/NearFarHeuristic":function(){define("require exports ../../../geometry/support/scaleUtils ../lib/glMatrix ../support/earthUtils ../support/mathUtils".split(" "),function(p,h,d,a,g,f){Object.defineProperty(h,"__esModule",{value:!0});h.createNearFarHeuristic=function(a,b,c){return"global"===a?new m:new k(b,c)};var k=function(){function h(a,c){this.elevationProvider=a;this.unitInMeters=d.getMetersPerUnitForSR(c)}h.prototype.compute=function(d,c,h,k,l){l||(l={maxFarNearRatio:0,
distance:0,minNearDistance:0});var n=g.earthRadius;l.maxFarNearRatio=e;l.minNearDistance=b/this.unitInMeters;var m=d[2]*this.unitInMeters,t=m;k=m-k;var p=this.elevationProvider?this.elevationProvider.getElevationBounds():null;p&&(m=0<=k?t-this.unitInMeters*p[0]:this.unitInMeters*p[1]-t);t=Math.max(h.xmax-h.xmin,h.ymax-h.ymin,4*Math.max(h.xmax-h.xmin,h.ymax-h.ymin));a.vec3d.subtract(c,d,q);v[0]=0<q[0]?h.xmax:h.xmin;v[1]=0<q[1]?h.ymax:h.ymin;v[2]=0<q[2]?t/2:-t/2;a.vec3d.subtract(v,d);a.vec3d.normalize(q);
d=1.1*a.vec3d.dot(v,q)*this.unitInMeters;c=m+n;n=Math.sqrt(c*c-n*n);h=Math.max(h.xmax-h.xmin,h.ymax-h.ymin);c=h*r*this.unitInMeters;m=f.clamp((m-c)/(h*u*this.unitInMeters-c),0,1);l.distance=f.lerp(n,d,m*m*m);l.distance*=Math.max(Math.log(Math.abs(k)),1);l.distance=Math.min(l.distance,Math.max(34064E4,t));l.distance/=this.unitInMeters;return l};return h}(),m=function(){function d(){}d.prototype.compute=function(d,c,h,k,l){l||(l={maxFarNearRatio:0,minNearDistance:0,distance:0});c=g.earthRadius;d=a.vec3d.dot(d,
d);h=c*c;l.maxFarNearRatio=e;l.minNearDistance=b/1;this.isNemoMode(d,k)?(k=c+k,l.distance=Math.sqrt(d-k*k)/1):d>h?(l.maxFarNearRatio=f.clamp(2E4-(Math.log(Math.sqrt(d)-c)-7.983)/9.011*19E3,1E3,2E4),l.distance=Math.sqrt(d-h)/1):l.distance=l.maxFarNearRatio*l.minNearDistance;l.distance*=1.2;return l};d.prototype.isNemoMode=function(a,c){var b=g.earthRadius+l;return a<b*b&&c<t};return d}(),e=2E4,b=2,l=2E4,t=-500,u=.001,r=1E-4,v=a.vec3d.create(),q=a.vec3d.create()})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils".split(" "),
function(p,h,d,a,g,f,k,m,e){Object.defineProperty(h,"__esModule",{value:!0});p=function(b){function g(a){a=b.call(this)||this;a.handles=new f;return a}d(g,b);g.prototype.initialize=function(){var a=this;this.handles.add(this.view.basemapTerrain.on("elevation-change",function(b){return a.handleElevationChangeEvent(b)}))};g.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};g.prototype.handleElevationChangeEvent=function(a){if(this.view.state.cameraController)return!1;
e.eyeWithinExtent(this.view,this.view.state.camera,a.extent,a.spatialReference)&&this.applyToCurrentCamera()};g.prototype.applyToCurrentCamera=function(){var a=this;this.view.state.updateCamera(function(b){m.applySurfaceCollision(a.view,b,1)})};a([k.property({constructOnly:!0})],g.prototype,"view",void 0);return g=a([k.subclass("esri.views.3d.state.ElevationCollisionConstraint")],g)}(k.declared(g));h.SurfaceCollisionConstraint=p;h.default=p})},"esri/views/3d/state/Frustum":function(){define(["require",
"exports","../lib/glMatrix","../support/earthUtils","../webgl-engine/lib/Util"],function(p,h,d,a,g){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function f(){this.planes=Array(6);this.points=Array(8);this.lines=Array(12);this.origin=d.vec3d.create();this.direction=d.vec3d.create();this._altitude=null;for(var a=0;6>a;a++)this.planes[a]=d.vec4d.create();for(a=0;8>a;a++)this.points[a]=d.vec3d.create();for(a=0;12>a;a++)this.lines[a]={origin:null,direction:d.vec3d.create(),endpoint:null}}
f.prototype.updateLine=function(a,f,e){a.origin=f;a.endpoint=e;d.vec3d.direction(e,f,a.direction)};f.prototype.update=function(f){g.matrix2frustumPlanes(f.viewMatrix,f.projectionMatrix,this.points,this.planes);for(var h=0;4>h;h++){var e=h,b=h+4;this.updateLine(this.lines[h],this.points[e],this.points[b]);this.updateLine(this.lines[h+4],this.points[e],3===h?this.points[0]:this.points[e+1]);this.updateLine(this.lines[h+8],this.points[b],3===h?this.points[4]:this.points[b+1])}d.vec3d.set(f.eye,this.origin);
d.vec3d.set(f.viewForward,this.direction);this._altitude=d.vec3d.length(this.origin)-a.earthRadius};Object.defineProperty(f.prototype,"altitude",{get:function(){return this._altitude},enumerable:!0,configurable:!0});return f}();h.Frustum=p;h.default=p})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../camera/constraintUtils ../../camera/intersectionUtils ./CameraController".split(" "),
function(p,h,d,a,g,f,k){Object.defineProperty(h,"__esModule",{value:!0});p=function(h){function e(b){var d=h.call(this)||this;d.handles=new a;d.view=b.view;d.desiredCamera=b.desiredCamera.copy();return d}d(e,h);Object.defineProperty(e.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"constraintEnabled",{get:function(){return this.view.state.constraints.collision.enabled},enumerable:!0,configurable:!0});e.prototype.onControllerStart=function(a){var b=
this;h.prototype.onControllerStart.call(this,a);this.handles.add(this.view.basemapTerrain.on("elevation-change",function(a){return b.handleElevationChangeEvent(a)}));this.applyCorrection()};e.prototype.onControllerEnd=function(a){this.handles.removeAll();h.prototype.onControllerEnd.call(this,a)};e.prototype.handleElevationChangeEvent=function(a){f.eyeWithinExtent(this.view,this.desiredCamera,a.extent,a.spatialReference)&&this.applyCorrection()};e.prototype.applyCorrection=function(){var a=this;this.view.state.updateCamera(function(b){b.copyViewFrom(a.desiredCamera);
g.applySurfaceCollision(a.view,b,1)||a.constraintEnabled||(a.state=k.State.Stopped)})};return e}(k.CameraController);h.SurfaceCollisionCorrectionController=p})},"esri/views/3d/support/cameraUtils":function(){define("require exports dojo/_base/lang ../../../Camera ../../../config ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ../lib/glMatrix ./cameraUtilsPlanar ./cameraUtilsSpherical ./earthUtils ./mathUtils ./projectionUtils ../webgl-engine/lib/Camera".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q){function n(a){return"global"===a.viewingMode?t:l}function w(c,d,e){var g=c.renderSpatialReference,h=b.vec3d.set(d.viewForward,C),h=A(c,d.eye,h,d.up,G);c=c.spatialReference||k.WGS84;v.vectorToVector(d.eye,g,B,c)||(c=k.WGS84,v.vectorToVector(d.eye,g,B,c));return e?(e.position.x=B[0],e.position.y=B[1],e.position.z=B[2],e.position.spatialReference=c,e.heading=h.heading,e.tilt=h.tilt,e.fov=r.rad2deg(d.fov),e):new a(new f(B,c),h.heading,h.tilt,r.rad2deg(d.fov))}
function c(a,c,b){var d=a.state.camera,e=d.fovX,d=d.width/2;"global"===a.viewingMode&&null!=b&&(c*=Math.cos(r.deg2rad(b)));c/=a.renderCoordsHelper.unitInMeters;return d/(39.37*g.screenDPI/c)/Math.tan(e/2)}function x(a,c,b){var d=a.state.camera;c=39.37*g.screenDPI/(d.width/2/(c*Math.tan(d.fovX/2)));"global"===a.viewingMode&&(c/=Math.cos(r.deg2rad(b)));return c*=a.renderCoordsHelper.unitInMeters}function z(c,b,d,e,f,g){var h=c.renderSpatialReference;b=y(c,e.heading,e.tilt,b,d,f);c=v.vectorToPoint(b.eye,
h,c.spatialReference||k.WGS84);if(!c)return null;if(!g)return new a(c,b.heading,b.tilt,e.fov);g.position=c;g.heading=b.heading;g.tilt=b.tilt;g.fov=e.fov;return g}function A(a,c,b,d,e){return n(a).directionToHeadingTilt(c,b,d,e)}function y(a,c,e,g,h,l){var m=b.vec3d.create(),r=a.renderSpatialReference;if(g)if(g instanceof f){var q=g;v.pointToVector(q,m,a.renderSpatialReference);null==q.z&&null!=a.basemapTerrain&&(q=a.basemapTerrain.getElevation(q),null!=q&&a.renderCoordsHelper.setAltitude(q,m))}else g&&
b.vec3d.set(g,m);else b.vec3d.set(a.state.camera.center,m);g&&g instanceof f||(g=v.vectorToPoint(m,r,a.spatialReference||k.WGS84));h=Math.max(h,a.state.constraints.minimumPoiDistance);r=e;e=h;if(!(q=l&&l.noReset))var q=g,t=a.engineToScreen(a.state.camera.center),u=a.toScreen(q),q=t.x-u.x,t=t.y-u.y,u=a.pointsOfInterest.centerOnSurfaceFrequent.distance,u=Math.log(Math.max(e,u)/Math.min(e,u))/Math.LN2,q=!(Math.sqrt(q*q+t*t)>5*Math.max(a.width,a.height)||8<u&&8E5<e);q?(r=n(a).eyeTiltToLookAtTilt(m,e,
r),r=a.state.constraints.clampTilt(e,r),r=n(a).lookAtTiltToEyeTilt(m,e,r)):(c=0,r=a.state.constraints.tilt(e).min);e=r;r=n(a).eyeForCenterWithHeadingTilt;c=r(m,h,c,e);m={eye:c.eye,up:c.up,center:m,heading:c.heading,tilt:c.tilt};return l&&l.noReset||"global"!==a.viewingMode||(c=a.renderCoordsHelper.fromRenderCoords(m.eye,J,a.spatialReference)?a.basemapTerrain&&(a.basemapTerrain.getElevation(J)||0)>J.z-1:!1,!c)?m:(m=a.state.constraints.tilt(h).min,y(a,0,m,g,h,d.mixin({},l,{noReset:!0})))}Object.defineProperty(h,
"__esModule",{value:!0});var B=b.vec3d.create(),E=b.vec3d.create(),C=b.vec3d.create(),G={heading:0,tilt:0},J=new f,F=new r.Cyclical(-2.0037508342788905E7,2.0037508342788905E7);h.externalToInternal=function(a,c){var d=a.renderSpatialReference,f=n(a).headingTiltToDirectionUp,g=b.vec3d.create();return v.pointToVector(c.position,g,d)?(d=f(g,c.heading,c.tilt),b.vec3d.add(d.direction,g),a=e.cameraOnContentAlongViewDirection(a,g,d.direction,d.up),a.fov=r.deg2rad(c.fov),a):null};h.internalToExternal=w;h.scaleToDistance=
c;h.distanceToScale=x;h.fromCenterScale=function(a,b,d,e,f,g){d=c(a,d,b.latitude);return z(a,b,d,e,f,g)};h.fromCenterDistance=z;h.directionToHeadingTilt=A;h.eyeHeadingTiltForCenterPointAtDistance=y;h.fromExtent=function(c,b,d,e,g,h){var l;g instanceof a?(h=g,l={noReset:!1}):l=g;var n="global"===c.viewingMode;g=c.renderSpatialReference;var r=c.spatialReference||k.WGS84,q=k.WebMercator,t=b.spatialReference||q,p,w=0;null!=b.zmax&&null!=b.zmin&&(p=(b.zmax+b.zmin)/2,w=b.zmax-b.zmin);if(n){var n=new f(b.xmin,
b.ymin,t),x=new f(b.xmax,b.ymax,t),n=m.project(n,q),x=m.project(x,q);if(null===n||null===x)return;b=new f(F.center(n.x,x.x),(x.y+n.y)/2,q);null!=p&&(b.z=p);p=u.getGreatCircleSpanAt(b,n,x);q=p.lon;t=p.lat;F.diff(n.x,x.x)>F.range/2&&(q+=u.halfEarthCircumference);q=Math.min(q,u.halfEarthCircumference);t=Math.min(t,u.halfEarthCircumference)}else m.canProject(b,r)&&(b=m.project(b,r)),q=b.xmax-b.xmin,t=b.ymax-b.ymin,b=new f({x:b.xmin+.5*q,y:b.ymin+.5*t,z:p,spatialReference:r});p=c.state.camera;d=y(c,d,
e,b,Math.max(1/Math.tan(p.fovX/2)*q*.5,1/Math.tan(p.fovY/2)*t*.5,1/Math.tan(p.fov/2)*w*.5)/1,l);e=v.vectorToPoint(d.eye,g,r);if(!e)return null;h||(h=new a);h.position=e;h.heading=d.heading;h.tilt=d.tilt;h.fov=c.camera.fov;return h};h.toExtent=function(a,c,b,d,e){var f;f=a.renderSpatialReference;c||(b||(b=a.state.camera),c=w(a,b,e));if(b)e=v.vectorToPoint(b.center,f,a.spatialReference||k.WGS84),f=b.distance;else{e=a.toMap(a.screenCenter);if(!e)return null;f=u.computeCarthesianDistance(c.position,e)}b||
(b=a.state.camera);c=2*f*Math.tan(b.fovX/2)*1;b=2*f*Math.tan(b.fovY/2)*1;return"global"===a.viewingMode?t.toExtent(a,e,c,b,d):l.toExtent(a,e,c,b,d)};h.scaleToZoom=function(a,c){return(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)?a.levelAtScale(c):void 0};h.zoomToScale=function(a,c){return(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)?a.scaleAtLevel(c):void 0};h.computeScale=function(a,c,d){var e=a.renderSpatialReference;c||(c=a.state.camera);var f;f=k.WGS84;c instanceof q?(v.vectorToVector(c.center,
e,E,f),f=E[1],c=c.distance):(f=c.position.latitude,v.pointToVector(c.position,B,e),v.pointToVector(d,E,e),c=b.vec3d.dist(B,E));return x(a,c,f)}})},"esri/views/3d/support/cameraUtilsPlanar":function(){define("require exports ../../../geometry/Extent ../lib/glMatrix ./cameraUtilsInternal ./mathUtils ./projectionUtils".split(" "),function(p,h,d,a,g,f,k){function m(d,g,h){d=a.vec3d.create();var k=a.vec3d.create();a.mat4d.identity(l);a.mat4d.rotateZ(l,-f.deg2rad(g));a.mat4d.rotateX(l,f.deg2rad(h));a.mat4d.multiplyVec3(l,
b,d);a.vec3d.scale(d,-1);a.mat4d.multiplyVec3(l,e,k);return{direction:d,up:k}}Object.defineProperty(h,"__esModule",{value:!0});var e=a.vec3d.createFrom(0,1,0),b=a.vec3d.createFrom(0,0,1),l=a.mat4d.create(),t=a.vec3d.create(),u=a.vec3d.create();h.headingTiltToDirectionUp=m;h.directionToHeadingTilt=function(a,d,f,h){return g.directionToHeadingTilt(d,f,h,b,e)};h.eyeForCenterWithHeadingTilt=function(b,d,e,f){var g=m(b,e,f);b=a.vec3d.add(a.vec3d.scale(g.direction,-d,a.vec3d.create()),b);return{up:g.up,
eye:b,heading:e,tilt:f}};h.lookAtTiltToEyeTilt=function(a,b,d){return f.rad2deg(d)};h.eyeTiltToLookAtTilt=function(a,b,d){return f.deg2rad(d)};h.toExtent=function(a,b,e,f,g){var c=a.renderSpatialReference;a=a.map&&a.spatialReference||b.spatialReference;k.pointToVector(b,t,c);k.pointToVector(b,u,c);t[0]-=e/2;u[0]+=e/2;t[1]-=f/2;u[1]+=f/2;k.vectorToVector(t,c,t,a);k.vectorToVector(u,c,u,a);g?(g.xmin=t[0],g.ymin=t[1],g.xmax=u[0],g.ymax=u[1],g.spatialReference=a):g=new d(t[0],t[1],u[0],u[1],a);return g}})},
"esri/views/3d/support/cameraUtilsInternal":function(){define(["require","exports","../lib/glMatrix","./mathUtils"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});var g=d.vec3d.create(),f=d.vec3d.create();h.directionToHeadingTilt=function(h,m,e,b,l){var k=g;d.vec3d.normalize(h,k);var u=d.vec3d.dot(k,b),r=0<u,u=Math.abs(u);.99<u&&(u=Math.abs(d.vec3d.dot(m,b)),.99>u?(d.vec3d.set(m,k),r&&d.vec3d.scale(k,-1)):k=null);m=0;k&&(d.vec3d.scale(b,d.vec3d.dot(b,k),f),d.vec3d.subtract(k,f),
m=d.vec3d.dot(k,l)/(d.vec3d.length(k)*d.vec3d.length(l)),d.vec3d.cross(k,l,f),m=(0<d.vec3d.dot(f,b)?1:-1)*a.rad2deg(a.acos(m)));h=a.rad2deg(a.acos(-d.vec3d.dot(b,h)/d.vec3d.length(h)));return e?(e.heading=m,e.tilt=h,e):{heading:m,tilt:h}}})},"esri/views/3d/support/cameraUtilsSpherical":function(){define("require exports ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ../lib/glMatrix ./cameraUtilsInternal ./earthUtils ./mathUtils".split(" "),function(p,
h,d,a,g,f,k,m,e){function b(a,b,d){var c=f.vec3d.create(),g=f.vec3d.create();f.vec3d.cross(a,u,n);0===f.vec3d.dot(n,n)&&f.vec3d.cross(a,r,n);f.mat4d.identity(q);f.mat4d.rotate(q,-e.deg2rad(b),a);f.mat4d.rotate(q,-e.deg2rad(d),n);f.vec3d.cross(n,a,g);f.vec3d.normalize(g);f.mat4d.multiplyVec3(q,g);f.vec3d.normalize(a,c);f.mat4d.multiplyVec3(q,f.vec3d.negate(c));return{direction:c,up:g}}function l(a){var c=a[1];a[1]=-a[2];a[2]=c}function t(a,d){d=b(d,a.heading,a.tilt);a.up=d.up;return a}Object.defineProperty(h,
"__esModule",{value:!0});var u=f.vec3d.createFrom(0,0,1),r=f.vec3d.normalize(f.vec3d.createFrom(1,1,1)),v=new e.Cyclical(-180,180),q=f.mat4d.create(),n=f.vec3d.create(),w=f.vec3d.create();h.headingTiltToDirectionUp=b;h.directionToHeadingTilt=function(a,b,d,e){var c=n;f.vec3d.normalize(a,c);f.vec3d.cross(c,u,w);0===f.vec3d.dot(w,w)&&f.vec3d.cross(c,r,w);f.vec3d.cross(w,c,w);return k.directionToHeadingTilt(b,d,e,c,w)};h.eyeForCenterWithHeadingTilt=function(a,b,d,g){var c={eye:f.vec3d.create(),up:null,
tilt:g,heading:d},h=n;h[0]=a[0];h[1]=a[2];h[2]=-a[1];d=e.deg2rad(d);var k=e.deg2rad(g);g=Math.sin(d);d=Math.cos(d);var m=Math.sin(k),r=Math.cos(k),q=f.vec3d.length(h);if(1E-8>Math.abs(k))k=b+q;else var v=q/m,u=e.asin(b/v),k=v*Math.sin(Math.PI-k-u);var v=m*b,r=r*b,u=d*v,p=k-r,w=p*p,x=b*b*m*m,m=d*d*x,x=g*g*x,z=h[1]*p,A=m*(m+w-h[1]*h[1]);if(0>A)return f.vec3d.scale(h,k/q,c.eye),c.tilt=0,c;var S=Math.sqrt(A),A=m+w,z=0<d?-S+z:S+z;if(1E-8>Math.abs(A))return 1E-8>q?(c.eye[0]=0,c.eye[1]=0,c.eye[2]=b):f.vec3d.scale(h,
k/q,c.eye),c.tilt=0,l(c.eye),t(c,a);c.eye[1]=z/A;A=c.eye[1]*c.eye[1];b=1-A;z=Math.sqrt(b);u=m*A+x-2*u*c.eye[1]*z*p+b*w;if(1E-8>Math.abs(u))return f.vec3d.scale(h,k/q,c.eye),c.tilt=0,l(c.eye),t(c,a);c.eye[0]=(b*(k*h[0]-r*h[0])-v*z*(h[0]*c.eye[1]*d+h[2]*g))/u;c.eye[2]=(b*(k*h[2]-r*h[2])-v*z*(h[2]*c.eye[1]*d-h[0]*g))/u;f.vec3d.scale(c.eye,k);l(c.eye);return t(c,a)};h.lookAtTiltToEyeTilt=function(a,b,d){a=f.vec3d.length(a);b=e.asin(b/(Math.sqrt(b*b+a*a-2*b*a*Math.cos(Math.PI-d))/Math.sin(d)));return e.rad2deg(d-
b)};h.eyeTiltToLookAtTilt=function(a,b,d){d=e.deg2rad(d);a=f.vec3d.length(a);return e.asin(b/(a/Math.sin(d)))+d};h.toExtent=function(c,b,f,h,k){function l(a){var c=Math.PI/2;a=e.cyclical2PI.normalize(a,-c);a>c&&(a=Math.PI-a);return a}var n;n=b.latitude;b=b.longitude;var r=m.getLonDeltaForDistance(b,n,f)/2;f=b-r;b+=r;n=e.deg2rad(n);r=m.earthRadius;n=(1+Math.sin(n))/(1-Math.sin(n));var q=(n+1)*Math.tan(h/r/2);n=1.5*Math.PI-2*Math.atan(.5*(q+Math.sqrt(4*n+q*q)));h=n+h/r;n=l(n);h=l(h);h<n&&(r=h,h=n,n=
r);n=Math.max(e.rad2deg(n),-90);h=Math.min(e.rad2deg(h),90);b=v.monotonic(f,b);180<b-f&&(r=(b-f-180)/2,f+=r,b-=r);k?(k.xmin=f,k.ymin=n,k.xmax=b,k.ymax=h,k.spatialReference=a.WGS84):k=new d(f,n,b,h,a.WGS84);c.spatialReference&&c.spatialReference.isWebMercator&&g.geographicToWebMercator(k,!1,k);return k}})},"esri/views/3d/support/viewpointUtils":function(){define("require exports ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ../lib/glMatrix ./aaBoundingBox ./aaBoundingRect ./cameraUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n){function w(a){return 360-q.cyclicalDeg.normalize(a)}function c(a){return q.cyclicalDeg.normalize(360-a)}function x(c,b,f){if(!b)return null;var g=c.spatialReference||a.SpatialReference.WGS84;if(b.camera){c=b.get("camera.position.spatialReference");if(!e.canProject(c,g))return null;b=b.camera.clone();c.equals(g)||(b.position=e.project(b.position,g));return b}var h=b.get("targetGeometry.spatialReference");if(h&&!e.canProject(h,g))return null;var h=r.internalToExternal(c,
c.state.camera),k={noReset:!1};null!=b.rotation&&(h.heading=w(b.rotation),k.noReset=!0);null!=f&&(h.tilt=f);if("point"===b.targetGeometry.type){f=b.targetGeometry;var l=void 0,m=b.targetGeometry.clone(),l=null!=b.scale?r.scaleToDistance(c,b.scale,f.latitude):c.state.camera.distance;b=r.eyeHeadingTiltForCenterPointAtDistance(c,h.heading,h.tilt,m,l,k);g=n.vectorToPoint(b.eye,c.renderSpatialReference,g);return new d(g,b.heading,b.tilt,h.fov)}return r.fromExtent(c,b.targetGeometry.extent,h.heading,h.tilt,
k)}function z(a,c,b){c=b.scale;null==c&&null!=b.zoom&&(c=r.zoomToScale(a,b.zoom));return c}function A(a,c){var b=!1;null!=c.heading?(a.heading=c.heading,b=!0):null!=c.rotation&&(a.heading=w(c.rotation),b=!0);null!=c.tilt&&(a.tilt=c.tilt,b=!0);null!=c.fov&&(a.fov=c.fov);return b}function y(b,d,e){var f=b.spatialReference||a.SpatialReference.WGS84;d=d||r.externalToInternal(b,e.camera);e.targetGeometry=n.vectorToPoint(d.center,b.renderSpatialReference,f);e.scale=r.computeScale(b,d);e.rotation=c(e.camera.heading);
return e}function B(a,c,b){if(c){if(!e.canProject(c.spatialReference,a.spatialReference))throw new k("viewpointutils:incompatible-spatialreference","Spatial reference ("+(c.spatialReference?c.spatialReference.wkid:"unknown")+") is incompatible with the view ("+a.spatialReference.wkid+")",{geometry:c});var d=[];if(!c.hasZ&&a.basemapTerrain){var f=void 0;switch(c.type){case "point":f=c;break;case "multipoint":case "polyline":case "mesh":f=c.extent.center;break;case "extent":f=c.center;break;case "polygon":f=
c.centroid}f&&e.canProject(f,a.basemapTerrain.spatialReference)?L[2]=a.basemapTerrain.getElevation(f)||0:L[2]=0}(0,Q[c.type])(c,function(a){d.push(a[0],a[1],a[2])},L);var g=d.length/3;if(0!==g&&(f=Array(d.length),n.bufferToBuffer(d,c.spatialReference,0,f,a.spatialReference,0,g)))for(c.hasZ&&(b.hasZ=!0),a=0;a<f.length;a+=3)c.hasZ?(L[0]=f[a+0],L[1]=f[a+1],L[2]=f[a+2]):(L[0]=f[a+0],L[1]=f[a+1]),t.expand(b.boundingBox,L)}}function E(a,c,b){return a.whenViewForGraphic(c).then(function(a){if(a&&a.whenGraphicBounds)return a.whenGraphicBounds(c)}).then(function(a){var c=
a.boundingBox;t.expand(b.boundingBox,c);a.screenSpaceObjects&&a.screenSpaceObjects.forEach(function(a){b.screenSpaceObjects.push(a)});isFinite(c[2])&&(b.hasZ=!0)}).catch(function(){B(a,c.geometry,b)})}function C(c,b,d){if(Array.isArray(b)&&2===b.length){var e=b[0],f=b[1];if("number"===typeof e&&"number"===typeof f)return O.x=e,O.y=f,O.z=void 0,O.spatialReference=a.SpatialReference.WGS84,B(c,O,d),m.resolve()}if(b&&"function"===typeof b.map)return m.eachAlways(b.map(function(a){return C(c,a,d)}));if(b instanceof
a.BaseGeometry)try{B(c,b,d)}catch(ba){return m.reject(ba)}else if(b instanceof g)return E(c,b,d);return m.resolve()}function G(a,b,d,e){if(b.camera)return J(a,d,b.camera,e);e.scale=b.scale;e.rotation=b.rotation;e.targetGeometry=b.targetGeometry?b.targetGeometry.clone():null;e.camera=null;null!=d.heading?e.rotation=c(d.heading):null!=d.rotation&&(e.rotation=d.rotation);b=z(a,e.targetGeometry,d);null!=b&&(e.scale=b);e.camera=x(a,e,d.tilt);return e}function J(a,c,b,d){d.camera=b.clone();d.camera.fov=
a.camera.fov;c=a.spatialReference;b=d.camera.position.spatialReference;if(!e.canProject(b,c))return null;b.equals(c)||(d.camera.position=e.project(d.camera.position,c));return y(a,null,d)}function F(d,e,f,g){if(!f)return null;g.targetGeometry=f.clone();var h=b.cameraOnContentAlongViewDirection(d);if(e.position){f=g.targetGeometry;var k=d.renderSpatialReference;n.pointToVector(e.position,N,k);n.pointToVector(f,D,k);g.targetGeometry=new a.Point(f);g.camera.position=new a.Point(e.position);l.vec3d.subtract(D,
N,R);r.directionToHeadingTilt(d,N,R,h.up,g.camera);g.scale=r.distanceToScale(d,l.vec3d.dist(N,D),g.targetGeometry.latitude);g.rotation=c(g.camera.heading);return g}if(e.zoomFactor){var k=h.distance/e.zoomFactor,m=l.vec3d.scale(h.viewForward,-k,L);l.vec3d.add(h.center,m,h.eye);h.markViewDirty();g.scale=r.distanceToScale(d,k,f.latitude)}r.internalToExternal(d,h,g.camera);k={noReset:!1};A(g.camera,e)&&(k.noReset=!0);return e.zoomFactor||(g.scale=z(d,g.targetGeometry,e),null==g.scale&&(n.pointToVector(f,
L,d.renderSpatialReference),v.frustumPoint(h.frustumPlanes,L)?g.scale=r.distanceToScale(d,l.vec3d.dist(h.eye,L),f.latitude):g.scale=r.computeScale(d,h)),r.fromCenterScale(d,g.targetGeometry,g.scale,g.camera,k,g.camera))?g:null}function I(a,c,d,e){e.targetGeometry=d.clone();var f=b.cameraOnContentAlongViewDirection(a);r.internalToExternal(a,f,e.camera);f={noReset:!1};A(e.camera,c)&&(f.noReset=!0);return r.fromExtent(a,d,e.camera.heading,e.camera.tilt,f,e.camera)?e:null}function H(a,c){if(!c||!a.spatialReference)return null;
a={target:null};if("declaredClass"in c||Array.isArray(c))a.target=c;else{for(var b in c)a[b]=c[b];c.center&&!a.target&&(a.target=c.center)}return a}function K(a){a&&(a.rotation=c(a.camera.heading));return m.resolve(a)}Object.defineProperty(h,"__esModule",{value:!0});h.DEFAULT_FRAME_COVERAGE=.66;h.rotationToHeading=w;h.headingToRotation=c;h.toCamera=x;h.fromInternalCamera=function(a,c,b){b||(b=new f({camera:new d}));r.internalToExternal(a,c,b.camera);return y(a,c,b)};h.fromCamera=function(a,c,b){b||
(b=new f);b.camera=c.clone();return y(a,null,b)};h.create=function(c,e){var g=H(c,e);if(!g)return m.reject(new k("viewpointutils-create:no-target","Missing target for creating viewpoint"));var q=new f({camera:new d({fov:c.camera.fov})}),v=null!=g.scale||null!=g.zoom;if(g.target instanceof f)return K(G(c,g.target,g,q));if(g.target instanceof d)return K(J(c,g,g.target,q));if(g.target instanceof a.Extent)return e=g.target.xmin===g.target.xmax||g.target.ymin===g.target.ymax,v||e?K(F(c,g,g.target.center,
q)):K(I(c,g,g.target,q));var p={boundingBox:t.create(t.NEGATIVE_INFINITY),spatialReference:c.spatialReference,hasZ:!1,screenSpaceObjects:[]};return C(c,g.target,p).then(function(){if(isFinite(p.boundingBox[0])){t.center(p.boundingBox,L);O.x=L[0];O.y=L[1];O.z=L[2];O.spatialReference=c.spatialReference;var d=void 0;isFinite(O.z)&&p.hasZ?d=t.isPoint(p.boundingBox):(O.z=void 0,d=u.isPoint(t.toRect(p.boundingBox,Z)));if(v||d)return F(c,g,O,q);var e=O,d=p.boundingBox,f;f=p.screenSpaceObjects;var k=h.DEFAULT_FRAME_COVERAGE;
if(f.length){for(var m=Number.NEGATIVE_INFINITY,w=0;w<f.length;w++)var x=f[w].screenSpaceBoundingRect,m=Math.max(m,Math.abs(x[0]),Math.abs(x[1]),Math.abs(x[2]),Math.abs(x[3]));f=k-m/Math.min(c.width,c.height)*2}else f=k;k=f;q.targetGeometry=e.clone();f=b.cameraOnContentAlongViewDirection(c);m=0;e.hasZ?m=e.z:c.basemapTerrain&&(m=c.basemapTerrain.getElevation(e));l.vec3d.set3(e.x,e.y,m,L);n.computeLinearTransformation(c.spatialReference,L,M,c.renderSpatialReference);l.mat4d.toMat3(M,V);l.mat3d.transpose(V);
t.set(S,t.NEGATIVE_INFINITY);e=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(w=0;w<e.length;w++){var x=e[w],z=d[x[2]];isFinite(z)||(z=m);l.vec3d.set3(d[x[0]],d[x[1]],z,L);n.vectorToVector(L,c.spatialReference,L,c.renderSpatialReference);t.expand(S,l.mat3d.multiplyVec3(V,L))}d=t.width(S);e=t.height(S);m=t.depth(S);w=1/Math.tan(f.fovY/2);d=Math.max(.5*Math.sqrt(d*d+m*m)*Math.max(w,1/Math.tan(f.fovX/2))+.5*e,.5*e*w+.5*Math.max(d,m))/k;r.internalToExternal(c,f,q.camera);f={noReset:!1};
A(q.camera,g)&&(f.noReset=!0);q.scale=r.distanceToScale(c,d,q.targetGeometry.latitude);d=r.fromCenterScale(c,q.targetGeometry,q.scale,q.camera,f,q.camera)?q:null;return d}if(g.position)return d=b.cameraOnContentAlongViewDirection(c),l.vec3d.set(d.viewForward,R),r.directionToHeadingTilt(c,d.eye,R,d.up,P),q.camera.position=new a.Point(g.position),q.camera.heading=null!=g.heading?g.heading:P.heading,q.camera.tilt=null!=g.tilt?g.tilt:P.tilt,y(c,null,q);d=b.cameraOnContentAlongViewDirection(c);d=n.vectorToPoint(d.center,
c.renderSpatialReference,O,c.spatialReference);return F(c,g,d,q)}).then(function(a){return K(a)})};var L=l.vec3d.create(),M=l.mat4d.create(),V=l.mat3d.create(),S=t.create(),Z=u.create(),R=l.vec3d.create(),N=l.vec3d.create(),D=l.vec3d.create(),P={heading:0,tilt:0},O=new a.Point,Q={point:function(a,c,b){b[0]=a.x;b[1]=a.y;a.hasZ&&(b[2]=a.z);c(b)},polygon:function(a,c,b){for(var d=a.hasZ,e=0;e<a.rings.length;e++)for(var f=a.rings[e],g=0;g<f.length;g++)b[0]=f[g][0],b[1]=f[g][1],d&&(b[2]=f[g][2]),c(b)},
polyline:function(a,c,b){for(var d=a.hasZ,e=0;e<a.paths.length;e++)for(var f=a.paths[e],g=0;g<f.length;g++)b[0]=f[g][0],b[1]=f[g][1],d&&(b[2]=f[g][2]),c(b)},multipoint:function(a,c,b){var d=a.points;a=a.hasZ;for(var e=0;e<d.length;e++)b[0]=d[e][0],b[1]=d[e][1],a&&(b[2]=d[e][2]),c(b)},extent:function(a,c,b){a.hasZ?(c(l.vec3d.set3(a.xmin,a.ymin,a.zmin,b)),c(l.vec3d.set3(a.xmax,a.ymin,a.zmin,b)),c(l.vec3d.set3(a.xmin,a.ymax,a.zmin,b)),c(l.vec3d.set3(a.xmax,a.ymax,a.zmin,b)),c(l.vec3d.set3(a.xmin,a.ymin,
a.zmax,b)),c(l.vec3d.set3(a.xmax,a.ymin,a.zmax,b)),c(l.vec3d.set3(a.xmin,a.ymax,a.zmax,b)),c(l.vec3d.set3(a.xmax,a.ymax,a.zmax,b))):(c(l.vec3d.set3(a.xmin,a.ymin,b[2],b)),c(l.vec3d.set3(a.xmax,a.ymin,b[2],b)),c(l.vec3d.set3(a.xmin,a.ymax,b[2],b)),c(l.vec3d.set3(a.xmax,a.ymax,b[2],b)))},mesh:function(a,c,b){if(a=a.vertexAttributes&&a.vertexAttributes.position)for(var d=0;d<a.length;d+=3)c(l.vec3d.set3(a[d+0],a[d+1],a[d+2],b))}}})},"esri/views/3d/support/CombinedElevationProvider":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ./Evented".split(" "),
function(p,h,d,a,g,f,k){return function(g){function e(a){var b=g.call(this)||this;b.providers={im:[],ground:[],scene:[]};b.handles=new Map;b.elevationChange=function(a){b.emit("elevation-change",a)};return b}d(e,g);e.prototype.getElevation=function(a,d){var b=-Infinity,e=!1;if("scene"===d)for(var f=0,g=this.providers.im;f<g.length;f++){var h=g[f],h=h.getElevation(a,d);null!=h&&(b=Math.max(h,b),!e&&isFinite(b)&&(e=!0))}if(!e)for(e=0,f=this.providers.ground;e<f.length;e++)h=f[e],h=h.getElevation(a,
d),null!=h&&(b=Math.max(h,b));if("scene"===d)for(e=0,f=this.providers.scene;e<f.length;e++)h=f[e],h=h.getElevation(a,d),null!=h&&(b=Math.max(h,b));return isFinite(b)?b:null};e.prototype.register=function(a,d){this.handles.set(d,d.on("elevation-change",this.elevationChange));this.providers[a].push(d)};e.prototype.unregister=function(a){this.handles.has(a)&&(this.handles.get(a).remove(),this.handles.delete(a));for(var b=0,d=Object.keys(this.providers);b<d.length;b++){var e=d[b],f=this.providers[e].indexOf(a);
-1<f&&this.providers[e].splice(f,1)}};a([f.property({constructOnly:!0})],e.prototype,"view",void 0);a([f.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],e.prototype,"spatialReference",void 0);return e=a([f.subclass("esri.views.3d.support.CombinedElevationProvider")],e)}(f.declared(g,k.Evented))})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["require","exports","../../../core/sniff"],function(p,h,d){var a=d("esri-mobile"),g=d("esri-iPhone");p=function(){function a(){}
a.isValidProfile=function(d){return d in a.profiles};a.getDefaultProfile=function(){return d("trident")||g?"low":"medium"};a.apply=function(d,f){d=a.profiles[d];f.sceneService["3dObject"].lodFactor=d.sceneService["3dObject"].lodFactor;f.sceneService.point.lodFactor=d.sceneService.point.lodFactor;f.sceneService.integratedMesh.lodFactor=d.sceneService.integratedMesh.lodFactor;f.sceneService.pointCloud.lodFactor=d.sceneService.pointCloud.lodFactor;f.sceneService.uncompressedTextureDownsamplingEnabled=
d.sceneService.uncompressedTextureDownsamplingEnabled;f.tiledSurface.lodBias=d.tiledSurface.lodBias;f.tiledSurface.angledSplitBias=d.tiledSurface.angledSplitBias;f.antialiasingEnabled=d.antialiasingEnabled;f.gpuMemoryLimit=d.gpuMemoryLimit};return a}();(function(d){d.profiles={low:{sceneService:{"3dObject":{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5},antialiasingEnabled:!1,
gpuMemoryLimit:200},medium:{sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1},antialiasingEnabled:!0,gpuMemoryLimit:a?400:500},high:{sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1},antialiasingEnabled:!0,
gpuMemoryLimit:a?600:1E3}}})(p||(p={}));return p})},"esri/views/3d/support/HighlightOptions":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(p,h,d,a,g,f,k){return function(f){function e(){var a=null!==f&&f.apply(this,arguments)||this;a.color=new g([0,255,255]);a.haloOpacity=1;a.fillOpacity=.25;return a}d(e,f);e.toEngineOptions=function(a){return{color:new Float32Array(g.toUnitRGBA(a.color)),
haloOpacity:a.haloOpacity,haloOpacityOccluded:.25*a.haloOpacity,fillOpacity:a.fillOpacity,fillOpacityOccluded:.25*a.fillOpacity}};a([k.property({type:g})],e.prototype,"color",void 0);a([k.property()],e.prototype,"haloOpacity",void 0);a([k.property()],e.prototype,"fillOpacity",void 0);return e=a([k.subclass()],e)}(k.declared(f))})},"esri/views/3d/support/MapCoordsHelper":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/scaleUtils ../../../portal/support/geometryServiceUtils ../../../tasks/support/ProjectParameters".split(" "),
function(p,h,d,a,g,f,k,m){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function e(a,d,e){void 0===e&&(e=null);var b=this;this.spatialReference=d;this.unitInMeters=f.getMetersPerUnitForSR(this.spatialReference);(this.geometryService=e)||k.create(a&&a.get("portalItem")).then(function(a){b.geometryService=a}).catch(function(){})}e.prototype.toGeographic=function(b){var e=this,f=!0;if(!this.geometryService)return g.reject(new a("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config"));
Array.isArray(b[0])&&"number"!==typeof b[0]||(b=[b],f=!1);b=b.map(function(a){return a instanceof d.Point?a:new d.Point(a,e.spatialReference)});b=new m({geometries:b,outSR:d.SpatialReference.WGS84});return this.geometryService.project(b).then(function(a){a=a.map(function(a){if("point"===a.type)return[a.x,a.y]});return f?a:a[0]})};e.prototype.canProject=function(){return!!this.geometryService};return e}();h.MapCoordsHelper=p;h.default=p})},"esri/views/3d/support/QualitySettings":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/typescript".split(" "),
function(p,h,d,a,g,f){var k=function(b){function e(){return null!==b&&b.apply(this,arguments)||this}d(e,b);a([f.property({value:1})],e.prototype,"lodFactor",void 0);return e=a([f.subclass()],e)}(g),m=function(b){function e(){return null!==b&&b.apply(this,arguments)||this}d(e,b);e.prototype.getDefaults=function(){return{"3dObject":new k,point:new k,integratedMesh:new k,pointCloud:new k,uncompressedTextureDownsamplingEnabled:!1}};a([f.property()],e.prototype,"3dObject",void 0);a([f.property()],e.prototype,
"point",void 0);a([f.property()],e.prototype,"integratedMesh",void 0);a([f.property()],e.prototype,"pointCloud",void 0);a([f.property()],e.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return e=a([f.subclass()],e)}(g),e=function(b){function e(){return null!==b&&b.apply(this,arguments)||this}d(e,b);a([f.property({value:0})],e.prototype,"lodBias",void 0);a([f.property({value:1})],e.prototype,"angledSplitBias",void 0);return e=a([f.subclass()],e)}(g);return function(b){function g(){return null!==
b&&b.apply(this,arguments)||this}d(g,b);g.prototype.getDefaults=function(){return{sceneService:new m,tiledSurface:new e,antialiasingEnabled:!0}};a([f.property()],g.prototype,"sceneService",void 0);a([f.property()],g.prototype,"tiledSurface",void 0);a([f.property()],g.prototype,"antialiasingEnabled",void 0);a([f.property()],g.prototype,"gpuMemoryLimit",void 0);return g=a([f.subclass()],g)}(g)})},"esri/core/accessorSupport/typescript":function(){define(["../declare","../typescript","../JSONSupport",
"dojo/_base/lang"],function(p,h,d,a){function g(a,d){if(!a)return d;if(!d)return a;for(var f in d){var e=a[f],b=d[f];Array.isArray(b)&&Array.isArray(e)?a[f]=e.concat(b):a[f]="object"===typeof b&&"object"===typeof e?g(e,b):b}return a}return{subclass:function(f,k){return function(k){k=h.declareDefinition(k,f);e&&(k.instanceMembers.properties=g(e,k.instanceMembers.properties));var e=k.instanceMembers.properties;if(e)for(var b in e){var l=e[b];l&&!l.reader&&l.type&&(l.type===Date?l.reader=function(a){return null!=
a?new Date(a):null}:-1!==l.type._meta.bases.indexOf(d)&&(l.reader=function(a){return function(b){return a.fromJSON(b)}}(l.type)))}return a.mixin(p(k.bases,k.instanceMembers),k.classMembers)}},shared:h.shared,property:function(a){return function(d,f){var e=Object.getPrototypeOf(d),e=e&&e.properties;d.properties&&d.properties!==e||(d.properties={});d.properties=d.properties||{};d.properties[f]=a||{}}}}})},"esri/core/typescript":function(){define(["./declare","dojo/_base/lang"],function(p,h){var d={declareDefinition:function(a,
d){var f=[],g=Object.getPrototypeOf(a.prototype),h;if(g!==Object.prototype){var e=g.constructor;h=e.prototype;f.push(e)}d&&(f=f.concat(d));d={};for(var e=Object.getOwnPropertyNames(a.prototype),b=0;b<e.length;b++){var l=e[b];if("constructor"!==l){var t=l;"dojoConstructor"===l&&(t="constructor");h&&a.prototype[l]===h[l]||(d[t]=a.prototype[l])}}e=Object.getOwnPropertyNames(a);g=Object.getOwnPropertyNames(g.constructor);h={};for(b=0;b<e.length;b++)l=e[b],-1===g.indexOf(l)&&(h[l]=a[l]);return{bases:f,
instanceMembers:d,classMembers:h}},subclass:function(a){return function(g){g=d.declareDefinition(g,a);return h.mixin(p(g.bases,g.instanceMembers),g.classMembers)}},shared:function(a){return function(d,f){d[f]=a}}};return d})},"esri/views/3d/support/RenderCoordsHelper":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../lib/glMatrix ./earthUtils ./mathUtils ./projectionUtils ../webgl-engine/lib/Util".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l){Object.defineProperty(h,"__esModule",{value:!0});h.createRenderCoordsHelper=function(a,b){return"global"===a?new u(b):new r(b)};var t;(function(a){a[a.X=0]="X";a[a.Y=1]="Y";a[a.Z=2]="Z"})(t=h.BasisDimension||(h.BasisDimension={}));p=function(){function c(a,c){this.spatialReference=a;this.unitInMeters=c}c.prototype.toRenderCoords=function(c,d,e){return c instanceof a?b.pointToVector(c,d,this.spatialReference):b.vectorToVector(c,d,e,this.spatialReference)};c.prototype.fromRenderCoords=
function(c,d,e){return d instanceof a?b.vectorToPoint(c,this.spatialReference,d,e):d instanceof g?b.vectorToPoint(c,this.spatialReference,d):b.vectorToVector(c,this.spatialReference,d,e)};return c}();h.RenderCoordsHelper=p;var u=function(a){function c(c){return a.call(this,c||b.SphericalECEFSpatialReference,1)||this}d(c,a);c.prototype.getAltitude=function(a){return k.vec3d.length(a)-m.earthRadius};c.prototype.setAltitude=function(a,c){a=(a+m.earthRadius)/k.vec3d.length(c);k.vec3d.scale(c,a)};c.prototype.setAltitudeOfTransformation=
function(a,c){var b=c[12],d=c[13],e=c[14];a=(a+m.earthRadius)/Math.sqrt(b*b+d*d+e*e);c[12]=b*a;c[13]=d*a;c[14]=e*a};c.prototype.worldUpAtPosition=function(a,c){return this.worldBasisAtPosition(a,t.Z,c)};c.prototype.worldBasisAtPosition=function(a,c,b){switch(c){case t.X:return e.cartesianToSpherical(a||w,q),a=q[2],k.vec3d.set3(-Math.sin(a),Math.cos(a),0,b);case t.Y:e.cartesianToSpherical(a||w,q);c=q[1];a=q[2];var d=Math.sin(c);return k.vec3d.set3(-d*Math.cos(a),-d*Math.sin(a),Math.cos(c),b);case t.Z:return k.vec3d.normalize(a||
w,b)}};c.prototype.intersectManifold=function(a,c,b,d){void 0===d&&(d=k.vec3d.create());if(!l.raySphere(a,c,null,m.earthRadius+b,q)||0>k.vec3d.dot(k.vec3d.direction(q,a,n),c))return!1;k.vec3d.set(q,d);return!0};return c}(p),r=function(a){function c(c){c=a.call(this,c,f.getMetersPerUnitForSR(c))||this;c.worldX=[1,0,0];c.worldY=[0,1,0];c.worldZ=[0,0,1];return c}d(c,a);c.prototype.getAltitude=function(a,c){return c?a[c+2]:a[2]};c.prototype.setAltitude=function(a,c){c[2]=a};c.prototype.setAltitudeOfTransformation=
function(a,c){c[14]=a};c.prototype.worldUpAtPosition=function(a,c){return k.vec3d.set(this.worldZ,c)};c.prototype.worldBasisAtPosition=function(a,c,b){switch(c){case t.X:return k.vec3d.set(this.worldX,b);case t.Y:return k.vec3d.set(this.worldY,b);case t.Z:return k.vec3d.set(this.worldZ,b)}};c.prototype.intersectManifold=function(a,c,b,d){void 0===d&&(d=k.vec3d.create());k.vec4d.set4(this.worldZ[0],this.worldZ[1],this.worldZ[2],-b,v);if(!l.rayPlane(a,c,v,q)||0>k.vec3d.dot(k.vec3d.direction(q,a,n),
c))return!1;k.vec3d.set(q,d);return!0};return c}(p),v=k.vec4d.create(),q=k.vec3d.create(),n=k.vec3d.create(),w=[0,0,0]})},"esri/views/3d/support/ResourceController":function(){define("../../../core/declare ../../../core/Handles ../../../core/Logger ../../../core/scheduling ./MemoryController ./StreamDataSupplier ./StreamDataLoader ./PreallocArray ../webgl-engine/lib/Performance ../webgl-engine/lib/Util".split(" "),function(p,h,d,a,g,f,k,m,e,b){function l(a){this.budget=this.begin=0;this.performance=
a;this.enabled=!0}var t=b.assert,u={TERRAIN:"terrain",SCENE:"scene",SYMBOLOGY:"symbols"},r=new m(20),v=d.getLogger("esri.views.support.ResourceController");l.prototype.now=function(){return this.performance.now()};l.prototype.reset=function(a){this.begin=this.now();this.budget=this.enabled?a:Number.MAX_VALUE};l.prototype.done=function(){return this.enabled&&this.elapsed()>=this.budget};l.prototype.remaining=function(){return Math.max(this.budget-this.elapsed(),0)};l.prototype.elapsed=function(){return this.now()-
this.begin};p=p(null,{constructor:function(b,d,c){c=c||e;this._clients=[];this._frameWorkers=[];this._nextFrameWorker=0;this._budget=new l(c);this._idleFrameWorkers=[];this._idleFrameWorkerRobin=0;this._idleUpdatesStartFired=!1;this._lastTargetChangeTime=c.now();this._memoryController=new g(b);this.navigationTimeout=300;this.animatingFrameTimeBudget=10;this.idleFrameWorkerBudget=30;this.idleFrameTimeBudget=50;c={};for(var f in u)c[u[f]]=0;c[u.TERRAIN]=15;c[u.SCENE]=20;c[u.SYMBOLOGY]=5;this.streamDataLoader=
new k(c);this._cameraListeners=new h;this._cameraListeners.add([b.watch("state.camera",this._cameraChangedHandler.bind(this),!0)]);d||(d=a);this._frameTask=d.addFrameTask({update:this._frameUpdate.bind(this)});this._view=b;this.stats={frameUpdateTime:new q,idleUpdateTime:new q};this.frameUpdateNavigation=null},destroy:function(){this._frameTask.remove();this._frameTask=null;this._cameraListeners.remove();this.streamDataLoader.destroy();this.streamDataLoader=null},setEnableBudget:function(a){this._budget.enabled=
!!a},isUpdating:function(){return this._memoryController.updating},registerClient:function(a,b,c){this._clients.push({client:a,type:b});this._memoryController.setDirty();return new f(b,this.streamDataLoader,c)},deregisterClient:function(a){for(var b=0;b<this._clients.length;b++)if(this._clients[b].client===a){this._clients[b]=this._clients[this._clients.length-1];this._clients.pop();this._memoryController.setDirty();return}console.warn("deregistering an unregistered client.")},setMaxGpuMemory:function(a){this._memoryController.setMaxGpuMemory(a)},
setMemoryDirty:function(){this._memoryController.setDirty()},getMemoryFactor:function(){return this._memoryController.getMemoryFactor()},getUsedMemory:function(){return this._memoryController.getUsedMemory()},getMemoryEvents:function(){return this._memoryController.events},registerIdleFrameWorker:function(a,b){var c=this._idleFrameWorkers.some(function(c){return c.client===a});t(!c,"Can only register idle frame workers once per client/layer");t(!b.idleFrame||b.needsUpdate,"needsUpdate has to be specified if idleFrame is specified");
this._idleFrameWorkers.push({client:a,callbacks:b});this._isIdle()&&this._idleUpdatesStartFired&&b.idleBegin&&b.idleBegin.call(a)},deregisterIdleFrameWorker:function(a){for(var b=this._idleFrameWorkers,c=0;c<b.length;c++){var d=b[c];if(d.client===a){this._idleUpdatesStartFired&&d.callbacks.idleEnd&&d.callbacks.idleEnd.call(a);b[c]=b[b.length-1];b.pop();break}}},registerFrameWorker:function(a){-1===this._frameWorkers.indexOf(a)&&this._frameWorkers.push(a)},deregisterFrameWorker:function(a){-1===this._frameWorkers.indexOf(a)?
v.warn("Can't deregister unknown frame handler"):(this._frameWorkers.splice(this._frameWorkers.indexOf(a),1),this._nextFrameWorker=0)},_cameraChangedHandler:function(){this._lastTargetChangeTime=this._budget.now();this._memoryController.setDirty();this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._callWorkersNoScheduling("idleEnd"))},_frameUpdate:function(a){var b=this._isIdle()?this.idleFrameWorkerBudget:this.animatingFrameTimeBudget;this._budget.reset(b-a.elapsedFrameTime);this._view.stateManager&&
this._view.stateManager.step(a.deltaTime/1E3);this._view.inputManager&&this._view.inputManager._pinchNavigation&&this._view.inputManager._pinchNavigation.momentum.doFrameUpdate(a.deltaTime);this._memoryController.update();for(a=0;a<this._frameWorkers.length;++a)if(b=(this._nextFrameWorker+a)%this._frameWorkers.length,this._frameWorkers[b](this._budget),3>this._budget.remaining()){this._nextFrameWorker=(b+1)%this._frameWorkers.length;break}this.stats.frameUpdateTime.addSample(this._budget.elapsed());
this._isIdle()&&(this._idleUpdatesStartFired||(this._callWorkersNoScheduling("idleBegin"),this._idleUpdatesStartFired=!0),this._budget.reset(this.idleFrameTimeBudget-this._budget.elapsed()),3<this._budget.remaining()&&(this._callWorkersStrictScheduling("idleFrame",this._budget),this.stats.idleUpdateTime.addSample(this._budget.elapsed())))},_isIdle:function(){return this._budget.now()-this._lastTargetChangeTime>this.navigationTimeout},_callWorkersNoScheduling:function(a){for(var b=this._idleFrameWorkers,
c=0;c<b.length;c++){var d=b[c];d.callbacks[a]&&d.callbacks[a].call(d.client)}},_callWorkersStrictScheduling:function(a,b){var c=this._idleFrameWorkers,d=c.length,e,f,g;r.clear();f=0;for(g=this._idleFrameWorkerRobin;f<d;f++)e=c[g++%d],e.callbacks.needsUpdate&&e.callbacks.needsUpdate.call(e.client)&&(0===r.length&&(this._idleFrameWorkerRobin=g),r.push(e));e=b.now();for(c=e+b.remaining();0<r.length&&e<c;)b.reset((c-e)/r.length),e=r.pop(),e.callbacks[a].call(e.client,b),e=b.now()}});p.ClientType=u;var q=
function(){this.addSample=function(a){this.min=Math.min(this.min,a);this.max=Math.max(this.max,a);this.total+=a;this.numSamples++};this.getAverage=function(){return this.total/this.numSamples};this.reset=function(){this.numSamples=this.total=0;this.min=Number.MAX_VALUE;this.max=-Number.MAX_VALUE};this.reset()};return p})},"esri/views/3d/support/MemoryController":function(){define(["require","exports","../../../core/Logger","../layers/support/MemoryManagedLayerView","./Evented"],function(p,h,d,a,g){var f=
d.getLogger("esri.views.3d.support.MemoryController");return function(){function d(a){this._view=a;this._minQuality=.1;this._memoryHWM=this._maxQuality=1;this._memoryLWM=.8;this._divideRate=1.5;this.events=new g.Evented;this._maxMemory=500;this._quality=1;this._memoryCached=this._memoryCommitted=this._memoryUsed=this._stableQuality=0;this.updating=!1}d.prototype.setMaxGpuMemory=function(a){a&&0<a&&(this._maxMemory=a,this.setDirty())};d.prototype.getMemoryFactor=function(){return this._quality};d.prototype._updateQuality=
function(a){a=Math.min(Math.max(a,this._minQuality),this._maxQuality);if(a===this._quality)return!1;this._quality=a;this.events.emit("quality-changed",this._quality);return!0};d.prototype.getUsedMemory=function(){return this._memoryUsed};d.prototype.setDirty=function(){this._stableQuality=0};d.prototype.update=function(){this._updateMemory();if(!(0>=this._memoryCommitted)){this._unloadSuspended();var a=this._layersUpdating();if(a){if(this._quality<=this._minQuality)return;if(this._memoryCommitted>
1.1*this._memoryHWM||this._memoryUsed>this._memoryHWM)0<this._stableQuality?this._updateQuality(this._stableQuality):this._updateQuality(this._quality/this._divideRate)}else{if(this._memoryCommitted>this._memoryHWM||this._memoryUsed>this._memoryHWM)this._stableQuality=0,a=this._updateQuality(this._quality/this._divideRate);this._memoryCommitted<this._memoryLWM&&this._quality<this._maxQuality&&this._stableQuality!==this._quality&&(this._stableQuality=this._quality,a=this._updateQuality(this._quality+
.1*(this._memoryLWM-this._memoryCommitted+.1)))}this.updating!==a&&(this.updating=a,this.events.emit("updating-changed",this.updating))}};d.prototype._layersUpdating=function(){var a=!1;this._view.allLayerViews.forEach(function(d){a=a||d.updating});return a};d.prototype._unloadSuspended=function(){var d=this,e=function(){return 0===d._memoryCached?!1:d._memoryCommitted>1.1*d._memoryHWM||d._memoryUsed>d._memoryHWM||d._memoryUsed>=d._memoryLWM&&.9>d._quality};if(e())for(var b=this._view.allLayerViews.toArray().filter(function(a){return a.suspended}),
f=function(){var d=null,e=0;b.forEach(function(b){if(a.isMemoryManagedLayerView(b)){var f=b.getUsedMemory();f>e&&(e=f,d=b)}});if(!d)return{value:void 0};d.removeCachedData();b.splice(b.indexOf(d),1);g._updateMemory()},g=this;e()&&0<b.length;){var h=f();if("object"===typeof h)return h.value}};d.prototype._updateMemory=function(){var d=0,e=0,b=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&(d+=this._view.basemapTerrain.getUsedMemory());var g=this._view._stage&&this._view._stage.view&&
this._view._stage.view.getEdgeView();g&&(d+=g.getGpuMemoryUsage());this._view.allLayerViews&&this._view.allLayerViews.forEach(function(f){if(a.isMemoryManagedLayerView(f)){var g=f.getUsedMemory();d+=g;f.suspended&&(b+=g);e+=f.getUnloadedMemory()}});d>this._maxMemory&&d!==this._warnMemoryUsage&&(this._warnMemoryUsage=d,g=function(a){return a.toLocaleString(void 0,{maximumFractionDigits:1})+" Mb"},f.warn("GPU Memory Limit exceeded! Limit: "+g(this._maxMemory)+" Current: "+g(d)+" Projected: "+g(d+e)));
this._memoryUsed=d/this._maxMemory;this._memoryCommitted=(d+e-b)/this._maxMemory;this._memoryCached=b/this._maxMemory};return d}()})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});h.isMemoryManagedLayerView=function(d){return"function"===typeof d.getUsedMemory}})},"esri/views/3d/support/StreamDataSupplier":function(){define(["require","exports"],function(p,h){return function(){function d(a,
d,f){this._clientType=a;this._loader=d;this._activeRequests=null;f&&f.trackRequests&&(this._activeRequests=new Map)}d.prototype.request=function(a,d){var f=this;d=this._loader.request(a,d,this._clientType);if(this._activeRequests){this._activeRequests.set(a,d);var g=function(){f._activeRequests.delete(a)};d.then(g,g)}return d};d.prototype.cancelRequest=function(a){this._loader.cancel(a)};d.prototype.cancelAll=function(){var a=this;this._activeRequests&&(this._activeRequests.forEach(function(d){a._loader.cancel(d)}),
this._activeRequests.clear())};d.prototype.hasPendingDownloads=function(){return this._loader.hasPendingDownloads()};return d}()})},"esri/views/3d/support/StreamDataLoader":function(){define("require exports ../../../request ./AsyncQuotaRoundRobinQueue ./PromiseLightweight ../webgl-engine/lib/Performance ../webgl-engine/lib/Util".split(" "),function(p,h,d,a,g,f,k){function m(a,g){if(a.status===e.CANCELLED)return!1;a.status=e.DOWNLOADING;var b,h;switch(a.docType){case "binary":h="array-buffer";b=0;
break;case "image":h="image";break;default:h="json"}a.startTime=f.now();a.downloadObj=d(a.url,{responseType:h,timeout:b,allowImageDataAccess:"image"===a.docType});a.downloadObj.then(function(b){a.duration=f.now()-a.startTime;a.size="binary"===a.docType?b.data.byteLength:0;a.result=b.data;g(a)},function(b){a.downloadObj.isCanceled()||g(a,b)});return!0}var e;(function(a){a[a.QUEUED=1]="QUEUED";a[a.DOWNLOADING=2]="DOWNLOADING";a[a.CANCELLED=4]="CANCELLED"})(e||(e={}));return function(){function b(b){this.tasks=
new Map;this.loadQueue=new a(m,this._doneLoadingCallback,this,b)}b.prototype.destroy=function(){var a=this;this.tasks.forEach(function(b,d){d.isRejected()||d.reject(b.url,null);a._cancelTask(d)});this.loadQueue.clear();this.tasks=this.loadQueue=null};b.prototype.request=function(a,b,d){var f=this,h=new g.Promise(function(){f.cancel(h)});a={url:a,docType:b,clientType:d,result:null,status:e.QUEUED,clientPromise:h,downloadObj:null,_cancelledInQueue:!1,startTime:0,duration:0,size:0};this.tasks.set(h,
a);this.loadQueue.push(a);return h};b.prototype.cancel=function(a){this._cancelTask(a)};b.prototype.hasPendingDownloads=function(){return 0<this.tasks.size};b.prototype._cancelTask=function(a){var b=this.tasks.get(a);b&&(b.status===e.DOWNLOADING&&(this.loadQueue.workerCancelled(b),b.status=e.CANCELLED,b.downloadObj.cancel(),b.downloadObj=null),b.status=e.CANCELLED,b.clientPromise=void 0,this.tasks.delete(a))};b.prototype._doneLoadingCallback=function(a,b){k.assert(a.status===e.DOWNLOADING);this.tasks.delete(a.clientPromise);
b?a.clientPromise.isRejected()||a.clientPromise.reject(a.url,b):a.clientPromise.done(a.url,a.result)};return b}()})},"esri/views/3d/support/AsyncQuotaRoundRobinQueue":function(){define(["require","exports","../../../core/arrayUtils","../webgl-engine/lib/Util"],function(p,h,d,a){return function(){function g(a,d,g,e){this.workerFunc=a;this.robin=0;this.type2id={};this.tasks=[];this.typeNumWorkers=[];this.typeWorkerQuota=[];this.typeStatistics=[];this.numTypes=this.maxTotalNumWorkers=this.totalNumWorkers=
0;for(var b in e)this.tasks[this.robin]=[],this.typeNumWorkers[this.robin]=0,this.typeStatistics[this.robin]={requests:0,size:0,duration:0,speed:0},this.typeWorkerQuota[this.robin]=e[b],this.type2id[b]=this.robin++,this.maxTotalNumWorkers+=e[b];this.numTypes=this.tasks.length;this.robin=0;var f=this;this.taskCallback=function(a){a._cancelledInQueue||(d.apply(g,arguments),f.taskFinished(a))}}g.prototype.setWorkerQuota=function(f){a.assert(d.equals(Object.keys(this.typeWorkerAllication),Object.keys(f)));
this.typeWorkerAllication=f;this.maxTotalNumWorkers=0;for(var g in f)this.typeWorkerQuota[this.type2id[g]]=f[g],this.maxTotalNumWorkers+=f[g]};g.prototype.setWorkerFunc=function(a){this.workerFunc=a};g.prototype.push=function(a){var d=this.type2id[a.clientType];this.totalNumWorkers<this.maxTotalNumWorkers?(this.typeNumWorkers[d]++,this.totalNumWorkers++,this.workerFunc(a,this.taskCallback)):this.tasks[d].push(a)};g.prototype._getStatsForType=function(a){a=this.type2id[a];return{quota:this.typeWorkerQuota[a],
workers:this.typeNumWorkers[a],queueSize:this.tasks[a].length,requestStats:this.typeStatistics[a]}};g.prototype.removeTasks=function(a,d){for(var f=[],e=0,b=this.tasks[this.type2id[d]];e<b.length;e++){var g=b[e];-1===a.indexOf(g)&&f.push(g)}this.tasks[this.type2id[d]]=f};g.prototype.workerCancelled=function(a){this.taskFinished(a);a._cancelledInQueue=!0};g.prototype.clear=function(){for(var a=0;a<this.tasks.length;a++)this.tasks[a]=[]};g.prototype.taskFinished=function(d){var f=this.type2id[d.clientType];
this.typeNumWorkers[f]--;this.totalNumWorkers--;this.typeStatistics[f].requests++;this.typeStatistics[f].size+=d.size||0;this.typeStatistics[f].duration+=d.duration||0;this.typeStatistics[f].speed=0<this.typeStatistics[f].duration?this.typeStatistics[f].size/this.typeStatistics[f].duration:0;a.assert(0<=this.typeNumWorkers[f]);this.next()};g.prototype.next=function(){var a=this.robin,d=!1;do this.typeNumWorkers[a]<this.typeWorkerQuota[a]&&this.processQueue(a)&&(d=!0),a=(a+1)%this.numTypes;while(!d&&
a!==this.robin);if(!d){do this.processQueue(a)&&(d=!0),a=(a+1)%this.numTypes;while(!d&&a!==this.robin)}this.robin=a};g.prototype.processQueue=function(a){for(;0<this.tasks[a].length;)if(this.workerFunc(this.tasks[a].shift(),this.taskCallback))return this.typeNumWorkers[a]++,this.totalNumWorkers++,!0;return!1};return g}()})},"esri/views/3d/support/SharedSymbolResources":function(){define("require exports ../../../core/Handles ../../../core/watchUtils ./ResourceController ./TextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),
function(p,h,d,a,g,f,k){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function e(a){this.streamDataSupplier=this.textures=null;this.graphicsOwners=[];this.screenSizePerspectiveHandles=null;var b=g.ClientType.SYMBOLOGY;this.viewState=a.viewState;this.stage=a.stage;this.pointsOfInterest=a.pointsOfInterest;this.resourceController=a.resourceController;this.streamDataSupplier=this.resourceController.registerClient(this,b);this.textures=new f(this.streamDataSupplier,a.stage,{preMultiplyAlpha:!0,
wrapClamp:!0});this.screenSizePerspectiveSettings=k.getSettings(a.viewingMode);this.screenSizePerspectiveSettingsLabels=k.getLabelSettings(a.viewingMode)}e.prototype.destroy=function(){this.resourceController.deregisterClient(this);this.streamDataSupplier=this.textures=null};e.prototype.addGraphicsOwner=function(b){var d=this;this.graphicsOwners.push(b);var e=null;b.layerView&&(e=a.init(b.layerView,"layer.screenSizePerspectiveEnabled",function(){return d.updateScreenSizePerspectiveEnabled()}));return{remove:function(){e&&
(e.remove(),e=null,d.updateScreenSizePerspectiveEnabled())}}};e.prototype.updateScreenSizePerspectiveEnabled=function(){var a=this,e=this.graphicsOwners.some(function(a){return a.layerView&&!0===a.layerView.get("layer.screenSizePerspectiveEnabled")});e&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new d,e=function(){return a.updateScreenSizePerspectiveSettings()},this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",e,!0),
this.pointsOfInterest.events.on("camera-parameters-changed",e)]),this.updateScreenSizePerspectiveSettings()):!e&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};e.prototype.updateScreenSizePerspectiveSettings=function(){m.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;m.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(m);this.screenSizePerspectiveSettingsLabels.update(m);this.stage.setNeedsRender()};
return e}();h.SharedSymbolResources=p;var m={distance:0,fovY:0};h.default=p})},"esri/views/3d/support/TextureCollection":function(){define("../../../core/declare ../../../core/urlUtils dojo/Deferred dojo/_base/lang ../webgl-engine/Stage ../webgl-engine/lib/Texture ../webgl-engine/lib/Util".split(" "),function(p,h,d,a,g,f,k){var m=k.assert;return p(null,{constructor:function(a,b,d){this._streamDataSupplier=a;this._stage=b;this._textureRecords={};this._loadedHandler=this._loadedHandler.bind(this);this._errorHandler=
this._errorHandler.bind(this);this._textureOptions=d||{}},acquire:function(a,b,f){var e;if(e=this._textureRecords[a])return e.referenceCount++,e.texture||e.clientDfd;if(b)return f=b(a),this._stage.add(g.ModelContentType.TEXTURE,f),e={texture:f,referenceCount:1},this._textureRecords[a]=e,f;e=new d;b=this._streamDataSupplier.request(a,"image");this._textureRecords[a]={clientDfd:e,loaderDfd:b,texture:null,size:Math.ceil(f||0),referenceCount:1};b.then(this._loadedHandler,this._errorHandler);return e.promise},
release:function(a){var b=this._textureRecords[a];b?(1>b.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),b.referenceCount--,1>b.referenceCount&&(b.texture?(this._stage.remove(g.ModelContentType.TEXTURE,b.texture.id),b.texture=null):this._streamDataSupplier.cancelRequest(b.loaderDfd),delete this._textureRecords[a])):console.warn("TextureCollection: texture doesn't exist: "+a)},isInUse:function(a){a=this._textureRecords[a];m(!a||0<a.referenceCount,"texture record with zero reference count");
return!!a},_loadedHandler:function(d,b){var e=this._textureRecords[d];m(e&&!e.texture);if(h.isSVG(d)&&(e.size||0===b.width&&0===b.height)){d=b.width?b.height/b.width:1;var k=e.size||64;1<d?(b.width=Math.round(k/d),b.height=k):(b.width=k,b.height=Math.round(k*d))}d=a.mixin({width:b.width,height:b.height},this._textureOptions);b=new f(b,"symbol",d);this._stage.add(g.ModelContentType.TEXTURE,b);e.texture=b;e.clientDfd.resolve(b)},_errorHandler:function(a){a=this._textureRecords[a];m(a&&!a.texture);a.clientDfd.reject()}})})},
"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../lib/glMatrix ../Evented ../PropertiesPool ./CenterOnSurface ./ContentGeometryUpdates ./disposeMembers ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Selector".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w){Object.defineProperty(h,"__esModule",{value:!0});var c=Array;p=function(g){function h(a){a=g.call(this,a)||this;a.handles=new f;a.lastSeenCameraParameters=new n;a.surfaceAltitudeAtCenter=0;a.surfaceAltitudeAtCenterDirty=!0;a.surfaceAltitudeAtCenterWithContent=0;a.surfaceAltitudeAtCenterWithContentDirty=!0;a.propertiesPool=new l.default({pointOfView:m,renderPointOfView:c},a);a.updateSurfaceAltitudeFrequentInterval=A;a.updateSurfaceAltitudeInfrequentInterval=
y;a.events=new b.Evented;a.renderPointOfView=[0,0,0];return a}d(h,g);h.prototype.initialize=function(){var a=this,c=this.view.state,b=this.view.basemapTerrain,d=this.view.renderCoordsHelper;this.surfaceSelector=new w(c.mode);this.surfaceSelector.enableBackfacesTerrain=c.isGlobal?!1:!0;this.surfaceSelector.enableInvisibleTerrain=!1;this.contentSelector=new w(c.mode);this.contentSelector.enableTerrain=!1;var e=this.estimateSurfaceAltitudeAtCenter.bind(this);this._set("centerOnSurfaceInfrequent",new t.default({state:c,
surface:b,renderCoordsHelper:d,estimateSurfaceAltitudeAtCenter:e,altitudeEstimationInterval:this.updateSurfaceAltitudeInfrequentInterval}));this._set("centerOnSurfaceFrequent",new t.default({state:c,surface:b,renderCoordsHelper:d,estimateSurfaceAltitudeAtCenter:e,altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));this._set("centerOnContent",new t.default({state:c,surface:b,renderCoordsHelper:d,estimateSurfaceAltitudeAtCenter:this.estimateSurfaceAltitudeAtCenterWithContent.bind(this),
altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));this._set("surfaceGeometryUpdates",new q.default({state:c,surface:b,renderCoordsHelper:d,centerOnSurfaceInstances:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new u.default({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:d}));this._set("surfaceOrigin",new v.default({view:this.view}));this.handles.add(c.watch("camera",function(c){return a.cameraChanged(c)},
!0));this.handles.add(this.surfaceGeometryUpdates.events.on("request-update",function(){return a.updateCenterPointsOfInterest()}));this.handles.add(b.watch("extent",function(){return a.updateCenterPointsOfInterest()}));this.handles.add(this.contentGeometryUpdates.events.on("request-update",function(){return a.updateCenterOnContent()}));this.cameraChanged(this.view.state.camera);this.forceUpdate()};h.prototype.destroy=function(){r.default(this,"handles","centerOnSurfaceInfrequent","centerOnSurfaceFrequent",
"centerOnContent","surfaceOrigin","propertiesPool")};Object.defineProperty(h.prototype,"pointOfView",{get:function(){var a=this.propertiesPool.get("pointOfView");this.view.renderCoordsHelper.fromRenderCoords(this.renderPointOfView,a,this.view.state.spatialReference);return a},enumerable:!0,configurable:!0});h.prototype.forceUpdate=function(){this.surfaceGeometryUpdates.forceUpdate();this.centerOnSurfaceInfrequent.forceUpdate();this.centerOnSurfaceFrequent.forceUpdate();this.centerOnContent.forceUpdate()};
h.prototype.hasPendingUpdates=function(){return this.surfaceGeometryUpdates.hasPendingUpdates()||this.centerOnContent.hasPendingUpdates()||this.centerOnSurfaceInfrequent.hasPendingUpdates()||this.centerOnSurfaceFrequent.hasPendingUpdates()};h.prototype.estimateSurfaceAltitudeAtCenterWithContent=function(){if(!this.surfaceAltitudeAtCenterWithContentDirty)return this.surfaceAltitudeAtCenterWithContent;this.surfaceAltitudeAtCenterWithContentDirty=!1;var a=this.view.state.camera;this.view._stage.pickRay(a.eye,
a.center,null,null,null,!1,this.contentSelector);this.contentSelector.minResult.getIntersectionPoint(z)?this.surfaceAltitudeAtCenterWithContent=this.view.renderCoordsHelper.getAltitude(z):this.surfaceAltitudeAtCenterWithContent=this.estimateSurfaceAltitudeAtCenter();return this.surfaceAltitudeAtCenterWithContent};h.prototype.estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this.surfaceAltitudeAtCenterDirty)return this.surfaceAltitudeAtCenter;this.surfaceAltitudeAtCenterDirty=
!1;var a=this.view.state.camera;this.surfaceSelector.init(null,a.eye,a.center,null,a,null,!1);this.view.basemapTerrain.intersect(this.surfaceSelector,a.eye,a.center);this.surfaceSelector.minResult.getIntersectionPoint(z)&&(this.surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(z));return this.surfaceAltitudeAtCenter};h.prototype.cameraChanged=function(a){this.updateCenterPointsOfInterest(a);this.cameraParametersChanged(this.lastSeenCameraParameters,a)&&(this.lastSeenCameraParameters.copyFrom(a),
x.camera=a,this.events.emit("camera-parameters-changed",x));a=a.eye;this.renderPointOfView[0]===a[0]&&this.renderPointOfView[1]===a[1]&&this.renderPointOfView[2]===a[2]||this._set("renderPointOfView",e.vec3d.set(a,this.propertiesPool.get("renderPointOfView")))};h.prototype.updateCenterPointsOfInterest=function(a){void 0===a&&(a=this.view.state.camera);this.surfaceAltitudeAtCenterWithContentDirty=this.surfaceAltitudeAtCenterDirty=!0;this.centerOnSurfaceFrequent.update(a);this.centerOnSurfaceInfrequent.update(a);
this.centerOnContent.update(a)};h.prototype.updateCenterOnContent=function(){this.surfaceAltitudeAtCenterWithContentDirty=!0;this.centerOnContent.update(this.view.state.camera)};h.prototype.cameraParametersChanged=function(a,c){return a.fov!==c.fov||a.fullViewport[0]!==c.fullViewport[0]||a.fullViewport[1]!==c.fullViewport[1]||a.fullViewport[2]!==c.fullViewport[2]||a.fullViewport[3]!==c.fullViewport[3]||a.padding[0]!==c.padding[0]||a.padding[1]!==c.padding[1]||a.padding[2]!==c.padding[2]||a.padding[3]!==
c.padding[3]?!0:!1};a([k.property({constructOnly:!0})],h.prototype,"updateSurfaceAltitudeFrequentInterval",void 0);a([k.property({constructOnly:!0})],h.prototype,"updateSurfaceAltitudeInfrequentInterval",void 0);a([k.property({readOnly:!0})],h.prototype,"centerOnContent",void 0);a([k.property({readOnly:!0})],h.prototype,"centerOnSurfaceFrequent",void 0);a([k.property({readOnly:!0})],h.prototype,"centerOnSurfaceInfrequent",void 0);a([k.property({readOnly:!0})],h.prototype,"surfaceOrigin",void 0);a([k.property({readOnly:!0})],
h.prototype,"contentGeometryUpdates",void 0);a([k.property({readOnly:!0})],h.prototype,"events",void 0);a([k.property({readOnly:!0,dependsOn:["renderPointOfView"]})],h.prototype,"pointOfView",null);a([k.property({readOnly:!0})],h.prototype,"renderPointOfView",void 0);a([k.property({readOnly:!0})],h.prototype,"surfaceGeometryUpdates",void 0);a([k.property({constructOnly:!0})],h.prototype,"view",void 0);return h=a([k.subclass("esri.views.3d.support.PointsOfInterest")],h)}(k.declared(g));h.PointsOfInterest=
p;var x={camera:null},z=e.vec3d.create(),A=200,y=3E3;h.default=p})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/throttle ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../lib/glMatrix ../debugFlags ../earthUtils ../mathUtils ../PropertiesPool ./PointOfInterest".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,t,u){Object.defineProperty(h,
"__esModule",{value:!0});var r=Array;p=function(h){function n(a){a=h.call(this,a)||this;a.propertiesPool=new t.default({location:k,renderLocation:r},a);a.currentSurfaceAltitude=0;a.latestSurfaceAltitude=0;a.distance=0;a.renderLocation=[0,0,0];return a}d(n,h);c=n;n.prototype.initialize=function(){this.measureSurfaceAltitudeThrottle=g.throttle(this.measureSurfaceAltitude,this.altitudeEstimationInterval,this);this.handles.add(this.measureSurfaceAltitudeThrottle);this.measureSurfaceAltitude()};Object.defineProperty(n.prototype,
"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});n.prototype.update=function(a){this.measureSurfaceAltitudeThrottle();this.updateCenterOnSurface()};n.prototype.forceUpdate=function(){this.measureSurfaceAltitudeThrottle.forceUpdate();this.updateCenterOnSurface()};n.prototype.hasPendingUpdates=function(){return this.measureSurfaceAltitudeThrottle.hasPendingUpdates()};
Object.defineProperty(n.prototype,"estimatedSurfaceAltitude",{get:function(){return this.latestSurfaceAltitude},enumerable:!0,configurable:!0});n.prototype.measureSurfaceAltitude=function(){this.latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this.updateCenterOnSurface()};n.prototype.updateCenterOnSurface=function(){var a=v,c=this.calculateSurfaceIntersection(this.currentSurfaceAltitude,a),b=this.currentSurfaceAltitude!==this.latestSurfaceAltitude;!c&&b&&(c=this.calculateSurfaceIntersection(this.latestSurfaceAltitude,
a))&&(this.currentSurfaceAltitude=this.latestSurfaceAltitude);b=q;c&&this.latestSurfaceAltitudeChangesDistanceSignificantly(a,b)&&(m.vec3d.set(b,a),this.currentSurfaceAltitude=this.latestSurfaceAltitude);c?(c=m.vec3d.dist(this.state.camera.eye,a),c!==this._get("distance")&&this._set("distance",c)):(c=this.state.camera,m.vec3d.add(m.vec3d.scale(c.viewForward,this._get("distance"),a),c.eye));c=this._get("renderLocation");c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]||this._set("renderLocation",m.vec3d.set(a,
this.propertiesPool.get("renderLocation")))};n.prototype.calculateSurfaceIntersection=function(a,c){var d=this.state.camera;if(!this.renderCoordsHelper.intersectManifold(d.eye,d.viewForward,a,c))return!1;if(this.state.isGlobal){a=b.earthRadius+a;var e=m.vec3d.length2(d.eye),f=e<a*a,g=m.vec3d.dist(d.eye,c);f&&g>b.earthRadius/4&&m.vec3d.add(m.vec3d.scale(d.viewForward,a-Math.sqrt(e),c),d.eye)}else if(d=this.surface.ready&&this.surface.extent)c[0]=l.clamp(c[0],d[0],d[2]),c[1]=l.clamp(c[1],d[1],d[3]);
return!0};n.prototype.latestSurfaceAltitudeChangesDistanceSignificantly=function(a,b){if(this.latestSurfaceAltitude===this.currentSurfaceAltitude||null==a)return!1;if(this.calculateSurfaceIntersection(this.latestSurfaceAltitude,b)){var d=this.state.camera.eye;a=m.vec3d.dist(d,a);b=m.vec3d.dist(d,b);if(e.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS||Math.abs(b-a)/a>c.RELATIVE_ALTITUDE_CHANGE_THRESHOLD)return!0}return!1};n.RELATIVE_ALTITUDE_CHANGE_THRESHOLD=.05;a([f.property({constructOnly:!0})],n.prototype,
"altitudeEstimationInterval",void 0);a([f.property({readOnly:!0})],n.prototype,"distance",void 0);a([f.property({constructOnly:!0})],n.prototype,"estimateSurfaceAltitudeAtCenter",void 0);a([f.property({readOnly:!0,dependsOn:["renderLocation"]})],n.prototype,"location",null);a([f.property({readOnly:!0})],n.prototype,"renderLocation",void 0);return n=c=a([f.subclass("esri.views.3d.support.CenterOnSurface")],n);var c}(f.declared(u.PointOfInterest));h.CenterOnSurface=p;var v=m.vec3d.create(),q=m.vec3d.create();
h.default=p})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ./disposeMembers".split(" "),function(p,h,d,a,g,f,k,m){Object.defineProperty(h,"__esModule",{value:!0});p=function(e){function b(a){a=e.call(this)||this;a.handles=new f;return a}d(b,e);b.prototype.destroy=function(){m.default(this,
"handles")};a([k.property({constructOnly:!0})],b.prototype,"renderCoordsHelper",void 0);a([k.property({constructOnly:!0})],b.prototype,"surface",void 0);a([k.property({constructOnly:!0})],b.prototype,"state",void 0);return b=a([k.subclass("esri.views.3d.support.PointOfInterest")],b)}(k.declared(g));h.PointOfInterest=p;h.default=p})},"esri/views/3d/support/pointsOfInterest/disposeMembers":function(){define(["require","exports","../../../../core/Accessor"],function(p,h,d){function a(a){for(var f=[],
g=1;g<arguments.length;g++)f[g-1]=arguments[g];if(a instanceof d&&a.destroyed)try{throw Error("instance is already destroyed");}catch(b){console.warn(b.stack)}else for(g=0;g<f.length;g++){var h=f[g];if(!(h in a))throw Error("Property '"+h+"' does not exist and cannot be disposed");var e=a[h];e&&("function"===typeof e.destroy?e.destroy():"function"===typeof e.dispose?e.dispose():"function"===typeof e.remove&&e.remove());a instanceof d&&h in a.__accessor__.metadatas?a._set(h,null):a[h]=null}}Object.defineProperty(h,
"__esModule",{value:!0});h.disposeMembers=a;h.default=a})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["require","exports","../../../../core/Handles","../Evented"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function f(f){this.handles=new d;this.events=new a.Evented;this.contentLayerViews=f.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",this.layerViewsChanged.bind(this)));this.layerViewsChanged({added:this.contentLayerViews.toArray(),
removed:[],moved:[],target:this.contentLayerViews})}f.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};f.prototype.layerViewsChanged=function(a){var d=this;a.added.forEach(function(a){"esri.views.3d.layers.SceneLayerView3D"===a.declaredClass&&d.handles.add(a.on("visible-geometry-changed",d.contentChanged.bind(d)),a.uid)});a.removed.forEach(function(a){return d.handles.remove(a.uid)})};f.prototype.contentChanged=function(){this.events.emit("request-update",g)};
return f}();h.ContentGeometryUpdates=p;var g={};h.default=p})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../aaBoundingRect".split(" "),function(p,h,d,a,g,f,k,m,e,b){Object.defineProperty(h,"__esModule",{value:!0});
p=function(g){function h(a){a=g.call(this,a)||this;a.location=null;a._updatePromise=null;a._handles=new f;return a}d(h,g);Object.defineProperty(h.prototype,"renderLocation",{get:function(){if(!this.location)return null;var a=[0,0,0];this.view.renderCoordsHelper.toRenderCoords(this.location,a);return a},enumerable:!0,configurable:!0});h.prototype.initialize=function(){var a=this;this.view.state.isLocal&&(this._handles.add([this.watch("surfaceView.extent",function(){return a._update()}),k.on(this,"surface.layers",
"change",function(){return a._update()})]),this._update())};h.prototype.destroy=function(){this._handles.destroy()};h.prototype._update=function(){var a=this;this._updatePromise&&(this._updatePromise.cancel("cancel"),this._updatePromise=null);if(this.surfaceView&&this.surfaceView.extent){var d=b.center(this.surfaceView.extent),d=new e({x:d[0],y:d[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updatePromise=this.surface.queryElevation(d,
{noDataValue:0}).then(function(b){a._updatePromise=null;a._set("location",b.geometry)}).catch(function(a){"cancel"===a||a&&"elevation-query:invalid-layer"===a.name||console.error("StableSurfaceCenter failed to update: ",a)})):this._set("location",d)}else this._set("location",null)};a([m.property({constructOnly:!0})],h.prototype,"view",void 0);a([m.property({readOnly:!0,aliasOf:"view.map.ground"})],h.prototype,"surface",void 0);a([m.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],h.prototype,
"surfaceView",void 0);a([m.property({readOnly:!0})],h.prototype,"location",void 0);a([m.property({readOnly:!0,dependsOn:["location"]})],h.prototype,"renderLocation",null);return h=a([m.subclass("esri.views.3d.terrain.StableSurfaceCenter")],h)}(m.declared(g));h.StableSurfaceCenter=p;h.default=p})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("require exports ../../../../core/Handles ../../../../core/scheduling ../../lib/glMatrix ../aaBoundingRect ../debugFlags ../Evented".split(" "),
function(p,h,d,a,g,f,k,m){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function g(a){var b=this;this.handles=new d;this.tileGeometryUpdateExtent=f.create(f.NEGATIVE_INFINITY);this.tileGeometryUpdateSpatialReference=null;this.hasPendingTileGeometryChanges=!0;this.events=new m.Evented;this.centerOnSurfaceInstances=a.centerOnSurfaceInstances;this.renderCoordsHelper=a.renderCoordsHelper;this.state=a.state;this.handles.add(a.surface.on("elevation-change",function(a){return b.tileGeometryChangeHandler(a)}))}
g.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};g.prototype.forceUpdate=function(){this.handles.has("tile-geometry-update")&&this.updateCenterOnGeometryUpdate();this.hasPendingTileGeometryChanges&&(this.events.emit("request-update",e),this.hasPendingTileGeometryChanges=!1)};g.prototype.hasPendingUpdates=function(){return this.handles.has("tile-geometry-update")};g.prototype.tileGeometryChangeHandler=function(b){var d=this;this.tileGeometryUpdateSpatialReference=
b.spatialReference;f.expand(this.tileGeometryUpdateExtent,b.tile.extent);this.handles.has("tile-geometry-update")||this.handles.add(a.schedule(function(){return d.updateCenterOnGeometryUpdate()}),"tile-geometry-update")};g.prototype.updateCenterOnGeometryUpdate=function(){this.handles.remove("tile-geometry-update");this.centerIntersectsExtent(this.tileGeometryUpdateExtent,this.tileGeometryUpdateSpatialReference)&&(k.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES?this.hasPendingTileGeometryChanges=
!0:this.events.emit("request-update",e));f.set(this.tileGeometryUpdateExtent,f.NEGATIVE_INFINITY)};g.prototype.furthestCenterOnSurface=function(){for(var a=this.centerOnSurfaceInstances[0],b=1;b<this.centerOnSurfaceInstances.length;b++){var d=this.centerOnSurfaceInstances[b];d.distance>a.distance&&(a=d)}return a};g.prototype.centerIntersectsExtent=function(a,d){var e=this.state.camera.eye,g=t,h=this.furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(e,b,d);this.renderCoordsHelper.fromRenderCoords(h.renderLocation,
l,d);b[0]<l[0]?(g[0]=b[0],g[2]=l[0]):(g[0]=l[0],g[2]=b[0]);b[1]<l[1]?(g[1]=b[1],g[3]=l[1]):(g[1]=l[1],g[3]=b[1]);return f.intersects(g,a)};return g}();h.SurfaceGeometryUpdates=p;var e={},b=g.vec3d.create(),l=g.vec3d.create(),t=f.create(f.NEGATIVE_INFINITY);h.default=p})},"esri/views/3d/terrain/TerrainSurface":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Handles ../../../core/Logger ../../../core/ObjectPool ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/Point ../lib/glMatrix ../support/aaBoundingRect ../support/Evented ../support/mathUtils ../support/PreallocArray ../support/projectionUtils ../support/PromiseLightweight ../support/ResourceController ./OverlayManager ./PlanarTile ./SphericalTile ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainConst ./TerrainRenderer ./terrainUtils ./TileGeometryFactory ./TilemapOnlyTile ./tileUtils ./tileUtils ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x,z,A,y,B,E,C,G,J,F,I,H,K,L,M,V){function S(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]}function Z(a){return a&&("cancel"===a||"cancel"===a.dojoType)}function R(a,c){var b=!1;c=c||a;var d=0;for(a=a.children;d<a.length;d++){var e=a[d];if(e){for(var f in e.layerInfo)for(var g in e.layerInfo[f]){var h=e.layerInfo[f][g].upsampleFromTile;if(h&&h.tile===c)return!0}b=b||R(e,c)}}return b}var N=r.vec3d,D=r.vec4d,P=r.mat4d,O=F.weakAssert,Q=e.getLogger("esri.views.3d.terrain.TerrainSurface");
p=function(e){function g(a,c){a=e.call(this)||this;a.defaultTileBackground=G.DEFAULT_TILE_BACKGROUND;a.hideSkirtsDistanceFromExtentMargin=T;a.hideSkirtsMinimumCameraTilt=da;a._clippingExtent=null;a._dataExtent=null;a._elevationBounds=[0,0];a._rootExtent=[0,0,0,0];a._iteratorPool=new b(L.IteratorPreorder);a._postorderIterator=new L.IteratorPostorder;a.visible=!1;a.suspended=!1;a._pendingUpdates=!1;a._lvPendingUpdates=!1;a._updateNextFrame=0;a._vectorTileLayerRequests=0;a._memoryUsage={};a._curOverlayOpacity=
1;a._curEyePos=N.create();a._curSplitLimits=[0,0,0,0,0,0];a._curFrustumPlanes=Array(6);a._viewProjectionMatrix=P.identity();a.tilemapStats={tilemapRequestsSent:0,tilemapRequestsPending:0,tilemapRequestErrors:0,fullTilemaps:0,emptyTilemaps:0,tilesRequested:0,tileRequestsSent:0,tileRequestErrors:0,tilesNotPresent:0};a._layerViews=[[],[]];a._layerIndexByLayerViewId=[{},{}];a._basemapLayerViewHandles={};a._handles=new m;a._frameLambda=null;a._frameUpdateLowerPrio=new w(500);a._topLevelTilemapOnlyTiles=
Array(G.TILEMAP_SIZE_EXP+1);a.loaded=!1;a.maxTextureScale=1.2;a.rootTiles=null;for(c=0;c<a._topLevelTilemapOnlyTiles.length;c++)a._topLevelTilemapOnlyTiles[c]=new H([c-G.TILEMAP_SIZE_EXP,0,0]);for(c=0;6>c;c++)a._curFrustumPlanes[c]=D.create();return a}d(g,e);g.prototype.normalizeCtorArgs=function(a,c){this._view=a;this._stage=a._stage;this._set("manifold",c);return{}};g.prototype.initialize=function(){var a=this;this.tilePool="planar"===this.manifold?y.Pool:B.Pool;this._renderer=new J(this.manifold,
null,this._view.pointsOfInterest);this._renderer.loaded=this._setLoaded.bind(this);this._renderer.updateTileBackground(this.tileBackground);this._renderer.install(this._view._stage);this._set("overlayManager",new A({terrainSurface:this,view:this._view}));this._handles.add(this.watch("overlayManager.hasHighlights",this._handleHasHighlights.bind(this)),"overlayManager");var c={layers:this._view.map.allLayers,layerViews:this._view.allLayerViews,spatialReference:this._view.spatialReference};this.extentHelper=
"spherical"===this.manifold?new E.SurfaceExtentHelperGlobal(c):new E.SurfaceExtentHelperLocal(c);this._handles.add(l.init(this.extentHelper,"stencilEnabledExtents",function(c){a._renderer.setStencilEnabledLayerExtents(c)}),"extentHelper");c=this._view.defaultsFromMap?new k({root:this._view.map,rootCollectionNames:this._view.defaultsFromMap.mapCollectionPaths,getChildrenFunction:function(a){return a.layers}}):this._view.map.allLayers;c=new C({layers:c,extentHelper:this.extentHelper,manifold:this.manifold,
viewSpatialReference:this._view.spatialReference});this._set("tilingSchemeLogic",c);this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",this._updateTilingSchemeAndExtent.bind(this),!0),this.tilingSchemeLogic.watch("extent",this._updateTilingSchemeAndExtent.bind(this),!0)],"tilingSchemeLogic");this._updateTilingSchemeAndExtent();this._streamDataSupplier=this._view.resourceController.registerClient(this,z.ClientType.TERRAIN);c={needsUpdate:this._needsIdleUpdate,idleFrame:this._idleUpdate};
this._frameLambda=this._frameUpdate.bind(this);this._view.resourceController.registerFrameWorker(this._frameLambda);this._view.resourceController.registerIdleFrameWorker(this,c);this._viewChangeUpdate=this._viewChangeUpdate.bind(this);this._view.resourceController.getMemoryEvents().on("quality-changed",function(){return a._viewChangeUpdate()});this._handles.add([this._view.on("resize",this._viewChangeUpdate),this._view.watch("state.camera",this._viewChangeUpdate,!0),this._view.watch("qualitySettings.tiledSurface.lodBias",
this._viewChangeUpdate),this._view.watch("clippingArea",this._clippingChanged.bind(this))],"view");this._handles.add(this._view.allLayerViews.on("change",this._handleLayerViewChanges.bind(this)),"allLayerViews");this._handleLayerViewChanges({added:this._view.allLayerViews.toArray(),removed:[],moved:[],target:this._view.allLayerViews});this._updateClippingExtent();this.notifyChange("extent")};g.prototype.destroy=function(){this._handles.destroy();this._removeAllTiles();this.tilingSchemeLogic.destroy();
this._set("tilingSchemeLogic",null);this.extentHelper.destroy();this.extentHelper=null;for(var a in this._basemapLayerViewHandles)this._unregisterTiledLayerView(a);this._view.resourceController.deregisterFrameWorker(this._frameLambda);this._view.resourceController.deregisterIdleFrameWorker(this);this._view.resourceController.deregisterClient(this);this.overlayManager&&(this.overlayManager.destroy(),this._set("overlayManager",null));this._renderer.destroy(this._stage);this._streamDataSupplier=this._stage=
this._view=this._renderer=null};Object.defineProperty(g.prototype,"cullBackFaces",{set:function(a){this._renderer.setCullBackFaces(a);this._set("cullBackFaces",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"extent",{get:function(){return this._clippingExtent||this._rootExtent},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"frontMostTransparent",{set:function(a){this._renderer.setFrontMostTransparent(a);this._set("frontMostTransparent",a)},enumerable:!0,
configurable:!0});Object.defineProperty(g.prototype,"opacity",{set:function(a){this._renderer.setOpacity(a);this._set("opacity",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"ready",{get:function(){return!!this.rootTiles},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"renderOrder",{set:function(a){this._renderer.setRenderOrder(a);this._set("renderOrder",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"skirts",{set:function(a){this._renderer.setDrawSkirts(a);
this._set("skirts",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"tileBackground",{set:function(a){a!==this.tileBackground&&this._renderer.updateTileBackground(a);this._set("tileBackground",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"velvetOverground",{set:function(a){a!==this.velvetOverground&&this._renderer.setVelvetOverground(a);this._set("velvetOverground",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"wireframe",{set:function(a){this._renderer.setWireframe(a);
this._set("wireframe",a);this._view._stage.setRenderParams({earlyOcclusionPixelDraw:a})},enumerable:!0,configurable:!0});g.prototype.setVisibility=function(a){a!==this.visible&&(this.visible=a,this._renderer.setVisibility(a),this.setUpdatesDisabled(!a),a&&this._viewChangeUpdate())};g.prototype.isVisible=function(){return this.visible&&this.ready};g.prototype.isSeeThrough=function(){return this._renderer.isTransparent()};g.prototype.setUpdatesDisabled=function(a){(this.suspended=a)||this._viewChangeUpdate()};
g.prototype.intersect=function(a,c,b){this._renderer.intersect(a,c,b)};g.prototype.getElevation=function(a){if(!this.ready)return null;var b=this.rootTiles;if(0===b[0].layerInfo[G.LayerClass.ELEVATION].length)return null;if(a instanceof u){if(!c.pointToVector(a,ba,this.tilingScheme.spatialReference))return Q.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;a=ba}for(var d,e=0;e<b.length;e++){var f=b[e];if(K.isPosWithinTile(f,a)){for(;f&&
!f.renderData;)b=0,a[0]>.5*(f.extent[0]+f.extent[2])&&(b+=1),a[1]<.5*(f.extent[1]+f.extent[3])&&(b+=2),f=f.children[b];d=(b=f.renderData)&&b.geometryState?b.geometryState.samplerData:null;break}}return d?I.elevationSampler(a[0],a[1],d):null};g.prototype.getElevationBounds=function(){return this._elevationBounds};g.prototype.getScale=function(a){if(this.tilingScheme){if(!c.pointToVector(a,ba,this.spatialReference))return Q.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),
null;if(this.rootTiles)for(var b=0;b<this.rootTiles.length;b++)if(a=this.rootTiles[b],K.isPosWithinTile(a,ba)){for(;a.children[0];)b=0,ba[0]>a.children[0].extent[2]&&(b+=1),ba[1]<a.children[0].extent[1]&&(b+=2),a=a.children[b];return this._getLodBiasCorrectedScale(a.lij[0])}}return 1E100};g.prototype.queryVisibleScaleRange=function(a,c,b,d){c=c?this.tilingScheme.levelAtScale(c):0;b=b?this.tilingScheme.levelAtScale(b):Infinity;var e=this._getLodBias();this._renderer.queryVisibleLevelRange(a,c+e,b+
e,d)};g.prototype._setLoaded=function(){this.loaded||this._set("loaded",!0)};g.prototype._updateTilingSchemeAndExtent=function(){var a=this.tilingSchemeLogic.extent,c=this.tilingSchemeLogic.tilingScheme,b=!1;a&&!v.equals(a,this._dataExtent)&&(b=!0,this._dataExtent?v.set(this._dataExtent,a):this._dataExtent=v.create(a));c!==this.tilingScheme&&(O(!!c,"tiling scheme cannot be reset to undefined"),b=!0,this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",c),this._updateClippingExtent(),
c&&(this._updateTiledLayers(),this._renderer.setTileSize(c.pixelSize[0]),this.overlayManager.setSpatialReference(c.spatialReference,"spherical"===this.manifold)));b&&this._updateRootTiles()};g.prototype._acquireTile=function(a,c,b,d){var e=this.tilePool.acquire();ea[0]=a;ea[1]=c;ea[2]=b;e.init(ea,d,this,this.tilingScheme);return e};g.prototype._releaseTile=function(a){a.dispose();a.parent=null;a.parentSurface=null;this.tilePool.release(a)};g.prototype._updateRootTiles=function(){var a=this,c=this._clippingExtent||
this._dataExtent,b=this.tilingScheme;if(c&&b){var d=ba,e=b.rootTilesInExtent(c,d,Infinity);if(this.rootTiles){if(e.length>U){Q.warn(G.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}var c=this.rootTiles.map(function(a){return a.lij}),g=f.difference(c,e,S);if(0<g.removed.length||0<g.added.length){var h=this.rootTiles.filter(function(c){return-1<f.findIndex(g.removed,S.bind(null,c.lij))?(a._purgeChildTiles(c),a._purgeTile(c),!1):!0});g.added.forEach(function(c){c=a._acquireTile(0,c[1],c[2],null);h.push(c);
a._loadTile(c)});this._set("rootTiles",h);this._renderer.setRootTiles(this.rootTiles)}}else e.length>U&&(Q.warn(G.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),e=b.rootTilesInExtent(c,d,U)),this._set("rootTiles",e.map(function(c){c=a._acquireTile(0,c[1],c[2],null);a._loadTile(c);return c})),this._renderer.setRootTiles(this.rootTiles);f.equals(d,this._rootExtent)||(this._rootExtent=D.create(d),this._hasFixedExtent()||this.notifyChange("extent"));this.setVisibility(!0);this._viewChangeUpdate();this.overlayManager.setOverlayDirty();
this.notifyChange("ready")}};g.prototype._viewChangeUpdate=function(){this._stage&&!this.suspended&&this.tilingScheme&&this.visible&&(this._updateViewDependentParameters(),this._updateOverlayOpacity(this._curEyePos),this._updateTiles(this.rootTiles))};g.prototype._updateClippingStatus=function(a){a.updateClippingStatus(this._clippingExtent)&&a.pendingUpdates&X.UPDATE_GEOMETRY&&(this._renderer.updateTileGeometryNeedsUpdate(a),this._updateTileGeometry(a),a.pendingUpdates&=~X.UPDATE_GEOMETRY)};g.prototype._updateTiles=
function(a){var c=this._iteratorPool.acquire();c.reset(a);var b=this._curSplitLimits,d=this._curFrustumPlanes,e=this._curEyePos,f;K.hasVisibleSiblings(a)?(a=this._elevationBounds[0],f=this._elevationBounds[1]):(a=Infinity,f=-Infinity);for(;!c.done;){var g=c.next();this._updateClippingStatus(g);var h=!0;if(g.updateVisibility(d,e)){g.updateScreenDepth(this._viewProjectionMatrix);g.renderData&&(a=Math.min(g.elevationBounds[0],a),f=Math.max(g.elevationBounds[1],f));var k=g.shouldSplit(b,e);k===X.SPLIT?
(g.pendingUpdates&=~X.MERGE,g.renderData?(h=!1,g.pendingUpdates|=X.SPLIT,c.skip()):h=!1):(g.pendingUpdates&=~X.SPLIT,k===X.VSPLITMERGE&&g.updateAgents(G.LayerClass.ELEVATION),c.skip())}else c.skip();if(h&&!g.renderData){g.pendingUpdates|=X.MERGE;g.pendingUpdates&=~X.SPLIT;h=this._iteratorPool.acquire();for(h.reset(g);!h.done;)k=h.next(),this._updateClippingStatus(k),k.updateVisibility(d,e),k.visible&&k.updateScreenDepth(this._viewProjectionMatrix);this._iteratorPool.release(h)}0!==g.pendingUpdates&&
(this._pendingUpdates=!0)}this._iteratorPool.release(c);isFinite(a)&&isFinite(f)&&(this._elevationBounds[0]!==a||this._elevationBounds[1]!==f)&&(this._elevationBounds[0]=a,this._elevationBounds[1]=f,this.emit("elevation-bounds-change",null))};g.prototype._updateViewDependentParameters=function(){var a=this._view.state.camera,c=Math.tan(.5*a.fovX),b=Math.tan(.5*a.fovY),d=this.tilingScheme.pixelSize,e=Math.pow(2,-this._getLodBias());this._curSplitLimits[0]=c;this._curSplitLimits[1]=d[0]/a.width*this.maxTextureScale*
e;this._curSplitLimits[2]=b;this._curSplitLimits[3]=d[1]/a.height*this.maxTextureScale*e;this._curSplitLimits[4]=this.tilingScheme.getMaxLod();this._curSplitLimits[5]=this._view.qualitySettings.tiledSurface.angledSplitBias;a.copyFrustumPlanes(this._curFrustumPlanes);P.multiply(a.projectionMatrix,a.viewMatrix,this._viewProjectionMatrix);N.set(a.eye,this._curEyePos);F.autoUpdateSkirtsVisibility(this,this._curEyePos)};g.prototype._setLayerViewsUpdating=function(){for(var a=0;a<G.LayerClass.LAYER_CLASS_COUNT;a++)for(var c=
this._layerViews[a],b=0;b<c.length;b++)c[b]._evaluateUpdatingState(this._pendingUpdates)};g.prototype._frameUpdateTraversal=function(a){if(this.suspended)return!1;this._frameUpdateLowerPrio.clear();var c=this._renderer.resourceCounter.numTileTexturesComposited,b=this._iteratorPool.acquire();b.reset(this.rootTiles);for(var d=!1,e=!1;!b.done&&(1<a.remaining()||!d)&&this._renderer.resourceCounter.numTileTexturesComposited-c<aa;){var f=b.next();f.pendingUpdates&X.MERGE?(this._mergeTile(f),f.pendingUpdates&=
~X.MERGE,d=!0,b.skip()):f.pendingUpdates&X.SPLIT?(this._splitTile(f),f.pendingUpdates&=~X.SPLIT,d=!0,b.skip()):0<f.pendingUpdates&&this._frameUpdateLowerPrio.push(f);0!==f.pendingUpdates&&(e=!0)}this._pendingUpdates=e||!b.done;this._iteratorPool.release(b);return d};g.prototype._updateTileGeometry=function(a){this._renderer._updateTileGeometry(a);W.spatialReference=this.spatialReference;W.tile=a;W.extent=a.extent;this.emit("elevation-change",W)};g.prototype._updateTileTexture=function(a){this._renderer.updateTileTexture(a)};
g.prototype._frameUpdate=function(a){if(this.rootTiles){for(var c=this._frameUpdateTraversal(a);(1<a.remaining()||!c)&&0<this._frameUpdateLowerPrio.length;){var b=this._frameUpdateLowerPrio.pop();b.pendingUpdates&X.DECODE_ELEVATION?(this._decodeElevation(b),b.pendingUpdates&=~X.DECODE_ELEVATION,c=!0):b.pendingUpdates&X.UPDATE_GEOMETRY?(this._renderer.updateTileGeometryNeedsUpdate(b),this._updateTileGeometry(b),c=!0,b.pendingUpdates&=~X.UPDATE_GEOMETRY):b.pendingUpdates&X.UPDATE_TEXTURE&&(this._updateTileTexture(b),
b.pendingUpdates&=~X.UPDATE_TEXTURE,c=!0);0!==b.pendingUpdates&&(this._pendingUpdates=!0)}0<this._frameUpdateLowerPrio.length&&(this._pendingUpdates=!0);if(this._streamDataSupplier.hasPendingDownloads()||0!==this._vectorTileLayerRequests)this._pendingUpdates=!0;this._pendingUpdates===this._lvPendingUpdates||!this._pendingUpdates&&20!==++this._updateNextFrame||(this._setLayerViewsUpdating(),this._lvPendingUpdates=this._pendingUpdates,this._updateNextFrame=0);c&&(this._memoryUsage={})}};g.prototype._needsIdleUpdate=
function(){return this.isVisible()&&this.overlayManager&&this.overlayManager.overlaysNeedUpdate()};g.prototype._idleUpdate=function(){this.overlayManager.updateOverlay();this._updateOverlayOpacity(this._curEyePos)};g.prototype._updateClippingExtent=function(){if(!this.spatialReference)return!1;var a=[0,0,0,0],b=null;c.extentToBoundingRect(this._view.clippingArea,a,this.spatialReference)&&(b=a);if(f.equals(b,this._clippingExtent))return!1;this._clippingExtent=b;this._renderer.clippingExtent=b;this.notifyChange("extent");
this.overlayManager.setOverlayDirty();return!0};g.prototype._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()};g.prototype._getLodBias=function(){var a=this._view.resourceController.getMemoryFactor();return Math.round(this._view.qualitySettings.tiledSurface.lodBias+2*a-2)};g.prototype._getLodBiasCorrectedScale=function(a){var c=this.tilingScheme.levels;a=n.clamp(a-this._getLodBias(),0,c.length-1);return c[a].scale};g.prototype._cancelTilemapRequests=function(a){for(var c=
0;c<G.LayerClass.LAYER_CLASS_COUNT;c++){var b=a.layerInfo[c];if(b)for(var d=0;d<b.length;d++){var e=b[d];e.tilemapRequest&&(e.tilemapRequest.cancel(),e.tilemapRequest=null)}}};g.prototype._removeAllTiles=function(){var a=this;this.rootTiles&&(this.rootTiles.forEach(function(c){a._purgeChildTiles(c);a._purgeTile(c)}),this._set("rootTiles",null),this.notifyChange("ready"));for(var c=0;c<this._topLevelTilemapOnlyTiles.length;c++)this._cancelTilemapRequests(this._topLevelTilemapOnlyTiles[c]);this.setVisibility(!1)};
g.prototype._purgeChildTiles=function(a){var c=this._postorderIterator;for(c.reset(a);!c.done;){for(var b=c.next(),d=0;4>d;d++)b.children[d]=null;b!==a&&this._purgeTile(b)}};g.prototype._purgeTile=function(a){a.unload(this._renderer);this._cancelTilemapRequests(a);a.parent=null;this._releaseTile(a)};g.prototype._splitTile=function(a){var c=a.lij[0]+1,b=2*a.lij[1],d=2*a.lij[2];a.children[0]=this._createTile(c,b,d,a);a.children[1]=this._createTile(c,b,d+1,a);a.children[2]=this._createTile(c,b+1,d,a);
a.children[3]=this._createTile(c,b+1,d+1,a);a.unload(this._renderer);ca.spatialReference=this.spatialReference;ca.extent=a.extent;ca.scale=this._getLodBiasCorrectedScale(c);this.emit("scale-change",ca)};g.prototype._createTile=function(a,c,b,d){O(!!d,"_createTile sanity check");a=this._acquireTile(a,c,b,d);a.updateClippingStatus(this._clippingExtent);a.updateVisibility(this._curFrustumPlanes,this._curEyePos);a.visible&&(a.updateScreenDepth(this._viewProjectionMatrix),a.shouldSplit(this._curSplitLimits,
this._curEyePos)===X.SPLIT&&(a.pendingUpdates|=X.SPLIT,this._pendingUpdates=!0));this._loadTile(a);return a};g.prototype._mergeTile=function(a){O(!a.renderData,"_mergeTile sanity check");this._loadTile(a);this._purgeChildTiles(a);ca.spatialReference=this.spatialReference;ca.extent=a.extent;ca.scale=this._getLodBiasCorrectedScale(a.lij[0]);this.emit("scale-change",ca)};g.prototype._loadTile=function(a){a.load(this._renderer);this.overlayManager&&this.overlayManager.hasOverlays()&&this.overlayManager.setOverlayParamsOfTile(a,
a.renderData,this._curOverlayOpacity);W.spatialReference=this.spatialReference;W.tile=a;W.extent=a.extent;this.emit("elevation-change",W)};g.prototype._handleHasHighlights=function(a){this._renderer.setNeedsHighlight(a)};g.prototype._decodeElevation=function(a){var c=G.LayerClass.ELEVATION,b=a.layerInfo[c];if(b)for(var d=0;d<b.length;d++){var e=b[d];e.pendingUpdates&=~X.DECODE_ELEVATION;if(e.rawData){var f=a.decodeElevationData(e.rawData);e.rawData=null;if(f){e.data=f;var e=a.lij[0],g=this._iteratorPool.acquire();
for(g.reset(a);!g.done;){var h=g.next();h.findElevationBoundsForLayer(d,e);h.computeElevationBounds()}this._iteratorPool.release(g);a.dataArrived(d,c,f);this._updateTiles(a)}}}};g.prototype._handleLayerViewChanges=function(a){var c=this,b=!1;a.added.forEach(function(a){var d=a.layer;F.isTiledLayerView(a)?(c._registerTiledLayer(a),d.loaded&&(b=!0)):a.supportsDraping&&c.overlayManager&&c.overlayManager.registerLayerView(a)});a.removed.forEach(function(a){F.isTiledLayerView(a)?(b=!0,c._unregisterTiledLayerView(a.uid)):
a.supportsDraping&&c.overlayManager&&c.overlayManager.unregisterLayerView(a)});(b=b||0<a.moved.filter(F.isTiledLayerView).length)&&this._updateTiledLayers()};g.prototype._registerTiledLayer=function(a){var c=this,b=[];b.push(a.watch("suspended",function(){c._updateTiledLayers()}));b.push(a.watch("fullOpacity",function(){return c._updateTileTextures()}));a.on("data-changed",function(){var b=F.isElevationLayerView(a)?G.LayerClass.ELEVATION:G.LayerClass.MAP,d=c._layerIndexByLayerViewId[b][a.uid];null!=
d&&c._invalidateLayerData(d,b)});this._basemapLayerViewHandles[a.uid]=b};g.prototype._unregisterTiledLayerView=function(a){var c=this._basemapLayerViewHandles[a];if(c){for(var b=0;b<c.length;b++)c[b].remove();delete this._basemapLayerViewHandles[a]}};g.prototype._updateTiledLayers=function(){var a=this;if(this.tilingScheme){var c=this._view.allLayerViews,b=[[],[]],d=G.LayerClass,e=null,f=v.create(v.NEGATIVE_INFINITY);c.forEach(function(c){var g=c.layer;if(c.layer&&c&&!c.suspended&&F.isTiledLayerView(c)){var h=
c.fullExtent;h?a.tilingScheme.compatibleWith(c.tileInfo)?(v.expand(f,h),F.isElevationLayerView(c)?b[d.ELEVATION].push(c):(Infinity!==c.maxDataLevel&&(null===e||c.maxDataLevel>e)&&(e=c.maxDataLevel),b[d.MAP].push(c))):Q.warn("Terrain: tiling scheme of layer "+g.id+" is incompatible with other tiled layers, will not be drawn"):Q.warn("Terrain: Map or elevation layer does not have fullExtent: "+g.id)}},this);for(var c=function(a){var c=g._layerViews[a],e=b[a];e.reverse();var f=c.length!==e.length,h=
e.length,k=Array(h),l=Array(c.length);g._layerIndexByLayerViewId[a]={};for(var n=0;n<h;n++){g._layerIndexByLayerViewId[a][e[n].uid]=n;var m=c.indexOf(e[n]);k[n]=m;n!==m&&(f=!0);-1<m&&(l[m]=n)}if(f){g._topLevelTilemapOnlyTiles.forEach(function(c){return c.modifyLayers(l,k,a)});c=g._postorderIterator;if(g.rootTiles)for(c.reset(g.rootTiles);!c.done;)c.next().modifyLayers(l,k,a);g._layerViews[a]=e;if(g.rootTiles){for(c.reset(g.rootTiles);!c.done;)e=c.next(),e.restartAgents(a),a===d.ELEVATION&&e.computeElevationBounds();
g._updateTiles(g.rootTiles)}}},g=this,h=0;h<d.LAYER_CLASS_COUNT;h++)c(h);this.tilingScheme.levels.length-1<e&&(this.tilingScheme.ensureMaxLod(e),this._viewChangeUpdate())}};g.prototype._hasFixedExtent=function(){return!!this._clippingExtent};g.prototype.layerViewByIndex=function(a,c){return this._layerViews[c][a]};g.prototype.numLayers=function(a){return this._layerViews[a].length};g.prototype.numTotalLayers=function(){return this._layerViews.reduce(function(a,c){return c.length+a},0)};g.prototype._updateTileTextures=
function(){var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;)a.next().updateTexture();this._iteratorPool.release(a)};g.prototype._invalidateLayerData=function(a,c){var b=this._iteratorPool.acquire();for(b.reset(this.rootTiles);!b.done;)b.next().removeLayerAgent(a,c);for(b.reset(this.rootTiles);!b.done;)b.next().invalidateLayerData(a,c);this._iteratorPool.release(b)};g.prototype.requestTileData=function(a,c,b){var d=this;this.tilemapStats.tilesRequested++;var e=this.layerViewByIndex(c,
b),f=e.layer;if(f.tilemapCache&&!F.isVectorTileLayerView(e)){var g=this.getTilemapTile(a),h=g.layerInfo[b][c];if(h.tilemap){if(!g.tileDataAvailable(a,c,b))return this.tilemapStats.tilesNotPresent++,this._dispatchDataEvent(a,"dataMissing",b,e,{notInTilemap:!0}),c=new x.Promise,c.reject(),c}else{h.tilemapRequest||(h.tilemapRequest=this.requestTilemap(g,c,b,e,f));var k,l=new x.Promise(function(){k&&k.cancel()});h.tilemapRequest.always(function(){h.tilemapRequest=null;if(!l.isCancelled()){var c=d._layerIndexByLayerViewId[b][e.uid];
null!=c&&(g.tileDataAvailable(a,c,b)?(k=d._requestTileData(a,c,b,e),k.then(function(){return l.resolve()})):(d.tilemapStats.tilesNotPresent++,d._dispatchDataEvent(a,"dataMissing",b,e,{notInTilemap:!0}),l.reject()))}});return l}}return this._requestTileData(a,c,b,e)};g.prototype._requestTileData=function(a,c,b,d){this.tilemapStats.tileRequestsSent++;return b===G.LayerClass.ELEVATION?this._requestElevationTileData(a,c,b,d):this._requestMapTileData(a,c,b,d)};g.prototype._requestElevationTileData=function(a,
c,b,d){function e(c){var e=g._layerIndexByLayerViewId[b][d.uid];null!=e?(e=a.layerInfo[b][e],e.rawData=c,a.pendingUpdates|=X.DECODE_ELEVATION,e.pendingUpdates|=X.DECODE_ELEVATION,g._pendingUpdates=!0):Q.warn("TerrainSurface: received data from unknown layer %d %s",b,a.lij.toString())}function f(c){Z(c)||(g.tilemapStats.tileRequestErrors++,g._dispatchDataEvent(a,"dataMissing",b,d,c))}var g=this,h;F.isElevationLayerView(d)?(c=d.layer,F.useFetchTileForLayer(c)?(h=c.fetchTile(a.lij[0],a.lij[1],a.lij[2],
G.ELEVATION_NODATA_VALUE),h.then(function(a){return e(a)},f)):(c=d.getTileUrl(a.lij[0],a.lij[1],a.lij[2]),h=this._streamDataSupplier.request(c,"binary"),h.then(function(a,c){c.url=a;e(c)},f))):O(!1,"_requestElevationTileData can only be called for elevation layer views");return h};g.prototype._requestMapTileData=function(a,c,b,d){function e(c){g._dispatchDataEvent(a,"dataArrived",b,d,c)}function f(c){Z(c)||(g._dispatchDataEvent(a,"dataMissing",b,d,c),g.tilemapStats.tileRequestErrors++)}var g=this;
if(F.isVectorTileLayerView(d)){var h=d.tileHandler;c=d.schemeHelper.getCompatibleLevelRowCol(a.lij);c=h.getVectorTileWithLRC(c[0],c[1],c[2],0);c.then(e).catch(f).always(function(){g._vectorTileLayerRequests=h.ongoingRequestCount});this._vectorTileLayerRequests=h.ongoingRequestCount}else F.useFetchTileForLayer(d.layer)&&F.isTileLayerView(d)?(c=d.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2]),c.then(e).catch(f)):(c=d.getTileUrl(a.lij[0],a.lij[1],a.lij[2]),null!=d.refreshInterval&&d.refreshTimestamp&&(c+=
(-1<c.indexOf("?")?"\x26":"?")+"_ts\x3d"+d.refreshTimestamp),c=this._streamDataSupplier.request(c,"image"),c.then(function(a,c){return e(c)},f));return c};g.prototype.requestTilemap=function(a,c,b,d,e){var f=this,g=a.lij[0]+G.TILEMAP_SIZE_EXP,h=a.lij[1]<<G.TILEMAP_SIZE_EXP,k=a.lij[2]<<G.TILEMAP_SIZE_EXP;this.tilemapStats.tilemapRequestsSent++;this.tilemapStats.tilemapRequestsPending++;return e.tilemapCache.fetchTilemap(g,h,k,{timeout:6E3}).then(function(e){f.tilemapStats.tilemapRequestsPending--;
c=f._layerIndexByLayerViewId[b][d.uid];null!=c&&(a.layerInfo[b][c].tilemap=e)}).catch(function(a){f.tilemapStats.tilemapRequestsPending--;f.tilemapStats.tilemapRequestErrors++})};g.prototype.getTilemapTile=function(a){var c=a.lij[0];return c>G.TILEMAP_SIZE_EXP?K.getTileNLevelsUp(a,G.TILEMAP_SIZE_EXP):this._topLevelTilemapOnlyTiles[c]};g.prototype._dispatchDataEvent=function(a,c,b,d,e){d=this._layerIndexByLayerViewId[b][d.uid];if(null!=d)a[c](d,b,e);else Q.warn("TerrainSurface: received data from unknown layer")};
g.prototype._updateTileOverlayParams=function(){if(this.rootTiles){var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;){var c=a.next();c.renderData&&this.overlayManager&&this.overlayManager.setOverlayParamsOfTile(c,c.renderData,this._curOverlayOpacity)}this._iteratorPool.release(a);this._renderer.setNeedsRender()}};g.prototype._updateOverlayOpacity=function(a){if(this.overlayManager&&(a=this.overlayManager.updateOpacity(a),!isNaN(a))){if(a!==this._curOverlayOpacity&&this.rootTiles){var c=
this._iteratorPool.acquire();for(c.reset(this.rootTiles);!c.done;){var b=c.next();b.renderData&&b.renderData.overlayTexId&&(b.renderData.overlayOpacity=a)}this._iteratorPool.release(c)}this._curOverlayOpacity=a;this._renderer.setNeedsRender()}};g.prototype.getStats=function(){var a=0,c=0,b=0,d=[],e=this._iteratorPool.acquire();for(e.reset(this.rootTiles);!e.done;){var f=e.next();a++;f.renderData&&(c++,f.visible&&(b++,f=f.lij[0],d[f]=null!=d[f]?d[f]+1:1))}this._iteratorPool.release(e);return{numNodes:a,
numLeaves:c,numVisible:b,numVisiblePerLevel:d}};g.prototype.getUsedMemory=function(){if(!this._view||!this._view.basemapTerrain)return 0;var a=this._view.basemapTerrain.getMemoryUsage(),c=0,b;for(b in a)c+=a[b];return c/1024/1024};g.prototype.getMemoryUsage=function(){0===Object.keys(this._memoryUsage).length&&this._updateMemoryUsage();return this._memoryUsage};g.prototype._updateMemoryUsage=function(){if(this.tilingScheme){var a=0,c=0,b=0,d=0,e=0,f=0,g=this._iteratorPool.acquire();g.reset(this.rootTiles);
for(var h=this.tilingScheme.pixelSize,h=h[0]*h[1]*4;!g.done;){for(var k=g.next(),l=R(k),n=0,m=k.layerInfo[G.LayerClass.MAP];n<m.length;n++){var r=m[n],r=r.data,q=0,t=0;r instanceof V?q+=1.3*r.descriptor.width*r.descriptor.height*4:r instanceof HTMLImageElement?t+=h:r instanceof M&&(f+=r.getGpuMemoryUsage(),b+=r.getCpuMemoryUsage());k.renderData||l?(a+=t,d+=q):(c+=t,e+=q)}l=0;for(n=k.layerInfo[G.LayerClass.ELEVATION];l<n.length;l++)r=n[l],r=r.data,a+=r?h:0;k.renderData&&(r=k.renderData.texture,d+=
r&&r.descriptor?1.3*r.descriptor.width*r.descriptor.height*4:0,k=k.renderData.estimateGeometryMemoryUsage(),f+=k,b+=k)}this._iteratorPool.release(g);this._memoryUsage={cpuVisibleImageData:a,cpuInvisibleImageData:c,cpuGeometryData:b,gpuVisibleImageData:d,gpuInvisibleImageData:e,gpuGeometryData:f}}};g.prototype.getTile=function(a){var c=a.split("/").map(function(a){return+a});if(0===c[0])return this.rootTiles.forEach(function(a){if(a.lij[1]===c[1]&&a.lij[2]===c[2])return a}),null;var b=Math.pow(2,c[0]),
d=Math.floor(c[1]/b),e=Math.floor(c[2]/b),f;this.rootTiles.some(function(a){return a.lij[1]===d&&a.lij[2]===e?(f=a,!0):!1});if(f){for(b=1<<c[0]-1;f.lij[0]<c[0];){var g=c[1]&b?2:0;0<(c[2]&b)&&g++;if(!f.children[g])return console.log("Tile "+a+" doesn't exist, smallest ancestor is "+K.tile2str(f)),null;f=f.children[g];b>>=1}O(f.lij[0]===c[0]&&f.lij[1]===c[1]&&f.lij[2]===c[2],"not the right tile?");return f}return null};g.prototype.hasPendingUpdates=function(){if(this._streamDataSupplier.hasPendingDownloads()||
0!==this._vectorTileLayerRequests)return!0;var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;)if(0<a.next().pendingUpdates)return this._iteratorPool.release(a),!0;this._iteratorPool.release(a);return!1};g.prototype.setBorders=function(a){this._renderer.setBorders(a)};g.prototype.setDisableRendering=function(a){this._renderer.setDisableRendering(a)};a([t.property({value:!1})],g.prototype,"cullBackFaces",null);a([t.property({readOnly:!0})],g.prototype,"extent",null);a([t.property({value:!1})],
g.prototype,"frontMostTransparent",null);a([t.property({readOnly:!0})],g.prototype,"loaded",void 0);a([t.property({value:1})],g.prototype,"opacity",null);a([t.property({readOnly:!0})],g.prototype,"overlayManager",void 0);a([t.property({readOnly:!0})],g.prototype,"manifold",void 0);a([t.property()],g.prototype,"maxTextureScale",void 0);a([t.property({readOnly:!0})],g.prototype,"ready",null);a([t.property({value:1})],g.prototype,"renderOrder",null);a([t.property({readOnly:!0})],g.prototype,"rootTiles",
void 0);a([t.property({value:!0})],g.prototype,"skirts",null);a([t.property({readOnly:!0,aliasOf:"tilingScheme.spatialReference"})],g.prototype,"spatialReference",void 0);a([t.property({value:G.DEFAULT_TILE_BACKGROUND})],g.prototype,"tileBackground",null);a([t.property({readOnly:!0})],g.prototype,"tilingScheme",void 0);a([t.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],g.prototype,"tilingSchemeLocked",void 0);a([t.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],
g.prototype,"tilingSchemeDone",void 0);a([t.property({readOnly:!0})],g.prototype,"tilingSchemeLogic",void 0);a([t.property({value:!0})],g.prototype,"velvetOverground",null);a([t.property({value:!1})],g.prototype,"wireframe",null);return g=a([t.subclass("esri.views.3d.terrain.TerrainSurface")],g)}(t.declared(g,q.Evented));var T=1.2,da=80/180*Math.PI,U=G.MAX_ROOT_TILES,aa=12,X=G.TileUpdateTypes,ba=D.create(),ea=[0,0,0],W={spatialReference:null,tile:null,extent:null},ca={spatialReference:null,extent:null,
scale:0};return p})},"esri/views/3d/terrain/OverlayManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/on ../../../Graphic ../../../core/Accessor ../../../core/Handles ../../../core/Logger ../../../core/accessorSupport/decorators ../../../geometry/Point ../../../symbols/SimpleMarkerSymbol ../lib/glMatrix ../state/utils/viewUtils ../support/aaBoundingRect ../support/debugFlags ../support/debugFlags ../support/earthUtils ../support/mathUtils ../support/projectionUtils ../webgl-engine/Stage ../webgl-engine/lib/Selector ../webgl-engine/lib/Texture".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x,z,A,y){var B=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],E=e.getLogger("esri.views.3d.OverlayManager"),C,G=function(e){function h(){var a=null!==e&&e.apply(this,arguments)||this;a._handles=new m;a._overlaySR=null;a._renderSR=null;a._overlaySREqualsRenderSR=!0;a._connectedLayers={};a._scale=0;a._dirty=!1;a._isSpherical=!1;a._latestOriginId=0;a.opacity=0;return a}
d(h,e);Object.defineProperty(h.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});h.prototype.initialize=function(){var a=this;this._stage=this.view._stage;this._renderer=this._stage.getTextureGraphicsRenderer();this._renderer.onHasHighlightsChanged=function(){return a.onHasHighlightsChanged()};this._initialEmptyTexture=y.createEmpty("initialOverlayTexture");this.groundSelector=new A(this.view.viewingMode);this.groundSelector.enableBackfacesTerrain=
!0;this.groundSelector.enableInvisibleTerrain=!0;this.groundSelector.enableHUDSelection=!1;this._stage.add(z.ModelContentType.TEXTURE,this._initialEmptyTexture);this._handles.add(this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location"],function(){return a.setOverlayDirty()}))};h.prototype.destroy=function(){for(var a in this._connectedLayers)this.unregisterLayerView(this._connectedLayers[a].layerView);this._disposeOverlays();this._stage.remove(z.ModelContentType.TEXTURE,
this._initialEmptyTexture.id);this._handles&&(this._handles.destroy(),this._handles=null)};h.prototype.onHasHighlightsChanged=function(){this.setOverlayDirty();this.notifyChange("hasHighlights")};h.prototype.hasOverlays=function(){return!!this._overlays};h.prototype.setSpatialReference=function(a,b){(this._overlaySR=a)?(this._renderSR=this.view.renderSpatialReference,this._overlaySREqualsRenderSR=this._overlaySR.equals(this._renderSR),this._longitudeCyclical=(this._isSpherical=b)?a.isWebMercator?
new c.Cyclical(-2.0037508342788905E7,2.0037508342788905E7):new c.Cyclical(-180,180):null):(this._disposeOverlays(),this._longitudeCyclical=null)};h.prototype.registerLayerView=function(a){var c=this,b=a.layer.uid;if(this._connectedLayers[b])E.warn("[OverlayManager#registerLayerView]: Layer "+b+" is already connected");else{var d=g(a,"draped-data-change",function(){return c.setOverlayDirty()});this._connectedLayers[b]={eventHandles:[d],layerView:a};if(a.setDrapingExtent&&this._overlays)for(b=0;b<this._overlays.length;b++)d=
this._overlays[b],a.setDrapingExtent(b,d.extent,this._overlaySR,2048,d.renderLocalOrigin);this.setOverlayDirty();this._setLayerViewOverlayUpdating(a,this._dirty)}};h.prototype.unregisterLayerView=function(a){for(var c in this._connectedLayers){var b=this._connectedLayers[c];if(b.layerView===a){if(b.eventHandles)for(var d=0;d<b.eventHandles.length;d++)b.eventHandles[d].remove();delete this._connectedLayers[c];this.setOverlayDirty();a.destroyed||(a._overlayUpdating=!1,a._evaluateUpdatingState())}}};
h.prototype.setOverlayDirty=function(){this._dirty||(this._setOverlayUpdating(!0),this._dirty=!0)};h.prototype._setLayerViewOverlayUpdating=function(a,c){if(!c||!a.suspended&&a.hasDraped)a._overlayUpdating=c,a._evaluateUpdatingState()};h.prototype._setOverlayUpdating=function(a){for(var c in this._connectedLayers)this._setLayerViewOverlayUpdating(this._connectedLayers[c].layerView,a);if(c=this.view._graphicsView)c._overlayUpdating=a,c._evaluateUpdatingState()};h.prototype.updateOverlay=function(){if(this._overlaySR){var a=
this._computeOverlayExtents();if(a){this._overlays||this._initOverlays();for(var c=0;c<this._overlays.length;c++){var b=this._overlays[c],d;a:{d=a[c];for(var e=b.extent,f=q.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS?0:G.EXTENTS_DIFFER_THRESHOLD*Math.max(d[2]-d[0],d[3]-d[1],e[2]-e[0],e[3]-e[1]),g=0;4>g;g++)if(Math.abs(e[g]-d[g])>f){d=!0;break a}d=!1}if(d){u.vec4d.set(a[c],b.extent);b.renderLocalOrigin={id:"OV_"+this._latestOriginId++,vec3:v.center(b.extent,u.vec3d.create())};for(var h in this._connectedLayers)d=
this._connectedLayers[h].layerView,d.setDrapingExtent&&d.setDrapingExtent(c,a[c],this._overlaySR,2048,b.renderLocalOrigin)}}this._setOverlayUpdating(!1);this._drawOverlays();this.terrainSurface._updateTileOverlayParams();this._dirty=!1}}};h.prototype.overlaysNeedUpdate=function(){return this._dirty&&!!this._overlaySR};h.prototype.updateOpacity=function(a){var b=1;if(this._overlays){var d=this._scale;a=this.view.renderCoordsHelper.getAltitude(a);3.5*a<d&&(b=Math.sqrt(c.clamp((a-d/10)/(d/3.5-d/10),
0,1)))}return b};h.prototype.setOverlayParamsOfTile=function(a,c,b){var d=a.extent;if(a=this._overlayForTile(a)){var e=a.extent;c.overlayTexScale[0]=(d[2]-d[0])/(e[2]-e[0]);c.overlayTexScale[1]=(d[3]-d[1])/(e[3]-e[1]);var f=d[0];if(this._longitudeCyclical){var f=this._longitudeCyclical.minimalMonotonic(e[0],f),g=this._longitudeCyclical.minimalMonotonic(e[0],d[2]);f>g&&(f=g-(d[2]-d[0]))}u.vec2d.set2((f-e[0])/(e[2]-e[0]),(d[1]-e[1])/(e[3]-e[1]),c.overlayTexOffset);c.overlayTexId=a.valid?a.texture.id:
this._initialEmptyTexture.id;c.highlightOverlayTexId=a.highlightValid?a.highlightTexture.id:this._initialEmptyTexture.id;c.overlayOpacity=void 0!==b?b:1}else c.overlayTexId=null,c.highlightOverlayTexId=null};h.prototype.overlayPixelSizeInMapUnits=function(a){var c;this._overlays&&(this._overlays[0]&&this._pointIsInExtent(a,this._overlays[0].extent)?c=this._overlays[0].extent:this._overlays[1]&&(c=this._overlays[1].extent));return c?(c[2]-c[0])/2048:0};h.prototype._overlayForTile=function(a){var c=
a.extent;a=a.clippingArea?v.intersection(c,a.clippingArea,H):c;return this._rectInsideRect(a,this._overlays[0].extent)?this._overlays[0]:this._rectanglesOverlap(a,this._overlays[1].extent)?this._overlays[1]:null};h.prototype._createEmptyOverlay=function(){var a=new y(null,"overlay",{wrapClamp:!0,mipmap:!0});this._stage.add(z.ModelContentType.TEXTURE,a);var c=new y(null,"highlightOverlay",{wrapClamp:!0,mipmap:!0});this._stage.add(z.ModelContentType.TEXTURE,c);return{extent:u.vec4d.create(),texture:a,
valid:!1,highlightTexture:c,highlightValid:!1,renderLocalOrigin:{id:"O",vec3:[0,0,0]}}};h.prototype._initOverlays=function(){this._overlays=[this._createEmptyOverlay(),this._createEmptyOverlay()]};h.prototype._disposeOverlays=function(){if(this._overlays){var a=this._stage;this._overlays.forEach(function(c){a.remove(z.ModelContentType.TEXTURE,c.texture.id);a.remove(z.ModelContentType.TEXTURE,c.highlightTexture.id)});this._overlays=null}};h.prototype._intersectGroundFromView=function(a,c,b,d){var e=
u.vec3d.createFrom(c*this.view.width,b*this.view.height,1);u.vec3d.unproject(e,a.viewMatrix,a.projectionMatrix,a.fullViewport,e);c=u.vec3d.createFrom(c*this.view.width,b*this.view.height,0);u.vec3d.unproject(c,a.viewMatrix,a.projectionMatrix,a.fullViewport,c);this.groundSelector.init([],c,e,null,a,null,!1);this.view.basemapTerrain.intersect(this.groundSelector,c,e);return this.groundSelector.minResult.getIntersectionPoint(d)};h.prototype._findHorizonBasedPointOfInterest=function(a,b,d){var e=.5;if("global"===
this.view.viewingMode){e=u.vec3d.create(a.eye);u.vec3d.normalize(e);u.vec3d.negate(e);b=u.vec3d.length(b);b=Math.asin(b/u.vec3d.length(a.eye));var f=Math.acos(u.vec3d.dot(a.viewForward,e)),e=c.clamp((b-(f-.5*a.fovY))/a.fovY,0,1);b=c.clamp((-b-(f-.5*a.fovY))/a.fovY,0,1);e=1===e&&0===b?.5:b+.55*(e-b)}else e=u.mat4d.multiplyVec4(a.projectionMatrix,u.vec4d.createFrom(0,Math.tan(.5*Math.PI-Math.acos(-a.viewForward[2])),1,0))[1],e=c.clamp(.5+.5*e,0,1),e=1===e||0===e?.5:0<a.eye[2]?.55*e:1-.55*(1-e);return this._intersectGroundFromView(a,
.5,e,d)?!0:!1};h.prototype._computeOverlayExtents=function(){var a=this.view.state.camera,b=this.terrainSurface.extent,d=u.vec3d.create(),e=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;this._findHorizonBasedPointOfInterest(a,this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,d)||u.vec3d.set(e,d);this._scale=this.view.renderCoordsHelper.getAltitude(a.eye);var g=u.vec3d.dist(a.eye,d),e=r.viewAngle(this.view.renderCoordsHelper,e,a.eye),e=Math.PI/2-Math.abs(e-Math.PI/
2);if(n.OVERLAY_SHOW_CENTER){var h=new t({color:[255,0,0],outline:{color:[255,255,255],width:2}}),k=new l;x.vectorToPoint(d,this._renderSR,k,this._overlaySR);h=new f({geometry:k,symbol:h});void 0!==C&&this.view.graphics.remove(C);this.view.graphics.add(h);C=h}this._overlaySREqualsRenderSR||x.vectorToVector(d,this._renderSR,d,this._overlaySR);h=1024*a.perPixelRatio*g*2;g=!1;k=Infinity;this._isSpherical&&(this._overlaySR.isWebMercator?(h/=Math.cos(x.webMercator.y2lat(d[1])),k=this.terrainSurface.extent[3],
k*=.999):(g=!0,h/=w.metersPerDegree,k=90),h>=k&&(h=k,d[1]=0,this._overlaySR.isWebMercator&&(d[0]=0)));var m=1;g&&(m=1/Math.max(.2,Math.cos(Math.abs(c.deg2rad(d[1])))),180<h*m&&(m=180/h));var q=h*m,p=L[0];p[0]=d[0]-q;p[1]=d[1]-h;p[2]=d[0]+q;p[3]=d[1]+h;this._isSpherical&&this._shiftExtentToFitBounds(p,Infinity,k);g=L[1];u.vec4d.set(p,g);6*q>b[2]-b[0]?u.vec4d.set(b,g):e<=.25*Math.PI?(g[0]-=q,g[1]-=h,g[2]+=q,g[3]+=h):(x.vectorToVector(a.eye,this._renderSR,K,this._overlaySR),u.vec2d.subtract(d,K,H),a=
-Math.atan2(H[1],H[0])+.125*Math.PI,0>a&&(a+=2*Math.PI),u.vec4d.scale(B[Math.floor(a/(.25*Math.PI))],2*h,H),H[0]*=m,H[2]*=m,u.vec4d.add(g,H,g));this._isSpherical&&(g[0]=this._longitudeCyclical.clamp(g[0]),g[2]=this._longitudeCyclical.clamp(g[2]),g[1]=Math.max(g[1],-k),g[3]=Math.min(g[3],k));!this._isSpherical&&b&&(a=v.intersection(p,b,M),b=v.intersection(g,b,V),v.contains(a,b)&&(g[2]=g[0],g[3]=g[1]));this.opacity=1;return L};h.prototype._drawOverlays=function(){for(var a=this._overlays[0].extent[2]-
this._overlays[0].extent[0],c=this._renderer,b=0;b<this._overlays.length;b++){var d=this._overlays[b].extent,e=this._longitudeCyclical?d[2]>this._longitudeCyclical.max:!1,f=this._longitudeCyclical?d[0]<this._longitudeCyclical.min:!1;if(e||f){J.views=I;var f=void 0,f=e?this._longitudeCyclical.max-d[0]:this._longitudeCyclical.min-d[0],f=Math.round(f/(d[2]-d[0])*2048),g=J.views[0];u.vec4d.set4(0,0,f,2048,g.viewport);u.vec4d.set4(d[0],d[1],this._longitudeCyclical.max,d[3],g.extent);e||(g.extent[0]+=this._longitudeCyclical.range);
g=J.views[1];u.vec4d.set4(f,0,2048-f,2048,g.viewport);u.vec4d.set4(this._longitudeCyclical.min,d[1],d[2],d[3],g.extent);e&&(g.extent[2]-=this._longitudeCyclical.range)}else J.views=F,u.vec4d.set(d,J.views[0].extent),u.vec4d.set4(0,0,2048,2048,J.views[0].viewport);J.width=2048;J.height=2048;J.pixelRatio=a/(d[2]-d[0]);this._overlays[b].valid=c.draw(this._overlays[b].texture,J);this._overlays[b].highlightValid=c.drawHighlights(this._overlays[b].highlightTexture,J)}};h.prototype._rectanglesOverlap=function(a,
c){return this._longitudeCyclical?(this._longitudeCyclical.contains(c[0],c[2],a[0])||this._longitudeCyclical.contains(c[0],c[2],a[2])||this._longitudeCyclical.contains(a[0],a[2],c[0]))&&!(a[1]>c[3]||a[3]<c[1]):v.intersects(a,c)};h.prototype._rectInsideRect=function(a,c){return this._longitudeCyclical?this._longitudeCyclical.contains(c[0],c[2],a[0])&&this._longitudeCyclical.contains(c[0],c[2],a[2])&&a[1]>c[1]&&a[3]<c[3]:v.contains(c,a)};h.prototype._pointIsInExtent=function(a,c){if(this._longitudeCyclical)return this._longitudeCyclical.contains(c[0],
c[2],a.x)&&a.y>=c[1]&&a.y<=c[3];var b=a.x;a=a.y;return b>c[0]&&b<c[2]&&a>c[1]&&a<c[3]};h.prototype._shiftExtentToFitBounds=function(a,c,b){var d=0,e=0;a[0]<-c?d=a[0]+c:a[2]>c&&(d=c-a[2]);a[1]<-b?e=a[1]+b:a[3]>b&&(e=b-a[3]);v.offset(a,d,e)};h.EXTENTS_DIFFER_THRESHOLD=1E-5;a([b.property()],h.prototype,"view",void 0);a([b.property()],h.prototype,"terrainSurface",void 0);a([b.property({type:Boolean})],h.prototype,"hasHighlights",null);return h=a([b.subclass("esri.views.3d.terrain.OverlayManager")],h)}(b.declared(k)),
J={width:0,height:0,pixelRatio:0,views:null},F=[{viewport:u.vec4d.create(),extent:u.vec4d.create()}],I=[F[0],{viewport:u.vec4d.create(),extent:u.vec4d.create()}],H=u.vec4d.create(),K=u.vec3d.create(),L=[u.vec4d.create(),u.vec4d.create()],M=v.create(),V=v.create();return G})},"esri/views/3d/terrain/PlanarTile":function(){define(["./TileBase","./TileGeometryFactory","../../../core/ObjectPool","../support/mathUtils","../lib/glMatrix"],function(p,h,d,a,g){var f=g.vec3d.createFrom(0,0,1);g=function(a,
d,e,b){p.call(this);this.tileUp=f;void 0!==a&&this.init(a,d,e,b)};g.prototype=new p;g.prototype.constructor=g;g.prototype.init=function(d,f,e,b){p.prototype.init.call(this,d,f,e,b);this.edgeLen=this.extent[2]-this.extent[0];this.curvatureHeight=0;this.centerAtSeaLevel[0]=a.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=a.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=0;this.updateRadiusAndCenter()};g.prototype.updateRadiusAndCenter=function(){p.prototype.updateRadiusAndCenter.call(this);
var a=(this.extent[2]-this.extent[0])*Math.SQRT1_2,d=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this.radius=Math.sqrt(a*a+d*d)};g.prototype.isVisible=function(a){if(!this.intersectsClippingArea)return!1;var d=this.extent[0],e=this.extent[1],b=this.elevationBounds[0],f=this.extent[2],g=this.extent[3],h=this.elevationBounds[1];return 0<a[0][0]*(0<a[0][0]?d:f)+a[0][1]*(0<a[0][1]?e:g)+a[0][2]*(0<a[0][2]?b:h)+a[0][3]||0<a[1][0]*(0<a[1][0]?d:f)+a[1][1]*(0<a[1][1]?e:g)+a[1][2]*(0<a[1][2]?b:h)+
a[1][3]||0<a[2][0]*(0<a[2][0]?d:f)+a[2][1]*(0<a[2][1]?e:g)+a[2][2]*(0<a[2][2]?b:h)+a[2][3]||0<a[3][0]*(0<a[3][0]?d:f)+a[3][1]*(0<a[3][1]?e:g)+a[3][2]*(0<a[3][2]?b:h)+a[3][3]||0<a[4][0]*(0<a[4][0]?d:f)+a[4][1]*(0<a[4][1]?e:g)+a[4][2]*(0<a[4][2]?b:h)+a[4][3]||0<a[5][0]*(0<a[5][0]?d:f)+a[5][1]*(0<a[5][1]?e:g)+a[5][2]*(0<a[5][2]?b:h)+a[5][3]?!1:!0};g.prototype._numSubdivisionsAtLevel=[2,2,2,2,2,2,2,2];g.prototype.createGeometry=function(a,d,e,b){a.needsUpdate=!1;h.createPlanarGlobeTile(a.numVertsPerRow,
this.extent,a.samplerData,d,e,a.clippingArea,b)};g.Pool=new d(g);return g})},"esri/views/3d/terrain/TileBase":function(){define("./terrainUtils ./tileUtils ./TerrainConst ./ElevationData ./TilePerLayerInfo ./ElevationTileAgent ./MapTileAgent ../support/mathUtils ../lib/glMatrix ../../../core/arrayUtils".split(" "),function(p,h,d,a,g,f,k,m,e,b){var l=e.vec3d,t=e.vec2d,u=e.vec4d,r=e.mat4d,v=p.weakAssert,q=l.create(),n=u.create(),w=u.create(),c=l.create(),x=k.AGENT_DONE,z=d.LayerClass.LAYER_CLASS_COUNT,
A=d.LayerClass.MAP,y=d.LayerClass.ELEVATION,B=d.TileUpdateTypes;e=function(a,b,d){this.lij=[0,0,0];this.extent=u.create();this.extentWGS84Rad=u.create();this.centerAtSeaLevel=l.create();this.center=l.create();this.tileUp=c;this.elevationBounds=t.create();this.children=[null,null,null,null];this.layerInfo=Array(z);this.intersectsClippingArea=this.isWithinClippingArea=!0;this.clippingArea=null;this._maxTesselation=0};e.prototype.init=function(a,c,b,e){this.lij[0]=a[0];this.lij[1]=a[1];this.lij[2]=a[2];
e.getExtent(a[0],a[1],a[2],this.extent,this.extentWGS84Rad);this.intersectsClippingArea=this.isWithinClippingArea=!0;this.clippingArea=null;this.radius=this.edgeLen=0;this.vlevel=a?a[0]:0;c&&c.elevationBounds?t.set(c.elevationBounds,this.elevationBounds):t.set2(0,0,this.elevationBounds);this.parent=c;for(a=0;4>a;a++)this.children[a]=null;this.pendingUpdates=0;this.renderData=null;this.renderOrder=this.screenDepth=0;this.visible=!1;this.parentSurface=b;for(a=0;a<z;a++)if(b){c=b.numLayers(a);var f;
this.layerInfo[a]?(f=this.layerInfo[a],f.length=c):(f=Array(c),this.layerInfo[a]=f);for(var h=0;h<c;h++)f[h]=g.makeEmptyLayerInfo(a,f[h]),a==y&&this.findElevationBoundsForLayer(h,-1)}else this.layerInfo[a]=null;this.computeElevationBounds();this._maxTesselation=Math.min(e.pixelSize[0],d.MAX_TILE_TESSELATION)};e.prototype.dispose=function(){for(var a=0;a<z;a++)for(var c=this.layerInfo[a],b=0;b<c.length;b++)c[b].dispose()};e.prototype.updateScreenDepth=function(a){l.set(this.center,w);w[3]=1;r.multiplyVec4(a,
w,w);this.screenDepth=w[2]/w[3]};e.prototype.shouldSplit=function(a,c){var b=this.lij[0];l.subtract(this.center,c,q);var d=l.length(q),e=this.edgeLen/(a[0]*d*2),d=this.edgeLen/(a[2]*d*2),f=a[1],g=a[3],h=a[4];a=a[5];return e<f?this.vlevel!==this.lij[0]?(this.vlevel=this.lij[0],B.VSPLITMERGE):B.NONE:b>=h?(c=b+Math.ceil(-m.log2(f/e)),c!==this.vlevel?(this.vlevel=c,B.VSPLITMERGE):B.NONE):6<b&&(l.scale(this.tileUp,l.dot(this.tileUp,q),n),l.subtract(n,q),l.length2(n)>this.radius*this.radius&&(l.scale(n,
this.radius/l.length(n)),l.add(n,this.center),l.subtract(c,n,n),c=this.elevationBounds[1]-this.elevationBounds[0],Math.min(1,(Math.abs(l.dot(n,this.tileUp))+.5*c+this.curvatureHeight)/l.length(n))*d<.1/a*g))?B.NONE:B.SPLIT};e.prototype.decodeElevationData=function(c){var b;if(c instanceof ArrayBuffer)try{b=a.createFromLERC(this.lij,this.extent,c,d.noDataValueOpt)}catch(G){console.warn("Error decoding %s: %s",c.url,G.message)}else b=a.createFromFetchTileResult(this.lij,this.extent,c);return b};e.prototype.getWGS84Extent=
function(){return this.extentWGS84Rad.map(m.rad2deg)};e.prototype.load=function(a){for(var c=0;c<z;c++)this.layerInfo[c]&&this._createOrUpdateAgents(0,c);a.loadTile(this)};e.prototype.unload=function(a){this.renderData&&a.unloadTile(this);for(a=0;a<z;a++)for(var c=this.layerInfo[a],b=0;b<c.length;b++){var e=c[b];e.loadingAgent&&e.loadingAgent!==x&&(e.loadingAgent.dispose(),(a===d.LayerClass.ELEVATION?f:k).Pool.release(e.loadingAgent),e.loadingAgent=null);e.pendingUpdates=0}this.pendingUpdates&=~d.TileUpdateTypes.UPDATE_GEOMETRY;
this.pendingUpdates&=~d.TileUpdateTypes.UPDATE_TEXTURE};e.prototype.updateClippingStatus=function(a){if(b.equals(a,this.clippingArea))return!1;var c=this.intersectsClippingArea,d=this.isWithinClippingArea;a?(this.intersectsClippingArea=this.intersectsExtent(a),this.isWithinClippingArea=this.isWithinExtent(a)):this.isWithinClippingArea=this.intersectsClippingArea=!0;this.clippingArea=a;a=d&&this.isWithinClippingArea;c=!d&&!c&&!this.isWithinClippingArea&&!this.intersectsClippingArea;!this.renderData||
a||c||this.updateGeometry();return!0};e.prototype.updateVisibility=function(a,c,b){a=(b||this.isVisible(a,c))&&this.intersectsClippingArea;if(a!==this.visible)for(this.visible=a,c=this.layerInfo[0],b=0;b<c.length;b++){var d=c[b];d.loadingAgent&&d.loadingAgent!==x&&d.loadingAgent.setSuspension(!a)}return a};e.prototype.getLayerInfo=function(a,c){return this.layerInfo[c][a]};e.prototype.hasLayerData=function(a,c){return(a=this.layerInfo[c][a])&&a.data&&!a.dataInvalidated};e.prototype.tileDataAvailable=
function(a,c,b){return(c=this.layerInfo[b][c].tilemap)?"unavailable"!==c.getAvailability(a.lij[1],a.lij[2]):!0};e.prototype.requestLayerData=function(a,c,b){d.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d requested by tile %s",this.lij.toString(),c,a,b.tile.lij.toString());var e=this.layerInfo[c][a];if(-1<e.waitingAgents.indexOf(b))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),b.tile.lij.toString(),c,a),!0;
if(e.data&&!e.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),b.tile.lij.toString(),c,a),e.waitingAgents.push(b),setTimeout(b.dataArrived.bind(b,this),0),!0;if(e.pendingUpdates&B.DECODE_ELEVATION)return e.waitingAgents.push(b),!0;e.waitingAgents.push(b);if(!e.requestPromise){var f=this.parentSurface.requestTileData(this,a,c);if(f.isFulfilled())return!1;a=function(){e.requestPromise===f&&(e.requestPromise=null)};e.requestPromise=
f;f.then(a,a);return!!f}return!0};e.prototype.descendants=function(a){a||(a=[]);for(var c=0;4>c;c++){var b=this.children[c];b&&(b.descendants(a),a.unshift(this.children[c]))}return a};e.prototype.isLij=function(a){return this.lij[0]===a[0]&&this.lij[1]===a[1]&&this.lij[2]==a[2]};e.prototype.findByLij=function(a){if(this.isLij(a))return this;for(var c=0;4>c;c++){var b=this.children[c];if(b&&(b=b.findByLij(a)))return b}return null};e.prototype.unrequestLayerData=function(a,c,b){d.TILE_LOADING_DEBUGLOG&&
console.log("tile %s layer %d/%d canceled by tile %s",this.lij.toString(),c,a,b.tile.lij.toString());var e=this.layerInfo[c][a],f=e.waitingAgents;b=f.indexOf(b);v(-1<b,"agent has not requested this piece of map data");f[b]=f[f.length-1];f.length--;1>f.length&&(f=e.requestPromise,b=!1,c===A&&(b=this.parentSurface.layerViewByIndex(a,A),b=p.isVectorTileLayerView(b)),b||v(f||e.rawData,"no pending operations on layerInfo that agents were waiting for"),f&&!f.isFulfilled()&&(f.cancel(),e.requestPromise=
null),d.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d request/loading canceled",this.lij.toString(),c,a))};e.prototype.dataArrived=function(a,c,b){a=this.layerInfo[c][a];a.data=b;a.dataInvalidated=!1;for(b=0;b<a.waitingAgents.length;b++)a.waitingAgents[b].dataArrived(this);a.waitingAgents.length=0};e.prototype.dataMissing=function(a,c,b){b.notInTilemap||console.error("Tile %s layer %d/%d error",this.lij.toString(),c,a);a=this.layerInfo[c][a];a.dataMissing=!0;for(c=0;c<a.waitingAgents.length;c++)a.waitingAgents[c].dataMissing(this);
a.waitingAgents.length=0};e.prototype.updateTexture=function(a){this.renderData&&(a?this.parentSurface._renderer.updateTileTexture(this):(this.pendingUpdates|=d.TileUpdateTypes.UPDATE_TEXTURE,this.parentSurface._pendingUpdates=!0))};e.prototype.invalidateLayerData=function(a,c){this.layerInfo[c][a].invalidateSourceData();this.restartAgents(c)};e.prototype.computeElevationBounds=function(){t.set2(Number.MAX_VALUE,-Number.MAX_VALUE,this.elevationBounds);for(var a=this.layerInfo[y],c=!1,b=0;b<a.length;b++){var d=
a[b];d.elevationBounds&&(this.elevationBounds[0]=Math.min(this.elevationBounds[0],d.elevationBounds[0]),this.elevationBounds[1]=Math.max(this.elevationBounds[1],d.elevationBounds[1]),c=!0)}c||t.set2(0,0,this.elevationBounds);this.updateRadiusAndCenter()};e.prototype.updateRadiusAndCenter=function(){l.scale(this.tileUp,.5*(this.elevationBounds[0]+this.elevationBounds[1]),n);l.add(this.centerAtSeaLevel,n,this.center)};e.prototype.findElevationBoundsForLayer=function(a,c){var b=this.layerInfo[y][a];
if(!b.elevationBounds||b.elevationBounds[2]<c)if(c=this.parentSurface.layerViewByIndex(a,y),h.fallsWithinLayer(this,c.layer,!1)){c=!1;if(b.data)t.set(b.data.bounds,n),n[2]=this.lij[0],c=!0;else{for(var e=this.parent,f=0,g=null,k=b.data;e&&(!k||f<d.ELEVATION_DESIRED_RESOLUTION_LEVEL);){f=this.vlevel-e.lij[0];g=k||g;k=e.layerInfo[y][a].data;if(!k&&g&&f>=d.ELEVATION_DESIRED_RESOLUTION_LEVEL)break;e=e.parent}if(k=k||g)k.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],n),Infinity!==n[0]&&(n[2]=
k.level,c=!0)}c&&(b.elevationBounds?l.set(n,b.elevationBounds):b.elevationBounds=[n[0],n[1],n[2]])}};e.prototype.updateGeometry=function(){this.pendingUpdates|=d.TileUpdateTypes.UPDATE_GEOMETRY;this.parentSurface._pendingUpdates=!0};e.prototype.modifyLayers=function(a,c,b){for(var e=c.length,h=this.layerInfo[b],l=Array(e),n=0;n<h.length;n++){var m=h[n];m.loadingAgent&&m.loadingAgent!==x&&(m.loadingAgent.dispose(),(b===d.LayerClass.ELEVATION?f:k).Pool.release(m.loadingAgent),m.loadingAgent=null);m.waitingAgents.length=
0}if(b===A)for(n=0;n<h.length;n++)void 0===a[n]&&h[n].dispose();for(n=0;n<e;n++)a=c[n],l[n]=-1<a?h[a]:g.makeEmptyLayerInfo(b);this.layerInfo[b]=l};e.prototype.restartAgents=function(a){if(this.renderData)if(this._createOrUpdateAgents(0,a),a===y){this.updateGeometry();a=this.layerInfo[a];for(var c=0;c<a.length;c++)a[c].pendingUpdates|=d.TileUpdateTypes.UPDATE_GEOMETRY;this.parentSurface._pendingUpdates=!0}else this.updateTexture(!0)};e.prototype.updateAgents=function(a){if(this.renderData){for(var c=
this.layerInfo[a],b=0;b<c.length;b++){var d=c[b];d.loadingAgent===x&&(d.loadingAgent=null)}this._createOrUpdateAgents(0,a)}};e.prototype.removeLayerAgent=function(a,c){a=this.layerInfo[c][a];a.loadingAgent&&a.loadingAgent!==x&&a.loadingAgent.dispose();a.loadingAgent=null};e.prototype.agentDone=function(a,c){var b=this.layerInfo[c],d=b[a];d.loadingAgent=x;d.data||d.upsampleFromTile||a<b.length-1&&this._createOrUpdateAgents(a+1,c)};e.prototype._createOrUpdateAgents=function(a,c){var b;b=c===y?!1:!this.visible;
for(var e=this.layerInfo[c];a<e.length;){var g=e[a],l=!1,n=this.parentSurface.layerViewByIndex(a,c);if(null!==g.loadingAgent&&g.loadingAgent!==x)l=g.loadingAgent.update();else if(g.loadingAgent!==x&&h.fallsWithinLayer(this,n.layer,!1)){var m=c===d.LayerClass.ELEVATION?f:k,r=m.Pool.acquire();(l=r.init(this,a,c,b))?g.loadingAgent=r:(r.dispose(),m.Pool.release(r),g.loadingAgent=x)}if(l&&!n.isTransparent)break;a++}};e.prototype.geometryState=function(a){var c,e=this._getElevationInfo(a?a.samplerData:
null),f=this.lij[0],g=!1;e.samplerData?(c=this.vlevel-f,c=Math.max(f-e.maxTileLevel,d.ELEVATION_DESIRED_RESOLUTION_LEVEL-c),f=this._maxTesselation,c=m.clamp((f>>c)+1,2,f+1)):c=8>f?this._numSubdivisionsAtLevel[f]+1:2;f=this.clippingArea;if(!this.intersectsClippingArea||this.isWithinClippingArea)f=null;a?(a.numVertsPerRow!==c&&(a.numVertsPerRow=c,g=!0),e.changed&&(a.samplerData=e.samplerData,g=!0),b.equals(a.clippingArea,f)||(a.clippingArea=f,g=!0),a.needsUpdate=g):a={numVertsPerRow:c,samplerData:e.samplerData,
needsUpdate:!0,clippingArea:f};return a};e.prototype._getElevationInfo=function(a){for(var c=this.layerInfo[y],b=c.length,d=Array(b),e=0,f=0,g=!1,k=0;k<b;k++){var l=c[k];if(l.upsampleFromTile){var l=l.upsampleFromTile.tile,n=l.layerInfo[y][k].data;a&&a[e]===n.samplerData||(g=!0);d[e++]=n.samplerData;f=Math.max(f,l.lij[0])}else l.data&&(n=this.parentSurface.layerViewByIndex(k,y),h.fallsWithinLayer(this,n.layer,!1)&&(a&&a[e]===l.data.samplerData||(g=!0),d[e++]=l.data.samplerData,f=this.lij[0]))}a&&
a.length!==e&&(g=!0);0<e?d.length=e:d=null;return{changed:g,samplerData:d,maxTileLevel:f}};e.prototype.isWithinExtent=function(a){var c=this.extent;return c[0]>=a[0]&&a[2]>=c[2]&&c[1]>=a[1]&&a[3]>=c[3]};e.prototype.intersectsExtent=function(a){var c=this.extent;return c[2]>=a[0]&&a[2]>=c[0]&&c[3]>=a[1]&&a[3]>=c[1]};return e})},"esri/views/3d/terrain/terrainUtils":function(){define("require exports ../../../layers/BaseElevationLayer ../../../layers/BaseTileLayer ../../../layers/ElevationLayer ../../../layers/TiledLayer ../../../layers/TileLayer ../../../layers/VectorTileLayer ../../../layers/WMTSLayer ../../../support/basemapDefinitions ./terrainUtilsPlanar ./terrainUtilsSpherical".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t){function u(a){return a&&"esri.views.3d.layers.TileLayerView3D"===a.declaredClass}function r(a){return a&&"esri.views.3d.layers.VectorTileLayerView3D"===a.declaredClass}function v(a){return a&&"esri.views.3d.layers.WMTSLayerView3D"===a.declaredClass}function q(a){return a&&"esri.views.3d.layers.ElevationLayerView3D"===a.declaredClass}function n(){x={};for(var a in b)b[a].baseMapLayers.forEach(function(a){x[a.url]=19});x["//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"]=
20}function w(a,b,d,e){return c["local"===e||"planar"===e?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(a,b,d)}Object.defineProperty(h,"__esModule",{value:!0});var c={planar:l,spherical:t};h.weakAssert=function(a,c){a||console.warn("Terrain: "+c)};h.autoUpdateSkirtsVisibility=function(a,b){c[a.manifold].autoUpdateSkirtsVisibility(a,b)};h.isTiledLayer=function(c){return c&&(c.isInstanceOf(f)||c.isInstanceOf(a)||c.isInstanceOf(d)||c.isInstanceOf(e))};h.isVectorTileLayer=function(a){return a&&
a.isInstanceOf(m)};h.isTileLayerView=u;h.isVectorTileLayerView=r;h.isWMTSLayerView=v;h.isElevationLayerView=q;h.isTiledLayerView=function(a){return a&&(u(a)||q(a)||r(a)||v(a))};h.useFetchTileForLayer=function(a){return a.fetchTile&&!(a.fetchTile===k.prototype.fetchTile||a.fetchTile===g.prototype.fetchTile)};var x=null;h.getKnownTiledServiceLevelCap=function(a){x||n();a=a&&a.replace(/https?:/,"");return a in x?x[a]:Infinity};h.prepareKnownTiledServiceLevelCaps=n;h.checkIfTileInfoSupportedForView=w;
h.getTiledLayerInfo=function(a,c,b){var d,f;if(a.isInstanceOf(e)){if(a=a.activeLayer){var g=a.tileMatrixSet;if(g)d=g.tileInfo,f=g.fullExtent;else if(a=a.tileMatrixSets)if(a=a.find(function(a){return null==w(a.tileInfo,a.fullExtent,c,b)}))return{tileInfo:a.tileInfo,fullExtent:a.fullExtent}}}else d=a.isInstanceOf(m)?a.compatibleTileInfo256:a.tileInfo,f=a.fullExtent;return d&&f&&null==w(d,f,c,b)?{tileInfo:d,fullExtent:f}:{tileInfo:null,fullExtent:null}}})},"esri/layers/BaseElevationLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Error ../core/promiseUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ./Layer ./support/TileInfo".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l){var t={id:"0/0/0",level:0,row:0,col:0,extent:null};return function(b){function h(){var a=null!==b&&b.apply(this,arguments)||this;a.tileInfo=l.create({spatialReference:e.WebMercator,size:256});a.fullExtent=new m(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,e.WebMercator);a.spatialReference=e.WebMercator;a.type="base-elevation";return a}d(h,b);h.prototype.getTileBounds=function(a,b,d,e){e=e||[0,0,0,0];t.level=a;t.row=b;t.col=d;t.extent=e;this.tileInfo.updateTileInfo(t);
t.extent=null;return e};h.prototype.fetchTile=function(a,b,d,e){throw new g("BaseElevationLayer:fetchtile-not-implemented","fetchTile() is not implemented");};h.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return f.reject(new g("base-elevation-layer:view-not-supported","BaseElevationLayer is only supported in 3D"));case "3d":return f.create(function(a){return p(["../views/3d/layers/ElevationLayerView3D"],a)})}};a([k.property({type:l})],h.prototype,"tileInfo",void 0);a([k.property()],
h.prototype,"fullExtent",void 0);a([k.property()],h.prototype,"spatialReference",void 0);a([k.property({readOnly:!0,value:"base-elevation"})],h.prototype,"type",void 0);return h=a([k.subclass("esri.layers.BaseElevationLayer")],h)}(k.declared(b))})},"esri/layers/BaseTileLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/_base/lang ../request ../core/Error ../core/promiseUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ./Layer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./support/TileInfo".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v){var q={id:"0/0/0",level:0,row:0,col:0,extent:null};return function(h){function n(){var a=null!==h&&h.apply(this,arguments)||this;a.tileInfo=v.create({spatialReference:l.WebMercator,size:256});a.type="base-tile";a.fullExtent=new b(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,l.WebMercator);a.spatialReference=l.WebMercator;return a}d(n,h);n.prototype.getTileBounds=function(a,b,d,e){e=e||[0,0,0,0];q.level=a;q.row=b;q.col=d;q.extent=e;
this.tileInfo.updateTileInfo(q);q.extent=null;return e};n.prototype.getTileUrl=function(a,b,d){throw new k("basetilelayer:gettileurl-not-implemented","getTileUrl() is not implemented");};n.prototype.fetchTile=function(a,b,d,e){a=this.getTileUrl(a,b,d);var c={responseType:"image"};e&&e.timestamp&&(c.query={_ts:e.timestamp});return"string"===typeof a?f(a,g.mixin({allowImageDataAccess:e&&e.allowImageDataAccess||!1},c)).then(function(a){return a.data}):a.then(function(a){return f(a,c)}).then(function(a){return a.data})};
n.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return m.create(function(a){return p(["../views/2d/layers/TiledLayerView2D"],a)});case "3d":return m.create(function(a){return p(["../views/3d/layers/TileLayerView3D"],a)})}};a([e.property({type:v})],n.prototype,"tileInfo",void 0);a([e.property({readOnly:!0,value:"base-tile"})],n.prototype,"type",void 0);a([e.property()],n.prototype,"fullExtent",void 0);a([e.property()],n.prototype,"spatialReference",void 0);return n=a([e.subclass("esri.layers.BaseTileLayer")],
n)}(e.declared(t,u,r))})},"esri/layers/VectorTileLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/_base/lang ../request ../core/Error ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ./TiledLayer ./mixins/ArcGISCachedService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/TileInfo ./support/TilemapCache ./support/vectorTileLayerLoader ../portal/support/jsonContext ../views/vectorTiles/SchemaHelper ../views/vectorTiles/style/StyleRepository".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x,z,A,y,B,E){return function(c){function h(a,b){a=c.call(this)||this;a.capabilities=null;a.currentStyleInfo=null;a.fullExtent=null;a.style=null;a.operationalLayerType="VectorTileLayer";a.tileInfo=null;a.tilemapCache=null;a.type="vector-tile";a.url=null;return a}d(h,c);h.prototype.normalizeCtorArgs=function(a,c){return"string"===typeof a?g.mixin({},{url:a},c):a};h.prototype.load=function(){var a=this,c=this.loadFromPortal({supportedTypes:["Vector Tile Service"],
supportsData:!1}).then(function(){if(a.portalItem&&a.portalItem.id){var c=a.portalItem.itemUrl+"/resources/styles/root.json";return f(c,{query:{f:"json"}}).then(function(b){b.data&&a.read({url:c},y.createForItem(a.portalItem))})}}).always(function(){return a.loadStyle()});this.addResolvingPromise(c);return this.when()};Object.defineProperty(h.prototype,"attributionDataUrl",{get:function(){var a=this.currentStyleInfo;return(a=a&&a.serviceUrl&&l.urlToObject(a.serviceUrl))?this._getDefaultAttribution(a.path):
null},enumerable:!0,configurable:!0});h.prototype.readCapabilities=function(a,c){return{supportsExportTiles:!!(c&&c.hasOwnProperty("exportTilesAllowed")&&c.exportTilesAllowed),supportsTileMapIndexing:c.capabilities?-1!==c.capabilities.toLowerCase().indexOf("tilemap"):!1}};Object.defineProperty(h.prototype,"parsedUrl",{get:function(){return this.serviceUrl?b.urlToObject(this.serviceUrl):null},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"serviceUrl",{get:function(){return this.currentStyleInfo&&
this.currentStyleInfo.serviceUrl||null},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"spatialReference",{get:function(){return this.tileInfo&&this.tileInfo.spatialReference||null},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"styleUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.styleUrl||null},enumerable:!0,configurable:!0});h.prototype.writeStyleUrl=function(a,c){a&&l.isProtocolRelative(a)&&(a="https:"+a);c.styleUrl=a};h.prototype.readTileIndexType=
function(a,c){return c.type};h.prototype.readTileIndexUrl=function(a,c){return l.join(this.serviceUrl,c.tileMap)};h.prototype.readTilemapCache=function(a,c){return c.capabilities&&-1<c.capabilities.indexOf("Tilemap")?new z({layer:this}):null};h.prototype.readTileServers=function(a,c){var b=this;a=c.tiles;this.serviceUrl&&a.forEach(function(a,c,d){d[c]=l.join(b.serviceUrl,a)});return a};h.prototype.readVersion=function(a,c){return c.version?parseFloat(c.version):parseFloat(c.currentVersion)};h.prototype.readCompatibleTileInfo256=
function(a,c){return x.fromJSON(B.create256x256CompatibleTileInfo(c.tileInfo))};h.prototype.readCompatibleTileInfo512=function(a,c){return x.fromJSON(B.create512x512CompatibleTileInfo(c.tileInfo))};h.prototype.loadStyle=function(a){a=a||this.style||this.url;if(this._loadingPromise&&"string"===typeof a&&this.url===a)return this._loadingPromise;var c=this._loadingPromise;this._loadingPromise=this._getSourceAndStyle(a);c&&!c.isFulfilled()&&c.cancel();return this._loadingPromise};h.prototype.getTileUrl=
function(a,c,b){var d=this.tileServers[c%this.tileServers.length];return d=d.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,c.toString()).replace(/\{x\}/gi,b.toString())};h.prototype.write=function(a,c){return c&&c.origin&&!this.styleUrl?(c.messages&&c.messages.push(new k("vectortilelayer:unsupported","VectorTileLayer ("+this.title+", "+this.id+") with style defined by JSON only are not supported",{layer:this})),null):this.inherited(arguments,[a,c])};h.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return e.create(function(a){return p(["../views/2d/layers/VectorTileLayerView2D"],
a)});case "3d":return e.create(function(a){return p(["../views/3d/layers/VectorTileLayerView3D"],a)})}};h.prototype._getSourceAndStyle=function(a){var c=this;return a?A.loadMetadata(a).then(function(b){c._set("currentStyleInfo",{serviceUrl:b.serviceUrl,styleUrl:b.styleUrl,spriteUrl:b.spriteUrl,glyphsUrl:b.glyphsUrl,style:b.style,layerDefinition:b.layerDefinition});"string"===typeof a?(c.url=a,c.style=null):(c.url=null,c.style=a);c._set("styleRepository",new E(b.style,b));c.read(b.layerDefinition)}):
e.reject(Error("invalid style!"))};h.prototype._getDefaultAttribution=function(a){var c=a.match(/^https?:\/\/(basemaps|basemapsbeta|basemapsdev)\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);if(c&&(a=c[3]&&c[3].toLowerCase()))for(var c=c[2]||"",b=0,d=["World_Basemap","World_Basemap_v2","World_Basemap_GCS_v2","World_Basemap_WGS84"];b<d.length;b++){var e=d[b];if(-1<e.toLowerCase().indexOf(a))return l.normalize("//static.arcgis.com/attribution/Vector"+c+"/"+
e)}};a([t.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],h.prototype,"attributionDataUrl",null);a([t.property({readOnly:!0})],h.prototype,"capabilities",void 0);a([t.reader("capabilities",["exportTilesAllowed","capabilities"])],h.prototype,"readCapabilities",null);a([t.property({readOnly:!0})],h.prototype,"currentStyleInfo",void 0);a([t.property({type:u,readOnly:!0})],h.prototype,"fullExtent",void 0);a([t.property()],h.prototype,"style",void 0);a([t.property({readOnly:!0,dependsOn:["serviceUrl"]})],
h.prototype,"parsedUrl",null);a([t.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],h.prototype,"serviceUrl",null);a([t.property({type:r,dependsOn:["tileInfo"],readOnly:!0})],h.prototype,"spatialReference",null);a([t.property({readOnly:!0})],h.prototype,"styleRepository",void 0);a([t.property({type:String,readOnly:!0,dependsOn:["currentStyleInfo"],json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],h.prototype,"styleUrl",null);a([t.writer(["portal-item",
"web-document"],"styleUrl")],h.prototype,"writeStyleUrl",null);a([t.property({readOnly:!0})],h.prototype,"tileIndexType",void 0);a([t.reader("tileIndexType",["tileIndexType","type"])],h.prototype,"readTileIndexType",null);a([t.property({readOnly:!0})],h.prototype,"tileIndexUrl",void 0);a([t.reader("tileIndexUrl",["tileIndexUrl","tileMap"])],h.prototype,"readTileIndexUrl",null);a([t.property({readOnly:!0,type:x})],h.prototype,"tileInfo",void 0);a([t.property({readOnly:!0,type:z})],h.prototype,"tilemapCache",
void 0);a([t.reader("tilemapCache",["capabilities"])],h.prototype,"readTilemapCache",null);a([t.property({readOnly:!0})],h.prototype,"tileServers",void 0);a([t.reader("tileServers",["tiles"])],h.prototype,"readTileServers",null);a([t.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],h.prototype,"type",void 0);a([t.property({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],h.prototype,"url",void 0);a([t.property({readOnly:!0})],
h.prototype,"version",void 0);a([t.reader("version",["version","currentVersion"])],h.prototype,"readVersion",null);a([t.property({readOnly:!0})],h.prototype,"compatibleTileInfo256",void 0);a([t.reader("compatibleTileInfo256",["tileInfo"])],h.prototype,"readCompatibleTileInfo256",null);a([t.property({readOnly:!0})],h.prototype,"compatibleTileInfo512",void 0);a([t.reader("compatibleTileInfo512",["tileInfo"])],h.prototype,"readCompatibleTileInfo512",null);return h=a([t.subclass("esri.layers.VectorTileLayer")],
h)}(t.declared(v,n,w,c,m,q))})},"esri/layers/support/vectorTileLayerLoader":function(){define("require exports dojo/has dojo/_base/lang ../../config ../../request ../../core/promiseUtils ../../core/urlUtils".split(" "),function(p,h,d,a,g,f,k,m){function e(a){if(a){var b=m.getOrigin(a);m.canUseXhr(b)||-1!==v.indexOf(b)||v.push(b);return a}}function b(a,b){var d=a.parsedUrl;if(null!=b.sources){var c=null;d&&(c=d.path.substring(0,d.path.lastIndexOf("/")),a.styleUrl=d.path);c||(c=(c=u(b,d))&&c.url);b.jsonUrl&&
(a.styleUrl=b.jsonUrl);var d=b.sprite||null,e=b.glyphs||null;c&&(d&&!m.isAbsolute(d)&&(d=m.normalize(m.join(c,d))),e&&!m.isAbsolute(e)&&(e=m.normalize(m.join(c,e))));a.style=b;a.spriteUrl=d;a.glyphsUrl=e;return t(a,b)}if(b.hasOwnProperty("tileInfo"))return a.layerDefinition=b,a.serviceUrl=d.path,l(a,b)}function l(a,b){var d=a.parsedUrl;b=b.defaultStyles;m.isAbsolute(b)?a.styleUrl=m.normalize(b):a.styleUrl=m.normalize(m.join(d.path,b,"root.json"));e(a.styleUrl);return f(a.styleUrl,{responseType:"json"}).then(function(c){var b=
c.data.sprite||null,d=c.data.glyphs||null,e=m.removeFile(a.styleUrl);b&&!m.isAbsolute(b)&&(b=m.normalize(m.join(e,b)));d&&!m.isAbsolute(d)&&(d=m.normalize(m.join(e,d)));a.spriteUrl=b;a.glyphsUrl=d;return a.style=c.data})}function t(a,b){var d=a.parsedUrl;(b=u(b,d))||k.reject("Source isn't available in the style object!");if(b.url)return a.serviceUrl=b.url,m.isAbsolute(a.serviceUrl)||(a.serviceUrl=m.join(d.path,a.serviceUrl)),e(a.serviceUrl),f(a.serviceUrl,{query:{f:"json"},responseType:"json"}).then(function(c){a.layerDefinition=
r(c.data);return a});a.layerDefinition=r(b);return k.resolve(a)}function u(a,b){if(!a.sources)return null;var d=a.sources;a=null;if(d.esri)a=d.esri,b&&a.url&&!m.isAbsolute(a.url)&&(d=b.path.substring(0,b.path.lastIndexOf("/")),a.url=m.join(d,a.url));else{for(var c=0,e=Object.keys(d);c<e.length;c++)if(b=e[c],-1!==b.toLocaleLowerCase().indexOf("street")&&"vector"===a.type){a=d[b];break}if(!a)for(c=0,e=Object.keys(d);c<e.length&&(b=e[c],a=d[b],"vector"!==a.type);c++);}return a}function r(a){if(a.hasOwnProperty("tileInfo"))return a;
for(var b={xmin:-2.0037507067161843E7,ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,spatialReference:{wkid:102100}},d=(b.xmax-b.xmin)/512,c=[],f=a.hasOwnProperty("minzoom")?parseFloat(a.minzoom):0,g=a.hasOwnProperty("maxzoom")?parseFloat(a.maxzoom):16;f<g;f++){var h=d/Math.pow(2,f);c.push({level:f,scale:Math.floor(3779.527559055118*h),resolution:h})}a.tiles.forEach(e);return{capabilities:"TilesOnly",initialExtent:b,fullExtent:b,minScale:c[0].scale,maxScale:c[c.length-
1].scale,tiles:a.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:c,spatialReference:{wkid:102100}}}}Object.defineProperty(h,"__esModule",{value:!0});var v=g.defaults&&g.defaults.io.corsEnabledServers||g.request.corsEnabledServers;h.loadMetadata=function(d){if(!d)return k.reject("invalid input URL!");var g={layerDefinition:null,parsedUrl:null,serviceUrl:null,style:null,styleUrl:null,url:null,spriteUrl:null,glyphsUrl:null};if("string"!==typeof d)return b(g,
d).then(function(){return g});d=g.url=m.normalize(d);var h=g.parsedUrl=m.urlToObject(d);e(d);return f(h.path,{responseType:"json",query:a.mixin({f:"json"},h.query)}).then(function(a){return b(g,a.data)}).then(function(){return g})}})},"esri/portal/support/jsonContext":function(){define(["require","exports","../../core/urlUtils","../Portal"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});h.createForItem=function(g){return{origin:"portal-item",url:d.urlToObject(g.itemUrl),portal:g.portal||
a.getDefault()}}})},"esri/views/vectorTiles/SchemaHelper":function(){define(["require","exports"],function(p,h){return function(){function d(a,d){this.lockedSchemaPixelSize=a;this.isWGS84=d}d.prototype.getCompatibleLevelRowCol=function(a){var d=a[0],f=a[1];a=a[2];this.isWGS84?(f>>=1,a>>=1):256===this.lockedSchemaPixelSize&&0<d&&(d--,f>>=1,a>>=1);return[d,f,a]};d.prototype.getSchemaShift=function(a,d){var f=0,g=0;if(256===this.lockedSchemaPixelSize||this.isWGS84)a[2]%2&&(f=2*d),a[1]%2&&(g=2*d);return[f,
g]};d.prototype.adjustLevel=function(a){return this.isWGS84?a:256===this.lockedSchemaPixelSize?0<a?a-1:0:a};d.create256x256CompatibleTileInfo=function(a){if(!a)return null;if(256===a.rows&&256===a.cols)return a;for(var d=a.format,f=a.compressionQuality,h=a.dpi,m=a.origin,e=a.spatialReference,b=4326===e.wkid,l=[],t,u,r=a.lods.length,v=0;v<r;v++){var q=a.lods[v];t=q.scale;u=b?q.resolution:2*q.resolution;l.push({level:q.level,scale:t,resolution:u})}return{rows:256,cols:256,dpi:h,format:d,compressionQuality:f,
origin:m,spatialReference:e,lods:l}};d.create512x512CompatibleTileInfo=function(a){if(!a||256===a.rows||256===a.cols)return null;for(var d=a.format,f=a.compressionQuality,h=a.dpi,m=a.origin,e=a.spatialReference,b=[],l,t,u=a.lods.length,r=0;r<u;r++){var v=a.lods[r];l=v.scale;t=.5*v.resolution;b.push({level:v.level,scale:l,resolution:t})}return{rows:512,cols:512,dpi:h,format:d,compressionQuality:f,origin:m,spatialReference:e,lods:b}};return d}()})},"esri/views/vectorTiles/style/StyleRepository":function(){define(["require",
"exports","dojo/has","./StyleLayer"],function(p,h,d,a){return function(){function g(a,h){this.styleJSON=a;this.version=parseFloat(a.version);this.sprite=h?h.spriteUrl:a.sprite;this.glyphs=h?h.glyphsUrl:a.glyphs;if(d("stable-symbol-rendering")){var f=(a.layers||[]).filter(function(a){return a.layout&&a.layout["text-font"]})[0];f&&(a.layers||[]).forEach(function(a){a.layout&&a.layout["text-font"]&&(a.layout["text-font"]=f.layout["text-font"])})}this.layers=(a.layers||[]).map(g._create);this._identifyRefLayers()}
g.prototype._identifyRefLayers=function(){for(var a=[],d=[],g=0,e=0,b=this.layers;e<b.length;e++){var h=b[e];if(1===h.type){var t=h,u=h.sourceLayer,u=u+("|"+JSON.stringify(h.minzoom)),u=u+("|"+JSON.stringify(h.maxzoom)),u=u+("|"+JSON.stringify(h.filter));if(t.hasDataDrivenFill||t.hasDataDrivenOutline)u+="|"+JSON.stringify(g);a.push({key:u,layer:h})}2===h.type&&(t=h,u=h.sourceLayer,u+="|"+JSON.stringify(h.minzoom),u+="|"+JSON.stringify(h.maxzoom),u+="|"+JSON.stringify(h.filter),u+="|"+JSON.stringify(h.layout&&
h.layout["line-cap"]),u+="|"+JSON.stringify(h.layout&&h.layout["line-join"]),t.hasDataDrivenLine&&(u+="|"+JSON.stringify(g)),d.push({key:u,layer:h}));++g}this._assignRefLayers(a);this._assignRefLayers(d)};g.prototype._assignRefLayers=function(a){a.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});for(var d,f,e=a.length,b=0;b<e;b++){var g=a[b];if(g.key===d)g.layer.refLayerId=f;else if(d=g.key,f=g.layer.id,1===g.layer.type&&!g.layer.getPaintProperty("fill-outline-color"))for(var h=b+1;h<e;h++){var u=
a[h];if(u.key===d){if(u.layer.getPaintProperty("fill-outline-color")){a[b]=u;a[h]=g;f=u.layer.id;break}}else break}}};g._create=function(d,g,h){g=1-1/(h.length+1)*(1+g);switch(d.type){case "background":return new a.BackgroundStyleLayer(0,d,g);case "fill":return new a.FillStyleLayer(1,d,g);case "line":return new a.LineStyleLayer(2,d,g);case "symbol":return new a.SymbolStyleLayer(3,d,g);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new a.CircleStyleLayer(4,d,
g)}throw Error("Unknown vector tile layer");};return g}()})},"esri/views/vectorTiles/style/StyleLayer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ./Filter ./StyleDefinition ./StyleProperty".split(" "),function(p,h,d,a,g,f,k){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function a(a,b,d){this.type=a;this.id=b.id;this.source=b.source;this.sourceLayer=b["source-layer"];this.minzoom=b.minzoom;this.maxzoom=b.maxzoom;
this.filter=b.filter;this.layout=b.layout;this.paint=b.paint;this.z=d;switch(a){case 0:this._layoutDefinition=f.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=f.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=f.StyleDefinition.fillLayoutDefinition;this._paintDefinition=f.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=f.StyleDefinition.lineLayoutDefinition;this._paintDefinition=f.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=
f.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=f.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=f.StyleDefinition.circleLayoutDefinition,this._paintDefinition=f.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}a.prototype.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=g.createFilter(this.filter)};a.prototype.getLayoutProperty=
function(a){var b=this._layoutProperties;if(b)return b[a]};a.prototype.getPaintProperty=function(a){var b=this._paintProperties;if(b)return b[a]};a.prototype.getLayoutValue=function(a,b,d){var e,f=this._layoutProperties;f&&(f=f[a])&&(e=f.getValue(b,d));a=this._layoutDefinition[a];void 0===e&&(e=a["default"]);"enum"===a.type&&(e=a.values.indexOf(e));return e};a.prototype.getPaintValue=function(a,b,d){var e,f=this._paintProperties;f&&(f=f[a])&&(e=f.getValue(b,d));a=this._paintDefinition[a];void 0===
e&&(e=a["default"]);"enum"===a.type&&(e=a.values.indexOf(e));return e};a.prototype._parseLayout=function(a){var b={},d;for(d in a){var e=this._layoutDefinition[d];e&&(b[d]=new k(d,e,a[d]))}return b};a.prototype._parsePaint=function(a){var b={},d;for(d in a){var e=this._paintDefinition[d];e&&(b[d]=new k(d,e,a[d]))}return b};return a}();h.StyleLayer=p;a=function(a){function e(b,d,e){return a.call(this,b,d,e)||this}d(e,a);return e}(p);h.BackgroundStyleLayer=a;a=function(a){function e(b,d,e){b=a.call(this,
b,d,e)||this;b.hasDataDrivenFill=!1;(d=b.getPaintProperty("fill-color"))&&d.isDataDriven&&(b.hasDataDrivenFill=!0);(e=b.getPaintProperty("fill-opacity"))&&e.isDataDriven&&(b.hasDataDrivenFill=!0);b.hasDataDrivenOutline=!1;(e=b.getPaintProperty("fill-outline-color"))&&e.isDataDriven&&(b.hasDataDrivenOutline=!0);!e&&d&&d.isDataDriven&&(b.hasDataDrivenOutline=!0);return b}d(e,a);return e}(p);h.FillStyleLayer=a;a=function(a){function e(b,d,e){b=a.call(this,b,d,e)||this;b.hasDataDrivenLine=!1;(d=b.getPaintProperty("line-color"))&&
d.isDataDriven&&(b.hasDataDrivenLine=!0);(d=b.getPaintProperty("line-opacity"))&&d.isDataDriven&&(b.hasDataDrivenLine=!0);(d=b.getPaintProperty("line-width"))&&d.isDataDriven&&(b.hasDataDrivenLine=!0);return b}d(e,a);return e}(p);h.LineStyleLayer=a;a=function(a){function e(b,d,e){b=a.call(this,b,d,e)||this;b.hasDataDrivenIcon=!1;(d=b.getPaintProperty("icon-color"))&&d.isDataDriven&&(b.hasDataDrivenIcon=!0);(d=b.getPaintProperty("icon-opacity"))&&d.isDataDriven&&(b.hasDataDrivenIcon=!0);(d=b.getLayoutProperty("icon-size"))&&
d.isDataDriven&&(b.hasDataDrivenIcon=!0);b.hasDataDrivenText=!1;(d=b.getPaintProperty("text-color"))&&d.isDataDriven&&(b.hasDataDrivenText=!0);(d=b.getPaintProperty("text-opacity"))&&d.isDataDriven&&(b.hasDataDrivenText=!0);(d=b.getLayoutProperty("text-size"))&&d.isDataDriven&&(b.hasDataDrivenText=!0);return b}d(e,a);return e}(p);h.SymbolStyleLayer=a;p=function(a){function e(b,d,e){return a.call(this,b,d,e)||this}d(e,a);return e}(p);h.CircleStyleLayer=p;p=function(){return function(a,d,b){this.cap=
a.getLayoutValue("line-cap",d,b);this.join=a.getLayoutValue("line-join",d,b);this.miterLimit=a.getLayoutValue("line-miter-limit",d,b);this.roundLimit=a.getLayoutValue("line-round-limit",d,b)}}();h.LineLayout=p;p=function(){return function(a,d,b,f){this.allowOverlap=a.getLayoutValue("icon-allow-overlap",d,f);this.ignorePlacement=a.getLayoutValue("icon-ignore-placement",d,f);this.optional=a.getLayoutValue("icon-optional",d,f);this.rotationAlignment=a.getLayoutValue("icon-rotation-alignment",d,f);this.size=
a.getLayoutValue("icon-size",d,f);this.rotate=a.getLayoutValue("icon-rotate",d,f);this.padding=a.getLayoutValue("icon-padding",d,f);this.keepUpright=a.getLayoutValue("icon-keep-upright",d,f);this.offset=a.getLayoutValue("icon-offset",d,f);2===this.rotationAlignment&&(this.rotationAlignment=b?0:1)}}();h.IconLayout=p;p=function(){return function(a,d,b,f){this.allowOverlap=a.getLayoutValue("text-allow-overlap",d,f);this.ignorePlacement=a.getLayoutValue("text-ignore-placement",d,f);this.optional=a.getLayoutValue("text-optional",
d,f);this.rotationAlignment=a.getLayoutValue("text-rotation-alignment",d,f);this.fontArray=a.getLayoutValue("text-font",d,f);this.maxWidth=a.getLayoutValue("text-max-width",d,f);this.lineHeight=a.getLayoutValue("text-line-height",d,f);this.letterSpacing=a.getLayoutValue("text-letter-spacing",d,f);this.justify=a.getLayoutValue("text-justify",d,f);this.anchor=a.getLayoutValue("text-anchor",d,f);this.maxAngle=a.getLayoutValue("text-max-angle",d,f);this.size=a.getLayoutValue("text-size",d,f);this.rotate=
a.getLayoutValue("text-rotate",d,f);this.padding=a.getLayoutValue("text-padding",d,f);this.keepUpright=a.getLayoutValue("text-keep-upright",d,f);this.transform=a.getLayoutValue("text-transform",d,f);this.offset=a.getLayoutValue("text-offset",d,f);2===this.rotationAlignment&&(this.rotationAlignment=b?0:1)}}();h.TextLayout=p})},"esri/views/vectorTiles/style/Filter":function(){define(["require","exports"],function(p,h){return function(){function d(a,g,f){this._op=a;"$type"===g?(this._val=f instanceof
Array?f.map(function(a){return d._types.indexOf(a)}):d._types.indexOf(f),this._op+=11):(this._key=g,this._val=f)}d.prototype.filter=function(a){switch(this._op){case 0:return this._val;case 1:return a.values[this._key]===this._val;case 2:return a.values[this._key]!==this._val;case 3:return a.values[this._key]<this._val;case 4:return a.values[this._key]>this._val;case 5:return a.values[this._key]<=this._val;case 6:return a.values[this._key]>=this._val;case 7:return-1!==this._val.indexOf(a.values[this._key]);
case 8:return-1===this._val.indexOf(a.values[this._key]);case 9:for(var d=0,f=this._val;d<f.length;d++){var h=f[d];if(h.filter(a))return!0}return!1;case 10:d=0;for(f=this._val;d<f.length;d++)if(h=f[d],!h.filter(a))return!1;return!0;case 11:d=0;for(f=this._val;d<f.length;d++)if(h=f[d],h.filter(a))return!1;return!0;case 12:return a.type===this._val;case 13:return a.type!==this._val;case 14:return a.type<this._val;case 15:return a.type>this._val;case 16:return a.type>=this._val;case 17:return a.type<=
this._val;case 18:return-1!==this._val.indexOf(a.type);case 19:return-1===this._val.indexOf(a.type)}};d.createFilter=function(a){if(!a)return new d(0,void 0,!0);var g=a[0];if(1>=a.length)return new d(0,void 0,"any"!==g);switch(g){case "\x3d\x3d":return new d(1,a[1],a[2]);case "!\x3d":return new d(2,a[1],a[2]);case "\x3e":return new d(4,a[1],a[2]);case "\x3c":return new d(3,a[1],a[2]);case "\x3e\x3d":return new d(6,a[1],a[2]);case "\x3c\x3d":return new d(5,a[1],a[2]);case "in":return new d(7,a[1],
a.slice(2));case "!in":return new d(8,a[1],a.slice(2));case "any":return new d(9,void 0,a.slice(1).map(d.createFilter.bind(this)));case "all":return new d(10,void 0,a.slice(1).map(d.createFilter.bind(this)));case "none":return new d(11,void 0,a.slice(1).map(d.createFilter.bind(this)));default:throw Error("invalid operator: "+g);}};d._types=["Unknown","Point","LineString","Polygon"];return d}()})},"esri/views/vectorTiles/style/StyleDefinition":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,
"__esModule",{value:!0});p=function(){function d(){}d.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],"default":"visible"}};d.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],"default":"visible"}};d.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],"default":"visible"},"line-cap":{type:"enum",values:["butt","round","square"],"default":"butt"},"line-join":{type:"enum",values:["bevel","round","miter"],"default":"miter"},"line-miter-limit":{type:"number",
"default":2},"line-round-limit":{type:"number","default":1.05}};d.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],"default":"visible"},"symbol-placement":{type:"enum",values:["point","line"],"default":"point"},"symbol-spacing":{type:"number",minimum:1,"default":250},"symbol-avoid-edges":{type:"boolean","default":!1},"icon-image":{type:"string"},"icon-allow-overlap":{type:"boolean","default":!1},"icon-ignore-placement":{type:"boolean","default":!1},"icon-optional":{type:"boolean",
"default":!1},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],"default":"auto"},"icon-size":{type:"number",minimum:0,"default":1},"icon-rotate":{type:"number","default":0},"icon-padding":{type:"number",minimum:0,"default":2},"icon-keep-upright":{type:"boolean","default":!1},"icon-offset":{type:"array",value:"number",length:2,"default":[0,0]},"text-field":{type:"string"},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],"default":"auto"},"text-font":{type:"array",
value:"string","default":["Open Sans Regular","Arial Unicode MS Regular"]},"text-size":{type:"number",minimum:0,"default":16},"text-max-width":{type:"number",minimum:0,"default":10},"text-line-height":{type:"number","default":1.2},"text-letter-spacing":{type:"number","default":0},"text-justify":{type:"enum",values:["left","center","right"],"default":"center"},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),"default":"center"},
"text-max-angle":{type:"number",minimum:0,"default":45},"text-rotate":{type:"number","default":0},"text-padding":{type:"number",minimum:0,"default":2},"text-keep-upright":{type:"boolean","default":!0},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],"default":"none"},"text-offset":{type:"array",value:"number",length:2,"default":[0,0]},"text-allow-overlap":{type:"boolean","default":!1},"text-ignore-placement":{type:"boolean","default":!1},"text-optional":{type:"boolean","default":!1}};
d.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],"default":"visible"}};d.backgroundPaintDefinition={"background-opacity":{type:"number",minimum:0,maximum:1,"default":1},"background-color":{type:"color","default":[0,0,0,1]},"background-pattern":{type:"string"}};d.fillPaintDefinition={"fill-opacity":{type:"number",minimum:0,maximum:1,"default":1},"fill-antialias":{type:"boolean","default":!0},"fill-color":{type:"color","default":[0,0,0,1]},"fill-outline-color":{type:"color",
"default":[0,0,0,0]},"fill-translate":{type:"array",value:"number",length:2,"default":[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],"default":"map"},"fill-pattern":{type:"string"}};d.linePaintDefinition={"line-opacity":{type:"number",minimum:0,maximum:1,"default":1},"line-color":{type:"color","default":[0,0,0,1]},"line-translate":{type:"array",value:"number",length:2,"default":[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],"default":"map"},"line-width":{type:"number",
minimum:0,"default":1},"line-gap-width":{type:"number",minimum:0,"default":0},"line-offset":{type:"number","default":0},"line-blur":{type:"number",minimum:0,"default":0},"line-dasharray":{type:"array",value:"number","default":[]},"line-pattern":{type:"string"}};d.symbolPaintDefinition={"icon-opacity":{type:"number",minimum:0,maximum:1,"default":1},"icon-color":{type:"color","default":[0,0,0,1]},"icon-halo-color":{type:"color","default":[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,"default":0},
"icon-halo-blur":{type:"number",minimum:0,"default":0},"icon-translate":{type:"array",value:"number",length:2,"default":[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],"default":"map"},"text-opacity":{type:"number",minimum:0,maximum:1,"default":1},"text-color":{type:"color","default":[0,0,0,1]},"text-halo-color":{type:"color","default":[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,"default":0},"text-halo-blur":{type:"number",minimum:0,"default":0},"text-translate":{type:"array",
value:"number",length:2,"default":[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],"default":"map"}};d.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,"default":1},"raster-hue-rotate":{type:"number","default":0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,"default":0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,"default":1},"raster-saturation":{type:"number",minimum:-1,maximum:1,"default":0},"raster-contrast":{type:"number",
minimum:-1,maximum:1,"default":0},"raster-fade-duration":{type:"number",minimum:0,"default":300}};d.circlePaintDefinition={"circle-opacity":{type:"number",minimum:0,maximum:1,"default":1},"circle-radius":{type:"number",minimum:0,"default":5},"circle-color":{type:"color","default":[0,0,0,1]},"circle-blur":{type:"number",minimum:0,"default":0},"circle-translate":{type:"array",value:"number",length:2,"default":[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],"default":"map"},"circle-stroke-width":{type:"number",
minimum:0,"default":0},"circle-stroke-color":{type:"color","default":[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,"default":1}};return d}();h.StyleDefinition=p})},"esri/views/vectorTiles/style/StyleProperty":function(){define(["require","exports","../../../Color","../GeometryUtils"],function(p,h,d,a){return function(){function g(a,d,h){this.isDataDriven=!1;switch(d.type){case "number":a=!0;break;case "color":a=!0;h=g._parseColor(h);break;case "array":a="number"===d.value;
break;default:a=!1}null==h&&(h=d.default);a&&"interval"===h.type&&(a=!1);var e=h&&h.stops&&0<h.stops.length;if(this.isDataDriven=h&&!!h.property)if(e)switch(h.type){case "identity":this.getValue=this._buildIdentity(h,d);break;case "categorical":this.getValue=this._buildCategorical(h,d);break;default:this.getValue=a?this._buildInterpolate(h,d):this._buildInterval(h,d)}else this.getValue=this._buildIdentity(h,d);else this.getValue=e?a?this._buildZoomInterpolate(h):this._buildZoomInterval(h):this._buildSimple(h)}
g.prototype._buildSimple=function(a){return function(){return a}};g.prototype._buildIdentity=function(a,d){return function(f,e){var b;e&&(b=e.values[a.property],"color"===d.type&&(b=g._parseColor(b)));return void 0!==b?b:void 0!==a.default?a.default:d.default}};g.prototype._buildCategorical=function(a,d){var f=this;return function(e,b){var g;b&&(g=b.values[a.property]);g=f._categorical(g,a.stops);return void 0!==g?g:void 0!==a.default?a.default:d.default}};g.prototype._buildInterval=function(a,d){var f=
this;return function(e,b){var g;b&&(g=b.values[a.property]);return"number"===typeof g?f._interval(g,a.stops):void 0!==a.default?a.default:d.default}};g.prototype._buildInterpolate=function(a,d){var f=this;return function(e,b){var g;b&&(g=b.values[a.property]);return"number"===typeof g?f._interpolate(g,a.stops,a.base||1):void 0!==a.default?a.default:d.default}};g.prototype._buildZoomInterpolate=function(a){var d=this;return function(f){return d._interpolate(f,a.stops,a.base||1)}};g.prototype._buildZoomInterval=
function(a){var d=this;return function(f){return d._interval(f,a.stops)}};g.prototype._categorical=function(a,d){for(var f=d.length,e=0;e<f;e++)if(d[e][0]===a)return d[e][1]};g.prototype._interval=function(a,d){for(var f=d.length,e=0,b=0;b<f;b++)if(d[b][0]<=a)e=b;else break;return d[e][1]};g.prototype._interpolate=function(d,g,h){for(var e,b,f=g.length,k=0;k<f;k++){var m=g[k];if(m[0]<=d)e=m;else{b=m;break}}if(e&&b){k=b[0]-e[0];d-=e[0];h=1===h?d/k:(Math.pow(h,d)-1)/(Math.pow(h,k)-1);if(Array.isArray(e[1])){e=
e[1];b=b[1];d=[];for(k=0;k<e.length;k++)d.push(a.interpolate(e[k],b[k],h));return d}return a.interpolate(e[1],b[1],h)}if(e)return e[1];if(b)return b[1]};g._isEmpty=function(a){for(var d in a)if(a.hasOwnProperty(d))return!1;return!0};g._parseColor=function(a){if(Array.isArray(a))return a;if("string"===typeof a){if(a=new d(a),!this._isEmpty(a))return d.toUnitRGBA(a)}else return a&&a.default&&(a.default=g._parseColor(a.default)),a&&a.stops&&(a.stops=a.stops.map(function(a){return[a[0],g._parseColor(a[1])]})),
a};return g}()})},"esri/views/vectorTiles/GeometryUtils":function(){define(["require","exports"],function(p,h){function d(a,d){a%=d;return 0<=a?a:a+d}Object.defineProperty(h,"__esModule",{value:!0});h.C_INFINITY=Number.POSITIVE_INFINITY;h.C_PI=Math.PI;h.C_2PI=2*h.C_PI;h.C_PI_BY_2=h.C_PI/2;h.C_RAD_TO_256=128/h.C_PI;h.C_256_TO_RAD=h.C_PI/128;h.C_DEG_TO_256=256/360;h.C_DEG_TO_RAD=h.C_PI/180;h.C_SQRT2=1.414213562;h.C_SQRT2_INV=1/h.C_SQRT2;var a=1/Math.LN2;h.positiveMod=d;h.radToByte=function(a){return d(a*
h.C_RAD_TO_256,256)};h.degToByte=function(a){return d(a*h.C_DEG_TO_256,256)};h.log2=function(d){return Math.log(d)*a};h.sqr=function(a){return a*a};h.clamp=function(a,d,h){return Math.min(Math.max(a,d),h)};h.interpolate=function(a,d,h){return a*(1-h)+d*h};h.between=function(a,d,h){return a>=d&&a<=h||a>=h&&a<=d}})},"esri/layers/WMTSLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/_base/lang ../request ../core/Collection ../core/Error ../core/Handles ../core/promiseUtils ../core/accessorSupport/decorators ../geometry/Extent ./Layer ./WebTileLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./support/WMTSSublayer ./support/wmtsUtils".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x){function z(a,b){return a.map(function(a){var d=new c;d.read(a,b);return d})}var A={"image/png":".png","image/png8":".png","image/png24":".png","image/png32":".png","image/jpg":".jpg","image/jpeg":".jpeg","image/gif":".gif","image/bmp":".bmp","image/tiff":".tif","image/jpgpng":"","image/jpegpng":"","image/unknown":""};return function(h){function n(a,c){var b=h.call(this)||this;b._sublayersHandles=new e;b.copyright=null;b.customParameters=null;b.customLayerParameters=
null;b.fullExtent=null;b.operationalLayerType="WebTiledLayer";b.resourceInfo=null;b.serviceMode="RESTful";b.sublayers=null;b.type="wmts";b.version="1.0.0";b.watch("activeLayer",function(a,c){c&&(c.layer=null);a&&(a.layer=b)},!0);b.watch("sublayers",function(a,c){c&&(c.forEach(function(a){a.layer=null}),b._sublayersHandles.removeAll(),b._sublayersHandles=null);a&&(a.forEach(function(a){a.layer=b}),b._sublayersHandles||(b._sublayersHandles=new e),b._sublayersHandles.add([a.on("after-add",function(a){a.item.layer=
b}),a.on("after-remove",function(a){a.item.layer=null})]))},!0);return b}d(n,h);n.prototype.normalizeCtorArgs=function(a,c){return"string"===typeof a?g.mixin({},{url:a},c):a};n.prototype.load=function(){var a=this;if("KVP"!==this.serviceMode&&"RESTful"!==this.serviceMode)console.error("WMTS mode could only be 'KVP' or 'RESTful'");else return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WMTS"]}).then(function(){return a._fetchService()}).catch(function(){return b.reject(new m("wmtslayer:unsupported-service-data",
"Invalid response from the WMTS service."))})),this.when()};Object.defineProperty(n.prototype,"activeLayer",{get:function(){return this._get("activeLayer")},set:function(a){this._set("activeLayer",a)},enumerable:!0,configurable:!0});n.prototype.readActiveLayerFromService=function(a,b,d){var e=this,f;this.activeLayer?b.layers.some(function(a){return a.id===e.activeLayer.id?(f=a,!0):!1}):(this.activeLayer=new c,f=b.layers[0]);this.activeLayer.read(f,d);return this.activeLayer};n.prototype.readActiveLayerFromItemOrWebDoc=
function(a,b,d){return new c({id:b.wmtsInfo.layerIdentifier,tileMatrixSetId:b.wmtsInfo.tileMatrixSet})};n.prototype.writeActiveLayer=function(a,c){a=this.activeLayer;c.templateUrl=this.getUrlTemplate(a.id,a.tileMatrixSetId,a.imageFormat,a.styleId);c.wmtsInfo=g.mixin(c.wmtsInfo||{},{layerIdentifier:a.id,tileMatrixSet:a.tileMatrixSetId})};Object.defineProperty(n.prototype,"fullExtents",{get:function(){var a=[];this.activeLayer.tileMatrixSets.forEach(function(c){c.fullExtent&&a.push(c.fullExtent)});
return a},enumerable:!0,configurable:!0});n.prototype.readServiceMode=function(a,c,b){return-1<c.templateUrl.indexOf("?")?"KVP":"RESTful"};n.prototype.readSublayersFromService=function(a,c,b){return z(c.layers,b)};Object.defineProperty(n.prototype,"supportedSpatialReferences",{get:function(){return this.activeLayer.tileMatrixSets.map(function(a){return a.tileInfo.spatialReference}).toArray()},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"title",{get:function(){return"Layer"===
this._get("title")?this.activeLayer&&this.activeLayer.title:this._get("title")},set:function(a){this._set("title",a)},enumerable:!0,configurable:!0});Object.defineProperty(n.prototype,"url",{get:function(){return this._get("url")},set:function(a){a&&"/"===a.substr(-1)?this._set("url",a.slice(0,-1)):this._set("url",a)},enumerable:!0,configurable:!0});n.prototype.createWebTileLayer=function(a){var c=this.getUrlTemplate(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.imageFormat,
this.activeLayer.styleId),b=this._getTileMatrixSetById(a.tileMatrixSetId).tileInfo,d=a.fullExtent;a={layerIdentifier:a.id,tileMatrixSet:a.tileMatrixSetId,url:this.url};this.customLayerParameters&&(a.customLayerParameters=this.customLayerParameters);this.customParameters&&(a.customParameters=this.customParameters);return new r({fullExtent:d,urlTemplate:c,tileInfo:b,wmtsInfo:a})};n.prototype.fetchTile=function(a,c,b){a=this.getTileUrl(a,c,b);return f(a,{responseType:"image"}).then(function(a){return a.data})};
n.prototype.findSublayerById=function(a){return this.sublayers.find(function(c){return c.id===a})};n.prototype.getTileUrl=function(a,c,b){var d=this._getTileMatrixSetById(this.activeLayer.tileMatrixSetId).tileInfo.lods[a],d=d.levelValue?d.levelValue:String(d.level);(a=this.resourceInfo?"":x.getTileUrlFromResourceUrls(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.styleId,a,c,b))||(a=this.getUrlTemplate(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.imageFormat,
this.activeLayer.styleId).replace(/\{level\}/gi,d).replace(/\{row\}/gi,c).replace(/\{col\}/gi,b));return a=this._appendCustomLayerParameters(a)};n.prototype.getUrlTemplate=function(a,c,b,d){var e="";if(!this.resourceInfo&&(e=x.getTileUrlTemplateFromResourceUrls(a,c,b,d)))return e;"KVP"===this.serviceMode?e=this.url+"?SERVICE\x3dWMTS\x26VERSION\x3d"+this.version+"\x26REQUEST\x3dGetTile\x26LAYER\x3d"+a+"\x26STYLE\x3d"+d+"\x26FORMAT\x3d"+b+"\x26TILEMATRIXSET\x3d"+c+"\x26TILEMATRIX\x3d{level}\x26TILEROW\x3d{row}\x26TILECOL\x3d{col}":
"RESTful"===this.serviceMode&&(e="",A[b.toLowerCase()]&&(e=A[b.toLowerCase()]),e=this.url+a+"/"+d+"/"+c+"/{level}/{row}/{col}"+e);return e};n.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return b.create(function(a){return p(["../views/2d/layers/WMTSLayerView2D"],a)});case "3d":return b.create(function(a){return p(["../views/3d/layers/WMTSLayerView3D"],a)})}};n.prototype._fetchService=function(){var a=this;return b.resolve().then(function(){if(a.resourceInfo)return"KVP"===a.resourceInfo.serviceMode&&
(a.url+=-1<a.url.indexOf("?")?"":"?"),{ssl:!1,data:a.resourceInfo};var c=a._getCapabilitiesUrl(a.serviceMode);return f(c,{responseType:"text",callbackParamName:"callback"}).catch(function(b){c=a._getCapabilitiesUrl("KVP"===a.serviceMode?"RESTful":"KVP");return f(c,{responseType:"text",callbackParamName:"callback"})})}).then(function(c){c.data=a.resourceInfo?x.parseResourceInfo(c.data):x.parseCapabilities(c.data,{serviceMode:a.serviceMode,url:a.url});c.data&&a.read(c.data,{origin:"service"})})};n.prototype._getTileMatrixSetById=
function(a){return this.findSublayerById(this.activeLayer.id).tileMatrixSets.find(function(c){return c.id===a})};n.prototype._appendCustomParameters=function(a){if(this.customParameters)for(var c in this.customParameters)a+=(-1===a.indexOf("?")?"?":"\x26")+c+"\x3d"+encodeURIComponent(this.customParameters[c]);return a};n.prototype._appendCustomLayerParameters=function(a){if(this.customLayerParameters||this.customParameters){var c=g.clone(this.customParameters||{});g.mixin(c,this.customLayerParameters||
{});for(var b in c)a+=(-1===a.indexOf("?")?"?":"\x26")+b+"\x3d"+encodeURIComponent(c[b])}return a};n.prototype._getCapabilitiesUrl=function(a){var c;this.url=this.url.split("?")[0];"KVP"===a?c=this.url+"?request\x3dGetCapabilities\x26service\x3dWMTS\x26version\x3d"+this.version:"RESTful"===a&&(c=this.url+"/"+this.version+"/WMTSCapabilities.xml");return c=this._appendCustomParameters(c)};a([l.property({type:c,dependsOn:["sublayers"],json:{origins:{"web-document":{write:{ignoreOrigin:!0}}}}})],n.prototype,
"activeLayer",null);a([l.reader("service","activeLayer",["layers"])],n.prototype,"readActiveLayerFromService",null);a([l.reader(["web-document","portal-item"],"activeLayer",["wmtsInfo"])],n.prototype,"readActiveLayerFromItemOrWebDoc",null);a([l.writer(["web-document","portal-item"],"activeLayer")],n.prototype,"writeActiveLayer",null);a([l.property()],n.prototype,"copyright",void 0);a([l.property({json:{origins:{"web-document":{read:{source:"wmtsInfo.customParameters"},write:{target:"wmtsInfo.customParameters"}},
"portal-item":{read:{source:"wmtsInfo.customParameters"},write:{target:"wmtsInfo.customParameters"}}}}})],n.prototype,"customParameters",void 0);a([l.property({json:{origins:{"web-document":{read:{source:"wmtsInfo.customLayerParameters"},write:{target:"wmtsInfo.customLayerParameters"}},"portal-item":{read:{source:"wmtsInfo.customLayerParameters"},write:{target:"wmtsInfo.customLayerParameters"}}}}})],n.prototype,"customLayerParameters",void 0);a([l.property({type:t,json:{write:{ignoreOrigin:!0},origins:{"web-document":{read:{source:"fullExtent"}},
"portal-item":{read:{source:"fullExtent"}}}}})],n.prototype,"fullExtent",void 0);a([l.property({readOnly:!0,dependsOn:["activeLayer"]})],n.prototype,"fullExtents",null);a([l.property()],n.prototype,"operationalLayerType",void 0);a([l.property()],n.prototype,"resourceInfo",void 0);a([l.property()],n.prototype,"serviceMode",void 0);a([l.reader(["portal-item","web-document"],"serviceMode",["templateUrl"])],n.prototype,"readServiceMode",null);a([l.property({type:k.ofType(c)})],n.prototype,"sublayers",
void 0);a([l.reader("service","sublayers",["layers"])],n.prototype,"readSublayersFromService",null);a([l.property({readOnly:!0,dependsOn:["activeLayer"]})],n.prototype,"supportedSpatialReferences",null);a([l.property({dependsOn:["activeLayer"],json:{read:{source:"title"}}})],n.prototype,"title",null);a([l.property({json:{read:!1},readOnly:!0,value:"wmts"})],n.prototype,"type",void 0);a([l.property({json:{origins:{service:{read:{source:"tileUrl"}},"web-document":{read:{source:"wmtsInfo.url"},write:{target:"wmtsInfo.url"}},
"portal-item":{read:{source:"wmtsInfo.url"},write:{target:"wmtsInfo.url"}}}}})],n.prototype,"url",null);a([l.property()],n.prototype,"version",void 0);return n=a([l.subclass("esri.layers.WMTSLayer")],n)}(l.declared(u,v,q,n,w))})},"esri/layers/WebTileLayer":function(){define("dojo/_base/lang dojo/_base/url dojo/string ../core/Error ../core/MultiOriginJSONSupport ../core/urlUtils ../geometry/SpatialReference ../geometry/Extent ../geometry/Point ./TiledLayer ./mixins/OperationalLayer ./mixins/ScaleRangeLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./support/TileInfo ./support/LOD ./support/commonProperties".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n){return b.createSubclass([l,g,t,u,r],{declaredClass:"esri.layers.WebTileLayer",normalizeCtorArgs:function(a,c){return"string"===typeof a?p.mixin({urlTemplate:a},c||{}):a},getDefaults:function(a){var c=new m(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,k.WebMercator);return p.mixin(this.inherited(arguments),{fullExtent:c,tileInfo:new v({size:256,dpi:96,format:"PNG8",compressionQuality:0,origin:new e({x:-2.0037508342787E7,y:2.0037508342787E7,
spatialReference:k.WebMercator}),spatialReference:k.WebMercator,lods:[new q({level:0,scale:5.91657527591555E8,resolution:156543.033928}),new q({level:1,scale:2.95828763795777E8,resolution:78271.5169639999}),new q({level:2,scale:1.47914381897889E8,resolution:39135.7584820001}),new q({level:3,scale:7.3957190948944E7,resolution:19567.8792409999}),new q({level:4,scale:3.6978595474472E7,resolution:9783.93962049996}),new q({level:5,scale:1.8489297737236E7,resolution:4891.96981024998}),new q({level:6,scale:9244648.868618,
resolution:2445.98490512499}),new q({level:7,scale:4622324.434309,resolution:1222.99245256249}),new q({level:8,scale:2311162.217155,resolution:611.49622628138}),new q({level:9,scale:1155581.108577,resolution:305.748113140558}),new q({level:10,scale:577790.554289,resolution:152.874056570411}),new q({level:11,scale:288895.277144,resolution:76.4370282850732}),new q({level:12,scale:144447.638572,resolution:38.2185141425366}),new q({level:13,scale:72223.819286,resolution:19.1092570712683}),new q({level:14,
scale:36111.909643,resolution:9.55462853563415}),new q({level:15,scale:18055.954822,resolution:4.77731426794937}),new q({level:16,scale:9027.977411,resolution:2.38865713397468}),new q({level:17,scale:4513.988705,resolution:1.19432856685505}),new q({level:18,scale:2256.994353,resolution:.597164283559817}),new q({level:19,scale:1128.497176,resolution:.298582141647617})]})})},properties:{copyright:{type:String,value:"",json:{write:!0}},fullExtent:{json:{write:!0}},legendEnabled:{json:{read:{source:["showLegend"],
reader:function(a,c){return null!=c.showLegend?c.showLegend:!0}},write:{target:"showLegend"}}},levelValues:{dependsOn:["tileInfo"],get:function(){var a=[];if(!this.tileInfo)return null;this.tileInfo.lods.forEach(function(c){a[c.level]=c.levelValue||c.level},this);return a}},operationalLayerType:"WebTiledLayer",popupEnabled:n.popupEnabled,refreshInterval:{json:{write:!0}},spatialReference:{type:k,value:k.WebMercator,json:{read:{source:["spatialReference","fullExtent.spatialReference"],reader:function(a,
c){return a||c.fullExtent&&c.fullExtent.spatialReference&&k.fromJSON(c.fullExtent.spatialReference)}}}},subDomains:{type:[String],value:null,json:{write:!0}},tileInfo:{type:v,json:{write:!0}},tileServers:{value:null,dependsOn:["urlTemplate","subDomains"],get:function(){if(!this.urlTemplate)return null;var a=new h(this.urlTemplate),c=a.scheme?a.scheme+"://":"//",b=c+a.authority+"/",d=this.subDomains,e,f=[];-1===a.authority.indexOf("{subDomain}")&&f.push(b);d&&0<d.length&&1<a.authority.split(".").length&&
d.forEach(function(b){-1<a.authority.indexOf("{subDomain}")&&(e=c+a.authority.replace(/\{subDomain\}/gi,b)+"/");f.push(e)},this);return f=f.map(function(a){"/"!==a.charAt(a.length-1)&&(a+="/");return a})}},type:{value:"web-tile",json:{read:!1}},urlPath:{dependsOn:["urlTemplate"],get:function(){if(!this.urlTemplate)return null;var a=this.urlTemplate,c=new h(a);return a.substring(((c.scheme?c.scheme+"://":"//")+c.authority+"/").length)}},urlTemplate:{type:String,json:{origins:{"portal-item":{read:{source:"url"}}},
read:{source:["urlTemplate","templateUrl"],reader:function(a,c){return a||c.templateUrl}},write:{target:"templateUrl",writer:function(a,c,b){a&&f.isProtocolRelative(a)&&(a="https:"+a);c[b]=a?f.normalize(a):a}}}},url:{json:{write:!1}},wmtsInfo:{json:{write:!0}}},getTileUrl:function(a,c,b){a=this.levelValues[a];var e=this.tileServers[c%this.tileServers.length]+d.substitute(this.urlPath,{level:a,col:b,row:c});return e=e.replace(/\{level\}/gi,a).replace(/\{row\}/gi,c).replace(/\{col\}/gi,b)},load:function(){var b=
this.loadFromPortal({supportedTypes:["WMTS"]}).then(function(){if(!this.urlTemplate)throw new a("layer:load","WebTileLayer (title: '"+this.title+"', id: '"+this.id+"') is missing the required 'urlTemplate' property value");}.bind(this));this.addResolvingPromise(b);return this}})})},"esri/layers/support/WMTSSublayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/Collection ../../core/JSONSupport ../../core/accessorSupport/decorators ../../geometry/Extent ./TileMatrixSet ./WMTSStyle".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l){return function(g){function h(a){a=g.call(this)||this;a.fullExtent=null;a.imageFormats=null;a.id=null;a.layer=null;a.styles=null;a.tileMatrixSetId=null;a.tileMatrixSets=null;return a}d(h,g);k=h;Object.defineProperty(h.prototype,"description",{get:function(){return this._get("description")},set:function(a){this._set("description",a)},enumerable:!0,configurable:!0});h.prototype.readFullExtent=function(a,b,d){return(a=b.fullExtent)?e.fromJSON(a):null};Object.defineProperty(h.prototype,
"imageFormat",{get:function(){var a=this._get("imageFormat");a||(a=this.imageFormats&&this.imageFormats.length?this.imageFormats[0]:"");return a},set:function(a){if(-1<a.indexOf("image/")||-1===this.imageFormats.indexOf(a))if(-1===a.indexOf("image/")&&(a="image/"+a),this.imageFormats&&-1===this.imageFormats.indexOf(a)){console.error("The layer doesn't support the format of "+a);return}this._set("imageFormat",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"styleId",{get:function(){var a=
this._get("styleId");a||(a=this.styles&&this.styles.length?this.styles.getItemAt(0).id:"");return a},set:function(a){this._set("styleId",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"title",{get:function(){return this._get("title")},set:function(a){this._set("title",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"tileMatrixSet",{get:function(){var a=this;return this.tileMatrixSets.find(function(b){return b.id===a.tileMatrixSetId})},enumerable:!0,configurable:!0});
h.prototype.clone=function(){var a=new k;this.hasOwnProperty("description")&&(a.description=this.description);this.hasOwnProperty("imageFormats")&&(a.imageFormats=this.imageFormats&&this.imageFormats.slice());this.hasOwnProperty("imageFormat")&&(a.imageFormat=this.imageFormat);this.hasOwnProperty("fullExtent")&&(a.fullExtent=this.fullExtent&&this.fullExtent.clone());this.hasOwnProperty("id")&&(a.id=this.id);this.hasOwnProperty("layer")&&(a.layer=this.layer);this.hasOwnProperty("styleId")&&(a.styleId=
this.styleId);this.hasOwnProperty("styles")&&(a.styles=this.styles&&this.styles.clone());this.hasOwnProperty("tileMatrixSetId")&&(a.tileMatrixSetId=this.tileMatrixSetId);this.hasOwnProperty("tileMatrixSets")&&(a.tileMatrixSets=this.tileMatrixSets.clone());this.hasOwnProperty("title")&&(a.title=this.title);return a};a([m.property()],h.prototype,"description",null);a([m.property()],h.prototype,"fullExtent",void 0);a([m.reader("fullExtent",["fullExtent"])],h.prototype,"readFullExtent",null);a([m.property({dependsOn:["imageFormats"]})],
h.prototype,"imageFormat",null);a([m.property({json:{read:{source:"formats"}}})],h.prototype,"imageFormats",void 0);a([m.property()],h.prototype,"id",void 0);a([m.property()],h.prototype,"layer",void 0);a([m.property()],h.prototype,"styleId",null);a([m.property({type:f.ofType(l),json:{read:{source:"styles"}}})],h.prototype,"styles",void 0);a([m.property({value:null,json:{write:{ignoreOrigin:!0}}})],h.prototype,"title",null);a([m.property()],h.prototype,"tileMatrixSetId",void 0);a([m.property({readOnly:!0,
dependsOn:["tileMatrixSetId"]})],h.prototype,"tileMatrixSet",null);a([m.property({type:f.ofType(b),json:{read:{source:"tileMatrixSets"}}})],h.prototype,"tileMatrixSets",void 0);return h=k=a([m.subclass("esri.layers.support.WMTSSublayer")],h);var k}(m.declared(k))})},"esri/layers/support/TileMatrixSet":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(p,h,d,a,g,f,k){return function(f){function e(a){a=f.call(this)||this;a.fullExtent=null;a.id=null;a.tileInfo=null;return a}d(e,f);b=e;e.prototype.clone=function(){var a=new b;this.hasOwnProperty("fullExtent")&&(a.fullExtent=this.fullExtent&&this.fullExtent.clone());this.hasOwnProperty("id")&&(a.id=this.id);this.hasOwnProperty("tileInfo")&&(a.tileInfo=this.tileInfo&&this.tileInfo.clone());return a};a([k.property({json:{read:{source:"fullExtent"}}})],e.prototype,"fullExtent",void 0);a([k.property({json:{read:{source:"id"}}})],
e.prototype,"id",void 0);a([k.property({json:{read:{source:"tileInfo"}}})],e.prototype,"tileInfo",void 0);return e=b=a([k.subclass("esri.layer.support.TileMatrixSet")],e);var b}(k.declared(f))})},"esri/layers/support/WMTSStyle":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(p,h,d,a,g,f,k){return function(f){function e(a){a=
f.call(this)||this;a.id=null;a.title=null;a.description=null;a.legendUrl=null;return a}d(e,f);b=e;e.prototype.clone=function(){var a=new b;this.hasOwnProperty("description")&&(a.description=this.description);this.hasOwnProperty("id")&&(a.id=this.id);this.hasOwnProperty("isDefault")&&(a.isDefault=this.isDefault);this.hasOwnProperty("keywords")&&(a.keywords=this.keywords&&this.keywords.slice());this.hasOwnProperty("legendUrl")&&(a.legendUrl=this.legendUrl);this.hasOwnProperty("title")&&(a.title=this.title);
return a};a([k.property({json:{read:{source:"id"}}})],e.prototype,"id",void 0);a([k.property({json:{read:{source:"title"}}})],e.prototype,"title",void 0);a([k.property({json:{read:{source:"abstract"}}})],e.prototype,"description",void 0);a([k.property({json:{read:{source:"legendUrl"}}})],e.prototype,"legendUrl",void 0);a([k.property({json:{read:{source:"isDefault"}}})],e.prototype,"isDefault",void 0);a([k.property({json:{read:{source:"keywords"}}})],e.prototype,"keywords",void 0);return e=b=a([k.subclass("esri.layer.support.WMTSStyle")],
e);var b}(k.declared(f))})},"esri/layers/support/wmtsUtils":function(){define("require exports ../../core/Error ../../geometry/Extent ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/WKIDUnitConversion ./TileInfo".split(" "),function(p,h,d,a,g,f,k,m){function e(a,c){return(a=c.getElementsByTagName(a))&&0<a.length?a[0]:null}function b(a,c){return Array.prototype.slice.call(c.getElementsByTagName(a)).map(function(a){return a.textContent})}function l(a,c){a.split("\x3e").forEach(function(a){c=
e(a,c)});return c&&c.textContent}function t(a,c,b,d){var f;Array.prototype.slice.call(d.childNodes).some(function(d){if(-1<d.nodeName.indexOf(a)){var g=e(c,d),g=g&&g.textContent;return g===b||b.split(":")&&b.split(":")[1]===g?(f=d,!0):!1}});return f}function u(a){var c=[],d=y[a],e=Array.prototype.slice.call(d.getElementsByTagName("ResourceURL")),d=d.getElementsByTagName("Dimension"),f,g,h,k;d.length&&(f=l("Identifier",d[0]),g=b("Default",d[0])||b("Value",d[0]));1<d.length&&(h=l("Identifier",d[1]),
k=b("Default",d[1])||b("Value",d[1]));A[a]={dimensions:g,dimensions2:k};e.forEach(function(a){var b=a.getAttribute("template");if(f&&g.length)if(-1<b.indexOf("{"+f+"}"))b=b.replace("{"+f+"}","{dimensionValue}");else{var d=b.toLowerCase().indexOf("{"+f.toLowerCase()+"}");-1<d&&(b=b.substring(0,d)+"{dimensionValue}"+b.substring(d+f.length+2))}h&&k.length&&(-1<b.indexOf("{"+h+"}")?b=b.replace("{"+h+"}","{dimensionValue2}"):(d=b.toLowerCase().indexOf("{"+h.toLowerCase()+"}"),-1<d&&(b=b.substring(0,d)+
"{dimensionValue2}"+b.substring(d+h.length+2))));c.push({template:b,format:a.getAttribute("fomrat"),resourceType:a.getAttribute("resourceType")})});return c}function r(a,c){return Array.prototype.slice.call(a.getElementsByTagName("Style")).map(function(a){var d=e("LegendURL",a),f=e("Keywords",a),f=f&&b("Keyword",f),d=d&&d.getAttribute("xlink:href");c&&(d=d&&d.replace(/^http:/i,"https:"));return{abstract:l("Abstract",a),id:l("Identifier",a),isDefault:"true"===a.getAttribute("isDefault"),keywords:f,
legendUrl:d,title:l("Title",a)}})}function v(a,c){return b("TileMatrixSet",a).map(function(b){return q(b,a,c)})}function q(a,d,f){d=t("TileMatrixSetLink","TileMatrixSet",a,d);d=b("TileMatrix",d);var g=t("TileMatrixSet","Identifier",a,f);f=n(g);var h=f.spatialReference,k=h.wkid,r=e("TileMatrix",g),r=[parseInt(l("TileWidth",r),10),parseInt(l("TileHeight",r),10)],q=[];d.length?d.forEach(function(b,d){b=t("TileMatrix","Identifier",b,g);q.push(c(b,k,d,a))}):Array.prototype.slice.call(g.getElementsByTagName("TileMatrix")).forEach(function(b,
d){q.push(c(b,k,d,a))});d=w(g,f,r,q[0]);return{id:a,fullExtent:d,tileInfo:new m({dpi:96,spatialReference:h,size:r,origin:f,lods:q})}}function n(a){var c=l("SupportedCRS",a);c&&(c=c.toLowerCase());var b=parseInt(c.split(":").pop(),10);if(900913===b||3857===b)b=102100;var d=!1;if(-1<c.indexOf("crs84")||-1<c.indexOf("crs:84"))b=4326,d=!0;else if(-1<c.indexOf("crs83")||-1<c.indexOf("crs:83"))b=4269,d=!0;else if(-1<c.indexOf("crs27")||-1<c.indexOf("crs:27"))b=4267,d=!0;var h=new f({wkid:b});a=e("TileMatrix",
a);var k=l("TopLeftCorner",a).split(" ");a=k[0].split("E").map(function(a){return Number(a)});var k=k[1].split("E").map(function(a){return Number(a)}),n=a[0],m=k[0],r;1<a.length&&(n=a[0]*Math.pow(10,a[1]));1<k.length&&(m=k[0]*Math.pow(10,k[1]));var q=d&&4326===b&&90===n&&-180===m;z.some(function(a,e){var f=Number(c.split(":").pop());if(f>=a[0]&&f<=a[1]||4326===b&&(!d||q))return r=new g(m,n,h),!0;e===z.length-1&&(r=new g(n,m,h));return!1});return r}function w(c,b,d,f){var g=e("BoundingBox",c),h,k;
g&&(h=l("LowerCorner",g).split(" "),k=l("UpperCorner",g).split(" "));h&&1<h.length&&k&&1<k.length?(c=parseFloat(h[0]),d=parseFloat(h[1]),h=parseFloat(k[0]),k=parseFloat(k[1])):(c=e("TileMatrix",c),h=parseFloat(l("MatrixWidth",c)),g=parseFloat(l("MatrixHeight",c)),c=b.x,k=b.y,h=c+h*d[0]*f.resolution,d=k-g*d[1]*f.resolution);return new a(c,d,h,k,b.spatialReference)}function c(a,c,b,d){var e=l("Identifier",a);a=l("ScaleDenominator",a).split("E").map(function(a){return Number(a)});a=1<a.length?a[0]*Math.pow(10,
a[1]):a[0];c=x(c,a,d);return{level:b,levelValue:e,scale:1.058267716535433*a,resolution:c}}function x(a,c,b){a=k.hasOwnProperty(String(a))?k.values[k[a]]:"default028mm"===b?6370997*Math.PI/180:6378137*Math.PI/180;return 7*c/25E3/a}Object.defineProperty(h,"__esModule",{value:!0});var z=[[3819,3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],
[4470,4470],[4475,4475],[4483,4483],[4490,4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],
[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],
[20004,20032],[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],A=new Map,y=new Map;h.parseCapabilities=function(a,c){a=a.replace(/ows:/gi,"");a=(new DOMParser).parseFromString(a,"text/xml").documentElement;var f=e("Contents",a);if(!f)throw new d("wmtslayer:wmts-capabilities-xml-is-not-valid");
var g=e("OperationsMetadata",a),g=(g=(g=g&&g.querySelector("[name\x3d'GetTile']"))&&g.getElementsByTagName("Get"))&&Array.prototype.slice.call(g),h=c.url&&-1<c.url.indexOf("https"),k=c.serviceMode,n,m,q;g&&g.length&&g.some(function(a){var c=e("Constraint",a);if(!c||t("AllowedValues","Value",k,c))return m=a.attributes[0].nodeValue,!0;if(!c||t("AllowedValues","Value","RESTful",c)||t("AllowedValues","Value","REST",c))q=a.attributes[0].nodeValue;else if(!c||t("AllowedValues","Value","KVP",c))n=a.attributes[0].nodeValue;
return!1});m||(q?(m=q,k="RESTful"):n?(m=n,k="KVP"):m=e("ServiceMetadataURL",a).getAttribute("xlink:href"));c=m.indexOf("1.0.0/");-1===c&&"RESTful"===k?m+="/":-1<c&&(m=m.substring(0,c));"KVP"===k&&(m+=-1<c?"":"?");h&&(m=m.replace(/^http:/i,"https:"));c=l("ServiceIdentification\x3eAccessConstraints",a);a=Array.prototype.slice.call(f.getElementsByTagName("Layer")).map(function(a){var c=l("Identifier",a);y[c]=a;var d=l("Abstract",a),g=b("Format",a),k,n=e("WGS84BoundingBox",a);k=n?l("LowerCorner",n).split(" "):
["-180","-90"];n=n?l("UpperCorner",n).split(" "):["180","90"];k={xmin:parseFloat(k[0]),ymin:parseFloat(k[1]),xmax:parseFloat(n[0]),ymax:parseFloat(n[1]),spatialReference:{wkid:4326}};var n=r(a,h),m=l("Title",a);a=v(a,f);return{id:c,fullExtent:k,description:d,formats:g,styles:n,title:m,tileMatrixSets:a}});return{copyright:c,layers:a,tileUrl:m,serviceMode:k}};h.parseResourceInfo=function(a){a.layers.forEach(function(a){a.tileMatrixSets.forEach(function(a){var c=a.tileInfo;96!==c.dpi&&(c.lods.forEach(function(b){b.scale=
96*b.scale/c.dpi;b.resolution=x(c.spatialReference.wkid,90.71428571428571*b.scale/96,a.id)}),c.dpi=96)})});return a};h.getTileUrlFromResourceUrls=function(a,c,b,d,e,f){var g=u(a),h=A[a].dimensions&&A[a].dimensions[0];a=A[a].dimensions2&&A[a].dimensions2[0];var k="";g&&0<g.length&&(k=g[e%g.length].template.replace(/\{Style\}/gi,b).replace(/\{TileMatrixSet\}/gi,c).replace(/\{TileMatrix\}/gi,d).replace(/\{TileRow\}/gi,e).replace(/\{TileCol\}/gi,f).replace(/\{dimensionValue\}/gi,h).replace(/\{dimensionValue2\}/gi,
a));return k};h.getTileUrlTemplateFromResourceUrls=function(a,c,b,d){b=u(a);var e="";if(b&&0<b.length){var f=A[a].dimensions&&A[a].dimensions[0];a=A[a].dimensions2&&A[a].dimensions2[0];e=b[0].template;e.indexOf(".xxx")===e.length-4&&(e=e.slice(0,e.length-4));e=e.replace(/\{Style\}/gi,d);e=e.replace(/\{TileMatrixSet\}/gi,c);e=e.replace(/\{TileMatrix\}/gi,"{level}");e=e.replace(/\{TileRow\}/gi,"{row}");e=e.replace(/\{TileCol\}/gi,"{col}");e=e.replace(/\{dimensionValue\}/gi,f);e=e.replace(/\{dimensionValue2\}/gi,
a)}return e}})},"esri/views/3d/terrain/terrainUtilsPlanar":function(){define("require exports ../../../core/Error ../lib/glMatrix ../support/aaBoundingRect ./TerrainConst ./TilingScheme".split(" "),function(p,h,d,a,g,f,k){function m(d,e,f,g){a.vec3d.set(f,b);b[g]=e[g];g=a.vec3d.subtract(b,e);var h=a.vec3d.subtract(d,e,l),h=a.vec3d.dot(h,g),c=a.vec3d.dot(g,g);e=0>=h?e:c<=h?f:a.vec3d.add(e,a.vec3d.scale(g,h/c),b);d=a.vec3d.subtract(d,e,b);return Math.PI/2-Math.atan(d[2]/Math.sqrt(d[0]*d[0]+d[1]*d[1]))}
function e(a,b){var d=a.getElevationBounds();a=a.extent;d=.5*(d[0]+d[1]);t[0]=a[0];t[1]=a[1];t[2]=d;u[0]=a[2];u[1]=a[3];u[2]=d;a=d=Infinity;b[0]<t[0]?d=m(b,t,u,0):b[0]>u[0]&&(d=m(b,u,t,0));b[1]<t[1]?a=m(b,t,u,1):b[1]>u[1]&&(a=m(b,u,t,1));return Math.min(d,a)}Object.defineProperty(h,"__esModule",{value:!0});var b=a.vec3d.create(),l=a.vec3d.create(),t=a.vec3d.create(),u=a.vec3d.create();h.autoUpdateSkirtsVisibility=function(a,b){var d,f=!0,h=a.extent,c=g.containsPoint(h,b);c?d=a.getElevation(b):(d=
a.getElevationBounds(),d=.5*(d[0]+d[1]));d>b[2]?f=!1:c||(g.containsPointWithMargin(h,b,a.hideSkirtsDistanceFromExtentMargin*Math.min(h[2]-h[0],h[3]-h[1]))?e(a,b)>a.hideSkirtsMinimumCameraTilt&&(f=!1):f=!1);f!==a.skirts&&(a.skirts=f)};h.tiltOnEdge=m;h.tiltToExtentEdge=e;h.checkIfTileInfoSupportedForViewSR=function(a,b,e){if(a.spatialReference.isGeographic)return new d("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var h=k.checkUnsupported(a);
if(h)return h;var l=a.lods,h=l[0].resolution*Math.pow(2,l[0].level),c=[h*a.size[0],h*a.size[1]],m=[a.origin.x,a.origin.y];b=g.fromExtent(b);var r=g.create();k.computeRowColExtent(b,c,m,r);c=(r[2]-r[0])*(r[3]-r[1]);c>f.MAX_ROOT_TILES?(l=l[0].scale*Math.pow(2,l[0].level),h=Math.max((b[3]-b[1])/a.size[1],(b[2]-b[0])/a.size[0])*l/h,b=Math.floor(Math.log(h)/Math.log(10)),h=Math.ceil(h/Math.pow(10,b))*Math.pow(10,b),h=new d("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+
Math.floor(l).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:l,suggestedLevel0Scale:h,requiredNumRootTiles:c,allowedNumRootTiles:f.MAX_ROOT_TILES})):h=null;return h?h:e&&!a.spatialReference.equals(e)?new d("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}})},"esri/views/3d/terrain/TerrainConst":function(){define(["require","exports","../support/aaBoundingRect",
"./TilingScheme"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});(function(a){a[a.MAP=0]="MAP";a[a.ELEVATION=1]="ELEVATION";a[a.LAYER_CLASS_COUNT=2]="LAYER_CLASS_COUNT"})(h.LayerClass||(h.LayerClass={}));(function(a){a[a.NONE=0]="NONE";a[a.SPLIT=1]="SPLIT";a[a.VSPLITMERGE=2]="VSPLITMERGE";a[a.MERGE=4]="MERGE";a[a.DECODE_ELEVATION=8]="DECODE_ELEVATION";a[a.UPDATE_GEOMETRY=16]="UPDATE_GEOMETRY";a[a.UPDATE_TEXTURE=32]="UPDATE_TEXTURE"})(h.TileUpdateTypes||(h.TileUpdateTypes={}));
h.TILE_LOADING_DEBUGLOG=!1;h.MAX_ROOT_TILES=64;h.MAX_TILE_TESSELATION=512;h.ELEVATION_NODATA_VALUE=3.40282347E38/10;h.noDataValueOpt={noDataValue:h.ELEVATION_NODATA_VALUE};h.ELEVATION_DESIRED_RESOLUTION_LEVEL=4;h.TILEMAP_SIZE_EXP=5;h.TILEMAP_SIZE=1<<h.TILEMAP_SIZE_EXP;h.WEBMERCATOR_WORLD_EXTENT=d.create([0,0,0,0]);a.WebMercatorAuxiliarySphere.getExtent(0,0,0,h.WEBMERCATOR_WORLD_EXTENT);h.GEOGRAPHIC_WORLD_EXTENT=d.create([-180,-90,180,90]);h.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";
h.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";h.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC"})},
"esri/views/3d/terrain/TilingScheme":function(){define(["../../../core/Error","../../../geometry/SpatialReference","../../../geometry/support/scaleUtils","../support/projectionUtils","../support/mathUtils"],function(p,h,d,a,g){var f=a.webMercator.x2lon,k=a.webMercator.y2lat,m=[0,0,0,0],e=function(a){var b=e._checkUnsupported(a);if(b)throw b;this.spatialReference=a.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isWGS84=this.spatialReference.isWGS84;this.origin=[a.origin.x,
a.origin.y];this.pixelSize=[a.size[0],a.size[1]];var d=a.lods.reduce(function(a,b,d){b.level<a.min&&(a.min=b.level,a.minIndex=d);a.max=Math.max(a.max,b.level);return a},{min:Infinity,minIndex:0,max:-Infinity}),f=a.lods[d.minIndex],g=Math.pow(2,f.level),b=f.resolution*g,f=f.scale*g;this.levels=Array(d.max+1);for(d=0;d<this.levels.length;d++)this.levels[d]={resolution:b,scale:f,tileSize:[b*a.size[0],b*a.size[1]]},b/=2,f/=2};e.prototype={getExtent:function(a,d,e,h,m){h=h||Array(4);var b=this.levels[a];
a=b.tileSize[0];b=b.tileSize[1];h[0]=this.origin[0]+e*a;h[2]=h[0]+a;h[3]=this.origin[1]-d*b;h[1]=h[3]-b;m&&(this._isWebMercator?(m[0]=f(h[0]),m[1]=k(h[1]),m[2]=f(h[2]),m[3]=k(h[3])):this._isWGS84&&(m[0]=g.deg2rad(h[0]),m[1]=g.deg2rad(h[1]),m[2]=g.deg2rad(h[2]),m[3]=g.deg2rad(h[3])))},ensureMaxLod:function(a){for(;this.levels.length<=a;){var b=this.levels[this.levels.length-1],d=b.resolution/2;this.levels.push({resolution:d,scale:b.scale/2,tileSize:[d*this.pixelSize[0],d*this.pixelSize[1]]})}},capMaxLod:function(a){this.levels.length>
a+1&&(this.levels.length=a+1)},getMaxLod:function(){return this.levels.length-1},scaleAtLevel:function(a){return this.levels[0].scale/Math.pow(2,a)},levelAtScale:function(a){var b=this.levels[0].scale;return a>=b?0:Math.log(b/a)*Math.LOG2E},compatibleWith:function(a){if(!(a instanceof e)){if(e._checkUnsupported(a))return!1;a=new e(a)}if(!a.spatialReference.equals(this.spatialReference)||a.pixelSize[0]!==this.pixelSize[0]||a.pixelSize[1]!==this.pixelSize[1])return!1;var b=Math.min(this.levels.length,
a.levels.length)-1,d=this.levels[b].resolution,f=g.floatEqualAbsolute,h=.5*d;if(!f(a.origin[0],this.origin[0],h)||!f(a.origin[1],this.origin[1],h))return!1;h=.5*d/Math.pow(2,b)/Math.max(this.pixelSize[0],this.pixelSize[1])*12;return f(d,a.levels[b].resolution,h)},rootTilesInExtent:function(a,d,f){var b=this.levels[0].tileSize;e.computeRowColExtent(a,b,this.origin,m);a=m[1];var g=m[3],h=m[0],k=m[2],l=k-h,t=g-a;l*t>f&&(f=Math.floor(Math.sqrt(f)),t>f&&(a=a+Math.floor(.5*t)-Math.floor(.5*f),g=a+f),l>
f&&(h=h+Math.floor(.5*l)-Math.floor(.5*f),k=h+f));f=Array((k-h)*(g-a));l=0;for(t=a;t<g;t++)for(var c=h;c<k;c++)f[l++]=[0,t,c];d&&(d[0]=this.origin[0]+h*b[0],d[1]=this.origin[1]-g*b[1],d[2]=this.origin[0]+k*b[0],d[3]=this.origin[1]-a*b[1]);return f}};e.computeRowColExtent=function(a,d,e,f){var b=.001*(a[2]-a[0]+(a[3]-a[1]));f[0]=Math.floor((a[0]+b-e[0])/d[0]);f[2]=Math.ceil((a[2]-b-e[0])/d[0]);f[1]=Math.floor((e[1]-a[3]+b)/d[1]);f[3]=Math.ceil((e[1]-a[1]-b)/d[1])};e.isPowerOfTwo=function(a){a=a.lods;
var b=a[0].resolution*Math.pow(2,a[0].level);return!a.some(function(a){return!g.floatEqualRelative(a.resolution,b/Math.pow(2,a.level))})};e.hasGapInLevels=function(a){a=a.lods.map(function(a){return a.level});a.sort(function(a,b){return a-b});for(var b=1;b<a.length;b++)if(a[b]!==a[0]+b)return!0;return!1};e.tileSizeSupported=function(a){var b=a.size[1];return b===a.size[0]&&0===(b&b-1)&&128<=b&&512>=b};e._checkUnsupported=function(a){return a?1>a.lods.length?new p("tilingscheme:generic","Tiling scheme must have at least one level"):
e.isPowerOfTwo(a)?null:new p("tilingscheme:power-of-two","Tiling scheme must be power of two"):new p("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};e.checkUnsupported=function(a){var b=e._checkUnsupported(a);return b?b:e.hasGapInLevels(a)?new p("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):e.tileSizeSupported(a)?null:new p("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]")};e.fromExtent=
function(a,f){var b=a[2]-a[0],g=a[3]-a[1],h=d.getMetersPerUnitForSR(f),k=1.2*Math.max(b,g);a=new e({size:[256,256],origin:{x:a[0]-.5*(k-b),y:a[3]+.5*(k-g)},lods:[{level:0,resolution:k/256,scale:1/(256/96*.0254/(k*h))}],spatialReference:f});a.ensureMaxLod(20);return a};e.WebMercatorAuxiliarySphereTileInfo={size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:h.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]};e.makeWebMercatorAuxiliarySphere=
function(a){a=null!=a?a:19;var b=new e(e.WebMercatorAuxiliarySphereTileInfo);b.ensureMaxLod(a);return b};e.WebMercatorAuxiliarySphere=e.makeWebMercatorAuxiliarySphere(19);e.makeWGS84WithTileSize=function(a,d){d=null!=d?d:16;var b=256/a;a=new e({size:[a,a],origin:{x:-180,y:90},spatialReference:h.WGS84,lods:[{level:0,resolution:.703125*b,scale:2.95497598570834E8*b}]});a.ensureMaxLod(d);return a};return e})},"esri/views/3d/terrain/terrainUtilsSpherical":function(){define(["require","exports","../../../core/Error",
"./TilingScheme"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});h.autoUpdateSkirtsVisibility=function(a,d){};h.checkIfTileInfoSupportedForViewSR=function(g,f,h){f=g.lods.length-1;if(g.spatialReference.isWebMercator){if(!a.makeWebMercatorAuxiliarySphere(f).compatibleWith(g))return new d("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(g.spatialReference.isWGS84){if(!a.makeWGS84WithTileSize(g.size[1],
f).compatibleWith(g))return new d("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme")}else return new d("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(h&&!g.spatialReference.equals(h))return new d("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}})},"esri/views/3d/terrain/tileUtils":function(){define(["require",
"exports","../support/PreallocArray","./UpsampleInfo"],function(p,h,d,a){function g(a,b,d,f){f=b.call(d,a,f);for(var e=0;4>e;e++){var h=a.children[e];h&&g(h,b,d,f)}}function f(a,b,d){if(Array.isArray(a))for(var e=0;e<a.length;e++)k(a[e],b,d);else k(a,b,d)}function k(a,b,d){for(var e=0;4>e;e++){var g=a.children[e];g&&f(g,b,d)}b.call(d,a)}Object.defineProperty(h,"__esModule",{value:!0});p=function(){function a(a){void 0===a&&(a=100);this.q=new d(a);this._last=null;this.done=!0}a.prototype.reset=function(a){this.q.clear();
a&&this.q.pushEither(a);this._last=null;this.done=0===this.q.length};a.prototype.skip=function(){this._last=null;0===this.q.length&&(this.done=!0)};a.prototype.next=function(){if(this.done)return null;if(null!==this._last){var a=this._last.children;if(a[0])for(var d=4;0<=d;d--){var e=a[d];e&&this.q.push(e)}this._last=null}this._last=this.q.pop();0!==this.q.length||this._last.children[0]||(this.done=!0);return this._last};return a}();h.IteratorPreorder=p;p=function(){function a(a){void 0===a&&(a=100);
this.q=new d(a);this.done=!0}a.prototype.reset=function(a){this.q.clear();this.q.pushEither(a);for(a=0;a<this.q.length;)for(var b=this.q.data[a++],d=0;4>d;d++){var e=b.children[d];e&&this.q.push(e)}this.done=0===this.q.length};a.prototype.next=function(){var a=this.q.pop();this.done=0===this.q.length;return a};return a}();h.IteratorPostorder=p;h.lij2str=function(a,b,d){return a+"/"+b+"/"+d};h.tile2str=function(a){return a.lij[0]+"/"+a.lij[1]+"/"+a.lij[2]};h.traverseTilesPreorder=function(a,b,d,f){if(Array.isArray(a))for(var e=
0;e<a.length;e++)g(a[e],b,d,f);else g(a,b,d,f)};h.traverseTilesPostorder=f;h.fallsWithinLayer=function(a,b,d){if(!b)return!1;var e=b.fullExtent,f=a.extent;if(d){if(f[0]<e.xmin||f[1]<e.ymin||f[2]>e.xmax||f[3]>e.ymax)return!1}else if(e.xmin>f[2]||e.ymin>f[3]||e.xmax<f[0]||e.ymax<f[1])return!1;a=a.parentSurface.tilingScheme.levels[a.lij[0]].scale;return 0<b.minScale&&a>1.00000001*b.minScale||0<b.maxScale&&a<.99999999*b.maxScale?!1:!0};h.isPosWithinTile=function(a,b){a=a.extent;return b[0]>=a[0]&&b[1]>=
a[1]&&b[0]<=a[2]&&b[1]<=a[3]};h.getTileNLevelsUp=function(a,b){for(;0<b;)a=a.parent,b--;return a};h.nextTileInAncestry=function(a,b){var d=a.lij[0]-b.lij[0]-1,e=a.lij[2]>>d,f=0;a.lij[1]>>d&1&&(f+=2);e&1&&(f+=1);return b.children[f]};h.computeUpsampleInfoForAncestor=function(d,b){for(var e=1,f=0,g=0;d!==b;)if(e*=.5,f*=.5,g*=.5,d.lij[2]&1&&(f+=.5),0===(d.lij[1]&1)&&(g+=.5),d=d.parent,null==d)throw Error("tile was not a descendant of ancestorTile");d=a.Pool.acquire();d.init(b,f,g,e);return d};var m=
[null];h.hasVisibleSiblings=function(a){Array.isArray(a)||(m[0]=a,a=m);for(var b=0;b<a.length;b++){var d=a[b],e=d.parent;if(e)for(var f=0;4>f;f++){var g=e.children[f];if(g&&g!==d&&g.visible)return!0}}return!1}})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["require","exports","../../../core/ObjectPool","../lib/glMatrix"],function(p,h,d,a){var g=a.vec2d;return function(){function a(a,d,e,b){this.scale=0;this.tile=null;this.offset=g.create();void 0!==a&&this.init(a,d,e,b)}a.prototype.init=
function(a,d,e,b){this.tile=a;this.offset[0]=d;this.offset[1]=e;this.scale=b};a.prototype.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};a.Pool=new d(a);return a}()})},"esri/views/3d/terrain/ElevationData":function(){define(["require","exports","../../../layers/support/rasterFormats/LercCodec","../support/mathUtils","./TerrainConst"],function(p,h,d,a,g){return function(){function f(a,d,e,b){this.samplerData=null;this.level=a;this.i=d;this.j=e;this.extent=b}f.prototype.computeMinMaxValue=
function(d,f,e,b){var h=Infinity,k=-Infinity;d-=this.level;var m=Math.pow(2,d);if(Math.floor(f/m)===this.i&&Math.floor(e/m)===this.j&&0<d){var r=this.samplerData.width,v=this.samplerData.pixelData,q=.5*g.ELEVATION_NODATA_VALUE;d=(r-1)/m;e=(e-this.j*m)*d;f=(f-this.i*m)*d;if(1>d){var m=Math.floor(e),n=Math.floor(f),p=m+n*r,c=v[p],x=v[p+1],z=v[p+r],p=v[p+r+1];if(c+x+z+p<q)return h=a.bilerp(c,x,z,p,e-m,f-n),k=a.bilerp(c,x,z,p,e-m+d,f-n),r=a.bilerp(c,x,z,p,e-m,f-n+d),d=a.bilerp(c,x,z,p,e-m+d,f-n+d),b[0]=
Math.min(h,k,r,d),b[1]=Math.max(h,k,r,d),b;e=m;f=n;d=1}else e=Math.floor(e),f=Math.floor(f),d=Math.ceil(d);for(m=e;m<=e+d;m++)for(n=f;n<=f+d;n++)p=m+n*r,c=v[p],c<q?(h=Math.min(h,c),k=Math.max(k,c)):(h=0<h?0:h,k=0>k?0:k)}b[0]=h;b[1]=k;return b};f.createFromLERC=function(a,g,e,b){e=d.decode(e,b);a=new f(a[0],a[1],a[2],g);a.samplerData={pixelData:e.pixelData,width:e.width,height:e.height,minValue:e.minValue,maxValue:e.maxValue,noDataValue:e.noDataValue,safeWidth:.99999999*(e.width-1),dx:(e.width-1)/
(a.extent[2]-a.extent[0]),dy:(e.width-1)/(a.extent[3]-a.extent[1]),x0:a.extent[0],y1:a.extent[3]};a.bounds=[a.samplerData.minValue,-3E38<a.samplerData.maxValue?a.samplerData.maxValue:0];return a};f.createFromFetchTileResult=function(a,d,e){a=new f(a[0],a[1],a[2],d);d=e.values;for(var b=e.noDataValue,g=Infinity,h=-Infinity,k=!0,m=0;m<d.length;m++){var p=d[m];p!==b&&(g=p<g?p:g,h=p>h?p:h,k=!1)}k&&(h=g=0);a.samplerData={pixelData:e.values,width:e.width,height:e.height,minValue:g,maxValue:h,noDataValue:b,
safeWidth:.99999999*(e.width-1),dx:(e.width-1)/(a.extent[2]-a.extent[0]),dy:(e.width-1)/(a.extent[3]-a.extent[1]),x0:a.extent[0],y1:a.extent[3]};a.bounds=[g,h];return a};return f}()})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("require exports ./TerrainConst ./TileAgentBase ./UpsampleInfo ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture".split(" "),function(p,h,d,a,g,f,k){return function(){function h(a){this.waitingAgents=[];this.rawData=this.requestPromise=this.loadingAgent=
this.upsampleFromTile=this.tilemapRequest=this.tilemap=this.data=null;this.pendingUpdates=0;this.elevationBounds=void 0;this.init(a)}h.prototype.init=function(a){this.waitingAgents.length=0;this.data=null;this.dataInvalidated=this.dataMissing=!1;this.rawData=this.requestPromise=this.loadingAgent=this.upsampleFromTile=this.tilemapRequest=this.tilemap=null;this.pendingUpdates=0;a===d.LayerClass.ELEVATION&&(this.elevationBounds=null)};h.prototype.invalidateSourceData=function(){this.tilemap=null;this.dataInvalidated=
!0;this.dataMissing=!1;this.upsampleFromTile&&(g.Pool.release(this.upsampleFromTile),this.upsampleFromTile=null)};h.prototype.dispose=function(){this.loadingAgent&&this.loadingAgent!==a.AGENT_DONE&&(this.loadingAgent.dispose(),this.loadingAgent=null);this.requestPromise&&(this.requestPromise.cancel(),this.requestPromise=null);this.tilemap=null;this.tilemapRequest&&(this.tilemapRequest.cancel(),this.tilemapRequest=null);this.upsampleFromTile&&(g.Pool.release(this.upsampleFromTile),this.upsampleFromTile=
null);this.rawData=null;this.pendingUpdates=0;this.disposeData()};h.prototype.disposeData=function(){var a=this.data;a&&(a instanceof k?a.dispose():a instanceof f&&a.dispose(),this.data=null)};h.makeEmptyLayerInfo=function(a,b){return b?(b.init(a),b):new h(a)};return h}()})},"esri/views/3d/terrain/TileAgentBase":function(){define(["require","exports","./tileUtils","./UpsampleInfo"],function(p,h,d,a){function g(d,f,e,b,h,p,u){if(!d.parent||6<u)return null;b*=.5;h*=.5;p*=.5;d.lij[2]&1&&(h+=.5);0===
(d.lij[1]&1)&&(p+=.5);return d.parent.hasLayerData(f,e)?(f=a.Pool.acquire(),f.init(d.parent,h,p,b),f):g(d.parent,f,e,b,h,p,u+1)}var f=Error("Abstract method called on TileAgentBase");return function(){function h(){}h.prototype.init=function(d,e,b,f){this.tile=d;this.layerIdx=e;this.layerClass=b;this.suspended=f;this._tileLayerInfo=d.getLayerInfo(e,b);this._dataRequested=null;(d=this._findAncestorWithData())?(this._setUpsamplingTile(d.tile),a.Pool.release(d)):(this._tileLayerInfo.upsampleFromTile&&
a.Pool.release(this._tileLayerInfo.upsampleFromTile),this._tileLayerInfo.upsampleFromTile=null);return this._requestNext(!0)};h.prototype.dispose=function(){this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this),this._dataRequested=null);this._tileLayerInfo=this.tile=null};h.prototype.setSuspension=function(a){a!==this.suspended&&((this.suspended=a)?this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this),this._dataRequested=
null):this._tileLayerInfo.data||this.update())};h.prototype.update=function(){var d=this._findAncestorWithData();d&&this._tileLayerInfo.upsampleFromTile&&d.tile!==this._tileLayerInfo.upsampleFromTile.tile?this._setUpsamplingTile(d.tile):d&&a.Pool.release(d);return this._requestNext()};h.prototype.dataArrived=function(a){throw f;};h.prototype.dataMissing=function(a){this._dataRequested=null;this._tileLayerInfo.disposeData();this._requestNext()};h.prototype._agentDone=function(){this.tile.agentDone(this.layerIdx,
this.layerClass);this.dispose()};h.prototype._requestNext=function(a){void 0===a&&(a=!1);if(this.suspended)return!0;var d=this._findNextDownload();if(this._dataRequested){if(d===this._dataRequested)return!0;this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this);this._dataRequested=null}d?d.requestLayerData(this.layerIdx,this.layerClass,this)&&(this._dataRequested=d):a||this._agentDone();return!!this._dataRequested};h.prototype._findNextDownload=function(){for(var a=this.layerIdx,
e=this.layerClass,b=this.tile.parentSurface.layerViewByIndex(a,e),f=b.minDataLevel,g=b.maxDataLevel,k=this._desiredMinLevelDelta(),r=h.START_LOADING_LEVEL_DELTA+k,p=this._scaleRangeEnabled,q,n=this.tile,w=0,c=n.lij[0],x=this._tileLayerInfo.upsampleFromTile?this._tileLayerInfo.upsampleFromTile.tile.lij[0]:-1,z=this.tile.parentSurface,A=z.tilemapStats,y=z.getTilemapTile(n),B=!1;n&&(!p||d.fallsWithinLayer(n,b.layer,!1))&&n.lij[0]>=f;){var E=n.layerInfo[e][a];if(E.data&&w>=k){n.lij[0]>x&&this._setUpsamplingTile(n);
E.dataInvalidated&&(q=n);break}if(y&&!y.tileDataAvailable(n,a,e))B=!0;else if(n.lij[0]<=g&&!E.data&&!E.dataMissing&&(q=n,w>=r))break;(n=n.parent)&&y&&(y=y.parent||z.getTilemapTile(n));w++}q&&c-q.lij[0]<k&&this._tileLayerInfo.upsampleFromTile&&(q=null);!q&&B&&A.tilesNotPresent++;return q};h.prototype._findAncestorWithData=function(){return g(this.tile,this.layerIdx,this.layerClass,1,0,0,0)};h.prototype._desiredMinLevelDelta=function(){throw f;};h.prototype._setUpsamplingTile=function(a){throw f;};
h.prototype._unsetUpsamplingTile=function(){this._tileLayerInfo.upsampleFromTile&&a.Pool.release(this._tileLayerInfo.upsampleFromTile);this._tileLayerInfo.upsampleFromTile=null};h.START_LOADING_LEVEL_DELTA=4;h.AGENT_DONE=new h;return h}()})},"esri/views/vectorTiles/VectorTileDisplayObject":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/ObjectPool ../../core/libs/gl-matrix/mat4 ../../core/libs/gl-matrix/vec2 ../../geometry/support/spatialReferenceUtils ../2d/engine/DisplayObject ../2d/tiling/TileKey ./RenderBucket ../webgl/BufferObject".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l){return function(h){function m(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];b=h.call(this)||this;b._renderBuckets=[];b._vectorTileData=null;b._symbolUpdateData=null;b.status=5;b.coords=[0,0];b.bounds=[0,0,0,0];b.tileTransform={transform:Float32Array[16],displayCoord:Float32Array[2]};b.stencilData={mask:0,reference:0};b.status=0;b.tileTransform.transform=g.create();b.tileTransform.displayCoord=f.create();0<a.length&&(d=b.acquire).call.apply(d,[b].concat(a));
return b;var d}d(m,h);m.prototype.reset=function(){e.pool.release(this.key);this.refKey=this.key=null;this.coords[0]=0;this.coords[1]=0;this.bounds[0]=0;this.bounds[1]=0;this.bounds[2]=0;this.height=this.width=this.bounds[3]=0;this.resolution=null;this.rotation=0;this.id=this.client=this.styleLayers=this._vectorTileData=null;this.tileTransform.transform.fill(0);this.tileTransform.displayCoord.fill(0);this.stencilData.mask=0;this.stencilData.reference=0;this._renderBuckets.length=0;this._symbolUpdateData=
null;this.status=0};m.prototype.acquire=function(a,b,d,e,f){this.key=a;this.refKey=b;b=d.lodAt(a.level).resolution;var c=d.size[0]*b,g=d.origin,h=a.col*c,l=a.row*c,n=d.spatialReference,m=0;n&&(n._isWrappable?n._isWrappable():n.isWrappable)&&(n=k.getInfo(n),m=n.valid[1]-n.valid[0]);h=g.x+h+a.world*m;g=g.y-l;this.coords[0]=h;this.coords[1]=g;this.bounds[0]=h;this.bounds[1]=g;this.bounds[2]=h+c;this.bounds[3]=g-c;this.widthInPixels=d.size[1];this.coordRange=4096;this.resolution=b;this.rotation=f;this.styleLayers=
e;this.id=a.id;this.status=1};m.prototype.setData=function(a,b){this._vectorTileData=a;this.client=b;this.status=3};m.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};m.prototype.dispose=function(){this.fillVertexArrayObject&&(this.fillVertexArrayObject.dispose(),this.fillVertexArrayObject=null);this.fillDDVertexArrayObject&&(this.fillDDVertexArrayObject.dispose(),this.fillDDVertexArrayObject=null);this.outlineVertexArrayObject&&(this.outlineVertexArrayObject.dispose(),
this.outlineVertexArrayObject=null);this.outlineDDVertexArrayObject&&(this.outlineDDVertexArrayObject.dispose(),this.outlineDDVertexArrayObject=null);this.lineVertexArrayObject&&(this.lineVertexArrayObject.dispose(),this.lineVertexArrayObject=null);this.lineDDVertexArrayObject&&(this.lineDDVertexArrayObject.dispose(),this.lineDDVertexArrayObject=null);this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),
this.iconDDVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);this.circleVertexArrayObject&&(this.circleVertexArrayObject.dispose(),this.circleVertexArrayObject=null);this.fillVertexBuffer&&(this.fillVertexBuffer.dispose(),this.fillVertexBuffer=null);this.fillDDVertexBuffer&&(this.fillDDVertexBuffer.dispose(),this.fillDDVertexBuffer=
null);this.fillIndexBuffer&&(this.fillIndexBuffer.dispose(),this.fillIndexBuffer=null);this.outlineVertexBuffer&&(this.outlineVertexBuffer.dispose(),this.outlineVertexBuffer=null);this.outlineDDVertexBuffer&&(this.outlineDDVertexBuffer.dispose(),this.outlineDDVertexBuffer=null);this.outlineIndexBuffer&&(this.outlineIndexBuffer.dispose(),this.outlineIndexBuffer=null);this.lineVertexBuffer&&(this.lineVertexBuffer.dispose(),this.lineVertexBuffer=null);this.lineDDVertexBuffer&&(this.lineDDVertexBuffer.dispose(),
this.lineDDVertexBuffer=null);this.lineIndexBuffer&&(this.lineIndexBuffer.dispose(),this.lineIndexBuffer=null);this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null);this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),
this.textDDVertexBuffer=null);this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null);this.circleVertexBuffer&&(this.circleVertexBuffer.dispose(),this.circleVertexBuffer=null);this.circleIndexBuffer&&(this.circleIndexBuffer.dispose(),this.circleIndexBuffer=null);this.texture&&(this.texture.dispose(),this.texture=null);this._renderBuckets.length=0;this.status=7};m.prototype.getCpuMemoryUsage=function(){return null!=this._vectorTileData&&this._vectorTileData.bufferData?this._vectorTileData.bufferData.reduce(function(a,
b){return a+b.byteLength},0)+this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength:0};m.prototype.getGpuMemoryUsage=function(){var a=0;this.fillVertexBuffer&&(a+=this.fillVertexBuffer.size);this.fillDDVertexBuffer&&(a+=this.fillDDVertexBuffer.size);this.fillIndexBuffer&&(a+=this.fillIndexBuffer.size);this.outlineVertexBuffer&&(a+=this.outlineVertexBuffer.size);this.outlineDDVertexBuffer&&(a+=this.outlineDDVertexBuffer.size);this.outlineIndexBuffer&&(a+=this.outlineIndexBuffer.size);
this.lineVertexBuffer&&(a+=this.lineVertexBuffer.size);this.lineDDVertexBuffer&&(a+=this.lineDDVertexBuffer.size);this.lineIndexBuffer&&(a+=this.lineIndexBuffer.size);this.iconVertexBuffer&&(a+=this.iconVertexBuffer.size);this.iconDDVertexBuffer&&(a+=this.iconDDVertexBuffer.size);this.iconIndexBuffer&&(a+=this.iconIndexBuffer.size);this.textVertexBuffer&&(a+=this.textVertexBuffer.size);this.textDDVertexBuffer&&(a+=this.textDDVertexBuffer.size);this.textIndexBuffer&&(a+=this.textIndexBuffer.size);
this.circleVertexBuffer&&(a+=this.circleVertexBuffer.size);this.circleIndexBuffer&&(a+=this.circleIndexBuffer.size);this.texture&&(a+=this.texture.descriptor.width*this.texture.descriptor.height*4);return a};m.prototype.attach=function(a){if(4===this.status)return!0;this.status=3;if(!this._vectorTileData||!this._vectorTileData.bufferDataInfo)return this.status=4,!0;if(0===this._renderBuckets.length)for(var d=new Uint32Array(this._vectorTileData.bucketDataInfo),e=d.length,f=0;f<e;){var g=d[f],c=d[f+
1];if(0===c)c=new b.BackgroundRenderBucket,c.layerID=g,this._renderBuckets.push(c),f+=2;else if(1===c)c=new b.FillRenderBucket,c.layerID=g,c.triangleElementStart=d[f+2],c.triangleElementCount=d[f+3],c.outlineElementStart=d[f+4],c.outlineElementCount=d[f+5],this._renderBuckets.push(c),f+=6;else if(2===c)c=new b.LineRenderBucket,c.layerID=g,c.triangleElementStart=d[f+2],c.triangleElementCount=d[f+3],this._renderBuckets.push(c),f+=4;else if(3===c){c=new b.SymbolRenderBucket;c.layerID=g;c.isSDF=0!==d[f+
2];var h=f+3,g=d[h];h++;if(0<g)for(var k=void 0,m=void 0,r=void 0,p=0;p<g;p++)k=d[h],m=d[h+1],r=d[h+2],c.markerPerPageElementsMap.set(k,[m,r]),h+=3;var t=d[h];h++;if(0<t)for(r=m=k=void 0,p=0;p<t;p++)k=d[h],m=d[h+1],r=d[h+2],c.glyphPerPageElementsMap.set(k,[m,r]),h+=3;this._renderBuckets.push(c);f+=5+3*g+3*t}else 4===c?(c=new b.CircleRenderBucket,c.layerID=g,c.triangleElementStart=d[f+2],c.triangleElementCount=d[f+3],this._renderBuckets.push(c),f+=4):console.error("Bad bucket type!")}a=a.context;d=
new Uint32Array(this._vectorTileData.bufferDataInfo);e=d.length;for(c=f=0;c<e;c+=2,f++)if(!(0>=d[c+1]||0===this._vectorTileData.bufferData[f].byteLength))switch(d[c]){case 1:this.fillVertexBuffer?this.fillVertexBuffer.setData(this._vectorTileData.bufferData[f]):this.fillVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[f]);break;case 2:this.fillDDVertexBuffer?this.fillDDVertexBuffer.setData(this._vectorTileData.bufferData[f]):this.fillDDVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[f]);
break;case 3:this.fillIndexBuffer?this.fillIndexBuffer.setData(this._vectorTileData.bufferData[f]):this.fillIndexBuffer=l.createIndex(a,35044,this._vectorTileData.bufferData[f]);break;case 4:this.outlineVertexBuffer?this.outlineVertexBuffer.setData(this._vectorTileData.bufferData[f]):this.outlineVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[f]);break;case 5:this.outlineDDVertexBuffer?this.outlineDDVertexBuffer.setData(this._vectorTileData.bufferData[f]):this.outlineDDVertexBuffer=
l.createVertex(a,35044,this._vectorTileData.bufferData[f]);break;case 6:this.outlineIndexBuffer?this.outlineIndexBuffer.setData(this._vectorTileData.bufferData[f]):this.outlineIndexBuffer=l.createIndex(a,35044,this._vectorTileData.bufferData[f]);break;case 7:this.lineVertexBuffer?this.lineVertexBuffer.setData(this._vectorTileData.bufferData[f]):this.lineVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[f]);break;case 8:this.lineDDVertexBuffer?this.lineDDVertexBuffer.setData(this._vectorTileData.bufferData[f]):
this.lineDDVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[f]);break;case 9:this.lineIndexBuffer?this.lineIndexBuffer.setData(this._vectorTileData.bufferData[f]):this.lineIndexBuffer=l.createIndex(a,35044,this._vectorTileData.bufferData[f]);break;case 10:this.iconVertexBuffer?this.iconVertexBuffer.setData(this._vectorTileData.bufferData[f]):this.iconVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[f]);break;case 11:this.iconDDVertexBuffer?this.iconDDVertexBuffer.setData(this._vectorTileData.bufferData[f]):
this.iconDDVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[f]);break;case 12:this.iconIndexBuffer?this.iconIndexBuffer.setData(this._vectorTileData.bufferData[f]):this.iconIndexBuffer=l.createIndex(a,35044,this._vectorTileData.bufferData[f]);break;case 13:this.textVertexBuffer?this.textVertexBuffer.setData(this._vectorTileData.bufferData[f]):this.textVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[f]);break;case 14:this.textDDVertexBuffer?this.textDDVertexBuffer.setData(this._vectorTileData.bufferData[f]):
this.textDDVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[f]);break;case 15:this.textIndexBuffer?this.textIndexBuffer.setData(this._vectorTileData.bufferData[f]):this.textIndexBuffer=l.createIndex(a,35044,this._vectorTileData.bufferData[f]);break;case 16:this.circleVertexBuffer?this.circleVertexBuffer.setData(this._vectorTileData.bufferData[f]):this.circleVertexBuffer=l.createVertex(a,35044,this._vectorTileData.bufferData[f]);break;case 17:this.circleIndexBuffer?this.circleIndexBuffer.setData(this._vectorTileData.bufferData[f]):
this.circleIndexBuffer=l.createIndex(a,35044,this._vectorTileData.bufferData[f])}this._vectorTileData=null;this.status=4;return!0};m.prototype.detach=function(a){this.client&&6!==this.status&&7!==this.status&&this.client.invoke("destructTileData",this.id);this.dispose();h.prototype.detach.call(this,a)};m.prototype.doRender=function(a){if(this.visible&&4===this.status){var b=a.context,d=a.renderer;if(b&&d){var e=a.drawphase;this._symbolUpdateData&&this._updateSymbolData(a);b.setStencilFunction(514,
this.stencilData.reference,this.stencilData.mask);var f=this.styleLayers,c=void 0!==a.layerOpacity?a.layerOpacity:1;if(0!==c){var g,h=this._renderBuckets.length,k=0;if(0===e)for(k=h-1;0<=k;k--)g=this._renderBuckets[k],3!==g.type&&g.hasData()&&d.renderBucket(b,g,a.displayLevel,a.requiredLevel,e,this,f.layers[g.layerID],c);else for(k=0;k<h;k++)g=this._renderBuckets[k],g.hasData()&&d.renderBucket(b,g,a.displayLevel,a.requiredLevel,e,this,f.layers[g.layerID],c)}}}};m.prototype._updateSymbolData=function(a){if(!this._symbolUpdateData.bucketDataInfo)return!0;
var d=new Uint32Array(this._symbolUpdateData.bucketDataInfo),e=d.length;if(0===e)return this._symbolUpdateData=null,!0;if(4!==this.status)return this.requestRender(),!1;a=a.context;for(var f=new Uint32Array(this._symbolUpdateData.bufferDataInfo),g=f.length,c=0,h=0;h<g;h+=2,c++)switch(f[h]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=l.createVertex(a,35044,this._symbolUpdateData.bufferData[c]);break;case 11:this.iconDDVertexBuffer&&
(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null);this.iconDDVertexBuffer=l.createVertex(a,35044,this._symbolUpdateData.bufferData[c]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);this.iconIndexBuffer=l.createIndex(a,35044,this._symbolUpdateData.bufferData[c]);break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=l.createVertex(a,35044,this._symbolUpdateData.bufferData[c]);
break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=null);this.textDDVertexBuffer=l.createVertex(a,35044,this._symbolUpdateData.bufferData[c]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=l.createIndex(a,35044,this._symbolUpdateData.bufferData[c])}a=this._renderBuckets.length;for(f=0;f<a;f++)this._renderBuckets[f]instanceof b.SymbolRenderBucket&&(g=this._renderBuckets[f],g.markerPerPageElementsMap.clear(),
g.glyphPerPageElementsMap.clear());for(a=0;a<e;){g=d[a];c=-1;h=this._renderBuckets.length;for(f=0;f<h;f++)if(this._renderBuckets[f].layerID===g){c=f;break}f=this._renderBuckets[c];f||(f=new b.SymbolRenderBucket,f.layerID=g,f.isSDF=0!==d[a+2],this._renderBuckets.push(f));var k=a+3,g=d[k];k++;if(0<g)for(var m=h=c=void 0,r=0;r<g;r++)c=d[k],h=d[k+1],m=d[k+2],f.markerPerPageElementsMap.set(c,[h,m]),k+=3;var p=d[k];k++;if(0<p)for(m=h=c=void 0,r=0;r<p;r++)c=d[k],h=d[k+1],m=d[k+2],f.glyphPerPageElementsMap.set(c,
[h,m]),k+=3;a+=5+3*g+3*p}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);this._symbolUpdateData=null;return!0};m.pool=new a(m);return m}(m)})},
"esri/core/libs/gl-matrix/mat4":function(){define(["./common"],function(p){var h={scalar:{},SIMD:{},create:function(){var d=new p.ARRAY_TYPE(16);d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=1;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=1;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d},clone:function(d){var a=new p.ARRAY_TYPE(16);a[0]=d[0];a[1]=d[1];a[2]=d[2];a[3]=d[3];a[4]=d[4];a[5]=d[5];a[6]=d[6];a[7]=d[7];a[8]=d[8];a[9]=d[9];a[10]=d[10];a[11]=d[11];a[12]=d[12];a[13]=d[13];a[14]=d[14];a[15]=d[15];return a},copy:function(d,
a){d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=a[3];d[4]=a[4];d[5]=a[5];d[6]=a[6];d[7]=a[7];d[8]=a[8];d[9]=a[9];d[10]=a[10];d[11]=a[11];d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d},fromValues:function(d,a,g,f,h,m,e,b,l,t,u,r,v,q,n,w){var c=new p.ARRAY_TYPE(16);c[0]=d;c[1]=a;c[2]=g;c[3]=f;c[4]=h;c[5]=m;c[6]=e;c[7]=b;c[8]=l;c[9]=t;c[10]=u;c[11]=r;c[12]=v;c[13]=q;c[14]=n;c[15]=w;return c},set:function(d,a,g,f,h,m,e,b,l,p,u,r,v,q,n,w,c){d[0]=a;d[1]=g;d[2]=f;d[3]=h;d[4]=m;d[5]=e;d[6]=b;d[7]=l;d[8]=
p;d[9]=u;d[10]=r;d[11]=v;d[12]=q;d[13]=n;d[14]=w;d[15]=c;return d},identity:function(d){d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=1;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=1;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d}};h.scalar.transpose=function(d,a){if(d===a){var g=a[1],f=a[2],h=a[3],m=a[6],e=a[7],b=a[11];d[1]=a[4];d[2]=a[8];d[3]=a[12];d[4]=g;d[6]=a[9];d[7]=a[13];d[8]=f;d[9]=m;d[11]=a[14];d[12]=h;d[13]=e;d[14]=b}else d[0]=a[0],d[1]=a[4],d[2]=a[8],d[3]=a[12],d[4]=a[1],d[5]=a[5],d[6]=a[9],d[7]=a[13],
d[8]=a[2],d[9]=a[6],d[10]=a[10],d[11]=a[14],d[12]=a[3],d[13]=a[7],d[14]=a[11],d[15]=a[15];return d};h.SIMD.transpose=function(d,a){var g,f,h,m,e,b;g=SIMD.Float32x4.load(a,0);f=SIMD.Float32x4.load(a,4);h=SIMD.Float32x4.load(a,8);a=SIMD.Float32x4.load(a,12);m=SIMD.Float32x4.shuffle(g,f,0,1,4,5);e=SIMD.Float32x4.shuffle(h,a,0,1,4,5);b=SIMD.Float32x4.shuffle(m,e,0,2,4,6);m=SIMD.Float32x4.shuffle(m,e,1,3,5,7);SIMD.Float32x4.store(d,0,b);SIMD.Float32x4.store(d,4,m);m=SIMD.Float32x4.shuffle(g,f,2,3,6,7);
e=SIMD.Float32x4.shuffle(h,a,2,3,6,7);g=SIMD.Float32x4.shuffle(m,e,0,2,4,6);f=SIMD.Float32x4.shuffle(m,e,1,3,5,7);SIMD.Float32x4.store(d,8,g);SIMD.Float32x4.store(d,12,f);return d};h.transpose=p.USE_SIMD?h.SIMD.transpose:h.scalar.transpose;h.scalar.invert=function(d,a){var g=a[0],f=a[1],h=a[2],m=a[3],e=a[4],b=a[5],l=a[6],p=a[7],u=a[8],r=a[9],v=a[10],q=a[11],n=a[12],w=a[13],c=a[14];a=a[15];var x=g*b-f*e,z=g*l-h*e,A=g*p-m*e,y=f*l-h*b,B=f*p-m*b,E=h*p-m*l,C=u*w-r*n,G=u*c-v*n,J=u*a-q*n,F=r*c-v*w,I=r*a-
q*w,H=v*a-q*c,K=x*H-z*I+A*F+y*J-B*G+E*C;if(!K)return null;K=1/K;d[0]=(b*H-l*I+p*F)*K;d[1]=(h*I-f*H-m*F)*K;d[2]=(w*E-c*B+a*y)*K;d[3]=(v*B-r*E-q*y)*K;d[4]=(l*J-e*H-p*G)*K;d[5]=(g*H-h*J+m*G)*K;d[6]=(c*A-n*E-a*z)*K;d[7]=(u*E-v*A+q*z)*K;d[8]=(e*I-b*J+p*C)*K;d[9]=(f*J-g*I-m*C)*K;d[10]=(n*B-w*A+a*x)*K;d[11]=(r*A-u*B-q*x)*K;d[12]=(b*G-e*F-l*C)*K;d[13]=(g*F-f*G+h*C)*K;d[14]=(w*z-n*y-c*x)*K;d[15]=(u*y-r*z+v*x)*K;return d};h.SIMD.invert=function(d,a){var g,f,h,m,e,b,l,p;e=SIMD.Float32x4.load(a,0);b=SIMD.Float32x4.load(a,
4);l=SIMD.Float32x4.load(a,8);p=SIMD.Float32x4.load(a,12);a=SIMD.Float32x4.shuffle(e,b,0,1,4,5);f=SIMD.Float32x4.shuffle(l,p,0,1,4,5);g=SIMD.Float32x4.shuffle(a,f,0,2,4,6);f=SIMD.Float32x4.shuffle(f,a,1,3,5,7);a=SIMD.Float32x4.shuffle(e,b,2,3,6,7);m=SIMD.Float32x4.shuffle(l,p,2,3,6,7);h=SIMD.Float32x4.shuffle(a,m,0,2,4,6);m=SIMD.Float32x4.shuffle(m,a,1,3,5,7);a=SIMD.Float32x4.mul(h,m);a=SIMD.Float32x4.swizzle(a,1,0,3,2);e=SIMD.Float32x4.mul(f,a);b=SIMD.Float32x4.mul(g,a);a=SIMD.Float32x4.swizzle(a,
2,3,0,1);e=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,a),e);b=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,a),b);b=SIMD.Float32x4.swizzle(b,2,3,0,1);a=SIMD.Float32x4.mul(f,h);a=SIMD.Float32x4.swizzle(a,1,0,3,2);e=SIMD.Float32x4.add(SIMD.Float32x4.mul(m,a),e);p=SIMD.Float32x4.mul(g,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1);e=SIMD.Float32x4.sub(e,SIMD.Float32x4.mul(m,a));p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,a),p);p=SIMD.Float32x4.swizzle(p,2,3,0,1);a=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,2,3,0,1),m);
a=SIMD.Float32x4.swizzle(a,1,0,3,2);h=SIMD.Float32x4.swizzle(h,2,3,0,1);e=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,a),e);l=SIMD.Float32x4.mul(g,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1);e=SIMD.Float32x4.sub(e,SIMD.Float32x4.mul(h,a));l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,a),l);l=SIMD.Float32x4.swizzle(l,2,3,0,1);a=SIMD.Float32x4.mul(g,f);a=SIMD.Float32x4.swizzle(a,1,0,3,2);l=SIMD.Float32x4.add(SIMD.Float32x4.mul(m,a),l);p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,a),p);a=SIMD.Float32x4.swizzle(a,2,
3,0,1);l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(m,a),l);p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(h,a));a=SIMD.Float32x4.mul(g,m);a=SIMD.Float32x4.swizzle(a,1,0,3,2);b=SIMD.Float32x4.sub(b,SIMD.Float32x4.mul(h,a));l=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,a),l);a=SIMD.Float32x4.swizzle(a,2,3,0,1);b=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,a),b);l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(f,a));a=SIMD.Float32x4.mul(g,h);a=SIMD.Float32x4.swizzle(a,1,0,3,2);b=SIMD.Float32x4.add(SIMD.Float32x4.mul(m,a),b);
p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(f,a));a=SIMD.Float32x4.swizzle(a,2,3,0,1);b=SIMD.Float32x4.sub(b,SIMD.Float32x4.mul(m,a));p=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,a),p);g=SIMD.Float32x4.mul(g,e);g=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(g,2,3,0,1),g);g=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(g,1,0,3,2),g);a=SIMD.Float32x4.reciprocalApproximation(g);g=SIMD.Float32x4.sub(SIMD.Float32x4.add(a,a),SIMD.Float32x4.mul(g,SIMD.Float32x4.mul(a,a)));g=SIMD.Float32x4.swizzle(g,0,0,0,0);if(!g)return null;
SIMD.Float32x4.store(d,0,SIMD.Float32x4.mul(g,e));SIMD.Float32x4.store(d,4,SIMD.Float32x4.mul(g,b));SIMD.Float32x4.store(d,8,SIMD.Float32x4.mul(g,l));SIMD.Float32x4.store(d,12,SIMD.Float32x4.mul(g,p));return d};h.invert=p.USE_SIMD?h.SIMD.invert:h.scalar.invert;h.scalar.adjoint=function(d,a){var g=a[0],f=a[1],h=a[2],m=a[3],e=a[4],b=a[5],l=a[6],p=a[7],u=a[8],r=a[9],v=a[10],q=a[11],n=a[12],w=a[13],c=a[14];a=a[15];d[0]=b*(v*a-q*c)-r*(l*a-p*c)+w*(l*q-p*v);d[1]=-(f*(v*a-q*c)-r*(h*a-m*c)+w*(h*q-m*v));d[2]=
f*(l*a-p*c)-b*(h*a-m*c)+w*(h*p-m*l);d[3]=-(f*(l*q-p*v)-b*(h*q-m*v)+r*(h*p-m*l));d[4]=-(e*(v*a-q*c)-u*(l*a-p*c)+n*(l*q-p*v));d[5]=g*(v*a-q*c)-u*(h*a-m*c)+n*(h*q-m*v);d[6]=-(g*(l*a-p*c)-e*(h*a-m*c)+n*(h*p-m*l));d[7]=g*(l*q-p*v)-e*(h*q-m*v)+u*(h*p-m*l);d[8]=e*(r*a-q*w)-u*(b*a-p*w)+n*(b*q-p*r);d[9]=-(g*(r*a-q*w)-u*(f*a-m*w)+n*(f*q-m*r));d[10]=g*(b*a-p*w)-e*(f*a-m*w)+n*(f*p-m*b);d[11]=-(g*(b*q-p*r)-e*(f*q-m*r)+u*(f*p-m*b));d[12]=-(e*(r*c-v*w)-u*(b*c-l*w)+n*(b*v-l*r));d[13]=g*(r*c-v*w)-u*(f*c-h*w)+n*(f*
v-h*r);d[14]=-(g*(b*c-l*w)-e*(f*c-h*w)+n*(f*l-h*b));d[15]=g*(b*v-l*r)-e*(f*v-h*r)+u*(f*l-h*b);return d};h.SIMD.adjoint=function(d,a){var g,f,h,m,e,b,l,p;g=SIMD.Float32x4.load(a,0);f=SIMD.Float32x4.load(a,4);h=SIMD.Float32x4.load(a,8);m=SIMD.Float32x4.load(a,12);b=SIMD.Float32x4.shuffle(g,f,0,1,4,5);e=SIMD.Float32x4.shuffle(h,m,0,1,4,5);a=SIMD.Float32x4.shuffle(b,e,0,2,4,6);e=SIMD.Float32x4.shuffle(e,b,1,3,5,7);b=SIMD.Float32x4.shuffle(g,f,2,3,6,7);f=SIMD.Float32x4.shuffle(h,m,2,3,6,7);g=SIMD.Float32x4.shuffle(b,
f,0,2,4,6);f=SIMD.Float32x4.shuffle(f,b,1,3,5,7);b=SIMD.Float32x4.mul(g,f);b=SIMD.Float32x4.swizzle(b,1,0,3,2);h=SIMD.Float32x4.mul(e,b);m=SIMD.Float32x4.mul(a,b);b=SIMD.Float32x4.swizzle(b,2,3,0,1);h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(e,b),h);m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,b),m);m=SIMD.Float32x4.swizzle(m,2,3,0,1);b=SIMD.Float32x4.mul(e,g);b=SIMD.Float32x4.swizzle(b,1,0,3,2);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,b),h);p=SIMD.Float32x4.mul(a,b);b=SIMD.Float32x4.swizzle(b,2,3,0,1);
h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(f,b));p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,b),p);p=SIMD.Float32x4.swizzle(p,2,3,0,1);b=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(e,2,3,0,1),f);b=SIMD.Float32x4.swizzle(b,1,0,3,2);g=SIMD.Float32x4.swizzle(g,2,3,0,1);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(g,b),h);l=SIMD.Float32x4.mul(a,b);b=SIMD.Float32x4.swizzle(b,2,3,0,1);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(g,b));l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,b),l);l=SIMD.Float32x4.swizzle(l,2,3,0,
1);b=SIMD.Float32x4.mul(a,e);b=SIMD.Float32x4.swizzle(b,1,0,3,2);l=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,b),l);p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,b),p);b=SIMD.Float32x4.swizzle(b,2,3,0,1);l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,b),l);p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(g,b));b=SIMD.Float32x4.mul(a,f);b=SIMD.Float32x4.swizzle(b,1,0,3,2);m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(g,b));l=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,b),l);b=SIMD.Float32x4.swizzle(b,2,3,0,1);m=SIMD.Float32x4.add(SIMD.Float32x4.mul(g,
b),m);l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(e,b));b=SIMD.Float32x4.mul(a,g);b=SIMD.Float32x4.swizzle(b,1,0,3,2);m=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,b),m);p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(e,b));b=SIMD.Float32x4.swizzle(b,2,3,0,1);m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(f,b));p=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,b),p);SIMD.Float32x4.store(d,0,h);SIMD.Float32x4.store(d,4,m);SIMD.Float32x4.store(d,8,l);SIMD.Float32x4.store(d,12,p);return d};h.adjoint=p.USE_SIMD?h.SIMD.adjoint:
h.scalar.adjoint;h.determinant=function(d){var a=d[0],g=d[1],f=d[2],h=d[3],m=d[4],e=d[5],b=d[6],l=d[7],p=d[8],u=d[9],r=d[10],v=d[11],q=d[12],n=d[13],w=d[14];d=d[15];return(a*e-g*m)*(r*d-v*w)-(a*b-f*m)*(u*d-v*n)+(a*l-h*m)*(u*w-r*n)+(g*b-f*e)*(p*d-v*q)-(g*l-h*e)*(p*w-r*q)+(f*l-h*b)*(p*n-u*q)};h.SIMD.multiply=function(d,a,g){var f=SIMD.Float32x4.load(a,0),h=SIMD.Float32x4.load(a,4),m=SIMD.Float32x4.load(a,8);a=SIMD.Float32x4.load(a,12);var e=SIMD.Float32x4.load(g,0),e=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(e,
0,0,0,0),f),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(e,1,1,1,1),h),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(e,2,2,2,2),m),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(e,3,3,3,3),a))));SIMD.Float32x4.store(d,0,e);e=SIMD.Float32x4.load(g,4);e=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(e,0,0,0,0),f),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(e,1,1,1,1),h),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(e,2,2,2,2),m),
SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(e,3,3,3,3),a))));SIMD.Float32x4.store(d,4,e);e=SIMD.Float32x4.load(g,8);e=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(e,0,0,0,0),f),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(e,1,1,1,1),h),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(e,2,2,2,2),m),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(e,3,3,3,3),a))));SIMD.Float32x4.store(d,8,e);g=SIMD.Float32x4.load(g,12);f=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,
0,0,0,0),f),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,1,1,1,1),h),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,2,2,2,2),m),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,3,3,3,3),a))));SIMD.Float32x4.store(d,12,f);return d};h.scalar.multiply=function(d,a,g){var f=a[0],h=a[1],m=a[2],e=a[3],b=a[4],l=a[5],p=a[6],u=a[7],r=a[8],v=a[9],q=a[10],n=a[11],w=a[12],c=a[13],x=a[14];a=a[15];var z=g[0],A=g[1],y=g[2],B=g[3];d[0]=z*f+A*b+y*r+B*w;d[1]=z*h+A*l+y*v+B*c;d[2]=z*m+A*
p+y*q+B*x;d[3]=z*e+A*u+y*n+B*a;z=g[4];A=g[5];y=g[6];B=g[7];d[4]=z*f+A*b+y*r+B*w;d[5]=z*h+A*l+y*v+B*c;d[6]=z*m+A*p+y*q+B*x;d[7]=z*e+A*u+y*n+B*a;z=g[8];A=g[9];y=g[10];B=g[11];d[8]=z*f+A*b+y*r+B*w;d[9]=z*h+A*l+y*v+B*c;d[10]=z*m+A*p+y*q+B*x;d[11]=z*e+A*u+y*n+B*a;z=g[12];A=g[13];y=g[14];B=g[15];d[12]=z*f+A*b+y*r+B*w;d[13]=z*h+A*l+y*v+B*c;d[14]=z*m+A*p+y*q+B*x;d[15]=z*e+A*u+y*n+B*a;return d};h.multiply=p.USE_SIMD?h.SIMD.multiply:h.scalar.multiply;h.mul=h.multiply;h.scalar.translate=function(d,a,g){var f=
g[0],h=g[1];g=g[2];var m,e,b,l,p,u,r,v,q,n,w,c;a===d?(d[12]=a[0]*f+a[4]*h+a[8]*g+a[12],d[13]=a[1]*f+a[5]*h+a[9]*g+a[13],d[14]=a[2]*f+a[6]*h+a[10]*g+a[14],d[15]=a[3]*f+a[7]*h+a[11]*g+a[15]):(m=a[0],e=a[1],b=a[2],l=a[3],p=a[4],u=a[5],r=a[6],v=a[7],q=a[8],n=a[9],w=a[10],c=a[11],d[0]=m,d[1]=e,d[2]=b,d[3]=l,d[4]=p,d[5]=u,d[6]=r,d[7]=v,d[8]=q,d[9]=n,d[10]=w,d[11]=c,d[12]=m*f+p*h+q*g+a[12],d[13]=e*f+u*h+n*g+a[13],d[14]=b*f+r*h+w*g+a[14],d[15]=l*f+v*h+c*g+a[15]);return d};h.SIMD.translate=function(d,a,g){var f=
SIMD.Float32x4.load(a,0),h=SIMD.Float32x4.load(a,4),m=SIMD.Float32x4.load(a,8),e=SIMD.Float32x4.load(a,12);g=SIMD.Float32x4(g[0],g[1],g[2],0);a!==d&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],d[4]=a[4],d[5]=a[5],d[6]=a[6],d[7]=a[7],d[8]=a[8],d[9]=a[9],d[10]=a[10],d[11]=a[11]);f=SIMD.Float32x4.mul(f,SIMD.Float32x4.swizzle(g,0,0,0,0));h=SIMD.Float32x4.mul(h,SIMD.Float32x4.swizzle(g,1,1,1,1));m=SIMD.Float32x4.mul(m,SIMD.Float32x4.swizzle(g,2,2,2,2));a=SIMD.Float32x4.add(f,SIMD.Float32x4.add(h,SIMD.Float32x4.add(m,
e)));SIMD.Float32x4.store(d,12,a);return d};h.translate=p.USE_SIMD?h.SIMD.translate:h.scalar.translate;h.scalar.scale=function(d,a,g){var f=g[0],h=g[1];g=g[2];d[0]=a[0]*f;d[1]=a[1]*f;d[2]=a[2]*f;d[3]=a[3]*f;d[4]=a[4]*h;d[5]=a[5]*h;d[6]=a[6]*h;d[7]=a[7]*h;d[8]=a[8]*g;d[9]=a[9]*g;d[10]=a[10]*g;d[11]=a[11]*g;d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d};h.SIMD.scale=function(d,a,g){var f;g=SIMD.Float32x4(g[0],g[1],g[2],0);f=SIMD.Float32x4.load(a,0);SIMD.Float32x4.store(d,0,SIMD.Float32x4.mul(f,
SIMD.Float32x4.swizzle(g,0,0,0,0)));f=SIMD.Float32x4.load(a,4);SIMD.Float32x4.store(d,4,SIMD.Float32x4.mul(f,SIMD.Float32x4.swizzle(g,1,1,1,1)));f=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(d,8,SIMD.Float32x4.mul(f,SIMD.Float32x4.swizzle(g,2,2,2,2)));d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d};h.scale=p.USE_SIMD?h.SIMD.scale:h.scalar.scale;h.rotate=function(d,a,g,f){var h=f[0],m=f[1];f=f[2];var e=Math.sqrt(h*h+m*m+f*f),b,l,t,u,r,v,q,n,w,c,x,z,A,y,B,E,C,G,J,F;if(Math.abs(e)<p.EPSILON)return null;
e=1/e;h*=e;m*=e;f*=e;b=Math.sin(g);l=Math.cos(g);t=1-l;g=a[0];e=a[1];u=a[2];r=a[3];v=a[4];q=a[5];n=a[6];w=a[7];c=a[8];x=a[9];z=a[10];A=a[11];y=h*h*t+l;B=m*h*t+f*b;E=f*h*t-m*b;C=h*m*t-f*b;G=m*m*t+l;J=f*m*t+h*b;F=h*f*t+m*b;h=m*f*t-h*b;m=f*f*t+l;d[0]=g*y+v*B+c*E;d[1]=e*y+q*B+x*E;d[2]=u*y+n*B+z*E;d[3]=r*y+w*B+A*E;d[4]=g*C+v*G+c*J;d[5]=e*C+q*G+x*J;d[6]=u*C+n*G+z*J;d[7]=r*C+w*G+A*J;d[8]=g*F+v*h+c*m;d[9]=e*F+q*h+x*m;d[10]=u*F+n*h+z*m;d[11]=r*F+w*h+A*m;a!==d&&(d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);
return d};h.scalar.rotateX=function(d,a,g){var f=Math.sin(g);g=Math.cos(g);var h=a[4],m=a[5],e=a[6],b=a[7],l=a[8],p=a[9],u=a[10],r=a[11];a!==d&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);d[4]=h*g+l*f;d[5]=m*g+p*f;d[6]=e*g+u*f;d[7]=b*g+r*f;d[8]=l*g-h*f;d[9]=p*g-m*f;d[10]=u*g-e*f;d[11]=r*g-b*f;return d};h.SIMD.rotateX=function(d,a,g){var f=SIMD.Float32x4.splat(Math.sin(g));g=SIMD.Float32x4.splat(Math.cos(g));a!==d&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],
d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);var h=SIMD.Float32x4.load(a,4);a=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(d,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(h,g),SIMD.Float32x4.mul(a,f)));SIMD.Float32x4.store(d,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,g),SIMD.Float32x4.mul(h,f)));return d};h.rotateX=p.USE_SIMD?h.SIMD.rotateX:h.scalar.rotateX;h.scalar.rotateY=function(d,a,g){var f=Math.sin(g);g=Math.cos(g);var h=a[0],m=a[1],e=a[2],b=a[3],l=a[8],p=a[9],u=a[10],r=a[11];a!==d&&(d[4]=a[4],
d[5]=a[5],d[6]=a[6],d[7]=a[7],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);d[0]=h*g-l*f;d[1]=m*g-p*f;d[2]=e*g-u*f;d[3]=b*g-r*f;d[8]=h*f+l*g;d[9]=m*f+p*g;d[10]=e*f+u*g;d[11]=b*f+r*g;return d};h.SIMD.rotateY=function(d,a,g){var f=SIMD.Float32x4.splat(Math.sin(g));g=SIMD.Float32x4.splat(Math.cos(g));a!==d&&(d[4]=a[4],d[5]=a[5],d[6]=a[6],d[7]=a[7],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);var h=SIMD.Float32x4.load(a,0);a=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(d,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,
g),SIMD.Float32x4.mul(a,f)));SIMD.Float32x4.store(d,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(h,f),SIMD.Float32x4.mul(a,g)));return d};h.rotateY=p.USE_SIMD?h.SIMD.rotateY:h.scalar.rotateY;h.scalar.rotateZ=function(d,a,g){var f=Math.sin(g);g=Math.cos(g);var h=a[0],m=a[1],e=a[2],b=a[3],l=a[4],p=a[5],u=a[6],r=a[7];a!==d&&(d[8]=a[8],d[9]=a[9],d[10]=a[10],d[11]=a[11],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);d[0]=h*g+l*f;d[1]=m*g+p*f;d[2]=e*g+u*f;d[3]=b*g+r*f;d[4]=l*g-h*f;d[5]=p*g-m*f;d[6]=u*g-e*
f;d[7]=r*g-b*f;return d};h.SIMD.rotateZ=function(d,a,g){var f=SIMD.Float32x4.splat(Math.sin(g));g=SIMD.Float32x4.splat(Math.cos(g));a!==d&&(d[8]=a[8],d[9]=a[9],d[10]=a[10],d[11]=a[11],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]);var h=SIMD.Float32x4.load(a,0);a=SIMD.Float32x4.load(a,4);SIMD.Float32x4.store(d,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(h,g),SIMD.Float32x4.mul(a,f)));SIMD.Float32x4.store(d,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,g),SIMD.Float32x4.mul(h,f)));return d};h.rotateZ=p.USE_SIMD?
h.SIMD.rotateZ:h.scalar.rotateZ;h.fromTranslation=function(d,a){d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=1;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=1;d[11]=0;d[12]=a[0];d[13]=a[1];d[14]=a[2];d[15]=1;return d};h.fromScaling=function(d,a){d[0]=a[0];d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=a[1];d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=a[2];d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};h.fromRotation=function(d,a,g){var f=g[0],h=g[1];g=g[2];var m=Math.sqrt(f*f+h*h+g*g),e;if(Math.abs(m)<p.EPSILON)return null;m=1/m;f*=m;
h*=m;g*=m;m=Math.sin(a);a=Math.cos(a);e=1-a;d[0]=f*f*e+a;d[1]=h*f*e+g*m;d[2]=g*f*e-h*m;d[3]=0;d[4]=f*h*e-g*m;d[5]=h*h*e+a;d[6]=g*h*e+f*m;d[7]=0;d[8]=f*g*e+h*m;d[9]=h*g*e-f*m;d[10]=g*g*e+a;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};h.fromXRotation=function(d,a){var g=Math.sin(a);a=Math.cos(a);d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=a;d[6]=g;d[7]=0;d[8]=0;d[9]=-g;d[10]=a;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};h.fromYRotation=function(d,a){var g=Math.sin(a);a=Math.cos(a);d[0]=a;d[1]=
0;d[2]=-g;d[3]=0;d[4]=0;d[5]=1;d[6]=0;d[7]=0;d[8]=g;d[9]=0;d[10]=a;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};h.fromZRotation=function(d,a){var g=Math.sin(a);a=Math.cos(a);d[0]=a;d[1]=g;d[2]=0;d[3]=0;d[4]=-g;d[5]=a;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=1;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};h.fromRotationTranslation=function(d,a,g){var f=a[0],h=a[1],m=a[2],e=a[3],b=f+f,l=h+h,p=m+m;a=f*b;var u=f*l,f=f*p,r=h*l,h=h*p,m=m*p,b=e*b,l=e*l,e=e*p;d[0]=1-(r+m);d[1]=u+e;d[2]=f-l;d[3]=0;d[4]=
u-e;d[5]=1-(a+m);d[6]=h+b;d[7]=0;d[8]=f+l;d[9]=h-b;d[10]=1-(a+r);d[11]=0;d[12]=g[0];d[13]=g[1];d[14]=g[2];d[15]=1;return d};h.getTranslation=function(d,a){d[0]=a[12];d[1]=a[13];d[2]=a[14];return d};h.getRotation=function(d,a){var g=a[0]+a[5]+a[10],f=0;0<g?(f=2*Math.sqrt(g+1),d[3]=.25*f,d[0]=(a[6]-a[9])/f,d[1]=(a[8]-a[2])/f,d[2]=(a[1]-a[4])/f):a[0]>a[5]&a[0]>a[10]?(f=2*Math.sqrt(1+a[0]-a[5]-a[10]),d[3]=(a[6]-a[9])/f,d[0]=.25*f,d[1]=(a[1]+a[4])/f,d[2]=(a[8]+a[2])/f):a[5]>a[10]?(f=2*Math.sqrt(1+a[5]-
a[0]-a[10]),d[3]=(a[8]-a[2])/f,d[0]=(a[1]+a[4])/f,d[1]=.25*f,d[2]=(a[6]+a[9])/f):(f=2*Math.sqrt(1+a[10]-a[0]-a[5]),d[3]=(a[1]-a[4])/f,d[0]=(a[8]+a[2])/f,d[1]=(a[6]+a[9])/f,d[2]=.25*f);return d};h.fromRotationTranslationScale=function(d,a,g,f){var h=a[0],m=a[1],e=a[2],b=a[3],l=h+h,p=m+m,u=e+e;a=h*l;var r=h*p,h=h*u,v=m*p,m=m*u,e=e*u,l=b*l,p=b*p,b=b*u,u=f[0],q=f[1];f=f[2];d[0]=(1-(v+e))*u;d[1]=(r+b)*u;d[2]=(h-p)*u;d[3]=0;d[4]=(r-b)*q;d[5]=(1-(a+e))*q;d[6]=(m+l)*q;d[7]=0;d[8]=(h+p)*f;d[9]=(m-l)*f;d[10]=
(1-(a+v))*f;d[11]=0;d[12]=g[0];d[13]=g[1];d[14]=g[2];d[15]=1;return d};h.fromRotationTranslationScaleOrigin=function(d,a,g,f,h){var k=a[0],e=a[1],b=a[2],l=a[3],p=k+k,u=e+e,r=b+b;a=k*p;var v=k*u,k=k*r,q=e*u,e=e*r,b=b*r,p=l*p,u=l*u,l=l*r,r=f[0],n=f[1];f=f[2];var w=h[0],c=h[1];h=h[2];d[0]=(1-(q+b))*r;d[1]=(v+l)*r;d[2]=(k-u)*r;d[3]=0;d[4]=(v-l)*n;d[5]=(1-(a+b))*n;d[6]=(e+p)*n;d[7]=0;d[8]=(k+u)*f;d[9]=(e-p)*f;d[10]=(1-(a+q))*f;d[11]=0;d[12]=g[0]+w-(d[0]*w+d[4]*c+d[8]*h);d[13]=g[1]+c-(d[1]*w+d[5]*c+d[9]*
h);d[14]=g[2]+h-(d[2]*w+d[6]*c+d[10]*h);d[15]=1;return d};h.fromQuat=function(d,a){var g=a[0],f=a[1],h=a[2];a=a[3];var m=g+g,e=f+f,b=h+h,g=g*m,l=f*m,f=f*e,p=h*m,u=h*e,h=h*b,m=a*m,e=a*e;a*=b;d[0]=1-f-h;d[1]=l+a;d[2]=p-e;d[3]=0;d[4]=l-a;d[5]=1-g-h;d[6]=u+m;d[7]=0;d[8]=p+e;d[9]=u-m;d[10]=1-g-f;d[11]=0;d[12]=0;d[13]=0;d[14]=0;d[15]=1;return d};h.frustum=function(d,a,g,f,h,m,e){var b=1/(g-a),k=1/(h-f),p=1/(m-e);d[0]=2*m*b;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=2*m*k;d[6]=0;d[7]=0;d[8]=(g+a)*b;d[9]=(h+f)*k;d[10]=
(e+m)*p;d[11]=-1;d[12]=0;d[13]=0;d[14]=e*m*2*p;d[15]=0;return d};h.perspective=function(d,a,g,f,h){a=1/Math.tan(a/2);var k=1/(f-h);d[0]=a/g;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=a;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=(h+f)*k;d[11]=-1;d[12]=0;d[13]=0;d[14]=2*h*f*k;d[15]=0;return d};h.perspectiveFromFieldOfView=function(d,a,g,f){var h=Math.tan(a.upDegrees*Math.PI/180),m=Math.tan(a.downDegrees*Math.PI/180),e=Math.tan(a.leftDegrees*Math.PI/180);a=Math.tan(a.rightDegrees*Math.PI/180);var b=2/(e+a),l=2/(h+m);d[0]=
b;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=l;d[6]=0;d[7]=0;d[8]=-((e-a)*b*.5);d[9]=(h-m)*l*.5;d[10]=f/(g-f);d[11]=-1;d[12]=0;d[13]=0;d[14]=f*g/(g-f);d[15]=0;return d};h.ortho=function(d,a,g,f,h,m,e){var b=1/(a-g),k=1/(f-h),p=1/(m-e);d[0]=-2*b;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=-2*k;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=2*p;d[11]=0;d[12]=(a+g)*b;d[13]=(h+f)*k;d[14]=(e+m)*p;d[15]=1;return d};h.lookAt=function(d,a,g,f){var k,m,e,b,l,t,u,r,v=a[0],q=a[1];a=a[2];e=f[0];b=f[1];m=f[2];u=g[0];f=g[1];k=g[2];if(Math.abs(v-
u)<p.EPSILON&&Math.abs(q-f)<p.EPSILON&&Math.abs(a-k)<p.EPSILON)return h.identity(d);g=v-u;f=q-f;u=a-k;r=1/Math.sqrt(g*g+f*f+u*u);g*=r;f*=r;u*=r;k=b*u-m*f;m=m*g-e*u;e=e*f-b*g;(r=Math.sqrt(k*k+m*m+e*e))?(r=1/r,k*=r,m*=r,e*=r):e=m=k=0;b=f*e-u*m;l=u*k-g*e;t=g*m-f*k;(r=Math.sqrt(b*b+l*l+t*t))?(r=1/r,b*=r,l*=r,t*=r):t=l=b=0;d[0]=k;d[1]=b;d[2]=g;d[3]=0;d[4]=m;d[5]=l;d[6]=f;d[7]=0;d[8]=e;d[9]=t;d[10]=u;d[11]=0;d[12]=-(k*v+m*q+e*a);d[13]=-(b*v+l*q+t*a);d[14]=-(g*v+f*q+u*a);d[15]=1;return d};h.str=function(d){return"mat4("+
d[0]+", "+d[1]+", "+d[2]+", "+d[3]+", "+d[4]+", "+d[5]+", "+d[6]+", "+d[7]+", "+d[8]+", "+d[9]+", "+d[10]+", "+d[11]+", "+d[12]+", "+d[13]+", "+d[14]+", "+d[15]+")"};h.frob=function(d){return Math.sqrt(Math.pow(d[0],2)+Math.pow(d[1],2)+Math.pow(d[2],2)+Math.pow(d[3],2)+Math.pow(d[4],2)+Math.pow(d[5],2)+Math.pow(d[6],2)+Math.pow(d[7],2)+Math.pow(d[8],2)+Math.pow(d[9],2)+Math.pow(d[10],2)+Math.pow(d[11],2)+Math.pow(d[12],2)+Math.pow(d[13],2)+Math.pow(d[14],2)+Math.pow(d[15],2))};h.add=function(d,a,
g){d[0]=a[0]+g[0];d[1]=a[1]+g[1];d[2]=a[2]+g[2];d[3]=a[3]+g[3];d[4]=a[4]+g[4];d[5]=a[5]+g[5];d[6]=a[6]+g[6];d[7]=a[7]+g[7];d[8]=a[8]+g[8];d[9]=a[9]+g[9];d[10]=a[10]+g[10];d[11]=a[11]+g[11];d[12]=a[12]+g[12];d[13]=a[13]+g[13];d[14]=a[14]+g[14];d[15]=a[15]+g[15];return d};h.subtract=function(d,a,g){d[0]=a[0]-g[0];d[1]=a[1]-g[1];d[2]=a[2]-g[2];d[3]=a[3]-g[3];d[4]=a[4]-g[4];d[5]=a[5]-g[5];d[6]=a[6]-g[6];d[7]=a[7]-g[7];d[8]=a[8]-g[8];d[9]=a[9]-g[9];d[10]=a[10]-g[10];d[11]=a[11]-g[11];d[12]=a[12]-g[12];
d[13]=a[13]-g[13];d[14]=a[14]-g[14];d[15]=a[15]-g[15];return d};h.sub=h.subtract;h.multiplyScalar=function(d,a,g){d[0]=a[0]*g;d[1]=a[1]*g;d[2]=a[2]*g;d[3]=a[3]*g;d[4]=a[4]*g;d[5]=a[5]*g;d[6]=a[6]*g;d[7]=a[7]*g;d[8]=a[8]*g;d[9]=a[9]*g;d[10]=a[10]*g;d[11]=a[11]*g;d[12]=a[12]*g;d[13]=a[13]*g;d[14]=a[14]*g;d[15]=a[15]*g;return d};h.multiplyScalarAndAdd=function(d,a,g,f){d[0]=a[0]+g[0]*f;d[1]=a[1]+g[1]*f;d[2]=a[2]+g[2]*f;d[3]=a[3]+g[3]*f;d[4]=a[4]+g[4]*f;d[5]=a[5]+g[5]*f;d[6]=a[6]+g[6]*f;d[7]=a[7]+g[7]*
f;d[8]=a[8]+g[8]*f;d[9]=a[9]+g[9]*f;d[10]=a[10]+g[10]*f;d[11]=a[11]+g[11]*f;d[12]=a[12]+g[12]*f;d[13]=a[13]+g[13]*f;d[14]=a[14]+g[14]*f;d[15]=a[15]+g[15]*f;return d};h.exactEquals=function(d,a){return d[0]===a[0]&&d[1]===a[1]&&d[2]===a[2]&&d[3]===a[3]&&d[4]===a[4]&&d[5]===a[5]&&d[6]===a[6]&&d[7]===a[7]&&d[8]===a[8]&&d[9]===a[9]&&d[10]===a[10]&&d[11]===a[11]&&d[12]===a[12]&&d[13]===a[13]&&d[14]===a[14]&&d[15]===a[15]};h.equals=function(d,a){var g=d[0],f=d[1],h=d[2],m=d[3],e=d[4],b=d[5],l=d[6],t=d[7],
u=d[8],r=d[9],v=d[10],q=d[11],n=d[12],w=d[13],c=d[14];d=d[15];var x=a[0],z=a[1],A=a[2],y=a[3],B=a[4],E=a[5],C=a[6],G=a[7],J=a[8],F=a[9],I=a[10],H=a[11],K=a[12],L=a[13],M=a[14];a=a[15];return Math.abs(g-x)<=p.EPSILON*Math.max(1,Math.abs(g),Math.abs(x))&&Math.abs(f-z)<=p.EPSILON*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(h-A)<=p.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(m-y)<=p.EPSILON*Math.max(1,Math.abs(m),Math.abs(y))&&Math.abs(e-B)<=p.EPSILON*Math.max(1,Math.abs(e),Math.abs(B))&&
Math.abs(b-E)<=p.EPSILON*Math.max(1,Math.abs(b),Math.abs(E))&&Math.abs(l-C)<=p.EPSILON*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(t-G)<=p.EPSILON*Math.max(1,Math.abs(t),Math.abs(G))&&Math.abs(u-J)<=p.EPSILON*Math.max(1,Math.abs(u),Math.abs(J))&&Math.abs(r-F)<=p.EPSILON*Math.max(1,Math.abs(r),Math.abs(F))&&Math.abs(v-I)<=p.EPSILON*Math.max(1,Math.abs(v),Math.abs(I))&&Math.abs(q-H)<=p.EPSILON*Math.max(1,Math.abs(q),Math.abs(H))&&Math.abs(n-K)<=p.EPSILON*Math.max(1,Math.abs(n),Math.abs(K))&&Math.abs(w-
L)<=p.EPSILON*Math.max(1,Math.abs(w),Math.abs(L))&&Math.abs(c-M)<=p.EPSILON*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(d-a)<=p.EPSILON*Math.max(1,Math.abs(d),Math.abs(a))};return h})},"esri/core/libs/gl-matrix/common":function(){define([],function(){var p={EPSILON:1E-6};p.ARRAY_TYPE="undefined"!==typeof Float32Array?Float32Array:Array;p.RANDOM=Math.random;p.ENABLE_SIMD=!1;p.SIMD_AVAILABLE=p.ARRAY_TYPE===Float32Array&&"SIMD"in this;p.USE_SIMD=p.ENABLE_SIMD&&p.SIMD_AVAILABLE;p.setMatrixArrayType=
function(d){p.ARRAY_TYPE=d};var h=Math.PI/180;p.toRadian=function(d){return d*h};p.equals=function(d,a){return Math.abs(d-a)<=p.EPSILON*Math.max(1,Math.abs(d),Math.abs(a))};return p})},"esri/core/libs/gl-matrix/vec2":function(){define(["./common"],function(p){var h={create:function(){var d=new p.ARRAY_TYPE(2);d[0]=0;d[1]=0;return d},clone:function(d){var a=new p.ARRAY_TYPE(2);a[0]=d[0];a[1]=d[1];return a},fromValues:function(d,a){var g=new p.ARRAY_TYPE(2);g[0]=d;g[1]=a;return g},copy:function(d,a){d[0]=
a[0];d[1]=a[1];return d},set:function(d,a,g){d[0]=a;d[1]=g;return d},add:function(d,a,g){d[0]=a[0]+g[0];d[1]=a[1]+g[1];return d},subtract:function(d,a,g){d[0]=a[0]-g[0];d[1]=a[1]-g[1];return d}};h.sub=h.subtract;h.multiply=function(d,a,g){d[0]=a[0]*g[0];d[1]=a[1]*g[1];return d};h.mul=h.multiply;h.divide=function(d,a,g){d[0]=a[0]/g[0];d[1]=a[1]/g[1];return d};h.div=h.divide;h.ceil=function(d,a){d[0]=Math.ceil(a[0]);d[1]=Math.ceil(a[1]);return d};h.floor=function(d,a){d[0]=Math.floor(a[0]);d[1]=Math.floor(a[1]);
return d};h.min=function(d,a,g){d[0]=Math.min(a[0],g[0]);d[1]=Math.min(a[1],g[1]);return d};h.max=function(d,a,g){d[0]=Math.max(a[0],g[0]);d[1]=Math.max(a[1],g[1]);return d};h.round=function(d,a){d[0]=Math.round(a[0]);d[1]=Math.round(a[1]);return d};h.scale=function(d,a,g){d[0]=a[0]*g;d[1]=a[1]*g;return d};h.scaleAndAdd=function(d,a,g,f){d[0]=a[0]+g[0]*f;d[1]=a[1]+g[1]*f;return d};h.distance=function(d,a){var g=a[0]-d[0];d=a[1]-d[1];return Math.sqrt(g*g+d*d)};h.dist=h.distance;h.squaredDistance=function(d,
a){var g=a[0]-d[0];d=a[1]-d[1];return g*g+d*d};h.sqrDist=h.squaredDistance;h.length=function(d){var a=d[0];d=d[1];return Math.sqrt(a*a+d*d)};h.len=h.length;h.squaredLength=function(d){var a=d[0];d=d[1];return a*a+d*d};h.sqrLen=h.squaredLength;h.negate=function(d,a){d[0]=-a[0];d[1]=-a[1];return d};h.inverse=function(d,a){d[0]=1/a[0];d[1]=1/a[1];return d};h.normalize=function(d,a){var g=a[0],f=a[1],g=g*g+f*f;0<g&&(g=1/Math.sqrt(g),d[0]=a[0]*g,d[1]=a[1]*g);return d};h.dot=function(d,a){return d[0]*a[0]+
d[1]*a[1]};h.cross=function(d,a,g){a=a[0]*g[1]-a[1]*g[0];d[0]=d[1]=0;d[2]=a;return d};h.lerp=function(d,a,g,f){var h=a[0];a=a[1];d[0]=h+f*(g[0]-h);d[1]=a+f*(g[1]-a);return d};h.random=function(d,a){a=a||1;var g=2*p.RANDOM()*Math.PI;d[0]=Math.cos(g)*a;d[1]=Math.sin(g)*a;return d};h.transformMat2=function(d,a,g){var f=a[0];a=a[1];d[0]=g[0]*f+g[2]*a;d[1]=g[1]*f+g[3]*a;return d};h.transformMat2d=function(d,a,g){var f=a[0];a=a[1];d[0]=g[0]*f+g[2]*a+g[4];d[1]=g[1]*f+g[3]*a+g[5];return d};h.transformMat3=
function(d,a,g){var f=a[0];a=a[1];d[0]=g[0]*f+g[3]*a+g[6];d[1]=g[1]*f+g[4]*a+g[7];return d};h.transformMat4=function(d,a,g){var f=a[0];a=a[1];d[0]=g[0]*f+g[4]*a+g[12];d[1]=g[1]*f+g[5]*a+g[13];return d};h.forEach=function(){var d=h.create();return function(a,g,f,h,m,e){g||(g=2);f||(f=0);for(h=h?Math.min(h*g+f,a.length):a.length;f<h;f+=g)d[0]=a[f],d[1]=a[f+1],m(d,d,e),a[f]=d[0],a[f+1]=d[1];return a}}();h.str=function(d){return"vec2("+d[0]+", "+d[1]+")"};h.exactEquals=function(d,a){return d[0]===a[0]&&
d[1]===a[1]};h.equals=function(d,a){var g=d[0];d=d[1];var f=a[0];a=a[1];return Math.abs(g-f)<=p.EPSILON*Math.max(1,Math.abs(g),Math.abs(f))&&Math.abs(d-a)<=p.EPSILON*Math.max(1,Math.abs(d),Math.abs(a))};return h})},"esri/views/2d/engine/DisplayObject":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","./Evented"],function(p,h,d,a){return function(a){function f(){var d=null!==a&&a.apply(this,arguments)||this;d._renderRequestedCalled=!1;d._attached=!1;d._opacity=1;d.renderRequested=
!1;d._visible=!0;return d}d(f,a);Object.defineProperty(f.prototype,"attached",{get:function(){return this._attached},set:function(a){this._attached!==a&&((this._attached=a)?this.hasEventListener("attach")&&this.emit("attach"):this.hasEventListener("detach")&&this.emit("detach"))},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"opacity",{get:function(){return this._opacity},set:function(a){this._opacity!==a&&(this._opacity=a,this.requestRender())},enumerable:!0,configurable:!0});
Object.defineProperty(f.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible!==a&&(this._visible=a,this.requestRender())},enumerable:!0,configurable:!0});f.prototype.attach=function(a){return!0};f.prototype.detach=function(a){};f.prototype.processRender=function(a){this._renderRequestedCalled=!1;this.doRender(a);this._renderRequestedCalled||(this.renderRequested=!1);this.hasEventListener("post-render")&&this.emit("post-render")};f.prototype.requestRender=function(){var a=
this.renderRequested;this.renderRequested=this._renderRequestedCalled=!0;this.parent&&this.parent.requestChildRender(this);a!==this.renderRequested&&this.hasEventListener("will-render")&&this.emit("will-render")};f.prototype.dispose=function(){};return f}(a.Evented)})},"esri/views/2d/engine/Evented":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","dojo/aspect","dojo/on"],function(p,h,d,a,g){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function d(){}
d.prototype.on=function(d,f){return a.after(this,"on"+d,f,!0)};d.prototype.once=function(a,d){return g.once(this,a,d)};d.prototype.emit=function(a){g.emit(this,a,this)};d.prototype.hasEventListener=function(a){a="on"+a;return!(!this[a]||!this[a].after)};return d}();h.Evented=p;h.EventedMixin=function(f){return function(f){function h(){return null!==f&&f.apply(this,arguments)||this}d(h,f);h.prototype.on=function(d,b){return a.after(this,"on"+d,b,!0)};h.prototype.once=function(a,b){return g.once(this,
a,b)};h.prototype.emit=function(a,b){g.emit(this,a,b)};h.prototype.hasEventListener=function(a){a="on"+a;return!(!this[a]||!this[a].after)};return h}(f)}})},"esri/views/vectorTiles/RenderBucket":function(){define(["require","exports","../../core/tsSupport/extendsHelper","../../core/tsSupport/decorateHelper"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});p=function(){return function(a){this.type=a}}();h.RenderBucket=p;a=function(a){function f(){var d=a.call(this,2)||this;d.triangleElementStart=
0;d.triangleElementCount=0;return d}d(f,a);f.prototype.hasData=function(){return 0<this.triangleElementCount};return f}(p);h.LineRenderBucket=a;a=function(a){function f(){var d=a.call(this,1)||this;d.triangleElementStart=0;d.triangleElementCount=0;d.outlineElementStart=0;d.outlineElementCount=0;return d}d(f,a);f.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.outlineElementCount};return f}(p);h.FillRenderBucket=a;a=function(a){function f(){var d=a.call(this,3)||this;d.markerPerPageElementsMap=
new Map;d.glyphPerPageElementsMap=new Map;d.isSDF=!1;return d}d(f,a);f.prototype.hasData=function(){return 0<this.markerPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};return f}(p);h.SymbolRenderBucket=a;a=function(a){function f(){var d=a.call(this,4)||this;d.triangleElementStart=0;d.triangleElementCount=0;return d}d(f,a);f.prototype.hasData=function(){return 0<this.triangleElementCount};return f}(p);h.CircleRenderBucket=a;p=function(a){function f(){return a.call(this,0)||this}d(f,a);
f.prototype.hasData=function(){return!0};return f}(p);h.BackgroundRenderBucket=p})},"esri/views/3d/terrain/ElevationTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TerrainConst ./TileAgentBase ./UpsampleInfo".split(" "),function(p,h,d,a,g,f,k){return function(f){function e(){var a=null!==f&&f.apply(this,arguments)||this;a._scaleRangeEnabled=!1;return a}d(e,f);e.prototype.dataArrived=function(a){a!==this.tile?this._setUpsamplingTile(a):
(this._unsetUpsamplingTile(),this.updateGeometry());this._dataRequested=null;this._requestNext()};e.prototype.updateGeometry=function(){this._tileLayerInfo.pendingUpdates|=g.TileUpdateTypes.UPDATE_GEOMETRY;this.tile.updateGeometry()};e.prototype._findAncestorWithData=function(){for(var a=this.layerClass,d=this.layerIdx,e=this.tile,f=e.vlevel,h;e&&!(e.layerInfo[a][d].data&&(h=e,f-e.lij[0]>=g.ELEVATION_DESIRED_RESOLUTION_LEVEL));)e=e.parent;return h?(a=k.Pool.acquire(),a.init(h,0,0,1),a):null};e.prototype._desiredMinLevelDelta=
function(){return g.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-this.tile.lij[0])};e.prototype._setUpsamplingTile=function(a){this._unsetUpsamplingTile();var b=k.Pool.acquire();b.init(a,0,0,1);this._tileLayerInfo.upsampleFromTile=b;this.updateGeometry()};e.Pool=new a(e);return e}(f)})},"esri/views/3d/terrain/MapTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TileAgentBase ./tileUtils".split(" "),function(p,h,d,a,g,f){return function(g){function h(){var a=
g.call(this)||this;a._scaleRangeEnabled=!0;return a}d(h,g);h.prototype.dataArrived=function(a){a!==this.tile?this._setUpsamplingTile(a):(this._unsetUpsamplingTile(),this.tile.updateTexture());this._dataRequested=null;a!==this.tile&&this._requestNext()};h.prototype._desiredMinLevelDelta=function(){return 0};h.prototype._setUpsamplingTile=function(a){this._tileLayerInfo.upsampleFromTile&&this._tileLayerInfo.upsampleFromTile.tile===a||(this._unsetUpsamplingTile(),this._tileLayerInfo.upsampleFromTile=
f.computeUpsampleInfoForAncestor(this.tile,a),this.tile.updateTexture())};h.Pool=new a(h);return h}(g)})},"esri/views/3d/terrain/TileGeometryFactory":function(){define("require exports ../support/aaBoundingBox ../support/ArrayPool ../support/earthUtils ../support/mathUtils ./TerrainConst".split(" "),function(p,h,d,a,g,f,k){function m(a,c,b){for(var d=0;d<b.length;d++){var e=b[d];if(e){var g=e.safeWidth,h=e.width,l=e.pixelData,n=f.clamp(e.dy*(e.y1-c),0,g),e=f.clamp(e.dx*(a-e.x0),0,g),g=Math.floor(n),
m=Math.floor(e),q=g*h+m,r=q+h,p=l[q],h=l[r],q=l[q+1],l=l[r+1];if(p+h+q+l<.5*k.ELEVATION_NODATA_VALUE)return n-=g,e-=m,a=p+(q-p)*e,a+(h+(l-h)*e-a)*n}}return null}function e(a,c,b,d){var e=0<(b&2),f=c+(d?1024:0)+(e?2048:0),g=u[f];if(!g){var g=c-1,h=c-1,k=c*c,l=2*g+2*h,n=g*h*6,m=6*l,q=6*(2*g+h-1);d&&(n*=2,m*=2,q*=2);for(var l=65536<k+l?new Uint32Array(n+m):new Uint16Array(n+m),r=0,p=0,v=n,t,w,x,z,R=0,N=0;N<=h;N++){e&&(R=0===N?q:N===h?-q:0);for(var v=v+R,D=0;D<=g;D++)z=w=-1,0===N&&(w=k+D,D!==g&&(z=r+
1)),D===g&&(w=k+g+N,N<h&&(z=r+g+1)),N===h&&(w=k+g+h+(g-D),0<D&&(z=r-1)),0===D&&0<N&&(w=k+2*g+h+(h-N),z=r-(g+1)),-1<w&&(x=0===D&&1===N?k:w+1,-1<z&&(t=r,d?(l[v+0]=t,l[v+1]=w,l[v+2]=w,l[v+3]=x,l[v+4]=x,l[v+5]=t,l[v+6]=x,l[v+7]=z,l[v+8]=z,l[v+9]=t,l[v+10]=t,l[v+11]=x,v+=12):(l[v+0]=t,l[v+1]=w,l[v+2]=x,l[v+3]=x,l[v+4]=z,l[v+5]=t,v+=6))),++r,D<g&&N<h&&(t=N*(g+1)+D,w=t+1,x=w+(g+1),z=x-1,d?(l[p+0]=t,l[p+1]=w,l[p+2]=w,l[p+3]=x,l[p+4]=x,l[p+5]=t,l[p+6]=x,l[p+7]=z,l[p+8]=z,l[p+9]=t,l[p+10]=t,l[p+11]=x,p+=12):
(l[p+0]=t,l[p+1]=w,l[p+2]=x,l[p+3]=x,l[p+4]=z,l[p+5]=t,p+=6));v-=R}g={values:l,numSurfaceIndices:n,numSkirtIndices:m};u[f]=g}a.indices=g.values;a.numSurfaceIndices=g.numSurfaceIndices;a.numSkirtIndices=g.numSkirtIndices;a.numWithoutSkirtIndices=a.numSurfaceIndices+(b?6*(c-1)*(d?2:1):0)}function b(a,c,b,d){a<d[0]&&(d[0]=a);a>d[3]&&(d[3]=a);c<d[1]&&(d[1]=c);c>d[4]&&(d[4]=c);b<d[2]&&(d[2]=b);b>d[5]&&(d[5]=b)}function l(a,c,d,e,f){a*=g.earthRadius;for(var h=0;h<=c;h++)d[5*e]=0,d[5*e+1]=0,d[5*e+2]=a,b(0,
0,a,f),e++}Object.defineProperty(h,"__esModule",{value:!0});var t=new a.ArrayPool(Float32Array);h.releaseGeometry=function(a){t.put(a.vertexAttributes);a.vertexAttributes=null;a.indices=null};h.elevationSampler=m;h.createSphericalGlobeTile=function(a,c,h,k,p,u,B,E,C){var w=h[0],x=h[1],z=h[2],y=h[3],A=Math.max(.9,1-.5*(z-w));h=a-1;var K=a-1,L=a*a,M=t.get(5*(L+(2*h+2*K))),V=C.boundingBox;d.set(V,d.NEGATIVE_INFINITY);var S=c[2]-c[0],Z=c[3]-c[1],R=z-w,z=u[0],N=u[1];u=u[2];for(var D=0;D<=h;D++){var P=
D/h,O=w+P*R;r[D]=Math.sin(O);v[D]=Math.cos(O);q[D]=P;n[D]=c[0]+P*S}for(S=w=0;S<=K;S++){var R=S/K,D=f.lerp(x,y,R),O=Math.cos(D),Q=Math.sin(D),T=void 0;k?(T=g.earthRadius/2*Math.log((1+Q)/(1-Q)),R=(T-c[1])/Z):T=180*D/Math.PI;for(D=0;D<=h;D++){var P=q[D],da=r[D],U=v[D],aa=g.earthRadius;p&&(aa+=m(n[D],T,p)||0);var U=U*O*aa,da=da*O*aa,aa=Q*aa,X=U-z,ba=da-N,ea=aa-u;b(X,ba,ea,V);var W=5*w;M[W+0]=X;M[W+1]=ba;M[W+2]=ea;M[W+3]=P;M[W+4]=R;W=-1;0===S&&(W=L+D);D===h&&(W=L+h+S);S===K&&(W=L+h+K+(h-D));0===D&&0<
S&&(W=L+2*h+K+(K-S));-1<W&&(U=U*A-z,da=da*A-N,aa=aa*A-u,b(U,da,aa,V),W*=5,M[W+0]=U,M[W+1]=da,M[W+2]=aa,M[W+3]=P,M[W+4]=R);++w}}k&&(c=!!(B&2),B&1&&l(-1,h,M,L,V),c&&l(1,h,M,L+h+K,V));C.numVertsPerRow=a;C.vertexAttributes=M;e(C,a,k?B:0,E)};h.createPlanarGlobeTile=function(a,c,f,g,h,k,l){var n=c[0],q=c[1],r=c[2]-n;c=c[3]-q;var p=.1*r,v=a-1,u=a-1,w=a*a,x=t.get(5*(w+(2*v+2*u))),z=l.boundingBox;d.set(z,d.NEGATIVE_INFINITY);for(var y=0,A=0;A<=u;A++){var B=A/u,Z=q+B*c;k&&(Z<k[1]?(Z=k[1],B=(Z-q)/c):Z>k[3]&&
(Z=k[3],B=(Z-q)/c));for(var R=0;R<=v;R++){var N=R/v,D=n+N*r;k&&(D<k[0]?(D=k[0],N=(D-n)/r):D>k[2]&&(D=k[2],N=(D-n)/r));var P=f?m(D,Z,f)||0:0,D=D-g[0],O=Z-g[1],P=P-g[2];b(D,O,P,z);x[5*y]=D;x[5*y+1]=O;x[5*y+2]=P;x[5*y+3]=N;x[5*y+4]=B;var Q=-1;0===A&&(Q=w+R);R===v&&(Q=w+v+A);A===u&&(Q=w+v+u+(v-R));0===R&&0<A&&(Q=w+2*v+u+(u-A));-1<Q&&(x[5*Q]=D,x[5*Q+1]=O,x[5*Q+2]=P-p,x[5*Q+3]=N,x[5*Q+4]=B,b(D,O,P-p,z));++y}}l.numVertsPerRow=a;l.vertexAttributes=x;e(l,a,0,h)};var u=[],r=Array(k.MAX_TILE_TESSELATION+1),
v=Array(k.MAX_TILE_TESSELATION+1),q=Array(k.MAX_TILE_TESSELATION+1),n=Array(k.MAX_TILE_TESSELATION+1)})},"esri/views/3d/support/ArrayPool":function(){define(["require","exports"],function(p,h){Object.defineProperty(h,"__esModule",{value:!0});p=function(){function d(a,d){void 0===d&&(d=50);this.arrayConstructor=a;this.maxPoolSizePerCount=d;this.pool={}}d.prototype.get=function(a){var d=this.pool[a];d||(d={ptr:0,data:Array(this.maxPoolSizePerCount)},this.pool[a]=d);0<d.ptr?(a=d.data[--d.ptr],d.data[d.ptr]=
null):a=new this.arrayConstructor(a);return a};d.prototype.put=function(a){var d=this.pool[a.length];d.ptr<d.data.length&&(d.data[d.ptr++]=a)};return d}();h.ArrayPool=p})},"esri/views/3d/terrain/SphericalTile":function(){define("./TileBase ./TileGeometryFactory ../../../core/ObjectPool ../support/mathUtils ../support/earthUtils ../lib/glMatrix".split(" "),function(p,h,d,a,g,f){var k=f.vec3d,m=g.earthRadius,e=function(a,d,e,f){e=m+e;var b=Math.cos(a);f[0]=Math.cos(d)*b*e;f[1]=Math.sin(d)*b*e;f[2]=
Math.sin(a)*e};g=function(a,d,e,f){p.call(this);this.tileUp=k.create();this.obb=Array(8);this._isWebMercator=!1;for(var b=0;8>b;b++)this.obb[b]=k.create();void 0!==a&&this.init(a,d,e,f)};g.prototype=new p;g.prototype.constructor=g;g.prototype.init=function(b,d,f,g){p.prototype.init.call(this,b,d,f,g);this._isWebMercator=g.spatialReference.isWebMercator;d=this.extentWGS84Rad[0];f=this.extentWGS84Rad[1];g=this.extentWGS84Rad[2];var h=this.extentWGS84Rad[3];b=b[0];var l=a.lerp(f,h,.5),q=a.lerp(d,g,.5);
this.edgeLen=(g-d)*Math.cos(0===b?0:Math.min(Math.abs(f),Math.abs(h)))*m;this.curvatureHeight=m-Math.sqrt(m*m-this.edgeLen*this.edgeLen/4);e(l,q,0,this.centerAtSeaLevel);k.set(this.centerAtSeaLevel,this.tileUp);k.normalize(this.tileUp);this._updateOBB();this.updateRadiusAndCenter()};g.prototype.isVisible=function(a,d){if(!this.intersectsClippingArea)return!1;if(9<this.lij[0]){d=this.obb;for(var b=0;6>b;b++){for(var e=0;8>e&&!(0>a[b][0]*d[e][0]+a[b][1]*d[e][1]+a[b][2]*d[e][2]+a[b][3]);e++);if(8===
e)return!1}}else if(d=this.radius,b=this.center,a[0][0]*b[0]+a[0][1]*b[1]+a[0][2]*b[2]+a[0][3]>d||a[1][0]*b[0]+a[1][1]*b[1]+a[1][2]*b[2]+a[1][3]>d||a[2][0]*b[0]+a[2][1]*b[1]+a[2][2]*b[2]+a[2][3]>d||a[3][0]*b[0]+a[3][1]*b[1]+a[3][2]*b[2]+a[3][3]>d||a[4][0]*b[0]+a[4][1]*b[1]+a[4][2]*b[2]+a[4][3]>d||a[5][0]*b[0]+a[5][1]*b[1]+a[5][2]*b[2]+a[5][3]>d)return!1;return!0};g.prototype.computeElevationBounds=function(){p.prototype.computeElevationBounds.call(this);this._updateOBB()};g.prototype.updateRadiusAndCenter=
function(){if(0===this.lij[0])k.set3(0,0,0,this.center),this.radius=m+this.elevationBounds[1];else{p.prototype.updateRadiusAndCenter.call(this);var a=Math.max(k.dist2(this.center,this.obb[0]),k.dist2(this.center,this.obb[1]));this.radius=Math.sqrt(a)}};g.prototype._numSubdivisionsAtLevel=[128,64,32,16,16,8,8,4];g.prototype.createGeometry=function(a,d,e,f){var b=this._isPole(this.lij[1],this.lij[0]);a.needsUpdate=!1;return h.createSphericalGlobeTile(a.numVertsPerRow,this.extent,this.extentWGS84Rad,
this._isWebMercator,a.samplerData,d,b,e,f)};g.prototype._updateOBB=function(){var a=this.extentWGS84Rad,d=this.obb,f;for(f=0;2>f;f++){var g=this.elevationBounds[f],h=4*f;e(a[1],a[0],g,d[h++]);e(a[3],a[0],g,d[h++]);e(a[3],a[2],g,d[h++]);e(a[1],a[2],g,d[h++])}this._isWebMercator&&(a=this._isPole(this.lij[1],this.lij[0]),2===a?(k.set3(0,0,m,d[1]),k.set3(0,0,m,d[2]),k.set3(0,0,m,d[5]),k.set3(0,0,m,d[6])):1===a&&(k.set3(0,0,-m,d[0]),k.set3(0,0,-m,d[3]),k.set3(0,0,-m,d[4]),k.set3(0,0,-m,d[7])))};g.prototype._isPole=
function(a,d){var b=0;a===(1<<d)-1&&(b+=1);0===a&&(b+=2);return b};g.Pool=new d(g);return g})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/arrayUtils ../../../core/Handles ../../../core/accessorSupport/decorators ../../../geometry/support/webMercatorUtils ../../../views/3d/support/aaBoundingRect ./TerrainConst ./terrainUtils".split(" "),function(p,
h,d,a,g,f,k,m,e,b,l,t){function u(a,b){a&&!a.spatialReference.equals(b)&&(a=e.canProject(a.spatialReference,b)?e.project(a,b):null);return a}Object.defineProperty(h,"__esModule",{value:!0});p=function(b){function e(a){a=b.call(this,a)||this;a._changeListeners=new k;return a}d(e,b);e.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layerViews.on("change",function(){return a.notifyChange("stencilEnabledExtents")})])};e.prototype.destroy=function(){this._changeListeners.destroy();
this._changeListeners=null};Object.defineProperty(e.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,
"spatialReference",{set:function(a){this.tilingScheme||this._set("spatialReference",a)},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"tilingScheme",{set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)},enumerable:!0,configurable:!0});e.prototype._computeStencilEnabledExtents=function(a,b){var d=[],c=0;for(a=a.items;c<a.length;c++){var e=a[c].layer;"IntegratedMeshLayer"===e.operationalLayerType&&null!=b&&(e=u(e.fullExtent,b),null!=e&&d.push([e.xmin,
e.ymin,e.xmax,e.ymax]))}return d};a([m.property({readOnly:!0})],e.prototype,"layerViewsExtent",null);a([m.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],e.prototype,"tiledLayersExtent",null);a([m.property({readOnly:!0,dependsOn:["spatialReference"]})],e.prototype,"stencilEnabledExtents",null);a([m.property()],e.prototype,"spatialReference",null);a([m.property()],e.prototype,"tilingScheme",null);a([m.property()],e.prototype,"defaultTiledLayersExtent",void 0);a([m.property({constructOnly:!0})],
e.prototype,"layers",void 0);a([m.property({constructOnly:!0})],e.prototype,"layerViews",void 0);return e=a([m.subclass()],e)}(m.declared(g));g=function(b){function e(){return null!==b&&b.apply(this,arguments)||this}d(e,b);e.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()};e.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()};e.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?l.WEBMERCATOR_WORLD_EXTENT:l.GEOGRAPHIC_WORLD_EXTENT};
a([m.property({dependsOn:["spatialReference"]})],e.prototype,"layerViewsExtent",void 0);return e=a([m.subclass()],e)}(m.declared(p));h.SurfaceExtentHelperGlobal=g;p=function(e){function g(){return null!==e&&e.apply(this,arguments)||this}d(g,e);g.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layers.on("change",function(){return a.notifyChange("tiledLayersExtent")}),this.layerViews.on("change",function(){return a.notifyChange("layerViewsExtent")})])};g.prototype._computeLayerViewsExtent=
function(){var a=b.create(b.NEGATIVE_INFINITY),d=this.spatialReference;this.layerViews.forEach(function(c){c.isResolved()&&(c=c.fullExtentInViewSpatialReference||c.layer.fullExtent,(c=u(c,d))&&b.expand(a,c))});var e=b.allFinite(a)?a:null,c=this._get("layerViewsExtent");return f.equals(e,c)?c:e};g.prototype._computeTiledLayersExtent=function(){var a=this.tilingScheme;if(!a)return null;var d=this.spatialReference,e=b.create(b.NEGATIVE_INFINITY);this.layers.forEach(function(c){if(c.loaded&&t.isTiledLayer(c)){var f=
t.getTiledLayerInfo(c,d,"local");c=f.tileInfo;f=f.fullExtent;c&&a.compatibleWith(c)&&f&&f.spatialReference.equals(d)&&b.expand(e,f)}});this.defaultTiledLayersExtent&&b.expand(e,this.defaultTiledLayersExtent);var c=b.allFinite(e)?e:null,g=this._get("tiledLayersExtent");return f.equals(c,g)?g:c};return g=a([m.subclass()],g)}(m.declared(p));h.SurfaceExtentHelperLocal=p})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ./terrainUtils ./TilingScheme".split(" "),
function(p,h,d,a,g,f,k,m,e){return function(b){function g(a){a=b.call(this,a)||this;a._changeHandles=new f;return a}d(g,b);g.prototype.initialize=function(){var a=this;this._changeHandles.add(this.layers.on("change",function(){return a._update()}));this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",function(){return a._setAdHocTilingScheme()}));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};g.prototype.destroy=function(){this._changeHandles.destroy();this._changeHandles=
null};g.prototype._update=function(){var a=this;this._waitTask=null;if(!this.tilingSchemeLocked){this._set("tilingSchemeDone",!1);var b=this.layers.find(function(b){return m.isTiledLayer(b)?b.isFulfilled()?b.isRejected()?!1:!!m.getTiledLayerInfo(b,a.viewSpatialReference,a.manifold).tileInfo:!0:!1});if(b)if(b.isResolved()){var d=m.getTiledLayerInfo(b,this.viewSpatialReference,this.manifold).tileInfo,d=new e(d),b=m.getKnownTiledServiceLevelCap(b.url);Infinity>b&&d.capMaxLod(b);this._set("tilingSchemeDone",
!0);this._lockTilingScheme(d)}else this._updateWhen(b);else this._set("tilingSchemeDone",!0)}};g.prototype._updateWhen=function(a){var b=this,d=a.when().always(function(){d===b._waitTask&&b._update()});this._waitTask=d};g.prototype._lockTilingScheme=function(a){var b=this;if("spherical"===this.manifold){var d=a.levels.length-1;a=a.spatialReference.isWebMercator?e.makeWebMercatorAuxiliarySphere(d):e.makeWGS84WithTileSize(a.pixelSize[0],d)}this.tilingSchemeLocked=!0;this.tilingScheme=a;this.extentHelper.tilingScheme=
this.tilingScheme;this._updateTiledLayerExtent();this._changeHandles.removeAll();this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",function(){return b._updateTiledLayerExtent()}))};g.prototype._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent};g.prototype._setAdHocTilingScheme=function(){if("spherical"===this.manifold)this.tilingScheme=this.extentHelper.spatialReference.isWebMercator?e.WebMercatorAuxiliarySphere:e.makeWGS84WithTileSize(256),this.extent=
this.extentHelper.layerViewsExtent;else{var a=this.extentHelper.layerViewsExtent;a&&(this.tilingScheme=e.fromExtent(a,this.extentHelper.spatialReference),this.extent=a)}};a([k.property()],g.prototype,"tilingScheme",void 0);a([k.property()],g.prototype,"extent",void 0);a([k.property({value:!1})],g.prototype,"tilingSchemeLocked",void 0);a([k.property({readOnly:!0,value:!1})],g.prototype,"tilingSchemeDone",void 0);a([k.property({constructOnly:!0})],g.prototype,"viewSpatialReference",void 0);a([k.property({constructOnly:!0})],
g.prototype,"layers",void 0);a([k.property({constructOnly:!0})],g.prototype,"extentHelper",void 0);a([k.property({constructOnly:!0})],g.prototype,"manifold",void 0);return g=a([k.subclass()],g)}(k.declared(g))})},"esri/views/3d/terrain/TerrainRenderer":function(){define("dojo/when ./tileUtils ./TerrainConst ./TileGeometryFactory ./TileRenderData ./ResourceCounter ./TileRenderer ../support/PreallocArray ../../../core/ObjectPool ../../../core/promiseUtils ../support/imageUtils ../webgl-engine/lib/ShaderVariations dojo/text!./TerrainMaterial.xml ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/lib/Util ../webgl-engine/lib/Geometry ../webgl-engine/lib/GeometryData ../lib/glMatrix ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/tracer ../../webgl/VertexArrayObject ../../webgl/BufferObject ../../webgl/Program ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/glUtil3D ../../webgl/Util".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x,z,A,y,B,E,C,G,J,F){var I=v.assert;v=w.vec2d;var H=w.vec3d,K=w.vec4d,L=w.mat4d.identity(),M=[2,2],V=x.OPAQUE_TERRAIN,S=x.TRANSPARENT_TERRAIN,Z=H.create(),R=v.create();w=function(n,q,v){function w(a,c){a=a.screenDepth;c=c.screenDepth;return a<c?-Y:a>c?Y:0}function x(a,c){return 0===a.tiles.length?-Y:0===c.tiles.length?Y:w(a.tiles.data[0],c.tiles.data[0])}q=q||256;var D,P=!1,O=null,X=null,ba=null,ea={},W,ca,ka=new e(g),ga=new m(10,function(){return{root:null,
tiles:new m(300)}}),ia=!0,ha=new h.IteratorPreorder,ja=null,qa=!0,ma=1,ra=!0,oa=!1,fa={mode:"none",width:1.5,falloff:1.5,wireOpacity:1,surfaceOpacity:0,color:[1,1,1,0],resolution:64},pa=!1,va=!1,la=!1,Y=1,Aa=!0,Ba=!0,ua=null,na=null,sa=null,ya=!1,Ca=[];this.updateTileBackground=function(a){sa&&sa.cancel();sa=a?l.requestImage(a).catch(function(){return null}):b.resolve(null);this.renderTileBackground();return sa};var Da=0,wa=0,Ea=0,Fa=0;this.resourceCounter=new f;this.castShadows=!0;this.clippingExtent=
null;this.loaded=function(){};var Ha=!1;this.needsRender=!0;this.receiveShadows=this.needsHighlight=this.didRender=!1;var ta=new m(10),xa=0,za=new m(30),Ia=new e(function(){this.extent=K.create();this.maxLevel=this.minLevel=0;this.callback=null},!1);this.renderTileBackground=function(){if(W&&sa&&na)return sa.then(function(a){na&&(ya=!0,na.setGridImage(a),O&&h.traverseTilesPreorder(O,function(a){na.updateTileTexture(a)}.bind(this)))}.bind(this))};this.initializeRenderContext=function(a){W=a.rctx;ca=
a.rctx.gl;var c=function(a){p(a).then(function(){P=!0;this.setNeedsRender()}.bind(this)).catch(c)}.bind(this);c(this.renderTileBackground());D=a.textureRep;var b=a.shaderSnippets;a=a.programRep;b.vsTerrain||b._parse(u);var d=new t("terrain",["vsTerrain","fsTerrain"],null,a,b,W);d.addDefine("Spherical","SPHERICAL");d.addDefine("Overlay","OVERLAY");d.addDefine("Atmosphere","ATMOSPHERE");d.addDefine("Wireframe","WIREFRAME");d.addDefine("TileBorders","TILE_BORDERS");d.addBinaryShaderSnippetSuffix("Wireframe",
"Wireframe",[!1,!0]);d.addDefine("ReceiveShadows","RECEIVE_SHADOWS");d.addDefine("ScreenSizePerspective","SCREEN_SIZE_PERSPECTIVE");var e=new t("terrainNormal",["vsTerrainNormal","fsNormal"],null,a,b,W);e.addDefine("Spherical","SPHERICAL");e.addDefine("AlphaZero","ALPHA_ZERO");ba={depth:a.get("depth"),depthShadowMap:a.get("depthShadowMap"),depthOnly:new B(W,b.vsTerrainDepthOnly,b.fsTerrainDepthOnly,E.Default3D),highlight:new B(W,b.vsTerrainHighlight,b.fsTerrainHighlight,E.Default3D)};X={color:d,normal:e};
this._updatePrograms();na=new k(W,q,a,this.resourceCounter,this.setNeedsRender.bind(this));this.renderTileBackground();ua=J.createEmptyTexture(W)};this.uninitializeRenderContext=function(a){null!=ua&&(ua.dispose(),ua=null);na&&(na.dispose(),na=null)};this._updatePrograms=function(){var a="spherical"===n,c="shader"===fa.mode;ba.color=X.color.getProgram([a,!0,a&&Ba,c,pa,c||pa,this.receiveShadows,oa]);ba.normal=X.normal.getProgram([a,!0]);this.setNeedsRender()};this.destroy=function(a){this.uninstall(a);
sa&&(sa.cancel(),sa=null)};this.install=function(a){a.addExternalRenderer([V,S],this)};this.uninstall=function(a){a.removeExternalRenderer(this)};this.setRootTiles=function(a){O=a;this.setNeedsRender()};this.setNeedsHighlight=function(a){this.needsHighlight=a;this.setNeedsRender()};this.setStencilEnabledLayerExtents=function(a){Ca=a;this.setNeedsRender()};this.setTileSize=function(a){q=a;na&&(na.tileSize=a);this.setNeedsRender()};this.loadTile=function(a){I(null===a.renderData);a.renderData=ka.acquire();
a.renderData.init();var c=this.getLocalOriginOfTile(a);a.createGeometry(a.renderData.updateGeometryState(a),c,"debug"===fa.mode,a.renderData.geometryInfo);a.renderData.localOrigin=c;this._updateTileGeometryBuffers(a);ya&&na.updateTileTexture(a)};this.queryVisibleLevelRange=function(a,c,b,d){var e=Ia.acquire();K.set(a,e.extent);e.minLevel=c?c:-Number.MAX_VALUE;e.maxLevel=null!=b?b:Number.MAX_VALUE;e.callback=d;za.push(e);this.setNeedsRender()};this.updateTileTexture=function(a){na&&ya&&na.updateTileTexture(a)};
this.updateTileGeometryNeedsUpdate=function(a){return a.renderData.updateGeometryState(a).needsUpdate};this._updateTileGeometry=function(a){for(var c=a.renderData.geometryState,b=a.layerInfo[d.LayerClass.ELEVATION],e=0;e<b.length;e++)b[e].pendingUpdates&=~d.TileUpdateTypes.UPDATE_GEOMETRY;return c.needsUpdate?(a.renderData.vao&&this._releaseTileGeometry(a),a.createGeometry(c,a.renderData.localOrigin,"debug"===fa.mode,a.renderData.geometryInfo),this._updateTileGeometryBuffers(a),!0):!1};this.updateTileGeometry=
function(a){a.renderData.updateGeometryState(a);return this._updateTileGeometry(a)};this.unloadTile=function(a){this._releaseTileGeometry(a);a.renderData.texture&&a.renderData.texture.dispose();ka.release(a.renderData);a.renderData=null};this.getLocalOriginOfTile=function(a){if(10<=a.lij[0]){for(;7<a.lij[0];)a=a.parent;return a.centerAtSeaLevel}if("spherical"===n)return Z;for(;a.parent;)a=a.parent;return a.centerAtSeaLevel};this.setVisibility=function(a){qa=a;this.setNeedsRender()};this.getStats=
function(){return{numTilesRendered:wa,numTilesCulled:Ea,numTrianglesRendered:Da,numOriginsRendered:Fa}};this.setDisableRendering=function(a){va=!!a;this.setNeedsRender()};this.getOpacity=function(){return ma};this.getWireframeEnabled=function(){return"shader"===fa.mode};this.setDebugScreenSizePerspective=function(a){a!==oa&&(oa=a,this._updatePrograms())};this.setWireframe=function(a){a&&!0!==a||(a={mode:a?"shader":"none"});if(void 0!==a.mode&&fa.mode!==a.mode){var c="debug"===fa.mode,b="debug"===
a.mode;fa.mode=a.mode;this._updatePrograms();c!==b&&O&&h.traverseTilesPreorder(O,function(a){a.renderData&&(a.renderData.vao&&this._releaseTileGeometry(a),a.createGeometry(a.renderData.updateGeometryState(a),a.renderData.localOrigin,b,a.renderData.geometryInfo),this._updateTileGeometryBuffers(a))}.bind(this))}for(var d in a)fa.hasOwnProperty(d)&&(fa[d]=a[d]),this.setNeedsRender();fa.resolution&&(fa.resolution=Math.min(fa.resolution,q),fa.resolution=1<<Math.round(Math.log(fa.resolution)/Math.LN2))};
this.setOpacity=function(a){ma=a;this.setNeedsRender()};this.setDrawSkirts=function(a){ra=a;this.setNeedsRender()};this.setCullBackFaces=function(a){la=a;this.setNeedsRender()};this.setRenderOrder=function(a){Y=a;this.setNeedsRender()};this.setBorders=function(a){pa!==a&&(pa=a,this._updatePrograms())};this.setFrontMostTransparent=function(a){Aa!==a&&(Aa=a,this.setNeedsRender())};this.setVelvetOverground=function(a){Ba!==a&&(Ba=a,this._updatePrograms())};this.setNeedsRender=function(){this.needsRender=
!0;this.didRender=!1;ia=!0};this.resetNeedsRender=function(){this.didRender&&(this.needsRender=0!==za.length,this.didRender=!1)};var Ga=H.create();this.isTransparent=function(){return 1>ma||"shader"===fa.mode&&(1>fa.wireOpacity||1>fa.surfaceOpacity)};this._renderMaterialPass=function(a,c){var b=this.isTransparent(),d=a.shadowMap&&a.shadowMap.getEnableState();this.receiveShadows!=d&&(this.receiveShadows=d,this._updatePrograms());d=a.camera;W.setDepthTestEnabled(!0);W.setBlendingEnabled(b);b&&W.setBlendFunctionSeparate(ca.SRC_ALPHA,
ca.ONE_MINUS_SRC_ALPHA,ca.ONE,ca.ONE_MINUS_SRC_ALPHA);b&&Aa?(b=ba.depthOnly,W.bindProgram(b),W.setColorMask(!1,!1,!1,!1),W.setDepthWriteEnabled(!0),this._renderTilesAuxiliary(a,b,c),W.setColorMask(!0,!0,!0,!0),W.setDepthFunction(ca.EQUAL),W.setDepthWriteEnabled(!1)):W.setDepthFunction(ca.LESS);b=ba.color;W.bindProgram(b);b.setUniform1f("opacity",ma);if("shader"===fa.mode||pa)b.setUniform1f("wireframe.width",fa.width),b.setUniform1f("wireframe.falloff",Math.min(fa.width,fa.falloff)),b.setUniform1f("wireframe.wireOpacity",
fa.wireOpacity*ma),b.setUniform1f("wireframe.surfaceOpacity",fa.surfaceOpacity*ma),b.setUniform4fv("wireframe.color",fa.color);d=a.camera;a.shadowMap&&a.shadowMap.bind(b);a.ssaoHelper&&a.ssaoHelper.setUniforms(b);b.setUniform1i("tex",4);b.setUniform1i("overlayTex",5);b.setUniformMatrix4fv("viewNormal",d.viewInverseTransposeMatrix);b.setUniformMatrix4fv("proj",d.projectionMatrix);a.lightingData.helper.setUniforms(b,!0);d=d.viewMatrix;H.set3(d[12],d[13],d[14],Ga);H.normalize(Ga);b.setUniform3fv("viewDirection",
Ga);for(Fa=Da=Ea=wa=0;ta.length<ta.data.length&&0<za.length;)d=za.pop(),ta.push(d);xa=ta.length;this._renderTiles(a,b,c);W.setBlendingEnabled(!1);W.setDepthFunction(ca.LESS);W.setDepthWriteEnabled(!0);for(a=0;a<ta.length;a++)c=ta.data[a],Ia.release(c),c.callback(a>=xa),c.callback=null;ta.clear();0<wa&&!Ha&&(Ha=!0,this.loaded&&this.loaded())};this._renderDepthPass=function(a,c,b){var d=a.camera;W.bindProgram(c);W.setBlendingEnabled(!1);W.setDepthTestEnabled(!0);W.setDepthFunction(ca.LESS);c.setUniformMatrix4fv("model",
L);c.setUniformMatrix4fv("viewNormal",d.viewInverseTransposeMatrix);R[0]=d.near;R[1]=d.far;c.setUniform2fv("nearFar",R);this._renderTilesAuxiliary(a,c,b)};this._renderNormalPass=function(a,c){var b=a.camera,d=ba.normal;W.bindProgram(d);W.setBlendingEnabled(!1);W.setDepthTestEnabled(!0);W.setDepthFunction(ca.LESS);d.setUniformMatrix4fv("viewNormal",b.viewInverseTransposeMatrix);this._renderTilesAuxiliary(a,d,c)};this._renderHighlightPass=function(a,c){var b=ba.highlight;W.bindProgram(b);W.setBlendingEnabled(!1);
W.setDepthTestEnabled(!0);W.setDepthFunction(ca.LESS);var d=a.offscreenRenderingHelper;W.bindTexture(d.getDepthTexture(),6);b.setUniform1i("depthTex",6);b.setUniform4f("highlightViewportPixelSz",0,0,1/d.width,1/d.height);this._renderTilesAuxiliary(a,b,c,!0)};this.render=function(a){if(P&&!va&&qa&&O&&ya){var b=this.isTransparent()?S:V;if(a.slot===b){z.trace("# BEGIN RENDER TERRAIN");b=a.pass;W.setFaceCullingEnabled(la);var d=1===a.lightingData.helper.globalFactor;b===c.MATERIAL?this._renderMaterialPass(a,
this._updatePerOriginTileData()):b===c.MATERIAL_DEPTH_SHADOWMAP&&this.castShadows&&d?this._renderDepthPass(a,ba.depthShadowMap,this._updatePerOriginTileData()):b===c.MATERIAL_DEPTH?this._renderDepthPass(a,ba.depth,this._updatePerOriginTileData()):b===c.MATERIAL_NORMAL?this._renderNormalPass(a,this._updatePerOriginTileData()):b===c.MATERIAL_HIGHLIGHT&&this.needsHighlight&&(this._renderHighlightPass(a,this._updatePerOriginTileData()),W.clear(W.gl.DEPTH_BUFFER_BIT));la&&W.setFaceCullingEnabled(!1);z.trace("# END RENDER TERRAIN");
return!0}}};this._updatePerOriginTileData=function(){if(!ia)return ga;ja=null;this._renderCollectOrigins();if(0!==Y){for(var a=0;a<ga.length;a++)this._sortFrontToBack(ga.data[a].tiles,w);this._sortFrontToBack(ga,x)}ia=!1;return ga};this._renderCollectOrigins=function(){ga.clear();for(var a=0;a<O.length;a++){var c=O[a],b=ga.next();b.root=c;b.origin="spherical"===n?Z:c.centerAtSeaLevel;b.tiles.clear();this._renderCollectOriginsForRoot(b)}return!0};this._renderCollectOriginsForRoot=function(a){for(ha.reset(a.root);!ha.done;){var c=
ha.next(),b=c.renderData;if(b&&!c.visible)Ea++,ha.skip();else{var d=ga.peek();if(7===c.lij[0]){if(d===a||0!==d.tiles.length)d=ga.next(),d.tiles.clear();d.root=c;d.origin=c.centerAtSeaLevel}if(b){10<=c.lij[0]?ga.peek().tiles.push(c):a.tiles.push(c);if(!ja||c.vlevel>ja.vlevel)ja=c;ha.skip()}}}};this._sortFrontToBack=function(a,c){a.sort(c)};this._updateStencilReadStateForTile=function(a,c){if(a.stencilRenderingHelper&&a.stencilRenderingHelper.getEnableState()){for(var b=!1,d=0;d<Ca.length;d++)if(c.intersectsExtent(Ca[d])){b=
!0;break}b?a.stencilRenderingHelper.enableStencilRead():a.stencilRenderingHelper.disableStencilRead()}};this._renderTilesAuxiliary=function(a,c,b,d){var e=a.camera,f=e.viewMatrix,g=a.rctx;c.setUniformMatrix4fv("proj",e.projectionMatrix);d&&c.setUniform1i("overlayTex",5);for(e=0;e<b.length;e++){var h=b.data[e];c.setUniform3fv("origin",h.origin);r.bindView(h.origin,f,c);for(var k=0;k<h.tiles.length;k++){var l=h.tiles.data[k],n=l.renderData;d&&(n.highlightOverlayTexId?Ja(c,n,n.highlightOverlayTexId):
g.bindTexture(ua,5));this._updateStencilReadStateForTile(a,l);g.bindVAO(n.vao);F.assertCompatibleVertexAttributeLocations(n.vao,c);l=n.vao.indexBuffer.size;ra||(l=n.geometryInfo.numWithoutSkirtIndices);g.drawElements(ca.TRIANGLES,l,n.vao.indexBuffer.indexType,0)}}g.bindVAO(null);g.stencilRenderingHelper&&g.stencilRenderingHelper.disableStencilRead()};this._renderTiles=function(a,c,b){var d=a.camera.viewMatrix;if(oa){var e=G.getSettings(n);e.update({distance:v.distanceToSurface,fovY:v.fovY});r.bindScreenSizePerspective(e,
c,"screenSizePerspective")}for(e=0;e<b.length;e++){var f=b.data[e];c.setUniform3fv("origin",f.origin);r.bindView(f.origin,d,c);a.shadowMap&&a.shadowMap.bindView(c,f.origin);Fa++;var g=f.tiles;if(0!==g.length){var h=ca.TRIANGLES;"debug"===fa.mode&&(h=ca.LINES);var k=ja,l;k?(k=k.vlevel,l=q/fa.resolution):(k=16,l=q/64);for(var m=0;m<g.length;m++){var p=g.data[m],f=p.renderData;this._updateStencilReadStateForTile(a,p);z.trace("# RENDER TILE "+p.lij[0]+"/"+p.lij[1]+"/"+p.lij[2]+", screenDepth:"+p.screenDepth);
c.setUniform2fv("texOffset",f.texOffset);c.setUniform1f("texScale",f.texScale);W.bindTexture(f.textureReference||f.texture,4);f.overlayTexId?Ja(c,f,f.overlayTexId):(c.setUniform2fv("overlayTexOffset",M),W.bindTexture(ua,5));("shader"===fa.mode||pa)&&c.setUniform1f("wireframe.subdivision",l*(1<<k-p.vlevel));var u=f.vao.indexBuffer.size;ra||(u=f.geometryInfo.numWithoutSkirtIndices);W.bindVAO(f.vao);F.assertCompatibleVertexAttributeLocations(f.vao,c);W.drawElements(h,u,f.vao.indexBuffer.indexType,0);
p.renderOrder=wa;wa++;Da+=u/3;f=p.extent;p=p.lij[0];for(u=0;u<xa;){var t=ta.data[u],w=t.extent;p>=t.minLevel&&p<=t.maxLevel&&w[0]<=f[2]&&w[2]>=f[0]&&w[1]<=f[3]&&w[3]>=f[1]?(ta.swap(u,xa-1),xa--):u++}}}}W.bindVAO(null);a.stencilRenderingHelper&&a.stencilRenderingHelper.disableStencilRead()};var Ja=function(a,c,b){var d=ea[b];d||(d=D.aquire(b).getGLTexture(),I(d),ea[b]=d);a.setUniform2fv("overlayTexOffset",c.overlayTexOffset);a.setUniform2fv("overlayTexScale",c.overlayTexScale);a.setUniform1f("overlayOpacity",
c.overlayOpacity);W.bindTexture(d,5)},Ka=H.create(),La=H.create(),Ma=H.create(),Na=this.clippingExtent;this.intersect=function(a,c,b){if(O&&(!a.isSelection||!this.isTransparent())&&a.enableTerrain){H.subtract(b,c,Ka);var d=a.getMinResult(),e=a.getMaxResult();ha.reset(O);for(var f={};!ha.done;){var g=ha.next();if(null!==g.renderData){if(a.enableInvisibleTerrain){if(!g.visible&&Na&&!g.intersectsExtent(Na))continue}else if(!g.visible)continue;var k=g.renderData.geometryInfo;N.getData().getAttribute("terrain").data=
k.vertexAttributes;N.getData()._indices.terrain=k.indices;var l=k.boundingBox;H.set3(l[0],l[1],l[2],N.boundingInfo.bbMin);H.set3(l[3],l[4],l[5],N.boundingInfo.bbMax);N.boundingInfo.indices=k.indices;N.boundingInfo.positionData=N.getData().getAttribute("terrain");k=g.renderData.localOrigin;H.subtract(c,k,La);H.subtract(b,k,Ma);r.intersectTriangleGeometry(N,f,void 0,a,La,Ma,function(c,b,f){if((ra||!(3*f>=g.renderData.geometryInfo.numWithoutSkirtIndices))&&0<=c&&(a.enableBackfacesTerrain||0>H.dot(b,
Ka))){if(void 0===d.dist||c<d.dist)f=h.lij2str(g.lij[0],g.lij[1],g.lij[2]),d.set(void 0,f,c,b,void 0),d.setIntersector("terrain");if(void 0===e.dist||c>e.dist)f=h.lij2str(g.lij[0],g.lij[1],g.lij[2]),e.set(void 0,f,c,b,void 0),e.setIntersector("terrain")}})}}}};this._updateTileGeometryBuffers=function(a){a=a.renderData;var c=a.geometryInfo.indices;a.vao=new A(W,E.Default3D,{geometry:C.Pos3Tex},{geometry:y.createVertex(W,ca.STATIC_DRAW,a.geometryInfo.vertexAttributes)},y.createIndex(W,ca.STATIC_DRAW,
c));this.setNeedsRender()};this._releaseTileGeometry=function(c){c=c.renderData;c.vao.dispose(!0);c.vao=null;a.releaseGeometry(c.geometryInfo);this.setNeedsRender()}};n=new n({terrain:{data:null,size:5}},{terrain:null});var N=new q(n,"tmpTerrainGeometry",{bbMin:H.create(),bbMax:H.create(),indices:null,positionData:null,getBBMin:function(){return this.bbMin},getBBMax:function(){return this.bbMax},getPrimitiveIndices:function(){},getChildren:function(){},getIndices:function(){return this.indices},getPosition:function(){return this.positionData}});
w.TileRenderData=g;return w})},"esri/views/3d/terrain/TileRenderData":function(){define(["require","exports","../lib/glMatrix","../support/aaBoundingBox"],function(p,h,d,a){var g=d.vec2d;return function(){function d(){this.overlayTexOffset=g.create();this.texOffset=g.create();this.geometryInfo={indices:null,vertexAttributes:null,boundingBox:a.create(a.NEGATIVE_INFINITY),numSurfaceIndices:0,numSkirtIndices:0,numWithoutSkirtIndices:0,numVertsPerRow:0};this.init()}d.prototype.init=function(){var d=this.geometryInfo;
d.indices=null;d.vertexAttributes=null;a.set(d.boundingBox,a.NEGATIVE_INFINITY);d.numSurfaceIndices=0;d.numSkirtIndices=0;d.numWithoutSkirtIndices=0;d.numVertsPerRow=0;this.textureReference=this.texture=this.vao=this.geometryState=null;g.set2(0,0,this.texOffset);this.texScale=1;this.highlightOverlayTexId=this.overlayTexId=null;this.overlayTexScale=[1,1];this.overlayOpacity=1;this.localOrigin=null};d.prototype.updateGeometryState=function(a){return this.geometryState=a.geometryState(this.geometryState)};
d.prototype.estimateGeometryMemoryUsage=function(){var a=this.geometryInfo;return a.indices.byteLength+a.vertexAttributes.byteLength};return d}()})},"esri/views/3d/terrain/ResourceCounter":function(){define(["require","exports"],function(p,h){return function(){function d(){this._numTileTexturesComposited=0}Object.defineProperty(d.prototype,"numTileTexturesComposited",{get:function(){return this._numTileTexturesComposited},enumerable:!0,configurable:!0});d.prototype.incrementNumTileTexturesComposited=
function(){this._numTileTexturesComposited++};d.prototype.resetNumTileTexturesComposited=function(){this._numTileTexturesComposited=0};return d}()})},"esri/views/3d/terrain/TileRenderer":function(){define("require exports ../lib/glMatrix ./TerrainConst ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../../vectorTiles/tileRendererHelper3D ../../vectorTiles/VectorTileDisplayObject ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u){var r=d.vec2d,v=Array(20),q=[0,0];return function(){function d(a,c,b,d,h){this._gridTex=null;this.tileSize=256;this._context=a;this.tileSize=c;this._resourceCounter=d;this._setNeedsRender=h;a.capabilities.textureFilterAnisotropic&&(this._maxAnisotropy=Math.min(8,a.parameters.maxMaxAnisotropy));c=new Float32Array(20);c[0]=-1;c[1]=-1;c[2]=0;c[3]=0;c[4]=0;c[5]=1;c[6]=-1;c[7]=0;c[8]=1;c[9]=0;c[10]=-1;c[11]=1;c[12]=0;c[13]=0;c[14]=1;c[15]=1;c[16]=1;c[17]=0;c[18]=1;c[19]=
1;this._vaoQuad=new u(a,g.Default3D,{geometry:f.Pos3Tex},{geometry:e.createVertex(a,35044,c)});this._blendLayersProgram=b.get("blendLayers")}d.prototype.dispose=function(){this._fbo&&(this._fbo.dispose(),this._fbo=null);this._vaoQuad&&(this._vaoQuad.dispose(),this._vaoQuad=null);this._gridTex&&(this._gridTex.dispose(),this._gridTex=null);this._blendLayersProgram&&(this._blendLayersProgram.dispose(),this._blendLayersProgram=null);this._context&&(this._context=null)};d.prototype.updateTileTexture=function(b){for(var c=
a.LayerClass.MAP,d=b.layerInfo[c],e=0;e<d.length;e++)d[e].pendingUpdates&=~a.TileUpdateTypes.UPDATE_TEXTURE;if(b.renderData){var f,e=b.renderData,g,h=0,k=!0;for(g=0;g<d.length;g++){f=d[g];var l=b.parentSurface.layerViewByIndex(g,c);v[g]=l.fullOpacity;if(f.data||f.upsampleFromTile)if(h++,!l.isTransparent){k=!1;break}}g===d.length&&g--;0===h&&this._gridTex?(e.textureReference=this._gridTex,r.set2(0,0,e.texOffset),e.texScale=1):1!==h||k?(this._composeMapLayers(b,d,g,k,v),e.textureReference=null,r.set2(0,
0,e.texOffset),e.texScale=1):(f=d[g],f.data?(c=f,r.set2(0,0,e.texOffset),e.texScale=1):(b=f.upsampleFromTile,c=b.tile.layerInfo[c][g],r.set(b.offset,e.texOffset),e.texScale=b.scale),c&&(c.data instanceof HTMLImageElement&&(c.data=this._buildTexture(c.data)),e.textureReference=c.data));this._setNeedsRender()}};d.prototype.setGridImage=function(a){this._gridTex=this._buildTexture(a)};d.prototype._buildTexture=function(a){var c={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,
maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},b=this._context,d;if(a)try{d=new l(b,c,a)}catch(A){c.width=c.height=this.tileSize,d=new l(b,c),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}else c.width=c.height=this.tileSize,d=new l(b,c);b.bindTexture(d);d.generateMipmap();return d};d.prototype._drawVectorData=function(a,c,b,d,e,f,g,h,l){void 0===l&&(l=1);k(this._context,b,a,c.renderer,c.schemeHelper,b[0],d,e,0,f,g,h,l)};d.prototype._drawRasterData=
function(a,c,b,d){void 0===d&&(d=1);var e=this._context,f=this._blendLayersProgram,g=this._vaoQuad;e.bindProgram(f);e.bindVAO(g);t.assertCompatibleVertexAttributeLocations(g,f);e.bindTexture(a,0);f.setUniform1i("tex",0);f.setUniform1f("scale",c);f.setUniform2f("offset",b[0],b[1]);f.setUniform1f("opacity",d);e.drawArrays(5,0,t.vertexCount(g,"geometry"))};d.prototype._composeMapLayers=function(d,c,e,f,g){var h=a.LayerClass.MAP,k=this._context;d.renderData.texture||(d.renderData.texture=this._buildTexture());
var l=d.renderData.texture,n=this._fbo;n&&n.width===l.descriptor.width&&n.height===l.descriptor.height||(this._fbo=n=b.create(k,{colorTarget:0,depthStencilTarget:1,width:l.descriptor.width,height:l.descriptor.height}));var r=k.gl;k.bindFramebuffer(n);k.setViewport(0,0,this.tileSize,this.tileSize);k.setClearColor(0,0,0,0);k.setClearDepth(1);k.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);k.setDepthTestEnabled(!1);k.setBlendFunctionSeparate(1,771,1,771);k.setBlendEquation(32774);k.setBlendingEnabled(!0);
var p,v,u;for(f&&this._gridTex&&this._drawRasterData(this._gridTex,1,q);0<=e;e--)if(f=null,n=c[e],n.data?(f=n,p=q,v=1):n.upsampleFromTile&&(v=n.upsampleFromTile,f=v.tile.layerInfo[h][e],u=v.tile.lij[0],p=v.offset,v=v.scale),f){if(f.data instanceof HTMLImageElement||f.data instanceof HTMLCanvasElement)f.data=this._buildTexture(f.data);f.data instanceof m?(n=d.parentSurface.layerViewByIndex(e,h),this._drawVectorData(f.data,n,d.lij,l.descriptor.width,l.descriptor.height,v,p,u,g[e])):this._drawRasterData(f.data,
v,p,g[e])}k.bindTexture(l);r.copyTexImage2D(k.gl.TEXTURE_2D,0,l.descriptor.pixelFormat,0,0,l.descriptor.width,l.descriptor.height,0);l.generateMipmap();k.bindFramebuffer(null);k.setBlendFunctionSeparate(770,771,1,771);k.setBlendingEnabled(!1);this._resourceCounter.incrementNumTileTexturesComposited()};return d}()})},"esri/views/vectorTiles/tileRendererHelper3D":function(){define(["require","exports","dojo/has","../../core/libs/gl-matrix/mat4","../../core/libs/gl-matrix/vec3"],function(p,h,d,a,g){var f=
{extent:{xmin:0,ymin:0,xmax:0,ymax:0,spatialReference:{wkid:102100,isWrappable:!0},intersects:function(a){return!1}},center:[0,0],scale:1,resolution:1,rotation:0,width:1,height:1,pixelRatio:1,size:[256,256],spatialReference:{wkid:102100,isWrappable:!0},worldScreenWidth:1,viewpoint:{},toMap:function(a,d,b){return null},toScreen:function(a,d,b){return null},clone:function(){return null},copy:function(a){return this},toJSON:function(){return null}},k=g.create();return function(g,e,b,h,p,u,r,v,q,n,w,
c,x){q=[e[0],e[1],e[2]];for(var l=n;1>l;l*=2)q[0]--,q[1]>>=1,q[2]>>=1;e={context:g,state:f,stationary:!0,pixelRatio:1,displayLevel:p.adjustLevel(u),requiredLevel:p.adjustLevel(e[0]),drawphase:0,renderer:h,layerOpacity:x,painter:null};if(r!==v)throw Error("It is expected that tiles are square!");u=1/n;x=p.getSchemaShift(q,u);l=x[1];b.tileTransform.displayCoord[0]=-1-2*u*w[0]-x[0];b.tileTransform.displayCoord[1]=1+2*u*(1-w[1]-n)+l;n=b.tileTransform.transform;a.identity(n);p.isWGS84&&512===p.lockedSchemaPixelSize&&
(u*=2);0===c&&(u/=2);p=.25*u/r;k.set([p,-p,1]);a.scale(n,n,k);g.setBlendFunctionSeparate(1,771,1,771);g.setClearDepth(1);g.clear(g.gl.DEPTH_BUFFER_BIT);e.state.size=[r,v];e.state.width=r;e.state.height=v;h.setStateParams(e.state,e.pixelRatio,q[0]);b.attach(e);g.setFaceCullingEnabled(!1);g.setDepthFunction(515);g.setBlendingEnabled(!1);g.setDepthTestEnabled(!0);g.setDepthWriteEnabled(!0);b.processRender(e);g.setDepthWriteEnabled(!1);g.setBlendingEnabled(!0);e.drawphase=1;b.processRender(e);e.drawphase=
2;b.processRender(e);d("esri-vector-tiles-debug")&&h.renderTileInfo(g,b);g.setDepthWriteEnabled(!0);g.setDepthTestEnabled(!1);g.setFaceCullingEnabled(!0)}})},"esri/core/libs/gl-matrix/vec3":function(){define(["./common"],function(p){var h={create:function(){var d=new p.ARRAY_TYPE(3);d[0]=0;d[1]=0;d[2]=0;return d},clone:function(d){var a=new p.ARRAY_TYPE(3);a[0]=d[0];a[1]=d[1];a[2]=d[2];return a},fromValues:function(d,a,g){var f=new p.ARRAY_TYPE(3);f[0]=d;f[1]=a;f[2]=g;return f},copy:function(d,a){d[0]=
a[0];d[1]=a[1];d[2]=a[2];return d},set:function(d,a,g,f){d[0]=a;d[1]=g;d[2]=f;return d},add:function(d,a,g){d[0]=a[0]+g[0];d[1]=a[1]+g[1];d[2]=a[2]+g[2];return d},subtract:function(d,a,g){d[0]=a[0]-g[0];d[1]=a[1]-g[1];d[2]=a[2]-g[2];return d}};h.sub=h.subtract;h.multiply=function(d,a,g){d[0]=a[0]*g[0];d[1]=a[1]*g[1];d[2]=a[2]*g[2];return d};h.mul=h.multiply;h.divide=function(d,a,g){d[0]=a[0]/g[0];d[1]=a[1]/g[1];d[2]=a[2]/g[2];return d};h.div=h.divide;h.ceil=function(d,a){d[0]=Math.ceil(a[0]);d[1]=
Math.ceil(a[1]);d[2]=Math.ceil(a[2]);return d};h.floor=function(d,a){d[0]=Math.floor(a[0]);d[1]=Math.floor(a[1]);d[2]=Math.floor(a[2]);return d};h.min=function(d,a,g){d[0]=Math.min(a[0],g[0]);d[1]=Math.min(a[1],g[1]);d[2]=Math.min(a[2],g[2]);return d};h.max=function(d,a,g){d[0]=Math.max(a[0],g[0]);d[1]=Math.max(a[1],g[1]);d[2]=Math.max(a[2],g[2]);return d};h.round=function(d,a){d[0]=Math.round(a[0]);d[1]=Math.round(a[1]);d[2]=Math.round(a[2]);return d};h.scale=function(d,a,g){d[0]=a[0]*g;d[1]=a[1]*
g;d[2]=a[2]*g;return d};h.scaleAndAdd=function(d,a,g,f){d[0]=a[0]+g[0]*f;d[1]=a[1]+g[1]*f;d[2]=a[2]+g[2]*f;return d};h.distance=function(d,a){var g=a[0]-d[0],f=a[1]-d[1];d=a[2]-d[2];return Math.sqrt(g*g+f*f+d*d)};h.dist=h.distance;h.squaredDistance=function(d,a){var g=a[0]-d[0],f=a[1]-d[1];d=a[2]-d[2];return g*g+f*f+d*d};h.sqrDist=h.squaredDistance;h.length=function(d){var a=d[0],g=d[1];d=d[2];return Math.sqrt(a*a+g*g+d*d)};h.len=h.length;h.squaredLength=function(d){var a=d[0],g=d[1];d=d[2];return a*
a+g*g+d*d};h.sqrLen=h.squaredLength;h.negate=function(d,a){d[0]=-a[0];d[1]=-a[1];d[2]=-a[2];return d};h.inverse=function(d,a){d[0]=1/a[0];d[1]=1/a[1];d[2]=1/a[2];return d};h.normalize=function(d,a){var g=a[0],f=a[1],h=a[2],g=g*g+f*f+h*h;0<g&&(g=1/Math.sqrt(g),d[0]=a[0]*g,d[1]=a[1]*g,d[2]=a[2]*g);return d};h.dot=function(d,a){return d[0]*a[0]+d[1]*a[1]+d[2]*a[2]};h.cross=function(d,a,g){var f=a[0],h=a[1];a=a[2];var m=g[0],e=g[1];g=g[2];d[0]=h*g-a*e;d[1]=a*m-f*g;d[2]=f*e-h*m;return d};h.lerp=function(d,
a,g,f){var h=a[0],m=a[1];a=a[2];d[0]=h+f*(g[0]-h);d[1]=m+f*(g[1]-m);d[2]=a+f*(g[2]-a);return d};h.hermite=function(d,a,g,f,h,m){var e=m*m,b=e*(2*m-3)+1,k=e*(m-2)+m,p=e*(m-1);m=e*(3-2*m);d[0]=a[0]*b+g[0]*k+f[0]*p+h[0]*m;d[1]=a[1]*b+g[1]*k+f[1]*p+h[1]*m;d[2]=a[2]*b+g[2]*k+f[2]*p+h[2]*m;return d};h.bezier=function(d,a,g,f,h,m){var e=1-m,b=e*e,k=m*m,p=b*e,b=3*m*b,e=3*k*e;m*=k;d[0]=a[0]*p+g[0]*b+f[0]*e+h[0]*m;d[1]=a[1]*p+g[1]*b+f[1]*e+h[1]*m;d[2]=a[2]*p+g[2]*b+f[2]*e+h[2]*m;return d};h.random=function(d,
a){a=a||1;var g=2*p.RANDOM()*Math.PI,f=2*p.RANDOM()-1,h=Math.sqrt(1-f*f)*a;d[0]=Math.cos(g)*h;d[1]=Math.sin(g)*h;d[2]=f*a;return d};h.transformMat4=function(d,a,g){var f=a[0],h=a[1];a=a[2];var m=g[3]*f+g[7]*h+g[11]*a+g[15],m=m||1;d[0]=(g[0]*f+g[4]*h+g[8]*a+g[12])/m;d[1]=(g[1]*f+g[5]*h+g[9]*a+g[13])/m;d[2]=(g[2]*f+g[6]*h+g[10]*a+g[14])/m;return d};h.transformMat3=function(d,a,g){var f=a[0],h=a[1];a=a[2];d[0]=f*g[0]+h*g[3]+a*g[6];d[1]=f*g[1]+h*g[4]+a*g[7];d[2]=f*g[2]+h*g[5]+a*g[8];return d};h.transformQuat=
function(d,a,g){var f=a[0],h=a[1],m=a[2];a=g[0];var e=g[1],b=g[2];g=g[3];var l=g*f+e*m-b*h,p=g*h+b*f-a*m,u=g*m+a*h-e*f,f=-a*f-e*h-b*m;d[0]=l*g+f*-a+p*-b-u*-e;d[1]=p*g+f*-e+u*-a-l*-b;d[2]=u*g+f*-b+l*-e-p*-a;return d};h.rotateX=function(d,a,g,f){var h=[],m=[];h[0]=a[0]-g[0];h[1]=a[1]-g[1];h[2]=a[2]-g[2];m[0]=h[0];m[1]=h[1]*Math.cos(f)-h[2]*Math.sin(f);m[2]=h[1]*Math.sin(f)+h[2]*Math.cos(f);d[0]=m[0]+g[0];d[1]=m[1]+g[1];d[2]=m[2]+g[2];return d};h.rotateY=function(d,a,g,f){var h=[],m=[];h[0]=a[0]-g[0];
h[1]=a[1]-g[1];h[2]=a[2]-g[2];m[0]=h[2]*Math.sin(f)+h[0]*Math.cos(f);m[1]=h[1];m[2]=h[2]*Math.cos(f)-h[0]*Math.sin(f);d[0]=m[0]+g[0];d[1]=m[1]+g[1];d[2]=m[2]+g[2];return d};h.rotateZ=function(d,a,g,f){var h=[],m=[];h[0]=a[0]-g[0];h[1]=a[1]-g[1];h[2]=a[2]-g[2];m[0]=h[0]*Math.cos(f)-h[1]*Math.sin(f);m[1]=h[0]*Math.sin(f)+h[1]*Math.cos(f);m[2]=h[2];d[0]=m[0]+g[0];d[1]=m[1]+g[1];d[2]=m[2]+g[2];return d};h.forEach=function(){var d=h.create();return function(a,g,f,h,m,e){g||(g=3);f||(f=0);for(h=h?Math.min(h*
g+f,a.length):a.length;f<h;f+=g)d[0]=a[f],d[1]=a[f+1],d[2]=a[f+2],m(d,d,e),a[f]=d[0],a[f+1]=d[1],a[f+2]=d[2];return a}}();h.angle=function(d,a){d=h.fromValues(d[0],d[1],d[2]);a=h.fromValues(a[0],a[1],a[2]);h.normalize(d,d);h.normalize(a,a);a=h.dot(d,a);return 1<a?0:Math.acos(a)};h.str=function(d){return"vec3("+d[0]+", "+d[1]+", "+d[2]+")"};h.exactEquals=function(d,a){return d[0]===a[0]&&d[1]===a[1]&&d[2]===a[2]};h.equals=function(d,a){var g=d[0],f=d[1];d=d[2];var h=a[0],m=a[1];a=a[2];return Math.abs(g-
h)<=p.EPSILON*Math.max(1,Math.abs(g),Math.abs(h))&&Math.abs(f-m)<=p.EPSILON*Math.max(1,Math.abs(f),Math.abs(m))&&Math.abs(d-a)<=p.EPSILON*Math.max(1,Math.abs(d),Math.abs(a))};return h})},"esri/views/3d/terrain/TilemapOnlyTile":function(){define(["require","exports","./TerrainConst","./TilePerLayerInfo"],function(p,h,d,a){return function(){function g(a){this.parent=null;this.lij=a;this.layerInfo=Array(d.LayerClass.LAYER_CLASS_COUNT)}g.prototype.tileDataAvailable=function(a,d,g){return(d=this.layerInfo[g][d].tilemap)?
"unavailable"!==d.getAvailability(a.lij[1],a.lij[2]):!0};g.prototype.modifyLayers=function(d,g,h){d=g.length;for(var e=this.layerInfo[h],b=Array(d),f=0;f<d;f++){var k=g[f];b[f]=-1<k?e[k]:new a(h)}this.layerInfo[h]=b};return g}()})},"esri/views/support/WebGLRequirements":function(){define(["require","exports","../../core/Error","../../core/sniff"],function(p,h,d,a){Object.defineProperty(h,"__esModule",{value:!0});h.check=function(){var g=null;a("esri-webgl")?a("esri-webgl-major-performance-caveat")?
g=new d("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check if your GPU is blacklisted."):a("esri-webgl-high-precision-fragment")?a("esri-webgl-vertex-shader-samplers")?a("esri-webgl-element-index-uint")||(g=new d("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.")):g=new d("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):
g=new d("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):g=new d("webgl:required","WebGL is required but not supported.");return g}})},"esri/views/ui/3d/DefaultUI3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../DefaultUI".split(" "),function(p,h,d,a,g,f){return function(f){function h(){var a=f.call(this)||
this;a.components=["attribution","zoom","navigation-toggle","compass"];return a}d(h,f);a([g.property()],h.prototype,"components",void 0);return h=a([g.subclass("esri.views.ui.3d.DefaultUI3D")],h)}(g.declared(f))})},"esri/views/ui/DefaultUI":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom-geometry ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u){return function(e){function h(a){a=e.call(this)||this;a._defaultPositionLookup=null;a.components=[];return a}d(h,e);h.prototype.initialize=function(){this._handles.add([f.init(this,"components",this._componentsWatcher.bind(this)),f.init(this,"view",this._updateViewAwareWidgets.bind(this))])};h.prototype._findComponentPosition=function(a){if(!this._defaultPositionLookup){var b=g.isBodyLtr();this._defaultPositionLookup={attribution:"manual",compass:b?"top-left":"top-right",
"navigation-toggle":b?"top-left":"top-right",zoom:b?"top-left":"top-right"}}return this._defaultPositionLookup[a]};h.prototype._removeComponents=function(a){var b=this;a.forEach(function(a){if(a=b.find(a))b.remove(a),a.destroy()})};h.prototype._updateViewAwareWidgets=function(a){var b=this;this.components.forEach(function(d){(d=(d=b.find(d))&&d.widget)&&void 0!==d.view&&d.set("view",a)})};h.prototype._componentsWatcher=function(a,b){this._removeComponents(b);this._addComponents(a)};h.prototype._addComponents=
function(a){var b=this;this.initialized&&a.forEach(function(a){return b.add(b._createComponent(a),b._findComponentPosition(a))})};h.prototype._createComponent=function(a){var b=this._createWidget(a);if(b)return new m({id:a,node:b})};h.prototype._createWidget=function(a){if("attribution"===a)return this._createAttribution();if("compass"===a)return this._createCompass();if("navigation-toggle"===a)return this._createNavigationToggle();if("zoom"===a)return this._createZoom()};h.prototype._createAttribution=
function(){return new b({view:this.view})};h.prototype._createCompass=function(){return new l({view:this.view})};h.prototype._createNavigationToggle=function(){return new t({view:this.view})};h.prototype._createZoom=function(){return new u({view:this.view})};a([k.property()],h.prototype,"components",void 0);return h=a([k.subclass("esri.views.ui.DefaultUI")],h)}(k.declared(e))})},"esri/views/ui/Component":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom dojo/dom-class ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(p,h,d,a,g,f,k,m){return function(e){function b(){var a=null!==e&&e.apply(this,arguments)||this;a.widget=null;return a}d(b,e);b.prototype.destroy=function(){this.widget&&this.widget.destroy();this.node=null};Object.defineProperty(b.prototype,"id",{get:function(){return this._get("id")||this.get("node.id")},set:function(a){this._set("id",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"node",{set:function(a){var b=this._get("node");a!==b&&(a&&f.add(a,"esri-component"),
b&&f.remove(b,"esri-component"),this._set("node",a))},enumerable:!0,configurable:!0});b.prototype.castNode=function(a){if(!a)return this._set("widget",null),null;if("string"===typeof a||a&&"nodeType"in a)return this._set("widget",null),g.byId(a);a&&"function"===typeof a.render&&!a.domNode&&(a.domNode=document.createElement("div"));this._set("widget",a);return a.domNode};a([m.property()],b.prototype,"id",null);a([m.property()],b.prototype,"node",null);a([m.cast("node")],b.prototype,"castNode",null);
a([m.property({readOnly:!0})],b.prototype,"widget",void 0);return b=a([m.subclass("esri.views.ui.Component")],b)}(m.declared(k))})},"esri/views/ui/UI":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom-class dojo/dom-construct dojo/dom-style dojo/_base/lang ../../core/Accessor ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./Component".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,
t,u,r){function v(a){return"object"!==typeof a||a&&a.isInstanceOf&&a.isInstanceOf(r)||!("component"in a||"index"in a||"position"in a)?null:a}var q={left:0,top:0,bottom:0,right:0},n={bottom:30,top:15,right:15,left:15};return function(b){function c(){var a=b.call(this)||this;a._cornerNameToContainerLookup={};a._positionNameToContainerLookup={};a._components=[];a._handles=new l;a._componentToKey=new Map;a.padding=n;a.view=null;a._initContainers();return a}d(c,b);c.prototype.initialize=function(){this._handles.add([t.init(this,
"view.padding, container",this._applyViewPadding.bind(this)),t.init(this,"padding",this._applyUIPadding.bind(this))])};c.prototype.destroy=function(){this.container=null;this._components.forEach(function(a){a.destroy()});this._components.length=0;this._handles.destroy();this._componentToKey.clear();this._componentToKey=null};Object.defineProperty(c.prototype,"container",{set:function(a){var c=this._get("container");a!==c&&(a&&(g.add(a,"esri-ui"),this._attachContainers(a)),c&&(g.remove(c,"esri-ui"),
k.set(c,{top:"",bottom:"",left:"",right:""}),f.empty(c)),this._set("container",a))},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"height",{get:function(){var a=this.get("view.height")||0;if(0===a)return a;var c=this._getViewPadding();return Math.max(a-(c.top+c.bottom),0)},enumerable:!0,configurable:!0});c.prototype.castPadding=function(a){return"number"===typeof a?{bottom:a,top:a,right:a,left:a}:m.mixin({},n,a)};Object.defineProperty(c.prototype,"width",{get:function(){var a=
this.get("view.width")||0;if(0===a)return a;var c=this._getViewPadding();return Math.max(a-(c.left+c.right),0)},enumerable:!0,configurable:!0});c.prototype.add=function(a,c){var b=this,d,e;if(Array.isArray(a))a.forEach(function(a){return b.add(a,c)});else{var f=v(a);f&&(d=f.index,c=f.position,a=f.component,e=f.key);c&&"object"===typeof c&&(d=c.index,e=c.key,c=c.position);!a||c&&!this._isValidPosition(c)||(a&&a.isInstanceOf&&a.isInstanceOf(r)||(a=new r({node:a})),this._place({component:a,position:c,
index:d}),this._components.push(a),e&&this._componentToKey.set(a,e))}};c.prototype.remove=function(a,c){var b=this;if(a){if(Array.isArray(a))return a.map(function(a){return b.remove(a,c)});var d=this.find(a);if(d){var e=this._componentToKey;if(!e.has(a)||e.get(a)===c)return e=this._components.indexOf(d),d.node.parentNode&&d.node.parentNode.removeChild(d.node),this._componentToKey.delete(a),this._components.splice(e,1)[0]}}};c.prototype.empty=function(a){var c=this;if(Array.isArray(a))return a.map(function(a){return c.empty(a)}).reduce(function(a,
c){return a.concat(c)});a=a||"manual";if("manual"===a)return Array.prototype.slice.call(this._manualContainer.children).filter(function(a){return!g.contains(a,"esri-ui-corner")}).map(function(a){return c.remove(a)});if(this._isValidPosition(a))return Array.prototype.slice.call(this._cornerNameToContainerLookup[a].children).map(this.remove,this)};c.prototype.move=function(a,c){var b=this;Array.isArray(a)&&a.forEach(function(a){return b.move(a,c)});if(a){var d,e=v(a)||v(c);e&&(d=e.index,c=e.position,
a=e.component||a);(!c||this._isValidPosition(c))&&(a=this.remove(a))&&this.add(a,{position:c,index:d})}};c.prototype.find=function(a){return a?a&&a.isInstanceOf&&a.isInstanceOf(r)?this._findByComponent(a):"string"===typeof a?this._findById(a):this._findByNode(a.domNode||a):null};c.prototype._getViewPadding=function(){return this.get("view.padding")||q};c.prototype._attachContainers=function(a){f.place(this._manualContainer,a);f.place(this._innerContainer,a)};c.prototype._initContainers=function(){var a=
f.create("div",{className:"esri-ui-inner-container esri-ui-corner-container"}),c=f.create("div",{className:"esri-ui-inner-container esri-ui-manual-container"}),b=f.create("div",{className:"esri-ui-top-left esri-ui-corner"},a),d=f.create("div",{className:"esri-ui-top-right esri-ui-corner"},a),e=f.create("div",{className:"esri-ui-bottom-left esri-ui-corner"},a),g=f.create("div",{className:"esri-ui-bottom-right esri-ui-corner"},a);this._innerContainer=a;this._manualContainer=c;this._cornerNameToContainerLookup=
{"top-left":b,"top-right":d,"bottom-left":e,"bottom-right":g};this._positionNameToContainerLookup=m.mixin({manual:c},this._cornerNameToContainerLookup)};c.prototype._isValidPosition=function(a){return!!this._positionNameToContainerLookup[a]};c.prototype._place=function(a){var c=a.component,b=a.index;a=this._positionNameToContainerLookup[a.position||"manual"];var d;-1<b?(d=Array.prototype.slice.call(a.children),0===b?this._placeComponent(c,a,"first"):b>=d.length?this._placeComponent(c,a,"last"):this._placeComponent(c,
d[b],"before")):this._placeComponent(c,a,"last")};c.prototype._placeComponent=function(a,c,b){var d=a.widget;d&&!d._started&&"function"===typeof d.postMixInProperties&&"function"===typeof d.buildRendering&&"function"===typeof d.postCreate&&"function"===typeof d.startup&&a.widget.startup();f.place(a.node,c,b)};c.prototype._applyViewPadding=function(){var a=this.container;a&&k.set(a,this._toPxPosition(this._getViewPadding()))};c.prototype._applyUIPadding=function(){this._innerContainer&&k.set(this._innerContainer,
this._toPxPosition(this.padding))};c.prototype._toPxPosition=function(a){return{top:this._toPxUnit(a.top),left:this._toPxUnit(a.left),right:this._toPxUnit(a.right),bottom:this._toPxUnit(a.bottom)}};c.prototype._toPxUnit=function(a){return 0===a?0:a+"px"};c.prototype._findByComponent=function(a){var c=null,b;this._components.some(function(d){(b=d===a)&&(c=d);return b});return c};c.prototype._findById=function(a){var c=null,b;this._components.some(function(d){(b=d.id===a)&&(c=d);return b});return c};
c.prototype._findByNode=function(a){var c=null,b;this._components.some(function(d){(b=d.node===a)&&(c=d);return b});return c};a([u.property()],c.prototype,"container",null);a([u.property({dependsOn:["view.height"]})],c.prototype,"height",null);a([u.property()],c.prototype,"padding",void 0);a([u.cast("padding")],c.prototype,"castPadding",null);a([u.property()],c.prototype,"view",void 0);a([u.property({dependsOn:["view.width"]})],c.prototype,"width",null);return c=a([u.subclass("esri.views.ui.UI")],
c)}(u.declared(e,b))})},"esri/widgets/Attribution":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Attribution/nls/Attribution ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Attribution/AttributionViewModel ./support/widget".split(" "),function(p,h,d,a,g,f,k,m,e,b){return function(h){function l(a){a=h.call(this)||this;a._isOpen=!1;a._attributionTextOverflowed=!1;a._prevSourceNodeHeight=0;a.iconClass="esri-icon-description";
a.itemDelimiter=" | ";a.label=g.widgetLabel;a.view=null;a.viewModel=new e;return a}d(l,h);l.prototype.postInitialize=function(){var a=this;this.own(f.on(this,"viewModel.items","change",function(){return a.scheduleRender()}))};Object.defineProperty(l.prototype,"attributionText",{get:function(){return this.viewModel.items.reduce(function(a,b){-1===a.indexOf(b.text)&&a.push(b.text);return a},[]).join(this.itemDelimiter)},enumerable:!0,configurable:!0});l.prototype.render=function(){var a=(d={},d["esri-attribution--open"]=
this._isOpen,d);return b.tsx("div",{bind:this,class:"esri-attribution esri-widget",classes:a,onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),b.tsx("div",{class:"esri-attribution__powered-by"},"Powered by ",b.tsx("a",{target:"_blank",href:"http://www.esri.com/",class:"esri-attribution__link"},"Esri")));var d};l.prototype._renderSourcesNode=function(){var a=this._isOpen,d=this._isInteractive(),e=this.attributionText,a=(f={},f["esri-attribution__sources--open"]=a,f["esri-interactive"]=
d,f);return b.tsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:"esri-attribution__sources",classes:a,innerHTML:e,role:d?"button":void 0,tabIndex:d?0:-1});var f};l.prototype._afterSourcesNodeCreate=function(a){this._prevSourceNodeHeight=a.clientWidth};l.prototype._afterSourcesNodeUpdate=function(a){var b=!1,d=a.clientHeight;a=a.scrollWidth>=a.clientWidth;var e=this._attributionTextOverflowed!==a;this._attributionTextOverflowed=a;e&&(b=!0);
this._isOpen&&(a=d<this._prevSourceNodeHeight,this._prevSourceNodeHeight=d,a&&(this._isOpen=!1,b=!0));b&&this.scheduleRender()};l.prototype._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)};l.prototype._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed};a([k.property({dependsOn:["viewModel.items.length","itemDelimiter"],readOnly:!0}),b.renderable()],l.prototype,"attributionText",null);a([k.property()],l.prototype,"iconClass",void 0);a([k.property(),
b.renderable()],l.prototype,"itemDelimiter",void 0);a([k.property()],l.prototype,"label",void 0);a([k.aliasOf("viewModel.view")],l.prototype,"view",void 0);a([k.property({type:e}),b.renderable(["state","view.size"])],l.prototype,"viewModel",void 0);a([b.accessibleHandler()],l.prototype,"_toggleState",null);return l=a([k.subclass("esri.widgets.Attribution")],l)}(k.declared(m))})},"esri/widgets/Attribution/AttributionViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Collection ../../core/Handles ../../core/lang ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/support/webMercatorUtils".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t){return function(g){function h(a){a=g.call(this,a)||this;a._handles=new k;a._pendingAttributionItemsByLayerId={};a._attributionDataByLayerId={};a.items=new f;a.view=null;a._updateAttributionItems=a._updateAttributionItems.bind(a);return a}d(h,g);h.prototype.initialize=function(){this._handles.add(e.init(this,"view",this._viewWatcher))};h.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(h.prototype,"state",{get:function(){return this.get("view.ready")?
"ready":"disabled"},enumerable:!0,configurable:!0});h.prototype._viewWatcher=function(a){var b=this,d=this._handles;d&&d.remove();a&&(d.add([a.allLayerViews.on("change",function(a){b._addLayerViews(a.added);0<a.removed.length&&(a.removed.forEach(function(a){d.remove(a.uid)}),b._updateAttributionItems())}),e.init(a,"stationary",this._updateAttributionItems)]),this._addLayerViews(a.allLayerViews))};h.prototype._addLayerViews=function(a){var b=this;a.forEach(function(a){b._handles.has(a.uid)||b._handles.add(e.init(a,
"suspended",b._updateAttributionItems),a.uid)})};h.prototype._updateAttributionItems=function(){var a=this,b=[];this._getActiveLayerViews().forEach(function(d){var e=d.layer;if(!e.hasAttributionData){if(d=e.get("copyright")){var c=a._findItem(b,{layer:e,text:d});c||b.push({text:d,layer:e})}}else if(e&&e.tileInfo){var f=a._attributionDataByLayerId;if(f[e.uid]){if(d=a._getDynamicAttribution(f[e.uid],a.view,e))(c=a._findItem(b,{layer:e,text:d}))||b.push({text:d,layer:e})}else{var g=a._pendingAttributionItemsByLayerId;
a._inProgress(g[e.uid])||(g[e.uid]=e.fetchAttributionData().then(function(c){c=a._createContributionIndex(c,a._isBingLayer(e));delete g[e.uid];f[e.uid]=c;a._updateAttributionItems()}))}}});this._itemsChanged(this.items,b)&&(this.items.removeAll(),this.items.addMany(b))};h.prototype._itemsChanged=function(a,b){return a.length!==b.length||a.some(function(a,d){return a.text!==b[d].text})};h.prototype._inProgress=function(a){return a&&!a.isFulfilled()};h.prototype._getActiveLayerViews=function(){return this.get("view.allLayerViews").filter(function(a){return!a.suspended&&
a.get("layer.attributionVisible")})};h.prototype._findItem=function(a,b){var d=b.layer,e=b.text,c;a.some(function(a){var b=a.layer===d&&a.text===e;b&&(c=a);return b});return c};h.prototype._isBingLayer=function(a){return-1!==a.declaredClass.toLowerCase().indexOf("vetiledlayer")};h.prototype._createContributionIndex=function(a,b){a=a.contributors;var d={};if(!a)return d;a.forEach(function(a,c){var e=a.coverageAreas;e&&e.forEach(function(e){var f=e.bbox,g=e.zoomMin-(b&&e.zoomMin?1:0),h=e.zoomMax-(b&&
e.zoomMax?1:0);a={extent:t.geographicToWebMercator(new l({xmin:f[1],ymin:f[0],xmax:f[3],ymax:f[2]})),attribution:a.attribution||"",score:m.isDefined(e.score)?e.score:100,id:c};for(e=g;e<=h;e++)d[e]=d[e]||[],d[e].push(a)})});d.maxKey=Math.max.apply(null,Object.keys(d));return d};h.prototype._getDynamicAttribution=function(a,b,d){var e=b.extent;b=d.tileInfo.scaleToZoom(b.scale);b=Math.min(a.maxKey,Math.round(b));if(!e||!m.isDefined(b)||-1>=b)return"";a=a[b];var c=e.center.clone().normalize(),f={};return a.filter(function(a){var b=
!f[a.id]&&a.extent.contains(c);b&&(f[a.id]=!0);return b}).sort(function(a,c){return c.score-a.score||a.objectId-c.objectId}).map(function(a){return a.attribution}).join(", ")};a([b.property({readOnly:!0,type:f})],h.prototype,"items",void 0);a([b.property({dependsOn:["view.ready"],readOnly:!0})],h.prototype,"state",null);a([b.property()],h.prototype,"view",void 0);return h=a([b.subclass("esri.widgets.Attribution.AttributionViewModel")],h)}(b.declared(g))})},"esri/widgets/Compass":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Compass/nls/Compass ../core/accessorSupport/decorators ./Widget ./Compass/CompassViewModel ./support/widget".split(" "),
function(p,h,d,a,g,f,k,m,e){return function(b){function h(a){a=b.call(this)||this;a.activeMode=null;a.iconClass="esri-icon-locate-circled";a.label=g.widgetLabel;a.modes=null;a.view=null;a.viewModel=new m;return a}d(h,b);h.prototype.reset=function(){};h.prototype.render=function(){var a=this.viewModel.orientation,b=this.viewModel.state,d="disabled"===b,f="compass"===("rotation"===b?"rotation":"compass"),b=(h={},h["esri-disabled"]=d,h["esri-compass--active"]="device-orientation"===this.viewModel.activeMode,
h["esri-interactive"]=!d,h),h=(k={},k["esri-icon-compass"]=f,k["esri-icon-dial"]=!f,k);return e.tsx("div",{bind:this,class:"esri-compass esri-widget-button esri-widget",classes:b,onclick:this._start,onkeydown:this._start,role:"button",tabIndex:d?-1:0,"aria-label":g.reset,title:g.reset},e.tsx("span",{"aria-hidden":"true",class:"esri-compass__icon",classes:h,styles:this._toRotationTransform(a)}),e.tsx("span",{class:"esri-icon-font-fallback-text"},g.reset));var h,k};h.prototype._start=function(){var a=
this.viewModel;a.nextMode();a.startMode()};h.prototype._toRotationTransform=function(a){return{transform:"rotateZ("+a.z+"deg)"}};a([f.aliasOf("viewModel.activeMode")],h.prototype,"activeMode",void 0);a([f.property()],h.prototype,"iconClass",void 0);a([f.property()],h.prototype,"label",void 0);a([f.aliasOf("viewModel.modes")],h.prototype,"modes",void 0);a([f.aliasOf("viewModel.view")],h.prototype,"view",void 0);a([f.property({type:m}),e.renderable(["viewModel.orientation","viewModel.state"])],h.prototype,
"viewModel",void 0);a([f.aliasOf("viewModel.reset")],h.prototype,"reset",null);a([e.accessibleHandler()],h.prototype,"_start",null);return h=a([f.subclass("esri.widgets.Compass")],h)}(f.declared(k))})},"esri/widgets/Compass/CompassViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),
function(p,h,d,a,g,f,k,m,e,b){var l=k.getLogger("esri.widgets.CompassViewModel");return function(g){function h(a){a=g.call(this,a)||this;a._handles=new f;a.canUseHeading=!1;a.orientation={x:0,y:0,z:0};a.view=null;a._updateForCamera=a._updateForCamera.bind(a);a._updateForRotation=a._updateForRotation.bind(a);a._updateRotationWatcher=a._updateRotationWatcher.bind(a);a._updateViewHeading=a._updateViewHeading.bind(a);a._checkHeadingSupport=a._checkHeadingSupport.bind(a);a._canUseHeading();return a}d(h,
g);h.prototype.initialize=function(){this._handles.add(e.init(this,"view",this._updateRotationWatcher))};h.prototype.destroy=function(){this._removeCheckHeadingListener();this._removeOrientationListener();this._handles.destroy();this.view=this._handles=null};Object.defineProperty(h.prototype,"activeMode",{get:function(){var a=this._get("activeMode");return a?a:(a=this.modes)?a[0]:"none"},set:function(a){this.stopMode();this._set("activeMode",a);void 0===a&&this._clearOverride("activeMode")},enumerable:!0,
configurable:!0});Object.defineProperty(h.prototype,"canShowNorth",{get:function(){var a=this.get("view.spatialReference");return a&&(a.isWebMercator||a.isWGS84)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"modes",{get:function(){return this._get("modes")||["reset"]},set:function(a){this._set("modes",a);void 0===a&&this._clearOverride("modes")},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"state",{get:function(){return this.get("view.ready")?this.canShowNorth?
"compass":"rotation":"disabled"},enumerable:!0,configurable:!0});h.prototype.previousMode=function(){var a=this.modes;2>a.length||(a=a.indexOf(this.activeMode),this._paginateMode(a-1))};h.prototype.nextMode=function(){var a=this.modes;2>a.length||(a=a.indexOf(this.activeMode),this._paginateMode(a+1))};h.prototype.startMode=function(){var a=this.activeMode;"reset"===a&&this.reset();"device-orientation"===a&&(this._removeOrientationListener(),this._addOrientationListener())};h.prototype.stopMode=function(){"device-orientation"===
this.activeMode&&this._removeOrientationListener()};h.prototype.reset=function(){if(this.get("view.ready")){var a={};"2d"===this.view.type?a.rotation=0:a.heading=0;this.view.goTo(a)}};h.prototype._supportsDeviceOrientation=function(){return"DeviceOrientationEvent"in window};h.prototype._paginateMode=function(a){var b=this.modes;this.activeMode=b[(a+b.length)%b.length]};h.prototype._supportsHeading=function(a){var b="number"===typeof a.webkitCompassHeading;return"number"===typeof a.compassHeading||
b||!1};h.prototype._getAccuracy=function(a){return a.compassAccuracy||a.webkitCompassAccuracy||0};h.prototype._getHeading=function(a){return a.webkitCompassHeading||a.compassHeading||void 0};h.prototype._removeCheckHeadingListener=function(){this._supportsDeviceOrientation()&&window.removeEventListener("deviceorientation",this._checkHeadingSupport)};h.prototype._checkHeadingSupport=function(a){this._supportsHeading(a)&&this._set("canUseHeading",!0);this._removeCheckHeadingListener()};h.prototype._canUseHeading=
function(){var a=this;this._supportsDeviceOrientation()&&(window.addEventListener("deviceorientation",this._checkHeadingSupport),m.after(500).then(function(){a._removeCheckHeadingListener()}))};h.prototype._getHeadingAdjustment=function(a,b){if("orientation"in window){b=window.orientation;if("number"!==typeof b)return a;a+=b;return 360<a?a-360:0>a?a+360:a}return a};h.prototype._updateViewHeading=function(a){var b=this.view,d=this._getHeading(a),e=this._getAccuracy(a);!b||!b.stationary||"number"!==
typeof d||0>d||360<d||50<e||(a=this._getHeadingAdjustment(d,a),"3d"===b.type&&(d=b.camera.clone(),d.heading=a,b.camera=d),"2d"===b.type&&(b.rotation=a))};h.prototype._removeOrientationListener=function(){this.canUseHeading&&window.removeEventListener("deviceorientation",this._updateViewHeading)};h.prototype._addOrientationListener=function(){var a=this.canShowNorth;this.canUseHeading?a?window.addEventListener("deviceorientation",this._updateViewHeading):l.warn("device-orientation mode requires 'canShowNorth' to be true"):
l.warn("The deviceorientation event is not supported in this browser")};h.prototype._updateForRotation=function(a){void 0!==a&&null!==a&&(this.orientation={z:a})};h.prototype._updateForCamera=function(a){a&&(this.orientation={x:0,y:0,z:-a.heading})};h.prototype._updateRotationWatcher=function(a){this._handles.removeAll();a&&("2d"===a.type?this._handles.add(e.init(this,"view.rotation",this._updateForRotation)):this._handles.add(e.init(this,"view.camera",this._updateForCamera)))};a([b.property({dependsOn:["modes"]})],
h.prototype,"activeMode",null);a([b.property({dependsOn:["view.spatialReference.isWebMercator","view.spatialReference.wkid"],readOnly:!0})],h.prototype,"canShowNorth",null);a([b.property({readOnly:!0})],h.prototype,"canUseHeading",void 0);a([b.property({dependsOn:["canUseHeading"]})],h.prototype,"modes",null);a([b.property()],h.prototype,"orientation",void 0);a([b.property({dependsOn:["view.ready","canShowNorth"],readOnly:!0})],h.prototype,"state",null);a([b.property()],h.prototype,"view",void 0);
a([b.property()],h.prototype,"previousMode",null);a([b.property()],h.prototype,"nextMode",null);a([b.property()],h.prototype,"startMode",null);a([b.property()],h.prototype,"stopMode",null);a([b.property()],h.prototype,"reset",null);return h=a([b.subclass("esri.widgets.CompassViewModel")],h)}(b.declared(g))})},"esri/widgets/NavigationToggle":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./NavigationToggle/nls/NavigationToggle ../core/accessorSupport/decorators ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/widget".split(" "),
function(p,h,d,a,g,f,k,m,e){return function(b){function h(a){a=b.call(this)||this;a.iconClass="esri-icon-pan2";a.label=g.widgetLabel;a.view=null;a.viewModel=new m;return a}d(h,b);Object.defineProperty(h.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});h.prototype.toggle=function(){};h.prototype.render=function(){var a="disabled"===this.get("viewModel.state"),b="pan"===this.get("viewModel.navigationMode"),d=(f={},f["esri-disabled"]=
a,f["esri-navigation-toggle--horizontal"]="horizontal"===this.layout,f),f=(h={},h["esri-navigation-toggle__button--active"]=b,h),b=(k={},k["esri-navigation-toggle__button--active"]=!b,k);return e.tsx("div",{bind:this,class:"esri-navigation-toggle esri-widget",classes:d,onclick:this._toggle,onkeydown:this._toggle,tabIndex:a?-1:0,"aria-label":g.toggle,title:g.toggle},e.tsx("div",{class:e.join("esri-navigation-toggle__button esri-widget-button","esri-navigation-toggle__button--pan"),classes:f},e.tsx("span",
{class:"esri-icon-pan"})),e.tsx("div",{class:e.join("esri-navigation-toggle__button esri-widget-button","esri-navigation-toggle__button--rotate"),classes:b},e.tsx("span",{class:"esri-icon-rotate"})));var f,h,k};h.prototype._toggle=function(){this.toggle()};a([f.property()],h.prototype,"iconClass",void 0);a([f.property()],h.prototype,"label",void 0);a([f.property({value:"vertical"}),e.renderable()],h.prototype,"layout",null);a([f.aliasOf("viewModel.view"),e.renderable()],h.prototype,"view",void 0);
a([f.property({type:m}),e.renderable(["viewModel.state","viewModel.navigationMode"])],h.prototype,"viewModel",void 0);a([f.aliasOf("viewModel.toggle")],h.prototype,"toggle",null);a([e.accessibleHandler()],h.prototype,"_toggle",null);return h=a([f.subclass("esri.widgets.NavigationToggle")],h)}(f.declared(k))})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),
function(p,h,d,a,g,f,k,m){return function(e){function b(a){a=e.call(this,a)||this;a._handles=new f;a.navigationMode="pan";a.view=null;a.toggle=a.toggle.bind(a);return a}d(b,e);b.prototype.initialize=function(){this._handles.add(k.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};b.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(b.prototype,"state",{get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":
"disabled"},enumerable:!0,configurable:!0});b.prototype.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};b.prototype._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};a([m.property({dependsOn:["view.ready"],readOnly:!0})],b.prototype,"state",null);a([m.property()],b.prototype,"navigationMode",void 0);a([m.property()],b.prototype,"view",void 0);
a([m.property()],b.prototype,"toggle",null);return b=a([m.subclass("esri.widgets.NavigationToggleViewModel")],b)}(m.declared(g))})},"esri/widgets/Zoom":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Zoom/nls/Zoom ../core/accessorSupport/decorators ./Widget ./Zoom/IconButton ./Zoom/ZoomViewModel ./support/widget".split(" "),function(p,h,d,a,g,f,k,m,e,b){return function(h){function k(a){a=h.call(this)||this;a.iconClass="esri-icon-zoom-in-magnifying-glass";
a.label=g.widgetLabel;a.view=null;a.viewModel=new e;return a}d(k,h);k.prototype.postInitialize=function(){this._zoomInButton=new m({action:this.zoomIn,iconClass:"esri-icon-plus",title:g.zoomIn});this._zoomOutButton=new m({action:this.zoomOut,iconClass:"esri-icon-minus",title:g.zoomOut})};Object.defineProperty(k.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});k.prototype.render=function(){var a=this.viewModel,d=(e={},e["esri-zoom--horizontal"]=
"horizontal"===this.layout,e);this._zoomInButton.enabled="ready"===a.state&&a.canZoomIn;this._zoomOutButton.enabled="ready"===a.state&&a.canZoomOut;return b.tsx("div",{class:"esri-zoom esri-widget",classes:d},this._zoomInButton.render(),this._zoomOutButton.render());var e};k.prototype.zoomIn=function(){};k.prototype.zoomOut=function(){};a([f.property()],k.prototype,"iconClass",void 0);a([f.property()],k.prototype,"label",void 0);a([f.property({value:"vertical"}),b.renderable()],k.prototype,"layout",
null);a([f.aliasOf("viewModel.view"),b.renderable()],k.prototype,"view",void 0);a([f.property({type:e}),b.renderable(["viewModel.canZoomIn","viewModel.canZoomOut","viewModel.state"])],k.prototype,"viewModel",void 0);a([f.aliasOf("viewModel.zoomIn")],k.prototype,"zoomIn",null);a([f.aliasOf("viewModel.zoomOut")],k.prototype,"zoomOut",null);return k=a([f.subclass("esri.widgets.Zoom")],k)}(f.declared(k))})},"esri/widgets/Zoom/IconButton":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../Widget ../support/widget".split(" "),
function(p,h,d,a,g,f,k){return function(f){function e(){var a=null!==f&&f.apply(this,arguments)||this;a.enabled=!0;a.iconClass="";a.title="";return a}d(e,f);e.prototype.render=function(){var a=this.enabled?0:-1,d=(e={},e["esri-disabled"]=!this.enabled,e["esri-interactive"]=this.enabled,e),e=(f={},f[this.iconClass]=!!this.iconClass,f);return k.tsx("div",{bind:this,class:"esri-widget-button esri-widget",classes:d,onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:a,title:this.title},
k.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon",classes:e}),k.tsx("span",{class:"esri-icon-font-fallback-text"},this.title));var e,f};e.prototype._triggerAction=function(){this.action.call(this)};a([g.property()],e.prototype,"action",void 0);a([g.property(),k.renderable()],e.prototype,"enabled",void 0);a([g.property({readOnly:!1}),k.renderable()],e.prototype,"iconClass",void 0);a([g.property(),k.renderable()],e.prototype,"title",void 0);a([k.accessibleHandler()],e.prototype,
"_triggerAction",null);return e=a([g.subclass("esri.widgets.IconButton")],e)}(g.declared(f))})},"esri/widgets/Zoom/ZoomViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(p,h,d,a,g,f,k,m){return function(e){function b(a){a=e.call(this,a)||this;a.canZoomIn=null;a.canZoomOut=null;a.zoomIn=a.zoomIn.bind(a);a.zoomOut=
a.zoomOut.bind(a);return a}d(b,e);b.prototype.destroy=function(){this.view=null};Object.defineProperty(b.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"view",{set:function(a){a?"2d"===a.type?this._zoomConditions=new k({view:a}):"3d"===a.type&&(this._zoomConditions=new m):this._zoomConditions=null;this._set("view",a)},enumerable:!0,configurable:!0});b.prototype.zoomIn=function(){this.canZoomIn&&
this._zoomToFactor(.5)};b.prototype.zoomOut=function(){this.canZoomOut&&this._zoomToFactor(2)};b.prototype._zoomToFactor=function(a){if("ready"===this.state){var b=this.view;"3d"===this.view.type?b.goTo({zoomFactor:1/a}):b.goTo({scale:this.get("view.scale")*a})}};a([f.property()],b.prototype,"_zoomConditions",void 0);a([f.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],b.prototype,"canZoomIn",void 0);a([f.property({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],b.prototype,"canZoomOut",
void 0);a([f.property({dependsOn:["view.ready"],readOnly:!0})],b.prototype,"state",null);a([f.property()],b.prototype,"view",null);a([f.property()],b.prototype,"zoomIn",null);a([f.property()],b.prototype,"zoomOut",null);return b=a([f.subclass("esri.widgets.Zoom.ZoomViewModel")],b)}(f.declared(g))})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(p,h,d,a,g,f){return function(g){function h(){return null!==g&&g.apply(this,arguments)||this}d(h,g);Object.defineProperty(h.prototype,"canZoomIn",{get:function(){var a=this.get("view.scale"),b=this.get("view.constraints.effectiveMaxScale");return 0===b||a>b},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"canZoomOut",{get:function(){var a=this.get("view.scale"),b=this.get("view.constraints.effectiveMinScale");return 0===b||a<b},enumerable:!0,configurable:!0});a([f.property({dependsOn:["view.ready",
"view.scale"],readOnly:!0})],h.prototype,"canZoomIn",null);a([f.property({dependsOn:["view.ready","view.scale"],readOnly:!0})],h.prototype,"canZoomOut",null);a([f.property()],h.prototype,"view",void 0);return h=a([f.subclass("esri.widgets.Zoom.ZoomConditions2D")],h)}(f.declared(g))})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(p,h,d,a,g,f){return function(g){function h(){var a=null!==g&&g.apply(this,arguments)||this;a.canZoomIn=!0;a.canZoomOut=!0;return a}d(h,g);a([f.property({readOnly:!0})],h.prototype,"canZoomIn",void 0);a([f.property({readOnly:!0})],h.prototype,"canZoomOut",void 0);return h=a([f.subclass("esri.widgets.Zoom.ZoomConditions3D")],h)}(f.declared(g))})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","./WidgetManager"],function(p,h,d,a){var g=null,f;f=p(null,
{constructor:function(){d.subscribe("publishData",h.hitch(this,this.onDataPublished));d.subscribe("fetchData",h.hitch(this,this.onFetchData));d.subscribe("clearAllData",h.hitch(this,this.onClearAllData));d.subscribe("removeData",h.hitch(this,this.onRemoveData));d.subscribe("clearDataHistory",h.hitch(this,this.onClearDataHistory));this.widgetManager=a.getInstance()},_dataStore:{},onDataPublished:function(a,d,e,b){"undefined"===typeof b&&(b=!1);this._dataStore[d]?(this._dataStore[d].current=e,b&&(this._dataStore[d].history?
this._dataStore[d].history.push(e):this._dataStore[d].history=[e])):(this._dataStore[d]={current:e},b&&(this._dataStore[d].history=[e]))},onFetchData:function(a){var f;if(a)"framework"===a?this._dataStore[a]?d.publish("dataFetched","framework","framework",this._dataStore[a].current,this._dataStore[a].history):d.publish("noData","framework","framework"):(f=this.widgetManager.getWidgetById(a))?this._dataStore[a]?d.publish("dataFetched",f.name,a,this._dataStore[a].current,this._dataStore[a].history):
d.publish("noData",f.name,a):d.publish("noData",void 0,a);else for(var e in this._dataStore)(f=this.widgetManager.getWidgetById(e))&&d.publish("dataFetched",f.name,e,this._dataStore[e].current,this._dataStore[e].history)},onClearAllData:function(){this._dataStore={};d.publish("allDataCleared")},onRemoveData:function(a){delete this._dataStore[a];d.publish("dataRemoved",a)},onClearDataHistory:function(a){this._dataStore[a]&&(this._dataStore[a].history=[]);d.publish("dataHistoryCleared",a)}});f.getInstance=
function(){null===g&&(g=new f);return g};return f})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),function(p,h,d,a,g,f,k,m,e){return p([f,k],{type:"widget",id:void 0,label:void 0,icon:void 0,uri:void 0,position:{},config:void 0,openAtStart:!1,sceneView:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,
templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(g.subscribe("publishData",h.hitch(this,this._onReceiveData)));this.own(g.subscribe("dataFetched",h.hitch(this,this._onReceiveData)));this.own(g.subscribe("noData",h.hitch(this,this._onNoData)))},startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},
onActive:function(){},onDeActive:function(){},onSignIn:function(a){},onSignOut:function(){},onPositionChange:function(a){this.setPosition(a)},setPosition:function(b,d){this.position=b;var e=m.getPositionStyle(this.position);e.position="absolute";d||(d="map"===b.relativeTo?this.sceneView.map.id:window.jimuConfig.layoutId);a.place(this.domNode,d);a.setStyle(this.domNode,e);this.started&&this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return a.getMarginBox(this.domNode)},
setState:function(a){this.state=a},setWindowState:function(a){this.windowState=a},resize:function(){},onConfigChanged:function(a){},onAppConfigChanged:function(a,d,e){},onAction:function(a,d){},getPanel:function(){if(!1===this.inPanel)return null;if("widgetOnScreen"===this.gid||"widgetPool"===this.gid)return e.getInstance().getPanelById(this.id+"_panel");var a=e.getInstance().getPanelById(this.gid+"_panel");return a?a:e.getInstance().getPanelById(this.id+"_panel")},publishData:function(a,d){"undefined"===
typeof d&&(d=!1);g.publish("publishData",this.name,this.id,a,d)},fetchData:function(a){a?g.publish("fetchData",a):0!==this.listenWidgetIds.length?d.forEach(this.listenWidgetIds,function(a){g.publish("fetchData",a)},this):g.publish("fetchData")},fetchDataByName:function(a){a=this.widgetManager.getWidgetsByName(a);d.forEach(a,function(a){this.fetchData(a.id)},this)},openWidgetById:function(a){return this.widgetManager.triggerWidgetOpen(a)},_onReceiveData:function(a,d,e,f){if(d!==this.id&&!(0!==this.listenWidgetIds.length&&
0>this.listenWidgetIds.indexOf(d)))this.onReceiveData(a,d,e,f)},onReceiveData:function(a,d,e,f){},_onNoData:function(a,d){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(d)))this.onNoData(a,d)},onNoData:function(a,d){}})})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,
t,u){var r,v=null;r=p(null,{constructor:function(){this.panels=[];this.widgetManager=u.getInstance();m(window,"resize",h.hitch(this,this.onWindowResize));this.activePanel=null;e.subscribe("/dnd/move/start",h.hitch(this,this._onMoveStart));e.subscribe("widgetActived",h.hitch(this,this._onWidgetActived))},showPanel:function(a){var b=new f,d=this.getPanelById(a.id+"_panel");d?("closed"===d.state&&this.openPanel(d),b.resolve(d)):k({Panel:this._loadPanelClass(a.panel.uri),nls:this._loadThemeI18N(a.panel.uri)}).then(h.hitch(this,
function(c){var d=a.id+"_panel",e=this.getPanelById(d),f={label:a.label,config:a,uri:a.panel.uri,position:a.panel.position,sceneView:this.sceneView,widgetManager:this.widgetManager,panelManager:this,id:d,gid:a.gid,nls:c.nls};h.mixin(f,a.panel.options);try{e=new c.Panel(f),console.log("panel ["+d+"] created.")}catch(y){console.log("create panel error: "+y+", panelId: "+d);b.reject(y);return}e.setPosition(a.panel.position);t.setVerticalCenter(e.domNode);this.openPanel(e);this.panels.push(e);m(e.domNode,
"click",h.hitch(this,this._onPanelClick,e));b.resolve(e)}));return b},setSceneView:function(a){this.sceneView=a;m(this.sceneView,"resize",h.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a.gid&&this.panels[b].id!==a.id&&this.closePanel(this.panels[b])},closeAllPanelsInGroup:function(a){for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a&&this.closePanel(this.panels[b])},
openPanel:function(b){var d=new f;if("string"===typeof b&&(b=this.getPanelById(b),!b))return d.reject(),d;if(!b.started)try{b.started=!0,b.startup()}catch(w){console.error("fail to startup panel "+b.id+". "+w.stack)}if("opened"===b.state)return d.resolve(b),d;b.setState("opened");return this.playOpenPanelAnimation(b).then(h.hitch(this,function(){a.setStyle(b.domNode,"display","");b.onOpen();this._activePanel(b);return b}))},closePanel:function(b){var d=new f;return"string"===typeof b&&(b=this.getPanelById(b),
!b)||"closed"===b.state?(d.resolve(),d):this.playClosePanelAnimation(b).then(function(){this.activePanel&&this.activePanel.id===b.id&&(this.activePanel.onDeActive(),this.activePanel=null);b.setState("closed");b.onClose();b.domNode&&a.setStyle(b.domNode,"display","none")})},minimizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("minimized");try{a.onMinimize()}catch(n){console.log(console.error("fail to minimize panel "+
a.id+". "+n.stack))}},maximizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("maximized");try{a.onMaximize()}catch(n){console.log(console.error("fail to maximize panel "+a.id+". "+n.stack))}},normalizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("normal");try{a.onNormalize()}catch(n){console.log(console.error("fail to noralize panel "+
a.id+". "+n.stack))}},changeWindowStateTo:function(a,b){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"normal"===b?this.normalizePanel(a):"minimized"===b?this.minimizePanel(a):"maximized"===b?this.maximizePanel(a):console.log("error state: "+b)},getPanelById:function(a){for(var b=0;b<this.panels.length;b++)if(this.panels[b].id===a)return this.panels[b]},onWindowResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"!==this.panels[a].position.relativeTo&&
this.panels[a].resize()},onMapResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"===this.panels[a].position.relativeTo&&this.panels[a].resize()},destroyPanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;if(a.domNode){"closed"!==a.state&&this.closePanel(a);this._removePanel(a);try{a.destroy()}catch(n){console.log(console.error("fail to destroy panel "+a.id+". "+n.stack))}}},destroyAllPanels:function(){var a=d.map(this.panels,function(a){return a.id});
d.forEach(a,function(a){this.destroyPanel(a)},this);this.panels=[]},playOpenPanelAnimation:function(d){if("string"===typeof d&&(d=this.getPanelById(d),!d)||!d.openAnimation||0===d.animationDuration)return b();var e=new f;"string"===typeof d.openAnimation?"fadeIn"===d.openAnimation?(a.setStyle(d.domNode,{opacity:0,display:""}),g.fadeIn({node:d.domNode,duration:d.animationDuration,onEnd:function(){e.resolve()}}).play()):e.resolve():e.resolve();return e},playClosePanelAnimation:function(a){if("string"===
typeof a&&(a=this.getPanelById(a),!a)||!a.closeAnimation||0===a.animationDuration)return b();var d=new f;"string"===typeof a.closeAnimation&&("fadeOut"===a.closeAnimation?g.fadeOut({node:a.domNode,duration:a.animationDuration,onEnd:function(){d.resolve()}}).play():d.resolve());return d},getPositionOnMobile:function(b){if("string"===typeof b&&(b=this.getPanelById(b),!b))return{};var d=a.getMarginBox(window.jimuConfig.layoutId),e=d.h/2;b.titleHeight||(b.titleHeight=35);return"maximized"===b.windowState?
{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:d.h-b.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===b.windowState?d.h>d.w?{left:0,right:0,top:"auto",bottom:0,width:"auto",height:b.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:d.w-d.w/2,right:0,top:"auto",bottom:0,width:d.w/
2,height:b.titleHeight,contentHeight:d.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}:d.h>d.w?{left:0,right:0,top:e,bottom:0,width:"auto",height:"auto",contentHeight:d.h-e-b.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:
{left:d.w-d.w/2,right:0,top:0,bottom:0,width:d.w/2,height:"auto",contentHeight:d.h-e-b.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(a){this._activePanel(a)},_activePanel:function(b){if(this.activePanel){if(this.activePanel.id===b.id){this.activePanel.moveTopOnActive&&
a.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),a.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var d=this.widgetManager.activeWidget;d&&"active"===d.state&&d.getPanel()!==b&&(d.setState("opened"),!1===d.inPanel&&a.setStyle(d.domNode,"zIndex","undefined"!==typeof d.position.zIndex?d.position.zIndex:
"auto"),d.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=b;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&a.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(a){var b=this.panels.indexOf(a);-1<b&&this.panels.splice(b,1);this.activePanel&&this.activePanel.id===a.id&&(this.activePanel=null)},_onMoveStart:function(a){d.forEach(this.panels,function(b){b.domNode===a.node&&this._activePanel(b)},
this)},_onWidgetActived:function(b){this.activePanel&&"active"===this.activePanel.state&&b.getPanel()!==this.activePanel&&(this.activePanel.setState("opened"),a.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(a){var b=new f;l([a],function(a){b.resolve(a)});return b},_loadThemeI18N:function(a){var b=new f;a.startWith("themes")?(a=a.split("/"),
l(["dojo/i18n!"+(a[0]+"/"+a[1]+"/nls/strings")],function(a){b.resolve(a)})):b.resolve({});return b}});r.getInstance=function(){null===v&&(v=new r,window._panelManager=v);return v};return r})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(p,h,d,a){return p([a],{widget:null,baseClass:"jimu-widget-frame jimu-container",postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);
this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&"closed"!==this.widget.state&&h.isFunction(this.widget.resize)&&this.widget.resize()},setLoading:function(a){this.loading=a;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(a){this.widget=a;this.loading&&this.loading.destroy();d.place(a.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&
this.widget.domNode)try{this.widget.destroy()}catch(g){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+g.stack)}this.loading&&this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),function(p,h,d,a,g,f,k,m,e){return p([g,f],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",
windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var a=this.getAllWidgetConfigs(),a=Array.isArray(this.config.widgets)?this.config.widgets:[this.config];d.forEach(a,function(a){var b,d;!1!==a.visible&&(d=new k,b=this.createFrame(a),this.addChild(b),b.setLoading(d),this.widgetManager.loadWidget(a).then(h.hitch(this,function(a){b.setWidget(a);
a.startup()})))},this)},getAllWidgetConfigs:function(){var a=[];return a=Array.isArray(this.config.widgets)?this.config.widgets:[this.config]},getWidgetById:function(a){for(var b=this.getChildren(),d=0;d<b.length;d++)if(b[d].getWidget()&&b[d].getWidget().id===a)return b[d].getWidget()},createFrame:function(a){return new m},setPosition:function(b,d){this.position=b;var f=e.getPositionStyle(this.position);f.position="absolute";d||(d="map"===b.relativeTo?this.sceneView.map.id:window.jimuConfig.layoutId);
this.started?this.resize():this.openAnimation&&(f.display="none");a.place(this.domNode,d);a.setStyle(this.domNode,f)},getPosition:function(){return this.position},setState:function(a){this.state=a},setWindowState:function(a){this.windowState=a},resize:function(){this.getChildren().forEach(function(a){a.resize()})},onPositionChange:function(a){this.setPosition(a)},onOpen:function(){d.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.openWidget(a.getWidget())},this)},onClose:function(){d.forEach(this.getChildren(),
function(a){a.getWidget()&&this.widgetManager.closeWidget(a.getWidget())},this)},onMaximize:function(){d.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.maximizeWidget(a.getWidget())},this)},onMinimize:function(){d.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.minimizeWidget(a.getWidget())},this)},onNormalize:function(){d.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.normalizeWidget(a.getWidget())},this)},onActive:function(){},
onDeActive:function(){},updateConfig:function(a){this._updateConfig(a)},reloadWidget:function(a){this.isWidgetInPanel(a)&&(this._updateConfig(a),this.getChildren().forEach(function(b){b.getWidget()&&b.getWidget().id===a.id&&(b.getWidget().destroy(),b.setLoading(new k),this.widgetManager.loadWidget(a).then(h.hitch(this,function(a){b.setWidget(a);a.startup();"closed"===this.state&&this.widgetManager.closeWidget(a)})))},this))},isWidgetInPanel:function(a){return d.some(this.getAllWidgetConfigs(),function(b){if(a.id===
b.id)return!0})?!0:!1},_updateConfig:function(a){if(Array.isArray(this.config.widgets)){for(var b=-1,d=0;d<this.config.widgets.length;d++)this.config.widgets[d].id===a.id&&(b=d);0<b&&(this.config.widgets[b]=a)}else this.config=a},destroy:function(){this.getChildren().forEach(function(a){try{a.domNode&&a.destroy()}catch(l){console.error("destroy widget frame error."+l.stack)}});this.inherited(arguments)}})})},"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase",
"dojo/dom-style","dojo/dom-construct"],function(p,h,d,a){return p(h,{baseClass:"jimu-loading-indicator",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);(this.hidden=!0===this.hidden)&&d.set(this.domNode,{display:"none"});d.set(this.domNode,{width:"100%",height:"100%"});var g='\x3cdiv class\x3d"loading-section"\x3e\x3cimg class\x3d"jimu-loading" src\x3d"'+require.toUrl("jimu")+'/images/loading2.gif"\x3e\x3c/div\x3e';a.place(g,this.domNode)},show:function(){this.domNode&&
d.set(this.domNode,"display","block")},hide:function(){this.domNode&&d.set(this.domNode,"display","none")}})})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(p,h,d,a,g){return p([a,g],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(d(window,"resize",h.hitch(this,this._onWindowResize)))},getConfig:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},
"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array","jimu/PanelManager"],function(p,h,d){return p(null,{constructor:function(){this.panelManager=d.getInstance()},postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(a){},getConfigById:function(a){for(var d=this.getAllConfigs(),f=0;f<d.length;f++)if(d[f].id===a)return d[f]},getAllConfigs:function(){var a=
[],a=a.concat(this.getWidgetConfigs(),this.getGroupConfigs()),a=h.filter(a,function(a){return a.visible});return a.sort(function(a,d){return a.index-d.index})},getAllConfigsIncludeInvisible:function(){var a=[],a=a.concat(this.getWidgetConfigs(),this.getGroupConfigs());return a.sort(function(a,d){return a.index-d.index})},isControlled:function(a){return h.some(this.getAllConfigsIncludeInvisible(),function(d){return d.id===a})},widgetIsControlled:function(a){return h.some(this.getAllConfigsIncludeInvisible(),
function(d){return d.id===a?!0:h.some(d.widgets,function(d){return d.id===a})})},getGroupConfigs:function(){var a=[];if(!this.appConfig.widgetPool)return a;this.appConfig.widgetPool.groups&&h.forEach(this.appConfig.widgetPool.groups,function(d){this.controlledGroups&&(Array.isArray(this.controlledGroups)?-1<this.controlledGroups.indexOf(d.id)&&a.push(d):"all"===this.controlledGroups&&a.push(d))},this);return a},getWidgetConfigs:function(){var a=[];if(!this.appConfig.widgetPool)return a;this.appConfig.widgetPool.widgets&&
h.forEach(this.appConfig.widgetPool.widgets,function(d){this.controlledWidgets&&(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(d.id)&&a.push(d):"all"===this.controlledWidgets&&a.push(d))},this);return a}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/geometry/SpatialReference ./unitUtils".split(" "),function(p,h,d,a,g,f,k,m){var e=null,b=null,l=!1;p=p(null,function(){});
var t=require.toUrl("jimu"),u=f(t+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),r=f(t+"/SpatialReference/transform.json",{handleAs:"json"});p.loadResource=function(){var d=new a;if(e&&b)return d.resolve(),d;g([u,r]).then(function(a){e=a[0];b=a[1];l=!0;d.resolve()},function(a){console.error(a);l=!1;d.reject(a)});return d};p.getAllCSUnits=function(){if(l){var a=[];d.forEach(e.wkids,h.hitch(this,function(b){b=this.getCSUnit(b);-1===d.indexOf(a,b)&&a.push(b)}));return a}};p.convertUnit=function(a,
b,d){if(l)return m.convertUnit(a,b,d)};p.getUnitRate=function(a,b){if(l)return m.getUnitRate(a,b)};p.isProjectUnit=function(a){if(l)return m.isProjectUnit(a)};p.isGeographicUnit=function(a){if(l)return m.isGeographicUnit(a)};p.getGeographicUnits=function(){if(l)return m.getGeographicUnits()};p.getProjectUnits=function(){if(l)return m.getProjectUnits()};p.getCSUnit=function(a){if(l){a=this.getCSStr(a);var b=0,d=0,b=a.lastIndexOf("UNIT"),d=a.indexOf(",",b);return a.slice(b+6,d-1)}};p.isSameSR=function(a,
b){if(l)return a=this.indexOfWkid(a),b=this.indexOfWkid(b),e.labels[a]===e.labels[b]};p.isValidWkid=function(a){if(l)return-1<this.indexOfWkid(a)};p.getSRLabel=function(a){if(l&&this.isValidWkid(a))return a=this.indexOfWkid(a),e.labels[a]};p.indexOfWkid=function(a){if(l)return d.indexOf(e.wkids,a)};p.isWebMercator=function(a){return k.prototype._isWebMercator?k.prototype._isWebMercator.apply({wkid:parseInt(a,10)},[]):(new k(parseInt(a,10))).isWebMercator};p.standardizeWkid=function(a){return this.isWebMercator(a)?
3857:parseInt(a,10)};p.isValidTfWkid=function(a){if(l)return-1<this.indexOfTfWkid(a)};p.getTransformationLabel=function(a){if(l)return this.isValidTfWkid(a)?(a=this.indexOfTfWkid(a),b.labels[a]):""};p.indexOfTfWkid=function(a){if(l)return d.indexOf(b.tfWkids,a)};p.isGeographicCS=function(a){if(l)return this.isValidWkid(a)?e.details[this.indexOfWkid(a)].startWith("GEOGCS"):!1};p.isProjectedCS=function(a){if(l)return this.isValidWkid(a)?e.details[this.indexOfWkid(a)].startWith("PROJCS"):!1};p.getGeoCSByProj=
function(a){if(l&&this.isProjectedCS(a))return a=this.getSpheroidStr(a),a=d.indexOf(e.details,a),e.wkids[a]};p.getSpheroidStr=function(a){if(l){if(this.isGeographicCS(a))return e.details[this.indexOfWkid(a)];if(this.isProjectedCS(a)){a=e.details[this.indexOfWkid(a)];var b=a.indexOf("GEOGCS"),d=a.indexOf("PROJECTION")-1;return a.slice(b,d)}return null}};p.getCSStr=function(a){if(l)return e.details[this.indexOfWkid(a)]};p.isSameSpheroid=function(a,b){if(l)return a=this.getSpheroidStr(a),b=this.getSpheroidStr(b),
a&&b&&a===b?!0:!1};return p})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare","dojo/_base/array"],function(p,h){var d="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),a="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),
g={INCHES:.0254,FOOT:.3048,FOOT_US:.3048006096012192,YARDS:.9144,MILES:1609.344,NAUTICAL_MILES:1852,MILLIMETERS:.001,CENTIMETERS:.01,METER:1,KILOMETERS:1E3,DECIMETERS:.1,LINK_CLARKE:.2011661949,FOOT_GOLD_COAST:.3047997101815088,FOOT_CLARKE:.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:.9143984146160287,CHAIN_SEARS:20.11676512155263,FOOT_SEARS:.3047994715386762,YARD_INDIAN_1937:.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,
DEGREE:.0174532925199433,DECIMAL_DEGREES:.0174532925199433,MGRS:.0174532925199433,USNG:.0174532925199433,DEGREE_MINUTE_SECONDS:.0174532925199433,GRAD:.01570796326794897};p=p(null,function(){});p.convertUnit=function(a,d,h){return g[a.toUpperCase()]/g[d.toUpperCase()]*h};p.getUnitRate=function(a,d){return g[a.toUpperCase()]/g[d.toUpperCase()]};p.isProjectUnit=function(a){return-1<h.indexOf(d,a.toUpperCase())};p.isGeographicUnit=function(d){return-1<h.indexOf(a,d.toUpperCase())};p.getGeographicUnits=
function(){return a};p.getProjectUnits=function(){return d};return p})},"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle dojo/touch".split(" "),function(p,h,d,a,g,f,k,m,e){return p([k,f],{baseClass:"jimu-panel jimu-on-screen-widget-panel",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title jimu-main-background" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode"\x3e${label}\x3c/div\x3e\x3cdiv class\x3d"close-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,press:_onCloseBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"max-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"foldable-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w)},_onMaxBtnClicked:function(a){a.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?this.panelManager.normalizePanel(this):this.panelManager.maximizePanel(this),this._setMobilePosition())},_onFoldableBtnClicked:function(a){a.stopPropagation();
this._getPositionInfo().isRunInMobile&&("minimized"===this.windowState?(d.removeClass(this.foldableNode,"fold-up"),d.addClass(this.foldableNode,"fold-down"),this.panelManager.normalizePanel(this)):(d.removeClass(this.foldableNode,"fold-down"),d.addClass(this.foldableNode,"fold-up"),this.panelManager.minimizePanel(this)),this._setMobilePosition())},_onCloseBtnClicked:function(a){this.panelManager.closePanel(this);a.stopPropagation()},_normalizePositionObj:function(a){var b=this._getLayoutBox();a.left=
isFinite(a.left)?a.left:b.w-a.right;a.top=isFinite(a.top)?a.top:b.h-a.bottom;delete a.right;delete a.bottom;this.position=h.mixin(h.clone(this.position),a)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();
this.resizeHandle=(new e({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(b,e){this.disableMoveable();var f=d.getMarginBox(jimuConfig.layoutId);f.l=f.l-b+e;f.w+=2*(b-e);this.moveable=new g.boxConstrainedMoveable(this.domNode,{box:f,handle:this.titleNode,within:!0});this.own(a(this.moveable,
"Moving",h.hitch(this,this.onMoving)));this.own(a(this.moveable,"MoveStop",h.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);this.inherited(arguments)},_switchToMobileUI:function(){d.removeClass(this.titleNode,"title-normal");d.addClass(this.titleNode,"title-full");d.setStyle(this.foldableNode,"display",
"block");d.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(d.removeClass(this.foldableNode,"fold-up"),d.addClass(this.foldableNode,"fold-down")):(d.removeClass(this.foldableNode,"fold-down"),d.addClass(this.foldableNode,"fold-up"))},_switchToDesktopUI:function(){d.removeClass(this.titleNode,"title-full");d.addClass(this.titleNode,"title-normal");d.setStyle(this.foldableNode,"display","none");d.setStyle(this.maxNode,"display","none")},resize:function(a){var b=this._getPositionInfo(),
d={left:b.position.left,top:b.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};a&&(a.t=this.domNode.offsetTop,d.left=isFinite(a.l)?a.l:d.left,d.top=isFinite(a.t)?a.t:d.top,d.width=isFinite(a.w)?a.w:d.width,d.height=isFinite(a.h)?a.h:d.height,this._normalizePositionObj(h.clone(d)),this.makePositionInfoBox(),d.width=this._positionInfoBox.w,d.height=this._positionInfoBox.h);b.position=d;this._onResponsible(b);this.inherited(arguments)},_onResponsible:function(a){a.isRunInMobile?
(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(a.position),this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(a){this._normalizePositionObj(a);this.makePositionInfoBox();a=this._getPositionInfo();this._onResponsible(a)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var a=jimuConfig.layoutId,
a="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return d.getMarginBox(a)},_getPositionInfo:function(){var a={isRunInMobile:!1,position:{left:0,top:5}},d=this._getLayoutBox(),e=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return a.isRunInMobile=!0,a;a.position.left=window.isRTL?d.w-e:e;var e=this._positionInfoBox.t,f=d.h-e;e>=f?e>=this._positionInfoBox.h&&(a.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):f>=this._positionInfoBox.h&&(a.position.top=
this._positionInfoBox.t+40+3);!a.isRunInMobile&&a.position.left+this._positionInfoBox.w>d.w&&(a.position.left-=this._positionInfoBox.w);return a},_setMobilePosition:function(){d.place(this.domNode,jimuConfig.layoutId);var a=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(a.zIndex=this.position.zIndex);var e=m.getPositionStyle(a);h.mixin(e,a.borderRadiusStyle);d.setStyle(this.domNode,e)},_setDesktopPosition:function(a){d.place(this.domNode,jimuConfig.mapId);d.setStyle(this.domNode,
{left:a.left+"px",right:"auto",top:a.top+"px",width:(a.width||this.position.width||this._originalBox.w)+"px",height:(a.height||this.position.height||this._originalBox.h)+"px"})},onMoving:function(a){d.setStyle(a.node,"opacity",.9)},onMoveStop:function(a){d.setStyle(a.node,"opacity",1);a=d.getMarginBox(a.node);this._normalizePositionObj(h.clone({left:a.l,top:a.t,width:a.w,height:a.h}));this.makePositionInfoBox()}})})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n){p.experimental("dojox.layout.ResizeHandle");var w=u("dojox.layout._ResizeHelper",q,{show:function(){t.set(this.domNode,"display","")},hide:function(){t.set(this.domNode,"display","none")},resize:function(a){l.setMarginBox(this.domNode,a)}});return u("dojox.layout.ResizeHandle",[q,n],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,
minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,r.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=v.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new w({id:"dojoxGlobalResizeHelper"})).placeAt(k.body()),
b.add(this._resizeHelper.domNode,this.activeResizeClass)));this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var a=h.partial(b.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;a("dojoxResizeNW");break;case "x":this._resizeX=!0;a("dojoxResizeW");break;case "y":this._resizeY=!0,a("dojoxResizeN")}},_beginSizing:function(a){if(!this._isSizing&&
(d.publish(this.startTopic,[this]),this.targetDomNode=(this.targetWidget=v.byId(this.targetId))?this.targetWidget.domNode:e.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var c=l.position(this.targetDomNode,!0);this._resizeHelper.resize({l:c.x,t:c.y,w:c.w,h:c.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:c.x,t:c.y})}this._isSizing=!0;this.startPoint={x:a.clientX,y:a.clientY};
var c=t.getComputedStyle(this.targetDomNode),b="border-model"===l.boxModel?{w:0,h:0}:l.getPadBorderExtents(this.targetDomNode,c),f=l.getMarginExtents(this.targetDomNode,c);this.startSize={w:t.get(this.targetDomNode,"width",c),h:t.get(this.targetDomNode,"height",c),pbw:b.w,pbh:b.h,mw:f.w,mh:f.h};this.isLeftToRight()||"absolute"!=t.get(this.targetDomNode,"position")||(c=l.position(this.targetDomNode,!0),this.startPosition={l:c.x,t:c.y});this._pconnects=[d.connect(k.doc,r.move,this,"_updateSizing"),
d.connect(k.doc,r.release,this,"_endSizing")];g.stop(a)}},_updateSizing:function(a){if(this.activeResize)this._changeSizing(a);else{var c=this._getNewCoords(a,"border",this._resizeHelper.startPosition);if(!1===c)return;this._resizeHelper.resize(c)}a.preventDefault()},_getNewCoords:function(a,b,d){try{if(!a.clientX||!a.clientY)return!1}catch(B){return!1}this._activeResizeLastEvent=a;var c=(this.isLeftToRight()?1:-1)*(this.startPoint.x-a.clientX),e=this.startPoint.y-a.clientY;a=this.startSize.w-(this._resizeX?
c:0);e=this._checkConstraints(a,this.startSize.h-(this._resizeY?e:0));(d=d||this.startPosition)&&this._resizeX&&(e.l=d.l+c,e.w!=a&&(e.l+=a-e.w),e.t=d.t);switch(b){case "margin":e.w+=this.startSize.mw,e.h+=this.startSize.mh;case "border":e.w+=this.startSize.pbw,e.h+=this.startSize.pbh}return e},_checkConstraints:function(a,b){if(this.minSize){var c=this.minSize;a<c.w&&(a=c.w);b<c.h&&(b=c.h)}this.constrainMax&&this.maxSize&&(c=this.maxSize,a>c.w&&(a=c.w),b>c.h&&(b=c.h));if(this.fixedAspect){var c=this.startSize.w,
d=this.startSize.h,e=c*b-d*a;0>e?a=b*c/d:0<e&&(b=a*d/c)}return{w:a,h:b}},_changeSizing:function(a){var c=this.targetWidget&&h.isFunction(this.targetWidget.resize),b=this._getNewCoords(a,c&&"margin");if(!1!==b&&(c?this.targetWidget.resize(b):this.animateSizing?m[this.animateMethod]([f.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:b.w}},duration:this.animateDuration}),f.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:b.h}},
duration:this.animateDuration})]).play():t.set(this.targetDomNode,{width:b.w+"px",height:b.h+"px"}),this.intermediateChanges))this.onResize(a)},_endSizing:function(c){a.forEach(this._pconnects,d.disconnect);var b=h.partial(d.publish,this.endTopic,[this]);this.activeResize?b():(this._resizeHelper.hide(),this._changeSizing(c),setTimeout(b,this.animateDuration+15));this._isSizing=!1;this.onResize(c)},onResize:function(a){}})})},"dojo/fx":function(){define("./_base/lang ./Evented ./_base/kernel ./_base/array ./aspect ./_base/fx ./dom ./dom-style ./dom-geometry ./ready require".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l){d.isAsync||b(0,function(){l(["./fx/Toggler"])});d=d.fx={};b={_fire:function(a,b){this[a]&&this[a].apply(this,b||[]);return this}};var t=function(b){this._index=-1;this._animations=b||[];this._current=this._onAnimateCtx=this._onEndCtx=null;this.duration=0;a.forEach(this._animations,function(a){a&&("undefined"!=typeof a.duration&&(this.duration+=a.duration),a.delay&&(this.duration+=a.delay))},this)};t.prototype=new h;p.extend(t,{_onAnimate:function(){this._fire("onAnimate",
arguments)},_onEnd:function(){this._onAnimateCtx.remove();this._onEndCtx.remove();this._onAnimateCtx=this._onEndCtx=null;this._index+1==this._animations.length?this._fire("onEnd"):(this._current=this._animations[++this._index],this._onAnimateCtx=g.after(this._current,"onAnimate",p.hitch(this,"_onAnimate"),!0),this._onEndCtx=g.after(this._current,"onEnd",p.hitch(this,"_onEnd"),!0),this._current.play(0,!0))},play:function(a,b){this._current||(this._current=this._animations[this._index=0]);if(!b&&"playing"==
this._current.status())return this;var d=g.after(this._current,"beforeBegin",p.hitch(this,function(){this._fire("beforeBegin")}),!0),e=g.after(this._current,"onBegin",p.hitch(this,function(a){this._fire("onBegin",arguments)}),!0),f=g.after(this._current,"onPlay",p.hitch(this,function(a){this._fire("onPlay",arguments);d.remove();e.remove();f.remove()}));this._onAnimateCtx&&this._onAnimateCtx.remove();this._onAnimateCtx=g.after(this._current,"onAnimate",p.hitch(this,"_onAnimate"),!0);this._onEndCtx&&
this._onEndCtx.remove();this._onEndCtx=g.after(this._current,"onEnd",p.hitch(this,"_onEnd"),!0);this._current.play.apply(this._current,arguments);return this},pause:function(){if(this._current){var a=g.after(this._current,"onPause",p.hitch(this,function(b){this._fire("onPause",arguments);a.remove()}),!0);this._current.pause()}return this},gotoPercent:function(b,d){this.pause();var e=this.duration*b;this._current=null;a.some(this._animations,function(a,b){if(e<=a.duration)return this._current=a,this._index=
b,!0;e-=a.duration;return!1},this);this._current&&this._current.gotoPercent(e/this._current.duration);d&&this.play();return this},stop:function(a){if(this._current){if(a){for(;this._index+1<this._animations.length;++this._index)this._animations[this._index].stop(!0);this._current=this._animations[this._index]}var b=g.after(this._current,"onStop",p.hitch(this,function(a){this._fire("onStop",arguments);b.remove()}),!0);this._current.stop()}return this},status:function(){return this._current?this._current.status():
"stopped"},destroy:function(){this.stop();this._onAnimateCtx&&this._onAnimateCtx.remove();this._onEndCtx&&this._onEndCtx.remove()}});p.extend(t,b);d.chain=function(a){return new t(p.isArray(a)?a:Array.prototype.slice.call(a,0))};var u=function(b){this._animations=b||[];this._connects=[];this.duration=this._finished=0;a.forEach(b,function(a){var b=a.duration;a.delay&&(b+=a.delay);this.duration<b&&(this.duration=b);this._connects.push(g.after(a,"onEnd",p.hitch(this,"_onEnd"),!0))},this);this._pseudoAnimation=
new f.Animation({curve:[0,1],duration:this.duration});var d=this;a.forEach("beforeBegin onBegin onPlay onAnimate onPause onStop onEnd".split(" "),function(a){d._connects.push(g.after(d._pseudoAnimation,a,function(){d._fire(a,arguments)},!0))})};p.extend(u,{_doAction:function(b,d){a.forEach(this._animations,function(a){a[b].apply(a,d)});return this},_onEnd:function(){++this._finished>this._animations.length&&this._fire("onEnd")},_call:function(a,b){var d=this._pseudoAnimation;d[a].apply(d,b)},play:function(a,
b){this._finished=0;this._doAction("play",arguments);this._call("play",arguments);return this},pause:function(){this._doAction("pause",arguments);this._call("pause",arguments);return this},gotoPercent:function(b,d){var e=this.duration*b;a.forEach(this._animations,function(a){a.gotoPercent(a.duration<e?1:e/a.duration,d)});this._call("gotoPercent",arguments);return this},stop:function(a){this._doAction("stop",arguments);this._call("stop",arguments);return this},status:function(){return this._pseudoAnimation.status()},
destroy:function(){this.stop();a.forEach(this._connects,function(a){a.remove()})}});p.extend(u,b);d.combine=function(a){return new u(p.isArray(a)?a:Array.prototype.slice.call(a,0))};d.wipeIn=function(a){var b=a.node=k.byId(a.node),d=b.style,e;a=f.animateProperty(p.mixin({properties:{height:{start:function(){e=d.overflow;d.overflow="hidden";if("hidden"==d.visibility||"none"==d.display)return d.height="1px",d.display="",d.visibility="",1;var a=m.get(b,"height");return Math.max(a,1)},end:function(){return b.scrollHeight}}}},
a));var h=function(){d.height="auto";d.overflow=e};g.after(a,"onStop",h,!0);g.after(a,"onEnd",h,!0);return a};d.wipeOut=function(a){var b=(a.node=k.byId(a.node)).style,d;a=f.animateProperty(p.mixin({properties:{height:{end:1}}},a));g.after(a,"beforeBegin",function(){d=b.overflow;b.overflow="hidden";b.display=""},!0);var e=function(){b.overflow=d;b.height="auto";b.display="none"};g.after(a,"onStop",e,!0);g.after(a,"onEnd",e,!0);return a};d.slideTo=function(a){var b=null,d=null,h=function(a){return function(){var c=
m.getComputedStyle(a),f=c.position;b="absolute"==f?a.offsetTop:parseInt(c.top)||0;d="absolute"==f?a.offsetLeft:parseInt(c.left)||0;"absolute"!=f&&"relative"!=f&&(c=e.position(a,!0),b=c.y,d=c.x,a.style.position="absolute",a.style.top=b+"px",a.style.left=d+"px")}}(a.node=k.byId(a.node));h();a=f.animateProperty(p.mixin({properties:{top:a.top||0,left:a.left||0}},a));g.after(a,"beforeBegin",h,!0);return a};return d})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),
function(p,h,d,a,g,f,k,m,e){return f("dijit.layout._LayoutWidget",[h,d,a],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);k.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var a=this.getParent&&this.getParent();a&&a.isLayoutContainer||(this.resize(),this.own(g.on("resize",p.hitch(this,"resize"))))}},resize:function(a,d){var b=this.domNode;a&&m.setMarginBox(b,a);d=d||{};
p.mixin(d,a||{});"h"in d&&"w"in d||(d=p.mixin(m.getMarginBox(b),d));a=e.getComputedStyle(b);var f=m.getMarginExtents(b,a),g=m.getBorderExtents(b,a);d=this._borderBox={w:d.w-(f.w+g.w),h:d.h-(f.h+g.h)};f=m.getPadExtents(b,a);this._contentBox={l:e.toPixelValue(b,a.paddingLeft),t:e.toPixelValue(b,a.paddingTop),w:d.w-f.w,h:d.h-f.h};this.layout()},layout:function(){},_setupChild:function(a){k.add(a.domNode,this.baseClass+"-child "+(a.baseClass?this.baseClass+"-"+a.baseClass:""))},addChild:function(a,d){this.inherited(arguments);
this._started&&this._setupChild(a)},removeChild:function(a){k.remove(a.domNode,this.baseClass+"-child"+(a.baseClass?" "+this.baseClass+"-"+a.baseClass:""));this.inherited(arguments)}})})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(p,h){return p("dijit._Contained",null,{_getSibling:function(d){var a=this.getParent();return a&&a._getSiblingOfChild&&a._getSiblingOfChild(this,"previous"==d?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},
getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var d=this.getParent();return d&&d.getIndexOfChild?d.getIndexOfChild(this):-1}})})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q){l("dijit-legacy-requires")&&q(0,function(){p(["dijit/MenuItem",
"dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return d("dijit.Menu",v,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):h.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return u.get(this._iframeContentDocument(a))||this._iframeContentDocument(a).__parent__||
a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(d){d=a.byId(d,this.ownerDocument);var f;if("iframe"==d.tagName.toLowerCase()){var c=d;f=this._iframeContentWindow(c);f=t.body(f.document)}else f=d==t.body(this.ownerDocument)?this.ownerDocument.documentElement:d;var h={node:d,iframe:c};g.set(d,"_dijitMenu"+this.id,
this._bindings.push(h));var k=e.hitch(this,function(a){var d=this.selector,e=d?function(a){return b.selector(d,a)}:function(a){return a},f=this;return[b(a,e(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<f._lastKeyDown+500||f._scheduleOpen(this,c,{x:a.pageX,y:a.pageY},a.target)}),b(a,e("keydown"),function(a){if(93==a.keyCode||a.shiftKey&&a.keyCode==m.F10||f.leftClickToOpen&&a.keyCode==m.SPACE)a.stopPropagation(),a.preventDefault(),
f._scheduleOpen(this,c,null,a.target),f._lastKeyDown=(new Date).getTime()})]});h.connects=f?k(f):[];c&&(h.onloadHandler=e.hitch(this,function(){var a=this._iframeContentWindow(c),a=t.body(a.document);h.connects=k(a)}),c.addEventListener?c.addEventListener("load",h.onloadHandler,!1):c.attachEvent("onload",h.onloadHandler))},unBindDomNode:function(b){var d;try{d=a.byId(b,this.ownerDocument)}catch(A){return}b="_dijitMenu"+this.id;if(d&&g.has(d,b)){for(var c=g.get(d,b)-1,e=this._bindings[c],f;f=e.connects.pop();)f.remove();
(f=e.iframe)&&(f.removeEventListener?f.removeEventListener("load",e.onloadHandler,!1):f.detachEvent("onload",e.onloadHandler));g.remove(d,b);delete this._bindings[c]}},_scheduleOpen:function(a,b,c,d){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:d,delegatedTarget:a,iframe:b,coords:c})},1))},_openMyself:function(b){function d(){q.refocus&&u&&u.focus();r.close(q)}var c=b.target,e=b.iframe,g=b.coords,h=!g;this.currentTarget=b.delegatedTarget;
if(g){if(e){b=f.position(e,!0);var c=this._iframeContentWindow(e),c=f.docScroll(c.document),n=k.getComputedStyle(e),m=k.toPixelValue,p=(l("ie"),m(e,n.paddingLeft))+(l("ie"),0),e=(l("ie"),m(e,n.paddingTop))+(l("ie"),0);g.x+=b.x+p-c.x;g.y+=b.y+e-c.y}}else g=f.position(c,!0),g.x+=10,g.y+=10;var q=this,e=this._focusManager.get("prevNode");b=this._focusManager.get("curNode");var u=!b||a.isDescendant(b,this.domNode)?e:b;r.open({popup:this,x:g.x,y:g.y,onExecute:d,onCancel:d,orient:this.isLeftToRight()?"L":
"R"});this.focus();h||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);r.close(this)}},destroy:function(){h.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dijit/popup":function(){define("dojo/_base/array dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on ./place ./BackgroundIframe ./Viewport ./main dojo/touch".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q){function n(){this._popupWrapper&&(f.destroy(this._popupWrapper),delete this._popupWrapper)}d=d(null,{_stack:[],_beginZIndex:1E3,_idGen:1,_repositionAll:function(){if(this._firstAroundNode){var a=this._firstAroundPosition,c=k.position(this._firstAroundNode,!0),b=c.x-a.x,a=c.y-a.y;if(b||a)for(this._firstAroundPosition=c,c=0;c<this._stack.length;c++){var d=this._stack[c].wrapper.style;d.top=parseFloat(d.top)+a+"px";"auto"==d.right?d.left=parseFloat(d.left)+b+
"px":d.right=parseFloat(d.right)-b+"px"}this._aroundMoveListener=setTimeout(l.hitch(this,"_repositionAll"),b||a?10:50)}},_createWrapper:function(a){var c=a._popupWrapper,b=a.domNode;c||(c=f.create("div",{"class":"dijitPopup",style:{display:"none"},role:"region","aria-label":a["aria-label"]||a.label||a.name||a.id},a.ownerDocumentBody),c.appendChild(b),b=b.style,b.display="",b.visibility="",b.position="",b.top="0px",a._popupWrapper=c,h.after(a,"destroy",n,!0),"ontouchend"in document&&t(c,"touchend",
function(a){/^(input|button|textarea)$/i.test(a.target.tagName)||a.preventDefault()}),c.dojoClick=!0);return c},moveOffScreen:function(a){var c=this._createWrapper(a);a=k.isBodyLtr(a.ownerDocument);var b={visibility:"hidden",top:"-9999px",display:""};b[a?"left":"right"]="-9999px";b[a?"right":"left"]="auto";m.set(c,b);return c},hide:function(a){var c=this._createWrapper(a);m.set(c,{display:"none",height:"auto",overflowY:"visible",border:""});a=a.domNode;"_originalStyle"in a&&(a.style.cssText=a._originalStyle)},
getTopPopup:function(){for(var a=this._stack,c=a.length-1;0<c&&a[c].parent===a[c-1].widget;c--);return a[c]},open:function(d){for(var c=this._stack,f=d.popup,h=f.domNode,n=d.orient||["below","below-alt","above","above-alt"],p=d.parent?d.parent.isLeftToRight():k.isBodyLtr(f.ownerDocument),q=d.around,w=d.around&&d.around.id?d.around.id+"_dropdown":"popup_"+this._idGen++;c.length&&(!d.parent||!a.isDescendant(d.parent.domNode,c[c.length-1].widget.domNode));)this.close(c[c.length-1].widget);var C=this.moveOffScreen(f);
f.startup&&!f._started&&f.startup();var G,J=k.position(h);if("maxHeight"in d&&-1!=d.maxHeight)G=d.maxHeight||Infinity;else{G=v.getEffectiveBox(this.ownerDocument);var F=q?k.position(q,!1):{y:d.y-(d.padding||0),h:2*(d.padding||0)};G=Math.floor(Math.max(F.y,G.h-(F.y+F.h)))}J.h>G&&(J=m.getComputedStyle(h),m.set(C,{overflowY:"scroll",height:G+"px",border:J.borderLeftWidth+" "+J.borderLeftStyle+" "+J.borderLeftColor}),h._originalStyle=h.style.cssText,h.style.border="none");g.set(C,{id:w,style:{zIndex:this._beginZIndex+
c.length},"class":"dijitPopup "+(f.baseClass||f["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:d.parent?d.parent.id:""});0==c.length&&q&&(this._firstAroundNode=q,this._firstAroundPosition=k.position(q,!0),this._aroundMoveListener=setTimeout(l.hitch(this,"_repositionAll"),50));e("config-bgIframe")&&!f.bgIframe&&(f.bgIframe=new r(C));w=f.orient?l.hitch(f,"orient"):null;n=q?u.around(C,q,n,p,w):u.at(C,d,"R"==n?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],d.padding,w);C.style.visibility="visible";
h.style.visibility="visible";h=[];h.push(t(C,"keydown",l.hitch(this,function(a){if(a.keyCode==b.ESCAPE&&d.onCancel)a.stopPropagation(),a.preventDefault(),d.onCancel();else if(a.keyCode==b.TAB&&(a.stopPropagation(),a.preventDefault(),(a=this.getTopPopup())&&a.onCancel))a.onCancel()})));f.onCancel&&d.onCancel&&h.push(f.on("cancel",d.onCancel));h.push(f.on(f.onExecute?"execute":"change",l.hitch(this,function(){var a=this.getTopPopup();if(a&&a.onExecute)a.onExecute()})));c.push({widget:f,wrapper:C,parent:d.parent,
onExecute:d.onExecute,onCancel:d.onCancel,onClose:d.onClose,handlers:h});if(f.onOpen)f.onOpen(n);return n},close:function(a){for(var c=this._stack;a&&p.some(c,function(c){return c.widget==a})||!a&&c.length;){var b=c.pop(),d=b.widget,e=b.onClose;d.bgIframe&&(d.bgIframe.destroy(),delete d.bgIframe);if(d.onClose)d.onClose();for(var f;f=b.handlers.pop();)f.remove();d&&d.domNode&&this.hide(d);e&&e()}0==c.length&&this._aroundMoveListener&&(clearTimeout(this._aroundMoveListener),this._firstAroundNode=this._firstAroundPosition=
this._aroundMoveListener=null)}});return q.popup=new d})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(p,h,d,a){return p("dijit.DropDownMenu",a,{templateString:d,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(a){this._moveToPopup(a);a.stopPropagation();a.preventDefault()},_onLeftArrow:function(a){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();
else this.onCancel(!1);else a.stopPropagation(),a.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v){return h("dijit._MenuBase",[t,v,r,u],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),
this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){g.toggle(this.domNode,"dijitMenuActive",a);g.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,childSelector:function(a){var b=l.byNode(a);return a.parentNode==this.containerNode&&b&&b.focus},postCreate:function(){var a=this,d="string"==typeof this.childSelector?this.childSelector:
f.hitch(this,"childSelector");this.own(m(this.containerNode,m.selector(d,k.enter),function(){a.onItemHover(l.byNode(this))}),m(this.containerNode,m.selector(d,k.leave),function(){a.onItemUnhover(l.byNode(this))}),m(this.containerNode,m.selector(d,b),function(b){a.onItemClick(l.byNode(this),b);b.stopPropagation()}),m(this.containerNode,m.selector(d,"focusin"),function(){a._onItemFocus(l.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(a,b,d,c){this.inherited(arguments);if(a&&(-1==
c||a.popup&&1==c))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},
onItemHover:function(a){this.activated?(this.set("selected",a),!a.popup||a.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,{type:"click"})},this.passivePopupDelay));this._hoveredChild=a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==
a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&
(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;a.popup?(this.set("selected",a),this.set("activated",!0),b=/^key/.test(b._origType||b.type)||0==b.clientX&&0==b.clientY,this._openItemPopup(a,b)):(this.onExecute(),a._onClick?a._onClick(b):a.onClick(b))},_openItemPopup:function(a,b){if(a!=
this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var d=a.popup;d.parentMenu=this;this.own(this._mouseoverHandle=m.once(d.domNode,"mouseover",f.hitch(this,"_onPopupHover")));var c=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){b&&c.focusChild(a);c._cleanUp()},onExecute:f.hitch(this,"_cleanUp",!0),onClose:function(){c._mouseoverHandle&&(c._mouseoverHandle.remove(),delete c._mouseoverHandle)}},
b);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(a.set(this.selected.focusNode,"tabIndex",this.tabIndex),this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=
a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),function(p,h,d,a,g,f,k,m,e,b){return h("dijit._KeyNavContainer",
[e,b,m],{connectKeyNavHandlers:function(a,b){var d=this._keyNavCodes={},e=f.hitch(this,"focusPrev"),h=f.hitch(this,"focusNext");p.forEach(a,function(a){d[a]=e});p.forEach(b,function(a){d[a]=h});d[g.HOME]=f.hitch(this,"focusFirstChild");d[g.END]=f.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){a.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);p.forEach(this.getChildren(),f.hitch(this,"_startupChild"))},addChild:function(a,
b){this.inherited(arguments);this._startupChild(a)},_startupChild:function(a){a.set("tabIndex","-1")},_getFirst:function(){var a=this.getChildren();return a.length?a[0]:null},_getLast:function(){var a=this.getChildren();return a.length?a[a.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(a){return(a=k.byNode(a))&&a.getParent()==this}})})},
"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(p,h,d,a,g,f,k,m){return h("dijit._KeyNavMixin",m,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);d.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var e=this._keyNavCodes={};e[a.HOME]=g.hitch(this,"focusFirstChild");e[a.END]=g.hitch(this,"focusLastChild");e[this.isLeftToRight()?
a.LEFT_ARROW:a.RIGHT_ARROW]=g.hitch(this,"_onLeftArrow");e[this.isLeftToRight()?a.RIGHT_ARROW:a.LEFT_ARROW]=g.hitch(this,"_onRightArrow");e[a.UP_ARROW]=g.hitch(this,"_onUpArrow");e[a.DOWN_ARROW]=g.hitch(this,"_onDownArrow")}var b=this,e="string"==typeof this.childSelector?this.childSelector:g.hitch(this,"childSelector");this.own(f(this.domNode,"keypress",g.hitch(this,"_onContainerKeypress")),f(this.domNode,"keydown",g.hitch(this,"_onContainerKeydown")),f(this.domNode,"focus",g.hitch(this,"_onContainerFocus")),
f(this.containerNode,f.selector(e,"focusin"),function(a){b._onChildFocus(k.getEnclosingWidget(this),a)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},
focusChild:function(a,b){a&&(this.focusedChild&&a!==this.focusedChild&&this._onChildBlur(this.focusedChild),a.set("tabIndex",this.tabIndex),a.focus(b?"end":"start"))},_onContainerFocus:function(a){a.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){d.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(a){d.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex","-1"),this.lastFocusedChild=this.focusedChild,
this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(a){a&&a!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),a.set("tabIndex",this.tabIndex),this.lastFocused=a,this._set("focusedChild",a))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(a,b,d,f){a&&this.focusChild(a)},_keyboardSearchCompare:function(a,b){var d=a.domNode;a=(a.label||(d.focusNode?d.focusNode.label:"")||d.innerText||d.textContent||
"").replace(/^\s+/,"").substr(0,b.length).toLowerCase();return b.length&&a==b?-1:0},_isFormElement:function(a){return"INPUT"===a.tagName||"TEXTAREA"===a.tagName||"SELECT"===a.tagName||"BUTTON"===a.tagName},_onContainerKeydown:function(d){if(!this._isFormElement(document.activeElement)){var b=this._keyNavCodes[d.keyCode];b?(b(d,this.focusedChild),d.stopPropagation(),d.preventDefault(),this._searchString=""):d.keyCode!=a.SPACE||!this._searchTimer||d.ctrlKey||d.altKey||d.metaKey||(d.stopImmediatePropagation(),
d.preventDefault(),this._keyboardSearch(d," "))}},_onContainerKeypress:function(d){this._isFormElement(document.activeElement)||d.charCode<=a.SPACE||d.ctrlKey||d.altKey||d.metaKey||(d.preventDefault(),d.stopPropagation(),this._keyboardSearch(d,String.fromCharCode(d.charCode).toLowerCase()))},_keyboardSearch:function(a,b){var d=null,e,f=0;g.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=b;var a=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;
e=this._searchString.substr(0,a);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var g=this.focusedChild||null;if(1==a||!g)if(g=this._getNextFocusableChild(g,1),!g)return;a=g;do{var h=this._keyboardSearchCompare(g,e);h&&0==f++&&(d=g);if(-1==h){f=-1;break}g=this._getNextFocusableChild(g,1)}while(g&&g!=a)})();this.onKeyboardSearch(d,a,e,f)},_onChildBlur:function(){},_getNextFocusableChild:function(a,b){var d=a;do{if(a)a=this._getNext(a,
b);else if(a=this[0<b?"_getFirst":"_getLast"](),!a)break;if(null!=a&&a!=d&&a.isFocusable())return a}while(a!=d);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(a,b){if(a)for(a=a.domNode;a;)if((a=a[0>b?"previousSibling":"nextSibling"])&&"getAttribute"in a){var d=k.byNode(a);if(d)return d}return null}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],function(p,h,d){return p([h,
d],{})})},"dgrid/Grid":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/on dojo/has ./List ./util/misc dojo/_base/sniff".split(" "),function(p,h,d,a,g,f,k,m){function e(a,d){d&&d.nodeType&&a.appendChild(d)}p=p(k,{columns:null,hasNeutralSort:!1,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(a){return"object"!==typeof a?this.columns[a]:this.cell(a).column},listType:"grid",cell:function(a,d){if(a.column&&a.element)return a;a.target&&a.target.nodeType&&
(a=a.target);var b;if(a.nodeType){do{if(this._rowIdToObject[a.id])break;var e=a.columnId;if(e){d=e;b=a;break}a=a.parentNode}while(a&&a!==this.domNode)}if(!b&&"undefined"!==typeof d){var f=this.row(a);if(e=f&&f.element)for(var e=e.getElementsByTagName("td"),g=0;g<e.length;g++)if(e[g].columnId===d){b=e[g];break}}if(null!=a)return{row:f||this.row(a),column:d&&this.column(d),element:b}},createRowCells:function(a,e,g,h,k){var b=d.create("table",{className:"dgrid-row-table",role:"presentation"}),l=9>f("ie")?
d.create("tbody",null,b):b,n,p,c,r,u,t,y,B,E,C;g=g||this.subRows;p=0;for(c=g.length;p<c;p++)for(t=g[p],n=d.create("tr",null,l),t.className&&(n.className=t.className),r=0,u=t.length;r<u;r++){y=t[r];B=y.id;E=y.field?" field-"+m.escapeCssIdentifier(y.field,"-"):"";(C="function"===typeof y.className?y.className(h):y.className)&&(E+=" "+C);E=d.create(a,{className:"dgrid-cell"+(B?" dgrid-column-"+m.escapeCssIdentifier(B,"-"):"")+E,role:"th"===a?"columnheader":"gridcell"});E.columnId=B;if(B=y.colSpan)E.colSpan=
B;if(B=y.rowSpan)E.rowSpan=B;e(E,y,h,k);n.appendChild(E)}return b},_createBodyRowCell:function(a,d,f,g){var b=f;d.get?b=d.get(f):"field"in d&&"_item"!==d.field&&(b=f[d.field]);d.renderCell?e(a,d.renderCell(f,b,a,g)):this._defaultRenderCell.call(d,f,b,a,g)},_createHeaderRowCell:function(a,d){var b=d.headerNode=a,f=d.field;f&&(a.field=f);d.renderHeaderCell?e(b,d.renderHeaderCell(b)):("label"in d||d.field)&&b.appendChild(document.createTextNode("label"in d?d.label:d.field));!1!==d.sortable&&f&&"_item"!==
f&&(a.sortable=!0,a.className+=" dgrid-sortable")},left:function(a,d){a.element||(a=this.cell(a));return this.cell(this._move(a,-(d||1),"dgrid-cell"))},right:function(a,d){a.element||(a=this.cell(a));return this.cell(this._move(a,d||1,"dgrid-cell"))},_defaultRenderCell:function(a,d,e){if(this.formatter){var b=this.formatter,f=this.grid.formatterScope;e.innerHTML="string"===typeof b&&f?f[b](d,a):this.formatter(d,a)}else null!=d&&e.appendChild(document.createTextNode(d))},renderRow:function(a,e){a=
this.createRowCells("td",h.hitch(this,"_createBodyRowCell"),e&&e.subRows,a,e);e=d.create("div",{role:"row"});e.appendChild(a);return e},renderHeader:function(){var a=this,e=this.headerNode;e.setAttribute("role","row");d.empty(e);var k=this.createRowCells("th",h.hitch(this,"_createHeaderRowCell"),this.subRows&&this.subRows.headerRows);this._rowIdToObject[k.id=this.id+"-header"]=this.columns;e.appendChild(k);this._sortListener&&this._sortListener.remove();this._sortListener=g(k,"click,keydown",function(b){if("click"===
b.type||32===b.keyCode||!f("opera")&&13===b.keyCode){var d=b.target,h,k;do if(d.sortable){h=d.field||d.columnId;k=a.sort[0];h=a.hasNeutralSort&&k&&k.property===h&&k.descending?[]:[{property:h,descending:k&&k.property===h&&!k.descending}];k={bubbles:!0,cancelable:!0,grid:a,parentType:b.type,sort:h};g.emit(b.target,"dgrid-sort",k)&&(a._sortNode=d,a.set("sort",h));break}while((d=d.parentNode)&&d!==e)}})},resize:function(){var a=this.headerNode.firstChild,d=this.contentNode,e;this.inherited(arguments);
d.style.width="";d&&a&&(e=a.offsetWidth)>d.offsetWidth&&(d.style.width=e+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(){this.inherited(arguments);this.updateSortArrow(this.sort)},_findSortArrowParent:function(a){var b=this.columns,d;for(d in b){var e=b[d];if(e.field===a)return e.headerNode}},updateSortArrow:function(b,e){this._lastSortedArrow&&(a.remove(this._lastSortedArrow.parentNode,"dgrid-sort-up dgrid-sort-down"),
d.destroy(this._lastSortedArrow),delete this._lastSortedArrow);e&&(this.sort=b);b[0]&&(e=b[0].property,b=b[0].descending,e=this._sortNode||this._findSortArrowParent(e),delete this._sortNode,e&&(e=e.contents||e,this._lastSortedArrow=d.create("div",{className:"dgrid-sort-arrow ui-icon",innerHTML:"\x26nbsp;",role:"presentation"},e,"first"),a.add(e,"dgrid-sort-"+(b?"down":"up")),this.resize()))},styleColumn:function(a,d){return this.addCssRule("#"+m.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+
m.escapeCssIdentifier(a,"-"),d)},_configColumns:function(a,d){var b=[],e=d instanceof Array;m.each(d,function(f,g){"string"===typeof f&&(d[g]=f={label:f});e||f.field||(f.field=g);g=f.id=f.id||(isNaN(g)?g:a+g);this._configColumn&&(this._configColumn(f,d,a),g=f.id);e&&(this.columns[g]=f);f.grid=this;b.push(f)},this);return e?d:b},_destroyColumns:function(){this.cleanup()},configStructure:function(){var a=this.subRows,d=this._columns=this.columns;this.columns=!d||d instanceof Array?{}:d;if(a)for(d=0;d<
a.length;d++)a[d]=this._configColumns(d+"-",a[d]);else this.subRows=[this._configColumns("",d)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(a){this._destroyColumns();this.subRows=null;this.columns=a;this._updateColumns()},_setSubRows:function(a){this._destroyColumns();this.subRows=a;this._updateColumns()},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&
(this.sort.length?(this._lastSortedArrow=null,this.updateSortArrow(this.sort)):this.resize())}});p.appendIfNode=e;return p})},"dgrid/List":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/on dojo/has ./util/misc dojo/_base/sniff".split(" "),function(p,h,d,a,g,f,k){function m(a,b){a.className="dgrid-scrollbar-measure";document.body.appendChild(a);b=a["offset"+b]-a["client"+b];a.className="";a.parentNode&&document.body.removeChild(a);return b}function e(b){a.replace(this.domNode,
b,this._class||"");this._class=b}function b(){return this._class}var l=[];l.push("has-mozilla");f("touch")&&l.push("has-touch");a.add(document.documentElement,l);f.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});var t,u;f.add("dom-scrollbar-width",function(a,b,c){return m(c,"Width")});f.add("dom-scrollbar-height",function(a,b,c){return m(c,"Height")});f.add("dom-rtl-scrollbar-left",function(a,b,c){a=document.createElement("div");c.className="dgrid-scrollbar-measure";
c.setAttribute("dir","rtl");c.appendChild(a);document.body.appendChild(c);b=!!f("ie")||!1||/\bEdge\//.test(navigator.userAgent)||a.offsetLeft>=f("dom-scrollbar-width");c.className="";c.parentNode&&document.body.removeChild(c);d.destroy(a);c.removeAttribute("dir");return b});var r=0,v=function(){this._started&&this.resize()},q=p(null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,addUiClasses:!0,highlightDuration:250,resizeThrottleDelay:k.defaultDelay,resizeThrottleMethod:"throttleDelayed",
postscript:function(a,b){var c=this;(this._Row=function(a,c,b){this.id=a;this.data=c;this.element=b}).prototype.remove=function(){c.removeRow(this.element)};b&&(this.srcNodeRef=b=b.nodeType?b:document.getElementById(b));this.create(a,b)},listType:"list",create:function(a,b){b=this.domNode=b||document.createElement("div");var c;a&&(this.params=a,p.safeMixin(this,a),c=a["class"]||a.className||b.className);this.sort=this.sort||[];this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();
this.id=b.id=b.id||this.id||q.autoIdPrefix+r++;this.buildRendering();c&&e.call(this,c);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var b=this.domNode,e=this.addUiClasses,c=this,l,m,p;p=this.isRTL="rtl"===(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();b.className="";b.setAttribute("role","grid");a.add(b,"dgrid dgrid-"+this.listType+(e?" ui-widget":""));l=this.headerNode=d.create("div",
{className:"dgrid-header dgrid-header-row"+(e?" ui-widget-header":"")+(this.showHeader?"":" dgrid-header-hidden")},b);m=this.bodyNode=d.create("div",{className:"dgrid-scroller"},b);m.tabIndex=-1;this.headerScrollNode=d.create("div",{className:"dgrid-header dgrid-header-scroll dgrid-scrollbar-width"+(e?" ui-widget-header":"")},b);this.footerNode=d.create("div",{className:"dgrid-footer"+(this.showFooter?"":" dgrid-footer-hidden")},b);p&&(b.className+=" dgrid-rtl"+(f("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":
""));g(m,"scroll",function(a){c.showHeader&&(l.scrollLeft=a.scrollLeft||m.scrollLeft);a.stopPropagation();g.emit(b,"scroll",{scrollTarget:m})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=d.create("div",{className:"dgrid-content"+(e?" ui-widget-content":"")},this.bodyNode);"string"===typeof this.resizeThrottleMethod&&k[this.resizeThrottleMethod]?e=k[this.resizeThrottleMethod](v,this,this.resizeThrottleDelay):"function"===typeof this.resizeThrottleMethod?e=this.resizeThrottleMethod(h.hitch(this,
v),this.resizeThrottleDelay):(console.warn("Invalid value specified for resizeThrottleMethod:  "+this.resizeThrottleMethod),e=k.throttleDelayed(v,this,this.resizeThrottleDelay));this._resizeHandle=g(window,"resize",e);this._listeners.push(this._resizeHandle)},postCreate:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this.sort))},configStructure:function(){},resize:function(){var a=this.bodyNode,b=this.footerNode,b=this.showFooter?
b.offsetHeight:0;this.headerScrollNode.style.height=a.style.marginTop=this.headerNode.offsetHeight+"px";a.style.marginBottom=b+"px";t||(t=f("dom-scrollbar-width"),u=f("dom-scrollbar-height"),f("ie")&&(t++,u++),k.addCssRule(".dgrid-scrollbar-width","width: "+t+"px"),k.addCssRule(".dgrid-scrollbar-height","height: "+u+"px"),17!==t&&(k.addCssRule(".dgrid-header-row","right: "+t+"px"),k.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+t+"px")))},addCssRule:function(a,b){a=k.addCssRule(a,b);this.cleanAddedRules&&
this._listeners.push(a);return a},on:function(a,b){return g(this.domNode,a,b)},cleanup:function(){for(var a in this._rowIdToObject)if(this._rowIdToObject[a]!==this.columns){var b=document.getElementById(a);b&&this.removeRow(b,!0)}},destroy:function(){if(this._listeners){for(var a=this._listeners.length;a--;)this._listeners[a].remove();this._listeners=null}this._started=!1;this.cleanup();d.destroy(this.domNode)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoRowId=0;this.contentNode.innerHTML=
"";this.scrollTo({x:0,y:0})},highlightRow:function(b,d){var c="dgrid-highlight"+(this.addUiClasses?" ui-state-highlight":"");b=b.element||b;a.add(b,c);setTimeout(function(){a.remove(b,c)},d||this.highlightDuration)},adjustRowIndices:function(b){var d=b.rowIndex;if(-1<d){do-1<b.rowIndex&&(this.maintainOddEven&&a.contains(b,"dgrid-row")&&a.replace(b,1===d%2?"dgrid-row-odd":"dgrid-row-even",0===d%2?"dgrid-row-odd":"dgrid-row-even"),b.rowIndex=d++);while((b=b.nextSibling)&&b.rowIndex!==d)}},renderArray:function(a,
b,c){c=c||{};var d=c.start||0,e=document.createDocumentFragment(),f=[],g=0,h=a.length;b||(this._lastCollection=a);for(;g<h;)f[g]=this.insertRow(a[g],e,null,d++,c),g++;(a=b?b.parentNode:this.contentNode)&&a.parentNode&&(a!==this.contentNode||h)&&(a.insertBefore(e,b||null),h&&this.adjustRowIndices(f[h-1]));return f},renderHeader:function(){},_autoRowId:0,insertRow:function(a,b,c,d,e){var f=this.id+"-row-"+(this.collection&&this.collection.getIdentity?this.collection.getIdentity(a):this._autoRowId++),
g=document.getElementById(f),h=g&&g.previousSibling;g&&(g===c&&(c=(c.connected||c).nextSibling),this.removeRow(g,!1,e));g=this.renderRow(a,e);g.className=(g.className||"")+" dgrid-row "+(1===d%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?" ui-state-default":"");this._rowIdToObject[g.id=f]=a;b.insertBefore(g,c||null);g.rowIndex=d;h&&h.rowIndex!==g.rowIndex-1&&this.adjustRowIndices(h);return g},renderRow:function(a){var b=document.createElement("div");b.appendChild(document.createTextNode(a));
return b},removeRow:function(a,b){a=a.element||a;delete this._rowIdToObject[a.id];b||d.destroy(a)},row:function(a){var b;if(a instanceof this._Row)return a;a.target&&a.target.nodeType&&(a=a.target);if(a.nodeType){do{var c=a.id;if(b=this._rowIdToObject[c])return new this._Row(c.substring(this.id.length+5),b,a);a=a.parentNode}while(a&&a!==this.domNode)}else return"object"===typeof a?b=this.collection.getIdentity(a):(b=a,a=this._rowIdToObject[this.id+"-row-"+b]),new this._Row(b,a,document.getElementById(this.id+
"-row-"+b))},cell:function(a){return{row:this.row(a)}},_move:function(a,b,c,d){var e,f;f=e=a.element;b=b||1;do if(a=e[0>b?"previousSibling":"nextSibling"]){do if((e=a)&&-1<(e.className+" ").indexOf(c+" ")){f=e;b+=0>b?1:-1;break}while(a=(!d||!e.hidden)&&e[0>b?"lastChild":"firstChild"])}else if(e=e.parentNode,!e||e===this.bodyNode||e===this.headerNode)break;while(b);return f},up:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,-(b||1),"dgrid-row",c))},down:function(a,b,c){a.element||
(a=this.row(a));return this.row(this._move(a,b||1,"dgrid-row",c))},scrollTo:function(a){"undefined"!==typeof a.x&&(this.bodyNode.scrollLeft=a.x);"undefined"!==typeof a.y&&(this.bodyNode.scrollTop=a.y)},getScrollPosition:function(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}},get:function(a){var b="_get"+a.charAt(0).toUpperCase()+a.slice(1);return"function"===typeof this[b]?this[b].apply(this,[].slice.call(arguments,1)):this[a]},set:function(a,b){if("object"===typeof a)for(var c in a)this.set(c,
a[c]);else c="_set"+a.charAt(0).toUpperCase()+a.slice(1),"function"===typeof this[c]?this[c].apply(this,[].slice.call(arguments,1)):this[a]=b;return this},_getClass:b,_setClass:e,_getClassName:b,_setClassName:e,_setSort:function(a,b){this.sort="string"!==typeof a?a:[{property:a,descending:b}];this._applySort()},_applySort:function(){this.refresh();if(this._lastCollection){var a=this.sort;if(a&&0<a.length){var b=a[0].property,c=!!a[0].descending;this._lastCollection.sort(function(a,d){a=a[b];d=d[b];
void 0===a&&(a="");void 0===d&&(d="");return a===d?0:a>d!==c?1:-1})}this.renderArray(this._lastCollection)}},_setShowHeader:function(b){var d=this.headerNode;this.showHeader=b;a.toggle(d,"dgrid-header-hidden",!b);this.renderHeader();this.resize();b&&(d.scrollLeft=this.getScrollPosition().x)},_setShowFooter:function(b){this.showFooter=b;a.toggle(this.footerNode,"dgrid-footer-hidden",!b);this.resize()}});q.autoIdPrefix="dgrid_";return q})},"dgrid/util/misc":function(){define(["dojo/has"],function(p){var h=
[],d,a,g,f=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,k=setTimeout,m=clearTimeout;p.add("requestidlecallback",function(a){return"function"===typeof a.requestIdleCallback});var e={defaultDelay:15,throttle:function(a,d,f){var b=!1;f=f||e.defaultDelay;return function(){b||(b=!0,a.apply(d,arguments),k(function(){b=!1},f))}},throttleDelayed:function(a,d,f){var b=!1;f=f||e.defaultDelay;return function(){if(!b){b=!0;var e=arguments;k(function(){b=!1;a.apply(d,e)},f)}}},debounce:function(a,d,f){var b;f=f||e.defaultDelay;
return function(){b&&(m(b),b=null);var e=arguments;b=k(function(){b=null;a.apply(d,e)},f)}},each:function(a,d,e){var b,f;if(a)if("number"===typeof a.length)for(b=0,f=a.length;b<f;b++)d.call(e,a[b],b,a);else for(b in a)d.call(e,a[b],b,a)},addCssRule:function(b,e){d||(d=document.createElement("style"),document.getElementsByTagName("head")[0].appendChild(d),d=d.sheet||d.styleSheet,a=d.deleteRule?"deleteRule":"removeRule",g=d.cssRules?"cssRules":"rules");var f=h.length;h[f]=(d.cssRules||d.rules).length;
d.addRule?d.addRule(b,e):d.insertRule(b+"{"+e+"}",h[f]);return{get:function(a){return d[g][h[f]].style[a]},set:function(a,b){"undefined"!==typeof h[f]&&(d[g][h[f]].style[a]=b)},remove:function(){var b=h[f],e,g;if(void 0!==b)for(d[a](b),h[f]=void 0,e=f+1,g=h.length;e<g;e++)h[e]>b&&h[e]--}}},escapeCssIdentifier:function(a,d){return"string"===typeof a?a.replace(f,d||"\\$1"):a}};return e})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/on dojo/when dojo/query ./util/misc".split(" "),
function(p,h,d,a,g,f,k,m,e){function b(a){return a&&(0<=a.className.indexOf("dgrid-row")||0<=a.className.indexOf("dgrid-loading"))}function l(a){return a&&0<=a.className.indexOf("dgrid-preload")}var t=0;return d([p,h],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:e.defaultDelay,keepScrollPosition:!1,rowHeight:0,_deleteQueue:[],postCreate:function(){this.inherited(arguments);var a=this;f(this.bodyNode,
"scroll",e[this.pagingMethod](function(b){a._processScroll(b)},null,this.pagingDelay))},renderQuery:function(b,d){var e=this,f=d&&d.container||this.contentNode,h,l,c,m,p=0,r=d&&d.start||0;"level"in b&&(p=m=b.level);h={query:b,count:0,level:p,top:!1};var u={node:g.create("div",{className:"dgrid-preload",style:{height:"0"}},f),count:0,query:b,next:h,level:p,top:!0};l=u.node;l.rowIndex=0;h.previous=u;c=h.node=g.create("div",{className:"dgrid-preload",style:{height:"0"}},f);u.id=t++;l.setAttribute("data-preloadid",
u.id);h.id=t++;c.setAttribute("data-preloadid",h.id);c.rowIndex=this.minRowsPerPage;e._insertPreload(u);var B=g.create("div",{className:"dgrid-loading"},c,"before");g.create("div",{className:"dgrid-below"},B).innerHTML=this.loadingMessage;d=a.mixin({start:0,count:this.minRowsPerPage},d);null!=m&&(d.queryLevel=m);return this._trackError(function(){var a=b(d);return e.renderQueryResults(a,c,d).then(function(b){return a.totalLength.then(function(a){var f=b.length,m=c.parentNode;!e._rows||"queryLevel"in
d||(e._rows.min=0,e._rows.max=f===a?Infinity:f-1);g.destroy(B);"queryLevel"in d||(e._total=a);0===a&&m&&(e.noDataNode&&g.destroy(e.noDataNode),e._insertNoDataNode(m));u.count=r;h.count=a-f-r;c.rowIndex=r+f;a?e._updatePreloadRowHeights(u):(c.style.display="none",l.style.display="none");e._previousScrollPosition&&m.offsetHeight&&(e.scrollTo(e._previousScrollPosition),delete e._previousScrollPosition);return k(e._processScroll()).then(function(){return b})})}).otherwise(function(a){g.destroy(B);throw a;
})})},_insertPreload:function(a){var b=this.preload;if(b){for(;b.node.compareDocumentPosition(a.node)&Node.DOCUMENT_POSITION_PRECEDING;)if(b=b.previous,null==b)return;for(;b.node.compareDocumentPosition(a.node)&Node.DOCUMENT_POSITION_FOLLOWING&&b.next;)b=b.next;b.previous.next=a;a.previous=b.previous;a=a.next;a.next=b;b.previous=a}else this.preload=a},refresh:function(a){var b=this,d=a&&a.keepScrollPosition;"undefined"===typeof d&&(d=this.keepScrollPosition);d&&(this._previousScrollPosition=this.getScrollPosition());
this.inherited(arguments);if(this._renderedCollection)return this.renderQuery(function(a){return b._renderedCollection.fetchRange({start:a.start,end:a.start+a.count})}).then(function(){b._emitRefreshComplete()})},resize:function(){this.inherited(arguments);this._processScroll()},cleanup:function(){this.inherited(arguments);this.preload=null},renderQueryResults:function(a){var b=this.inherited(arguments),d=this._getRenderedCollection(this.preload);d&&d.releaseRange&&b.then(function(b){b[0]&&!b[0].parentNode.tagName&&
a.totalLength.then(function(){d.releaseRange(b[0].rowIndex,b[b.length-1].rowIndex+1)})});return b},_getFirstRowSibling:function(a){return a.lastChild},_calcRowHeight:function(a){var b=a.nextSibling;return b&&!/\bdgrid-preload\b/.test(b.className)?b.offsetTop-a.offsetTop:a.offsetHeight},_calcAverageRowHeight:function(a){for(var b=a.length,d=0,e=0;e<b;e++)d+=this._calcRowHeight(a[e]);return b&&d?d/b:0},_updatePreloadRowHeights:function(){var a=this.preload;if(a){for(;a.previous;)a=a.previous;for(;a;)a.rowHeight||
(a.rowHeight=this.rowHeight||this._calcAverageRowHeight(a.node.parentNode.querySelectorAll(".dgrid-row")),this._adjustPreloadHeight(a)),a=a.next}},lastScrollTop:0,_processScroll:function(a){function d(a,c){c=c?"next":"previous";for(var b;b=a[c];)a=b;return a}function e(a,e){function f(){var c;a:{c=!e;for(var b=a;b=b[e?"previous":"next"];)if(c===b.top){c=b;break a}c=void 0}if(c&&k!==c&&!l(c.top?c.node.nextSibling:c.node.previousSibling))return h(),a=c,r=a.node,m=e?a.node.offsetTop-u:p-(a.node.offsetTop+
a.node.offsetHeight),w=(c=g(r))&&c.rowIndex,x=void 0,c}function g(a){var c=l(a);(a=a[q])&&!b(a)&&(a=c&&l(a)?null:(c=f())?c:g(a));return a}function h(){a.count+=v;e&&(r.rowIndex-=v);c._adjustPreloadHeight(a);v=0;c._releaseRange(a,e,w,x)}var k=a;a=d(a,e);var m=e?a.node.offsetTop-u:p-(a.node.offsetTop+a.node.offsetHeight),n=c.farOffRemoval,r=a.node,q=e?"previousSibling":"nextSibling",v=0,t=0,w,x;if(m>2*n){var y;w=(y=g(r))&&y.rowIndex;for(x=void 0;y&&k!==a;){var A=c._calcRowHeight(y);t+A+n>m||!b(y)?y=
f():(t+=A,v+=y.count||1,c._pruneRow(y,e),"rowIndex"in y&&(x=y.rowIndex),y=g(y))}h();c._deleteNodeQueue()}}function f(a,c){do a=c?a.next:a.previous;while(a&&!a.node.offsetWidth);return a}var h=this.preload,k;this._updatePreloadRowHeights();if(k=h&&h.rowHeight){var c=this,m=c.bodyNode,p=a&&a.scrollTop||this.getScrollPosition().y,u=m.offsetHeight+p,t;a=c.lastScrollTop;var m=c.bufferRows*k,B=m-k,E,C=!0;for(c.lastScrollTop=p;h&&!h.node.offsetWidth;)h=h.previous;for(;h&&h!==t;){t=c.preload;c.preload=h;
k=h.node;var G=k.offsetTop;if(u+1+B<G)h=f(h,C=!1);else if(p-1-B>G+k.offsetHeight)h=f(h,C=!0);else{var G=((k.top?p-m:u)-G)/h.rowHeight,J=(u-p+2*m)/h.rowHeight,J=J+Math.min(Math.abs(Math.max(Math.min((p-a)*h.rowHeight,c.maxRowsPerPage/2),c.maxRowsPerPage/-2)),10);k.top&&(G-=J);G=Math.max(G,0);10>G&&0<G&&J+G<c.maxRowsPerPage&&(J+=Math.max(0,G),G=0);J=Math.min(Math.max(J,c.minRowsPerPage),c.maxRowsPerPage,h.count);if(0===J)h=f(h,C);else{var J=Math.ceil(J),G=Math.min(Math.floor(G),h.count-J),F={};h.count-=
J;var I=k,H,K=c.queryRowsOverlap,L=!h.top&&h;L?(h.previous&&(e(h),0<G&&l(k.previousSibling)?(G=Math.min(h.count,G),h.previous.count+=G,c._adjustPreloadHeight(h.previous,!0),k.rowIndex+=G,K=0):J+=G,h.count-=G),F.start=k.rowIndex-K,F.count=Math.min(J+K,c.maxRowsPerPage),k.rowIndex=F.start+F.count):(h.next&&(I=k.nextSibling,e(h,!0),l(k.nextSibling)?(h.next.count+=h.count-G,h.next.node.rowIndex=G+J,c._adjustPreloadHeight(h.next),h.count=G,K=0,I=h.next.node):H=!0),F.start=h.count,F.count=Math.min(J+K,
c.maxRowsPerPage),F.scrollingUp=!0);H&&I&&I.offsetWidth&&(H=I.offsetTop);c._adjustPreloadHeight(h);"level"in h.query&&(F.queryLevel=h.query.level);if("queryLevel"in F||!(F.start>c._total||0>F.count)){var M=g.create("div",{className:"dgrid-loading",style:{height:J*h.rowHeight+"px"}},I,"before");g.create("div",{className:"dgrid-"+(L?"below":"above"),innerHTML:c.loadingMessage},M);M.count=J;c._trackError(function(){(function(a,b,d){var e=h.query(F);E=c.renderQueryResults(e,a,F).then(function(f){var h=
c._rows;!h||"queryLevel"in F||!f.length||(b?(h.max<=h.min&&(h.min=f[0].rowIndex),h.max=f[f.length-1].rowIndex):(h.max<=h.min&&(h.max=f[f.length-1].rowIndex),h.min=f[0].rowIndex));I=a.nextSibling;g.destroy(a);d&&I&&I.offsetWidth&&c.scrollTo({y:c.bodyNode.scrollTop+I.offsetTop-d});e.totalLength.then(function(a){"queryLevel"in F||(c._total=a,c._rows&&c._rows.max>=c._total-1&&(c._rows.max=Infinity));b&&(b.count=a-b.node.rowIndex,c._adjustPreloadHeight(b))});c._processScroll();return f},function(c){g.destroy(a);
throw c;})})(M,L,H)});h=h.previous}}}}return E}},_adjustPreloadHeight:function(a,b){a.node.style.height=this._calculatePreloadHeight(a,b)+"px"},_calculatePreloadHeight:function(a,b){return Math.min(a.count*a.rowHeight,b?Infinity:this.maxEmptySpace)},_pruneRow:function(a,b,d){this.removeRow(a,!0,d);this._queueNodeForDeletion(a)},_queueNodeForDeletion:function(a){this._deleteQueue.push(a)},_deleteNodeQueue:function(){for(var a=document.createElement("div"),b=this._deleteQueue,d=b.length;d--;)a.appendChild(b[d]);
this._deleteQueue=[];setTimeout(function(){g.destroy(a)},1)},_removePreloads:function(a){if(a&&a.length){var b=this,d=this._getHeadPreload();a.forEach(function(a){if(a=b._findPreload(a,d))a.previous&&(a.previous.next=a.next),a.next&&(a.next.previous=a.previous)})}},_getHeadPreload:function(){var a=this.preload;if(a)for(;a.previous;)a=a.previous;return a},_findPreload:function(a,b){for(b||(b=this._getHeadPreload());b;){if(b.node===a)return b;b=b.next}},_getRenderedCollection:function(){return this._renderedCollection},
_releaseRange:function(a,b,d,e){if(a){var f=a.level;a=this._getRenderedCollection(a);null!=e&&a.releaseRange&&"number"===typeof d&&"number"===typeof e&&(b?a.releaseRange(e,d+1):a.releaseRange(d,e+1),this._rows&&!f&&(this._rows[b?"max":"min"]=e,this._rows.max>=this._total-1&&(this._rows.max=Infinity)))}}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/aspect dojo/dom-construct dojo/has dojo/on dojo/when".split(" "),function(p,h,d,a,g,f,k,m){function e(a){if("object"!==
typeof a)a=Error(a);else if("cancel"===a.dojoType)return;k.emit(this.domNode,"dgrid-error",{grid:this,error:a,cancelable:!0,bubbles:!0})&&console.error(a)}return p(null,{collection:null,_renderedCollection:null,_rows:null,_observerHandle:null,shouldTrackCollection:!0,getBeforePut:!0,noDataMessage:"",loadingMessage:"",_total:0,constructor:function(){this.dirty={};this._updating={};this._columnsWithSet={};a.before(this,"configStructure",h.hitch(this,function(){this._columnsWithSet={}}))},destroy:function(){this.inherited(arguments);
this._renderedCollection&&this._cleanupCollection();this._refreshTimeout&&clearTimeout(this._refreshTimeout)},_configColumn:function(a){a.set&&(this._columnsWithSet[a.field]=a);this.inherited(arguments)},_setCollection:function(a){this._renderedCollection&&(this.cleanup(),this._cleanupCollection({shouldRevert:!a||a.storage!==this._renderedCollection.storage}));this.collection=a;if(this._started){if(a){var b=a;this.sort&&0<this.sort.length&&(b=a.sort(this.sort));b.track&&this.shouldTrackCollection&&
(b=b.track(),this._rows=[],this._observerHandle=this._observeCollection(b,this.contentNode,{rows:this._rows}));this._renderedCollection=b}this.refresh()}},_setStore:function(){this.collection||console.debug("set('store') call detected, but you probably meant set('collection')")},_getTotal:function(){return this._total},_cleanupCollection:function(a){a=a||{};this._renderedCollection.tracking&&this._renderedCollection.tracking.remove();this._observerHandle&&(this._observerHandle.remove(),this._observerHandle=
this._rows=null);!1!==a.shouldRevert&&(this.dirty={});this._renderedCollection=this.collection=null},_applySort:function(){this.collection?this.set("collection",this.collection):this.store&&console.debug("_StoreMixin found store property but not collection; this is often the sign of a mistake during migration from 0.3 to 0.4")},_emitRefreshComplete:function(){var a=this;this._refreshTimeout=setTimeout(function(){k.emit(a.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:a});a._refreshTimeout=
null},0)},_insertNoDataNode:function(a){this._removeNoDataNode();a=a||this.contentNode;var b=this.noDataNode=g.create("div",{className:"dgrid-no-data",innerHTML:this.noDataMessage});a.insertBefore(b,this._getFirstRowSibling?this._getFirstRowSibling(a):null);return b},_removeNoDataNode:function(){return this.noDataNode?(g.destroy(this.noDataNode),delete this.noDataNode,!0):!1},row:function(){var a=this.inherited(arguments);a&&a.data&&"undefined"!==typeof a.id&&(a.id=this.collection.getIdentity(a.data));
return a},refresh:function(){var a=this.inherited(arguments);this.collection||this._insertNoDataNode();return a},refreshCell:function(a){if(!this.collection||!this._createBodyRowCell)throw Error("refreshCell requires a Grid with a collection.");this.inherited(arguments);return this.collection.get(a.row.id).then(h.hitch(this,"_refreshCellFromItem",a))},_refreshCellFromItem:function(a,d,e){var b=a.element;g.empty(b);var f=this.dirty&&this.dirty[a.row.id];f&&(d=h.delegate(d,f));this._createBodyRowCell(b,
a.column,d,e)},renderArray:function(){var a=this.inherited(arguments);this.collection||a.length&&this.noDataNode&&g.destroy(this.noDataNode);return a},insertRow:function(a,d,e,f,k){var b=this.collection,l=this.dirty,b=b&&b.getIdentity(a),m;b in l&&!(b in this._updating)&&(m=l[b]);m&&(a=h.delegate(a,m));l=this.inherited(arguments);k&&k.rows&&(k.rows[f]=l);this.noDataNode&&(g.destroy(this.noDataNode),this.noDataNode=null);return l},updateDirty:function(a,d,e){var b=this.dirty,f=b[a];f||(f=b[a]={});
f[d]=e},save:function(){function a(a,c){return function(b){var d=e._columnsWithSet,h=e._updating,l,m;if("function"===typeof b.set)b.set(c);else for(l in c)b[l]=c[l];for(l in d)m=d[l].set(b),void 0!==m&&(b[l]=m);h[a]=!0;return f.put(b).then(function(c){delete g[a];delete h[a];k[a]=c;return k})}}var e=this,f=this.collection,g=this.dirty,h=new d,k={},m=function(a){var c;return e.getBeforePut||!(c=e.row(a).data)?function(){return f.get(a)}:function(){return c}},n=h.then(function(){return k}),p;for(p in g)var c=
a(p,g[p]),n=n.then(m(p)).then(c);h.resolve();return n},revert:function(){this.dirty={};this.refresh()},_trackError:function(a){"string"===typeof a&&(a=h.hitch(this,a));var b=this,f;try{f=m(a())}catch(u){a=new d,a.reject(u),f=a.promise}f.otherwise(function(a){e.call(b,a)});return f},removeRow:function(a,d,e){var b={element:a};d||this.up(b).element!==a||this.down(b).element!==a||this._insertNoDataNode();(b=e&&e.rows||this._rows)&&delete b[a.rowIndex];return this.inherited(arguments)},renderQueryResults:function(a,
d,e){e=h.mixin({rows:this._rows},e);var b=this;return a.then(function(a){a=b.renderArray(a,d,e);delete b._lastCollection;return a})},_observeCollection:function(a,d,e){var b=this,f=e.rows,g,h=[a.on("delete, update",function(a){var h=a.previousIndex,c=a.index;void 0!==h&&f[h]&&("max"in f&&(void 0===c||c<f.min||c>f.max)&&f.max--,g=f[h],g.parentNode===d&&b.removeRow(g,!1,e),f.splice(h,1),("delete"===a.type||"update"===a.type&&(h<c||void 0===c))&&f[h]&&f[h].rowIndex--);"delete"===a.type&&(g=null)}),a.on("add, update",
function(a){var h=a.previousIndex,c=a.index;if(void 0!==c&&(!("max"in f)||c>=f.min&&c<=f.max)){"max"in f&&(void 0===h||h<f.min||h>f.max)&&f.max++;if(f.length){if(h=f[c],!h&&(h=f[c-1]))h=(h.connected||h).nextSibling}else h=b._getFirstRowSibling&&b._getFirstRowSibling(d);g&&h&&g.id===h.id&&(h=(h.connected||h).nextSibling);h&&!h.parentNode&&(h=document.getElementById(h.id));f.splice(c,0,void 0);g=b.insertRow(a.target,d,h,c,e);b.highlightRow(g)}g=null}),a.on("add, delete, update",function(d){var e="undefined"!==
typeof d.previousIndex?d.previousIndex:Infinity,c="undefined"!==typeof d.index?d.index:Infinity,g=Math.min(e,c);e!==c&&f[g]&&b.adjustRowIndices(f[g]);Infinity!==e&&b._processScroll&&(f[e]||f[e-1])&&b._processScroll();b._onNotification(f,d,a);a===b._renderedCollection&&"totalLength"in d&&(b._total=d.totalLength)})];return{remove:function(){for(;0<h.length;)h.pop().remove()}}},_onNotification:function(){}})})},"dgrid/Selection":function(){define("dojo/_base/declare dojo/dom-class dojo/on dojo/has dojo/aspect ./List dojo/has!touch?./util/touch dojo/query dojo/_base/sniff dojo/dom".split(" "),
function(p,h,d,a,g,f,k){function m(a,b){b=a.unselectable=b?"on":"";a=a.getElementsByTagName("*");for(var d=a.length;--d;)"INPUT"!==a[d].tagName&&"TEXTAREA"!==a[d].tagName&&(a[d].unselectable=b)}function e(e,f){var h=e.bodyNode,k=f?"text":"-moz-none";b&&"msUserSelect"!==b?h.style[b]=k:a("dom-selectstart")?f||e._selectstartHandle?f&&e._selectstartHandle&&(e._selectstartHandle.remove(),delete e._selectstartHandle):e._selectstartHandle=d(h,"selectstart",function(a){var c=a.target&&a.target.tagName;"INPUT"!==
c&&"TEXTAREA"!==c&&a.preventDefault()}):(m(h,!f),f||e._unselectableHandle)?f&&e._unselectableHandle&&(e._unselectableHandle.remove(),delete e._unselectableHandle):e._unselectableHandle=g.after(e,"renderRow",function(a){m(a,!0);return a})}a.add("dom-comparedocumentposition",function(a,b,d){return!!d.compareDocumentPosition});a.add("dom-selectstart","undefined"!==typeof document.onselectstart);var b=a("css-user-select"),l=(f=a("pointer"))&&"MS"===f.slice(0,2),t=f?f+(l?"Down":"down"):"mousedown",u=f?
f+(l?"Up":"up"):"mouseup";"WebkitUserSelect"===b&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(b=!1);return p(null,{selectionDelegate:".dgrid-row",selectionEvents:t+","+u+",dgrid-cellfocusin",selectionTouchEvents:a("touch")?k.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);
this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!==this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},
_setAllowTextSelection:function(a){"undefined"!==typeof a?e(this,a):e(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(a,b){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(b))&&("dgrid-cellfocusin"!==a.type||"mousedown"!==a.parentType)&&(a.type!==u||b===this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=a;if(!a.keyCode||!a.ctrlKey||32===a.keyCode)if(!a.shiftKey&&a.type===t&&this.isSelected(b))this._waitForMouseUp=b;else this[this._selectionHandlerName](a,
b);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,b){a=a.keyCode?a.ctrlKey:a.metaKey;this._lastSelected===b?this.select(b,null,!a||!this.isSelected(b)):(this.clearSelection(),this.select(b),this._lastSelected=b)},_multipleSelectionHandler:function(a,b){var d=this._lastSelected,e=a.keyCode?a.ctrlKey:a.metaKey,f;a.shiftKey||(f=e?null:!0,d=null);this.select(b,d,f);d||(this._lastSelected=b)},_extendedSelectionHandler:function(a,b){(2===a.button?this.isSelected(b):a.keyCode?a.ctrlKey:
a.metaKey)||this.clearSelection(null,!0);this._multipleSelectionHandler(a,b)},_toggleSelectionHandler:function(a,b){this.select(b,null,null)},_initSelectionEvents:function(){var b=this,e=this.contentNode,f=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};a("touch")&&!a("pointer")&&this.selectionTouchEvents?(d(e,k.selector(f,this.selectionTouchEvents),function(a){b._handleSelect(a,this);b._ignoreMouseSelect=this}),d(e,d.selector(f,this.selectionEvents),function(a){b._ignoreMouseSelect!==
this?b._handleSelect(a,this):a.type===u&&(b._ignoreMouseSelect=null)})):d(e,d.selector(f,this.selectionEvents),function(a){b._handleSelect(a,this)});this.addKeyHandler&&this.addKeyHandler(32,function(a){b._handleSelect(a,a.target)});if(this.allowSelectAll)this.on("keydown",function(a){a.metaKey&&65===a.keyCode&&!/\bdgrid-input\b/.test(a.target.className)&&(a.preventDefault(),b[b.allSelected?"clearSelection":"selectAll"]())});this._setCollection&&g.before(this,"_setCollection",function(a){b._updateDeselectionAspect(a)});
this._updateDeselectionAspect()},_updateDeselectionAspect:function(a){function b(a,c){if((a=d.row(a))&&d.selection[a.id])d[c](a)}var d=this,e;this._removeDeselectSignals&&this._removeDeselectSignals();e=a&&a.track&&this._observeCollection?[g.before(this,"_observeCollection",function(a){e.push(a.on("delete",function(a){"undefined"===typeof a.index&&b(a.id,"deselect")}))}),g.after(this,"_observeCollection",function(a){e.push(a.on("update",function(c){"undefined"!==typeof c.index&&b(a.getIdentity(c.target),
"select")}))},!0)]:[g.before(this,"removeRow",function(a,c){c||(a=this.row(a))&&a.id in this.selection&&this.deselect(a)})];this._removeDeselectSignals=function(){for(var a=e.length;a--;)e[a].remove();e=[]}},allowSelect:function(){return!0},_fireSelectionEvent:function(a){var b=this._selectionEventQueues[a],e=this._selectionTriggerEvent,f;f={bubbles:!0,grid:this};e&&(f.parentType=e.type);f[this._selectionTargetType]=b;this._selectionEventQueues[a]=[];d.emit(this.contentNode,"dgrid-"+a,f)},_fireSelectionEvents:function(){var a=
this._selectionEventQueues,b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},_select:function(a,b,d){var e,f,c;"undefined"===typeof d&&(d=!0);a.element||(a=this.row(a));if(!1===d||this.allowSelect(a))if(e=this.selection,f=!!e[a.id],null===d&&(d=!f),c=a.element,d||this.allSelected?e[a.id]=d:delete this.selection[a.id],c&&(d?h.add(c,"dgrid-selected"+(this.addUiClasses?" ui-state-active":"")):h.remove(c,"dgrid-selected ui-state-active")),d!==f&&c&&this._selectionEventQueues[(d?"":"de")+"select"].push(a),
b)if(b.element||(b=this.row(b)),b){if(b=b.element)for(e=this._determineSelectionDirection(c,b),e||(b=document.getElementById(b.id),e=this._determineSelectionDirection(c,b));a.element!==b&&(a=this[e](a));)this._select(a,null,d)}else this._lastSelected=c,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},
_determineSelectionDirection:a("dom-comparedocumentposition")?function(a,b){a=b.compareDocumentPosition(a);return a&1?!1:2===a?"down":"up"}:function(a,b){return 1>b.sourceIndex?!1:b.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,b,d){this._select(a,b,d);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var d in this.selection)a!==d&&this._select(d,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},
selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},
renderArray:function(){var a=this.inherited(arguments),b=this.selection,d,e,f;for(d=0;d<a.length;d++)e=this.row(a[d]),(f=e.id in b?b[e.id]:this.allSelected)&&this.select(e,null,f);this._fireSelectionEvents();return a}})})},"dojo/store/Memory":function(){define(["../_base/declare","./util/QueryResults","./util/SimpleQueryEngine"],function(p,h,d){return p("dojo.store.Memory",null,{constructor:function(a){for(var d in a)this[d]=a[d];this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:d,
get:function(a){return this.data[this.index[a]]},getIdentity:function(a){return a[this.idProperty]},put:function(a,d){var f=this.data,g=this.index,h=this.idProperty,h=a[h]=d&&"id"in d?d.id:h in a?a[h]:Math.random();if(h in g){if(d&&!1===d.overwrite)throw Error("Object already exists");f[g[h]]=a}else g[h]=f.push(a)-1;return h},add:function(a,d){(d=d||{}).overwrite=!1;return this.put(a,d)},remove:function(a){var d=this.index,f=this.data;if(a in d)return f.splice(d[a],1),this.setData(f),!0},query:function(a,
d){return h(this.queryEngine(a,d)(this.data))},setData:function(a){a.items?(this.idProperty=a.identifier||this.idProperty,a=this.data=a.items):this.data=a;this.index={};for(var d=0,f=a.length;d<f;d++)this.index[a[d][this.idProperty]]=d}})})},"dojo/store/util/QueryResults":function(){define(["../../_base/array","../../_base/lang","../../when"],function(p,h,d){var a=function(g){function f(f){g[f]=function(){var e=arguments,b=d(g,function(b){Array.prototype.unshift.call(e,b);return a(p[f].apply(p,e))});
if("forEach"!==f||k)return b}}if(!g)return g;var k=!!g.then;k&&(g=h.delegate(g));f("forEach");f("filter");f("map");null==g.total&&(g.total=d(g,function(a){return a.length}));return g};h.setObject("dojo.store.util.QueryResults",a);return a})},"dojo/store/util/SimpleQueryEngine":function(){define(["../../_base/array"],function(p){return function(h,d){function a(a){a=p.filter(a,h);var f=d&&d.sort;f&&a.sort("function"==typeof f?f:function(a,b){for(var d,e=0;d=f[e];e++){var g=a[d.attribute],h=b[d.attribute],
g=null!=g?g.valueOf():g,h=null!=h?h.valueOf():h;if(g!=h)return!!d.descending==(null==g||g>h)?-1:1}return 0});if(d&&(d.start||d.count)){var g=a.length;a=a.slice(d.start||0,(d.start||0)+(d.count||Infinity));a.total=g}return a}switch(typeof h){default:throw Error("Can not query with a "+typeof h);case "object":case "undefined":var g=h;h=function(a){for(var d in g){var f=g[d];if(f&&f.test){if(!f.test(a[d],a))return!1}else if(f!=a[d])return!1}return!0};break;case "string":if(!this[h])throw Error("No filter function "+
h+" was found in store");h=this[h];case "function":}a.matches=h;return a}})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,t){d.isAsync||m(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var u=h("dojo.dnd.Source",l,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,
autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(b,d){a.mixin(this,a.mixin({},d));b=this.accept;if(b.length)for(this.accept={},d=0;d<b.length;++d)this.accept[b[d]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&g.add(this.node,"dojoDndSource");this.targetState="";this.accept&&g.add(this.node,"dojoDndTarget");this.horizontal&&g.add(this.node,"dojoDndHorizontal");this.topics=
[e.subscribe("/dnd/source/over",a.hitch(this,"onDndSourceOver")),e.subscribe("/dnd/start",a.hitch(this,"onDndStart")),e.subscribe("/dnd/drop",a.hitch(this,"onDndDrop")),e.subscribe("/dnd/cancel",a.hitch(this,"onDndCancel"))]},checkAcceptance:function(a,b){if(this==a)return!this.copyOnly||this.selfAccept;for(var d=0;d<b.length;++d){for(var e=a.getItem(b[d].id).type,f=!1,c=0;c<e.length;++c)if(e[c]in this.accept){f=!0;break}if(!f)return!1}return!0},copyState:function(a,b){if(a)return!0;2>arguments.length&&
(b=this==t.manager().target);if(b){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){u.superclass.destroy.call(this);p.forEach(this.topics,function(a){a.remove()});this.targetAnchor=null},onMouseMove:function(a){if(!this.isDragging||"Disabled"!=this.targetState){u.superclass.onMouseMove.call(this,a);var d=t.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(a.pageX-this._lastX)>this.delay||Math.abs(a.pageY-this._lastY)>this.delay)){var e=
this.getSelectedNodes();e.length&&d.startDrag(this,e,this.copyState(b.getCopyKeyState(a),!0))}this.isDragging&&(e=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=f.position(this.current,!0)),e=this.horizontal?a.pageX-this.targetBox.x<this.targetBox.w/2==f.isBodyLtr(this.current.ownerDocument):a.pageY-this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||e!=this.before)&&(this._markTargetAnchor(e),d.canDrop(!this.current||d.source!=this||!(this.current.id in
this.selection)))}},onMouseDown:function(a){this.mouseDown||!this._legalMouseDown(a)||this.skipForm&&b.isFormElement(a)||(this.mouseDown=!0,this._lastX=a.pageX,this._lastY=a.pageY,u.superclass.onMouseDown.call(this,a))},onMouseUp:function(a){this.mouseDown&&(this.mouseDown=!1,u.superclass.onMouseUp.call(this,a))},onDndSourceOver:function(a){this!==a?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(a=t.manager(),a.canDrop("Disabled"!=this.targetState&&(!this.current||
a.source!=this||!(this.current.id in this.selection))))},onDndStart:function(a,b,d){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==a?d?"Copied":"Moved":"");b=this.accept&&this.checkAcceptance(a,b);this._changeState("Target",b?"":"Disabled");this==a&&t.manager().overSource(this);this.isDragging=!0},onDndDrop:function(a,b,d,e){if(this==e)this.onDrop(a,b,d);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=
!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(a,b,d){if(this!=a)this.onDropExternal(a,b,d);else this.onDropInternal(b,d)},onDropExternal:function(a,d,e){var f=this._normalizedCreator;this._normalizedCreator=this.creator?function(b,c){return f.call(this,a.getItem(b.id).data,c)}:e?function(d){var c=a.getItem(d.id);d=d.cloneNode(!0);d.id=b.getUniqueId();return{node:d,data:c.data,type:c.type}}:function(b){var c=a.getItem(b.id);a.delItem(b.id);
return{node:b,data:c.data,type:c.type}};this.selectNone();e||this.creator||a.selectNone();this.insertNodes(!0,d,this.before,this.current);!e&&this.creator&&a.deleteSelectedNodes();this._normalizedCreator=f},onDropInternal:function(a,d){var e=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(d)this._normalizedCreator=this.creator?function(a,b){return e.call(this,this.getItem(a.id).data,b)}:function(a){var d=this.getItem(a.id);a=a.cloneNode(!0);a.id=b.getUniqueId();return{node:a,
data:d.data,type:d.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var b=this.getItem(a.id);return{node:a,data:b.data,type:b.type}}}this._removeSelection();this.insertNodes(!0,a,this.before,this.current);this._normalizedCreator=e}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){u.superclass.onOverEvent.call(this);t.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){u.superclass.onOutEvent.call(this);
t.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(a){if(this.current!=this.targetAnchor||this.before!=a)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=a,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,
this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(a){this._changeState("Source",a?"Copied":"Moved")},_legalMouseDown:function(a){if("touchstart"!=a.type&&!k.isLeft(a))return!1;if(!this.withHandles)return!0;for(a=a.target;a&&a!==this.node;a=a.parentNode){if(g.contains(a,"dojoDndHandle"))return!0;if(g.contains(a,"dojoDndItem")||g.contains(a,"dojoDndIgnore"))break}return!1}});return u})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t){var u=h("dojo.dnd.Selector",t,{constructor:function(d,f){f||(f={});this.singular=f.singular;this.autoSync=f.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(e(this.node,b.press,a.hitch(this,"onMouseDown")),e(this.node,b.release,a.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var a=new m,b=l._empty,d;for(d in this.selection)d in b||a.push(g.byId(d));return a},selectNone:function(){return this._removeSelection()._removeAnchor()},
selectAll:function(){this.forInItems(function(a,b){this._addItemClass(g.byId(b),"Selected");this.selection[b]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var a=l._empty,b;for(b in this.selection)if(!(b in a)){var d=g.byId(b);this.delItem(b);f.destroy(d)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(a,b){b=b||d.global;var e=this.selection,f=l._empty,g;for(g in e)g in f||a.call(b,this.getItem(g),g,this)},sync:function(){u.superclass.sync.call(this);
this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var a=[],b=l._empty,d;for(d in this.selection)d in b||this.getItem(d)||a.push(d);p.forEach(a,function(a){delete this.selection[a]},this);return this},insertNodes:function(a,b,d,e){var f=this._normalizedCreator;this._normalizedCreator=function(b,d){b=f.call(this,b,d);a?(this.anchor?this.anchor!=b.node&&(this._removeItemClass(b.node,"Anchor"),this._addItemClass(b.node,"Selected")):(this.anchor=b.node,this._removeItemClass(b.node,"Selected"),
this._addItemClass(this.anchor,"Anchor")),this.selection[b.node.id]=1):(this._removeItemClass(b.node,"Selected"),this._removeItemClass(b.node,"Anchor"));return b};u.superclass.insertNodes.call(this,b,d,e);this._normalizedCreator=f;return this},destroy:function(){u.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(a){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!l.getCopyKeyState(a)&&!a.shiftKey&&this.current.id in this.selection)this.simpleSelection=
!0,k.isLeft(a)&&(a.stopPropagation(),a.preventDefault());else{if(!this.singular&&a.shiftKey){l.getCopyKeyState(a)||this._removeSelection();var b=this.getAllNodes();if(b.length&&(this.anchor||(this.anchor=b[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var d=0,e;d<b.length&&(e=b[d],e!=this.anchor&&e!=this.current);++d);for(++d;d<b.length;++d){e=b[d];if(e==this.anchor||e==this.current)break;this._addItemClass(e,"Selected");this.selection[e.id]=
1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?l.getCopyKeyState(a)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):l.getCopyKeyState(a)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):
(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);a.stopPropagation();a.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&
(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=e(this.node,b.move,a.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var a=l._empty,b;for(b in this.selection)if(!(b in a)){var d=g.byId(b);d&&this._removeItemClass(d,"Selected")}this.selection=
{};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return u})},"dojo/_base/NodeList":function(){define(["./kernel","../query","./array","./html","../NodeList-dom"],function(p,h,d){h=h.NodeList;var a=h.prototype;a.connect=h._adaptAsForEach(function(){return p.connect.apply(this,arguments)});a.coords=h._adaptAsMap(p.coords);h.events="blur focus change click error keydown keypress keyup load mousedown mouseenter mouseleave mousemove mouseout mouseover mouseup submit".split(" ");
d.forEach(h.events,function(d){var f="on"+d;a[f]=function(a,d){return this.connect(f,a,d)}});return p.NodeList=h})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,t,u,r){h=h("dojo.dnd.Container",e,{skipForm:!1,allowNested:!1,constructor:function(b,d){this.node=f.byId(b);d||(d={});this.creator=d.creator||
null;this.skipForm=d.skipForm;this.parent=d.dropParent&&f.byId(d.dropParent);this.map={};this.current=null;this.containerState="";k.add(this.node,"dojoDndContainer");d&&d._skipStartup||this.startup();this.events=[l(this.node,u.over,a.hitch(this,"onMouseOver")),l(this.node,u.out,a.hitch(this,"onMouseOut")),l(this.node,"dragstart",a.hitch(this,"onSelectStart")),l(this.node,"selectstart",a.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(a){return this.map[a]},setItem:function(a,
b){this.map[a]=b},delItem:function(a){delete this.map[a]},forInItems:function(a,b){b=b||d.global;var e=this.map,f=r._empty,c;for(c in e)c in f||a.call(b,e[c],c,this);return b},clearItems:function(){this.map={}},getAllNodes:function(){return t((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var a={};this.getAllNodes().forEach(function(b){if(b.id){var d=this.getItem(b.id);if(d){a[b.id]=d;return}}else b.id=r.getUniqueId();var d=b.getAttribute("dndType"),e=b.getAttribute("dndData");
a[b.id]={data:e||b.innerHTML,type:d?d.split(/\s*,\s*/):["text"]}},this);this.map=a;return this},insertNodes:function(a,b,d){this.parent.firstChild?b?d||(d=this.parent.firstChild):d&&(d=d.nextSibling):d=null;var e;if(d)for(b=0;b<a.length;++b)e=this._normalizedCreator(a[b]),this.setItem(e.node.id,{data:e.data,type:e.type}),d.parentNode.insertBefore(e.node,d);else for(b=0;b<a.length;++b)e=this._normalizedCreator(a[b]),this.setItem(e.node.id,{data:e.data,type:e.type}),this.parent.appendChild(e.node);
return this},destroy:function(){p.forEach(this.events,function(a){a.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(a,b,d){a._skipStartup=!0;return new d(b,a)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var a=this.parent.getElementsByTagName("tbody");a&&a.length&&(this.parent=a[0])}this.defaultCreator=r._defaultCreator(this.parent);this.sync()},onMouseOver:function(a){for(var b=a.relatedTarget;b&&
b!=this.node;)try{b=b.parentNode}catch(n){b=null}b||(this._changeState("Container","Over"),this.onOverEvent());b=this._getChildByEvent(a);this.current!=b&&(this.current&&this._removeItemClass(this.current,"Over"),b&&this._addItemClass(b,"Over"),this.current=b)},onMouseOut:function(a){for(a=a.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(q){a=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(a){this.withHandles||
this.skipForm&&r.isFormElement(a)||(a.stopPropagation(),a.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(a,b){var d="dojoDnd"+a;a=a.toLowerCase()+"State";k.replace(this.node,d+b,d+this[a]);this[a]=b},_addItemClass:function(a,b){k.add(a,"dojoDndItem"+b)},_removeItemClass:function(a,b){k.remove(a,"dojoDndItem"+b)},_getChildByEvent:function(a){if(a=a.target)for(var b=a.parentNode;b;a=b,b=a.parentNode)if((b==this.parent||this.allowNested)&&k.contains(a,"dojoDndItem"))return a;
return null},_normalizedCreator:function(b,d){b=(this.creator||this.defaultCreator).call(this,b,d);a.isArray(b.type)||(b.type=["text"]);b.node.id||(b.node.id=r.getUniqueId());k.add(b.node,"dojoDndItem");return b}});r._createNode=function(a){return a?function(b){return m.create(a,{innerHTML:b})}:r._createSpan};r._createTrTd=function(a){var b=m.create("tr");m.create("td",{innerHTML:a},b);return b};r._createSpan=function(a){return m.create("span",{innerHTML:a})};r._defaultCreatorNodes={ul:"li",ol:"li",
div:"div",p:"div"};r._defaultCreator=function(b){b=b.tagName.toLowerCase();var d="tbody"==b||"thead"==b?r._createTrTd:r._createNode(r._defaultCreatorNodes[b]);return function(b,e){var c=b&&a.isObject(b),f;c&&b.tagName&&b.nodeType&&b.getAttribute?(f=b.getAttribute("dndData")||b.innerHTML,c=(c=b.getAttribute("dndType"))?c.split(/\s*,\s*/):["text"]):(f=c&&b.data?b.data:b,c=c&&b.type?b.type:["text"],b=("avatar"==e?r._createSpan:d)(String(f)));b.id||(b.id=r.getUniqueId());return{node:b,data:f,type:c}}};
return h})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,t,u,r){var v=h("dojo.dnd.Manager",[f],{constructor:function(){this.source=this.avatar=null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:k("touch")?4:16,OFFSET_Y:k("touch")?4:16,overSource:function(a){this.avatar&&
(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=!!this.target,this.avatar.update());b.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),b.publish("/dnd/source/over",null)):b.publish("/dnd/source/over",null)},startDrag:function(f,h,k){function c(a){a.preventDefault();a.stopPropagation()}u.autoScrollStart(a.doc);this.source=f;this.nodes=h;this.copy=!!k;this.avatar=this.makeAvatar();a.body().appendChild(this.avatar.node);
b.publish("/dnd/start",f,h,this.copy);this.events=[e(a.doc,l.move,d.hitch(this,"onMouseMove")),e(a.doc,l.release,d.hitch(this,"onMouseUp")),e(a.doc,"keydown",d.hitch(this,"onKeyDown")),e(a.doc,"keyup",d.hitch(this,"onKeyUp")),e(a.doc,"dragstart",c),e(a.body(),"selectstart",c)];f="dojoDnd"+(k?"Copy":"Move");g.add(a.body(),f)},canDrop:function(a){a=!(!this.target||!a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){g.remove(a.body(),["dojoDndCopy","dojoDndMove"]);
p.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new r(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(a){var b=this.avatar;b&&(u.autoScrollNodes(a),b=b.node.style,b.left=a.pageX+this.OFFSET_X+"px",b.top=a.pageY+this.OFFSET_Y+"px",b=!!this.source.copyState(t.getCopyKeyState(a)),this.copy!=b&&this._setCopyStatus(b));k("touch")&&a.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&
this.canDropFlag){var d=!!this.source.copyState(t.getCopyKeyState(a));b.publish("/dnd/drop/before",this.source,this.nodes,d,this.target,a);b.publish("/dnd/drop",this.source,this.nodes,d,this.target,a)}else b.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(a){if(this.avatar)switch(a.keyCode){case m.CTRL:a=!!this.source.copyState(!0);this.copy!=a&&this._setCopyStatus(a);break;case m.ESCAPE:b.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(a){this.avatar&&a.keyCode==m.CTRL&&(a=
!!this.source.copyState(!1),this.copy!=a&&this._setCopyStatus(a))},_setCopyStatus:function(b){this.copy=b;this.source._markDndStatus(this.copy);this.updateAvatar();g.replace(a.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});t._manager=null;v.manager=t.manager=function(){t._manager||(t._manager=new v);return t._manager};return v})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),
function(p,h,d,a,g,f,k,m){return p("dojo.dnd.Avatar",null,{constructor:function(a){this.manager=a;this.construct()},construct:function(){var d=f.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),b=this.manager.source,g,h=f.create("tbody",null,d),m=f.create("tr",null,h),p=f.create("td",null,m),v=Math.min(5,this.manager.nodes.length),q=0;k("highcontrast")&&f.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},p);f.create("span",{innerHTML:b.generateText?
this._generateText():""},p);for(a.set(m,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});q<v;++q)b.creator?g=b._normalizedCreator(b.getItem(this.manager.nodes[q].id).data,"avatar").node:(g=this.manager.nodes[q].cloneNode(!0),"tr"==g.tagName.toLowerCase()&&(m=f.create("table"),f.create("tbody",null,m).appendChild(g),g=m)),g.id="",m=f.create("tr",null,h),p=f.create("td",null,m),p.appendChild(g),a.set(m,{"class":"dojoDndAvatarItem",style:{opacity:(9-q)/10}});this.node=d},destroy:function(){f.destroy(this.node);
this.node=!1},update:function(){g.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(k("highcontrast")){var a=d.byId("a11yIcon"),b="+";this.manager.canDropFlag&&!this.manager.copy?b="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||(b="x"):b="o";a.innerHTML=b}m("tr.dojoDndAvatarHeader td span"+(k("highcontrast")?" span":""),this.node).forEach(function(a){a.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},
"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(p,h,d,a){return p("dijit.CheckedMenuItem",d,{baseClass:"dijitMenuItem dijitCheckedMenuItem",templateString:a,checked:!1,_setCheckedAttr:function(a){this.domNode.setAttribute("aria-checked",a?"true":"false");this._set("checked",a)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(a){this.disabled||
(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(a)}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,t){k=p("dijit.MenuItem"+(f("dojo-bidi")?"_NoBidi":""),[m,e,b,l],{templateString:t,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",
a);var b="",d;d=a.search(/{\S}/);if(0<=d){var b=a.charAt(d+1),e=a.substr(0,d);a=a.substr(d+3);d=e+b+a;a=e+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+b+"\x3c/span\x3e"+a}else d=a;this.domNode.setAttribute("aria-label",d+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){!a||"label"in this.params||this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);
d.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&d.set(this.accelKeyNode,"id",this.id+"_accel");h.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==f("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(u){}},_setSelected:function(b){a.toggle(this.domNode,"dijitMenuItemSelected",b)},setLabel:function(a){g.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){g.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.",
"","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){this.accelKeyNode&&(this.accelKeyNode.style.display=a?"":"none",this.accelKeyNode.innerHTML=a,d.set(this.containerNode,"colSpan",a?"1":"2"));this._set("accelKey",a)}});f("dojo-bidi")&&(k=p("dijit.MenuItem",k,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));
return k})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c){function x(a){return function(b){this._isLoaded?this.inherited(a,arguments):
this.loadDropDown(m.hitch(this,a,b))}}var z=h("dijit.form._SelectMenu",u,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(e(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}))},focus:function(){var a=!1,b=this.parentWidget.value;m.isArray(b)&&(b=b[b.length-1]);b&&p.forEach(this.parentWidget._getChildren(),function(c){c.option&&b===c.option.value&&(a=!0,
this.focusChild(c,!1))},this);a||this.inherited(arguments)}});g=h("dijit.form.Select"+(b("dojo-bidi")?"_NoBidi":""),[l,t,n],{baseClass:"dijitSelect dijitValidationTextBox",templateString:c,_buttonInputDisabled:b("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);if(this.options.length&&!this.value&&this.srcNodeRef){var b=this.srcNodeRef.selectedIndex||0;this._set("value",
this.options[0<=b?b:0].value)}this.dropDown=new z({id:this.id+"_menu",parentWidget:this});a.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(a){if(a.value||a.label){var b=m.hitch(this,"_setValueAttr",a);a=new r({option:a,label:("text"===this.labelType?(a.label||"").toString().replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a.label)||this.emptyLabel,onClick:b,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:a.disabled||
!1});a.focusNode.setAttribute("role","option");return a}return new v({ownerDocument:this.ownerDocument})},_addOptionItem:function(a){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(a))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(A){}},focusChild:function(a){a&&this.set("value",a.option)},_getFirst:function(){var a=this._getChildren();return a.length?a[0]:null},
_getLast:function(){var a=this._getChildren();return a.length?a[a.length-1]:null},childSelector:function(a){return(a=w.byNode(a))&&a.getParent()==this.dropDown},onKeyboardSearch:function(a,b,c,d){a&&this.focusChild(a)},_loadChildren:function(a){if(!0===a)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{p.forEach(this._getChildren(),function(a){a.destroyRecursive()});var b=new r({ownerDocument:this.ownerDocument,label:this.emptyLabel});
this.dropDown.addChild(b)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(a){this.inherited(arguments);d.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",_setDisabledAttr:function(a){this.inherited(arguments);this._refreshState()},
_setRequiredAttr:function(a){this._set("required",a);this.focusNode.setAttribute("aria-required",a);this._refreshState()},_setOptionsAttr:function(a){this._isLoaded=!1;this._set("options",a)},_setDisplay:function(a){a=("text"===this.labelType?(a||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+a+"\x3c/span\x3e"},
validate:function(a){a=this.disabled||this.isValid(a);this._set("state",a?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",a?"false":"true");var b=a?"":this._missingMsg;b&&this.focused&&this._hasBeenBlurred?q.show(b,this.domNode,this.tooltipPosition,!this.isLeftToRight()):q.hide(this.domNode);this._set("message",b);return a},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||"")},reset:function(){this.inherited(arguments);q.hide(this.domNode);
this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=f.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(e(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var a=this._keyNavCodes;delete a[k.LEFT_ARROW];delete a[k.RIGHT_ARROW]},_setStyleAttr:function(b){this.inherited(arguments);a.toggle(this.domNode,
this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(a){this._loadChildren(!0);this._isLoaded=!0;a()},destroy:function(a){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(a),delete this.dropDown);q.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){q.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});b("dojo-bidi")&&(g=
h("dijit.form.Select",g,{_setDisplay:function(a){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));g._Menu=z;g.prototype._onContainerKeydown=x("_onContainerKeydown");g.prototype._onContainerKeypress=x("_onContainerKeypress");return g})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u){return g("dijit.form._FormSelectWidget",u,{multiple:!1,options:null,store:null,_setStoreAttr:function(a){this._created&&this._deprecatedSetStore(a)},query:null,_setQueryAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:a})},queryOptions:null,_setQueryOptionsAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:a})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(a){var b=this.options||[];if(null==a)return b;if(e.isArrayLike(a))return p.map(a,"return this.getOptions(item);",this);e.isString(a)&&(a={value:a});e.isObject(a)&&(p.some(b,function(b,d){for(var e in a)if(!(e in b)||b[e]!=a[e])return!1;a=d;return!0})||(a=-1));return 0<=a&&a<b.length?b[a]:null},addOption:function(a){p.forEach(e.isArrayLike(a)?a:[a],function(a){a&&e.isObject(a)&&this.options.push(a)},this);this._loadChildren()},removeOption:function(a){a=this.getOptions(e.isArrayLike(a)?
a:[a]);p.forEach(a,function(a){a&&(this.options=p.filter(this.options,function(b){return b.value!==a.value||b.label!==a.label}),this._removeOptionItem(a))},this);this._loadChildren()},updateOption:function(a){p.forEach(e.isArrayLike(a)?a:[a],function(a){var b=this.getOptions({value:a.value}),d;if(b)for(d in a)b[d]=a[d]},this);this._loadChildren()},setStore:function(a,b,d){m.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(a,b,d)},_deprecatedSetStore:function(b,f,g){var k=this.store;g=g||{};if(k!==b){for(var m;m=this._notifyConnections.pop();)m.remove();b.get||(e.mixin(b,{_oldAPI:!0,get:function(a){var b=new h;this.fetchItemByIdentity({identity:a,onItem:function(a){b.resolve(a)},onError:function(a){b.reject(a)}});return b.promise},query:function(a,b){var c=new h(function(){d.abort&&d.abort()});c.total=new h;var d=this.fetch(e.mixin({query:a,onBegin:function(a){c.total.resolve(a)},
onComplete:function(a){c.resolve(a)},onError:function(a){c.reject(a)}},b));return new t(c)}}),b.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[d.after(b,"onNew",e.hitch(this,"_onNewItem"),!0),d.after(b,"onDelete",e.hitch(this,"_onDeleteItem"),!0),d.after(b,"onSet",e.hitch(this,"_onSetItem"),!0)]));this._set("store",b)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);g.query&&this._set("query",g.query);g.queryOptions&&this._set("queryOptions",g.queryOptions);b&&b.query&&(this._loadingStore=!0,this.onLoadDeferred=new h,this._queryRes=b.query(this.query,this.queryOptions),l(this._queryRes,e.hitch(this,function(c){if(this.sortByLabel&&!g.sort&&c.length)if(b.getValue)c.sort(a.createSortFunction([{attribute:b.getLabelAttributes(c[0])[0]}],b));else{var d=this.labelAttr;c.sort(function(a,b){return a[d]>b[d]?1:b[d]>
a[d]?-1:0})}g.onFetch&&(c=g.onFetch.call(this,c,g));p.forEach(c,function(a){this._addOptionForItem(a)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(e.hitch(this,function(a,b,c){b==c?this._onSetItem(a):(-1!=b&&this._onDeleteItem(a),-1!=c&&this._onNewItem(a))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:f);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(c):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),e.hitch(this,function(a){console.error("dijit.form.Select: "+a.toString());this.onLoadDeferred.reject(a)})));return k},_setValueAttr:function(a,b){this._onChangeActive||(b=null);if(this._loadingStore)this._pendingValue=a;else if(null!=a){a=e.isArrayLike(a)?p.map(a,function(a){return e.isObject(a)?a:{value:a}}):e.isObject(a)?[a]:[{value:a}];a=p.filter(this.getOptions(a),function(a){return a&&a.value});var d=this.getOptions()||[];this.multiple||a[0]&&a[0].value||!d.length||(a[0]=
d[0]);p.forEach(d,function(b){b.selected=p.some(a,function(a){return a.value===b.value})});d=p.map(a,function(a){return a.value});if("undefined"!=typeof d&&"undefined"!=typeof d[0]){var f=p.map(a,function(a){return a.label});this._setDisplay(this.multiple?f:f[0]);this.inherited(arguments,[this.multiple?d:d[0],b]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var a=p.map([].concat(this.get("selectedOptions")),function(a){return a&&"label"in a?a.label:a?a.value:null},this);return this.multiple?
a:a[0]},_setDisplayedValueAttr:function(a){this.set("value",this.getOptions("string"==typeof a?{label:a}:a))},_loadChildren:function(){this._loadingStore||(p.forEach(this._getChildren(),function(a){a.destroyRecursive()}),p.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var a=[].concat(this.value);if(a&&a[0]){var b=this;p.forEach(this._getChildren(),function(d){var e=p.some(a,function(a){return d.option&&
a===d.option.value});e&&!b.multiple&&(b.focusedChild=d);k.toggle(d.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),e);d.domNode.setAttribute("aria-selected",e?"true":"false")},this)}},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var b=p.filter(a,function(a){return a.selected})[0];if(b&&b.value)return b.value;a[0].selected=!0;return a[0].value}return this.multiple?p.map(p.filter(a,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(a,b){b&&b.parent||this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption({value:this.store.getIdentity(a)})},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var b=this.store,d=this.labelAttr&&this.labelAttr in a?a[this.labelAttr]:b.getLabel(a);return{value:d?b.getIdentity(a):null,label:d,item:a}},_addOptionForItem:function(a){var b=this.store;b.isItemLoaded&&!b.isItemLoaded(a)?b.loadItem({item:a,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(a=this._getOptionObjForItem(a),this.addOption(a))},constructor:function(a){this._oValue=(a||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);f.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?b("\x3e *",this.srcNodeRef).map(function(a){return"separator"===a.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:a.getAttribute("data-"+m._scopeName+"-value")||a.getAttribute("value"),
label:String(a.innerHTML),selected:a.getAttribute("selected")||!1,disabled:a.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);d.after(this,"onChange",e.hitch(this,"_updateSelection"));var a=this.store;a&&(a.getIdentity||a.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(a,this._oValue,
{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var a;a=this._notifyConnections.pop();)a.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(p){var h={};p.setObject("dojo.data.util.sorter",h);h.basicComparator=function(d,a){var g=-1;null===d&&(d=void 0);null===a&&(a=void 0);if(d==a)g=0;else if(d>a||null==d)g=1;return g};h.createSortFunction=function(d,a){function g(a,b,d,e){return function(f,g){f=e.getValue(f,a);g=e.getValue(g,a);
return b*d(f,g)}}for(var f=[],k,m=a.comparatorMap,e=h.basicComparator,b=0;b<d.length;b++){k=d[b];var l=k.attribute;if(l){k=k.descending?-1:1;var p=e;m&&("string"!==typeof l&&"toString"in l&&(l=l.toString()),p=m[l]||e);f.push(g(l,k,p,a))}}return function(a,b){for(var d=0;d<f.length;){var e=f[d++](a,b);if(0!==e)return e}return 0}};return h})},"dijit/_HasDropDown":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on dojo/touch ./registry ./focus ./popup ./_FocusMixin".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q){return p("dijit._HasDropDown",q,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(a){this.disabled||this.readOnly||("MSPointerDown"!=a.type&&a.preventDefault(),this.own(l.once(this.ownerDocument,t.release,b.hitch(this,"_onDropDownMouseUp"))),this.toggleDropDown())},_onDropDownMouseUp:function(a){var b=
this.dropDown,c=!1;if(a&&this._opened){var d=f.position(this._buttonNode,!0);if(!(a.pageX>=d.x&&a.pageX<=d.x+d.w&&a.pageY>=d.y&&a.pageY<=d.y+d.h)){for(d=a.target;d&&!c;)g.contains(d,"dijitPopup")?c=!0:d=d.parentNode;if(c){d=a.target;if(b.onItemClick){for(var e;d&&!(e=u.byNode(d));)d=d.parentNode;if(e&&e.onClick&&e.getParent)e.getParent().onItemClick(e,a)}return}}}this._opened?b.focus&&(!1!==b.autoFocus||"mouseup"==a.type&&!this.hovering)&&(this._focusDropDownTimer=this.defer(function(){b.focus();
delete this._focusDropDownTimer})):this.focus&&this.defer("focus")},_onDropDownClick:function(a){this._stopClickEvents&&(a.stopPropagation(),a.preventDefault())},buildRendering:function(){this.inherited(arguments);this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var a={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||
this.dropDownPosition[0]||"Down";g.add(this._arrowWrapperNode||this._buttonNode,"dijit"+a+"ArrowButton")},postCreate:function(){this.inherited(arguments);var a=this.focusNode||this.domNode;this.own(l(this._buttonNode,t.press,b.hitch(this,"_onDropDownMouseDown")),l(this._buttonNode,"click",b.hitch(this,"_onDropDownClick")),l(a,"keydown",b.hitch(this,"_onKey")),l(a,"keyup",b.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0);this.dropDown&&(this.dropDown._destroyed||this.dropDown.destroyRecursive(),
delete this.dropDown);this.inherited(arguments)},_onKey:function(a){if(!this.disabled&&!this.readOnly){var b=this.dropDown,c=a.target;b&&this._opened&&b.handleKey&&!1===b.handleKey(a)?(a.stopPropagation(),a.preventDefault()):b&&this._opened&&a.keyCode==e.ESCAPE?(this.closeDropDown(),a.stopPropagation(),a.preventDefault()):!this._opened&&(a.keyCode==e.DOWN_ARROW||(a.keyCode==e.ENTER||a.keyCode==e.SPACE&&(!this._searchTimer||a.ctrlKey||a.altKey||a.metaKey))&&("input"!==(c.tagName||"").toLowerCase()||
c.type&&"text"!==c.type.toLowerCase()))&&(this._toggleOnKeyUp=!0,a.stopPropagation(),a.preventDefault())}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp;this.toggleDropDown();var a=this.dropDown;a&&a.focus&&this.defer(b.hitch(a,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1);this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(a){a()},loadAndOpenDropDown:function(){var a=new h,d=b.hitch(this,function(){this.openDropDown();a.resolve(this.dropDown)});
this.isLoaded()?d():this.loadDropDown(d);return a},toggleDropDown:function(){this.disabled||this.readOnly||(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var d=this.dropDown,e=d.domNode,c=this._aroundNode||this.domNode,h=this,k=v.open({parent:this,popup:d,around:c,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){h.closeDropDown(!0)},onCancel:function(){h.closeDropDown(!0)},onClose:function(){a.set(h._popupStateNode,"popupActive",
!1);g.remove(h._popupStateNode,"dijitHasDropDownOpen");h._set("_opened",!1)}});if(this.forceWidth||this.autoWidth&&c.offsetWidth>d._popupWrapper.offsetWidth){var c=c.offsetWidth-d._popupWrapper.offsetWidth,l={w:d.domNode.offsetWidth+c};this._origStyle=e.style.cssText;b.isFunction(d.resize)?d.resize(l):f.setMarginBox(e,l);"R"==k.corner[1]&&(d._popupWrapper.style.left=d._popupWrapper.style.left.replace("px","")-c+"px")}a.set(this._popupStateNode,"popupActive","true");g.add(this._popupStateNode,"dijitHasDropDownOpen");
this._set("_opened",!0);this._popupStateNode.setAttribute("aria-expanded","true");this._popupStateNode.setAttribute("aria-owns",d.id);"presentation"===e.getAttribute("role")||e.getAttribute("aria-labelledby")||e.setAttribute("aria-labelledby",this.id);return k},closeDropDown:function(a){this._focusDropDownTimer&&(this._focusDropDownTimer.remove(),delete this._focusDropDownTimer);this._opened&&(this._popupStateNode.setAttribute("aria-expanded","false"),a&&this.focus&&this.focus(),v.close(this.dropDown),
this._opened=!1);this._origStyle&&(this.dropDown.domNode.style.cssText=this._origStyle,delete this._origStyle)}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(p,h,d,a,g,f){return p("dijit.MenuSeparator",[d,a,g],{templateString:f,buildRendering:function(){this.inherited(arguments);h.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare",
"dojo/keys","./_Spinner","./NumberTextBox"],function(p,h,d,a){return p("dijit.form.NumberSpinner",[d,a.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(a,d){var f=this.constraints,g=isNaN(a),e=!isNaN(f.max),b=!isNaN(f.min);g&&0!=d&&(a=0<d?b?f.min:e?f.max:0:e?this.constraints.max:b?f.min:0);d=a+d;if(g||isNaN(d))return a;e&&d>f.max&&(d=f.max);b&&d<f.min&&(d=f.min);return d},_onKeyDown:function(a){if(!(this.disabled||this.readOnly||a.keyCode!=h.HOME&&a.keyCode!=h.END||
a.ctrlKey||a.altKey||a.metaKey||"undefined"==typeof this.get("value"))){var d=this.constraints[a.keyCode==h.HOME?"min":"max"];"number"==typeof d&&this._setValueAttr(d,!1);a.stopPropagation();a.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),function(p,h,d,a,g,f,k,m,e,b){return p("dijit.form._Spinner",m,{defaultTimeout:500,
minimumTimeout:10,timeoutChangeRate:.9,smallDelta:1,largeDelta:10,templateString:e,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(a){return a},_arrowPressed:function(a,d,e){this.disabled||this.readOnly||(this._setValueAttr(this.adjust(this.get("value"),d*e),!1),b.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=null},_typematicCallback:function(a,b,d){var e=
this.smallDelta;b==this.textbox&&(b=d.keyCode,e=b==h.PAGE_UP||b==h.PAGE_DOWN?this.largeDelta:this.smallDelta,b=b==h.UP_ARROW||b==h.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==a?this._arrowReleased(b):this._arrowPressed(b,b==this.upArrowNode?1:-1,e)},_wheelTimer:null,_mouseWheeled:function(a){if(this.focused){a.stopPropagation();a.preventDefault();var b=a.wheelDelta/120;Math.floor(b)!=b&&(b=0<a.wheelDelta?1:-1);a=a.detail?-1*a.detail:b;if(0!==a){var d=this[0<a?"upArrowNode":"downArrowNode"];this._arrowPressed(d,
a,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(d)},50)}}},_setConstraintsAttr:function(a){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(a,
b){this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(f(this.domNode,g.wheel,d.hitch(this,"_mouseWheeled")),k.addListener(this.upArrowNode,this.textbox,{keyCode:h.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),k.addListener(this.downArrowNode,this.textbox,{keyCode:h.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,
"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),k.addListener(this.upArrowNode,this.textbox,{keyCode:h.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),k.addListener(this.downArrowNode,this.textbox,{keyCode:h.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout))}})})},"dijit/typematic":function(){define("dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/on dojo/sniff ./main".split(" "),
function(p,h,d,a,g,f){var k=f.typematic={_fireEventAndReload:function(){this._timer=null;this._callback(++this._count,this._node,this._evt);this._currentTimeout=Math.max(0>this._currentTimeout?this._initialDelay:1<this._subsequentDelay?this._subsequentDelay:Math.round(this._currentTimeout*this._subsequentDelay),this._minDelay);this._timer=setTimeout(d.hitch(this,"_fireEventAndReload"),this._currentTimeout)},trigger:function(a,e,b,f,g,h,k,p){if(g!=this._obj){this.stop();this._initialDelay=k||500;this._subsequentDelay=
h||.9;this._minDelay=p||10;this._obj=g;this._node=b;this._count=this._currentTimeout=-1;this._callback=d.hitch(e,f);this._evt={faux:!0};for(var l in a)"layerX"!=l&&"layerY"!=l&&(e=a[l],"function"!=typeof e&&"undefined"!=typeof e&&(this._evt[l]=e));this._fireEventAndReload()}},stop:function(){this._timer&&(clearTimeout(this._timer),this._timer=null);this._obj&&(this._callback(-1,this._node,this._evt),this._obj=null)},addKeyListener:function(f,e,b,g,t,u,r){var l="keyCode"in e?"keyCode":"charCode"in
e?"charCode":"charOrCode",m=[a(f,"keyCode"in e?"keydown":"charCode"in e?"keypress":h._keypress,d.hitch(this,function(a){a[l]!=e[l]||void 0!==e.ctrlKey&&e.ctrlKey!=a.ctrlKey||void 0!==e.altKey&&e.altKey!=a.altKey||void 0!==e.metaKey&&e.metaKey!=(a.metaKey||!1)||void 0!==e.shiftKey&&e.shiftKey!=a.shiftKey?k._obj==e&&k.stop():(a.stopPropagation(),a.preventDefault(),k.trigger(a,b,f,g,e,t,u,r))})),a(f,"keyup",d.hitch(this,function(){k._obj==e&&k.stop()}))];return{remove:function(){p.forEach(m,function(a){a.remove()})}}},
addMouseListener:function(f,e,b,h,t,u){var l=[a(f,"mousedown",d.hitch(this,function(a){a.preventDefault();k.trigger(a,e,f,b,f,h,t,u)})),a(f,"mouseup",d.hitch(this,function(a){this._obj&&a.preventDefault();k.stop()})),a(f,"mouseout",d.hitch(this,function(a){this._obj&&a.preventDefault();k.stop()})),a(f,"dblclick",d.hitch(this,function(a){a.preventDefault();9>g("ie")&&(k.trigger(a,e,f,b,f,h,t,u),setTimeout(d.hitch(this,k.stop),50))}))];return{remove:function(){p.forEach(l,function(a){a.remove()})}}},
addListener:function(a,d,b,f,g,h,k,v){var e=[this.addKeyListener(d,b,f,g,h,k,v),this.addMouseListener(a,f,g,h,k,v)];return{remove:function(){p.forEach(e,function(a){a.remove()})}}}};return k})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(p,h,d){return p("dijit.form.RangeBoundTextBox",d,{rangeMessage:"",rangeCheck:function(a,d){return("min"in d?0<=this.compare(a,d.min):!0)&&("max"in d?0>=this.compare(a,d.max):
!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var a=this.get("value");if(null==a)return!1;var d=!1;"min"in this.constraints&&(d=this.constraints.min,d=0>this.compare(a,"number"==typeof d&&0<=d&&0!=a?0:d));!d&&"max"in this.constraints&&(d=this.constraints.max,d=0<this.compare(a,"number"!=typeof d||0<d?d:0));return d},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(a){return this.inherited(arguments)&&
(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(a))},getErrorMessage:function(a){var d=this.get("value");return null==d||""===d||"number"==typeof d&&isNaN(d)||this.isInRange(a)?this.inherited(arguments):this.rangeMessage},postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=h.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare",
"dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(p,h,d,a){return p("dijit.form.MappedTextBox",a,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(a){return a.toString?a.toString():""},toString:function(){var a=this.filter(this.get("value"));return null!=a?"string"==typeof a?a:this.serialize(a,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},
buildRendering:function(){this.inherited(arguments);this.valueNode=d.place("\x3cinput type\x3d'hidden'"+(this.name?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),function(p,h,d,a,g,f){var k=function(a){a=a||{};var b=d.getLocalization("dojo.cldr",
"number",d.normalizeLocale(a.locale)),e=a.pattern?a.pattern:b[(a.type||"decimal")+"Format"];a="number"==typeof a.places?a.places:"string"===typeof a.places&&0<a.places.length?a.places.replace(/.*,/,""):-1!=e.indexOf(".")?e.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:b.decimal,places:a}},m=p("dijit.form.NumberTextBoxMixin",null,{pattern:function(a){return"("+(this.focused&&this.editOptions?this._regExpGenerator(h.delegate(a,this.editOptions))+"|":"")+this._regExpGenerator(a)+")"},value:NaN,
editOptions:{pattern:"#.######"},_formatter:g.format,_regExpGenerator:g.regexp,_decimalInfo:k(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(a){var b="number"==typeof a.places?a.places:0;b&&b++;"number"!=typeof a.max&&(a.max=9*Math.pow(10,15-b));"number"!=typeof a.min&&(a.min=-9*Math.pow(10,15-b));this.inherited(arguments,[a]);this.focusNode&&this.focusNode.value&&!isNaN(this.value)&&this.set("value",this.value);this._decimalInfo=
k(a)},_onFocus:function(){if(!this.disabled&&!this.readOnly){var a=this.get("value");"number"!=typeof a||isNaN(a)||(a=this.format(a,this.constraints),void 0!==a&&(this.textbox.value=a));this.inherited(arguments)}},format:function(a,b){var d=String(a);if("number"!=typeof a)return d;if(isNaN(a))return"";if(!("rangeCheck"in this&&this.rangeCheck(a,b))&&!1!==b.exponent&&/\de[-+]?\d/i.test(d))return d;this.editOptions&&this.focused&&(b=h.mixin({},b,this.editOptions));return this._formatter(a,b)},_parser:g.parse,
parse:function(a,b){var d=h.mixin({},b,this.editOptions&&this.focused?this.editOptions:{});if(this.focused&&null!=d.places){var e=d.places,e="number"===typeof e?e:Number(e.split(",").pop());d.places="0,"+e}d=this._parser(a,d);this.editOptions&&this.focused&&isNaN(d)&&(d=this._parser(a,b));return d},_getDisplayedValueAttr:function(){var a=this.inherited(arguments);return isNaN(a)?this.textbox.value:a},filter:function(a){if(null==a||"string"==typeof a&&""==a)return NaN;"number"!=typeof a||isNaN(a)||
0==a||(a=g.round(a,this._decimalInfo.places));return this.inherited(arguments,[a])},serialize:function(a,b){return"number"!=typeof a||isNaN(a)?"":this.inherited(arguments)},_setBlurValue:function(){var a=h.hitch(h.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(a,!0)},_setValueAttr:function(a,b,d){if(void 0!==a&&void 0===d)if(d=String(a),"number"==typeof a)if(isNaN(a))d="";else{if("rangeCheck"in this&&this.rangeCheck(a,this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(d))d=
void 0}else a?a=void 0:(d="",a=NaN);this.inherited(arguments,[a,b,d])},_getValueAttr:function(){var a=this.inherited(arguments);if(isNaN(a)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+g._realNumberRegexp(h.delegate(this.constraints))+"$")).test(this.textbox.value))return a=Number(this.textbox.value),isNaN(a)?void 0:a}else return a},isValid:function(a){if(!this.focused||this._isEmpty(this.textbox.value))return this.inherited(arguments);
var b=this.get("value");return!isNaN(b)&&this.rangeCheck(b,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var d="number"==typeof this.constraints.min,b="number"==typeof this.constraints.max,f=this.get("value");if(isNaN(f)||!d&&!b)return this.inherited(arguments);var g=f|0,h=0>f,k=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),m=(this.maxLength||20)-this.textbox.value.length,p=k?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,
""):"",g=k?g+"."+p:g+"",m=a.rep("9",m),k=f;h?k=Number(g+m):f=Number(g+m);return!(d&&f<this.constraints.min||b&&k>this.constraints.max)}});p=p("dijit.form.NumberTextBox",[f,m],{baseClass:"dijitTextBox dijitNumberTextBox"});p.Mixin=m;return p})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(p,h,d,a,g,f,k,m,e,b,l){var t=e("dijit.ColorPalette",[d,a,g],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:h,baseClass:"dijitColorPalette",_dyeFactory:function(a,b,d,e){return new this._dyeClass(a,
b,d,e)},buildRendering:function(){this.inherited(arguments);this._dyeClass=e(t._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],k.getLocalization("dojo","colors",this.lang))}});t._Color=e("dijit._Color",m,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":p.toUrl("./themes/a11y/colors7x10.png"),"3x4":p.toUrl("./themes/a11y/colors3x4.png")},constructor:function(a,b,d,e){this._title=e;this._row=b;this._col=d;this.setColor(m.named[a])},getValue:function(){return this.toHex()},fillCell:function(a,d){d=l.substitute(f("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:d,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});b.place(d,a)}});return t})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(p,h,d,a,g,f,k,m,e,b,l){return p("dijit._PaletteMixin",m,{defaultTimeout:500,timeoutChangeRate:.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(a){return new ("string"==
typeof this.dyeClass?f.getObject(this.dyeClass):this.dyeClass)(a)},_preparePalette:function(b,d){this._cells=[];var h=this._blankGif;this.own(k(this.gridNode,e,f.hitch(this,"_onCellClick")));for(var m=0;m<b.length;m++)for(var p=a.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),n=0;n<b[m].length;n++){var t=b[m][n];if(t){var c=this._dyeFactory(t,m,n,d[t]),t=a.create("td",{"class":this.cellClass,tabIndex:"-1",title:d[t],role:"gridcell"},p);c.fillCell(t,h);t.idx=this._cells.length;this._cells.push({node:t,
dye:c})}}this._xDim=b[0].length;this._yDim=b.length;var u={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},z;for(z in u)this.own(l.addKeyListener(this.domNode,{keyCode:g[z],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var a=u[z];return function(b){this._navigateByKey(a,b)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){b.focus(this._currentFocus)},
_onCellClick:function(a){for(var d=a.target;"TD"!=d.tagName;){if(!d.parentNode||d==this.gridNode)return;d=d.parentNode}var e=this._getDye(d).getValue();this._setCurrent(d);b.focus(d);this._setValueAttr(e,!0);a.stopPropagation();a.preventDefault()},_setCurrent:function(a){"_currentFocus"in this&&h.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=a)&&h.set(a,"tabIndex",this.tabIndex)},_setValueAttr:function(a,b){0<=this._selectedCell&&d.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(a)for(var e=0;e<this._cells.length;e++)if(a==this._cells[e].dye.getValue()){this._selectedCell=e;d.add(this._cells[e].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?a:null);if(b||void 0===b)this.onChange(a)},onChange:function(){},_navigateByKey:function(a,d){-1!=d&&(a=this._currentFocus.idx+a,a<this._cells.length&&-1<a&&(a=this._cells[a].node,this._setCurrent(a),this.defer(f.hitch(b,"focus",a))))},_getDye:function(a){return this._cells[a.idx].dye}})})},
"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x,z){var A=h("dijit.form._SliderMover",l,{onMouseMove:function(a){var b=
this.widget,c=b._abspos;c||(c=b._abspos=g.position(b.sliderBarContainer,!0),b._setPixelValue_=m.hitch(b,"_setPixelValue"),b._isReversed_=b._isReversed());a=a[b._mousePixelCoord]-c[b._startingPixelCoord];b._setPixelValue_(b._isReversed_?c[b._pixelCount]-a:a,c[b._pixelCount],!1)},destroy:function(a){l.prototype.destroy.apply(this,arguments);var b=this.widget;b._abspos=null;b._setValueAttr(b.value,!0)}});d=h("dijit.form.HorizontalSlider",[c,x],{templateString:z,value:0,showButtons:!0,minimum:0,maximum:100,
discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:v.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",_onKeyUp:function(a){this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey||this._setValueAttr(this.value,
!0)},_onKeyDown:function(a){if(!(this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey)){switch(a.keyCode){case k.HOME:this._setValueAttr(this.minimum,!1);break;case k.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?k.RIGHT_ARROW:k.LEFT_ARROW:case !1===this._descending?k.DOWN_ARROW:k.UP_ARROW:case !1===this._descending?k.PAGE_DOWN:k.PAGE_UP:this.increment(a);break;case this._descending||this.isLeftToRight()?k.LEFT_ARROW:k.RIGHT_ARROW:case !1===this._descending?
k.UP_ARROW:k.DOWN_ARROW:case !1===this._descending?k.PAGE_UP:k.PAGE_DOWN:this.decrement(a);break;default:return}a.stopPropagation();a.preventDefault()}},_onHandleClick:function(a){this.disabled||this.readOnly||(e("ie")||q.focus(this.sliderHandle),a.stopPropagation(),a.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(a){if(!this.disabled&&!this.readOnly&&this.clickSelect){q.focus(this.sliderHandle);a.stopPropagation();a.preventDefault();var b=g.position(this.sliderBarContainer,
!0),c=a[this._mousePixelCoord]-b[this._startingPixelCoord];this._setPixelValue(this._isReversed()?b[this._pixelCount]-c:c,b[this._pixelCount],!0);this._movable.onMouseDown(a)}},_setPixelValue:function(a,b,c){if(!this.disabled&&!this.readOnly){var d=this.discreteValues;if(1>=d||Infinity==d)d=b;d--;this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*Math.round(a/(b/d))/d+this.minimum,this.maximum),this.minimum),c)}},_setValueAttr:function(b,c){this._set("value",b);this.valueNode.value=
b;this.focusNode.setAttribute("aria-valuenow",b);this.inherited(arguments);var d=this.maximum>this.minimum?(b-this.minimum)/(this.maximum-this.minimum):0,e=!1===this._descending?this.remainingBar:this.progressBar,f=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(c&&0<this.slideDuration&&e.style[this._progressPixelSize]){var g=this,h={},k=parseFloat(e.style[this._progressPixelSize]),l=this.slideDuration*
(d-k/100);0!=l&&(0>l&&(l=0-l),h[this._progressPixelSize]={start:k,end:100*d,units:"%"},this._inProgressAnim=a.animateProperty({node:e,duration:l,onAnimate:function(a){f.style[g._progressPixelSize]=100-parseFloat(a[g._progressPixelSize])+"%"},onEnd:function(){delete g._inProgressAnim},properties:h}),this._inProgressAnim.play())}else e.style[this._progressPixelSize]=100*d+"%",f.style[this._progressPixelSize]=100*(1-d)+"%"},_bumpValue:function(a,b){if(!(this.disabled||this.readOnly||this.maximum<=this.minimum)){var c=
f.getComputedStyle(this.sliderBarContainer),d=g.getContentBox(this.sliderBarContainer,c),c=this.discreteValues;if(1>=c||Infinity==c)c=d[this._pixelCount];c--;a=Math.round((this.value-this.minimum)*c/(this.maximum-this.minimum))+a;0>a&&(a=0);a>c&&(a=c);a=a*(this.maximum-this.minimum)/c+this.minimum;this._setValueAttr(a,b)}},_onClkBumper:function(a){this.disabled||this.readOnly||!this.clickSelect||this._setValueAttr(a,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===this._descending?this.minimum:
this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(a){this._bumpValue(a.keyCode==k.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(a){this._bumpValue(a.keyCode==k.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(a){this.focused&&(a.stopPropagation(),a.preventDefault(),this._bumpValue(0>a.wheelDelta?-1:1,!0))},startup:function(){this._started||(p.forEach(this.getChildren(),function(a){this[a.container]!=this.containerNode&&
this[a.container].appendChild(a.domNode)},this),this.inherited(arguments))},_typematicCallback:function(a,b,c){if(-1==a)this._setValueAttr(this.value,!0);else this[b==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](c)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display="");var a=t('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+"_label"),this.focusNode.setAttribute("aria-labelledby",
a[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(n.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),n.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(r(this.domNode,u.wheel,m.hitch(this,"_mouseWheeled")));var a=h(A,{widget:this});this._movable=new b(this.sliderHandle,{mover:a});this._layoutHackIE7()},
destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});d._Mover=A;return d})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(p,h,d){return p("dijit.form.HorizontalRule",[h,d],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',
_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(a){return this._positionPrefix+a+this._positionSuffix+this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);var a;if(1==this.count)a=this._genHTML(50,0);else{var d,f=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){a=this._genHTML(0,0);for(d=1;d<this.count-1;d++)a+=this._genHTML(f*d,d);a+=this._genHTML(100,this.count-1)}else{a=this._genHTML(100,0);for(d=1;d<this.count-1;d++)a+=
this._genHTML(100-f*d,d);a+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=a}})})},"dojo/_base/query":function(){define(["../query","./NodeList"],function(p){return p})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(p,h,d,a,g,f,k,m,e){a("dijit-legacy-requires")&&f(0,function(){p(["dijit/form/RadioButton"])});
return h("dijit.form.CheckBox",[k,m],{templateString:e,baseClass:"dijitCheckBox",_setValueAttr:function(a,d){"string"==typeof a&&(this.inherited(arguments),a=!0);this._created&&this.set("checked",a,d)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&g("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");
this.inherited(arguments)},_onBlur:function(){this.id&&g("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");this.inherited(arguments)}})})},"dijit/form/ToggleButton":function(){define(["dojo/_base/declare","dojo/_base/kernel","./Button","./_ToggleButtonMixin"],function(p,h,d,a){return p("dijit.form.ToggleButton",[d,a],{baseClass:"dijitToggleButton",setChecked:function(a){h.deprecated("setChecked("+a+") is deprecated. Use set('checked',"+a+") instead.","","2.0");this.set("checked",a)}})})},
"dijit/form/_ToggleButtonMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(p,h){return p("dijit.form._ToggleButtonMixin",null,{checked:!1,_aria_attr:"aria-pressed",_onClick:function(d){var a=this.checked;this._set("checked",!a);var g=this.inherited(arguments);this.set("checked",g?this.checked:a);return g},_setCheckedAttr:function(d,a){this._set("checked",d);var g=this.focusNode||this.domNode;this._created&&h.get(g,"checked")!=!!d&&h.set(g,"checked",!!d);g.setAttribute(this._aria_attr,
String(d));this._handleOnChange(d,a)},postCreate:function(){this.inherited(arguments);var d=this.focusNode||this.domNode;this.checked&&d.setAttribute("checked","checked");void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.checked)},reset:function(){this._hasBeenBlurred=!1;this.set("checked",this.params.checked||!1)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(p,h){return p("dijit.form._CheckBoxMixin",null,{type:"checkbox",
value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(d){this._set("readOnly",d);h.set(this.focusNode,"readOnly",d)},_setLabelAttr:void 0,_getSubmitValue:function(d){return null==d||""===d?"on":d},_setValueAttr:function(d){d=this._getSubmitValue(d);this._set("value",d);h.set(this.focusNode,"value",d)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));h.set(this.focusNode,"value",this.value)},_onClick:function(d){return this.readOnly?
(d.stopPropagation(),d.preventDefault(),!1):this.inherited(arguments)}})})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox","./ComboBoxMixin"],function(p,h,d){return p("dijit.form.ComboBox",[h,d],{})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),function(p,h,d,
a,g,f,k,m,e){return p("dijit.form.ComboBoxMixin",[m,f],{dropDownClass:k,hasDownArrow:!0,templateString:e,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(a){this._set("hasDownArrow",a);this._buttonNode.style.display=a?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(b){b.get||a.mixin(b,{_oldAPI:!0,get:function(a){var b=new h;this.fetchItemByIdentity({identity:a,onItem:function(a){b.resolve(a)},
onError:function(a){b.reject(a)}});return b.promise},query:function(b,d){var e=new h(function(){f.abort&&f.abort()});e.total=new h;var f=this.fetch(a.mixin({query:b,onBegin:function(a){e.total.resolve(a)},onComplete:function(a){e.resolve(a)},onError:function(a){e.reject(a)}},d));return g(e)}});this._set("store",b)},postMixInProperties:function(){var b=this.params.store||this.store;b&&this._setStoreAttr(b);this.inherited(arguments);if(!this.params.store&&this.store&&!this.store._oldAPI){var e=this.declaredClass;
a.mixin(this.store,{getValue:function(a,b){d.deprecated(e+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return a[b]},getLabel:function(a){d.deprecated(e+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return a.name},fetch:function(b){d.deprecated(e+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],a.hitch(this,function(a){(new a({objectStore:this})).fetch(b)}))}})}},
buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(p,h,d,a,g,f,k,m,e,b,l){h=h("dijit.form._AutoCompleterMixin",l,{item:null,autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",
maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(a){var b=0;if("number"==typeof a.selectionStart)b=a.selectionStart;else if(m("ie")){var d=a.ownerDocument.selection.createRange().duplicate();a=a.createTextRange();d.move("character",0);a.move("character",0);try{a.setEndPoint("EndToEnd",d),b=String(a.text).replace(/\r/g,"").length}catch(v){}}return b},_setCaretPos:function(a,d){d=parseInt(d);b.selectInputText(a,d,d)},_setDisabledAttr:function(a){this.inherited(arguments);this.domNode.setAttribute("aria-disabled",
a?"true":"false")},_onKey:function(b){if(!(32<=b.charCode)){var d=b.charCode||b.keyCode;if(d!=a.ALT&&d!=a.CTRL&&d!=a.META&&d!=a.SHIFT){var e=this.dropDown,f=null;this._abortQuery();this.inherited(arguments);if(!(b.altKey||b.ctrlKey||b.metaKey))switch(this._opened&&(f=e.getHighlightedOption()),d){case a.PAGE_DOWN:case a.DOWN_ARROW:case a.PAGE_UP:case a.UP_ARROW:this._opened&&this._announceOption(f);b.stopPropagation();b.preventDefault();break;case a.ENTER:if(f){if(f==e.nextButton){this._nextSearch(1);
b.stopPropagation();b.preventDefault();break}else if(f==e.previousButton){this._nextSearch(-1);b.stopPropagation();b.preventDefault();break}b.stopPropagation();b.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case a.TAB:d=this.get("displayedValue");if(e&&(d==e._messages.previousMessage||d==e._messages.nextMessage))break;f&&this._selectOption(f);case a.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},_autoCompleteText:function(a){var d=
this.focusNode;b.selectInputText(d,d.value.length);var e=this.ignoreCase?"toLowerCase":"substr";0==a[e](0).indexOf(this.focusNode.value[e](0))?(e=this.autoComplete?this._getCaretPos(d):d.value.length,e+1>d.value.length&&(d.value=a,b.selectInputText(d,e))):(d.value=a,b.selectInputText(d))},_openResultList:function(a,b,d){var e=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();a.length||0!=d.start?(this._nextSearch=this.dropDown.onPage=g.hitch(this,function(b){a.nextPage(-1!==b);
this.focus()}),this.dropDown.createOptions(a,d,g.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in d?(d.direction?this.dropDown.highlightFirstOption():d.direction||this.dropDown.highlightLastOption(),e&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(b[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)):this.closeDropDown()},_showResultList:function(){this.closeDropDown(!0);
this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var a=this.get("displayedValue"),b=this.dropDown;!b||a!=b._messages.previousMessage&&a!=b._messages.nextMessage?"undefined"==typeof this.item?(this.item=null,this.set("displayedValue",a)):(this.value!=
this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(a,b,d){var e="";a&&(d||(d=this.store._oldAPI?this.store.getValue(a,this.searchAttr):a[this.searchAttr]),e=this._getValueField()!=this.searchAttr?this.store.getIdentity(a):d);this.set("value",e,b,d,a)},_announceOption:function(a){if(a){var b;if(a==this.dropDown.nextButton||a==this.dropDown.previousButton)b=
a.innerHTML,this.item=void 0,this.value="";else{var e=this.dropDown.items[a.getAttribute("item")];b=(this.store._oldAPI?this.store.getValue(e,this.searchAttr):e[this.searchAttr]).toString();this.set("item",e,!1,b)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",d.get(a,"id"));this._autoCompleteText(b)}},_selectOption:function(a){this.closeDropDown();a&&this._announceOption(a);this._setCaretPos(this.focusNode,this.focusNode.value.length);
this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(a){if(!this.dropDown){var b=this.id+"_popup";this.dropDown=new (g.isString(this.dropDownClass)?g.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:g.hitch(this,this._selectOption),id:b,dir:this.dir,textDir:this.textDir})}this._lastInput=a;this.inherited(arguments)},
_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new e({},this.srcNodeRef),!("value"in this.params))){var a=this.item=this.store.fetchSelectedItem();if(a){var b=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(a,b):a[b]}}},postCreate:function(){var a=f('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",
a[0].id));this.inherited(arguments);p.after(this,"onSearch",g.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(a){a=this.labelFunc(a,this.store);var b=this.labelType;"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(a=this.doHighlight(a,this._lastInput),b="html");return{html:"html"==b,label:a}},doHighlight:function(a,b){var d=(this.ignoreCase?"i":"")+("all"==this.highlightMatch?"g":""),e=this.queryExpr.indexOf("${0}");b=k.escapeString(b);return this._escapeHtml(a.replace(new RegExp((0==
e?"^":"")+"("+b+")"+(e==this.queryExpr.length-4?"$":""),d),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(a){return a=String(a).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},labelFunc:function(a,b){return(b._oldAPI?b.getValue(a,this.labelAttr||this.searchAttr):a[this.labelAttr||this.searchAttr]).toString()},
_setValueAttr:function(a,b,d,e){this._set("item",e||null);null==a&&(a="");this.inherited(arguments)}});m("dojo-bidi")&&h.extend({_setTextDirAttr:function(a){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",a)}});return h})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),function(p,h,d,a,g,f){function k(a){return{id:a.value,value:a.value,name:d.trim(a.innerText||a.textContent||"")}}return p("dijit.form.DataList",
g,{constructor:function(g,e){this.domNode=h.byId(e);d.mixin(this,g);this.id&&f.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:a("option",this.domNode).map(k)}])},destroy:function(){f.remove(this.id)},fetchSelectedItem:function(){var d=a("\x3e option[selected]",this.domNode)[0]||a("\x3e option",this.domNode)[0];return d&&k(d)}})})},"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),
function(p,h,d,a,g,f,k){return p("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(a){this._set("list",a)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(a){return new RegExp("^"+a.replace(/(\\.)|(\*)|(\?)|\W/g,function(a,b,d,f){return d?".*":f?".":b?b:"\\"+a})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&
(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(a){if(!this.disabled&&!this.readOnly){a=a.charOrCode;this._prev_key_backspace=!1;if(a==h.DELETE||a==h.BACKSPACE)this._maskValidSubsetError=this._prev_key_backspace=!0;if(this.store)this.searchTimer=
this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(a){this._abortQuery();var e=this,b=d.clone(this.query),h={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},k=g.substitute(this.queryExpr,[a.replace(/([\\\*\?])/g,"\\$1")]),m,p=function(){var a=e._fetchHandle=e.store.query(b,h);e.disabled||e.readOnly||m!==e._lastQuery||f(a,function(d){e._fetchHandle=
null;e.disabled||e.readOnly||m!==e._lastQuery||f(a.total,function(a){d.total=a;var f=e.pageSize;if(isNaN(f)||f>d.total)f=d.total;d.nextPage=function(a){h.direction=a=!1!==a;h.count=f;a?(h.start+=d.length,h.start>=d.total&&(h.count=0)):(h.start-=f,0>h.start&&(h.count=Math.max(f+h.start,0),h.start=0));0>=h.count?(d.length=0,e.onSearch(d,b,h)):p()};e.onSearch(d,b,h)})},function(a){e._fetchHandle=null;e._cancelingQuery||console.error(e.declaredClass+" "+a.toString())})};d.mixin(h,this.fetchProperties);
this.store._oldAPI?m=k:(m=this._patternToRegExp(k),m.toString=function(){return k});this._lastQuery=b[this.searchAttr]=m;this._queryDeferHandle=this.defer(p,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var a=this.list;a&&(this.store=k.byId(a))}this.inherited(arguments)}})})},"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),
function(p,h,d,a,g,f,k,m){return p("dijit.form._ComboBoxMenu",[g,f,m,k],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(h.add(this.previousButton,"dijitMenuItemRtl"),h.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var a=this.ownerDocument.createElement("div");a.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");a.setAttribute("role","option");return a},onHover:function(a){h.add(a,"dijitMenuItemHover")},onUnhover:function(a){h.remove(a,
"dijitMenuItemHover")},onSelect:function(a){h.add(a,"dijitMenuItemSelected")},onDeselect:function(a){h.remove(a,"dijitMenuItemSelected")},_page:function(a){var b=0,e=this.domNode.scrollTop,f=d.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();b<f;){var g=this.getHighlightedOption();if(a){if(!g.previousSibling||"none"==g.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!g.nextSibling||"none"==g.nextSibling.style.display)break;this.selectNextNode()}g=
this.domNode.scrollTop;b+=(g-e)*(a?-1:1);e=g}},handleKey:function(d){switch(d.keyCode){case a.DOWN_ARROW:return this.selectNextNode(),!1;case a.PAGE_DOWN:return this._page(!1),!1;case a.UP_ARROW:return this.selectPreviousNode(),!1;case a.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(p,h,d,a,g){var f=h("dijit.form._ComboBoxMenuMixin"+
(a("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=g.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(a){this._set("value",a);this.onChange(a)},onClick:function(a){if(a==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(a==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(a)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(a,d){var e=this._createMenuItem();a=d(a);a.html?e.innerHTML=a.label:e.appendChild(e.ownerDocument.createTextNode(a.label));""==e.innerHTML&&(e.innerHTML="\x26#160;");return e},createOptions:function(a,f,e){this.items=a;this.previousButton.style.display=0==f.start?"none":"";d.set(this.previousButton,"id",this.id+
"_prev");p.forEach(a,function(a,b){a=this._createOption(a,e);a.setAttribute("item",b);d.set(a,"id",this.id+b);this.nextButton.parentNode.insertBefore(a,this.nextButton)},this);var b=!1;a.total&&!a.total.then&&-1!=a.total?f.start+f.count<a.total?b=!0:f.start+f.count>a.total&&f.count==a.length&&(b=!0):f.count==a.length&&(b=!0);this.nextButton.style.display=b?"":"none";d.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var a=this.containerNode;2<a.childNodes.length;)a.removeChild(a.childNodes[a.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});a("dojo-bidi")&&(f=h("dijit.form._ComboBoxMenuMixin",
f,{_createOption:function(){var a=this.inherited(arguments);this.applyTextDir(a);return a}}));return f})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(p,h,d,a){return p("dijit.form._ListMouseMixin",a,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(a,d){this._setSelectedAttr(d,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(d)})},_onMouseDown:function(a,d){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(d,!1)},_onMouseUp:function(a,d){this._isDragging=!1;var f=this.selected,g=this._hoveredNode;f&&d==f?this.defer(function(){this._onClick(a,
f)}):g&&this.defer(function(){this._onClick(a,g)})},_onMouseOut:function(a,d){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(a,d){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=d;this.onHover(d);this._isDragging&&this._setSelectedAttr(d,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(p,h,d){return p("dijit.form._ListBase",null,{selected:null,_listConnect:function(a,d){var f=this;return f.own(h(f.containerNode,h.selector(function(a,d,e){return a.parentNode==e},a),function(a){f[d](a,this)}))},selectFirstNode:function(){for(var a=this.containerNode.firstChild;a&&"none"==a.style.display;)a=a.nextSibling;this._setSelectedAttr(a,!0)},selectLastNode:function(){for(var a=this.containerNode.lastChild;a&&"none"==a.style.display;)a=a.previousSibling;this._setSelectedAttr(a,
!0)},selectNextNode:function(){var a=this.selected;if(a){for(a=a.nextSibling;a&&"none"==a.style.display;)a=a.nextSibling;a?this._setSelectedAttr(a,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var a=this.selected;if(a){for(a=a.previousSibling;a&&"none"==a.style.display;)a=a.previousSibling;a?this._setSelectedAttr(a,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(a,g){if(this.selected!=a){var f=this.selected;if(f)this.onDeselect(f);
a&&(g&&d.scrollIntoView(a),this.onSelect(a));this._set("selected",a)}else if(a)this.onSelect(a)}})})},"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n        \x3cimg data-dojo-attach-point\x3d"loadingImg"/\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:esri/views/3d/environment/materials/SimpleAtmosphereMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsSimpleAtmosphere"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n\r\n#ifndef PANORAMIC\r\n\r\n  const float TWICEPI \x3d 2.0*3.14159265;\r\n  const float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\r\n\r\n  uniform vec3 silCircleCenter;\r\n  uniform vec3 silCircleV1;\r\n  uniform vec3 silCircleV2;\r\n  uniform vec2 texV;\r\n\r\n#endif\r\n\r\n  uniform vec3 lightDirection;\r\n\r\n  attribute vec3 $position;\r\n  varying vec2 vtc;\r\n  varying float falloff;\r\n\r\n  void main(void) {\r\n\r\n#ifdef PANORAMIC\r\n\r\n    vec3 pos \x3d $position;\r\n    float ndotl \x3d lightDirection.z;\r\n    vtc \x3d vec2(0, $position.z+0.05);\r\n\r\n#else\r\n\r\n    float phi \x3d $position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\r\n    vec3 pos \x3d (sin(phi) * silCircleV1 + cos(phi) * silCircleV2 + silCircleCenter) * $position.y;\r\n    float ndotl \x3d dot(normalize(pos), lightDirection);\r\n\r\n    vtc.x \x3d $position.x / ATMOSPHERE_RIM_SEGMENTS;\r\n    vtc.y \x3d texV.x * (1.0 - $position.z) + texV.y * $position.z;\r\n\r\n#endif\r\n\r\n    falloff \x3d max(0.0, (smoothstep(-1.0, 0.8, ndotl + ndotl)));\r\n\r\n    gl_Position \x3d proj * view * vec4(pos, 1.0);\r\n    gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsSimpleAtmosphere"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n  uniform vec4 color;\r\n  varying vec2 vtc;\r\n  varying float falloff;\r\n\r\n  void main() {\r\n    vec4 texColor \x3d texture2D(tex, vtc);\r\n    gl_FragColor \x3d texColor * color * falloff;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/environment/materials/RealisticAtmosphereMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3c!--Vertex Shader for Atmosphere--\x3e\r\n\x3csnippet name\x3d"vsRealisticAtmosphere"\x3e\x3c![CDATA[\r\n//\r\n// Based on Atmospheric scattering vertex shader by Sean O\'Neil from GPU Gems 2 Chapter 16.\r\n//\r\n// Link:                   http://http.developer.nvidia.com/GPUGems2/gpugems2_chapter16.html\r\n// Download Portal:        http://http.download.nvidia.com/developer/GPU_Gems_2/CD/Index.html\r\n// Unmodified Source Code: http://http.download.nvidia.com/developer/GPU_Gems_2/CD/Content/16.zip\r\n//\r\n// Adapted for WebGIS by Jascha Gr\u00fcbel (jgruebel@esri.com), Z\u00fcrich 2015\r\n//\r\n\r\n  $vsprecisionf\r\n\r\n  //Camera\r\n  uniform vec2 halfSizeNearPlane;\r\n  uniform vec3 v3CameraUp;\r\n  uniform vec3 v3CameraRight;\r\n  uniform vec3 v3CameraDir;\r\n  uniform vec2 v2CameraCenterOffset;\r\n\r\n  //Attributes\r\n  attribute vec3 $position;\r\n  attribute vec2 $uv0;\r\n\r\n  //Varyings\r\n  varying vec3 v3WorldRay;\r\n  varying vec2 vtc;\r\n\r\n#ifdef HAZE\r\n  varying vec3 v3EyeDir;\r\n#endif\r\n\r\n  void main(void) {\r\n    vec3 v3Pos \x3d $position;\r\n    vtc \x3d $uv0;\r\n    vec2 rayvtc \x3d $uv0 - v2CameraCenterOffset;\r\n\r\n#ifdef HAZE\r\n    v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\r\n#else\r\n    vec3 v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\r\n#endif\r\n    v3WorldRay \x3d v3EyeDir.z*v3CameraDir + v3EyeDir.y*v3CameraUp + v3EyeDir.x*v3CameraRight;\r\n    gl_Position \x3d vec4(v3Pos, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"atmosphereScaleFunction"\x3e\x3c![CDATA[\r\n  //Approximation for inner integral based on a radii ratio of 10.25:10\r\n  float scale(float fCos){\r\n    float x \x3d 1.0 - fCos;\r\n    return exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"toneMapperConstants"\x3e\x3c![CDATA[\r\n#ifdef HAZE\r\n  const float fOneOverGamma \x3d 1.0;//Gamma \x3d 1.0\r\n#else\r\n  const float fOneOverGamma \x3d 0.454545; // Gamma \x3d 2.2\r\n#endif\r\n  const vec3 v3OneOverGamma \x3d vec3(fOneOverGamma);\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"exponentialToneMapper"\x3e\x3c![CDATA[\r\n  //ToneMapping operators\r\n  vec3 expTM(vec3 inputColor,float exposure){\r\n      return pow(1.0 - exp(inputColor * -exposure), v3OneOverGamma);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"reinhardToneMapper"\x3e\x3c![CDATA[\r\n  vec3 reinhardTM(vec3 inputColor, float exposure){\r\n      vec3 intermediate \x3d inputColor *exposure;\r\n      intermediate /\x3d (1.0+intermediate);\r\n      return pow(intermediate, v3OneOverGamma);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"HSVColorSpace"\x3e\x3c![CDATA[\r\n//based on http://gamedev.stackexchange.com/a/59808\r\n// Hue in range [0,1] instead of 360\u00b0\r\nvec3 rgb2hsv(vec3 c)\r\n{\r\n    vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\r\n    vec4 p \x3d mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\r\n    vec4 q \x3d mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\r\n\r\n    float d \x3d q.x - min(q.w, q.y);\r\n    float e \x3d 1.0e-10;\r\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\r\n}\r\n\r\nvec3 hsv2rgb(vec3 c)\r\n{\r\n    vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\r\n    vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\r\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\r\n}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"atmosphereUniformsConstantsVaryings"\x3e\x3c![CDATA[\r\n\r\n  //Light\r\n  uniform vec3 v3LightDir;      // The direction vector to the light source\r\n  uniform vec3 v3InvWavelength; // 1 / pow(wavelength, 4) for the red, green, and blue channels\r\n  uniform vec3 v3InvWavelengthScaled; //v3InvWavelength * fKr4PI + fKm4PI\r\n\r\n  //Radii\r\n  uniform vec4 v4Radii; // inner, inner^2, outer, outer^2,\r\n\r\n  //Atmosphere\r\n  const float fKrESun \x3d 0.075;        // Kr * ESun \x3d 0.005 * 15.0\r\n  const float fKmESun \x3d 0.015;        // Km * ESun \x3d 0.005 * 15\r\n  //uniform float fScale;         // 1 / (fOuterRadius - fInnerRadius)\r\n  //uniform float fScaleDepth;    // The scale depth (i.e. the altitude at which the atmosphere\'s average density is found)\r\n  //uniform float fScaleOverScaleDepth; // fScale / fScaleDepth\r\n  //uniform float fOneOverScaleDepth; // 1.0 / fScaleDepth\r\n\r\n  //uniform float fScaleDepthBlue;    // The scale depth (i.e. the altitude at which the atmosphere\'s average density is found)\r\n  //uniform float fScaleOverScaleDepthBlue; // fScale / fScaleDepth\r\n  //uniform float fOneOverScaleDepthBlue; // 1.0 / fScaleDepth\r\n\r\n  uniform vec4 v4AtmosParams1; //(fScale,fScaleDepth,fScaleOverScaleDepth,fOneOverScaleDepth)\r\n  uniform vec4 v4AtmosParams2; //(g,fScaleDepthBlue,fScaleOverScaleDepthBlue,fOneOverScaleDepthBlue)\r\n#ifndef HAZE\r\n  uniform vec4 v4AtmosParams3; //(g2,fMiePhaseCoefficients,fLowerAlphaBlendBound,fOneOverOuterRadiusMinusAlphaBlendBound)\r\n#endif\r\n\r\n  //Camera\r\n  uniform vec3 v3CameraPos;     // The camera\'s current position\r\n  //uniform float fCameraHeight;  // The camera\'s current height\r\n  //uniform float fCameraHeight2; // fCameraHeight^2\r\n  //uniform float fC; //fCameraHeight2 - fOuterRadius2; // C \x3d ||o-c||^2 - r^2\r\n  //uniform float fCSur; //fCameraHeight2 - (fInnerRadius2 - 63756370000.0); // C \x3d ||o-c||^2 - r^2\r\n  uniform vec4 v4SphereComp; //The camera\'s current height, CameraHeight^2,fC,fCSur\r\n  uniform vec2 nearFar;\r\n\r\n  //Camera HDR\r\n#ifdef HAZE\r\n  const float fExposure \x3d 1.5;\r\n#else\r\n  const float fExposure \x3d 2.0;\r\n#endif\r\n\r\n#ifdef HAZE\r\n  //Depth texture\r\n  uniform sampler2D tDepth;\r\n#endif\r\n\r\n  //Testing variables\r\n  uniform float showTest;\r\n\r\n  //Varyings\r\n  varying vec3 v3EyeDir;\r\n  varying vec3 v3WorldRay;\r\n  varying vec2 vtc;\r\n\r\n  //Loop constants for integral approximation\r\n  const float fSamples \x3d 5.0;\r\n  const int maxSamples \x3d 5;\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmospherePrecomputation"\x3e\x3c![CDATA[\r\n    float fInnerRadius \x3d v4Radii[0];   // The inner (planetary) radius\r\n    float fInnerRadius2 \x3d v4Radii[1];  // fInnerRadius^2\r\n    float fOuterRadius \x3d v4Radii[2];   // The outer (atmosphere) radius\r\n    float fOuterRadius2 \x3d v4Radii[3];  // fOuterRadius^2\r\n\r\n    float fCameraHeight \x3d v4SphereComp[0];\r\n    float fCameraHeight2 \x3d v4SphereComp[1];\r\n    float fC \x3d v4SphereComp[2];\r\n    float fCSur \x3d v4SphereComp[3];\r\n\r\n#ifdef PLANAR\r\n    vec3 cameraPosition \x3d vec3(0.0,0.0,fCameraHeight);\r\n#else\r\n    vec3 cameraPosition \x3d v3CameraPos;\r\n#endif\r\n\r\n    //Debug variables\r\n    vec3 test \x3d vec3(0.0,0.0,0.0);\r\n\r\n    //Obtain ray from Camera\r\n    vec3 worldSpaceRay \x3d normalize(v3WorldRay);\r\n\r\n    //Compute Atmosphere intersection; i.e. ray/sphere intersection\r\n    float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay); // B \x3d 2(l * (o-c))\r\n    float det \x3d B*B - 4.0 * fC; // det \x3d B^2 - 4.0* C\r\n\r\n    //idealized sphere intersection to discard early some pixels\r\n    float detSur \x3d B*B - 4.0 * fCSur; // det \x3d B^2 - 4.0* C\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereDiscardPixels"\x3e\x3c![CDATA[\r\n#ifdef HAZE\r\n      bool continueComputation \x3d true;\r\n\r\n      // only use red channel from depth texture.\r\n      // see \'Issues\' at https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture\r\n      float depthSample \x3d texture2D(tDepth, vtc).r;\r\n\r\n      float zNear \x3d nearFar[0];\r\n      float zFar \x3d nearFar[1];\r\n\r\n      // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\r\n      float zNorm \x3d 2.0 * depthSample - 1.0;\r\n      float linDepth \x3d 2.0 * zNear * zFar /\r\n        (zFar + zNear - zNorm * (zFar - zNear));\r\n\r\n      float rayEndT;\r\n      float altitudeAlpha \x3d 1.0;\r\n\r\n      // find intersections with ground, but only between the near and far\r\n      // clipping planes.\r\n      if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\r\n        vec3 cameraSpaceRay \x3d normalize(v3EyeDir);\r\n        cameraSpaceRay /\x3d cameraSpaceRay.z;\r\n        cameraSpaceRay *\x3d linDepth;\r\n\r\n        float cameraSpaceRayLength \x3d length(cameraSpaceRay);\r\n\r\n#ifndef PLANAR\r\n        vec3 v3World \x3d cameraPosition + worldSpaceRay * cameraSpaceRayLength;\r\n        float v3WorldRadius2 \x3d dot(v3World, v3World);\r\n\r\n        // Handle tall structures:\r\n        // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\r\n        float transitionStart \x3d fInnerRadius + 20000.0;\r\n        float transitionHeight \x3d 25000.0;\r\n        float transitionEnd \x3d transitionStart + transitionHeight;\r\n\r\n        float edge0 \x3d transitionStart * transitionStart;\r\n        float edge1 \x3d transitionEnd * transitionEnd;\r\n\r\n        altitudeAlpha \x3d 1.0 - clamp((v3WorldRadius2 - edge0) / (edge1 - edge0), 0.0, 1.0);\r\n        rayEndT \x3d cameraSpaceRayLength;\r\n\r\n        if (altitudeAlpha \x3e 0.0) {\r\n          continueComputation \x3d true;\r\n\r\n          if (detSur \x3e 0.0) {\r\n            float nearSurfaceT \x3d 0.5 *(-B - sqrt(detSur));\r\n            float interp \x3d clamp(((fCameraHeight - fInnerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\r\n            rayEndT \x3d mix(cameraSpaceRayLength, nearSurfaceT, interp);\r\n          }\r\n        }\r\n#else\r\n        rayEndT \x3d cameraSpaceRayLength;\r\n#endif\r\n      }\r\n#ifdef PLANAR\r\n      if (16500.0 + fInnerRadius \x3e\x3d fCameraHeight){\r\n        continueComputation \x3d true;\r\n      }\r\n#endif\r\n#endif\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"atmosphereUnpackAddUniforms"\x3e\x3c![CDATA[\r\n        float fScale \x3d v4AtmosParams1.x;\r\n        vec2 v2ScaleDepth \x3d vec2(v4AtmosParams1.y,v4AtmosParams2.y);//fScaleDepth, fScaleDepthBlue\r\n        vec2 v2ScaleOverScaleDepth \x3d vec2(v4AtmosParams1.z,v4AtmosParams2.z);//fScaleOverScaleDepth, fScaleOverScaleDepthBlue\r\n        vec2 v2OneOverScaleDepth \x3d vec2(v4AtmosParams1.w,v4AtmosParams2.w);//fOneOverScaleDepth, fOneOverScaleDepthBlue\r\n\r\n#ifndef HAZE\r\n        float g \x3d v4AtmosParams2.x;\r\n        float g2 \x3d v4AtmosParams3.x;\r\n        float fMiePhaseCoefficients \x3d v4AtmosParams3.y;\r\n        float fLowerAlphaBlendBound \x3d v4AtmosParams3.z;\r\n        float fOneOverOuterRadiusMinusAlphaBlendBound \x3d v4AtmosParams3.w;\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereComputeRayAndLoopSetup"\x3e\x3c![CDATA[\r\n        float rayStartT \x3d 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\r\n#ifdef HAZE\r\n        float nearT \x3d abs(rayStartT);\r\n        float farT \x3d abs(rayEndT);\r\n#else\r\n        float rayEndT \x3d 0.5 *(-B + sqrt(det)); //far intersection with atmosphere\r\n\r\n#endif\r\n\r\n        float fDistance;//calculate its scattering offset\r\n        // Calculate the ray\'s starting position\r\n        if (rayStartT \x3c 0.0)\r\n        { //ray starts from camera to far\r\n          rayStartT \x3d 0.0;\r\n#ifndef HAZE\r\n          fDistance \x3d fScale*(fInnerRadius - fCameraHeight);\r\n#endif\r\n        }\r\n#ifndef HAZE\r\n        else\r\n        {//outside atmosphere\r\n          fDistance \x3d -1.0;\r\n        }\r\n#endif\r\n\r\n        // Initialize the scattering loop variables\r\n        vec3 v3Start \x3d cameraPosition + worldSpaceRay * rayStartT;\r\n\r\n#ifdef HAZE\r\n        vec3 v3End \x3d cameraPosition + worldSpaceRay * rayEndT;\r\n\r\n        float fEndLength \x3d length(v3End);\r\n        float fLocalCameraHeight \x3d length(v3Start);\r\n\r\n        //computed for the original end point to get consistent light angles after possible inversions\r\n        float fLightAngle \x3d dot(v3LightDir, v3End) / fEndLength;\r\n\r\n        if (nearT \x3e farT)\r\n        {\r\n          if (fLocalCameraHeight \x3c fEndLength)\r\n          {\r\n            //Switch positive slopes for flipped rays\r\n            v3End \x3d cameraPosition + worldSpaceRay * rayStartT;\r\n            v3Start \x3d cameraPosition + worldSpaceRay * rayEndT;\r\n            worldSpaceRay *\x3d -1.0;\r\n            fEndLength \x3d length(v3End);\r\n            fLocalCameraHeight \x3d length(v3Start);\r\n          }\r\n          else if (fLocalCameraHeight \x3d\x3d fEndLength)\r\n          {// create minuscule fake slope for integration if the slope is zero\r\n            fLocalCameraHeight +\x3d 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\r\n            //slope for the camera function\r\n          }\r\n        }\r\n\r\n        //Calculate its scattering offset\r\n        // Assumes camera constrains of WSV 3.8\r\n        float fCameraDepth;\r\n        float fCameraDepthBlue;\r\n        if (fLocalCameraHeight \x3e fOuterRadius)\r\n        {\r\n          fDistance \x3d fInnerRadius - fOuterRadius;\r\n        } else\r\n        {//outside atmosphere\r\n          fDistance \x3d fEndLength - fLocalCameraHeight;\r\n        }\r\n\r\n#endif\r\n        vec2 v2OpticalStartDepth \x3d exp(fDistance * v2OneOverScaleDepth);\r\n\r\n        float fRayLength \x3d rayEndT - rayStartT;\r\n        float fSampleLength \x3d fRayLength / fSamples;\r\n        float fScaledLength \x3d fSampleLength * fScale;\r\n        vec3 v3SampleRay \x3d worldSpaceRay * fSampleLength;\r\n        vec3 v3SamplePoint \x3d v3Start + v3SampleRay * 0.5;\r\n\r\n#ifdef HAZE\r\n        float fCameraAngle \x3d dot(-worldSpaceRay, v3End) / fEndLength;\r\n        float fScaleCameraAngle \x3d scale(fCameraAngle);\r\n        vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth;\r\n\r\n        float scaledValues \x3d scale(fLightAngle) + fScaleCameraAngle;\r\n        vec2 v2ScaledValuesDepth \x3d scaledValues * v2ScaleDepth;\r\n#else\r\n        float fCameraAngle \x3d dot(worldSpaceRay, v3Start / length(v3Start));\r\n        float angleMultiplier \x3d fCameraAngle\x3e0.0?fCameraAngle:0.0;\r\n\r\n        float fScaleCameraAngle \x3d scale(fCameraAngle);\r\n        vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth * v2ScaleDepth;\r\n#endif\r\n\r\n        //Loop variables\r\n        vec3 v3FrontColor \x3d vec3(0.0, 0.0, 0.0);\r\n        vec3 v3FrontColorBlue \x3d vec3(0.0, 0.0, 0.0);\r\n        vec3 v3Attenuate\x3d vec3(0.0, 0.0, 0.0);\r\n        vec3 v3AttenuateBlue \x3d vec3(0.0, 0.0, 0.0);\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereComputeSampleContribution"\x3e\x3c![CDATA[\r\n          float fHeight \x3d length(v3SamplePoint);\r\n          vec2 v2Depth \x3d exp(v2ScaleOverScaleDepth * (fInnerRadius - fHeight));\r\n#ifdef HAZE\r\n          vec2 v2Scatter \x3d v2Depth*v2ScaledValuesDepth-v2CameraOffset;\r\n#else\r\n          float fLightAngle \x3d dot(v3LightDir, v3SamplePoint) / fHeight;\r\n          float fCameraAngle \x3d dot(worldSpaceRay, v3SamplePoint) / fHeight;\r\n          float fTempScaledValues \x3d scale(fLightAngle) - scale(fCameraAngle);\r\n          vec2 v2Scatter \x3d v2CameraOffset + fTempScaledValues*v2Depth* v2ScaleDepth;\r\n#endif\r\n          v3Attenuate \x3d exp(-v2Scatter.x * v3InvWavelengthScaled);\r\n          v3AttenuateBlue \x3d exp(-v2Scatter.y * v3InvWavelengthScaled);\r\n\r\n          v3FrontColor +\x3d v3Attenuate * v2Depth.x;\r\n          v3FrontColorBlue +\x3d v3AttenuateBlue * v2Depth.y;\r\n\r\n          v3SamplePoint +\x3d v3SampleRay;\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereComputeHDRColors"\x3e\x3c![CDATA[\r\n        //Phase computation\r\n        //clamp to avoid numerical instability at fCos \x3d\x3d -1.0 (and close values) to display fake sun\r\n        float fCos \x3d clamp(dot(v3LightDir, -worldSpaceRay ),-0.9999999,1.0);\r\n        float fOnePlusCos2 \x3d fCos*fCos + 1.0;\r\n#ifdef HAZE\r\n        // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\r\n        vec3 colorCoefficients \x3d (fScaledLength* 0.75 * fOnePlusCos2)*(fKrESun*v3InvWavelength+fKmESun);\r\n\r\n        //Scaled Length is only applied afterwards to save multiplications\r\n        vec3 v3Color \x3d colorCoefficients *v3FrontColor;\r\n        vec3 v3ColorBlue \x3d colorCoefficients *v3FrontColorBlue;\r\n#else\r\n        vec3 v3RayleighCoefficients \x3d (fScaledLength*0.75 * fOnePlusCos2*fKrESun)*v3InvWavelength;\r\n        float fMieCoefficients \x3d fScaledLength*fKmESun * fMiePhaseCoefficients * fOnePlusCos2 / pow(1.0 + g2 - 2.0*g*fCos, 1.5);\r\n\r\n        // Calculate the attenuation factor for the ground\r\n        vec3 v3Color \x3d v3RayleighCoefficients * v3FrontColor + fMieCoefficients * v3FrontColor;\r\n        vec3 v3ColorBlue \x3d v3RayleighCoefficients * v3FrontColorBlue + fMieCoefficients * v3FrontColorBlue;\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereComputePixelColor"\x3e\x3c![CDATA[\r\n\r\n\r\n        //HDR to LDR conversion\r\n        vec3 ldrBlue \x3d expTM(v3ColorBlue,2.0*fExposure);\r\n        vec3 ldrRed \x3d expTM(v3Color,fExposure);\r\n\r\n        //mix reddish and blueish atmosphere\r\n        vec3 LDR \x3d mix(ldrBlue,ldrRed,0.2);\r\n#ifdef HAZE\r\n        LDR *\x3d (1.0-fCameraAngle);\r\n        vec3 hsv \x3d rgb2hsv(LDR);\r\n        hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0);//boost haze saturation by 50%\r\n        LDR \x3d hsv2rgb(hsv);\r\n        vec3 finalColor \x3d LDR;\r\n        // when rendering we specify the blend functions such that\r\n        // newDestColor \x3d oldDestColor*(1.0-finalColor) + finalColor\r\n#else\r\n        //reinhard tonemapper for looking upwards\r\n        vec3 ldrReinhard \x3d reinhardTM(v3Color,fExposure);\r\n        LDR +\x3d angleMultiplier*ldrReinhard;\r\n\r\n        //height dependent parameter to smooth out reddish atmosphere\r\n        float side \x3d (rayEndT+rayStartT)*0.5;\r\n        float atmoHeight \x3d sqrt(fCameraHeight2 - side*side);\r\n        float h2 \x3d clamp(1.0-(atmoHeight-fLowerAlphaBlendBound)/(fOuterRadius-fLowerAlphaBlendBound),0.0,1.0);\r\n\r\n        vec3 finalColor \x3d LDR*h2;\r\n        vec3 hsv \x3d rgb2hsv(finalColor);\r\n        hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0);//boost sky saturation by 50%\r\n        finalColor \x3d hsv2rgb(hsv);\r\n#endif\r\n#ifdef PLANAR\r\n#ifndef HAZE\r\n        float alpha \x3d clamp(fCameraHeight-fInnerRadius,7000.0,30000.0);\r\n        alpha \x3d alpha / (30000.0-7000.0);\r\n        gl_FragColor \x3d vec4(finalColor, 1.0-alpha);\r\n#else\r\n        float alpha \x3d clamp(fCameraHeight-fInnerRadius,0.0,16500.0);\r\n        alpha \x3d alpha / (16500.0-0.0);\r\n        gl_FragColor \x3d vec4(finalColor, 1.0-alpha);\r\n#endif\r\n#else\r\n#ifndef HAZE\r\n        float alpha \x3d clamp(fCameraHeight-fInnerRadius,7000.0,30000.0);\r\n        alpha \x3d alpha / (30000.0-7000.0);\r\n        float atmosStrength \x3d clamp((length(ldrRed)-0.05)*1.05,0.0,1.0);\r\n        gl_FragColor \x3d vec4(finalColor, atmosStrength*clamp(1.0-(atmoHeight-fInnerRadius)/(fOuterRadius-fInnerRadius),0.0,1.0));\r\n#else\r\n        gl_FragColor \x3d vec4(finalColor, 1.0) * altitudeAlpha;\r\n#endif\r\n#endif\r\n\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c!--Fragment Shader for Atmosphere--\x3e\r\n\x3csnippet name\x3d"fsRealisticAtmosphere"\x3e\x3c![CDATA[\r\n\r\n  $fsprecisionf\r\n\r\n$atmosphereUniformsConstantsVaryings\r\n\r\n$atmosphereScaleFunction\r\n\r\n  //Conversion implementation found in util.xml\r\n$rgba2float\r\n\r\n\r\n$toneMapperConstants\r\n$exponentialToneMapper\r\n#ifndef HAZE\r\n$reinhardToneMapper\r\n#endif\r\n\r\n$HSVColorSpace\r\n\r\n  void main()\r\n  {\r\n\r\n    $atmospherePrecomputation\r\n\r\n    //Inside Atmosphere\r\n    if (det \x3e\x3d 0.0) {\r\n#ifdef HAZE\r\n      $atmosphereDiscardPixels\r\n\r\n      if (continueComputation) {\r\n#endif\r\n        $atmosphereUnpackAddUniforms\r\n\r\n        $atmosphereComputeRayAndLoopSetup\r\n\r\n        // Now loop through the sample rays\r\n        for(int i\x3d0; i\x3cmaxSamples; i++)\r\n        {\r\n          $atmosphereComputeSampleContribution\r\n        }\r\n\r\n        $atmosphereComputeHDRColors\r\n\r\n        $atmosphereComputePixelColor\r\n\r\n        //Debug variable overlay\r\n        if(showTest\x3e0.0){\r\n          gl_FragColor \x3d vec4(test,1.0);\r\n        }\r\n#ifdef HAZE\r\n      } else {//Not on surface\r\n        gl_FragColor \x3d vec4(0.0);\r\n      }\r\n#endif\r\n    } else {//Outside Atmosphere\r\n      gl_FragColor \x3d vec4(0.0);\r\n    }\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/offscreen.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsOffscreenRenderer"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n  varying vec2 vtc;\r\n\r\n  void main(void) {\r\n    gl_Position \x3d vec4($position.xy, 0.0, 1.0);\r\n    vtc \x3d $position.xy * 0.5 + 0.5;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsOffscreenRenderer"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n  varying vec2 vtc;\r\n\r\n  void main() {\r\n    vec4 texColor \x3d texture2D(tex, vtc);\r\n    gl_FragColor \x3d texColor;\r\n  }\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/environment/materials/StarMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderStar"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tuniform vec4 viewport;\r\n\r\n\tattribute vec3 $position;\r\n\tattribute vec4 $color;\r\n  attribute float $size;\r\n\r\n\tvarying vec4 vcolor;\r\n\tvarying float vsize;\r\n\r\n\t$alignToPixelCenter\r\n\r\n\tvoid main(void) {\r\n\t\tvec4 posProj \x3d proj * view * model*vec4($position*1.0e25,1.0);//move infinitely far away\r\n\t\tgl_Position \x3d alignToPixelCenter(posProj, viewport.zw); //pixel align position\r\n    gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\r\n\t\tvcolor \x3d $color/1.2;\r\n\t\tvsize \x3d size*5.0;\r\n\t\tgl_PointSize \x3d vsize;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderStar"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tvarying vec4 vcolor;\r\n\tvarying float vsize;\r\n\r\n\tvoid main() {\r\n\t\tfloat cap \x3d 0.7;\r\n\t\tfloat scale \x3d 1.0/cap;\r\n\t\tfloat helper \x3d clamp(length(abs(gl_PointCoord-vec2(0.5))),0.0,cap);\r\n\t\tfloat alpha \x3d clamp((cap-helper)*scale,0.0,1.0);\r\n\t\tfloat intensity \x3d alpha*alpha*alpha;\r\n\t\tif (vsize \x3c 3.0)\r\n\t\t\tintensity *\x3d 0.5;\r\n\t\tgl_FragColor \x3d vec4(1.0,1.0,1.0,intensity);\r\n\t\tgl_FragColor.xyz *\x3d vcolor.xyz;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/highlight.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3c!--\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\nSmartly downsamples a texture, halfing its resolution. This allows for a square\r\nscreen region to check if none, any or all pixels were set.\r\n\r\nThe red channel is always ceiled after interpolating the 4 merged pixels.\r\nThis allows to evaluate:\r\nany(pixels.red !\x3d 0.0) as red \x3d\x3d 1.0\r\nnone(pixels.red !\x3d 0.0) as red \x3d\x3d 0.0\r\n\r\nThe green and blue channels are set to floor(max(green, blue)).\r\nThis allows to evaluate:\r\nall(pixels.green || pixels.blue) as green \x3d\x3d 1.0\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n--\x3e\r\n\r\n\x3csnippet name\x3d"vsConservativeDownsample"\x3e\x3c![CDATA[\r\n\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n\r\n  void main()\r\n  {\r\n    gl_Position \x3d vec4(vec2(1.0) - $position * 2.0, .0, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsConservativeDownsample"\x3e\x3c![CDATA[\r\n\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n  uniform vec2 invFramebufferDim;\r\n\r\n  void main()\r\n  {\r\n    vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\r\n    vec4 value \x3d texture2D(tex, coord);\r\n    float mx \x3d floor(max(value.g, value.b));\r\n    gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c!--\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\nGaussian blur with linear sampling. Supports different number of samples, but\r\nonly 5 samples have proper weights. Uses linear texture interpolation to reduce\r\nthe number of samples taken.\r\n\r\nDefines:\r\nGRID_OPTIMIZATION (set or !set)\r\nGAUSSIAN_SAMPLES (3,5,7)\r\n\r\nThis technique requires linear filtering on source texture\r\nhttp://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n--\x3e\r\n\x3csnippet name\x3d"vsHighlightBlurFastGaussian"\x3e\x3c![CDATA[\r\n\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n  attribute vec2 $uv0;\r\n\r\n  #ifdef GRID_OPTIMIZATION\r\n    uniform sampler2D coverageTex;\r\n    varying vec3 blurCoordinate;\r\n  #else\r\n    uniform vec2 blurSize;\r\n    varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\r\n  #endif\r\n\r\n  void main()\r\n  {\r\n    gl_Position \x3d vec4($position, 0.0, 1.0);\r\n\r\n    #ifdef GRID_OPTIMIZATION\r\n      // sample the coverage texture at the block center\r\n      // and if no coverage detected, create degenerate triangle\r\n      vec4 cov \x3d texture2D(coverageTex, $uv0);\r\n      if (cov.r \x3d\x3d 0.0) {\r\n        gl_Position \x3d vec4(0,0,0,0);\r\n      }\r\n\r\n      // create texture coordinate for blur center\r\n      // encode information about fully inside block in z coordinate\r\n      blurCoordinate \x3d vec3(gl_Position.xy * .5 + vec2(.5), max(cov.g, cov.b));\r\n    #else\r\n      vec2 uv \x3d $position.xy * .5 + vec2(.5);\r\n\r\n      #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n        // not proper gaussian weights\r\n        blurCoordinates[0] \x3d uv;\r\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n        blurCoordinates[0] \x3d uv;\r\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n        blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n        blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n        // not proper gaussian weights\r\n        blurCoordinates[0] \x3d uv;\r\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n        blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n        blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n        blurCoordinates[5] \x3d uv + blurSize * 5.1;\r\n        blurCoordinates[6] \x3d uv - blurSize * 5.1;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n        // not proper gaussian weights\r\n        blurCoordinates[0] \x3d uv;\r\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n        blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n        blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n        blurCoordinates[5] \x3d uv + blurSize * 5.1;\r\n        blurCoordinates[6] \x3d uv - blurSize * 5.1;\r\n        blurCoordinates[7] \x3d uv + blurSize * 7.1;\r\n        blurCoordinates[8] \x3d uv - blurSize * 7.1;\r\n      #endif\r\n    #endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsHighlightBlurFastGaussian"\x3e\x3c![CDATA[\r\n\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n\r\n  #ifdef GRID_OPTIMIZATION\r\n    uniform vec2 blurSize;\r\n    varying vec3 blurCoordinate;\r\n  #else\r\n    varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\r\n  #endif\r\n\r\n  void main()\r\n  {\r\n    #ifdef GRID_OPTIMIZATION\r\n      vec2 uv \x3d blurCoordinate.xy;\r\n      vec4 center \x3d texture2D(tex, uv);\r\n\r\n      // do not blur if no pixel or all pixels in neighborhood are set\r\n      if (blurCoordinate.z \x3d\x3d 1.0) {\r\n        gl_FragColor \x3d center;\r\n      }\r\n      else {\r\n        vec4 sum \x3d vec4(0.0);\r\n\r\n        #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n          // not proper gaussian weights\r\n          sum +\x3d center * 0.204164;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n        #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n          sum +\x3d center * 0.204164;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\r\n        #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n          // not proper gaussian weights\r\n          sum +\x3d center * 0.204164;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 5.1) * 0.03;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 5.1) * 0.03;\r\n        #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n          // not proper gaussian weights\r\n          sum +\x3d center * 0.154164;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 1.5) * 0.204005;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 1.5) * 0.204005;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 3.5) * 0.123913;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 3.5) * 0.123913;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 5.5) * 0.123913;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 5.5) * 0.123913;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 7.5) * 0.05;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 7.5) * 0.05;\r\n        #endif\r\n\r\n        gl_FragColor \x3d sum;\r\n      }\r\n    #else\r\n      vec4 sum \x3d vec4(0.0);\r\n\r\n      #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n        // not proper gaussian weights\r\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n        // not proper gaussian weights\r\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.03;\r\n        sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.03;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n        // not proper gaussian weights\r\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.154164;\r\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.204005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.204005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.123913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.123913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.09;\r\n        sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.09;\r\n        sum +\x3d texture2D(tex, blurCoordinates[7]) * 0.05;\r\n        sum +\x3d texture2D(tex, blurCoordinates[8]) * 0.05;\r\n      #endif\r\n\r\n      gl_FragColor \x3d sum;\r\n    #endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c!--\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\nMerging blurred outlines with source image, advanced version\r\n\r\nDefines:\r\nGRID_OPTIMIZATION (set or !set)\r\nGRID_DEBUG (set or !set)\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n--\x3e\r\n\x3csnippet name\x3d"vsHighlightApply"\x3e\x3c![CDATA[\r\n\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n  varying vec2 uv;\r\n\r\n  #ifdef GRID_OPTIMIZATION\r\n    attribute vec2 $uv0;\r\n    uniform sampler2D coverageTex;\r\n  #endif\r\n\r\n  void main()\r\n  {\r\n    #ifdef GRID_OPTIMIZATION\r\n      #ifdef GRID_DEBUG\r\n        vec4 cov \x3d texture2D(coverageTex, $uv0);\r\n        // if no highlight pixel set in this block,\r\n        // or all pixels set, hide block\r\n        if (cov.r \x3d\x3d 0.0 || cov.g \x3d\x3d 1.0 || cov.b \x3d\x3d 1.0) {\r\n          gl_Position \x3d vec4(0,0,0,0);\r\n          return;\r\n        }\r\n        gl_Position \x3d vec4($position, .0, 1.0);\r\n        uv \x3d $uv0;\r\n        return;\r\n      #else\r\n        vec4 cov \x3d texture2D(coverageTex, $uv0);\r\n        // if no highlight pixel set in this block, hide block\r\n        if (cov.r \x3d\x3d 0.0) {\r\n          gl_Position \x3d vec4(0,0,0,0);\r\n          return;\r\n        }\r\n      #endif\r\n    #endif\r\n\r\n    gl_Position \x3d vec4($position, .0, 1.0);\r\n    uv \x3d $position.xy * .5 + vec2(.5);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsHighlightApply"\x3e\x3c![CDATA[\r\n\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n  uniform sampler2D origin;\r\n\r\n  uniform vec4 color;\r\n  uniform float outlineSize;\r\n  uniform float blurSize;\r\n  uniform vec4 opacities; // [outline, outlineOccluded, fill, fillOccluded]\r\n\r\n  varying vec2 uv;\r\n\r\n  void main()\r\n  {\r\n    #if defined(GRID_OPTIMIZATION) \x26\x26 defined(GRID_DEBUG)\r\n      gl_FragColor \x3d vec4(uv, 0, 1.0);\r\n    #else\r\n      // Read the highlight intensity from the blurred highlight image\r\n      vec4 blurredHighlightValue \x3d texture2D(tex, uv);\r\n      float highlightIntensity \x3d blurredHighlightValue.a;\r\n\r\n      // Discard all pixels which are not affected by highlight\r\n      if (highlightIntensity \x3d\x3d 0.0) {\r\n        discard;\r\n      }\r\n\r\n      vec4 origin_color \x3d texture2D(origin, uv);\r\n\r\n      float outlineIntensity;\r\n      float fillIntensity;\r\n\r\n      // if occluded\r\n      if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\r\n        outlineIntensity \x3d color.w * opacities[1];\r\n        fillIntensity \x3d color.w * opacities[3];\r\n      }\r\n      // if unoccluded\r\n      else {\r\n        outlineIntensity \x3d color.w * opacities[0];\r\n        fillIntensity \x3d color.w * opacities[2];\r\n      }\r\n\r\n      float inner \x3d 1.0 - outlineSize / 9.0;\r\n      float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\r\n\r\n      float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\r\n      //float fillFactor \x3d smoothstep(0.6, 0.72, highlightIntensity);\r\n      float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\r\n      float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\r\n\r\n      // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n      // I.e., color should not be premultiplied with alpha\r\n      gl_FragColor \x3d vec4(color.xyz, intensity);\r\n    #endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/occluded.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsRenderOccludedApply"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n  varying vec2 uv;\r\n\r\n  void main(void) {\r\n    gl_Position \x3d vec4($position, 0.0, 1.0);\r\n    uv \x3d $position.xy * 0.5 + vec2(0.5);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsRenderOccludedApply"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D occludedColorMap;\r\n\r\n  varying vec2 uv;\r\n\r\n  void main() {\r\n    vec4 occludedColor \x3d texture2D(occludedColorMap, uv);\r\n    gl_FragColor \x3d occludedColor * vec4(1.0, 1.0, 1.0, 0.4);\r\n  }\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/ssao.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\t\x3csnippet name\x3d"createFsSSAOSrc"\x3e\x3c![CDATA[\r\n\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D rnm;\r\n\tuniform sampler2D normalMap;\r\n\tuniform sampler2D depthMap;\r\n\tuniform float\t\tssaoAtt;\r\n\tuniform vec2\t\trnmScale;\r\n\tuniform float\t\tradius;\r\n\tuniform vec2\t\tnearFar;\r\n\tuniform vec3\t\tpSphere[64];\r\n\r\n\tvarying vec2\t\tuv;\r\n\r\n\tconst\tfloat\t\tstrength \x3d .07;\r\n\tconst\tfloat\t\tfalloff \x3d .000002;\r\n\r\n\t$rgba2float\r\n\tvoid main(void) {\r\n\t\tvec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\r\n\t\tfloat currentPixelDepth \x3d rgba2float(texture2D(depthMap, uv));\r\n\t\tvec3 ep \x3d vec3(uv.xy, currentPixelDepth);\r\n\t\tvec3 norm \x3d vec3(-1.0) + 2.0 * texture2D(normalMap, uv).xyz;\r\n\t\tfloat bl \x3d .0;\r\n\t\tfloat f \x3d mix(nearFar.x, nearFar.y, currentPixelDepth) / nearFar.x;\r\n\t\tfloat radD \x3d radius / f;\r\n\t\tradD \x3d min(radD, .5);\r\n\t\tfloat depthDifference;\r\n\t\tvec3 ray;\r\n\r\n\t\tfor(int i \x3d 0; i \x3c NUM_TAP_SAMPLES; ++i) {\r\n\t\t\tray \x3d radD*reflect(pSphere[i], fres);\r\n\t\t\tvec2 tc \x3d ep.xy + sign(dot(ray, norm) ) * ray.xy;\r\n\t\t\tif (tc.x \x3e\x3d .0 \x26\x26 tc.y \x3e\x3d .0 \x26\x26 tc.x \x3c\x3d 1.0 \x26\x26 tc.y \x3c\x3d 1.0) {\r\n\t\t\t\tfloat occluderDepth \x3d rgba2float(texture2D(depthMap, tc));\r\n\t\t\t\tvec3 occluderNormal \x3d vec3(-1.0) + 2.0 * texture2D(normalMap, tc).xyz;\r\n\t\t\t\tdepthDifference \x3d currentPixelDepth - occluderDepth;\r\n\t\t\t\tbl +\x3d step(falloff, depthDifference) * (1.0 - dot(occluderNormal, norm)) * (1.0 - smoothstep(falloff, strength, depthDifference));\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfloat ao \x3d 1.0 + bl * (-1.38 / float(NUM_TAP_SAMPLES)) * ssaoAtt;\r\n\t\tgl_FragColor.a \x3d ao;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\t\x3csnippet name\x3d"getDepthLinear"\x3e\x3c![CDATA[\r\n\tfloat getDepthLinear(vec2 ssC) {\r\n\t\treturn -(rgba2float(texture2D(depthMap, ssC))*(nearFar[1] - nearFar[0])+nearFar[0]);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"createFsSSAOSrcObscurance"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform mat4 projMatrixInv;\r\n\r\n\tuniform sampler2D normalMap;\r\n\tuniform sampler2D depthMap;\r\n\r\n\tuniform float     intensity;\r\n\r\n\tuniform float projScale;\r\n\tuniform float     radius;\r\n\tuniform vec2      nearFar;\r\n\r\n\tuniform vec4      projInfo;\r\n\r\n\tuniform vec2\t  screenDimensions;\r\n\r\n\t//noise texture lookup could be replaced with hash function if WebGL gets XOR functionality\r\n\tuniform vec3\t\tpSphere[NUM_TAP_SAMPLES]; //tap position\r\n\tuniform vec2\t\trnmScale;\r\n\tuniform sampler2D rnm; //noise texture\r\n\r\n\t//set z scaling, used to prevent division in ortho mode\r\n\tuniform vec2 zScale;\r\n\r\n\tvarying vec2  uv;\r\n\tvarying vec4  camPos;\r\n\r\n\t$rgba2float\r\n\t$getDepthLinear\r\n\r\n\t/** Returns a unit vector and a screen-space radius for the tap on a unit disk (the caller should scale by the actual disk radius) */\r\n\t/*uniform float numSpiralTurns;\r\n\tvec2 tapLocation(int sampleNumber, float spinAngle, out float ssR){\r\n\t\t// Radius relative to ssR\r\n\t\tfloat alpha \x3d (float(sampleNumber) + 0.5) * (1.0 / float(NUM_TAP_SAMPLES));\r\n\t\tfloat angle \x3d alpha * (numSpiralTurns * 6.28) + spinAngle;\r\n\r\n\t\tssR \x3d alpha;\r\n\t\treturn vec2(cos(angle), sin(angle));\r\n\t}*/\r\n\r\n\r\n\tfloat fallOffFunction(float vv, float vn, float bias) {\r\n\t  float radius2 \x3d radius * radius;\r\n\r\n\t\t// A: From the HPG12 paper\r\n\t\t// Note large epsilon to avoid overdarkening within cracks\r\n\t\t// return float(vv \x3c radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\r\n\r\n\t\t// B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\r\n\t\tfloat f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\r\n\r\n\t\t// C: Medium contrast (which looks better at high radii), no division.  Note that the\r\n\t\t// contribution still falls off with radius^2, but we\'ve adjusted the rate in a way that is\r\n\t\t// more computationally efficient and happens to be aesthetically pleasing.\r\n\t\t// return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\r\n\r\n\t\t// D: Low contrast, no division operation\r\n\t\t// return 2.0 * float(vv \x3c radius * radius) * max(vn - bias, 0.0);\r\n\t}\r\n\r\n\r\n\t/** Compute the occlusion due to sample point \\a Q about camera-space point \\a C with unit normal \\a n_C */\r\n\tfloat aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\r\n\t\tvec3 v \x3d Q - C;\r\n\t\tfloat vv \x3d dot(v, v);\r\n\t\tfloat vn \x3d dot(normalize(v), n_C);\r\n\t\treturn fallOffFunction(vv, vn, 0.1);\r\n\t}\r\n\r\n\r\n\t/** Reconstruct camera-space P.xyz from screen-space S \x3d (x, y) in\r\n\t\tpixels and camera-space z \x3c 0.  Assumes that the upper-left pixel center\r\n\t\tis at (0.5, 0.5) [but that need not be the location at which the sample tap\r\n\t\twas placed!]\r\n\r\n\t\tCosts 3 MADD.  Error is on the order of 10^3 at the far plane, partly due to z precision.\r\n\t  */\r\n\tvec3 reconstructCSPosition(vec2 S, float z) {\r\n\t\treturn vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\r\n\t}\r\n\r\n\tvoid main(void)\r\n\t{\r\n\r\n\t\t//Hash function used in the HPG12 AlchemyAO paper\r\n\t\t//Not supported in WebGL -\x3e using texture lookup as in old SSAO shader instead\r\n\t\t//ivec2 ssC \x3d ivec2(gl_FragCoord.xy);\r\n\t\t//float randomPatternRotationAngle \x3d float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\r\n\t\tvec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\r\n\r\n\t   float currentPixelDepth \x3d getDepthLinear(uv);\r\n\r\n\t   if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\r\n\t\tgl_FragColor \x3d vec4(0);\r\n\t\treturn;\r\n\t   }\r\n\r\n\t   vec3 currentPixelPos \x3d reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\r\n\r\n\t   // get the normal of current fragment\r\n\t   vec4 norm4 \x3d texture2D(normalMap, uv);\r\n\t   vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\r\n\t   bool isTerrain \x3d norm4.w\x3c0.5;\r\n\r\n\t   float sum \x3d .0;\r\n\r\n\t   vec4 occluderFragment;\r\n\t   vec3 ray;\r\n\r\n\t   vec3 tapPixelPos;\r\n\r\n\t   // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\r\n\t   // bug or deviation from CE somewhere else?\r\n\t   float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\r\n\r\n\t   for(int i \x3d 0; i \x3c NUM_TAP_SAMPLES; ++i)\r\n\t   {\r\n\t\t  // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\r\n\t\t  //float ssR;\r\n\t\t  //vec2 unitOffset \x3d tapLocation(i, randomPatternRotationAngle, ssR);\r\n\t\t  // get the depth of the occluder fragment\r\n\t\t  //vec2 offset \x3d vec2(-unitOffset*radius*ssR*ps);\r\n\r\n\t\t  vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\r\n\t\t  vec2 offset \x3d vec2(-unitOffset*radius*ps);\r\n\r\n\r\n\t\t  //don\'t use current or very nearby samples\r\n\t\t  if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\r\n\r\n\r\n\t\t  vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\r\n\t\t  if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\r\n\t\t  vec2 tcTap \x3d tc/screenDimensions;\r\n\t\t  float occluderFragmentDepth \x3d getDepthLinear(tcTap);\r\n\r\n\t\t  if (isTerrain) {\r\n\t\t  \tbool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\r\n\t\t  \tif (isTerrainTap)\r\n\t\t  \t\tcontinue;\r\n\t\t  }\r\n\r\n\t\t  tapPixelPos \x3d reconstructCSPosition(tc, occluderFragmentDepth);\r\n\r\n\t\t  sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\r\n\t   }\r\n\r\n\t   // output the result\r\n\r\n\t\tfloat A \x3d max(1.0-sum*intensity/float(NUM_TAP_SAMPLES),0.0);\r\n\r\n\t\t// Anti-tone map to reduce contrast and drag dark region farther\r\n\t\t// (x^0.2 + 1.2 * x^4)/2.2\r\n\t\tA \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\r\n\r\n\r\n\t   //gl_FragColor \x3d vec4(norm/2.0+0.5, 1.0);\r\n\t   //gl_FragColor \x3d vec4(-currentPixelDepth/1000.0);\r\n\t   //gl_FragColor \x3d vec4(tapPixelPos.x/100.0);\r\n\t   gl_FragColor \x3d vec4(A);\r\n\r\n\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsBlurEdgeAware"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D normalMap;\r\n\tuniform sampler2D depthMap;\r\n\tuniform sampler2D tex;\r\n\r\n\r\n\tuniform vec2 blurSize;\r\n\r\n\r\n\tuniform float g_BlurFalloff;\r\n\tuniform float projScale;\r\n\r\n\r\n\tvarying vec2 uv;\r\n\r\n\tuniform vec2\t\tnearFar;\r\n\r\n\t//set z scaling, used to prevent division in ortho mode\r\n\tuniform vec2 zScale;\r\n\r\n\t$rgba2float\r\n\t$getDepthLinear\r\n\r\n\tfloat BlurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness)\r\n\t{\r\n\t\tfloat c \x3d texture2D(tex, uv).r;\r\n\t\tfloat d \x3d getDepthLinear(uv);\r\n\r\n\t\tfloat ddiff \x3d d - center_d;\r\n\r\n\t\tfloat w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\r\n\r\n\t\tw_total +\x3d w;\r\n\r\n\t\treturn w*c;\r\n\t}\r\n\r\n\tvoid main(void)\r\n\t{\r\n\r\n\t\tfloat b \x3d 0.0;\r\n\t\tfloat w_total \x3d 0.0;\r\n\r\n\t\tfloat center_d \x3d  getDepthLinear(uv);\r\n\r\n\t\tfloat sharpness \x3d -0.05*projScale/(center_d*zScale.x+zScale.y);\r\n\t\tfor (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r)\r\n\t\t{\r\n\t\t\tfloat rf \x3d float(r);\r\n\t\t\tvec2 uvOffset \x3d uv + rf*blurSize;\r\n\t\t\tb +\x3d BlurFunction(uvOffset, rf, center_d, w_total, sharpness);\r\n\t\t}\r\n\r\n\t\tgl_FragColor \x3d vec4(b/w_total);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\t\x3csnippet name\x3d"fsBlurSrc0"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D tex;\r\n\tuniform float blurSize;\r\n\tvarying vec2 uv;\r\n\r\n\tvoid main() {\r\n\t\tint rad \x3d RADIUS - 1;\r\n\r\n\t\tvec4 sum \x3d vec4(0.0);\r\n\t\tfor (int k \x3d -RADIUS; k \x3c\x3d RADIUS; ++k) { \t\t// NOTE for-variable-init must be a const expression\r\n\t\t\tfloat fi \x3d float(k);\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\t\x3csnippet name\x3d"fsBlurSrc1"\x3e\x3c![CDATA[\r\n\t\t}\r\n\r\n\t\tgl_FragColor \x3d sum / float(RADIUS * RADIUS);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\t\x3csnippet name\x3d"fsBlurH"\x3e\x3c![CDATA[\r\n\t$fsBlurSrc0\r\n\t\t\tsum +\x3d texture2D(tex, vec2(uv.x + fi * blurSize, uv.y)) * (float(rad) - abs(fi) + 1.0);\r\n\t$fsBlurSrc1\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\t\x3csnippet name\x3d"fsBlurV"\x3e\x3c![CDATA[\r\n\t$fsBlurSrc0\r\n\t\t\tsum +\x3d texture2D(tex, vec2(uv.x, uv.y + fi * blurSize)) * (float(rad) - abs(fi) + 1.0);\r\n\t$fsBlurSrc1\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRendererUtils.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"EdgeRendererUtils_distanceBasedPerspectiveFactor"\x3e\x3c![CDATA[\r\n  uniform float uDistanceFalloffFactor;\r\n\r\n  float distanceBasedPerspectiveFactor(float distance) {\r\n    return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"EdgeRendererUtils_readComponentColor"\x3e\x3c![CDATA[\r\n  uniform sampler2D uComponentColorTex;\r\n  uniform vec2 uComponentColorTexInvDim;\r\n\r\n  attribute float componentIndex;\r\n\r\n  vec4 readComponentColor() {\r\n    float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\r\n    vec2 indexCoord \x3d vec2(\r\n      mod(normalizedIndex, 1.0),\r\n      (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\r\n    );\r\n    return texture2D(uComponentColorTex, indexCoord);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"EdgeRendererUtils_isSilhouetteEdge"\x3e\x3c![CDATA[\r\n  // #uniforms: uView, uModel\r\n  // #attributes: normalA, normalB\r\n  bool isSilhouetteEdge(vec4 viewPos) {\r\n    // transform the two face normals\r\n    vec3 viewNormalA \x3d (uView * uModel * vec4(normalA, 0.0)).xyz;\r\n    vec3 viewNormalB \x3d (uView * uModel * vec4(normalB, 0.0)).xyz;\r\n\r\n    // compute the direction from the edge to the camera\r\n    vec3 viewDir \x3d -viewPos.xyz;\r\n\r\n    // check which of the two faces are visible\r\n    // display the edge if exactly one of the two is visible\r\n    float faceAVisible \x3d dot(viewDir, viewNormalA); // positive if visible\r\n    float faceBVisible \x3d dot(viewDir, viewNormalB); // positive if visible\r\n\r\n    // 1 if exactly one face visible, 0 otherwise\r\n    return faceAVisible * faceBVisible \x3c 0.0;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"EdgeRendererUtils_adjustProjectedPosition"\x3e\x3c![CDATA[\r\n  uniform vec2 uDepthBias;\r\n  uniform vec2 uViewportDimInv;\r\n\r\n  // Utility function to check for NaN values\r\n  bool isNaN(float val) {\r\n    return ( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 ) ? false : true;\r\n    // important: some nVidias failed to cope with version below.\r\n    // Probably wrong optimization.\r\n    /*return ( val \x3c\x3d 0.0 || 0.0 \x3c\x3d val ) ? false : true;*/\r\n  }\r\n\r\n  // An offset in xy screen space, along the projected normal of the edge\r\n  // This reduces depth fighting when looking at a face from a flat angle\r\n  vec2 calculateProjectedBiasXY(vec4 projPos, vec3 worldNormal) {\r\n    float offsetXY \x3d uDepthBias.x;\r\n    float offsetZ  \x3d uDepthBias.y;\r\n\r\n    // screen space pixel offset\r\n    // we multiply by two to account for the fact that NDC go from -1 to 1\r\n    // we multiply by projPos.w to compensate for the perspective divison that happens later\r\n    // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\r\n    // towards the camera\r\n    vec4 projNormal \x3d uProj * uView * vec4(worldNormal, 0.0);\r\n\r\n    return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\r\n  }\r\n\r\n  // A z-offset, using a depth based heuristic.\r\n  float calculateProjectedBiasZ(vec4 projPos) {\r\n    float offsetZ \x3d uDepthBias.y;\r\n    return sqrt(projPos.z) * offsetZ;\r\n  }\r\n\r\n  vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\r\n    vec2 offsetXY \x3d calculateProjectedBiasXY(projPos, worldNormal);\r\n\r\n    // we currently have to do this check because some geometries come with 0 length edge normals.\r\n    // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\r\n    if (!isNaN(offsetXY.x) \x26\x26 !isNaN(offsetXY.y)) {\r\n      projPos.xy +\x3d offsetXY;\r\n    }\r\n\r\n    projPos.z +\x3d calculateProjectedBiasZ(projPos) * lineWidth;\r\n\r\n    return projPos;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"EdgeRendererUtils_worldNormal"\x3e\x3c![CDATA[\r\n  vec3 modelToWorldNormal(vec3 normal) {\r\n    return (uModel * vec4(normal, 0)).xyz;\r\n  }\r\n\r\n  vec3 silhouetteWorldNormal(vec3 normalA, vec3 normalB) {\r\n    return modelToWorldNormal(normalize(normalA + normalB));\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"EdgeRendererUtils_extensionFalloff"\x3e\x3c![CDATA[\r\n  // Fall-off extension length for shorter strokes, starting from strokes that are 256 size,\r\n  // fall-off exponentially\r\n  float calculateExtensionLength(float extensionLength, float lineLength) {\r\n    return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/lib/edgeRendering/RibbonEdgeRenderer.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsRibbonEdgeSketch"\x3e\x3c![CDATA[\r\n#if defined(SKETCH) || defined(UBER)\r\n\r\nuniform vec2 uStrokesTextureScale;\r\nuniform float uStrokesLog2Resolution;\r\nuniform float uStrokeVariants;\r\n\r\nvarying vec2 vStrokeUV;\r\nvarying float vLineIndex;\r\n\r\n  void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\r\n    vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\r\n\r\n    float lineIndex \x3d clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\r\n\r\n    vStrokeUV \x3d vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + variantStroke + 0.5) * uStrokesTextureScale;\r\n    vStrokeUV.x +\x3d variantOffset;\r\n\r\n    vLineIndex \x3d lineIndex;\r\n  }\r\n\r\n#endif /* SKETCH || UBER */\r\n\r\n#ifdef SKETCH\r\n\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n    calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\r\n  }\r\n\r\n#endif /* SKETCH */\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsRibbonEdgeEmissiveLighting"\x3e\x3c![CDATA[\r\n\r\n#if defined(EMISSIVE_LIGHTING) || defined(UBER)\r\n\r\n  void calculateStyleOutputsEmissive(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n  }\r\n#endif /* EMISSIVE_LIGHTING || UBER */\r\n\r\n#ifdef EMISSIVE_LIGHTING\r\n\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n    calculateStyleOutputsEmissive(viewPosV0, viewPosV1, worldPosV0, worldPosV1, projPos, worldNormal, unpackedAttributes);\r\n  }\r\n\r\n#endif /* EMISSIVE_LIGHTING */\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsRibbonEdgeUberLighting"\x3e\r\n\x3c![CDATA[\r\n\r\n#ifdef UBER\r\n\r\n  varying float vType;\r\n\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n    vType \x3d unpackedAttributes.type;\r\n\r\n    if (unpackedAttributes.type \x3d\x3d 0.0) {\r\n      calculateStyleOutputsEmissive(viewPosV0, viewPosV1, worldPosV0, worldPosV1, projPos, worldNormal, unpackedAttributes);\r\n    }\r\n    else {\r\n      calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\r\n    }\r\n  }\r\n\r\n#endif /* UBER */\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsRibbonEdgeLineAmplitudeRegular"\x3e\x3c![CDATA[\r\n\r\n#if defined(UBER) || !defined(SKETCH)\r\n\r\n  float calculateLineAmplitudeRegular() {\r\n    return 0.0;\r\n  }\r\n\r\n#endif /* UBER || !SKETCH */\r\n\r\n#if !defined(UBER) \x26\x26 !defined(SKETCH)\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    return calculateLineAmplitudeRegular();\r\n  }\r\n\r\n#endif /* !UBER \x26\x26 !SKETCH */\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsRibbonEdgeLineAmplitudeSketch"\x3e\x3c![CDATA[\r\n\r\n#if defined(UBER) || defined(SKETCH)\r\n\r\n  uniform float uStrokesAmplitude;\r\n\r\n  float calculateLineAmplitudeSketch() {\r\n    return uStrokesAmplitude;\r\n  }\r\n\r\n#endif /* UBER || SKETCH */\r\n\r\n#ifdef SKETCH\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    return calculateLineAmplitudeSketch();\r\n  }\r\n\r\n#endif /* SKETCH */\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsRibbonEdgeLineAmplitudeUber"\x3e\x3c![CDATA[\r\n\r\n#ifdef UBER\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    float type \x3d unpackedAttributes.type;\r\n\r\n    if (type \x3c\x3d 0.0) {\r\n      return calculateLineAmplitudeSketch();\r\n    }\r\n    else {\r\n      return calculateLineAmplitudeRegular();\r\n    }\r\n  }\r\n\r\n#endif /* UBER */\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsRibbonEdge"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  // Transformations\r\n  uniform mat4 uProj;\r\n  uniform mat4 uView;\r\n  uniform mat4 uModel;\r\n  uniform vec3 uCameraPosition;\r\n\r\n  // Line configuration\r\n\r\n#ifndef UBER\r\n\r\n  uniform int uLineWidth;\r\n  uniform int uExtensionLength;\r\n\r\n#endif\r\n\r\n  // Conversion constants\r\n  uniform vec2 uPixelToNDC;\r\n  uniform vec2 uNDCToPixel;\r\n\r\n  // Inputs\r\n  attribute vec3 position0;\r\n  attribute vec3 position1;\r\n  attribute float variantOffset;\r\n  attribute float variantStroke;\r\n  attribute float variantExtension;\r\n\r\n#ifdef SILHOUETTE\r\n\r\n  attribute vec3 normalA;\r\n  attribute vec3 normalB;\r\n\r\n#else /* SILHOUETTE */\r\n\r\n  attribute vec3 normal;\r\n\r\n#endif /* SILHOUETTE */\r\n\r\nattribute vec2 sidenessAtt;\r\nattribute vec2 packedAttributes;\r\n\r\nstruct UnpackedAttributes {\r\n  vec2 sideness;\r\n  vec2 sidenessNorm;\r\n  float lineWidthPixels;\r\n  float extensionLengthPixels;\r\n\r\n#ifdef UBER\r\n\r\n  float type;\r\n\r\n#endif\r\n};\r\n\r\n  // Output required to compute color\r\n  varying vec4 vColor;\r\n\r\n  // Output required to compute distance to line/caps\r\n  varying vec3 vPosition;\r\n  varying float vRadius;\r\n  varying float vLineLengthPixels;\r\n  varying float vSizeFalloffFactor;\r\n\r\n  $EdgeRendererUtils_adjustProjectedPosition\r\n\r\n  $vsRibbonEdgeEmissiveLighting\r\n  $vsRibbonEdgeSketch\r\n  $vsRibbonEdgeUberLighting\r\n\r\n  $vsRibbonEdgeLineAmplitudeRegular\r\n  $vsRibbonEdgeLineAmplitudeSketch\r\n  $vsRibbonEdgeLineAmplitudeUber\r\n\r\n  $EdgeRendererUtils_readComponentColor\r\n  $EdgeRendererUtils_distanceBasedPerspectiveFactor\r\n  $EdgeRendererUtils_worldNormal\r\n  $EdgeRendererUtils_extensionFalloff\r\n\r\n#ifdef SILHOUETTE\r\n\r\n  $EdgeRendererUtils_isSilhouetteEdge\r\n\r\n#endif /* SILHOUETTE */\r\n\r\n  vec4 calculateGeometricOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n    vec2 sideness \x3d unpackedAttributes.sideness;\r\n    vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\r\n\r\n    vec4 viewPos \x3d mix(viewPosV0, viewPosV1, sidenessNorm.y);\r\n    vec4 projPosV0 \x3d uProj * viewPosV0;\r\n    vec4 projPosV1 \x3d uProj * viewPosV1;\r\n    vec4 projPos \x3d uProj * viewPos;\r\n\r\n    vec3 screenSpaceLineNDC \x3d (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\r\n    vec2 screenSpaceLinePixels \x3d screenSpaceLineNDC.xy * uNDCToPixel;\r\n    float lineLengthPixels \x3d length(screenSpaceLinePixels);\r\n\r\n    float dzPerPixel \x3d screenSpaceLineNDC.z / lineLengthPixels;\r\n    vec2 screenSpaceDirection \x3d screenSpaceLinePixels / lineLengthPixels;\r\n    vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\r\n\r\n    float falloffFactor \x3d distanceBasedPerspectiveFactor(-viewPos.z);\r\n    float lineWidthPixels \x3d unpackedAttributes.lineWidthPixels * falloffFactor;\r\n\r\n    float extensionLengthPixels \x3d calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\r\n    float lineAmplitudePixels \x3d calculateLineAmplitude(unpackedAttributes);\r\n\r\n    vSizeFalloffFactor \x3d falloffFactor;\r\n\r\n    float lineWidthAndAmplitudePixels \x3d lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\r\n    float extendedLineLengthPixels \x3d lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\r\n\r\n#ifdef ANTIALIASING\r\n\r\n    const float aaPaddingPixels \x3d 1.0;\r\n\r\n    // Line size with padding\r\n    float halfAAPaddedLineWidthAndAmplitudePixels \x3d lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\r\n    float aaPaddedRoundedCapSizePixels \x3d lineWidthPixels * 0.5 + aaPaddingPixels;\r\n\r\n    // Line length with padding\r\n    float aaPaddedLineLengthPixels \x3d extendedLineLengthPixels + aaPaddingPixels + aaPaddingPixels;\r\n    float halfAAPaddedLineLengthPixels \x3d aaPaddedLineLengthPixels * 0.5;\r\n\r\n#else /* ANTIALIASING */\r\n\r\n    // Even if there is no AA, we still want to do proper \x3c1px rendering,\r\n    // so we effectively clamp the pixel sizes to minimum of 1px and compute\r\n    // coverage in the fragment shader\r\n    float halfAAPaddedLineWidthAndAmplitudePixels \x3d max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\r\n    float aaPaddedRoundedCapSizePixels \x3d max(lineWidthPixels, 1.0) * 0.5;\r\n\r\n    float halfAAPaddedLineLengthPixels \x3d max(extendedLineLengthPixels, 1.0) * 0.5;\r\n\r\n#endif /* ANTIALIASING */\r\n\r\n    // Half line width in NDC including padding for anti aliasing\r\n    vec2 halfAAPaddedLineWidthAndAmplitudeNDC \x3d halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\r\n    vec2 aaPaddedRoundedCapSizeNDC \x3d aaPaddedRoundedCapSizePixels * uPixelToNDC;\r\n    vec2 extensionLengthNDC \x3d extensionLengthPixels * uPixelToNDC;\r\n\r\n    // Compute screen space position of vertex, offsetting for line size and end caps\r\n    vec2 ndcOffset \x3d (\r\n        screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\r\n      + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\r\n    );\r\n\r\n    projPos.xy +\x3d ndcOffset * projPos.w;\r\n    projPos.z +\x3d (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\r\n\r\n    projPos \x3d adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\r\n\r\n    // Line length with end caps\r\n    float aaPaddedLineWithCapsLengthPixels \x3d extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\r\n\r\n    float pixelPositionAlongLine \x3d aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\r\n\r\n    // Position in pixels with origin at first vertex of line segment\r\n    vPosition \x3d vec3(\r\n      halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\r\n      pixelPositionAlongLine,\r\n      pixelPositionAlongLine / extendedLineLengthPixels\r\n    );\r\n\r\n    // The line width radius in pixels\r\n    vRadius \x3d lineWidthPixels * 0.5;\r\n    vLineLengthPixels \x3d extendedLineLengthPixels;\r\n\r\n#ifdef SILHOUETTE\r\n\r\n    gl_Position \x3d isSilhouetteEdge(viewPosV0) ? projPos : vec4(10, 10, 10, 1);\r\n\r\n#else /* SILHOUETTE */\r\n\r\n    gl_Position \x3d projPos;\r\n\r\n#endif /* SILHOUETTE */\r\n\r\n#ifdef UBER\r\n\r\n    if (unpackedAttributes.type \x3c\x3d 0.0 \x26\x26 lineLengthPixels \x3c\x3d 3.0) {\r\n      gl_Position \x3d vec4(10, 10, 10, 1);\r\n    }\r\n\r\n#elif defined(SKETCH)\r\n\r\n    if (lineLengthPixels \x3c\x3d 3.0) {\r\n      gl_Position \x3d vec4(10, 10, 10, 1);\r\n    }\r\n\r\n#endif\r\n\r\n    return projPos;\r\n  }\r\n\r\n  void calculateColorOutputs() {\r\n    vColor \x3d readComponentColor();\r\n  }\r\n\r\n#ifdef UBER\r\n\r\n#if __VERSION__ !\x3d 100\r\n#define SUPPORTS_BITWISE_OPERATIONS\r\n#endif\r\n\r\n#ifndef SUPPORTS_BITWISE_OPERATIONS\r\n\r\n  /**\r\n   * Returns whether the first bit in x is set (0 or 1) and shifts\r\n   * the input by one bit.\r\n   */\r\n  int isSetAndShift(inout int x) {\r\n    int isSet \x3d x - 2 * (x / 2);\r\n    x /\x3d 2;\r\n\r\n    return isSet;\r\n  }\r\n\r\n#endif /* SUPPORTS_BITWISE_OPERATIONS */\r\n\r\n  UnpackedAttributes unpackAttributes() {\r\n    int packedTypeAndLineWidth \x3d int(packedAttributes.x);\r\n    float extensionLengthPixels \x3d float(packedAttributes.y);\r\n\r\n#ifndef SUPPORTS_BITWISE_OPERATIONS\r\n\r\n    int type \x3d isSetAndShift(packedTypeAndLineWidth);\r\n    int lineWidthPixels \x3d packedTypeAndLineWidth;\r\n\r\n#else /* SUPPORTS_BITWISE_OPERATIONS */\r\n\r\n    int type \x3d (packedTypeAndLineWidth ) \x26 0x01;\r\n    int lineWidthPixels \x3d (packedTypeAndLineWidth \x3e\x3e 1) \x26 0xf;\r\n\r\n#endif /* SUPPORTS_BITWISE_OPERATIONS */\r\n\r\n    vec2 sidenessNorm \x3d sidenessAtt;\r\n    vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\r\n\r\n    float fType \x3d -float(type) + 0.5; // SOLID (\x3d0) needs to be \x3e 0.0, SKETCHY (\x3d1) needs to be \x3c\x3d 0;\r\n\r\n    if (fType \x3c\x3d 0.0) {\r\n      extensionLengthPixels *\x3d variantExtension * 2.0 - 1.0;\r\n    }\r\n\r\n    return UnpackedAttributes(sideness, sidenessNorm, float(lineWidthPixels), extensionLengthPixels, fType);\r\n  }\r\n\r\n#else /* UBER */\r\n\r\n  UnpackedAttributes unpackAttributes() {\r\n    vec2 sidenessNorm \x3d sidenessAtt;\r\n    vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\r\n    float extensionLengthPixels \x3d float(uExtensionLength);\r\n\r\n#ifdef SKETCH\r\n\r\n    extensionLengthPixels *\x3d variantExtension * 2.0 - 1.0;\r\n\r\n#endif /* SKETCH */\r\n\r\n    return UnpackedAttributes(sideness, sidenessNorm, float(uLineWidth), extensionLengthPixels);\r\n  }\r\n\r\n#endif /* UBER */\r\n\r\n  void main() {\r\n\r\n    UnpackedAttributes unpackedAttributes \x3d unpackAttributes();\r\n\r\n    vec4 worldPosV0 \x3d uModel * vec4(position0, 1.0);\r\n    vec4 worldPosV1 \x3d uModel * vec4(position1, 1.0);\r\n\r\n    vec4 viewPosV0 \x3d uView * worldPosV0;\r\n    vec4 viewPosV1 \x3d uView * worldPosV1;\r\n\r\n#ifdef SILHOUETTE\r\n\r\n    vec3 worldNormal \x3d silhouetteWorldNormal(normalA, normalB);\r\n\r\n#else /* SILHOUETTE */\r\n\r\n    vec3 worldNormal \x3d modelToWorldNormal(normal);\r\n\r\n#endif /* SILHOUETTE */\r\n\r\n    // General geometric computation for all types of edges\r\n    vec4 projPos \x3d calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal, unpackedAttributes);\r\n    calculateColorOutputs();\r\n\r\n    // Specific computation for different edge styles\r\n    calculateStyleOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, projPos, worldNormal, unpackedAttributes);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsRibbonEdgeEmissiveLighting"\x3e\x3c![CDATA[\r\n\r\n#if defined(EMISSIVE_LIGHTING) || defined(UBER)\r\n\r\n  vec3 evaluateEdgeLightingEmissive(vec2 distance) {\r\n    return vColor.rgb;\r\n  }\r\n\r\n#endif /* EMISSIVE_LIGHTING || UBER */\r\n\r\n#ifdef EMISSIVE_LIGHTING\r\n\r\n  vec3 evaluateEdgeLighting(vec2 distance) {\r\n    return evaluateEdgeLightingEmissive(distance);\r\n  }\r\n\r\n#endif /* EMISSIVE_LIGHTING */\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsRibbonEdgeSketchLighting"\x3e\x3c![CDATA[\r\n\r\n#if defined(SKETCH) || defined(UBER)\r\n\r\n  vec3 evaluateEdgeLightingSketch(vec2 distance) {\r\n    return vColor.rgb;\r\n  }\r\n\r\n#endif /* SKETCH || UBER */\r\n\r\n#ifdef SKETCH\r\n\r\n  vec3 evaluateEdgeLighting(vec2 distance) {\r\n    return evaluateEdgeLightingSketch(distance);\r\n  }\r\n\r\n#endif /* SKETCH */\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsRibbonEdgeUberLighting"\x3e\x3c![CDATA[\r\n\r\n#ifdef UBER\r\n\r\n  varying float vType;\r\n\r\n  vec3 evaluateEdgeLighting(vec2 distance) {\r\n    if (vType \x3e 0.0) { // EMISSIVE\r\n      return evaluateEdgeLightingEmissive(distance);\r\n    }\r\n    else { // SKETCH\r\n      return evaluateEdgeLightingSketch(distance);\r\n    }\r\n  }\r\n\r\n#endif\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsRibbonEdgeLineOffsetSketch"\x3e\x3c![CDATA[\r\n\r\n$rgba2float\r\n\r\n#if defined(UBER) || defined(SKETCH)\r\n\r\n  uniform sampler2D uStrokesTexture;\r\n  uniform float uStrokesNormalizationScale;\r\n\r\n  varying vec2 vStrokeUV;\r\n\r\n  float calculateLineOffsetSketch() {\r\n    float offsetNorm \x3d rgba2float(texture2D(uStrokesTexture, vStrokeUV));\r\n    return (offsetNorm - 0.5) * uStrokesNormalizationScale;\r\n  }\r\n\r\n  float calculateLinePressureSketch() {\r\n\r\n#ifdef PRESSURE\r\n\r\n    return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0, 0.5)));\r\n\r\n#else\r\n\r\n    return 1.0;\r\n\r\n#endif /* PRESSURE */\r\n\r\n  }\r\n\r\n#endif /* UBER || SKETCH */\r\n\r\n#ifdef SKETCH\r\n\r\n  float calculateLineOffset() {\r\n    return calculateLineOffsetSketch();\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    return calculateLinePressureSketch();\r\n  }\r\n\r\n#endif /* SKETCH */\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsRibbonEdgeLineOffsetRegular"\x3e\x3c![CDATA[\r\n\r\n#if defined(UBER) || !defined(SKETCH)\r\n\r\n  float calculateLineOffsetRegular() {\r\n    return 0.0;\r\n  }\r\n\r\n  float calculateLinePressureRegular() {\r\n    return 1.0;\r\n  }\r\n\r\n#endif /* UBER || !SKETCH */\r\n\r\n#if !defined(UBER) \x26\x26 !defined(SKETCH)\r\n\r\n  float calculateLineOffset() {\r\n    return calculateLineOffsetRegular();\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    return calculateLinePressureRegular();\r\n  }\r\n\r\n#endif /* !UBER || !SKETCH */\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsRibbonEdgeLineOffsetUber"\x3e\x3c![CDATA[\r\n\r\n#ifdef UBER\r\n\r\n  float calculateLineOffset() {\r\n    if (vType \x3c\x3d 0.0) {\r\n      return calculateLineOffsetSketch();\r\n    }\r\n    else {\r\n      return calculateLineOffsetRegular();\r\n    }\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n\r\n#ifdef PRESSURE\r\n\r\n    if (vType \x3c\x3d 0.0) {\r\n      return calculateLinePressureSketch();\r\n    }\r\n    else {\r\n      return calculateLinePressureRegular();\r\n    }\r\n\r\n#else\r\n\r\n    return calculateLinePressureRegular();\r\n\r\n#endif /* PRESSURE */\r\n\r\n  }\r\n\r\n#endif /* UBER */\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsRibbonEdge"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  varying vec4 vColor;\r\n  varying float vRadius;\r\n  varying vec3 vPosition;\r\n  varying float vLineLengthPixels;\r\n  varying float vSizeFalloffFactor;\r\n  varying float vLineIndex;\r\n\r\n  // At which coverage threshold we discard a fragment completely\r\n  #define COVERAGE_TEST_THRESHOLD 0.01\r\n\r\n  $fsRibbonEdgeEmissiveLighting\r\n  $fsRibbonEdgeSketchLighting\r\n  $fsRibbonEdgeUberLighting\r\n\r\n  $fsRibbonEdgeLineOffsetRegular\r\n  $fsRibbonEdgeLineOffsetSketch\r\n  $fsRibbonEdgeLineOffsetUber\r\n\r\n  vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\r\n    float lineOffset \x3d calculateLineOffset();\r\n    float positionX \x3d position.x - lineOffset;\r\n\r\n    if (radius \x3c 1.0) {\r\n      // Handle this specifically for subpixel sizes:\r\n      // 1. Compute correct coverage (note coverage is computed by\r\n      //    0.5 - dist, so we make sure that that will lead to correct\r\n      //    subpixel coverage\r\n      // 2. Ignore rounded caps\r\n      float coverageX \x3d clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\r\n      float coverageY \x3d clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\r\n\r\n      float coverage \x3d min(coverageX, coverageY);\r\n\r\n      return vec2(0.5 - coverage, 0.0);\r\n    }\r\n    else {\r\n      // Between -radius -\x3e 0 for start cap, 0 for line, 0 -\x3e radius\r\n      float positionOnCap \x3d position.y - clamp(position.y, 0.0, lineLength);\r\n\r\n      vec2 lineToPosition \x3d vec2(positionX, positionOnCap);\r\n      return vec2(length(lineToPosition) - radius, positionOnCap / radius);\r\n    }\r\n  }\r\n\r\n  void main() {\r\n\r\n    float radius \x3d vRadius * calculateLinePressure();\r\n\r\n    vec2 distance \x3d lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\r\n    float coverage \x3d clamp(0.5 - distance.x, 0.0, 1.0);\r\n\r\n#ifdef ANTIALIASING\r\n\r\n    const float coverageLimit \x3d COVERAGE_TEST_THRESHOLD;\r\n\r\n#else /* ANTIALIASING */\r\n\r\n    // Use subpixel coverage computation when lines get subpixel widths\r\n    // so we still render them appropriately. Otherwise discard anything\r\n    // that is not fully within the line\r\n    float coverageLimit \x3d radius \x3c\x3d 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75;\r\n\r\n#endif /* ANTIALIASING */\r\n\r\n    if (coverage \x3c coverageLimit) {\r\n      discard;\r\n    }\r\n\r\n    vec3 shadedColor \x3d evaluateEdgeLighting(distance);\r\n    float alpha \x3d vColor.a * coverage;\r\n\r\n    gl_FragColor \x3d vec4(shadedColor, alpha);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/HUDMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderHUD"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  $commonAttributesAndUniformsHUD\r\n\r\n  uniform float pixelRatio;\r\n  uniform vec2 screenOffset;\r\n  uniform vec2 anchorPos;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  uniform vec4 screenSizePerspective;\r\n\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n  varying vec3 debugBorderCoords;\r\n#endif\r\n\r\n  attribute vec2 $uv0;\r\n  attribute vec4 $color;\r\n  attribute vec2 $size;\r\n  attribute vec4 $auxpos2;\r\n\r\n  varying vec4 vcolor;\r\n\r\n  varying vec2 vtc;\r\n  varying vec2 vsize;\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n  varying float voccluded;\r\n#endif\r\n\r\n  $vvUniforms\r\n\r\n  $alignToPixelCenter\r\n  $alignToPixelOrigin\r\n  $projectPositionHUD\r\n  $vvFunctions\r\n\r\n  void main(void) {\r\n    ProjectHUDAux projectAux;\r\n    vec4 posProj \x3d projectPositionHUD(projectAux);\r\n\r\n    vec2 inputSize;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n    inputSize \x3d screenSizePerspectiveScaleVec2($size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\r\n\r\n    vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\r\n\r\n#else\r\n\r\n    inputSize \x3d $size;\r\n\r\n    vec2 screenOffsetScaled \x3d screenOffset;\r\n#endif\r\n\r\n#ifdef VV_SIZE\r\n    // only use width (.xx) for proportional scaling\r\n    // (if no width was defined in vv, width\r\n    //  will be a copy of height vv)\r\n    inputSize *\x3d vvGetScale($auxpos2).xx;\r\n#endif\r\n\r\n    vec2 combinedSize \x3d inputSize * pixelRatio;\r\n    vec4 quadOffset \x3d vec4(0);\r\n\r\n#if defined(OCCL_TEST) || defined(BINARY_HIGHLIGHT_OCCLUSION)\r\n    bool visible \x3d testVisibilityHUD(posProj);\r\n#endif\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n  voccluded \x3d visible ? 0.0 : 1.0;\r\n#endif\r\n\r\n#ifdef OCCL_TEST\r\n    if (visible) {\r\n#endif\r\n      // UV goes from 0 to 1.99999, where the integer part is used\r\n      // for the normalized vertex coordinates, and the fractional\r\n      // part is used for texture sampling\r\n      vec2 uv01 \x3d floor($uv0);\r\n      vec2 uv \x3d $uv0 - uv01;\r\n\r\n      // Displace icon based on anchor position (normalized for size) and\r\n      // absolute screen offset. anchorPos is [-0.5, 0.5]\r\n      quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\r\n\r\n#ifdef SIGNED_DISTANCE_FIELD\r\n\r\n      // SDF primitives might be scaled so that the SDF texture resolution does\r\n      // not match the resolution of the canvas, but we still want to render\r\n      // outline-only (\'cross\' and \'x\') primitives cleanly. Aligning to a screen\r\n      // pixel border at the geometry center achieves this, since SDF textures\r\n      // always have power of 2 dimensions.\r\n      posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;\r\n#else\r\n      posProj +\x3d quadOffset;\r\n\r\n      // Aligning vertex positions to the nearest (using \'floor\') screen pixel\r\n      // border renders textures with pixel-perfect results. If the texture\r\n      // resolution does not match the canvas resolution then aligning is\r\n      // redundant.\r\n      if (inputSize.x \x3d\x3d $size.x) {\r\n        posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\r\n      }\r\n#endif\r\n\r\n      gl_Position \x3d posProj;\r\n\r\n      vtc \x3d uv;\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n      debugBorderCoords \x3d vec3(uv01, 1.0 / combinedSize);\r\n#endif\r\n\r\n      vsize \x3d inputSize;\r\n#ifdef OCCL_TEST\r\n    } else {\r\n      vtc \x3d vec2(.0);\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n      debugBorderCoords \x3d vec3(0);\r\n#endif\r\n\r\n    }\r\n#endif\r\n\r\n    gl_Position \x3d posProj;\r\n\r\n#ifdef VV_COLOR\r\n    vcolor \x3d vvGetColor($auxpos2, vvColorValues, vvColorColors);\r\n#else\r\n    vcolor \x3d $color / 255.0;\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderHUDBaseVariables"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  #extension GL_OES_standard_derivatives : require\r\n\r\n  uniform sampler2D tex;\r\n  uniform vec4 overrideColor;\r\n  uniform vec4 outlineColor;\r\n  uniform float outlineSize;\r\n\r\n  varying vec4 vcolor;\r\n\r\n  varying vec2 vtc;\r\n  varying vec2 vsize;\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n  varying float voccluded;\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n  varying vec3 debugBorderCoords;\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderHUDBaseMain"\x3e\x3c![CDATA[\r\n  vec4 premultiply(vec4 v) {\r\n    return vec4(v.rgb * v.a, v.a);\r\n  }\r\n\r\n  void main() {\r\n\r\n#ifdef SIGNED_DISTANCE_FIELD\r\n    vec4 color \x3d vec4(0.0, 0.0, 0.0, 0.0);\r\n    vec4 fillPixelColor \x3d overrideColor * vcolor;\r\n\r\n    // Attempt to sample texel centers to avoid thin cross outline\r\n    // disappearing with large symbol sizes.\r\n    // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\r\n    const float txSize \x3d 128.0;\r\n    vec2 scaleFactor \x3d ((vsize - txSize) / txSize);\r\n    vec2 samplePos \x3d vtc + vec2(1.0, -1.0) * (1.0 / txSize) * scaleFactor;\r\n\r\n    // Distance in [-0.5, 0.5]\r\n    float d \x3d dot(texture2D(tex, samplePos), vec4(1.0/16777216.0, 1.0/65535.0, 1.0/256.0, 1.0)) - 0.5;\r\n\r\n    // Work around loss of precision for \'d \x3d 0.0\'.\r\n    // \'0\' gets normalised to 0.5 * 256 \x3d 128 before float packing, but can only\r\n    // be stored in the texture as 128 / 255 \x3d 0.502.\r\n    // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603110\r\n    const float diff \x3d (128.0/255.0 - 0.5);\r\n\r\n    // adjust all values, not just those close to 0, to avoid discontinuities in\r\n    // the outlines of other shapes e.g. circles\r\n    d \x3d d - diff;\r\n\r\n    // Distance in output units\r\n    float dist \x3d d * vsize.x;\r\n\r\n    fillPixelColor.a *\x3d clamp(0.5 - dist, 0.0, 1.0);\r\n\r\n    if (outlineSize \x3e 0.25) {\r\n      vec4 outlinePixelColor \x3d outlineColor;\r\n      float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\r\n      outlinePixelColor.a *\x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\r\n\r\n      // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\r\n      float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\r\n      vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\r\n        vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\r\n\r\n      gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\r\n    }\r\n    else {\r\n      gl_FragColor \x3d premultiply(fillPixelColor);\r\n    }\r\n\r\n    // visualize SDF:\r\n    // gl_FragColor \x3d vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\r\n#else\r\n\r\n    // HUDMaterial is rendered with a blending mode that assumes a pre-multiplied\r\n    // fragment color. Input textures should already be pre-multiplied and so\r\n    // don\'t require adjustment, but the override and vertex colors must be\r\n    // modulated by their alpha values.\r\n\r\n    gl_FragColor \x3d texture2D(tex, vtc, -0.5) * premultiply(overrideColor * vcolor);\r\n\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n     float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, vec2(debugBorderCoords.z))) || any(greaterThan(debugBorderCoords.xy, vec2(1.0 - debugBorderCoords.z))));\r\n     gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 1, 1), isBorder);\r\n#endif\r\n\r\n    if (gl_FragColor.a \x3c 0.1) {\r\n      discard;\r\n    }\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderHUD"\x3e\x3c![CDATA[\r\n$fragmentShaderHUDBaseVariables\r\n$fragmentShaderHUDBaseMain\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderHUDHighlight"\x3e\x3c![CDATA[\r\n$fragmentShaderHUDBaseVariables\r\n\r\n  uniform sampler2D depthTex;\r\n  uniform vec4 highlightViewportPixelSz;\r\n\r\n$fragmentShaderHUDBaseMain\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n    // Instead of deciding on a per-pixel basis if the highlight is occluded,\r\n    // do it for all highlight pixel based on the centroid occlusion. This\r\n    // is a temporary solution for:\r\n    // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/9645\r\n    if (voccluded \x3d\x3d 1.0) {\r\n      gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\r\n    } else {\r\n      gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\r\n    }\r\n#else\r\n    $highlightWrite\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"vertexShaderOcclusionTestPixel"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  $commonAttributesAndUniformsHUD\r\n\r\n  $alignToPixelCenter\r\n  $projectPositionHUD\r\n\r\n  void main(void) {\r\n    vec4 posProjCenter;\r\n\r\n    // Check for special value of position (0, 0, 0) which is used by the Renderer when graphics\r\n    // are removed before the VBO is recompacted. If this is the case, then we just project outside\r\n    // of clip space.\r\n    if (dot($position, $position) \x3e 0.0) {\r\n      // Render single point to center of the pixel to avoid subpixel filtering to affect\r\n      // the marker color\r\n      ProjectHUDAux projectAux;\r\n      vec4 posProj \x3d projectPositionHUD(projectAux);\r\n\r\n      posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\r\n    }\r\n    else {\r\n      // Project out of clip space\r\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n    }\r\n\r\n    gl_Position \x3d posProjCenter;\r\n    gl_PointSize \x3d 1.0;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderTexOnly"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tattribute vec3 $position;\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\r\n\tvoid main(void) {\r\n\t\tgl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\r\n\t\tvtc \x3d $uv0;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderTexOnly"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D tex;\r\n\tuniform vec4 color;\r\n\tvarying vec2 vtc;\r\n\r\n\tvoid main() {\r\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\r\n\t\tgl_FragColor \x3d texColor * color;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/hud.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"commonAttributesAndUniformsHUD"\x3e\x3c![CDATA[\r\n  attribute vec3 $position;\r\n  attribute vec3 $normal;\r\n  attribute vec4 $auxpos1;\r\n\r\n  uniform mat4 proj;\r\n\r\n  uniform mat4 view;\r\n  uniform mat4 viewNormal;\r\n\r\n  uniform mat4 model;\r\n  uniform mat4 modelNormal;\r\n\r\n  uniform vec4 viewport;\r\n\r\n  uniform vec3 camPos;\r\n\r\n  uniform float polygonOffset;\r\n  uniform float cameraGroundRelative;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\r\n  // [ screenLength, distanceFactor, minWorldLength, maxWorldLength ]\r\n  uniform vec4 verticalOffset;\r\n\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  // [ divisor, offset, minPixelSize, paddingPixels ]\r\n  uniform vec4 screenSizePerspectiveAlignment;\r\n\r\n#endif\r\n\r\n  uniform sampler2D hudVisibilityTexture;\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"projectPositionHUD"\x3e\x3c![CDATA[\r\n  $screenSizePerspective\r\n\r\n  // Corresponds to cos(10 deg), used to compare against dot product of two vectors\r\n  const float SMALL_OFFSET_ANGLE \x3d 0.984807753012208;\r\n\r\n  struct ProjectHUDAux {\r\n    vec3 posModel;\r\n    vec3 posView;\r\n    vec3 vnormal;\r\n\r\n    float distanceToCamera;\r\n    float absCosAngle;\r\n  };\r\n\r\n\r\n  /**\r\n   * Apply the simulated polygon offset for HUD objects that improves\r\n   * issues with Z-fighting.\r\n   *\r\n   * @param posView {vec3} (inout) the position in view space. Will be modified in place.\r\n   * @param pointGroundDistance {float} the distance from the point geometry to the ground surface.\r\n   * @param absCosAngle {float} the absolute cosine of the angle between the world-up at the point geometry\r\n   *   and the view direction.\r\n   *\r\n   * Dependencies:\r\n   *\r\n   *   Attributes:\r\n   *     - auxpos1: contains centerOffset and pointGroundDistance\r\n   *\r\n   *   Uniforms:\r\n   *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n   *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\r\n   *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\r\n   *         reduced flickering.\r\n   *     - viewport: the viewport [x, y, width, height]\r\n   */\r\n  float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\r\n    float pointGroundSign \x3d sign(pointGroundDistance);\r\n\r\n    if (pointGroundSign \x3d\x3d 0.0) {\r\n      pointGroundSign \x3d 1.0;\r\n    }\r\n\r\n    // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\r\n    // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\r\n    float groundRelative \x3d cameraGroundRelative * pointGroundSign;\r\n\r\n    // view angle dependent part of polygon offset emulation\r\n    // we take the absolute value because the sign that is dropped is\r\n    // instead introduced using the ground-relative position of the symbol and the camera\r\n    if (polygonOffset \x3e .0) {\r\n      float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\r\n\r\n      float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\r\n      float factor \x3d (1.0 - tanAlpha / viewport[2]);\r\n\r\n      // same side of the terrain\r\n      if (groundRelative \x3e 0.0) {\r\n        posView *\x3d factor;\r\n      }\r\n      // opposite sides of the terrain\r\n      else {\r\n        posView /\x3d factor;\r\n      }\r\n    }\r\n\r\n    return groundRelative;\r\n  }\r\n\r\n  /**\r\n   * Project the 3d position of a HUD object from world space to clip space. In addition\r\n   * to standard model view projection, it also emulates a polygon offset to\r\n   * help with points above/below ground and icon flickering. The resulting location\r\n   * is the anchor of the HUD object, i.e. the position that is used also for testing\r\n   * visibility of the HUD object. Note that the returned projected position is not\r\n   * aligned to a pixel center or border, it is up to the caller to align if necessary.\r\n   *\r\n   * Dependencies:\r\n   *\r\n   *   Attributes:\r\n   *     - position: contains the point world position\r\n   *     - normal: contains the world normal pointing up at the point\r\n   *     - auxpos1: contains centerOffset and pointGroundDistance\r\n   *\r\n   *   Uniforms:\r\n   *     - model: the object -\x3e world transformation matrix\r\n   *     - modelNormal: the object -\x3e world normal transformation matrix (inv transp of model)\r\n   *     - view: the world -\x3e view transformation matrix\r\n   *     - viewNormal: the world -\x3e view normal transformation matrix (inv transp of view)\r\n   *     - proj: the view -\x3e clip projection matrix\r\n   *     - verticalOffset: a vec4 containing:\r\n   *         - the screen height of the vertical offset\r\n   *         - the screen height of the vertical offset as a fraction of camera distance.\r\n   *         - the minimum world size vertical offset.\r\n   *         - the maximum world size vertical offset.\r\n   *       This will do a screen sized offset of the point along its normal (used for line callouts)\r\n   *     - screenSizePerspectiveAlignment: a vec3 containing\r\n   *         - the view distance dependent divisor\r\n   *         - the view distance dependent offset\r\n   *         - the minimum pixel size\r\n   *         - the amount of padding in pixels around the region to be scaled (not used for alignment)\r\n   *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n   *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\r\n   *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\r\n   *         reduced flickering.\r\n   *     - camPos: the position of the camera in world space\r\n   *     - viewport: the viewport [x, y, width, height]\r\n   */\r\n  vec4 projectPositionHUD(out ProjectHUDAux aux) {\r\n    // centerOffset is in view space and is used to implement world size offsetting\r\n    // of labels with respect to objects. It also pulls the label towards the viewer\r\n    // so that the label is visible in front of the object.\r\n    vec3 centerOffset \x3d $auxpos1.xyz;\r\n\r\n    // The pointGroundDistance is the distance of the geometry to the ground and is\r\n    // negative if the point is below the ground, or positive if the point is above\r\n    // ground.\r\n    float pointGroundDistance \x3d $auxpos1.w;\r\n\r\n    aux.posModel \x3d (model * vec4($position, 1.0)).xyz;\r\n    aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\r\n    aux.vnormal \x3d (modelNormal * vec4($normal, 1.0)).xyz;\r\n\r\n    // Screen sized offset in world space, used for example for line callouts\r\n    // Note: keep this implementation in sync with the CPU implementation, see\r\n    //   - MaterialUtil.verticalOffsetAtDistance\r\n    //   - HUDMaterial.applyVerticalOffsetTransformation\r\n\r\n    aux.distanceToCamera \x3d length(aux.posView);\r\n\r\n    vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\r\n    float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\r\n\r\n    aux.absCosAngle \x3d abs(cosAngle);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n#if defined(VERTICAL_OFFSET) || defined(CENTER_OFFSET_UNITS_SCREEN)\r\n    vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);\r\n#endif\r\n\r\n#endif\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n    float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);\r\n#else\r\n    float verticalOffsetScreenHeight \x3d verticalOffset.x;\r\n#endif\r\n\r\n    float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\r\n    vec3 modelOffset \x3d aux.vnormal * worldOffset;\r\n\r\n    aux.posModel +\x3d modelOffset;\r\n\r\n    vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\r\n    aux.posView +\x3d viewOffset;\r\n\r\n    // Since we elevate the object, we need to take that into account\r\n    // in the distance to ground\r\n    pointGroundDistance +\x3d worldOffset;\r\n\r\n#endif\r\n\r\n    float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\r\n\r\n#ifndef CENTER_OFFSET_UNITS_SCREEN\r\n    // Apply x/y in view space, but z in screen space (i.e. along posView direction)\r\n    aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0);\r\n\r\n    // Same material all have same z !\x3d 0.0 condition so should not lead to\r\n    // branch fragmentation and will save a normalization if it\'s not needed\r\n    if (centerOffset.z !\x3d 0.0) {\r\n      aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\r\n    }\r\n#endif\r\n\r\n    vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\r\n\r\n#ifdef CENTER_OFFSET_UNITS_SCREEN\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n    float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);\r\n#else\r\n    float centerOffsetY \x3d centerOffset.y;\r\n#endif\r\n\r\n    posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * 2.0 / viewport.zw * posProj.w;\r\n\r\n#endif\r\n\r\n    // constant part of polygon offset emulation\r\n    posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\r\n\r\n    return posProj;\r\n  }\r\n\r\n  /**\r\n   * Test for visibility of a HUD object.\r\n   *\r\n   * Dependencies:\r\n   *\r\n   *   Uniforms:\r\n   *     - hudVisibilityTexture: the texture that contains the visibility information\r\n   *     - markerColor: the special marker color that is used to write visibility information\r\n   *     - viewport: the viewport\r\n   */\r\n  bool testVisibilityHUD(vec4 posProj) {\r\n    // For occlusion testing, use the nearest pixel center to avoid\r\n    // subpixel filtering messing up the color we use to test for\r\n    vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\r\n\r\n    return texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w).r \x3e 0.0;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/util.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"alignToPixelCenter"\x3e\x3c![CDATA[\r\n  vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\r\n    // From clip space to (0 : 1), bias towards right pixel edge\r\n    vec2 xy \x3d vec2(.500123) + .5 * clipCoord.xy / clipCoord.w;\r\n\r\n    // Size of a pixel in range (0 : 1)\r\n    vec2 pixelSz \x3d vec2(1.0) / widthHeight;\r\n\r\n    // Round to nearest pixel center\r\n    vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\r\n\r\n    // Convert back to clip space\r\n    vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\r\n\r\n    return vec4(result, clipCoord.zw);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"alignToPixelOrigin"\x3e\x3c![CDATA[\r\n  vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\r\n    // From clip space to (0 : 1),\r\n    vec2 xy \x3d vec2(.5) + .5 * clipCoord.xy / clipCoord.w;\r\n\r\n    // Size of a pixel in range (0 : 1)\r\n    vec2 pixelSz \x3d vec2(1.0) / widthHeight;\r\n\r\n    // Round to nearest pixel border, (0 : 1)\r\n    vec2 ij \x3d floor((xy + .5 * pixelSz) * widthHeight) * pixelSz;\r\n\r\n    // Convert back to clip space\r\n    vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\r\n\r\n    return vec4(result, clipCoord.zw);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"float2rgba"\x3e\x3c![CDATA[\r\n  // This is the maximum float value representable as 32bit fixed point,\r\n  // it is rgba2float(vec4(1)) inlined.\r\n  const float MAX_RGBA_FLOAT \x3d\r\n    255.0 / 256.0 +\r\n    255.0 / 256.0 / 256.0 +\r\n    255.0 / 256.0 / 256.0 / 256.0 +\r\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\r\n\r\n  vec4 float2rgba(const float value) {\r\n    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\r\n    const vec4 fixedPointFactors \x3d vec4(1, 256, 256 * 256, 256 * 256 * 256);\r\n\r\n    // Make sure value is in the domain we can represent\r\n    float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\r\n\r\n    // Decompose value in 32bit fixed point parts represented as\r\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\r\n    // by a power of 256 (this removes the bits that are represented in the previous\r\n    // component) and then converts the fractional part to 8bits.\r\n    vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * fixedPointFactors) * 256.0);\r\n\r\n    // Convert uint8 values (from 0 to 255) to floating point representation for\r\n    // the shader\r\n    const float toU8AsFloat \x3d 1.0 / 255.0;\r\n\r\n    return fixedPointU8 * toU8AsFloat;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"rgba2float"\x3e\x3c![CDATA[\r\n  float rgba2float(vec4 rgba) {\r\n    // Convert components from 0-\x3e1 back to 0-\x3e255 and then\r\n    // add the components together with their corresponding\r\n    // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\r\n    const vec4 factors \x3d vec4(\r\n      255.0 / (256.0),\r\n      255.0 / (256.0 * 256.0),\r\n      255.0 / (256.0 * 256.0 * 256.0),\r\n      255.0 / (256.0 * 256.0 * 256.0 * 256.0)\r\n    );\r\n\r\n\t\treturn dot(rgba, factors);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"calcFragDepth"\x3e\x3c![CDATA[\r\n\t#ifdef GL_OES_standard_derivatives\r\n\t\t#extension GL_OES_standard_derivatives : enable\r\n\t#endif\r\n\r\n\tfloat calcFragDepth(const in float depth) {\r\n\t\t//calc polygon offset\r\n\t\tconst float SLOPE_SCALE \x3d 2.0;\r\n\t\tconst float BIAS \x3d 2.0 * .000015259;\t\t// 1 / (2^16 - 1)\r\n\t\tfloat m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\r\n\t\tfloat result \x3d depth + SLOPE_SCALE * m + BIAS;\r\n\t\treturn clamp(result, .0, .999999);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"evalShadow"\x3e\x3c![CDATA[\r\n\t$rgba2float\r\n\r\n\t// "matrix" parameter used to have const qualifier as well, but IE11 couldn\'t deal with it at time of writing.\r\n\t// once IE11 is fine with it, const should probably be re-introduced\r\n\tfloat evalShadow(const in vec3 vpos, const in float depth, const in sampler2D depthTex, const int num, const in vec4 distance, in mat4 matrix[4], const in float halfPxSz) {\r\n\t\t//choose correct cascade\r\n\t\tint i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\r\n\r\n\t\tif (i \x3e\x3d num) return .0;\r\n\r\n\t\tmat4 mat \x3d i \x3d\x3d 0 ? matrix[0] : i \x3d\x3d 1 ? matrix[1] : i \x3d\x3d 2 ? matrix[2] : matrix[3];\r\n\r\n\t\tvec4 lv \x3d mat * vec4(vpos, 1.0);\r\n\t\tlv.xy /\x3d lv.w;\r\n\r\n\t\t//vertex completely outside? -\x3e no shadow\r\n\t\tvec3 lvpos \x3d .5 * lv.xyz + vec3(.5);\r\n\t\tif (lvpos.z \x3e\x3d 1.0) return .0;\r\n\t\tif (lvpos.x \x3c .0 || lvpos.x \x3e 1.0 || lvpos.y \x3c .0 || lvpos.y \x3e 1.0) return .0;\r\n\r\n\t\t//calc coord in cascade texture\r\n\t\tvec2 uv \x3d vec2(float(i - 2 * (i / 2)) *.5, float(i / 2) * .5) + .5 * lvpos.xy;\r\n\r\n\t\tfloat texSize \x3d .5 / halfPxSz;\r\n\r\n\t\t//filter, offset by half pixels\r\n\t\tvec2 st \x3d fract((vec2(halfPxSz) + uv) * texSize);\r\n\r\n\t\tfloat s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n\t\tfloat s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n\t\tfloat s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n\t\tfloat s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n\r\n\t\treturn mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3c!--\r\n\tScene Lighting Definitions:\r\n\t\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\n\tdefines:\r\n\t\t- SH_ORDER: 1|2|3\r\n\tinput:\r\n\t\t- normal: vec3\r\n\t\t- albedo: vec3\r\n\t  - shadow: float\r\n\t\t- ssao: float\r\n\treturn:\r\n\t  - color: vec3\r\n--\x3e\r\n\x3csnippet name\x3d"sceneLightingDefinitions"\x3e\x3c![CDATA[\r\n\t$viewingMode\r\n\r\n\t// main light\r\n\t/////////////////////////////////////////\r\n\tuniform vec3 lightingMainDirection;\r\n\tuniform vec3 lightingMainIntensity;\r\n\r\n\t// ambient lighting\r\n\t/////////////////////////////////////////\r\n\t#ifndef SH_ORDER\r\n\t\t#define SH_ORDER 2\r\n\t#endif\r\n\r\n\t#if SH_ORDER \x3d\x3d 0\r\n\t\tuniform vec3 lightingAmbientSH0;\r\n\t#elif SH_ORDER \x3d\x3d 1\r\n\t\tuniform vec4 lightingAmbientSH_R;\r\n\t\tuniform vec4 lightingAmbientSH_G;\r\n\t\tuniform vec4 lightingAmbientSH_B;\r\n\t#elif SH_ORDER \x3d\x3d 2\r\n\t\tuniform vec3 lightingAmbientSH0;\r\n\t\tuniform vec4 lightingAmbientSH_R1;\r\n\t\tuniform vec4 lightingAmbientSH_G1;\r\n\t\tuniform vec4 lightingAmbientSH_B1;\r\n\t\tuniform vec4 lightingAmbientSH_R2;\r\n\t\tuniform vec4 lightingAmbientSH_G2;\r\n\t\tuniform vec4 lightingAmbientSH_B2;\r\n\t#endif\r\n\r\n\t// special tweaking\r\n\t//////////////////////////////////////////\r\n\t\tuniform float lightingFixedFactor;\r\n\t\tuniform float lightingGlobalFactor;\r\n\r\n\t\tuniform float ambientBoostFactor;\r\n\r\n\t// evaluation\r\n\t//////////////////////////////////////////\r\n\r\n\tvec3 evaluateSceneLighting(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\r\n\t\t// evaluate the main light\r\n\t\tfloat dotVal \x3d mix(clamp(-dot(normal, lightingMainDirection), 0.0, 1.0), 1.0, lightingFixedFactor);\r\n\t\tvec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\r\n\r\n\t\t// evaluate the sh ambient light\r\n\t\t#if SH_ORDER \x3d\x3d 0\r\n\t\t\tvec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\r\n\t\t#elif SH_ORDER \x3d\x3d 1\r\n\t\t\tvec4 sh0 \x3d vec4(\r\n\t\t\t\t0.282095,\r\n\t\t\t\t0.488603 * normal.x,\r\n\t\t\t\t0.488603 * normal.z,\r\n\t\t\t\t0.488603 * normal.y\r\n\t\t\t);\r\n\t\t\tvec3 ambientLight \x3d vec3(\r\n\t\t\t\tdot(lightingAmbientSH_R, sh0),\r\n\t\t\t\tdot(lightingAmbientSH_G, sh0),\r\n\t\t\t\tdot(lightingAmbientSH_B, sh0)\r\n\t\t\t);\r\n\t\t#elif SH_ORDER \x3d\x3d 2\r\n\t\t\tvec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\r\n\r\n\t\t\tvec4 sh1 \x3d vec4(\r\n\t\t\t\t0.488603 * normal.x,\r\n\t\t\t\t0.488603 * normal.z,\r\n\t\t\t\t0.488603 * normal.y,\r\n\t\t\t\t1.092548 * normal.x * normal.y\r\n\t\t\t);\r\n\t\t\tvec4 sh2 \x3d vec4(\r\n\t\t\t\t1.092548 * normal.y * normal.z,\r\n\t\t\t\t0.315392 * (3.0 * normal.z * normal.z - 1.0),\r\n\t\t\t\t1.092548 * normal.x * normal.z,\r\n\t\t\t\t0.546274 * (normal.x * normal.x - normal.y * normal.y)\r\n\t\t\t);\r\n\t\t\tambientLight +\x3d vec3(\r\n\t\t\t\tdot(lightingAmbientSH_R1, sh1),\r\n\t\t\t\tdot(lightingAmbientSH_G1, sh1),\r\n\t\t\t\tdot(lightingAmbientSH_B1, sh1)\r\n\t\t\t);\r\n\t\t\tambientLight +\x3d vec3(\r\n\t\t\t\tdot(lightingAmbientSH_R2, sh2),\r\n\t\t\t\tdot(lightingAmbientSH_G2, sh2),\r\n\t\t\t\tdot(lightingAmbientSH_B2, sh2)\r\n\t\t\t);\r\n\t\t#endif\r\n\t\tambientLight *\x3d (1.0 - ssao);\r\n\r\n\t\t// inverse gamma correction on the albedo color\r\n\t\tfloat gamma \x3d 2.1;\r\n\t\tvec3 albedoGammaC \x3d pow(albedo, vec3(gamma));\r\n\r\n\t\t// physically correct BRDF normalizes by PI\r\n\t\tconst float PI \x3d 3.14159;\r\n\t\tvec3 totalLight \x3d mainLight + ambientLight + additionalLight;\r\n\t\ttotalLight \x3d min(totalLight, vec3(PI, PI, PI));\r\n\t\tvec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\r\n\r\n\t\t// apply gamma correction to the computed color\r\n\t\toutColor \x3d pow(outColor, vec3(1.0/gamma));\r\n\r\n\t\treturn outColor;\r\n\t}\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"sceneLightingAdditionalLightGlobal"\x3e\x3c![CDATA[\r\n  vec3 sceneLightingAdditionalLightGlobal(vec3 worldPos, float ssao, out float additionalAmbientScale) {\r\n    // heuristic lighting model originally used in the terrain shading\r\n    // now used to generated additional ambient light\r\n\r\n#ifdef VIEWING_MODE_GLOBAL\r\n\r\n      float vndl \x3d -dot(normalize(worldPos), lightingMainDirection);\r\n\r\n#else\r\n\r\n      float vndl \x3d -dot(vec3(0,0,1), lightingMainDirection);\r\n\r\n#endif\r\n\r\n    additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\r\n    return ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"normal2envTC"\x3e\x3c![CDATA[\r\n\tvec2 normal2envTC(vec3 normal) {\r\n\t\tfloat v \x3d .5 + .5 * asin(normal.y) * 0.63661977;\r\n\t\tfloat u \x3d .5 - .5 * atan(normal.z, normal.x) * 0.31830988;\r\n\t\treturn vec2(u, v);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderShowDepth"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tattribute vec2 $position;\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\r\n\tvoid main(void) {\r\n\t\tgl_Position \x3d proj * vec4($position.x, $position.y, .0, 1.0);\r\n\t\tvtc \x3d $uv0;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\t\x3csnippet name\x3d"fragmentShaderShowDepth"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D depthTex;\r\n\tvarying vec2 vtc;\r\n\t$rgba2float\r\n\tvoid main() {\r\n\t//\tgl_FragColor \x3d vec4(vec3(texture2D(depthTex, vtc).a), 1.0);\r\n\t\tgl_FragColor \x3d vec4(rgba2float(texture2D(depthTex, vtc)));\r\n\t//\tgl_FragColor \x3d texture2D(depthTex, vtc);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsUVQuad"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec2 $position;\r\n\tvarying vec2 uv;\r\n\r\n\tvoid main(void) {\r\n\t\tgl_Position \x3d vec4($position.x, $position.y, .0, 1.0);\r\n\t\tuv \x3d $position * .5 + vec2(.5);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"toScreenCoords"\x3e\x3c![CDATA[\r\n\tvec4 toScreenCoords(vec3 vertex) {\r\n\t\tvec4 vClipSpace \x3d proj * view * vec4((model * vec4(vertex, 1.0)).xyz, 1.0);\r\n\t\tvClipSpace.xy *\x3d screenSize;\r\n\t\treturn vClipSpace/abs(vClipSpace.w);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vvUniforms"\x3e\x3c![CDATA[\r\n#if defined(VV_SIZE)\r\n\t#define VV_CUSTOM_MODEL_MATRIX\r\n#endif\r\n\r\n#if defined(VV_SIZE)\r\n\tuniform vec3 vvSizeMinSize;\r\n\tuniform vec3 vvSizeMaxSize;\r\n\tuniform vec3 vvSizeOffset;\r\n\tuniform vec3 vvSizeFactor;\r\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\r\n\tuniform vec3 vvSizeValue;\r\n#endif\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\tuniform mat3 vvSymbolRotation;\r\n#endif\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\tuniform vec3 vvSymbolAnchor;\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n\t#define VV_COLOR_N 8\r\n\tuniform float vvColorValues[VV_COLOR_N];\r\n\tuniform vec4 vvColorColors[VV_COLOR_N];\r\n#endif\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vvFunctions"\x3e\x3c![CDATA[\r\n// Evaluation of size\r\n#if defined(VV_SIZE)\r\n\tvec3 vvGetScale(vec4 featureAttribute) {\r\n\t\treturn clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\r\n\t}\r\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\r\n\tvec3 vvGetScale(vec4 featureAttribute) {\r\n\t\treturn vvSizeValue;\r\n\t}\r\n#endif\r\n\r\n// Applying the model matrix\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\tvec4 vvTransformPosition(vec3 position, vec4 featureAttribute) {\r\n\t\treturn vec4(vvSymbolRotation * (vvGetScale(featureAttribute) * (position + vvSymbolAnchor)), 1.0);\r\n\t}\r\n\r\n\tvec4 vvTransformNormal(vec3 normal, vec4 featureAttribute) {\r\n\t\t// Normal transform is the inverse transpose of model transform\r\n\t\treturn vec4(vvSymbolRotation * normal / vvGetScale(featureAttribute), 1.0);\r\n\t}\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n\tvec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\r\n\t\tfloat value \x3d featureAttribute.y;\r\n\t\tif (value \x3c\x3d values[0]) {\r\n\t\t\treturn colors[0];\r\n\t\t}\r\n\r\n\t\tfor (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n\t\t\tif (values[i] \x3e\x3d value) {\r\n\t\t\t\tfloat f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\r\n\t\t\t\treturn mix(colors[i-1], colors[i], f);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn colors[VV_COLOR_N - 1];\r\n\t}\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"rgb2hsv"\x3e\x3c![CDATA[\r\nvec3 rgb2hsv(vec3 c)\r\n{\r\n\tvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\r\n\tvec4 p \x3d mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\r\n\tvec4 q \x3d mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\r\n\r\n\tfloat d \x3d q.x - min(q.w, q.y);\r\n\tfloat e \x3d 1.0e-10;\r\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\r\n}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"hsv2rgb"\x3e\x3c![CDATA[\r\nvec3 hsv2rgb(vec3 c)\r\n{\r\n\tvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\r\n\tvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\r\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\r\n}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"colorMixMode"\x3e\x3c![CDATA[\r\n$rgb2hsv\r\n$hsv2rgb\r\n\r\n\r\n/*\r\n * The color mix modes are encoded in the symbol color as follows:\r\n *  - Fully transparent symbols are represented with alpha 0 for\r\n *    all color mix modes (except ignore).\r\n *  - color mix mode ignore is encoded as multiply with white\r\n *  - the other 3 color mix modes (tint, replace, multiply) are\r\n *    equally distributed on the remaining 255 alpha values, which\r\n *    gives us 85 possible alpha values\r\n *\r\n * alpha             0 : fully transparent\r\n * alpha in [  1 -  85]: tint\r\n * alpha in [ 86 - 170]: replace\r\n * alpha in [171 - 255]: multiply\r\n */\r\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\r\n  float symbolAlpha \x3d 0.0;\r\n\r\n  const float maxTint \x3d 85.0;\r\n  const float maxReplace \x3d 170.0;\r\n  const float scaleAlpha \x3d 3.0;\r\n\r\n  if (symbolColor.a \x3d\x3d 0.0) {\r\n    colorMixMode \x3d 1; // fully transparent -\x3e multiply\r\n    symbolAlpha \x3d 0.0;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxTint) {\r\n    colorMixMode \x3d 0; // tint\r\n    symbolAlpha \x3d scaleAlpha * symbolColor.a;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxReplace) {\r\n    colorMixMode \x3d 3; // replace\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\r\n  }\r\n  else {\r\n    colorMixMode \x3d 1;  // multiply\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\r\n  }\r\n\r\n  return vec4(symbolColor.rgb, symbolAlpha);\r\n}\r\n\r\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  vec3 internalMixed \x3d internalColor * textureColor;\r\n  vec3 allMixed \x3d internalMixed * externalColor;\r\n\r\n  if (mode \x3d\x3d 1 /* multiply */) {\r\n    return allMixed;\r\n  }\r\n  else if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalColor;\r\n  }\r\n  else {\r\n    // tint (or something invalid)\r\n    vec3 hsvIn \x3d rgb2hsv(internalMixed);\r\n    vec3 hsvTint \x3d rgb2hsv(externalColor);\r\n    vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\r\n    return hsv2rgb(hsvOut);\r\n  }\r\n}\r\n\r\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  float internalMixed \x3d internalOpacity * textureOpacity;\r\n  float allMixed \x3d internalMixed * externalOpacity;\r\n\r\n  if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalOpacity;\r\n  }\r\n  else {\r\n    // multiply or tint (or something invalid)\r\n    return allMixed;\r\n  }\r\n}\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"highlightWrite"\x3e\x3c![CDATA[\r\n  // the following uniforms are common to all highlight shaders:\r\n  // uniform sampler2D depthTex\r\n  // uniform vec4 highlightViewportPixelSz\r\n  float sceneDepth \x3d texture2D(depthTex, (gl_FragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\r\n  if (gl_FragCoord.z \x3e sceneDepth + 5e-6) {\r\n    gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\r\n  }\r\n  else {\r\n    gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"screenSizePerspective"\x3e\x3c![CDATA[\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n// Note that the implementation here should be kept in sync with the corresponding\r\n// CPU implementation (used for hitTest etc) in screenSizePerspectiveUtils.ts\r\n\r\n/**\r\n * Compute the screen size perspective lower bound from pre-computed screen\r\n * size perspective factors (or parameters, since both store the pixel lower\r\n * bound information in the same place). When computing the minimum size,\r\n * the padding (e.g. text halo) is scaled with the same factor as the\r\n * original size scales to reach the minimum size.\r\n *\r\n * {\r\n *    x: N/A\r\n *    y: N/A\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nfloat screenSizePerspectiveMinSize(float size, vec4 factor) {\r\n\r\n  // Original calculation:\r\n  //   padding \x3d 2 * factor.w\r\n  //   minSize \x3d factor.z\r\n  //\r\n  //   minSize + minSize / size * padding\r\n  //\r\n  // Incorporates padding (factor.w, e.g. text halo size) into the\r\n  // minimum bounds calculation, taking into account that padding\r\n  // would scale down proportionally to the size.\r\n  //\r\n  // Calculation below is the same, but avoids division by zero when\r\n  // size would be zero, without branching using step.\r\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10683\r\n\r\n  // nonZeroSize is 1 if size \x3e 0, and 0 otherwise\r\n  float nonZeroSize \x3d 1.0 - step(size, 0.0);\r\n\r\n  return (\r\n    factor.z * (\r\n      1.0 +\r\n      nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\r\n                                   // proportionally scaled padding\r\n      2.0 * factor.w / (\r\n        size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\r\n      )\r\n    )\r\n  );\r\n}\r\n\r\n/**\r\n * Computes the view angle dependent screen size perspective factor. The goal\r\n * of this factor is that:\r\n *\r\n *   1. There is no perspective when looking top-down\r\n *   2. There is a smooth and quick transition to full perspective when\r\n *      tilting.\r\n */\r\nfloat screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\r\n  return absCosAngle * absCosAngle * absCosAngle;\r\n}\r\n\r\n/**\r\n * Precomputes a set of factors that can be used to apply screen size perspective\r\n * The factors are based on the viewing angle, distance to camera and the screen size\r\n * perspective parameters:\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n *\r\n * The result is a set of factors that can be used to apply the perspective:\r\n *\r\n * {\r\n *    x: distance based relative scale factor (0 -\x3e 1)\r\n *    y: view dependent scale factor\r\n *    z: minPixelSize (abs)\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nvec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\r\n}\r\n\r\n/**\r\n * Applies screen size perspective factors to a single dimension size, given the viewing angle,\r\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\r\n * perspective parameters using screenSizePerspectiveScaleFactorFloat.\r\n *\r\n * Note that for single scale application, the screenSizePerspectiveScaleFloat can be used, which\r\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorFloat.\r\n */\r\n\r\nfloat applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\r\n  return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\r\n}\r\n\r\n/**\r\n * Applies screen size perspective parameters to a single dimension size, given the viewing angle,\r\n * distance to camera and perspective parameters\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nfloat screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\r\n}\r\n\r\n/**\r\n * Applies screen size perspective factors to a vec2 size (width/height), given the viewing angle,\r\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\r\n * perspective parameters using screenSizePerspectiveScaleFactorVec2.\r\n *\r\n * Note that for single scale application, the screenSizePerspectiveScaleVec2 can be used, which\r\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorVec2.\r\n */\r\nvec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\r\n  return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\r\n}\r\n\r\n/**\r\n * Applies screen size perspective parameters to a vec2 size (width/height), given the viewing angle,\r\n * distance to camera and perspective parameters\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nvec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\r\n}\r\n\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"computeNormal"\x3e\x3c![CDATA[\r\n  #ifdef GROUND_NORMAL_SHADING\r\n    #ifdef VIEWING_MODE_GLOBAL\r\n      vec3 normal \x3d normalize(vpos + localOrigin);\r\n    #else\r\n      vec3 normal \x3d vec3(0,0,1);\r\n    #endif\r\n  #else\r\n    // compute normal\r\n    #ifdef DOUBLESIDED\r\n      vec3 normal \x3d dot(vnormal, viewDir)\x3e0.0 ? -vnormal : vnormal;\r\n    #elif defined(WINDINGORDERDOUBLESIDED)\r\n      vec3 normal \x3d gl_FrontFacing ? vnormal : -vnormal;\r\n    #else\r\n      vec3 normal \x3d vnormal;\r\n    #endif\r\n    normal \x3d normalize(normal);\r\n  #endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"decodeNormal"\x3e\x3c![CDATA[\r\nvec3 decodeNormal(vec2 f)\r\n{\r\n    float z \x3d 1.0 - abs(f.x) - abs(f.y);\r\n    return vec3(f + sign(f) * min(z, 0.0), z);\r\n}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/CheckerBoardMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsCheckerBoard"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform mat4 model;\r\n\r\n  attribute vec3 $position;\r\n  attribute vec2 $uv0;\r\n\r\n  varying vec2 vUV;\r\n\r\n  void main(void) {\r\n    vUV \x3d $uv0;\r\n    gl_Position \x3d proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsCheckerBoard"\x3e\x3c![CDATA[\r\n#ifdef GL_OES_standard_derivatives\r\n#extension GL_OES_standard_derivatives : enable\r\n#endif\r\n\r\n  $fsprecisionf\r\n\r\n  uniform vec2 size;\r\n  uniform vec4 color1;\r\n  uniform vec4 color2;\r\n\r\n  varying vec2 vUV;\r\n\r\n  void main() {\r\n    vec2 uvScaled \x3d vUV / (2.0 * size);\r\n\r\n#ifdef GL_OES_standard_derivatives\r\n    vec2 uv \x3d fract(uvScaled - 0.25);\r\n    vec2 ab \x3d clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\r\n    float fade \x3d smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\r\n    float t \x3d mix(abs(ab.x + ab.y), 0.5, fade);\r\n#else\r\n    vec2 ab \x3d step(0.5, fract(uvScaled));\r\n    float t \x3d abs(1.0 - ab.x - ab.y);\r\n#endif\r\n\r\n    gl_FragColor \x3d mix(color2, color1, t);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/ColorMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderColorMaterial"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\r\n\tattribute vec3 $position;\r\n#ifdef VERTEXCOLORS\r\n\tattribute vec4 $color;\r\n\r\n\tvarying vec4 vColor;\r\n#endif\r\n\r\n\tvoid main(void) {\r\n#ifdef VERTEXCOLORS\r\n\t\tvColor \x3d $color * 0.003921568627451; // \x3d 1/255;\r\n#endif\r\n\t\tgl_Position \x3d proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderColorMaterial"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform vec4 eColor;\r\n#ifdef VERTEXCOLORS\r\n\tvarying vec4 vColor;\r\n#endif\r\n\r\n\tvoid main() {\r\n#ifdef VERTEXCOLORS\r\n\t\tgl_FragColor \x3d vColor * eColor;\r\n#else\r\n\t\tgl_FragColor \x3d eColor;\r\n#endif\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/DefaultMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"calculateVerticalOffset"\x3e\x3c![CDATA[\r\n  $viewingMode\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  // [ verticalOffsetPerDistance, minWorldLength, maxWorldLength ]\r\n  uniform vec4 verticalOffset;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  uniform vec4 screenSizePerspectiveAlignment;\r\n\r\n  $screenSizePerspective\r\n\r\n#endif\r\n\r\n  vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\r\n    float viewDistance \x3d length((view * vec4(worldPos, 1)).xyz);\r\n    float verticalOffsetOffsetDistance \x3d verticalOffset.x * viewDistance;\r\n\r\n#ifdef VIEWING_MODE_GLOBAL\r\n    vec3 worldNormal \x3d normalize(worldPos + localOrigin);\r\n#else\r\n    vec3 worldNormal \x3d vec3(0, 0, 1);\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n    float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\r\n\r\n    float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);\r\n#else\r\n    float verticalOffsetScreenHeight \x3d verticalOffset.x;\r\n#endif\r\n\r\n    // Screen sized offset in world space, used for example for line callouts\r\n    float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\r\n\r\n    return worldNormal * worldOffset;\r\n  }\r\n#endif\r\n]]\x3e\r\n\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsPhongSrc"\x3e\x3c![CDATA[\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n  uniform vec3 camPos;\r\n\r\n\tuniform vec3 localOrigin;\r\n\r\n#ifdef INSTANCED\r\n    attribute mat4 model;\r\n    attribute mat4 modelNormal;\r\n#else\r\n\tuniform mat4 model;\r\n\tuniform mat4 modelNormal;\r\n#endif\r\n#ifdef INSTANCEDCOLOR\r\n\tattribute vec4 instanceColor;\r\n#endif\r\n\tattribute vec3 $position;\r\n#ifdef COMPRESSED_NORMALS\r\n  attribute vec2 $normalCompressed;\r\n#else\r\n  attribute vec3 $normal;\r\n#endif\r\n\tvarying vec3 vpos;\r\n\tvarying vec3 vnormal;\r\n\r\n#ifdef COMPONENTCOLORS\r\n  uniform sampler2D uComponentColorTex;\r\n  uniform vec2 uComponentColorTexInvDim;\r\n\r\n  attribute float $componentIndex;\r\n\r\n  vec4 readComponentColor() {\r\n    float normalizedIndex \x3d ($componentIndex + 0.5) * uComponentColorTexInvDim.x;\r\n    vec2 indexCoord \x3d vec2(\r\n      mod(normalizedIndex, 1.0),\r\n      (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\r\n    );\r\n    return texture2D(uComponentColorTex, indexCoord);\r\n  }\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n\tvarying float linearDepth;\r\n#endif\r\n\r\n#ifdef VERTEXCOLORS\r\n\tattribute vec4 $color;\r\n#endif\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\n  attribute vec4 $symbolColor;\r\n#endif\r\n\r\n#if defined(VV_SIZE) || defined(VV_COLOR)\r\n\tattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n$vvUniforms\r\n\r\n#if defined(VERTEXCOLORS)\r\n\tvarying vec4 vcolor;\r\n#endif\r\n\r\n  // Workaround for https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13452\r\n  // We pass the externalColor uniform from VS to FS through the vcolorExt varying because\r\n  // there is a driver bug for Intel Integrated Graphics which led to rendering artifacts\r\n  // since the introduction of https://devtopia.esri.com/WebGIS/arcgis-js-api/pull/12673\r\n  // This should be further cleaned up later with through the following issue:\r\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12763\r\n\tuniform vec4 externalColor;\r\n\tvarying vec4 vcolorExt;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\n\tvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#endif\r\n\r\n\t$vvFunctions\r\n\r\n\t$colorMixMode\r\n\r\n  $calculateVerticalOffset\r\n\r\n  $decodeNormal\r\n\r\n\tvoid main(void) {\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\r\n\t\tvpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\r\n\r\n#ifdef COMPRESSED_NORMALS\r\n    vnormal \x3d normalize((modelNormal * vvTransformNormal(decodeNormal($normalCompressed), instanceFeatureAttribute)).xyz);\r\n#else\r\n    vnormal \x3d normalize((modelNormal * vvTransformNormal($normal, instanceFeatureAttribute)).xyz);\r\n#endif\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\t\tvec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\r\n#endif\r\n\r\n#else /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n\t\tvpos \x3d (model * vec4($position, 1.0)).xyz;\r\n#ifdef COMPRESSED_NORMALS\r\n    vnormal \x3d normalize((modelNormal * vec4(decodeNormal($normalCompressed), 1.0)).xyz);\r\n#else\r\n    vnormal \x3d normalize((modelNormal * vec4($normal, 1.0)).xyz);\r\n#endif\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\t\tvec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\r\n#endif\r\n\r\n#endif /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n\r\n\t\tgl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n\t\t// Shadowmap\'s cascading index used to be based on \'1.0 / gl_FragCoord.w\'\r\n\t\t// (i.e. the perspective interpolation of \'gl_Position.w\'). Precision\r\n\t\t// issues on iPad/iPhone with the \'w\' component require the depth to be\r\n\t\t// passed as varying to properly drive the cascading shadow map index.\r\n\t\tlinearDepth \x3d gl_Position.w;\r\n#endif\r\n\r\n#ifdef VERTEXCOLORS\r\n\t\tvcolor \x3d $color * 0.003921568627451; // \x3d 1/255\r\n#endif\r\n\r\n\t\tvcolorExt \x3d externalColor;\r\n\r\n#ifdef INSTANCEDCOLOR\r\n\t\tvcolorExt *\x3d instanceColor;\r\n#endif\r\n#ifdef VV_COLOR\r\n\t\tvcolorExt *\x3d vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\r\n#endif\r\n#ifdef SYMBOLVERTEXCOLORS\r\n    int symbolColorMixMode;\r\n    vcolorExt *\x3d decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n    colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n#ifdef COMPONENTCOLORS\r\n    int symbolColorMixMode;\r\n    vcolorExt *\x3d decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n    colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsPhongSrc"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n\tuniform vec3 camPos;\r\n\tuniform vec3 localOrigin;\r\n\r\n\t$sceneLightingDefinitions\r\n\t$sceneLightingAdditionalLightGlobal\r\n\r\n\t// material parameters\r\n\t//////////////////////////////////////////\r\n\tuniform vec3 ambient;\r\n\tuniform vec3 diffuse;\r\n\tuniform vec3 specular;\r\n\tuniform float opacity;\r\n\tuniform float layerOpacity;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\n\tvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#else\r\n  uniform int colorMixMode;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n\tuniform sampler2D depthTex;\r\n\tuniform int shadowMapNum;\r\n\tuniform vec4 shadowMapDistance;\r\n\tuniform mat4 shadowMapMatrix[4];\r\n\tuniform float depthHalfPixelSz;\r\n#endif\r\n\r\n#ifdef RECEIVE_SSAO\r\n\tuniform sampler2D ssaoTex;\r\n\tuniform vec4 viewportPixelSz;\r\n#endif\r\n\r\n\r\n\tvarying vec3 vpos;\r\n\tvarying vec3 vnormal;\r\n#if defined(VERTEXCOLORS)\r\n\tvarying vec4 vcolor;\r\n#endif\r\n\tvarying vec4 vcolorExt;\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n\tvarying float linearDepth;\r\n\t$evalShadow\r\n#endif\r\n\r\n\t$colorMixMode\r\n\r\n\tvoid main() {\r\n\t\tvec3 viewDir \x3d normalize(vpos - camPos);\r\n\r\n\t\t$computeNormal\r\n\r\n\t\tvec3 reflDir \x3d normalize(reflect(viewDir, normal));\r\n\r\n\t\t// compute ssao\r\n\t\t#ifdef RECEIVE_SSAO\r\n\t\t\t\tfloat ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n\t\t\t\tssao \x3d viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\r\n\t\t#else\r\n\t\t\t\tfloat ssao \x3d 1.0;\r\n\t\t#endif\r\n\r\n\t\t// At global scale we create some additional ambient light based on the main light to simulate global illumination\r\n\t\tfloat additionalAmbientScale;\r\n\t\tvec3 additionalLight \x3d sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\r\n\r\n\t\t// compute shadowing\r\n\t\tfloat shadow \x3d 0.0;\r\n\t\t#ifdef RECEIVE_SHADOWS\r\n\t\t\tshadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n\t\t#elif defined(VIEWING_MODE_GLOBAL)\r\n\t\t\t// at global scale (and in global scenes) we fall back to this approximation\r\n\t\t\t// to shadow objects on the dark side of the earth\r\n\t\t\tshadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\r\n\t\t#endif\r\n\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c!-- Keep is synchronized with the logic in Material.js:isVisible --\x3e\r\n\x3csnippet name\x3d"externalColorMix"\x3e\x3c![CDATA[\r\n\tvec3 matColor \x3d max(ambient, diffuse); // combine the old material parameters into a single one\r\n\t#if defined(VERTEXCOLORS)\r\n\t\t\t// Internal colors: varying vcolor + uniform ambient/diffuse, external colors: varying vcolorExt\r\n\t\t\tvec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n\t\t\tfloat opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n\t#else\r\n\t\t\t// Internal colors: uniform ambient/diffuse, external colors: varying vcolorExt\r\n\t\t\tvec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n\t\t\tfloat opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n\t#endif\r\n\talbedo_+\x3d 0.25 * specular; // don\'t completely ignore specular for now\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsPhong"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\t$vsPhongSrc\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsPhong"\x3e\x3c![CDATA[\r\n\t\t$fsprecisionf\r\n\r\n\t\t$fsPhongSrc\r\n\r\n\t\tvec4 texColor \x3d vec4(1,1,1,1);\r\n\t\t$externalColorMix\r\n\r\n\t\tif (opacity_ \x3c 0.001) {\r\n\t\t\tdiscard;\r\n\t\t}\r\n\r\n\t\tvec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n\r\n\t\tgl_FragColor \x3d vec4(shadedColor, opacity_);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsPhongTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\t$vsPhongSrc\r\n#ifndef FLIPV\r\n\t\tvtc \x3d $uv0;\r\n#else\r\n\t\tvtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsPhongTextured"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D tex;\r\n\tvarying vec2 vtc;\r\n\r\n\t$fsPhongSrc\r\n\r\n\t\t// read texture color\r\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\r\n\t\tif (texColor.a \x3c .33) discard;\r\n\r\n\t\t$externalColorMix\r\n\r\n\t\tif (opacity_ \x3c 0.001) {\r\n\t\t\tdiscard;\r\n\t\t}\r\n\r\n\t\tvec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n\r\n\t\tgl_FragColor \x3d vec4(shadedColor, opacity_);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsPhongAtlasTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec4 $uv0;\r\n\tattribute vec4 $region;\r\n\tvarying vec2 vtc;\r\n\tvarying vec4 regionV;\r\n\t$vsPhongSrc\r\n#ifndef FLIPV\r\n\t\tvtc \x3d $uv0.xy;\r\n#else\r\n\t\tvtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n\t\tregionV \x3d $region/65535.0;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsPhongAtlasTextured"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D tex;\r\n\tuniform vec2 texSize;\r\n\tvarying vec2 vtc;\r\n\tvarying vec4 regionV;\r\n\r\n\tfloat calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\r\n\t\t// from:\r\n\t\t//   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\r\n\t\t//   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\r\n\t\t//   - http://www.linedef.com/virtual-texture-demo.html\r\n\t\tfloat deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\r\n\t\treturn max(0.5 * log2(deltaMaxSqr), 0.0);\r\n\t}\r\n\r\n\t$fsPhongSrc\r\n\r\n\t\tvec2 uv \x3d vtc;\r\n\t\tuv \x3d fract(uv);\r\n\t\t//[umin, vmin, umax, vmax]\r\n\r\n\t\tvec2 atlasScale \x3d regionV.zw - regionV.xy;\r\n\t\tuv \x3d uv.xy * atlasScale + regionV.xy;\r\n\r\n\t\tvec4 texColor;\r\n\t\t#ifdef GL_OES_standard_derivatives\r\n\t\t\t#extension GL_OES_standard_derivatives : enable\r\n\r\n\t\t\t// calculate derivative of continuous texture coordinate\r\n\t\t\t// to avoid mipmapping artifacts caused by manual wrapping in shader\r\n\t\t\tvec2 dUVdx \x3d dFdx(vtc) * atlasScale;\r\n\t\t\tvec2 dUVdy \x3d dFdy(vtc) * atlasScale;\r\n\r\n\t\t\t#ifdef GL_EXT_shader_texture_lod\r\n\t\t\t\t#extension GL_EXT_shader_texture_lod : enable\r\n\r\n\t\t\t\t// workaround for artifacts in Windows 10 using Intel HD Graphics 4000 series\r\n\t\t\t\t// see: https://devtopia.esri.com/Zurich-R-D-Center/arcgis-js-api-canvas3d-issues/issues/768\r\n\t\t\t\tconst float epsilon \x3d 1.0E-32;\r\n\t\t\t\tfloat zeroUVShift \x3d uv.x \x3d\x3d 0.0 \x26\x26 uv.y \x3d\x3d 0.0 ? epsilon : 0.0;\r\n\r\n\t\t\t\ttexColor \x3d texture2DGradEXT(tex, uv + zeroUVShift, dUVdx, dUVdy);\r\n\t\t\t#else\r\n\t\t\t\t// use bias to compensate for difference in automatic vs desired mipmap level\r\n\t\t\t\tvec2 dUVdxAuto \x3d dFdx(uv);\r\n\t\t\t\tvec2 dUVdyAuto \x3d dFdy(uv);\r\n\t\t\t\tfloat mipMapLevel \x3d calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\r\n\t\t\t\tfloat autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\r\n\t\t\t\ttexColor \x3d texture2D(tex, uv, mipMapLevel - autoMipMapLevel);\r\n\t\t\t#endif\r\n\t\t#else\r\n\t\t\ttexColor \x3d texture2D(tex, uv);\r\n\t\t#endif\r\n\r\n\t\tif (texColor.a \x3c .33) discard;\r\n\r\n\t\t$externalColorMix\r\n\r\n\t\tif (opacity_ \x3c 0.001) {\r\n\t\t\tdiscard;\r\n\t\t}\r\n\r\n\t\tvec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n\t\tgl_FragColor \x3d vec4(shadedColor, opacity_);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsDepthSrc"\x3e\x3c![CDATA[\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n  uniform vec3 camPos;\r\n  uniform vec3 localOrigin;\r\n\r\n#ifdef INSTANCED\r\n\tattribute mat4 model;\r\n  attribute mat4 modelNormal;\r\n#else\r\n\tuniform mat4 model;\r\n  uniform mat4 modelNormal;\r\n#endif\r\n\tuniform vec2 nearFar;\r\n\tattribute vec3 $position;\r\n\tvarying float depth;\r\n\r\n\t$vvUniforms\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\n\tattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\t$vvFunctions\r\n\r\n  $calculateVerticalOffset\r\n\r\n\tvoid main(void) {\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\r\n    vec3 vpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\r\n#endif\r\n\r\n#else /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n\t\tvec3 vpos \x3d (model * vec4($position, 1.0)).xyz;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\t\tvec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\r\n#endif\r\n\r\n#endif /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n\r\n    vec4 eye \x3d view * vec4(vpos, 1);\r\n\r\n\t\tgl_Position \x3d proj * eye;\r\n\t\tdepth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsDepth"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\t$vsDepthSrc\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsDepthTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\t$vsDepthSrc\r\n#ifndef FLIPV\r\n        vtc \x3d $uv0;\r\n#else\r\n        vtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsNormalSrc"\x3e\x3c![CDATA[\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n  uniform vec3 camPos;\r\n  uniform vec3 localOrigin;\r\n\r\n#ifdef INSTANCED\r\n\tattribute mat4 model;\r\n\tattribute mat4 modelNormal;\r\n#else\r\n\tuniform mat4 model;\r\n\tuniform mat4 modelNormal;\r\n#endif\r\n\tuniform mat4 viewNormal;\r\n\tattribute vec3 $position;\r\n#ifdef COMPRESSED_NORMALS\r\n  attribute vec2 $normalCompressed;\r\n#else\r\n  attribute vec3 $normal;\r\n#endif\r\n\tvarying vec3 vnormal;\r\n\r\n\t$vvUniforms\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\n\tattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\t$vvFunctions\r\n\r\n  $calculateVerticalOffset\r\n\r\n  $decodeNormal\r\n\r\n\tvoid main(void) {\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\r\n    vec3 vpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\r\n#ifdef COMPRESSED_NORMALS\r\n    vnormal \x3d normalize((viewNormal * modelNormal * vvTransformNormal(decodeNormal($normalCompressed), instanceFeatureAttribute)).xyz);\r\n#else\r\n\t\tvnormal \x3d normalize((viewNormal * modelNormal * vvTransformNormal($normal, instanceFeatureAttribute)).xyz);\r\n#endif\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\r\n#endif\r\n\r\n#else /* VV_CUSTOM_MODEL_MATRIX */\r\n\t\tvec3 vpos \x3d (model * vec4($position, 1.0)).xyz;\r\n#ifdef COMPRESSED_NORMALS\r\n    vnormal \x3d normalize((viewNormal * modelNormal * vec4(decodeNormal($normalCompressed), 1.0)).xyz);\r\n#else\r\n\t\tvnormal \x3d normalize((viewNormal * modelNormal * vec4($normal, 1.0)).xyz);\r\n#endif\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\r\n#endif\r\n\r\n#endif /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n\r\n    gl_Position \x3d proj * view * vec4(vpos, 1);\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsNormal"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\t$vsNormalSrc\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsNormalTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\t$vsNormalSrc\r\n#ifndef FLIPV\r\n\t\tvtc \x3d $uv0;\r\n#else\r\n\t\tvtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsHighlightSrc"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n  uniform vec3 camPos;\r\n  uniform vec3 localOrigin;\r\n\r\n#ifdef INSTANCED\r\n\tattribute mat4 model;\r\n  attribute mat4 modelNormal;\r\n#else\r\n\tuniform mat4 model;\r\n  uniform mat4 modelNormal;\r\n#endif\r\n\tattribute vec3 $position;\r\n\r\n\t$vvUniforms\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\n\tattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\t$vvFunctions\r\n\r\n  $calculateVerticalOffset\r\n\r\n\tvoid main(void) {\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\r\n    vec3 vpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\r\n#endif\r\n\r\n#else /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n    vec3 vpos \x3d (model * vec4($position, 1.0)).xyz;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\r\n#endif\r\n\r\n#endif /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n\r\n\t\tgl_Position \x3d proj * view * vec4(vpos, 1);\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsHighlight"\x3e\x3c![CDATA[\r\n\t$vsHighlightSrc\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsHighlightTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\t$vsHighlightSrc\r\n#ifndef FLIPV\r\n\t\tvtc \x3d $uv0;\r\n#else\r\n\t\tvtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsDepthSrc"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\tvarying float depth;\r\n\r\n\tvoid main() {\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsDepth"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\t$calcFragDepth\r\n\t$float2rgba\r\n\t$fsDepthSrc\r\n#ifndef BIAS_SHADOWMAP\r\n\t\tgl_FragColor \x3d float2rgba(depth);\r\n#else\r\n\t\tgl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n#endif\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsDepthTextured"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D tex;\r\n\tvarying vec2 vtc;\r\n\t$calcFragDepth\r\n\t$float2rgba\r\n\r\n\t$fsDepthSrc\r\n\t\tif (texture2D(tex, vtc).a \x3c .33) discard;\r\n#ifndef BIAS_SHADOWMAP\r\n\t\tgl_FragColor \x3d float2rgba(depth);\r\n#else\r\n\t\tgl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n#endif\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsNormal"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tvarying vec3 vnormal;\r\n\tvoid main() {\r\n\t\tvec3 normal \x3d normalize(vnormal);\r\n\t\tif (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n\r\n#ifndef ALPHA_ZERO\r\n\t\tgl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n#else\r\n\t\tgl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n#endif\r\n\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsNormalTextured"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tvarying vec3 vnormal;\r\n\tvarying vec2 vtc;\r\n\tuniform sampler2D tex;\r\n\tvoid main() {\r\n\t\tif (texture2D(tex, vtc).a \x3c .33) discard;\r\n\t\tvec3 normal \x3d normalize(vnormal);\r\n\t\tif (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n#ifndef ALPHA_ZERO\r\n\t\tgl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n#else\r\n\t\tgl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n#endif\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsHighlight"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n  uniform sampler2D depthTex;\r\n  uniform vec4 highlightViewportPixelSz;\r\n\r\n\tvoid main() {\r\n\t\t$highlightWrite\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsHighlightTextured"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tvarying vec2 vtc;\r\n\tuniform sampler2D tex;\r\n  uniform sampler2D depthTex;\r\n  uniform vec4 highlightViewportPixelSz;\r\n\r\n\tvoid main() {\r\n\t\tif (texture2D(tex, vtc).a \x3c .33) discard;\r\n\r\n\t\t$highlightWrite\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/LineCalloutMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderLineCallout"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  $commonAttributesAndUniformsHUD\r\n\r\n  attribute vec2 $uv0;\r\n\r\n  uniform float lineSize;\r\n  uniform vec2 pixelToNDC;\r\n  uniform float borderSize;\r\n  uniform vec2 screenOffset;\r\n\r\n  varying vec4 coverageSampling;\r\n  varying vec2 lineSizes;\r\n\r\n  $alignToPixelOrigin\r\n  $alignToPixelCenter\r\n\r\n  $projectPositionHUD\r\n\r\n  void main(void) {\r\n    ProjectHUDAux projectAux;\r\n    vec4 endPoint \x3d projectPositionHUD(projectAux);\r\n\r\n#ifdef OCCL_TEST\r\n    if (!testVisibilityHUD(endPoint)) {\r\n      gl_Position \x3d vec4(1e38, 1e38, 1e38, 1);\r\n    }\r\n    else {\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n      vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\r\n      vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\r\n#else\r\n      vec2 screenOffsetScaled \x3d screenOffset;\r\n#endif\r\n\r\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\r\n      // used to get the correct depth value\r\n      vec3 posView \x3d (view * model * vec4($position, 1.0)).xyz;\r\n      applyHUDViewDependentPolygonOffset($auxpos1.w, projectAux.absCosAngle, posView);\r\n\r\n      vec4 startPoint \x3d proj * vec4(posView, 1);\r\n\r\n      // Apply screen offset to both start and end point\r\n      vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\r\n\r\n      startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\r\n      endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\r\n\r\n      // Align start and end to pixel origin\r\n      vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\r\n      vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\r\n\r\n#ifdef DEPTH_HUD\r\n\r\n#ifdef DEPTH_HUD_ALIGN_START\r\n      endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);\r\n#else\r\n      startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);\r\n#endif\r\n\r\n#endif\r\n\r\n      vec4 projectedPosition \x3d mix(startAligned, endAligned, $uv0.y);\r\n\r\n      // The direction of the line in screen space\r\n      vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\r\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n      float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\r\n      float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\r\n\r\n#else\r\n\r\n      float lineSizeScaled \x3d lineSize;\r\n      float borderSizeScaled \x3d borderSize;\r\n\r\n#endif\r\n\r\n      float halfPixelSize \x3d lineSizeScaled * 0.5;\r\n\r\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\r\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\r\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\r\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\r\n      float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\r\n      float halfPixelSizeInt \x3d floor(halfWholePixelSize);\r\n\r\n      // Sub-pixel offset if we need to grow sub-pixels to the left\r\n      float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\r\n\r\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\r\n      float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\r\n\r\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\r\n      float padding \x3d 1.0 + borderSizeScaled;\r\n      vec2 ndcOffset \x3d (pixelOffset - padding + $uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\r\n\r\n      // Offset x/y from the center of the line in screen space\r\n      projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\r\n\r\n      // Compute a coverage varying which we can use in the fragment shader to determine\r\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\r\n      // This works by computing two coordinates that can be linearly interpolated and then\r\n      // subtracted to find out how far away from the line edge we are.\r\n      float edgeDirection \x3d ($uv0.x * 2.0 - 1.0);\r\n\r\n      float halfBorderSize \x3d 0.5 * borderSizeScaled;\r\n      float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\r\n      float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\r\n\r\n      float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\r\n\r\n      coverageSampling \x3d vec4(\r\n        // Edge coordinate\r\n        outerEdgeCoverageSampler,\r\n\r\n        // Border edge coordinate\r\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\r\n\r\n        // Line offset\r\n        halfPixelSize - 0.5,\r\n\r\n        // Border offset\r\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\r\n      );\r\n\r\n      lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\r\n\r\n      gl_Position \x3d projectedPosition;\r\n\r\n#ifdef OCCL_TEST\r\n    }\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet\x3e\x3c![CDATA[\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderLineCallout"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform vec4 color;\r\n  uniform vec4 borderColor;\r\n\r\n  varying vec4 coverageSampling;\r\n  varying vec2 lineSizes;\r\n\r\n  void main() {\r\n    // Mix between line and border coverage offsets depending on whether we need\r\n    // a border (based on the sidedness).\r\n    vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\r\n\r\n    // Mix between border and line color based on the line coverage (conceptually the line\r\n    // blends on top of the border background).\r\n    //\r\n    // Anti-alias by blending final result using the full (including optional border) coverage\r\n    // and the color alpha\r\n    float borderAlpha \x3d color.a * borderColor.a * coverage.y;\r\n    float colorAlpha \x3d color.a * coverage.x;\r\n\r\n    float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\r\n\r\n#ifdef DEPTH_HUD\r\n\r\n    if (finalAlpha \x3c 0.01) {\r\n      discard;\r\n    }\r\n\r\n#else\r\n\r\n    // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\r\n    // need to divide by finalAlpha). We avoid the division here by setting the\r\n    // appropriate blending function in the material.\r\n    vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\r\n\r\n    gl_FragColor \x3d vec4(finalRgb, finalAlpha);\r\n\r\n#endif\r\n\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/MeasurementArrowMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsMeasurementArrow"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform mat4 model;\r\n\r\n  uniform float width;\r\n\r\n  attribute vec3 $position;\r\n  attribute vec3 $normal;\r\n  attribute vec2 $uv0;\r\n  attribute float $auxpos1;\r\n\r\n  varying vec2 vtc;\r\n  varying float vlength;\r\n  varying float vradius;\r\n\r\n  void main(void) {\r\n    vec3 bitangent \x3d $normal;\r\n\r\n    vtc \x3d $uv0;\r\n    vlength \x3d $auxpos1;\r\n    vradius \x3d 0.5 * width;\r\n\r\n    vec4 pos \x3d view * vec4((model * vec4($position + vradius * bitangent * $uv0.y, 1.0)).xyz, 1.0);\r\n    gl_Position \x3d proj * pos;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsMeasurementArrow"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform float outlineSize;\r\n  uniform vec4 outlineColor;\r\n  uniform float stripeLength;\r\n  uniform vec4 stripeEvenColor;\r\n  uniform vec4 stripeOddColor;\r\n\r\n  varying vec2 vtc;\r\n  varying float vlength;\r\n  varying float vradius;\r\n\r\n  #define INV_SQRT2 (1.0 / sqrt(2.0))\r\n\r\n  vec4 arrowColor(vec2 tc, float len) {\r\n    float d \x3d INV_SQRT2 * (tc.x - abs(tc.y));\r\n    d \x3d min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\r\n    d \x3d min(d, 1.0 - abs(tc.y));\r\n\r\n    if (d \x3c 0.0) {\r\n      return vec4(0.0);\r\n    } else if (d \x3c outlineSize) {\r\n      return outlineColor;\r\n    } else {\r\n      return fract(0.5 / stripeLength * tc.x * vradius) \x3e\x3d 0.5 ? stripeOddColor : stripeEvenColor;\r\n    }\r\n  }\r\n\r\n  void main(void) {\r\n    vec2 ntc \x3d vec2(vtc.x / vradius, vtc.y);\r\n    vec4 color \x3d arrowColor(ntc, vlength / vradius);\r\n    if (color.a \x3d\x3d 0.0) {\r\n      discard;\r\n    }\r\n    gl_FragColor \x3d color;\r\n  }\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/RibbonLineMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsRibbonLine"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\r\n\tuniform float extLineWidth;\r\n\tuniform float nearPlane;\r\n\r\n\tattribute vec3 $position;\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\r\n\tattribute vec4 $color;\r\n\tvarying vec4 vColor;\r\n\r\n\tattribute float size;\r\n\r\n#ifndef WALL\r\n\tuniform float miterLimit;\r\n\tattribute vec3 $auxpos1;\r\n\tattribute vec3 $auxpos2;\r\n#endif\r\n\r\n#ifdef SCREENSCALE\r\n\tuniform vec2 screenSize;\r\n\t$toScreenCoords\r\n#define VECTYPE vec2\r\n#define ZEROVEC vec2(0.0, 0.0)\r\n#define PERPENDICULAR(v) vec2(v.y, -v.x);\r\n#define ISOUTSIDE (left.x * right.y - left.y * right.x)*$uv0.y \x3e 0.0\r\n\r\n#else //ifdef SCREENSCALE\r\n\r\n#define VECTYPE vec3\r\n#define ZEROVEC vec3(0.0, 0.0, 0.0)\r\n// these macros are only valid for "strip" type lines:\r\n#define PERPENDICULAR(v) cross(up/*vec3(0.0, 1.0, 0.0)*/, v)\r\n#define ISOUTSIDE dot(cross(left, right), up/*vec3(0.0, 1.0, 0.0)*/)*$uv0.y \x3c 0.0\r\n\r\n#endif //ifdef SCREENSCALE\r\n\r\n\tfloat interp(float ncp, vec4 a, vec4 b) {\r\n\t\treturn (-ncp - a.z) / (b.z - a.z);\r\n\t}\r\n\r\n#ifdef SCREENSCALE\r\n\r\n  void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next) {\r\n\t\tfloat vnp \x3d nearPlane*0.99;\r\n\r\n\t\t//We have four vertices per point on the line. Start and end vertices\r\n\t\t//are treated differently --\x3e d \x3e 0, d \x3c 0\r\n\t\tfloat d \x3d abs($uv0.y) - 1.1;\r\n\r\n\t\t//current pos behind ncp --\x3e we need to clip\r\n\t\tif(pos.z \x3e -nearPlane) {\r\n\t\t\tif (d \x3c 0.0) {\r\n\t\t\t\t//previous in front of ncp\r\n\t\t\t\tif(prev.z \x3c -nearPlane) {\r\n\t\t\t\t\tpos \x3d mix(prev, pos, interp(vnp, prev, pos));\r\n\t\t\t\t\tnext \x3d pos;\r\n\t\t\t\t} else {\r\n\t\t\t\t  pos \x3d vec4(0, 0, 0, 1);\r\n\t\t\t  }\r\n\t\t\t}\r\n\t\t\t//next in front of ncp\r\n\t\t\tif(d \x3e 0.0) {\r\n\t\t\t\tif(next.z \x3c -nearPlane) {\r\n\t\t\t\t\tpos \x3d mix(pos, next, interp(vnp, pos, next));\r\n\t\t\t\t\tprev \x3d pos;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpos \x3d vec4(0, 0, 0, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\telse {\r\n\t\t\t//current position visible\r\n\t\t\t//previous behind ncp\r\n\t\t\tif (prev.z \x3e -nearPlane) {\r\n\t\t\t\tprev \x3d mix(pos, prev, interp(vnp, pos, prev));\r\n\t\t\t}\r\n\t\t\t//next behind ncp\r\n\t\t\tif (next.z \x3e -nearPlane) {\r\n\t\t\t\tnext \x3d mix(next, pos, interp(vnp, next, pos));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpos\x3d proj * pos;\r\n\t\tpos.xy *\x3d screenSize;\r\n\t\tpos /\x3d pos.w;\r\n\r\n\t\tnext \x3d proj * next;\r\n\t\tnext.xy *\x3d screenSize;\r\n\t\tnext /\x3d next.w;\r\n\r\n\t\tprev \x3d proj * prev;\r\n\t\tprev.xy *\x3d screenSize;\r\n\t\tprev /\x3d prev.w;\r\n  }\r\n\r\n#endif // SCREENSCALE\r\n\r\n\tvoid main(void) {\r\n\r\n\tfloat lineWidth \x3d extLineWidth + $size;\r\n\r\n#ifdef SCREENSCALE\r\n\r\n#if 0\r\n\t\tvec4 pos \x3d toScreenCoords($position.xyz);\r\n\t\tvec2 left \x3d (pos - toScreenCoords($auxpos1)).xy;\r\n\t\tvec2 right \x3d (toScreenCoords($auxpos2) - pos).xy;\r\n#else\r\n\t\tvec4 pos  \x3d view * vec4((model * vec4($position.xyz, 1.0)).xyz, 1.0);\r\n\t\tvec4 prev \x3d view * vec4((model * vec4($auxpos1.xyz, 1.0)).xyz, 1.0);\r\n\t\tvec4 next \x3d view * vec4((model * vec4($auxpos2.xyz, 1.0)).xyz, 1.0);\r\n\r\n\t\tclipAndTransform(pos, prev, next);\r\n\r\n\t\tvec2 left \x3d (pos - prev).xy;\r\n\t\tvec2 right \x3d (next - pos).xy;\r\n#endif\r\n\r\n#else // ifdef SCREENSCALE\r\n\t\tvec4 pos \x3d vec4($position, 1.0);\r\n#ifndef WALL\r\n\t\tvec3 left \x3d $position.xyz - $auxpos1;\r\n\t\tvec3 right \x3d $auxpos2 - $position.xyz;\r\n\t\tvec3 up \x3d normalize($position.xyz);\r\n#endif // ifndef WALL\r\n#endif // ifdef SCREENSCALE\r\n\r\n#ifdef WALL\r\n\t\tfloat displacementLen \x3d lineWidth;\r\n\t\tvec3 displacementDir \x3d normalize($position.xyz);//vec3(0.0, 1.0, 0.0);\r\n#else // ifdef WALL\r\n\r\n\t\tfloat leftLen \x3d length(left);\r\n\t\tleft \x3d (leftLen \x3e 0.001) ? left/leftLen : ZEROVEC;\r\n\r\n\t\tfloat rightLen \x3d length(right);\r\n\t\tright \x3d (rightLen \x3e 0.001) ? right/rightLen : ZEROVEC;\r\n\r\n\t\t// determine if vertex is on the "outside or "inside" of the join\r\n\t\tbool isOutside \x3d ISOUTSIDE;\r\n\r\n\t\t// compute miter join position first\r\n\t\tfloat displacementLen \x3d lineWidth;\r\n\t\tVECTYPE displacementDir \x3d normalize(left + right);\r\n\t\tdisplacementDir \x3d PERPENDICULAR(displacementDir);\r\n\t\tif (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\r\n\t\t\tfloat nDotSeg \x3d dot(displacementDir, left);\r\n\t\t\tdisplacementLen /\x3d length(nDotSeg*left - displacementDir);\r\n\r\n\t\t\t// limit displacement of inner vertices\r\n\t\t\tif (!isOutside)\r\n\t\t\t\tdisplacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\r\n\t\t}\r\n\r\n\t\tif (isOutside \x26\x26 (displacementLen \x3e miterLimit*lineWidth)) {\r\n\t\t\t// convert to bevel join if miterLimit is exceeded\r\n\t\t\tif (leftLen \x3c 0.001)\r\n\t\t\t    displacementDir \x3d right;\r\n\t\t\telse if (rightLen \x3c 0.001)\r\n\t\t\t\tdisplacementDir \x3d left;\r\n\t\t\telse\r\n\t\t\t\tdisplacementDir \x3d (abs($uv0.y) - 1.1 \x3c 0.0) ? left : right;\r\n\t\t\tdisplacementDir \x3d normalize(displacementDir);\r\n\t\t\tdisplacementDir \x3d PERPENDICULAR(displacementDir);\r\n\t\t\tdisplacementLen \x3d lineWidth;\r\n\t\t}\r\n\r\n#endif // ifdef WALL\r\n\r\n#ifdef SCREENSCALE\r\n\t\tpos.xy +\x3d displacementDir * floor($uv0.y + 0.5) * displacementLen;\r\n\t\tpos.xy /\x3d screenSize;\r\n#else\r\n\t\tpos.xyz +\x3d displacementDir * floor($uv0.y + 0.5) * displacementLen;\r\n\t\tpos \x3d proj * view * model * pos;\r\n#endif\r\n\r\n\t\tvtc \x3d $uv0;\r\n\t\tvColor \x3d $color * 0.003921568627451; // \x3d 1/255\r\n\t\tgl_Position \x3d pos;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"fsRibbonLine"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n\tuniform vec4 eColor;\r\n\tvarying vec4 vColor;\r\n\tvarying vec2 vtc;\r\n\r\n#ifdef STIPPLE\r\n  uniform float stippleLengthDoubleInv;\r\n#endif\r\n\r\n\tvoid main() {\r\n\r\n#ifdef STIPPLE\r\n    if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\r\n      discard;\r\n    }\r\n#endif\r\n\r\n    gl_FragColor \x3d eColor * vColor;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsRibbonLineHighlight"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n#ifdef STIPPLE\r\n  uniform float stippleLengthDoubleInv;\r\n#endif\r\n\r\n\tvoid main() {\r\n#ifdef STIPPLE\r\n    if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\r\n      discard;\r\n    }\r\n#endif\r\n\r\n\t\tgl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/BlendLayers.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderBlendLayers"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec3 $position;\r\n\tattribute vec2 $uv0;\r\n\r\n\tuniform float scale;\r\n\tuniform vec2 offset;\r\n\r\n\tvarying vec2 uv;\r\n\r\n\tvoid main(void) {\r\n\t\tgl_Position \x3d vec4($position, 1.0);\r\n\t\tuv \x3d $uv0 * scale + offset;;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderBlendLayers"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n\tvarying vec2 uv;\r\n\r\n\tuniform sampler2D tex;\r\n\tuniform float opacity;\r\n\r\n\tvoid main() {\r\n\t\tvec4 color \x3d texture2D(tex, uv);\r\n\r\n    // Note: output in pre-multiplied alpha for correct alpha compositing\r\n\t\tgl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/SimpleGLMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderSimple"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tattribute vec3 $position;\r\n\r\n\tvoid main(void) {\r\n\t\tgl_Position \x3d proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderSimple"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform vec4 color;\r\n\r\n\tvoid main() {\r\n\t\tgl_FragColor \x3d color;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/terrain/TerrainMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsTerrain"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform vec3 origin;\r\n  uniform vec2 texOffset;\r\n  uniform float texScale;\r\n  uniform mat4 viewNormal;\r\n\r\n  attribute vec3 $position;\r\n  attribute vec2 $uv0;\r\n  varying vec2 vtc;\r\n  varying vec3 vpos;\r\n  varying vec3 vnormal;\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n  varying float linearDepth;\r\n#endif\r\n\r\n#if defined(WIREFRAME) || defined(TILE_BORDERS)\r\n  varying vec2 vuv;\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\n  uniform vec3 lightDirection;\r\n  varying vec3 wpos;\r\n  varying vec3 wview;\r\n  varying vec3 wnormal;\r\n  varying vec3 wlight;\r\n#endif\r\n\r\n#ifdef OVERLAY\r\n  uniform vec2 overlayTexOffset;\r\n  uniform vec2 overlayTexScale;\r\n  varying vec2 vtcOverlay;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n\r\n  uniform vec4 screenSizePerspective;\r\n\r\n  varying float screenSizeDistanceToCamera;\r\n  varying float screenSizeCosAngle;\r\n\r\n#endif\r\n\r\n  void main(void) {\r\n    vpos \x3d $position;\r\n\r\n#ifdef SPHERICAL\r\n    vnormal \x3d normalize(vpos + origin);\r\n#else\r\n    vnormal \x3d vec3(0, 0, 1); // WARNING: up-axis dependent code\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\n    wpos \x3d (view * vec4(vpos, 1.0)).xyz;\r\n    wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\r\n    wlight \x3d (view  * vec4(lightDirection, 1.0)).xyz;\r\n#endif\r\n\r\n#if defined(WIREFRAME) || defined(TILE_BORDERS)\r\n    vuv \x3d $uv0;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n\r\n    vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\r\n\r\n    screenSizeDistanceToCamera \x3d length(viewPos);\r\n\r\n    vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\r\n    screenSizeCosAngle \x3d abs(viewSpaceNormal.z);\r\n\r\n#endif\r\n\r\n    gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n    // Shadowmap\'s cascading index used to be based on \'1.0 / gl_FragCoord.w\'\r\n    // (i.e. the perspective interpolation of \'gl_Position.w\'). Precision\r\n    // issues on iPad/iPhone with the \'w\' component require the depth to be\r\n    // passed as varying to properly drive the cascading shadow map index.\r\n    linearDepth \x3d gl_Position.w;\r\n#endif\r\n\r\n    vtc \x3d $uv0*texScale + texOffset;\r\n\r\n#ifdef OVERLAY\r\n    vtcOverlay \x3d $uv0*overlayTexScale + overlayTexOffset;\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsTerrainCommon"\x3e\x3c![CDATA[\r\n  uniform vec3 lightDirection;\r\n  uniform vec3 viewDirection;\r\n  uniform sampler2D depthTex;\r\n  uniform int shadowMapNum;\r\n  uniform vec4 shadowMapDistance;\r\n  uniform mat4 shadowMapMatrix[4];\r\n  uniform float depthHalfPixelSz;\r\n  uniform sampler2D ssaoTex;\r\n  uniform vec4 viewportPixelSz;\r\n  uniform sampler2D tex;\r\n  uniform float opacity;\r\n\r\n  varying vec3 vpos;\r\n  varying vec3 vnormal;\r\n  varying vec2 vtc;\r\n\r\n#if defined(WIREFRAME) || defined(TILE_BORDERS)\r\n  varying vec2 vuv;\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\n  varying vec3 wpos;\r\n  varying vec3 wview;\r\n  varying vec3 wnormal;\r\n  varying vec3 wlight;\r\n#endif\r\n\r\n  $sceneLightingDefinitions\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n  $screenSizePerspective\r\n\r\n  uniform vec4 screenSizePerspective;\r\n\r\n  varying float screenSizeDistanceToCamera;\r\n  varying float screenSizeCosAngle;\r\n#endif\r\n\r\n  const vec3 ambient \x3d vec3(0.2,0.2,0.2);\r\n  const vec3 diffuse \x3d vec3(0.8,0.8,0.8);\r\n  const float diffuseHardness \x3d 2.5;\r\n\r\n#ifdef OVERLAY\r\n  uniform sampler2D overlayTex;\r\n  uniform float overlayOpacity;\r\n  varying vec2 vtcOverlay;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n\tvarying float linearDepth;\r\n\t$evalShadow\r\n#endif\r\n\r\n  float lum(vec3 c) {\r\n    float max \x3d max(max(c.r, c.g), c.b);\r\n    float min \x3d min(min(c.r, c.g), c.b);\r\n    return (min + max) * 0.5;\r\n  }\r\n\r\n#ifdef ATMOSPHERE\r\n  vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\r\n    vec3 surfaceColor   \x3d vec3(0.0);\r\n    vec3 fuzzySpecColor \x3d vec3(1.0);\r\n    vec3 subColor       \x3d vec3(0.0);\r\n    float rollOff       \x3d 1.0;\r\n\r\n    vec3 Ln \x3d normalize(lightPos);\r\n    vec3 Nn \x3d normalize(normal);\r\n    vec3 Hn \x3d normalize(view + Ln);\r\n\r\n    float ldn \x3d dot(Ln, Nn);\r\n    float diffComp \x3d max(0.0, ldn);\r\n    float vdn \x3d 1.0 - dot(view, Nn);\r\n    float ndv \x3d dot(view, Ln);\r\n\r\n    vec3 diffContrib \x3d surfaceColor * diffComp;\r\n    float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\r\n\r\n    vec3 subContrib \x3d subLamb * subColor;\r\n    vec3 vecColor \x3d vec3(vdn);\r\n\r\n    vec3 diffuseContrib \x3d (subContrib + diffContrib);\r\n    vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\r\n\r\n    return (diffContrib + specularContrib) * rollOff;\r\n  }\r\n#endif\r\n\r\n  void main() {\r\n    vec3 a \x3d ambient;\r\n\r\n    float shadow \x3d 0.0;\r\n#ifdef RECEIVE_SHADOWS\r\n    shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n#endif\r\n    float vndl \x3d dot(normalize(vnormal), lightDirection);\r\n    float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\r\n    vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\r\n\r\n    float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n    vec4 texCol \x3d texture2D(tex, vtc);\r\n\r\n#ifdef OVERLAY\r\n    if ((vtcOverlay.x \x3e 0.0) \x26\x26 (vtcOverlay.y \x3e 0.0) \x26\x26 (vtcOverlay.x \x3c 1.0) \x26\x26 (vtcOverlay.y \x3c 1.0)) {\r\n      vec4 overlayTexCol \x3d texture2D(overlayTex, vtcOverlay);\r\n      overlayTexCol *\x3d overlayOpacity;\r\n      texCol \x3d texCol * (1.0 - overlayTexCol.a) + overlayTexCol; // texCol and overlayTexCol have pre-multiplied alpha\r\n    }\r\n#endif\r\n\r\n    vec3 atm \x3d vec3(0.0);\r\n#ifdef ATMOSPHERE\r\n    float ndotl \x3d max(0.0, min(1.0, vndl));\r\n    atm \x3d atmosphere(wlight, wnormal, -viewDirection);\r\n    atm *\x3d max(0.0, min(1.0, (1.0-lum(texCol.rgb)*1.5))); //avoid atmosphere on bright base maps\r\n    atm *\x3d max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\r\n#endif\r\n\r\n    vec3 albedo \x3d atm + texCol.rgb;\r\n    vec3 normal \x3d normalize(vnormal);\r\n\r\n    // heuristic shading function used in the old terrain, now used to add ambient lighting\r\n    float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\r\n\t\tvec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\r\n\r\n    gl_FragColor \x3d vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), texCol.a) * opacity;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n    // This is only used for debug rendering the screenSize perspective\r\n\r\n    float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\r\n\r\n    if (perspectiveScale \x3c\x3d 0.25) {\r\n      gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 0, 1), perspectiveScale * 4.0);\r\n    }\r\n    else if (perspectiveScale \x3c\x3d 0.5) {\r\n      gl_FragColor \x3d mix(gl_FragColor, vec4(0, 0, 1, 1), (perspectiveScale - 0.25) * 4.0);\r\n    }\r\n    else if (perspectiveScale \x3e\x3d 0.99) {\r\n      gl_FragColor \x3d mix(gl_FragColor, vec4(0, 1, 0, 1), 0.2);\r\n    }\r\n    else {\r\n      gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 1, 1), (perspectiveScale - 0.5) * 2.0);\r\n    }\r\n\r\n#endif\r\n\r\n  // closing } is missing here, it\'s in the shaders using this snippet below\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsTerrainWireframe"\x3e\x3c![CDATA[\r\n#ifdef GL_OES_standard_derivatives\r\n#extension GL_OES_standard_derivatives : enable\r\n#endif\r\n\r\n  $fsprecisionf\r\n\r\n  struct WireframeSettings {\r\n    float width;\r\n    float falloff;\r\n    float subdivision;\r\n    vec4 color;\r\n    float wireOpacity;\r\n    float surfaceOpacity;\r\n  };\r\n\r\n  uniform WireframeSettings wireframe;\r\n\r\n    $fsTerrainCommon\r\n\r\n    vec2 vuvScaled \x3d vuv * wireframe.subdivision;\r\n    vec2 vuvMod \x3d fract(vuvScaled);\r\n\r\n#ifdef GL_OES_standard_derivatives\r\n    vec2 dVuv \x3d fwidth(vuvScaled);\r\n    dVuv \x3d max(vec2(0.00001), dVuv); // workaround against flickering skirts, see #10245\r\n#else\r\n    // Something that reasonably works\r\n    vec2 dVuv \x3d vec2(0.05);\r\n#endif\r\n\r\n    vec2 edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\r\n                                  wireframe.width * dVuv, min(vuvMod, 1.0 - vuvMod));\r\n\r\n    float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\r\n\r\n#ifdef WIREFRAME\r\n    gl_FragColor \x3d vec4(mix(gl_FragColor.rgb, wireframe.color.rgb, edgeFactor * wireframe.color.a),\r\n                        mix(wireframe.surfaceOpacity, wireframe.wireOpacity, edgeFactor));\r\n#endif\r\n\r\n\r\n#ifdef TILE_BORDERS\r\n    dVuv \x3d fwidth(vuv);\r\n    edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\r\n                              wireframe.width * dVuv, min(vuv, 1.0 - vuv));\r\n    edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\r\n\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsTerrain"\x3e\x3c![CDATA[\r\n    $fsprecisionf\r\n    $fsTerrainCommon\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsTerrainNormal"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform vec3 origin;\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform mat4 viewNormal;\r\n  attribute vec3 $position;\r\n  varying vec3 vnormal;\r\n\r\n  void main(void) {\r\n#ifdef SPHERICAL\r\n    vec4 normal \x3d vec4(normalize($position + origin), 1.0);\r\n#else\r\n    vec4 normal \x3d vec4(0.0, 1.0, 0.0, 1.0);\r\n#endif\r\n\r\n    gl_Position \x3d proj * view * vec4($position, 1.0);\r\n    vnormal \x3d normalize((viewNormal * normal).xyz);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsTerrainDepthOnly"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n\r\n  attribute vec3 $position;\r\n\r\n  void main() {\r\n    gl_Position \x3d proj * view * vec4($position, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsTerrainDepthOnly"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  void main() {\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsTerrainHighlight"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform vec2 overlayTexScale;\r\n  uniform vec2 overlayTexOffset;\r\n\r\n  attribute vec3 $position;\r\n  attribute vec2 $uv0;\r\n\r\n  varying vec2 vtcOverlay;\r\n\r\n  void main() {\r\n    vtcOverlay \x3d $uv0*overlayTexScale + overlayTexOffset;\r\n\r\n    gl_Position \x3d proj * view * vec4($position, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsTerrainHighlight"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D overlayTex;\r\n\r\n  uniform sampler2D depthTex;\r\n  uniform vec4 highlightViewportPixelSz;\r\n\r\n  varying vec2 vtcOverlay;\r\n\r\n  void main() {\r\n    vec4 texCol \x3d vec4(0,0,0,0);\r\n    if ((vtcOverlay.x \x3e 0.0) \x26\x26 (vtcOverlay.y \x3e 0.0) \x26\x26 (vtcOverlay.x \x3c 1.0) \x26\x26 (vtcOverlay.y \x3c 1.0)) {\r\n      texCol \x3d texture2D(overlayTex, vtcOverlay);\r\n    }\r\n\r\n    if (texCol.a \x3d\x3d 0.0) {\r\n      // Here we have to write black, instead of discarding the fragment in order to overwrite\r\n      // the highlights which might have been written by skirts of other tiles.\r\n      // As a consequence skirts are not visible, but terrain overwrites draped highlights.\r\n      gl_FragColor \x3d vec4(0,0,0,0);\r\n      return;\r\n    }\r\n\r\n    $highlightWrite\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"*now":function(p){p(['dojo/i18n!*preload*jimu/nls/main*["ar","bs","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("./ConfigManager ./LayoutManager ./DataManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query dojo/domReady! esri/config esri/request esri/core/urlUtils esri/identity/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main".split(" "),function(p,h,d,a,g,f,k,m,e,b,l,t,u,r,v,q,n,w,c,x,z,A,y){f={};x.getEsriConfigRequestObject().timeout=18E4;"function"!==typeof b.getAll&&(b.getAll=
function(a){var c=[];(a=b(a))&&c.push(a);return c});window.jimuNls=y;w.setProtocolErrorHandler(function(){return!0});w=x.getAncestorWindow();var B=!1;try{B=0===w.location.href.indexOf("https://")}catch(C){}var E=/\/SceneServer\/layers\/\d+\/?$/;q.setRequestPreCallback(function(a){a&&"object"===typeof a&&!a.content&&E.test(a.url)&&(a.content={f:"json"});a.query&&a.query.printFlag&&(a.timeout=3E5);B&&(a.url=a.url.replace(/^http(s?):\/\//gi,"//"));-1===a.url.indexOf("/queryRelatedRecords?")||x.isHostedService(a.url)||
(a.url=a.url.replace("FeatureServer","MapServer"));return a});k(window,"mousedown",function(a){if(m.isMiddle(a))return a.preventDefault(),a.stopPropagation(),a.returnValue=!1});String.prototype.startWith=function(a){return this.substr(0,a.length)===a?!0:!1};String.prototype.endWith=function(a){return this.substr(this.length-a.length,a.length)===a?!0:!1};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=g.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",
layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="2.8";window.productVersion="Portal for ArcGIS 10.6.1";f.initApp=function(){var b,c;console.log("jimu.js init...");b=window.location.search;if(""===b)b={};else for(c in b=u.queryToObject(b.substr(1)),b)b[c]=x.sanitizeHTML(b[c]);d.getInstance();a.setStyle(jimuConfig.loadingId,"display","none");a.setStyle(jimuConfig.mainPageId,"display","block");c=h.getInstance({mapId:jimuConfig.mapId,
urlParams:b},jimuConfig.layoutId);b=p.getInstance(b);c.startup();b.loadConfig()};return f});