// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./portalUtils esri/config esri/tasks/GeometryService".split(" "),function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r){function u(c,a){var b=l.clone(c),d=t.widgetProperties;"undefined"===typeof a&&(a=!1);delete b.mode;t.visitElement(b,function(c,u){c.widgets?(delete c.isOnScreen,
delete c.gid,"jimu.js/images/group_icon.png"===c.icon&&delete c.icon,delete c.openType,u.isOnScreen&&c.panel&&t.isEqual(c.panel,b.widgetOnScreen.panel)&&delete c.panel):(c.icon&&c.icon===c.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion&&delete c.icon,delete c.panel,delete c.folderUrl,delete c.amdFolder,delete c.thumbnail,delete c.configFile,delete c.gid,delete c.isOnScreen,d.forEach(function(a){delete c[a]}),a?("undefined"===typeof c.openAtStart&&(c.openAtStart=!1),c.config||delete c.config):
(c.visible&&delete c.visible,c.manifest&&c.label===c.manifest.label&&delete c.label,c.isDefaultConfig&&(delete c.config,delete c.isDefaultConfig)),delete c.manifest)});delete b.rawAppConfig;delete b._ssl;delete b.getConfigElementById;delete b.getConfigElementsByName;delete b.getConfigElementByLabel;delete b.processNoUriWidgets;delete b.addElementId;delete b.getCleanConfig;delete b.visitElement;delete b.agolConfig;delete b._itemData;delete b.oldWabVersion;return b}var C=null,E;E=w(null,{urlParams:null,
appConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(c){this.urlParams=c||{};this.listenBuilderEvents();this.versionManager=new k;this.widgetManager=m.getInstance();this.configLoader=p.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&window.parent.setConfigViewerTopic&&l.isFunction(window.parent.setConfigViewerTopic)&&window.parent.setConfigViewerTopic(d);"preview"===this.urlParams.mode&&window.parent.setPreviewViewerTopic&&
l.isFunction(window.parent.setPreviewViewerTopic)&&window.parent.setPreviewViewerTopic(d);q(window,"resize",l.hitch(this,this._onWindowResize))},listenBuilderEvents:function(){d.subscribe("builder/widgetChanged",l.hitch(this,this._onWidgetChanged));d.subscribe("builder/groupChanged",l.hitch(this,this._onGroupChanged));d.subscribe("builder/widgetPoolChanged",l.hitch(this,this._onWidgetPoolChanged));d.subscribe("builder/openAtStartChange",l.hitch(this,this._onOpenAtStartChanged));d.subscribe("builder/sceneViewChanged",
l.hitch(this,this._onSceneViewChanged));d.subscribe("builder/mapOptionsChanged",l.hitch(this,this._onMapOptionsChanged));d.subscribe("builder/appAttributeChanged",l.hitch(this,this._onAppAttributeChanged));d.subscribe("builder/setAppConfig",l.hitch(this,this._onAppConfigSet));d.subscribe("builder/themeChanged",l.hitch(this,this._onThemeChanged));d.subscribe("builder/layoutChanged",l.hitch(this,this._onLayoutChanged));d.subscribe("builder/styleChanged",l.hitch(this,this._onStyleChanged));d.subscribe("builder/syncExtent",
l.hitch(this,this._onSyncExtent));d.subscribe("builder/loadingPageChanged",l.hitch(this,this._onLoadingPageChanged));d.subscribe("builder/templateConfigChanged",l.hitch(this,this._onTemplateConfigChanged));d.subscribe("builder/sharedThemeChanged",l.hitch(this,this._onSharedThemeChanged))},loadConfig:function(){if("preview"!==this.urlParams.mode&&"config"!==this.urlParams.mode)return this.configLoader.loadConfig().then(l.hitch(this,function(c){this.portalSelf=this.configLoader.portalSelf;this.appConfig=
this._addDefaultValues(c);window.appInfo.isRunInMobile=this._isRunInMobile();console.timeEnd("Load Config");c=this.getAppConfig();d.publish("appConfigLoaded",c);return c}),l.hitch(this,function(c){console.error(c);c&&c.message&&"string"===typeof c.message&&this._showErrorMessage(c.message)}))},_showErrorMessage:function(c){a.create("div",{"class":"app-error",innerHTML:t.sanitizeHTML("Unable to create map: "+c)},document.body)},getAppConfig:function(){var c;window.appInfo.isRunInMobile?(c=l.clone(this._getMobileConfig(this.appConfig)),
c._originConfig=l.clone(this.appConfig)):c=l.clone(this.appConfig);c.getConfigElementById=function(c){return t.getConfigElementById(this,c)};c.getConfigElementByLabel=function(c){return t.getConfigElementByLabel(this,c)};c.getConfigElementsByName=function(c){return t.getConfigElementsByName(this,c)};c.getCleanConfig=function(c){return this._originConfig?u(this._originConfig,c):u(this,c)};c.visitElement=function(c){t.visitElement(this,c)};return c},_onWindowResize:function(){var c=this._isRunInMobile();
window.appInfo.isRunInMobile!==c&&(window.appInfo.isRunInMobile=c,this.appConfig&&d.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_isRunInMobile:function(){var c=a.getMarginBox(window.jimuConfig.layoutId);if(c.w<=window.jimuConfig.breakPoints[0]||c.h<=window.jimuConfig.breakPoints[0])return a.addClass(window.jimuConfig.layoutId,"jimu-ismobile"),!0;a.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1},_getMobileConfig:function(c){return t.mixinAppConfigPosition(c,c.mobileLayout)},
_onWidgetChanged:function(c){var a=t.reCreateObject(c);c=t.getConfigElementById(this.appConfig,c.id);!1!==a.inPanel||c.uri||(a.closeable=!0);for(var b in a)c[b]=a[b];delete c.isDefaultConfig;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"widgetChange",a)},_onGroupChanged:function(c){var a=t.reCreateObject(c);c=t.getConfigElementById(this.appConfig,c.id);for(var b in a)c[b]=a[b];this.configLoader.addNeedValues(this.appConfig);
this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"groupChange",a)},_onWidgetPoolChanged:function(c){c=t.reCreateObject(c);if(1===this.widgetManager.getControllerWidgets().length)this.appConfig.widgetPool.widgets=c.widgets,this.appConfig.widgetPool.groups=c.groups;else{var a=t.getConfigElementById(this.appConfig,c.controllerId);f.forEach(a.controlledWidgets,function(c){this._removeWidgetOrGroupFromPoolById(this.appConfig,c)},this);f.forEach(a.controlledGroups,
function(c){this._removeWidgetOrGroupFromPoolById(this.appConfig,c)},this);this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?c.widgets:this.appConfig.widgetPool.widgets.concat(c.widgets);this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?c.groups:this.appConfig.widgetPool.groups.concat(c.groups);this.configLoader.addNeedValues(this.appConfig);a.controlledWidgets=f.map(c.widgets,function(c){return c.id});a.controlledGroups=
f.map(c.groups,function(c){return c.id})}this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",c)},_removeWidgetOrGroupFromPoolById:function(c,a){f.some(c.widgetPool.widgets,function(b,d){if(b.id===a)return c.widgetPool.widgets.splice(d,1),!0});f.some(c.widgetPool.groups,function(b,d){if(b.id===a)return c.widgetPool.groups.splice(d,1),!0})},_onOpenAtStartChanged:function(c){var a=t.reCreateObject(c),
b=this.appConfig;c.isOnScreen?(b=b.widgetOnScreen&&b.widgetOnScreen.widgets)&&0<b.length&&f.forEach(b,l.hitch(this,function(a){a.id===c.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})):((b=b.widgetPool)&&b.groups&&0<b.groups.length&&f.forEach(b.groups,l.hitch(this,function(a){a.id===c.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})),b&&b.widgets&&0<b.widgets.length&&f.forEach(b.widgets,l.hitch(this,function(a){a.id===c.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})));d.publish("appConfigChanged",
this.getAppConfig(),"openAtStartChange",a)},_onAppAttributeChanged:function(c){c=t.reCreateObject(c);l.mixin(this.appConfig,c);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"attributeChange",c)},_onLoadingPageChanged:function(c){c=t.reCreateObject(c);var a;"backgroundColor"in c?this.appConfig.loadingPage.backgroundColor=c.backgroundColor:"backgroundImage"in c?(a=
this.appConfig.loadingPage.backgroundImage||{},this.appConfig.loadingPage.backgroundImage=l.mixin(a,c.backgroundImage)):"loadingGif"in c&&(a=this.appConfig.loadingPage.loadingGif||{},this.appConfig.loadingPage.loadingGif=l.mixin(a,c.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"loadingPageChange",c)},_onTemplateConfigChanged:function(c){c=t.reCreateObject(c);this.appConfig.templateConfig=c;this.configLoader.addNeedValues(this.appConfig);
this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",c)},_onSceneViewChanged:function(c){c=t.reCreateObject(c);c.itemId&&c.itemId!==this.appConfig.map.itemId&&this.appConfig.map.mapOptions&&t.deleteMapOptions(this.appConfig.map.mapOptions);l.mixin(this.appConfig.map,c);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);d.publish("appConfigChanged",this.getAppConfig(),"mapChange",c)},_onMapOptionsChanged:function(c){c=
t.reCreateObject(c);this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});l.mixin(this.appConfig.map.mapOptions,c);d.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",c)},_onThemeChanged:function(c){this._getAppConfigFromTheme(c).then(l.hitch(this,function(a){this.appConfig=a;d.publish("appConfigChanged",this.getAppConfig(),"themeChange",c.getName())}))},_onLayoutChanged:function(c){this.appConfig=t.mixinAppConfigPosition(this.appConfig,c.layoutConfig);this._addDefaultPanelAndPosition(this.appConfig);
d.publish("appConfigChanged",this.getAppConfig(),"layoutChange",c.name)},_onStyleChanged:function(c){this.appConfig.theme.styles=this._genStyles(this.appConfig.theme.styles,c.name);c.isCustom?this.appConfig.theme.customStyles={mainBackgroundColor:c.styleColor}:(delete this.appConfig.theme.customStyles,delete this.appConfig.titleColor,this.appConfig.theme.sharedTheme={isPortalSupport:this.appConfig.theme.sharedTheme.isPortalSupport,useHeader:!1,useLogo:!1});d.publish("appConfigChanged",this.getAppConfig(),
"styleChange",c.name)},_onSharedThemeChanged:function(c){var a=this.appConfig.theme.sharedTheme;c=t.reCreateObject(c);c.useHeader&&!a.useHeader&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},this.appConfig.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor})):console.error("Portal does not support sharedTheme."));
!c.useHeader&&a.useHeader&&(delete this.appConfig.titleColor,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor}));c.useLogo&&!a.useLogo&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",this.appConfig.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link,this._onAppAttributeChanged({logo:this.appConfig.logo,
logoLink:this.appConfig.logoLink})):console.error("Portal does not support sharedTheme."));!c.useLogo&&a.useLogo&&this._onAppAttributeChanged({logo:this.appConfig.logo});l.mixin(a,c);d.publish("appConfigChanged",this.getAppConfig(),"sharedThemeChange",c)},_onSyncExtent:function(c){d.publish("syncExtent",c)},_genStyles:function(c,a){var b=[];b.push(a);f.forEach(c,function(c){0>b.indexOf(c)&&b.push(c)});return b},_getAppConfigFromTheme:function(c){var a=new b,d,u=[],k=this.getAppConfig().getCleanConfig();
k.mode=this.urlParams.mode;f.forEach(k.widgetPool.groups,function(c){delete c.panel},this);if(c.appConfig)d=l.clone(c.appConfig),d.map=k.map,d.map.position=c.appConfig.map.position,this._copyPoolToThemePool(k,d),d.links=k.links,d.title=k.title,d.subtitle=k.subtitle,d.logo=k.logo;else{var m=c.getCurrentLayout(),u=c.getCurrentStyle();d=l.clone(k);m=l.clone(m.layoutConfig);d.widgetOnScreen=m.widgetOnScreen;m.widgetPool&&(f.forEach(m.widgetPool.widgets,function(c){c.isPreconfiguredInTheme=!0}),f.forEach(m.widgetPool.groups,
function(c){c.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(k,m);d.widgetPool=m.widgetPool;m.map&&m.map.position&&(d.map.position=m.map.position);d.mobileLayout=m.mobileLayout;u=this._genStyles(f.map(c.getStyles(),function(c){return c.name}),u.name);d.theme={name:c.getName(),styles:u,version:c.getVersion()};this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(d.theme.sharedTheme={useHeader:!0,useLogo:!0,isPortalSupport:!0},d.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background}):
(d.theme.sharedTheme={useHeader:!1,useLogo:!1,isPortalSupport:!1},d.theme.customStyles={mainBackgroundColor:""});d.titleColor=k.titleColor;d.logoLink=k.logoLink}this.configLoader.addNeedValues(d);this.configLoader.loadWidgetsManifest(d).then(l.hitch(this,function(){this._addDefaultValues(d);a.resolve(d)}));return a},_copyPoolToThemePool:function(c,a){var b=c.widgetPool;a.widgetPool||(a.widgetPool={});c=a.widgetPool;var d=f.filter(c.widgets,function(c){if(c.isPreconfiguredInTheme||!f.some(b.widgets,
function(a){return a.name===c.name}))return!0}),u=f.filter(c.groups,function(c){return c.isPreconfiguredInTheme}),k=f.filter(b.widgets,function(c){return!c.isPreconfiguredInTheme}),m=f.filter(b.groups,function(c){return!c.isPreconfiguredInTheme}),k=this._getPoolWidgetsWithoutDuplicated(k,a.widgetOnScreen.widgets||[]);c.widgets=k.concat(d);c.groups=m.concat(u)},_getPoolWidgetsWithoutDuplicated:function(c,a){for(var b=l.clone(c),d=this.getAppConfig(),u=c.length-1;0<=u;u--)for(var k=a.length-1;0<=k;k--)if(a[k].uri){var f=
a[k].name;f||(f=t.getWidgetNameFromUri(a[k].uri));var m=d.getConfigElementById(c[u].id);c[u]&&c[u].name===f&&!1===m.supportMultiInstance&&(console.log("Widget",c[u].name,"is not copied to new theme because this widget exists in new theme."),b.splice(u,1))}return b},_onAppConfigSet:function(c){c=t.reCreateObject(c);window.appInfo.isRunInMobile=this._isRunInMobile();this.configLoader.processProxy(c);this.configLoader.addNeedValues(c);this._addDefaultValues(c);x.setPortalUrl(c.portalUrl);this.appConfig?
(c.map.itemId&&c.map.itemId!==this.appConfig.map.itemId&&t.deleteMapOptions(c.map.mapOptions),this.appConfig=c,d.publish("appConfigChanged",this.getAppConfig(),"resetConfig",c)):(this.appConfig=c,z.getPortal(c.portalUrl).loadSelfInfo().then(l.hitch(this,function(c){this.portalSelf=c;d.publish("appConfigLoaded",this.getAppConfig())})))},_addDefaultValues:function(c){this._addDefaultPortalUrl(c);this._addDefaultGeometryService(c);this._addDefaultStyle(c);this._addDefaultMap(c);this._addDefaultVisible(c);
this._addDefaultSharedTheme(c);"undefined"===typeof c.widgetOnScreen&&(c.widgetOnScreen={});"undefined"===typeof c.widgetPool&&(c.widgetPool={});this._addDefaultPanelAndPosition(c);this._addDefaultOfWidgetGroup(c);(c.widgetPool.widgets&&0<c.widgetPool.widgets.length&&void 0===c.widgetPool.widgets[0].index||c.widgetPool.groups&&0<c.widgetPool.groups.length&&void 0===c.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(c);return c},_addDefaultPortalUrl:function(c){"undefined"===typeof c.portalUrl&&
(c.portalUrl="http://www.arcgis.com/");c.portalUrl&&"/"!==c.portalUrl.substr(c.portalUrl.length-1)&&(c.portalUrl+="/")},_addDefaultGeometryService:function(c){var a=c&&c.geometryService,a=a&&"string"===typeof a&&l.trim(a)?l.trim(a):this.portalSelf.helperServices.geometry.url;c.geometryService=a;v.geometryService=new r(c.geometryService);t.setGlobalGeometryService(c.geometryService)},_addDefaultStyle:function(c){!c.theme||c.theme.styles&&0!==c.theme.styles.length||(c.theme.styles=["default"])},_addDefaultMap:function(c){c.map.id=
"map";"undefined"===typeof c.map["3D"]&&"undefined"===typeof c.map["2D"]&&(c.map["2D"]=!0);"undefined"===typeof c.map.position&&(c.map.position={left:0,right:0,top:0,bottom:0});"undefined"===typeof c.map.portalUrl&&(c.map.portalUrl=c.portalUrl)},_addDefaultVisible:function(c){t.visitElement(c,function(c){void 0===c.visible&&(c.visible=!0)})},_addDefaultSharedTheme:function(c){c.theme.sharedTheme?("undefined"===typeof c.theme.sharedTheme.useHeader&&(c.theme.sharedTheme.useHeader=!1),"undefined"===
typeof c.theme.sharedTheme.useLogo&&(c.theme.sharedTheme.useLogo=!1)):c.theme.sharedTheme={useHeader:!1,useLogo:!1}},_addDefaultPanelAndPosition:function(c){this._addOnScreenDefaultPanelAndPosition(c);this._addPoolDefaultPanelAndPosition(c)},_addOnScreenDefaultPanelAndPosition:function(c){var a,b;if(c=c.widgetOnScreen){a=c.panel&&c.panel.positionRelativeTo?c.panel.positionRelativeTo:"map";"undefined"===typeof c.panel||"undefined"===typeof c.panel.uri?c.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:a}}:
"undefined"===typeof c.panel.position?c.panel.position={relativeTo:a}:"undefined"===typeof c.panel.position.relativeTo&&(c.panel.position.relativeTo=a);if(c.widgets)for(a=0;a<c.widgets.length;a++)c.widgets[a].position||(c.widgets[a].position={}),c.widgets[a].position.relativeTo||(c.widgets[a].position.relativeTo=c.widgets[a]&&c.widgets[a].positionRelativeTo?c.widgets[a].positionRelativeTo:"map"),!0!==c.widgets[a].inPanel||c.widgets[a].panel||(c.widgets[a].panel=l.clone(c.panel),c.widgets[a].panel.position=
c.widgets[a].position,c.widgets[a].panel.position.relativeTo=c.widgets[a].position.relativeTo);if(c.groups)for(a=0;a<c.groups.length;a++)for(c.groups[a].panel||(c.groups[a].panel=c.panel),c.groups[a].panel&&!c.groups[a].panel.position&&(c.groups[a].panel.position={}),c.groups[a].panel.position.relativeTo||(c.groups[a].panel.position.relativeTo=c.groups[a].panel.positionRelativeTo?c.groups[a].panel.positionRelativeTo:"map"),c.groups[a].widgets||(c.groups[a].widgets=[]),b=0;b<c.groups[a].widgets.length;b++)c.groups[a].widgets[b].panel=
c.groups[a].panel}},_addPoolDefaultPanelAndPosition:function(c){var a,b,d=c.widgetPool;if(d){a=d.panel&&d.panel.positionRelativeTo?d.panel.positionRelativeTo:"map";"undefined"===typeof d.panel||"undefined"===typeof d.panel.uri?d.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:a}}:"undefined"===typeof d.panel.position?d.panel.position={relativeTo:a}:"undefined"===typeof d.panel.position.relativeTo&&(d.panel.position.relativeTo=a);if(d.groups)for(a=0;a<d.groups.length;a++)for(d.groups[a].panel?
d.groups[a].panel.position.relativeTo||(d.groups[a].panel.position.relativeTo=d.groups[a].panel.positionRelativeTo?d.groups[a].panel.positionRelativeTo:"map"):d.groups[a].panel=d.panel,d.groups[a].widgets||(d.groups[a].widgets=[]),b=0;b<d.groups[a].widgets.length;b++)d.groups[a].widgets[b].panel=d.groups[a].panel;if(d.widgets)for(a=0;a<d.widgets.length;a++)!1===d.widgets[a].inPanel?(b=d.widgets[a].positionRelativeTo?d.widgets[a].positionRelativeTo:"map",d.widgets[a].position)?d.widgets[a].position.relativeTo||
(d.widgets[a].position.relativeTo=b):d.widgets[a].position={relativeTo:b}:d.widgets[a].panel||(d.widgets[a].panel=c.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(c){t.visitElement(c,l.hitch(this,function(c,a){c.isOnScreen=a.isOnScreen;c.widgets?(c.gid=c.id,1===c.widgets.length?(c.label||(c.label=c.widgets[0].label?c.widgets[0].label:"Group"),c.icon||(c.icon=c.widgets[0].uri?this._getDefaultIconFromUri(c.widgets[0].uri):"jimu.js/images/group_icon.png")):(c.icon=c.icon?c.icon:"jimu.js/images/group_icon.png",
c.label=c.label?c.label:"Group_"+a.index)):(c.gid=a.groupId,c.uri&&t.processWidgetSetting(c))}))},_getDefaultIconFromUri:function(c){c=c.split("/");c.pop();return c.join("/")+"/images/icon.png"},_addIndexForWidgetPool:function(c){var a=0,b,d;if(c.widgetPool.widgets)for(b=0;b<c.widgetPool.widgets.length;b++)c.widgetPool.widgets[b].index=a,a++;if(c.widgetPool.groups)for(b=0;b<c.widgetPool.groups.length;b++)for(c.widgetPool.groups[b].index=a,a++,d=0;d<c.widgetPool.groups[b].widgets.length;d++)c.widgetPool.groups[b].widgets[d].index=
d}});E.getInstance=function(c){null===C?C=new E(c):c&&(C.urlParams=c);window.getAppConfig=l.hitch(C,C.getAppConfig);return C};return E})},"dojo/_base/html":function(){define("./kernel ../dom ../dom-style ../dom-attr ../dom-prop ../dom-class ../dom-construct ../dom-geometry".split(" "),function(w,l,f,a,d,b,q,t){w.byId=l.byId;w.isDescendant=l.isDescendant;w.setSelectable=l.setSelectable;w.getAttr=a.get;w.setAttr=a.set;w.hasAttr=a.has;w.removeAttr=a.remove;w.getNodeProp=a.getNodeProp;w.attr=function(b,
d,f){return 2==arguments.length?a["string"==typeof d?"get":"set"](b,d):a.set(b,d,f)};w.hasClass=b.contains;w.addClass=b.add;w.removeClass=b.remove;w.toggleClass=b.toggle;w.replaceClass=b.replace;w._toDom=w.toDom=q.toDom;w.place=q.place;w.create=q.create;w.empty=function(a){q.empty(a)};w._destroyElement=w.destroy=function(a){q.destroy(a)};w._getPadExtents=w.getPadExtents=t.getPadExtents;w._getBorderExtents=w.getBorderExtents=t.getBorderExtents;w._getPadBorderExtents=w.getPadBorderExtents=t.getPadBorderExtents;
w._getMarginExtents=w.getMarginExtents=t.getMarginExtents;w._getMarginSize=w.getMarginSize=t.getMarginSize;w._getMarginBox=w.getMarginBox=t.getMarginBox;w.setMarginBox=t.setMarginBox;w._getContentBox=w.getContentBox=t.getContentBox;w.setContentSize=t.setContentSize;w._isBodyLtr=w.isBodyLtr=t.isBodyLtr;w._docScroll=w.docScroll=t.docScroll;w._getIeDocumentElementOffset=w.getIeDocumentElementOffset=t.getIeDocumentElementOffset;w._fixIeBiDiScrollLeft=w.fixIeBiDiScrollLeft=t.fixIeBiDiScrollLeft;w.position=
t.position;w.marginBox=function(a,b){return b?t.setMarginBox(a,b):t.getMarginBox(a)};w.contentBox=function(a,b){return b?t.setContentSize(a,b):t.getContentBox(a)};w.coords=function(a,b){w.deprecated("dojo.coords()","Use dojo.position() or dojo.marginBox().");a=l.byId(a);var d=f.getComputedStyle(a),d=t.getMarginBox(a,d);a=t.position(a,b);d.x=a.x;d.y=a.y;return d};w.getProp=d.get;w.setProp=d.set;w.prop=function(a,b,f){return 2==arguments.length?d["string"==typeof b?"get":"set"](a,b):d.set(a,b,f)};w.getStyle=
f.get;w.setStyle=f.set;w.getComputedStyle=f.getComputedStyle;w.__toPixelValue=w.toPixelValue=f.toPixelValue;w.style=function(a,b,d){switch(arguments.length){case 1:return f.get(a);case 2:return f["string"==typeof b?"get":"set"](a,b)}return f.set(a,b,d)};return w})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/promise/all dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/kernel esri/config esri/core/lang esri/geometry/SpatialReference esri/geometry/Extent esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/support/webMercatorUtils esri/tasks/GeometryService esri/tasks/support/ProjectParameters esri/core/urlUtils esri/request ./shared/utils".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c,D,B,I,G,H,K,J,P,O,L,M,R){function Q(e,n){e=e||"";var h=0,y=[{test:window.File&&window.FileReader&&window.FileList&&window.Blob||!g.file.isEnabledFlash(),failure:[e+"libs/polyfills/fileAPI/FileAPI.js"],callback:function(){h++;h===y.length&&n()}}];for(e=0;e<y.length;e++)testLoad(y[e])}function T(e,g){var n=e.match(/url\([^)]+\)/gi),h,y;if(null===n||""===g)return e;for(h=0;h<n.length;h++)if(y=n[h].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i),4<=y.length){var F=
y[2];g.endWith("/")||(g+="/");e=e.replace(y[1]+F+y[3],y[1]+g+F+y[3])}return e}function A(e,g){var n=Array.isArray(g),h=n&&[]||{};n?(e=e||[],h=h.concat(e),g.forEach(function(g,n){"undefined"===typeof e[n]?h[n]=g:"object"===typeof g?h[n]=A(e[n],g):-1===e.indexOf(g)&&h.push(g)})):(e&&"object"===typeof e&&Object.keys(e).forEach(function(g){h[g]=e[g]}),Object.keys(g).forEach(function(n){h[n]="object"===typeof g[n]&&g[n]?e[n]?A(e[n],g[n]):g[n]:g[n]}));return h}function V(e){var n,h={};n=e.indexOf("/");
e.substring(0,n);n=e.substring(0,e.lastIndexOf("/")+1);h.folderUrl=require(g.getRequireConfig()).toUrl(n);h.amdFolder=n;h.url=h.folderUrl;if(/^http(s)?:\/\//.test(e)||/^\/\//.test(e))h.isRemote=!0;return h}function S(e){e.panels.forEach(function(e){e.uri="panels/"+e.name+"/Panel.js"});e.styles.forEach(function(e){e.uri="styles/"+e.name+"/style.css"});e.layouts.forEach(function(e){e.uri="layouts/"+e.name+"/config.json";e.icon="layouts/"+e.name+"/icon.png";e.RTLIcon="layouts/"+e.name+"/icon_rtl.png"})}
function h(e,g,n){function h(e,g){return w.isArray(e[g.key])?e[g.key][g.index]:e[g.key]}g=function(e){var g=[];e.split("_").forEach(function(e){var n=!1,h;"--"===e.slice(e.length-2)&&(n=!0,e=e.slice(0,e.length-2));h=e.search(/\[[0-9]+\]/);-1===h&&(h=e.length);g.push({key:e.slice(0,h),index:Number(e.slice(h+1,-1)),deleteFlag:n})});return g}(g);for(var y=1;y<g.length-1;y++)if(e=h(e,g[y]),!e)return;if(g[g.length-1].deleteFlag)!0===n&&(w.isArray(e[g[g.length-1].key])?delete e[g[g.length-1].key][g[g.length-
1].index]:delete e[g[g.length-1].key]);else if(w.isArray(e[g[g.length-1].key])){if(void 0===n)return e[g[g.length-1].key][g[g.length-1].index];e[g[g.length-1].key][g[g.length-1].index]=n}else{if(void 0===n)return e[g[g.length-1].key];e[g[g.length-1].key]=n}}function e(e,n,y){function F(h){h=g.template.getSearchRange(n,h,"]");var y=n.slice(h.firstPos,h.lastPos);return-1!==h.firstPos?(y=n.slice(h.firstPos+y.indexOf("[")+1,h.lastPos-1),h=n.slice(h.lastPos+1),(y=g.getConfigElementById(e,y))?{object:y,
key:"section_"+h,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}var A=e,N=n=n.replace(/\//g,"_"),c=F("groups\\[.+\\]");if("deleted"!==c.state&&("isSection"===c.state&&(A=c.object,N=c.key),c=F("widgets\\[.+\\]"),"delete"!==c.state))return"isSection"===c.state&&(A=c.object,N=c.key),h(A,N,y)}var g={},n={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};w.mixin(g,R);window.atob||(window.atob=function(e){e=C.decode(e);for(var g="",n=0,h=e.length;n<
h;n++)g+=String.fromCharCode(e[n]);return g});window.btob||(window.btob=function(e){for(var g=[],n=0,h=e.length;n<h;n++)g.push(String.charCodeAt(e[n]));return C.encode(g)});var y="unload",F=[];require.on("error",function(e){l.forEach(F,function(g){e.info[0]&&-1<e.info[0].indexOf(g.resKey)&&g.def.reject(e);for(var n in e.info)-1<n.indexOf(g.resKey)&&g.def.reject(e)})});g.checkError=function(e,g){F.push({resKey:e,def:g})};g.replacePlaceHolder=function(e,g){var n=x.stringify(e),h=n.match(/\$\{(\w)+\}/g);
if(null===h)return e;for(e=0;e<h.length;e++){var y=h[e].match(/(\w)+/g)[0];g[y]&&(n=n.replace(h[e],g[y]))}return x.parse(n)};g.changeUnit=function(e){var g=Math.abs(e),n;e=Math.floor(g);n=Math.floor(60*(g-e));g=(60*(60*(g-e)-n)).toFixed(2);return e+"\u00b0"+(10>n?"0"+n:n)+"'"+(10>g?"0"+g:g)+'"'};g.formatTime=function(e){var g=e/1E3;e=Math.floor(g/60);g=Number(g-60*e).toFixed(1);return(10>e?"0"+e:e)+":"+(10>g?"0"+g:g)};g.parseTime=function(e){var g=/(\d{2,})\:(\d{2})\.(\d{1})/;if(!g.test(e))return console.log("wrong time format."),
-1;e=e.match(g);return 1E3*(60*parseInt(e[1],10)+parseInt(e[2],10)+parseInt(e[3],10)/10)};g.preloadImg=function(e,g){var n=[],n="string"===typeof e?[e]:e;l.forEach(n,function(e){(new Image).src=g?g+e:e})};var N=null;g.getImagesSize=function(e){var g=new m;if(!e||0!==e.indexOf("http"))return g.reject(),g;null===N&&(N=f.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var n=p(N,"load",function(){clearTimeout(h);h=null;n.remove();var e=f.getContentBox(N);
1===e.w&&1===e.h||0===e.w||0===e.h?g.reject():g.resolve([e.w,e.h])},{}),h=setTimeout(function(){clearTimeout(h);h=null;g.reject()},5E3);f.setAttr(N,"src",e);return g};g.getPositionStyle=function(e){var g={};if(!e)return g;e=w.clone(e);if(window.isRTL){var n;"undefined"!==typeof e.left&&"undefined"!==typeof e.right?(n=e.left,e.left=e.right,e.right=n):"undefined"!==typeof e.left?(e.right=e.left,delete e.left):"undefined"!==typeof e.right&&(e.left=e.right,delete e.right);"undefined"!==typeof e.paddingLeft&&
"undefined"!==typeof e.paddingRight?(n=e.paddingLeft,e.paddingLeft=e.paddingRight,e.paddingRight=n):"undefined"!==typeof e.paddingLeft?(e.paddingRight=e.paddingLeft,delete e.paddingLeft):"undefined"!==typeof e.paddingRight&&(e.paddingLeft=e.paddingRight,delete e.paddingRight);"undefined"!==typeof e.marginLeft&&"undefined"!==typeof e.marginRight?(n=e.marginLeft,e.marginLeft=e.marginRight,e.marginRight=n):"undefined"!==typeof e.marginLeft?(e.marginRight=e.marginLeft,delete e.marginLeft):"undefined"!==
typeof e.marginRight&&(e.marginLeft=e.marginRight,delete e.marginRight)}n="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom margin marginLeft marginRight marginTop marginBottom".split(" ");for(var h=0;h<n.length;h++){var y=n[h];"number"===typeof e[y]?g[y]=e[y]+"px":"undefined"!==typeof e[y]?g[y]=e[y]:"padding"===y.substr(0,7)||"margin"===y.substr(0,7)?g[y]=0:g[y]="auto"}g.zIndex="undefined"===typeof e.zIndex?"auto":e.zIndex;return g};g.isEqual=function(e,
g){function n(e,g){var F;if(null===e&&null===g||"undefined"===typeof e&&"undefined"===typeof g)return!0;if(null===e&&null!==g||null===g&&null!==e||"undefined"===typeof e&&"undefined"!==typeof g||"undefined"===typeof g&&"undefined"!==typeof e)return!1;if(isNaN(e)&&isNaN(g)&&"number"===typeof e&&"number"===typeof g||e===g)return!0;if("function"===typeof e&&"function"===typeof g||e instanceof Date&&g instanceof Date||e instanceof RegExp&&g instanceof RegExp||e instanceof String&&g instanceof String||
e instanceof Number&&g instanceof Number)return e.toString()===g.toString();if(-1<h.indexOf(e)||-1<y.indexOf(g))return!1;if(null!==g){for(F in g)if(g.hasOwnProperty(F)!==e.hasOwnProperty(F)||typeof g[F]!==typeof e[F])return!1;for(F in e){if(g.hasOwnProperty(F)!==e.hasOwnProperty(F)||typeof g[F]!==typeof e[F])return!1;switch(typeof e[F]){case "object":case "function":h.push(e);y.push(g);if(!n(e[F],g[F]))return!1;h.pop();y.pop();break;default:if(e[F]!==g[F])return!1}}}return!0}var h,y;h=[];y=[];return n(e,
g)?!0:!1};g.getUriInfo=V;g.file={loadFileAPI:function(){var e=new m;if("unload"===y){var g=window.isBuilder?"stemapp/":"";window.FileAPI={debug:!1,flash:!0,staticPath:g+"libs/polyfills/fileAPI/",flashUrl:g+"libs/polyfills/fileAPI/FileAPI.flash.swf",flashImageUrl:g+"libs/polyfills/fileAPI/FileAPI.flash.image.swf"};Q(g,w.hitch(this,function(){y="loaded";e.resolve()}));y="loading"}else"loaded"===y&&e.resolve();return e},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&
window.Blob?!0:!1},supportFileAPI:function(){return a("safari")&&6>a("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var e=null;if(document.all)try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(Y){e=null}else navigator.plugins&&0<navigator.plugins.length&&(e=navigator.plugins["Shockwave Flash"]);return!!e},containSeparator:function(e){return 0<=e.indexOf("/")?!0:0<=e.indexOf("\\")?!0:!1},getNameFromPath:function(e){var g="",g=0<=e.indexOf("/")?
"/":"\\";e=e.split(g);return 0<e.length?e[e.length-1]:null},getFolderFromPath:function(e){return e.substr(0,e.length-g.file.getNameFromPath(e).length)},readFile:function(e,g,n,h){if(this.supportHTML5()){var y=e.target.files[0];y&&(y.type.match(g)?y.size>=n?h({errCode:"exceed"}):(e=new FileReader,e.onload=function(e){h(null,y.name,e.target.result)},e.readAsDataURL(y)):h({errCode:"invalidType"}))}else if(this.supportFileAPI()){var F=window.FileAPI.getFiles(e);F[0].type.match(g)?F[0].size>=n?h({errCode:"exceed"}):
window.FileAPI.readAsDataURL(F[0],function(e){e&&e.result?h(null,F[0].name,e.result):h({errCode:"readError"})}):h({errCode:"invalidType"})}}};g.processWidgetSetting=function(e){if(!e.uri)return e;w.mixin(e,V(e.uri));e.icon||(e.icon=e.amdFolder+"images/icon.png");e.thumbnail||(e.thumbnail=e.amdFolder+"images/thumbnail.png");return e};g.getRequireConfig=function(){if(jimuConfig){var e=[];jimuConfig.widgetsPackage&&(e=e.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(e=e.concat(jimuConfig.themesPackage));
jimuConfig.configsPackage&&(e=e.concat(jimuConfig.configsPackage));return{packages:e}}return{}};g.getTypeByGeometryType=function(e){var g="",n="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),h=["esriGeometryRing","esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(e)?g="point":0<=n.indexOf(e)?g="polyline":0<=h.indexOf(e)&&(g="polygon");return g};g.getSymbolTypeByGeometryType=
function(e){var n=null;e=g.getTypeByGeometryType(e);"point"===e?n="marker":"polyline"===e?n="line":"polygon"===e&&(n="fill");return n};g.getServices=function(){return n};g.getArcGISDefaultGeometryService=function(){return new P(n.geometryService)};g.restoreToDefaultWebMapExtent=function(e,n,h){var y=new m;if(!e||"esri.Map"!==e.declaredClass)return setTimeout(function(){y.reject("Invalid map.")},0),y;n=n&&n.itemInfo;if(!n)return setTimeout(function(){y.reject("Invalid itemInfo")},0),y;n=n.item&&n.item.extent;
if(!n)return setTimeout(function(){y.reject("Invalid itemInfo.item.extent")}),y;var F=new B({wkid:4326}),F=new I(n[0][0],n[0][1],n[1][0],n[1][1],F);if(4326===parseInt(e.spatialReference.wkid,10))return e.setExtent(F);if(e.spatialReference.isWebMercator)return F=J.geographicToWebMercator(F),e.setExtent(F);n=new O;n.geometries=[F];n.outSR=e.spatialReference;F=c&&c.defaults&&c.defaults.geometryService;F&&"esri.tasks.GeometryService"===F.declaredClass||(h&&"string"===typeof h&&w.trim(h)?(h=w.trim(h),
F=new P(h)):F=g.getArcGISDefaultGeometryService());F.project(n).then(function(g){if(g=g&&g[0])return e.setExtent(g);y.reject("Invalid projected geometry.");return y},function(e){console.error(e);y.reject(e);return y});return y};g.getAncestorWindow=function(){for(var e=window;e&&e.parent&&e!==e.parent;)e=e.parent;return e};g.getAncestorDom=function(e,g,n){if(e&&1===e.nodeType&&g&&"function"===typeof g){var h=100,y=document.body;n&&("number"===typeof n?(n=parseInt(n,10),0<n&&(h=n)):1===n.nodeType&&
(y=n));for(n=0;e.parentNode&&n<h&&f.isDescendant(e.parentNode,y);){if(g(e.parentNode))return e.parentNode;e=e.parentNode;n++}}return null};g.bindClickAndDblclickEvents=function(e,g,n,h){var y=null;if(e&&1===e.nodeType&&g&&"function"===typeof g&&n&&"function"===typeof n){var F=200;h&&"number"===typeof h&&(h=parseInt(h,10),0<h&&(F=h));var A=0,y=p(e,"click",function(e){A++;1===A?setTimeout(function(){1===A&&(A=0,g(e))},F):2===A&&(A=0,n(e))})}return y};g.isScrollToBottom=function(e){var g=f.getContentBox(e);
return 1>e.scrollHeight-(e.scrollTop+g.h)};g.getAllItemTypes=function(){var e=[],e=e.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service","Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));
return e=e.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer","Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};g.getItemQueryStringByTypes=function(e){var n=
"",h=g.getAllItemTypes();if(e&&0<e.length&&0<e.length){var y="";l.forEach(e,function(g,n){y+=' type:"'+g+'" ';n!==e.length-1&&(y+=" OR ")});n=" ( "+y+" ) ";h=e.concat(h);h=l.filter(h,function(g){return l.every(e,function(e){return 0>e.toLowerCase().indexOf(g.toLowerCase())})});l.forEach(h,function(e){n+=' -type:"'+e+'" '})}return n};g.getItemQueryStringByTypeKeywords=function(e){var g="";e&&0<e.length&&(g=' typekeywords:"'+e.join(",")+'" ');return g};g.isNotEmptyString=function(e,g){var n=e&&"string"===
typeof e;return n?g?n&&w.trim(e):!0:!1};g.isValidNumber=function(e){return"number"===typeof e&&!isNaN(e)};g.isObject=function(e){return e&&"object"===typeof e};g.getRandomString=function(){var e=Math.random().toString();return e=e.slice(2,e.length)};g._getDomainsByServerName=function(e){var g=e.split("."),n=g.length;return l.map(g,w.hitch(this,function(e,h){e=g.slice(h,n);var y="",F=e.length-1;l.forEach(e,w.hitch(this,function(e,g){y+=e;g!==F&&(y+=".")}));return y}))};g.removeCookie=function(e,g){var n=
this._getDomainsByServerName(window.location.hostname);l.forEach(n,w.hitch(this,function(n){z(e,null,{expires:-1,path:g});z(e,null,{expires:-1,path:g,domain:n});z(e,null,{expires:-1,path:g,domain:"."+n})}))};g.isLocaleChanged=function(e,g){return!e.startWith(g)};g.hashToObject=function(e){e=e.replace("#","");e=b.queryToObject(e);for(var g in e)if(e.hasOwnProperty(g))try{e[g]=x.parse(e[g])}catch(W){}return e};g.reCreateObject=function(e){function g(e){var h=[];e.forEach(function(e){Array.isArray(e)?
h.push(g(e)):"object"===typeof e?h.push(n(e)):h.push(e)});return h}function n(e){var h={},y;for(y in e)e.hasOwnProperty(y)&&(null===e[y]?h[y]=null:Array.isArray(e[y])?h[y]=g(e[y]):h[y]="object"===typeof e[y]?n(e[y]):e[y]);return h}return Array.isArray(e)?g(e):n(e)};g.setVerticalCenter=function(e){setTimeout(function(){var g=q(".jimu-vcenter-text",e),n,h;l.forEach(g,function(e){n=f.getContentBox(e).h;f.setStyle(e,{lineHeight:n+"px"})},this);g=q(".jimu-vcenter",e);l.forEach(g,function(e){n=f.getContentBox(e).h;
h=f.getContentBox(q(e).parent()[0]).h;f.setStyle(e,{marginTop:(h-n)/2+"px"})},this)},10)};g.merge=A;g.loadStyleLink=function(e,n,h){var y=new m,F,A=require(g.getRequireConfig()).toUrl(n);if(require.cache["url:"+A]){F=require.cache["url:"+A];var N=A.split("/").pop(),A=A.substr(0,A.length-N.length);F=T(F,A);e=h?f.create("style",{id:e,type:"text/css"},f.byId(h),"before"):f.create("style",{id:e,type:"text/css"},document.getElementsByTagName("head")[0]);e.styleSheet&&!e.sheet?e.styleSheet.cssText=F:e.appendChild(f.toDom(F));
y.resolve("load");return y}F=h?f.create("link",{id:e,rel:"stylesheet",type:"text/css",href:A},f.byId(h),"before"):f.create("link",{id:e,rel:"stylesheet",type:"text/css",href:A},document.getElementsByTagName("head")[0]);p(F,"load",function(){y.resolve("load")});var c=setInterval(function(){var e;if(l.some(document.styleSheets,function(g){if(g.href&&g.href.substr(g.href.indexOf(n),g.href.length)===n)return e=g,!0}))try{!y.isFulfilled()&&(e.cssRules&&e.cssRules.length||e.rules&&e.rules.length)&&y.resolve("load"),
clearInterval(c)}catch(ba){}},50);return y};g.changeLocation=function(e){window.history.pushState&&window.history.pushState({path:e},"",e)};g.urlToObject=function(e){var g=null;-1===e.indexOf("#")?(g=L.urlToObject(e),g.hash=null):(e=e.split("#"),g=L.urlToObject(e[0]),g.hash=e[1]?-1<e[1].indexOf("\x3d")?b.queryToObject(e[1]):e[1]:null);return g};g.addManifestProperies=function(e){e.icon=e.url+"images/icon.png";"theme"===e.category?S(e):("undefined"!==typeof e["2D"]&&(e.support2D=e["2D"]),"undefined"!==
typeof e["3D"]&&(e.support3D=e["3D"]),"undefined"===typeof e["2D"]&&"undefined"===typeof e["3D"]&&(e.support2D=!0),delete e["2D"],delete e["3D"],"undefined"===typeof e.properties&&(e.properties={}),R.processWidgetProperties(e))};g.getUniqueValues=function(e,g){var n=new m;e=e.replace(/\/*$/g,"")+"/generateRenderer";g=x.stringify({type:"uniqueValueDef",uniqueValueFields:[g]});M(e,{query:{classificationDef:g,f:"json"},responseType:"json",callbackParamName:"callback"}).then(w.hitch(this,function(e){var g=
e.data;e=[];(g=g&&g.uniqueValueInfos)&&0<g.length&&(e=l.map(g,w.hitch(this,function(e){return e.value})));n.resolve(e)}),w.hitch(this,function(e){n.reject(e)}));return n};g.combineRadioCheckBoxWithLabel=function(e,n){var h=!1;if(e&&1===e.nodeType&&"input"===e.tagName.toLowerCase()){var y=e.getAttribute("type")||"",y=y.toLowerCase();if("radio"===y||"checkbox"===y)h=!0}y=!1;n&&1===n.nodeType&&"label"===n.tagName.toLowerCase()&&(y=!0);h&&y&&(h=e.getAttribute("id"),h||(h="input_"+g.getRandomString(),
e.setAttribute("id",h)),n.setAttribute("for",h),f.setStyle(n,"cursor","pointer"))};g.convertExtentToPolygon=function(e){var g=e.xmin,n=e.xmax,h=e.ymin,y=e.ymax;return new K({rings:[[[g,y],[n,y],[n,h],[g,h],[g,y]]],spatialReference:e.toJson()})};g.combineGeometries=function(e){function n(e){var g={points:[],spatialReference:e[0].spatialReference.toJson()};l.forEach(e,function(e){g.points=g.points.concat(e.points)});return new G(g)}function h(e){var g={paths:[],spatialReference:e[0].spatialReference.toJson()};
l.forEach(e,function(e){g.paths=g.paths.concat(e.paths)});return new H(g)}function y(e){var n={rings:[],spatialReference:e[0].spatialReference.toJson()};l.forEach(e,function(e){"polygon"===e.type?n.rings=n.rings.concat(e.rings):"extent"===e.type&&(e=g.convertExtentToPolygon(e),n.rings=n.rings.concat(e.rings))});return new K(n)}var F=null;if(e&&0<e.length)if(1===e.length)F=e[0];else{for(var A=null,N=null,c=null,a=null,U=0;U<e.length;U++){A=e[U];switch(A.type){case "point":case "multipoint":a="point";
break;case "polyline":a="polyline";break;case "polygon":case "extent":a="polygon";break;default:return null}if(0===U)c=a;else if(c!==a)return null;if(U!==e.length-1&&(N=e[U+1],!A.spatialReference.equals(N.spatialReference)))return null}"point"===a?F=n(e):"polyline"===a?F=h(e):"polygon"===a&&(F=y(e))}return F};g.isFeaturelayerUrlSupportQuery=function(e,g){var n=!1,h=/\/featureserver\//gi.test(e);e=/\/mapserver\//gi.test(e);g=(g||"").toLowerCase();h?n=0<=g.indexOf("query"):e&&(n=0<=g.indexOf("data"));
return n};g.isImageServiceSupportQuery=function(e){return 0<=(e||"").toLowerCase().indexOf("catalog")};g.isStringEndWith=function(e,g){return e.lastIndexOf(g)+g.length===e.length};g.processManifestLabel=function(e,g){e.label=e.i18nLabels&&(e.i18nLabels[g]||e.i18nLabels.defaultLabel)||e.label||e.name;e.layouts&&l.forEach(e.layouts,function(n){var h="i18nLabels_layout_"+n.name;n.label=e[h]&&(e[h][g]||e[h].defaultLabel)||n.label||n.name});e.styles&&l.forEach(e.styles,function(n){var h="i18nLabels_style_"+
n.name;n.label=e[h]&&(e[h][g]||e[h].defaultLabel)||n.label||n.name})};g.addManifest2WidgetJson=function(e,g){w.mixin(e,g.properties);e.name=g.name;e.label||(e.label=g.label);e.manifest=g};g.widgetJson=function(){var e={addManifest2WidgetJson:function(e,g){w.mixin(e,g.properties);e.name=g.name;e.label||(e.label=g.label);e.manifest=g;e.isRemote=g.isRemote;e.isRemote&&(e.itemId=g.itemId);g.featureActions&&(e.featureActions=g.featureActions);e.icon||(e.icon=g.icon);e.thumbnail||(e.thumbnail=g.thumbnail);
e.folderUrl=g.folderUrl;e.amdFolder=g.amdFolder},removeManifestFromWidgetJson:function(e){if(e.manifest){for(var g in e.manifest.properties)e[g]=void 0;e.name=void 0;e.label=void 0;e.featureActions=void 0;e.manifest=void 0}},getUriFromItem:function(g){return g.url?e.getFolderUrlFromItem(g)+"Widget":null},getFolderUrlFromItem:function(e){if(!e.url)return null;e=/manifest\.json$/.test(e.url)?e.url.substring(0,e.url.length-13):/\/$/.test(e.url)?e.url:e.url+"/";"https:"===window.location.protocol&&(e=
e.replace(/^http:\/\//,"https://"));return e}};return e}();g.addI18NLabel=function(e){var n=new m;if(e.i18nLabels)return n.resolve(e),n;e.i18nLabels={};if(e.properties&&!1===e.properties.hasLocale)return n.resolve(e),n;var h="widget"===e.category?"_widgetLabel":"_themeLabel";require(g.getRequireConfig(),["dojo/i18n!"+e.amdFolder+"nls/strings"],function(g){e.i18nLabels[dojoConfig.locale]=g[h];"theme"===e.category&&(e.layouts&&e.layouts.forEach(function(n){e["i18nLabels_layout_"+n.name]={};e["i18nLabels_layout_"+
n.name][dojoConfig.locale]=g["_layout_"+n.name]}),e.styles&&e.styles.forEach(function(n){e["i18nLabels_style_"+n.name]={};e["i18nLabels_style_"+n.name][dojoConfig.locale]=g["_style_"+n.name]}));n.resolve(e)});return n};g.localizeNumber=function(e,g){var n=(e.toString().split(".")[1]||"").length,h="",h=g&&isFinite(g.places)&&g.places,h=0<h||0<n?"#,###,###,##0.0"+Array.prototype.join.call({length:0<h?h+1:n},"0"):"#,###,###,##0",n={locale:d.locale,pattern:h};w.mixin(n,g||{});try{return v.format(e,n)}catch(X){return console.error(X),
e.toLocaleString()}};g.parseNumber=function(e,g){var n={locale:d.locale};w.mixin(n,g||{});try{return v.parse(e,n)}catch(ca){return console.error(ca),e}};g.localizeDate=function(e,g){var n={locale:d.locale,fullYear:!0};w.mixin(n,g||{});try{return r.format(e,n)}catch(ca){return console.error(ca),"date"===n.selector?e.toLocaleDateString():"time"===n.selector?e.toLocaleTimeString():e.toLocaleString()}};g.localizeNumberByFieldInfo=function(e,n){var h=null,h=w.exists("format.places",n)&&n.format.places,
h=g.localizeNumber(e,{places:h});return w.exists("format.digitSeparator",n)&&!n.format.digitSeparator?h.toString().replace(new RegExp("\\"+u.group,"g"),""):h};g.fieldFormatter={getFormattedUrl:function(e){if(e&&"string"===typeof e){var g=e.indexOf("http:");-1===g&&(g=e.indexOf("https:"));if(-1<g&&-1===e.indexOf("href\x3d")){var n=e.indexOf(" ",g);-1===n&&(n=e.length);var h=e.substring(g,n);e=e.substring(0,g)+'\x3cA href\x3d"'+h+'" target\x3d"_blank"\x3e'+h+"\x3c/A\x3e"+e.substring(n,e.length)}}return e||
""},getFormattedNumber:function(e,n){if("number"===typeof e){var h=(e.toString().split(".")[1]||"").length;e=g.localizeNumberByFieldInfo(e,{format:{places:n&&"number"===typeof n.places?parseInt(n.places,10):h,digitSeparator:n&&n.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+(e||"")+"\x3c/span\x3e"}return e},getFormattedDate:function(e){e&&(e=g.localizeDate(new Date(e),{fullYear:!0}));return e||""},getCodedValue:function(e,g){if(e&&e.codedValues){for(var n=0,h=e.codedValues.length;n<
h;n++){var y=e.codedValues[n];if(D.isDefined(g)&&w.exists("code",y)&&g.toString()===y.code.toString())return y.name}return g}return g||null},getTypeName:function(e,g){for(var n=g.length,h=0;h<n;h++)if(e===g[h].id)return g[h].name;return e}};g.addRelativePathInCss=T;g.url={isAbsolute:function(e){return e?e.startWith("http")||e.startWith("/"):!1},removeQueryParamFromUrl:function(e,g){e=L.urlToObject(e);e.query&&delete e.query[g];g=e.path;for(var n in e.query)g=g===e.path?g+"?"+n+"\x3d"+e.query[n]:g+
"\x26"+n+"\x3d"+e.query[n];return g},addQueryParamToUrl:function(e,g,n){e=L.urlToObject(e);e.query||(e.query={});e.query[g]=n;g=e.path;for(var h in e.query)g=g===e.path?g+"?"+h+"\x3d"+e.query[h]:g+"\x26"+h+"\x3d"+e.query[h];return g}};g.processUrlInWidgetConfig=function(e,g){if(e)return e.startWith("data:")||e.startWith("http")||e.startWith("/")?e:e.startWith("${appPath}")?e.replace("${appPath}",window.appInfo.appPath):g+e};g.processUrlInAppConfig=function(e){if(e)return e.startWith("data:")||e.startWith("http")||
e.startWith("/")?e:window.appInfo.appPath+e};g.getLocationUrlWithoutHashAndQueryParams=function(){var e=window.location,n=e.protocol+"//"+e.host+e.pathname,e=L.urlToObject(e.href);e.query&&e.query.apiurl&&(n=g.url.addQueryParamToUrl(n,"apiurl",e.query.apiurl));return n};g.getDefaultWebMapThumbnail=function(){return require.toUrl("jimu/images/webmap.png")};g.invertColor=function(e){e=e.substring(1);3===e.length&&(e=e.slice(0,1)+e.slice(0,1)+e.slice(1,1)+e.slice(1,1)+e.slice(2,1)+e.slice(2,1));e=parseInt(e,
16);return 7829367<e?"#000000":"#ffffff"};g.mixinAppConfigPosition=function(e,g){e=w.clone(e);if(!g)return e;g=w.clone(g);var n=e.widgetOnScreen,h=g.widgetOnScreen;h&&h.widgets&&("[object Object]"===Object.prototype.toString.call(h.widgets)?l.forEach(n.widgets,function(e,g){g=e.uri?e.uri:"ph_"+g;h.widgets[g]&&h.widgets[g].position&&(h.widgets[g].position.relativeTo||(h.widgets[g].position.relativeTo="map"),e.position=h.widgets[g].position)},this):l.forEach(h.widgets,function(e,g){e.position&&!e.position.relativeTo&&
(e.position.relativeTo="map");n.widgets[g]&&e.position&&(n.widgets[g].position=e.position)}));h&&h.groups&&("[object Object]"===Object.prototype.toString.call(h.groups)?l.forEach(n.groups,function(e,g){g=e.label?e.label:"g_"+g;h.groups[g]&&h.groups[g].panel&&h.groups[g].panel.position&&(h.groups[g].panel.position.relativeTo||(h.groups[g].panel.position.relativeTo="map"),e.panel.position=h.groups[g].panel.position)},this):l.forEach(h.groups,function(e,g){e.panel&&e.panel.position&&!e.panel.position.relativeTo&&
(e.panel.position.relativeTo="map");n.groups[g]&&e.panel.position&&(n.groups[g].panel.position=e.panel.position)}));g.map&&g.map.position&&(e.map?e.map.position=g.map.position:e.map={position:g.map.position});g.widgetPool&&g.widgetPool.panel&&(g.widgetPool.panel.position&&!g.widgetPool.panel.position.relativeTo&&(g.widgetPool.panel.position.relativeTo="map"),e.widgetPool.panel.position=g.widgetPool.panel.position);g.mobileLayout&&(e.mobileLayout=g.mobileLayout);return e};g.template={groupIdentification:"groups\\[.+\\]",
widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(e,g,n){var h=-1;g=e.search(new RegExp(g));0<=g&&(e=e.slice(g,e.length),e=e.indexOf(n),h=g+e+n.length);return{firstPos:g,lastPos:h}},setConfigValue:function(e,g,n){h(e,g,n)},getConfigValue:function(e,g){return h(e,g)},setConfigValueWithId:function(g,n,h){e(g,n,h)},getConfigValueWithId:function(g,n){return e(g,n)},getKeyInfo:function(e){var g=this.getWidgetIdByKey(e);if(null!==g)return{type:"widget",id:g};e=this.getGroupIdByKey(e);return null!==
e?{type:"group",id:e}:{type:"unknow",id:null}},getWidgetIdByKey:function(e){var n=g.template.getSearchRange(e,g.template.widgetIdentification,"]");if(-1===n.firstPos)e=null;else{var h=e.slice(n.firstPos,n.lastPos);e=e.slice(n.firstPos+h.indexOf("[")+1,n.lastPos-1)}return e},getGroupIdByKey:function(e){var n=g.template.getSearchRange(e,g.template.groupIdentification,"]");if(-1===n.firstPos)e=null;else{var h=e.slice(n.firstPos,n.lastPos);e=e.slice(n.firstPos+h.indexOf("[")+1,n.lastPos-1)}return e},
getConfigedWidgetsByTemplateConfig:function(e){var n=[],h=g.template.widgetIdentification+"_config",y;l.forEach(e.configurationSettings,function(e){l.forEach(e.fields,function(e){e.fieldName&&(y=g.template.getSearchRange(e.fieldName,h,"]"),0<=y.firstPos&&(e=g.template.getWidgetIdByKey(e.fieldName),-1===n.indexOf(e)&&n.push(e)))},this)},this);return n},mergeTemplateAppConfigToAppConfig:function(e,n,h){function y(e){var g=[];l.forEach(e,function(e){e&&g.push(e)},this);return g}var F=e.widgetOnScreen,
A=e.portalUrl;n.values.webmap&&(e.map.itemId=n.values.webmap);h&&(e.map.mapOptions&&g.deleteMapOptions(e.map.mapOptions),e.map.portalUrl=A,n.values.app_title||(n.values.app_title=h.title),n.values.app_subtitle||(n.values.app_subtitle=h.snippet));for(var N in n.values)"webmap"!==N&&g.template.setConfigValueWithId(e,N,n.values[N]);e.widgetPool.widgets=y(e.widgetPool.widgets);F.widgets=y(F.widgets);if(e.widgetPool.groups)for(n=0;n<e.widgetPool.groups.length;n++)e.widgetPool.groups[n].widgets=y(e.widgetPool.groups[n].widgets);
if(F.groups)for(n=0;n<F.groups.length;n++)F.groups[n].widgets=y(F.groups[n].widgets);return e}};g.deleteMapOptions=function(e){e&&(delete e.extent,delete e.lods,delete e.center,delete e.scale,delete e.zoom,delete e.maxScale,delete e.maxZoom,delete e.minScale,delete e.minZoom,delete e.initialState)};g.localeIsSame=function(e,g){return e.split("-")[0]===g.split("-")[0]};g.graphicsExtent=function(){return null};g.sanitizeHTML=function(e){return html_sanitize(e,function(e){return e},function(e){return e})};
g.stripHTML=function(e){return e?-1<e.indexOf("\x3c")&&-1<e.indexOf("\x3e")?e.replace(/<(?:.|\s)*?>/g,""):e:e};g.removeSuffixSlashes=function(e){return e.replace(/\/*$/g,"")};g.getBestDisplayAttributes=function(e,n){var h={},y=null,F;for(F in e)y=g.getBestDisplayValue(F,e,n),h[F]=y;return h};g.getBestDisplayValue=function(e,n,h){var y="",F=null;w.isArrayLike(h)?F=g.getFieldInfoByFieldName(h,e):"object"===typeof h&&h.name===e&&(F=h);F&&(y=n[e],"esriFieldTypeDate"===F.type?y&&(e=new Date(parseInt(y,
10)),y=g._tryLocaleDate(e)):"number"===typeof y&&(F.domain&&"codedValue"===F.domain.type?l.some(F.domain.codedValues,function(e){if(e.code===y)return y=e.name,!0}):y=g._tryLocaleNumber(y)));if(null===y||void 0===y)y="";return y};g._tryLocaleNumber=function(e){var n=g.localizeNumber(e);if(null===n||void 0===n)n=e;return n};g._tryLocaleDate=function(e){var n=g.localizeDate(e);n||(n=e.toLocaleDateString());return n};g.getFieldInfoByFieldName=function(e,g){var n=null;e&&0<e.length&&l.some(e,w.hitch(this,
function(e){return e.name===g?(n=e,!0):!1}));return n};g.containsNonLatinCharacter=function(e){for(var g=0;g<e.length;g++)if(255<e.charCodeAt(g))return!0;return!1};g.isVersion4API=function(){return 0===E.version.indexOf("4")};g.getEsriConfig=function(){return c};g.getEsriConfigRequestObject=function(){var e=null;return e=g.isVersion4API()?c.request:c.defaults.io};g.setGlobalGeometryService=function(e){e=new P(e);g.isVersion4API()?c.geometryService=e:c.defaults.geometryService=e;return e};g.getQueryableFeatureLayersFromMap=
function(e){var g=[];e.layers&&(g=e.layers.filter(function(e){return"esri.layers.FeatureLayer"===e.declaredClass&&e.url&&e.supportedQueryFormats&&0<=e.supportedQueryFormats.toUpperCase().indexOf("JSON")}));return g};g.has=function(e){var g=a(e);if(g)return g;if("ie"===e.toLowerCase()){e=0;var n=/MSIE (\d+\.\d+);/.test(navigator.userAgent),h=!!navigator.userAgent.match(/Trident\/7.0/),y=navigator.userAgent.indexOf("rv:11.0");n&&(e=Number(RegExp.$1));-1!==navigator.appVersion.indexOf("MSIE 10")&&(e=
10);h&&-1!==y&&(e=11);return 11===e&&11||g}if("edge"===e.toLowerCase())return navigator.userAgent.split("Edge/")[1]||g};g.isNeedHttpsButNot=function(){var e=navigator.geolocation,g=window.hasOwnProperty("isSecureContext");return(g&&window.isSecureContext||!g&&"https:"===window.location.protocol)&&e?!1:!0};g.isInConfigOrPreviewWindow=function(){var e=!1;try{e=!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(Y){console.log(Y),e=!1}return!!e};g.getAppHref=function(){var e=
"";return e=g.isInConfigOrPreviewWindow()?window.parent.location.href:window.location.href};g.getAppIdFromUrl=function(){var e=!0,n=g.getAppHref();if(-1!==n.indexOf("id\x3d")||-1!==n.indexOf("appid\x3d")||-1!==n.indexOf("apps"))e=!1;if(!0===e)return n;e=this.urlToObject(window.location.href);if(e.query&&(e.query.id||e.query.appid))return e.query.id||e.query.appid;if(window.appInfo){if(window.appInfo.id)return window.appInfo.id;if(window.appInfo.appPath){if(e=window.appInfo.appPath.split("/"),e.length&&
2<e.length)return e[e.length-2]}else console.error("CAN NOT getAppIdFromUrl")}};g.getEditorContentHeight=function(e,g,n){var h=new m;this._content=e;this._dom=g;this._domParam=n;var y=setTimeout(w.hitch(this,function(){clearTimeout(y);y=null;var e=0,g=this._domParam.contentWidth;try{var n=document.createElement("div");n.setAttribute("id","fakeContent");f.setStyle(n,"background-size","contain");n.innerHTML=this._content;this._dom.appendChild(n);if(n){var F=q("img",n);F&&F.length&&F.style({maxWidth:g-
20+"px"});f.setStyle(n,"position","absolute");f.setStyle(n,"width",g+"px");f.setStyle(n,"left","-99999px");f.setStyle(n,"top","-99999px");f.setStyle(n,"visibility","hidden");var A=f.getContentBox(n);A.h&&(e=A.h,e+=this._domParam.contentMarginTop+this._domParam.footerHeight+8)}}catch(la){console.error("can't getEditorContentHeight"+la),e=200}h.resolve(e)}),1500);return h};g.getEditorTextColor=function(e,n){return{name:"dijit.editor.plugins.EditorTextColor",custom:{recordUID:g.getColorRecordName(e),
forceAttr:n}}};g.getEditorBackgroundColor=function(e){return{name:"dijit.editor.plugins.EditorBackgroundColor",custom:{recordUID:g.getColorRecordName(e)}}};g.getColorRecordName=function(e){return"wab_cr_"+(e||"")};g.isEsriDomain=function(e){return/^https?:\/\/(?:[\w\-\_]+\.)+(?:esri|arcgis)\.com/.test(e)};g.b64toBlob=function(e,g,n){g=g||"";n=n||512;e=window.atob(e.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,""));for(var h=[],y=0;y<e.length;y+=n){for(var F=e.slice(y,y+n),A=Array(F.length),N=
0;N<F.length;N++)A[N]=F.charCodeAt(N);F=new Uint8Array(A);h.push(F)}return new Blob(h,{type:g})};g.subtractionArray=function(e,g){for(var n=e.length-1;0<=n;n--)for(var h=e[n],y=g.length-1;0<=y;y--)if(h===g[y]){e.splice(n,1);g.splice(y,1);break}return e};g.resourcesUrlToBlob=function(e){return M({url:e,handleAs:"blob"})};g.processItemResourceOfAppConfig=function(e,g){function n(e){var g=e.obj,n=e.key,h={obj:g,key:n};"number"===typeof e.i?(h.i=e.i,h.value=g[n][e.i]):h.value=g[n];return h}function h(e){for(var g in e)if("object"===
typeof e[g])if(Array.isArray(e[g]))for(var n=e,F=g,A=0;A<n[F].length;A++)"string"===typeof n[F][A]?y(n,F,A):"object"===typeof n[F][A]&&h(n[F][A]);else h(e[g]);else"string"===typeof e[g]&&y(e,g)}function y(e,h,y){"number"===typeof y?g.test(e[h][y])&&(N=g.func(n({obj:e,key:h,i:y})),"function"===typeof N.then?A.push(N):F.push(N)):g.test(e[h])&&(N=g.func(n({obj:e,key:h})),"function"===typeof N.then?A.push(N):F.push(N))}var F=[],A=[],N;h(e);return 0<A.length?k(A).then(function(g){0<F.length&&(g=g.concat(F));
return{appConfig:e,result:g}}):{appConfig:e,result:F}};return g})},"dojo/NodeList-traverse":function(){define(["./query","./_base/lang","./_base/array"],function(w,l,f){var a=w.NodeList;l.extend(a,{_buildArrayFromCallback:function(a){for(var b=[],d=0;d<this.length;d++){var f=a.call(this[d],this[d],b);f&&(b=b.concat(f))}return b},_getUniqueAsNodeList:function(a){for(var b=[],d=0,t;t=a[d];d++)1==t.nodeType&&-1==f.indexOf(b,t)&&b.push(t);return this._wrap(b,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(a,
b){a=this._getUniqueAsNodeList(a);a=b?w._filterResult(a,b):a;return a._stash(this)},_getRelatedUniqueNodes:function(a,b){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(b),a)},children:function(a){return this._getRelatedUniqueNodes(a,function(a,d){return l._toArray(a.childNodes)})},closest:function(a,b){return this._getRelatedUniqueNodes(null,function(d,f){do if(w._filterResult([d],a,b).length)return d;while(d!=b&&(d=d.parentNode)&&1==d.nodeType);return null})},parent:function(a){return this._getRelatedUniqueNodes(a,
function(a,d){return a.parentNode})},parents:function(a){return this._getRelatedUniqueNodes(a,function(a,d){for(d=[];a.parentNode;)a=a.parentNode,d.push(a);return d})},siblings:function(a){return this._getRelatedUniqueNodes(a,function(a,d){d=[];for(var b=a.parentNode&&a.parentNode.childNodes,f=0;f<b.length;f++)b[f]!=a&&d.push(b[f]);return d})},next:function(a){return this._getRelatedUniqueNodes(a,function(a,d){for(a=a.nextSibling;a&&1!=a.nodeType;)a=a.nextSibling;return a})},nextAll:function(a){return this._getRelatedUniqueNodes(a,
function(a,d){for(d=[];a=a.nextSibling;)1==a.nodeType&&d.push(a);return d})},prev:function(a){return this._getRelatedUniqueNodes(a,function(a,d){for(a=a.previousSibling;a&&1!=a.nodeType;)a=a.previousSibling;return a})},prevAll:function(a){return this._getRelatedUniqueNodes(a,function(a,d){for(d=[];a=a.previousSibling;)1==a.nodeType&&d.push(a);return d})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?
[this[this.length-1]]:[],this)},even:function(){return this.filter(function(a,b){return 0!=b%2})},odd:function(){return this.filter(function(a,b){return 0==b%2})}});return a})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],function(w){w=w.getObject("dojox.encoding.base64",!0);w.encode=function(l){for(var f=[],a=l.length,d=a%3,a=a-d,b=0;b<a;){var q=l[b++]<<16|l[b++]<<8|l[b++];f.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>18&63));f.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>
12&63));f.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>6&63));f.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q&63))}switch(d){case 2:q=l[b++]<<16|l[b++]<<8;f.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>18&63));f.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>12&63));f.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>6&
63));f.push("\x3d");break;case 1:q=l[b++]<<16,f.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>18&63)),f.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(q>>>12&63)),f.push("\x3d"),f.push("\x3d")}return f.join("")};w.decode=function(l){l=l.split("");for(var f=[],a=l.length;"\x3d"==l[--a];);for(var d=0;d<a;){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(l[d++])<<18;d<=a&&(b|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(l[d++])<<
12);d<=a&&(b|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(l[d++])<<6);d<=a&&(b|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(l[d++]));f.push(b>>>16&255);f.push(b>>>8&255);f.push(b&255)}for(;0==f[f.length-1];)f.pop();return f};return w})},"jimu/shared/utils":function(){define(["./basePortalUrlUtils"],function(w){function l(a,b){function d(b,d){var k,f,m,q,v="widgetOnScreen"===b;if(a[b]){if(a[b].groups)for(k=0;k<a[b].groups.length;k++)if(m=
a[b].groups[k],d(m,{index:k,isWidget:!1,groupId:m.id,isThemeWidget:!1,isOnScreen:v}),a[b].groups[k].widgets)for(f=0;f<a[b].groups[k].widgets.length;f++)q=a[b].groups[k].widgets[f],d(q,{index:f,isWidget:!0,groupId:m.id,isThemeWidget:q.uri&&-1<q.uri.indexOf("themes/"+a.theme.name),isOnScreen:v});if(a[b].widgets)for(k=0;k<a[b].widgets.length;k++)q=a[b].widgets[k],d(a[b].widgets[k],{index:k,isWidget:!0,groupId:b,isThemeWidget:q.uri&&-1<q.uri.indexOf("themes/"+a.theme.name),isOnScreen:v})}}d("widgetOnScreen",
b);d("widgetPool",b)}var f={},a="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwitched isController hasVersionManager isThemeWidget supportMultiInstance".split(" ");f.visitElement=l;f.getConfigElementById=function(a,b){var d;if("map"===b)return a.map;l(a,function(a){if(a.id===b)return d=a,!0});return d};f.getConfigElementByLabel=function(a,b){var d;if("map"===b)return a.map;l(a,function(a){if(a.label||a.name===b)return d=
a,!0});return d};f.getConfigElementsByName=function(a,b){var d=[];if("map"===b)return[a.map];l(a,function(a){a.name===b&&d.push(a)});return d};f.getWidgetNameFromUri=function(a){a=a.split("/");a.pop();return a.pop()};f.getAmdFolderFromUri=function(a){a=a.split("/");a.pop();return a.join("/")+"/"};f.widgetProperties=a;f.processWidgetProperties=function(d){"undefined"===typeof d.properties.isController&&(d.properties.isController=!1);"undefined"===typeof d.properties.isThemeWidget&&(d.properties.isThemeWidget=
!1);"undefined"===typeof d.properties.hasVersionManager&&(d.properties.hasVersionManager=!1);a.forEach(function(a){"undefined"===typeof d.properties[a]&&(d.properties[a]=!0)})};f.getControllerWidgets=function(a){var b=[];a.visitElement(function(a){a.isController&&b.push(a)});return b};f.isHostedService=function(a){var b=w.getServerByUrl(a);return(new RegExp(b+"/[^/]+/[^/]+/rest/services","gi")).test(a)};return f})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var w={declaredClass:"jimu.shared.basePortalUrlUtils"};
"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=function(l){return this.substr(0,l.length)===l});"function"!==typeof String.prototype.endWith&&(String.prototype.endWith=function(l){return this.substr(this.length-l.length,l.length)===l});w.getServerByUrl=function(l){l=(l||"").trim();l=l.replace(/^(http(s?):?)\/\//gi,"");0===l.indexOf("//")&&
(l=l.slice(2));return l.split("/")[0]};w.getServerWithProtocol=function(l){var f="";if(l=(l||"").trim()){var a=w.getServerByUrl(l);if(!a)return f;var d=w.getProtocol(l);d?f=d+"://"+a:0===l.indexOf("//")&&(f="//"+a)}return f};w.isSameServer=function(l,f){l=w.getServerByUrl(l)||"";f=w.getServerByUrl(f)||"";return l.toLowerCase()===f.toLowerCase()};w.isOnline=function(l){return 0<=w.getServerByUrl(l).toLowerCase().indexOf(".arcgis.com")};w.isArcGIScom=function(l){l=w.getServerByUrl(l).toLowerCase();
return"www.arcgis.com"===l||"arcgis.com"===l};w.getStandardPortalUrl=function(l){var f=w.getServerByUrl(l);if(""===f)return"";w.isOnline(f)?(w.isArcGIScom(f)&&(f="www.arcgis.com"),l=w.addProtocol(l),l=w.getProtocol(l)+"://"+f):(l=(l||"").trim().replace(/sharing(.*)/gi,"").replace(/\/*$/g,""),l=w.addProtocol(l),l.replace(new RegExp("http(s?)://"+f,"g"),"")||(l+="/arcgis"));return l};w.isSamePortalUrl=function(l,f){var a=/^http(s?):\/\//gi,d=/^\/\//gi;l=w.getStandardPortalUrl(l).toLowerCase().replace(a,
"").replace(d,"");f=w.getStandardPortalUrl(f).toLowerCase().replace(a,"").replace(d,"");return l===f};w.addProtocol=function(l){if(-1>=l.toLowerCase().indexOf("http://")&&-1>=l.toLowerCase().indexOf("https://")){var f="";"undefined"!==typeof window&&window.location?(f=window.location.protocol,l=l.startWith("//")?f+l:l.startWith("/")?f+"//"+window.location.host+l:f+"//"+l):(f="http:",l.startWith("//")&&(l=f+l))}return l};w.getProtocol=function(l){var f="";l=l.toLowerCase();0===l.indexOf("https://")?
f="https":0===l.indexOf("http://")&&(f="http");return f};w.updateUrlProtocolByOtherUrl=function(l,f){f=f.toLowerCase();0===f.indexOf("https://")?l=w.setHttpsProtocol(l):0===f.indexOf("http://")&&(l=w.setHttpProtocol(l));return l};w.removeProtocol=function(l){return l.replace(/^http(s?):\/\//i,"//")};w.setHttpProtocol=function(l){l=w.addProtocol(l);return l.replace(/^https:\/\//,"http://")};w.setHttpsProtocol=function(l){l=w.addProtocol(l);return l.replace(/^http:\/\//,"https://")};w.setProtocol=function(l,
f){return 0<=f.indexOf("https")?w.setHttpsProtocol(l):0<=f.indexOf("http")?w.setHttpProtocol(l):l};w.getSharingUrl=function(l){var f="";(l=w.getStandardPortalUrl(l))&&(f=l+"/sharing");return f};w.getOAuth2Url=function(l){var f="";(l=w.getStandardPortalUrl(l))&&(f=l+"/sharing/oauth2");return f};w.getAppIdUrl=function(l,f){var a="";(l=w.getStandardPortalUrl(l))&&(a=l+"/sharing/oauth2/apps/"+f);return a};w.getSignInUrl=function(l){var f="";(l=w.getStandardPortalUrl(l))&&(f=l+"/home/signin.html");return f};
w.getBaseSearchUrl=function(l){var f="";l=w.getStandardPortalUrl(l);(l=l.replace(/\/*$/g,""))&&(f=l+"/sharing/rest/search");return f};w.getBaseItemUrl=function(l){var f="";(l=w.getStandardPortalUrl(l))&&(f=l+"/sharing/rest/content/items");return f};w.getItemUrl=function(l,f){var a="";(l=w.getBaseItemUrl(l))&&f&&(a=l+"/"+f);return a};w.getItemDataUrl=function(l,f){var a="";(l=w.getItemUrl(l,f))&&(a=l+"/data");return a};w.getGenerateTokenUrl=function(l){var f="";l&&(l=w.getStandardPortalUrl(l),f=l+
"/sharing/generateToken");return f};w.getItemDetailsPageUrl=function(l,f){var a="";l&&f&&(l=w.getStandardPortalUrl(l),a=l+"/home/item.html?id\x3d"+f);return a};w.getUserProfilePageUrl=function(l,f){var a="";l&&f&&(l=w.getStandardPortalUrl(l),a=l+"/home/user.html?user\x3d"+f);return a};w.getBaseGroupUrl=function(l){var f="";(l=w.getStandardPortalUrl(l))&&(f=l+"/sharing/rest/community/groups");return f};w.getPortalSelfInfoUrl=function(l){var f="";(l=w.getStandardPortalUrl(l||""))&&(f=l+"/sharing/portals/self");
return f};w.getCommunitySelfUrl=function(l){var f="";(l=w.getStandardPortalUrl(l||""))&&(f=l+"/sharing/rest/community/self");return f};w.getBaseUserUrl=function(l){var f="";(l=w.getStandardPortalUrl(l))&&(f=l+"/sharing/rest/community/users");return f};w.getUserUrl=function(l,f){var a="",d=w.getBaseUserUrl(l);l&&f&&(a=d+"/"+f);return a};w.getUserTagsUrl=function(l,f){var a="",d=w.getUserUrl(l,f);l&&f&&(a=d+"/tags");return a};w.getUserThumbnailUrl=function(l,f,a){var d="";(l=w.getUserUrl(l,f))&&a&&
(d=l+"/info/"+a);return d};w.getContentUrl=function(l){var f="";l&&(l=w.getStandardPortalUrl(l),f=l+"/sharing/rest/content");return f};w.getUserContentUrl=function(l,f,a){var d="",d="";l&&f&&(d=w.getContentUrl(l),d=a?d+"/users/"+f+"/"+a:d+"/users/"+f);return d};w.getUserContentItemUrl=function(l,f,a){var d="",d="";l&&f&&a&&(d=w.getUserContentUrl(l,f),d=d+"/items/"+a);return d};w.getItemResourceUrl=function(l,f,a){var d="",d="";l&&f&&(d=w.getContentUrl(l),d=a?d+"/items/"+f+"/resources/"+a:d+"/items/"+
f+"/resources");return d};w.getAddItemUrl=function(l,f,a){var d="",d="";l&&f&&(d=w.getUserContentUrl(l,f,a),d+="/addItem");return d};w.getDeleteItemUrl=function(l,f,a){var d="";(l=w.getUserItemsUrl(l,f))&&(d=l+"/"+a+"/delete");return d};w.getUserItemsUrl=function(l,f,a){var d="",d="";l&&f&&(d=w.getUserContentUrl(l,f,a),d+="/items");return d};w.getUpdateItemUrl=function(l,f,a,d){var b="",b="";l&&f&&(b=w.getUserItemsUrl(l,f,d),b=b+"/"+a+"/update");return b};w.shareItemUrl=function(l,f,a,d){var b="",
b="";l&&f&&(b=w.getUserItemsUrl(l,f,d),b=b+"/"+a+"/share");return b};w.getHomeIndexUrl=function(l){var f="";(l=w.getStandardPortalUrl(l))&&(f=l+"/home/index.html");return f};w.getHomeMapViewerUrl=function(l,f){var a="";if(l=w.getStandardPortalUrl(l))a=l+"/home/webmap/viewer.html",a=f?a+("?webmap\x3d"+f):a+"?useExisting\x3d1";return a};w.getHomeGalleryUrl=function(l){var f="";(l=w.getStandardPortalUrl(l))&&(f=l+"/home/gallery.html");return f};w.getHomeGroupsUrl=function(l){var f="";(l=w.getStandardPortalUrl(l))&&
(f=l+"/home/groups.html");return f};w.getHomeMyContentUrl=function(l){var f="";(l=w.getStandardPortalUrl(l))&&(f=l+"/home/content.html");return f};w.getHomeMyOrganizationUrl=function(l){var f="";(l=w.getStandardPortalUrl(l))&&(f=l+"/home/organization.html");return f};w.getHomeUserUrl=function(l){var f="";(l=w.getStandardPortalUrl(l))&&(f=l+"/home/user.html");return f};w.getPortalHelpUrl=function(l,f){var a="";(l=w.getStandardPortalUrl(l))&&(a=l+"/portalhelp/"+(f||"en")+"/website/help/");return a};
w.getPortalAdminHelpUrl=function(l,f){var a="";(l=w.getStandardPortalUrl(l))&&(a=l+"/portalhelp/"+(f||"en")+"/admin/help/");return a};w.getPortalProxyUrl=function(l){var f="";(l=w.getStandardPortalUrl(l))&&(f=l+"/sharing/proxy");return f};w.getOAuth2SignOutUrl=function(l){var f="";(l=w.getStandardPortalUrl(l))&&(f=l+"/sharing/oauth2/signout");return f};w.getNewPrintUrl=function(l){var f="";if(l=w.getStandardPortalUrl(l))l=w.setHttpProtocol(l),f=l+"/sharing/tools/newPrint";return f};return w})},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all ./utils jimu/tokenUtils ./dijit/Message".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u){var C=null,E=w(q,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;window.isBuilder?(b.subscribe("app/sceneViewLoaded",l.hitch(this,this._onSceneViewLoaded)),b.subscribe("app/sceneViewChanged",l.hitch(this,this._onSceneViewChanged))):(b.subscribe("sceneViewLoaded",l.hitch(this,this._onSceneViewLoaded)),b.subscribe("sceneViewChanged",l.hitch(this,this._onSceneViewChanged)));window.isBuilder?(b.subscribe("app/appConfigLoaded",
l.hitch(this,this._onAppConfigLoaded)),b.subscribe("app/appConfigChanged",l.hitch(this,this._onAppConfigChanged))):(b.subscribe("appConfigLoaded",l.hitch(this,this._onAppConfigLoaded)),b.subscribe("appConfigChanged",l.hitch(this,this._onAppConfigChanged)));b.subscribe("userSignIn",l.hitch(this,this._onUserSignIn));b.subscribe("userSignOut",l.hitch(this,this._onUserSignOut));b.subscribe("builder/actionTriggered",l.hitch(this,this._onActionTriggered));b.subscribe("/dnd/move/start",l.hitch(this,this._onMoveStart))},
loadWidget:function(c){var a=new d,f;c=l.clone(c);c.folderUrl||v.processWidgetSetting(c);(f=this.getWidgetById(c.id))?a.resolve(f):z([this.loadWidgetClass(c),this.loadWidgetManifest(c)]).then(l.hitch(this,function(c){var d=c[0],f=c[1];this.loadWidgetResources(f).then(l.hitch(this,function(c){try{var k=this.createWidget(f,d,c);console.log("widget ["+f.uri+"] created.")}catch(P){console.log("create ["+f.uri+"] error:"+P.stack),new u({message:window.jimuNls.createWidgetError+": "+f.uri}),a.reject(P)}setTimeout(l.hitch(this,
function(){a.resolve(k);this.emit("widget-created",k);b.publish("widgetCreated",k)}),50)}),function(c){a.reject(c)})}),function(c){a.reject(c)});return a},loadWidgetClass:function(c){var a=new d,b;b=c.isRemote?c.uri+".js":c.uri;require(v.getRequireConfig(),[b],l.hitch(this,function(c){a.resolve(c)}));v.checkError(c.uri,a);return a},loadWidgetResources:function(c){var a=new d,b,u,f,k=[];f=l.clone(c);c=this.tryLoadWidgetConfig(f);b=this._tryLoadResource(f,"i18n");u=this._tryLoadResource(f,"style");
f=this._tryLoadResource(f,"template");k.push(c);k.push(b);k.push(f);k.push(u);z(k).then(l.hitch(this,function(c){var b={};b.config=c[0];b.i18n=c[1];b.template=c[2];b.style=c[3];a.resolve(b)}),function(c){a.reject(c)});return a},loadWidgetManifest:function(c){var a=new d,b=v.getUriInfo(c.uri),b=b.isRemote?b.folderUrl+"manifest.json?f\x3djson":b.folderUrl+"manifest.json";if(c.manifest)return a.resolve(c),a;x(b,{handleAs:"json",headers:{"X-Requested-With":null}}).then(l.hitch(this,function(b){if(b.error&&
b.error.code)return a.reject(b.error);b.amdFolder=c.amdFolder;b.category="widget";c.label?(this._processManifest(b),v.addManifest2WidgetJson(c,b),a.resolve(c)):v.addI18NLabel(b).then(l.hitch(this,function(){this._processManifest(b);v.addManifest2WidgetJson(c,b);a.resolve(c)}))}),function(c){a.reject(c)});return a},getWidgetMarginBox:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return{};if(c._marginBox)return c._marginBox;c.setPosition({left:-9999,top:-9999,relativeTo:c.position.relativeTo});
this.openWidget(c);c._marginBox=c.getMarginBox();this.closeWidget(c);return c._marginBox},_processManifest:function(c){v.addManifestProperies(c);v.processManifestLabel(c,window.dojoConfig.locale)},createWidget:function(c,a,b){if(this.getWidgetById(c.id))return this.getWidgetById(c.id);b.config&&b.i18n&&(b.config=v.replacePlaceHolder(b.config,b.i18n));c.rawConfig=c.config;c.config=b.config||{};this.appConfig._appData&&this._mergeAgolConfig(c);c.nls=b.i18n||{};b.template&&(c.templateString=b.template);
c["class"]="jimu-widget";c.label||(c.label=c.name);c.sceneView=this.sceneView;c.appConfig=this.appConfig;b={};for(var d in c)c.hasOwnProperty(d)&&(b[d]=c[d]);b.widgetManager=this;c=new a(b);c.clazz=a;m.after(c,"startup",l.hitch(this,this._postWidgetStartup,c));m.before(c,"destroy",l.hitch(this,this._onDestroyWidget,c));t(c.domNode,"click",l.hitch(this,this._onClickWidget,c));this.loaded.push(c);return c},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var c=f.map(this.loaded,
function(c){return c.id});f.forEach(c,function(c){this.destroyWidget(c)},this);this.loaded=[]},loadWidgetSettingPage:function(c){var a=new d;c=l.clone(c);c.id+="_setting";z([this.loadWidgetSettingClass(c)]).then(l.hitch(this,function(b){var d=b[0];this.loadWidgetSettingPageResources(c).then(l.hitch(this,function(b){var f;b={nls:b.i18n,templateString:b.template,appConfig:this.appConfig,sceneView:this.sceneView,"class":"jimu-widget-setting"};for(var k in c)c.hasOwnProperty(k)&&(b[k]=c[k]);try{f=new d(b),
m.before(f,"destroy",l.hitch(this,this._onDestroyWidgetSetting,f)),a.resolve(f)}catch(J){new u({message:window.jimuNls.createWidgetSettingError+":"+c.uri}),a.reject(J)}}),function(c){console.log(c)})}),function(c){a.reject(c)});return a},loadWidgetSettingClass:function(c){var a=new d;require(v.getRequireConfig(),[url],l.hitch(this,function(c){a.resolve(c)}));v.checkError(c.folderUrl+"setting/Setting.js",a);return a},loadWidgetSettingPageResources:function(c){var a=new d,b,u,f=[];c=l.clone(c);b=this._tryLoadResource(c,
"settingI18n");u=this._tryLoadResource(c,"settingTemplate");c=this._tryLoadResource(c,"settingStyle");f.push(b);f.push(u);f.push(c);z(f).then(l.hitch(this,function(c){var b={};b.i18n=c[0]||{};b.template=c[1];b.style=c[2];a.resolve(b)}),function(c){console.log(c)});return a},getWidgetById:function(c){var a;f.some(this.loaded,function(b){if(b.id===c)return a=b,!0},this);return a},getWidgetByLabel:function(c){var a;f.some(this.loaded,function(b){if(b.label===c)return a=b,!0},this);return a},getWidgetsByName:function(c){var a=
[];f.some(this.loaded,function(b){b.name===c&&a.push(b)},this);return a},changeWindowStateTo:function(c,a){"normal"===a?this.normalizeWidget(c):"minimized"===a?this.minimizeWidget(c):"maximized"===a?this.maximizeWidget(c):console.log("error state: "+a)},closeWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;if("closed"!==c.state){this.activeWidget&&this.activeWidget.id===c.id&&(this.activeWidget.onDeActive(),this.activeWidget=null);a.setStyle(c.domNode,"display","none");
c.setState("closed");try{c.onClose()}catch(D){console.log(console.error("fail to close widget "+c.name+". "+D.stack))}}},openWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;if(!c.started)try{c.started=!0,c.startup()}catch(D){console.error("fail to startup widget "+c.name+". "+D.stack)}if("closed"===c.state){a.setStyle(c.domNode,"display","");c.setState("opened");try{c.onOpen()}catch(D){console.error("fail to open widget "+c.name+". "+D.stack)}}},activateWidget:function(c){if("string"===
typeof c&&(c=this.getWidgetById(c),!c))return;"opened"===c.state&&this._activeWidget(c)},maximizeWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;"closed"===c.state&&this.openWidget(c);c.setWindowState("maximized");try{c.onMaximize()}catch(D){console.log(console.error("fail to maximize widget "+c.name+". "+D.stack))}},minimizeWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;"closed"===c.state&&this.openWidget(c);c.setWindowState("minimized");
try{c.onMinimize()}catch(D){console.log(console.error("fail to minimize widget "+c.name+". "+D.stack))}},normalizeWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;"closed"===c.state&&this.openWidget(c);c.setWindowState("normal");try{c.onNormalize()}catch(D){console.log(console.error("fail to normalize widget "+c.name+". "+D.stack))}},destroyWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;this._removeWidget(c);try{c.destroy()}catch(D){console.log(console.error("fail to destroy widget "+
c.name+". "+D.stack))}},tryLoadWidgetConfig:function(c){return this._tryLoadWidgetConfig(c).then(l.hitch(this,function(a){return this._upgradeWidgetConfig(c,a).then(function(a){return c.config=a})}))},triggerWidgetOpen:function(c){function a(c){var a=m.after(c,"onOpen",function(){a.remove();u.resolve(c)})}var u=new d,f=this.getWidgetById(c);if(f){if("closed"!==f.state)return u.resolve(f),u;a(f)}else var k=b.subscribe("widgetCreated",l.hitch(this,function(a){a.id===c&&(k.remove(),u.resolve(a))}));
b.publish("openWidget",c);return u},_tryLoadWidgetConfig:function(c){var a=new d;if(c.config&&l.isObject(c.config))return a.resolve(c.config),a;if(c.config){if(require.cache["url:"+c.config])return a.resolve(k.parse(require.cache["url:"+c.config])),a;a=v.processUrlInAppConfig(c.config);a=a.split("/");a[a.length-1]=encodeURIComponent(a[a.length-1]);a=a.join("/");return x(a,{handleAs:"json"})}return this._tryLoadResource(c,"config").then(function(a){c.isDefaultConfig=!0;return a})},_upgradeWidgetConfig:function(c,
a){var b=new d,u=c.manifest.version,f=c.version,k;if(u===f)return b.resolve(a),b;if(!1===c.hasVersionManager)return c.version=u,b.resolve(a),b;require(v.getRequireConfig(),[c.amdFolder+"VersionManager"],l.hitch(this,function(d){d=new d;var m=d.getVersionIndex(f),C=d.getVersionIndex(u);if(m>C)b.reject("Bad widget version number, "+c.name+","+f);else try{k=d.upgrade(a,f,u),c.version=u,b.resolve(k)}catch(O){console.log("Read widget ["+c.name+"] old config error,"+O.stack),b.resolve(a)}}));return b},
loadWidgetStyle:function(c){var b="widget/style/"+c.uri,u=new d,b=this._replaceId(b);return a.byId(b)?(u.resolve("load"),u):v.loadStyleLink(b,c.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(c){var b="widget/style/"+c.uri+"/setting",u=new d,b=this._replaceId(b);return a.byId(b)?(u.resolve("load"),u):v.loadStyleLink(b,c.settingStyleFile)},loadWidgetConfig:function(c){c=require(v.getRequireConfig()).toUrl(c.configFile);if(require.cache["url:"+c]){var a=
new d;a.resolve(k.parse(require.cache["url:"+c]));return a}return x(c,{handleAs:"json"})},loadWidgetI18n:function(c){var a=new d;require(v.getRequireConfig(),["dojo/i18n!"+c.i18nFile],function(c){a.resolve(c)});return a},loadWidgetSettingI18n:function(c){var a=new d;require(v.getRequireConfig(),["dojo/i18n!"+c.settingI18nFile],function(c){a.resolve(c)});return a},loadWidgetTemplate:function(c){var a=new d;require(v.getRequireConfig(),["dojo/text!"+c.templateFile],function(c){a.resolve(c)});v.checkError(c.templateFile,
a);return a},loadWidgetSettingTemplate:function(c){var a=new d;require(v.getRequireConfig(),["dojo/text!"+c.settingTemplateFile],function(c){a.resolve(c)});v.checkError(c.settingTemplateFile,a);return a},removeWidgetStyle:function(c){a.destroy(this._replaceId("widget/style/"+c.uri))},removeWidgetSettingStyle:function(c){a.destroy(this._replaceId("widget/style/"+c.uri+"/setting"))},getControllerWidgets:function(){return f.filter(this.loaded,function(c){return c.isController})},getOffPanelWidgets:function(){return f.filter(this.loaded,
function(c){return!c.inPanel})},getOnScreenOffPanelWidgets:function(){return f.filter(this.loaded,function(c){return c.isOnScreen&&!c.inPanel})},closeOtherWidgetsInTheSameGroup:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;for(var a=0;a<this.loaded.length;a++)this.loaded[a].gid===c.gid&&this.loaded[a].id!==c.id&&this.closeWidget(this.loaded[a])},closeAllWidgetsInGroup:function(c){for(var a=0;a<this.loaded.length;a++)this.loaded[a].gid===c&&this.closeWidget(this.loaded[a])},
_mergeAgolConfig:function(c){var a=this.appConfig._appData.values,b="widgets["+c.id+"]",d;for(d in a){var u=d.replace(/\//g,"_").indexOf(b+"_config");0<=u&&v.template.setConfigValue(c,d.replace(/\//g,"_").substr(u,d.length).replace(b,"widget"),a[d])}},_onUserSignIn:function(c){f.forEach(this.loaded,function(a){a.onSignIn(c)},this)},_onUserSignOut:function(){f.forEach(this.loaded,function(c){c.onSignOut()},this)},_activeWidget:function(c){if(this.activeWidget){if(this.activeWidget.id===c.id){!1===
this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&a.setStyle(this.activeWidget.domNode,"zIndex",101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&a.setStyle(c.domNode,"zIndex","zIndex"in c.position?c.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=c;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&a.setStyle(this.activeWidget.domNode,
"zIndex",101),this.activeWidget.onActive(),b.publish("widgetActived",c))},_onClickWidget:function(c,b){var d=p(".jimu-widget",c.domNode);if(0<d.length)for(var u=0;u<d.length;u++)if(b.target===d[u]||a.isDescendant(b.target,d[u]))return;this._activeWidget(c)},_onMoveStart:function(c){f.forEach(this.loaded,function(a){a.domNode===c.node&&this._activeWidget(a)},this)},_onAppConfigLoaded:function(c){this.appConfig=c=l.clone(c);r.setPortalUrl(c.portalUrl)},_onSceneViewLoaded:function(c){this.sceneView=
c},_onSceneViewChanged:function(c){this.sceneView=c},_onAppConfigChanged:function(c,a,b,d){var u=l.clone(c);this.appConfig=u;f.forEach(this.loaded,function(c){c&&(c.onAppConfigChanged(u,a,b,d),"widgetChange"===a&&this._onConfigChanged(b.id,b.config,d))},this)},_onConfigChanged:function(c,a){if(c=this.getWidgetById(c))c.onConfigChanged(a),l.mixin(c.config,a)},_onActionTriggered:function(c){if("map"!==c.elementId&&"app"!==c.elementId){var a=this.getWidgetById(c.elementId);if(a)a.onAction(c.action,c.data);
else this.missedActions.push({id:c.elementId,action:{name:c.action,data:c.data}});f.forEach(this.getControllerWidgets(),function(a){if(a.widgetIsControlled(c.elementId))a.onAction(c.action,{widgetId:c.elementId,data:c.data})},this)}},_postWidgetStartup:function(c){c.started=!0;v.setVerticalCenter(c.domNode);m.after(c,"resize",l.hitch(this,v.setVerticalCenter,c.domNode));this.openWidget(c);var a=r.getPortalCredential(this.appConfig.portalUrl);if(a)c.onSignIn(a);else c.onSignOut();this._triggerMissedAction(c)},
_triggerMissedAction:function(c){this.missedActions.forEach(function(a){if(a.id===c.id)c.onAction(a.action.name,a.action.data)})},_remove:function(c){return f.some(this.loaded,function(a,b){if(a.id===c)return this.loaded.splice(b,1),!0},this)},_tryLoadResource:function(c,a){var b,f=new d;if("config"===a)b=c.amdFolder+"config.json",c.configFile=b,b="hasConfig";else if("style"===a)b=c.amdFolder+"css/style.css",c.styleFile=b,b="hasStyle";else if("i18n"===a)b=c.amdFolder+"nls/strings.js",c.i18nFile=c.isRemote?
b:c.amdFolder+"nls/strings",b="hasLocale";else if("template"===a)b=c.amdFolder+"Widget.html",c.templateFile=b,b="hasUIFile";else if("settingTemplate"===a)b=c.amdFolder+"setting/Setting.html",c.settingTemplateFile=b,b="hasSettingUIFile";else if("settingI18n"===a)b=c.amdFolder+"setting/nls/strings.js",c.settingI18nFile=c.isRemote?b:c.amdFolder+"setting/nls/strings",b="hasSettingLocale";else if("settingStyle"===a)b=c.amdFolder+"setting/css/style.css",c.settingStyleFile=b,b="hasSettingStyle";else return f;
c[b]?function(){var b;if("config"===a)b=this.loadWidgetConfig(c);else if("style"===a)b=this.loadWidgetStyle(c);else if("i18n"===a)b=this.loadWidgetI18n(c);else if("template"===a)b=this.loadWidgetTemplate(c);else if("settingTemplate"===a)b=this.loadWidgetSettingTemplate(c);else if("settingStyle"===a)b=this.loadWidgetSettingStyle(c);else if("settingI18n"===a)b=this.loadWidgetSettingI18n(c);else return f;b.then(function(c){f.resolve(c)},function(a){new u({message:window.jimuNls.loadWidgetResourceError+
": "+c.uri});f.reject(a)})}.apply(this):f.resolve(null);return f},_replaceId:function(c){return c.replace(/\//g,"_").replace(/\./g,"_")},_onDestroyWidget:function(c){"closed"!==c.state&&this.closeWidget(c);this._removeWidget(c);console.log("destroy widget ["+c.uri+"].")},_onDestroyWidgetSetting:function(c){this.removeWidgetSettingStyle(c)},_removeWidget:function(c){if("string"===typeof c&&(c=this.getWidgetById(c),!c))return;this.activeWidget&&this.activeWidget.id===c.id&&(this.activeWidget=null);
this._remove(c.id);0===this.getWidgetsByName(c.name).length&&this.removeWidgetStyle(c)}});E.getInstance=function(c){null===C&&(C=new E(c),window._widgetManager=C);return C};return E})},"jimu/tokenUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/request esri/core/urlUtils esri/identity/IdentityManager esri/identity/OAuthInfo jimu/portalUrlUtils jimu/utils".split(" "),function(w,l,f,a,d,b,q,t,m,
k,p,x,z,v,r){"function"!==typeof d.getAll&&(d.getAll=function(a){var b=[];(a=d(a))&&b.push(a);return b});x={portalUrl:null,cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){return r.isInConfigOrPreviewWindow()},isStringStartWith:function(a,b){return a.substr(0,b.length)===b},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(a){(a=v.getStandardPortalUrl(a))&&(a+="/");this.portalUrl=a},getPortalUrl:function(){return this.portalUrl},
isWebTierPortal:function(b){var d=new a,u=v.getStandardPortalUrl(b);b=u+"/sharing";var c=v.setHttpsProtocol(u+"/sharing/generateToken?f\x3djson"),f=v.setHttpsProtocol(b);t.get(c,{jsonp:"callback"}).then(w.hitch(this,function(a){a.token?(this.webTierPortalUrls.push(u),this.removeWabAuthCookie(),m.id.getCredential(f).then(w.hitch(this,function(b){function f(a){var b=a.creationTime||(new Date).getTime(),d=a.expires;0<b&&0<d&&d>b&&setTimeout(function(){t.get(c,{jsonp:"callback"}).then(function(c){c.token&&
(a.token=c.token,a.expires=c.expires,a.creationTime=(new Date).getTime(),a.refreshServerTokens(),f(a))},function(c){console.error(c)})},.8*(d-b))}b.token||(b.token=a.token);b.expires||(b.expires=a.expires);var k=r.getEsriConfigRequestObject(),m=p.canUseXhr(b.server,!0);-1<m&&k.corsEnabledServers.splice(m,1);this._pushCorsEnabledServerInfo({host:v.getServerByUrl(u),withCredentials:!0});d.resolve(!0);f(b)}),w.hitch(this,function(){d.resolve(!0)}))):d.resolve(!1)}),w.hitch(this,function(c){console.error(c);
d.reject(c)}));return d},addAuthorizedCrossOriginDomains:function(a){if(a&&0<a.length)for(var b=0;b<a.length;b++)this.addWithCredentialDomain(a[b])},addWithCredentialDomain:function(a){if(a&&"string"===typeof a){var b=r.getEsriConfigRequestObject().corsEnabledServers,d=v.getServerByUrl(a);(a=v.getServerWithProtocol(a))||(a="http://"+d);a=p.canUseXhr(a,!0);-1<a&&b.splice(a,1);this._pushCorsEnabledServerInfo({host:d,withCredentials:!0})}},_pushCorsEnabledServerInfo:function(a){if(a){var b=r.getEsriConfigRequestObject(),
d=b.corsEnabledServers,c="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");if("object"===typeof a&&"string"===typeof a.host){for(var f in a.host)a[f]="function"===typeof a.host[f]?function(){return a.host[f].apply(a.host,arguments)}:a.host[f];a.length=a.host.length;l.forEach(c,function(c){"function"===typeof a.host[c]&&
(a[c]=function(){return a.host[c].apply(a.host,arguments)})});a.withCredentials&&b.webTierAuthServers&&0>b.webTierAuthServers.indexOf(a.host)&&b.webTierAuthServers.push(a.host)}d.push(a)}},tryRegisterCredential:function(a){return this.isValidCredential(a)?l.some(m.id.credentials,w.hitch(this,function(b){return a.token===b.token}))?!1:(m.id.credentials.push(a),!0):!1},registerToken:function(a){var b=v.getSharingUrl(this.portalUrl);m.id.findCredential(b)&&l.some(m.id.credentials,w.hitch(this,function(a,
c){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,a))return m.id.credentials.splice(c,1),!0}));return this._getTokenInfo(a).then(function(a){m.id.registerToken(a)})},_getTokenInfo:function(a){var b=v.getPortalSelfInfoUrl(this.portalUrl);return t.get(b+("?f\x3djson\x26token\x3d"+a),{jsonp:"callback"}).then(w.hitch(this,function(b){if(b.user)return{server:v.getSharingUrl(this.portalUrl),ssl:b.allSSL,token:a,userId:b.user.username};throw Error(window.jimuNls.urlParams.invalidToken);}),function(a){console.error(a);
throw Error(window.jimuNls.urlParams.validateTokenError);})},_isInvalidPortalUrl:function(a){return a&&"string"===typeof a&&w.trim(a)},signInPortal:function(b){var d=new a;if(this._isInvalidPortalUrl(b)){b=v.getStandardPortalUrl(b);var f=v.getSharingUrl(b),c=this.getPortalCredential(b);c?setTimeout(w.hitch(this,function(){d.resolve(c)}),0):d=m.id.getCredential(f)}else setTimeout(w.hitch(this,function(){d.reject("Invalid portalurl.")}),0);return d},_loadPortalSelfInfo:function(b){b=v.getPortalSelfInfoUrl(b);
var d=new a;k(b,{responseType:"json",query:{f:"json"},callbackParamName:"callback"}).then(w.hitch(this,function(a){d.resolve(a.data)}),w.hitch(this,function(a){d.reject(a)}));return d},registerOAuthInfo:function(a,b){if(!a||"string"!==typeof a||!b||"string"!==typeof b)return null;var d=m.id.findOAuthInfo(a);d||(d=window.location.protocol+"//"+window.location.host+require.toUrl("jimu")+"/oauth-callback.html",d=new z({appId:b,expiration:20160,portalUrl:a,authNamespace:"/",popup:!0,popupCallbackUrl:d}),
m.id.registerOAuthInfos([d]));d.appId=b;return d},signOutAll:function(){var a=v.getStandardPortalUrl(this.portalUrl),b=!!m.id.findCredential(a+"/sharing/rest");window.appInfo.isRunInPortal?this.removeEsriAuthCookieStorage():this.removeWabAuthCookie();m.id.destroyCredentials();m.id._oAuthHash=null;b&&this._publishCurrentPortalUserSignOut(a)},userHaveSignInPortal:function(a){return!!this.getPortalCredential(w.trim(a||""))},isValidCredential:function(a){var b=!1;if(a){var b=a.token,d=a.server,c=a.scope,
b=b&&"string"===typeof b&&w.trim(b),d=d&&"string"===typeof d&&w.trim(d),c="portal"===c||"server"===c,f=!0;a.expires&&(a=parseInt(a.expires,10),f=(new Date).getTime(),f=a>f);b=b&&d&&c&&f}return b},isValidPortalCredentialOfPortalUrl:function(a,b){var d=!1;this.isValidCredential(b)&&(d="portal"===b.scope,a=v.isSameServer(a,b.server),d=d&&a);return d},getPortalCredential:function(a){var b=null;a=w.trim(a||"");if(!a)return null;a=v.getStandardPortalUrl(a);return b=this._filterPortalCredential(a,m.id.credentials)},
saveAndRegisterCookieToCredential:function(a){a=w.clone(a);a.referer=window.location.host;a.scope="portal";a.isAdmin=!!a.isAdmin;this.saveWabCookie(a);var b=a.server+"/sharing/rest";a.server=b;m.id.registerToken(a);return m.id.findCredential(b,a.userId)},registerAuth2Hash:function(a){a=w.clone(a);var b=1E3*parseInt(a.expires_in,10),b=(new Date).getTime()+b,d=v.getStandardPortalUrl(a.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,server:d,token:a.access_token,
expires:b,userId:a.username,scope:"portal",isAdmin:!!a.isAdmin})},saveWabCookie:function(a){this.removeCookie("wab_auth");d("wab_auth",b.stringify(a),{expires:new Date(a.expires),path:"/"})},removeWabAuthCookie:function(){this.removeCookie("wab_auth")},removeEsriAuthCookieStorage:function(){this.removeCookie("esri_auth");window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(a,
b){var d=null;b&&0<b.length&&(b=l.filter(b,w.hitch(this,function(c){return this.isValidPortalCredentialOfPortalUrl(a,c)})),0<b.length&&(d=b[b.length-1]));return d},_removePortalCredential:function(a){var b=w.trim(a||"");if(b){b=v.getStandardPortalUrl(b);for(a=l.filter(m.id.credentials,w.hitch(this,function(a){return this.isValidPortalCredentialOfPortalUrl(b,a)}));0<a.length;)a[0].destroy(),a.splice(0,1);m.id.credentials=l.filter(m.id.credentials,w.hitch(this,function(a){return!this.isValidPortalCredentialOfPortalUrl(b,
a)}))}},getUserIdByToken:function(b,d){var f=new a;if(b&&"string"===typeof b&&d&&"string"===typeof d){var c=v.getStandardPortalUrl(d);d=l.filter(m.id.credentials,w.hitch(this,function(a){var d=a.token===b&&a.userId;a=v.isSameServer(c,a.server);return d&&a}));if(0<d.length){var u=d[0];setTimeout(w.hitch(this,function(){f.resolve(u.userId)}),0);return f}d=v.getCommunitySelfUrl(c);k(d,{responseType:"json",query:{f:"json"},callbackParamName:"callback"}).then(w.hitch(this,function(c){c=c&&c.data;f.resolve(c&&
c.username||"")}),w.hitch(this,function(c){console.error(c);f.reject("fail to get userId by token")}))}else setTimeout(w.hitch(this,function(){f.reject("invalid parameters")}),0);return f},xtGetCredentialFromCookie:function(a){var f=d("wab_auth"),k=null;if(f)try{k=b.parse(f)}catch(c){console.error(c)}if(!k||"object"!==typeof k||!v.isSameServer(a,k.server)||window.location.host!==k.referer)return null;k.expires=parseInt(k.expires,10);f=(new Date).getTime();if(!(k.expires>f))return this.removeCookie("wab_auth"),
null;a+="/sharing/rest";k.server=a;(f=m.id.findCredential(a))||m.id.registerToken(k);return f=m.id.findCredential(a)},removeCookie:function(a){var b=this.getCookiePath();r.removeCookie(a,b)},_getDomainsByServerName:function(a){var b=a.split("."),d=b.length;return l.map(b,w.hitch(this,function(c,a){c=b.slice(a,d);var f="",k=c.length-1;l.forEach(c,w.hitch(this,function(c,a){f+=c;a!==k&&(f+=".")}));return f}))},_publishCurrentPortalUserSignIn:function(a){if(this.isValidCredential(a))try{q.publish("userSignIn",
a)}catch(C){console.error(C)}},_publishAnyUserSignIn:function(a){if(this.isValidCredential(a))try{q.publish("anyUserSignIn",a)}catch(C){console.error(C)}},_publishCurrentPortalUserSignOut:function(a){try{q.publish("userSignOut",a)}catch(C){console.error(C)}},_signInSuccess:function(a){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,a)&&this._publishCurrentPortalUserSignIn(a),this._publishAnyUserSignIn(a)}catch(C){console.error(C)}},_bindEvents:function(){f.after(m.id,"signIn",w.hitch(this,
function(a,b){console.log(b[1]);f.after(a,"callback",w.hitch(this,function(a,c){this._signInSuccess(c[0],!1)}));return a}))},isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var a=window.parent;if(a){var b=a.esri&&a.esri.id;b&&(m.id=b,b=r.getEsriConfigRequestObject(),a=a.esriConfig.defaults.io,b.corsEnabledServers=a.corsEnabledServers,b.webTierAuthServers=a.webTierAuthServers,b._processedCorsServers=a._processedCorsServers,b.corsStatus=
a.corsStatus)}}this._bindEvents();this._started=!0}}};x.startup();return x})},"jimu/portalUrlUtils":function(){define(["dojo/_base/lang","jimu/shared/basePortalUrlUtils"],function(w,l){var f=w.clone(l);f.declaredClass="jimu.portalUrlUtils";f.getPortalUrlFromLocation=function(){return f.getPortalServerFromLocation()+f.getDeployContextFromLocation()};f.getPortalSignInUrlFromLocation=function(){return f.getPortalUrlFromLocation()+"home/signin.html"};f.getPortalServerFromLocation=function(){return window.location.protocol+
"//"+window.location.host};f.getDeployContextFromLocation=function(){var a=window.location.href.split("?")[0],d=a.indexOf("/home");0>d&&(d=a.indexOf("/apps"));a=a.substring(a.indexOf(window.location.host)+window.location.host.length+1,d);"/"!==a&&(a="/"+a+"/");return a};f.getRestBaseUrlFromLocation=function(){return window.location.protocol+"//"+window.location.host+f.getDeployContextFromLocation()+"sharing/rest/"};return f})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup".split(" "),
function(w,l,f,a,d,b){return w(b,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,postMixInProperties:function(){this.content=this.message},_createTitleNode:function(){this.titleLabel&&(this.titleNode=f.create("div",{"class":"title"},this.domNode),this.titleLabeNode=f.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode),this.closeBtnNode=f.create("div",
{"class":"close-btn jimu-float-trailing"},this.titleNode),this.own(d(this.closeBtnNode,"click",l.hitch(this,this.close))))},_preProcessing:function(){0===this.buttons.length&&this.buttons.push({label:window.jimuNls.common.ok,key:a.ENTER,onClick:l.hitch(this,this.close)})},_increaseZIndex:function(){f.setStyle(this.domNode,"zIndex",501);f.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase jimu/utils".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x){var z=0;return w(p,{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",titleLabel:"",content:null,container:null,buttons:[],enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,maxHeight:800,maxWidth:1024,constructor:function(){this.buttons=[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},postCreate:function(){this._preProcessing();this.inherited(arguments);this._initDomNode();
this._positioning();a.place(this.domNode,this.container);setTimeout(l.hitch(this,function(){this._moveToMiddle()}),50);this.own(b(window,"resize",l.hitch(this,function(){this._fixedHeight||this.autoHeight?(this._calculatePosition(),this._moveToMiddle()):this._positioning()})));this.overlayNode=a.create("div",{"class":"jimu-overlay"},this.container);this._increaseZIndex();d.animateProperty({node:this.domNode,properties:{opacity:1},duration:200}).play();this.domNode.focus()},_preProcessing:function(){"number"===
typeof this.height&&(this._fixedHeight=!0,this.autoHeight=!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=a.create("div",{"class":"title"},this.domNode);this.titleLabeNode=a.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode);this.closeBtnNode=a.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing"},this.titleNode);var d=null,d="ontouchstart"in document?t.press:"click";this.own(b(this.closeBtnNode,
d,l.hitch(this,this.close)))},_initDomNode:function(){this._createTitleNode();this.contentContainerNode=a.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?this.contentContainerNode.innerHTML=this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&a.place(this.content,this.contentContainerNode));this.buttonContainer=a.create("div",{"class":"button-container"},this.domNode);0===
this.buttons.length&&a.setStyle(this.buttonContainer,"display","none");for(var b=this.buttons.length-1;-1<b;b--)this._createButton(this.buttons[b]),this.buttons[b].disable&&this.disableButton(b)},_limitButtonsMaxWidth:function(){var b=this.enabledButtons.length;if(0!==b){var d=a.getContentBox(this.buttonContainer),k=a.getMarginExtents(this.enabledButtons[0]),m=a.getPadBorderExtents(this.enabledButtons[0]),p=0,m=8===q("ie")?m.l+m.r:0,p=(d.w-(k.l+k.r+m)*b)/b;0<p&&(f.forEach(this.enabledButtons,l.hitch(this,
function(c){a.setStyle(c,"maxWidth",p+"px")})),f.forEach(this.disabledButtons,l.hitch(this,function(c){a.setStyle(c,"maxWidth",p+"px")})))}},_moveableNode:function(d,f){this.moveable&&(this.moveable.destroy(),this.moveable=null);var u=a.getMarginBox(this.container);u.l=u.l-d+f;u.w+=2*(d-f);this.moveable=new k.boxConstrainedMoveable(this.domNode,{box:u,handle:this.titleNode||this.contentContainerNode,within:!0});this.own(b(this.moveable,"Moving",l.hitch(this,this.onMoving)));this.own(b(this.moveable,
"MoveStop",l.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===m("#header").length?{t:0,l:0,w:0,h:0}:a.getMarginBox("header")},_getFooterBox:function(){return 0===m(".footer",this.container).length?{t:0,l:0,w:0,h:0}:a.getMarginBox(m(".footer",this.container)[0])},_calculatePosition:function(){var b=a.getContentBox(this.container),d=this._getHeaderBox(),f=this._getFooterBox(),f=b.h-d.h-f.h-40,k=0;k=this._fixedHeight?this.height:this.autoHeight?f-200:this.height=f>this.maxHeight?this.maxHeight:
f;f=(f-k)/2+d.h+20;f=f<d.h?d.h:f;this.width=this.width||this.maxWidth;a.setStyle(this.domNode,{left:(b.w-this.width)/2+"px",top:f+"px",width:this.width+"px"})},_calculateHeight:function(){this.autoHeight?(a.setStyle(this.domNode,"height","auto"),a.addClass(this.contentContainerNode,"content-static"),0===this.buttons.length&&a.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(a.setStyle(this.domNode,"height",this.height+"px"),a.addClass(this.contentContainerNode,"content-absolute"),a.addClass(this.buttonContainer,
"button-container-absolute"),0===this.buttons.length&&a.setStyle(this.contentContainerNode,{bottom:"15px"}));this._moveableNode(this.width,100)},_moveToMiddle:function(){if(this.autoHeight){var b=a.getMarginBox(this.domNode),d=a.getContentBox(this.container),f=this._getHeaderBox(),k=this._getFooterBox(),k=d.h-f.h-k.h-40,m=0,m=b.h||k-200,b=(k-m)/2+f.h+20,b=b<f.h?f.h:b;a.setStyle(this.domNode,{left:(d.w-this.width)/2+"px",top:b+"px",width:this.width+"px"})}},_positioning:function(){this._calculatePosition();
this._calculateHeight()},_increaseZIndex:function(){a.setStyle(this.domNode,"zIndex",z+200+1);a.setStyle(this.overlayNode,"zIndex",z+200);z++},setTitleLabel:function(a){this.titleNode.innerHTML=x.stripHTML(a)},onMoving:function(b){a.setStyle(b.node,"opacity",.9)},onMoveStop:function(b){a.setStyle(b.node,"opacity",1)},close:function(){if(!this.onClose||!1!==this.onClose()){var b=this.domNode.parentNode,f=l.clone(this.domNode);a.setStyle(this.domNode,"display","none");a.destroy(this.overlayNode);this.destroy();
this.moveable.destroy();a.place(f,b);d.animateProperty({node:f,properties:{opacity:0},duration:200,onEnd:function(){a.destroy(f)}}).play()}},addButton:function(a){this._createButton(a)},_createButton:function(d){var f=" ";d.classNames&&0<d.classNames.length&&"function"===typeof d.classNames.join&&(f+=d.classNames.join(" "));var k=a.create("div",{"class":"jimu-btn jimu-float-trailing jimu-trailing-margin1 "+f,innerHTML:d.label,title:d.title},this.buttonContainer);this.enabledButtons.unshift(k);f=a.create("div",
{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+f,title:d.title,innerHTML:d.label,style:{display:"none"}},this.buttonContainer);this.disabledButtons.unshift(f);this.own(b(k,"click",l.hitch(this,function(a){if(d.onClick)d.onClick(a);else this.close()})))},setButtonProps:function(b,d){"number"===typeof b&&isFinite(b)||(d=b,b=0);if(d&&0!==this.enabledButtons.length)for(var f in d)"title"===f?(a.setAttr(this.enabledButtons[b],"title",d[f]),a.setAttr(this.disabledButtons[b],
"title",d[f])):"label"===f&&(a.setProp(this.enabledButtons[b],"innerHTML",d[f]),a.setProp(this.disabledButtons[b],"innerHTML",d[f]))},enableButton:function(b){"number"===typeof b&&isFinite(b)&&b<this.enabledButtons.length?(a.setStyle(this.enabledButtons[b],"display","inline-block"),a.setStyle(this.disabledButtons[b],"display","none")):(f.forEach(this.enabledButtons[b],l.hitch(this,function(b){a.setStyle(b,"display","inline-block")})),f.forEach(this.disabledButtons[b],l.hitch(this,function(b){a.setStyle(b,
"display","none")})))},disableButton:function(b){"number"===typeof b&&isFinite(b)&&b<this.disabledButtons.length?(a.setStyle(this.disabledButtons[b],"display","inline-block"),a.setStyle(this.enabledButtons[b],"display","none")):(f.forEach(this.disabledButtons,l.hitch(this,function(b){a.setStyle(b,"display","inline-block")})),f.forEach(this.enabledButtons,l.hitch(this,function(b){a.setStyle(b,"display","none")})))},showButton:function(a){this.enableButton(a)},hideButton:function(b){"number"===typeof b&&
isFinite(b)&&b<this.disabledButtons.length?(a.setStyle(this.disabledButtons[b],"display","none"),a.setStyle(this.enabledButtons[b],"display","none")):(f.forEach(this.disabledButtons,l.hitch(this,function(b){a.setStyle(b,"display","none")})),f.forEach(this.enabledButtons,l.hitch(this,function(b){a.setStyle(b,"display","none")})))}})})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),function(w,l,f,a,d,b){a=w("dojo.dnd.move.constrainedMoveable",
b,{constraints:function(){},within:!1,constructor:function(a,b){b||(b={});this.constraints=b.constraints;this.within=b.within},onFirstMove:function(a){var b=this.constraintBox=this.constraints.call(this,a);b.r=b.l+b.w;b.b=b.t+b.h;this.within&&(a=l.getMarginSize(a.node),b.r-=a.w,b.b-=a.h)},onMove:function(a,b){var d=this.constraintBox,f=a.node.style;this.onMoving(a,b);b.l=b.l<d.l?d.l:d.r<b.l?d.r:b.l;b.t=b.t<d.t?d.t:d.b<b.t?d.b:b.t;f.left=b.l+"px";f.top=b.t+"px";this.onMoved(a,b)}});d=w("dojo.dnd.move.boxConstrainedMoveable",
a,{box:{},constructor:function(a,b){var d=b&&b.box;this.constraints=function(){return d}}});w=w("dojo.dnd.move.parentConstrainedMoveable",a,{area:"content",constructor:function(a,b){var d=b&&b.area;this.constraints=function(){var a=this.node.parentNode,b=f.getComputedStyle(a),m=l.getMarginBox(a,b);if("margin"==d)return m;var q=l.getMarginExtents(a,b);m.l+=q.l;m.t+=q.t;m.w-=q.w;m.h-=q.h;if("border"==d)return m;q=l.getBorderExtents(a,b);m.l+=q.l;m.t+=q.t;m.w-=q.w;m.h-=q.h;if("padding"==d)return m;q=
l.getPadExtents(a,b);m.l+=q.l;m.t+=q.t;m.w-=q.w;m.h-=q.h;return m}}});return{constrainedMoveable:a,boxConstrainedMoveable:d,parentConstrainedMoveable:w}})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager"],function(w){function l(){this.versions=[{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",upgrader:function(f){return f},compatible:!0},{version:"2.0",description:"The version for Online 4.1.",upgrader:function(f){return f},compatible:!0},{version:"2.0.1",
description:"The version for Developer Edition 2.0.",upgrader:function(f){var a=null,d=0,b=f.widgetOnScreen.widgets;if(b&&0<b.length)for(d=0;d<b.length;d++)a=b[d],"widgets/Viz/Widget"===a.uri&&(a.uri="widgets/3DFx/Widget",a.name="3DFx");if((b=f.widgetPool.widgets)&&0<b.length)for(d=0;d<b.length;d++)a=b[d],"widgets/Viz/Widget"===a.uri&&(a.uri="widgets/3DFx/Widget",a.name="3DFx");return f},compatible:!0},{version:"2.1",description:"The version for Online 4.2.",upgrader:function(f){return f},compatible:!0},
{version:"2.2",description:"The version for Online 4.3.",upgrader:function(f){return f},compatible:!0},{version:"2.3",description:"The version for Online 4.4.",upgrader:function(f){return f},compatible:!0},{version:"2.4",description:"The version for Online 5.1.",upgrader:function(f){return f},compatible:!0},{version:"2.5",description:"The version for Online 5.2.",upgrader:function(f){return f},compatible:!0},{version:"2.6",description:"The version for Online 5.3.",upgrader:function(f){return f},compatible:!0}];
this.isCompatible=function(f,a){f=this.getVersionIndex(f);a=this.getVersionIndex(a);for(f+=1;f<=a;f++)if(!1===this.versions[f].compatible)return!1;return!0}}l.prototype=new w;return l.prototype.constructor=l})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=[];this.upgrade=function(w,l,f){l=this.getVersionIndex(l);f=this.getVersionIndex(f);if(l>=f)throw Error("New version should higher than old version.");for(l+=1;l<=f;l++)this.versions[l].upgrader&&
(w=this.versions[l].upgrader(w));return w};this.getVersionIndex=function(w){w=this.fixVersion(w);var l,f;for(f=0;f<this.versions.length;f++)this.versions[f].version===w&&(l=f);null===w&&(l=-1);void 0===l&&(l=this.versions.length-1);return l};this.fixVersion=function(w){return w?w:null}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./appConfigResourceUtils ./portalUrlUtils ./AppStateManager esri/identity/IdentityManager esri/core/urlUtils".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c){var D=null,B;B=w(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(a,c){this._removeHash(a);this.urlParams=a||{};this.widgetManager=p.getInstance();l.mixin(this,c)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(l.hitch(this,function(a){var c=this.checkConfig(a);if(c)throw c;this.rawAppConfig=l.clone(a);C.getInstance().setRawAppConfig(this.rawAppConfig);
a=this._upgradeAppConfig(a);this._processAfterTryLoad(a);this.appConfig=a;if(this.urlParams.id)return this.loadWidgetsManifest(a).then(l.hitch(this,function(){return this._upgradeAllWidgetsConfig(a)})).then(l.hitch(this,function(a){return this.insertAppIdtoResourceUrlofAppConfig(a,this.urlParams.id)})).then(l.hitch(this,function(){this._configLoaded=!0;a.title&&(document.title=window.isBuilder?k.stripHTML(a.title)+" - Web AppBuilder for ArcGIS":k.stripHTML(a.title));this._readAndSetSharedTheme(a);
return this.getAppConfig()}));z.setPortalUrl(a.portalUrl);return this._proesssWebTierAndSignin(a).then(l.hitch(this,function(){return this.urlParams.appid?window.appInfo.isRunInPortal?this._getAppConfigFromTemplateAppId(a.portalUrl,this.urlParams.appid).then(l.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)})):this._processNotInPortalAppProtocol(a).then(l.hitch(this,function(a){return this._getAppDataAddTemplateDataFromTemplateAppId(a.portalUrl,
this.urlParams.appid).then(l.hitch(this,function(c){c.appData.appConfig&&(a=c.appData.appConfig);a._appData=c.appData;a.templateConfig=c.templateData;a.isTemplateApp=!0;return a}))})):this._processNotInPortalAppProtocol(a)})).then(l.hitch(this,function(a){this._processAfterTryLoad(a);this.appConfig=a;return a.map.itemId?a:v.getDefaultWebScene(a.portalUrl).then(function(c){a.map.itemId=c;return a})})).then(l.hitch(this,function(a){return this.loadWidgetsManifest(a)})).then(l.hitch(this,function(a){return a._appData?
a._appData.values&&a._appData.values.webmap?v.getPortal(a.portalUrl).getItemById(a._appData.values.webmap).then(l.hitch(this,function(c){return k.template.mergeTemplateAppConfigToAppConfig(a,a._appData,c)})):k.template.mergeTemplateAppConfigToAppConfig(a,a._appData):a})).then(l.hitch(this,function(){return this._upgradeAllWidgetsConfig(a)})).then(l.hitch(this,function(a){return a._wabAppId?this.processResourceInAppConfigForConfigLoader(a,this.urlParams):a.appItemId&&-1<window.JSON.stringify(a).indexOf("${itemId}")?
this.insertAppIdtoResourceUrlofAppConfig(a,a.appItemId):a})).then(l.hitch(this,function(){this.appConfig=a;this._configLoaded=!0;a.title&&(document.title=k.stripHTML(a.title));this._readAndSetSharedTheme(a);return this.getAppConfig()}))}),l.hitch(this,function(a){this.showError(a)}))},processResourceInAppConfigForConfigLoader:function(a,c){var b=a.portalUrl,d=a.appItemId,f=c.appid,k=new q,m=l.clone(a);this.insertAppIdtoResourceUrlofAppConfig(m,f).then(function(){if("config"===c.mode){var u=this.getResourceUrlsOfAppConfig(a).result;
0!==u.length?v.getItemResources(b,f).then(function(a){if(0===a.length)return u=u.map(function(a){return{resUrl:a}}),r.AddResourcesToItemForAppSave(b,u,d,f).then(function(){k.resolve(m)},function(a){console.warn("Add resource to template based app error:"+a.message||a);k.resolve(m)});k.resolve(m)},function(a){console.warn("Get resource of template based item error:"+a.message||a);k.resolve(m)}):k.resolve(m)}else k.resolve(m)}.bind(this),function(a){console.warn("Insert appId to resource url of appConfig error:"+
a.message||a);k.resolve(m)});return k},getResourceUrlsOfAppConfig:function(a){var c={test:function(a){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items/.test(a)},func:l.hitch(this,function(a){return a.value})};return k.processItemResourceOfAppConfig(a,c)},insertAppIdtoResourceUrlofAppConfig:function(a,c){function b(a){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items/.test(a)}function d(a,c){var b=c.obj,d=c.key,f={obj:b,key:d};"number"===typeof c.i?(f.i=c.i,f.value=b[d][c.i]):f.value=b[d];
c=f;a=m.processItemIdAndTokenOfResources(c.value,a);b=c.obj;d=c.key;"number"===typeof c.i?b[d][c.i]=a:b[d]=a;return!0}var f=a.portalUrl,m=this;return v.getPortal(f).getItemById(c).then(l.hitch(this,function(m){m={test:b,func:l.hitch(this,d,{appId:c,isPublic:"public"===m.access,portalUrl:f})};return k.processItemResourceOfAppConfig(a,m).appConfig}))},processItemIdAndTokenOfResources:function(a,c){0<a.indexOf("${itemId}")&&(a=a.replace("${itemId}",c.appId));/(\?|\&)token=.+/.test(a)&&(a=a.replace(/(\?|\&)token=.+/,
""));c.isPublic||(c=z.getPortalCredential(c.portalUrl))&&(a+="?token\x3d"+c.token);return a},getAppConfig:function(){var a=l.clone(this.appConfig);a.getConfigElementById=function(a){return k.getConfigElementById(this,a)};a.getConfigElementsByName=function(a){return k.getConfigElementsByName(this,a)};a.visitElement=function(a){k.visitElement(this,a)};this._addAuthorizedCrossOriginDomains(this.portalSelf,a);return a},_addAuthorizedCrossOriginDomains:function(a,c){a&&a.authorizedCrossOriginDomains&&
z.addAuthorizedCrossOriginDomains(a.authorizedCrossOriginDomains);c&&c.authorizedCrossOriginDomains&&z.addAuthorizedCrossOriginDomains(c.authorizedCrossOriginDomains)},checkConfig:function(a){return(a=this._getRepeatedId(a))?"repeated id:"+a:null},processProxy:function(a){var b=k.getEsriConfigRequestObject();b.alwaysUseProxy=a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.alwaysUseProxy;b.proxyUrl="";b.proxyRules=[];a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.url&&(b.proxyUrl=a.httpProxy.url);a.httpProxy&&
a.httpProxy.useProxy&&a.httpProxy.rules&&f.forEach(a.httpProxy.rules,function(a){c.addProxyRule(a)})},addNeedValues:function(a){this._processNoUriWidgets(a);this._addElementId(a);this._processWidgetJsons(a)},showError:function(c){a.create("div",{"class":"app-error",innerHTML:k.sanitizeHTML(c.message)},document.body)},_tryLoadConfig:function(){if(this.urlParams.config)return this.configFile=this.urlParams.config,m(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(l.hitch(this,
function(a){z.setPortalUrl(a.portalUrl);return this.urlParams.token?z.registerToken(this.urlParams.token).then(function(){return a}):a}));if(this.urlParams.id){window.appInfo.isRunInPortal=!0;var a=u.getPortalUrlFromLocation(),c=new q;z.setPortalUrl(a);var b;this.urlParams.token?b=z.registerToken(this.urlParams.token):(b=new q,b.resolve());b.then(l.hitch(this,function(){v.getPortal(a).loadSelfInfo().then(l.hitch(this,function(b){this.portalSelf=b;b.allSSL&&"http:"===window.location.protocol?(window.location.href=
u.setHttpsProtocol(window.location.href),c.reject()):this._processSignIn(a).then(l.hitch(this,function(){this._getAppConfigFromAppId(a,this.urlParams.id).then(l.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)})).then(function(a){c.resolve(a)},function(a){c.reject(a)})}))}))}),l.hitch(this,function(a){this.showError(a)}));return c}this.configFile="config.json";return m(this.configFile,{handleAs:"json"}).then(l.hitch(this,function(a){z.setPortalUrl(a.portalUrl);
return this.urlParams.token?z.registerToken(this.urlParams.token).then(function(){return a}):a}))},_upgradeAppConfig:function(a){var c=window.wabVersion,b=a.wabVersion;if(c===b)return a;var d=this.versionManager.getVersionIndex(b),f=this.versionManager.getVersionIndex(c);if(d>f)throw Error("Bad version number, "+b);a=this.versionManager.upgrade(a,b,c);a.wabVersion=c;a.isUpgraded=!0;return a},_upgradeAllWidgetsConfig:function(a){var c=new q,b=[];if(!a.isUpgraded)return c.resolve(a),c;delete a.isUpgraded;
x.visitElement(a,l.hitch(this,function(a){a.uri&&(a.config?(a=this.widgetManager.tryLoadWidgetConfig(a),b.push(a)):a.version=a.manifest.version)}));t(b).then(l.hitch(this,function(){c.resolve(a)}),function(a){c.reject(a)});return c},_processAfterTryLoad:function(a){this._setPortalUrl(a);this._tryUpdateAppConfigByLocationUrl(a);this._processUrlParams(a);this.addNeedValues(a);this.processProxy(a);E.tokenValidity=10080;return a},_readAndSetSharedTheme:function(a){a.theme.sharedTheme||(a.theme.sharedTheme=
{useHeader:!1,useLogo:!1},a.theme.sharedTheme.isPortalSupport=this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?!0:!1);a.theme.sharedTheme.useHeader&&(a.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(a.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},a.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text):console.error("Portal does not support sharedTheme."));a.theme.sharedTheme.useLogo&&
(a.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(a.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",!a.logoLink&&this.portalSelf.portalProperties.sharedTheme.logo.link&&(a.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link)):(console.error("Portal does not support sharedTheme, use default logo."),a.logo="images/app-logo.png"))},_tryUpdateAppConfigByLocationUrl:function(a){if(!(this.urlParams.config&&
-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var c=u.getPortalUrlFromLocation(),c=u.getStandardPortalUrl(c);u.isOnline(c)&&(c=u.updateUrlProtocolByOtherUrl(c,a.portalUrl),a.map.portalUrl&&u.isSamePortalUrl(a.portalUrl,a.map.portalUrl)&&(a.map.portalUrl=c),a.portalUrl=c,a.httpProxy&&a.httpProxy.url&&(a.httpProxy.url=u.getPortalProxyUrl(c)))}},_processWidgetJsons:function(a){x.visitElement(a,function(a,c){c.isWidget&&a.uri&&k.processWidgetSetting(a)})},_processNoUriWidgets:function(a){var c=
0;x.visitElement(a,function(a,b){b.isWidget&&!a.uri&&(c++,a.placeholderIndex=c)})},_addElementId:function(a){var c=0,b;x.visitElement(a,function(a){if(a.id){a.id=a.id.replace(/\//g,"_");var d=a.id.lastIndexOf("_");-1<d&&(b=a.id.substr(d+1),c=Math.max(c,b))}});x.visitElement(a,function(a){a.id||(c++,a.id=a.uri?a.uri.replace(/\//g,"_")+"_"+c:"_"+c)})},_setPortalUrl:function(a){if(a.portalUrl){var c=u.getPortalUrlFromLocation(),d=u.isOnline(c);u.isSamePortalUrl(a.portalUrl,c)||d||(window.appInfo.isRunInPortal=
!1)}else window.isXT&&b("wab_portalurl")?a.portalUrl=b("wab_portalurl"):(window.appInfo.isRunInPortal=!0,a.portalUrl=u.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(a,c){a.portalUrl=u.setProtocol(a.portalUrl,c);a.map.portalUrl&&(a.map.portalUrl=u.setProtocol(a.map.portalUrl,c));a.httpProxy&&(a.httpProxy.url=u.setProtocol(a.httpProxy.url,c),a.httpProxy&&a.httpProxy.rules&&f.forEach(a.httpProxy.rules,l.hitch(this,function(a){a.proxyUrl=u.setProtocol(a.proxyUrl,c)})))},_processInPortalAppProtocol:function(a){var c=
new q,b=v.getPortal(a.portalUrl),d=l.hitch(this,function(b){if("https:"===window.location.protocol)this._changePortalUrlProtocol(a,"https");else{if(b){window.location.href=u.setHttpsProtocol(window.location.href);c.reject();return}this._changePortalUrlProtocol(a,"http")}this._checkLocale();c.resolve(a)});b.loadSelfInfo().then(l.hitch(this,function(c){this.portalSelf=c;"private"===c.access?(c=0===a.portalUrl.toLowerCase().indexOf("https://"),d(c)):d(c.allSSL)}),l.hitch(this,function(a){c.reject(a)}));
return c},_processNotInPortalAppProtocol:function(a){var c=new q;a.portalUrl?v.getPortal(a.portalUrl).loadSelfInfo().then(l.hitch(this,function(b){this.portalSelf=b;var d="https:"===window.location.protocol;(b.allSSL||d)&&this._changePortalUrlProtocol(a,"https");0!==a.portalUrl.toLowerCase().indexOf("https://")||d||z.isInConfigOrPreviewWindow()?c.resolve(a):(window.location.href=u.setHttpsProtocol(window.location.href),c.reject())}),l.hitch(this,function(a){c.reject(a)})):c.resolve(a);return c},_proesssWebTierAndSignin:function(a){var c=
new q,b=!1,d=a.portalUrl;this._processWebTier(a).then(l.hitch(this,function(a){b=a;return v.getPortal(d).loadSelfInfo()})).then(l.hitch(this,function(a){this.portalSelf=a;return this._processSignIn(d,b)})).then(l.hitch(this,function(){c.resolve()}),function(a){c.reject(a)});return c},_processWebTier:function(a){var c=new q,b=a.portalUrl;a.isWebTier?(z.addAuthorizedCrossOriginDomains([b]),z.isWebTierPortal(b).then(l.hitch(this,function(){var d=z.getPortalCredential(b);d&&d.ssl&&"http:"===window.location.protocol&&
!z.isInConfigOrPreviewWindow()?window.location.href=u.setHttpsProtocol(window.location.href):c.resolve(a.isWebTier)}),l.hitch(this,function(a){c.reject(a)}))):c.resolve(!1);return c},_processSignIn:function(a,c){var b=new q,d=v.getPortal(a),f=u.getSharingUrl(a);window.appInfo.isRunInPortal?(c=E.checkSignInStatus(f),c.always(l.hitch(this,function(){b.resolve()}))):(z.isInBuilderWindow()||z.isInConfigOrPreviewWindow()||!this.portalSelf.supportsOAuth||!this.rawAppConfig.appId||c||z.registerOAuthInfo(a,
this.rawAppConfig.appId),c=E.checkSignInStatus(f),c.always(l.hitch(this,function(){z.xtGetCredentialFromCookie(a);d.loadSelfInfo().then(l.hitch(this,function(a){this.portalSelf=a;this._checkLocale();b.resolve()}))})));return b},_checkLocale:function(){if(!z.isInConfigOrPreviewWindow()){var a=this.portalSelf.user&&this.portalSelf.user.culture||d.locale,a=a.toLowerCase();!this.urlParams.locale&&k.isLocaleChanged(d.locale,a)&&(b("wab_app_locale",a),window.location.reload())}},_getAppConfigFromTemplateAppId:function(a,
c){var b=v.getPortal(a);return this._getWabAppIdAndDataFromTemplateAppId(a,c).then(l.hitch(this,function(c){var d=c.appId,f=c.appData;return t([this._getAppConfigFromAppId(a,d),b.getItemData(f.source)]).then(l.hitch(this,function(a){var c;f.appConfig?(c=f.appConfig,delete f.appConfig):c=a[0];c=this._upgradeAppConfig(c);a=a[1];c._appData=f;c._wabAppId=d;c.templateConfig=a;c.isTemplateApp=!0;return c}))}))},_getAppDataAddTemplateDataFromTemplateAppId:function(a,c){var b=v.getPortal(a);return b.getItemData(c).then(function(a){return b.getItemData(a.source).then(function(c){return{appData:a,
templateData:c}})})},_getWabAppIdAndDataFromTemplateAppId:function(a,b){var d=new q,f=v.getPortal(a);f.getItemData(b).then(l.hitch(this,function(a){f.getItemById(a.source).then(l.hitch(this,function(b){b=c.urlToObject(b.url);d.resolve({appId:b.query.id,appData:a})}))}),function(a){d.reject(a)});return d},_getAppConfigFromAppId:function(a,c){return v.getPortal(a).getItemData(c)},_removeHash:function(a){for(var c in a)a[c]&&(a[c]=a[c].replace("#",""))},loadWidgetsManifest:function(a){function c(c,d,
f){function m(d){return c.loadWidgetManifest(d).then(function(a){return a},function(c){console.log("Widget failed to load, it is removed.",d.name);c.stack?console.error(c.stack):console.log(c);b(a,d)})}return d.itemId?v.getPortal(f).getItemById(d.itemId).then(function(c){var f;f=k.isEsriDomain(c.url)?!0:z.getPortalCredential(a.portalUrl)?!0:!1;if(f)return d.uri=k.widgetJson.getUriFromItem(c),m(d);console.log("Widget is not useable, it is removed.",d.name);b(a,d)}):m(d)}function b(a,c){function b(b){a[b]&&
a[b].widgets&&(a[b].widgets=a[b].widgets.filter(function(a){if(c)return a.id!==c.id;a.uri&&!a.manifest&&console.error("Widget is removed because it is not loaded successfully.",a.uri);return a.manifest}));a[b]&&a[b].groups&&a[b].groups.forEach(function(a){a.widgets&&(a.widgets=a.widgets.filter(function(a){if(c)return a.id!==c.id;a.uri&&!a.manifest&&console.error("Widget is removed because it is not loaded successfully.",a.uri);return a.manifest}))})}b("widgetOnScreen");b("widgetPool")}var d=[],f=
new q;a._buildInfo&&a._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(l.hitch(this,function(b){x.visitElement(a,l.hitch(this,function(f){f.widgets||!f.uri&&!f.itemId||(f.uri&&b[f.uri]?(this._addNeedValuesForManifest(b[f.uri],f.uri),k.widgetJson.addManifest2WidgetJson(f,b[f.uri])):d.push(c(this.widgetManager,f,a.portalUrl)))}));t(d).then(function(){f.resolve(a)})})):(x.visitElement(a,l.hitch(this,function(b){b.widgets||!b.uri&&!b.itemId||d.push(c(this.widgetManager,b,a.portalUrl))})),
t(d).then(function(){f.resolve(a)}));setTimeout(function(){f.isResolved()||(b(a),f.resolve(a))},6E4);return f},_addNeedValuesForManifest:function(a,c){l.mixin(a,k.getUriInfo(c));k.addManifestProperies(a);k.processManifestLabel(a,d.locale)},_loadMergedWidgetManifests:function(){return m(window.appInfo.appPath+"widgets/widgets-manifest.json",{handleAs:"json"})},_getRepeatedId:function(a){var c=[],b;x.visitElement(a,function(a){if(0<c.indexOf(a.id))return b=a.id,!0;c.push(a.id)});return b},_processUrlParams:function(a){var c=
this.urlParams.itemid||this.urlParams.webmap;c&&a.map.itemId!==c&&(a.map.mapOptions&&k.deleteMapOptions(a.map.mapOptions),a.map.itemId=c);this.urlParams.mode&&(a.mode=this.urlParams.mode);a.map.mapOptions||(a.map.mapOptions={});this.urlParams.scale&&(a.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||this.urlParams.zoom)a.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});B.getInstance=function(a,c){null===D?D=new B(a,c):(D.urlParams=a,D.options=c);return D};return B})},
"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json esri/request ./utils ./portalUrlUtils ./tokenUtils".split(" "),function(w,l,f,a,d,b,q,t,m,k,p){var x=w([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(a){this.portalUrl=k.getStandardPortalUrl(a);this.selfUrl=k.getPortalSelfInfoUrl(a)},loadSelfInfo:function(){var a=new d,b={query:{f:"json"},
responseType:"json",callbackParamName:"callback",cacheBust:!0};this.isValidCredential()&&(b.query.token=this.credential.token);t(this.selfUrl,b).then(l.hitch(this,function(c){c=c.data;var b=c.user;delete c.user;l.mixin(this,c);c.user=b;a.resolve(c)}),l.hitch(this,function(c){console.error(c);a.reject(c)}));return a},_checkCredential:function(){var a=p.isValidCredential(this.credential);a||this.clearCredentialAndUser();return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},
updateCredential:function(){this._checkCredential()||(this.credential=p.getPortalCredential(this.portalUrl))},signIn:function(){var a=new d;this.updateCredential();this.isValidCredential()?setTimeout(l.hitch(this,function(){a.resolve(this.credential)}),0):a=p.signInPortal(this.portalUrl);return a},haveSignIn:function(){return p.userHaveSignInPortal(this.portalUrl)},clearCredentialAndUser:function(){this.user=this.credential=null},getUser:function(){this.updateCredential();var a=new d;this.user&&"jimu.PortalUser"===
this.user.declaredClass?setTimeout(l.hitch(this,function(){this.user.updateCredential();a.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(l.hitch(this,function(b){this.user=b;a.resolve(this.user)}),l.hitch(this,function(b){console.error(b);a.reject(b)})):p.getUserIdByToken(this.credential.token,this.portalUrl).then(l.hitch(this,function(b){this.credential.userId=b;this._getUser(this.credential.userId).then(l.hitch(this,function(c){this.user=
c;a.resolve(this.user)}),l.hitch(this,function(c){console.error(c);a.reject(c)}))}),l.hitch(this,function(b){console.error(b);a.reject(b)})):setTimeout(l.hitch(this,function(){a.reject("credential is null.")}),0);return a},queryItems:function(a){this.updateCredential();var b=new d,c=k.getBaseSearchUrl(this.portalUrl),m={f:"json"};a&&(m=l.mixin(m,a));this.isValidCredential()&&(m.token=this.credential.token);m.sortField||m.sortOrder||(m.sortField="title",m.sortOrder="asc");t(c,{responseType:"json",
query:m,callbackParamName:"callback"}).then(l.hitch(this,function(a){a=a.data;a.results=f.map(a.results,l.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new r(a)}));b.resolve(a)}),l.hitch(this,function(a){console.error(a);b.reject(a)}));return b},getItemData:function(a){this.updateCredential();a=k.getItemDataUrl(this.portalUrl,a);var b={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(b.query.token=this.credential.token);
var c=new d;t(a,b).then(l.hitch(this,function(a){c.resolve(a.data)}),l.hitch(this,function(a){c.reject(a)}));return c},getItemById:function(a){var b=new d;this.updateCredential();a=k.getItemUrl(this.portalUrl,a);var c={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(c.query.token=this.credential.token);t(a,c).then(l.hitch(this,function(a){a=a.data;a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;a=new r(a);b.resolve(a)}),l.hitch(this,
function(a){console.error(a);b.reject(a)}));return b},getAppById:function(a){var b=new d;this.updateCredential();this.isValidCredential()?(a=k.getAppIdUrl(this.portalUrl,a),t(a,{responseType:"json",query:{f:"json",token:this.credential.token}}).then(l.hitch(this,function(a){b.resolve(a.data)}),l.hitch(this,function(a){b.reject(a)}))):setTimeout(l.hitch(this,function(){b.reject("token is null.")}),0);return b},queryGroups:function(a){this.updateCredential();var b=new d,c=k.getBaseGroupUrl(this.portalUrl),
m={f:"json"};a&&(m=l.mixin(m,a));this.isValidCredential()&&(m.token=this.credential.token);t(c,{responseType:"json",query:m,callbackParamName:"callback"}).then(l.hitch(this,function(a){a=a.data;a.results=f.map(a.results,l.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new v(a)}));b.resolve(a)}),l.hitch(this,function(a){console.error(a);b.reject(a)}));return b},registerApp:function(a,b,c){var f=new d;this.updateCredential();if(this.isValidCredential()){var m=
this.credential&&this.credential.token,u=k.getOAuth2Url(this.portalUrl);t(u+"/registerApp",{query:{itemId:a,appType:b,redirect_uris:q.stringify(c),token:m,f:"json"},responseType:"json",method:"post"}).then(l.hitch(this,function(a){f.resolve(a.data)}),l.hitch(this,function(a){f.reject(a)}))}else setTimeout(l.hitch(this,function(){f.reject("token is null.")}),0);return f},createAndRegisterApp:function(a){var b=new d;this.updateCredential();this.isValidCredential()?this.getUser().then(l.hitch(this,function(c){c.addItem({title:"Web AppBuilder for ArcGIS",
type:"Web Mapping Application",text:"",snippet:"",tags:"Registered App for OAuth"},"").then(l.hitch(this,function(c){c.success?this.registerApp(c.id,"browser",a).then(l.hitch(this,function(a){b.resolve(a)}),l.hitch(this,function(a){console.error(a);b.reject(a)})):b.reject("create app failed")}),l.hitch(this,function(a){console.error(a);b.reject(a)}))}),l.hitch(this,function(a){console.error(a);b.reject(a)})):setTimeout(l.hitch(this,function(){b.reject("token is null.")}),0);return b},_getUser:function(a){this.updateCredential();
var b=new d;a=k.getUserUrl(this.portalUrl,a);var c={query:{f:"json"},responseType:"json",callbackParamName:"callback"};this.isValidCredential()&&(c.query.token=this.credential&&this.credential.token);t(a,c).then(l.hitch(this,function(a){a=a.data;a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;this.user=new z(a);b.resolve(this.user)}),l.hitch(this,function(a){console.error(a);b.reject(a)}));return b},getItemResources:function(a,b,c){c||(c=100);a=k.getStandardPortalUrl(a);a=k.getItemResourceUrl(a,
b);return t({url:a,content:{f:"json",num:c}}).then(function(a){if(a&&a.resources)return a.resources})},addResource:function(a,b,c,d,f){a=k.getStandardPortalUrl(a);var m=this.getPortal(a),u=new FormData;u.append("file",c,d);u.append("fileName",d);u.append("f","json");var r="";f?(u.append("resourcesPrefix",f),r=f+"/"+d):r=d;return m.getItemById(b,!0).then(function(c){c=k.getUserContentItemUrl(a,c.owner,b);return t({url:c+"/addResources",form:u}).then(function(c){var b="";c&&c.success&&(b=k.getItemResourceUrl(a,
"${itemId}",r));return b},function(a){console.error(a.message||a);return a})})},removeResources:function(a,b,c,d){var f={resource:d?d+"/"+c:c,f:"json"};a=k.getStandardPortalUrl(a);return this.getPortal(a).getItemById(b,!0).then(function(c){c=k.getUserContentItemUrl(a,c.owner,b);return t({url:c+"/removeResources",content:f},{usePost:!0}).then(function(a){return a},function(a){console.error(a.message||a);return a})})}}),z=w([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,
constructor:function(a){a&&l.mixin(this,a)},_checkCredential:function(){var a=p.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getGroups:function(){var a=[];this.groups&&(a=f.map(this.groups,l.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;
a.portal=this.portal;return new v(a)})));return a},getItemsByKeywords:function(a,b){return this.portal.queryItems({start:b||1,num:100,q:"owner:"+this.username+' AND typekeywords:"'+a+'"'})},getContent:function(){this.updateCredential();var a=k.getUserContentUrl(this.portalUrl,this.username),b={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential&&(b.query.token=this.credential.token);var c=new d;t(a,b).then(l.hitch(this,function(a){c.resolve(a.data)}),l.hitch(this,
function(a){c.reject(a)}));return c},getTags:function(){this.updateCredential();var a=k.getUserTagsUrl(this.portalUrl,this.username),b={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(b.query.token=this.credential.token);var c=new d;t(a,b).then(l.hitch(this,function(a){c.resolve(a.data)}),l.hitch(this,function(a){c.reject(a)}));return c},addItem:function(a,b){this.updateCredential();var c=new d;if(this.isValidCredential()){var f={f:"json",token:this.credential.token};
a&&(f=l.mixin(f,a));a=k.getAddItemUrl(this.portalUrl,this.username,b);t(a,{responseType:"json",callbackParamName:"callback",query:f,method:"post"}).then(l.hitch(this,function(a){c.resolve(a.data)}),l.hitch(this,function(a){console.error(a);c.reject(a)}))}else setTimeout(l.hitch(this,function(){c.reject("token is null.")}),0);return c},deleteItem:function(a){this.updateCredential();var b=new d;this.isValidCredential()?(a=k.getDeleteItemUrl(this.portalUrl,this.username,a),t(a,{query:{token:this.credential.token,
f:"json"},responseType:"json",method:"post"}).then(l.hitch(this,function(a){b.resolve(a.data)}),l.hitch(this,function(a){b.reject(a)}))):setTimeout(l.hitch(this,function(){b.reject("token is null.")}),0);return b},getItemById:function(a,b){this.updateCredential();var c=new d;b=k.getUserItemsUrl(this.portalUrl,this.username,b);var f={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(f.query.token=this.credential.token);t(b+"/"+a,f).then(l.hitch(this,function(a){a=
a.data;a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;a=new r(a);c.resolve(a)}),l.hitch(this,function(a){console.error(a);c.reject(a)}));return c},shareItem:function(a,b,c){this.updateCredential();var f=new d;this.isValidCredential()?(b=k.shareItemUrl(this.portalUrl,this.username,b,c),c={responseType:"json",callbackParamName:"callback",query:{f:"json",token:this.credential.token},method:"post"},a&&(a.content&&!a.query&&(a.query=a.content),c.query=l.mixin(c.query,a)),t(b,c).then(l.hitch(this,
function(a){f.resolve(a.data)}),l.hitch(this,function(a){console.error(a);f.reject(a)}))):setTimeout(l.hitch(this,function(){f.reject("token is null.")}),0);return f},updateItem:function(a,b){this.updateCredential();var c=new d;this.isValidCredential()?this.portal.getItemById(a).then(l.hitch(this,function(d){var f={f:"json",token:this.credential.token};b&&(f=l.mixin(f,b));d=k.getUpdateItemUrl(this.portalUrl,this.username,a,d.ownerFolder);t(d,{responseType:"json",callbackParamName:"callback",timeout:1E5,
query:f,method:"post"}).then(l.hitch(this,function(a){c.resolve(a.data)}),l.hitch(this,function(a){console.error(a);c.reject(a)}))}),l.hitch(this,function(a){console.error(a);c.reject(a)})):setTimeout(l.hitch(this,function(){c.reject("token is null.")}),0);return c},isAdminRole:function(){return"org_admin"===this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===
this.role}}),v=w([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&l.mixin(this,a)},_checkCredential:function(){var a=p.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(a){a.q="group:"+this.id+
" AND "+a.q;return this.portal.queryItems(a)}}),r=w([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(a){a&&l.mixin(this,a);this.itemUrl=k.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&this.thumbnail&&this.itemUrl&&(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+
this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=k.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=k.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var a=p.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},
getItemData:function(){return this.portal.getItemData(this.id)}}),u={portals:[],webMapQueryStr:" "+m.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+m.getItemQueryStringByTypes(["Web Scene"])+" ",_findPortal:function(a){for(var b=0;b<this.portals.length;b++){var c=this.portals[b];if(k.isSamePortalUrl(a,c.portalUrl))return c.updateCredential(),c}return null},getPortal:function(a){if(!a||"string"!==typeof a||!l.trim(a))return null;a=k.getStandardPortalUrl(a);var b=this._findPortal(a);
b||(b=new x(a),b.credential=p.getPortalCredential(b.portalUrl),b.updateCredential(),this.portals.push(b));return b},getPortalSelfInfo:function(a){return this.getPortal(a).loadSelfInfo()},getBasemapGalleryGroup:function(a){return this._getPortalSelfGroup(a,"basemapGalleryGroupQuery")},getTemplatesGroup:function(a){return this._getPortalSelfGroup(a,"templatesGroupQuery")},getUnits:function(b){var f="english",c="",k=new d;this.getPortal(b).getUser().then(l.hitch(this,function(b){b&&b.units?f=b.units:
(c=a.locale,f=c.startWith("en")?"english":"metric");k.resolve(f)}),l.hitch(this,function(d){console.warn(d);this.getPortalSelfInfo(b).then(l.hitch(this,function(b){var d=null;b&&b.units?d=b.units:(c=b&&b.culture||a.locale,d=c.startWith("en")?"english":"metric");k.resolve(d)}),l.hitch(this,function(b){console.warn(b);c=a.locale;f=c.startWith("en")?"english":"metric";k.resolve(f)}))}));return k.promise},_getPortalSelfGroup:function(a,b){var c=new d,f=this.getPortal(a);f||setTimeout(l.hitch(this,function(){c.reject()}),
0);this.getPortalSelfInfo(a).then(l.hitch(this,function(a){f.queryGroups({f:"json",q:a[b]}).then(l.hitch(this,function(a){0<a.results.length?(a=a.results[0],a.portalUrl=f.portalUrl,a.credential=f.credential,a.portal=f,a=new v(a),c.resolve(a)):c.reject("Can't find portal self group.")}),l.hitch(this,function(a){console.error(a);c.reject(a)}))}),l.hitch(this,function(a){console.error(a);c.reject(a)}));return c},getWebMapsFromBasemapGalleryGroup:function(a){var b=new d;this.getBasemapGalleryGroup(a).then(l.hitch(this,
function(a){a?a.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(l.hitch(this,function(a){b.resolve(a)}),l.hitch(this,function(a){console.error(a);b.reject(a)})):b.reject()}),l.hitch(this,function(a){console.error(a);b.reject(a)}));return b},getDefaultWebScene:function(a){var b=new d,c=this.getPortal(a);c.getUser().then(l.hitch(this,function(a){c.queryItems({start:1,num:1,f:"json",q:this.webSceneQueryStr+' AND owner:"'+a.username+'" ',sortField:"numViews",sortOrder:"desc"}).then(l.hitch(this,
function(a){a=a.results;a=f.filter(a,l.hitch(this,function(a){return a.type&&"web scene"===a.type.toLowerCase()}));0<a.length?b.resolve(a[0].id):b.resolve(null)}),l.hitch(this,function(a){b.reject(a)}))}),l.hitch(this,function(){b.reject("not sign in")}));return b},getDefaultWebMap:function(a){var b=new d;this.getPortalSelfInfo(a).then(l.hitch(this,function(c){var d=c.defaultBasemap&&c.defaultBasemap.id;d?b.resolve(d):this._getDefaultWebMapByBasemapGallery(a,c).then(l.hitch(this,function(c){c?b.resolve(c):
this._getMostNumViewsWebMap(a).then(l.hitch(this,function(a){a?b.resolve(a):b.reject()}),l.hitch(this,function(a){console.error(a);b.reject(a)}))}),l.hitch(this,function(a){console.error(a);b.reject(a)}))}),l.hitch(this,function(a){console.error(a);b.reject(a)}));return b},_getDefaultWebMapByBasemapGallery:function(a,b){var c=new d,k=this.getPortal(a),m=b.defaultBasemap&&b.defaultBasemap.title;k.queryGroups({f:"json",q:b.basemapGalleryGroupQuery}).then(l.hitch(this,function(a){a=a.results;0<a.length?
k.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+a[0].id+" AND title:"+m}).then(l.hitch(this,function(a){a=a.results;a=f.filter(a,l.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?c.resolve(a[0].id):(console.log("Can't find web map under basemapGalleryGroupQuery."),k.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+m}).then(l.hitch(this,function(a){a=a.results;a=f.filter(a,l.hitch(this,function(a){return a.type&&"web map"===
a.type.toLowerCase()}));if(0<a.length){var b=a[0];k.getItemData(b.id).then(l.hitch(this,function(a){a&&(a.operationalLayers||a.baseMap||a.version)?c.resolve(b.id):c.resolve(null)}),l.hitch(this,function(){c.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),c.resolve(null)}),l.hitch(this,function(a){console.error(a);c.reject(a)})))}),l.hitch(this,function(a){console.error(a);c.reject(a)})):(console.log("Can't find group by basemapGalleryGroupQuery."),c.resolve(null))}),
l.hitch(this,function(a){console.error(a);c.reject(a)}));return c},_getMostNumViewsWebMap:function(a){var b=new d;this.getPortal(a).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(l.hitch(this,function(a){a=a.results;a=f.filter(a,l.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?b.resolve(a[0].id):b.reject("Can't find most-num-views web map.")}),l.hitch(this,function(a){console.error(a);
b.reject(a)}));return b}};b.subscribe("userSignOut",function(a){(a=u._findPortal(a))&&a.clearCredentialAndUser()});return u})},"jimu/appConfigResourceUtils":function(){define(["dojo/Deferred","dojo/promise/all","jimu/portalUtils","jimu/utils"],function(w,l,f,a){return{AddResourcesToItemForAppSave:function(d,b,q,t){b=b||[];if(0===b.length){var m=new w;m.resolve(b);return m}b=b.map(function(b){var d=b.resUrl.split("resources/")[1],f=new w;b.b64?(b=a.b64toBlob(b.b64),f.resolve({blob:b,fileName:d.split("/")[1],
prefixName:d.split("/")[0]})):(b=b.resUrl,0<b.indexOf("${itemId}")&&(b=b.replace("${itemId}",q)),a.resourcesUrlToBlob(b).then(function(a){f.resolve({blob:a,fileName:d.split("/")[1],prefixName:d.split("/")[0]},function(a){console.error(a.message||a);f.reject(a)})}));return f});return l(b).then(function(a){if(a instanceof Array&&0<a.length)return a=a.map(function(a){var b=q;t&&(b=t);return f.addResource(d,b,a.blob,a.fileName,a.prefixName)}.bind(this)),l(a).then(function(a){return a})}.bind(this))}}})},
"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/geometry/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),function(w,l,f,a,d,b,q,t,m){var k=null,p=w(null,{rawAppConfig:null,mapMd5:null,appStateKey:null,setRawAppConfig:function(a){this.rawAppConfig=a},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var b=a.stringify(this.rawAppConfig.map);this.mapMd5=t(b)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?
this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var a=new f,k={};if(m.isInConfigOrPreviewWindow()||!this.rawAppConfig||!this.rawAppConfig.map)return a.resolve(k),a;var p=this._getAppStateKey(),r=q.get(p);r&&r.appStateMd5===this._getAppStateMd5()?(p=r.map&&r.map.extent,r=r.map&&r.map.layers,p&&(k.extent=new d(p.xmin,p.ymin,p.xmax,p.ymax,new b(p.spatialReference))),r&&(k.layers=r)):q.remove(p);a.resolve(k);return a},saveWabAppState:function(a,
b){if(a&&!m.isInConfigOrPreviewWindow()){var d=this._getAppStateKey(),f={extent:{xmin:a.extent.xmin,xmax:a.extent.xmax,ymin:a.extent.ymin,ymax:a.extent.ymax,spatialReference:{wkid:a.extent.spatialReference.wkid,wkt:a.extent.spatialReference.wkt}},layers:{}};b&&b.traversalLayerInfosOfWebmap&&b.traversalLayerInfosOfWebmap(l.hitch(this,function(a){f.layers[a.id]={visible:a.isShowInMap()}}));q.set(d,{map:f,appStateMd5:this._getAppStateMd5()})}}});p.getInstance=function(a){null===k&&(k=new p);k.urlParams=
a;return k};return p})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/query dojo/dom-construct dojo/dom-geometry dojo/Deferred dojo/promise/all dojo/when require ./WidgetManager ./PanelManager ./MapManager ./utils ./OnScreenWidgetIcon ./WidgetPlaceholder ./dijit/LoadingShelter".split(" "),function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c,D,B){var I=null,G;G=w([d],{constructor:function(a,c){this.widgetManager=
r.getInstance();this.panelManager=u.getInstance();this.own(b.subscribe("appConfigLoaded",l.hitch(this,this.onAppConfigLoaded)));this.own(b.subscribe("appConfigChanged",l.hitch(this,this.onAppConfigChanged)));this.own(b.subscribe("sceneViewLoaded",l.hitch(this,this.onSceneViewLoaded)));this.own(b.subscribe("sceneViewChanged",l.hitch(this,this.onSceneViewChanged)));this.own(b.subscribe("beforeSceneViewDestory",l.hitch(this,this.onBeforeSceneViewDestroy)));this.own(b.subscribe("builder/actionTriggered",
l.hitch(this,this.onActionTriggered)));this.own(b.subscribe("openWidget",l.hitch(this,this._onOpenWidgetRequest)));this.widgetPlaceholders=[];this.preloadWidgetIcons=[];this.preloadGroupPanels=[];this.invisibleWidgetIds=[];this.own(q(window,"resize",l.hitch(this,this.resize)));this.id=c},postCreate:function(){this.containerNode=this.domNode},sceneView:null,mapId:"map",hlDiv:null,animTime:500,resize:function(){f.forEach(this.widgetManager.getAllWidgets(),function(a){!1===a.inPanel&&a.resize()},this)},
onAppConfigLoaded:function(a){this.appConfig=l.clone(a);this.appConfig.theme&&this._loadTheme(this.appConfig.theme);this._loadMap()},onAppConfigChanged:function(a,c,b){a=l.clone(a);switch(c){case "themeChange":this._onThemeChange(a);break;case "styleChange":this._onStyleChange(a);break;case "layoutChange":this._onLayoutChange(a);break;case "widgetChange":this._onWidgetChange(a,b);break;case "groupChange":this._onGroupChange(a,b);break;case "widgetPoolChange":this._onWidgetPoolChange(a,b);break;case "resetConfig":this._onResetConfig(a);
break;case "loadingPageChange":this._onLoadingPageChange(a,b)}this.appConfig=a},onSceneViewLoaded:function(a){this.sceneView=a;this.panelManager.setSceneView(this.sceneView);this._loadPreloadWidgets(this.appConfig)},onSceneViewChanged:function(a){this.sceneView=a;this.panelManager.setSceneView(this.sceneView);this._loadPreloadWidgets(this.appConfig)},onBeforeSceneViewDestroy:function(){this.panelManager.destroyAllPanels();this._destroyOffPanelWidgets();this._destroyWidgetPlaceholders();this._destroyPreloadWidgetIcons()},
onActionTriggered:function(c){"highLight"===c.action&&(f.forEach(this.widgetPlaceholders,function(a){a.configId===c.elementId&&this._highLight(a)},this),f.forEach(this.preloadWidgetIcons,function(a){a.configId===c.elementId&&this._highLight(a)},this),f.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(a){a.configId===c.elementId&&this._highLight(a)},this),f.forEach(this.preloadGroupPanels,function(a){a.configId===c.elementId&&this._highLight(a)},this));"removeHighLight"===c.action&&
this._removeHighLight();"showLoading"===c.action&&(a.setStyle(jimuConfig.loadingId,"display","block"),a.setStyle(jimuConfig.mainPageId,"display","none"));"showApp"===c.action&&(a.setStyle(jimuConfig.loadingId,"display","none"),a.setStyle(jimuConfig.mainPageId,"display","block"))},_highLight:function(a){if(a.domNode){this.hlDiv&&this._removeHighLight(a);var c=k.getMarginBox(a.domNode);this.hlDiv=m.create("div",{style:{position:"absolute",left:c.l+"px",top:c.t+"px",width:c.w+"px",height:c.h+"px"},"class":"icon-highlight"},
a.domNode,"before")}},_removeHighLight:function(){this.hlDiv&&(m.destroy(this.hlDiv),this.hlDiv=null)},_onWidgetChange:function(a,c){c=a.getConfigElementById(c.id);c.isController?this._reloadControllerWidget(a,c.id):(f.forEach(this.widgetPlaceholders,function(b){b.configId===c.id&&(b.destroy(),this._loadPreloadWidget(c,a))},this),this._removeDestroyed(this.widgetPlaceholders),f.forEach(this.preloadWidgetIcons,function(b){if(b.configId===c.id){var d=b.state;b.destroy();this._loadPreloadWidget(c,a).then(function(a){if(c.uri&&
"opened"===d)a.onClick()})}},this),this._removeDestroyed(this.preloadWidgetIcons),f.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(b){b.configId===c.id&&(b.destroy(),!1===c.visible?0>this.invisibleWidgetIds.indexOf(c.id)&&this.invisibleWidgetIds.push(c.id):this._loadPreloadWidget(c,a))},this),f.forEach(this.preloadGroupPanels,function(a){a.reloadWidget(c)},this),this._updatePlaceholder(a),f.forEach(this.invisibleWidgetIds,function(b){b===c.id&&!1!==c.visible&&(this._loadPreloadWidget(c,
a),b=this.invisibleWidgetIds.indexOf(c.id),this.invisibleWidgetIds.splice(b,1))},this),c.isOnScreen||f.forEach(this.widgetManager.getControllerWidgets(),function(b){b.widgetIsControlled(c.id)&&this._reloadControllerWidget(a,b.id)},this))},_onGroupChange:function(a,c){c=a.getConfigElementById(c.id);c.isOnScreen?(this.panelManager.destroyPanel(c.id+"_panel"),this._removeDestroyed(this.preloadGroupPanels),this._loadPreloadGroup(c,a)):(f.forEach(this.widgetManager.getControllerWidgets(),function(b){b.isControlled(c.id)&&
this._reloadControllerWidget(a,b.id)},this),f.forEach(this.panelManager.panels,function(a){a.config.id===c.id&&a.updateConfig(c)},this))},_updatePlaceholder:function(a){f.forEach(this.widgetPlaceholders,function(c){c.setIndex(a.getConfigElementById(c.configId).placeholderIndex)},this)},_onWidgetPoolChange:function(a,c){this._reloadControllerWidget(a,c.controllerId)},_reloadControllerWidget:function(a,c){var b=this.widgetManager.getWidgetById(c);if(b){var d=b.getOpenedIds(),k=b.windowState;f.forEach(b.getAllConfigs(),
function(a){if(a.widgets)this.panelManager.destroyPanel(a.id+"_panel"),f.forEach(a.widgets,function(a){this.panelManager.destroyPanel(a.id+"_panel")},this);else{var c=this.widgetManager.getWidgetById(a.id);c&&(a.inPanel?this.panelManager.destroyPanel(c.getPanel()):this.widgetManager.destroyWidget(c))}},this);this.widgetManager.destroyWidget(b);c=a.getConfigElementById(c);!1!==c.visible&&this._loadPreloadWidget(c,a).then(l.hitch(this,function(a){this.widgetManager.changeWindowStateTo(a,k);d&&a.setOpenedIds(d)}))}},
_removeDestroyed:function(a){var c=[];f.forEach(a,function(a){a._destroyed&&c.push(a)});f.forEach(c,function(c){c=a.indexOf(c);a.splice(c,1)})},_destroyPreloadWidgetIcons:function(){f.forEach(this.preloadWidgetIcons,function(a){a.destroy()},this);this.preloadWidgetIcons=[]},_destroyOffPanelWidgets:function(){f.forEach(this.widgetManager.getOffPanelWidgets(),function(a){this.widgetManager.destroyWidget(a)},this)},_destroyWidgetPlaceholders:function(){f.forEach(this.widgetPlaceholders,function(a){a.destroy()},
this);this.widgetPlaceholders=[]},_destroyPreloadGroupPanels:function(){f.forEach(this.preloadGroupPanels,function(a){this.panelManager.destroyPanel(a)},this);this.preloadGroupPanels=[]},_changeMapPosition:function(a){this.sceneView&&(E.isEqual(this.mapManager.getMapPosition(),a.map.position)||this.mapManager.setMapPosition(a.map.position))},_onThemeChange:function(a){this._destroyPreloadWidgetIcons();this._destroyWidgetPlaceholders();this._destroyOffPanelWidgets();this._destroyPreloadGroupPanels();
this.panelManager.destroyAllPanels();this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();v(["themes/"+a.theme.name+"/main"],l.hitch(this,function(){this._loadThemeCommonStyle(a.theme);this._loadThemeCurrentStyle(a.theme);this._addCustomStyle(a.theme);this._changeMapPosition(a);this._loadPreloadWidgets(a)}))},_onResetConfig:function(a){a.map.itemId!==this.appConfig.map.itemId?(b.publish("appConfigChanged",a,"mapChange",a),
this._updateCommonStyle(a),this._onStyleChange(a),this._changeMapPosition(a)):this._onThemeChange(a)},_onLoadingPageChange:function(c,b){"backgroundColor"in b?a.setStyle(jimuConfig.loadingId,"background-color",c.loadingPage.backgroundColor):"backgroundImage"in b?(c=c.loadingPage.backgroundImage,c.visible&&c.uri?(a.setStyle(jimuConfig.loadingImageId,"background-image","url('"+c.uri+"')"),a.setStyle(jimuConfig.loadingImageId,"width",c.width+"px"),a.setStyle(jimuConfig.loadingImageId,"height",c.height+
"px")):(a.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),a.setStyle(jimuConfig.loadingImageId,"width","0px"),a.setStyle(jimuConfig.loadingImageId,"height","0px"))):"loadingGif"in b&&(c=c.loadingPage.loadingGif,c.visible&&c.uri?(a.setStyle(jimuConfig.loadingGifId,"background-image","url('"+c.uri+"')"),a.setStyle(jimuConfig.loadingGifId,"width",c.width+"px"),a.setStyle(jimuConfig.loadingGifId,"height",c.height+"px")):(a.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),
a.setStyle(jimuConfig.loadingGifId,"width","0px"),a.setStyle(jimuConfig.loadingGifId,"height","0px")))},_updateCommonStyle:function(a){this._removeThemeCommonStyle(this.appConfig.theme);this._loadThemeCommonStyle(a.theme)},_onStyleChange:function(a){this._removeThemeCurrentStyle(this.appConfig.theme);this._loadThemeCurrentStyle(a.theme);this._removeCustomStyle();this._addCustomStyle(a.theme)},_onLayoutChange:function(a){b.publish("beforeLayoutChange");this._changeMapPosition(a);f.forEach(this.widgetPlaceholders,
function(c){c.moveTo(a.getConfigElementById(c.configId).position)},this);f.forEach(this.preloadWidgetIcons,function(c){c.moveTo(a.getConfigElementById(c.configId).position)},this);f.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(c){if(!c.closeable){var b=a.getConfigElementById(c.id).position;c.setPosition(b)}},this);f.forEach(this.preloadGroupPanels,function(c){var b=a.getConfigElementById(c.config.id).panel.position;c.setPosition(b)},this);b.publish("afterLayoutChange")},_loadTheme:function(a){v(["themes/"+
a.name+"/main"],l.hitch(this,function(){this._loadThemeCommonStyle(a);this._loadThemeCurrentStyle(a);this._addCustomStyle(a)}))},_loadThemeCommonStyle:function(c){E.loadStyleLink(this._getThemeCommonStyleId(c),"themes/"+c.name+"/common.css");a.addClass(this.domNode,c.name)},_removeThemeCommonStyle:function(c){a.removeClass(this.domNode,c.name);a.destroy(this._getThemeCommonStyleId(c))},_loadThemeCurrentStyle:function(c){E.loadStyleLink(this._getThemeCurrentStyleId(c),"themes/"+c.name+"/styles/"+c.styles[0]+
"/style.css");a.addClass(this.domNode,c.styles[0])},_removeThemeCurrentStyle:function(c){a.removeClass(this.domNode,c.styles[0]);a.destroy(this._getThemeCurrentStyleId(c))},_addCustomStyle:function(c){var b=l.getObject("customStyles",!1,c);if(b){var d=".jimu-main-background{background-color: ${mainBackgroundColor} !important;}";(c=this._getFixedThemeStyles(c))&&(d+=c);d=l.replace(d,b,/\$\{([^\}]+)\}/g);b=a.create("style",{type:"text/css"});try{b.appendChild(document.createTextNode(d))}catch(P){b.styleSheet.cssText=
d}b.setAttribute("source","custom");document.head.appendChild(b)}},_getFixedThemeStyles:function(a){var c=".esriPopup .titlePane {background-color: ${mainBackgroundColor} !important;}";"PlateauTheme"===a.name?c+=".jimu-widget-header-controller .jimu-title, .jimu-widget-header-controller .jimu-subtitle{color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller .links .jimu-link{color: ${mainBackgroundColor} !important;}.jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out{background-color: ${mainBackgroundColor} !important;}.jimu-preload-widget-icon-panel \x3e .jimu-panel-title, .jimu-foldable-panel \x3e .jimu-panel-title, .jimu-title-panel \x3e .title{color: ${mainBackgroundColor} !important;}.jimu-panel{border-color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller{border-bottom-color: ${mainBackgroundColor} !important;}":
"BillboardTheme"===a.name?c+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-home, .jimu-widget-navigate, .jimu-widget-zoom .esri-zoom .esri-widget, .jimu-widget-mylocation, .jimu-widget-search .esri-search-button.esri-submit,.jimu-widget-placeholder,.jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important;}.jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important;}":
"BoxTheme"===a.name?c+=".jimu-main-background, .jimu-widget-home, .jimu-widget-navigate, .jimu-widget-zoom .esri-zoom .esri-widget, .jimu-widget-mylocation, .jimu-widget-search .esri-search-button.esri-submit, .jimu-widget-placeholder{background-color: ${mainBackgroundColor} !important;}":"TabTheme"===a.name&&(c+=".tab-widget-frame .title-label{color: ${mainBackgroundColor} !important;}");return c},_removeCustomStyle:function(){t('style[source\x3d"custom"]',document.head).forEach(function(c){a.destroy(c)})},
_getThemeCommonStyleId:function(a){return"theme_"+a.name+"_style_common"},_getThemeCurrentStyleId:function(a){return"theme_"+a.name+"_style_"+a.styles[0]},_loadMap:function(){a.create("div",{id:this.mapId,style:l.mixin({position:"absolute",backgroundColor:"#EEEEEE",overflow:"hidden",minWidth:"1px",minHeight:"1px"})},this.id);this.mapManager=C.getInstance({appConfig:this.appConfig,urlParams:this.urlParams},this.mapId);this.mapManager.setMapPosition(this.appConfig.map.position);this.mapManager.showMap()},
_createPreloadWidgetPlaceHolder:function(c){var b;b="map"===c.position.relativeTo?this.mapId:this.id;var d=l.clone(c);d.position.width=32;d.position.height=32;c=new D({index:d.placeholderIndex,configId:c.id});c.moveTo(d.position);a.place(c.domNode,b);this.widgetPlaceholders.push(c);return c},_createPreloadWidgetIcon:function(b){var d=new c({panelManager:this.panelManager,widgetManager:this.widgetManager,widgetConfig:b,configId:b.id,sceneView:this.sceneView});"map"===b.position.relativeTo?a.place(d.domNode,
this.mapId):a.place(d.domNode,this.id);a.setStyle(d.domNode,{width:"32px",height:"32px"});d.moveTo(b.position);d.startup();!this.openAtStartWidget&&b.openAtStart&&(d.switchToOpen(),this.openAtStartWidget=b.name);this.preloadWidgetIcons.push(d);return d},_loadPreloadWidgets:function(a){console.time("Load widgetOnScreen");var c=new B,d=[];c.placeAt(this.id);c.startup();f.forEach(a.widgetOnScreen.widgets,function(c){!1===c.visible?this.invisibleWidgetIds.push(c.id):d.push(this._loadPreloadWidget(c,a))},
this);f.forEach(a.widgetOnScreen.groups,function(c){d.push(this._loadPreloadGroup(c,a))},this);x(d).then(l.hitch(this,function(){c&&(c.destroy(),c=null);console.timeEnd("Load widgetOnScreen");b.publish("preloadWidgetsLoaded");this._doPostLoad()}),l.hitch(this,function(){c&&(c.destroy(),c=null);console.timeEnd("Load widgetOnScreen");b.publish("preloadWidgetsLoaded");this._doPostLoad()}))},_doPostLoad:function(){v(["dynamic-modules/postload"])},_loadPreloadWidget:function(a,c){var b=new p;if("config"===
c.mode&&!a.uri)return c=this._createPreloadWidgetPlaceHolder(a),b.resolve(c),b;if(!a.uri)return b.resolve(null),b;a.inPanel||a.closeable?(c=this._createPreloadWidgetIcon(a),b.resolve(c)):this.widgetManager.loadWidget(a).then(l.hitch(this,function(c){try{c.setPosition(c.position),this.widgetManager.openWidget(c)}catch(O){console.log(console.error("fail to startup widget "+c.name+". "+O.stack))}c.configId=a.id;b.resolve(c)}),function(a){b.reject(a)});return b},_loadPreloadGroup:function(a,c){return c.mode||
a.widgets&&0!==a.widgets.length?this.panelManager.showPanel(a).then(l.hitch(this,function(c){c.configId=a.id;this.preloadGroupPanels.push(c);return c})):z(null)},_onOpenWidgetRequest:function(a){f.forEach(this.preloadWidgetIcons,function(c){c.configId===a&&c.switchToOpen()},this);f.forEach(this.widgetManager.getControllerWidgets(),function(c){c.widgetIsControlled(a)&&c.setOpenedIds([a])},this)}});G.getInstance=function(a,c){null===I&&(I=new G(a,c),window._layoutManager=I);return I};return G})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z){var v,r=null;v=w(null,{constructor:function(){this.panels=[];this.widgetManager=z.getInstance();t(window,"resize",l.hitch(this,this.onWindowResize));this.activePanel=null;m.subscribe("/dnd/move/start",l.hitch(this,this._onMoveStart));m.subscribe("widgetActived",l.hitch(this,this._onWidgetActived))},showPanel:function(a){var d=new b,f=this.getPanelById(a.id+"_panel");f?("closed"===f.state&&this.openPanel(f),d.resolve(f)):q({Panel:this._loadPanelClass(a.panel.uri),
nls:this._loadThemeI18N(a.panel.uri)}).then(l.hitch(this,function(c){var b=a.id+"_panel",f=this.getPanelById(b),k={label:a.label,config:a,uri:a.panel.uri,position:a.panel.position,sceneView:this.sceneView,widgetManager:this.widgetManager,panelManager:this,id:b,gid:a.gid,nls:c.nls};l.mixin(k,a.panel.options);try{f=new c.Panel(k),console.log("panel ["+b+"] created.")}catch(G){console.log("create panel error: "+G+", panelId: "+b);d.reject(G);return}f.setPosition(a.panel.position);x.setVerticalCenter(f.domNode);
this.openPanel(f);this.panels.push(f);t(f.domNode,"click",l.hitch(this,this._onPanelClick,f));d.resolve(f)}));return d},setSceneView:function(a){this.sceneView=a;t(this.sceneView,"resize",l.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a.gid&&this.panels[b].id!==a.id&&this.closePanel(this.panels[b])},closeAllPanelsInGroup:function(a){for(var b=0;b<this.panels.length;b++)this.panels[b].gid===
a&&this.closePanel(this.panels[b])},openPanel:function(d){var f=new b;if("string"===typeof d&&(d=this.getPanelById(d),!d))return f.reject(),f;if(!d.started)try{d.started=!0,d.startup()}catch(E){console.error("fail to startup panel "+d.id+". "+E.stack)}if("opened"===d.state)return f.resolve(d),f;d.setState("opened");return this.playOpenPanelAnimation(d).then(l.hitch(this,function(){a.setStyle(d.domNode,"display","");d.onOpen();this._activePanel(d);return d}))},closePanel:function(d){var f=new b;return"string"===
typeof d&&(d=this.getPanelById(d),!d)||"closed"===d.state?(f.resolve(),f):this.playClosePanelAnimation(d).then(function(){this.activePanel&&this.activePanel.id===d.id&&(this.activePanel.onDeActive(),this.activePanel=null);d.setState("closed");d.onClose();d.domNode&&a.setStyle(d.domNode,"display","none")})},minimizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("minimized");try{a.onMinimize()}catch(C){console.log(console.error("fail to minimize panel "+
a.id+". "+C.stack))}},maximizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("maximized");try{a.onMaximize()}catch(C){console.log(console.error("fail to maximize panel "+a.id+". "+C.stack))}},normalizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("normal");try{a.onNormalize()}catch(C){console.log(console.error("fail to noralize panel "+
a.id+". "+C.stack))}},changeWindowStateTo:function(a,b){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"normal"===b?this.normalizePanel(a):"minimized"===b?this.minimizePanel(a):"maximized"===b?this.maximizePanel(a):console.log("error state: "+b)},getPanelById:function(a){for(var b=0;b<this.panels.length;b++)if(this.panels[b].id===a)return this.panels[b]},onWindowResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"!==this.panels[a].position.relativeTo&&
this.panels[a].resize()},onMapResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"===this.panels[a].position.relativeTo&&this.panels[a].resize()},destroyPanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;if(a.domNode){"closed"!==a.state&&this.closePanel(a);this._removePanel(a);try{a.destroy()}catch(C){console.log(console.error("fail to destroy panel "+a.id+". "+C.stack))}}},destroyAllPanels:function(){var a=f.map(this.panels,function(a){return a.id});
f.forEach(a,function(a){this.destroyPanel(a)},this);this.panels=[]},playOpenPanelAnimation:function(f){if("string"===typeof f&&(f=this.getPanelById(f),!f)||!f.openAnimation||0===f.animationDuration)return k();var m=new b;"string"===typeof f.openAnimation?"fadeIn"===f.openAnimation?(a.setStyle(f.domNode,{opacity:0,display:""}),d.fadeIn({node:f.domNode,duration:f.animationDuration,onEnd:function(){m.resolve()}}).play()):m.resolve():m.resolve();return m},playClosePanelAnimation:function(a){if("string"===
typeof a&&(a=this.getPanelById(a),!a)||!a.closeAnimation||0===a.animationDuration)return k();var f=new b;"string"===typeof a.closeAnimation&&("fadeOut"===a.closeAnimation?d.fadeOut({node:a.domNode,duration:a.animationDuration,onEnd:function(){f.resolve()}}).play():f.resolve());return f},getPositionOnMobile:function(b){if("string"===typeof b&&(b=this.getPanelById(b),!b))return{};var d=a.getMarginBox(window.jimuConfig.layoutId),f=d.h/2;b.titleHeight||(b.titleHeight=35);return"maximized"===b.windowState?
{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:d.h-b.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===b.windowState?d.h>d.w?{left:0,right:0,top:"auto",bottom:0,width:"auto",height:b.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:d.w-d.w/2,right:0,top:"auto",bottom:0,width:d.w/
2,height:b.titleHeight,contentHeight:d.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}:d.h>d.w?{left:0,right:0,top:f,bottom:0,width:"auto",height:"auto",contentHeight:d.h-f-b.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:
{left:d.w-d.w/2,right:0,top:0,bottom:0,width:d.w/2,height:"auto",contentHeight:d.h-f-b.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(a){this._activePanel(a)},_activePanel:function(b){if(this.activePanel){if(this.activePanel.id===b.id){this.activePanel.moveTopOnActive&&
a.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),a.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var d=this.widgetManager.activeWidget;d&&"active"===d.state&&d.getPanel()!==b&&(d.setState("opened"),!1===d.inPanel&&a.setStyle(d.domNode,"zIndex","undefined"!==typeof d.position.zIndex?d.position.zIndex:
"auto"),d.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=b;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&a.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(a){var b=this.panels.indexOf(a);-1<b&&this.panels.splice(b,1);this.activePanel&&this.activePanel.id===a.id&&(this.activePanel=null)},_onMoveStart:function(a){f.forEach(this.panels,function(b){b.domNode===a.node&&this._activePanel(b)},
this)},_onWidgetActived:function(b){this.activePanel&&"active"===this.activePanel.state&&b.getPanel()!==this.activePanel&&(this.activePanel.setState("opened"),a.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(a){var d=new b;p([a],function(a){d.resolve(a)});return d},_loadThemeI18N:function(a){var d=new b;a.startWith("themes")?(a=a.split("/"),
p(["dojo/i18n!"+(a[0]+"/"+a[1]+"/nls/strings")],function(a){d.resolve(a)})):d.resolve({});return d}});v.getInstance=function(){null===r&&(r=new v,window._panelManager=r);return r};return v})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/on dojo/keys esri/geometry/Extent esri/geometry/Point ./utils ./dijit/LoadingShelter ./AppStateManager ./WebSceneLoader esri/Viewpoint".split(" "),function(w,l,f,a,d,b,q,t,m,k,p,x,z,v){var r=
null,u=w(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,constructor:function(a,f){this.appConfig=a.appConfig;this.urlParams=a.urlParams;this.id=this.mapDivId=f;this.appStateManager=x.getInstance(this.urlParams);d.subscribe("appConfigChanged",l.hitch(this,this.onAppConfigChanged));d.subscribe("changeMapPosition",l.hitch(this,this.onChangeMapPosition));d.subscribe("syncViewpoint",l.hitch(this,this.onSyncViewpoint));b(window,
"resize",l.hitch(this,this.onWindowResize));b(window,"beforeunload",l.hitch(this,this.onBeforeUnload))},showMap:function(){this._showMap(this.appConfig)},_showMap:function(a){console.time("Load Map");this.loading=new p;this.loading.placeAt(this.mapDivId);this.loading.startup();a.map["3D"]?a.map.itemId?this._show3DWebScene(a):console.log("No webscene found. Please set map.itemId in config.json."):a.map.itemId?this._show2DWebMap(a):console.log("No webmap found. Please set map.itemId in config.json.")},
onBeforeUnload:function(){this.appStateManager.saveWabAppState(this.map,this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(a){a&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&this._mapMobileInfoWindow.destroy(),this.isMobileInfoWindow=!1);window.appInfo.isRunInMobile&&!this.isMobileInfoWindow?
this.isMobileInfoWindow=!0:!window.appInfo.isRunInMobile&&this.isMobileInfoWindow&&(this.isMobileInfoWindow=!1)},onChangeMapPosition:function(a){var b=l.clone(this.mapPosition);l.mixin(b,a);this.setMapPosition(b)},setMapPosition:function(b){this.mapPosition=b;b=k.getPositionStyle(b);a.setStyle(this.mapDivId,b);this.map&&this.map.resize&&this.map.resize()},getMapPosition:function(){return this.mapPosition},onSyncViewpoint:function(a){this.sceneView&&(this.sceneView.viewpoint=a.clone())},_visitConfigMapLayers:function(a,
b){f.forEach(a.map.basemaps,function(a,d){a.isOperationalLayer=!1;b(a,d)},this);f.forEach(a.map.operationallayers,function(a,d){a.isOperationalLayer=!0;b(a,d)},this)},_destroySceneView:function(){if(this.sceneView)try{this.sceneView.destroy()}catch(C){console.error(C)}this.sceneView=null;window._sceneView=null},_show3DWebScene:function(a){var b=a.map.portalUrl,c=a.map.itemId;this._destroySceneView();z.createMap(this.mapDivId,b,c).then(l.hitch(this,function(c){this._publishSceneViewEvent(c);if(a.map.mapOptions&&
(c=a.map.mapOptions.initialState)&&c.viewpoint)try{var b=v.fromJSON(c.viewpoint);b&&(this.sceneView.map.initialViewProperties.viewpoint=b,this.sceneView.viewpoint=b.clone())}catch(I){console.error(I)}}),l.hitch(this,function(){this.loading&&this.loading.destroy();d.publish("mapCreatedFailed")}))},_publishSceneViewEvent:function(a){window._sceneView=a;console.timeEnd("Load Map");this.loading&&this.loading.destroy();this.sceneView?(this.sceneView=a,console.log("sceneView changed"),d.publish("sceneViewChanged",
this.sceneView)):(this.sceneView=a,console.log("sceneView loaded"),d.publish("sceneViewLoaded",this.sceneView))},_show2DWebMap:function(b){b.map.mapOptions||(b.map.mapOptions={});var m=this._processMapOptions(b.map.mapOptions)||{};m.isZoomSlider=!1;k.createWebMap(b.map.portalUrl,b.map.itemId,this.mapDivId,{mapOptions:m,bingMapsKey:b.bingMapsKey,usePopupManager:!0}).then(l.hitch(this,function(c){var d=c.map;d.hideZoomSlider();d.infoWindow.resize(270,316);d.itemId=b.map.itemId;d.itemInfo=c.itemInfo;
d.webMapResponse=c;d.enableSnapping({snapKey:q.copyKey});a.setStyle(d.root,"zIndex",0);d._initialExtent=d.extent;f.forEach("extent center marker find query scale level".split(" "),function(a){},this);this._publishMapEvent(d)}),l.hitch(this,function(){this.loading&&this.loading.destroy();d.publish("mapCreatedFailed")}))},_processMapOptions:function(a){if(a)return a.lods||delete a.lods,a.lods&&0===a.lods.length&&delete a.lods,a=l.clone(a),a.extent&&(a.extent=new t(a.extent)),a.center&&!l.isArrayLike(a.center)&&
(a.center=new m(a.center)),a},onAppConfigChanged:function(a,b,c){this.appConfig=a;"mapChange"===b?this._recreateMap(a):"mapOptionsChange"===b&&c.initialState&&(a=c.initialState.viewpoint)&&(this.sceneView.map.initialViewProperties.viewpoint=v.fromJSON(a),this.sceneView.animateTo(v.fromJSON(a)))},_recreateMap:function(a){this.sceneView&&(d.publish("beforeSceneViewDestory",this.sceneView),this._destroySceneView());this._showMap(a)},disableWebMapPopup:function(){},enableWebMapPopup:function(){}});u.getInstance=
function(a,b){null===r&&(r=new u(a,b));return r};return u})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(w,l,f,a,d){return w([l,f],{baseClass:"jimu-loading-shelter",declaredClass:"jimu.dijit.LoadingShelter",templateString:a,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);
this.hidden&&d.setStyle(this.domNode,"display","none");d.setStyle(this.domNode,{width:"100%",height:"100%"});this.loadingImg.src=require.toUrl("jimu")+"/images/loading2.gif";this.showLoading||d.setStyle(this.imgDiv,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(a){this.domNode&&this.hidden&&("string"===typeof a&&(this.textNode.innerHTML=a),d.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&
(d.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/WebSceneLoader":function(){define("dojo/Deferred dojo/_base/lang dojo/_base/array dojo/_base/html dojo/promise/all esri/kernel esri/WebScene esri/views/SceneView esri/portal/Portal esri/portal/PortalItem esri/core/sniff ./utils ./portalUtils ./portalUrlUtils".split(" "),function(w,l,f,a,d,b,q,t,m,k,p,x,z,v){return{createMap:function(b,d,f){var k=new w;p("esri-webgl")?k=this._createMap(b,d,f):(k.reject("The browser doesn't support webgl."),
(b=l.getObject("webSceneLoader.webglSupportTip",!1,window.jimuNls))||(b="3D web apps aren't supported in your browser."),a.create("div",{"class":"app-error",innerHTML:b},document.body));return k},_createMap:function(a,b,f){x.getEsriConfig().portalUrl=v.getStandardPortalUrl(b);var r=new w,c=[];m._default=null;var p=new q({portalItem:new k({id:f})}),u=new t({map:p,container:a});c.push(p);c.push(u);b=z.getPortal(b);c.push(b.getItemById(f));c.push(b.getItemData(f));d(c).then(l.hitch(this,function(c){u.popup&&
(u.popup.closeOnViewChangeEnabled=!0);p.id=a;p.itemId=f;p.itemInfo={item:c[2],itemData:c[3]};this._handleLocalScene(u);r.resolve(u)}),l.hitch(this,function(a){console.error(a);r.reject(a)}));return r},_handleLocalScene:function(a){try{a.viewingMode&&"local"===a.viewingMode.toLowerCase()&&(l.setObject("constraints.collision.enabled",!1,a),l.setObject("constraints.tilt.max",179.99,a))}catch(u){console.error(u)}},_handleAttribution:function(d){try{if("4.0"!==b.version){var k=d.ui&&d.ui._components;k&&
0<k.length&&f.some(k,function(b){return(b=b&&b._widget)&&"esri.widgets.Attribution"===b.declaredClass?(b.domNode.parentNode.style.width="100%",a.create("span",{innerHTML:"Powered by Esri","class":"esri-attribution-powered-by"},b.domNode),!0):!1})}}catch(C){console.error(C)}}}})},"esri/WebScene":function(){define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/tsSupport/paramHelper ./Map ./core/Error ./core/requireUtils ./core/promiseUtils ./core/JSONSupport ./core/Loadable ./core/Collection ./core/urlUtils ./core/Logger ./core/accessorSupport/read ./core/accessorSupport/originUtils ./support/webSceneUtils ./Viewpoint ./kernel ./geometry/support/jsonUtils ./geometry/support/castUtils ./geometry/Geometry ./geometry/HeightModelInfo ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./webscene/Presentation ./webscene/InitialViewProperties ./webscene/Environment ./webscene/Version ./portal/PortalItem ./portal/Portal dojo/has dojo/_base/lang ./core/accessorSupport/decorators".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c,D,B,I,G,H,K,J,P,O,L,M,R,Q,T,A){var V=v.getLogger("esri.WebScene"),S=new L.default(1,8);return function(h){function e(e){e=h.call(this)||this;e.clippingArea=null;e.clippingEnabled=!1;e.heightModelInfo=null;e.sourceVersion=null;e.supportsHeightModelInfo=!0;e.presentation=null;e.initialViewProperties=null;e.portalItem=null;e.resourceInfo=null;e.authoringApp=null;e.authoringAppVersion=null;e._isAuthoringAppSetByUser=!1;e._isAuthoringAppVersionSetByUser=!1;
return e}f(e,h);e.prototype.initialize=function(){this.otherwise(function(e){V.error("#load()","Failed to load web scene",e)});if(this.resourceInfo){var e=void 0;try{e=this._validateJSON(this.resourceInfo)}catch(n){this.addResolvingPromise(m.reject(n));return}this.read(e);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}};e.prototype.getDefaults=function(e){return T.mixin(this.inherited(arguments),{presentation:{},initialViewProperties:{}})};
e.prototype.readClippingArea=function(e){return e&&e.geometry?D.fromJSON(e.geometry):null};e.prototype.writeClippingArea=function(e,n){n.clippingArea||(n.clippingArea={});n.clippingArea.geometry=e.toJSON()};e.prototype.readClippingEnabled=function(e,n){return n.clippingArea?!!n.clippingArea.clip:!1};e.prototype.writeClippingEnabled=function(e,n){this.clippingArea&&(n.clippingArea||(n.clippingArea={}),n.clippingArea.clip=e)};e.prototype.writeLayers=function(e,n,h,a){var g=this,y=T.mixin({},a,{layerContainerType:"operational-layers"});
e=e.filter(function(e){return g.verifyWriteLayer(e,y)}).map(function(e){return e.write(null,y)}).filter(function(e){return!!e});n.operationalLayers=e.toArray()};e.prototype.verifyWriteLayer=function(e,n){return e.write?!0:(n&&n.messages&&n.messages.push(new q("layer:unsupported","Layers ("+e.title+", "+e.id+") of type '"+e.declaredClass+"' cannot be persisted in web scenes",{layer:e})),!1)};e.prototype.readSourceVersion=function(e,n){e=n.version.split(".");n=e[1];return new L.default(parseInt(e[0],
10),parseInt(n,10))};e.prototype.writeSourceVersion=function(e,n){n.version=S.major+"."+S.minor};Object.defineProperty(e.prototype,"authoringApp",{set:function(e){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",e)},enumerable:!0,configurable:!0});e.prototype.writeAuthoringApp=function(e,n){n.authoringApp=e&&this._isAuthoringAppSetByUser?e:"ArcGIS API for JavaScript"};Object.defineProperty(e.prototype,"authoringAppVersion",{set:function(e){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",
e)},enumerable:!0,configurable:!0});e.prototype.writeAuthoringAppVersion=function(e,n){n.authoringAppVersion=e&&this._isAuthoringAppVersionSetByUser?e:c.version};e.prototype.writeGround=function(e,n,h,a){n[h]=e?e.write(null,a):{layers:[]}};e.prototype.readInitialViewProperties=function(e,n){e={};n.initialState&&n.initialState.environment&&(e.environment=O.fromJSON(n.initialState.environment));n.spatialReference&&(e.spatialReference=H.fromJSON(n.spatialReference));e.viewingMode=n.viewingMode||"global";
n.initialState&&n.initialState.viewpoint&&(e.viewpoint=E.fromJSON(n.initialState.viewpoint));return new P(e)};e.prototype.writeInitialViewProperties=function(e,n,h,a){e&&(h={},e.environment&&(h.environment=e.environment.write({},a)),e.viewpoint&&(h.viewpoint=e.viewpoint.toJSON()),0!==Object.keys(h).length&&(n.initialState=h),n.spatialReference=e.spatialReference?e.spatialReference.toJSON():H.WebMercator.toJSON(),n.viewingMode=null!=e.viewingMode?e.viewingMode:"global")};e.prototype.load=function(){this.addResolvingPromise(this._loadFromSource());
return this};e.prototype.read=function(e,n){var g=this;n=T.mixin({},n,{origin:"web-scene"});var h=this._isAuthoringAppVersionSetByUser,a=this._isAuthoringAppSetByUser,A=arguments;r.readLoadable(this,e,function(n){return g.inherited(A,[e,n])},n);a||(this._isAuthoringAppSetByUser=!1);h||(this._isAuthoringAppVersionSetByUser=!1);if(e.baseMap&&Array.isArray(e.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){var h=e.baseMap.elevationLayers.map(function(e){return{id:e.id}}),
c=this.presentation.slides,b=function(e,g){return e.visibleLayers.some(function(e){return e.id===g})},d=h.filter(function(e){return!c.some(function(g){return b(g,e.id)})});c.forEach(function(e){e.visibleLayers.addMany(d)})}return this};e.prototype._writeBasemapElevationLayers=function(e){var g=e.ground&&e.ground.layers;!e.baseMap&&g&&g.length&&(e.baseMap={title:"Basemap",baseMapLayers:[]});e.baseMap&&(e.baseMap.elevationLayers=T.clone(g))};e.prototype.write=function(e,n){if("loaded"!==this.loadStatus){var g=
new q("webscene:not-loaded","Web scene must be loaded before it can be serialized");V.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus);throw g;}n=T.mixin({},n,{origin:"web-scene"});g=this.inherited(arguments,[e,n]);this._writeBasemapElevationLayers(g);return g};e.prototype.save=function(e){var g=this;if(!this.portalItem)return V.error("save(): requires the .portalItem property to be set"),m.reject(new q("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"));
if("Web Scene"!==this.portalItem.type)return m.reject(new q("webscene:portal-item-wrong-type",'Portal item needs to have type "Web Scene"'));var h,a;return this.load().then(function(){return g._loadObjectsWithLayers()}).then(function(){h=g._enableVerifyItemRelativeUrls({origin:"web-scene",url:g.portalItem.itemUrl&&z.urlToObject(g.portalItem.itemUrl),messages:[],portal:g.portalItem.portal||R.getDefault(),writtenProperties:[],blockedRelativeUrls:[]});a=g.write(null,h);return g._verifySave(a,h,e).then(function(){g._updateTypeKeywords(g.portalItem);
return g.portalItem.update({data:a})})}).then(function(){u.updateOrigins(h);return m.resolve(g.portalItem)})};e.prototype.saveAs=function(e,n){var g=this;if(!e)return V.error("saveAs(portalItem): requires a portal item parameter"),m.reject(new q("webscene:portal-item-required","saveAs requires a portal item to save to"));if(e.type&&"Web Scene"!==e.type||e.id)return m.reject(new q("webscene:portal-item-already-exists","WebScene can only saveAs to a new and empty portal item"));var h=e.portal||R.getDefault(),
a,A;return this.load().then(function(){return g._loadObjectsWithLayers()}).then(function(){a=g._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:h,writtenProperties:[],blockedRelativeUrls:[]});A=g.write(null,a);return g._verifySaveAs(A,a,n).then(function(){return h._signIn()})}).then(function(){e.type="Web Scene";e.portal=h;g._updateTypeKeywords(e);return h.user.addItem({item:e,folder:n&&n.folder,data:A})}).then(function(){g.portalItem=e;k.prototype.read.call(g,{version:A.version,
authoringApp:A.authoringApp,authoringAppVersion:A.authoringAppVersion},{name:"web-scene",url:e.itemUrl&&z.urlToObject(e.itemUrl)});u.updateOrigins(a);return m.resolve(e)})};e.prototype._verifySave=function(e,n,h,a){void 0===a&&(a=!1);var g=n.messages.filter(function(e){return"error"===e.type}).map(function(e){return new q(e.name,e.message,e.details)});n.blockedRelativeUrls&&(g=g.concat(n.blockedRelativeUrls.map(function(e){return new q("url:unsupported","Relative url '"+e+"' is not supported in Web Scene")})));
h&&h.ignoreUnsupported&&(g=g.filter(function(e){return"layer:unsupported"!==e.name&&"symbol:unsupported"!==e.name&&"property:unsupported"!==e.name}));var y=h&&h.strictSchemaValidationEnabled;return(y?t.when(w,"./webscene/validator").then(function(g){g=g.validate(e);if(0<g.length){var n="webscene did not validate: "+g.join(", ");V.error((a?"saveAs":"save")+"(): "+n)}return g.map(function(e){return new q("webscene:schema-validation",e)})}).then(function(e){return y&&0<e.length?(e=C.createSchemaValidationError(e.concat(g)),
m.reject(e)):g}):m.resolve(g)).then(function(e){if(0<e.length)return m.reject(new q("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:e}))})};e.prototype._verifySaveAs=function(e,n,h){return this.canSaveAs(n)?m.reject(C.createCopyError()):this._verifySave(e,n,h,!0)};e.prototype.verifySaveAs=function(e){var g=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),h=this.write(null,g);return this._verifySaveAs(h,
g,e)};e.prototype.canSaveAs=function(e){e||(e=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write(null,e));return e.verifyItemRelativeUrls&&0<e.verifyItemRelativeUrls.writtenUrls.length};e.prototype.updateFrom=function(e,n){void 0===n&&(n={});n.environmentExcluded||(this.initialViewProperties.environment=O.prototype.clone.apply(e.environment));n.viewpointExcluded||(this.initialViewProperties.viewpoint=e.viewpoint.clone());this.initialViewProperties.spatialReference=e.spatialReference.clone();
this.initialViewProperties.viewingMode=e.viewingMode;e.clippingArea?e.clippingArea!==this.clippingArea&&(this.clippingArea=e.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1;e.heightModelInfo&&(this.heightModelInfo=e.heightModelInfo.clone());e.map===this&&e.allLayerViews.forEach(function(e){e.layer.visible=e.visible})};e.prototype._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?
this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()};e.prototype._readAndLoadFromJSON=function(e,n){e=this._validateJSON(e,n&&n.url&&n.url.path);this.read(e,n);return this._loadFromJSON(e,n)};e.prototype._extractOperationalLayers=function(e){var g=this,h=[];if(!this.sourceVersion.supportsGround&&e.baseMap&&Array.isArray(e.baseMap.elevationLayers))for(var a=0,A=e.baseMap.elevationLayers;a<A.length;a++)h.push(A[a]);var c=[],b=function(e){e.layers&&(e.layers=e.layers.filter(b));return"ArcGISTiledElevationServiceLayer"===
e.layerType?(g.sourceVersion.supportsGround||c.push(e),!1):!0};return{operationalLayers:e.operationalLayers?e.operationalLayers.filter(b):[],operationalElevationLayers:c,basemapElevationLayers:h}};e.prototype._loadFromJSON=function(e,n){var g=this,h=new x;return this._validateSpatialReference().then(function(){return g._validateHeightModelInfo()}).then(function(){return t.when(w,"./portal/support/layersCreator")}).then(function(y){var a=g._extractOperationalLayers(e),F=a.operationalLayers,A=a.operationalElevationLayers,
a=a.basemapElevationLayers,c=[],b={context:T.mixin({},n,{layerContainerType:"operational-layers"})};g.portalItem&&(b.context.portal=g.portalItem.portal||R.getDefault());if(0<a.length){var N=T.mixin({},b,{context:T.mixin({},b.context,{layerContainerType:"ground"})});N.defaultLayerType="ArcGISTiledElevationServiceLayer";c.push.apply(c,y.populateOperationalLayers(g.ground.layers,a,N))}0<A.length&&(N=T.mixin({},b,{context:T.mixin({},b.context,{layerContainerType:"ground"})}),N.defaultLayerType="ArcGISTiledElevationServiceLayer",
c.push.apply(c,y.populateOperationalLayers(h,A,N)));F&&0<F.length&&c.push.apply(c,y.populateOperationalLayers(g.layers,F,b));return m.eachAlways(c).then(function(){})}).then(function(){return g._loadObjectsWithLayers()}).then(function(){g.ground.layers.addMany(h)})};e.prototype._loadObjectsWithLayers=function(){var e=[];this.ground&&e.push(this.ground.load());this.basemap&&e.push(this.basemap.load());this.presentation.slides.forEach(function(g){g.basemap&&e.push(g.basemap.load())});return m.eachAlways(e).then(function(){})};
e.prototype._loadFromItem=function(e){var g=this;return e.load().otherwise(function(e){throw new q("webscene:load-portal-item","Failed to load portal item",{error:e});}).then(function(){if("Web Scene"!==e.type)throw new q("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:e.type});}).then(function(){return e.fetchData()}).then(function(n){g.resourceInfo=n;return g._readAndLoadFromJSON(n,{origin:"web-scene",url:z.urlToObject(e.itemUrl),portal:e.portal||
R.getDefault()})})};e.prototype._validateSpatialReference=function(){var e=this.initialViewProperties,n=this._sceneSpatialReference,h;if("local"!==e.viewingMode){if(!n.isWGS84&&!n.isWebMercator)return m.reject(new q("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator or WGS84 GCS are supported",{spatialReference:n,viewingMode:e.viewingMode}));h=function(e){return!e||e.isWGS84||e.isWebMercator}}else{if(n.isGeographic)return m.reject(new q("webscene:unsupported-spatial-reference",
"Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:n,viewingMode:e.viewingMode}));h=function(e){return!e||e.equals(n)}}var a=function(e){return e&&(e.camera&&e.camera.position&&e.camera.position.spatialReference||e.targetGeometry&&e.targetGeometry.spatialReference)},A=a(e.viewpoint);return A&&!h(A)?m.reject(new q("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",
{cameraSpatialReference:A,sceneSpatialReference:n,viewingMode:e.viewingMode})):(A=this.presentation.slides.find(function(e){return!h(a(e.viewpoint))}))?(A=a(A.viewpoint),m.reject(new q("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:A,sceneSpatialReference:n,viewingMode:e.viewingMode}))):m.resolve()};e.prototype._validateHeightModelInfo=
function(){var e=K.validateWebSceneError(this.heightModelInfo,this._sceneSpatialReference);return e?m.reject(e):m.resolve()};e.prototype._validateJSON=function(e,n){void 0===n&&(n=null);e=this._sanitizeJSON(e,n);n=L.default.parse(e.version,"webscene");S.validate(n);e.version=n.major+"."+n.minor;1===n.major&&2>=n.minor&&(e.spatialReference=H.WebMercator.toJSON());return e};e.prototype._sanitizeJSON=function(e,n){void 0===n&&(n=null);return{version:e.version||"",baseMap:e.baseMap,ground:e.ground,operationalLayers:e.operationalLayers,
authoringApp:e.authoringApp||"",authoringAppVersion:e.authoringAppVersion||"",viewingMode:e.viewingMode||"global",presentation:e.presentation&&J.sanitizeJSON(e.presentation)||{},initialState:e.initialState,spatialReference:e.spatialReference||H.WebMercator.toJSON(),heightModelInfo:e.heightModelInfo||null,clippingArea:e.clippingArea}};e.prototype._updateTypeKeywords=function(e){"local"===this.initialViewProperties.viewingMode?e.typeKeywords?-1===e.typeKeywords.indexOf("ViewingMode-Local")&&e.typeKeywords.push("ViewingMode-Local"):
e.typeKeywords=["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(function(e){return"ViewingMode-Local"!==e}));e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter(function(e,g,h){return h.indexOf(e)===g}))};Object.defineProperty(e.prototype,"_sceneSpatialReference",{get:function(){return this.initialViewProperties.spatialReference||H.WebMercator},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"_verifyItemRelativeRootPath",
{get:function(){return this.portalItem&&this.portalItem.itemUrl?z.urlToObject(this.portalItem.itemUrl).path:null},enumerable:!0,configurable:!0});e.prototype._enableVerifyItemRelativeUrls=function(e){var g=this._verifyItemRelativeRootPath;g&&(e.verifyItemRelativeUrls={rootPath:g,writtenUrls:[]});return e};e.fromJSON=function(e){return new this({resourceInfo:e})};e.VERSION=S;a([A.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],e.prototype,"basemap",void 0);a([A.property({type:I}),
A.cast(B.cast)],e.prototype,"clippingArea",void 0);a([A.reader("clippingArea")],e.prototype,"readClippingArea",null);a([A.writer("clippingArea")],e.prototype,"writeClippingArea",null);a([A.property({type:Boolean})],e.prototype,"clippingEnabled",void 0);a([A.reader("clippingEnabled",["clippingArea"])],e.prototype,"readClippingEnabled",null);a([A.writer("clippingEnabled")],e.prototype,"writeClippingEnabled",null);a([A.property({type:G,json:{write:!0}})],e.prototype,"heightModelInfo",void 0);a([A.property()],
e.prototype,"layers",void 0);a([A.writer("layers")],e.prototype,"writeLayers",null);a([A.property({readOnly:!0,type:L.default,json:{write:{allowNull:!0}}})],e.prototype,"sourceVersion",void 0);a([A.reader("sourceVersion",["version"])],e.prototype,"readSourceVersion",null);a([A.writer("sourceVersion")],e.prototype,"writeSourceVersion",null);a([A.property({type:String,json:{write:{allowNull:!0}}})],e.prototype,"authoringApp",null);a([A.writer("authoringApp")],e.prototype,"writeAuthoringApp",null);a([A.property({type:String,
json:{write:{allowNull:!0}}})],e.prototype,"authoringAppVersion",null);a([A.writer("authoringAppVersion")],e.prototype,"writeAuthoringAppVersion",null);a([A.property({json:{write:{allowNull:!0,enabled:!0}}})],e.prototype,"ground",void 0);a([A.writer("ground")],e.prototype,"writeGround",null);a([A.property({type:J,json:{write:!0}})],e.prototype,"presentation",void 0);a([A.property({type:P})],e.prototype,"initialViewProperties",void 0);a([A.reader("initialViewProperties",["initialState.environment",
"spatialReference","viewingMode","initialState.viewpoint"])],e.prototype,"readInitialViewProperties",null);a([A.writer("initialViewProperties")],e.prototype,"writeInitialViewProperties",null);a([A.property({type:M})],e.prototype,"portalItem",void 0);a([A.property()],e.prototype,"resourceInfo",void 0);a([d(0,A.cast(M))],e.prototype,"saveAs",null);a([A.property()],e.prototype,"_sceneSpatialReference",null);a([A.property()],e.prototype,"_verifyItemRelativeRootPath",null);return e=a([A.subclass("esri.WebScene")],
e)}(A.declared(b,p,k))})},"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../MultiOriginJSONSupport"],function(w,l,f){Object.defineProperty(l,"__esModule",{value:!0});l.updateOrigins=function(a){a&&a.writtenProperties&&a.writtenProperties.forEach(function(a){var b=a.target;a.newOrigin&&a.oldOrigin!==a.newOrigin&&b.isInstanceOf(f)&&b.updateOrigin(a.propName,a.newOrigin)})}})},"esri/support/webSceneUtils":function(){define(["require","exports","../core/Error"],function(w,
l,f){Object.defineProperty(l,"__esModule",{value:!0});l.createCopyError=function(){return new f("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")};l.isCopyError=function(a){return a&&"webscene:failed-to-copy-embedded-resources"===a.name};l.createSchemaValidationError=function(a){return new f("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:a})};l.isSchemaValidationError=
function(a){return a&&"webscene:schema-validation"===a.name}})},"esri/geometry/support/castUtils":function(){define(["../Point","../Polyline","../Polygon","../Multipoint","../Extent"],function(w,l,f,a,d){return{cast:function(b){return!b||b.declaredClass?b||null:void 0!==b.x&&void 0!==b.y?new w(b):void 0!==b.paths?new l(b):void 0!==b.rings?new f(b):void 0!==b.points?new a(b):void 0!==b.xmin&&void 0!==b.ymin&&void 0!==b.xmax&&void 0!==b.ymax?new d(b):null}}})},"esri/webscene/Presentation":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/Collection ../core/collectionUtils ../core/accessorSupport/decorators ./Slide".split(" "),
function(w,l,f,a,d,b,q,t,m){var k=b.ofType(m);return function(b){function d(a){a=b.call(this,a)||this;a.slides=new k;return a}f(d,b);Object.defineProperty(d.prototype,"slides",{set:function(a){this._set("slides",q.referenceSetter(a,this._get("slides"),k))},enumerable:!0,configurable:!0});d.prototype.clone=function(){return new this.constructor({slides:this.slides.clone()})};d.sanitizeJSON=function(a){return{slides:void 0!==a.slides&&Array.isArray(a.slides)?a.slides.filter(function(a){return a&&!!a.viewpoint}).map(function(a){return m.sanitizeJSON(a)}):
[]}};a([t.property({type:k,json:{write:!0}}),t.cast(q.castForReferenceSetter)],d.prototype,"slides",null);return d=a([t.subclass("esri.webscene.Presentation")],d)}(t.declared(d))})},"esri/webscene/Slide":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ../Viewpoint ../Basemap ../support/basemapUtils ../core/JSONSupport ../core/lang ../core/Logger ../core/Collection ../core/collectionUtils ../core/promiseUtils ./Environment ./Lighting ./support/Description ./support/Title ./support/Thumbnail dojo/_base/lang dojo/promise/all ../views/3d/lib/glMatrix".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c,D,B,I){var G=0,H=function(c){function b(){var a=null!==c&&c.apply(this,arguments)||this;a.id="";return a}f(b,c);k=b;b.prototype.clone=function(){return new k({id:this.id})};a([d.property({type:String,json:{write:!0}})],b.prototype,"id",void 0);return b=k=a([d.subclass()],b);var k}(d.declared(m)),K=x.ofType(H),J=p.getLogger("esri.webscene.Slide");return function(m){function p(a){a=m.call(this,a)||this;a._currentAnimation=null;a.id=Date.now().toString(16)+
"-slide-"+G++;a.title=new E.default;a.description=new C.default;a.thumbnail=new c.default;a.viewpoint=null;a.basemap=null;a.environment=new r;a.visibleLayers=new K;return a}f(p,m);p.prototype.castBasemap=function(a){return t.ensureType(a)};Object.defineProperty(p.prototype,"visibleLayers",{set:function(a){this._set("visibleLayers",z.referenceSetter(a,this._get("visibleLayers"),K))},enumerable:!0,configurable:!0});p.prototype.castVisibleLayers=function(a){return a&&"function"===typeof a.map?a.map(function(a){if("string"===
typeof a)return{id:a};if(a.id)return{id:a.id};J.warn('Invalid visible layer, expected { id }, Layer or "id"');return a}):a};p.prototype.clone=function(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||
null})};p.prototype._updateVisibleLayersFrom=function(a){var c=this,b=[];return v.eachAlways(this._allLayers(a.map).map(function(c){return a.whenLayerView(c).then(function(a){a.visible&&b.push(new H({id:a.layer.id}))})}).toArray()).then(function(){c.visibleLayers.removeAll();c.visibleLayers.addMany(b)})};p.prototype.updateFrom=function(a,b){var d=this;b=D.mixin({screenshot:D.mixin({format:"jpeg",quality:80,width:120,height:75},b&&b.screenshot)},b);return a.then(function(){d.viewpoint=a.viewpoint.clone();
d.environment.lighting=u.prototype.clone.apply(a.environment.lighting);d.basemap=a.map.basemap&&a.map.basemap.clone()||null;return d._updateVisibleLayersFrom(a)}).then(function(){return a.takeScreenshot(b.screenshot)}).then(function(a){d.thumbnail=new c.default({url:a.dataURL});return d})};p.prototype.applyTo=function(a,c){var b=this,d=D.mixin({animate:!0},c);return this._applyBasemap(a).then(function(){return B([b._applyViewpoint(a,d),b._applyLayerVisibility(a,d)])}).then(function(){return b})};
p.prototype._applyBasemap=function(a){var c=this;return this.basemap?this.basemap.load().always(function(){a.map.basemap=t.clonePreservingTiledLayers(c.basemap,a.map.basemap)}):v.resolve()};p.prototype._allLayers=function(a){var c=new x;this._collectLayers(a,c);this._collectLayers(a.ground,c);return c};p.prototype._collectLayers=function(a,c){var b=this;a.layers.forEach(function(a){c.add(a);a.layers&&b._collectLayers(a,c)})};p.prototype._applyLayerVisibility=function(a,c){var b=this;if(this.visibleLayers){var d=
this._allLayers(a.map);if(c.applyToLayerViews)return v.eachAlways(d.map(function(c){return a.whenLayerView(c).then(function(a){a.visible=b.visibleLayers.some(function(A){return A.id===a.layer.id})})}).toArray());d.forEach(function(a){return a.visible=b.visibleLayers.some(function(A){return A.id===a.id})});return v.resolve()}};p.prototype._applyViewpoint=function(a,c){if(this.viewpoint){this.viewpoint.camera.fov=a.camera.fov;if(c.animate){if(this.get("environment.lighting.date"))return this._animateToLighting(a,
c).then(function(){});a.environment.lighting=this.environment.lighting.clone();return a.goTo(this.viewpoint,c).then(function(){})}a.viewpoint=this.viewpoint;a.environment.lighting=this.environment.lighting.clone()}return v.resolve()};p.prototype._animateToLighting=function(a,c){var b=this,d;"global"===a.viewingMode&&(d=this._animateLightingWithCamera(a));this._currentAnimation&&(this._currentAnimation.stop(),this._currentAnimation=null);a.environment.lighting.cameraTrackingEnabled=!1;a.environment.lighting.directShadowsEnabled=
this.environment.lighting.directShadowsEnabled;null!=this.environment.lighting.displayUTCOffset&&(a.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);var f=a.goTo(this.viewpoint,c);this._currentAnimation=f;this._currentAnimation.always(function(){d&&d.remove();b._currentAnimation===f&&(a.environment.lighting.cameraTrackingEnabled=!0)});this._currentAnimation.then(function(){a.environment.lighting=b.environment.lighting.clone()});return this._currentAnimation};p.prototype._getTime=
function(a){var c=a.getTime();a=3600*a.getUTCHours()+60*a.getUTCMinutes()+a.getUTCSeconds();return[c,a]};p.prototype._setTime=function(a,c,b){a.setTime(c);a.setUTCHours(b/3600);a.setUTCMinutes(b%3600/60);a.setUTCSeconds(b%3600%60);return a};p.prototype._animateLightingWithCamera=function(a){var c=this,b=I.vec3d,d=this._getTime(new Date(a.environment.lighting.date.toString())),f=d[0],A=d[1],d=this._getTime(this.environment.lighting.date),k=d[0],m=d[1],h=a.renderCoordsHelper,e=[0,0,0];h.toRenderCoords(a.camera.position,
e);var g=[0,0,0];h.toRenderCoords(this.viewpoint.camera.position,g);var n=[0,0,0],y=new Date;return a.watch("camera",function(F){h.toRenderCoords(F.position,n);F=b.dist2(e,n);var N=b.dist2(g,n),d=0;0!==F+N&&(d=F/(F+N));a.environment.lighting.date=c._setTime(y,f+(k-f)*d,A+(m-A)*d)})};p.createFrom=function(a,c){return(new this).updateFrom(a,c)};p.sanitizeJSON=function(a){var c;c=void 0!==a.visibleLayers&&Array.isArray(a.visibleLayers)?k.clone(a.visibleLayers):[];c={id:a.id||"",title:a.title||{text:""},
thumbnail:a.thumbnail||{url:""},viewpoint:a.viewpoint,baseMap:a.baseMap,visibleLayers:c};void 0!==a.description&&(c.description=a.description);void 0!==a.environment&&(c.environment=r.sanitizeJSON(a.environment));return c};a([d.property({json:{write:!0}})],p.prototype,"id",void 0);a([d.property({type:E.default,json:{write:!0}})],p.prototype,"title",void 0);a([d.property({type:C.default,json:{write:!0}})],p.prototype,"description",void 0);a([d.property({type:c.default,json:{write:!0}})],p.prototype,
"thumbnail",void 0);a([d.property({type:b,json:{write:!0}})],p.prototype,"viewpoint",void 0);a([d.property({type:q,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],p.prototype,"basemap",void 0);a([d.cast("basemap")],p.prototype,"castBasemap",null);a([d.property({type:K,json:{write:!0}})],p.prototype,"visibleLayers",null);a([d.cast("visibleLayers")],p.prototype,"castVisibleLayers",null);a([d.property({type:r,json:{write:!0}})],p.prototype,"environment",void 0);return p=a([d.subclass("esri.webscene.Slide")],
p)}(d.declared(m))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators ./Lighting".split(" "),function(w,l,f,a,d,b,q){return function(d){function m(a){a=d.call(this,a)||this;a.lighting=new q;return a}f(m,d);k=m;m.prototype.clone=function(){return new k({lighting:q.prototype.clone.call(this.lighting)})};m.sanitizeJSON=function(a){return{lighting:a.lighting?q.sanitizeJSON(a.lighting):
(new q).toJSON()}};a([b.property({type:q,json:{write:!0}})],m.prototype,"lighting",void 0);return m=k=a([b.subclass("esri.webscene.Environment")],m);var k}(b.declared(d))})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),function(w,l,f,a,d,b){return function(d){function q(a){a=d.call(this,a)||this;a.date=null;a.directShadowsEnabled=!1;a.displayUTCOffset=
null;return a}f(q,d);m=q;q.prototype.readDate=function(a,b){return null!=b.datetime&&new Date(b.datetime)||null};q.prototype.writeDate=function(a,b){null!=a&&(b.datetime=a.getTime())};q.prototype.readDirectShadowsEnabled=function(a,b){return!!b.directShadows};q.prototype.writedirectShadowsEnabled=function(a,b){a&&(b.directShadows=!0)};q.prototype.writeDisplayUTCOffset=function(a,b){null!=a&&(b.displayUTCOffset=a)};q.prototype.clone=function(){return new m({date:null!=this.date?new Date(this.date.getTime()):
null,directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null})};q.sanitizeJSON=function(a){var b={datetime:a.datetime};void 0!==a.directShadows&&(b.directShadows=!!a.directShadows);void 0!==a.displayUTCOffset&&(b.displayUTCOffset=a.displayUTCOffset);return b};a([b.property({type:Date})],q.prototype,"date",void 0);a([b.reader("date",["datetime"])],q.prototype,"readDate",null);a([b.writer("date")],q.prototype,"writeDate",null);a([b.property({type:Boolean})],
q.prototype,"directShadowsEnabled",void 0);a([b.reader("directShadowsEnabled",["directShadows"])],q.prototype,"readDirectShadowsEnabled",null);a([b.writer("directShadowsEnabled")],q.prototype,"writedirectShadowsEnabled",null);a([b.property({type:Number,json:{write:!0}})],q.prototype,"displayUTCOffset",void 0);a([b.writer("displayUTCOffset")],q.prototype,"writeDisplayUTCOffset",null);return q=m=a([b.subclass("esri.webscene.Lighting")],q);var m}(b.declared(d))})},"esri/webscene/support/Description":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(w,l,f,a,d,b){Object.defineProperty(l,"__esModule",{value:!0});w=function(d){function q(){var a=null!==d&&d.apply(this,arguments)||this;a.text="";return a}f(q,d);m=q;q.prototype.clone=function(){return new m({text:this.text})};a([b.property({type:String,json:{write:!0}})],q.prototype,"text",void 0);return q=m=a([b.subclass("esri.webscene.support.Description")],q);var m}(b.declared(d));l.default=w})},"esri/webscene/support/Title":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(w,l,f,a,d,b){Object.defineProperty(l,"__esModule",{value:!0});w=function(d){function q(){var a=null!==d&&d.apply(this,arguments)||this;a.text="";return a}f(q,d);m=q;q.prototype.clone=function(){return new m({text:this.text})};a([b.property({type:String,json:{write:!0}})],q.prototype,"text",void 0);return q=m=a([b.subclass("esri.webscene.support.Title")],q);var m}(b.declared(d));l.default=w})},"esri/webscene/support/Thumbnail":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(w,l,f,a,d,b){Object.defineProperty(l,"__esModule",{value:!0});w=function(d){function q(){var a=null!==d&&d.apply(this,arguments)||this;a.url="";return a}f(q,d);m=q;q.prototype.clone=function(){return new m({url:this.url})};a([b.property({type:String,json:{write:!0}})],q.prototype,"url",void 0);return q=m=a([b.subclass("esri.webscene.support.Thumbnail")],q);var m}(b.declared(d));l.default=w})},"esri/webscene/InitialViewProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Viewpoint ../core/Accessor ../geometry/SpatialReference ./Environment ../core/accessorSupport/decorators".split(" "),
function(w,l,f,a,d,b,q,t,m){return function(b){function k(a){a=b.call(this,a)||this;a.environment=new t;a.spatialReference=null;a.viewpoint=null;return a}f(k,b);x=k;Object.defineProperty(k.prototype,"viewingMode",{set:function(a){"local"!==a&&"global"!==a||this._set("viewingMode",a)},enumerable:!0,configurable:!0});k.prototype.clone=function(){return new x({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?
this.viewpoint.clone():null})};a([m.property({type:t})],k.prototype,"environment",void 0);a([m.property({type:q})],k.prototype,"spatialReference",void 0);a([m.property()],k.prototype,"viewingMode",null);a([m.property({type:d})],k.prototype,"viewpoint",void 0);return k=x=a([m.subclass("esri.webscene.InitialViewProperties")],k);var x}(m.declared(b))})},"esri/webscene/Version":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/Version"],function(w,l,f,a){Object.defineProperty(l,
"__esModule",{value:!0});w=function(a){function b(b,d){return a.call(this,b,d,"webscene")||this}f(b,a);Object.defineProperty(b.prototype,"supportsGround",{get:function(){return this.since(1,8)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"supportsVisibleElevationLayersInSlides",{get:function(){return this.lessThan(1,8)},enumerable:!0,configurable:!0});return b}(a.Version);l.Version=w;l.default=w})},"esri/core/Version":function(){define(["require","exports","./Error"],function(w,
l,f){Object.defineProperty(l,"__esModule",{value:!0});w=function(){function a(a,b,f){void 0===f&&(f="");this.major=a;this.minor=b;this._context=f}a.prototype.lessThan=function(a,b){return this.major<a||a===this.major&&this.minor<b};a.prototype.since=function(a,b){return!this.lessThan(a,b)};a.prototype.validate=function(a){if(this.major!==a.major)throw new f((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+"version is '"+this.major+"', but got '${version.major}.${version.minor}'",
{version:a});};a.prototype.clone=function(){return new a(this.major,this.minor,this._context)};a.parse=function(d,b){void 0===b&&(b="");var q=d.split("."),t=q[0],q=q[1],m=/^\s*\d+\s*$/;if(!t||!t.match||!t.match(m))throw new f((b&&b+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:d});if(!q||!q.match||!q.match(m))throw new f((b&&b+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:d});d=parseInt(t,10);t=parseInt(q,
10);return new a(d,t,b)};return a}();l.Version=w})},"esri/views/SceneView":function(){define("../core/accessorSupport/watch dojo/_base/lang dojo/_base/kernel dojo/dom dojo/Deferred dojo/when ./View ./BreakpointsOwner ./DOMContainer ./ViewAnimation ./animation/easing ../geometry/HeightModelInfo ../geometry/SpatialReference ../geometry/support/scaleUtils ../geometry/support/webMercatorUtils ../Camera ../Graphic ../geometry/Point ../geometry/Extent ../geometry/ScreenPoint ../Viewpoint ../core/Scheduler ../core/sniff ../core/watchUtils ../core/promiseUtils ../core/Error ../core/Logger ../core/HandleRegistry ../webscene/Environment ./support/screenshotUtils ./support/WebGLRequirements ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/constraints/SceneViewConstraints ./3d/input/SceneInputManager ./3d/lib/glMatrix ./3d/support/cameraUtils ./3d/support/viewpointUtils ./3d/support/projectionUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Selector ./3d/support/CombinedElevationProvider ./3d/support/HighlightOptions ./3d/support/RenderCoordsHelper ./3d/support/MapCoordsHelper ./3d/support/ResourceController ./3d/support/DisplayQualityProfile ./3d/support/QualitySettings ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/support/debugFlags ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/layers/graphics/Deconflictor ./3d/layers/GraphicsView3D ./3d/navigation/spherical/NavigationSpherical ./3d/navigation/planar/NavigationPlanar ./3d/support/Frustum ./ui/3d/DefaultUI3D".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c,D,B,I,G,H,K,J,P,O,L,M,R,Q,T,A,V,S,h,e,g,n,y,F,N,U,Y,W,ca,X,aa,da,ea,ia,ba,la,qa,ja,ra,ga,ha){function na(e,g){return function(){return this._internallyReady?g.apply(this,arguments):this._get(e)}}function oa(e,g){return function(n){if(this._internallyReady)return g.apply(this,arguments);this._initialProps[e]=n;this._set(e,n);ta[e]&&this.notifyChange("initialExtentRequired")}}aa=aa.default;var ka=P.getLogger("esri.views.SceneView"),sa=S.vec3d,ma=sa.create();
P=new E(0,0,0);var Z=new u(new E(0,0,0)),va={point:P,retval:null},pa={heading:0,tilt:0},ta={camera:["viewpoint"],viewpoint:["extent"],extent:["center","scale"],scale:["zoom"],center:[],zoom:[]},wa=Object.keys(ta);da=da.default;return m.createSubclass([q,t],{declaredClass:"esri.views.SceneView",properties:{animation:{type:k,value:null},basemapTerrain:{readOnly:!0,value:null},elevationProvider:{readOnly:!0,value:null},camera:{copy:function(e,g){e.position.x=g.position.x;e.position.y=g.position.y;e.position.z=
g.position.z;e.position.spatialReference=g.position.spatialReference;e.heading=g.heading;e.tilt=g.tilt},type:u},canvas:{readOnly:!0,value:null},center:{copy:function(e,g){if(!e)return g.clone();e.x=g.x;e.y=g.y;e.z=g.z;e.spatialReference=g.spatialReference;return e},dependsOn:["pointsOfInterest.centerOnContent.location"],type:E},clippingArea:{type:c,dependsOn:["map.clippingArea","map.clippingEnabled","viewingMode"],get:function(){if("global"===this.viewingMode)return null;if(this._userClippingArea)return this._userClippingArea;
var e=this.get("map.clippingEnabled"),g=this.get("map.clippingArea");if(!e||!g)return this._clippingArea=null;if(!(g instanceof c))return ka.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(r.canProject(g.spatialReference,this.spatialReference))g=r.project(g,this.spatialReference);else return ka.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;return this._clippingArea&&g&&this._clippingArea.equals(g)?
this._clippingArea:this._clippingArea=g},set:function(e){this.ready&&"global"===this.viewingMode&&e?ka.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=e,this.notifyChange("clippingArea"))}},constraints:{type:A,value:null},dataExtent:{dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0,get:function(){function e(e){e&&(e=r.project(e,n))&&(h&&(e=e.intersection(h)),e&&g.push(e))}var g=[],n=this.spatialReference||z.WGS84,h=this.clippingArea;
h&&(h=r.project(h,n));var a=this._get("basemapTerrain");a&&a.spatialReference&&e(new c({xmin:a.extent[0],ymin:a.extent[1],zmin:0,xmax:a.extent[2],ymax:a.extent[3],zmax:0,spatialReference:a.spatialReference}));this.map&&this.map.allLayers.forEach(function(g){e(g.fullExtent)});return 0<g.length?(a=g.reduce(function(e,g){return e.union(g)}),a.hasZ?(a.zmin=Math.min(0,a.zmin),a.zmax=Math.max(0,a.zmax)):(a.zmin=0,a.zmax=0),a):new c({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:n})}},environment:{value:null,
set:function(e){e!==this._defaults.environment&&(this._externallySet.environment=!0);e?e instanceof Q?this._set("environment",e):e instanceof L?this.environment.lighting=e.lighting:e.declaredClass?this._set("environment",e):this._set("environment",new Q(e)):this._set("environment",new Q)}},environmentManager:{},extent:{copy:function(e,g){e.xmin=g.xmin;e.ymin=g.ymin;e.zmin=g.zmin;e.xmax=g.xmax;e.ymax=g.ymax;e.zmax=g.zmax;e.spatialReference=g.spatialReference},type:c},fullOpacity:1,groundExtent:{dependsOn:["basemapTerrain.extent"],
readOnly:!0,get:function(){var e=this._get("basemapTerrain");if(e&&e.spatialReference){var g=e.extent;return new c({xmin:g[0],ymin:g[1],xmax:g[2],ymax:g[3],spatialReference:e.spatialReference})}return new c({spatialReference:this.spatialReference||z.WGS84})}},initialExtentRequired:{dependsOn:["map.initialViewProperties.viewpoint"],get:function(){if(this.get("map.initialViewProperties.viewpoint"))return!1;for(var e=0;e<wa.length;e++)if(this._initialProps&&void 0!==this._initialProps[wa[e]])return!1;
return!0}},interacting:{dependsOn:["navigation.interacting"],get:function(){return!(!this.navigation||!this.navigation.interacting)}},map:{value:null},mapCoordsHelper:{},pointsOfInterest:da,screenSizePerspectiveEnabled:!0,navigation:{readOnly:!0,value:null},inputManager:{},qualityProfile:{set:function(e){ca.isValidProfile(e)&&(ca.apply(e,this),this._set("qualityProfile",e))}},qualitySettings:{type:X},ready:{dependsOn:["viewingMode"]},renderCoordsHelper:{},resolution:{dependsOn:["scale","spatialReference"],
readOnly:!0,get:function(){return null!=this.spatialReference?v.getResolutionForScale(this.scale,this.spatialReference):0}},scale:{dependsOn:["pointsOfInterest.centerOnContent.distance"]},spatialReference:{dependsOn:["map.initialViewProperties.spatialReference","defaultsFromMap.isSpatialReferenceDone"]},isHeightModelInfoRequired:!0,type:"3d",ui:{type:ha},updating:{},updatingPercentage:0,viewingMode:{dependsOn:["map.initialViewProperties.viewingMode","spatialReference"],get:function(){var e=this.get("map.initialViewProperties.viewingMode"),
g=this.spatialReference;e||(e=!g||g.isWebMercator||g.isWGS84?"global":"local");return e},set:function(e){this._internallyReady?ka.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(e)?this._override("viewingMode",e):void 0===e&&this._clearOverride("viewingMode")}},viewpoint:{copy:function(e,g){e.rotation=g.rotation;e.scale=g.scale;e.targetGeometry=g.targetGeometry;e.camera=g.camera},dependsOn:["camera"],type:B},zoom:{dependsOn:["scale"]},highlightOptions:{type:N}},
getDefaults:function(e){var g=this.inherited(arguments);g.constraints||e.constraints||(this._defaults.constraints=new A,g.constraints=this._defaults.constraints);g.environment||e.environment||(this._defaults.environment=new Q,g.environment=this._defaults.environment);g.qualitySettings=new X;g.qualityProfile=ca.getDefaultProfile();g.highlightOptions=new N;return g},constructor:function(){H.when(this,"ready",this._viewReadyHandler.bind(this));this._internallyReady=!1;this._initialProps={};this._initialDefaultSpatialReference=
this._gotoTask=this._userClippingArea=null;this._initCoordinateSystem();this._frustum=new ga;this._clippingArea=this._constraints=this._animationStateWatcher=null;this.inputManager=new V({view:this});this._defaults={};this._externallySet={};this.resourceController=new W(this);this.deconflictor=new la(this);this._evaluateUpdating=this._evaluateUpdating.bind(this);this._layerViewsUpdatingHandles={};this._navigationHandles=new O;this._stageHandles=new O;this._navigationPauseNotifications=!1;this._navigationHandles.add([H.on(this,
"navigation","currentViewChanged",this._navigationCurrentViewChanged.bind(this),null,null,!0),H.on(this,"navigation","currentViewReachedTarget",this._navigationCurrentViewReachedTarget.bind(this),null,null,!0),H.on(this,"navigation","targetViewChanged",function(e){this._navigationPauseNotifications||this._navigationTargetViewChanged(e)}.bind(this),null,null,!0),H.on(this,"navigation","animationStarted",function(e){this._navigationPauseNotifications||this._navigationAnimationStarted(e)}.bind(this),
null,null,!0)]);this.watch("map",function(e){e&&e.load&&e.load()})},initialize:function(){this.environmentManager=new T({view:this});this._updateUpdatingMonitorsHandle=this.allLayerViews.on("change",this._updateUpdatingMonitors.bind(this));this._updateUpdatingMonitors({added:this.allLayerViews.toArray(),removed:[],moved:[]});H.whenNot(this,"ready",this._viewUnreadyHandler.bind(this));H.init(this.qualitySettings,"gpuMemoryLimit",function(e){this.resourceController&&this.resourceController.setMaxGpuMemory(e)}.bind(this))},
destroy:function(){w.dispatchTarget(this);this.environmentManager.destroy();this._disposeGraphicsView();this._updateUpdatingMonitorsHandle.remove();this._updateUpdatingMonitorsHandle=null;this._navigationHandles.remove();this._navigationHandles=null;this._stageHandles.remove();this.inputManager&&(this.inputManager.destroy(),this.inputManager=null)},destroyLayerViews:function(){for(var e in this._layerViewsUpdatingHandles)this._layerViewsUpdatingHandles[e].remove();this._layerViewsUpdatingHandles=
{};this._disposeSurface();this.inherited(arguments);this._stage&&(this._stage.dispose(),this._stage=null,this._stageHandles.remove());this._setCanvas(null);this.deconflictor.destroy();this.deconflictor=null;this.resourceController.destroy();this.resourceController=null},on:function(e,g,n){var h=this.inputManager.viewEvents.register(e,g,n);return h?h:this.inherited(arguments)},toMap:function(e,g,n){if(!this._internallyReady)return ka.error("#toMap()","Scene view cannot be used before it is ready"),
null;e=this._normalizePointArgs(e,g,void 0,n);g=this._stage.pick([e.point.x,this.height-e.point.y]).getMinResult();return this._computeMapPointFromIntersectionResult(g,e.retval)},toScreen:function(e,n,h,a){if(!this._internallyReady)return ka.error("#toScreen()","Scene view cannot be used before it is ready"),null;e=this._normalizePointArgs(e,n,h,a);g.pointToVector(e.point,ma,this.renderSpatialReference);return this.engineToScreen(ma,e.retval)},pixelSizeAt:function(e,n,h){if(!this._internallyReady)return ka.error("#pixelSizeAt()",
"Scene view cannot be used before it is ready"),null;if("esri.geometry.ScreenPoint"===e.declaredClass){if(!this._stage.pick([e.x,this.height-e.y]).getMinResult().getIntersectionPoint(ma))return 0}else e=this._normalizePointArgs(e,n,h,void 0),g.pointToVector(e.point,ma,this.renderSpatialReference);return this.navigation.currentCamera.computePixelSizeAt(ma)},hitTest:function(e,g){if(!this._internallyReady)return ka.error("#hitTest()","Scene view cannot be used before it is ready"),null;e=this._normalizePointArgs(e,
g,void 0,void 0);var n=[e.point.x,this.height-e.point.y],h=this._stage.pick(n,null,!0);e=h.getMinResult();var a=this._computeMapPointFromIntersectionResult(e),y;switch(e.targetType){case "None":y=null;break;case "StageObject":y=this._getGraphicFromStageObject(e.target,e.triangleNr);break;case "StagePoint":y=this._getGraphicFromStagePoint(e.target)}return b(y).otherwise(function(){return null}).then(function(e){var g=[];(e||a)&&g.push({mapPoint:a,graphic:e});e={screenPoint:n,results:g};ea.SCENEVIEW_HITTEST_RETURN_SELECTOR&&
(e.selector=h);return e})},goTo:function(g,n){if(this._internallyReady)return n=l.mixin({animate:!0},n),g=e.create(this,g,n),this._gotoTask={},n.animate?this._gotoAnimated(g,n):this._gotoImmediate(g,n);ka.error("#goTo()","Scene view cannot be used before it is ready")},animateTo:function(e,g){f.deprecated(this.declaredClass+".animateTo is deprecated. Use .goTo instead.","","4.0");return this.goTo(e,g)},takeScreenshot:function(e){if(this._internallyReady){e=M.adjustScreenshotSettings(e,this);var g=
new d;this._stage.requestScreenCapture(e,function(e){I.schedule(function(){g.resolve(e)})});return g.promise}ka.error("#takeScreenshot()","Scene view cannot be used before it is ready")},engineToScreen:function(e,g){var n=sa.create();this._stage.getCamera().projectPoint(e,n);e=n[0];var h=this.height-n[1],n=n[2];return g?(g.x=e,g.y=h,g.z=n,g):new D({x:e,y:h,z:n})},getDefaultSpatialReference:function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||
this.get("defaultsFromMap.isSpatialReferenceDone")&&this._initialDefaultSpatialReference||null},validate:function(){var e=R.check();G("safari")&&9>G("safari")&&(e=new J("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:G("safari")}));return e?(ka.warn("#validate()",e.message),K.reject(e)):K.resolve()},isSpatialReferenceSupported:function(e,g){var n=e.isGeographic,h=e.isWebMercator,a=e.isWGS84,y="local"===
this.viewingMode,F=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));if(F){if(y&&n||!y&&!h&&!a)return!1}else if(n&&!a)return!1;if(g)if(ba.isTiledLayer(g)){if(F?n=ba.getTiledLayerInfo(g,e,this.viewingMode):(n=ba.getTiledLayerInfo(g,e,"global"),null==n.tileInfo&&(n=ba.getTiledLayerInfo(g,e,"local"))),null==n.tileInfo)return!1}else if((a||h)&&!y)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=e),F||this.ready||(this.viewingMode=
"global"),!1;return!0},has:function(e){return this._stage.has(e)},flushDisplayModifications:function(){this._stage.processDirty()},getFrustum:function(){this._frustum.dirty&&this._frustum.update(this.navigation.currentCamera);return this._frustum},getDrawingOrder:function(e){return this.allLayerViews.findIndex(function(g){return g.layer&&g.layer.uid===e})},getViewForGraphic:function(e){return e.layer?this.allLayerViews.find(function(g){return g.layer===e.layer}):this._graphicsView},whenViewForGraphic:function(e){return e.layer?
this.whenLayerView(e.layer):K.resolve(this._graphicsView)},renderSpatialReference:null,_graphicsView:null,_surfaceReadyWatchHandle:null,_stageHandles:null,_navigationHandles:null,_gotoImmediate:function(e,g){var n=this._gotoTask;return e.then(function(e){n===this._gotoTask&&(this.viewpoint=e)}.bind(this))},_gotoAnimated:function(g,n){!this.animation||"running"!==this.animation.state&&"waiting-for-target"!==this.animation.state?this.animation=new k({target:g}):this.animation.target=g;var a=this.animation;
a.state="waiting-for-target";g.then(function(y){if(a.target===g&&this.animation===a){a.target=y;a.state="running";y=e.toCamera(this,y);if(!y)throw ka.error("#goTo()","Invalid target specified for animateTo"),new J("goto:invalid-camera","Invalid camera in conversion from viewpoint");this._cameraAlmostEquals(this.camera,y)?a.finish():(y=h.externalToInternal(this,y),y.almostEquals(this.navigation.currentCamera,5E-4/this.renderCoordsHelper.unitInMeters)?a.finish():(this._navigationPauseNotifications=
!0,this._setInternalCamera(y,this._animateOptions(n)),a.state===k.State.STOPPED&&a.stop(),this._navigationPauseNotifications=!1))}}.bind(this)).otherwise(function(){a.target===g&&this.animation===a&&(this.animation=null,a.finish())});return a},_animateOptions:function(e){var g={animate:!0};e&&null!=e.speedFactor&&(g.speedFactor=e.speedFactor);e&&null!=e.duration&&(g.duration=e.duration/1E3);e&&null!=e.minDuration&&(g.minDuration=e.minDuration/1E3);e&&null!=e.maxDuration&&(g.maxDuration=e.maxDuration/
1E3);e&&null!=e.easing&&(g.easing="string"===typeof e.easing?p.named[e.easing]:e.easing);return g},_trackCanvasSize:function(){this.on("resize",function(e){if(this.canvas){this.canvas.width=e.width;this.canvas.height=e.height;var g=this._stage.getCamera();g.width=e.width;g.height=e.height;this._stage.setCamera(g);this.navigation&&(this.navigation.windowSize=[e.width,e.height])}}.bind(this));this.canvas.width=this.width;this.canvas.height=this.height},_computeMapPointFromIntersectionResult:function(e,
g){if(e.getIntersectionPoint(ma)){g=this._computeMapPointFromVec3d(ma,g);var n=this._get("basemapTerrain");"terrain"===e.intersector&&n&&(e=n.getElevation(g),null!==e&&(g.z=e));return g}return null},_computeMapPointFromVec3d:function(e,n){var h=this.spatialReference||z.WGS84;g.vectorToVector(e,this.renderSpatialReference,e,h)||(h=z.WGS84,g.vectorToVector(e,this.renderSpatialReference,e,h));n?(n.x=e[0],n.y=e[1],n.z=e[2],n.spatialReference=h):n=new E(e,h);return n},_getGraphicFromStageObject:function(e,
g){var n=e.getMetadata();if(null!=n&&null!=n.layerUid){if(n.layerUid===this._graphicsView.mockLayerId)return this._graphicsView.getGraphicsFromStageObject(e,g);if(n=this.map.findLayerByUid(n.layerUid))return this.whenLayerView(n).then(function(n){if(n&&null!=n.getGraphicsFromStageObject&&!n.suspended)return n.getGraphicsFromStageObject(e,g)})}return null},_getGraphicFromStagePoint:function(e){var g=this._computeMapPointFromVec3d(e.point),g=new C(g);e=e.metadata.layerUid;null!=e&&(g.layer=this.map.findLayerByUid(e));
return g},_viewingModeToManifold:function(e){return{local:"planar",global:"spherical"}[e]},_initBasemapTerrain:function(e){this._disposeBasemapTerrain();this._set("basemapTerrain",new ia(this,this._viewingModeToManifold(e)));this._set("elevationProvider",new F({view:this}));this.elevationProvider.register("ground",this.basemapTerrain);this.navigation.elevationProvider=this.basemapTerrain},_initGlobe:function(e){this._initCoordinateSystem();this._initNavigation(e);this._stage.setViewParams({backgroundColor:[0,
0,0,0],maxFarNearRatio:0,frustumCullingEnabled:!1});this._initBasemapTerrain(e);this._navigationCurrentViewChanged({camera:this.navigation.currentCamera})},_initCoordinateSystem:function(){if(this.spatialReference){var e=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(e)||(this.mapCoordsHelper=new Y(this.map,e));var n=this.renderCoordsHelper?this.renderCoordsHelper.unitInMeters:1,h="global"===this.viewingMode,e=h?g.SphericalRenderSpatialReference:e;e!==this.renderSpatialReference&&
(this.renderSpatialReference=e,this.renderCoordsHelper=new (h?U.Spherical:U.Planar)(e),this._stage&&this._stage.setIntersectTolerance(y.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters),this._constraints&&this._constraints.scale(n/this.renderCoordsHelper.unitInMeters))}else this.renderSpatialReference=this.renderCoordsHelper=this.mapCoordsHelper=null},_paddingEqualsArray:function(e){var g=this.padding;return g?g.top===e[0]&&g.right===e[1]&&g.bottom===e[2]&&g.left===e[3]:!0},_navigationCurrentViewChanged:function(e){this._frustum.dirty=
!0;e=e.camera;var g=e.padding,n=this._get("basemapTerrain"),a=n.spatialReference;a&&(a=this.renderCoordsHelper.fromRenderCoords(e.eye,a),n=n.getElevation(a)||0,e.aboveGround=a.z>=n);this._paddingEqualsArray(g)||(n=this._padding,g={top:g[0],right:g[1],bottom:g[2],left:g[3]},this._internallyReady?(this._padding=g,this.notifyChange("padding",n,g)):this.padding=g);this._stage.setCamera(e);this.notifyChange("extent");g=this.camera;e=h.internalToExternal(this,e,Z);g&&this._cameraAlmostEquals(g,e)||this.notifyChange("camera")},
_cameraAlmostEquals:function(e,g){return 1E-5>Math.abs(e.tilt-g.tilt)&&1E-5>Math.abs(e.heading-g.heading)&&1E-5>Math.abs(e.fov-g.fov)&&e.position.equals(g.position)},_navigationAnimationStarted:function(g){g=e.fromInternalCamera(this,this.navigation.targetCamera);this.animation?this.animation.target=g:this.animation=new k({target:g})},_navigationTargetViewChanged:function(n){if(this.animation&&"waiting-for-target"!==this.animation.state){n=n.camera;var a=this.spatialReference||z.WGS84,y=h.internalToExternal(this,
n);n=new B({camera:y,targetGeometry:g.vectorToPoint(n.center,a,this.renderSpatialReference),scale:h.computeScale(this,n),rotation:e.headingToRotation(y.heading)});this.animation.target=n}},_navigationCurrentViewReachedTarget:function(e){if(e.interruptedAnimation||e.finishedAnimation)this._gotoTask=null;if(this.animation&&(e.interruptedAnimation||e.finishedAnimation)){this._animationStateWatcher&&(this._animationStateWatcher.remove(),this._animationStateWatcher=null);var g=this.animation;this.animation=
null;e.finishedAnimation?g.finish():g.stop();this.notifyChange("animation")}},_setInternalCamera:function(e,g){e&&(this.navigation.setCamera(e,g),this._externallySet.camera=!0);return!!e},_setCamera:function(e,g){return this._setInternalCamera(h.externalToInternal(this,e),g)},_evaluateUpdating:function(){var e=0,g=0,n=!1;this.allLayerViews.forEach(function(h){h.updating&&(n=!0,h=h.updatingPercentage,null!=h&&(++g,e+=h))});this._graphicsView&&this._graphicsView.updating&&(n=!0);n!==this.updating&&
(this.updating=n);e=0!==g?e/g:n?100:0;this.updatingPercentage!==e&&(this.updatingPercentage=e)},_updateUpdatingMonitors:function(e){for(var g=0;g<e.removed.length;g++){var n=e.removed[g],h=this._layerViewsUpdatingHandles[n.uid];h&&(delete this._layerViewsUpdatingHandles[n.uid],n.destroyed||h.remove())}for(g=0;g<e.added.length;g++)n=e.added[g],n.destroyed||(h=n.watch(["updating","updatingPercentage"],this._evaluateUpdating),this._layerViewsUpdatingHandles[n.uid]=h);this._evaluateUpdating()},_spatialReferenceSetter:function(e){this.inherited(arguments);
this._initCoordinateSystem()},_setInitialView:function(g){if(g&&!this._externallySet.camera){var n=null;g instanceof B&&!g.camera&&g.targetGeometry instanceof c&&(n=e.rotationToHeading(g.rotation),g=g.targetGeometry);if(g instanceof B)this.viewpoint=g;else if(g instanceof u)this.camera=g;else{var h=this._getDesiredHeadingTilt();null!=n&&(h.heading=n);e.create(this,{target:g,heading:h.heading,tilt:h.tilt}).then(function(e){this.navigation._dataExtentChanged();this.viewpoint=e}.bind(this))}}},_pickRay:function(e,
g,n,h,a,y,F){return this._stage?this._stage.pickRay(e,g,n,h,a,y,F):null},_pickRayWithBeginPoint:function(e,g,n,h,a){return this._stage?this._stage.pickRayWithBeginPoint(e,g,n,h,a):null},_removeHandles:function(e){for(var g=0;g<e.length;g++){var n=e[g];this[n]&&(this[n].remove(),this[n]=null)}},_setCanvas:function(e){e!==this._get("canvas")&&this._set("canvas",e)},_disposeSurface:function(){this._removeHandles(["_stageFrameTask","_updateDrawingOrderHandle","onViewExtentUpdateHandle","_mapLayersChangeHandle"]);
this.pointsOfInterest&&(this.pointsOfInterest.destroy(),this.pointsOfInterest=null);this._disposeBasemapTerrain();this._setNavigation(null);this.environmentManager&&this.environmentManager.disposeRendering()},_disposeBasemapTerrain:function(){var e=this._get("basemapTerrain");e&&(e.destroy(),this._set("basemapTerrain",null))},_disposeNavigation:function(){var e=this._get("navigation");e&&(e.destroy(),e.elevationProvider=null,this._set("navigation",null))},_setNavigation:function(e){this._get("navigation")!==
e&&(this._disposeNavigation(),e&&(e.windowSize=[this.width,this.height],e.userConstraints=this.constraints),this._set("navigation",e))},_initNavigation:function(e){e=e||this.viewingMode;var g={view:this};"global"===e?this._setNavigation(new ja(g)):this._setNavigation(new ra(g))},_initSurface:function(){var e={};e.deactivatedWebGLExtensions=this.deactivatedWebGLExtensions;e.viewingMode=this.viewingMode;this.renderCanvas&&(e.canvas=this.renderCanvas);this._stage=new n(this.viewingMode,a.byId(this.surface),
e);this._stage.selectionState=!1;this._stageHandles.add(H.init(this.qualitySettings,"antialiasingEnabled",function(){this._stage.setRenderParams({antialiasingEnabled:this.qualitySettings.antialiasingEnabled})}.bind(this)));this._stageHandles.add(H.watch(this,this.highlightOptions.keys().map(function(e){return"highlightOptions."+e}),function(){this._stage.setRenderParams({defaultHighlightOptions:N.toEngineOptions(this.highlightOptions)})}.bind(this)));this._stageHandles.add(H.init(this,"highlightOptions",
function(){this._stage.setRenderParams({defaultHighlightOptions:N.toEngineOptions(this.highlightOptions)})}.bind(this)));this.renderCoordsHelper&&this._stage.setIntersectTolerance(y.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._setCanvas(this._stage.getCanvas());this._stageFrameTask=I.addFrameTask(this._stage.getFrameTask());this._trackCanvasSize();this._initGlobe(this.viewingMode);this.pointsOfInterest=new da({view:this});H.init(this.pointsOfInterest.centerOnContent,"location",function(){this.notifyChange("center")}.bind(this),
!0);H.init(this.pointsOfInterest.centerOnContent,["distance","location"],function(){this.notifyChange("scale")}.bind(this),!0);this.pointsOfInterest.events.on("camera-parameters-changed",function(){this.notifyChange("scale")}.bind(this));this.sharedSymbolResources=new aa({stage:this._stage,viewingMode:this.viewingMode,resourceController:this.resourceController,pointsOfInterest:this.pointsOfInterest})},_initGraphicsView:function(){this._surfaceReadyWatchHandle=H.whenTrueOnce(this,"basemapTerrain.ready",
function(){this._graphicsView=new qa({view:this,graphics:this.graphics});this._surfaceReadyWatchHandle=null;this._layerViewsUpdatingHandles[this._graphicsView.mockLayerId]=H.init(this._graphicsView,"updating",this._evaluateUpdating)}.bind(this))},_disposeGraphicsView:function(){this._surfaceReadyWatchHandle&&(this._surfaceReadyWatchHandle.remove(),this._surfaceReadyWatchHandle=null);if(this._graphicsView){var e=this._graphicsView.mockLayerId;this._layerViewsUpdatingHandles[e].remove();delete this._layerViewsUpdatingHandles[e];
this._graphicsView.destroy();this._graphicsView=null}},_normalizePointArgs:function(e,g,n,h,a){a=a||va;var y=a.point;y.spatialReference=void 0;"object"===typeof e?(y.x=e.x,y.y=e.y,y.z=e.z,e.spatialReference&&(y.spatialReference=e.spatialReference),a.retval=g):(y.x=e,y.y=g,"number"!==typeof n&&void 0!==n?(y.z=void 0,a.retval=n):(y.z=n,a.retval=h));y.spatialReference||(y.spatialReference=this.spatialReference||z.WGS84);return a},_separateInitialProperties:function(){var e={},g={},n={},h=function(e){if(e=
ta[e])for(var g=0;g<e.length;g++)n[e[g]]=!0,h(e[g])},a;for(a in this._initialProps){var y=this._initialProps[a];ta[a]?(h(a),e[a]=y):g[a]=y}for(a in n)delete e[a];return{view:e,other:g}},_viewReadyHandler:function(e,g){if(!g){"global"===this.viewingMode&&(this._clippingArea=null);this._internallyReady=!0;this._initSurface();this._initGraphicsView();e=this._separateInitialProperties();for(var n in e.other)this.set(n,e.other[n]);for(n in e.view)this.set(n,e.view[n]);n=this.get("map.initialViewProperties.viewpoint");
e=this.get("initialExtent");n?this._setInitialView(n):e&&e.spatialReference.equals(this.spatialReference)?this._setInitialView(e):"local"===this.viewingMode&&H.whenOnce(this.basemapTerrain,"ready",function(){this._setInitialView(this.groundExtent)}.bind(this));!this._externallySet.environment&&(n=this.get("map.initialViewProperties.environment"))&&(this.environment=n);this._initialProps={};this.notifyChange("initialExtentRequired");this._updateDrawingOrderHandle=this.allLayerViews.on("change",this._updateDrawingOrder.bind(this));
this._updateDrawingOrder({added:this.allLayerViews.toArray(),removed:[],moved:[]});this.environmentManager.updateReadyChange(!0)}},_viewUnreadyHandler:function(e,g){g&&(this._initialDefaultSpatialReference=null,this.environmentManager.updateReadyChange(!1),this._disposeGraphicsView(),this._internallyReady=!1,this._disposeSurface(),this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null),this._stage&&(this._stage.dispose(),this._stage=null,this._stageHandles.remove()),
this._setCanvas(null))},_getDesiredHeadingTilt:function(){if(this._externallySet.camera){var e=this.camera;pa.heading=e.heading;pa.tilt=e.tilt}else pa.heading=0,pa.tilt=.5;return pa},_cameraSetter:oa("camera",function(e){this._setCamera(e,{animate:!1})||ka.error("#camera\x3d","Invalid camera",e)}),_cameraGetter:na("camera",function(e){return h.internalToExternal(this,this.navigation.currentCamera,e)}),_externalExtent:function(){this._cachedExtentDirty&&(h.toExtent(this,null,null,this._cachedExtent,
Z),this._cachedExtentDirty=!1);return this._cachedExtent},_extentGetter:na("extent",function(e){return h.toExtent(this,null,null,e,Z)}),_extentSetter:oa("extent",function(e){var g=h.fromExtent(this,e,this._getDesiredHeadingTilt(),Z);g?this.camera=g:this._isIncompatibleSpatialReference(e.spatialReference)?ka.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+e.spatialReference.wkid+", view: "+this.spatialReference.wkid+")",e):ka.error("#extent\x3d","Invalid extent",e)}),_heightModelInfoGetter:function(){var e=
this.getDefaultHeightModelInfo();return null!=e?x.deriveUnitFromSR(e,this.spatialReference):null},_isIncompatibleSpatialReference:function(e){return e&&!e.equals(this.spatialReference)&&!r.canProject(e,this.spatialReference)},_scaleGetter:na("scale",function(){if(null!=this.navigation){var e=this.pointsOfInterest.centerOnContent;return h.distanceToScale(this,e.distance,e.location.latitude)}return 0}),_scaleSetter:oa("scale",function(e){var g=this._getDesiredHeadingTilt(),n=this.pointsOfInterest.centerOnContent;
n.forceUpdate();var a=n.renderLocation;e=h.scaleToDistance(this,e,n.location.latitude);g=h.eyeHeadingTiltForCenterPointAtDistance(this,g.heading,g.tilt,a,e);this._externallySet.camera=!0;this.navigation.setCameraFromEyeCenterAndUp(g.eye,g.center,g.up,{animate:!1});n.forceUpdate()}),_zoomGetter:na("zoom",function(){return h.scaleToZoom(this,this.scale)}),_zoomSetter:oa("zoom",function(e){this.scale=h.zoomToScale(this,e)}),_centerGetter:na("center",function(e){return this.pointsOfInterest.centerOnContent.location}),
_centerSetter:oa("center",function(e){if(this._isIncompatibleSpatialReference(e&&e.spatialReference))ka.error("#center\x3d","Center has an incompatible spatial reference (center: "+e.spatialReference.wkid+", view: "+this.spatialReference.wkid+")",e);else{var g=this.pointsOfInterest.centerOnContent;g.forceUpdate();var n=this._getDesiredHeadingTilt();(n=h.eyeHeadingTiltForCenterPointAtDistance(this,n.heading,n.tilt,e,g.distance))||ka.error("#center\x3d","Invalid center",e);this._externallySet.camera=
!0;this.navigation.setCameraFromEyeCenterAndUp(n.eye,n.center,n.up,{animate:!1});g.forceUpdate()}}),_viewpointGetter:na("viewpoint",function(){return e.fromCamera(this,this.camera)}),_viewpointSetter:oa("viewpoint",function(g){var n=e.toCamera(this,g);n?this._setCamera(n,{animate:!1}):ka.error("#viewpoint\x3d","Invalid viewpoint",g)}),_screenCenterGetter:function(){var e=this.padding;return new D((this.size[0]-(e.left+e.right))/2+e.left,(this.size[1]-(e.top+e.bottom))/2+e.top)},_updateDrawingOrder:function(){var e=
this.allLayerViews.length-1;this.allLayerViews.forEach(function(g,n){null!=g.drawingOrder&&(g.drawingOrder=e-n)},this)},_paddingSetter:oa("padding",function(e){this._set("padding",{top:e&&e.top||0,right:e&&e.right||0,bottom:e&&e.bottom||0,left:e&&e.left||0});this.navigation&&(this.navigation.padding=this._get("padding"))}),_constraintsSetter:oa("constraints",function(e){this._set("constraints",e);e===this._defaults.constraints&&(this._defaults.constraints=null,e.scale(1/this.renderCoordsHelper.unitInMeters));
this.navigation.userConstraints=e}),_animationSetter:function(e){e!==this._get("animation")&&(this._internallyReady?(this._animationStateWatcher&&(this._animationStateWatcher.remove(),this._animationStateWatcher=null),this._set("animation",e),e&&(this._animationStateWatcher=e.watch("state",function(e){if(e===k.State.FINISHED||e===k.State.STOPPED)this.animation=null,e===k.State.FINISHED?this.navigation.setCurrentToTarget():this.navigation.setCamera(this.navigation.currentCamera,{animate:!1})}.bind(this)))):
ka.error("#animation\x3d","Scene view cannot be used before it is ready"))},_mapSetter:function(e){e!==this._get("map")&&(this.navigation&&this.navigation._dataExtentChanged(),this._mapLayersChangeHandle&&this._mapLayersChangeHandle.remove(),e&&(this._mapLayersChangeHandle=e.allLayers.on("change",this.notifyChange.bind(this,"dataExtent"))),delete this._externallySet.camera,this.inherited(arguments))}})})},"esri/views/BreakpointsOwner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/accessorSupport/decorators ../core/watchUtils ./DOMContainer ../core/Accessor ../core/ArrayPool ../core/HandleRegistry dojo/dom-class".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x){var z={widthBreakpoint:{getValue:function(a){var b=a.viewSize[0];a=a.breakpoints;var d=this.values;return b<=a.xsmall?d.xsmall:b<=a.small?d.small:b<=a.medium?d.medium:b<=a.large?d.large:d.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},
heightBreakpoint:{getValue:function(a){var b=a.viewSize[1];a=a.breakpoints;var d=this.values;return b<=a.xsmall?d.xsmall:b<=a.small?d.small:b<=a.medium?d.medium:b<=a.large?d.large:d.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},
orientation:{getValue:function(a){a=a.viewSize;var b=this.values;return a[1]>=a[0]?b.portrait:b.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},v={xsmall:544,small:768,medium:992,large:1200};return function(m){function r(){var a=null!==m&&m.apply(this,arguments)||this;a._breakpointsHandles=new p;a.breakpoints=v;a.orientation=null;a.widthBreakpoint=null;a.heightBreakpoint=null;return a}
f(r,m);r.prototype.initialize=function(){this._breakpointsHandles.add([q.init(this,["breakpoints","size"],this._updateClassNames)])};r.prototype.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)};r.prototype._updateClassNames=function(){if(this.container){var a=k.acquire(),b=k.acquire(),c=!1,d,f,m;for(d in z)f=this[d],m=z[d].getValue({viewSize:this.size,breakpoints:this.breakpoints}),f!==m&&(c=!0,this[d]=m,b.push(z[d].valueToClassName[f]),
a.push(z[d].valueToClassName[m]));c&&(this._applyClassNameChanges(a,b),k.release(a),k.release(b))}};r.prototype._applyClassNameChanges=function(a,b){var c=this.container;c&&(x.remove(c,b),x.add(c,a))};r.prototype._removeActiveClassNames=function(){var a=this.container;if(a)for(var b in z)x.remove(a,z[b].valueToClassName[this[b]])};a([b.property({set:function(a){var b=this._get("breakpoints");if(a!==b){b=(b=a)&&b.xsmall<b.small&&b.small<b.medium&&b.medium<b.large;if(!b){var c=JSON.stringify(v,null,
2);console.warn("provided breakpoints are not valid, using defaults:"+c)}a=b?a:v;this._set("breakpoints",d({},a))}}})],r.prototype,"breakpoints",void 0);a([b.property()],r.prototype,"orientation",void 0);a([b.property()],r.prototype,"widthBreakpoint",void 0);a([b.property()],r.prototype,"heightBreakpoint",void 0);return r=a([b.subclass("esri.views.BreakpointsOwner")],r)}(b.declared(m,t))})},"esri/views/DOMContainer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/_base/lang dojo/on dojo/dom dojo/dom-construct ../core/Accessor ../core/Evented ../core/HandleRegistry ../core/Scheduler ../core/watchUtils ../widgets/Popup ./PopupManager ./ui/DefaultUI ../core/accessorSupport/decorators".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C){var E=[0,0];return function(c){function k(){var a=c.call(this)||this;a.height=0;a.position=null;a.resizing=!1;a.root=null;a.surface=null;a.suspended=!0;a.width=0;Object.defineProperty(a,"_measureInfo",{enumerable:!1,writable:!1,value:{task:null,freq:16,time:750}});a._domHandles=new p;a.watch("interacting",function(c){var b=a.surface;b&&b.setAttribute("data-interacting",c.toString())});return a}f(k,c);k.prototype.getDefaults=function(){return d.mixin(this.inherited(arguments),
{popup:{},ui:{}})};k.prototype.initialize=function(){var a=this,c=this._measureInfo,d=null;z.init(this,"container",function(f,k,m,p){if(null!=f||null!=k)d&&(d.remove(),d=null,c.freq=16,c.time=750),c.task&&(c.task.remove(),c.task=null),f?(d=b(window,"resize",function(){c.freq=16;c.time=750}),c.task=x.addFrameTask({prepare:function(c){var b=a._measureInfo;b.time+=c.deltaTime;b.time<b.freq||(b.time=0,a._measure()?(b.freq=16,a._set("resizing",!0)):(b.freq=Math.min(750,2*b.freq),512<=b.freq&&a._set("resizing",
!1)))}})):a._set("resizing",!1),a._measure(),f=a.root,k=a.surface,m=a.width,p=a.height,f&&k&&m&&p&&(f.style.width=k.style.width=m+"px",f.style.height=k.style.height=p+"px")})};k.prototype.destroy=function(){this.ui.destroy();this.popup&&this.popup.destroy();this.container=null};Object.defineProperty(k.prototype,"container",{set:function(a){var c=this._get("container");if(c!==a){c&&(c.classList.remove("esri-view"),this.popupManager.destroy(),this.popupManager=null,t.destroy(this.root),this._set("root",
null));if(a){a.classList.add("esri-view");c=document.createElement("div");c.className="esri-view-root";a.insertBefore(c,a.firstChild);this._set("root",c);var b=document.createElement("div");b.className="esri-view-surface";q.setSelectable(b,!1);c.appendChild(b);this._set("surface",b);this._forceReadyCycle();this.popupManager=new r({enabled:!0,view:this})}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null);this._set("container",
a)}},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"popup",{set:function(a){var c=this._get("popup");a!==c&&(a||(a=new v({container:document.createElement("div")})),this._domHandles.remove("view-popup"),c&&c.destroy(),a&&(a.viewModel.view=this,this._domHandles.add([z.init(this,"root",function(c,b){var d=a.container;d||(a.container=document.createElement("div"));var f=d&&d.parentNode;q.isDescendant(f,b)&&f.removeChild(d);c&&!f&&t.place(a.container,c)})],"view-popup")),this._set("popup",
a))},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"size",{get:function(){return[this.width,this.height]},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"ui",{set:function(a){var c=this._get("ui");a!==c&&(this._domHandles.remove("ui"),c&&c.destroy(),a&&(a.view=this,this._domHandles.add([z.init(this,"root",function(c){a.container=c?t.create("div",null,c):null})],"ui")),this._set("ui",a))},enumerable:!0,configurable:!0});k.prototype.focus=function(){this.surface&&
this.surface.focus()};k.prototype.pageToContainer=function(a,c,b){var d=this.position;a-=d[0];c-=d[1];b?(b[0]=a,b[1]=c):b=[a,c];return b};k.prototype.containerToPage=function(a,c,b){var d=this.position;a+=d[0];c+=d[1];b?(b[0]=a,b[1]=c):b=[a,c];return b};k.prototype._measure=function(){var a=this.container,c=a?a.clientWidth:0,b=a?a.clientHeight:0;if(0===c||0===b||"hidden"===window.getComputedStyle(a).visibility)return this.suspended||this._set("suspended",!0),!1;var d=this.root,f=this.surface,k=this.width,
m=this.height,p=this.position;if(c===k&&b===m)return this.suspended&&this._set("suspended",!1),!1;d&&f&&(d.style.width=f.style.width=c+"px",d.style.height=f.style.height=b+"px");this._set("width",c);this._set("height",b);this._set("suspended",!1);d=(a.ownerDocument||window.document).defaultView;a=a.getBoundingClientRect();E[0]=a.left+d.pageXOffset;E[1]=a.top+d.pageYOffset;p&&E[0]===p[0]&&E[1]===p[1]||this._set("position",E.slice());this.emit("resize",{oldWidth:k,oldHeight:m,width:c,height:b});return!0};
a([C.property({value:null,cast:function(a){return q.byId(a)}})],k.prototype,"container",null);a([C.property({readOnly:!0})],k.prototype,"height",void 0);a([C.property({type:v})],k.prototype,"popup",null);a([C.property({readOnly:!0})],k.prototype,"position",void 0);a([C.property({readOnly:!0})],k.prototype,"resizing",void 0);a([C.property({readOnly:!0})],k.prototype,"root",void 0);a([C.property({value:null,dependsOn:["width","height"],readOnly:!0})],k.prototype,"size",null);a([C.property({readOnly:!0})],
k.prototype,"surface",void 0);a([C.property({readOnly:!0})],k.prototype,"suspended",void 0);a([C.property({type:u})],k.prototype,"ui",null);a([C.property({readOnly:!0})],k.prototype,"width",void 0);return k=a([C.subclass("esri.views.DOMContainer")],k)}(C.declared(m,k))})},"esri/widgets/Popup":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ./support/widget ../core/accessorSupport/decorators ../core/lang ../core/HandleRegistry ../core/watchUtils ./Widget ../widgets/support/widgetUtils ./Popup/PopupRenderer ./Popup/PopupViewModel dojo/i18n!./Popup/nls/Popup ./Spinner dojo/dom-geometry".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C){function E(a,c){return void 0===c?"esri-popup__"+a:"esri-popup__"+a+"-"+c}var c=w.toUrl("./Popup/images/default-action.svg"),D={buttonEnabled:!0,position:"auto",breakpoint:{width:544}};return function(B){function l(a){a=B.call(this)||this;a._containerNode=null;a._mainContainerNode=null;a._featureMenuButtonNode=null;a._featureMenuViewportNode=null;a._handleRegistry=new m;a._displayActionTextLimit=2;a._pointerOffsetInPx=16;a._spinner=null;a._closeFeatureMenuHandle=
null;a.actions=null;a.alignment="auto";a.autoCloseEnabled=null;a.content=null;a.collapsed=!1;a.collapseEnabled=!0;a.dockEnabled=!1;a.featureCount=null;a.featureMenuOpen=!1;a.features=null;a.featureNavigationEnabled=!0;a.highlightEnabled=null;a.location=null;a.popupRenderers=[];a.promises=null;a.selectedFeature=null;a.selectedFeatureIndex=null;a.selectedPopupRenderer=null;a.spinnerEnabled=!0;a.title=null;a.updateLocationEnabled=null;a.view=null;a.viewModel=new v;a.visible=null;return a}f(l,B);l.prototype.postInitialize=
function(){var a=this,c=k.pausable(this,"\n      viewModel.visible,\n      dockEnabled,\n      viewModel.selectedFeature\n    ",function(){return a._closeFeatureMenu()});this._closeFeatureMenuHandle=c;this.own(k.watch(this,"viewModel.screenLocation",function(){return a._positionContainer()}),k.watch(this,["viewModel.visible","dockEnabled"],function(){return a._toggleScreenLocationEnabled()}),k.watch(this,"viewModel.screenLocation",function(c,b){!!c!==!!b&&a.reposition()}),k.watch(this,"viewModel.features",
function(c){return a._createPopupRenderers(c)}),k.watch(this,"viewModel.view.padding viewModel.view.size viewModel.visible viewModel.waitingForResult viewModel.location alignment".split(" "),function(){return a.reposition()}),c,k.watch(this,"spinnerEnabled",function(c){return a._spinnerEnabledChange(c)}),k.watch(this,["title","content"],function(){return a._hasFeatureUpdated()}),k.watch(this,"viewModel.view.size",function(c,b){return a._updateDockEnabledForViewSize(c,b)}),k.watch(this,"viewModel.view",
function(c,b){return a._viewChange(c,b)}),k.watch(this,"viewModel.view.ready",function(c,b){return a._viewReadyChange(c,b)}),k.watch(this,["viewModel.waitingForResult","viewModel.location"],function(){return a._displaySpinner()}),k.watch(this,["popupRenderers","viewModel.selectedFeatureIndex"],function(){return a._updatePopupRenderer()}),k.watch(this,"selectedPopupRenderer.viewModel.title",function(c){return a._setTitleFromPopupRenderer(c)}),k.watch(this,["selectedPopupRenderer.viewModel.content",
"selectedPopupRenderer.viewModel.waitingForContent"],function(){return a._setContentFromPopupRenderer()}),k.on(this,"viewModel","trigger-action",function(c){return a._zoomToAction(c)}))};l.prototype.destroy=function(){this._destroyPopupRenderers();this._destroySpinner();this._handleRegistry.destroy();this._handleRegistry=null};Object.defineProperty(l.prototype,"currentAlignment",{get:function(){return this._getCurrentAlignment()},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"currentDockPosition",
{get:function(){return this._getCurrentDockPosition()},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"dockOptions",{get:function(){return this._get("dockOptions")||D},set:function(a){var c=d({},D),b=this.get("viewModel.view.breakpoints"),f={};b&&(f.width=b.xsmall,f.height=b.xsmall);a=d({},c,a);c=d({},c.breakpoint,f);f=a.breakpoint;!0===f?a.breakpoint=c:"object"===typeof f&&(a.breakpoint=d({},c,f));this._set("dockOptions",a);this._setCurrentDockPosition();this.reposition()},enumerable:!0,
configurable:!0});l.prototype.clear=function(){};l.prototype.close=function(){this.visible=!1};l.prototype.next=function(){return null};l.prototype.open=function(a){a=d({visible:!0},{featureMenuOpen:!1,updateLocationEnabled:!1,promises:[]},a);a.featureMenuOpen&&this._closeFeatureMenuHandle.pause();this.set(a)};l.prototype.previous=function(){return null};l.prototype.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};l.prototype.triggerAction=function(a){return null};
l.prototype.render=function(){var a=this.collapsed,c=this.collapseEnabled,d=this.dockEnabled,f=this.dockOptions,k=this.actions,m=this.featureMenuOpen,p=this.featureNavigationEnabled,u=this.popupRenderers,v=this.visible,q=this.viewModel,C=q.featureCount,A=q.promiseCount,D=q.pendingPromisesCount,S=q.selectedFeatureIndex,h=q.title,q=q.waitingForResult,p=1<C&&p,m=1<C&&m,e=c&&!m&&a,g=k&&k.length,n=p&&this._getPageText(C,S),y=this._renderContent(),F=x.isRtl(),N=this.get("selectedPopupRenderer")?this.get("selectedPopupRenderer.viewModel.waitingForContent")||
this.get("selectedPopupRenderer.viewModel.content"):y,U=d?r.undock:r.dock,k=this.currentAlignment,a=this.currentDockPosition,D=D?b.tsx("div",{key:E("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":r.loading,title:r.loading},b.tsx("span",{"aria-hidden":"true",class:b.join("esri-popup__icon","esri-rotating esri-icon-loading-indicator")})):null,Y=(W={},W["esri-icon-layer-list"]=!m,W["esri-icon-close"]=m,W),W=b.tsx("span",{"aria-hidden":"true",class:"esri-popup__icon",
classes:Y}),Y=(B={},B["esri-icon-right-triangle-arrow"]=F,B["esri-popup__pagination-previous-icon--rtl"]=F,B["esri-icon-left-triangle-arrow"]=!F,B["esri-popup__pagination-previous-icon"]=!F,B),B=b.tsx("span",{"aria-hidden":"true",class:"esri-popup__icon",classes:Y}),B=b.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:b.join("esri-popup__button","esri-popup__pagination-previous"),"aria-label":r.previous,title:r.previous},B),F=(z={},z["esri-icon-left-triangle-arrow"]=
F,z["esri-popup__pagination-next-icon--rtl"]=F,z["esri-icon-right-triangle-arrow"]=!F,z["esri-popup__pagination-next-icon"]=!F,z),z=b.tsx("span",{"aria-hidden":"true",class:"esri-popup__icon",classes:F}),z=b.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:b.join("esri-popup__button","esri-popup__pagination-next"),"aria-label":r.next,title:r.next},z),W=b.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,
afterCreate:this._storeFeatureMenuButtonNode,afterUpdate:this._storeFeatureMenuButtonNode,class:b.join("esri-popup__button","esri-popup__feature-menu-button"),"aria-label":r.menu,title:r.menu},W),n=b.tsx("div",{class:"esri-popup__pagination-page-text"},n),z=p?b.tsx("div",{class:"esri-popup__navigation-buttons"},B,n,z,W):null,n=this._wouldDockTo(),W="top-left"===n||"bottom-left"===n,F="top-center"===n,B="bottom-center"===n,n="top-right"===n||"bottom-right"===n?b.tsx("span",{"aria-hidden":"true",key:E("dock-right-icon"),
class:b.join("esri-popup__icon","esri-popup__icon--dock-icon","esri-icon-dock-right")}):null,W=W?b.tsx("span",{"aria-hidden":"true",key:E("dock-left-icon"),class:b.join("esri-popup__icon","esri-popup__icon--dock-icon","esri-icon-dock-left")}):null,F=F?b.tsx("span",{"aria-hidden":"true",key:E("dock-top-icon"),class:b.join("esri-popup__icon","esri-popup__icon--dock-icon","esri-icon-maximize")}):null,B=B?b.tsx("span",{"aria-hidden":"true",key:E("dock-bottom-icon"),class:b.join("esri-popup__icon","esri-popup__icon--dock-icon",
"esri-icon-dock-bottom")}):null,Y=d?b.tsx("span",{"aria-hidden":"true",key:E("undocked-icon"),class:b.join("esri-popup__icon","esri-icon-minimize")}):null,f=f.buttonEnabled?b.tsx("div",{role:"button","aria-label":U,title:U,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,class:b.join("esri-popup__button","esri-popup__button--dock")},n,F,W,B,Y):null,c=c&&(N||g||p),U=(l={},l["esri-popup__header-title--button"]=c,l),l=c?e?r.expand:r.collapse:"",h=h?b.tsx("h1",{class:"esri-popup__header-title",
role:c?"button":"heading","aria-label":l,title:l,classes:U,bind:this,tabIndex:c?0:-1,onclick:this._toggleCollapsed,onkeydown:this._toggleCollapsed,innerHTML:h}):null,l=b.tsx("span",{"aria-hidden":"true",class:b.join("esri-popup__icon","esri-icon-close")}),l=b.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:"esri-popup__button","aria-label":r.close,title:r.close},l),h=b.tsx("header",{class:"esri-popup__header"},h,b.tsx("div",{class:"esri-popup__header-buttons"},
f,l)),y=N&&!e?b.tsx("article",{key:E("content-container"),class:"esri-popup__content"},y):null,N=!e&&("bottom-left"===k||"bottom-center"===k||"bottom-right"===k||"top-left"===a||"top-center"===a||"top-right"===a),e=!e&&("top-left"===k||"top-center"===k||"top-right"===k||"bottom-left"===a||"bottom-center"===a||"bottom-right"===a),l=m?null:b.tsx("div",{key:E("actions"),class:"esri-popup__actions"},this._renderActions()),D=b.tsx("section",{key:E("navigation"),class:"esri-popup__navigation"},D,z),p=p||
g?b.tsx("div",{key:E("feature-buttons"),class:"esri-popup__feature-buttons"},l,D):null;(S=this._renderFeatureMenuNode(u,S,m))&&this._closeFeatureMenuHandle.resume();u=t.substitute({total:u.length},r.selectedFeatures);S=b.tsx("section",{key:E("menu"),class:"esri-popup__feature-menu"},b.tsx("h2",{class:"esri-popup__feature-menu-header"},u),b.tsx("nav",{class:"esri-popup__feature-menu-viewport",afterCreate:this._storeFeatureMenuViewportNode,afterUpdate:this._storeFeatureMenuViewportNode},S));this._featureMenuViewportNode&&
(this._featureMenuViewportNode.scrollTop=0);u=d?null:b.tsx("div",{key:E("pointer"),class:"esri-popup__pointer",role:"presentation"},b.tsx("div",{class:b.join("esri-popup__pointer-direction","esri-popup--shadow")}));m=(I={},I["esri-popup--aligned-top-center"]="top-center"===k,I["esri-popup--aligned-bottom-center"]="bottom-center"===k,I["esri-popup--aligned-top-left"]="top-left"===k,I["esri-popup--aligned-bottom-left"]="bottom-left"===k,I["esri-popup--aligned-top-right"]="top-right"===k,I["esri-popup--aligned-bottom-right"]=
"bottom-right"===k,I["esri-popup--is-docked"]=d,I["esri-popup--shadow"]=!d,I["esri-popup--feature-updated"]=v,I["esri-popup--is-docked-top-left"]="top-left"===a,I["esri-popup--is-docked-top-center"]="top-center"===a,I["esri-popup--is-docked-top-right"]="top-right"===a,I["esri-popup--is-docked-bottom-left"]="bottom-left"===a,I["esri-popup--is-docked-bottom-center"]="bottom-center"===a,I["esri-popup--is-docked-bottom-right"]="bottom-right"===a,I["esri-popup--feature-menu-open"]=m,I);I=this.get("selectedFeature.layer.title");
k=this.get("selectedFeature.layer.id");d=(w={},w["esri-popup--shadow"]=d,w);w=N?S:null;S=e?S:null;a=N?p:null;p=e?p:null;v=v&&!q&&(A?C:1)?b.tsx("div",{key:E("container"),class:"esri-popup__position-container",classes:m,"data-layer-title":I,"data-layer-id":k,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},b.tsx("div",{class:b.join("esri-popup__main-container","esri-widget"),classes:d,bind:this,afterCreate:this._storeMainContainerNode,afterUpdate:this._storeMainContainerNode},
a,w,h,y,p,S),u):null;return b.tsx("div",{key:E("base"),class:"esri-popup",role:"presentation"},v);var W,B,z,l,I,w};l.prototype._setTitleFromPopupRenderer=function(a){this.viewModel.title=a||""};l.prototype._setContentFromPopupRenderer=function(){this.viewModel.content=this.selectedPopupRenderer||null;this.scheduleRender()};l.prototype._zoomToAction=function(a){a.action&&"zoom-to"===a.action.id&&this.viewModel.zoomToLocation()};l.prototype._spinnerEnabledChange=function(a){this._destroySpinner();a&&
(a=this.get("viewModel.view"),this._createSpinner(a))};l.prototype._displaySpinner=function(){var a=this._spinner;if(a){var c=this.viewModel,b=c.location;c.waitingForResult?a.show({location:b}):a.hide()}};l.prototype._getIconStyles=function(a){return{"background-image":a?"url("+a+")":""}};l.prototype._renderAction=function(a,d,f,m){var p=this,u=k.watch(a,["id","className","title","image","visible"],function(){return p.scheduleRender()});this._handleRegistry.add(u,m);u=this.get("selectedFeature.attributes");
"zoom-to"===a.id&&(a.title=r.zoom,a.className="esri-icon-zoom-in-magnifying-glass");m=a.title;var v=a.className,q=a.image||v?a.image:c;m=m&&u?t.substitute(u,m):m;v=v&&u?t.substitute(u,v):v;u=q&&u?t.substitute(u,q):q;q=(C={},C[v]=!!v,C["esri-popup__action-image"]=!!u,C);f=f<=this._displayActionTextLimit?b.tsx("span",{key:E("action-text-"+d+"-"+a.uid),class:"esri-popup__action-text"},m):null;return a.visible?b.tsx("div",{key:E("action-"+d+"-"+a.uid),role:"button",tabIndex:0,title:m,"aria-label":m,class:b.join("esri-popup__button",
"esri-popup__action"),bind:this,"data-action-index":d,onclick:this._triggerAction,onkeydown:this._triggerAction},b.tsx("span",{key:E("action-icon-"+d+"-"+a.uid),"aria-hidden":"true",class:"esri-popup__icon",classes:q,styles:this._getIconStyles(u)}),f):null;var C};l.prototype._renderActions=function(){var a=this;this._handleRegistry.remove("actions");var c=this.actions;if(c){var d=c.length,c=c.toArray().map(function(c,b){return a._renderAction(c,b,d,"actions")});return b.tsx("div",{key:E("actions"),
class:"esri-popup__actions"},c)}};l.prototype._updatePopupRenderer=function(){var a=this.popupRenderers[this.viewModel.selectedFeatureIndex]||null;a&&!a.contentEnabled&&(a.contentEnabled=!0);this._set("selectedPopupRenderer",a)};l.prototype._destroyPopupRenderers=function(){this.popupRenderers.forEach(function(a){return a.destroy()});this._set("popupRenderers",[])};l.prototype._createPopupRenderers=function(a){var c=this;this._destroyPopupRenderers();var b=[];a&&a.forEach(function(a){a=new z({contentEnabled:!1,
graphic:a,view:c.get("viewModel.view")});b.push(a)});this._set("popupRenderers",b)};l.prototype._isScreenLocationWithinView=function(a,c){return-1<a.x&&-1<a.y&&a.x<=c.width&&a.y<=c.height};l.prototype._isOutsideView=function(a){var c=a.popupHeight,b=a.popupWidth,d=a.screenLocation,f=a.side;a=a.view;if(isNaN(b)||isNaN(c)||!a||!d)return!1;var k=a.padding;return"right"===f&&d.x+b/2>a.width-k.right||"left"===f&&d.x-b/2<k.left||"top"===f&&d.y-c<k.top||"bottom"===f&&d.y+c>a.height-k.bottom?!0:!1};l.prototype._determineCurrentAlignment=
function(){var a=this._pointerOffsetInPx,c=this._containerNode,b=this._mainContainerNode,d=this.viewModel,f=d.screenLocation,d=d.view;if(!f||!d||!c)return"top-center";if(!this._isScreenLocationWithinView(f,d))return this._get("currentAlignment")||"top-center";var k=b?window.getComputedStyle(b,null):null,b=k?parseInt(k.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,k=k?parseInt(k.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0,m=C.getContentBox(c),c=m.w+a,m=Math.max(m.h,b,k)+
a,a=this._isOutsideView({popupHeight:m,popupWidth:c,screenLocation:f,side:"right",view:d}),b=this._isOutsideView({popupHeight:m,popupWidth:c,screenLocation:f,side:"left",view:d}),k=this._isOutsideView({popupHeight:m,popupWidth:c,screenLocation:f,side:"top",view:d}),f=this._isOutsideView({popupHeight:m,popupWidth:c,screenLocation:f,side:"bottom",view:d});return b?k?"bottom-right":"top-right":a?k?"bottom-left":"top-left":k?f?"top-center":"bottom-center":"top-center"};l.prototype._getCurrentAlignment=
function(){var a=this.alignment;return this.dockEnabled?null:"auto"===a?this._determineCurrentAlignment():"function"===typeof a?a.call(this):a};l.prototype._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())};l.prototype._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())};l.prototype._getDockPosition=function(){var a=this.get("dockOptions.position");return"auto"===a?this._determineCurrentDockPosition():"function"===
typeof a?a.call(this):a};l.prototype._getCurrentDockPosition=function(){return this.dockEnabled?this._getDockPosition():null};l.prototype._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};l.prototype._renderFeatureMenuItemNode=function(a,c,d,f){var k=c===d,m=(p={},p["esri-popup__feature-menu-item--selected"]=k,p);a=a.title||r.untitled;p=k?b.tsx("span",{key:E("feature-menu-selected-feature-"+d),title:r.selectedFeature,"aria-label":r.selectedFeature,class:"esri-icon-check-mark"}):
null;return b.tsx("li",{role:"menuitem",tabIndex:k||!f?-1:0,key:E("feature-menu-feature-"+d),classes:m,class:"esri-popup__feature-menu-item",title:a,"aria-label":a,bind:this,"data-feature-index":c,onclick:this._selectFeature,onkeydown:this._selectFeature},b.tsx("span",{class:"esri-popup__feature-menu-title"},a,p));var p};l.prototype._renderFeatureMenuNode=function(a,c,d){var f=this;return 1<a.length?b.tsx("ol",{class:"esri-popup__feature-menu-list",role:"menu"},a.map(function(a,b){return f._renderFeatureMenuItemNode(a,
b,c,d)})):null};l.prototype._determineCurrentDockPosition=function(){var a=this.get("viewModel.view"),c=x.isRtl()?"top-left":"top-right";if(!a)return c;var b=a.padding||{left:0,right:0,top:0,bottom:0},b=a.width-b.left-b.right;return(a=a.get("breakpoints"))&&b<=a.xsmall?"bottom-center":c};l.prototype._renderContent=function(){var a=this.get("viewModel.content");if("string"===typeof a)return b.tsx("div",{key:E("content-string"),innerHTML:a});if(a&&a.isInstanceOf&&a.isInstanceOf(p))return b.tsx("div",
{key:E("content-widget")},a.render());if(a instanceof HTMLElement)return b.tsx("div",{key:E("content-html-element"),bind:a,afterUpdate:this._attachToNode,afterCreate:this._attachToNode});if(a&&"function"===typeof a.postMixInProperties&&"function"===typeof a.buildRendering&&"function"===typeof a.postCreate&&"function"===typeof a.startup)return b.tsx("div",{key:E("content-dijit"),bind:a.domNode,afterUpdate:this._attachToNode,afterCreate:this._attachToNode})};l.prototype._attachToNode=function(a){a.appendChild(this)};
l.prototype._positionContainer=function(a){void 0===a&&(a=this._containerNode);a&&(this._containerNode=a);if(a){var c=this.viewModel.screenLocation,b=C.getContentBox(a);if(c=this._calculatePositionStyle(c,b))a.style.top=c.top,a.style.left=c.left,a.style.bottom=c.bottom,a.style.right=c.right}};l.prototype._calculateFullWidth=function(a){var c=this.currentAlignment,b=this._pointerOffsetInPx;return"top-left"===c||"bottom-left"===c||"top-right"===c||"bottom-right"===c?a+b:a};l.prototype._calculateAlignmentPosition=
function(a,c,b,d){var f=this.currentAlignment,k=this._pointerOffsetInPx;d/=2;var m=b.height-c;b=b.width-a;if("bottom-center"===f)return{top:c+k,left:a-d};if("top-left"===f)return{bottom:m+k,right:b+k};if("bottom-left"===f)return{top:c+k,right:b+k};if("top-right"===f)return{bottom:m+k,left:a+k};if("bottom-right"===f)return{top:c+k,left:a+k};if("top-center"===f)return{bottom:m+k,left:a-d}};l.prototype._calculatePositionStyle=function(a,c){var b=this.view;if(b){var d=b.padding;if(this.dockEnabled)return{left:d.left?
d.left+"px":"",top:d.top?d.top+"px":"",right:d.right?d.right+"px":"",bottom:d.bottom?d.bottom+"px":""};if(a&&c&&(c=this._calculateFullWidth(c.w),a=this._calculateAlignmentPosition(a.x,a.y,b,c)))return{top:void 0!==a.top?a.top+"px":"auto",left:void 0!==a.left?a.left+"px":"auto",bottom:void 0!==a.bottom?a.bottom+"px":"auto",right:void 0!==a.right?a.right+"px":"auto"}}};l.prototype._viewChange=function(a,c){a&&c&&(this.close(),this.clear())};l.prototype._viewReadyChange=function(a,c){a?(a=this.get("viewModel.view"),
this._wireUpView(a)):c&&(this.close(),this.clear())};l.prototype._wireUpView=function(a){this._destroySpinner();a&&(this.spinnerEnabled&&this._createSpinner(a),this._setDockEnabledForViewSize(this.dockOptions))};l.prototype._dockingThresholdCrossed=function(a,c,b){var d=a[0];a=a[1];var f=c[0];c=c[1];var k=b.width;b=b.height;return d<=k&&f>k||d>k&&f<=k||a<=b&&c>b||a>b&&c<=b};l.prototype._updateDockEnabledForViewSize=function(a,c){if(a&&c){var b=this.get("viewModel.view.padding")||{left:0,right:0,top:0,
bottom:0},d=b.left+b.right,f=b.top+b.bottom,b=[],k=[];b[0]=a[0]-d;b[1]=a[1]-f;k[0]=c[0]-d;k[1]=c[1]-f;a=this.dockOptions;this._dockingThresholdCrossed(b,k,a.breakpoint)&&this._setDockEnabledForViewSize(a);this._setCurrentDockPosition()}};l.prototype._hasFeatureUpdated=function(){var a=this._containerNode,c=this.viewModel.pendingPromisesCount,b=this.get("selectedPopupRenderer.viewModel.waitingForContent");!a||c||b||(a.classList.remove("esri-popup--feature-updated"),a.offsetHeight,a.classList.add("esri-popup--feature-updated"))};
l.prototype._storeMainContainerNode=function(a){this._mainContainerNode=a};l.prototype._storeFeatureMenuButtonNode=function(a){this._featureMenuButtonNode=a};l.prototype._storeFeatureMenuViewportNode=function(a){this._featureMenuViewportNode=a};l.prototype._toggleScreenLocationEnabled=function(){var a=this.dockEnabled,c=this.viewModel;c&&(c.screenLocationEnabled=this.visible&&!a)};l.prototype._shouldDockAtCurrentViewSize=function(a){a=a.breakpoint;var c=this.get("viewModel.view.ui"),b=c.width,c=c.height;
if(isNaN(b)||isNaN(c))return!1;b=a.hasOwnProperty("width")&&b<=a.width;a=a.hasOwnProperty("height")&&c<=a.height;return b||a};l.prototype._setDockEnabledForViewSize=function(a){a.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(a))};l.prototype._getPageText=function(a,c){return t.substitute({index:c+1,total:a},r.pageText)};l.prototype._destroySpinner=function(){this._spinner&&(this._spinner.destroy(),this._spinner=null)};l.prototype._createSpinner=function(a){a&&(this._spinner=new u({container:document.createElement("div"),
view:a}),a.root.appendChild(this._spinner.container))};l.prototype._closeFeatureMenu=function(){this.featureMenuOpen=!1};l.prototype._toggleCollapsed=function(){this.collapsed=!this.collapsed};l.prototype._close=function(){this.close()};l.prototype._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled};l.prototype._toggleFeatureMenu=function(){this.featureMenuOpen=!this.featureMenuOpen};l.prototype._triggerAction=function(a){this.viewModel.triggerAction(a.currentTarget["data-action-index"])};
l.prototype._selectFeature=function(a){a=a.currentTarget["data-feature-index"];isNaN(a)||(this.viewModel.selectedFeatureIndex=a);this._featureMenuButtonNode&&this._featureMenuButtonNode.focus()};l.prototype._next=function(){this.next()};l.prototype._previous=function(){this.previous()};a([q.aliasOf("viewModel.actions"),b.renderable()],l.prototype,"actions",void 0);a([q.property()],l.prototype,"alignment",void 0);a([q.aliasOf("viewModel.autoCloseEnabled")],l.prototype,"autoCloseEnabled",void 0);a([q.aliasOf("viewModel.content"),
b.renderable()],l.prototype,"content",void 0);a([q.property(),b.renderable()],l.prototype,"collapsed",void 0);a([q.property(),b.renderable()],l.prototype,"collapseEnabled",void 0);a([q.property({readOnly:!0,dependsOn:["dockEnabled","alignment"]}),b.renderable()],l.prototype,"currentAlignment",null);a([q.property({readOnly:!0,dependsOn:["dockEnabled","dockOptions"]}),b.renderable()],l.prototype,"currentDockPosition",null);a([q.property(),b.renderable()],l.prototype,"dockOptions",null);a([q.property(),
b.renderable()],l.prototype,"dockEnabled",void 0);a([q.aliasOf("viewModel.featureCount"),b.renderable()],l.prototype,"featureCount",void 0);a([q.property(),b.renderable()],l.prototype,"featureMenuOpen",void 0);a([q.aliasOf("viewModel.features"),b.renderable()],l.prototype,"features",void 0);a([q.property(),b.renderable()],l.prototype,"featureNavigationEnabled",void 0);a([q.aliasOf("viewModel.highlightEnabled")],l.prototype,"highlightEnabled",void 0);a([q.aliasOf("viewModel.location"),b.renderable()],
l.prototype,"location",void 0);a([q.property({readOnly:!0}),b.renderable()],l.prototype,"popupRenderers",void 0);a([q.aliasOf("viewModel.promises")],l.prototype,"promises",void 0);a([q.aliasOf("viewModel.selectedFeature"),b.renderable()],l.prototype,"selectedFeature",void 0);a([q.aliasOf("viewModel.selectedFeatureIndex"),b.renderable()],l.prototype,"selectedFeatureIndex",void 0);a([q.property({readOnly:!0}),b.renderable()],l.prototype,"selectedPopupRenderer",void 0);a([q.property()],l.prototype,"spinnerEnabled",
void 0);a([q.aliasOf("viewModel.title"),b.renderable()],l.prototype,"title",void 0);a([q.aliasOf("viewModel.updateLocationEnabled")],l.prototype,"updateLocationEnabled",void 0);a([q.aliasOf("viewModel.view")],l.prototype,"view",void 0);a([q.property({type:v}),b.renderable("viewModel.screenLocation viewModel.screenLocationEnabled viewModel.state viewModel.pendingPromisesCount viewModel.promiseCount viewModel.waitingForResult".split(" ")),b.vmEvent(["triggerAction","trigger-action"])],l.prototype,"viewModel",
void 0);a([q.aliasOf("viewModel.visible"),b.renderable()],l.prototype,"visible",void 0);a([q.aliasOf("viewModel.clear")],l.prototype,"clear",null);a([q.aliasOf("viewModel.next")],l.prototype,"next",null);a([q.aliasOf("viewModel.previous")],l.prototype,"previous",null);a([q.aliasOf("viewModel.triggerAction")],l.prototype,"triggerAction",null);a([b.accessibleHandler()],l.prototype,"_toggleCollapsed",null);a([b.accessibleHandler()],l.prototype,"_close",null);a([b.accessibleHandler()],l.prototype,"_toggleDockEnabled",
null);a([b.accessibleHandler()],l.prototype,"_toggleFeatureMenu",null);a([b.accessibleHandler()],l.prototype,"_triggerAction",null);a([b.accessibleHandler()],l.prototype,"_selectFeature",null);a([b.accessibleHandler()],l.prototype,"_next",null);a([b.accessibleHandler()],l.prototype,"_previous",null);return l=a([q.subclass("esri.widgets.Popup")],l)}(q.declared(p))})},"esri/widgets/support/widget":function(){define(["require","exports","./decorators","./jsxFactory","./widgetUtils"],function(w,l,f,a,
d){function b(a){for(var b in a)l.hasOwnProperty(b)||(l[b]=a[b])}Object.defineProperty(l,"__esModule",{value:!0});b(f);b(a);b(d)})},"esri/widgets/support/decorators":function(){define(["require","exports","./decorators/accessibleHandler","./decorators/renderable","./decorators/vmEvent"],function(w,l,f,a,d){function b(a){for(var b in a)l.hasOwnProperty(b)||(l[b]=a[b])}Object.defineProperty(l,"__esModule",{value:!0});b(f);b(a);b(d)})},"esri/widgets/support/decorators/accessibleHandler":function(){define(["require",
"exports","dojo/keys"],function(w,l,f){function a(a){return function(b){for(var d=[],t=1;t<arguments.length;t++)d[t-1]=arguments[t];t=b.type;if(b instanceof KeyboardEvent||"keyup"===t||"keydown"===t||"keypress"===t){if(b.keyCode===f.ENTER||b.keyCode===f.SPACE)b.preventDefault(),b.target.click()}else a.call.apply(a,[this,b].concat(d))}}Object.defineProperty(l,"__esModule",{value:!0});l.accessibleHandler=function(){return function(d,b){return{value:a(d[b])}}}})},"esri/widgets/support/decorators/renderable":function(){define(["require",
"exports","./propUtils"],function(w,l,f){Object.defineProperty(l,"__esModule",{value:!0});l.renderable=function(a){var d="string"===typeof a?f.splitProps(a):a;return function(a,q){a._renderableProps||(a._renderableProps=[]);a=a._renderableProps;d?a.push.apply(a,f.normalizePropNames(d,q)):a.push(q)}}})},"esri/widgets/support/decorators/propUtils":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});l.splitProps=function(f){return f.split(",").map(function(a){return a.trim()})};
l.normalizePropNames=function(f,a){return f.map(function(d){d=0===d.indexOf(a)?d:a+"."+d;return d})}})},"esri/widgets/support/decorators/vmEvent":function(){define(["require","exports","./propUtils"],function(w,l,f){Object.defineProperty(l,"__esModule",{value:!0});l.vmEvent=function(a){return function(d){d._delegatedEventNames||(d._delegatedEventNames=[]);var b=Array.isArray(a)?a:f.splitProps(a);d._delegatedEventNames=d._delegatedEventNames.concat(b)}}})},"esri/widgets/support/jsxFactory":function(){define(["require",
"exports","../libs/maquette/maquette"],function(w,l,f){Object.defineProperty(l,"__esModule",{value:!0});l.tsx=f.h})},"esri/widgets/support/widgetUtils":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});l.join=function(){for(var f=[],a=0;a<arguments.length;a++)f[a]=arguments[a];return f.join(" ")};l.isRtl=function(){return"rtl"===document.dir}})},"esri/widgets/Popup/PopupRenderer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../support/widget ../Widget ./PopupRendererViewModel ../../core/requireUtils ../support/uriUtils dojo/i18n!./nls/PopupRenderer ../../core/watchUtils".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x){function z(a,b){return void 0===b?"esri-popup-renderer__"+a:"esri-popup-renderer__"+a+"-"+b}return function(v){function r(a){a=v.call(this)||this;a._chartMap=new Map;a._activeMediaMap=new Map;a._chartRequirePromise=null;a._refreshTimers=new Map;a._mediaInfo=new Map;a.contentEnabled=null;a.graphic=null;a.title=null;a.view=null;a.viewModel=new t;return a}f(r,v);r.prototype.postInitialize=function(){var a=this;this.own(x.init(this,"viewModel.content",function(){return a._setupMediaRefreshTimers()}))};
r.prototype.destroy=function(){this._clearMediaRefreshTimers();this._activeMediaMap.clear();this._activeMediaMap=null;this._cancelChartModules();this._destroyCharts()};r.prototype.render=function(){var a=b.tsx("div",{key:z("loading-container"),class:"esri-popup-renderer__loading-container"},b.tsx("span",{class:b.join("esri-icon-loading-indicator esri-rotating","esri-popup-renderer__loading-spinner")})),a=this.viewModel.waitingForContent?a:this._renderContent();return b.tsx("div",{class:"esri-popup-renderer"},
b.tsx("div",{class:"esri-popup-renderer__size-container"},b.tsx("div",{class:"esri-popup-renderer__main-container"},a)))};r.prototype.goToMedia=function(a,b){this._setContentElementMedia(a,b)};r.prototype.nextMedia=function(a){this._pageContentElementMedia(a,"next")};r.prototype.previousMedia=function(a){this._pageContentElementMedia(a,"previous")};r.prototype._cancelChartModules=function(){this._chartRequirePromise&&this._chartRequirePromise.cancel()};r.prototype._destroyChart=function(a){var b=
this._chartMap.get(a);b&&(b.chart.destroy(),b.tooltip.destroy());this._chartMap.delete(a)};r.prototype._destroyCharts=function(){this._chartMap.forEach(function(a){a.chart.destroy();a.tooltip.destroy()});this._chartMap.clear()};r.prototype._renderContent=function(){this._destroyCharts();var a=this.viewModel.content;if("string"===typeof a)return b.tsx("div",{key:z("content-string"),innerHTML:a});if(a&&a.isInstanceOf&&a.isInstanceOf(q))return b.tsx("div",{key:z("content-widget")},a.render());if(a instanceof
HTMLElement)return b.tsx("div",{key:z("content-html-element"),bind:a,afterUpdate:this._attachToNode,afterCreate:this._attachToNode});if(a&&"function"===typeof a.postMixInProperties&&"function"===typeof a.buildRendering&&"function"===typeof a.postCreate&&"function"===typeof a.startup)return b.tsx("div",{key:z("content-dijit"),bind:a.domNode,afterUpdate:this._attachToNode,afterCreate:this._attachToNode});if(Array.isArray(a))return a.length?b.tsx("div",{key:z("content-content-elements")},a.map(this._renderContentElement,
this)):null};r.prototype._renderContentElement=function(a,b){var d=this.viewModel.contentTypes;switch(a.type){case d.attachments:return this._renderAttachments(a,b);case d.fields:return this._renderFields(a,b);case d.media:return this._renderMedia(a,b);case d.text:return this._renderText(a,b);default:return null}};r.prototype._renderAttachmentInfo=function(a,d){return b.tsx("li",{class:"esri-popup-renderer__attachments-item",key:z("attachment",d)},b.tsx("a",{class:"esri-popup-renderer__attachments-item-link",
href:a.url,target:"_blank"},b.tsx("span",{class:b.join("esri-icon-download","esri-popup-renderer__attachments-item-icon")}),b.tsx("span",{class:"esri-popup-renderer__attachments-item-title"},a.name||p.noTitle)))};r.prototype._renderAttachments=function(a,d){return(a=a.attachmentInfos)&&a.length?b.tsx("div",{key:z("attachments-element"),class:b.join("esri-popup-renderer__attachments","esri-popup-renderer__content-element")},b.tsx("div",{class:"esri-popup-renderer__attachments-title"},p.attach),b.tsx("ul",
{class:"esri-popup-renderer__attachments-items"},a.map(this._renderAttachmentInfo))):null};r.prototype._renderFieldInfo=function(a,d){var f=this.viewModel,c=f.formattedAttributes.content[d]||f.formattedAttributes.global,m=a.fieldName,f=a.label||m;a=!(!a.format||!a.format.dateFormat);c=k.autoLink(null==c[m]?"":c[m]);a=(p={},p["esri-popup-renderer__field-data--date"]=a,p);return b.tsx("tr",{key:z("fields-element-info-row",d)},b.tsx("th",{key:z("fields-element-info-row-header",d),class:"esri-popup-renderer__field-header",
innerHTML:f}),b.tsx("td",{key:z("fields-element-info-row-data",d),class:"esri-popup-renderer__field-data",classes:a,innerHTML:c}));var p};r.prototype._renderFields=function(a,d){var f=this;return(a=a.fieldInfos)?b.tsx("div",{key:z("fields-element",d),class:b.join("esri-popup-renderer__fields","esri-popup-renderer__content-element")},b.tsx("table",{summary:p.fieldsSummary,key:z("fields-element-table",d)},b.tsx("tbody",{key:z("fields-element-table-body",d)},a.map(function(a){return f._renderFieldInfo(a,
d)})))):null};r.prototype._shouldOpenInNewTab=function(a){void 0===a&&(a="");return!/^(?:mailto:|tel:)/.test(a.trim().toLowerCase())};r.prototype._clearMediaRefreshTimers=function(){this._refreshTimers.forEach(function(a){return clearTimeout(a)});this._refreshTimers.clear()};r.prototype._clearMediaRefreshTimer=function(a){var b=this._refreshTimers.get(a);b&&(clearTimeout(b),this._refreshTimers.delete(a))};r.prototype._getImageSource=function(a,b){var d=-1!==a.indexOf("?")?"\x26":"?";a=a.split("#");
var c=a[1],c=void 0===c?"":c;return""+a[0]+d+"timestamp\x3d"+b+(c?"#":"")+c};r.prototype._setupMediaRefreshTimer=function(a){var b=this.get("viewModel.content");if(Array.isArray(b)&&(b=b[a])&&"media"===b.type){var d=this._activeMediaMap.get(a);isNaN(d)&&(d=0);(b=b.mediaInfos[d])&&"image"===b.type&&b.refreshInterval&&this._setRefreshTimeout(a,b)}};r.prototype._setupMediaRefreshTimers=function(){var a=this;this._clearMediaRefreshTimers();var b=this.get("viewModel.content");Array.isArray(b)&&b.forEach(function(b,
c){return a._setupMediaRefreshTimer(c)})};r.prototype._updateMediaInfoTimestamp=function(a,b){var d=Date.now();this._mediaInfo.set(b,{timestamp:d,sourceURL:this._getImageSource(a,d)});this.scheduleRender()};r.prototype._setRefreshTimeout=function(a,b){var d=this,c=b.refreshInterval,f=b.value;c&&(b=6E4*c,this._updateMediaInfoTimestamp(f.sourceURL,a),b=setInterval(function(){d._updateMediaInfoTimestamp(f.sourceURL,a)},b),this._refreshTimers.set(a,b))};r.prototype._renderMediaInfoType=function(a,d){var f=
a.value,c=a.title,c=void 0===c?"":c,k=a.type,m=a.refreshInterval,p=f.sourceURL,f=f.linkURL;if("image"===k)return a=this._shouldOpenInNewTab(f)?"_self":"_blank",p=(m=m?this._mediaInfo.get(d):null)?m.sourceURL:p,d=b.tsx("img",{alt:c,key:z("media-image-"+(m?m.timestamp:0),d),src:p}),(c=f?b.tsx("a",{title:c,href:f,target:a},d):null)?c:d;if(-1!==k.indexOf("chart"))return b.tsx("div",{key:z("chart",d),bind:this,"data-media-info":a,"data-content-element-index":d,class:"esri-popup-renderer__media-chart",
afterCreate:this._getChartDependencies,afterUpdate:this._getChartDependencies})};r.prototype._getChartDependencies=function(a){var b=this,d=a["data-media-info"],c=a["data-content-element-index"],f=d.value,k=f.theme||"Claro",p=d.type,d=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],r=k;"string"===typeof k&&(r=k.replace(/\./g,"/"),-1===r.indexOf("/")&&(r="dojox/charting/themes/"+r));d.push(r);this._cancelChartModules();this._chartRequirePromise=m.when(w,d).then(function(d){b._renderChart(a,
c,p,f,d[0],d[1],d[2]);b._chartRequirePromise=null})};r.prototype._renderChart=function(a,b,d,c,f,k,m){a=new f(a,{margins:{l:4,t:4,r:4,b:4}});m&&a.setTheme(m);switch(d){case "pie-chart":a.addPlot("default",{type:"Pie",labels:!1});a.addSeries("Series A",c.fields);break;case "line-chart":a.addPlot("default",{type:"Markers"});a.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});a.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});c.fields.forEach(function(a,c){a.x=
c+1});a.addSeries("Series A",c.fields);break;case "column-chart":a.addPlot("default",{type:"Columns",gap:3});a.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});a.addSeries("Series A",c.fields);break;case "bar-chart":a.addPlot("default",{type:"Bars",gap:3}),a.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),a.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),a.addSeries("Series A",c.fields)}d=new k(a);a.render();this._chartMap.set(b,{chart:a,
tooltip:d})};r.prototype._renderMediaInfo=function(a,d){this._destroyChart(d);var f=this._renderMediaInfoType(a,d),c=a.title?b.tsx("div",{key:z("media-title",d),class:"esri-popup-renderer__media-item-title",innerHTML:a.title}):null;a=a.caption?b.tsx("div",{key:z("media-caption",d),class:"esri-popup-renderer__media-item-caption",innerHTML:a.caption}):null;return b.tsx("div",{key:z("media-container",d),class:"esri-popup-renderer__media-item-container"},b.tsx("div",{key:z("media-item-container",d),class:"esri-popup-renderer__media-item"},
f),c,a)};r.prototype._renderMediaStatsItem=function(a,d,f){f="chart"===f?b.join("esri-popup-renderer__media-chart-icon","esri-icon-chart"):b.join("esri-popup-renderer__media-image-icon","esri-icon-media");return b.tsx("li",{class:"esri-popup-renderer__media-image-summary"},b.tsx("span",{class:"esri-popup-renderer__media-count","aria-label":a},"("+d+")"),b.tsx("span",{"aria-hidden":"true",class:f}))};r.prototype._renderMediaPageButton=function(a,d){var f=(a="previous"===a)?p.previous:p.next,c=a?b.join("esri-popup-renderer__button",
"esri-popup-renderer__media-previous"):b.join("esri-popup-renderer__button","esri-popup-renderer__media-next"),k=a?b.join("esri-popup-renderer__icon","esri-popup-renderer__media-previous-icon","esri-icon-left-triangle-arrow"):b.join("esri-popup-renderer__icon","esri-popup-renderer__media-next-icon","esri-icon-right-triangle-arrow"),m=a?b.join("esri-popup-renderer__icon","esri-popup-renderer__media-previous-icon--rtl","esri-icon-right-triangle-arrow"):b.join("esri-popup-renderer__icon","esri-popup-renderer__media-next-icon--rtl",
"esri-icon-left-triangle-arrow"),r=a?this._previousClick:this._nextClick;return b.tsx("div",{key:z(a?"previous":"next",d),title:f,tabIndex:0,role:"button",class:c,"data-content-element-index":d,bind:this,onkeydown:r,onclick:r},b.tsx("span",{"aria-hidden":"true",class:k}),b.tsx("span",{"aria-hidden":"true",class:m}),b.tsx("span",{class:"esri-icon-font-fallback-text"},f))};r.prototype._renderMedia=function(a,d){a=a.mediaInfos;var f=this._getMediaStats(a),c=f.total,k=(m={},m["esri-popup-renderer--media-pagination-visible"]=
1<f.total,m),m=this._renderMediaStatsItem(p.numImages,f.images,"image"),f=this._renderMediaStatsItem(p.numCharts,f.charts,"chart"),r=this._renderMediaPageButton("previous",d),u=this._renderMediaPageButton("next",d),v=this._activeMediaMap.get(d);isNaN(v)&&(this._activeMediaMap.set(d,0),v=0);return c?b.tsx("div",{key:z("media-element",d),class:b.join("esri-popup-renderer__media","esri-popup-renderer__content-element"),classes:k},b.tsx("ul",{class:"esri-popup-renderer__media-summary"},m,f),b.tsx("div",
{key:z("media-element-container",d),class:"esri-popup-renderer__media-container"},r,this._renderMediaInfo(a[v],d),u)):null;var m};r.prototype._renderText=function(a,d){return a.text?b.tsx("div",{key:z("text-element",d),innerHTML:a.text,class:b.join("esri-popup-renderer__text","esri-popup-renderer__content-element")}):null};r.prototype._attachToNode=function(a){a.appendChild(this)};r.prototype._getMediaStats=function(a){var b=0,d=0;a.forEach(function(a){a=a.type;"image"===a?b++:-1!==a.indexOf("chart")&&
d++});return{total:d+b,images:b,charts:d}};r.prototype._setContentElementMedia=function(a,b){this._clearMediaRefreshTimer(a);var d=this.viewModel.content;(d=(d=d&&d[a])&&d.mediaInfos)&&d.length&&(this._activeMediaMap.set(a,(b+d.length)%d.length),this._setupMediaRefreshTimer(a),this.scheduleRender())};r.prototype._pageContentElementMedia=function(a,b){b="previous"===b?-1:1;b=this._activeMediaMap.get(a)+b;this._setContentElementMedia(a,b)};r.prototype._previousClick=function(a){this.previousMedia(a.currentTarget["data-content-element-index"])};
r.prototype._nextClick=function(a){this.nextMedia(a.currentTarget["data-content-element-index"])};a([d.aliasOf("viewModel.contentEnabled")],r.prototype,"contentEnabled",void 0);a([d.aliasOf("viewModel.graphic")],r.prototype,"graphic",void 0);a([d.aliasOf("viewModel.title")],r.prototype,"title",void 0);a([d.aliasOf("viewModel.view")],r.prototype,"view",void 0);a([d.property({type:t}),b.renderable(["viewModel.waitingForContent","viewModel.content"])],r.prototype,"viewModel",void 0);a([b.accessibleHandler()],
r.prototype,"_previousClick",null);a([b.accessibleHandler()],r.prototype,"_nextClick",null);return r=a([d.subclass("esri.widgets.Popup.PopupRenderer")],r)}(d.declared(q))})},"esri/widgets/support/uriUtils":function(){define(["require","exports","../../core/lang","dojo/i18n!./nls/uriUtils"],function(w,l,f,a){function d(a){var d=null;b.some(function(b){b.pattern.test(a)&&(d=b);return!!d});return d}Object.defineProperty(l,"__esModule",{value:!0});var b=[{id:"http",pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,
target:"_blank",label:a.view},{id:"tel",pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"mailto",pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"arcgis-appstudio-player",pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:a.openInApp,appName:"App Studio Player"},{id:"arcgis-collector",pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:a.openInApp,appName:"Collector"},{id:"arcgis-explorer",pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:a.openInApp,
appName:"Explorer"},{id:"arcgis-navigator",pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:a.openInApp,appName:"Navigator"},{id:"arcgis-survey123",pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:a.openInApp,appName:"Survey123"},{id:"arcgis-trek2there",pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:a.openInApp,appName:"Trek2There"},{id:"arcgis-workforce",pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:a.openInApp,appName:a.workforce},{id:"iform",pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,
label:a.openInApp,appName:"iForm"},{id:"flow",pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:a.openInApp,appName:"FlowFinity"},{id:"lfmobile",pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:a.openInApp,appName:"Laserfische"},{id:"mspbi",pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:a.openInApp,appName:"Microsoft Power Bi"}];l.autoLink=function(a){if("string"!==typeof a||!a)return a;var b=d(a);if(!b)return a;var m=a.match(b.pattern),m=f.substitute({appName:b.appName,hierPart:m&&m[2]},b.label);return a.replace(b.pattern,
"\x3ca "+(b.target?'target\x3d"'+b.target+'"':"")+'" href\x3d"$1"\x3e'+m+"\x3c/a\x3e")}})},"esri/widgets/Popup/PopupViewModel":function(){define("../../core/Accessor ../../core/Collection ../../core/Error ../../core/Evented ../../core/HandleRegistry ../../core/promiseUtils ../../core/watchUtils ../../geometry/geometryEngine ../../geometry/support/webMercatorUtils ../../geometry/Point ../../support/Action ../support/AnchorElementViewModel dojo/fx/easing dojo/_base/lang".split(" "),function(w,l,f,a,
d,b,q,t,m,k,p,x,z,v){function r(a,b){return b.allLayerViews.find(function(c){return c.layer===a})}var u={id:"zoom-to"};return w.createSubclass([a,x],{declaredClass:"esri.widgets.Popup.PopupViewModel",properties:{actions:{type:l.ofType(p)},animationOptions:{},autoCloseEnabled:{},clear:{},content:{},featureCount:{readOnly:!0},features:{},location:{type:k},next:{},pendingPromisesCount:{readOnly:!0},previous:{},promiseCount:{readOnly:!0,dependsOn:["promises"],get:function(){return this.promises?this.promises.length:
0}},promises:{},selectedFeature:{readOnly:!0},selectedFeatureIndex:{},state:{dependsOn:["view.ready"],readOnly:!0},title:{},triggerAction:{},updateLocationEnabled:{},view:{},visible:{},waitingForResult:{dependsOn:["pendingPromisesCount","featureCount"],readOnly:!0},zoomFactor:{}},_handles:null,constructor:function(){this._handles=new d},getDefaults:function(a){return v.mixin(this.inherited(arguments),{actions:[u],animationOptions:{duration:300,easing:z.quadInOut},promises:[]})},initialize:function(){this._handles.add([this.on("view-change",
this._autoClose),q.watch(this,"location",this._locationWatcher),q.whenFalse(this,"visible",this._visibleWatcher)])},destroy:function(){this._handles.destroy();this.view=this._handles=null},actions:[u],animationOptions:{duration:300,easing:z.quadInOut},autoCloseEnabled:!1,content:null,featureCount:0,features:null,_featuresSetter:function(a){this._set("features",a);this._updateFeatureCount(a);this.promiseCount||(this.selectedFeatureIndex=-1,a&&a.length&&(this.selectedFeatureIndex=0))},highlightEnabled:!0,
_highlightEnabledSetter:function(a){this._set("highlightEnabled",a);this._highlightFeature(this.selectedFeature,this.view)},location:null,_locationSetter:function(a){var b=this.get("view.spatialReference.isWebMercator");a&&a.get("spatialReference.isWGS84")&&b&&(a=m.geographicToWebMercator(a));this._set("location",a)},pendingPromisesCount:0,waitingForResult:!1,_waitingForResultGetter:function(){return 0<this.pendingPromisesCount&&0===this.featureCount},promiseCount:0,promises:[],_promisesSetter:function(a){var d=
this._get("promises");d&&d.forEach(function(a){a.cancel()});this.features=[];d=a&&a.length;this._set("selectedFeatureIndex",-1);this._set("selectedFeature",null);this._selectedFeatureChange(this.selectedFeature,this.updateLocationEnabled);this._set("pendingPromisesCount",0);this._set("promises",a);a&&a.length&&(this._set("pendingPromisesCount",d),a=a.slice(0),a.forEach(function(a){a.always(function(c){a.isCanceled()||(this._set("pendingPromisesCount",this.pendingPromisesCount-1),this._updateFeatures(a,
c))}.bind(this))},this),b.eachAlways(a).then(function(){this.featureCount||(this.visible=!1)}.bind(this)))},selectedFeature:null,selectedFeatureIndex:-1,_selectedFeatureIndexSetter:function(a){if(isNaN(a)||-1>a)a=-1;var b=null,c=this.features;c&&c.length&&(a=(a+c.length)%c.length,b=c[a]);this._set("selectedFeature",b);this._set("selectedFeatureIndex",a);this._selectedFeatureChange(b,this.updateLocationEnabled)},state:"disabled",_stateGetter:function(){return this.get("view.ready")?"ready":"disabled"},
title:null,updateLocationEnabled:!1,_updateLocationEnabledSetter:function(a){this._selectedFeatureChange(this.selectedFeature,a);this._set("updateLocationEnabled",a)},view:null,visible:!1,zoomFactor:4,centerAtLocation:function(){return this.location&&this.view?this.view.goTo({target:this.location,scale:this.view.scale},this.animationOptions):b.reject(new f(this.declaredClass+"::Cannot center at location without a location and view."))},clear:function(){this.set({promises:[],features:[],content:null,
title:null,location:null})},triggerAction:function(a){(a=this.actions.getItemAt(a))&&this.emit("trigger-action",{action:a})},next:function(){this.selectedFeatureIndex+=1;return this},previous:function(){--this.selectedFeatureIndex;return this},zoomToLocation:function(){var a=this.view,d=this.location;if(!d||!a)return b.reject(new f(this.declaredClass+"::Cannot zoom to location without a location and view."));var c=a.scale/this.zoomFactor,k=this.selectedFeature,m=k&&k.geometry,p=k&&"3d"===a.type;m||
p?(d={target:k},m&&"point"===m.type&&this._isScreenSize(k)&&(d.scale=c,this.location=m)):d={target:d,scale:c};return a.goTo(d,this.animationOptions)},_autoClose:function(){this.autoCloseEnabled&&(this.visible=!1)},_isScreenSize:function(a){if("3d"!==this.view.type||"esri.Graphic"!==a.declaredClass)return!0;var b=!0,c=this.view.getViewForGraphic(a);c&&c.whenGraphicBounds&&c.whenGraphicBounds(a).then(function(a){b=!a||a[0]===a[3]&&a[1]===a[4]&&a[2]===a[5]});return b},_getSelectedFeatureActions:function(){this._originalActions&&
(this.actions=this._originalActions,this._originalActions=null);var a=this.actions.filter(function(a){return!a.temporary},this),b=a,c=this.selectedFeature.popupTemplate;if(c&&c.actions){for(var b=c.actions,d=0;d<b.length;d++)b.getItemAt(d).temporary=!0;c.overwriteActions?this._originalActions=a:b=a.concat(b)}this.actions=b},_getPointFromGeometry:function(a){switch(a&&a.type){case "point":return a;case "extent":return a.center;case "polygon":return a.centroid;case "multipoint":case "polyline":return a.extent.center;
default:return null}},_locationWatcher:function(a,b){var c=this.get("view.extent");this.updateLocationEnabled&&c&&a&&a!==b&&!t.contains(c,a)&&this.centerAtLocation()},_visibleWatcher:function(a){this._handles.remove("highlight")},_highlightFeature:function(a,b){this._handles.remove("highlight");if(a&&b&&this.highlightEnabled){var c=a.layer;if(c&&(b=r(c,b))&&"function"===typeof b.highlight){var c=c.objectIdField,d=a.attributes;a=b.highlight(d&&d[c]||a);this._handles.add(a,"highlight")}}},_selectedFeatureChange:function(a,
b){this._highlightFeature(a,this.view);a&&(b&&(this.location=this._getPointFromGeometry(a.geometry)),this._getSelectedFeatureActions())},_updateFeatureCount:function(a){var b=0;a&&a.length&&(b=a.length);this._set("featureCount",b)},_updateFeatures:function(a,b){a&&this.promises&&!(!this._validatePromise(a)||b instanceof f||b instanceof Error)&&b&&b.length&&(a={},this.features&&this.features.length?(b=b.filter(function(a){return-1===this.features.indexOf(a)},this),a.features=this.features.concat(b)):
(a.features=b,a.selectedFeatureIndex=0),this.set(a))},_validatePromise:function(a){return-1<this.promises.indexOf(a)}})})},"esri/geometry/geometryEngine":function(){define("require exports ../kernel ./Geometry ./Polygon ./Polyline ./Point ./Extent ./Multipoint dojo/_base/lang".split(" "),function(w,l,f,a,d,b,q,t,m,k){function p(a){if(void 0===q.fromJson){if(void 0!==a.x&&void 0!==a.y)return new q(a);if(void 0!==a.paths)return new b(a);if(void 0!==a.rings)return new d(a);if(void 0!==a.points)return new m(a);
if(void 0!==a.xmin&&void 0!==a.ymin&&void 0!==a.xmax&&void 0!==a.ymax)return new t(a)}else{if(void 0!==a.x&&void 0!==a.y)return q.fromJson(a);if(void 0!==a.paths)return b.fromJson(a);if(void 0!==a.rings)return d.fromJson(a);if(void 0!==a.points)return m.fromJson(a);if(void 0!==a.xmin&&void 0!==a.ymin&&void 0!==a.xmax&&void 0!==a.ymax)return t.fromJson(a)}}function x(a){if(void 0===q.fromJson){if(void 0!==a.x&&void 0!==a.y)return new q(a);if(void 0!==a.paths)return new b(a);if(void 0!==a.rings)return new d(a);
if(void 0!==a.points)return new m(a);if(void 0!==a.xmin&&void 0!==a.ymin&&void 0!==a.xmax&&void 0!==a.ymax)return new t(a)}else{if(void 0!==a.x&&void 0!==a.y)return q.fromJSON(a);if(void 0!==a.paths)return b.fromJSON(a);if(void 0!==a.rings)return d.fromJSON(a);if(void 0!==a.points)return m.fromJSON(a);if(void 0!==a.xmin&&void 0!==a.ymin&&void 0!==a.xmax&&void 0!==a.ymax)return t.fromJSON(a)}}function z(a,c){var A;if(null==a||void 0===a||"number"===typeof a)return a;var h=a.toString();if(""===h)return null;
if(2==c){if(A=M[h],void 0!==A)return A}else if(0==c){A=L[h];if(void 0!==A)return A;A=R[a];if(void 0!==A)return A}else if(3==c&&(A=L[h],void 0!==A))return A;if(1==c&&(A=R[a],void 0!==A))return A;if(!0===/^\d+$/.test(h))return parseInt(h);throw Error("Unrecognised Unit Type");}function v(a){if(void 0!==a&&null!==a)switch(a){case "loxodrome":return 1;case "great-elliptic":return 2;case "normal-section":return 3;case "shape-preserving":return 4}return 0}function r(a,c){if(null===a||void 0===a||a.s())return null;
switch(a.D()){case B.Xn.Point:var A=new q(a.lk(),a.mk(),c);if(P){var h=a.hasAttribute(B.xf.M);a.hasAttribute(B.xf.Z)&&A.set("z",a.lO());h&&A.set("m",a.NN())}return A;case B.Xn.Polygon:var A=a.hasAttribute(B.xf.Z),h=a.hasAttribute(B.xf.M),e=u(a,A,h),A=new d({rings:e,hasZ:A,hasM:h});P?A.set("spatialReference",c):A.setSpatialReference(c);A.setCacheValue("_geVersion",a);return A;case B.Xn.Polyline:return A=a.hasAttribute(B.xf.Z),h=a.hasAttribute(B.xf.M),e=u(a,A,h),A=new b({paths:e,hasZ:A,hasM:h}),P?A.set("spatialReference",
c):A.setSpatialReference(c),A.setCacheValue("_geVersion",a),A;case B.Xn.MultiPoint:var A=a.hasAttribute(B.xf.Z),h=a.hasAttribute(B.xf.M),g=e=null;A&&(e=a.mc(B.xf.Z));h&&(g=a.mc(B.xf.M));var n=new B.b,y=a.F();c=new m(c);P&&(c.set("hasZ",A),c.set("hasM",h));for(var F=0;F<y;F++){a.w(F,n);var N=[n.x,n.y];A&&N.push(e.get(F));h&&N.push(g.get(F));c.addPoint(N)}c.setCacheValue("_geVersion",a);return c;case B.Xn.Envelope:return e=a.hasAttribute(B.xf.Z),A=a.hasAttribute(B.xf.M),h=new t(a.R.v,a.R.C,a.R.B,a.R.G,
c),P&&(e&&(e=a.Ah(B.xf.Z,0),h.set("zmin",e.qa),h.set("zmax",e.va)),A&&(e=a.Ah(B.xf.M,0),h.set("mmin",e.qa),h.set("mmax",e.va))),h.setCacheValue("_geVersion",a),h}return null}function u(a,c,b){var h=[],e=a.ea(),g=null,n=null;c&&(g=a.mc(B.xf.Z));b&&(n=a.mc(B.xf.M));for(var y=new B.b,F=0;F<e;F++){for(var A=a.Ea(F),d=a.Ha(F),f=0,k=0,m=NaN,p=NaN,r=NaN,u=NaN,v=a.vc(F),q=[],x=A;x<A+d;x++){a.w(x,y);var u=r=NaN,D=[y.x,y.y];c&&(r=g.get(x),D.push(r));b&&(u=n.get(x),D.push(u));x==A&&v&&(f=y.x,k=y.y,m=r,p=u);
q.push(D)}!v||f==y.x&&k==y.y&&(!c||isNaN(m)&&isNaN(r)||m==r)&&(!b||isNaN(p)&&isNaN(u)||p==u)||q.push(q[0].slice(0));h.push(q)}return h}function C(a){var c=a._geVersion;if(null==c||void 0==c){if(Object.freeze&&Object.isFrozen(a))return 102100===a.wkid?T:4326===a.wkid?Q:c=B.Nf.create(a.wkid);-1!=a.wkid&&null!==a.wkid&&void 0!==a.wkid?(c=B.Nf.create(a.wkid),a._geVersion=c):""!==a.wkt&&void 0!==a.wkt&&null!==a.wkt&&(c=B.Nf.NL(a.wkt),a._geVersion=c)}return c}function E(a){if(null==a)return null;var c=
a.getCacheValue("_geVersion");if(null==c||void 0==c)c=B.Pb.IL(a),a.setCacheValue("_geVersion",c);return c}function c(a){return null===a.spatialReference?null:C(a.spatialReference)}var D=this&&this.__extends||function(a,c){function A(){this.constructor=a}for(var h in c)c.hasOwnProperty(h)&&(a[h]=c[h]);a.prototype=null===c?Object.create(c):(A.prototype=c.prototype,new A)},B;(function(a){var c=function(){function a(){}a.Sk=!1;a.it=!1;a.$v="";return a}();a.ah=c;if("undefined"!==typeof window)a.ah.$v=
"browser","Float64Array"in window&&(a.ah.it=!0),"ArrayBuffer"in window&&(a.ah.Sk=!0);else if("undefined"!==typeof process)c.$v="node",a.ah.Sk=!0,a.ah.it=!0;else{c.$v="browser";try{var A=new ArrayBuffer(0);new Uint8Array(A);a.ah.Sk=!0;a.ah.it=!0}catch(h){a.ah.Sk=!1}}})(B||(B={}));(function(a){(function(a){a[a.Unknown=0]="Unknown";a[a.Point=33]="Point";a[a.Line=322]="Line";a[a.Envelope=197]="Envelope";a[a.MultiPoint=550]="MultiPoint";a[a.Polyline=1607]="Polyline";a[a.Polygon=1736]="Polygon"})(a.Xn||
(a.Xn={}));(function(a){a[a.enumMild=0]="enumMild";a[a.enumMedium=1]="enumMedium";a[a.enumHot=2]="enumHot"})(a.rH||(a.rH={}));var c=function(){function c(){this.description=null;this.Ux=0}c.prototype.D=function(){return 0};c.prototype.fb=function(){return-1};c.prototype.Qf=function(a){this.qc();a!=this.description&&this.nm(a)};c.prototype.nm=function(){};c.prototype.Ik=function(h){this.qc();h!=this.description&&(h=a.Od.QN(this.description,h),h!=this.description&&this.nm(h))};c.prototype.hasAttribute=
function(a){return this.description.hasAttribute(a)};c.prototype.Ne=function(h){this.qc();this.description.hasAttribute(h)||(h=a.Od.PN(this.description,h),this.nm(h))};c.prototype.Ah=function(){return null};c.prototype.Fp=function(){};c.prototype.o=function(){};c.prototype.Cn=function(){};c.prototype.dd=function(a){this.o(a)};c.prototype.s=function(){return!0};c.prototype.Ja=function(){};c.prototype.Oe=function(){};c.prototype.Pa=function(){return null};c.prototype.copyTo=function(){};c.prototype.Mh=
function(){return 0};c.prototype.$b=function(){return 0};c.prototype.WC=function(){return this.hasAttribute(1)};c.ve=function(a){return((a&192)>>6)+1>>1};c.Km=function(a){return 0!=(a&32)};c.qT=function(a){return 0!=(a&64)};c.SO=function(a){return 0!=(a&128)};c.Lc=function(a){return 0!=(a&256)};c.Th=function(a){return 0!=(a&512)};c.Kc=function(a){return 0!=(a&1024)};c.prototype.vm=function(){var a=this.Pa();this.copyTo(a);return a};c.prototype.Rf=function(){return null};c.Yj=function(a){var e=a.Pa();
a.copyTo(e);return e};c.prototype.qc=function(){0<=this.Ux&&(this.Ux+=2147483649)};c.Vu=function(h){var e=h.D();if(c.Th(e))return h.F();if(h.s())return 0;if(197==e)return 4;if(33==e)return 1;if(c.Lc(e))return 2;throw a.g.ra("missing type");};return c}();a.T=c})(B||(B={}));(function(a){var c=function(){function c(){this.y=this.x=0}c.Oa=function(a,e){var g=new c;g.x=a;g.y=e;return g};c.prototype.ma=function(a,e){this.x=a;this.y=e};c.prototype.J=function(a){this.x=a.x;this.y=a.y};c.prototype.Cq=function(a,
e){return this.x===a&&this.y===e};c.prototype.Ww=function(a){return 2.220446049250313E-16>=Math.abs(this.x-a.x)&&2.220446049250313E-16>=Math.abs(this.y-a.y)};c.prototype.ub=function(a){return this.x===a.x&&this.y===a.y};c.prototype.lc=function(a){return a==this?!0:a instanceof c?this.x==a.x&&this.y==a.y:!1};c.prototype.sub=function(a){this.x-=a.x;this.y-=a.y};c.prototype.pc=function(a,e){this.x=a.x-e.x;this.y=a.y-e.y};c.prototype.add=function(a,e){void 0!==e?(this.x=a.x+e.x,this.y=a.y+e.y):(this.x+=
a.x,this.y+=a.y)};c.prototype.Bp=function(){this.x=-this.x;this.y=-this.y};c.prototype.qr=function(a){this.x=-a.x;this.y=-a.y};c.prototype.OO=function(a,e,g){this.x=a.x*(1-g)+e.x*g;this.y=a.y*(1-g)+e.y*g};c.prototype.Fr=function(a,e){this.x=this.x*a+e.x;this.y=this.y*a+e.y};c.prototype.DR=function(a,e,g){this.x=e.x*a+g.x;this.y=e.y*a+g.y};c.prototype.scale=function(a){this.x*=a;this.y*=a};c.prototype.compare=function(a){return this.y<a.y?-1:this.y>a.y?1:this.x<a.x?-1:this.x>a.x?1:0};c.prototype.normalize=
function(){var a=this.length();0==a&&(this.x=1,this.y=0);this.x/=a;this.y/=a};c.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};c.prototype.Up=function(){return this.x*this.x+this.y*this.y};c.Fb=function(a,e){return Math.sqrt(this.Zb(a,e))};c.Yv=function(a,e,g,n){a-=g;e-=n;return Math.sqrt(a*a+e*e)};c.prototype.ml=function(a){return this.x*a.x+this.y*a.y};c.prototype.uA=function(a){return Math.abs(this.x*a.x)+Math.abs(this.y*a.y)};c.prototype.Ai=function(a){return this.x*
a.y-this.y*a.x};c.prototype.Er=function(a,e){var g=-this.x*e+this.y*a;this.x=this.x*a+this.y*e;this.y=g};c.prototype.tt=function(){var a=this.x;this.x=-this.y;this.y=a};c.prototype.zD=function(a){this.x=-a.y;this.y=a.x};c.prototype.Kp=function(){var a=this.x;this.x=this.y;this.y=-a};c.prototype.FA=function(){this.y=this.x=NaN};c.prototype.pv=function(){return isNaN(this.x)};c.prototype.ps=function(){return 0<this.x?0<=this.y?1:4:0<this.y?2:0==this.x?4:3};c.cq=function(a,e){var g=a.ps(),n=e.ps();return n==
g?(g=a.Ai(e),0>g?1:0<g?-1:0):g<n?-1:1};c.HT=function(a,e){return c.cq(a,e)};c.Zb=function(a,e){var g=a.x-e.x;a=a.y-e.y;return g*g+a*a};c.prototype.toString=function(){return"("+this.x+" , "+this.y+")"};c.prototype.Eh=function(){this.y=this.x=NaN};c.prototype.yJ=function(){return this.pv()?NaN:Math.abs(this.x)>=Math.abs(this.y)?Math.abs(this.x):Math.abs(this.y)};c.prototype.offset=function(a,e){var g=c.Fb(a,e),n=c.Oa(this.x,this.y);if(0==g)return c.Fb(n,a);var h=new c;h.J(e);h.sub(a);n.sub(a);return n.Ai(h)/
g};c.yn=function(h,e,g){var n=new a.$k;n.set(e.x);n.sub(h.x);var y=new a.$k;y.set(g.y);y.sub(h.y);var F=new a.$k;F.set(e.y);F.sub(h.y);var c=new a.$k;c.set(g.x);c.sub(h.x);n.Ap(y);F.Ap(c);n.sub(F);if(!n.Dq())return g=n.value(),0>g?-1:0<g?1:0;n=new a.Tn(e.x);y=new a.Tn(h.x);F=new a.Tn(h.y);n=n.nr(y);h=new a.Tn(g.y);h=h.nr(F);e=new a.Tn(e.y);e=e.nr(F);g=new a.Tn(g.x);g=g.nr(y);n=n.Wp(h);e=e.Wp(g);n=n.Wp(e);return n.vP()?-1:n.nO()?1:0};c.prototype.hc=function(){return a.I.Rh(a.I.Rh())};return c}();a.b=
c})(B||(B={}));(function(a){var c=function(){function a(a){this.Ov=this.Or=0;this.ES=a}a.prototype.reset=function(){this.Ov=this.Or=0};a.prototype.add=function(a){a-=this.Ov;var e=this.Or+a;this.Ov=e-this.Or-a;this.Or=e};a.prototype.sub=function(a){this.add(-a)};a.prototype.rl=function(){return this.ES+this.Or};return a}();a.av=c;c=function(){function a(){}a.LT=function(a,e){return 0<=e?Math.abs(a):-Math.abs(a)};a.sign=function(a){return 0>a?-1:0<a?1:0};a.gH=function(a){return a-360*Math.floor(a/
360)};a.round=function(a){return Math.floor(a+.5)};a.Ty=function(a){return a*a};a.ut=function(a,e,g){var n;.5>=g?n=a+(e-a)*g:n=e-(e-a)*(1-g);return n};a.BD=function(a,e,g,n){.5>=g?(n.x=a.x+(e.x-a.x)*g,n.y=a.y+(e.y-a.y)*g):(n.x=e.x-(e.x-a.x)*(1-g),n.y=e.y-(e.y-a.y)*(1-g))};a.tP=function(a,e,g,n,y,F){.5>=y?(F.x=a+(g-a)*y,F.y=e+(n-e)*y):(F.x=g-(g-a)*(1-y),F.y=n-(n-e)*(1-y))};return a}();a.vi=c})(B||(B={}));(function(a){var c=function(c){function h(){c.call(this);this.ha=this.la=this.ja=this.na=0;this.fa=
null}D(h,c);h.prototype.Mb=function(){return a.b.Oa(this.na,this.ja)};h.prototype.ht=function(e){e.x=this.na;e.y=this.ja};h.prototype.ed=function(e){this.gl(0,e)};h.prototype.Ny=function(e,g){this.gl(0,a.b.Oa(e,g))};h.prototype.En=function(e){this.wA(0,e)};h.prototype.setStart=function(e){this.CA(0,e)};h.prototype.gt=function(e,g){return this.yd(0,e,g)};h.prototype.My=function(e,g,a){this.om(0,e,g,a)};h.prototype.oc=function(){return a.b.Oa(this.la,this.ha)};h.prototype.uw=function(e){e.x=this.la;
e.y=this.ha};h.prototype.vd=function(e){this.gl(1,e)};h.prototype.Ok=function(e,g){this.gl(1,a.b.Oa(e,g))};h.prototype.Bn=function(e){this.wA(1,e)};h.prototype.setEnd=function(e){this.CA(1,e)};h.prototype.Ws=function(e,g){return this.yd(1,e,g)};h.prototype.Cy=function(e,g,a){this.om(1,e,g,a)};h.prototype.fb=function(){return 1};h.prototype.s=function(){return this.sc()};h.prototype.Ja=function(){};h.prototype.Mh=function(){return 0};h.prototype.Ga=function(e,g,a,h,F){return this.wJ(e,g,a,h,F)};h.prototype.jc=
function(e,g){return 0!=this.fq(e,g,!1)};h.prototype.Eq=function(e,g){return this.qs(e,g,!1)};h.prototype.qs=function(){return null};h.prototype.sc=function(){return!1};h.prototype.rv=function(e){this.qc();if(null==this.fa&&0<e)this.fa=a.I.Lh(2*e);else if(null!=this.fa&&this.fa.length<2*e){for(var g=this.fa.slice(0),n=this.fa.length;n<2*e;n++)g[n]=0;this.fa=g}};h.KI=function(e,g,a){if(0<a)var n=0;for(var h=0;h<a;h++)g[0+n]=e[0],n++};h.prototype.gl=function(e,g){0!=e?(this.la=g.x,this.ha=g.y):(this.na=
g.x,this.ja=g.y)};h.prototype.nm=function(e){if(null!=this.fa){for(var g=a.Od.iu(e,this.description),n=[],y=h.Xk(this.description,0),F=h.Xk(this.description,1),c=h.Xk(e,0),b=h.Xk(e,1),A=0,d=1,f=e.Aa;d<f;d++){var k=e.Hd(d),m=a.pa.Wa(k);if(-1==g[d])for(var p=a.pa.ue(k),k=0;k<m;k++)n[c+A]=p,n[b+A]=p,A++;else for(p=this.description.fj(g[d])-2,k=0;k<m;k++)n[c+A]=this.fa[y+p],n[b+A]=this.fa[F+p],A++,p++}this.fa=n}this.description=e};h.prototype.wA=function(e,g){if(this.sc())throw a.g.ra("empty geometry");
g.Qf(this.description);g.sc()&&g.ko();for(var n=0;n<this.description.Aa;n++)for(var h=this.description.Fd(n),F=0,c=a.pa.Wa(h);F<c;F++){var b=this.yd(e,h,F);g.setAttribute(h,F,b)}};h.prototype.CA=function(e,g){this.qc();if(g.sc())throw a.g.ra("empty geometry");for(var n=g.description,h=0,F=n.Aa;h<F;h++)for(var c=n.Fd(h),b=a.pa.Wa(c),A=0;A<b;A++){var d=g.ld(c,A);this.om(e,c,A,d)}};h.prototype.yd=function(e,g,n){if(this.sc())throw a.g.ra("This operation was performed on an Empty Geometry.");if(0==g)return 0!=
e?0!=n?this.ha:this.la:0!=n?this.ja:this.na;if(n>=a.pa.Wa(g))throw a.g.Uc();var y=this.description.zf(g);return 0<=y?(null!=this.fa&&this.rv(this.description.le.length-2),this.fa[h.Xk(this.description,e)+this.description.fj(y)-2+n]):a.pa.ue(g)};h.prototype.om=function(e,g,n,y){this.qc();if(n>=a.pa.Wa(g))throw a.g.Uc();var F=this.description.zf(g);0>F&&(this.Ne(g),F=this.description.zf(g));0==g?0!=e?0!=n?this.ha=y:this.la=y:0!=n?this.ja=y:this.na=y:(null==this.fa&&this.rv(this.description.le.length-
2),this.fa[h.Xk(this.description,e)+this.description.fj(F)-2+n]=y)};h.prototype.copyTo=function(e){if(e.D()!=this.D())throw a.g.N();e.description=this.description;e.rv(this.description.le.length-2);h.KI(this.fa,e.fa,2*(this.description.le.length-2));e.na=this.na;e.ja=this.ja;e.la=this.la;e.ha=this.ha;e.qc();this.eo(e)};h.prototype.Ah=function(e,g){var n=new a.Nd;if(this.sc())return n.Ja(),n;n.qa=this.yd(0,e,g);n.va=n.qa;n.Oj(this.yd(1,e,g));return n};h.prototype.XE=function(e){this.sc()?e.Ja():(e.qa=
this.yd(0,0,0),e.va=e.qa,e.Oj(this.yd(1,0,0)))};h.prototype.uu=function(e,g){g.Qf(this.description);g.ic(this.Kb(e));for(var n=1,h=this.description.Aa;n<h;n++)for(var F=this.description.Fd(n),c=a.pa.Wa(F),b=0;b<c;b++){var A=this.ld(e,F,b);g.setAttribute(F,b,A)}};h.prototype.sJ=function(e){if(this.description!=e.description||this.na!=e.na||this.la!=e.la||this.ja!=e.ja||this.ha!=e.ha)return!1;for(var g=0;g<2*(this.description.le.length-2);g++)if(this.fa[g]!=e.fa[g])return!1;return!0};h.prototype.kD=
function(){return this.na==this.la&&this.ja==this.ha};h.prototype.reverse=function(){var e=this.na;this.na=this.la;this.la=e;e=this.ja;this.ja=this.ha;this.ha=e;for(var e=1,g=this.description.Aa;e<g;e++)for(var n=this.description.Hd(e),h=0,F=a.pa.Wa(n);h<F;h++){var c=this.yd(0,n,h),b=this.yd(1,n,h);this.om(0,n,h,b);this.om(1,n,h,c)}};h.prototype.fq=function(e,g,n){var h=e.D();switch(this.D()){case 322:if(322==h)return a.yb.xJ(this,e,g,n);throw a.g.wa();default:throw a.g.wa();}};h.prototype.wJ=function(e,
g,n,h,F){var y=e.D();switch(this.D()){case 322:if(322==y)return a.yb.ov(this,e,g,n,h,F);throw a.g.wa();default:throw a.g.wa();}};h.prototype.kv=function(){return null};h.Xk=function(e,g){return g*(e.le.length-2)};h.prototype.Kb=function(e,g){if(void 0===g)return g=new a.b,this.Kb(e,g),g;a.vi.tP(this.na,this.ja,this.la,this.ha,e,g)};h.prototype.Gd=function(){return null};h.prototype.TC=function(){return null};h.prototype.nt=function(){return null};h.prototype.mg=function(){return null};h.prototype.mD=
function(){return null};h.prototype.Pf=function(){return null};h.prototype.rA=function(e,g){return void 0!==g?this.Ru(g)-this.Ru(e):this.Ru(e)};h.prototype.eo=function(){};h.prototype.xm=function(){return null};h.prototype.Bi=function(){};h.prototype.ld=function(){return null};h.prototype.xe=function(){return null};h.prototype.Ru=function(){return null};h.prototype.AD=function(){return null};h.prototype.Fb=function(e,g){if(!g&&0!=this.fq(e,0,!1))return 0;g=1.7976931348623157E308;var a,h;a=this.Mb();
h=e.Gd(a,!1);a.sub(e.Kb(h));a=a.length();a<g&&(g=a);a=this.oc();h=e.Gd(a,!1);a.sub(e.Kb(h));a=a.length();a<g&&(g=a);a=e.Mb();h=this.Gd(a,!1);a.sub(this.Kb(h));a=a.length();a<g&&(g=a);a=e.oc();h=this.Gd(a,!1);a.sub(this.Kb(h));a=a.length();a<g&&(g=a);return g};h.prototype.Rf=function(){return a.Hh.il(this,null)};return h}(a.T);a.fA=c})(B||(B={}));new B.b;(function(a){(function(a){a[a.Unknown=-1]="Unknown";a[a.Not=0]="Not";a[a.Weak=1]="Weak";a[a.Strong=2]="Strong"})(a.tH||(a.tH={}));(function(a){a[a.DirtyIsKnownSimple=
1]="DirtyIsKnownSimple";a[a.IsWeakSimple=2]="IsWeakSimple";a[a.IsStrongSimple=4]="IsStrongSimple";a[a.DirtyOGCFlags=8]="DirtyOGCFlags";a[a.DirtyVerifiedStreams=32]="DirtyVerifiedStreams";a[a.DirtyExactIntervals=64]="DirtyExactIntervals";a[a.DirtyLooseIntervals=128]="DirtyLooseIntervals";a[a.DirtyIntervals=192]="DirtyIntervals";a[a.DirtyIsEnvelope=256]="DirtyIsEnvelope";a[a.DirtyLength2D=512]="DirtyLength2D";a[a.DirtyRingAreas2D=1024]="DirtyRingAreas2D";a[a.DirtyCoordinates=1993]="DirtyCoordinates";
a[a.DirtyAllInternal=65535]="DirtyAllInternal";a[a.DirtyAll=16777215]="DirtyAll"})(a.cH||(a.cH={}));var c=function(c){function h(){c.call(this);this.El=65535;this.ta=0;this.rg=-1;this.pb=null}D(h,c);h.prototype.eo=function(){};h.prototype.qv=function(){};h.prototype.xv=function(){};h.prototype.F=function(){return this.ta};h.prototype.s=function(){return this.sc()};h.prototype.sc=function(){return 0==this.ta};h.prototype.gj=function(e){return 0!=(this.El&e)};h.prototype.yf=function(e,g){this.El=g?
this.El|e:this.El&~e};h.prototype.kc=function(){this.gj(32)&&this.FJ()};h.prototype.Su=function(){if(this.sc())throw a.g.ra("This operation was performed on an Empty Geometry.");};h.prototype.Sd=function(e,g){if(0>e||e>=this.ta)throw a.g.ra("index out of bounds");this.kc();g.Qf(this.description);g.s()&&g.ko();for(var n=0;n<this.description.Aa;n++)for(var h=this.description.Fd(n),F=0,c=a.pa.Wa(h);F<c;F++){var b=this.Ba[n].Bh(c*e+F);g.setAttribute(h,F,b)}};h.prototype.Iu=function(e,g){this.kc();for(var n=
g.description,h=0;h<n.Aa;h++)for(var F=n.Fd(h),c=a.pa.Wa(F),b=0;b<c;b++){var A=g.ld(F,b);this.setAttribute(F,e,b,A)}};h.prototype.w=function(e,g){if(0>e||e>=this.F())throw a.g.Uc();this.kc();this.Ba[0].ec(2*e,g)};h.prototype.Fa=function(e){var g=new a.b;this.w(e,g);return g};h.prototype.uc=function(e,g){this.Ba[0].ec(2*e,g)};h.prototype.ic=function(e,g,n){if(0>e||e>=this.ta)throw a.g.Uc();this.kc();var h=this.Ba[0];void 0!==n?(h.write(2*e,g),h.write(2*e+1,n)):h.Rn(2*e,g);this.ce(1993)};h.prototype.Lw=
function(e){if(0>e||e>=this.F())throw a.g.Uc();this.kc();var g=this.Ba[0],n=new a.ee;n.x=g.read(2*e);n.y=g.read(2*e+1);n.z=this.hasAttribute(1)?this.Ba[1].Bh(e):a.pa.ue(1);return n};h.prototype.Py=function(e,g){if(0>e||e>=this.F())throw a.g.Uc();this.Ne(1);this.kc();this.ce(1993);var n=this.Ba[0];n.write(2*e,g.x);n.write(2*e+1,g.y);this.Ba[1].Uk(e,g.z)};h.prototype.ld=function(e,g,n){if(0>g||g>=this.ta)throw a.g.Uc();var h=a.pa.Wa(e);if(n>=h)throw a.g.Uc();this.kc();var F=this.description.zf(e);return 0<=
F?this.Ba[F].Bh(g*h+n):a.pa.ue(e)};h.prototype.nC=function(e,g,a){return this.ld(e,g,a)};h.prototype.setAttribute=function(e,g,n,h){if(0>g||g>=this.ta)throw a.g.Uc();var y=a.pa.Wa(e);if(n>=y)throw a.g.Uc();this.Ne(e);this.kc();e=this.description.zf(e);this.ce(1993);this.Ba[e].Uk(g*y+n,h)};h.prototype.mc=function(e){this.Su();this.Ne(e);this.kc();return this.Ba[this.description.zf(e)]};h.prototype.bm=function(e,g){if(null!=g&&a.pa.Qh(e)!=g.Qh())throw a.g.N();this.Ne(e);e=this.description.zf(e);null==
this.Ba&&(this.Ba=a.Ac.ay(this.description.Aa));this.Ba[e]=g;this.ce(16777215)};h.prototype.nm=function(e){var g=null;if(null!=this.Ba)for(var n=a.Od.iu(e,this.description),g=[],h=0,F=e.Aa;h<F;h++)-1!=n[h]&&(g[h]=this.Ba[n[h]]);this.description=e;this.Ba=g;this.rg=-1;this.ce(16777215)};h.prototype.IA=function(e){this.ss(!0);e instanceof a.i?this.R.o(e):this.R.Cn(e)};h.prototype.EJ=function(e){this.ss(!1);e instanceof a.i?this.R.o(e):this.R.Cn(e)};h.prototype.Fp=function(e){this.ss(!0);this.R.copyTo(e)};
h.prototype.o=function(e){this.IA(e)};h.prototype.Cn=function(e){this.IA(e)};h.prototype.dd=function(e){this.EJ(e)};h.prototype.Ah=function(e,g){var n=new a.Nd;if(this.sc())return n.Ja(),n;this.ss(!0);return this.R.Ah(e,g)};h.prototype.hc=function(){var e=this.description.hc();if(!this.sc())for(var g=this.F(),n=0,h=this.description.Aa;n<h;n++)e=this.Ba[n].jj(e,0,g*a.pa.Wa(this.description.Fd(n)));return e};h.prototype.lc=function(e){if(e==this)return!0;if(!(e instanceof h&&this.description.lc(e.description))||
this.sc()!=e.sc())return!1;if(this.sc())return!0;var g=this.F();if(g!=e.F())return!1;for(var n=0;n<this.description.Aa;n++){var y=this.description.Hd(n),F=this.mc(y),c=e.mc(y);if(!F.lc(c,0,g*a.pa.Wa(y)))return!1}return!0};h.prototype.copyTo=function(e){if(e.D()!=this.D())throw a.g.N();this.tA(e)};h.prototype.tA=function(e){this.kc();e.description=this.description;e.Ba=null;var g=this.description.Aa,n=null;if(null!=this.Ba)for(var n=[],h=0;h<g;h++)null!=this.Ba[h]&&(n[h]=this.Ba[h].Ip(this.F()*a.pa.Wa(this.description.Fd(h))));
null!=this.R?(e.R=this.R.Pa(),this.R.copyTo(e.R)):e.R=null;e.ta=this.ta;e.El=this.El;e.Ba=n;try{this.eo(e)}catch(F){throw e.Ja(),a.g.BI();}};h.prototype.EA=function(){this.ta=0;this.rg=-1;this.Ba=null;this.ce(16777215)};h.prototype.ce=function(e){16777215==e&&(this.rg=-1,this.qv());this.El|=e;this.kJ();this.qc()};h.prototype.ss=function(e){this.kc();if(this.gj(192))if(null==this.R?this.R=new a.Vj(this.description):this.R.Qf(this.description),this.s())this.R.Ja();else{this.wv(e);for(var g=1;g<this.description.Aa;g++)for(var n=
this.description.Fd(g),h=a.pa.Wa(n),F=this.Ba[g],c=0;c<h;c++){var b=new a.Nd;b.Ja();for(var A=0;A<this.ta;A++){var d=F.Bh(A*h+c);b.Db(d)}this.R.setInterval(n,c,b)}e&&this.yf(192,!1)}};h.prototype.wv=function(){this.R.Ja();for(var e=this.Ba[0],g=new a.b,n=0;n<this.ta;n++)e.ec(2*n,g),this.R.Db(g)};h.prototype.tm=function(e){e.Ja();for(var g=this.Ba[0],n=new a.b,h=0;h<this.ta;h++)g.ec(2*h,n),e.Db(n)};h.prototype.FJ=function(){if(this.rg<this.ta){null==this.Ba&&(this.Ba=a.Ac.ay(this.description.Aa));
this.rg=2147483647;for(var e=0;e<this.description.Aa;e++){var g=this.description.Fd(e);if(null!=this.Ba[e]){var n=a.pa.Wa(g),h=a.I.truncate(this.Ba[e].size/n);h<this.ta&&(h=a.I.truncate(this.rg>this.ta+5?(5*this.ta+3)/4:this.ta),this.Ba[e].resize(h*n,a.pa.ue(g)));h<this.rg&&(this.rg=h)}else this.Ba[e]=a.Ac.Tv(g,this.ta),this.rg=this.ta}}this.xv();this.yf(32,!1)};h.prototype.jo=function(e){if(0>e)throw a.g.N();e!=this.ta&&(this.ta=e,this.ce(65535))};h.prototype.rj=function(e){if(!this.gj(1)){if(!this.gj(2))return 0;
if(this.TP>=e)return this.gj(8)?1:2}return-1};h.prototype.hg=function(e,g){this.TP=g;if(-1==e)this.yf(1,!0),this.yf(8,!0);else if(this.yf(1,!1),this.yf(8,!0),0==e)this.yf(2,!1),this.yf(4,!1);else if(1==e)this.yf(2,!0),this.yf(4,!1);else if(2==e)this.yf(2,!0),this.yf(4,!0);else throw a.g.ra("internal error.");};h.prototype.kJ=function(){null!=this.pb&&(this.pb=null)};h.prototype.vJ=function(e,g,n,h){if(0>e||e>=this.ta)throw a.g.ra("index out of bounds");if(0>g||g>=this.ta)throw a.g.ra("index out of bounds");
this.kc();h.Qf(this.description);h.s()&&h.ko();for(var y=0;y<this.description.Aa;y++)for(var c=this.description.Fd(y),b=0,A=a.pa.Wa(c);b<A;b++){var d=this.Ba[y].Bh(A*e+b),f=this.Ba[y].Bh(A*g+b);h.setAttribute(c,b,a.vi.ut(d,f,n))}};h.prototype.mv=function(e,g){var a=this.Ba[0].f,h=a[2*e]-a[2*g],a=a[2*e+1]-a[2*g+1];return Math.sqrt(h*h+a*a)};h.prototype.bh=function(e,g){if(0>e||e>=this.ta)throw a.g.Uc();if(g.s())throw a.g.N();this.kc();for(var n=g.description,h=0;h<n.Aa;h++)for(var F=n.Hd(h),c=a.pa.Wa(F),
b=0;b<c;b++){var A=g.ld(F,b);this.setAttribute(F,e,b,A)}};h.prototype.jv=function(){return null};h.prototype.dj=function(){return null};return h}(a.T);a.Wr=c})(B||(B={}));(function(a){var c=function(){function c(){this.cb=this.Qm=null;this.Ol=124234251;this.Ct=!0;this.Ae=-1;this.cb=new a.Fc(7);this.Qm=null}c.prototype.Hn=function(a){this.Qm=a};c.prototype.lM=function(){this.Ct=!1};c.prototype.de=function(a){this.cb.de(a)};c.prototype.nq=function(a){var e=this.cb.be();this.mS(e);this.oS(a,e);return e};
c.prototype.fM=function(a){this.cb.Jc(a)};c.prototype.addElement=function(a,e){var g;-1==e?(-1==this.Ae&&(this.Ae=this.nq(-1)),g=this.Ae):g=e;return this.MA(a,0,g)};c.prototype.PA=function(a){-1==this.Ae&&(this.Ae=this.nq(-1));return this.MA(a,1,this.Ae)};c.prototype.qm=function(a){var e;-1==this.Ae&&(this.Ae=this.nq(-1));e=this.Ae;var g=this.cb.f;if(-1==e||-1==g[7*e])return a=this.cb.Pj([-1,-1,-1,a,this.ck(),-1,-1]),g=this.cb.f,g[7*e]=a,this.mo(-1,a,e,g),a;var n=-1==e?-1:g[7*e+2];a=this.cb.Pj([-1,
-1,n,a,this.ck(),-1,-1]);g=this.cb.f;g[7*n+1]=a;this.Fv(a,g);-1===g[7*a+2]&&(g[7*e]=a);this.mo(-1,a,e,g);return a};c.prototype.vs=function(h,e,g,n){var y=-1;-1==y&&(-1==this.Ae&&(this.Ae=this.nq(-1)),y=this.Ae);var c=this.cb.f;if(-1==y||-1==c[7*y])return g=this.cb.Pj([-1,-1,-1,g,this.ck(),-1,-1]),c=this.cb.f,c[7*y]=g,this.mo(-1,g,y,c),g;var b;n?(n=-1!=e?this.Qm.compare(this,g,e):-1,b=-1!=h?this.Qm.compare(this,g,h):1):(n=-1,b=1);if(0==n||0==b)return c[7*y+3]=0==n?e:h,-1;(-1!=e&&-1!=h?this.Ol>a.I.$x(this.Ol)>>
1:-1!=e)?h=e:n=b;for(e=!0;;){if(0>n)if(b=c[7*h],-1!=b)h=b;else{n=h;g=this.cb.Pj([-1,-1,h,g,this.ck(),-1,-1]);c=this.cb.f;c[7*h]=g;break}else if(b=c[7*h+1],-1!=b)h=b;else{n=c[7*h+6];g=this.cb.Pj([-1,-1,h,g,this.ck(),-1,-1]);c=this.cb.f;c[7*h+1]=g;break}e&&(n*=-1,e=!1)}this.Fv(g,c);-1===c[7*g+2]&&(c[7*y]=g);this.mo(n,g,y,c);return g};c.prototype.tC=function(){return this.xN(this.Ae)};c.prototype.kd=function(a,e){e=-1==e?this.Ae:e;this.Ct?this.eM(a,e):this.$S(a,e)};c.prototype.search=function(a,e){for(e=
this.dt(e);-1!=e;){var g=this.Qm.compare(this,a,e);if(0==g)return e;e=0>g?this.ik(e):this.Jo(e)}return-1};c.prototype.GR=function(a){for(var e=this.dt(-1),g=-1;-1!=e;){var n=a.compare(this,e);if(0==n)return e;0>n?e=this.ik(e):(g=e,e=this.Jo(e))}return g};c.prototype.sF=function(a){for(var e=this.dt(-1),g=-1;-1!=e;){var n=a.compare(this,e);if(0==n)return e;0>n?(g=e,e=this.ik(e)):e=this.Jo(e)}return g};c.prototype.da=function(a){return this.cb.O(a,3)};c.prototype.ik=function(a){return this.cb.O(a,0)};
c.prototype.Jo=function(a){return this.cb.O(a,1)};c.prototype.getParent=function(a){return this.cb.O(a,2)};c.prototype.bb=function(a){return this.cb.O(a,6)};c.prototype.ge=function(a){return this.cb.O(a,5)};c.prototype.gc=function(a){return-1==a?this.gk(this.Ae):this.gk(a)};c.prototype.tc=function(a){return-1==a?this.uq(this.Ae):this.uq(a)};c.prototype.hO=function(a){return-1==a?this.QC(this.Ae):this.QC(a)};c.prototype.Vi=function(a,e){this.By(a,e)};c.prototype.dt=function(a){return-1==a?this.MC(this.Ae):
this.MC(a)};c.prototype.clear=function(){this.cb.Nh(!1);this.Ae=-1};c.prototype.size=function(a){return-1==a?this.OC(this.Ae):this.OC(a)};c.prototype.pK=function(a,e){for(var g=e[7*a],n=e[7*a+1],h=e[7*a+4];-1!=g||-1!=n;){var c=-1!=g?e[7*g+4]:2147483647,n=-1!=n?e[7*n+4]:2147483647;if(h<=Math.min(c,n))break;c<=n?this.oF(g,e):this.nF(a,e);g=e[7*a];n=e[7*a+1]}};c.prototype.Fv=function(a,e){if(this.Ct)for(var g=e[7*a+4],n=e[7*a+2];-1!=n&&e[7*n+4]>g;)e[7*n]==a?this.oF(a,e):this.nF(n,e),n=e[7*a+2]};c.prototype.nF=
function(a,e){var g=e[7*a+1],n;e[7*g+2]=e[7*a+2];e[7*a+2]=g;n=e[7*g];e[7*a+1]=n;-1!=n&&(e[7*n+2]=a);e[7*g]=a;n=e[7*g+2];-1!=n&&(e[7*n]==a?e[7*n]=g:e[7*n+1]=g)};c.prototype.oF=function(a,e){var g=e[7*a+2],n;e[7*a+2]=e[7*g+2];e[7*g+2]=a;n=e[7*a+1];e[7*g]=n;-1!=n&&(e[7*n+2]=g);e[7*a+1]=g;n=e[7*a+2];-1!=n&&(e[7*n]===g?e[7*n]=a:e[7*n+1]=a)};c.prototype.Tj=function(a,e){this.cb.L(a,2,e)};c.prototype.Gy=function(a,e){this.cb.L(a,0,e)};c.prototype.Ky=function(a,e){this.cb.L(a,1,e)};c.prototype.Jy=function(a,
e){this.cb.L(a,5,e)};c.prototype.Gu=function(a,e){this.cb.L(a,6,e)};c.prototype.VF=function(a,e){this.cb.L(e,0,a)};c.prototype.mS=function(a){this.cb.L(a,4,0)};c.prototype.oS=function(a,e){this.cb.L(e,5,a)};c.prototype.MC=function(a){return-1==a?-1:this.cb.O(a,0)};c.prototype.gk=function(a){return-1==a?-1:this.cb.O(a,1)};c.prototype.uq=function(a){return-1==a?-1:this.cb.O(a,2)};c.prototype.xN=function(a){return-1==a?-1:this.cb.O(a,3)};c.prototype.OC=function(a){return-1==a?0:this.cb.O(a,4)};c.prototype.QC=
function(a){return this.cb.O(a,5)};c.prototype.ou=function(a){return this.cb.Pj([-1,-1,-1,a,this.ck(),-1,-1])};c.prototype.bk=function(a){-1!=a&&this.cb.Jc(a)};c.prototype.ck=function(){this.Ol=a.I.$x(this.Ol);return this.Ol&1073741823};c.prototype.MA=function(a,e,g){var n=this.cb.f;if(-1==g||-1==n[7*g])return a=this.cb.Pj([-1,-1,-1,a,this.ck(),-1,-1]),n=this.cb.f,n[7*g]=a,this.mo(-1,a,g,n),a;for(var h=-1==g?-1:n[7*g];;){var c=-1==e?1:this.Qm.compare(this,a,h);if(0>c)if(c=this.ik(h),-1!=c)h=c;else{e=
h;a=this.cb.Pj([-1,-1,h,a,this.ck(),-1,-1]);n=this.cb.f;n[7*h]=a;break}else{if(1==e&&0==c)return n[7*g+3]=h,-1;c=n[7*h+1];if(-1!=c)h=c;else{e=n[7*h+6];a=this.cb.Pj([-1,-1,h,a,this.ck(),-1,-1]);n=this.cb.f;n[7*h+1]=a;break}}}this.Fv(a,n);-1===n[7*a+2]&&(n[7*g]=a);this.mo(e,a,g,n);return a};c.prototype.mo=function(a,e,g,n){var h;-1!=a?(h=n[7*a+5],n[7*a+5]=e):h=-1==g?-1:n[7*g+2];n[7*e+5]=h;-1!=h&&(n[7*h+6]=e);n[7*e+6]=a;a==(-1==g?-1:n[7*g+1])&&(n[7*g+1]=e);-1==a&&(n[7*g+2]=e);n[7*g+4]=(-1==g?0:n[7*g+
4])+1};c.prototype.ry=function(a,e){var g=this.cb.f,n=g[7*a+5];a=g[7*a+6];-1!=n?g[7*n+6]=a:g[7*e+1]=a;-1!=a?g[7*a+5]=n:g[7*e+2]=n;g[7*e+4]=-1===e?-1:g[7*e+4]-1};c.prototype.$S=function(h,e){this.ry(h,e);var g=this.ik(h),n=this.Jo(h),y=this.getParent(h),c=h;if(-1!=g&&-1!=n){this.Ol=a.I.$x(this.Ol);var b;b=1073741823<this.Ol?this.bb(h):this.ge(h);var A=this.getParent(b)==h;this.cb.Pu(h,b,0);this.cb.Pu(h,b,1);this.cb.Pu(h,b,2);-1!=y?this.ik(y)==h?this.Gy(y,b):this.Ky(y,b):this.VF(b,e);A?(g==b?(this.Gy(b,
h),this.Tj(n,b)):n==b&&(this.Ky(b,h),this.Tj(g,b)),this.Tj(h,b),y=b):(this.Tj(g,b),this.Tj(n,b),y=this.getParent(h),c=b);g=this.ik(h);n=this.Jo(h);-1!=g&&this.Tj(g,h);-1!=n&&this.Tj(n,h)}g=-1!=g?g:n;-1==y?this.VF(g,e):this.ik(y)==c?this.Gy(y,g):this.Ky(y,g);-1!=g&&this.Tj(g,y);this.bk(h,e)};c.prototype.eM=function(a,e){var g=this.cb.f;g[7*a+4]=2147483647;var n=-1,h=-1,c=-1===e?-1:g[7*e],b=c==a;b&&(n=g[7*c],h=g[7*c+1],-1==n&&-1==h)?(this.ry(c,e),this.bk(c,e),g[7*e]=-1):(this.pK(a,g),c=g[7*a+2],-1!=
c&&(g[7*c]==a?g[7*c]=-1:g[7*c+1]=-1),this.ry(a,e),this.bk(a,e),b&&(g[7*e]=-1==n||-1!=g[7*n+2]?h:n))};c.prototype.By=function(a,e){this.cb.L(a,3,e)};return c}();a.bj=c})(B||(B={}));(function(a){var c=function(){function c(a,e){void 0!==a&&this.K(a,e)}c.prototype.K=function(a,e){this.qa=a;this.va=e;this.normalize()};c.prototype.normalize=function(){if(!isNaN(this.qa)){if(this.qa>this.va){var a=this.qa;this.qa=this.va;this.va=a}isNaN(this.va)&&this.Ja()}};c.prototype.Ja=function(){this.va=this.qa=NaN};
c.prototype.s=function(){return isNaN(this.qa)};c.prototype.Db=function(a){"number"===typeof a?this.s()?this.va=this.qa=a:this.Oj(a):a.s()||(this.s()?(this.qa=a.qa,this.va=a.va):(this.qa>a.qa&&(this.qa=a.qa),this.va<a.va&&(this.va=a.va),this.qa>this.va&&this.Ja()))};c.prototype.Oj=function(a){a<this.qa?this.qa=a:a>this.va&&(this.va=a)};c.prototype.contains=function(a){return"number"===typeof a?a>=this.qa&&a<=this.va:a.qa>=this.qa&&a.va<=this.va};c.prototype.Ga=function(a){this.s()||a.s()?this.Ja():
(this.qa<a.qa&&(this.qa=a.qa),this.va>a.va&&(this.va=a.va),this.qa>this.va&&this.Ja())};c.prototype.P=function(a){this.s()||(this.qa-=a,this.va+=a,this.va<this.qa&&this.Ja())};c.prototype.lv=function(){return this.s()?2.220446049250313E-14:2.220446049250313E-14*(Math.abs(this.qa)+Math.abs(this.va)+1)};c.prototype.yy=function(a,e){a>e?(this.qa=e,this.va=a):(this.qa=a,this.va=e)};c.prototype.Sy=function(h){return a.I.Kr(h,this.qa,this.va)};c.prototype.aa=function(){return this.va-this.qa};c.prototype.Af=
function(){return.5*(this.qa+this.va)};c.prototype.lc=function(a){return a==this?!0:a instanceof c?this.s()&&a.s()?!0:this.qa!=a.qa||this.va!=a.va?!1:!0:!1};c.prototype.hc=function(){return a.I.Rh(a.I.Rh())};return c}();a.Nd=c})(B||(B={}));(function(a){var c=new a.Nd,b=new a.Nd,h=function(){return function(){this.Zd=null;this.Lf=-1;this.ib=new a.yb;this.ux=55555555;this.Et=this.Ft=!1;this.$h=new a.Nd;this.$h.yy(0,0)}}();a.XT=h;var e=function(){function e(e,g,c){this.a=e;this.Mj=NaN;this.mE=this.sp=
0;this.nE=NaN;this.ka=g;this.tp=10*g;this.oE=this.pE=NaN;this.Zf=!1;this.Cl=this.mr=this.un=this.gr=this.fr=-1;this.lx=c;this.Rx=new h;this.vE=new h;a.I.truncate(3*e.pd/2)}e.prototype.$C=function(e,g,a,h){e.Zd=null===h?null:h[a[5*g]];e.Et=null!=e.Zd;e.Et||(h=a[5*g+2],-1!==h&&this.a.gR(a[5*g],a[5*h],e.ib),e.Zd=e.ib,e.$h.yy(e.ib.na,e.ib.la),e.$h.va+=this.ka,e.ib.KE(),e.Ft=e.ib.ha==e.ib.ja,e.Ft||(e.ux=(e.ib.la-e.ib.na)/(e.ib.ha-e.ib.ja)))};e.prototype.tL=function(e,g){var a=e.fq(g,this.ka,!0);if(0!=
a)return 2==a?this.aw():this.Oh();e.ht(G);e.uw(H);g.ht(K);g.uw(J);I.ma(this.sp,this.Mj);G.ub(K)&&this.Mj==G.y?0>H.compare(J)?I.J(H):I.J(J):G.ub(J)&&this.Mj==G.y?0>H.compare(K)?I.J(H):I.J(K):K.ub(H)&&this.Mj==K.y?0>G.compare(J)?I.J(G):I.J(J):H.ub(J)&&this.Mj==H.y&&(0>G.compare(K)?I.J(G):I.J(K));return e.xe(I.y,I.x)<g.xe(I.y,I.x)?-1:1};e.prototype.rL=function(e,g){if(e.ib.ja==g.ib.ja&&e.ib.na==g.ib.na)return e.ib.ha==g.ib.ha&&e.ib.la==g.ib.la?this.lx?this.aw():0:this.HB(e,g);if(e.ib.ha==g.ib.ha&&e.ib.la==
g.ib.la)return this.GB(e,g);var a=this.GB(e,g);e=this.HB(e,g);return 0>a&&0>e?-1:0<a&&0<e?1:this.Oh()};e.prototype.mL=function(e,g){if(e.la>g.la){if(g.la>g.na&&g.ha-g.ja<2*this.ka&&e.Kh(g.la,g.ha,this.ka))return this.Oh()}else if((g.ha-g.ja)/(g.la-g.na)*(e.la-e.na)<this.tp&&g.Kh(e.la,e.ha,this.ka))return this.Oh();return 1};e.prototype.nL=function(e,g){if(e.na<g.na){if(g.la>g.na&&g.ha-g.ja<2*this.ka&&e.Kh(g.la,g.ha,this.ka))return this.Oh()}else if((g.ha-g.ja)/(g.la-g.na)*(e.na-e.la)<this.tp&&g.Kh(e.na,
e.ja,this.ka))return this.Oh();return-1};e.prototype.oL=function(e,g){var n=new a.b;n.pc(g.oc(),g.Mb());n.Kp();n.normalize();var h=new a.b;h.pc(e.Mb(),g.Mb());var y=new a.b;y.pc(e.oc(),g.Mb());var h=h.ml(n),n=y.ml(n),y=Math.abs(h),c=Math.abs(n);if(y<c){if(y<this.tp&&g.Kh(e.na,e.ja,this.ka))return this.Oh()}else if(c<this.tp&&g.Kh(e.la,e.ha,this.ka))return this.Oh();return 0>h&&0>n?-1:0<h&&0<n?1:this.Oh()};e.prototype.FB=function(e,g){return e.ja==g.ja&&e.na==g.na?this.mL(e,g):e.ha==g.ha&&e.la==g.la?
this.nL(e,g):this.oL(e,g)};e.prototype.qL=function(e,g){return e.ha==g.ha&&e.la==g.la&&e.ja==g.ja&&e.na==g.na?this.lx?this.aw():0:this.Oh()};e.prototype.GB=function(e,g){var a=1;if(e.ib.ja<g.ib.ja){var a=-1,n=e;e=g;g=n}n=e.ib;e=g.ib;var h=n.na-e.na;g=g.ux*(n.ja-e.ja);var y=this.tp;return h<g-y?-a:h>g+y?a:e.Kh(n.na,n.ja,this.ka)?this.Oh():h<g?-a:a};e.prototype.HB=function(e,g){var a=1;if(g.ib.ha<e.ib.ha){var a=-1,n=e;e=g;g=n}n=e.ib;e=g.ib;var h=n.la-e.na;g=g.ux*(n.ha-e.ja);var y=this.tp;return h<g-
y?-a:h>g+y?a:e.Kh(n.la,n.ha,this.ka)?this.Oh():h<g?-a:a};e.prototype.aw=function(){this.Zf=!0;this.ei=new a.wd(5,this.un,this.mr);return-1};e.prototype.Oh=function(){this.Zf=!0;this.lx?this.ei=new a.wd(4,this.un,this.mr):this.mr=this.un=this.gr=this.fr=-1;return-1};e.prototype.sL=function(e,g,a,h){if(this.Zf)return-1;var n=this.nE==this.Mj&&this.mE==this.sp,y;n&&e==this.fr?y=this.oE:(y=NaN,this.fr=-1);n&&g==this.gr?n=this.pE:(n=NaN,this.gr=-1);a.Zd.XE(c);h.Zd.XE(b);if(c.va<b.qa)return-1;if(b.va<c.qa)return 1;
this.nE=this.Mj;this.mE=this.sp;isNaN(y)&&(this.fr=e,this.oE=y=e=a.Zd.xe(this.Mj,this.sp));isNaN(n)&&(this.gr=g,this.pE=n=e=h.Zd.xe(this.Mj,this.sp));return Math.abs(y-n)<=this.ka?this.tL(a.Zd,h.Zd):y<n?-1:y>n?1:0};e.prototype.lq=function(){this.Zf=!1};e.prototype.rl=function(){return this.ei};e.prototype.XF=function(e,g){this.Mj=e;this.sp=g;this.mr=this.un=this.gr=this.fr=-1};e.prototype.compare=function(e,g,a){if(this.Zf)return-1;e=e.da(a);this.Cl=a;return this.JB(g,g,e,e)};e.prototype.JB=function(e,
g,a,h){var n;this.un==g?n=this.Rx:(this.un=g,n=this.Rx,this.Rx.Lf=e,this.$C(n,g,this.a.cd.f,this.a.Ge));var y;null==y&&(this.mr=h,y=this.vE,this.vE.Lf=a,this.$C(y,h,this.a.cd.f,this.a.Ge));if(n.Et||y.Et)return this.sL(g,h,n,y);if(n.$h.va<y.$h.qa)return-1;if(y.$h.va<n.$h.qa)return 1;e=n.Ft?1:0;e|=y.Ft?2:0;return 0==e?this.rL(n,y):1==e?this.FB(n.ib,y.ib):2==e?-1*this.FB(y.ib,n.ib):this.qL(n.ib,y.ib)};return e}();a.hA=e})(B||(B={}));(function(a){var c=function(){function c(h,e){this.a=h;this.ka=e;this.Zf=
!1;this.un=-1;this.$h=new a.Nd;this.pp=new a.b;this.pp.Eh();this.Vd=new a.yb;this.Cl=-1;this.Cx=1.7976931348623157E308}c.prototype.lq=function(){this.Zf=!1;this.Cx=1.7976931348623157E308};c.prototype.bh=function(a){this.pp.J(a)};c.prototype.compare=function(a,e){return this.KB(e,a.da(e))};c.prototype.KB=function(h,e){var g=null!=this.a.cc(e);g||(this.a.Oc(e,this.Vd),this.$h.yy(this.Vd.na,this.Vd.la));if(g)throw a.g.ra("not implemented");if(this.pp.x+this.ka<this.$h.qa)return-1;if(this.pp.x-this.ka>
this.$h.va)return 1;if(this.Vd.ja==this.Vd.ha)return this.Cl=h,this.Zf=!0,0;this.Vd.KE();e=this.Vd.Mb();g=new a.b;g.pc(this.Vd.oc(),e);g.Kp();var n=new a.b;n.pc(this.pp,e);e=g.ml(n);e/=g.length();return e<10*-this.ka?-1:e>10*this.ka?1:this.Vd.Eq(this.pp,this.ka)&&(g=Math.abs(e),g<this.Cx&&(this.Cl=h,this.Cx=g),this.Zf=!0,g<.25*this.ka)?0:0>e?-1:1};return c}();a.JI=c})(B||(B={}));(function(a){function c(a,e,g,n){g=new Float64Array(a.subarray(g,n));a.set(g,e)}var b=function(){function h(e){this.Sa=
this.Xf=!1;this.f=[];var g=e;2>g&&(g=2);this.f=a.I.Lh(g,h.ob);this.size=e}h.Yc=function(e,g){h.ob=g;e=new h(e);h.ob=0;return e};h.lj=function(e){var g=new h(0);g.f=e.f.slice(0);g.size=e.size;return g};h.V=function(e,g){var a=new h(0);a.size=e.size;a.size>g&&(a.size=g);a.f=e.f.slice(0,a.size);return a};h.prototype.xb=function(){};h.prototype.read=function(e){return this.f[e]};h.prototype.ec=function(e,g){g.x=this.f[e];g.y=this.f[e+1]};h.prototype.get=function(e){return this.f[e]};h.prototype.write=
function(e,g){if(this.Sa)throw a.g.xa();this.f[e]=g};h.prototype.set=function(e,g){if(this.Sa)throw a.g.xa();this.f[e]=g};h.prototype.Rn=function(e,g){if(this.Sa)throw a.g.xa();this.f[e]=g.x;this.f[e+1]=g.y};h.prototype.add=function(e){this.resize(this.size+1);this.f[this.size-1]=e};h.prototype.Ip=function(e){return h.V(this,e)};h.prototype.Bh=function(e){return this.read(e)};h.prototype.resize=function(e,g){void 0===g&&(g=0);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");
if(e<=this.size){if(a.I.truncate(5*e/4)<this.f.length){var n=this.f.slice(0,e);this.f=n}}else if(e>this.f.length){a.I.truncate(64>e?Math.max(2*e,4):5*e/4);for(var n=this.f.slice(0),h=this.f.length;h<e;h++)n[h]=g;this.f=n}this.size=e};h.prototype.cf=function(e){(null==this.f||e>this.f.length)&&this.resize(e);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");this.size=e};h.prototype.Uk=function(e,g){this.write(e,g)};h.prototype.jj=function(e,g,n){for(var h=this.size;g<
h&&g<n;g++)e=a.I.Rh(this.read(g));return e};h.prototype.lc=function(e,g,a){if(null==e||!(e instanceof h))return!1;var n=this.size,c=e.size;if(a>n||a>c&&n!=c)return!1;for(a>n&&(a=n);g<a;g++)if(this.read(g)!=e.read(g))return!1;return!0};h.prototype.nk=function(e,g,n,h,c,b,A){if(this.Sa)throw a.g.xa();if(!c&&(1>b||0!=h%b))throw a.g.N();var y=this.size-A;y<h&&this.resize(this.size+h-y);for(y=0;y<A-e;y++)this.f[e+h+y]=this.f[e+y];this.f==g.f&&e<n&&(n+=h);if(c)for(y=0;y<h;y++)this.f[y+e]=g.f[n+y];else for(c=
h,A=0;A<h;A+=b)for(c-=b,y=0;y<b;y++)this.f[e+A+y]=g.f[n+c+y]};h.prototype.ul=function(e,g,n,h){if(this.Sa)throw a.g.xa();h-=e;for(var y=this.f.slice(e,e+h),c=0;c<h;c++)this.f[e+n+c]=y[c];for(h=0;h<n;h++)this.f[e+h]=g};h.prototype.lg=function(e,g,n){if(this.Sa)throw a.g.xa();for(var h=this.f.slice(e,e+(n-e)),c=0;c<n-e;c++)this.f[c+e+2]=h[c];this.f[e]=g.x;this.f[e+1]=g.y};h.prototype.km=function(e,g,n,h,c,b){if(0>e||0>g||0>h)throw a.g.N();if(!c&&(0>=b||0!=g%b))throw a.g.N();if(n.size<h+g)throw a.g.N();
if(0!=g)if(this.size<g+e&&this.resize(g+e),n==this)this.xi(e,g,h,c,b);else if(c)for(c=0;c<g;c++)this.f[e]=n.f[h],e++,h++;else if(h=h+g-b,1==b)for(c=0;c<g;c++)this.f[e]=n.f[h],e++,h--;else for(c=0,g=a.I.truncate(g/b);c<g;c++){for(var y=0;y<b;y++)this.f[e+y]=n.f[h+y];e+=b;h-=b}};h.prototype.oj=function(e,g,n){if(this.Sa)throw a.g.xa();if(e+g>this.size)throw a.g.xa();if(0<n-(e+g)){n-=e+g;for(var h=this.f.slice(e+g,e+n+g),c=0;c<n;c++)this.f[e+c]=h[c]}this.size-=g};h.prototype.Jp=function(e,g,n){if(this.Sa)throw a.g.xa();
if(1>n||0!=g%n)throw a.g.xa();for(var h=g>>1,c=0;c<h;c+=n){g-=n;for(var b=0;b<n;b++){var A=this.f[e+c+b];this.f[e+c+b]=this.f[e+g+b];this.f[e+g+b]=A}}};h.prototype.dh=function(e,g,n){if(0>g||0>n||0>g||n+g>this.size)throw a.g.N();for(var h=g;h<g+n;h++)this.f[h]=e};h.prototype.xi=function(e,g,n,h,c){if(!h||e!=n){for(var y=0;y<g;y++)this.f[e+y]=this.f[n+y];if(!h)for(n=e,e=e+g-c,h=0,g=a.I.truncate(g/2);h<g;h++){for(y=0;y<c;y++){var F=this.f[n+y];this.f[n+y]=this.f[e+y];this.f[e+y]=F}n+=c;e-=c}}};h.prototype.$p=
function(e,g,n,h,c){if(0>e||0>g||0>h)throw a.g.N();if(0!=g)for(this.size<(g<<1)+e&&this.resize((g<<1)+e),c||(e+=g-1<<1),c=c?2:-2,g+=h;h<g;h++)this.f[e]=n[h].x,this.f[e+1]=n[h].y,e+=c};h.prototype.Hp=function(e,g,n,h,c){if(0>e||0>g||0>h||this.size<g+e)throw a.g.N();if(c)for(c=0;c<g;c++)n[h+c]=this.f[e+c];else for(h=h+g-1;e<g;e++)n[h]=this.f[e],h--};h.prototype.clear=function(e){e?this.resize(0):this.cf(0)};h.prototype.xd=function(e,g,a){var n=this.f.slice(0,e),h=this.f.slice(g);e=this.f.slice(e,g).sort(a);
this.f.length=0;this.f.push.apply(this.f,n.concat(e).concat(h))};h.prototype.Qh=function(){return 1};h.ob=0;return h}();a.qd=b;b=function(){function h(e){this.Sa=this.Xf=!1;this.f=null;var g=e;2>g&&(g=2);this.f=new Float64Array(g);this.size=e}h.Yc=function(e,g){var a=new h(e),y=a.f;2>e&&(e=2);if(0!==g)for(var c=0;c<e;c++)y[c]=g;return a};h.lj=function(e){var g=new h(0);g.f=new Float64Array(e.f);g.size=e.size;return g};h.V=function(e,g){var a=new h(0);a.size=e.size;a.size>g&&(a.size=g);g=a.size;2>
g&&(g=2);a.f=new Float64Array(g);a.f.set(e.f.length<=g?e.f:e.f.subarray(0,g),0);return a};h.prototype.xb=function(e){0>=e||(null==this.f?this.f=new Float64Array(e):e<=this.f.length||(0<this.f.length?(e=new Float64Array(e),e.set(this.f),this.f=e):this.f=new Float64Array(e)))};h.prototype.read=function(e){return this.f[e]};h.prototype.ec=function(e,g){g.x=this.f[e];g.y=this.f[e+1]};h.prototype.get=function(e){return this.f[e]};h.prototype.write=function(e,g){if(this.Sa)throw a.g.xa();this.f[e]=g};h.prototype.set=
function(e,g){if(this.Sa)throw a.g.xa();this.f[e]=g};h.prototype.Rn=function(e,g){if(this.Sa)throw a.g.xa();this.f[e]=g.x;this.f[e+1]=g.y};h.prototype.add=function(e){this.resize(this.size+1);this.f[this.size-1]=e};h.prototype.Ip=function(e){return h.V(this,e)};h.prototype.Bh=function(e){return this.read(e)};h.prototype.resize=function(e,g){void 0===g&&(g=0);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");if(e<=this.size){if(30<this.f.length&&5*e/4<this.f.length){var n=
new Float64Array(this.f,0,e);this.f=n}}else{e>this.f.length&&(n=a.I.truncate(64>e?Math.max(2*e,4):5*e/4),n=new Float64Array(n),n.set(this.f),this.f=n);for(var n=this.f,h=this.size;h<e;h++)n[h]=g}this.size=e};h.prototype.cf=function(e){(null==this.f||e>this.f.length)&&this.resize(e);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");this.size=e};h.prototype.Uk=function(e,g){this.write(e,g)};h.prototype.jj=function(e,g,n){for(var h=this.size;g<h&&g<n;g++)e=a.I.Rh(this.read(g));
return e};h.prototype.lc=function(e,g,a){if(null==e||!(e instanceof h))return!1;var n=this.size,c=e.size;if(a>n||a>c&&n!=c)return!1;for(a>n&&(a=n);g<a;g++)if(this.read(g)!=e.read(g))return!1;return!0};h.prototype.nk=function(e,g,n,h,F,b,A){if(this.Sa)throw a.g.xa();if(!F&&(1>b||0!=h%b))throw a.g.N();var y=this.size-A;y<h&&this.resize(this.size+h-y);c(this.f,e+h,e,e+(A-e));this.f==g.f&&e<n&&(n+=h);if(F)this.f.set(g.f.subarray(n,n+h),e);else for(F=h,A=0;A<h;A+=b)for(F-=b,y=0;y<b;y++)this.f[e+A+y]=g.f[n+
F+y]};h.prototype.ul=function(e,g,n,h){if(this.Sa)throw a.g.xa();h-=e;c(this.f,e+h,e,e+h);for(h=0;h<n;h++)this.f[e+h]=g};h.prototype.lg=function(e,g,n){if(this.Sa)throw a.g.xa();c(this.f,e+2,e,e+(n-e));this.f[e]=g.x;this.f[e+1]=g.y};h.prototype.km=function(e,g,n,h,c,b){if(0>e||0>g||0>h)throw a.g.N();if(!c&&(0>=b||0!=g%b))throw a.g.N();if(n.size<h+g)throw a.g.N();if(0!=g)if(this.size<g+e&&this.resize(g+e),n==this)this.xi(e,g,h,c,b);else if(c)for(c=0;c<g;c++)this.f[e]=n.f[h],e++,h++;else if(h=h+g-b,
1==b)for(c=0;c<g;c++)this.f[e]=n.f[h],e++,h--;else for(c=0,g=a.I.truncate(g/b);c<g;c++){for(var y=0;y<b;y++)this.f[e+y]=n.f[h+y];e+=b;h-=b}};h.prototype.oj=function(e,g,n){if(this.Sa)throw a.g.xa();if(e+g>this.size)throw a.g.xa();0<n-(e+g)&&c(this.f,e,e+g,e+(n-(e+g))+g);this.size-=g};h.prototype.Jp=function(e,g,n){if(this.Sa)throw a.g.xa();if(1>n||0!=g%n)throw a.g.xa();for(var h=g>>1,c=0;c<h;c+=n){g-=n;for(var b=0;b<n;b++){var A=this.f[e+c+b];this.f[e+c+b]=this.f[e+g+b];this.f[e+g+b]=A}}};h.prototype.dh=
function(e,g,n){if(0>g||0>n||0>g||n+g>this.size)throw a.g.N();for(var h=g;h<g+n;h++)this.f[h]=e};h.prototype.xi=function(e,g,n,h,c){if(!h||e!=n)if(this.f.set(this.f.subarray(n,n+g),e),!h)for(n=e,e=e+g-c,h=0,g=a.I.truncate(g/2);h<g;h++){for(var y=0;y<c;y++){var F=this.f[n+y];this.f[n+y]=this.f[e+y];this.f[e+y]=F}n+=c;e-=c}};h.prototype.$p=function(e,g,n,h,c){if(0>e||0>g||0>h)throw a.g.N();if(0!=g)for(this.size<(g<<1)+e&&this.resize((g<<1)+e),c||(e+=g-1<<1),c=c?2:-2,g+=h;h<g;h++)this.f[e]=n[h].x,this.f[e+
1]=n[h].y,e+=c};h.prototype.Hp=function(e,g,n,h,c){if(0>e||0>g||0>h||this.size<g+e)throw a.g.N();if(c)for(c=0;c<g;c++)n[h+c]=this.f[e+c];else for(h=h+g-1;e<g;e++)n[h]=this.f[e],h--};h.prototype.clear=function(e){e?this.resize(0):this.cf(0)};h.prototype.xd=function(e,g,a){Array.prototype.sort.call(this.f.subarray(e,g),a)};h.prototype.Qh=function(){return 1};return h}();a.QG=b})(B||(B={}));!0===B.ah.Sk&&!0===B.ah.it&&(B.qd=B.QG);(function(a){function c(a,e,g,n){g=new Int32Array(a.subarray(g,n));a.set(g,
e)}a.tT=function(){return function(){this.random=1973}}();var b=function(){function h(e){this.Sa=this.Xf=!1;this.f=[];var g=e;2>g&&(g=2);this.f=this.f=a.I.Lh(g,h.ob);this.size=e}h.Yc=function(e,g){h.ob=g;e=new h(e);h.ob=0;return e};h.lj=function(e){var g=new h(0);g.f=e.f.slice(0);g.size=e.size;return g};h.V=function(e,g){var a=new h(0);a.size=e.size;a.size>g&&(a.size=g);a.f=e.f.slice(0,a.size);return a};h.prototype.xb=function(){};h.prototype.read=function(e){return this.f[e]};h.prototype.ec=function(e,
g){g.x=this.f[e];g.y=this.f[e+1]};h.prototype.get=function(e){return this.f[e]};h.prototype.write=function(e,g){if(this.Sa)throw a.g.xa();this.f[e]=g};h.prototype.set=function(e,g){if(this.Sa)throw a.g.xa();this.f[e]=g};h.prototype.Rn=function(e,g){if(this.Sa)throw a.g.xa();this.f[e]=g.x;this.f[e+1]=g.y};h.prototype.add=function(e){this.resize(this.size+1);this.f[this.size-1]=e};h.prototype.Ip=function(e){return h.V(this,e)};h.prototype.Bh=function(e){return this.read(e)};h.prototype.resize=function(e,
g){void 0===g&&(g=0);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");if(e<=this.size){if(a.I.truncate(5*e/4)<this.f.length){var n=this.f.slice(0,e);this.f=n}}else if(e>this.f.length){a.I.truncate(64>e?Math.max(2*e,4):5*e/4);for(var n=this.f.slice(0),h=this.f.length;h<e;h++)n[h]=g;this.f=n}this.size=e};h.prototype.cf=function(e){(null==this.f||e>this.f.length)&&this.resize(e);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");
this.size=e};h.prototype.Uk=function(e,g){this.write(e,g)};h.prototype.jj=function(e,g,n){for(var h=this.size;g<h&&g<n;g++)e=a.I.kg(this.read(g),e);return e};h.prototype.lc=function(e,g,a){if(null==e||!(e instanceof h))return!1;var n=this.size,c=e.size;if(a>n||a>c&&n!=c)return!1;for(a>n&&(a=n);g<a;g++)if(this.read(g)!=e.read(g))return!1;return!0};h.prototype.nk=function(e,g,n,h,c,b,A){if(this.Sa)throw a.g.xa();if(!c&&(1>b||0!=h%b))throw a.g.N();for(var y=0;y<A-e;y++)this.f[e+h+y]=this.f[e+y];this.f==
g.f&&e<n&&(n+=h);if(c)for(y=0;y<h;y++)this.f[y+e]=g.f[n+y];else for(c=h,A=0;A<h;A+=b)for(c-=b,y=0;y<b;y++)this.f[e+A+y]=g.f[n+c+y]};h.prototype.ul=function(e,g,n,h){if(this.Sa)throw a.g.xa();h-=e;for(var y=this.f.slice(e,e+h),c=0;c<h;c++)this.f[e+n+c]=y[c];for(h=0;h<n;h++)this.f[e+h]=g};h.prototype.lg=function(e,g,n){if(this.Sa)throw a.g.xa();for(var h=this.f.slice(e,e+(n-e)),c=0;c<n-e;c++)this.f[c+e+2]=h[c];this.f[e]=g.x;this.f[e+1]=g.y};h.prototype.km=function(e,g,n,h,c,b){if(0>e||0>g||0>h)throw a.g.N();
if(!c&&(0>=b||0!=g%b))throw a.g.N();if(n.size<h+g)throw a.g.N();if(0!=g)if(this.size<g+e&&this.resize(g+e),n==this)this.xi(e,g,h,c,b);else if(c)for(c=0;c<g;c++)this.f[e]=n.f[h],e++,h++;else if(h=h+g-b,1==b)for(c=0;c<g;c++)this.f[e]=n.f[h],e++,h--;else for(c=0,g=a.I.truncate(g/b);c<g;c++){for(var y=0;y<b;y++)this.f[e+y]=n.f[h+y];e+=b;h-=b}};h.prototype.oj=function(e,g,n){if(this.Sa)throw a.g.xa();if(e+g>this.size)throw a.g.xa();if(0<n-(e+g)){n-=e+g;for(var h=this.f.slice(e+g,e+n+g),c=0;c<n;c++)this.f[e+
c]=h[c]}this.size-=g};h.prototype.Jp=function(e,g,n){if(this.Sa)throw a.g.xa();if(1>n||0!=g%n)throw a.g.xa();for(var h=g>>1,c=0;c<h;c+=n){g-=n;for(var b=0;b<n;b++){var A=this.f[e+c+b];this.f[e+c+b]=this.f[e+g+b];this.f[e+g+b]=A}}};h.prototype.dh=function(e,g,n){if(0>g||0>n||0>g||n+g>this.size)throw a.g.N();for(var h=g;h<g+n;h++)this.f[h]=e};h.prototype.xi=function(e,g,n,h,c){if(!h||e!=n){for(var y=0;y<g;y++)this.f[e+y]=this.f[n+y];if(!h)for(n=e,e=e+g-c,h=0,g=a.I.truncate(g/2);h<g;h++){for(y=0;y<c;y++){var F=
this.f[n+y];this.f[n+y]=this.f[e+y];this.f[e+y]=F}n+=c;e-=c}}};h.prototype.$p=function(e,g,n,h,c){if(0>e||0>g||0>h)throw a.g.N();if(0!=g)for(this.size<(g<<1)+e&&this.resize((g<<1)+e),c||(e+=g-1<<1),c=c?2:-2,g+=h;h<g;h++)this.f[e]=n[h].x,this.f[e+1]=n[h].y,e+=c};h.prototype.Hp=function(e,g,n,h,c){if(0>e||0>g||0>h||this.size<g+e)throw a.g.N();if(c)for(c=0;c<g;c++)n[h+c]=this.f[e+c];else for(h=h+g-1;e<g;e++)n[h]=this.f[e],h--};h.prototype.clear=function(e){e?this.resize(0):this.cf(0)};h.prototype.xd=
function(e,g,a){var n=this.f.slice(0,e),h=this.f.slice(g);e=this.f.slice(e,g).sort(a);this.f.length=0;this.f.push.apply(this.f,n.concat(e).concat(h))};h.prototype.Qh=function(){return 2};h.prototype.tc=function(){return this.f[this.size-1]};h.prototype.af=function(){this.resize(this.size-1)};h.prototype.JF=function(e){this.f[this.size-1]=e};h.prototype.QE=function(e){e<this.size-1&&(this.f[e]=this.f[this.size-1]);this.resize(this.size-1)};h.prototype.Qs=function(e){for(var g=0,a=this.size;g<a;g++)if(this.f[g]==
e)return g;return-1};h.prototype.Nw=function(e){return 0<=this.Qs(e)};h.ob=0;return h}();a.ga=b;b=function(){function h(e){this.Sa=this.Xf=!1;this.f=null;var g=e;2>g&&(g=2);this.f=new Int32Array(g);this.size=e}h.Yc=function(e,g){var a=new h(e),y=a.f;2>e&&(e=2);if(0!==g)for(var c=0;c<e;c++)y[c]=g;return a};h.lj=function(e){var g=new h(0);g.f=new Int32Array(e.f);g.size=e.size;return g};h.V=function(e,g){var a=new h(0);a.size=e.size;a.size>g&&(a.size=g);g=a.size;2>g&&(g=2);a.f=new Int32Array(g);a.f.set(e.f.length<=
g?e.f:e.f.subarray(0,g),0);return a};h.prototype.xb=function(e){0>=e||(null==this.f?this.f=new Int32Array(e):e<=this.f.length||(0<this.f.length?(e=new Int32Array(e),e.set(this.f),this.f=e):this.f=new Int32Array(e)))};h.prototype.read=function(e){return this.f[e]};h.prototype.ec=function(e,g){g.x=this.f[e];g.y=this.f[e+1]};h.prototype.get=function(e){return this.f[e]};h.prototype.write=function(e,g){if(this.Sa)throw a.g.xa();this.f[e]=g};h.prototype.set=function(e,g){if(this.Sa)throw a.g.xa();this.f[e]=
g};h.prototype.Rn=function(e,g){if(this.Sa)throw a.g.xa();this.f[e]=g.x;this.f[e+1]=g.y};h.prototype.add=function(e){this.resize(this.size+1);this.f[this.size-1]=e};h.prototype.Ip=function(e){return h.V(this,e)};h.prototype.Bh=function(e){return this.read(e)};h.prototype.resize=function(e,g){void 0===g&&(g=0);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");if(e<=this.size){if(30<this.f.length&&5*e/4<this.f.length){var n=new Int32Array(this.f,0,e);this.f=
n}}else{e>this.f.length&&(n=a.I.truncate(64>e?Math.max(2*e,4):5*e/4),n=new Int32Array(n),n.set(this.f),this.f=n);for(var n=this.f,h=this.size;h<e;h++)n[h]=g}this.size=e};h.prototype.cf=function(e){(null==this.f||e>this.f.length)&&this.resize(e);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");this.size=e};h.prototype.Uk=function(e,g){this.write(e,g)};h.prototype.jj=function(e,g,n){for(var h=this.size;g<h&&g<n;g++)e=a.I.kg(this.read(g),e);return e};h.prototype.lc=
function(e,g,a){if(null==e||!(e instanceof h))return!1;var n=this.size,c=e.size;if(a>n||a>c&&n!=c)return!1;for(a>n&&(a=n);g<a;g++)if(this.read(g)!=e.read(g))return!1;return!0};h.prototype.nk=function(e,g,n,h,F,b,A){if(this.Sa)throw a.g.xa();if(!F&&(1>b||0!=h%b))throw a.g.N();c(this.f,e+h,e,e+(A-e));this.f==g.f&&e<n&&(n+=h);if(F)this.f.set(g.f.subarray(n,n+h),e);else for(F=h,A=0;A<h;A+=b){F-=b;for(var y=0;y<b;y++)this.f[e+A+y]=g.f[n+F+y]}};h.prototype.ul=function(e,g,n,h){if(this.Sa)throw a.g.xa();
h-=e;c(this.f,e+h,e,e+h);for(h=0;h<n;h++)this.f[e+h]=g};h.prototype.lg=function(e,g,n){if(this.Sa)throw a.g.xa();c(this.f,e+2,e,e+(n-e));this.f[e]=g.x;this.f[e+1]=g.y};h.prototype.km=function(e,g,n,h,c,b){if(0>e||0>g||0>h)throw a.g.N();if(!c&&(0>=b||0!=g%b))throw a.g.N();if(n.size<h+g)throw a.g.N();if(0!=g)if(this.size<g+e&&this.resize(g+e),n==this)this.xi(e,g,h,c,b);else if(c)for(c=0;c<g;c++)this.f[e]=n.f[h],e++,h++;else if(h=h+g-b,1==b)for(c=0;c<g;c++)this.f[e]=n.f[h],e++,h--;else for(c=0,g=a.I.truncate(g/
b);c<g;c++){for(var y=0;y<b;y++)this.f[e+y]=n.f[h+y];e+=b;h-=b}};h.prototype.oj=function(e,g,n){if(this.Sa)throw a.g.xa();if(e+g>this.size)throw a.g.xa();0<n-(e+g)&&c(this.f,e,e+g,e+(n-(e+g))+g);this.size-=g};h.prototype.Jp=function(e,g,n){if(this.Sa)throw a.g.xa();if(1>n||0!=g%n)throw a.g.xa();for(var h=g>>1,c=0;c<h;c+=n){g-=n;for(var b=0;b<n;b++){var A=this.f[e+c+b];this.f[e+c+b]=this.f[e+g+b];this.f[e+g+b]=A}}};h.prototype.dh=function(e,g,n){if(0>g||0>n||0>g||n+g>this.size)throw a.g.N();for(var h=
g;h<g+n;h++)this.f[h]=e};h.prototype.xi=function(e,g,n,h,c){if(!h||e!=n)if(this.f.set(this.f.subarray(n,n+g),e),!h)for(n=e,e=e+g-c,h=0,g=a.I.truncate(g/2);h<g;h++){for(var y=0;y<c;y++){var b=this.f[n+y];this.f[n+y]=this.f[e+y];this.f[e+y]=b}n+=c;e-=c}};h.prototype.$p=function(e,g,n,h,c){if(0>e||0>g||0>h)throw a.g.N();if(0!=g)for(this.size<(g<<1)+e&&this.resize((g<<1)+e),c||(e+=g-1<<1),c=c?2:-2,g+=h;h<g;h++)this.f[e]=n[h].x,this.f[e+1]=n[h].y,e+=c};h.prototype.Hp=function(e,g,n,h,c){if(0>e||0>g||0>
h||this.size<g+e)throw a.g.N();if(c)for(c=0;c<g;c++)n[h+c]=this.f[e+c];else for(h=h+g-1;e<g;e++)n[h]=this.f[e],h--};h.prototype.clear=function(e){e?this.resize(0):this.cf(0)};h.prototype.xd=function(e,g,a){10>g-e?h.$i(this.f,e,g,a):h.$g(this.f,e,g-1,a)};h.prototype.Qh=function(){return 2};h.prototype.tc=function(){return this.f[this.size-1]};h.prototype.af=function(){this.resize(this.size-1)};h.prototype.JF=function(e){this.f[this.size-1]=e};h.prototype.QE=function(e){e<this.size-1&&(this.f[e]=this.f[this.size-
1]);this.resize(this.size-1)};h.prototype.Qs=function(e){for(var g=0,a=this.size;g<a;g++)if(this.f[g]==e)return g;return-1};h.prototype.Nw=function(e){return 0<=this.Qs(e)};h.$i=function(e,g,a,h){for(var n=g;n<a;n++){for(var y=e[n],c=n-1;c>=g&&0<h(e[c],y);)e[c+1]=e[c],c--;e[c+1]=y}};h.Wf=function(e,g,a){var n=e[a];e[a]=e[g];e[g]=n};h.$g=function(e,g,a,y){if(!(g>=a))for(;;){if(9>a-g){h.$i(e,g,a+1,y);break}var n=e[g];h.Wf(e,g,a);for(var c=g,b=g;b<a;b++)0>=y(e[b],n)&&(h.Wf(e,c,b),c+=1);h.Wf(e,c,a);c-
g<a-c?(h.$g(e,g,c-1,y),g=c+1):(h.$g(e,c+1,a,y),a=c-1)}};return h}();a.Xu=b})(B||(B={}));!0===B.ah.Sk&&(B.ga=B.Xu);(function(a){function c(a,e,g,n){g=new Int8Array(a.subarray(g,n));a.set(g,e)}var b=function(){function h(e){this.Sa=this.Xf=!1;this.f=[];var g=e;2>g&&(g=2);this.f=a.I.Lh(g,h.ob);this.size=e}h.Yc=function(e,g){h.ob=g;e=new h(e);h.ob=0;return e};h.lj=function(e){var g=new h(0);g.f=e.f.slice(0);g.size=e.size;return g};h.V=function(e,g){var a=new h(0);a.size=e.size;a.size>g&&(a.size=g);a.f=
e.f.slice(0,a.size);return a};h.prototype.xb=function(){};h.prototype.read=function(e){return this.f[e]};h.prototype.ec=function(e,g){g.x=this.f[e];g.y=this.f[e+1]};h.prototype.get=function(e){return this.f[e]};h.prototype.write=function(e,g){if(this.Sa)throw a.g.xa();this.f[e]=g};h.prototype.set=function(e,g){if(this.Sa)throw a.g.xa();this.f[e]=g};h.prototype.Rn=function(e,g){if(this.Sa)throw a.g.xa();this.f[e]=g.x;this.f[e+1]=g.y};h.prototype.add=function(e){this.resize(this.size+1);this.f[this.size-
1]=e};h.prototype.Ip=function(e){return h.V(this,e)};h.prototype.Bh=function(e){return this.read(e)};h.prototype.resize=function(e,g){void 0===g&&(g=0);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");if(e<=this.size){if(a.I.truncate(5*e/4)<this.f.length){var n=this.f.slice(0,e);this.f=n}}else if(e>this.f.length){a.I.truncate(64>e?Math.max(2*e,4):5*e/4);for(var n=this.f.slice(0),h=this.f.length;h<e;h++)n[h]=g;this.f=n}this.size=e};h.prototype.cf=function(e){(null==
this.f||e>this.f.length)&&this.resize(e);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");this.size=e};h.prototype.Uk=function(e,g){this.write(e,g)};h.prototype.jj=function(e,g,n){for(var h=this.size;g<h&&g<n;g++)e=a.I.kg(this.read(g),e);return e};h.prototype.lc=function(e,g,a){if(null==e||!(e instanceof h))return!1;var n=this.size,c=e.size;if(a>n||a>c&&n!=c)return!1;for(a>n&&(a=n);g<a;g++)if(this.read(g)!=e.read(g))return!1;return!0};h.prototype.nk=function(e,
g,n,h,c,b,A){if(this.Sa)throw a.g.xa();if(!c&&(1>b||0!=h%b))throw a.g.N();for(var y=0;y<A-e;y++)this.f[e+h+y]=this.f[e+y];this.f==g.f&&e<n&&(n+=h);if(c)for(y=0;y<h;y++)this.f[y+e]=g.f[n+y];else for(c=h,A=0;A<h;A+=b)for(c-=b,y=0;y<b;y++)this.f[e+A+y]=g.f[n+c+y]};h.prototype.ul=function(e,g,h,y){if(this.Sa)throw a.g.xa();y-=e;for(var n=this.f.slice(e,e+y),c=0;c<y;c++)this.f[e+h+c]=n[c];for(y=0;y<h;y++)this.f[e+y]=g};h.prototype.lg=function(e,g,h){if(this.Sa)throw a.g.xa();for(var n=this.f.slice(e,e+
(h-e)),c=0;c<h-e;c++)this.f[c+e+2]=n[c];this.f[e]=g.x;this.f[e+1]=g.y};h.prototype.km=function(e,g,h,y,c,b){if(0>e||0>g||0>y)throw a.g.N();if(!c&&(0>=b||0!=g%b))throw a.g.N();if(h.size<y+g)throw a.g.N();if(0!=g)if(this.size<g+e&&this.resize(g+e),h==this)this.xi(e,g,y,c,b);else if(c)for(c=0;c<g;c++)this.f[e]=h.f[y],e++,y++;else if(y=y+g-b,1==b)for(c=0;c<g;c++)this.f[e]=h.f[y],e++,y--;else for(c=0,g=a.I.truncate(g/b);c<g;c++){for(var n=0;n<b;n++)this.f[e+n]=h.f[y+n];e+=b;y-=b}};h.prototype.oj=function(e,
g,h){if(this.Sa)throw a.g.xa();if(e+g>this.size)throw a.g.xa();if(0<h-(e+g)){h-=e+g;for(var n=this.f.slice(e+g,e+h+g),c=0;c<h;c++)this.f[e+c]=n[c]}this.size-=g};h.prototype.Jp=function(e,g,h){if(this.Sa)throw a.g.xa();if(1>h||0!=g%h)throw a.g.xa();for(var n=g>>1,c=0;c<n;c+=h){g-=h;for(var b=0;b<h;b++){var A=this.f[e+c+b];this.f[e+c+b]=this.f[e+g+b];this.f[e+g+b]=A}}};h.prototype.dh=function(e,g,h){if(0>g||0>h||0>g||h+g>this.size)throw a.g.N();for(var n=g;n<g+h;n++)this.f[n]=e};h.prototype.xi=function(e,
g,h,c,b){if(!c||e!=h){for(var n=0;n<g;n++)this.f[e+n]=this.f[h+n];if(!c)for(h=e,e=e+g-b,c=0,g=a.I.truncate(g/2);c<g;c++){for(n=0;n<b;n++){var y=this.f[h+n];this.f[h+n]=this.f[e+n];this.f[e+n]=y}h+=b;e-=b}}};h.prototype.$p=function(e,g,h,c,b){if(0>e||0>g||0>c)throw a.g.N();if(0!=g)for(this.size<(g<<1)+e&&this.resize((g<<1)+e),b||(e+=g-1<<1),b=b?2:-2,g+=c;c<g;c++)this.f[e]=h[c].x,this.f[e+1]=h[c].y,e+=b};h.prototype.Hp=function(e,g,h,c,b){if(0>e||0>g||0>c||this.size<g+e)throw a.g.N();if(b)for(b=0;b<
g;b++)h[c+b]=this.f[e+b];else for(c=c+g-1;e<g;e++)h[c]=this.f[e],c--};h.prototype.clear=function(e){e?this.resize(0):this.cf(0)};h.prototype.xd=function(e,g,a){var h=this.f.slice(0,e),n=this.f.slice(g);e=this.f.slice(e,g).sort(a);this.f.length=0;this.f.push.apply(this.f,h.concat(e).concat(n))};h.prototype.Qh=function(){return 1};h.prototype.xy=function(e,g){if(this.Sa)throw a.g.ra("invalid call. Attribute Stream is read only.");this.f[e]|=g};h.prototype.BB=function(e,g){if(this.Sa)throw a.g.ra("invalid call. Attribute Stream is read only.");
this.f[e]&=~g};h.ob=0;return h}();a.Wk=b;b=function(){function h(e){this.f=null;var g=e;2>g&&(g=2);this.f=new Int8Array(g);this.size=e}h.Yc=function(e,g){var a=new h(e),c=a.f;2>e&&(e=2);if(0!==g)for(var b=0;b<e;b++)c[b]=g;return a};h.lj=function(e){var g=new h(0);g.f=new Int8Array(e.f);g.size=e.size;return g};h.V=function(e,g){var a=new h(0);a.size=e.size;a.size>g&&(a.size=g);g=a.size;2>g&&(g=2);a.f=new Int8Array(g);a.f.set(e.f.length<=g?e.f:e.f.subarray(0,g),0);return a};h.prototype.xb=function(e){0>=
e||(null==this.f?this.f=new Int8Array(e):e<=this.f.length||(0<this.f.length?(e=new Int8Array(e),e.set(this.f),this.f=e):this.f=new Int8Array(e)))};h.prototype.read=function(e){return this.f[e]};h.prototype.ec=function(e,g){g.x=this.f[e];g.y=this.f[e+1]};h.prototype.get=function(e){return this.f[e]};h.prototype.write=function(e,g){if(this.Sa)throw a.g.xa();this.f[e]=g};h.prototype.set=function(e,g){if(this.Sa)throw a.g.xa();this.f[e]=g};h.prototype.Rn=function(e,g){if(this.Sa)throw a.g.xa();this.f[e]=
g.x;this.f[e+1]=g.y};h.prototype.add=function(e){this.resize(this.size+1);this.f[this.size-1]=e};h.prototype.Ip=function(e){return h.V(this,e)};h.prototype.Bh=function(e){return this.read(e)};h.prototype.resize=function(e,g){void 0===g&&(g=0);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");if(e<=this.size){if(30<this.f.length&&5*e/4<this.f.length){var h=new Int8Array(this.f,0,e);this.f=h}}else{e>this.f.length&&(h=a.I.truncate(64>e?Math.max(2*e,4):5*e/4),
h=new Int8Array(h),h.set(this.f),this.f=h);for(var h=this.f,c=this.size;c<e;c++)h[c]=g}this.size=e};h.prototype.cf=function(e){(null==this.f||e>this.f.length)&&this.resize(e);if(this.Xf)throw a.g.ra("invalid call. Attribute Stream is locked and cannot be resized.");this.size=e};h.prototype.Uk=function(e,g){this.write(e,g)};h.prototype.jj=function(e,g,h){for(var n=this.size;g<n&&g<h;g++)e=a.I.kg(this.read(g),e);return e};h.prototype.lc=function(e,g,a){if(null==e||!(e instanceof h))return!1;var n=this.size,
c=e.size;if(a>n||a>c&&n!=c)return!1;for(a>n&&(a=n);g<a;g++)if(this.read(g)!=e.read(g))return!1;return!0};h.prototype.nk=function(e,g,h,y,b,A,d){if(this.Sa)throw a.g.xa();if(!b&&(1>A||0!=y%A))throw a.g.N();c(this.f,e+y,e,e+(d-e));this.f==g.f&&e<h&&(h+=y);if(b)this.f.set(g.f.subarray(h,h+y),e);else for(b=y,d=0;d<y;d+=A){b-=A;for(var n=0;n<A;n++)this.f[e+d+n]=g.f[h+b+n]}};h.prototype.ul=function(e,g,h,y){if(this.Sa)throw a.g.xa();y-=e;c(this.f,e+y,e,e+y);for(y=0;y<h;y++)this.f[e+y]=g};h.prototype.lg=
function(e,g,h){if(this.Sa)throw a.g.xa();c(this.f,e+2,e,e+(h-e));this.f[e]=g.x;this.f[e+1]=g.y};h.prototype.km=function(e,g,h,c,b,A){if(0>e||0>g||0>c)throw a.g.N();if(!b&&(0>=A||0!=g%A))throw a.g.N();if(h.size<c+g)throw a.g.N();if(0!=g)if(this.size<g+e&&this.resize(g+e),h==this)this.xi(e,g,c,b,A);else if(b)for(b=0;b<g;b++)this.f[e]=h.f[c],e++,c++;else if(c=c+g-A,1==A)for(b=0;b<g;b++)this.f[e]=h.f[c],e++,c--;else for(b=0,g=a.I.truncate(g/A);b<g;b++){for(var n=0;n<A;n++)this.f[e+n]=h.f[c+n];e+=A;c-=
A}};h.prototype.oj=function(e,g,h){if(this.Sa)throw a.g.xa();if(e+g>this.size)throw a.g.xa();0<h-(e+g)&&c(this.f,e,e+g,e+(h-(e+g))+g);this.size-=g};h.prototype.Jp=function(e,g,h){if(this.Sa)throw a.g.xa();if(1>h||0!=g%h)throw a.g.xa();for(var n=g>>1,c=0;c<n;c+=h){g-=h;for(var b=0;b<h;b++){var A=this.f[e+c+b];this.f[e+c+b]=this.f[e+g+b];this.f[e+g+b]=A}}};h.prototype.dh=function(e,g,h){if(0>g||0>h||0>g||h+g>this.size)throw a.g.N();for(var n=g;n<g+h;n++)this.f[n]=e};h.prototype.xi=function(e,g,h,c,
b){if(!c||e!=h)if(this.f.set(this.f.subarray(h,h+g),e),!c)for(h=e,e=e+g-b,c=0,g=a.I.truncate(g/2);c<g;c++){for(var n=0;n<b;n++){var y=this.f[h+n];this.f[h+n]=this.f[e+n];this.f[e+n]=y}h+=b;e-=b}};h.prototype.$p=function(e,g,h,c,b){if(0>e||0>g||0>c)throw a.g.N();if(0!=g)for(this.size<(g<<1)+e&&this.resize((g<<1)+e),b||(e+=g-1<<1),b=b?2:-2,g+=c;c<g;c++)this.f[e]=h[c].x,this.f[e+1]=h[c].y,e+=b};h.prototype.Hp=function(e,g,h,c,b){if(0>e||0>g||0>c||this.size<g+e)throw a.g.N();if(b)for(b=0;b<g;b++)h[c+
b]=this.f[e+b];else for(c=c+g-1;e<g;e++)h[c]=this.f[e],c--};h.prototype.clear=function(e){e?this.resize(0):this.cf(0)};h.prototype.xd=function(e,g,a){g=this.f.subarray(e,g);Array.prototype.sort.call(g,a);this.f.set(g,e)};h.prototype.xy=function(e,g){if(this.Sa)throw a.g.ra("invalid call. Attribute Stream is read only.");this.f[e]|=g};h.prototype.BB=function(e,g){if(this.Sa)throw a.g.ra("invalid call. Attribute Stream is read only.");this.f[e]&=~g};h.prototype.Qh=function(){return 1};return h}();a.Yu=
b})(B||(B={}));!0===B.ah.Sk&&(B.Wk=B.Yu);(function(a){var c=function(){function c(){}c.to=function(h,e){return a.Wk.Yc(h,e)};c.kl=function(h,e){return a.qd.Yc(h,e)};c.Sv=function(h,e,g){switch(h){case 1:h=a.qd.Yc(e,g);break;case 2:h=a.ga.Yc(e,g);break;case 4:h=a.Wk.Yc(e,g);break;default:throw a.g.wa();}return h};c.Tv=function(h,e){return c.Sv(a.pa.Qh(h),e*a.pa.Wa(h),a.pa.ue(h))};c.Dg=function(h,e){return a.ga.Yc(h,e)};c.ay=function(a){var e,g=[];for(e=0;e<a;e++)g.push(null);return g};return c}();
a.Ac=c})(B||(B={}));(function(a){var c=function(){function c(){}c.to=function(h,e){return a.Yu.Yc(h,e)};c.kl=function(h,e){return a.qd.Yc(h,e)};c.Sv=function(h,e,g){switch(h){case 1:h=a.qd.Yc(e,g);break;case 2:h=a.Xu.Yc(e,g);break;case 4:h=a.Yu.Yc(e,g);break;default:throw a.g.wa();}return h};c.Tv=function(h,e){return a.Ac.Sv(a.pa.Qh(h),e*a.pa.Wa(h),a.pa.ue(h))};c.Dg=function(h,e){return a.Xu.Yc(h,e)};c.ay=function(a){var e,g=[];for(e=0;e<a;e++)g.push(null);return g};return c}();a.RG=c})(B||(B={}));
!0===B.ah.Sk&&(B.Ac=B.RG);(function(a){a.ca=function(){return function(a){void 0===a&&(a=0);this.l=a}}()})(B||(B={}));(function(a){var c=function(){function a(){}a.nb=function(e,g){return 0<=g?a.H(e):-a.H(e)};a.H=function(e){return 0>e?-e:e};a.Ih=function(e){return 3.552713678800501E-15>e};a.Xz=function(e,g,h){return a.H(e-g)<=h*(1+(a.H(e)+a.H(g))/2)};a.S=function(e,g){return a.Xz(e,g,3.552713678800501E-15)};a.wI=function(e){return 3.552713678800501E-15>=a.H(e)};a.Vc=function(e){return a.wI(e)};return a}();
a.j=c;var b=function(){function h(){}h.Sn=function(e,g){e=c.H(e);g=c.H(g);var a=0;0!=e+g&&(e>g?(a=g/e,a=e*Math.sqrt(1+a*a)):(a=e/g,a=g*Math.sqrt(1+a*a)));return a};h.Ep=function(e,g,a,y,b){for(var n=[0,0,0],F=[0,0,0],A=0;2>=A;A++)g[A]-=e[A],a[A]-=g[A];a=n[1]*F[2]-n[2]*F[1];g=n[2]*F[0]-n[0]*F[2];n=n[0]*F[1]-n[1]*F[0];e=-1*(a*e[0]+g*e[1]+n*e[2]);y[0]=a;y[1]=g;y[2]=n;y[3]=e;F=h.jm(y);y[0]/=F;y[1]/=F;y[2]/=F;y[3]/=F;0!=b&&(F=c.Vc(n)?c.Vc(e)?c.nb(1,g):-c.nb(1,e):c.nb(1,n),F*=c.nb(1,b),y[0]*=F,y[1]*=F,
y[2]*=F,y[3]*=F)};h.Uu=function(e,g,a){a[0]=e[1]*g[2]-g[1]*e[2];a[1]=e[2]*g[0]-g[2]*e[0];a[2]=e[0]*g[1]-g[0]*e[1]};h.Qr=function(e,g){return e[0]*g[0]+e[1]*g[1]+e[2]*g[2]};h.jm=function(e){return h.Sn(h.Sn(e[0],e[1]),e[2])};h.wm=function(e,g,a,c,b,A){var n=h.n(1,e,g),y=Math.cos(g);c.l=(n+0)*y*Math.cos(a);b.l=(n+0)*y*Math.sin(a);A.l=(n*(1-e)+0)*Math.sin(g)};h.JK=function(e,g,a,y,b,A,d){var n=h.Sn(g,a),F=1*Math.sqrt(1-e),N=F/1;if(c.S(n,0))A.l=0,b.l=c.nb(1.570796326794897,y),d.l=c.H(y)-F;else{A.l=Math.atan2(a,
g);a=Math.atan2(1*y,F*n);A=Math.cos(a);var f=Math.sin(a);g=F*e/(1-e);e*=1;a=Math.atan2(y+g*f*f*f,n-e*A*A*A);3.141592653589793<c.H(a)&&(a=c.nb(3.141592653589793,a)-a);a=Math.atan(N*Math.tan(a));f=Math.sin(a);A=Math.cos(a);b.l=Math.atan2(y+g*f*f*f,n-e*A*A*A);1.570796326794897<c.H(b.l)&&(b.l=c.nb(3.141592653589793,b.l)-b.l);a=Math.atan(N*Math.tan(b.l));f=Math.sin(a);A=Math.cos(a);d.l=(y-F*f)*Math.sin(b.l)+(n-1*A)*Math.cos(b.l)}};h.n=function(e,g,a){a=Math.sin(a);return e/Math.sqrt(1-g*a*a)};h.sr=function(e,
g){return Math.atan2(Math.sin(g)*(1-e),Math.cos(g))};h.Si=function(e,g){return Math.atan2(Math.sin(g),Math.cos(g)*(1-e))};h.xn=function(e,g){if(c.Ih(e)||0==g||c.S(c.H(g),1.570796326794897))return g;var a,y,b,A,d,f,k,m,p;if(.006884661117170036>e){A=Math.sqrt(1-e);d=(1-A)/(1+A);f=d*d;k=d*f;m=d*k;a=d*m;p=d*a;y=d*p;b=1.572916666666667*k-3.2578125*a+4.295068359375*y;A=2.142578125*m-6.071484375*p;e=3.129296875*a-11.249837239583334*y;var r=4.775276692708333*p,u=7.958636765252976*y,v=Math.cos(2*g);return g+
Math.sin(2*g)*(1.5*d-.84375*k+.525390625*a-.2688395182291667*y-b+e-u+v*(2*(1.3125*f-1.71875*m+1.650146484375*p)-4*A+6*r+v*(4*b-12*e+24*u+v*(8*A-32*r+v*(16*e-80*u+v*(32*r+64*v*u))))))}A=1-e;d=e/2;f=c.H(g);k=f*h.Yr(e)/(1.570796326794897*A);m=9999;p=f;for(f=0;1E-16<m&&50>f;f++)y=h.Tk(e,p),a=(h.Lz(p,e)-d*Math.sin(2*p)/y)/A-k,y=1/(y*y*y),b=a/y,a=p-b,m=c.H(b),p=a;return 0<=g?p:-p};h.nR=function(e,g){return c.Ih(g)?e:e*h.Yr(g)/1.570796326794897};h.W=function(e){e=h.Hz(e,6.283185307179586);return 0>e?e+6.283185307179586:
3.141592653589793>c.H(e)||c.S(c.H(e),3.141592653589793)?e:e-6.283185307179586};h.Hz=function(e,g){return e-Math.floor(e/g)*g};h.gg=function(e,g){if(.006884661117170036>g){g=Math.sqrt(1-g);g=(1-g)/(1+g);var a=g*g,c=a*a;return e/(1+g)*(1+.25*a+.015625*c+.00390625*a*c)*1.570796326794897}return e*h.Yr(g)};h.Dp=function(e,g){var a=c.nb(1,Math.sin(g));g=c.H(h.Hz(g,3.141592653589793));g=1.570796326794897>=g?g:3.141592653589793-g;var y;c.S(g,1.570796326794897)?y=g:y=Math.atan(Math.sqrt(1-e)*Math.tan(g));
return y*a};h.q=function(e,g,a){if(.006884661117170036>g){g=Math.sqrt(1-g);g=(1-g)/(1+g);var n=g*g,c=g*n,b=g*c,A=g*b,d=g*A,f=g*d,k=-.7291666666666666*c+.2278645833333333*A+.03987630208333334*f,m=.615234375*b-.21533203125*d,p=-.54140625*A+.20302734375*f,r=.48876953125*d,u=-.4488699776785715*f,v=Math.cos(2*a);return e/(1+g)*((1+.25*n+.015625*b+.00390625*d)*a+Math.sin(2*a)*(-1.5*g+.1875*c+.0234375*A+.00732421875*f-k+p-u+v*(2*(.9375*n-.234375*b-.03662109375*d)-4*m+6*r+v*(4*k-12*p+24*u+v*(8*m-32*r+v*(16*
p-80*u+v*(32*r+64*v*u)))))))}return e*(h.Lz(a,g)-.5*g*Math.sin(2*a)/h.Tk(g,a))};h.Tk=function(e,g){g=Math.sin(g);return Math.sqrt(1-e*g*g)};h.Yr=function(e){return c.Xz(e,1,2.220446049250313E-16)?1:1>e?h.js(0,1-e)-e/3*h.hs(0,1-e):NaN};h.Lz=function(e,g){var n=c.nb(1,e);e=c.H(e);var y=Math.floor(e/1.570796326794897),b;if(1<g)b=0==e?0:NaN;else if(c.Vc(y))b=h.sin(e),b=b*h.js(1-b*b,1-g*b*b)-g/3*b*b*b*h.hs(1-b*b,1-g*b*b);else{b=a.I.truncate(y%2);var A=h.Yr(g);0<b?(b=Math.sin(1.570796326794897*(y+1)-e),
b=b*h.js(1-b*b,1-g*b*b)-g/3*b*b*b*h.hs(1-b*b,1-g*b*b),b=A*(y+1)-b):(b=Math.sin(e-1.570796326794897*y),b=b*h.js(1-b*b,1-g*b*b)-g/3*b*b*b*h.hs(1-b*b,1-g*b*b),b=A*y+b)}return b*n};h.sin=function(e){e=h.W(e);var g=c.nb(1,e);e=c.H(e);return c.S(e,3.141592653589793)?0:c.S(e,1.570796326794897)?1*g:Math.sin(e)*g};h.hs=function(e,g){for(var a=1,h=0,b=1,A,d,f,k;;){A=.2*(e+g+3*a);d=(A-e)/A;f=(A-g)/A;k=(A-a)/A;if(1E-4>c.H(d)&&1E-4>c.H(f)&&1E-4>c.H(k))break;k=Math.sqrt(g);A=Math.sqrt(a);k=Math.sqrt(e)*(k+A)+k*
A;h+=b/(A*(a+k));b*=.25;e=.25*(e+k);g=.25*(g+k);a=.25*(a+k)}e=d*f;a=k*k;g=e-a;a=e-6*a;d=a+g+g;return 3*h+b*(1+a*(-.2142857142857143+.10227272727272728*a-.1730769230769231*k*d)+k*(.1666666666666667*d+k*(-.4090909090909091*g+.1153846153846154*k*e)))/(A*Math.sqrt(A))};h.js=function(e,g){for(var a,h,b,A,d=1;;d=.25*(d+a)){a=(e+g+d)/3;h=2-(a+e)/a;b=2-(a+g)/a;A=2-(a+d)/a;if(1E-4>c.H(h)&&1E-4>c.H(b)&&1E-4>c.H(A))break;a=Math.sqrt(g);h=Math.sqrt(d);a=Math.sqrt(e)*(a+h)+a*h;e=.25*(e+a);g=.25*(g+a)}e=h*b-A*
A;g=h*b*A;return(1+(.04166666666666666*e-.1-.06818181818181818*g)*e+.07142857142857142*g)/Math.sqrt(a)};h.qu=function(e,g){if(c.Ih(e)||0==g||c.S(c.H(g),1.570796326794897))return g;var a,h,b;if(.006884661117170036>e){a=e*e;h=e*a;b=e*h;var A=e*b,d=e*A,f=e*d,k=-(.02708333333333333*h+.03430059523809524*b+.03149181547619048*A+.02634359154541446*d+.02156896735835538*f),m=.007669890873015873*b+.01299603174603175*A+.0148051353064374*d+.01454454953803912*f,p=-(.002275545634920635*A+.004830845032667949*d+.006558395368616723*
f),r=6.957236677288761E-4*d+.001775193002406544*f,u=-(2.17324089394402E-4*f),v=Math.cos(2*g);return g+Math.sin(2*g)*(-(.5*e+.2083333333333333*a+.09375*h+.04878472222222222*b+.02916666666666667*A+.01938905423280423*d+.01388255931712963*f)-k+p-u+v*(2*(.1041666666666667*a+.0875*h+.06050347222222222*b+.04151785714285714*A+.02958958540013228*d+.02203667534722222*f)-4*m+6*r+v*(4*k-12*p+24*u+v*(8*m-32*r+v*(16*p-80*u+v*(32*r+64*v*u))))))}0==g||c.S(c.H(g),1.570796326794897)?a=g:(h=Math.sqrt(e),b=h*Math.sin(g),
a=Math.tan(.7853981633974483+g/2)*Math.pow((1-b)/(1+b),h/2),a=2*Math.atan(a)-1.570796326794897);return a};h.$K=function(e,g){if(c.Ih(e)||0==g||c.S(c.H(g),1.570796326794897))return g;var a,h;if(.006884661117170036>e){v=e*e;p=e*v;r=e*p;a=e*r;u=e*a;h=e*u;var b=.05833333333333333*p+.07232142857142858*r+.05634300595238095*a+.0355325796406526*u+.020235546186067*h,A=.02653149801587302*r+.04379960317460317*a+.0429211791776896*u+.03255384637546096*h,d=.01294022817460318*a+.02668104344536636*u+.03155651254609588*
h,f=.00659454790965208*u+.0163075268674227*h,k=.003463473736911237*h,m=Math.cos(2*g);return g+Math.sin(2*g)*(.5*e+.2083333333333333*v+.08333333333333333*p+.03611111111111111*r+.01875*a+.01195601851851852*u+.008863673941798942*h-b+d-k+m*(2*(.1458333333333333*v+.1208333333333333*p+.07039930555555556*r+.03616071428571429*a+.01839451058201058*u+.01017113095238095*h)-4*A+6*f+m*(4*b-12*d+24*k+m*(8*A-32*f+m*(16*d-80*k+m*(32*f+64*m*k))))))}for(var p=Math.sqrt(e),r=p/2,u=Math.tan(.7853981633974483+g/2),b=
0,A=1,v=g;0!=A;v=h)if(a=p*Math.sin(v),h=u*Math.pow((1+a)/(1-a),r),h=2*Math.atan(h)-1.570796326794897,b++,c.S(h,v)||3E4<b)A=0;return v};return h}();a.u=b})(B||(B={}));(function(a){var c=function(){function c(){}c.Fb=function(h,e,g,n,c,b,A,d){if(null!=b||null!=A||null!=d){n=a.u.W(n);e=a.u.W(e);g=a.u.W(g);c=a.u.W(c);1.570796326794897<a.j.H(g)&&(g=a.j.nb(3.141592653589793,g)-g,e=a.u.W(e+3.141592653589793));1.570796326794897<a.j.H(c)&&(c=a.j.nb(3.141592653589793,c)-c,n=a.u.W(n+3.141592653589793));var y=
a.u.W(n-e);if(a.j.S(g,c)&&(a.j.S(e,n)||a.j.S(a.j.H(g),1.570796326794897)))null!=b&&(b.l=0),null!=A&&(A.l=0),null!=d&&(d.l=0);else{if(a.j.S(g,-c)){if(a.j.S(a.j.H(g),1.570796326794897)){null!=b&&(b.l=3.141592653589793*h);null!=A&&(A.l=0<g?a.u.W(3.141592653589793-a.u.W(n)):a.u.W(n));null!=d&&(d.l=0<g?a.u.W(n):a.u.W(3.141592653589793-a.u.W(n)));return}if(a.j.S(a.j.H(y),3.141592653589793)){null!=b&&(b.l=3.141592653589793*h);null!=A&&(A.l=0);null!=d&&(d.l=0);return}}var F=1.570796326794897==a.j.H(g)?0:
Math.cos(g),N=Math.sin(g),f=1.570796326794897==a.j.H(c)?0:Math.cos(c),k=Math.sin(c),m=1.570796326794897==a.j.H(y)?0:Math.cos(y),p=3.141592653589793==a.j.H(y)?0:Math.sin(y);if(null!=b){var U=Math.sin((c-g)/2),y=Math.sin(y/2);b.l=2*Math.asin(Math.sqrt(U*U+F*f*y*y))*h}null!=A&&(a.j.S(a.j.H(g),1.570796326794897)?A.l=0>g?n:a.u.W(3.141592653589793-n):A.l=Math.atan2(f*p,F*k-N*f*m));null!=d&&(a.j.S(a.j.H(c),1.570796326794897)?d.l=0>c?e:a.u.W(3.141592653589793-e):(d.l=Math.atan2(F*p,k*F*m-f*N),d.l=a.u.W(d.l+
3.141592653589793)))}}};c.gf=function(h,e,g,n,c,b,A){if(null!=b||null!=A){e=a.u.W(e);g=a.u.W(g);1.570796326794897<a.j.H(g)&&(g=a.j.nb(3.141592653589793,g)-g,e=a.u.W(e+3.141592653589793));a.j.S(a.j.H(g),1.570796326794897)&&(e=0);c=a.u.W(c);var y=a.j.S(a.j.H(c),1.570796326794897)?0:Math.cos(c),F=a.j.S(a.j.H(c),3.141592653589793)?0:Math.sin(c),d=a.j.S(a.j.H(g),1.570796326794897)?0:Math.cos(g),N=Math.sin(g);h=n/h;n=a.j.S(a.j.H(h),1.570796326794897)?0:Math.cos(h);var f=a.j.S(a.j.H(h),3.141592653589793)?
0:Math.sin(h),k=Math.asin(N*n+d*f*y);null!=A&&(A.l=k);null!=b&&(b.l=a.j.S(a.j.H(k),1.570796326794897)?a.j.S(g,-k)?0>k?c:a.u.W(3.141592653589793-c):e:a.j.S(a.j.H(g),1.570796326794897)&&a.j.S(h,3.141592653589793)?0>g?c:a.u.W(3.141592653589793-c):a.u.W(e+Math.atan2(f*F,d*n-N*f*y)))}};return c}();a.zg=c})(B||(B={}));(function(a){var c=function(){function c(){}c.Fb=function(h,e,g,n,c,b,A,d,f){var y=new a.ca(0),F=new a.ca(0),N=[0,0,0],k=[0,0,0],m=[0,0,0],Y=new a.ca(0),p=new a.ca(0),r=new a.ca(0),U=new a.ca(0),
u=new a.ca(0);if(null!=A||null!=d||null!=f)if(a.j.Ih(e))a.zg.Fb(h,g,n,c,b,A,d,f);else{c=a.u.W(c);g=a.u.W(g);var v=a.u.W(c-g);if(a.j.S(n,b)&&(a.j.S(g,c)||a.j.S(a.j.H(n),1.570796326794897)))null!=A&&(A.l=0),null!=d&&(d.l=0),null!=f&&(f.l=0);else{if(a.j.S(n,-b)){if(a.j.S(a.j.H(n),1.570796326794897)){null!=A&&(A.l=2*a.u.gg(h,e));null!=d&&(d.l=0<n?a.u.W(3.141592653589793-a.u.W(c)):a.u.W(c));null!=f&&(f.l=0<n?a.u.W(c):a.u.W(3.141592653589793-a.u.W(c)));return}a.j.S(a.j.H(v),3.141592653589793)&&(null!=A&&
(A.l=2*a.u.gg(h,e)),null!=d&&(d.l=0),null!=f&&(f.l=0))}else if(a.j.S(a.j.H(n),1.570796326794897)||a.j.S(a.j.H(b),1.570796326794897))a.j.S(a.j.H(n),1.570796326794897)?g=c:c=g;var q=0,x;0>v&&(q=1,x=g,g=c,c=x,x=n,n=b,b=x);var v=a.u.sr(e,n),D=a.u.sr(e,b);if(null!=d||null!=f)a.zg.Fb(h,g,v,c,D,null,y,F),y=Math.atan2(Math.sin(y.l)*Math.cos(n-v),Math.cos(y.l)),F=Math.atan2(Math.sin(F.l)*Math.cos(b-D),Math.cos(F.l)),0!=q&&(x=y,y=F,F=x),null!=d&&(d.l=y),null!=f&&(f.l=F);null!=A&&(a.u.wm(e,n,g,r,U,u),N[0]=r.l,
N[1]=U.l,N[2]=u.l,a.u.wm(e,b,c,r,U,u),k[0]=r.l,k[1]=U.l,k[2]=u.l,m[0]=N[1]*k[2]-k[1]*N[2],m[1]=-(N[0]*k[2]-k[0]*N[2]),m[2]=N[0]*k[1]-k[0]*N[1],e=1-a.u.Tk(e,a.u.Dp(e,a.u.Si(e,Math.acos(m[2]/Math.sqrt(m[0]*m[0]+m[1]*m[1]+m[2]*m[2]))))),e*=2-e,d=Math.atan2(-m[1],-m[0]),m=a.u.W(d-1.570796326794897),d=a.u.W(d+1.570796326794897),m=a.j.H(a.u.W(g-m))<=a.j.H(a.u.W(g-d))?m:d,a.zg.Fb(1,m,0,g,v,Y,null,null),a.zg.Fb(1,m,0,c,D,p,null,null),3.141592653589793<Y.l+p.l&&(m=a.u.W(m+3.141592653589793),a.zg.Fb(1,m,0,
g,v,Y,null,null),a.zg.Fb(1,m,0,c,D,p,null,null)),Y.l*=a.j.nb(1,n),p.l*=a.j.nb(1,b),Y.l=a.u.Si(e,Y.l),p.l=a.u.Si(e,p.l),g=a.u.q(h,e,Y.l),h=a.u.q(h,e,p.l),A.l=a.j.H(h-g))}}};c.gf=function(h,e,g,n,c,b,A,d){var y=0,F=new a.ca(0),N=new a.ca(0),f=[0,0,0],k=[0,0,0],m=new a.ca(0),p=new a.ca(0),r=new a.ca(0);if(null!=A||null!=d)if(a.j.Ih(e))a.zg.gf(h,g,n,c,b,A,d);else if(a.j.Vc(c))null!=A&&(A.l=g),null!=d&&(d.l=n);else{b=a.u.W(b);0>c&&(c=a.j.H(c),b=a.u.W(b+3.141592653589793));g=a.u.W(g);n=a.u.W(n);1.570796326794897<
a.j.H(n)&&(g=a.u.W(g+3.141592653589793),n=a.j.nb(3.141592653589793,n)-n);a.j.S(a.j.H(n),1.570796326794897)&&(g=0);var U;if(a.j.Vc(n))U=a.j.H(1.570796326794897-a.j.H(b)),U=a.u.Si(e,U),U=1-a.u.Tk(e,a.u.Dp(e,U)),U*=2-U,h=c/a.u.gg(h,U)*1.570796326794897,h=a.u.xn(U,h),h=a.u.sr(U,h),a.zg.gf(1,g,n,h,b,A,F),null!=d&&(y=F.l),null!=d&&(d.l=a.u.Si(e,y));else if(a.j.S(a.j.H(n),1.570796326794897))y=a.u.gg(h,e),F=2*y,h=a.j.nb(1.570796326794897,n),b=0<h?a.u.W(3.141592653589793-b):b,n=y-c,a.j.H(n)<=y?null!=A&&(A.l=
b):(n=Math.floor(c/F),0==a.I.truncate(n%2)?(null!=A&&(A.l=b),n=y-(c-n*F)):(null!=A&&(A.l=a.u.W(b+3.141592653589793)),n=y-((n+1)*F-c))),null!=d&&(d.l=a.u.xn(e,n/y*h));else{U=a.u.sr(e,n);b=Math.atan2(Math.sin(b),Math.cos(b)*Math.cos(n-U));var u=a.I.truncate(a.j.nb(1,U))*(1.570796326794897>=a.j.H(b)?1:-1);b=a.u.W(g+Math.atan(Math.tan(b)*-Math.sin(U)));a.zg.Fb(h,b,0,g,U,null,N,null);U=a.j.H(1.570796326794897-a.j.H(N.l));U=a.u.Si(e,U);U=1-a.u.Tk(e,a.u.Dp(e,U));U*=2-U;a.u.wm(e,0,b,m,p,r);f[0]=m.l;f[1]=
p.l;f[2]=r.l;a.u.wm(e,n,g,m,p,r);k[0]=m.l;k[1]=p.l;k[2]=r.l;n=Math.acos((f[0]*k[0]+f[1]*k[1]+f[2]*k[2])/Math.sqrt(k[0]*k[0]+k[1]*k[1]+k[2]*k[2]));n=a.u.Si(U,n);n=a.u.q(h,U,n)+c*u;c=0<n?N.l:a.u.W(N.l+3.141592653589793);h=a.j.H(n)/a.u.gg(h,U)*1.570796326794897;h=a.u.xn(U,h);h=a.u.sr(U,h);a.zg.gf(1,b,0,h,c,A,F);null!=d&&(y=F.l);null!=d&&(d.l=a.u.Si(e,y))}}};return c}();a.Xj=c})(B||(B={}));(function(a){var c=function(){function c(){}c.Fb=function(h,e,g,n,c,b,A,d,f){var y=0,F=0,N=0;if(null!=A||null!=d||
null!=f)if(a.j.Ih(e))a.zg.Fb(h,g,n,c,b,A,d,f);else{var k=a.u.W(c-g);if(a.j.S(n,b)&&(a.j.Vc(k)||a.j.S(a.j.H(n),1.570796326794897)))null!=A&&(A.l=0),null!=d&&(d.l=0),null!=f&&(f.l=0);else{if(a.j.S(n,-b)){if(a.j.S(a.j.H(n),1.570796326794897)){null!=A&&(A.l=2*a.u.gg(h,e));null!=d&&(d.l=0<n?a.u.W(3.141592653589793-a.u.W(c)):a.u.W(c));null!=f&&(f.l=0<n?a.u.W(c):a.u.W(3.141592653589793-a.u.W(c)));return}a.j.S(a.j.H(k),3.141592653589793)&&(null!=A&&(A.l=2*a.u.gg(h,e)),null!=d&&(d.l=0),null!=f&&(f.l=0))}else{if(a.j.S(a.j.H(n),
1.570796326794897)||a.j.S(a.j.H(b),1.570796326794897)){a.Xj.Fb(h,e,g,n,c,b,A,d,f);return}if(a.j.Vc(k)||a.j.S(a.j.H(k),3.141592653589793)){a.Xj.Fb(h,e,g,n,c,b,A,d,f);return}}var m=1-Math.sqrt(1-e),p=e/(1-e),Y=h*(1-m);h=a.u.Dp(e,n);var r=a.u.Dp(e,b);e=1.570796326794897==a.j.H(h)?0:Math.cos(h);var U=Math.sin(h),u=1.570796326794897==a.j.H(r)?0:Math.cos(r),v=Math.sin(r),q=k,x=Math.cos(q),D=Math.sin(q),B=1,t=0,z,l,C,S,E;do{z=q;l=Math.sqrt(Math.pow(u*D,2)+Math.pow(e*v-U*u*x,2));C=U*v+e*u*x;S=Math.atan2(l,
C);if(0==l){B=0;break}E=e*u*D/l;y=Math.cos(Math.asin(E));y*=y;F=C-2*U*v/y;1<a.j.H(F)&&(F=a.j.nb(1,F));N=F*F;q=m/16*y*(4+m*(4-3*y));q=k+(1-q)*m*E*(S+q*l*(F+q*C*(2*N-1)));x=Math.cos(q);D=Math.sin(q);t++;if(3.141592653589793<a.j.H(q)&&30<t){B=0;break}}while(5E3>=t&&!a.j.S(z,q));if(0!=B)p*=y,m=p*(256+p*(-128+p*(74-47*p)))/1024,null!=A&&(A.l=Y*(1+p*(4096+p*(-768+p*(320-175*p)))/16384)*(S-m*l*(F+m/4*(C*(2*N-1)-m/6*F*(4*l*l-3)*(4*N-3))))),null!=d&&(a.j.S(a.j.H(n),1.570796326794897)?d.l=0>n?c:a.u.W(3.141592653589793-
c):d.l=Math.atan2(u*D,e*v-U*u*x)),null!=f&&(a.j.S(a.j.H(b),1.570796326794897)?f.l=0>b?g:a.u.W(3.141592653589793-g):(f.l=Math.atan2(e*D,e*v*x-U*u),f.l=a.u.W(f.l+3.141592653589793)));else{q=a.j.nb(3.141592653589793,k);C=U*v-e*u;S=Math.acos(C);l=Math.sin(S);y=1;t=E=0;do N=E,y*=y,x=y*y,E=m*y*(1+m+m*m),F=m*m*x*(1+2.25*m),B=m*m*m*x*y,x=1-.25*E+.1875*F-.1953125*B,E=.25*E-.25*F+.29296875*B,D=.03125*F-.05859375*B,B*=.00651041666666667,F=C-2*U*v/y,1<a.j.H(F)&&(F=a.j.nb(1,F)),y=Math.acos(F),C=Math.cos(2*y),
z=Math.cos(3*y),E=a.j.S(n,-b)?a.u.W(3.141592653589793-k)/(3.141592653589793*m*x):a.u.W(q-k)/(m*(x*S+E*l*F+D*Math.sin(2*S)*C+B*Math.sin(3*S)*z)),D=E*l/(e*u),q=1.570796326794897<a.j.H(k)?a.j.nb(3.141592653589793,D)-Math.asin(D):Math.asin(D),x=Math.cos(q),l=Math.sqrt(Math.pow(u*D,2)+Math.pow(e*v-U*u*x,2)),S=3.141592653589793-Math.asin(a.j.H(l)),C=Math.cos(S),y=Math.cos(Math.asin(E)),t++;while(70>=t&&!a.j.S(N,E));null!=A&&(y*=y,p*=y,x=1+p*(4096+p*(-768+p*(320-175*p)))/16384,a.j.S(n,-b)?A.l=3.141592653589793*
Y*x:(F=C-2*U*v/y,y=Math.acos(F),C=Math.cos(2*y),z=Math.cos(3*y),A.l=Y*(x*S+p*(-512+p*(128+p*(-60+35*p)))/2048*l*F+p*(-4+5*p)/6144*p*p*Math.sin(2*S)*C+B*Math.sin(3*S)*z+-7.62939453125E-5*p*p*p*p*Math.sin(4*S)*Math.cos(4*y))));null!=d&&(a.j.Vc(n)&&a.j.Vc(b)?(y=Math.sqrt(1-E*E),d.l=Math.acos(y),0>k&&(d.l*=-1)):a.j.S(a.j.H(n),1.570796326794897)?d.l=0>n?c:a.u.W(3.141592653589793-c):(A=E/e,Y=Math.sqrt(1-A*A),0>e*v-U*u*Math.cos(q)&&(Y*=-1),d.l=Math.atan2(A,Y),a.j.S(n,-b)&&a.j.H(a.u.W(g-c))>3.141592653589793*
(1-m*Math.cos(n))&&(0<n&&1.570796326794897>a.j.H(d.l)||0>n&&1.570796326794897<a.j.H(d.l))&&(d.l=a.j.nb(3.141592653589793,d.l)-d.l)));if(null!=f)if(a.j.Vc(n)&&a.j.Vc(b))y=Math.sqrt(1-E*E),f.l=Math.acos(y),0<=k&&(f.l*=-1);else if(a.j.S(a.j.H(b),1.570796326794897))f.l=0>b?g:a.u.W(3.141592653589793-g);else if(k=E/u,A=Math.sqrt(1-k*k),Y=Math.sin(q/2),0>Math.sin(r-h)-2*e*v*Y*Y&&(A*=-1),f.l=Math.atan2(k,A),f.l=a.u.W(f.l+3.141592653589793),a.j.S(n,-b)&&!a.j.Vc(n)&&!a.j.S(a.j.H(n),1.570796326794897)&&a.j.H(a.u.W(g-
c))>3.141592653589793*(1-m*Math.cos(n))&&(null!=d?Y=d.l:(A=E/e,Y=Math.sqrt(1-A*A),0>e*v-U*u*Math.cos(q)&&(Y*=-1),Y=Math.atan2(A,Y),a.j.S(n,-b)&&a.j.H(a.u.W(g-c))>3.141592653589793*(1-m*Math.cos(n))&&(0<n&&1.570796326794897>a.j.H(Y)||0>n&&1.570796326794897<a.j.H(Y))&&(Y=a.j.nb(3.141592653589793,Y)-Y)),1.570796326794897>=a.j.H(Y)&&1.570796326794897<a.j.H(f.l)||1.570796326794897<=a.j.H(Y)&&1.570796326794897>a.j.H(f.l)))f.l=-1*a.u.W(f.l+3.141592653589793)}}}};c.gf=function(h,e,g,n,c,b,A,d){if(null!=A||
null!=d)if(a.j.Ih(e))a.zg.gf(h,g,n,c,b,A,d);else if(b=a.u.W(b),a.j.S(a.j.H(n),1.570796326794897)||a.j.Vc(b)||a.j.S(a.j.H(b),3.141592653589793))a.Xj.gf(h,e,g,n,c,b,A,d);else{var y=1.570796326794897==a.j.H(b)?0:Math.cos(b),F=3.141592653589793==a.j.H(b)?0:Math.sin(b);a.j.S(a.j.H(n),1.570796326794897)&&(g=0);b=1-Math.sqrt(1-e);var N=a.u.Dp(e,n);n=1.570796326794897==a.j.H(N)?0:Math.cos(N);var f=Math.sin(N),N=Math.atan2(Math.tan(N),y),k=n*F,m=k*k,p=1-m,r=e/(1-e)*p;e=r*(256+r*(-128+r*(74-47*r)))/1024;var U=
e/4,u=e/6,v=c/(h*(1-b)*(1+r*(4096+r*(-768+r*(320-175*r)))/16384)),q=v,x;do{x=q;c=1.570796326794897==a.j.H(q)?0:Math.cos(q);var r=3.141592653589793==a.j.H(q)?0:Math.sin(q),D=r*r;h=Math.cos(2*N+q);q=h*h;q=e*r*(h+U*(c*(2*q-1)-u*h*(4*D-3)*(4*q-3)))+v}while(!a.j.S(x,q));c=1.570796326794897==a.j.H(q)?0:Math.cos(q);r=3.141592653589793==a.j.H(q)?0:Math.sin(q);null!=A&&(F=Math.atan2(r*F,n*c-f*r*y),p=b/16*p*(4+b*(4-3*p)),h=Math.cos(2*N+q),A.l=a.u.W(g+(F-(1-p)*b*k*(q+p*r*(h+p*c*(2*h*h-1))))));null!=d&&(p=f*
r-n*c*y,p=(1-b)*Math.sqrt(m+p*p),d.l=Math.atan2(f*c+n*r*y,p))}};return c}();a.cs=c})(B||(B={}));(function(a){var c=function(){function c(){}c.Fb=function(h,e,g,n,c,b,d,A,f){var y=a.u.W(c-g),F=a.j.S(a.j.H(n),1.570796326794897),N=a.j.S(a.j.H(b),1.570796326794897);if(a.j.S(n,b)&&(a.j.Vc(y)||F))null!=d&&(d.l=0),null!=A&&(A.l=0),null!=f&&(f.l=0);else{var k,m;a.j.Ih(e)?(k=Math.sin(n),m=Math.sin(b),k=Math.sqrt((1+k)/(1-k)),m=Math.sqrt((1+m)/(1-m)),k=Math.log(m)-Math.log(k),k=Math.atan2(y,k),null!=d&&(d.l=
a.j.S(n,b)?a.j.H(h*Math.cos(n)*y):a.j.H((h*b-h*n)/Math.cos(k)))):(m=a.u.qu(e,b),k=Math.sin(a.u.qu(e,n)),m=Math.sin(m),k=Math.sqrt((1+k)/(1-k)),m=Math.sqrt((1+m)/(1-m)),k=Math.log(m)-Math.log(k),k=Math.atan2(y,k),null!=d&&(a.j.S(n,b)?d.l=a.j.H(h*y*Math.cos(n)/a.u.Tk(e,n)):(y=a.u.q(h,e,n),h=a.u.q(h,e,b),d.l=a.j.H((h-y)/Math.cos(k)))));if(null!=A||null!=f)d=a.u.W(k+3.141592653589793),F&&N||!F&&!N||(F?k=0>n?c:a.u.W(3.141592653589793-c):N&&(d=0>b?g:a.u.W(3.141592653589793-g))),null!=A&&(A.l=k),null!=f&&
(f.l=d)}};c.gf=function(h,e,g,n,c,b,d,A){b=a.u.W(b);0>c&&(c=a.j.H(c),b=a.u.W(b+3.141592653589793));a.j.Ih(e)?a.j.S(a.j.H(n),1.570796326794897)?(g=0>n?b:a.u.W(3.141592653589793-b),b=c/h%6.283185307179586,3.141592653589793>=b?h=n-a.j.nb(b,n):(g=a.u.W(g+3.141592653589793),h=-n+a.j.nb(b-3.141592653589793,n))):a.j.S(a.j.H(b),1.570796326794897)?(g=a.u.W(g+a.j.nb(c,b)/(h*Math.cos(n))),h=n):(h=n+c*Math.cos(b)/h,1.570796326794897<a.j.H(h)&&(h=1.570796326794897),a.j.S(a.j.H(h),1.570796326794897)&&(a.j.Vc(b)||
a.j.S(a.j.H(b),3.141592653589793))||(1.570796316258184<a.j.H(h)&&(h=a.j.nb(1.570796316258184,h)),e=Math.sin(n),n=Math.sin(h),e=Math.sqrt((1+e)/(1-e)),n=Math.sqrt((1+n)/(1-n)),e=Math.log(n)-Math.log(e),g=a.u.W(g+Math.tan(b)*e))):a.j.S(a.j.H(n),1.570796326794897)?(g=0>n?b:a.u.W(3.141592653589793-b),b=c/a.u.nR(h,e),b%=6.283185307179586,3.141592653589793>=b?(h=n-a.j.nb(b,n),h=a.u.xn(e,h)):(g=a.u.W(g+3.141592653589793),h=-n+a.j.nb(b-3.141592653589793,n),h=a.u.xn(e,h))):a.j.S(a.j.H(b),1.570796326794897)?
(g=a.u.W(g+a.j.nb(c,b)*a.u.Tk(e,n)/(h*Math.cos(n))),h=n):(h=1.570796326794897*(c*Math.cos(b)+a.u.q(h,e,n))/a.u.gg(h,e),1.570796326794897<a.j.H(h)&&(h=a.j.nb(1.570796326794897,h)),h=a.u.xn(e,h),a.j.S(a.j.H(h),1.570796326794897)&&(a.j.Vc(b)||a.j.S(a.j.H(b),3.141592653589793))||(c=a.u.qu(e,n),n=a.u.qu(e,h),1.570796316258184<a.j.H(n)&&(n=a.j.nb(1.570796316258184,h),h=a.u.$K(e,n)),e=Math.sin(c),n=Math.sin(n),e=Math.sqrt((1+e)/(1-e)),n=Math.sqrt((1+n)/(1-n)),e=Math.log(n)-Math.log(e),g=a.u.W(g+Math.tan(b)*
e)));null!=d&&(d.l=g);null!=A&&(A.l=h)};return c}();a.Zz=c})(B||(B={}));(function(a){var c=function(){function c(){}c.gw=function(h,e,g,n,c,b,d){a.cs.Fb(h,e,g,n,c,b,null,d,null)};c.Ph=function(h,e,g,n,c,b,d,A){a.cs.gf(h,e,g,n,c,b,d,A)};c.Rd=function(h,e,g,n,c,b,d,A,f,k){switch(k){case 2:a.Xj.Fb(h,e,g,n,c,b,d,A,f);break;case 3:a.$z.Fb(h,e,g,n,c,b,d,A,f);break;case 1:a.Zz.Fb(h,e,g,n,c,b,d,A,f);break;default:a.cs.Fb(h,e,g,n,c,b,d,A,f)}};c.dk=function(h,e,g,n,c,b,d,A,f){switch(f){case 2:a.Xj.gf(h,e,g,
n,c,b,d,A);break;case 3:a.$z.gf(h,e,g,n,c,b,d,A);break;case 1:a.Zz.gf(h,e,g,n,c,b,d,A);break;default:a.cs.gf(h,e,g,n,c,b,d,A)}};return c}();a.zb=c})(B||(B={}));(function(a){var c=function(){function c(){}c.QS=function(h,e){var g=8;0>g&&(g=8);var n=[0,0,0,0],y=new a.b;y.J(e);y.scale(9102==a.Ya.Em(h).Se().Qc()?1:a.Ya.Em(h).Se().Dj/3.141592653589793*180);-180>y.x?(y.x-=y.x%360,-180>y.x&&(y.x+=360)):180<y.x&&(y.x-=y.x%360,180<y.x&&(y.x-=360));90<y.y&&(y.y=90);-90>y.y&&(y.y=-90);h=5*g;e=(h+31)/32;for(var b=
-180,d=180,A=h-1,f=e-1;0<=f;f--)for(var k=A-32*f,m=Math.min(32,h-32*f),p=1;p<m;p+=2){var r=.5*(d+b);y.x>=r?(n[f]|=1<<k,b=r):d=r;k-=2;A-=2}b=-90;d=90;A=h-2;for(f=e-1;0<=f;f--)for(k=A-32*f,m=Math.min(32,h-32*f),p=0;p<m;p+=2)r=.5*(d+b),y.y>=r?(n[f]|=1<<k,b=r):d=r,k-=2,A-=2;return c.XS(n,g,g)};c.XS=function(a,e,g){for(var h=[],c=0;c<e;c++)h[c]="";for(var b=c=0,d=0;d<e;d++){var A=a[c]>>b&31,b=b+5;if(31<b){var f=37-b,A=A&(1<<f)-1,b=b-32;c++;A|=(a[c]&(1<<b)-1)<<f}h[e-1-d]="0123456789bcdefghjkmnpqrstuvwxyz".split("")[A]}if(g>
e)for(d=0;d<g-e;d++)h.push("0");else g<e&&(h.length=g);return h.join("")};return c}();a.qH=c})(B||(B={}));(function(a){var c={gcstol:[0,1E-8,1,1.11111E-8,2,1.68845E-8,3,2.17661E-8,4,2.22508E-8,5,2.34848E-8,6,2.37811E-8,7,2.88455E-8,8,3.1456E-8,9,3.29779E-8,10,3.66789E-8,11,4.23597E-8,12,4.79463E-8,13,6.45223E-8,14,7.26274E-8,15,7.49945E-8,16,7.52506E-8,17,7.97991E-8,18,9.66202E-8,19,9.79918E-8,20,9.89735E-8,21,1.02314E-7,22,1.08146E-7,23,2.29734E-7,24,2.42985E-7,25,2.7546E-7,26,3.37034E-7,27,4.30795E-7,
28,5.20871E-7,29,5.50921E-7,30,6.74068E-7,31,6.86177E-7,32,7.25263E-7,33,7.44101E-7,34,7.74267E-7,35,9.62954E-7,36,1.06103E-6,37,1.14363E-6,38,1.16219E-6,39,1.36419E-6,40,1.36744E-6,41,1.43239E-6,42,1.73624E-6,43,1.84825E-6,44,1.90986E-6,45,1.97572E-6,46,2.12207E-6,47,2.72837E-6,48,3.1831E-6,49,3.58099E-6,50,3.81972E-6,51,4.09256E-6,52,4.40737E-6,53,4.77465E-6,54,5.16178E-6,55,5.20871E-6,56,5.72958E-6,57,6.03113E-6,58,6.98729E-6,59,9.24125E-6,60,1.14592E-5],pcstol:[0,6.66667E-9,1,2E-8,2,4.97098E-5,
3,.001,4,.00109362,5,.00328087,6,.00497101],newtoold:[2154,102110,2195,102200,2204,32036,2205,26979,2225,102641,2226,102642,2227,102643,2228,102644,2229,102645,2230,102646,2231,102653,2232,102654,2233,102655,2234,102656,2235,102657,2236,102658,2237,102659,2238,102660,2239,102666,2240,102667,2241,102668,2242,102669,2243,102670,2246,102679,2247,102680,2248,102685,2249,102686,2250,102687,2254,102694,2255,102695,2257,102712,2258,102713,2259,102714,2260,102715,2261,102716,2262,102717,2263,102718,2264,
102719,2267,102724,2268,102725,2271,102728,2272,102729,2274,102736,2275,102737,2276,102738,2277,102739,2278,102740,2279,102741,2283,102746,2284,102747,2285,102748,2286,102749,2287,102752,2288,102753,2289,102754,2312,23433,2326,102140,2395,2091,2396,2092,2397,2166,2398,2167,2399,2168,2759,102229,2760,102230,2761,102248,2762,102249,2763,102250,2764,102251,2765,102252,2766,102241,2767,102242,2768,102243,2769,102244,2770,102245,2771,102246,2772,102253,2773,102254,2774,102255,2775,102256,2776,102257,2777,
102258,2778,102259,2779,102260,2780,102266,2781,102267,2782,102261,2783,102262,2784,102263,2785,102264,2786,102265,2787,102268,2788,102269,2789,102270,2790,102271,2791,102272,2792,102273,2793,102274,2794,102275,2795,102276,2796,102277,2797,102278,2798,102279,2799,102280,2800,102281,2801,102282,2802,102283,2803,102284,2804,102285,2805,102286,2806,102287,2807,102288,2808,102289,2809,102290,2810,102291,2811,102292,2812,102293,2813,102294,2814,102295,2815,102296,2816,102297,2817,102298,2818,102300,2819,
102304,2820,102307,2821,102308,2822,102309,2823,102310,2824,102311,2825,102312,2826,102313,2827,102314,2828,102315,2829,102316,2830,102317,2831,102318,2832,102320,2833,102321,2834,102322,2835,102323,2836,102324,2837,102325,2838,102326,2839,102327,2840,102330,2841,102334,2842,102335,2843,102336,2844,102337,2845,102338,2846,102339,2847,102340,2848,102341,2849,102342,2850,102343,2851,102344,2852,102345,2853,102346,2854,102347,2855,102348,2856,102349,2857,102350,2858,102351,2859,102352,2860,102353,2861,
102354,2862,102355,2863,102356,2864,102357,2865,102358,2866,102361,2942,102167,2943,102169,2944,2139,2945,2140,2946,2141,2947,2142,2948,2143,2949,2144,2950,2145,2951,2146,2952,2147,2953,2036,2954,2291,2955,2153,2956,2152,2957,2151,2958,2150,2959,2149,2960,2037,2961,2038,2962,2148,2965,2244,2966,2245,3003,102091,3004,102092,3005,102190,3060,2982,3067,102139,3072,102606,3074,102608,3075,102208,3077,102210,3078,102123,3080,102119,3081,102603,3082,102602,3083,102601,3088,65163,3089,102763,3090,102363,
3092,102151,3093,102152,3094,102153,3095,102154,3096,102155,3097,102145,3098,102146,3099,102147,3100,102148,3101,102149,3102,2155,3107,102172,3110,102170,3111,102171,3119,2214,3158,102234,3159,102235,3160,102236,3336,2979,3338,102006,3346,2600,3370,102126,3371,102127,3372,102130,3373,102131,3400,102184,3401,102185,3404,3359,3407,3366,3417,102675,3418,102676,3419,102677,3420,102678,3421,102707,3422,102708,3423,102709,3424,102711,3433,102651,3434,102652,3435,102671,3436,102672,3437,102710,3438,102730,
3448,102095,3451,102681,3452,102682,3455,102735,3461,2063,3462,2064,3463,3073,3464,3076,3560,102742,3566,102743,3567,102744,3734,102722,3735,102723,3736,102755,3737,102756,3738,102757,3739,102758,3741,102205,3742,102206,3743,102207,3748,102211,3750,102202,3751,102203,3759,102663,3760,102463,3764,102112,3770,102090,3771,102180,3772,102181,3773,102182,3775,102186,3776,102187,3777,102188,3800,102183,3801,102189,3812,102199,3814,102609,3815,102469,3819,104990,3821,104136,3824,104137,3825,102444,3826,
102443,3827,102442,3828,102441,3857,102100,3889,104991,3906,104992,4048,103201,4049,103202,4050,103203,4051,103204,4056,103205,4057,103206,4058,103207,4059,103208,4060,103209,4061,103210,4062,103211,4063,103212,4071,103213,4082,103214,4083,103215,4093,103216,4094,103217,4095,103218,4096,103219,4167,104108,4169,37252,4171,104107,4189,104110,4197,4234,4223,37223,4304,104304,4414,102201,4415,102762,4417,102764,4434,102765,4437,102647,4455,32029,4456,32018,4457,3454,4462,102439,4463,4466,4470,4469,4484,
103794,4485,103795,4486,103796,4487,103797,4488,103798,4489,103799,4611,104104,4612,104111,4613,37255,4615,37247,4616,37250,4617,4140,4618,4291,4620,37211,4626,37235,4647,102362,4658,37204,4668,37201,4669,4126,4672,37217,4673,104125,4675,37220,4684,37232,4698,4631,4707,37213,4708,37231,4709,37212,4710,37238,4711,37214,4712,37237,4713,37208,4714,37215,4715,37253,4716,37216,4717,37239,4719,37219,4722,37242,4724,37233,4725,37222,4727,37224,4728,37246,4729,37226,4730,37227,4731,37228,4732,37229,4733,
37230,4734,37251,4735,37259,4736,37254,4739,37205,4758,104133,4760,37001,4762,104114,4826,102214,5013,104142,5014,102331,5015,102332,5016,102333,5173,102085,5174,102086,5175,102087,5176,102088,5177,102089,5178,102040,5179,102080,5185,102081,5186,102082,5187,102083,5188,102084,5221,102066,5246,104100,5247,102490,5324,104144,5325,102420,5329,2934,5365,104143,5367,102305,5451,104132,5513,102065,5514,102067,5519,102111,5520,31461,5646,102745,5839,5388,5858,5532,5879,4474,21896,21891,21897,21892,21898,
21893,21899,21894,26701,102124,26702,102125,26799,26747,26847,102683,26848,102684,26849,102691,26850,102692,26851,102693,26852,102704,26853,102750,26854,102751,26857,102466,26858,102467,26859,102468,26901,102128,26902,102129,27493,27492,29101,29100,29168,29118,29169,29119,29170,29120,29171,29121,29172,29122,29187,29177,29188,29178,29189,29179,29190,29180,29191,29181,29192,29182,29193,29183,29194,29184,29195,29185,29902,29900,31279,31278,31281,31291,31282,31292,31283,31293,31284,31294,31285,31295,
31286,31296,31287,31297,31466,31462,31467,31463,31468,31464,31469,31465,31986,31917,31987,31918,31988,31919,31989,31920,31990,31921,31991,31922,32064,32074,32065,32075,32066,32076,32067,32077],pcsid:[2066,6,2136,5,2155,5,2157,3,2158,3,2159,5,2160,5,2219,3,2220,3,2244,5,2245,5,2256,5,2265,5,2266,5,2269,5,2270,5,2273,5,2290,3,2291,3,2294,3,2295,3,2313,3,2314,5,2964,5,2967,5,2968,5,2991,3,2992,5,2993,3,2994,5,3073,3,3076,3,3079,3,3091,5,3106,3,3108,3,3109,3,3141,3,3142,3,3167,2,3337,3,3347,3,3348,3,
3359,5,3360,3,3361,5,3362,3,3363,5,3364,3,3365,5,3366,5,3402,3,3403,3,3405,3,3406,3,3439,3,3440,3,3447,3,3449,3,3450,3,3453,5,3454,5,3460,3,3479,5,3480,3,3481,5,3482,3,3483,5,3484,3,3485,5,3486,3,3487,5,3488,3,3489,3,3490,5,3491,3,3492,5,3493,3,3494,5,3495,3,3496,5,3497,3,3498,5,3499,3,3500,5,3501,3,3502,5,3503,3,3504,5,3505,3,3506,5,3507,3,3508,5,3509,3,3510,5,3511,3,3512,5,3513,3,3514,3,3515,5,3516,3,3517,5,3518,3,3519,5,3520,3,3521,5,3522,3,3523,5,3524,3,3525,5,3526,3,3527,5,3528,3,3529,5,3530,
3,3531,5,3532,3,3533,5,3534,3,3535,5,3536,3,3537,5,3538,3,3539,5,3540,3,3541,5,3542,3,3543,5,3544,3,3545,5,3546,3,3547,5,3548,3,3549,5,3550,3,3551,5,3552,3,3553,5,3582,5,3583,3,3584,5,3585,3,3586,5,3587,3,3588,5,3589,3,3590,5,3591,3,3592,3,3593,5,3598,5,3599,3,3600,5,3605,5,3606,3,3607,3,3608,5,3609,3,3610,5,3611,3,3612,5,3613,3,3614,5,3615,3,3616,5,3617,3,3618,5,3619,3,3620,5,3621,3,3622,5,3623,3,3624,5,3625,3,3626,5,3627,3,3628,5,3629,3,3630,5,3631,3,3632,5,3633,3,3634,5,3635,3,3636,5,3640,5,3641,
3,3642,5,3643,3,3644,5,3645,3,3646,5,3647,3,3648,5,3649,3,3650,5,3651,3,3652,5,3653,3,3654,5,3655,3,3656,5,3657,3,3658,5,3659,3,3660,5,3661,3,3662,5,3663,3,3664,5,3668,5,3669,3,3670,5,3671,3,3672,5,3673,3,3674,5,3675,3,3676,5,3677,5,3678,3,3679,5,3680,5,3681,3,3682,5,3683,5,3684,3,3685,3,3686,5,3687,3,3688,5,3689,3,3690,5,3691,3,3692,5,3696,5,3697,3,3698,5,3699,3,3700,5,3740,3,3749,3,3783,3,3784,3,3793,3,3794,3,3802,3,3816,3,3829,3,3854,3,3920,3,3978,3,3979,3,3991,5,3992,5,4026,3,4037,3,4038,3,4217,
5,4438,5,4439,5,4467,3,4471,3,4474,3,4559,3,4839,3,5018,3,5048,3,5167,3,5168,3,5223,3,5234,3,5235,3,5243,3,5266,3,5316,3,5320,3,5321,3,5330,3,5331,3,5337,3,5361,3,5362,3,5382,3,5383,3,5396,3,5456,3,5457,3,5469,3,5472,4,5490,3,5518,3,5523,3,5559,3,5588,5,5589,5,5596,3,5627,3,5629,3,5641,3,5643,3,5644,3,5654,5,5655,5,5659,3,5700,3,5825,3,5836,3,5837,3,5842,3,5844,3,5880,3,5887,3,5890,3,20499,3,20538,3,20539,3,20790,3,20791,3,21291,3,21292,3,21500,3,21817,3,21818,3,22032,3,22033,3,22091,3,22092,3,22332,
3,22391,3,22392,3,22700,3,22770,3,22780,3,22832,3,23090,3,23095,3,23239,3,23240,3,23433,3,23700,3,24047,3,24048,3,24100,5,24200,3,24305,3,24306,3,24382,4,24383,3,24500,3,24547,3,24548,3,24571,2,24600,3,25E3,3,25231,3,25884,3,25932,3,26237,3,26331,3,26332,3,26591,3,26592,3,26632,3,26692,3,26855,5,26856,5,27120,3,27200,3,27291,4,27292,4,27429,3,27492,3,27500,3,27700,3,28232,3,28600,3,28991,3,28992,3,29100,3,29220,3,29221,3,29333,3,29635,3,29636,3,29701,3,29738,3,29739,3,29849,3,29850,3,29871,2,29872,
5,29873,3,29900,3,29901,3,29903,3,30200,6,30339,3,30340,3,30591,3,30592,3,30791,3,30792,3,31028,3,31121,3,31154,3,31170,3,31171,3,31370,3,31528,3,31529,3,31600,3,31700,3,31838,3,31839,3,31901,3,32061,3,32062,3,32098,3,32099,5,32100,3,32104,3,32161,3,32766,3,53034,3,53048,3,53049,3,54034,3,65061,5,65062,5,65161,3,65163,3,102041,5,102064,4,102068,1,102069,0,102217,5,102218,3,102219,5,102220,5,102378,5,102379,5,102380,3,102381,5,102589,5,102599,5,102600,5,102604,5,102605,3,102606,3,102647,3,102704,5,
102705,5,102733,5,102761,5,102762,3,102763,5,102764,3,102765,3,102766,5,102970,5,102974,5,102993,3,102994,3,102995,5,102996,5,103015,3,103016,5,103017,3,103018,5,103025,3,103026,3,103027,5,103028,5,103035,3,103036,3,103037,5,103038,5,103039,3,103040,3,103041,5,103042,5,103043,3,103044,3,103045,5,103046,5,103047,3,103048,3,103049,5,103050,5,103051,3,103052,5,103053,3,103054,5,103055,3,103056,5,103057,3,103058,3,103059,5,103060,5,103061,3,103062,3,103063,5,103064,5,103069,5,103070,3,103071,3,103072,
5,103073,5,103086,3,103087,3,103088,5,103089,5,103094,5,103095,3,103096,5,103103,3,103104,5,103105,3,103106,5,103121,3,103122,5,103123,3,103124,3,103125,5,103126,5,103127,3,103128,3,103129,5,103130,5,103131,3,103132,3,103133,5,103134,5,103135,3,103136,3,103137,5,103138,5,103139,3,103140,5,103141,3,103142,5,103143,3,103144,5,103145,3,103146,5,103147,3,103148,3,103149,5,103150,5,103151,3,103152,5,103172,3,103173,5,103174,3,103175,3,103176,5,103177,5,103178,3,103179,3,103180,5,103181,5,103182,3,103183,
3,103184,5,103185,5,103228,3,103229,3,103230,5,103231,5,103250,3,103251,5,103252,3,103253,5,103260,3,103261,3,103262,5,103263,5,103270,3,103271,3,103272,5,103273,5,103274,3,103275,3,103276,5,103277,5,103278,3,103279,3,103280,5,103281,5,103282,3,103283,3,103284,5,103285,5,103286,3,103287,5,103288,3,103289,5,103290,3,103291,5,103292,3,103293,3,103294,5,103295,5,103296,3,103297,3,103298,5,103299,5,103376,5,103377,3,103378,3,103379,5,103380,5,103393,3,103394,3,103395,5,103396,5,103472,3,103473,5,103474,
3,103475,5,103482,3,103483,5,103484,3,103485,5,103500,3,103501,5,103502,3,103503,3,103504,5,103505,5,103506,3,103507,3,103508,5,103509,5,103510,3,103511,3,103512,5,103513,5,103514,3,103515,5,103516,3,103517,5,103518,3,103519,5,103520,3,103521,5,103522,3,103523,3,103524,5,103525,5,103526,3,103527,5,103561,5,103562,5,103563,3,103564,3,103565,5,103566,5,103567,3,103568,3,103569,5,103570,5,103585,5,103695,5],pcsidc:[[2E3,2045,3],[2056,2065,3],[2067,2135,3],[2137,2153,3],[2161,2170,3],[2172,2193,3],[2196,
2198,3],[2200,2203,3],[2206,2217,3],[2222,2224,5],[2251,2253,5],[2280,2282,5],[2308,2311,3],[2315,2325,3],[2327,2394,3],[2400,2462,3],[2523,2576,3],[2578,2693,3],[2695,2758,3],[2867,2888,5],[2891,2930,5],[2931,2941,3],[2969,2973,3],[2975,2982,3],[2984,2988,3],[2995,3002,3],[3006,3051,3],[3054,3059,3],[3061,3066,3],[3068,3071,3],[3084,3087,3],[3112,3118,3],[3120,3138,3],[3146,3151,3],[3153,3157,3],[3161,3166,3],[3168,3172,3],[3174,3203,3],[3294,3313,3],[3315,3335,3],[3339,3345,3],[3350,3358,3],[3367,
3369,3],[3374,3399,3],[3408,3416,3],[3425,3432,5],[3441,3446,5],[3456,3459,5],[3465,3478,3],[3554,3559,3],[3561,3565,5],[3568,3570,5],[3571,3581,3],[3594,3597,3],[3601,3604,3],[3637,3639,3],[3665,3667,3],[3693,3695,3],[3701,3727,3],[3728,3733,5],[3744,3747,3],[3753,3758,5],[3761,3763,3],[3765,3769,3],[3779,3781,3],[3788,3791,3],[3797,3799,3],[3832,3841,3],[3844,3852,3],[3873,3885,3],[3890,3893,3],[3907,3912,3],[3942,3950,3],[3968,3970,3],[3973,3976,3],[3986,3989,3],[3994,3997,3],[4399,4413,5],[4418,
4433,5],[4491,4554,3],[5069,5072,3],[5105,5130,3],[5180,5184,3],[5253,5259,3],[5269,5275,3],[5292,5311,3],[5343,5349,3],[5355,5357,3],[5387,5389,3],[5459,5463,3],[5479,5482,3],[5530,5539,3],[5550,5552,3],[5562,5583,3],[5623,5625,5],[5631,5639,3],[5649,5653,3],[5663,5680,3],[5682,5685,3],[5875,5877,3],[20002,20032,3],[20062,20092,3],[20135,20138,3],[20248,20258,3],[20348,20358,3],[20436,20440,3],[20822,20824,3],[20934,20936,3],[21035,21037,3],[21095,21097,3],[21148,21150,3],[21413,21423,3],[21473,
21483,3],[21780,21782,3],[21891,21894,3],[22171,22177,3],[22181,22187,3],[22191,22197,3],[22234,22236,3],[22521,22525,3],[22991,22994,3],[23028,23038,3],[23830,23853,3],[23866,23872,3],[23877,23884,3],[23886,23894,3],[23946,23948,3],[24311,24313,3],[24342,24347,3],[24370,24374,4],[24375,24381,3],[24718,24721,3],[24817,24821,3],[24877,24882,3],[24891,24893,3],[25391,25395,3],[25828,25838,3],[26191,26195,3],[26391,26393,3],[26703,26722,3],[26729,26760,5],[26766,26798,5],[26860,26870,5],[26891,26899,
3],[26903,26923,3],[26929,26946,3],[26948,26998,3],[27037,27040,3],[27205,27232,3],[27258,27260,3],[27391,27398,3],[27561,27564,3],[27571,27574,3],[27581,27584,3],[27591,27594,3],[28191,28193,3],[28348,28358,3],[28402,28432,3],[28462,28492,3],[29118,29122,3],[29177,29185,3],[30161,30179,3],[30491,30494,3],[30729,30732,3],[31251,31259,3],[31265,31268,3],[31275,31278,3],[31288,31297,3],[31461,31465,3],[31491,31495,3],[31917,31922,3],[31965,31985,3],[31992,32E3,3],[32001,32003,5],[32005,32031,5],[32033,
32060,5],[32074,32077,5],[32081,32086,3],[32107,32130,3],[32133,32158,3],[32164,32167,5],[32180,32199,3],[32201,32260,3],[32301,32360,3],[32601,32662,3],[32664,32667,5],[32701,32761,3],[53001,53004,3],[53008,53019,3],[53021,53032,3],[53042,53046,3],[54001,54004,3],[54008,54019,3],[54021,54032,3],[54042,54046,3],[54048,54053,3],[102001,102040,3],[102042,102063,3],[102065,102067,3],[102070,102112,3],[102114,102117,3],[102118,102121,5],[102122,102208,3],[102210,102216,3],[102221,102300,3],[102304,102377,
3],[102382,102388,3],[102389,102391,5],[102401,102444,3],[102450,102452,3],[102461,102468,5],[102469,102492,3],[102500,102519,5],[102530,102549,3],[102570,102588,3],[102590,102598,3],[102601,102603,3],[102608,102628,3],[102629,102646,5],[102648,102672,5],[102675,102700,5],[102701,102703,3],[102707,102730,5],[102735,102758,5],[102767,102798,3],[102962,102969,3],[102971,102973,3],[102975,102989,3],[102990,102992,5],[102997,103002,3],[103003,103008,5],[103009,103011,3],[103012,103014,5],[103019,103021,
3],[103022,103024,5],[103029,103031,3],[103032,103034,5],[103065,103068,3],[103074,103076,3],[103077,103079,5],[103080,103082,3],[103083,103085,5],[103090,103093,3],[103097,103099,3],[103100,103102,5],[103107,103109,3],[103110,103112,5],[103113,103116,3],[103117,103120,5],[103153,103157,3],[103158,103162,5],[103163,103165,3],[103166,103171,5],[103186,103188,3],[103189,103191,5],[103192,103195,3],[103196,103199,5],[103200,103224,3],[103225,103227,5],[103232,103237,3],[103238,103243,5],[103244,103246,
3],[103247,103249,5],[103254,103256,3],[103257,103259,5],[103264,103266,3],[103267,103269,5],[103300,103375,3],[103381,103383,3],[103384,103386,5],[103387,103389,3],[103390,103392,5],[103397,103399,3],[103400,103471,5],[103476,103478,3],[103479,103481,5],[103486,103488,3],[103489,103491,5],[103492,103495,3],[103496,103499,5],[103539,103543,3],[103544,103548,5],[103549,103551,3],[103552,103557,5],[103558,103560,3],[103571,103573,3],[103574,103576,5],[103577,103580,3],[103581,103583,5],[103600,103694,
3],[103700,103793,5],[103794,103799,3]],gcsid:[4042,0,4075,0,4081,0,4168,0,4170,0,4188,0,4261,1,4262,0,4263,0,4288,0,4289,0,4305,1,4322,0,4324,0,4326,0,4466,0,4469,0,4475,0,4483,0,4490,0,4555,0,4558,0,4614,0,4619,0,4657,0,4670,0,4671,0,4674,0,4682,0,4683,0,4718,0,4720,0,4721,0,4723,0,4726,0,4737,0,4738,0,4759,0,4761,0,4807,1,4808,0,4809,0,4816,1,4817,0,4818,0,4819,1,4820,0,4821,1,4823,0,4824,0,4901,1,4902,1,4903,0,4904,0,5228,0,5229,0,5233,0,5252,0,5264,0,5340,0,5354,0,5360,0,5371,0,5373,0,5381,0,
5393,0,5464,0,5467,0,5489,0,5524,0,5527,0,5546,0,5561,0,5593,0,5681,0,5886,0,37225,1,37235,0,37257,0,37259,0,37260,0,104020,0,104139,1,104140,1,104223,0,104286,0,104287,0,104304,0,104305,0,104896,0,104900,5,104901,0,104902,0,104903,9,104904,2,104905,2,104906,59,104907,54,104908,0,104909,58,104910,31,104911,56,104912,6,104913,50,104914,41,104915,10,104916,3,104917,30,104918,8,104919,60,104920,53,104921,44,104922,48,104923,51,104924,38,104925,0,104926,49,104927,57,104928,21,104929,23,104930,35,104931,
49,104932,27,104933,17,104934,13,104935,7,104936,56,104937,40,104938,28,104939,37,104940,15,104941,55,104942,22,104943,4,104944,0,104945,20,104946,42,104947,47,104948,52,104949,43,104950,46,104951,39,104952,24,104953,16,104954,50,104955,36,104956,33,104957,46,104958,14,104959,19,104960,0,104961,34,104962,32,104963,29,104964,45,104965,26,104966,25,104967,41,104968,11,104969,12,104970,18],gcsidc:[[4001,4016,0],[4018,4025,0],[4027,4029,0],[4031,4036,0],[4044,4047,0],[4052,4054,0],[4120,4166,0],[4172,
4176,0],[4178,4185,0],[4190,4196,0],[4198,4216,0],[4218,4222,0],[4224,4232,0],[4234,4260,0],[4265,4267,0],[4269,4286,0],[4291,4303,0],[4306,4319,0],[4600,4610,0],[4621,4625,0],[4627,4633,0],[4636,4639,0],[4641,4646,0],[4659,4667,0],[4676,4680,0],[4686,4697,0],[4699,4706,0],[4740,4757,0],[4763,4765,0],[4801,4806,0],[4810,4812,1],[4813,4815,0],[37001,37008,0],[37201,37208,0],[37211,37224,0],[37226,37233,0],[37237,37243,0],[37245,37247,0],[37249,37255,0],[104100,104138,0],[104141,104145,0],[104256,104261,
0],[104700,104786,0],[104990,104992,0]]},b={c:[[2E3,2045,9001],[2056,2065,9001],[2067,2135,9001],[2137,2153,9001],[2161,2170,9001],[2172,2193,9001],[2196,2198,9001],[2200,2203,9001],[2206,2217,9001],[2222,2224,9002],[2251,2253,9002],[2280,2282,9002],[2308,2311,9001],[2315,2325,9001],[2327,2394,9001],[2400,2462,9001],[2523,2576,9001],[2578,2693,9001],[2695,2758,9001],[2867,2869,9002],[2870,2888,9003],[2891,2895,9003],[2896,2898,9002],[2902,2908,9003],[2915,2920,9003],[2921,2923,9002],[2924,2930,9003],
[2931,2941,9001],[2969,2973,9001],[2975,2982,9001],[2984,2988,9001],[2995,3002,9001],[3006,3051,9001],[3054,3059,9001],[3061,3066,9001],[3068,3071,9001],[3084,3087,9001],[3112,3118,9001],[3120,3138,9001],[3146,3151,9001],[3153,3157,9001],[3161,3166,9001],[3168,3172,9001],[3174,3203,9001],[3294,3313,9001],[3315,3335,9001],[3339,3345,9001],[3350,3358,9001],[3367,3369,9001],[3374,3399,9001],[3408,3416,9001],[3425,3432,9003],[3441,3446,9003],[3456,3459,9003],[3465,3478,9001],[3554,3559,9001],[3561,3565,
9003],[3568,3570,9003],[3571,3581,9001],[3594,3597,9001],[3601,3604,9001],[3637,3639,9001],[3665,3667,9001],[3693,3695,9001],[3701,3727,9001],[3728,3733,9003],[3744,3747,9001],[3753,3758,9003],[3761,3763,9001],[3765,3769,9001],[3779,3781,9001],[3788,3791,9001],[3797,3799,9001],[3832,3841,9001],[3844,3852,9001],[3873,3885,9001],[3890,3893,9001],[3907,3912,9001],[3942,3950,9001],[3968,3970,9001],[3973,3976,9001],[3986,3989,9001],[3994,3997,9001],[4001,4016,9102],[4018,4025,9102],[4027,4029,9102],[4031,
4036,9102],[4044,4047,9102],[4052,4054,9102],[4120,4166,9102],[4172,4176,9102],[4178,4185,9102],[4190,4196,9102],[4198,4216,9102],[4218,4222,9102],[4224,4232,9102],[4234,4260,9102],[4265,4267,9102],[4269,4286,9102],[4291,4303,9102],[4306,4319,9102],[4399,4413,9003],[4418,4433,9003],[4491,4554,9001],[4600,4610,9102],[4621,4625,9102],[4627,4633,9102],[4636,4639,9102],[4641,4646,9102],[4659,4667,9102],[4676,4680,9102],[4686,4697,9102],[4699,4706,9102],[4740,4757,9102],[4763,4765,9102],[4801,4806,9102],
[4810,4812,9105],[4813,4815,9102],[5069,5072,9001],[5105,5130,9001],[5180,5184,9001],[5253,5259,9001],[5269,5275,9001],[5292,5311,9001],[5343,5349,9001],[5355,5357,9001],[5387,5389,9001],[5459,5463,9001],[5479,5482,9001],[5530,5539,9001],[5550,5552,9001],[5562,5583,9001],[5623,5625,9003],[5631,5639,9001],[5649,5653,9001],[5663,5680,9001],[5682,5685,9001],[5875,5877,9001],[20002,20032,9001],[20062,20092,9001],[20135,20138,9001],[20248,20258,9001],[20348,20358,9001],[20436,20440,9001],[20822,20824,
9001],[20934,20936,9001],[21035,21037,9001],[21095,21097,9001],[21148,21150,9001],[21413,21423,9001],[21473,21483,9001],[21780,21782,9001],[21891,21894,9001],[22171,22177,9001],[22181,22187,9001],[22191,22197,9001],[22234,22236,9001],[22521,22525,9001],[22991,22994,9001],[23028,23038,9001],[23830,23853,9001],[23866,23872,9001],[23877,23884,9001],[23886,23894,9001],[23946,23948,9001],[24311,24313,9001],[24342,24347,9001],[24370,24374,9084],[24375,24381,9001],[24718,24721,9001],[24817,24821,9001],[24877,
24882,9001],[24891,24893,9001],[25391,25395,9001],[25828,25838,9001],[26191,26195,9001],[26391,26393,9001],[26703,26722,9001],[26729,26760,9003],[26766,26798,9003],[26860,26870,9003],[26891,26899,9001],[26903,26923,9001],[26929,26946,9001],[26948,26998,9001],[27037,27040,9001],[27205,27232,9001],[27258,27260,9001],[27391,27398,9001],[27561,27564,9001],[27571,27574,9001],[27581,27584,9001],[27591,27594,9001],[28191,28193,9001],[28348,28358,9001],[28402,28432,9001],[28462,28492,9001],[29118,29122,9001],
[29177,29185,9001],[30161,30179,9001],[30491,30494,9001],[30729,30732,9001],[31251,31259,9001],[31265,31268,9001],[31275,31278,9001],[31288,31297,9001],[31461,31465,9001],[31491,31495,9001],[31917,31922,9001],[31965,31985,9001],[31992,32E3,9001],[32001,32003,9003],[32005,32031,9003],[32033,32060,9003],[32074,32077,9003],[32081,32086,9001],[32107,32130,9001],[32133,32158,9001],[32164,32167,9003],[32180,32199,9001],[32201,32260,9001],[32301,32360,9001],[32601,32662,9001],[32664,32667,9003],[32701,32761,
9001],[37001,37008,9102],[37201,37208,9102],[37211,37224,9102],[37226,37233,9102],[37237,37243,9102],[37245,37247,9102],[37249,37255,9102],[53001,53004,9001],[53008,53019,9001],[53021,53032,9001],[53042,53046,9001],[54001,54004,9001],[54008,54019,9001],[54021,54032,9001],[54042,54046,9001],[54048,54053,9001],[102001,102040,9001],[102042,102063,9001],[102065,102067,9001],[102070,102112,9001],[102114,102117,9001],[102122,102208,9001],[102210,102216,9001],[102221,102300,9001],[102304,102377,9001],[102382,
102388,9001],[102389,102391,9003],[102401,102444,9001],[102450,102452,9001],[102461,102468,9003],[102469,102492,9001],[102500,102519,9002],[102530,102549,9001],[102570,102588,9001],[102590,102598,9001],[102601,102603,9001],[102608,102628,9001],[102629,102646,9003],[102648,102672,9003],[102675,102700,9003],[102701,102703,9001],[102707,102730,9003],[102735,102758,9003],[102767,102798,9001],[102962,102969,9001],[102971,102973,9001],[102975,102989,9001],[102990,102992,9002],[102997,103002,9001],[103003,
103008,9003],[103009,103011,9001],[103012,103014,9003],[103019,103021,9001],[103022,103024,9003],[103029,103031,9001],[103032,103034,9003],[103065,103068,9001],[103074,103076,9001],[103077,103079,9002],[103080,103082,9001],[103083,103085,9003],[103090,103093,9001],[103097,103099,9001],[103100,103102,9003],[103107,103109,9001],[103110,103112,9003],[103113,103116,9001],[103117,103120,9003],[103153,103157,9001],[103158,103162,9003],[103163,103165,9001],[103166,103168,9002],[103169,103171,9003],[103186,
103188,9001],[103189,103191,9003],[103192,103195,9001],[103196,103199,9003],[103200,103224,9001],[103225,103227,9002],[103232,103237,9001],[103238,103243,9003],[103244,103246,9001],[103247,103249,9003],[103254,103256,9001],[103257,103259,9003],[103264,103266,9001],[103267,103269,9003],[103300,103375,9001],[103381,103383,9001],[103384,103386,9002],[103387,103389,9001],[103390,103392,9003],[103397,103399,9001],[103400,103471,9003],[103476,103478,9001],[103479,103481,9003],[103486,103488,9001],[103489,
103491,9003],[103492,103495,9001],[103496,103499,9003],[103539,103543,9001],[103544,103548,9003],[103549,103551,9001],[103552,103554,9002],[103555,103557,9003],[103558,103560,9001],[103571,103573,9001],[103574,103576,9003],[103577,103580,9001],[103581,103583,9003],[103600,103694,9001],[103700,103793,9003],[103794,103799,9001],[104100,104138,9102],[104141,104145,9102],[104256,104261,9102],[104700,104786,9102],[104900,104970,9102],[104990,104992,9102]],nc:[2066,9039,2136,9094,2155,9003,2157,9001,2158,
9001,2159,9094,2160,9094,2219,9001,2220,9001,2244,9003,2245,9003,2256,9002,2265,9002,2266,9002,2269,9002,2270,9002,2273,9002,2290,9001,2291,9001,2294,9001,2295,9001,2313,9001,2314,9005,2899,9003,2900,9003,2901,9002,2909,9002,2910,9002,2911,9003,2912,9003,2913,9002,2914,9002,2964,9003,2967,9003,2968,9003,2991,9001,2992,9002,2993,9001,2994,9002,3073,9001,3076,9001,3079,9001,3091,9003,3106,9001,3108,9001,3109,9001,3141,9001,3142,9001,3167,9301,3337,9001,3347,9001,3348,9001,3359,9003,3360,9001,3361,9002,
3362,9001,3363,9003,3364,9001,3365,9003,3366,9005,3402,9001,3403,9001,3405,9001,3406,9001,3439,9001,3440,9001,3447,9001,3449,9001,3450,9001,3453,9003,3454,9003,3460,9001,3479,9002,3480,9001,3481,9002,3482,9001,3483,9002,3484,9001,3485,9003,3486,9001,3487,9003,3488,9001,3489,9001,3490,9003,3491,9001,3492,9003,3493,9001,3494,9003,3495,9001,3496,9003,3497,9001,3498,9003,3499,9001,3500,9003,3501,9001,3502,9003,3503,9001,3504,9003,3505,9001,3506,9003,3507,9001,3508,9003,3509,9001,3510,9003,3511,9001,3512,
9003,3513,9001,3514,9001,3515,9003,3516,9001,3517,9003,3518,9001,3519,9003,3520,9001,3521,9003,3522,9001,3523,9003,3524,9001,3525,9003,3526,9001,3527,9003,3528,9001,3529,9003,3530,9001,3531,9003,3532,9001,3533,9003,3534,9001,3535,9003,3536,9001,3537,9003,3538,9001,3539,9003,3540,9001,3541,9003,3542,9001,3543,9003,3544,9001,3545,9003,3546,9001,3547,9003,3548,9001,3549,9003,3550,9001,3551,9003,3552,9001,3553,9003,3582,9003,3583,9001,3584,9003,3585,9001,3586,9003,3587,9001,3588,9002,3589,9001,3590,9002,
3591,9001,3592,9001,3593,9002,3598,9003,3599,9001,3600,9003,3605,9002,3606,9001,3607,9001,3608,9003,3609,9001,3610,9003,3611,9001,3612,9003,3613,9001,3614,9003,3615,9001,3616,9003,3617,9001,3618,9003,3619,9001,3620,9003,3621,9001,3622,9003,3623,9001,3624,9003,3625,9001,3626,9003,3627,9001,3628,9003,3629,9001,3630,9003,3631,9001,3632,9003,3633,9001,3634,9002,3635,9001,3636,9002,3640,9003,3641,9001,3642,9003,3643,9001,3644,9002,3645,9001,3646,9002,3647,9001,3648,9002,3649,9001,3650,9003,3651,9001,3652,
9003,3653,9001,3654,9003,3655,9001,3656,9002,3657,9001,3658,9003,3659,9001,3660,9003,3661,9001,3662,9003,3663,9001,3664,9003,3668,9003,3669,9001,3670,9003,3671,9001,3672,9003,3673,9001,3674,9003,3675,9001,3676,9002,3677,9003,3678,9001,3679,9002,3680,9003,3681,9001,3682,9002,3683,9003,3684,9001,3685,9001,3686,9003,3687,9001,3688,9003,3689,9001,3690,9003,3691,9001,3692,9003,3696,9003,3697,9001,3698,9003,3699,9001,3700,9003,3740,9001,3749,9001,3783,9001,3784,9001,3793,9001,3794,9001,3802,9001,3816,9001,
3829,9001,3854,9001,3920,9001,3978,9001,3979,9001,3991,9003,3992,9003,4026,9001,4037,9001,4038,9001,4042,9102,4075,9102,4081,9102,4168,9102,4170,9102,4188,9102,4217,9003,4261,9105,4262,9102,4263,9102,4288,9102,4289,9102,4305,9105,4322,9102,4324,9102,4326,9102,4438,9003,4439,9003,4466,9102,4467,9001,4469,9102,4471,9001,4474,9001,4475,9102,4483,9102,4490,9102,4555,9102,4558,9102,4559,9001,4614,9102,4619,9102,4657,9102,4670,9102,4671,9102,4674,9102,4682,9102,4683,9102,4718,9102,4720,9102,4721,9102,4723,
9102,4726,9102,4737,9102,4738,9102,4759,9102,4761,9102,4807,9105,4808,9102,4809,9102,4816,9105,4817,9102,4818,9102,4819,9105,4820,9102,4821,9105,4823,9102,4824,9102,4839,9001,4901,9105,4902,9105,4903,9102,4904,9102,5018,9001,5048,9001,5167,9001,5168,9001,5223,9001,5228,9102,5229,9102,5233,9102,5234,9001,5235,9001,5243,9001,5252,9102,5264,9102,5266,9001,5316,9001,5320,9001,5321,9001,5330,9001,5331,9001,5337,9001,5340,9102,5354,9102,5360,9102,5361,9001,5362,9001,5371,9102,5373,9102,5381,9102,5382,9001,
5383,9001,5393,9102,5396,9001,5456,9001,5457,9001,5464,9102,5467,9102,5469,9001,5472,9037,5489,9102,5490,9001,5518,9001,5523,9001,5524,9102,5527,9102,5546,9102,5559,9001,5561,9102,5588,9002,5589,9005,5593,9102,5596,9001,5627,9001,5629,9001,5641,9001,5643,9001,5644,9001,5654,9003,5655,9003,5659,9001,5681,9102,5700,9001,5825,9001,5836,9001,5837,9001,5842,9001,5844,9001,5880,9001,5886,9102,5887,9001,5890,9001,20499,9001,20538,9001,20539,9001,20790,9001,20791,9001,21291,9001,21292,9001,21500,9001,21817,
9001,21818,9001,22032,9001,22033,9001,22091,9001,22092,9001,22332,9001,22391,9001,22392,9001,22700,9001,22770,9001,22780,9001,22832,9001,23090,9001,23095,9001,23239,9001,23240,9001,23433,9001,23700,9001,24047,9001,24048,9001,24100,9005,24200,9001,24305,9001,24306,9001,24382,9084,24383,9001,24500,9001,24547,9001,24548,9001,24571,9062,24600,9001,25E3,9001,25231,9001,25884,9001,25932,9001,26237,9001,26331,9001,26332,9001,26591,9001,26592,9001,26632,9001,26692,9001,26855,9003,26856,9003,27120,9001,27200,
9001,27291,9040,27292,9040,27429,9001,27492,9001,27500,9001,27700,9001,28232,9001,28600,9001,28991,9001,28992,9001,29100,9001,29220,9001,29221,9001,29333,9001,29635,9001,29636,9001,29701,9001,29738,9001,29739,9001,29849,9001,29850,9001,29871,9042,29872,9041,29873,9001,29900,9001,29901,9001,29903,9001,30200,9039,30339,9001,30340,9001,30591,9001,30592,9001,30791,9001,30792,9001,31028,9001,31121,9001,31154,9001,31170,9001,31171,9001,31370,9001,31528,9001,31529,9001,31600,9001,31700,9001,31838,9001,31839,
9001,31901,9001,32061,9001,32062,9001,32098,9001,32099,9003,32100,9001,32104,9001,32161,9001,32766,9001,37225,9105,37235,9102,37257,9102,37259,9102,37260,9102,53034,9001,53048,9001,53049,9001,54034,9001,65061,9003,65062,9003,65161,9001,65163,9001,102041,9003,102064,9085,102068,109030,102069,109031,102118,9003,102119,9002,102120,9003,102121,9003,102217,9003,102218,9001,102219,9003,102220,9003,102378,9002,102379,9002,102380,9001,102381,9002,102589,9003,102599,9003,102600,9003,102604,9003,102605,9001,
102606,9001,102647,9001,102704,9003,102705,9003,102733,9003,102761,9003,102762,9001,102763,9003,102764,9001,102765,9001,102766,9003,102970,9002,102974,9003,102993,9001,102994,9001,102995,9003,102996,9003,103015,9001,103016,9003,103017,9001,103018,9003,103025,9001,103026,9001,103027,9003,103028,9003,103035,9001,103036,9001,103037,9003,103038,9003,103039,9001,103040,9001,103041,9003,103042,9003,103043,9001,103044,9001,103045,9003,103046,9003,103047,9001,103048,9001,103049,9003,103050,9003,103051,9001,
103052,9003,103053,9001,103054,9003,103055,9001,103056,9003,103057,9001,103058,9001,103059,9003,103060,9003,103061,9001,103062,9001,103063,9003,103064,9003,103069,9003,103070,9001,103071,9001,103072,9003,103073,9003,103086,9001,103087,9001,103088,9003,103089,9003,103094,9002,103095,9001,103096,9003,103103,9001,103104,9003,103105,9001,103106,9003,103121,9001,103122,9003,103123,9001,103124,9001,103125,9002,103126,9002,103127,9001,103128,9001,103129,9003,103130,9003,103131,9001,103132,9001,103133,9003,
103134,9003,103135,9001,103136,9001,103137,9002,103138,9002,103139,9001,103140,9003,103141,9001,103142,9003,103143,9001,103144,9003,103145,9001,103146,9002,103147,9001,103148,9001,103149,9003,103150,9003,103151,9001,103152,9003,103172,9001,103173,9003,103174,9001,103175,9001,103176,9003,103177,9003,103178,9001,103179,9001,103180,9003,103181,9003,103182,9001,103183,9001,103184,9003,103185,9003,103228,9001,103229,9001,103230,9003,103231,9003,103250,9001,103251,9003,103252,9001,103253,9003,103260,9001,
103261,9001,103262,9003,103263,9003,103270,9001,103271,9001,103272,9003,103273,9003,103274,9001,103275,9001,103276,9003,103277,9003,103278,9001,103279,9001,103280,9003,103281,9003,103282,9001,103283,9001,103284,9003,103285,9003,103286,9001,103287,9003,103288,9001,103289,9003,103290,9001,103291,9003,103292,9001,103293,9001,103294,9003,103295,9003,103296,9001,103297,9001,103298,9003,103299,9003,103376,9003,103377,9001,103378,9001,103379,9003,103380,9003,103393,9001,103394,9001,103395,9003,103396,9003,
103472,9001,103473,9002,103474,9001,103475,9003,103482,9001,103483,9003,103484,9001,103485,9003,103500,9001,103501,9003,103502,9001,103503,9001,103504,9002,103505,9002,103506,9001,103507,9001,103508,9003,103509,9003,103510,9001,103511,9001,103512,9003,103513,9003,103514,9001,103515,9003,103516,9001,103517,9003,103518,9001,103519,9003,103520,9001,103521,9002,103522,9001,103523,9001,103524,9003,103525,9003,103526,9001,103527,9003,103561,9003,103562,9003,103563,9001,103564,9001,103565,9003,103566,9003,
103567,9001,103568,9001,103569,9003,103570,9003,103585,9003,103695,9003,104020,9102,104139,9105,104140,9105,104223,9102,104286,9102,104287,9102,104304,9102,104305,9102,104896,9102]},h=function(){function e(){}e.cC=function(g){!1===e.ti&&e.bo();var a=e.NG(g);if(-1==a){var h=e.ks(g);h!=g&&(a=e.cC(h))}return a};e.NG=function(g){return void 0!==e.ds[g]?e.ds[g]:-1};e.SM=function(g){!1===e.ti&&e.bo();var a=e.Fz(g);if(1E38==a){var h=e.ks(g);h!=g&&(a=e.Fz(h));if(1E38==a)return 1E-10}return a};e.WO=function(g){if(void 0!==
e.Un[g])return!0;var a=e.ks(g);return a!=g&&void 0!==e.Un[a]?!0:!1};e.ZO=function(g){if(void 0!==e.Gh[g])return!0;var a=e.ks(g);return a!=g&&void 0!==e.Gh[a]?!0:!1};e.Fz=function(a){!1===e.ti&&e.bo();return void 0!==e.Un[a]?e.Un[a]:void 0!==e.Gh[a]?e.Gh[a]:1E38};e.oU=function(a){!1===e.ti&&e.bo();return void 0!==e.ew[a]?e.ew[a]:a};e.ks=function(a){!1===e.ti&&e.bo();return void 0!==e.Mw[a]?e.Mw[a]:a};e.bo=function(){for(var a=c,h,y=0;y<a.pcsid.length;y+=2)e.Gh[a.pcsid[y]]=a.pcstol[2*a.pcsid[y+1]+1];
for(y=0;y<a.pcsidc.length;y+=1){h=a.pcsidc[y];for(var F=h[0];F<=h[1];F++)e.Gh[F]=a.pcstol[2*h[2]+1]}for(y=0;y<a.gcsid.length;y+=2)e.Un[a.gcsid[y]]=a.gcstol[2*a.gcsid[y+1]+1];for(y=0;y<a.gcsidc.length;y+=1)for(h=a.gcsidc[y],F=h[0];F<=h[1];F++)e.Gh[F]=a.gcstol[2*h[2]+1];for(y=0;y<b.c.length;y+=1)for(h=b.c[y],F=h[0];F<=h[1];F++)e.ds[F]=h[2];for(y=0;y<b.nc.length;y+=2)e.ds[b.nc[y]]=b.nc[y+1];b=null;for(y=0;y<a.newtoold.length;y+=2)e.ew[a.newtoold[y+1]]=a.newtoold[y],e.Mw[a.newtoold[y]]=a.newtoold[y+1];
c=null;e.ti=!0};e.ti=!1;e.Un=[];e.Gh=[];e.ew=[];e.Mw=[];e.ds=[];return e}();a.ls=h})(B||(B={}));(function(a){function c(e){return 0===e.length?'""':'"'==e[0]||"."==e[0]||"0"<=e[0]&&"9">=e[0]?e:'"'+e.trim()+'"'}var b=[],h=function(){function e(){}e.UM=function(g){try{for(var h=0;h<b.length;h++)if(b[h].wkttext===g)return b[h].unit;for(var y,F=h="",d=!1,A=0;A<g.length;A++){var f=g[A];!0===d?'"'==f?'"'==g[A+1]?h+=f:d=!1:h+=f:/[\s]/.test(f)||(","==f?(F=""!==h?F+(c(h)+","):F+",",h=""):")"==f||"]"==f?(F=
""!==h?F+(c(h)+"]}"):F+"]}",h=""):"("==f||"["==f?(F+='{ "entity": "'+h.toUpperCase().trim()+'", "values":[',h=""):'"'==f?(d=!0,h=""):h+=f)}y=JSON.parse(F);var k=e.Dz(y);if(null===k)return null;y=null;for(f=0;f<k.values.length;f++)if("object"===typeof k.values[f]&&"UNIT"===k.values[f].entity){y=k.values[f];break}if(null===y)return null;var m=a.Tb.EL("GEOGCS"===k.entity?1:0,y.values[1],y.values[2]);b.push({wkttext:g,unit:m});10<b.length&&b.shift();return m}catch(X){return null}};e.Dz=function(a){if(null===
a)return null;if("GEOGCS"===a.entity||"PROJCS"===a.entity)return a;for(var g=[],h=0;h<a.values.length;h++)if("object"===typeof a.values[h]&&void 0!==a.values[h].entity){if("GEOGCS"===a.values[h].entity||"PROJCS"==a.values[h].entity)return a.values[h];g.push(a.values[h])}for(a=0;a<g.length;a++)if(h=e.Dz(g[a]),null!==h)return h;return null};e.TM=function(e){var a=-1;if(null!=e&&0<e.length){var g,h;g=e.indexOf("PROJCS");if(0<=g){var c=0;g=e.lastIndexOf("UNIT");if(0<=g&&(g=e.indexOf(",",g+4),0<g&&(g++,
h=e.indexOf("]",g+1),0<h)))try{c=parseFloat(e.substring(g,h))}catch(Y){c=0}0<c&&(a=.001/c)}else if(g=e.indexOf("GEOGCS"),0<=g){var b=0,c=0;g=e.indexOf("SPHEROID",g+6);if(0<g&&(g=e.indexOf(",",g+8),0<g)){g++;h=e.indexOf(",",g+1);if(0<h)try{b=parseFloat(e.substring(g,h))}catch(Y){b=0}if(0<b&&(g=e.indexOf("UNIT",h+1),0<=g&&(g=e.indexOf(",",g+4),0<g&&(g++,h=e.indexOf("]",g+1),0<h))))try{c=parseFloat(e.substring(g,h))}catch(Y){c=0}}0<b&&0<c&&(a=.001/(b*c))}}return a};return e}();a.mA=h})(B||(B={}));(function(a){(function(a){a[a.NONE=
0]="NONE";a[a.LINEAR=1]="LINEAR";a[a.ANGULAR=2]="ANGULAR"})(a.BH||(a.BH={}));(function(a){a[a.enumFloat=0]="enumFloat";a[a.enumDouble=1]="enumDouble";a[a.enumInt32=2]="enumInt32";a[a.enumInt64=3]="enumInt64";a[a.enumInt8=4]="enumInt8";a[a.enumInt16=5]="enumInt16"})(a.oI||(a.oI={}));(function(a){a[a.POSITION=0]="POSITION";a[a.Z=1]="Z";a[a.M=2]="M";a[a.ID=3]="ID";a[a.NORMAL=4]="NORMAL";a[a.TEXTURE1D=5]="TEXTURE1D";a[a.TEXTURE2D=6]="TEXTURE2D";a[a.TEXTURE3D=7]="TEXTURE3D";a[a.ID2=8]="ID2";a[a.MAXSEMANTICS=
10]="MAXSEMANTICS"})(a.xf||(a.xf={}));var c=function(){function c(a,e){this.er=this.le=null;this.up=this.Aa=0;this.Wg=this.Jf=null;this.tk=0;if(void 0!==e){this.Aa=e.Aa;this.up=e.up;this.Jf=e.Jf.slice(0);this.Wg=e.Wg.slice(0);this.tk=e.tk;this.er=[];for(e=a=0;e<this.Aa;e++)this.er[e]=a,a+=c.Wa(this.Jf[e]);this.up=a;this.le=[];for(e=0;e<this.Aa;e++){a=c.Wa(this.Hd(e));for(var g=c.ue(this.Hd(e)),h=0;h<a;h++)this.le[this.er[e]+h]=g}}else this.up=this.Aa=0}c.prototype.Hd=function(h){if(0>h||h>this.Aa)throw a.g.N();
return this.Jf[h]};c.prototype.zf=function(a){return this.Wg[a]};c.JN=function(a){return c.ac[a]};c.Qh=function(a){return c.Cc[a]};c.ye=function(a){return c.Bd[a]};c.Gh=function(a){return c.ye(c.Qh(a))*c.Wa(a)};c.Wa=function(a){return c.ob[a]};c.Wf=function(a){return 2>a};c.ti=function(a){return c.Wf(c.Qh(a))};c.prototype.hasAttribute=function(a){return 0<=this.Wg[a]};c.prototype.WC=function(){return this.hasAttribute(1)};c.ue=function(a){return c.V[a]};c.prototype.XN=function(a){return this.er[a]};
c.nD=function(a,e){return c.V[a]===e};c.$g=function(h){if(4==h)return 2;if(8==h)return 3;throw a.g.N();};c.prototype.lc=function(a){return this===a};c.prototype.jj=function(){for(var h=a.I.kg(this.Jf[0]),e=1;e<this.Aa;e++)h=a.I.kg(this.Jf[e],h);return h};c.prototype.fj=function(a){return this.er[a]};c.prototype.hc=function(){return this.tk};c.prototype.Fd=function(a){return this.Jf[a]};c.V=[0,0,NaN,0,0,0,0,0,0];c.ac=[1,1,1,0,2,1,1,1,0];c.Cc=[1,1,1,2,0,0,0,0,2];c.Bd=[4,8,4,8,1,2];c.ob=[2,1,1,1,3,1,
2,3,2];return c}();a.pa=c})(B||(B={}));(function(a){function c(e,a,h,c){var g=e.jd,n=e.e+a+1;1===h?c=5<=g[n]:2===h?c=5<g[n]||5==g[n]&&(c||0>n||void 0!==g[n+1]||g[n-1]&1):3===h?c=c||void 0!==g[n]||0>n:(c=!1,0!==h&&b("!Big.RM!"));if(1>n||!g[0])c?(e.e=-a,e.jd=[1]):e.jd=[e.e=0];else{g.length=n--;if(c)for(;9<++g[n];)g[n]=0,n--||(++e.e,g.unshift(1));for(n=g.length;!g[--n];g.pop());}}function b(e){e=Error(e);e.name="BigError";throw e;}var h=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,e=function(){function e(a){if(a instanceof
e)this.Dd=a.Dd,this.e=a.e,this.jd=a.jd.slice();else{var g,n,c;0===a&&0>1/a?a="-0":h.test(a+="")||b(NaN);this.Dd="-"==a.charAt(0)?(a=a.slice(1),-1):1;-1<(g=a.indexOf("."))&&(a=a.replace(".",""));0<(n=a.search(/e/i))?(0>g&&(g=n),g+=+a.slice(n+1),a=a.substring(0,n)):0>g&&(g=a.length);for(n=0;"0"==a.charAt(n);n++);if(n==(c=a.length))this.jd=[this.e=0];else{for(;"0"==a.charAt(--c););this.e=g-n-1;this.jd=[];for(g=0;n<=c;this.jd[g++]=+a.charAt(n++));}}}e.prototype.abs=function(){var a=new e(this);a.Dd=1;
return a};e.prototype.DB=function(){var a=0,g=this.jd,h=(a=new e(a)).jd,c=this.Dd,b=a.Dd,d=this.e,A=a.e;if(!g[0]||!h[0])return g[0]?c:h[0]?-b:0;if(c!=b)return c;a=0>c;if(d!=A)return d>(A^a)?1:-1;c=-1;for(b=(d=g.length)<(A=h.length)?d:A;++c<b;)if(g[c]!=h[c])return g[c]>(h[c]^a)?1:-1;return d==A?0:d>(A^a)?1:-1};e.prototype.VB=function(a){var g=this.jd,h=(a=new e(a)).jd,n=this.Dd==a.Dd?1:-1,d=e.Cc;(d!==~~d||0>d||1E6<d)&&b("!Big.DP!");if(!g[0]||!h[0])return g[0]==h[0]&&b(NaN),h[0]||b(n/0),new e(0*n);
var A,f,k,m,p=h.slice(),r=A=h.length,u=g.length,v=g.slice(0,A),q=v.length,x=a,D=x.jd=[],B=0,t=d+(x.e=this.e-a.e)+1;x.Dd=n;n=0>t?0:t;for(p.unshift(0);q++<A;v.push(0));do{for(f=0;10>f;f++){if(A!=(q=v.length))k=A>q?1:-1;else for(m=-1,k=0;++m<A;)if(h[m]!=v[m]){k=h[m]>v[m]?1:-1;break}if(0>k){for(a=q==A?h:p;q;){if(v[--q]<a[q]){for(m=q;m&&!v[--m];v[m]=9);--v[m];v[q]+=10}v[q]-=a[q]}for(;!v[0];v.shift());}else break}D[B++]=k?f:++f;v[0]&&k?v[q]=g[r]||0:v=[g[r]]}while((r++<u||void 0!==v[0])&&n--);D[0]||1==B||
(D.shift(),x.e--);B>t&&c(x,d,e.ye,void 0!==v[0]);return x};e.prototype.nO=function(){return 0<this.DB()};e.prototype.vP=function(){return 0>this.DB()};e.prototype.nr=function(a){var g,h,n=this.Dd,c=(a=new e(a)).Dd;if(n!=c)return a.Dd=-c,this.NE(a);var b=this.jd.slice();h=this.e;var d=a.jd,A=a.e;if(!b[0]||!d[0])return d[0]?(a.Dd=-c,a):new e(b[0]?this:0);if(n=h-A){(g=0>n)?(n=-n,h=b):(A=h,h=d);h.reverse();for(c=n;c--;h.push(0));h.reverse()}else for(h=((g=b.length<d.length)?b:d).length,n=c=0;c<h;c++)if(b[c]!=
d[c]){g=b[c]<d[c];break}g&&(h=b,b=d,d=h,a.Dd=-a.Dd);if(0<(c=(h=d.length)-(g=b.length)))for(;c--;b[g++]=0);for(c=g;h>n;){if(b[--h]<d[h]){for(g=h;g&&!b[--g];b[g]=9);--b[g];b[h]+=10}b[h]-=d[h]}for(;0==b[--c];b.pop());for(;0==b[0];)b.shift(),--A;b[0]||(a.Dd=1,b=[A=0]);a.jd=b;a.e=A;return a};e.prototype.NE=function(a){var g,h=this.Dd;g=(a=new e(a)).Dd;if(h!=g)return a.Dd=-g,this.nr(a);g=this.e;var n=this.jd,c=a.e,b=a.jd;if(!n[0]||!b[0])return b[0]?a:new e(n[0]?this:0*h);n=n.slice();if(h=g-c){0<h?(c=g,
g=b):(h=-h,g=n);for(g.reverse();h--;g.push(0));g.reverse()}0>n.length-b.length&&(g=b,b=n,n=g);h=b.length;for(g=0;h;)g=(n[--h]=n[h]+b[h]+g)/10|0,n[h]%=10;g&&(n.unshift(g),++c);for(h=n.length;0==n[--h];n.pop());a.jd=n;a.e=c;return a};e.prototype.pow=function(a){var g=this,h=new e(1),n=h,c=0>a;(a!==~~a||-1E6>a||1E6<a)&&b("!pow!");for(a=c?-a:a;;){a&1&&(n=n.Wp(g));a>>=1;if(!a)break;g=g.Wp(g)}return c?h.VB(n):n};e.prototype.round=function(a,g){var h=this;null==a?a=0:(a!==~~a||0>a||1E6<a)&&b("!round!");
c(h=new e(h),a,null==g?e.ye:g);return h};e.prototype.sqrt=function(){var a,g,h;g=this.jd;a=this.Dd;h=this.e;var d=new e("0.5");if(!g[0])return new e(this);0>a&&b(NaN);a=Math.sqrt(this.toString());0==a||a==1/0?(a=g.join(""),a.length+h&1||(a+="0"),g=new e(Math.sqrt(a).toString()),g.e=((h+1)/2|0)-(0>h||h&1)):g=new e(a.toString());a=g.e+(e.Cc+=4);do h=g,g=d.Wp(h.NE(this.VB(h)));while(h.jd.slice(0,a).join("")!==g.jd.slice(0,a).join(""));c(g,e.Cc-=4,e.ye);return g};e.prototype.Wp=function(a){var g,h=this.jd,
n=(a=new e(a)).jd,c=h.length,b=n.length,d=this.e,A=a.e;a.Dd=this.Dd==a.Dd?1:-1;if(!h[0]||!n[0])return new e(0*a.Dd);a.e=d+A;c<b&&(g=h,h=n,n=g,A=c,c=b,b=A);for(g=Array(A=c+b);A--;g[A]=0);for(d=b;d--;){b=0;for(A=c+d;A>d;)b=g[A]+n[d]*h[A-d-1]+b,g[A--]=b%10,b=b/10|0;g[A]=(g[A]+b)%10}b&&++a.e;g[0]||g.shift();for(d=g.length;!g[--d];g.pop());a.jd=g;return a};e.prototype.toString=function(){var e=this.e,a=this.jd.join(""),g=a.length;if(-7>=e||21<=e)a=a.charAt(0)+(1<g?"."+a.slice(1):"")+(0>e?"e":"e+")+e;else if(0>
e){for(;++e;a="0"+a);a="0."+a}else if(0<e)if(++e>g)for(e-=g;e--;a+="0");else e<g&&(a=a.slice(0,e)+"."+a.slice(e));else 1<g&&(a=a.charAt(0)+"."+a.slice(1));return 0>this.Dd&&this.jd[0]?"-"+a:a};e.Cc=20;e.ye=1;return e}();a.Tn=e})(B||(B={}));(function(a){var c=function(){function h(e){this.$e=e}h.prototype.Zp=function(e,g,h){var n=new a.b,c=new a.b,b=this.$e;h.xd(e,g,function(e,a){b.ec(2*e,n);b.ec(2*a,c);return n.compare(c)})};h.prototype.Mo=function(e){return this.$e.read(2*e+1)};return h}(),b=function(){function h(){}
h.No=function(e){if(e.s())return!1;var g=e.D();return 1736==g?0==e.Mh()?!1:!0:1607==g?(g=[!1],h.qz(e,!0,g),g[0]):197==g||a.T.Lc(g)&&!e.kD()?!0:!1};h.il=function(e){var g=e.D();if(1736==g)return g=new a.Xa(e.description),e.s()||e.tA(g),g;if(1607==g)return h.qz(e,!1,null);if(197==g)return g=new a.Xa(e.description),e.s()||g.Wc(e,!1),g;if(a.T.Lc(g)){g=new a.pe(e.description);if(!e.s()&&!e.kD()){var n=new a.Va;e.En(n);g.add(n);e.Bn(n);g.add(n)}return g}if(a.T.Km(g))return null;throw a.g.N();};h.qz=function(e,
g,h){null!=h&&(h[0]=!1);var n=null;g||(n=new a.pe(e.description));if(!e.s()){var b=new a.ga(0);b.xb(2*e.ea());for(var d=0,A=e.ea();d<A;d++)if(0<e.Ha(d)&&!e.Oo(d)){var f=e.Ea(d);b.add(f);f=e.Dc(d)-1;b.add(f)}if(0<b.size){A=new a.Rr;d=e.mc(0);A.sort(b,0,b.size,new c(d));A=new a.b;d.ec(2*b.get(0),A);for(var f=0,k=1,m=new a.Va,p=new a.b,r=1,u=b.size;r<u;r++)if(d.ec(2*b.get(r),p),p.ub(A))b.get(f)>b.get(r)?(b.set(f,2147483647),f=r):b.set(r,2147483647),k++;else{if(0==(k&1))b.set(f,2147483647);else if(g)return null!=
h&&(h[0]=!0),null;A.J(p);f=r;k=1}if(0==(k&1))b.set(f,2147483647);else if(g)return null!=h&&(h[0]=!0),null;if(!g)for(b.xd(0,b.size,function(e,a){return e-a}),r=0,u=b.size;r<u&&2147483647!=b.get(r);r++)e.Sd(b.get(r),m),n.add(m)}}return g?null:n};return h}();a.Hh=b})(B||(B={}));(function(a){var c=function(){function c(){this.lf=new a.ga(0);this.Lq=new a.ga(0);this.gE=1;this.Qq=NaN}c.prototype.sort=function(a,e,g,n){if(32>g-e)n.Zp(e,g,a);else{var h=!0;try{for(var c=Infinity,b=-Infinity,d=e;d<g;d++){var A=
n.Mo(a.get(d));A<c&&(c=A);A>b&&(b=A)}if(this.reset(g-e,c,b,g-e)){for(d=e;d<g;d++){var f=a.get(d),A=n.Mo(f),k=this.oC(A);this.lf.set(k,this.lf.get(k)+1);this.Lq.write(d-e,f)}var m=this.lf.get(0);this.lf.set(0,0);for(var d=1,p=this.lf.size;d<p;d++){var r=this.lf.get(d);this.lf.set(d,m);m+=r}for(d=e;d<g;d++){var f=this.Lq.read(d-e),A=n.Mo(f),k=this.oC(A),u=this.lf.get(k);a.set(u+e,f);this.lf.set(k,u+1)}h=!1}}catch(ia){this.lf.resize(0),this.Lq.resize(0)}if(h)n.Zp(e,g,a);else{d=g=0;for(p=this.lf.size;d<
p;d++)h=g,g=this.lf.get(d),g>h&&n.Zp(e+h,e+g,a);100<this.lf.size&&(this.lf.resize(0),this.Lq.resize(0))}}};c.prototype.reset=function(a,e,g,n){if(2>a||g==e)return!1;a=Math.min(c.tI,a);this.lf.xb(a);this.lf.resize(a);this.lf.dh(0,0,this.lf.size);this.gE=e;this.Lq.resize(n);this.Qq=(g-e)/(a-1);return!0};c.prototype.oC=function(h){return a.I.truncate((h-this.gE)/this.Qq)};c.tI=65536;return c}();a.Rr=c})(B||(B={}));(function(a){var c;(function(e){e[e.enum_line=1]="enum_line";e[e.enum_arc=2]="enum_arc";
e[e.enum_dummy=4]="enum_dummy";e[e.enum_concave_dip=8]="enum_concave_dip";e[e.enum_connection=3]="enum_connection"})(c||(c={}));var b=function(){function e(){}e.Ks=function(g,h,n,c,b,y){var F=new e;F.Fl=new a.b;F.Ql=new a.b;F.Lt=new a.b;F.Fl.J(g);F.Ql.J(h);F.Lt.J(n);F.qn=c;F.Rg=b;F.Ug=y;return F};e.Oa=function(g,h,n,c){var b=new e;b.Fl=new a.b;b.Ql=new a.b;b.Lt=new a.b;b.Fl.J(g);b.Ql.J(h);b.Lt.Eh();b.qn=4;b.Rg=n;b.Ug=c;return b};return e}(),h=function(){function e(e,a,g,h,n,c){this.It=null;this.ua=
0;this.Ex=e;this.yE=this.wE=0;this.Da=a;this.Pi=g;this.Cj=h;this.mp=n;this.Yb=c}e.prototype.next=function(){for(var e=new a.Va;;){if(this.ua==this.Ex.F())return null;this.Ex.Sd(this.ua,e);this.ua++;if(!e.s())break}var g=!1;null==this.It&&(this.wE=e.lk(),this.yE=e.mk(),this.It=n.buffer(e,this.Da,this.Pi,this.Cj,this.mp,this.Yb),g=!0);var h;this.ua<this.Ex.F()?(h=new a.Ka,this.It.copyTo(h)):h=this.It;if(!g){var g=new a.Bg,c=e.lk()-this.wE,e=e.mk()-this.yE;g.Nn(c,e);h.Oe(g)}return h};e.prototype.ya=
function(){return 0};return e}(),e=function(){function e(e,a){this.Ma=e;this.ua=0;this.Yo=a}e.prototype.next=function(){var e=this.Ma.U;if(this.ua<e.ea()){var g=this.ua;this.ua++;if(!e.Oo(g))for(var h=e.Fa(e.Dc(g)-1);this.ua<e.ea();){var n=e.Fa(e.Ea(this.ua));if(e.Oo(this.ua))break;if(n!=h)break;h=e.Fa(e.Dc(this.ua)-1);this.ua++}if(1==this.ua-g)return this.Ma.kB(this.Ma.U,g,this.Yo);h=new a.Xa(this.Ma.U.description);h.Zj(this.Ma.U,g,!0);for(g+=1;g<this.ua;g++)h.ys(this.Ma.U,g,0,e.ct(g),!1);return this.Ma.kB(h,
0,this.Yo)}return null};e.prototype.ya=function(){return 0};return e}(),g=function(){function e(e){this.Ma=e;this.ua=0}e.prototype.next=function(){var e=this.Ma.U;if(this.ua<e.ea()){var a=this.ua;e.oo(this.ua);for(this.ua++;this.ua<e.ea()&&!(0<e.oo(this.ua));)this.ua++;return 0==a&&this.ua==e.ea()?this.Ma.Gv(e,0,e.ea()):this.Ma.Gv(e,a,this.ua)}return null};e.prototype.ya=function(){return 0};return e}(),n=function(){function n(e){this.Vq=this.Tt=this.Wq=this.sd=null;this.Jd=[];this.Yb=e;this.hb=this.wt=
this.OP=this.Da=this.vx=this.jr=this.ka=0;this.sx=this.Cj=-1;this.Yo=!0}n.buffer=function(e,g,h,c,b,y){if(null==e)throw a.g.N();if(0>c)throw a.g.N();if(e.s())return new a.Ka(e.description);var d=new a.i;e.dd(d);0<g&&d.P(g,g);y=new n(y);y.Pi=h;y.U=e;y.ka=a.Ia.zd(h,d,!0);y.jr=a.Ia.zd(null,d,!0);y.Da=g;y.OP=e.D();0>=b&&(b=96);y.hb=Math.abs(y.Da);y.wt=0!=y.hb?1/y.hb:0;isNaN(c)||0==c?c=1E-5*y.hb:c>.5*y.hb&&(c=.5*y.hb);12>b&&(b=12);e=Math.abs(g)*(1-Math.cos(Math.PI/b));e>c?c=e:(e=Math.PI/Math.acos(1-c/
Math.abs(g)),e<b-1&&(b=a.I.truncate(e),12>b&&(b=12,c=Math.abs(g)*(1-Math.cos(Math.PI/b)))));y.Cj=c;y.mp=b;y.vx=Math.min(y.jr,.25*c);return y.lB()};n.prototype.Ss=function(){if(null==this.sd)this.sd=[];else if(0!==this.sd.length)return;var e=this.pB(),e=a.I.truncate((e+3)/4),g=.5*Math.PI/e;this.sx=g;for(var h=0;h<4*e;h++)this.sd.push(null);for(var n=Math.cos(g),g=Math.sin(g),c=a.b.Oa(0,1),h=0;h<e;h++)this.sd[h+0*e]=a.b.Oa(c.y,-c.x),this.sd[h+1*e]=a.b.Oa(-c.x,-c.y),this.sd[h+2*e]=a.b.Oa(-c.y,c.x),this.sd[h+
3*e]=c,c=a.b.Oa(c.x,c.y),c.Er(n,g)};n.prototype.lB=function(){var e=this.U.D();if(a.T.Lc(e))return e=new a.Xa(this.U.description),e.Bc(this.U,!0),this.U=e,this.lB();if(this.Da<=this.ka)if(a.T.SO(e)){if(0>=this.Da&&(e=new a.i,this.U.o(e),e.aa()<=2*-this.Da||e.ba()<=2*this.Da))return new a.Ka(this.U.description)}else return new a.Ka(this.U.description);switch(this.U.D()){case 33:return this.tK();case 550:return this.sK();case 1607:return this.vK();case 1736:return this.uK();case 197:return this.qK();
default:throw a.g.wa();}};n.prototype.vK=function(){if(this.oD(this.U)){var g=new a.Va;this.U.Sd(0,g);var h=new a.i;this.U.o(h);g.ic(h.Af());return this.Es(g)}this.U=this.SQ(this.U);g=new e(this,this.Yo);return a.wi.local().$(g,this.Pi,this.Yb).next()};n.prototype.uK=function(){if(0==this.Da)return this.U;var e=a.as.local();this.Ss();this.U=e.$(this.U,null,!1,this.Yb);if(0>this.Da){var h=this.U,h=this.Gv(h,0,h.ea());return e.$(h,this.Pi,!1,this.Yb)}if(this.oD(this.U))return e=new a.Va,this.U.Sd(0,
e),h=new a.i,this.U.o(h),e.ic(h.Af()),this.Es(e);e=new g(this);return a.wi.local().$(e,this.Pi,this.Yb).next()};n.prototype.Gv=function(e,g,h){for(var c=new a.Ka(e.description);g<h;g++)if(!(1>e.Ha(g))){var b=e.oo(g),y=new a.i;e.Ti(g,y);if(0<this.Da)if(0<b)if(this.pD(e,g))b=new a.Va,e.Sd(e.Ea(g),b),b.ic(y.Af()),this.us(c,b);else{var d=b=new a.Xa(e.description),d=a.Tr.sD(this.U,g)||2==this.sm(this.U,g,d,!0,1)?this.jB(e,g):this.rm(b);c.add(d,!1)}else{if(!(y.aa()+this.ka<=2*this.hb||y.ba()+this.ka<=2*
this.hb||(d=b=new a.Xa(e.description),this.sm(this.U,g,d,!0,1),b.s()))){var F=new a.i;F.K(y);F.P(this.hb,this.hb);d.ws(F);d=this.rm(b);y=1;for(b=d.ea();y<b;y++)c.Zj(d,y,!0)}}else if(0<b){if(!(y.aa()+this.ka<=2*this.hb||y.ba()+this.ka<=2*this.hb||(d=b=new a.Xa(e.description),this.sm(this.U,g,d,!0,-1),b.s())))for(F=new a.i,d.dd(F),F.P(this.hb,this.hb),d.ws(F),d=this.rm(b),y=1,b=d.ea();y<b;y++)c.Zj(d,y,!0)}else for(d=b=new a.Xa(e.description),this.sm(this.U,g,d,!0,-1),d=this.rm(b),y=0,b=d.ea();y<b;y++)c.Zj(d,
y,!0)}if(0<this.Da)return 1<c.ea()?c=this.rm(c):n.Id(c);e=new a.i;c.dd(e);if(c.s())return n.Id(c);e.P(this.hb,this.hb);c.ws(e);c=this.rm(c);e=new a.Ka(c.description);y=1;for(b=c.ea();y<b;y++)e.Zj(c,y,!1);return n.Id(e)};n.prototype.tK=function(){return this.Es(this.U)};n.prototype.Es=function(e){var g=new a.Ka(this.U.description);this.us(g,e);return this.nS(g)};n.prototype.sK=function(){var e=new h(this.U,this.Da,this.Pi,this.Cj,this.mp,this.Yb);return a.wi.local().$(e,this.Pi,this.Yb).next()};n.prototype.qK=
function(){var e=new a.Ka(this.U.description);if(0>=this.Da){if(0==this.Da)e.Wc(this.U,!1);else{var g=new a.Vj;this.U.Fp(g);g.P(this.Da,this.Da);e.Wc(g,!1)}return e}e.Wc(this.U,!1);this.U=e;return this.jB(e,0)};n.prototype.jB=function(e,g){this.Ss();var h=new a.Ka(e.description),c=new a.b,b=new a.b,y=new a.b,d=new a.b,F=new a.b,A=new a.b,f=new a.b,k=new a.b,N=e.Ha(g),m=e.Ea(g),p=0;for(g=e.Ha(g);p<g;p++){e.w(m+p,b);e.w(m+(p+1)%N,d);e.w(m+(p+2)%N,A);f.pc(d,b);if(0==f.length())throw a.g.wa();f.tt();
f.normalize();f.scale(this.hb);c.add(f,b);y.add(f,d);0==p?h.Nr(c):h.Lm(c);h.Lm(y);k.pc(A,d);if(0==k.length())throw a.g.wa();k.tt();k.normalize();k.scale(this.hb);F.add(k,d);this.NA(h,d,y,F,!1)}return n.Id(h)};n.prototype.kB=function(e,g,h){this.Ss();if(1>e.Ha(g))return null;if(this.pD(e,g)&&0<this.Da){h=new a.Va;e.Sd(e.Ea(g),h);var n=new a.i;e.Ti(g,n);h.ic(n.Af());return this.Es(h)}n=new a.Xa(e.description);if(e.Oo(g))this.sm(e,g,n,h,1),this.sm(e,g,n,h,-1);else{var c=new a.Xa(e.description);c.Zj(e,
g,!1);c.ys(e,g,0,e.ct(g),!1);this.sm(c,0,n,h,1)}return this.rm(n)};n.prototype.rm=function(e){return a.Of.Qj(e,this.jr,!0,!0,this.Yb)};n.prototype.pB=function(){if(0==this.Cj)return this.mp;var e=1-this.Cj*Math.abs(this.wt),g;-1>e?g=4:g=2*Math.PI/Math.acos(e)+.5;4>g?g=4:g>this.mp&&(g=this.mp);return a.I.truncate(g)};n.prototype.NA=function(e,g,h,n,c){this.Ss();var b=new a.b;b.pc(h,g);b.scale(this.wt);var y=new a.b;y.pc(n,g);y.scale(this.wt);b=Math.atan2(b.y,b.x)/this.sx;0>b&&(b=this.sd.length+b);
b=this.sd.length-b;y=Math.atan2(y.y,y.x)/this.sx;0>y&&(y=this.sd.length+y);y=this.sd.length-y;y<b&&(y+=this.sd.length);var d=a.I.truncate(y),y=a.I.truncate(Math.ceil(b)),b=new a.b;b.J(this.sd[y%this.sd.length]);b.Fr(this.hb,g);var F=10*this.ka;b.sub(h);b.length()<F&&(y+=1);b.J(this.sd[d%this.sd.length]);b.Fr(this.hb,g);b.sub(n);b.length()<F&&--d;h=d-y;h++;d=0;for(y%=this.sd.length;d<h;d++,y=(y+1)%this.sd.length)b.J(this.sd[y]),b.Fr(this.hb,g),e.Lm(b);c&&e.Lm(n)};n.prototype.sm=function(e,g,h,n,c){var y=
new a.fd,d=y.QJ(e,g);y.xo(this.vx,!1,!1);if(2>y.F(d)){if(0>c)return 1;c=e;y=new a.Va;c.Sd(c.Ea(g),y);this.us(h,y);return 1}var F=y.Fa(y.Cb(y.Vb(d))),A=new a.Bg;A.Nn(-F.x,-F.y);y.Oe(A);if(n&&(this.MM(y,d,c),2>y.F(d))){if(0>c)return 1;c=e;y=new a.Va;c.Sd(c.Ea(g),y);this.us(h,y);return 1}this.Jd.length=0;var f=y.Vb(d);g=y.Cb(f);var k=1==c?y.Ua(g):y.X(g);e=1==c?y.X(g):y.Ua(g);var N=!0;n=new a.b;for(var d=new a.b,m=new a.b,p=new a.b,r=new a.b,Y=new a.b,u=new a.b,U=new a.b,v=new a.b,q=new a.b,x=this.hb,
f=y.Ha(f),D=0;D<f;D++)y.w(e,d),N&&(y.w(g,n),y.w(k,m),U.pc(n,m),U.normalize(),q.zD(U),q.scale(x),p.add(q,n)),u.pc(d,n),u.normalize(),v.zD(u),v.scale(x),r.add(n,v),k=U.Ai(u),N=U.ml(u),0>k||0>N&&0==k?this.Jd.push(b.Ks(p,r,n,2,this.Jd.length+1,this.Jd.length-1)):p.ub(r)||(this.Jd.push(b.Oa(p,n,this.Jd.length+1,this.Jd.length-1,"dummy")),this.Jd.push(b.Oa(n,r,this.Jd.length+1,this.Jd.length-1,"dummy"))),Y.add(d,v),this.Jd.push(b.Ks(r,Y,n,1,this.Jd.length+1,this.Jd.length-1)),p.J(Y),q.J(v),m.J(n),n.J(d),
U.J(u),k=g,g=e,N=!1,e=1==c?y.X(g):y.Ua(g);this.Jd[this.Jd.length-1].Rg=0;this.Jd[0].Ug=this.Jd.length-1;this.UQ(h);A.Nn(F.x,F.y);h.ZA(A,h.ea()-1);return 1};n.prototype.UQ=function(e){for(var a=this.aL(),g=!0,h=a+1,n=a;h!=a;n=h){var c=this.Jd[n],h=-1!=c.Rg?c.Rg:(n+1)%this.Jd.length;0!=c.qn&&(g&&e.Nr(c.Fl),2==c.qn?this.NA(e,c.Lt,c.Fl,c.Ql,!0):e.Lm(c.Ql),g=!1)}};n.prototype.aL=function(){null==this.Vq&&(this.Vq=[null,null,null,null,null,null,null,null,null]);for(var e=0,g=0,h=this.Jd.length;g<h;){var n=
this.Jd[g];if(0!=(n.qn&3)){e=g;break}g=n.Rg}h=e+1;for(g=e;h!=e;g=h){for(var n=this.Jd[g],h=n.Rg,c=1,b=null;h!=g;){b=this.Jd[h];if(0!=(b.qn&3))break;h=b.Rg;c++}1!=c&&1==(n.qn&b.qn)&&(null==this.Wq&&(this.Wq=new a.yb,this.Tt=new a.yb),this.Wq.ed(n.Fl),this.Wq.vd(n.Ql),this.Tt.ed(b.Fl),this.Tt.vd(b.Ql),1==this.Wq.Ga(this.Tt,this.Vq,null,null,this.jr)&&(n.Ql.J(this.Vq[0]),b.Fl.J(this.Vq[0]),n.Rg=h,b.Ug=g))}return e};n.prototype.rt=function(e,g,h){var n=new a.b;n.pc(h,e);h=n.length();h=this.hb*this.hb-
h*h*.25;if(0<h){h=Math.sqrt(h);n.normalize();n.Kp();var c=new a.b;c.pc(g,e);if(c.ml(n)+h>=this.hb)return!0}return!1};n.prototype.MM=function(e,g,h){for(var n=0;1>n;n++){var c=!1,b=e.Vb(g),y=e.Ha(b);if(0==y)break;var d=y;if(3>y)break;!e.vc(b)&&(d=y-1);for(var b=e.Cb(b),y=0<h?e.Ua(b):e.X(b),F=0<h?e.X(b):e.Ua(b),A=y,f=!0,k=new a.b,N=new a.b,m=new a.b,p=new a.b,r=new a.b,u=a.b.Oa(0,0),v=new a.b,U=new a.b,q=new a.b,x=new a.b,D=this.hb,B=0,t=0;t<d;){e.w(F,N);f&&(e.w(b,k),e.w(y,m),A=y);U.pc(k,m);U.normalize();
v.pc(N,k);v.normalize();if(A==F)break;var z=U.Ai(v),l=U.ml(v),C=!0;0>z||0>l&&0==z||!this.rt(m,k,N)||(u.J(N),C=!1,++B,c=!0);if(C){if(0<B)for(;;){z=0<h?e.Ua(A):e.X(A);if(z==b)break;e.w(z,p);if(this.rt(p,m,u))m.J(p),A=z,C=!1,++B;else{z!=F&&this.rt(p,m,N)&&this.rt(p,k,N)&&(m.J(p),A=z,C=!1,++B);break}}if(!C)continue;if(0<B){A=0<h?e.Ua(y):e.X(y);for(f=1;f<B;f++)C=0<h?e.Ua(A):e.X(A),e.vf(A,!0),A=C;q.pc(k,m);B=q.length();B=D*D-B*B*.25;B=Math.sqrt(B);D-B>.5*this.Cj?(r.add(m,k),r.scale(.5),q.normalize(),q.Kp(),
x.J(q),x.scale(D-B),r.add(x),e.Yi(y,r)):e.vf(y,!0);B=0}m.J(k);A=b}k.J(N);y=b;b=F;F=0<h?e.X(b):e.Ua(b);t++;f=!1}if(0<B){A=0<h?e.Ua(y):e.X(y);for(f=1;f<B;f++)C=0<h?e.Ua(A):e.X(A),e.vf(A,!0),A=C;r.add(m,k);r.scale(.5);q.pc(k,m);B=q.length();B=D*D-B*B*.25;B=Math.sqrt(B);q.normalize();q.Kp();x.J(q);x.scale(D-B);r.add(x);e.Yi(y,r)}e.xo(this.vx,!1,!1);if(!c)break}};n.prototype.pD=function(e,g){if(1==e.Ha(g))return!0;var h=new a.i;e.Ti(g,h);return Math.max(h.aa(),h.ba())<.5*this.Cj?!0:!1};n.prototype.oD=
function(e){var g=new a.i;e.o(g);return Math.max(g.aa(),g.ba())<.5*this.Cj?!0:!1};n.prototype.SQ=function(e){e=a.Sz.local().$(e,.25*this.Cj,!1,this.Yb);for(var g=0,h=0,n=e.ea();h<n;h++)g=Math.max(e.Ha(h),g);if(32>g)return this.Yo=!1,e;this.Yo=!0;return a.Of.Qj(e,this.jr,!1,!0,this.Yb)};n.prototype.us=function(e,g){g=g.w();if(null!=this.sd&&0!==this.sd.length){var h=new a.b;h.J(this.sd[0]);h.Fr(this.hb,g);e.Nr(h);for(var n=1,c=this.sd.length;n<c;n++)h.J(this.sd[n]),h.Fr(this.hb,g),e.Lm(h)}else for(var n=
this.pB(),h=a.I.truncate((n+3)/4),n=.5*Math.PI/h,c=Math.cos(n),b=Math.sin(n),y=new a.b,d=3;0<=d;d--)switch(y.ma(0,this.hb),d){case 0:for(n=0;n<h;n++)e.wj(y.x+g.x,y.y+g.y),y.Er(c,b);break;case 1:for(n=0;n<h;n++)e.wj(-y.y+g.x,y.x+g.y),y.Er(c,b);break;case 2:for(n=0;n<h;n++)e.wj(-y.x+g.x,-y.y+g.y),y.Er(c,b);break;default:for(e.Uy(y.y+g.x,-y.x+g.y),n=1;n<h;n++)y.Er(c,b),e.wj(y.y+g.x,-y.x+g.y)}};n.Id=function(e){e.hg(1,0);return e};n.prototype.nS=function(e){e.hg(2,this.ka);e.hl();return e};return n}();
a.UG=n})(B||(B={}));(function(a){var c=function(){function c(h){this.Qb=h;this.a=new a.fd;this.vg=new a.ga(0)}c.prototype.po=function(a,e,g){switch(e){case 0:if(a.v<g&&a.B<=g)break;else return a.v>=g?1:-1;case 1:if(a.C<g&&a.G<=g)break;else return a.C>=g?1:-1;case 2:if(a.v>=g&&a.B>g)break;else return a.B<=g?1:-1;case 3:if(!(a.C>=g&&a.G>g))return a.G<=g?1:-1}return 0};c.prototype.cL=function(a,e){return 1736==a.D()?this.dL(a,e):this.eL(a)};c.prototype.dL=function(h,e){if(0==this.Qb.aa()||0==this.Qb.ba())return h.Pa();
var g=new a.i;h.dd(g);this.U=this.a.Eb(h);var n=new a.i,c=new a.i,b=new a.b,d=new a.b,A=[0,0,0,0,0,0,0,0,0],f=[0,0,0,0,0,0,0,0,0];new a.Ag;var k=new a.yb,m=new a.ga(0);m.xb(Math.min(100,h.F()));for(var p=!1,r=0;!p&&4>r;r++){var u=!1,v=0!=(r&1),q=0;switch(r){case 0:q=this.Qb.v;u=g.v<=q&&g.B>=q;break;case 1:q=this.Qb.C;u=g.C<=q&&g.G>=q;break;case 2:q=this.Qb.B;u=g.v<=q&&g.B>=q;break;case 3:q=this.Qb.G,u=g.C<=q&&g.G>=q}if(u)for(p=!0,u=this.a.Vb(this.U);-1!=u;){var x=-1,D=-1,B=this.a.Cb(u),t=B;do{var z=
this.a.cc(t);null==z&&(z=k,this.a.w(t,b),z.ed(b),this.a.w(this.a.X(t),d),z.vd(d));z.o(n);var C=this.po(n,r,q),l=0,S=-1;if(-1==C){z=z.nt(v,q,A,f);0<z?l=this.a.Mr(t,f,z):l=0;for(var l=l+1,E=t,I=this.a.X(E),z=0;z<l;z++){this.a.w(E,b);this.a.w(I,d);S=this.a.cc(E);null==S&&(S=k,S.ed(b),S.vd(d));S.o(c);S=this.po(c,r,q);if(-1==S){if(v)S=Math.abs(b.y-q),G=Math.abs(d.y-q),S<G?(b.y=q,this.a.Yi(E,b)):(d.y=q,this.a.Yi(I,d));else{var S=Math.abs(b.x-q),G=Math.abs(d.x-q);S<G?(b.x=q,this.a.Yi(E,b)):(d.x=q,this.a.Yi(I,
d))}S=this.a.cc(E);null==S&&(S=k,S.ed(b),S.vd(d));S.o(c);S=this.po(c,r,q)}G=x;x=S;-1==D&&(D=x);if(0!=G||1!=x)1==G&&0==x||0!=G||0!=x||m.add(E);1==x&&(p=!1);S=E=I;I=this.a.X(I)}}if(0==l){G=x;x=C;-1==D&&(D=x);if(0!=G||1!=x)1==G&&0==x||0!=G||0!=x||m.add(t);1==x&&(p=!1);S=this.a.X(t)}t=S}while(t!=B);0==D&&0==x&&m.add(B);z=0;for(x=m.size;z<x;z++)D=m.get(z),this.a.vf(D,!1);m.clear(!1);u=3>this.a.Ha(u)?this.a.Cr(u):this.a.bc(u)}}if(p)return h.Pa();this.AR();0<e&&this.gM(e);return this.a.hf(this.U)};c.prototype.eL=
function(h){var e=new a.i,g=new a.i,n=[0,0,0,0,0,0,0,0,0],c=[0,0,0,0,0,0,0,0,0],b=new a.Ag,d=h,A=new a.i;h.dd(A);for(var f=0;4>f;f++){var k=!1,m=0!=(f&1),p=0;switch(f){case 0:p=this.Qb.v;k=A.v<=p&&A.B>=p;break;case 1:p=this.Qb.C;k=A.C<=p&&A.G>=p;break;case 2:p=this.Qb.B;k=A.v<=p&&A.B>=p;break;case 3:p=this.Qb.G,k=A.C<=p&&A.G>=p}if(k){k=d;d=h.Pa();k=k.Ca();k.Lk();for(var r,u=new a.b;k.kb();)for(var v,q=!0;k.La();){var x=k.ia();x.o(e);var D=this.po(e,f,p);if(-1==D){if(D=x.nt(m,p,n,c),0<D){var B=0;r=
x.Mb();for(var t=0;t<=D;t++)if(v=t<D?c[t]:1,B!=v){x.Bi(B,v,b);var z=b.get();z.ed(r);t<D&&(m?(u.x=n[t],u.y=p):(u.x=p,u.y=n[t]),z.vd(u));z.o(g);var l=this.po(g,f,p);if(-1==l){r=z.Mb();B=z.oc();if(m)l=Math.abs(r.y-p),C=Math.abs(B.y-p),l<C?(r.y=p,z.ed(r)):(B.y=p,z.vd(B));else{var l=Math.abs(r.x-p),C=Math.abs(B.x-p);l<C?(r.x=p,z.ed(r)):(B.x=p,z.vd(B))}z.o(g);l=this.po(g,f,p)}r=z.oc();B=v;v=l;1==v?(d.Bc(z,q),q=!1):q=!0}}}else v=D,1==v?(d.Bc(x,q),q=!1):q=!0}}}return d};c.prototype.AR=function(){this.vn=
-1;this.Nu(!1,this.Qb.v);this.Nu(!1,this.Qb.B);this.Nu(!0,this.Qb.C);this.Nu(!0,this.Qb.G);this.vg.resize(0);this.vg.xb(100);this.vn=this.a.re();for(var h=new a.b,e=this.a.Vb(this.U);-1!=e;e=this.a.bc(e))for(var g=this.a.Cb(e),n=0,c=this.a.Ha(e);n<c;n++,g=this.a.X(g))if(this.a.w(g,h),this.Qb.v==h.x||this.Qb.B==h.x||this.Qb.C==h.y||this.Qb.G==h.y)this.a.lb(g,this.vn,this.vg.size),this.vg.add(g);this.zu(!1,this.Qb.v);this.zu(!1,this.Qb.B);this.zu(!0,this.Qb.C);this.zu(!0,this.Qb.G);this.WM()};c.prototype.gM=
function(h){for(var e=new a.b,g=new a.b,n=a.I.Lh(2048,0),c=this.a.Vb(this.U);-1!=c;c=this.a.bc(c)){var b=this.a.Cb(c),d=b;do{var A=this.a.X(d);this.a.w(d,e);var f=-1;e.x==this.Qb.v?(this.a.w(A,g),g.x==this.Qb.v&&(f=1)):e.x==this.Qb.B&&(this.a.w(A,g),g.x==this.Qb.B&&(f=1));e.y==this.Qb.C?(this.a.w(A,g),g.y==this.Qb.C&&(f=0)):e.y==this.Qb.G&&(this.a.w(A,g),g.y==this.Qb.G&&(f=0));if(-1!=f&&(f=a.b.Fb(e,g),f=a.I.truncate(Math.min(Math.ceil(f/h),2048)),!(1>=f))){for(var k=1;k<f;k++)n[k-1]=1*k/f;this.a.Mr(d,
n,f-1)}d=A}while(d!=b)}};c.prototype.Nu=function(h,e){var g=this.a.re(),n=new a.b,c=new a.ga(0);c.xb(100);for(var b=this.a.Vb(this.U);-1!=b;b=this.a.bc(b))for(var d=this.a.Cb(b),A=0,f=this.a.Ha(b);A<f;A++){var k=this.a.X(d);this.a.w(d,n);if(h?n.y==e:n.x==e)if(this.a.w(k,n),h?n.y==e:n.x==e)1!=this.a.Ra(d,g)&&(c.add(d),this.a.lb(d,g,1)),1!=this.a.Ra(k,g)&&(c.add(k),this.a.lb(k,g,1));d=k}this.a.bf(g);if(!(3>c.size)){var m=this;c.xd(0,c.size,function(e,a){return m.kj(e,a)});g=new a.b;b=new a.b;d=new a.b;
b.Eh();for(var p=-1,A=new a.ga(0),f=new a.ga(0),k=this.a.re(),r=this.a.re(),u=0,v=c.size;u<v;u++){var q=c.get(u);this.a.w(q,n);if(!n.ub(b)){if(-1!=p){for(var x=p;x<u;x++){var p=c.get(x),D=this.a.X(p),q=this.a.Ua(p),B=!1;0>this.kj(p,D)&&(this.a.w(D,g),h?g.y==e:g.x==e)&&(A.add(p),B=!0,this.a.lb(p,r,1));0>this.kj(p,q)&&(this.a.w(q,g),h?g.y==e:g.x==e)&&(B||A.add(p),this.a.lb(p,k,1))}x=0;for(B=A.size;x<B;x++){p=A.get(x);q=this.a.Ra(p,k);D=this.a.Ra(p,r);if(1==q){q=this.a.Ua(p);this.a.w(q,d);var t=[0];
t[0]=0;if(!d.ub(n)){var z=a.b.Fb(b,d);t[0]=a.b.Fb(d,n)/z;0==t[0]?t[0]=2.220446049250313E-16:1==t[0]&&(t[0]=.9999999999999998);this.a.Mr(q,t,1);q=this.a.Ua(p);this.a.Yi(q,n);f.add(q);this.a.lb(q,k,1);this.a.lb(q,r,-1)}}1==D&&(D=this.a.X(p),this.a.w(D,d),t=[0],t[0]=0,d.ub(n)||(z=a.b.Fb(b,d),t[0]=a.b.Fb(b,n)/z,0==t[0]?t[0]=2.220446049250313E-16:1==t[0]&&(t[0]=.9999999999999998),this.a.Mr(p,t,1),q=this.a.X(p),this.a.Yi(q,n),f.add(q),this.a.lb(q,k,-1),this.a.lb(q,r,1)))}p=A;A=f;f=p;f.clear(!1)}p=u;b.J(n)}}this.a.bf(k);
this.a.bf(r)}};c.prototype.zu=function(h,e){var g=new a.b,n=new a.ga(0);n.xb(100);for(var c=this.a.re(),b=0,d=this.vg.size;b<d;b++){var A=this.vg.get(b);if(-1!=A){var f=this.a.X(A);this.a.w(A,g);if(h?g.y==e:g.x==e)if(this.a.w(f,g),h?g.y==e:g.x==e)-2!=this.a.Ra(A,c)&&(n.add(A),this.a.lb(A,c,-2)),-2!=this.a.Ra(f,c)&&(n.add(f),this.a.lb(f,c,-2))}}if(0!=n.size){var k=this;n.xd(0,n.size,function(e,a){return k.kj(e,a)});b=0;for(d=n.size;b<d;b++){var m=n.get(b);this.a.lb(m,c,b)}A=new a.b;f=new a.b;f.Eh();
for(var p=-1,b=0,d=n.size;b<d;b++)if(m=n.get(b),-1!=m&&(this.a.w(m,g),!g.ub(f))){if(-1!=p)for(;;){for(var m=!1,r=1<b-p?b-1:b,u=p;u<r;u++){var v=n.get(u);if(-1!=v){var q=-1,x=this.a.X(v);0>this.kj(v,x)&&(this.a.w(x,A),h?A.y==e:A.x==e)&&(q=x);var x=-1,D=this.a.Ua(v);0>this.kj(v,D)&&(this.a.w(D,A),h?A.y==e:A.x==e)&&(x=D);if(-1!=q&&-1!=x)this.no(v,n,c),this.a.vf(v,!1),this.no(q,n,c),this.a.vf(q,!1),m=!0;else if(-1!=q||-1!=x){for(D=u+1;D<b;D++){var B=n.get(D);if(-1!=B){var t=this.a.X(B),z=-1;0>this.kj(B,
t)&&(this.a.w(t,A),h?A.y==e:A.x==e)&&(z=t);var t=this.a.Ua(B),l=-1;0>this.kj(B,t)&&(this.a.w(t,A),h?A.y==e:A.x==e)&&(l=t);if(-1!=z&&-1!=l){this.no(B,n,c);this.a.vf(B,!1);this.no(z,n,c);this.a.vf(z,!1);m=!0;break}if(-1!=q&&-1!=l){this.dF(n,v,q,B,l,c);m=!0;break}else if(-1!=x&&-1!=z){this.dF(n,B,z,v,x,c);m=!0;break}}}if(m)break}}}if(!m)break}p=b;f.J(g)}}this.a.bf(c)};c.prototype.no=function(a,e,g){g=this.a.Ra(a,g);e.set(g,-1);g=this.a.Ra(a,this.vn);this.vg.set(g,-1);e=this.a.rd(a);-1!=e&&this.a.Cb(e)==
a&&(this.a.Dh(e,-1),this.a.Wi(e,-1))};c.prototype.dF=function(a,e,g,n,c,b){this.a.Sc(e,n);this.a.Tc(n,e);this.a.Tc(g,c);this.a.Sc(c,g);this.no(n,a,b);this.a.Ui(n,!1);this.no(c,a,b);this.a.Ui(c,!0)};c.prototype.WM=function(){for(var a=0,e=this.vg.size;a<e;a++){var g=this.vg.get(a);-1!=g&&this.a.im(g,-1)}for(var n=0,c=0,b=this.a.Vb(this.U);-1!=b;){var d=this.a.Cb(b);if(-1==d||b!=this.a.rd(d)){var A=b,b=this.a.bc(b);this.a.Dh(A,-1);this.a.yu(A)}else{g=d;A=0;do this.a.im(g,b),A++,g=this.a.X(g);while(g!=
d);2>=A?(g=this.a.Ra(d,this.vn),this.vg.set(g,-1),d=this.a.vf(d,!1),2==A&&(g=this.a.Ra(d,this.vn),this.vg.set(g,-1),this.a.vf(d,!1)),A=b,b=this.a.bc(b),this.a.Dh(A,-1),this.a.yu(A)):(this.a.Jr(b,!1),this.a.Wi(b,this.a.Ua(d)),this.a.hm(b,A),c+=A,n++,b=this.a.bc(b))}}a=0;for(e=this.vg.size;a<e;a++)if(g=this.vg.get(a),-1!=g&&(b=this.a.rd(g),-1==b)){b=this.a.Cf(this.U,-1);A=0;d=g;do this.a.im(g,b),A++,g=this.a.X(g);while(g!=d);2>=A?(g=this.a.Ra(d,this.vn),this.vg.set(g,-1),d=this.a.vf(d,!1),2==A&&(g=
this.a.Ra(d,this.vn),0<=g&&this.vg.set(g,-1),this.a.vf(d,!1)),A=b,this.a.Dh(A,-1),this.a.yu(A)):(this.a.Gn(b,!0),this.a.hm(b,A),this.a.Dh(b,d),this.a.Wi(b,this.a.Ua(d)),this.a.Jr(b,!1),c+=A,n++)}this.a.gm(this.U,n);this.a.Pk(this.U,c);a=0;for(e=this.a.$c;-1!=e;e=this.a.we(e))a+=this.a.F(e);this.a.ZF(a)};c.Xk=function(a,e,g){return(new c(e)).cL(a,g)};c.clip=function(h,e,g,n){if(h.s())return h;if(e.s())return h.Pa();g=h.D();if(33==g)return n=h.w(),e.contains(n)?h:h.Pa();if(197==g)return n=new a.i,h.o(n),
n.Ga(e)?(e=new a.Vj,h.copyTo(e),e.Cu(n),e):h.Pa();var b=new a.i;h.dd(b);if(e.contains(b))return h;if(!e.jc(b))return h.Pa();b=h.pb;if(null!=b&&(b=b.hi,null!=b)){b=b.Dn(e);if(1==b){if(1736!=g)throw a.g.wa();h=new a.Ka(h.description);h.ws(e);return h}if(0==b)return h.Pa()}switch(g){case 550:g=null;for(var b=h.F(),d=h.mc(0),A=0,f=0;f<b;f++)n=new a.b,d.ec(2*f,n),e.contains(n)||(0==A&&(g=h.Pa()),A<f&&g.Pd(h,A,f),A=f+1);0<A&&g.Pd(h,A,b);return 0==A?h:g;case 1736:case 1607:return c.Xk(h,e,n);default:throw a.g.wa();
}};c.prototype.kj=function(h,e){var g=new a.b;this.a.w(h,g);h=new a.b;this.a.w(e,h);return g.compare(h)};return c}();a.Ed=c})(B||(B={}));(function(a){var c=new a.b,b=function(){function e(e,h,c,b,d){this.Ml=new a.b;this.ln=new a.b;this.Ck=new a.b;this.a=e;this.Px=c;this.bn=b;this.Ml=h;this.vk=d;this.ln.Eh();this.Ck.Eh()}e.prototype.sB=function(e){this.a.w(e,this.ln);e=a.I.truncate((this.ln.x-this.Ml.x)*this.bn+.5);var g=a.I.truncate((this.ln.y-this.Ml.y)*this.bn+.5);return h.XC(e,g)};e.prototype.vw=
function(e){return this.a.Ra(e,this.vk)};return e}();a.wT=function(){return function(){}}();var h=function(){function e(){this.Ml=new a.b;this.Zo=[0,0,0,0];this.Kq=[0,0,0,0];this.en=this.vk=-1}e.zM=function(a,h){var g=new e;g.a=a;g.ka=h;g.Px=h*h;g.Kt=2*h;g.bn=1/g.Kt;return g.fL()};e.Vw=function(e,a,h,c,b){e-=h;a-=c;return e*e+a*a<=b};e.XC=function(e,h){return a.I.kg(h,a.I.kg(e))};e.prototype.hL=function(g,h){this.a.uc(g,c);for(var n=(c.y-this.Ml.y)*this.bn,b=a.I.truncate((c.x-this.Ml.x)*this.bn),
d=a.I.truncate(n),A=n=0;1>=A;A+=1)for(var f=0;1>=f;f+=1){var k=e.XC(b+A,d+f),m=this.uk.DN(k);-1!=m&&(this.Zo[n]=m,this.Kq[n]=k,n++)}for(b=n-1;1<=b;b--)for(m=this.Zo[b],d=b-1;0<=d;d--)if(m==this.Zo[d]){this.Kq[d]=-1;n--;b!=n&&(this.Kq[b]=this.Kq[n],this.Zo[b]=this.Zo[n]);break}for(d=0;d<n;d++)this.iL(g,this.Kq[d],c,this.Zo[d],h)};e.prototype.iL=function(g,h,c,b,d){for(var n=new a.b;-1!=b;b=this.uk.SN(b)){var y=this.uk.da(b);g==y||-1!=h&&this.a.Ra(y,this.vk)!=h||(this.a.uc(y,n),e.Vw(c.x,c.y,n.x,n.y,
this.Px)&&d.add(b))}};e.prototype.Tl=function(e,a,h){var g=this.a.Ra(e,this.en),n=this.a.Ra(a,this.en);-1==g&&(g=this.nd.jh(),this.nd.addElement(g,e),this.a.lb(e,this.en,g));-1==n?this.nd.addElement(g,a):this.nd.Qv(g,n);this.a.lb(a,this.en,-2);a=this.aQ(e,a);h&&(h=this.St.sB(e),this.a.lb(e,this.vk,h));return a};e.$P=function(g,h,c){g.lc(h);c=g;var n=new a.b;e.HH(g.w(),h.w(),n);c.ic(n)};e.HH=function(e,a,h){var g=e.x;e.x!=a.x&&(g=(1*e.x+1*a.x)/2);var n=e.y;e.y!=a.y&&(n=(1*e.y+1*a.y)/2);h.ma(g,n)};
e.prototype.aQ=function(e,h){var g=new a.b;this.a.w(e,g);var n=new a.b;this.a.w(h,n);var c=this.a.RC(e);h=this.a.RC(h);var b=c+h,d=0,A=g.x;g.x!=n.x&&(A=(g.x*c+n.x*h)/b,d++);var f=g.y;g.y!=n.y&&(f=(g.y*c+n.y*h)/b,d++);0<d&&this.a.ic(e,A,f);this.a.pS(e,b);return 0!=d};e.prototype.fL=function(){var e=this.a.pd,h=this.a.wC();this.Ml=h.yw();h=Math.max(h.ba(),h.aa())/2147483646;this.Kt<h&&(this.Kt=h,this.bn=1/this.Kt);this.nd=new a.Ur;this.nd.Dr(a.I.truncate(this.a.pd/3+1));this.nd.$l(a.I.truncate(this.a.pd/
3+1));this.vk=this.a.re();this.en=this.a.re();this.St=new b(this.a,this.Ml,this.Px,this.bn,this.vk);this.uk=new a.AH(a.I.truncate(4*e/3),this.St);this.uk.wR(this.a.pd);e=!1;for(h=this.a.$c;-1!=h;h=this.a.we(h))for(var c=this.a.Vb(h);-1!=c;c=this.a.bc(c))for(var d=this.a.Cb(c),A=0,f=this.a.Ha(c);A<f;A++){var k=this.St.sB(d);this.a.lb(d,this.vk,k);this.uk.addElement(d,k);d=this.a.X(d)}var m=new a.ga(0);m.xb(10);for(h=this.a.$c;-1!=h;h=this.a.we(h))for(c=this.a.Vb(h);-1!=c;c=this.a.bc(c))for(d=this.a.Cb(c),
A=0,f=this.a.Ha(c);A<f;A++){if(-2!=this.a.Ra(d,this.en))for(k=this.a.Ra(d,this.vk),this.uk.Jc(d,k);;){this.hL(d,m);if(0==m.size)break;for(var k=!1,p=0,r=m.size;p<r;p++){var u=m.get(p),v=this.uk.da(u);this.uk.kd(u);k=this.Tl(d,v,p+1==r)||k}e=e||k;m.clear(!1);if(!k)break}d=this.a.X(d)}e&&this.ZJ();this.St=this.uk=null;this.a.bf(this.vk);this.a.bf(this.en);return e};e.prototype.ZJ=function(){for(var e=new a.b,h=this.nd.Wd;-1!=h;h=this.nd.Cw(h)){var c=this.nd.gc(h);this.a.w(this.nd.da(c),e);for(c=this.nd.bb(c);-1!=
c;c=this.nd.bb(c))this.a.Yi(this.nd.da(c),e)}};return e}();a.Sr=h})(B||(B={}));(function(a){var c=Math.PI,b=2*Math.PI,h=Math.PI/2,e=function(){function e(){}e.yL=function(a,g){var h=new e;h.x=a;h.y=g;h.type=0;h.mh=0;return h};e.um=function(a){var g=new e;g.x=a.x;g.y=a.y;g.type=0;g.mh=0;return g};e.xL=function(a){var g=new e;g.x=a.x;g.y=a.y;g.type=a.type;g.mh=a.mh;return g};e.Ad=function(a,g,h){var n=new e;n.x=a.x+g*Math.cos(h);n.y=a.y+g*Math.sin(h);n.type=a.type;n.mh=a.mh;return n};e.Js=function(a,
g){var h=new e;h.x=.5*(a.x+g.x);h.y=.5*(a.y+g.y);h.type=a.type;h.mh=a.mh;return h};e.LB=function(a,g){var h=new e;h.x=a.x+.001*(g.x-a.x);h.y=a.y+.001*(g.y-a.y);h.type=a.type;h.mh=a.mh;return h};return e}(),g=function(){return function(){}}();(function(e){e[e.Round=0]="Round";e[e.Bevel=1]="Bevel";e[e.Miter=2]="Miter";e[e.Square=3]="Square"})(a.EH||(a.EH={}));var n=function(){function n(e){this.Kx=this.Ib=this.dg=null;this.oe=e}n.$=function(e,g,h,c,b,y){if(null==e)throw a.g.N();if(1>e.fb())throw a.g.N();
if(0==g||e.s())return e;y=new n(y);y.$m=e;y.Da=g;y.ka=b;y.bi=h;y.Dx=c;return y.hv()};n.prototype.hJ=function(){var e=this.$m,g=e.Mb(),h=e.oc(),n=new a.b;n.pc(h,g);n.normalize();n.tt();n.scale(this.Da);g.add(n);h.add(n);n=e.Pa();e.ed(g);e.vd(h);return n};n.prototype.gJ=function(){var e=this.$m;if(0<this.Da&&2!=this.bi){var g=new a.Ka;g.Wc(e,!1);this.$m=g;return this.hv()}e=new a.Vj(e.R);e.P(this.Da,this.Da);return e};n.prototype.rF=function(e,a,g,h){return(a.x-e.x)*(h.x-g.x)+(a.y-e.y)*(h.y-g.y)};n.prototype.Ub=
function(a,g){if(void 0===g)this.Ib.push(a),this.Xe++;else if(0==this.Xe)this.Ub(a);else{var n=this.eu,c,b;c=this.dg[0==g?n-1:g-1];b=this.dg[g];var y=this.rF(c,b,this.Ib[this.Xe-1],a);0<y?this.Ub(a):0>y&&(0<this.rF(c,b,b,this.Ib[this.Xe-1])?(b=this.dg[0==g?n-2:1==g?n-1:g-2],n=e.Ad(c,this.Da,Math.atan2(c.y-b.y,c.x-b.x)-h),this.Ib[this.Xe-1]=n,1==this.bi||2==this.bi?(n=e.Js(n,c),this.Ub(n),n=e.Ad(c,this.Da,this.vt+h),c=e.Js(n,c),c.type|=256,this.Ub(c)):(n=e.Ad(c,this.Da,this.vt+h),n.type|=256),this.Ub(n),
this.Ub(a,g)):(n=e.Ad(b,this.Da,this.vt+h),this.Ub(n),1==this.bi||2==this.bi?(n=e.Js(n,b),this.Ub(n),n=e.Ad(b,this.Da,this.gx-h),c=e.Js(n,b),c.type|=256,this.Ub(c)):(n=e.Ad(b,this.Da,this.gx-h),n.type|=256),this.Ub(n)))}};n.prototype.mB=function(){var g,n,y,d,A,f,k=this.eu;this.Xe=0;var m=.5*this.ka,p=0,r=0;for(g=0;g<k;g++){d=this.dg[g];A=0==g?this.dg[k-1]:this.dg[g-1];f=g==k-1?this.dg[0]:this.dg[g+1];var u=A.x-d.x,v=A.y-d.y,q=f.x-d.x,x=f.y-d.y;n=Math.atan2(v,u);y=Math.atan2(x,q);this.vt=n;this.gx=
y;0==g&&(p=n,r=y);u=u*x-q*v;v=y;y<n&&(y+=b);if(0<u*this.Da)1==this.bi||2==this.bi?(n=e.Ad(d,this.Da,n+h),this.Ub(n),n=e.LB(d,n),this.Ub(n),n=e.Ad(d,this.Da,y-h),d=e.LB(d,n),d.type|=256,this.Ub(d),this.Ub(n)):(u=.5*(y-n),u=this.Da/Math.abs(Math.sin(u)),n=e.Ad(d,u,.5*(n+y)),this.Ub(n,g));else if(0!=(d.type&512)){u=1-m/Math.abs(this.Da);A=1;f=0>this.Da?-c:c;-1<u&&1>u&&(v=2*Math.acos(u),.017453292519943295>v&&(v=.017453292519943295),A=a.I.truncate(c/v+1.5),1<A&&(f/=A));v=n+h;n=e.Ad(d,this.Da,v);0==g&&
(n.type|=1024);this.Ub(n,g);u=this.Da/Math.cos(f/2);v+=f/2;n=e.Ad(d,u,v);n.type|=1024;for(this.Ub(n);0<--A;)v+=f,n=e.Ad(d,u,v),n.type|=1024,this.Ub(n);n=e.Ad(d,this.Da,y-h);n.type|=1024;this.Ub(n)}else if(1==this.bi)n=e.Ad(d,this.Da,n+h),this.Ub(n,g),n=e.Ad(d,this.Da,y-h),this.Ub(n);else if(0==this.bi)for(u=1-m/Math.abs(this.Da),A=1,f=y-h-(n+h),-1<u&&1>u&&(v=2*Math.acos(u),.017453292519943295>v&&(v=.017453292519943295),A=a.I.truncate(Math.abs(f)/v+1.5),1<A&&(f/=A)),u=this.Da/Math.cos(.5*f),v=n+h+
.5*f,n=e.Ad(d,u,v),this.Ub(n,g);0<--A;)v+=f,n=e.Ad(d,u,v),this.Ub(n);else 2==this.bi?(u=A.x-d.x,v=A.y-d.y,q=f.x-d.x,x=f.y-d.y,A=(u*q+v*x)/Math.sqrt(u*u+v*v)/Math.sqrt(q*q+x*x),.99999999<A?(n=e.Ad(d,1.4142135623730951*this.Da,y-.25*c),this.Ub(n,g),n=e.Ad(d,1.4142135623730951*this.Da,y+.25*c),this.Ub(n)):(A=Math.abs(this.Da/Math.sin(.5*Math.acos(A))),f=Math.abs(this.Dx*this.Da),A>f?(u=.5*(y-n),u=this.Da/Math.abs(Math.sin(u)),n=e.Ad(d,u,.5*(n+y)),y=a.b.Oa(n.x,n.y),n=a.b.Oa(d.x,d.y),d=new a.b,d.pc(y,
n),y=new a.b,y.DR(f/d.length(),d,n),n=(A-f)*Math.abs(this.Da)/Math.sqrt(A*A-this.Da*this.Da),0<this.Da?d.tt():d.Kp(),d.scale(n/d.length()),n=new a.b,n.add(y,d),A=new a.b,A.pc(y,d),n=e.um(n),this.Ub(n,g),n=e.um(A),this.Ub(n)):(u=.5*(y-n),u=this.Da/Math.abs(Math.sin(u)),n=e.Ad(d,u,.5*(n+y)),this.Ub(n,g)))):(y=v,0<this.Da?(y>n&&(y-=b),A=n-y<h):(y<n&&(y+=b),A=y-n<h),A?(u=1.4142135623730951*this.Da,v=0>u?n+.25*c:n+.75*c,n=e.Ad(d,u,v),this.Ub(n,g),v=0>u?y-.25*c:y-.75*c,n=e.Ad(d,u,v),this.Ub(n)):(u=.5*(y-
n),u=this.Da/Math.abs(Math.sin(u)),y<n&&(y+=b),n=e.Ad(d,u,(n+y)/2),this.Ub(n,g)))}this.vt=p;this.gx=r;this.Ub(this.Ib[0],0);d=e.xL(this.Ib[this.Xe-1]);this.Ib[0]=d;return this.sR()};n.prototype.xs=function(e,g){if(!(2>g))for(var h=0;h<g;h++){var n=this.Ib[e+h];0!=h?this.Kx.Lm(a.b.Oa(n.x,n.y)):this.Kx.Nr(a.b.Oa(n.x,n.y))}};n.prototype.iJ=function(a,g,h){var n=a.Ea(g),c=a.Dc(g);this.Ib=[];this.Kx=h;if(a.vc(g)){for(g=a.Fa(n);a.Fa(c-1).ub(g);)c--;if(2<=c-n){this.eu=c-n;this.dg=[];for(g=n;g<c;g++)this.dg.push(e.um(a.Fa(g)));
this.mB()&&this.xs(0,this.Xe-1)}}else{for(g=a.Fa(n);n<c&&a.Fa(n+1).ub(g);)n++;for(g=a.Fa(c-1);n<c&&a.Fa(c-2).ub(g);)c--;if(2<=c-n){this.eu=2*(c-n)-2;this.dg=[];h=e.um(a.Fa(n));h.type|=1536;this.dg.push(h);for(g=n+1;g<c-1;g++)h=e.um(a.Fa(g)),this.dg.push(h);h=e.um(a.Fa(c-1));h.type|=512;this.dg.push(h);for(g=c-2;g>=n+1;g--)h=e.um(a.Fa(g)),h.type|=1024,this.dg.push(h);if(this.mB())if(2<=this.Ib.length){a=-1;(c=0!=(this.Ib[this.Xe-1].type&1024))||(a=0);for(g=1;g<this.Xe;g++)(n=0!=(this.Ib[g].type&1024))?
c||(c=g-1,1<c-a+1&&this.xs(a,c-a+1)):c&&(a=g-1),c=n;c||(c=this.Xe-1,1<c-a+1&&this.xs(a,c-a+1))}else a=0,c=this.Xe-1,0<=a&&1<=c-a&&this.xs(a,c-a+1)}}this.dg=null;this.eu=0;this.Ib=null;this.Xe=0};n.prototype.sR=function(){for(var e=!1,a=0;a<this.Xe;a++){var g=this.Ib[a];g.Rg=a+1;g.Ug=a-1;this.Ib[a]=g}g=this.Ib[0];g.Ug=this.Xe-2;this.Ib[0]=g;g=this.Ib[this.Xe-2];g.Rg=0;this.Ib[this.Xe-2]=g;for(a=g=0;a<this.Xe;a++)if(0!=(this.Ib[g].type&256)){var h=this.$L(g);if(-1!=h)g=h;else{e=!0;break}}else g=this.Ib[g].Rg;
if(e)return!1;this.vL(g);return!0};n.prototype.$L=function(e){for(var a=this.Xe-1,g=e,h,n,c=1;c<=a-2;c++){h=g=this.Ib[g].Rg;n=e;for(var b=1;b<=c;b++){n=this.Ib[n].Ug;if(0==(this.Ib[n].type&256)&&0==(this.Ib[h].type&256)){var y=this.oO(n,h);if(-1!=y)return y}h=this.Ib[h].Ug}}return-1};n.prototype.oO=function(e,h){var n,c,b,y;n=this.Ib[this.Ib[e].Ug];c=this.Ib[e];b=this.Ib[this.Ib[h].Ug];y=this.Ib[h];if(!this.HR(n,c,b,y))return-1;var d=new g;return this.NM(n,c,b,y,d)&&!d.cB&&a.I.bG((c.x-n.x)*(y.y-b.y)-
(c.y-n.y)*(y.x-b.x))!=a.I.bG(this.Da)?(n=this.Ib[e].Ug,d.Xl.type=c.type,d.Xl.Rg=h,d.Xl.Ug=n,this.Ib[e]=d.Xl,d.Xl=this.Ib[h],d.Xl.Ug=e,this.Ib[h]=d.Xl,h):-1};n.prototype.HR=function(e,a,g,h){return Math.max(e.x,a.x)>=Math.min(g.x,h.x)&&Math.max(g.x,h.x)>=Math.min(e.x,a.x)&&Math.max(e.y,a.y)>=Math.min(g.y,h.y)&&Math.max(g.y,h.y)>=Math.min(e.y,a.y)};n.prototype.NM=function(a,g,h,n,c){c.cB=!1;var b,y,d;b=(g.y-a.y)*(n.x-h.x)-(g.x-a.x)*(n.y-h.y);y=(h.y-a.y)*(g.x-a.x)-(h.x-a.x)*(g.y-a.y);b=0==b?2:y/b;return 0<=
b&&1>=b&&(d=b,b=(n.y-h.y)*(g.x-a.x)-(n.x-h.x)*(g.y-a.y),y=(a.y-h.y)*(n.x-h.x)-(a.x-h.x)*(n.y-h.y),b=0==b?2:y/b,0<=b&&1>=b)?(c.Xl=e.yL(a.x+b*(g.x-a.x),a.y+b*(g.y-a.y)),c.Xl.mh=h.mh+d*(n.mh-h.mh),0!=d&&1!=d||0!=b&&1!=b||(c.cB=!0),c.wU=b,c.xU=d,(0==d||1==d)&&0<b&&1>b||(0==b||1==b)&&0<d&&1>d?!1:!0):!1};n.prototype.vL=function(e){for(;this.Ib[e].Ug<e;)e=this.Ib[e].Ug;var a=0,g=e;do g=this.Ib[g],this.Ib[a]=g,g=g.Rg,a++;while(g!=e);this.Ib[a]=this.Ib[0];this.Xe=a+1};n.prototype.qA=function(e){var a=this.$m,
g=a.Ca();if(null!=g){g.Lk();for(var h=-1;g.kb();)h++,this.iJ(a,h,e)}};n.prototype.hv=function(){var e=this.$m.D();return 322==e?this.hJ():197==e?this.gJ():a.T.Lc(e)?(e=new a.Xa,e.Bc(this.$m,!0),this.$m=e,this.hv()):1607==e?(e=new a.Xa,this.qA(e),e):1736==e?(e=new a.Ka,this.qA(e),e):null};return n}();a.XG=n})(B||(B={}));(function(a){var c=function(){function e(e){this.xj=e}e.prototype.w=function(e,a){this.xj.a.w(e,a)};e.prototype.kd=function(e){var a=this.xj.za.da(e);this.xj.za.kd(e,-1);this.xj.a.vf(a,
!1)};return e}(),b=function(){function e(e){this.xj=e}e.prototype.w=function(e,a){this.xj.NP.w(e,a)};e.prototype.kd=function(e){this.xj.za.kd(e,-1)};return e}(),h=function(){function e(e){this.xj=e}e.prototype.w=function(e,a){a.J(this.xj.PP[e])};e.prototype.kd=function(e){this.xj.za.kd(e,-1)};return e}(),e=function(){function e(e){void 0===e?(this.za=new a.bj,this.za.de(20),this.a=new a.fd,this.FP=this.a.jg(550),this.cr=this.a.Cf(this.FP,-1),this.oh=new c(this)):e instanceof Array?(this.za=new a.bj,
this.za.de(20),this.PP=e,this.oh=new h(this)):(this.za=new a.bj,this.za.de(20),this.NP=e,this.oh=new b(this))}e.prototype.Eb=function(e){var g=e.D();if(a.Wr.Th(g))this.OJ(e);else if(a.al.Lc(g))this.SJ(e);else if(197==g)this.LJ(e);else if(33==g)this.RJ(e);else throw a.g.N("invalid shape type");};e.prototype.sN=function(){var e=new a.Va,g=this.za.gc(-1),h=new a.Ka(this.a.wp);this.a.Jk(this.za.da(g),e);h.df(e);for(g=this.za.bb(g);-1!=g;g=this.za.bb(g))this.a.Jk(this.za.da(g),e),h.lineTo(e);return h};
e.wL=function(g){var h=new e(g),n=g.F(),c=1,b=new a.b,d=new a.b,A=new a.b;for(g.w(0,b);;){g.w(c,d);if(!(d.Ww(b)&&c<n-1))break;c++}h.za.addElement(0,-1);h.za.qm(c);for(n=c+1;n<g.F();n++)g.w(n,A),c=h.cz(A),-1!=c&&h.za.Vi(c,n);A=new a.Va;c=h.za.gc(-1);n=new a.Ka(g.description);g.Sd(h.za.da(c),A);n.df(A);for(c=h.za.bb(c);-1!=c;c=h.za.bb(c))g.Sd(h.za.da(c),A),n.lineTo(A);return n};e.Oa=function(a,g,h){for(var n=new e(a),c=1,b=a[0];a[c].Ww(b)&&c<g-1;)c++;n.za.addElement(0,-1);n.za.qm(c);for(c+=1;c<g;c++)b=
n.cz(a[c]),-1!=b&&n.za.Vi(b,c);a=0;for(g=n.za.gc(-1);-1!=g;g=n.za.bb(g))h[a++]=n.za.da(g);return a};e.sD=function(g,h){var n=g.Ea(h),c=g.Dc(h);h=!g.vc(h)&&g.Oo(h);g=g.mc(0);n*=2;c*=2;h&&(c-=2);if(6>c-n)return!0;h=new a.b;var b=new a.b,y=new a.b;g.ec(n,h);g.ec(n+2,b);g.ec(n+4,y);var d=e.Bd(b,y,h);if(d.Dq()||!e.ac(d.value()))return!1;for(var A=a.b.Oa(b.x,b.y),f=new a.b,n=n+6;n<c;n+=2){f.J(b);b.J(y);g.ec(n,y);d=e.Bd(b,y,h);if(d.Dq()||!e.ac(d.value()))return!1;d=e.Bd(A,y,h);if(d.Dq()||!e.ac(d.value()))return!1;
d=e.Bd(b,y,f);if(d.Dq()||!e.ac(d.value()))return!1}return!0};e.prototype.OJ=function(e){for(var g=new a.Va,h=new a.b,n=0;n<e.F();n++){e.w(n,h);var c=this.hq(h);if(-1!=c){e.Sd(n,g);var b=this.a.Ub(this.cr,g);this.za.Vi(c,b)}}};e.prototype.LJ=function(e){for(var g=new a.Va,h=new a.b,n=0;4>n;n++){e.vu(n,h);var c=this.hq(h);if(-1!=c){e.uf(n,g);var b=this.a.Ub(this.cr,g);this.za.Vi(c,b)}}};e.prototype.SJ=function(e){var g=new a.Va,h=e.Mb(),h=this.hq(h);if(-1!=h){e.En(g);var n=this.a.Ub(this.cr,g);this.za.Vi(h,
n)}h=e.oc();h=this.hq(h);-1!=h&&(e.Bn(g),e=this.a.Ub(this.cr,g),this.za.Vi(h,e))};e.prototype.RJ=function(e){var a=e.w(),a=this.hq(a);-1!=a&&(e=this.a.Ub(this.cr,e),this.za.Vi(a,e))};e.prototype.hq=function(e){var a=-1;if(0==this.za.size(-1))return a=this.za.addElement(-4,-1);if(1==this.za.size(-1)){var g=this.a.Fa(this.za.da(this.za.gc(-1)));e.Ww(g)||(a=this.za.qm(-5));return a}return a=this.cz(e)};e.prototype.cz=function(g){var h=-1,n=this.za.gc(-1),c=this.za.tc(-1),b=this.za.da(n),d=this.za.da(c),
A=new a.b,f=new a.b;this.oh.w(b,A);this.oh.w(d,f);b=a.b.yn(f,g,A);if(e.ac(b))h=this.za.qm(-1),A=this.az(g,c,n),A!=n&&this.bz(g,n,this.za.ge(A));else if(e.ti(b)){for(var f=this.za.dt(-1),k=this.za.gc(-1),m=this.za.tc(-1),p,b=new a.b,d=new a.b;k!=this.za.ge(m);)p=this.za.da(f),this.oh.w(p,b),p=a.b.yn(b,g,A),e.ti(p)?(m=f,f=this.za.ik(f)):(k=f,f=this.za.Jo(f));f=m;A=k;p=this.za.da(f);k=this.za.da(A);this.oh.w(p,b);this.oh.w(k,d);if(A==n||(b=a.b.yn(d,g,b),e.ac(b)))h=this.za.vs(A,f,-2,!1),this.bz(g,f,c),
this.az(g,A,n)}else null==this.ib&&(this.ib=new a.yb),this.ib.ed(f),this.ib.vd(A),A=this.ib.Gd(g,!0),0>A?(A=this.za.ge(c),this.za.kd(c,-1),h=this.za.qm(-3),this.az(g,A,n)):1<A&&(A=this.za.bb(n),this.za.kd(n,-1),h=this.za.vs(-1,A,-3,!1),this.bz(g,A,c));return h};e.prototype.bz=function(g,h,c){if(h!=c){var n=this.za.da(h),b=this.za.bb(h),y=new a.b,d=new a.b;for(this.oh.w(n,y);h!=c&&2<this.za.size(-1);){this.oh.w(this.za.da(b),d);n=a.b.yn(d,g,y);if(e.ac(n))break;n=h;h=b;y.J(d);b=this.za.bb(h);this.oh.kd(n)}}};
e.prototype.az=function(g,h,c){if(h==c)return c;var n=this.za.da(h),b=this.za.ge(h),y=new a.b,d=new a.b;for(this.oh.w(n,y);h!=c&&2<this.za.size(-1);){this.oh.w(this.za.da(b),d);n=a.b.yn(y,g,d);if(e.ac(n))break;n=h;h=b;y.J(d);b=this.za.ge(h);this.oh.kd(n)}return h};e.Bd=function(e,g,h){var n=new a.$k;n.set(g.x);n.sub(e.x);var c=new a.$k;c.set(h.y);c.sub(e.y);var b=new a.$k;b.set(g.y);b.sub(e.y);g=new a.$k;g.set(h.x);g.sub(e.x);n.Ap(c);b.Ap(g);n.sub(b);return n};e.ac=function(e){return 0>e};e.ti=function(e){return 0<
e};e.ao=function(e){return 0==e};return e}();a.Tr=e})(B||(B={}));(function(a){var c=function(){function c(a){this.oe=this.a=null;this.WD=!0;this.oe=a}c.HE=function(h,e,g){h=a.Ia.As(h);return a.Sr.Vw(e.lk(),e.mk(),g.lk(),g.mk(),a.vi.Ty(h))};c.gL=function(h,e){var g=new a.Va;a.Sr.$P(h,e,g);return g};c.$=function(a,e,g,n){g=new c(g);g.a=a;g.ka=e;g.WD=n;return g.rJ()};c.prototype.lJ=function(h){return a.Sr.zM(this.a,h)};c.prototype.oJ=function(h){return a.Zu.$(this.a,h,this.oe)};c.prototype.rJ=function(){for(var h=
this.ka,e=a.Ia.As(h),h=a.Ia.UJ(h),g=1.00001*h,h=1.000001*h,n=!1,c=30<this.a.pd+10?1E3:(this.a.pd+10)*(this.a.pd+10),b=0,d=this.a.pO();;b++){if(b>c)throw a.g.ra("Internal Error: max number of iterations exceeded");var A=this.lJ(e),n=n||A;this.WD&&(A=0!=this.a.xo(e,!0,!1),n=n||A);A=!1;if(0==b||d||a.Zu.DE(!0,this.a,h,null,this.oe))A=this.oJ(g),n=n||A;if(!A)break}return n};return c}();a.aj=c})(B||(B={}));(function(a){var c=function(){function c(a){this.Ld=this.zc=null;this.Yb=a;this.hx=!0}c.prototype.et=
function(a,e){var g=this.a.cc(a);if(null==g){if(!this.a.Oc(a,e))return null;g=e}return g};c.prototype.LL=function(){var h=this.a.Gp(!1),e=!1,g=new a.yb,n=new a.yb,c=new a.i;c.Ja();var b=new a.i;b.Ja();for(var d=new a.Va,A=new a.gA,f=h.next();-1!=f;f=h.next()){var k=null,m=!1;if(!a.T.Km(this.a.Lb(h.mj))){k=this.et(f,g);if(null==k)continue;k.o(c);c.P(this.ka,this.ka);if(k.mg(this.ka))if(k.mg(0))m=!0,k=null;else continue}var p=this.a.Gp(h),r=p.next();for(-1!=r&&(r=p.next());-1!=r;r=p.next()){var u=null,
v=!1;if(!a.T.Km(this.a.Lb(p.mj))){u=this.et(r,n);if(null==u)continue;u.o(b);if(u.mg(this.ka))if(u.mg(0))v=!0,u=null;else continue}var q=0,x=0;if(null!=k&&null!=u)c.rD(b)&&(A.zn(k),A.zn(u),A.Ga(this.ka,!1),q=A.kk(0),x=A.kk(1),0<q+x&&(this.a.Tp(f,A,0,!0),this.a.Tp(r,A,1,!0)),A.clear());else if(null!=k){var D=new a.b;this.a.w(r,D);if(c.contains(D)){A.zn(k);this.a.Jk(r,d);A.Tw(this.ka,d,!1);q=A.kk(0);if(0<q)if(this.a.Tp(f,A,0,!0),v){v=-1;for(D=this.a.X(r);-1!=D&&D!=r&&(u=this.et(D,n),v=D,null!=u&&u.mg(0));D=
this.a.X(D));for(D=r;-1!=D&&(this.a.bh(D,A.nf),D!=v);D=this.a.X(D));}else this.a.bh(r,A.nf);A.clear()}}else if(null!=u){if(D=new a.b,this.a.w(f,D),b.P(this.ka,this.ka),b.contains(D)){A.zn(u);this.a.Jk(f,d);A.Tw(this.ka,d,!1);x=A.kk(0);if(0<x)if(this.a.Tp(r,A,0,!0),m){v=-1;for(D=this.a.X(f);-1!=D&&D!=f&&(u=this.et(D,n),v=D,null!=u&&u.mg(0));D=this.a.X(D));for(D=f;-1!=D&&(this.a.bh(D,A.nf),D!=v);D=this.a.X(D));}else this.a.bh(f,A.nf);A.clear()}}else continue;if(0!=q+x){if(0!=q){k=this.a.cc(f);if(null==
k){if(!this.a.Oc(f,g))continue;k=g;g.o(c)}else k.o(c);if(k.mg(this.ka))break}e=!0}}}return e};c.prototype.ML=function(){return this.HQ()};c.prototype.HQ=function(){return(new a.aA).GS(this.a,this.ka)};c.prototype.EE=function(){var h=!1,e,g;null==this.zc&&(this.zc=new a.bj);var n=new a.ga(0);n.xb(this.a.pd+1);for(var c=this.a.Gp(),b=c.next();-1!=b;b=c.next())n.add(b);this.a.Mu(n,n.size);n.add(-1);c=this.a.re();b=this.a.re();this.Ld=new a.hA(this.a,this.ka,!this.hx);this.zc.Hn(this.Ld);var d=new a.ga(0),
A=new a.ga(0),f=0;new a.b;var k=this.a.cd;this.a.wb.kc();for(var m=this.a.wb.Ba[0].f,p,r,u=n.get(f++);-1!=u;){r=k.O(u,0);p=m[2*r];r=m[2*r+1];var v=p,q=r;do{var x=k.O(u,2),D=k.O(u,1);-1!=x&&(e=k.O(x,0),g=m[2*e],e=m[2*e+1],0>(q<e?-1:q>e?1:v<g?-1:v>g?1:0)&&(A.add(u),A.add(x)));-1!=D&&(e=k.O(D,0),g=m[2*e],e=m[2*e+1],0>(q<e?-1:q>e?1:v<g?-1:v>g?1:0)&&(A.add(D),A.add(D)));g=this.a.Ra(u,c);-1!=g&&(d.add(g),this.a.lb(u,c,-1));g=this.a.Ra(u,b);-1!=g&&(d.add(g),this.a.lb(u,b,-1));u=n.get(f++);-1!==u&&(q=k.O(u,
0),v=m[2*q],q=m[2*q+1])}while(-1!=u&&v===p&&q===r);v=1==d.size&&2==A.size;g=q=-1;x=0;for(D=d.size;x<D;x++){e=d.get(x);var B=this.zc.ge(e);-1==B||d.Nw(B)||(q=B);e=this.zc.bb(e);-1==e||d.Nw(e)||(g=e);if(-1!=q&&-1!=g)break}this.Ld.XF(r,p);x=0;for(D=d.size;x<D;x++)e=d.get(x),this.zc.kd(e,-1);d.clear(!1);if(!v&&-1!=q&&-1!=g&&this.SK(q,g)){h=!0;this.ei=this.Ld.rl();break}x=0;for(D=A.size;x<D;x+=2){r=A.get(x);p=A.get(x+1);v?(r=this.zc.vs(q,g,r,!0),v=!1):r=this.zc.addElement(r,-1);if(this.Ld.Zf){this.ei=
this.Ld.rl();h=!0;break}-1==this.a.Ra(p,c)?this.a.lb(p,c,r):this.a.lb(p,b,r)}if(h)break;A.cf(0)}this.a.bf(c);this.a.bf(b);return h};c.prototype.SK=function(a,e){this.Ld.compare(this.zc,this.zc.da(a),e);a=this.Ld.Zf;this.Ld.lq();return a};c.Gh=function(h){for(var e=h.$c;-1!=e;e=h.we(e))if(a.T.Kc(h.Lb(e)))return!0;return!1};c.Yk=function(a,e,g,n){if(!c.Gh(a))return!1;e=new c(n);e.a=a;e.ka=g;if(15>a.pd)a=e.LL();else return e.ML();return a};c.$=function(a,e,g){return c.Yk(a,a.wC(),e,g)};c.DE=function(h,
e,g,n,b){if(!c.Gh(e))return!1;var y=new c(b);y.a=e;y.ka=g;y.hx=h;if(y.EE())return null!=n&&n.aq(y.ei),!0;var d=new a.Bg;d.Oy();e.Oe(d);y=new c(b);y.a=e;y.ka=g;y.hx=h;h=y.EE();d.Oy();e.Oe(d);return h?(null!=n&&n.aq(y.ei),!0):!1};return c}();a.Zu=c})(B||(B={}));(function(a){(function(e){e[e.Left=0]="Left";e[e.Right=1]="Right";e[e.Coincident=2]="Coincident";e[e.Undefined=3]="Undefined";e[e.Uncut=4]="Uncut"})(a.ZG||(a.ZG={}));var c=function(){return function(e,a,h,c,b,d,A,f,k,m,p){this.U=e;this.cu=a;
this.Yq=h;this.ag=c;this.Il=m;this.xk=p}}();a.yT=c;var b=function(){function e(e,a){this.jE=e;this.Zh=a}e.prototype.nJ=function(e,g){var h=new a.b;this.Zh.w(e,h);var n=new a.b;this.Zh.w(g,n);h=h.compare(n);if(0!=h)return h;h=this.Zh.Ra(e,this.jE);n=this.Zh.Ra(g,this.jE);return h<n?-1:h==n?0:1};return e}(),h=function(){return function(e,a,h,c,b,d,A,f,k){this.ag=e;this.Yq=a;this.Lx=h;this.sE=c;this.Wh=b;this.xk=d;this.Il=A;this.tE=f;this.RP=k}}();a.xT=h;var e=function(){function e(){}e.YG=function(g,
h,b,d,A,f){if(h.s())g=new c(h,4,-1,-1,NaN,4,-1,-1,NaN,-1,-1,NaN,-1,-1,NaN),A.push(g);else{var n=new a.fd;n.Eb(h);n.Eb(b);a.aj.$(n,d,f,!0);h=0;b=n.re();for(d=n.$c;-1!=d;d=n.we(d))for(f=n.Vb(d);-1!=f;f=n.bc(f))for(var y=n.Cb(f),k=0,F=n.Ha(f);k<F;y=n.X(y),k++)n.lb(y,b,h++);h=e.qM(b,n);e.CI(g,h,n,A)}};e.qM=function(g,h){for(var n=h.pd,c=new a.ga(0),y=h.$c;-1!=y;y=h.we(y))for(var d=h.Vb(y);-1!=d;d=h.bc(d))for(var A=h.Cb(d),f=0,k=h.Ha(d);f<k;A=h.X(A),f++)c.add(A);var m=new b(g,h);c.xd(0,n,function(e,a){return m.nJ(e,
a)});g=[];var p=[],r=h.re(),u=h.re(),y=h.$c,d=h.we(y),k=new a.b,v=new a.b,q=c.get(0),x=h.rd(q),D=h.Vf(x);h.w(q,k);for(var B=1,A=0;B<n-1;){for(var t=!1,f=B;f<n;f++)if(f!=A){var z=c.get(f),l=h.rd(z),C=h.Vf(l);h.w(z,v);if(k.ub(v))D==y&&C==d&&(t=e.SI(r,u,h,g,p,x,q,l,z));else break}if(t||A==B-1){t&&A==B-1&&B--;if(++A==n)break;q=c.get(A);x=h.rd(q);D=h.Vf(x);h.w(q,k)}t||(B=A+1)}n=[];for(y=h.$c;-1!=y;y=h.we(y))for(d=h.Vb(y);-1!=d;d=h.bc(d))for(c=h.Cb(d),f=0,k=h.Ha(d);f<k;c=h.X(c),f++){A=h.Ra(c,u);if(0<=A)for(;A<
p.length&&p[A].ag==c;)n.push(p[A++]);A=h.Ra(c,r);if(0<=A)for(;A<g.length&&g[A].ag==c;)n.push(g[A++])}h.bf(r);h.bf(u);return n};e.SI=function(a,g,h,c,b,d,A,f,k){var n=h.hk(d),y=h.hk(f),F=h.Cb(d),m=h.Cb(f),p=h.Ua(A),r=h.Ua(k),N=!1,u=!1,v=!1,q=!1;A!=F&&(k!=m&&(N=e.VI(a,h,c,d,p,f,r)),k!=y&&(u=e.YI(a,h,c,d,p,f,k)));A!=n&&(k!=m&&(v=e.aJ(g,h,b,d,A,f,r,F)),k!=y&&(q=e.dJ(g,h,b,d,A,f,k,F)));N&&u&&v?(a=c.length-1,2==b[q?b.length-2:b.length-1].Wh&&(c[a-1]=c[a],--c.length)):N&&u&&q&&2==b[b.length-1].Wh&&(b=c[c.length-
1],--c.length,h.Ra(b.ag,a)==c.length&&h.lb(b.ag,a,-1));return N||u||v||q};e.VI=function(e,g,c,b,d,A,f){var n,y;y=new a.yb;var k=new a.yb,F=[0,0],m=[0,0];n=g.cc(d);null==n&&(g.Oc(d,y),n=y);y=g.cc(f);null==y&&(g.Oc(f,k),y=k);n=n.Ga(y,null,F,m,0);2>n&&(b=new h(d,b,F[0],NaN,n,f,A,m[0],NaN),c.push(b),b=g.Ra(d,e),0>b&&g.lb(d,e,c.length-1));return!0};e.YI=function(e,g,c,b,d,A,f){var n,y;y=new a.yb;var k=new a.yb,F=[0,0],m=[0,0];n=g.cc(d);null==n&&(g.Oc(d,y),n=y);y=g.cc(f);null==y&&(g.Oc(f,k),y=k);n=n.Ga(y,
null,F,m,0);return 2>n?(b=new h(d,b,F[0],NaN,n,f,A,m[0],NaN),c.push(b),b=g.Ra(d,e),0>b&&g.lb(d,e,c.length-1),!0):!1};e.aJ=function(e,g,c,b,d,A,f,k){var n,y;y=new a.yb;var F=new a.yb,m=[0,0],p=[0,0];n=g.cc(d);null==n&&(g.Oc(d,y),n=y);y=g.cc(f);null==y&&(g.Oc(f,F),y=F);n=n.Ga(y,null,m,p,0);if(2==n)return b=new h(d,b,m[0],m[1],n,f,A,p[0],p[1]),c.push(b),b=g.Ra(d,e),0>b&&g.lb(d,e,c.length-1),!0;F=!1;d==k&&(b=new h(d,b,m[0],NaN,n,f,A,p[0],NaN),c.push(b),b=g.Ra(d,e),0>b&&g.lb(d,e,c.length-1),F=!0);return F};
e.dJ=function(e,g,c,b,d,A,f,k){var n,y;y=new a.yb;var F=new a.yb,m=[0,0],p=[0,0];n=g.cc(d);null==n&&(g.Oc(d,y),n=y);y=g.cc(f);null==y&&(g.Oc(f,F),y=F);n=n.Ga(y,null,m,p,0);if(2==n)return b=new h(d,b,m[0],m[1],n,f,A,p[0],p[1]),c.push(b),b=g.Ra(d,e),0>b&&g.lb(d,e,c.length-1),!0;F=!1;d==k&&(b=new h(d,b,m[0],NaN,n,f,A,p[0],NaN),c.push(b),b=g.Ra(d,e),0>b&&g.lb(d,e,c.length-1),F=!0);return F};e.CI=function(g,h,b,d){var n,y=[];y[0]=new a.b;y[1]=new a.b;y[2]=new a.b;y[3]=new a.b;var A=new a.b,f=new a.b,k=
new a.b,F=new a.b,m=null;null!=d&&(m=new a.Ag,m.mq());var p,r=0,N=null,u=new a.yb;new a.yb;for(var v=b.Vb(b.$c);-1!=v;v=b.bc(v)){var q,x=4,D=-1,B,t,z,l=-1,C,S,E,I,G=-1,H=-1,K=NaN;q=!0;var J=!1,w=!0,P=!0,O=!0,V=0;z=v;C=0;for(var L=b.Cb(v),T=b.Ha(v),M=0;M<T;L=b.X(L),M++){p=b.cc(L);if(null==p){if(!b.Oc(L,u))continue;p=u}-1==l&&(l=L);for(var Q=0;r<h.length&&L==h[r].ag;){D=h[r].Yq;B=h[r].ag;t=h[r].Lx;S=h[r].Il;E=h[r].xk;I=h[r].tE;if(2==h[r].Wh){if(J||(z=D,l=B,C=t,G=S,H=E,K=I,x=2,null!=d?N=new a.Xa:V=0,
O=!1,P=!0),t=h[r].sE,I=h[r].RP,null!=d?(p.Bi(Q,h[r].sE,m),N.Bc(m.get(),P)):V++,Q=t,J=!0,P=q=!1,r+1==h.length||2!=h[r+1].Wh||h[r+1].ag==B&&h[r+1].Lx!=Q)null!=d?(n=new c(N,2,D,B,t,x,z,l,C,S,E,I,G,H,K),d.push(n)):null.add(V),z=D,l=B,C=t,G=S,H=E,K=I,x=2,J=q=!1,P=O=!0}else{var R=b.X(B);if(r<h.length-1&&h[r+1].ag==R&&h[r+1].xk==E&&2==h[r+1].Wh)t!=Q&&(O&&(null!=d?N=new a.Xa:V=0),q=0<r&&h[r-1].Yq==D?1==x?0:0==x?1:3:3,null!=d?(p.Bi(Q,t,m),N.Bc(m.get(),P),n=new c(N,q,D,B,t,x,z,l,C,S,E,I,G,H,K),d.push(n)):(V++,
null.add(V)),Q=t,z=D,l=B,C=t,G=S,H=E,K=I,x=q,q=w=!1,P=O=!0);else if(!e.KK(g,b,h,r,A,f)){e.KG(b,h,r,v,L,k,F);var fa=!1,R=!1;n=!0;if(!(A.ub(k)||f.ub(k)||A.ub(F)||f.ub(F))){y[0].J(A);y[1].J(f);y[2].J(k);y[3].J(F);y.sort(a.b.cq);var xa=y[0],ya=y[1],za=y[2],Aa=y[3];xa.ub(A)?ya.ub(f)?g?(R=fa=!0,n=!1):fa=!1:Aa.ub(f)?g?n=R=fa=!0:fa=!1:(fa=!0,n=ya.ub(k)):ya.ub(A)?za.ub(f)?g?(R=fa=!0,n=!1):fa=!1:xa.ub(f)?g?n=R=fa=!0:fa=!1:(fa=!0,n=za.ub(k)):za.ub(A)?Aa.ub(f)?g?(R=fa=!0,n=!1):fa=!1:ya.ub(f)?g?n=R=fa=!0:fa=!1:
(fa=!0,n=Aa.ub(k)):xa.ub(f)?g?(R=fa=!0,n=!1):fa=!1:za.ub(f)?g?n=R=fa=!0:fa=!1:(fa=!0,n=xa.ub(k))}if(fa){fa=L==B;if(t!=Q||fa&&0==Q)O&&(null!=d?N=new a.Xa:V=0),null!=d?(p.Bi(Q,t,m),N.Bc(m.get(),P)):V++;if(n)if(1!=x){if(t!=Q||fa&&0==Q)null!=d?(n=new c(N,1,D,B,t,x,z,l,C,S,E,I,G,H,K),d.push(n)):null.add(V);if(!R)x=1;else if(r==h.length-2||h[r+2].Yq!=D)x=0}else{if(t!=Q||fa&&0==Q)null!=d?(n=new c(N,3,D,B,t,x,z,l,C,S,E,I,G,H,K),d.push(n)):null.add(V);x=1}else if(0!=x){if(t!=Q||fa&&0==Q)null!=d?(n=new c(N,
0,D,B,t,x,z,l,C,S,E,I,G,H,K),d.push(n)):null.add(V);if(!R)x=0;else if(r==h.length-2||h[r+2].Yq!=D)x=1}else{if(t!=Q||fa&&0==Q)null!=d?(n=new c(N,3,D,B,t,x,z,l,C,S,E,I,G,H,K),d.push(n)):null.add(V);x=0}if(t!=Q||fa&&0==Q)Q=t,z=D,l=B,C=t,G=S,H=E,K=I,q=w=!1,P=O=!0}}}r++}1!=Q&&(O&&(null!=d?N=new a.Xa:V=0),null!=d?(p.Bi(Q,1,m),N.Bc(m.get(),P)):V++,P=O=!1,w=!0)}w&&(t=1,B=b.hk(v),B=b.Ua(B),E=S=-1,I=NaN,q?null!=d?(n=new c(N,4,D,B,t,x,z,l,C,S,E,I,G,H,K),d.push(n)):null.add(V):(q=1==x?0:0==x?1:3,null!=d?(n=new c(N,
q,D,B,t,x,z,l,C,S,E,I,G,H,K),d.push(n)):null.add(V)))}};e.KK=function(g,h,c,b,d,A){var n=c[b].tE;if(1==n)return e.GJ(g,h,c,b,d,A);if(0==n)return e.dK(g,h,c,b,d,A);throw a.g.wa();};e.GJ=function(e,g,h,c,b,d){var n=new a.yb,y=h[c].ag,A=h[c].Il,f=h[c].xk,k=-1,F=-1,m=-1,p=-1;if(!e&&0<c)var r=h[c-1],k=r.ag,F=r.Il,m=r.xk,p=r.Wh;var N=-1,u=-1,v=-1,q=-1;c<h.length-1&&(r=h[c+1],N=r.ag,u=r.Il,v=r.xk,q=r.Wh);var x=g.X(y),r=g.X(f);if(!e)return 0<c&&k==y&&F==A&&m==r&&2==p||c<h.length-1&&N==x&&u==A&&v==r&&2==q?
(e=g.cc(f),null==e&&(g.Oc(f,n),e=n),d.J(e.Pf(1)),b.qr(d),d.normalize(),b.normalize(),!1):c<h.length-1&&N==y&&u==A&&v==r?(e=g.cc(f),null==e&&(g.Oc(f,n),e=n),b.J(e.Pf(1)),e=g.cc(r),null==e&&(g.Oc(r,n),e=n),d.J(e.Pf(0)),b.Bp(),d.normalize(),b.normalize(),!1):!0;if(c==h.length-1||N!=y||u!=A||v!=r||2==q)return e=g.cc(f),null==e&&(g.Oc(f,n),e=n),d.J(e.Pf(1)),b.qr(d),d.normalize(),b.normalize(),!1;e=g.cc(f);null==e&&(g.Oc(f,n),e=n);b.J(e.Pf(1));e=g.cc(r);null==e&&(g.Oc(r,n),e=n);d.J(e.Pf(0));b.Bp();d.normalize();
b.normalize();return!1};e.dK=function(e,g,h,c,b,d){var n=new a.yb,y=h[c].ag,A=h[c].Il,f=h[c].xk,k=-1,F=-1,m=-1,p=-1;if(!e&&c<h.length-1)var r=h[c+1],k=r.ag,F=r.Il,m=r.xk,p=r.Wh;var u=-1,N=-1,v=-1,r=-1;0<c&&(r=h[c-1],u=r.ag,N=r.Il,v=r.xk,r=r.Wh);var q=g.X(y),x=g.Ua(f);return e?0==c||u!=y||N!=A||v!=x||2==r?(e=g.cc(f),null==e&&(g.Oc(f,n),e=n),d.J(e.Pf(0)),b.qr(d),d.normalize(),b.normalize(),!1):!0:0<c&&u==y&&N==A&&v==x&&2==r||c<h.length-1&&k==q&&F==A&&m==x&&2==p?(e=g.cc(f),null==e&&(g.Oc(f,n),e=n),d.J(e.Pf(0)),
b.qr(d),d.normalize(),b.normalize(),!1):!0};e.KG=function(e,g,h,c,b,d,A){var n=new a.yb,y=e.cc(b);null==y&&(e.Oc(b,n),y=n);h=g[h];g=h.ag;h=h.Lx;b=e.X(g);if(1==h)d.J(y.Pf(1)),-1!=b&&b!=e.hk(c)?(y=e.cc(b),null==y&&(e.Oc(b,n),y=n),A.J(y.Pf(0)),y=e.cc(g),null==y&&e.Oc(g,n)):A.J(d),d.Bp(),A.normalize(),d.normalize();else if(0==h)A.J(y.Pf(h)),d.qr(A),A.normalize(),d.normalize();else throw a.g.wa();};return e}();a.$G=e})(B||(B={}));(function(a){(function(e){e[e.Linear=0]="Linear";e[e.Angular=1]="Angular";
e[e.Area=2]="Area"})(a.RI||(a.RI={}));var c=function(){function e(e,a,g){this.Nc=a;this.Dj=g;this.wx=e}e.PC=function(a){return 0!==a.Nc?null:-1===a.wx?new e(-1,2,a.Dj*a.Dj):e.Qd(n[a.wx])};e.Qd=function(e){e=g[e];return void 0===e?null:e};e.EL=function(a,g,h){var n=null;if(void 0!==h&&null!==h)try{"EPSG"===h.values[0]&&(n=e.Qd(parseInt(h.values[1])))}catch(ca){}null===n&&(n=new e(-1,a,g));return n};e.prototype.Qc=function(){return this.wx};e.prototype.rC=function(e){if(e.Nc!=this.Nc)throw a.g.xa();
return this.Dj/e.Dj};e.ih=function(e,a,g){return a.rC(g)*e};e.OB=function(e,a,g,h,n){g=g.rC(h);for(h=0;h<a;h++)n[h]=e[h]*g};return e}();a.Tb=c;for(var b=[109402,4046.8564224,109403,4046.87260987425,109463,100,109401,1E4,109461,225E8,109460,25E8,109451,1E-4,109444,404.68564224000005,109424,404.6849341289498,109428,404.68493792602754,109416,404.67838076760535,109420,404.68423895571647,109448,404.683871963536,109411,404.6872609874253,109450,.01,109408,3.34450944,109405,.09290304,109430,.09290354800069446,
109423,.0929028774400711,109427,.09290287831176021,109441,.09290349665192114,109407,.09290137299531805,109440,.09290286332673177,109431,.09290274144751023,109432,.09290207073852812,109433,.09290279616016,109434,.09290273520025,109419,.09290271785025629,109447,.0929026336004445,109406,.09290341161327487,109453,6.4516E-4,109454,6.451625806477421E-4,109414,1E6,109445,.04046856422400001,109425,.04046849341289498,109429,.04046849379260275,109417,.04046783807676053,109421,.04046842389557164,109449,.0404683871963536,
109412,.04046872609874253,109404,1,109410,1.000027193184865,109413,2589998.4703195216,109452,1E-6,109409,3429904,109458,3434290.937856,109457,3434528.1495040003,109464,1.244521604938272E-7,109455,25.292852640000003,109456,25.29295381171408,109459,2.89612324,109439,2589988.110336,109462,.7168473118308245,109442,.83612736,109422,.83612589696064,109426,.836125904805842,109415,.8361123569578626,109435,.836124673027592,109436,.836118636646753,109437,.8361251654414399,109438,.83612461680225,109418,.8361244606523066,
109446,.8361237024040001,109443,.8361307045194736],h=[9103,2.908882086657216E-4,9104,4.84813681109536E-6,9102,.0174532925199433,9106,.01570796326794897,9105,.01570796326794897,9109,1E-6,9114,9.817477042468104E-4,1031,4.84813681109536E-9,9112,1.570796326794897E-4,9101,1,9113,1.570796326794897E-6],e=[109031,15E4,109461,109030,5E4,109460,1033,.01,109451,9097,20.1168,109444,9052,20.1167824,109424,9062,20.116782494375872,109428,9038,20.1166195164,109416,9042,20.116765121552632,109420,9301,20.116756,109448,
9033,20.11684023368047,109411,109005,.1,109450,9014,1.8288,109408,9002,.3048,109405,9070,.3048008333333334,109430,9051,.3047997333333333,109423,9061,.3047997347632708,109427,9095,.3048007491,109441,9005,.3047972654,109407,9094,.3047997101815088,109440,9080,.3047995102481469,109431,9081,.30479841,109432,9082,.3047996,109433,9083,.3047995,109434,9041,.304799471538676,109419,9300,.3047993333333334,109447,9003,.3048006096012192,109406,109008,.0254,109453,109009,.0254000508001016,109454,9036,1E3,109414,
9098,.201168,109445,9053,.201167824,109425,9063,.2011678249437587,109429,9039,.201166195164,109417,9043,.2011676512155263,109421,9302,.20116756,109449,9034,.2011684023368047,109412,9001,1,109404,9031,1.0000135965,109410,9035,1609.3472186944375,109413,1025,.001,109452,9030,1852,109409,109013,1853.184,109458,109012,1853.248,109457,109016,3.527777777777778E-4,109464,109010,5.0292,109455,109011,5.029210058420118,109456,109014,1.7018,109459,9093,1609.344,109439,109015,.8466683600033867,109462,9096,.9144,
109442,9050,.9143992,109422,9060,.9143992042898124,109426,9037,.9143917962000001,109415,9084,.9143985307444408,109435,9085,.91439523,109436,9086,.9143988,109437,9087,.9143985,109438,9040,.9143984146160287,109418,9099,.914398,109446,109002,.9144018288036576,109443,109001,.9144,109442,109003,20.1168,109444,109004,.201168,109445,109006,.01,109451,109007,.001,109452],g=[],n=[],y=0;y<b.length;y+=2)g[b[y]]=new c(b[y],2,b[y+1]);b=null;for(y=0;y<h.length;y+=2)g[h[y]]=new c(h[y],1,h[y+1]);h=null;for(y=0;y<
e.length;y+=3)g[e[y]]=new c(e[y],0,e[y+1]),n[e[y]]=e[y+2];e=null})(B||(B={}));(function(a){var c=function(){function a(){}a.prototype.set=function(a,e){void 0!==e?(this.Lf=a,this.Og=e):"number"===typeof a?(this.Lf=a,this.Og=0):(this.Lf=a.Lf,this.Og=a.Og)};a.prototype.value=function(){return this.Lf};a.prototype.sub=function(a){if("number"===typeof a){var e=this.Lf-a;a=this.Og+2.220446049250313E-16*Math.abs(e)}else e=this.Lf-a.Lf,a=this.Og+a.Og+2.220446049250313E-16*Math.abs(e);this.Lf=e;this.Og=a};
a.prototype.Ap=function(a){var e=this.Lf*a.Lf;this.Og=this.Og*Math.abs(a.Lf)+a.Og*Math.abs(this.Lf)+this.Og*a.Og+2.220446049250313E-16*Math.abs(e);this.Lf=e};a.prototype.eP=function(){return Math.abs(this.Lf)<=this.Og};a.prototype.Dq=function(){return this.eP()&&0!=this.Og};return a}();a.$k=c})(B||(B={}));var I=new B.b,G=new B.b,H=new B.b,K=new B.b,J=new B.b;(function(a){var c;(function(a){a[a.closedPath=1]="closedPath";a[a.exteriorPath=2]="exteriorPath";a[a.ringAreaValid=4]="ringAreaValid"})(c||
(c={}));var b=function(){function h(e,a,h,c,b,d,f){void 0!==a?(this.ab=e,this.mj=a,this.$j=h,this.zh=c,this.ua=d,this.mx=f,this.Pt=b):(this.ab=e.ab,this.mj=e.mj,this.$j=e.$j,this.zh=e.zh,this.ua=e.ua,this.mx=e.mx,this.Pt=e.Pt);this.JD=!0}h.prototype.next=function(){return this.JD?(this.JD=!1,this.zh):-1!=this.zh?(this.zh=this.ab.X(this.zh),this.ua++,-1!=this.zh&&this.zh!=this.Pt?this.zh:this.cQ()):-1};h.prototype.cQ=function(){this.$j=this.ab.bc(this.$j);for(this.ua=0;-1!=this.mj;){for(;-1!=this.$j;this.$j=
this.ab.bc(this.$j))if(this.Pt=this.zh=this.ab.Cb(this.$j),-1!=this.zh)return this.zh;this.mj=this.ab.we(this.mj);if(-1==this.mj)break;if(!this.mx||a.T.Kc(this.ab.Lb(this.mj)))this.$j=this.ab.Vb(this.mj)}return-1};h.UL=function(e,a,n,c,b,d,f){return new h(e,a,n,c,b,d,f)};return h}();a.CT=b;c=function(){function h(){this.Zm=this.Al=this.Ej=this.Mc=this.Jj=this.jn=this.fi=this.Rc=this.sh=this.wg=this.Ge=this.wp=this.zp=this.wb=this.Hk=null;this.Xt=this.$c=-1;this.pd=0;this.kx=!1;this.wp=this.zp=this.wb=
null}h.prototype.Fi=function(e){return null!=this.Ge?this.Ge[e]:null};h.prototype.Fh=function(e,a){if(null==this.Ge){if(null==a)return;this.Ge=[];for(var g=0,h=this.wb.F();g<h;g++)this.Ge.push(null)}this.Ge[e]=a};h.prototype.Mn=function(e,a){this.Rc.L(e,1,a)};h.prototype.Ln=function(e,a){this.Rc.L(e,2,a)};h.prototype.Iy=function(e,a){this.Rc.L(e,6,a)};h.prototype.Ho=function(e){return this.Rc.O(e,6)};h.prototype.Hu=function(e,a){this.Rc.L(e,7,a)};h.prototype.bt=function(e){return this.Rc.O(e,0)};
h.prototype.MF=function(e,a){this.Mc.L(e,1,a)};h.prototype.QF=function(e,a){this.Mc.L(e,0,a)};h.prototype.xC=function(e){return this.Mc.O(e,7)};h.prototype.Jn=function(e,a){this.Mc.L(e,3,a)};h.prototype.Kn=function(e,a){this.Mc.L(e,4,a)};h.prototype.jQ=function(e){null==this.Mc&&(this.Mc=new a.Fc(8));var g=this.Mc.be();this.Mc.L(g,2,e);this.Mc.L(g,5,0);this.Mc.L(g,6,0);this.Mc.L(g,7,g);return g};h.prototype.bN=function(e){this.Mc.Jc(e)};h.prototype.lQ=function(e){null==this.Rc&&(this.Rc=new a.Fc(8),
this.cd=new a.Fc(5),this.fi=new a.qd(0),this.jn=new a.qd(0));var g=this.Rc.be();this.Rc.L(g,0,g);this.Rc.L(g,3,0);this.Rc.L(g,6,0);this.Hu(g,e);g>=this.fi.size&&(e=16>g?16:a.I.truncate(3*g/2),this.fi.resize(e),this.jn.resize(e));this.fi.set(g,0);this.jn.set(g,0);return g};h.prototype.iC=function(e){this.Rc.Jc(e)};h.prototype.dw=function(e){this.cd.Jc(e);this.pd--};h.prototype.mQ=function(e){null==this.Rc&&(this.Rc=new a.Fc(8),this.cd=new a.Fc(5),this.fi=new a.qd(0),this.jn=new a.qd(0));var g=this.cd.be(),
h=0<=e?e:g;this.cd.L(g,0,h);if(0>e){if(h>=this.wb.F()){e=16>h?16:a.I.truncate(3*h/2);this.wb.resize(e);if(null!=this.Ge)for(var c=0;c<e;c++)this.Ge.push(null);null!=this.wg&&this.wg.resize(e);this.zp=this.wb.mc(0)}this.wb.ic(h,-1E38,-1E38);null!=this.Ge&&(this.Ge[h]=null);null!=this.wg&&this.wg.write(h,1)}this.cd.L(g,4,2*h);this.pd++;return g};h.prototype.vl=function(e,a,h){var g=-1!=a?this.Ua(a):this.hk(e),n=-1!=g?this.X(g):-1,c=this.mQ(null==h?this.pd:-1),b=this.gb(c);null!=h&&this.wb.Iu(b,h);this.im(c,
e);this.Sc(c,n);this.Tc(c,g);-1!=n&&this.Tc(n,c);-1!=g&&this.Sc(g,c);h=this.vc(e);g=this.Cb(e);-1==a&&this.Wi(e,c);a==g&&this.Dh(e,c);h&&-1==n&&(this.Sc(c,c),this.Tc(c,c));this.hm(e,this.Ha(e)+1);e=this.Vf(e);this.Pk(e,this.F(e)+1);return c};h.prototype.Fo=function(){null==this.Zm&&(this.Zm=new a.Va(this.wb.description));return this.Zm};h.prototype.Pp=function(e,a){this.Mc.L(e,2,this.Mc.O(e,2)&-134217729||(1==a?134217728:0))};h.prototype.Cm=function(e){return 0!=(this.Mc.O(e,2)&134217728)?1:0};h.prototype.MJ=
function(e){var a=this.jg(e.D(),e.description);1736==e.D()&&this.Pp(a,e.Cm());this.WA(a,e);return a};h.prototype.NJ=function(e){var a=this.jg(e.D(),e.description);this.XA(a,e);return a};h.prototype.TQ=function(e,g){null==this.Rc&&(this.Rc=new a.Fc(8),this.cd=new a.Fc(5),this.fi=new a.qd(0),this.jn=new a.qd(0));this.Rc.de(this.Rc.Xc+e);this.cd.de(this.cd.Xc+g);this.fi.xb(this.fi.size+e);this.jn.xb(this.jn.size+e)};h.prototype.WA=function(e,g){this.TQ(g.ea(),g.F());this.Hk.Pd(g,0,g.F());this.zp=this.wb.mc(0);
for(var h=null!=this.Ge&&null!=g.Fe,c=0,b=g.ea();c<b;c++)if(!(2>g.Ha(c))){var d=this.Cf(e,-1);this.Gn(d,g.vc(c));for(var f=g.Ea(c),A=g.Dc(c);f<A;f++){var k=this.vl(d,-1,null);if(h)if(k=this.gb(k),0!=(g.NC(f)&1))this.Fh(k,null);else{var m=new a.Ag;g.cc(f,m,!0);this.Fh(k,m.get())}}}};h.prototype.XA=function(e,a){this.Hk.Pd(a,0,a.F());this.zp=this.wb.mc(0);e=this.Cf(e,-1);var g=0;for(a=a.F();g<a;g++)this.vl(e,-1,null)};h.prototype.DS=function(e,g,h){var n=this.X(e);if(-1==n)throw a.g.wa();for(var c=
this.Fo(),b=this.rd(e),d=0,f=g.kk(h);d<f;d++){var A=this.gb(e),k=this.X(e),m=g.Io(h,d);0==d&&(m.En(c),this.bh(e,c));322==m.D()?this.Fh(A,null):this.Fh(A,a.T.Yj(m));m.Bn(c);d<f-1?e=this.vl(b,k,c):this.bh(n,c)}};h.prototype.CS=function(e,g,h){var n=this.X(e);if(-1==n)throw a.g.wa();for(var c=this.Fo(),b=this.rd(e),d=0,f=g.kk(h);d<f;d++){var A=this.gb(e),k=this.X(e),m=g.Io(h,f-d-1);0==d&&(m.Bn(c),this.bh(e,c));322==m.D()?this.Fh(A,null):this.Fh(A,a.T.Yj(m));m.En(c);d<f-1?e=this.vl(b,k,c):this.bh(n,c)}};
h.prototype.wC=function(){var e=new a.i;e.Ja();for(var g=this.Gp(),h=new a.b,c=!0,b=g.next();-1!=b;b=g.next())this.w(b,h),c?e.Db(h.x,h.y):e.Oj(h.x,h.y),c=!1;return e};h.prototype.Eb=function(e){var g=e.D();if(a.T.Kc(g))return this.MJ(e);if(550==g)return this.NJ(e);throw a.g.wa();};h.prototype.YJ=function(e,g){var h=g.D();if(a.T.Kc(h))this.WA(e,g);else if(550==h)this.XA(e,g);else throw a.g.wa();};h.prototype.QJ=function(e,g){var h=this.jg(1736,e.description);if(2>e.Ha(g))return h;this.Hk.Pd(e,e.Ea(g),
e.Dc(g));this.zp=this.wb.mc(0);var c=this.Cf(h,-1);this.Gn(c,e.vc(g)||!0);var b=null!=this.Ge&&null!=e.Fe,d=e.Ea(g);for(g=e.Dc(g);d<g;d++){var f=this.vl(c,-1,null);if(b)if(f=this.gb(f),0!=(e.NC(d)&1))this.Fh(f,null);else{var A=new a.Ag;e.cc(d,A,!0);this.Fh(f,A.get())}}return h};h.prototype.hf=function(e){var g=this.Lb(e),h=a.sH.jg(g,this.Hk.description),c=this.F(e);if(0==c)return h;if(a.T.Kc(g)){for(var g=this.ea(e),b=a.Ac.Dg(g+1),d=a.Ac.to(g+1,0),f=h.description,A=0,k=f.Aa;A<k;A++){for(var m=f.Hd(A),
p=a.pa.Wa(m),r=a.Ac.Tv(m,c),u=this.wb.mc(m),v=0,q=0,x=0,D=this.Vb(e);-1!=D;D=this.bc(D)){var B=0;this.vc(D)&&(B|=1);this.VO(D)&&(B|=4);0!=B&&d.xy(q,B);var t=this.Ha(D);b.write(q++,x);x+=t;if(0==m)for(var t=u,z=r,l=new a.b,B=this.Cb(D);v<x;B=this.X(B),v++){var C=this.gb(B);t.ec(2*C,l);z.Rn(2*v,l)}else for(B=this.Cb(D);v<x;B=this.X(B),v++)for(C=this.gb(B),z=0;z<p;z++)l=u.Bh(C*p+z),r.Uk(v*p+z,l)}h.bm(m,r);b.write(g,c)}h.NF(d);h.OF(b);h.ce(16777215)}else if(550==g){f=h.description;h.resize(c);A=0;for(k=
f.Aa;A<k;A++){m=f.Hd(A);p=a.pa.Wa(m);r=h.mc(m);u=this.wb.mc(m);v=0;D=this.Vb(e);t=this.Ha(D);for(B=this.Cb(D);v<t;B=this.X(B),v++)for(C=this.gb(B),z=0;z<p;z++)l=u.Bh(C*p+z),r.Uk(v*p+z,l);h.bm(m,r)}h.ce(16777215)}return h};h.prototype.sy=function(e){for(var a=this.Vb(e);-1!=a;a=this.Cr(a));var a=this.aO(e),h=this.we(e);-1!=a?this.MF(a,h):this.$c=h;-1!=h?this.QF(h,a):this.Xt=a;this.bN(e)};h.prototype.jg=function(e,g){return void 0===g?this.QB(e,a.Od.Tf()):this.QB(e,g)};h.prototype.QB=function(e,g){e=
this.jQ(e);null==this.wb?this.wb=this.Hk=new a.pe(g):this.Hk.Ik(g);this.wp=this.Hk.description;this.kx=1<this.wp.Aa;-1==this.$c?this.$c=e:(this.QF(e,this.Xt),this.MF(this.Xt,e));return this.Xt=e};h.prototype.we=function(e){return this.Mc.O(e,1)};h.prototype.aO=function(e){return this.Mc.O(e,0)};h.prototype.Lb=function(e){return this.Mc.O(e,2)&2147483647};h.prototype.EF=function(e,g,h){g=this.Ej[g];e=this.xC(e);e>=g.size&&g.resize(Math.max(a.I.truncate(1.25*e),16),-1);g.write(e,h)};h.prototype.yC=
function(e,a){e=this.xC(e);a=this.Ej[a];return e<a.size?a.read(e):-1};h.prototype.RB=function(){null==this.Ej&&(this.Ej=[]);for(var e=0;e<this.Ej.length;e++)if(null==this.Ej[e])return this.Ej[e]=a.Ac.Dg(0),e;this.Ej.push(a.Ac.Dg(0));return this.Ej.length-1};h.prototype.tR=function(e){this.Ej[e]=null};h.prototype.Vb=function(e){return this.Mc.O(e,3)};h.prototype.Ys=function(e){return this.Mc.O(e,4)};h.prototype.F=function(e){return this.Mc.O(e,5)};h.prototype.ea=function(e){return this.Mc.O(e,6)};
h.prototype.xo=function(e,g,h){for(var n=0,c=this.$c;-1!=c;c=this.we(c)){var b=this.Lb(c);if(a.T.Kc(b)&&(!h||1736==b))for(var b=1736==this.Lb(c),d=this.Vb(c);-1!=d;){for(var f=0,A=this.Cb(d);f<a.I.truncate(this.Ha(d)/2);){var k=this.X(A);if(-1==k)break;var m=this.gb(A),p=this.Fi(m);null!=p?m=p.$b():(p=this.gb(k),m=this.wb.mv(m,p));m<=e?(0==m?0==n&&(n=-1):n=1,k!=this.hk(d)&&(this.Zy(k,A),this.vf(k,!0))):A=this.X(A);f++}f=this.Cb(d);for(A=this.vc(d)?f:this.hk(d);0<this.Ha(d);)if(k=this.Ua(A),-1!=k){var r=
this.gb(k),p=this.Fi(r);null!=p?m=p.$b():(m=this.gb(A),m=this.wb.mv(m,r));if(m<=e)0==m?0==n&&(n=-1):n=1,this.Zy(k,A),this.vf(k,!1),f==k&&(f=this.Cb(d));else if(A=this.Ua(A),A==f)break}else{this.vf(A,!0);0==n&&(n=-1);break}A=this.Ha(d);g&&(b?3>A:2>A)?(d=this.Cr(d),n=0<A?1:0==n?-1:n):d=this.bc(d)}}return n};h.prototype.Zy=function(e,a){var g=this.gb(e),h=this.gb(a);null!=this.wg&&(g=this.wg.read(g),this.wg.write(h,g));if(null!=this.sh)for(h=0,g=this.sh.length;h<g;h++)if(null!=this.sh[h]){var c=this.Ra(e,
h);-1!=c&&this.lb(a,h,c)}};h.prototype.Mr=function(e,g,h){var n=0,c=this.X(e);if(-1==c)throw a.g.wa();for(var b=this.gb(e),d=this.gb(c),f=this.Fi(b),A=null==f?this.wb.mv(b,d):f.$b(),k=0;k<h;k++){var m=g[k];if(0<m&&1>m){var p=m;null!=f&&(p=0<A?f.rA(m)/A:0);this.wb.vJ(b,d,p,this.Fo());var r=this.vl(this.rd(e),c,this.Fo());n++;if(null!=f){var u=f.xm(0,m),p=this.gb(this.Ua(r));this.Fh(p,u);this.Yi(r,u.oc());if(k==h-1||1==g[k+1])m=f.xm(m,1),this.Fh(p,m)}}}return n};h.prototype.bh=function(e,a){var g=this.gb(e);
this.wb.Iu(g,a);g=this.Fi(g);null!=g&&g.setStart(a);e=this.Ua(e);-1!=e&&(e=this.gb(e),null!=this.Fi(e)&&g.setEnd(a))};h.prototype.Jk=function(e,a){e=this.gb(e);this.wb.Sd(e,a)};h.prototype.Yi=function(e,a){this.ic(e,a.x,a.y)};h.prototype.ic=function(e,a,h){var g=this.gb(e);this.wb.ic(g,a,h);g=this.Fi(g);null!=g&&g.Ny(a,h);e=this.Ua(e);-1!=e&&(e=this.gb(e),null!=this.Fi(e)&&g.Ok(a,h))};h.prototype.w=function(e,a){this.wb.w(this.cd.O(e,0),a)};h.prototype.uc=function(e,a){this.wb.Ba[0].ec(2*this.cd.O(e,
0),a)};h.prototype.Fa=function(e){var g=new a.b;this.wb.w(this.cd.O(e,0),g);return g};h.prototype.SC=function(e,a){this.zp.ec(2*e,a)};h.prototype.ld=function(e,a,h){return this.wb.ld(e,this.gb(a),h)};h.prototype.setAttribute=function(e,a,h,c){this.wb.setAttribute(e,this.gb(a),h,c)};h.prototype.gb=function(e){return this.cd.O(e,0)};h.prototype.mk=function(e){var g=new a.b;this.w(e,g);return g.y};h.prototype.Cq=function(e,a){e=this.gb(e);a=this.gb(a);var g=this.wb.Ba[0].f;return g[2*e]===g[2*a]&&g[2*
e+1]===g[2*a+1]};h.prototype.pt=function(e,a){e=this.gb(e);var g=this.wb.Ba[0].f;return g[2*e]===a.x&&g[2*e+1]===a.y};h.prototype.pS=function(e,g){1>g&&(g=1);if(null==this.wg){if(1==g)return;this.wg=a.Ac.kl(this.wb.F(),1)}e=this.gb(e);e>=this.wg.size&&this.wg.resize(e+1,1);this.wg.write(e,g)};h.prototype.RC=function(e){e=this.gb(e);return null==this.wg||e>=this.wg.size?1:this.wg.read(e)};h.prototype.lb=function(e,a,h){a=this.sh[a];e=this.gb(e);a.size<this.wb.F()&&a.resize(this.wb.F(),-1);a.write(e,
h)};h.prototype.Ra=function(e,a){e=this.gb(e);a=this.sh[a];return e<a.size?a.read(e):-1};h.prototype.re=function(){null==this.sh&&(this.sh=[]);for(var e=0;e<this.sh.length;e++)if(null==this.sh[e])return this.sh[e]=a.Ac.Dg(0,-1),e;this.sh.push(a.Ac.Dg(0,-1));return this.sh.length-1};h.prototype.bf=function(e){this.sh[e]=null};h.prototype.cc=function(e){return null!=this.Ge?(e=this.gb(e),this.Ge[e]):null};h.prototype.Oc=function(e,g){var h=this.cd.O(e,2);if(-1==h)return!1;if(this.kx){var c=new a.Va;
this.Jk(e,c);g.setStart(c);this.Jk(h,c);g.setEnd(c)}else this.wb.uc(this.cd.O(e,0),I),g.gl(0,I),this.wb.uc(this.cd.O(h,0),I),g.gl(1,I);return!0};h.prototype.gR=function(e,g,h){if(this.kx){var n=new a.Va;this.Jk(e,n);h.setStart(n);this.Jk(g,n);h.setEnd(n)}else this.wb.uc(e,I),h.gl(0,I),this.wb.uc(g,I),h.gl(1,I)};h.prototype.Cf=function(e,g){var h;if(-1!=g){if(e!=this.Vf(g))throw a.g.wa();h=this.wq(g)}else h=this.Ys(e);var c=this.lQ(e);-1!=g&&this.Mn(g,c);this.Ln(c,g);this.Mn(c,h);-1!=h?this.Ln(h,c):
this.Jn(e,c);-1==g&&this.Kn(e,c);this.gm(e,this.ea(e)+1);return c};h.prototype.aD=function(e,a,h,c){e=this.Cf(e,-1);for(var g=0,n=a,b=!1;n==h&&(b=!0),this.im(n,e),g++,n=this.X(n),n!=a;);this.Gn(e,!0);this.hm(e,g);b&&(a=h);this.Dh(e,a);this.Wi(e,this.Ua(a));this.Jr(e,!1);null!=c&&(c[0]=b);return e};h.prototype.Cr=function(e){var a=this.wq(e),h=this.bc(e),c=this.Vf(e);-1!=a?this.Ln(a,h):this.Jn(c,h);-1!=h?this.Mn(h,a):this.Kn(c,a);this.bL(e);this.gm(c,this.ea(c)-1);this.iC(e);return h};h.prototype.bL=
function(e){var a=this.Cb(e);if(-1!=a){for(var h=0,c=this.Ha(e);h<c;h++){var b=a,a=this.X(a);this.dw(b)}a=this.Vf(e);this.Pk(a,this.F(a)-this.Ha(e))}this.hm(e,0)};h.prototype.bc=function(e){return this.Rc.O(e,2)};h.prototype.wq=function(e){return this.Rc.O(e,1)};h.prototype.Ha=function(e){return this.Rc.O(e,3)};h.prototype.vc=function(e){return 0!=(this.Ho(e)&1)};h.prototype.Gn=function(e,a){if(this.vc(e)!=a){if(0<this.Ha(e)){var g=this.Cb(e),h=this.hk(e);a?(this.Sc(h,g),this.Tc(g,h)):(this.Sc(h,
-1),this.Tc(g,-1));g=this.gb(h);this.Fh(g,null)}this.Iy(e,(this.Ho(e)|1)-1|(a?1:0))}};h.prototype.Vf=function(e){return this.Rc.O(e,7)};h.prototype.VO=function(e){return 0!=(this.Ho(e)&2)};h.prototype.Dy=function(e,a){this.Iy(e,(this.Ho(e)|2)-2|(a?2:0))};h.prototype.Gw=function(e){if(this.bP(e))return this.fi.get(this.bt(e));var g=new a.yb,h=this.Cb(e);if(-1==h)return 0;var c=new a.b;this.w(h,c);for(var b=0,d=0,f=this.Ha(e);d<f;d++,h=this.X(h)){var A=this.cc(h);if(null==A){if(!this.Oc(h,g))continue;
A=g}b+=A.kv(c.x,c.y)}this.Jr(e,!0);this.fi.set(this.bt(e),b);return b};h.prototype.Rp=function(e,a,h){a=this.Jj[a];e=this.bt(e);a.size<this.fi.size&&a.resize(this.fi.size,-1);a.write(e,h)};h.prototype.Ei=function(e,a){e=this.bt(e);a=this.Jj[a];return e<a.size?a.read(e):-1};h.prototype.Uv=function(){null==this.Jj&&(this.Jj=[]);for(var e=0;e<this.Jj.length;e++)if(null==this.Jj[e])return this.Jj[e]=a.Ac.Dg(0),e;this.Jj.push(a.Ac.Dg(0));return this.Jj.length-1};h.prototype.ty=function(e){this.Jj[e]=null};
h.prototype.bQ=function(e,g,h){if(-1==h)throw a.g.N();if(g!=h){var n=this.bc(h),c=this.wq(h),b=this.Vf(h);-1==c?this.Jn(b,n):this.Ln(c,n);-1==n?this.Kn(b,c):this.Mn(n,c);this.Pk(b,this.F(b)-this.Ha(h));this.gm(b,this.ea(b)-1);c=-1==g?this.Ys(e):this.wq(g);this.Mn(h,c);this.Ln(h,g);-1==g?this.Kn(e,h):this.Mn(g,h);-1==c?this.Jn(e,h):this.Ln(c,h);this.Pk(e,this.F(e)+this.Ha(h));this.gm(e,this.ea(e)+1);this.Hu(h,e)}};h.prototype.zi=function(e,a){this.wb.Sd(this.gb(a),this.Fo());this.vl(e,-1,this.Fo())};
h.prototype.vf=function(e,g){var h=this.rd(e),c=this.Ua(e),b=this.X(e);-1!=c&&this.Sc(c,b);var d=this.Ha(h);e==this.Cb(h)&&this.Dh(h,1<d?b:-1);-1!=b&&this.Tc(b,c);e==this.hk(h)&&this.Wi(h,1<d?c:-1);if(-1!=c&&-1!=b){var c=this.gb(c),f=this.gb(b);g?(g=this.Fi(c),null!=g&&(c=new a.b,this.wb.w(f,c),g.vd(c))):(f=this.gb(e),g=this.Fi(f),this.Fh(c,g),null!=g&&(c=this.wb.Fa(c),g.ed(c)))}this.hm(h,d-1);h=this.Vf(h);this.Pk(h,this.F(h)-1);this.dw(e);return b};h.prototype.Cb=function(e){return this.Rc.O(e,4)};
h.prototype.hk=function(e){return this.Rc.O(e,5)};h.prototype.X=function(e){return this.cd.O(e,2)};h.prototype.Ua=function(e){return this.cd.O(e,1)};h.prototype.rd=function(e){return this.cd.O(e,3)};h.prototype.Ub=function(e,a){return this.vl(e,-1,a)};h.prototype.Gp=function(e){if(void 0===e)return this.Gp(!1);if(e instanceof b)return new b(e);var g,h=-1,c=-1,d=-1,f=0,A=!1;for(g=this.$c;-1!=g;g=this.we(g))if(!e||a.T.Kc(this.Lb(g))){for(h=this.Vb(g);-1!=h;h=this.bc(h))if(d=c=this.Cb(h),f=0,-1!=c){A=
!0;break}if(A)break}return b.UL(this,g,h,c,d,f,e)};h.prototype.Oe=function(e){this.Hk.Oe(e);if(null!=this.Ge)for(var a=0,h=this.Ge.length;a<h;a++)null!=this.Ge[a]&&this.Ge[a].Oe(e)};h.prototype.Tp=function(e,a,h,c){c?this.DS(e,a,h):this.CS(e,a,h)};h.prototype.Tc=function(e,a){this.cd.L(e,1,a)};h.prototype.Sc=function(e,a){this.cd.L(e,2,a)};h.prototype.im=function(e,a){this.cd.L(e,3,a)};h.prototype.hm=function(e,a){this.Rc.L(e,3,a)};h.prototype.Dh=function(e,a){this.Rc.L(e,4,a)};h.prototype.Wi=function(e,
a){this.Rc.L(e,5,a)};h.prototype.gm=function(e,a){this.Mc.L(e,6,a)};h.prototype.Pk=function(e,a){this.Mc.L(e,5,a)};h.prototype.lF=function(e){var a=e;do{var h=this.X(a);this.Sc(a,this.Ua(a));this.Tc(a,h);a=h}while(a!=e)};h.prototype.ZF=function(e){this.pd=e};h.prototype.yu=function(e){var a=this.wq(e),h=this.bc(e),c=this.Vf(e);-1!=a?this.Ln(a,h):this.Jn(c,h);-1!=h?this.Mn(h,a):this.Kn(c,a);this.Dh(e,-1);this.Wi(e,-1);this.iC(e)};h.prototype.Ui=function(e,g){var h=this.Ua(e),c=this.X(e);-1!=h&&this.Sc(h,
c);-1!=c&&this.Tc(c,h);if(-1!=h&&-1!=c)if(h=this.gb(h),c=this.gb(c),g){if(g=this.Fi(h),null!=g){var b=new a.b;this.wb.w(c,b);g.vd(b)}}else c=this.gb(e),g=this.Fi(c),this.Fh(h,g),null!=g&&(b=new a.b,this.wb.w(h,b),g.ed(b));this.dw(e)};h.prototype.bP=function(e){return 0!=(this.Ho(e)&4)};h.prototype.Jr=function(e,a){this.Iy(e,(this.Ho(e)|4)-4|(a?4:0))};h.prototype.Mu=function(e,a){var g=this.cd.f;this.wb.kc();var h=this.wb.Ba[0].f;e.xd(0,a,function(e,a){e=g[5*e];a=g[5*a];var c=h[2*e];e=h[2*e+1];var n=
h[2*a];a=h[2*a+1];return e<a?-1:e>a?1:c<n?-1:c>n?1:0})};h.prototype.pO=function(){for(var e=this.$c;-1!=e;e=this.we(e))if(!a.T.Kc(this.Lb(e)))return!0;return!1};h.prototype.Vy=function(e,a){for(var g=this.Vb(e),h=this.Vb(a),c=this.Ys(e),b=this.Ys(a),d=this.Vb(e);-1!=d;d=this.bc(d))this.Hu(d,a);for(d=this.Vb(a);-1!=d;d=this.bc(d))this.Hu(d,e);this.Jn(e,h);this.Jn(a,g);this.Kn(e,b);this.Kn(a,c);g=this.F(e);h=this.ea(e);c=this.ea(a);this.Pk(e,this.F(a));this.Pk(a,g);this.gm(e,c);this.gm(a,h);g=this.Mc.O(e,
2);this.Mc.L(e,2,this.Mc.O(a,2));this.Mc.L(a,2,g)};return h}();a.fd=c})(B||(B={}));(function(a){var c=function(c){function h(e,g,h,b){c.call(this);this.R=new a.i;void 0===e?this.MB():"number"===typeof e?this.AL(e,g,h,b):e instanceof a.Va?void 0!==g?this.Ks(e,g,h):this.BL(e):e instanceof a.pa?void 0!==g?this.DL(e,g):this.CL(e):e instanceof a.i?this.zL(e):this.MB()}D(h,c);h.prototype.Ks=function(e,g,h){this.description=a.Od.Tf();this.R.Ja();e.s()||this.sv(e,g,h)};h.prototype.zL=function(e){this.description=
a.Od.Tf();this.R.K(e);this.R.normalize()};h.prototype.CL=function(e){if(null==e)throw a.g.N();this.description=e;this.R.Ja()};h.prototype.DL=function(e,g){if(null==e)throw a.g.N();this.description=e;this.R.K(g);this.R.normalize()};h.prototype.MB=function(){this.description=a.Od.Tf();this.R.Ja()};h.prototype.BL=function(e){this.description=a.Od.Tf();this.R.Ja();e.s()||this.sv(e)};h.prototype.AL=function(e,g,h,c){this.description=a.Od.Tf();this.K(e,g,h,c)};h.prototype.K=function(e,a,h,c){this.qc();
if("number"===typeof e)this.R.K(e,a,h,c);else for(this.Ja(),a=0,h=e.length;a<h;a++)this.Db(e[a])};h.prototype.Cu=function(e){this.qc();if(!e.dP())throw a.g.N();this.R.K(e)};h.prototype.Ja=function(){this.qc();this.R.Ja()};h.prototype.s=function(){return this.R.s()};h.prototype.aa=function(){return this.R.aa()};h.prototype.ba=function(){return this.R.ba()};h.prototype.lw=function(){return this.R.lw()};h.prototype.Vs=function(){return this.R.Vs()};h.prototype.qq=function(){return this.R.Af()};h.prototype.Db=
function(e){if(e instanceof a.b)this.qc(),this.R.Db(e);else if(e instanceof a.i)this.qc(),this.R.Db(e);else if(e instanceof a.Va){if(this.qc(),!e.sc()){var g=e.description;this.description!=g&&this.Ik(g);if(this.s())this.sv(e);else{this.R.Db(e.w());for(var c=1,b=g.Aa;c<b;c++)for(var d=g.Fd(c),f=a.pa.Wa(d),A=0;A<f;A++){var k=e.ld(d,A),m=this.Ah(d,A);m.Db(k);setInterval(d,A,m)}}}}else if(e instanceof h&&!e.s())for(g=e.description,g!=this.description&&this.Ik(g),this.R.Db(e.R),c=1,b=g.Aa;c<b;c++)for(d=
g.Hd(c),f=a.pa.Wa(d),A=0;A<f;A++)k=e.Ah(d,A),m=this.Ah(d,A),m.Db(k),setInterval(d,A,m)};h.prototype.sv=function(e,g,h){if(void 0!==g){this.R.K(e.w(),g,h);g=e.description;h=1;for(var c=g.Aa;h<c;h++)for(var n=g.Fd(h),b=a.pa.Wa(n),d=0;d<b;d++){var f=e.ld(n,d);this.setInterval(n,d,f,f)}}else for(this.R.K(e.fa[0],e.fa[1]),g=e.description,h=1,c=g.Aa;h<c;h++)for(n=g.Fd(h),b=a.pa.Wa(n),d=0;d<b;d++)f=e.ld(n,d),this.setInterval(n,d,f,f)};h.prototype.setInterval=function(e,g,h,c){var n=null;"number"===typeof h?
n=new a.Nd(h,c):n=h;this.qc();if(0==e)if(0==g)this.R.v=n.qa,this.R.B=n.va;else if(1==g)this.R.C=n.qa,this.R.G=n.va;else throw a.g.Uc();else this.DA(0,e,g,n.qa),this.DA(1,e,g,n.va)};h.prototype.P=function(e,a){this.qc();this.R.P(e,a)};h.prototype.Oe=function(e){if(e instanceof a.Bg)this.qc(),e.$y(this.R);else if(this.qc(),!this.R.s()){var g=new a.fH;this.Cn(g);g.UO()?g.Ja():e.$y(g)}};h.prototype.copyTo=function(e){if(e.D()!=this.D())throw a.g.N();e.qc();e.description=this.description;e.R.K(this.R);
e.fa=null;if(null!=this.fa){e.ns();for(var g=0;g<2*(this.description.le.length-2);g++)e.fa[g]=this.fa[g]}};h.prototype.Pa=function(){return new h(this.description)};h.prototype.Mh=function(){return this.R.rN()};h.prototype.$b=function(){return this.R.CC()};h.prototype.D=function(){return 197};h.prototype.fb=function(){return 2};h.prototype.Fp=function(e){this.copyTo(e)};h.prototype.o=function(e){e.v=this.R.v;e.C=this.R.C;e.B=this.R.B;e.G=this.R.G};h.prototype.Cn=function(e){e.v=this.R.v;e.C=this.R.C;
e.B=this.R.B;e.G=this.R.G;e.K(this.R.v,this.R.C,this.yd(0,1,0),this.R.B,this.R.G,this.yd(1,1,0))};h.prototype.Ah=function(e,g){var h=new a.Nd;h.K(this.yd(0,e,g),this.yd(1,e,g));return h};h.prototype.uf=function(e,g){g.Qf(this.description);var h=this.description.Aa-1;switch(e){case 0:for(e=0;e<h;e++)for(var c=this.description.Hd(e),b=a.pa.Wa(c),d=0;d<b;d++)g.setAttribute(c,d,this.yd(0,c,d));g.ic(this.R.v,this.R.C);break;case 1:for(e=0;e<h;e++)for(c=this.description.Hd(e),b=a.pa.Wa(c),d=0;d<b;d++)g.setAttribute(c,
d,this.yd(1,c,d));g.ic(this.R.v,this.R.G);break;case 2:for(e=0;e<h;e++)for(c=this.description.Hd(e),b=a.pa.Wa(c),d=0;d<b;d++)g.setAttribute(c,d,this.yd(0,c,d));g.ic(this.R.B,this.R.G);break;case 3:for(e=0;e<h;e++)for(c=this.description.Hd(e),b=a.pa.Wa(c),d=0;d<b;d++)g.setAttribute(c,d,this.yd(1,c,d));g.ic(this.R.B,this.R.C);break;default:throw a.g.Uc();}};h.prototype.vu=function(e,a){e=this.R.vu(e);a.ma(e.x,e.y)};h.prototype.zN=function(e,a){return a*(e.up-2)};h.prototype.mC=function(e,g,h){if(this.R.s())throw a.g.ra("empty geometry");
if(0==g)return 0!=e?0!=h?this.R.G:this.R.B:0!=h?this.R.C:this.R.v;if(h>=a.pa.Wa(g))throw a.g.N();var c=this.description.zf(g);this.ns();return 0<=c?this.fa[this.zN(this.description,e)+this.description.XN(c)-2+h]:a.pa.ue(g)};h.prototype.ns=function(){this.qc();if(null==this.fa&&2<this.description.le.length){this.fa=[];for(var e=h.V(this.description,0),g=h.V(this.description,1),c=0,b=1,d=this.description.Aa;b<d;b++)for(var f=this.description.Hd(b),A=a.pa.Wa(f),f=a.pa.ue(f),k=0;k<A;k++)this.fa[e+c]=
f,this.fa[g+c]=f,c++}};h.prototype.nm=function(e){if(null!=this.fa)if(2<e.le.length){for(var g=a.Od.iu(e,this.description),c=[],b=h.V(this.description,0),d=h.V(this.description,1),f=h.V(e,0),A=h.V(e,1),k=0,m=1,p=e.Aa;m<p;m++){var r=e.Hd(m),u=a.pa.Wa(r);if(-1==g[m])for(var v=a.pa.ue(r),r=0;r<u;r++)c[f+k]=v,c[A+k]=v,k++;else for(v=this.description.fj(g[m])-2,r=0;r<u;r++)c[f+k]=this.fa[b+v],c[A+k]=this.fa[d+v],k++,v++}this.fa=c}else this.fa=null;this.description=e};h.prototype.yd=function(e,g,c){if(this.R.s())throw a.g.ra("This operation was performed on an Empty Geometry.");
if(0==g)return 0!=e?0!=c?this.R.G:this.R.B:0!=c?this.R.C:this.R.v;if(c>=a.pa.Wa(g))throw a.g.Uc();var n=this.description.zf(g);return 0<=n?(this.ns(),this.fa[h.V(this.description,e)+this.description.fj(n)-2+c]):a.pa.ue(g)};h.prototype.DA=function(e,g,c,b){this.qc();if(0==g)0!=e?0!=c?this.R.G=b:this.R.B=b:0!=c?this.R.C=b:this.R.v=b;else{if(c>=a.pa.Wa(g))throw a.g.Uc();if(!this.hasAttribute(g)){if(a.pa.nD(g,b))return;this.Ne(g)}g=this.description.zf(g);this.ns();this.fa[h.V(this.description,e)+this.description.fj(g)-
2+c]=b}};h.V=function(e,a){return a*(e.le.length-2)};h.prototype.Ga=function(e){this.qc();var g=new a.i;e.o(g);return this.R.Ga(g)};h.prototype.jc=function(e){return e instanceof a.i?this.R.jc(e):this.R.jc(e.R)};h.prototype.offset=function(e,a){this.qc();this.R.offset(e,a)};h.prototype.normalize=function(){this.qc();this.R.normalize()};h.prototype.Af=function(e){if(void 0!==e)if(e.Qf(this.description),this.s())e.Ja();else{for(var g=this.description.Aa,h=1;h<g;h++)for(var c=this.description.Hd(h),
b=a.pa.Wa(c),d=0;d<b;d++){var f=.5*(this.mC(0,c,d)+this.mC(1,c,d));e.setAttribute(c,d,f)}e.ic(this.R.Af())}else{e=new a.Va(this.description);if(this.s())return e;g=this.description.Aa;for(h=1;h<g;h++)for(c=this.description.Fd(h),b=a.pa.Wa(c),d=0;d<b;d++)f=.5*(this.yd(0,c,d)+this.yd(1,c,d)),e.setAttribute(c,d,f);e.ic(this.R.lw(),this.R.Vs());return e}};h.prototype.yw=function(){return new a.Va(this.R.yw())};h.prototype.contains=function(e){return e instanceof a.Va?e.s()?!1:this.R.contains(e.lk(),e.mk()):
this.R.contains(e.R)};h.prototype.lc=function(e){if(e==this)return!0;if(!(e instanceof h)||this.description!=e.description)return!1;if(this.s())return e.s()?!0:!1;if(!this.R.lc(e.R))return!1;for(var a=0,c=2*(this.description.le.length-2);a<c;a++)if(this.fa[a]!=e.fa[a])return!1;return!0};h.prototype.hc=function(){var e=this.description.hc(),e=a.I.kg(e,this.R.hc());if(!this.s()&&null!=this.fa)for(var g=0,h=2*(this.description.le.length-2);g<h;g++)e=a.I.kg(e,this.fa[g]);return e};h.prototype.Rf=function(){return a.Hh.il(this,
null)};h.prototype.toString=function(){return this.s()?"Envelope: []":"Envelope: ["+this.R.v+", "+this.R.C+", "+this.R.B+", "+this.R.G+"]"};return h}(a.T);a.Vj=c})(B||(B={}));(function(a){var c=function(){function c(a,e,g,c){void 0===a?this.Ja():(this.v=a,this.C=e,this.B=g,this.G=c)}c.Oa=function(a,e,g,n){var h=new c;h.v=a;h.C=e;h.B=g;h.G=n;return h};c.prototype.K=function(h,e,g,n){"number"===typeof h?void 0!==g?(this.v=h,this.C=e,this.B=g,this.G=n,this.normalize()):(this.v=h,this.C=e,this.B=h,this.G=
e):h instanceof a.b?void 0!==e?(this.v=h.x-.5*e,this.B=this.v+e,this.C=h.y-.5*g,this.G=this.C+g,this.normalize()):(this.v=h.x,this.C=h.y,this.B=h.x,this.G=h.y):h instanceof c?this.K(h.v,h.C,h.B,h.G):h instanceof a.Nd&&(h.s()||e.s()?this.Ja():(this.v=h.qa,this.B=h.va,this.C=e.qa,this.G=e.va))};c.prototype.IN=function(a,e){var g=new c;g.K(this.v,this.C,this.B,this.G);g.P(a,e);return g};c.prototype.Ey=function(a,e){if(void 0!==e)if(0==e)this.Ja();else{this.v=a[0].x;this.C=a[0].y;this.B=this.v;this.G=
this.C;for(var g=1;g<e;g++){var h=a[g];h.x<this.v?this.v=h.x:h.x>this.B&&(this.B=h.x);h.y<this.C?this.C=h.y:h.y>this.G&&(this.G=h.y)}}else if(null==a||0==a.length)this.Ja();else for(h=a[0],this.K(h.x,h.y),g=1;g<a.length;g++)h=a[g],this.Oj(h.x,h.y)};c.prototype.Ja=function(){this.G=this.B=this.C=this.v=NaN};c.prototype.s=function(){return isNaN(this.v)};c.prototype.Db=function(h,e){"number"===typeof h?this.s()?(this.v=h,this.C=e,this.B=h,this.G=e):(this.v>h?this.v=h:this.B<h&&(this.B=h),this.C>e?this.C=
e:this.G<e&&(this.G=e)):h instanceof a.b?this.Db(h.x,h.y):h instanceof a.ee?this.Db(h.x,h.y):h instanceof c&&!h.s()&&(this.Db(h.v,h.C),this.Db(h.B,h.G))};c.prototype.Oj=function(a,e){this.v>a?this.v=a:this.B<a&&(this.B=a);this.C>e?this.C=e:this.G<e&&(this.G=e)};c.prototype.P=function(a,e){this.s()||(this.v-=a,this.B+=a,this.C-=e,this.G+=e,(this.v>this.B||this.C>this.G)&&this.Ja())};c.prototype.scale=function(a){0>a&&this.Ja();this.s()||(this.v*=a,this.B*=a,this.C*=a,this.G*=a)};c.prototype.jc=function(a){return!this.s()&&
!a.s()&&(this.v<=a.v?this.B>=a.v:a.B>=this.v)&&(this.C<=a.C?this.G>=a.C:a.G>=this.C)};c.prototype.rD=function(a){return(this.v<=a.v?this.B>=a.v:a.B>=this.v)&&(this.C<=a.C?this.G>=a.C:a.G>=this.C)};c.prototype.Ga=function(a){if(this.s()||a.s())return!1;a.v>this.v&&(this.v=a.v);a.B<this.B&&(this.B=a.B);a.C>this.C&&(this.C=a.C);a.G<this.G&&(this.G=a.G);(a=this.v<=this.B&&this.C<=this.G)||this.Ja();return a};c.prototype.vu=function(h){switch(h){case 0:return a.b.Oa(this.v,this.C);case 1:return a.b.Oa(this.v,
this.G);case 2:return a.b.Oa(this.B,this.G);case 3:return a.b.Oa(this.B,this.C);default:throw a.g.Uc();}};c.prototype.hy=function(h){if(null==h||4>h.length)throw a.g.N();null!=h[0]?h[0].ma(this.v,this.C):h[0]=a.b.Oa(this.v,this.C);null!=h[1]?h[1].ma(this.v,this.G):h[1]=a.b.Oa(this.v,this.G);null!=h[2]?h[2].ma(this.B,this.G):h[2]=a.b.Oa(this.B,this.G);null!=h[3]?h[3].ma(this.B,this.C):h[3]=a.b.Oa(this.B,this.C)};c.prototype.rN=function(){return this.s()?0:this.aa()*this.ba()};c.prototype.CC=function(){return this.s()?
0:2*(this.aa()+this.ba())};c.prototype.lw=function(){return(this.B+this.v)/2};c.prototype.Vs=function(){return(this.G+this.C)/2};c.prototype.aa=function(){return this.B-this.v};c.prototype.ba=function(){return this.G-this.C};c.prototype.move=function(a,e){this.s()||(this.v+=a,this.C+=e,this.B+=a,this.G+=e)};c.prototype.offset=function(a,e){this.v+=a;this.B+=a;this.C+=e;this.G+=e};c.prototype.normalize=function(){if(!this.s()){var a=Math.min(this.v,this.B),e=Math.max(this.v,this.B);this.v=a;this.B=
e;a=Math.min(this.C,this.G);e=Math.max(this.C,this.G);this.C=a;this.G=e}};c.prototype.Yl=function(a){a.ma(this.v,this.C)};c.prototype.YE=function(a){a.ma(this.B,this.C)};c.prototype.aF=function(a){a.ma(this.v,this.G)};c.prototype.Zl=function(a){a.ma(this.B,this.G)};c.prototype.dP=function(){return this.s()||this.v<=this.B&&this.C<=this.G};c.prototype.Af=function(){return a.b.Oa((this.B+this.v)/2,(this.G+this.C)/2)};c.prototype.yw=function(){return a.b.Oa(this.v,this.C)};c.prototype.contains=function(h,
e){if(void 0!==e)return h>=this.v&&h<=this.B&&e>=this.C&&e<=this.G;if(h instanceof a.Va)return this.contains(h.lk(),h.mk());if(h instanceof a.b)return this.contains(h.x,h.y);if(h instanceof c)return h.v>=this.v&&h.B<=this.B&&h.C>=this.C&&h.G<=this.G;throw a.g.N();};c.prototype.jl=function(h,e){if(void 0!==e)return h>this.v&&h<this.B&&e>this.C&&e<this.G;if(h instanceof a.b)return this.jl(h.x,h.y);if(h instanceof c)return h.v>this.v&&h.B<this.B&&h.C>this.C&&h.G<this.G;throw a.g.N();};c.prototype.lc=
function(a){return a==this?!0:a instanceof c?this.s()&&a.s()?!0:this.v!=a.v||this.C!=a.C||this.B!=a.B||this.G!=a.G?!1:!0:!1};c.prototype.hc=function(){var h=this.v,h=a.I.truncate(h^h>>>32),e=a.I.kg(h),h=this.B,h=a.I.truncate(h^h>>>32),e=a.I.kg(h,e),h=this.C,h=a.I.truncate(h^h>>>32),e=a.I.kg(h,e),h=this.G,h=a.I.truncate(h^h>>>32);return e=a.I.kg(h,e)};c.prototype.vv=function(h){var e=new a.b;e.J(h);if(e.pv())return e;if(this.s())return e.FA(),e;e.x<this.v?e.x=this.v:e.x>this.B&&(e.x=this.B);e.y<this.C?
e.y=this.C:e.y>this.G&&(e.y=this.G);if(!e.lc(h))return e;h=this.Af();(e.x<h.x?e.x-this.v:this.B-e.x)<(e.y<h.y?e.y-this.C:this.G-e.y)?e.x=e.x<h.x?this.v:this.B:e.y=e.y<h.y?this.C:this.G;return e};c.prototype.ms=function(a){if(this.s())return NaN;if(a.x==this.v)return a.y-this.C;var e=this.G-this.C,g=this.B-this.v;return a.y==this.G?e+a.x-this.v:a.x==this.B?e+g+this.G-a.y:a.y==this.C?2*e+g+this.B-a.x:this.ms(this.vv(a))};c.prototype.vA=function(a){if(this.s())return-1;a=this.ms(a);var e=this.G-this.C,
g=this.B-this.v;return a<e?0:(a-=e)<g?1:a-g<e?2:3};c.prototype.lv=function(){return this.s()?2.220446049250313E-14:2.220446049250313E-14*(Math.abs(this.v)+Math.abs(this.B)+Math.abs(this.C)+Math.abs(this.G)+1)};c.prototype.Nv=function(a,e){var g=this.ej(a),h=this.ej(e);if(0!=(g&h))return 0;if(0==(g|h))return 4;var b=(0!=g?1:0)|(0!=h?2:0);do{var d=e.x-a.x,f=e.y-a.y;d>f?0!=(g&c.Cc)?(0!=(g&c.ob)?(a.y+=f*(this.v-a.x)/d,a.x=this.v):(a.y+=f*(this.B-a.x)/d,a.x=this.B),g=this.ej(a)):0!=(h&c.Cc)?(0!=(h&c.ob)?
(e.y+=f*(this.v-e.x)/d,e.x=this.v):(e.y+=f*(this.B-e.x)/d,e.x=this.B),h=this.ej(e)):0!=g?(0!=(g&c.ac)?(a.x+=d*(this.C-a.y)/f,a.y=this.C):(a.x+=d*(this.G-a.y)/f,a.y=this.G),g=this.ej(a)):(0!=(h&c.ac)?(e.x+=d*(this.C-e.y)/f,e.y=this.C):(e.x+=d*(this.G-e.y)/f,e.y=this.G),h=this.ej(e)):0!=(g&c.Bd)?(0!=(g&c.ac)?(a.x+=d*(this.C-a.y)/f,a.y=this.C):(a.x+=d*(this.G-a.y)/f,a.y=this.G),g=this.ej(a)):0!=(h&c.Bd)?(0!=(h&c.ac)?(e.x+=d*(this.C-e.y)/f,e.y=this.C):(e.x+=d*(this.G-e.y)/f,e.y=this.G),h=this.ej(e)):
0!=g?(0!=(g&c.ob)?(a.y+=f*(this.v-a.x)/d,a.x=this.v):(a.y+=f*(this.B-a.x)/d,a.x=this.B),g=this.ej(a)):(0!=(h&c.ob)?(e.y+=f*(this.v-e.x)/d,e.x=this.v):(e.y+=f*(this.B-e.x)/d,e.x=this.B),h=this.ej(e));if(0!=(g&h))return 0}while(0!=(g|h));return b};c.prototype.ej=function(a){return(a.x<this.v?1:0)|(a.x>this.B?1:0)<<1|(a.y<this.C?1:0)<<2|(a.y>this.G?1:0)<<3};c.prototype.mg=function(a){return!this.s()&&(this.aa()<=a||this.ba()<=a)};c.prototype.Fb=function(h){return h instanceof a.b?Math.sqrt(this.gG(h)):
Math.sqrt(this.Ou(h))};c.prototype.Ou=function(a){var e=0,g=0,h;h=this.v-a.B;h>e&&(e=h);h=this.C-a.G;h>g&&(g=h);h=a.v-this.B;h>e&&(e=h);h=a.C-this.G;h>g&&(g=h);return e*e+g*g};c.prototype.gG=function(a){var e=0,g=0,h;h=this.v-a.x;h>e&&(e=h);h=this.C-a.y;h>g&&(g=h);h=a.x-this.B;h>e&&(e=h);h=a.y-this.G;h>g&&(g=h);return e*e+g*g};c.prototype.wu=function(a){this.s()?a.Ja():a.K(this.v,this.B)};c.ob=1;c.ac=4;c.Cc=3;c.Bd=12;return c}();a.i=c})(B||(B={}));(function(a){var c;(function(a){a[a.initialize=0]=
"initialize";a[a.initializeRed=1]="initializeRed";a[a.initializeBlue=2]="initializeBlue";a[a.initializeRedBlue=3]="initializeRedBlue";a[a.sweep=4]="sweep";a[a.sweepBruteForce=5]="sweepBruteForce";a[a.sweepRedBlueBruteForce=6]="sweepRedBlueBruteForce";a[a.sweepRedBlue=7]="sweepRedBlue";a[a.sweepRed=8]="sweepRed";a[a.sweepBlue=9]="sweepBlue";a[a.iterate=10]="iterate";a[a.iterateRed=11]="iterateRed";a[a.iterateBlue=12]="iterateBlue";a[a.iterateBruteForce=13]="iterateBruteForce";a[a.iterateRedBlueBruteForce=
14]="iterateRedBlueBruteForce";a[a.resetRed=15]="resetRed";a[a.resetBlue=16]="resetBlue"})(c||(c={}));var b=function(){function a(e,a){this.th=e;this.KD=a}a.prototype.Zp=function(e,a,h){this.th.BS(h,e,a,this.KD)};a.prototype.Mo=function(e){return this.th.pq(e,this.KD)};return a}();c=function(){function h(){this.Vt=this.cn=this.Ve=this.ad=null;this.fp=new a.i;this.Al=this.Mi=this.Ni=this.od=this.rf=this.ud=this.Nt=this.Wm=this.Zc=this.vb=null;this.Hb=-1;this.ka=0;this.Rj()}h.prototype.Vp=function(){this.Rj();
this.At=!0;null==this.vb?(this.Wm=new a.ga(0),this.vb=[]):(this.Wm.cf(0),this.vb.length=0)};h.prototype.Wc=function(e,g){if(!this.At)throw a.g.xa();var h=new a.i;h.K(g);this.Wm.add(e);this.vb.push(h)};h.prototype.wo=function(){if(!this.At)throw a.g.xa();this.At=!1;null!=this.vb&&0<this.vb.length&&(this.Hb=0,this.Ec=!1)};h.prototype.jG=function(){this.Rj();this.zt=!0;null==this.vb?(this.Wm=new a.ga(0),this.vb=[]):(this.Wm.cf(0),this.vb.length=0)};h.prototype.OA=function(e,g){if(!this.zt)throw a.g.xa();
var h=new a.i;h.K(g);this.Wm.add(e);this.vb.push(h)};h.prototype.$B=function(){if(!this.zt)throw a.g.xa();this.zt=!1;null!=this.vb&&0<this.vb.length&&null!=this.Zc&&0<this.Zc.length&&(-1==this.Hb?this.Hb=3:2==this.Hb?this.Hb=3:3!=this.Hb&&(this.Hb=1),this.Ec=!1)};h.prototype.iG=function(){this.Rj();this.yt=!0;null==this.Zc?(this.Nt=new a.ga(0),this.Zc=[]):(this.Nt.cf(0),this.Zc.length=0)};h.prototype.LA=function(e,g){if(!this.yt)throw a.g.xa();var h=new a.i;h.K(g);this.Nt.add(e);this.Zc.push(h)};
h.prototype.ZB=function(){if(!this.yt)throw a.g.xa();this.yt=!1;null!=this.vb&&0<this.vb.length&&null!=this.Zc&&0<this.Zc.length&&(-1==this.Hb?this.Hb=3:1==this.Hb?this.Hb=3:3!=this.Hb&&(this.Hb=2),this.Ec=!1)};h.prototype.next=function(){if(this.Ec)return!1;for(var e=!0;e;)switch(this.Hb){case 0:e=this.Qw();break;case 1:e=this.yO();break;case 2:e=this.vO();break;case 3:e=this.xO();break;case 4:e=this.LS();break;case 5:e=this.HS();break;case 6:e=this.IS();break;case 7:e=this.JS();break;case 8:e=this.Qu();
break;case 9:e=this.Wy();break;case 10:e=this.$w();break;case 11:e=this.iP();break;case 12:e=this.fP();break;case 13:e=this.gP();break;case 14:e=this.hP();break;case 15:e=this.hF();break;case 16:e=this.gF();break;default:throw a.g.wa();}return this.Ec?!1:!0};h.prototype.YF=function(e){this.ka=e};h.prototype.Fw=function(e){return this.vb[e]};h.prototype.jw=function(e){return this.Zc[e]};h.prototype.jk=function(e){return this.Wm.read(e)};h.prototype.ek=function(e){return this.Nt.read(e)};h.Cv=function(e){return 1==
(e&1)};h.Yk=function(e){return 0==(e&1)};h.prototype.Rj=function(){this.At=this.yt=this.zt=!1;this.pf=this.qf=this.tg=this.ae=-1;this.Ec=!0};h.prototype.Qw=function(){this.mf=this.Ff=-1;if(10>this.vb.length)return this.ae=this.vb.length,this.Hb=5,!0;null==this.ad&&(this.ad=new a.bq(!0),this.cn=this.ad.Re(),this.ud=new a.ga(0));this.ad.Vp();for(var e=0;e<this.vb.length;e++){var g=this.vb[e];this.ad.gq(g.v,g.B)}this.ad.wo();this.ud.xb(2*this.vb.length);this.ud.resize(0);for(e=0;e<2*this.vb.length;e++)this.ud.add(e);
this.Lr(this.ud,2*this.vb.length,!0);this.ae=2*this.vb.length;this.Hb=4;return!0};h.prototype.yO=function(){this.mf=this.Ff=-1;if(10>this.vb.length||10>this.Zc.length)return this.ae=this.vb.length,this.Hb=6,!0;null==this.ad&&(this.ad=new a.bq(!0),this.cn=this.ad.Re(),this.ud=new a.ga(0));this.ad.Vp();for(var e=0;e<this.vb.length;e++){var g=this.vb[e];this.ad.gq(g.v,g.B)}this.ad.wo();this.ud.xb(2*this.vb.length);this.ud.resize(0);for(e=0;e<2*this.vb.length;e++)this.ud.add(e);this.Lr(this.ud,this.ud.size,
!0);this.ae=this.ud.size;-1!=this.qf&&(this.od.Fg(this.qf),this.Ni.resize(0),this.qf=-1);this.Hb=7;return this.gF()};h.prototype.vO=function(){this.mf=this.Ff=-1;if(10>this.vb.length||10>this.Zc.length)return this.ae=this.vb.length,this.Hb=6,!0;null==this.Ve&&(this.Ve=new a.bq(!0),this.Vt=this.Ve.Re(),this.rf=new a.ga(0));this.Ve.Vp();for(var e=0;e<this.Zc.length;e++){var g=this.Zc[e];this.Ve.gq(g.v,g.B)}this.Ve.wo();this.rf.xb(2*this.Zc.length);this.rf.resize(0);for(e=0;e<2*this.Zc.length;e++)this.rf.add(e);
this.Lr(this.rf,this.rf.size,!1);this.tg=this.rf.size;-1!=this.pf&&(this.od.Fg(this.pf),this.Mi.resize(0),this.pf=-1);this.Hb=7;return this.hF()};h.prototype.xO=function(){this.mf=this.Ff=-1;if(10>this.vb.length||10>this.Zc.length)return this.ae=this.vb.length,this.Hb=6,!0;null==this.ad&&(this.ad=new a.bq(!0),this.cn=this.ad.Re(),this.ud=new a.ga(0));null==this.Ve&&(this.Ve=new a.bq(!0),this.Vt=this.Ve.Re(),this.rf=new a.ga(0));this.ad.Vp();for(var e=0;e<this.vb.length;e++){var g=this.vb[e];this.ad.gq(g.v,
g.B)}this.ad.wo();this.Ve.Vp();for(e=0;e<this.Zc.length;e++)g=this.Zc[e],this.Ve.gq(g.v,g.B);this.Ve.wo();this.ud.xb(2*this.vb.length);this.rf.xb(2*this.Zc.length);this.ud.resize(0);this.rf.resize(0);for(e=0;e<2*this.vb.length;e++)this.ud.add(e);for(e=0;e<2*this.Zc.length;e++)this.rf.add(e);this.Lr(this.ud,this.ud.size,!0);this.Lr(this.rf,this.rf.size,!1);this.ae=this.ud.size;this.tg=this.rf.size;-1!=this.qf&&(this.od.Fg(this.qf),this.Ni.resize(0),this.qf=-1);-1!=this.pf&&(this.od.Fg(this.pf),this.Mi.resize(0),
this.pf=-1);this.Hb=7;return!0};h.prototype.LS=function(){var e=this.ud.get(--this.ae),a=e>>1;if(h.Yk(e))return this.ad.remove(a),0==this.ae?(this.mf=this.Ff=-1,this.Ec=!0,!1):!0;this.cn.uy(this.vb[a].v,this.vb[a].B,this.ka);this.Ff=a;this.Hb=10;return!0};h.prototype.HS=function(){if(-1==--this.ae)return this.mf=this.Ff=-1,this.Ec=!0,!1;this.tg=this.Ff=this.ae;this.Hb=13;return!0};h.prototype.IS=function(){if(-1==--this.ae)return this.mf=this.Ff=-1,this.Ec=!0,!1;this.Ff=this.ae;this.tg=this.Zc.length;
this.Hb=14;return!0};h.prototype.JS=function(){var e=this.ud.get(this.ae-1),a=this.rf.get(this.tg-1),c=this.pq(e,!0),b=this.pq(a,!1);return c>b?this.Qu():c<b?this.Wy():h.Cv(e)?this.Qu():h.Cv(a)?this.Wy():this.Qu()};h.prototype.Qu=function(){var e=this.ud.get(--this.ae),g=e>>1;if(h.Yk(e))return-1!=this.qf&&-1!=this.Ni.get(g)?(this.od.Jc(this.qf,this.Ni.get(g)),this.Ni.set(g,-1)):this.ad.remove(g),0==this.ae?(this.mf=this.Ff=-1,this.Ec=!0,!1):!0;if(-1!=this.pf&&0<this.od.vq(this.pf))for(e=this.od.gc(this.pf);-1!=
e;){var c=this.od.getData(e);this.Ve.lg(c);this.Mi.set(c,-1);c=this.od.bb(e);this.od.Jc(this.pf,e);e=c}0<this.Ve.size()?(this.Vt.uy(this.vb[g].v,this.vb[g].B,this.ka),this.Ff=g,this.Hb=12):(-1==this.qf&&(null==this.od&&(this.od=new a.$n),this.Ni=new a.ga(0),this.Ni.resize(this.vb.length,-1),this.Ni.dh(-1,0,this.vb.length),this.qf=this.od.jh(1)),this.Ni.set(g,this.od.addElement(this.qf,g)),this.Hb=7);return!0};h.prototype.Wy=function(){var e=this.rf.get(--this.tg),g=e>>1;if(h.Yk(e))return-1!=this.pf&&
-1!=this.Mi.get(g)?(this.od.Jc(this.pf,this.Mi.get(g)),this.Mi.set(g,-1)):this.Ve.remove(g),0==this.tg?(this.mf=this.Ff=-1,this.Ec=!0,!1):!0;if(-1!=this.qf&&0<this.od.vq(this.qf))for(e=this.od.gc(this.qf);-1!=e;){var c=this.od.getData(e);this.ad.lg(c);this.Ni.set(c,-1);c=this.od.bb(e);this.od.Jc(this.qf,e);e=c}0<this.ad.size()?(this.cn.uy(this.Zc[g].v,this.Zc[g].B,this.ka),this.mf=g,this.Hb=11):(-1==this.pf&&(null==this.od&&(this.od=new a.$n),this.Mi=new a.ga(0),this.Mi.resize(this.Zc.length,-1),
this.Mi.dh(-1,0,this.Zc.length),this.pf=this.od.jh(0)),this.Mi.set(g,this.od.addElement(this.pf,g)),this.Hb=7);return!0};h.prototype.$w=function(){this.mf=this.cn.next();if(-1!=this.mf)return!1;var e=this.ud.get(this.ae)>>1;this.ad.lg(e);this.Hb=4;return!0};h.prototype.iP=function(){this.Ff=this.cn.next();if(-1!=this.Ff)return!1;this.mf=this.Ff=-1;var e=this.rf.get(this.tg)>>1;this.Ve.lg(e);this.Hb=7;return!0};h.prototype.fP=function(){this.mf=this.Vt.next();if(-1!=this.mf)return!1;var e=this.ud.get(this.ae)>>
1;this.ad.lg(e);this.Hb=7;return!0};h.prototype.gP=function(){if(-1==--this.tg)return this.Hb=5,!0;this.fp.K(this.vb[this.ae]);var e=this.vb[this.tg];this.fp.P(this.ka,this.ka);return this.fp.jc(e)?(this.mf=this.tg,!1):!0};h.prototype.hP=function(){if(-1==--this.tg)return this.Hb=6,!0;this.fp.K(this.vb[this.ae]);var e=this.Zc[this.tg];this.fp.P(this.ka,this.ka);return this.fp.jc(e)?(this.mf=this.tg,!1):!0};h.prototype.hF=function(){if(null==this.ad)return this.Ec=!0,!1;this.ae=this.ud.size;0<this.ad.size()&&
this.ad.reset();-1!=this.qf&&(this.od.Fg(this.qf),this.Ni.resize(0),this.qf=-1);this.Ec=!1;return!0};h.prototype.gF=function(){if(null==this.Ve)return this.Ec=!0,!1;this.tg=this.rf.size;0<this.Ve.size()&&this.Ve.reset();-1!=this.pf&&(this.od.Fg(this.pf),this.Mi.resize(0),this.pf=-1);this.Ec=!1;return!0};h.prototype.Lr=function(e,g,h){null==this.Al&&(this.Al=new a.Rr);h=new b(this,h);this.Al.sort(e,0,g,h)};h.prototype.BS=function(e,a,c,b){var g=this;e.xd(a,c,function(e,a){var c=g.pq(e,b),n=g.pq(a,
b);return c<n||c==n&&h.Yk(e)&&h.Cv(a)?-1:1})};h.prototype.pq=function(e,a){var g=.5*this.ka;if(a)return a=this.vb[e>>1],g=h.Yk(e)?a.C-g:a.G+g;a=this.Zc[e>>1];return g=h.Yk(e)?a.C-g:a.G+g};return h}();a.sz=c})(B||(B={}));(function(a){var c=function(){function c(){}c.Oa=function(a,e,g,n,b,d){var h=new c;h.v=a;h.C=e;h.Je=g;h.B=n;h.G=b;h.ig=d;return h};c.prototype.Ja=function(){this.Je=this.v=NaN};c.prototype.s=function(){return isNaN(this.v)};c.prototype.UO=function(){return isNaN(this.Je)};c.prototype.K=
function(a,e,g,c,b,d){void 0!==c?"number"===typeof a?(this.v=a,this.C=e,this.Je=g,this.B=c,this.G=b,this.ig=d):(this.v=a.x-.5*e,this.B=this.v+e,this.C=a.y-.5*g,this.G=this.C+g,this.Je=a.z-.5*c,this.ig=this.Je+c):(this.v=a,this.C=e,this.Je=g,this.B=a,this.G=e,this.ig=g)};c.prototype.move=function(a){this.v+=a.x;this.C+=a.y;this.Je+=a.z;this.B+=a.x;this.G+=a.y;this.ig+=a.z};c.prototype.copyTo=function(a){a.v=this.v;a.C=this.C;a.B=this.B;a.G=this.G};c.prototype.Oj=function(a,e,g){this.v>a?this.v=a:this.B<
a&&(this.B=a);this.C>e?this.C=e:this.G<e&&(this.G=e);0==isNaN(this.Je)?this.Je>g?this.Je=g:this.ig<g&&(this.ig=g):this.ig=this.Je=g};c.prototype.Db=function(h,e,g,n,b,d){if("number"===typeof h)n?(this.Db(h,e,g),this.Db(n,b,d)):this.s()?(this.v=h,this.C=e,this.Je=g,this.B=h,this.G=e,this.ig=g):this.Oj(h,e,g);else if(h instanceof a.ee)this.Db(h.x,h.y,h.z);else if(h instanceof c)h.s()||(this.Db(h.v,h.C,h.Je),this.Db(h.B,h.G,h.ig));else throw a.g.N();};c.prototype.Oa=function(a,e,g){a.s()||e.s()?this.Ja():
(this.v=a.qa,this.B=a.va,this.C=e.qa,this.G=e.va,this.Je=g.qa,this.ig=g.va)};c.prototype.hy=function(h){if(null==h||8>h.length)throw a.g.N();h[0]=new a.ee(this.v,this.C,this.Je);h[1]=new a.ee(this.v,this.G,this.Je);h[2]=new a.ee(this.B,this.G,this.Je);h[3]=new a.ee(this.B,this.C,this.Je);h[4]=new a.ee(this.v,this.C,this.ig);h[5]=new a.ee(this.v,this.G,this.ig);h[6]=new a.ee(this.B,this.G,this.ig);h[7]=new a.ee(this.B,this.C,this.ig)};c.prototype.Ey=function(a){if(null==a||0==a.length)this.Ja();else{var e=
a[0];this.K(e.x,e.y,e.z);for(e=1;e<a.length;e++){var g=a[e];this.Oj(g.x,g.y,g.z)}}};return c}();a.fH=c})(B||(B={}));(function(a){(function(a){a.wa=function(){var a=Error();a.message="Internal Error";return a};a.qe=function(){var a=Error();a.message="Not Implemented";return a};a.cj=function(){var a=Error();a.message="The input unit and the spatial reference unit are not of the same unit type.ie Linear vs.Angular";return a};a.xa=function(){var a=Error();a.message="Invalid Call";return a};a.N=function(a){var h=
Error();h.message="Illegal Argument Exception";void 0!==a&&(h.message+=": "+a);return h};a.BI=function(){var a=Error();a.message="Runtime Exception.";return a};a.ra=function(a){var h=Error();h.message="Geometry Exception: "+a;return h};a.PG=function(){var a=Error();a.message="Assert Failed Exception";return a};a.Uc=function(){var a=Error();a.message="IndexOutOfBoundsException";return a};a.aU=function(a){a.message="UserCancelException";return a}})(a.g||(a.g={}))})(B||(B={}));(function(a){var c=function(){function e(e,
a){this.Ma=e;this.hE=a;this.kE=-1;this.rk=!1}e.prototype.next=function(){if(++this.kE==this.hE.F())return null;var e=this.hE.Fa(this.kE);e.scale(this.Ma.Rb);var h=new a.Ka;this.Ma.Iv(e,this.rk,h);return h};e.prototype.ya=function(){return 0};return e}(),b=function(){function e(e,h,c){this.Ma=e;this.Zt=h;this.Om=!1;this.Um=c;this.Mt=[0];this.zj=[0];this.Qi=[0];this.Sq=[0];this.rk=!1;this.$o=new a.Ka;this.Bj=[]}e.prototype.next=function(){if(this.Om){this.Om=!1;this.bd.ia();var e=a.T.Yj(this.$o);return e=
a.Of.Qj(e,this.Ma.jp,!0,!0,this.Ma.Yb)}null==this.bd&&(this.bd=this.Zt.Ca(),this.bd.kb(),null!=this.Um&&this.Um.lo());if(!this.bd.La()){if(!this.bd.kb())return null;null!=this.Um&&this.Um.lo()}e=null;this.zj[0]=0;this.Fx=this.Mt[0]=0;this.uh=NaN;this.Om=!1;for(var c=this.Bj.length=0,b=new a.b,d=new a.b,f=[0];this.bd.La()&&8>this.Fx;){var k=this.bd.ia();b.J(k.Mb());d.J(k.oc());b.scale(this.Ma.Rb);d.scale(this.Ma.Rb);a.ui.Hs(b,d)?b.x=d.x:a.ui.Fs(b,d)&&(d.x=b.x);this.Bj.length=0;a.ui.kC(this.Ma.Gb,this.Ma.Xb,
this.Ma.ke,b,d,this.Ma.Nx,this.Ma.hr,f,this.Qi,this.Sq,this.Bj,this.Mt);null!=this.Um&&(k=this.Bj.slice(0),this.Um.dD(this.Um.ea()-1,k,k.length-1));a.ui.Gs(b,d)?(this.$o.Ja(),this.Ma.Iv(b,this.rk,this.$o),this.Om=!0):(this.$o.Ja(),this.Om=this.Lv(f[0],this.$o));if(this.Om){this.bd.oi();if(this.bd.Ow()){this.bd.oi();this.bd.ia();break}this.bd.yR();break}null==e&&(e=new a.Ka,e.lo());this.TA(e);c++}this.Mt[0]=0;if(0<c){for(f=this.bd.Jb();0<c;)this.bd.oi(),b.J(this.Zt.Fa(this.bd.Jb())),d.J(this.Zt.Fa(this.bd.Bm())),
b.scale(this.Ma.Rb),d.scale(this.Ma.Rb),this.rk&&(a.ui.Hs(b,d)?b.x=d.x:a.ui.Fs(b,d)&&(d.x=b.x)),this.Bj.length=0,a.ui.kC(this.Ma.Gb,this.Ma.Xb,this.Ma.ke,d,b,this.Ma.Nx,this.Ma.hr,null,this.Qi,this.Sq,this.Bj,this.Mt),this.TA(e),c--;b.J(this.Zt.Fa(this.bd.Jb()));b.scale(this.Ma.Rb);h.kq(this.Ma.Gb,this.Ma.Xb,this.Ma.Rb,this.Ma.hb,b,this.uh+1.570796326794897,this.uh+4.71238898038469,this.Ma.Sm,this.rk,this.zj,e,NaN,NaN);this.bd.Sb(f);this.bd.ia();c=a.Ia.Cg(null,e,!0);return e=a.Of.Qj(e,c,!0,!0,this.Ma.Yb)}this.Om=
!1;this.bd.ia();e=a.T.Yj(this.$o);return e=a.Of.Qj(e,this.Ma.jp,!0,!0,this.Ma.Yb)};e.prototype.TA=function(e){var g=this.Bj[0],c,b=this.Qi[0]-1.570796326794897,d=this.Sq[0]+1.570796326794897,f;if(!isNaN(this.uh)){this.uh>=this.Qi[0]?(c=this.uh+1.570796326794897,b=c+3.141592653589793-(this.uh-this.Qi[0])):(c=this.uh+1.570796326794897,b=c+3.141592653589793-(6.283185307179586-(this.Qi[0]-this.uh)));f=this.uh>=this.Qi[0]&&3.141592653589793>=this.uh-this.Qi[0]?!1:this.uh<this.Qi[0]&&3.141592653589793<=
this.Qi[0]-this.uh?!1:!0;var k=!1;if(Math.abs(b-c)<=.5*this.Ma.Sm)if(f){var A=e.Fa(e.F()-2);A.scale(this.Ma.Rb);var m=new a.ca(0);a.zb.gw(this.Ma.Gb,this.Ma.Xb,g.x,g.y,A.x,A.y,m);for(A=m.l;A<=c;)A+=6.283185307179586;for(;A>c;)A-=6.283185307179586;A<b&&(k=!0)}else k=!0;k?(e.eF(0,e.F()-1),this.rk||(g=new a.b,g.J(e.Fa(e.F()-1)),g.scale(this.Ma.Rb),-3.141592653589793>g.x-this.zj[0]?this.zj[0]-=6.283185307179586:3.141592653589793<g.x-this.zj[0]&&(this.zj[0]+=6.283185307179586)),f||(b=.5*(b+c))):(f?(c=
new a.b,c.J(g),c.scale(1/this.Ma.Rb),e.kf(0,-1,c)):h.kq(this.Ma.Gb,this.Ma.Xb,this.Ma.Rb,this.Ma.hb,this.Bj[0],c,b,this.Ma.Sm,this.rk,this.zj,e,NaN,NaN),this.Fx+=1)}h.Hv(this.Ma.Gb,this.Ma.Xb,this.Ma.Rb,this.Ma.hb,this.Ma.ke,this.Bj,b,d,this.rk,this.zj,e);this.uh=this.Sq[0]};e.prototype.Lv=function(e,a){return this.Ma.Lv(this.Bj,e,this.Qi[0],this.Sq[0],this.rk,a)};e.prototype.ya=function(){return 0};return e}(),h=function(){function e(){}e.buffer=function(g,h,c,b,d,f){if(null==g)throw a.g.N("Geometry::Geodesic_bufferer::buffer");
if(g.s())return new a.Ka(g.description);var n=new e;n.sg=h;n.wc=a.Ya.Em(h);var y=a.Ya.ft(n.wc);n.Yb=f;n.Gb=a.Ya.Ts(n.wc);n.Xb=y*(2-y);n.Rb=n.wc.Se().Dj;n.ka=n.sg.xq();n.jp=n.wc.xq();n.hr=n.jp*n.Rb;n.ip=1.570796326794897/n.Rb;n.rU=3.141592653589793/n.Rb;n.Uq=6.283185307179586/n.Rb;n.sU=n.Uq/6;n.Ix=0;n.qU=1.5707963267948966*n.Gb/n.Ix;4==c?(n.ke=2,n.Gt=!0):(n.ke=c,n.Gt=!1);n.Da=b;n.hb=Math.abs(b);isNaN(d)||.001>d?n.sS():n.Rm=d;c=g.D();a.T.Lc(c)?(c=new a.Xa(g.description),c.Bc(g,!0),g=c,c=1607):197==
c&&(c=new a.i,g.o(c),c.aa()<=n.ka||c.ba()<=n.ka?(c=new a.Xa(g.description),c.Wc(g,!1),g=c,c=1607):(c=new a.Ka(g.description),c.Wc(g,!1),g=c,c=1736));n.tS();a.T.Km(c)||n.uS();if(n.hb<=.5*n.Rm)return 1736!=c?new a.Ka(g.description):n.Gt?g:a.ui.oq(g,n.sg,n.ke,n.Nx,-1,f);if(0>n.Da&&1736!=c)return new a.Ka(g.description);n.Gt&&a.T.Kc(c)?(h=a.ui.oq(g,h,4,NaN,n.Rm,f),g=a.Ya.Wl(h,n.sg,n.wc)):g=a.Ya.Wl(g,n.sg,n.wc);g=a.gh.qo(g,n.wc);if(g.s())return new a.Ka(g.description);!n.Gt&&a.T.Kc(c)&&(g=a.ui.IE(n.Rb,
g));g=e.PS(g,n.wc);switch(c){case 1736:h=n.yK(g);break;case 1607:h=n.zK(g);break;case 550:h=n.wK(g);break;case 33:h=n.xK(g);break;default:throw a.g.ra("corrupted_geometry");}n=a.Ya.Wl(h,n.wc,n.sg);n.Ik(g.description);return n};e.prototype.yK=function(e){var g=new a.Ka;e=new b(this,e,g);e=a.wi.local().$(e,this.wc,this.Yb).next();e=a.Vn.nl(e,this.wc,2);var h=new a.Bg;h.scale(1/this.Rb,1/this.Rb);g.Oe(h);g=a.Vn.nl(g,this.wc,2);return 0<=this.Da?a.wi.local().$(g,e,this.wc,this.Yb):a.Zr.local().$(g,e,
this.wc,this.Yb)};e.prototype.zK=function(e){e=new b(this,e,null);e=a.wi.local().$(e,this.wc,this.Yb).next();return e=a.Vn.nl(e,this.wc,2)};e.prototype.wK=function(e){e=new c(this,e);e=a.wi.local().$(e,this.wc,this.Yb).next();return e=a.Vn.nl(e,this.wc,2)};e.prototype.xK=function(e){e=e.w();e.scale(this.Rb);var g=new a.Ka;this.Iv(e,!1,g);return g=a.Vn.nl(g,this.wc,2)};e.prototype.Lv=function(g,h,c,b,d,f){var n=g[0],y=g[g.length-1],k=n.y>y.y?n.y:y.y,A=a.u.q(this.Gb,this.Xb,n.y<y.y?n.y:y.y),k=a.u.q(this.Gb,
this.Xb,k);if(.001<this.Ix-(A+h+this.hb)&&.001<this.Ix+(k-h-this.hb))return!1;h=c-1.570796326794897;c=b+1.570796326794897;var A=h-3.141592653589793,k=h+3.141592653589793,m=c+3.141592653589793,F=[NaN],p=[NaN],r=[NaN],u=[NaN];b=!1;e.wG(this.Gb,this.Xb,this.hb,n,h,A,y,c,F,p);e.wG(this.Gb,this.Xb,this.hb,y,m,c,n,A,r,u);c<F[0]&&F[0]<m?b=!0:c<p[0]&&p[0]<m&&(b=!0);b||(A<r[0]&&r[0]<h?b=!0:A<u[0]&&u[0]<h&&(b=!0));if(!b&&d)return!1;for(var v=[],N=g.length-1;0<=N;N--)v.push(g[N]);f.Ja();f.lo();N=[0];e.Hv(this.Gb,
this.Xb,this.Rb,this.hb,this.ke,g,h,c,d,N,f);e.kq(this.Gb,this.Xb,this.Rb,this.hb,y,c,m,this.Sm,d,N,f,F[0],p[0]);e.Hv(this.Gb,this.Xb,this.Rb,this.hb,this.ke,v,m,k,d,N,f);e.kq(this.Gb,this.Xb,this.Rb,this.hb,n,A,h,this.Sm,d,N,f,r[0],u[0]);g=!1;d||(g=this.zB(this.Rb,f));return b||g};e.prototype.Iv=function(a,h,c){c.Ja();c.lo();e.kq(this.Gb,this.Xb,this.Rb,this.hb,a,-this.Sm,6.283185307179586,this.Sm,h,[0],c,NaN,NaN);h||this.zB(this.Rb,c)};e.prototype.zB=function(e,a){var g=this.XK(e,a);e=this.YK(e,
a);return g||e};e.prototype.XK=function(e,h){var g=h.F(),c=!1,n=new a.i;h.o(n);if(!a.j.S(n.G*e,1.570796326794897)&&!a.j.S(n.C*e,-1.570796326794897))return!1;for(var b=new a.b,g=g-1;0<=g;g--)h.w(g,b),b.y==n.G&&a.j.S(b.y*e,1.570796326794897)?(c=!0,this.RE(b,g,h)):b.y==n.C&&a.j.S(b.y*e,-1.570796326794897)&&(c=!0,this.RE(b,g,h));return c};e.prototype.YK=function(e,a){var g=a.Fa(0),h=a.Fa(a.F()-1);return 3.141592653589793<Math.abs(g.x-h.x)*e?(this.RQ(a),!0):this.WK(a)};e.prototype.WK=function(e){return 0>
e.Mh()?(this.QQ(e),!0):!1};e.prototype.RE=function(e,h,c){var g=c.F(),n=0<h?h-1:g-1,g=c.Fa(h<g-1?h+1:0),n=c.Fa(n);if(!a.j.S(g.y,e.y)&&!a.j.S(g.x,e.x)){var b=new a.b;b.ma(g.x,e.y);c.ic(h,b)}a.j.S(n.y,e.y)||a.j.S(n.x,e.x)||(g=new a.b,g.ma(n.x,e.y),c.kf(0,h,g))};e.prototype.RQ=function(e){var g=new a.Ka,h=new a.Ka,c=new a.Bg,b=e.Fa(0),d=e.Fa(e.F()-1),f=new a.b;b.x>d.x?(d=this.ip,c.Nn(-this.Uq,0)):(d=-this.ip,c.Nn(this.Uq,0));g.add(e,!1);e.Ja();h.add(g,!1);h.Oe(c);b=new a.i;h.o(b);b.P((this.Uq-b.aa())/
2,0);b.C=-this.ip;b.G=this.ip;for(var k=0;k<h.F();k++)h.w(k,f),g.kf(0,-1,f);h.Oe(c);for(k=0;k<h.F();k++)h.w(k,f),g.kf(0,-1,f);h=g.Fa(0);c=g.Fa(g.F()-1);f.ma(c.x,d);g.kf(0,-1,f);f.ma(.5*(c.x+h.x),d);g.kf(0,-1,f);f.ma(h.x,d);g.kf(0,-1,f);g=a.gh.Rw(g,this.wc,2,b.v);g=a.gh.Rw(g,this.wc,2,b.B);g=a.Ed.clip(g,b,this.jp,NaN);e.add(g,!1)};e.prototype.QQ=function(e){var g=new a.i;e.o(g);g.P((this.Uq-g.aa())/2,0);g.C=-this.ip;g.G=this.ip;e.lo();var h=new a.b;h.ma(g.v,g.C);e.kf(1,-1,h);h.ma(g.v,g.G);e.kf(1,-1,
h);h.ma(.5*(g.v+g.B),g.G);e.kf(1,-1,h);h.ma(g.B,g.G);e.kf(1,-1,h);h.ma(g.B,g.C);e.kf(1,-1,h);h.ma(.5*(g.v+g.B),g.C);e.kf(1,-1,h)};e.Hv=function(g,h,c,b,d,f,k,A,m,p,r){var n=null;m||(n=new a.b,n.Eh(),0<r.F()&&(n.J(r.Fa(r.F()-1)),n.scale(c)));var y=new a.ca(0),F=new a.ca(0),u=new a.ca(0),v=new a.b,q=new a.b,N=f[f.length-1];c=1/c;for(var x=0;x<f.length;x++){var D=f[x],B;0==x?B=k:x==f.length-1?B=A:(a.zb.Rd(g,h,N.x,N.y,D.x,D.y,null,null,y,d),B=y.l-1.570796326794897);a.zb.Ph(g,h,D.x,D.y,b,B,F,u);m?q.ma(F.l,
u.l):(v.ma(F.l,u.l),e.Gz(D.x,v.x,n.x,p),q.ma(p[0]+v.x,v.y),n.J(q));q.scale(c);r.kf(0,-1,q)}};e.kq=function(g,h,c,b,d,f,k,A,m,p,r,u,v){if(!(k-f<A)){var n=new a.ca(0),y=new a.ca(0),F=new a.b,q=new a.b,N=null;m||(N=new a.b,N.Eh(),0<r.F()&&(N.J(r.Fa(r.F()-1)),N.scale(c)));var x=a.I.truncate(Math.ceil(f/A)),D=x++*A;D==f&&(D=x++*A);for(c=1/c;D<k+A;){f<u&&u<D?(D=u,x--):f<v&&v<D&&(D=v,x--);if(D>=k)break;a.zb.Ph(g,h,d.x,d.y,b,D,n,y);m?q.ma(n.l,y.l):(F.ma(n.l,y.l),e.Gz(d.x,F.x,N.x,p),q.ma(p[0]+F.x,F.y),N.J(q));
q.scale(c);r.kf(0,-1,q);f=D;D=x++*A}}};e.wG=function(e,h,c,b,d,f,k,A,m,p){var g=new a.b,n=new a.b,y=new a.ca(0),F=new a.ca(0);a.zb.Ph(e,h,b.x,b.y,c,d,y,F);g.ma(y.l,F.l);a.zb.Ph(e,h,b.x,b.y,c,f,y,F);n.ma(y.l,F.l);c=new a.ca(0);a.zb.gw(e,h,k.x,k.y,g.x,g.y,c);m[0]=c.l;a.zb.gw(e,h,k.x,k.y,n.x,n.y,c);for(p[0]=c.l;m[0]<=p[0];)m[0]+=6.283185307179586;for(;m[0]>p[0];)m[0]-=6.283185307179586;for(;m[0]>=A;)m[0]-=6.283185307179586,p[0]-=6.283185307179586;for(;m[0]<A;)m[0]+=6.283185307179586,p[0]+=6.283185307179586};
e.Gz=function(e,a,h,c){if(isNaN(h)){for(;3.141592653589793<c[0]+a-e;)c[0]-=6.283185307179586;for(;3.141592653589793<e-(c[0]+a);)c[0]+=6.283185307179586}else 3.141592653589793<c[0]+a-h?c[0]-=6.283185307179586:3.141592653589793<h-(c[0]+a)&&(c[0]+=6.283185307179586)};e.PS=function(e,h){var g=e.D(),c;a.T.Kc(g)?c=e.ea():550==g?c=e.F():c=1;if(1==c)return e;var n=new a.ga(0);n.resize(c);for(var b=[],d=new a.i,f=0;f<c;f++){n.write(f,f);var k;a.T.Kc(g)?(e.Ti(f,d),k=d.Af()):k=e.Fa(f);k=a.qH.QS(h,k);b[f]=k}n.xd(0,
n.size,function(e,a){return b[e]<b[a]?-1:b[e]>b[a]?1:0});d=e.Pa();for(f=0;f<c;f++)k=n.read(f),a.T.Kc(g)?d.Zj(e,k,!0):d.Pd(e,k,k+1);return d};e.prototype.tS=function(){var e=Math.min(3.141592653589793*this.Gb-this.hb,this.hb),e=Math.min(e,.39269908169872414*this.Gb),h=new a.b;h.ma(0,10*this.Rb);var c=45*this.Rb,b=new a.ca(0),d=new a.ca(0),f=new a.ca(0),k=new a.ca(0),A=new a.ca(0),m=new a.ca(0),p=new a.ca(0),r=new a.ca(0),u=new a.b,v=new a.b,q=new a.b,x=new a.b;a.zb.Ph(this.Gb,this.Xb,h.x,h.y,e,0,b,
d);u.ma(b.l,d.l);a.zb.Ph(this.Gb,this.Xb,h.x,h.y,e,c,f,k);v.ma(f.l,k.l);for(var b=new a.ca(0),d=new a.ca(0),D=new a.ca(0);;){a.zb.Ph(this.Gb,this.Xb,h.x,h.y,e,.5*(0+c),A,m);q.ma(A.l,m.l);a.zb.Rd(this.Gb,this.Xb,u.x,u.y,v.x,v.y,b,d,null,2);a.zb.dk(this.Gb,this.Xb,u.x,u.y,.5*b.l,d.l,p,r,2);x.ma(p.l,r.l);a.zb.Rd(this.Gb,this.Xb,q.x,q.y,x.x,x.y,D,null,null,2);if(D.l<=this.Rm)break;c*=.9;a.zb.Ph(this.Gb,this.Xb,h.x,h.y,e,c,f,k);v.ma(f.l,k.l)}this.Sm=6.283185307179586/Math.ceil(6.283185307179586/(c-0))};
e.prototype.uS=function(){var e=Math.min(3.141592653589793*this.Gb-this.hb,this.hb),e=Math.min(e,.39269908169872414*this.Gb),h=new a.b,c=new a.b;h.ma(0,10*this.Rb);c.ma(10*this.Rb,10*this.Rb);var b=new a.ca(0),d=new a.ca(0),f=new a.ca(0);a.zb.Rd(this.Gb,this.Xb,h.x,h.y,c.x,c.y,f,b,d,this.ke);var k=new a.ca(0),A=new a.ca(0),m=new a.ca(0),p=new a.ca(0),r=new a.b,u=new a.ca(0),v=new a.ca(0),q=new a.ca(0),x=new a.ca(0),D=new a.ca(0),B=new a.ca(0),t=new a.ca(0),z=new a.ca(0),l=new a.ca(0),C=new a.b,E=
new a.b,I=new a.b,S=new a.b,G=1,b=b.l,d=d.l+1.570796326794897,f=f.l;a.zb.Ph(this.Gb,this.Xb,h.x,h.y,e,b-1.570796326794897,v,q);C.ma(v.l,q.l);a.zb.Ph(this.Gb,this.Xb,c.x,c.y,e,d,x,D);E.ma(x.l,D.l);for(var v=new a.ca(0),q=new a.ca(0),d=new a.ca(0),H=new a.ca(0);;){a.zb.dk(this.Gb,this.Xb,h.x,h.y,.5*(0+G)*f,b,k,A,this.ke);r.ma(k.l,A.l);a.zb.Rd(this.Gb,this.Xb,h.x,h.y,r.x,r.y,null,null,u,this.ke);a.zb.Ph(this.Gb,this.Xb,r.x,r.y,e,u.l+1.570796326794897,B,t);I.ma(B.l,t.l);a.zb.Rd(this.Gb,this.Xb,C.x,C.y,
E.x,E.y,v,q,null,2);a.zb.dk(this.Gb,this.Xb,C.x,C.y,.5*v.l,q.l,z,l,2);S.ma(z.l,l.l);a.zb.Rd(this.Gb,this.Xb,I.x,I.y,S.x,S.y,d,null,null,2);if(d.l<=this.Rm)break;G*=.9;a.zb.dk(this.Gb,this.Xb,h.x,h.y,G*f,b,m,p,this.ke);c.ma(m.l,p.l);a.zb.Rd(this.Gb,this.Xb,h.x,h.y,c.x,c.y,null,null,H,this.ke);a.zb.Ph(this.Gb,this.Xb,c.x,c.y,e,H.l+1.570796326794897,x,D);E.ma(x.l,D.l)}e=G*f;1E5<e&&(e=1E5);this.Nx=e};e.prototype.sS=function(){var e;e=5E4<this.hb?100:1E4<this.hb?10:1;500>this.hb/e&&(e=this.hb/500);.01>
e&&(e=.01);this.Rm=e};return e}();a.pH=h})(B||(B={}));(function(a){var c=function(){function c(){}c.ac=function(h,e){var g=new a.b;g.J(e);h.push(g)};c.$i=function(a,e){a.add(e.x);a.add(e.y)};c.cx=function(a){a.cf(a.size-2)};c.cy=function(a,e){e.ma(a.get(a.size-2),a.get(a.size-1))};c.oq=function(h,e,g,n,b,d){if(null==h)throw a.g.N();var y=h.D();if(h.s()||a.T.Km(y))return h;var f=new c;f.sg=e;f.wc=a.Ya.Em(e);var k=a.Ya.ft(f.wc);f.Yb=d;f.Gb=a.Ya.Ts(f.wc);f.Xb=k*(2-k);f.Rb=f.wc.Se().Dj;f.jp=f.wc.xq();
f.hr=f.jp*f.Rb;f.Bx=n;f.Ax=b;f.ke=g;197==y?(g=new a.Ka(h.description),g.Wc(h,!1)):a.T.Lc(y)?(g=new a.Xa(h.description),g.Bc(h,!0)):g=h;if(4!=f.ke){e=0==f.sg.lc(f.wc)?a.Ya.Wl(g,f.sg,f.wc):a.gh.qo(g,f.wc);if(e.s())return e;e=c.IE(f.Rb,e);e=f.hw(e);e=a.Vn.nl(e,f.wc,f.ke);f=a.Ya.Wl(e,f.wc,f.sg)}else{2==a.Nf.Am(e)?(h=a.Ya.TN(),e=a.$r.local().$(g,h,e,d),e==h&&(e=new a.Ka,h.copyTo(e))):e=a.gh.qo(g,f.wc);if(e.s())return e;f=f.wS(e)}return f};c.IE=function(h,e){var g=new a.i;e.dd(g);if(3.141592653589793>g.aa()*
h)return e;for(var n=!1,g=e.Ca(),b=new a.b,d=new a.b;g.kb();)for(;g.La();){var f=g.ia();b.J(f.Mb());d.J(f.oc());b.scale(h);d.scale(h);if(3.141592653589793<Math.abs(b.x-d.x)){var k=c.Gs(b,d);if(!k){n=!0;break}if(6.283185307179586<Math.abs(b.x-d.x)){n=!0;break}}}if(!n)return e;var n=e.Pa(),A=1<e.description.Aa,m=new a.b,p=new a.b,r=new a.b,u=new a.b,v=new a.Va;for(g.Lk();g.kb();)for(var q=NaN,x=[0];g.La();){f=g.ia();b.J(f.Mb());d.J(f.oc());b.scale(h);d.scale(h);isNaN(q)?(c.Bd(b.x,NaN,x),p.J(b)):p.J(r);
q=p.x;if(k=c.Gs(b,d)){if(6.283185307179586<d.x-b.x)for(;6.283185307179586<d.x-b.x;)d.x-=6.283185307179586;if(-6.283185307179586>d.x-b.x)for(;-6.283185307179586>d.x-b.x;)d.x+=6.283185307179586;c.Bd(d.x,NaN,x);r.J(d)}else m.J(d),c.eK(m),c.Bd(m.x,q,x),r.ma(x[0]+m.x,m.y);.5>Math.abs(r.x-d.x)&&r.J(d);A?(f.uu(0,v),u.J(p),u.scale(1/h),v.ic(u),(k=g.wl())?n.df(v):n.lineTo(v),g.Jm()&&!e.vc(g.Qa)&&(f.uu(1,v),u.J(r),u.scale(1/h),v.ic(u),n.lineTo(v))):((k=g.wl())&&n.Sw(),f=n.ea()-1,u.J(p),u.scale(1/h),n.kf(f,
-1,u),g.Jm()&&!e.vc(g.Qa)&&(u.J(r),u.scale(1/h),n.kf(f,-1,u)))}return n};c.kC=function(h,e,g,n,b,d,f,k,A,m,p,r){var y=new a.b,F=new a.b,u=0<n.compare(b);c.Ez(u,n,b,y,F);c.Jz(h,e,g,y,F,d,NaN,f,k,A,m,null,p,r);u&&c.gy(A,m,null,p)};c.prototype.hw=function(h){var e=h.Pa(),g=h.Ca(),n=[],b=null,d=null,f=1<h.description.Aa;f&&(b=new a.qd(0),d=new a.Ag);for(var k=[0],A=new a.b,m=new a.b,p=new a.b,r=new a.b;g.kb();)for(k[0]=0;g.La();){var u=g.ia();A.J(u.Mb());m.J(u.oc());A.scale(this.Rb);m.scale(this.Rb);
var v=0<A.compare(m);c.Ez(v,A,m,p,r);n.length=0;null!=b&&b.cf(0);0<this.Bx?c.Jz(this.Gb,this.Xb,this.ke,p,r,this.Bx,this.Ax,this.hr,null,null,null,f?b:null,n,k):c.dH(this.Gb,this.Xb,this.ke,p,r,this.Ax,this.hr,f?b:null,n,k);v&&c.gy(null,null,f?b:null,n);n[0].J(u.Mb());n[n.length-1].J(u.oc());for(var q=1;q<n.length-1;q++)n[q].scale(1/this.Rb);f?(v=c.Cz(v,u,d),c.oz(g.wl(),g.Jm()&&!h.vc(g.Qa),u,v,b,n,e)):c.mz(g.wl(),g.Jm()&&!h.vc(g.Qa),n,e)}return e};c.prototype.wS=function(h){var e=h.Pa(),g=h.Ca(),
n=[],b=null,d=new a.Ag,f=1<h.description.Aa;for(f&&(b=new a.qd(0));g.kb();)for(;g.La();){var k=g.ia(),A=k.Mb(),m=k.oc(),A=0<A.compare(m),m=c.Cz(A,k,d);n.length=0;null!=b&&b.cf(0);c.FR(this.Gb,this.Xb,this.Rb,m,this.sg,this.Bx,this.Ax,f?b:null,n);A&&c.gy(null,null,f?b:null,n);f?c.oz(g.wl(),g.Jm()&&!h.vc(g.Qa),k,m,b,n,e):c.mz(g.wl(),g.Jm()&&!h.vc(g.Qa),n,e)}return e};c.mz=function(a,e,g,c){a&&c.Sw();a=c.ea()-1;var h=g.slice(0);c.dD(a,h,h.length-1);e&&c.kf(a,-1,g[g.length-1])};c.oz=function(h,e,g,c,
b,d,f){var n=new a.Va;g.En(n);h?f.df(n):f.lineTo(n);if(2<d.length){h=c.$b();for(var y=1;y<d.length-1;y++){var k=c.AD(b.get(y)*h);c.uu(k,n);n.ic(d[y]);f.lineTo(n)}}e&&(g.Bn(n),f.lineTo(n))};c.Jz=function(h,e,g,n,b,d,f,k,A,m,p,r,u,v){var y=new a.ca(0),F=new a.ca(0),q=new a.ca(0);a.zb.Rd(h,e,n.x,n.y,b.x,b.y,q,y,F,g);var q=q.l,x=y=y.l,F=F.l;0>x&&(x+=6.283185307179586);0>F&&(F+=6.283185307179586);null!=A&&(A[0]=q);null!=m&&(m[0]=x);null!=p&&(p[0]=F);m=A=NaN;null!=r&&(m=a.u.gg(h,e),p=a.u.q(h,e,n.y),A=(m-
p)/q,m=(m+p)/q);p=c.Hs(n,b);var F=c.Fs(n,b),x=p||F,N=c.wz(n,b,k),D=new a.ca(0),B=new a.ca(0),t=new a.b,z=new a.b,l=new a.b;c.Bd(n.x,NaN,v);var C=[v[0]];if(q<=d)c.ac(u,n),c.Bd(b.x,NaN,v),null!=r&&r.add(0),x?(p&&c.by(n,b,r,u),F&&c.Vx(n,b,r,u)):N?c.Xx(n,b,y,A,m,r,u):0<f&&(z.ma(n.x-C[0],n.y),t.ma(b.x-v[0],b.y),c.yv(h,e,g,n,q,y,z,t,0,1,f,r,u,C)),c.ac(u,b);else{d=1+a.I.truncate(Math.ceil(q/d));var Y=q/(d-1),U=new a.b,E=0;c.ac(u,n);U.J(n);z.ma(n.x-v[0],n.y);null!=r&&r.add(0);for(var I=1;I<d;I++){var G;I<
d-1?(a.zb.dk(h,e,n.x,n.y,I*Y,y,D,B,g),t.ma(D.l,B.l),c.Bd(t.x,U.x,v),l.ma(v[0]+t.x,t.y),G=I/(d-1)):(c.Bd(b.x,NaN,v),t.ma(b.x-v[0],b.y),l.J(b),G=1);x?(1==I&&p&&c.by(n,l,r,u),I==d-1&&F&&c.Vx(U,b,r,u)):N?c.uz(U,l,k)&&(n.x<b.x?U.x>l.x&&(v[0]+=6.283185307179586,l.ma(v[0]+t.x,t.y)):U.x<l.x&&(v[0]-=6.283185307179586,l.ma(v[0]+t.x,t.y)),c.Xx(U,l,y,A,m,r,u)):0<f&&c.yv(h,e,g,n,q,y,z,t,E,G,f,r,u,C);c.ac(u,l);null!=r&&r.add(G);U.J(l);z.J(t);C[0]=v[0];E=G}}};c.dH=function(h,e,g,n,b,d,f,k,A,m){var y=new a.ca(0),
p=new a.ca(0),F=new a.ca(0);a.zb.Rd(h,e,n.x,n.y,b.x,b.y,F,y,p,g);var p=F.l,y=y.l,r=F=NaN;if(null!=k)var r=a.u.gg(h,e),u=a.u.q(h,e,n.y),F=(r-u)/p,r=(r+u)/p;var u=c.Hs(n,b),v=c.Fs(n,b),q=u||v;f=c.wz(n,b,f);var x=c.Gs(n,b),x=q||f||x;c.Bd(n.x,NaN,m);var N=new a.b;c.ac(A,n);N.J(n);null!=k&&k.add(0);x?(q?(u&&c.by(n,b,k,A),v&&c.Vx(n,b,k,A)):f&&c.Xx(n,b,y,F,r,k,A),c.Bd(b.x,NaN,m),c.ac(A,b)):p<=d?(c.Bd(b.x,NaN,m),c.ac(A,b)):(F=new a.b,f=new a.b,F.J(n),f.J(b),F.x-=m[0],f.x-=m[0],-3.141592653589793>f.x?f.x+=
6.283185307179586:3.141592653589793<f.x&&(f.x-=6.283185307179586),c.yv(h,e,g,n,p,y,F,f,0,1,d,k,A,m),c.ac(A,b),c.Bd(b.x,NaN,m));null!=k&&k.add(1)};c.yv=function(h,e,g,n,b,d,f,k,A,m,p,r,u,v){var y=new a.b,F=new a.b;y.ma(f.x+v[0],f.y);new a.ca(0);new a.ca(0);new a.ca(0);new a.ca(0);var q=new a.ca(0),x=new a.ca(0),N=new a.ca(0),D=new a.b,B=new a.b,t=new a.b,z=new a.b;D.J(f);B.J(k);f=new a.qd(0);k=new a.qd(0);c.$i(f,B);k.add(m);var l=new a.b,C=new a.yb,Y=[];for(c.Kz(4,Y);0<f.size;){for(var U=!1,E,I=NaN,
G=0;3>G;G++)if(E=Y[G]*m+(1-Y[G])*A,a.zb.dk(h,e,n.x,n.y,E*b,d,q,x,g),t.ma(q.l,x.l),0==G&&(I=E,z.J(t)),c.mR(D,t,B,C),C.Kb(C.Gd(t,!0),l),a.zb.Rd(h,e,t.x,t.y,l.x,l.y,N,null,null,2),N.l>p){U=!0;break}U?(B.J(z),m=I,c.$i(f,B),k.add(m)):(c.cx(f),k.oj(k.size-1,1,k.size-1),0<f.size&&(c.Bd(B.x,y.x,v),F.ma(v[0]+B.x,B.y),c.ac(u,F),y.J(F),null!=r&&r.add(m),D.J(B),A=m,c.cy(f,B),m=k.get(k.size-1)))}};c.FR=function(h,e,g,n,b,d,f,k,A){var y=new a.b,m=new a.b,p=new a.b,F=new a.b,r=new a.b,u=new a.b,v=new a.b,q=new a.b,
x=new a.b,N=new a.b,D=new a.ca(0),B=new a.ca(0),t=new a.b,z=[[],[]],l=1==a.Nf.Am(b);b=b.Ko();var C=n.Mb(),Y=n.oc();l?(u.ma(C.x*g,C.y*g),v.ma(Y.x*g,Y.y*g)):(z[0][0]=C.x,z[0][1]=C.y,z[1][0]=Y.x,z[1][1]=Y.y,a.Ya.tu(),u.x=z[0][0]*g,u.y=z[0][1]*g,v.x=z[1][0]*g,v.y=z[1][1]*g);var U=0,E=0,I=1,G=n.mD();y.J(C);m.J(Y);var Y=new a.qd(0),S=new a.qd(0),H=new a.qd(0);c.$i(Y,m);c.$i(S,v);H.add(I);c.ac(A,y);null!=k&&k.add(E);var K=[],J;J=0<f?G?5:3:G?5:1;c.Kz(J,K);for(var w=new a.ca(0),P=new a.ca(0),O=new a.ca(0),
V=new a.ca(0),L=new a.ca(0),T=new a.ca(0),M=new a.ca(0);0<S.size;){var Q=!1,R,fa=NaN;a.zb.Rd(h,e,u.x,u.y,v.x,v.y,w,P,null,2);for(C=0;C<J;C++){if(0==C){if(!G&&0>=f&&w.l<=d&&3.141592653589793>Math.abs(u.x-v.x))break;if(n.rA(E,I)<=b)break}R=K[C]*I+(1-K[C])*E;n.Kb(R,p);l?q.ma(p.x*g,p.y*g):(z[0][0]=p.x,z[0][1]=p.y,a.Ya.tu(),q.x=z[0][0]*g,q.y=z[0][1]*g);if(0==C&&(fa=R,r.J(p),N.J(q),0<d&&(w.l>d||3.141592653589793<=Math.abs(u.x-v.x)))){Q=!0;break}if(G&&0<d){if(a.zb.Rd(h,e,u.x,u.y,q.x,q.y,O,null,null,2),O.l>
d||3.141592653589793<=Math.abs(u.x-q.x)){Q=!0;break}}else if(0<f)if(G?(F.OO(y,m,K[C]),l?x.ma(F.x*g,F.y*g):(z[0][0]=F.x,z[0][1]=F.y,a.Ya.tu(),x.x=z[0][0]*g,x.y=z[0][1]*g)):(F.J(p),x.J(q)),a.zb.Rd(h,e,u.x,u.y,x.x,x.y,V,null,null,2),V.l<=w.l){a.zb.dk(h,e,u.x,u.y,V.l,P.l,D,B,2);t.ma(D.l,B.l);a.zb.Rd(h,e,t.x,t.y,q.x,q.y,L,null,null,2);if(L.l>f){Q=!0;break}if(G){a.zb.Rd(h,e,t.x,t.y,x.x,x.y,T,null,null,2);if(T.l>f){Q=!0;break}a.zb.Rd(h,e,x.x,x.y,q.x,q.y,M,null,null,2);if(M.l>f){Q=!0;break}}}else{Q=!0;break}}Q?
(m.J(r),v.J(N),I=fa,c.$i(Y,m),c.$i(S,v),H.add(I)):(c.cx(Y),c.cx(S),H.oj(H.size-1,1,H.size-1),c.ac(A,m),U+=w.l,null!=k&&k.add(U),0<S.size&&(y.J(m),u.J(v),E=I,c.cy(Y,m),c.cy(S,v),I=H.get(H.size-1)))}if(null!=k)for(h=1/U,C=0;C<k.size;C++)k.write(C,k.read(C)*h)};c.gy=function(a,e,g,c){c.reverse();null!=g&&g.Jp(0,g.size,1);g=null!=a?a[0]:NaN;c=null!=e?e[0]:NaN;null!=a&&(a[0]=c);null!=e&&(e[0]=g)};c.Ez=function(a,e,g,c,b){a?(c.J(g),b.J(e)):(c.J(e),b.J(g))};c.Cz=function(a,e,g){if(!a)return e;g.create(e.D());
e.copyTo(g.get());g.get().reverse();return g.get()};c.Bd=function(a,e,g){if(isNaN(e)){for(;3.141592653589793<g[0]-a;)g[0]-=6.283185307179586;for(;3.141592653589793<a-g[0];)g[0]+=6.283185307179586}else 3.141592653589793<g[0]+a-e?g[0]-=6.283185307179586:3.141592653589793<e-(g[0]+a)&&(g[0]+=6.283185307179586)};c.mR=function(a,e,g,c){3.141592653589793>Math.abs(e.x-a.x)?(c.ed(a),3.141592653589793<=g.x-a.x?c.Ok(g.x-6.283185307179586,g.y):3.141592653589793<=a.x-g.x?c.Ok(g.x+6.283185307179586,g.y):c.Ok(g.x,
g.y)):(c.ed(g),3.141592653589793<=a.x-g.x?c.Ok(a.x-6.283185307179586,a.y):3.141592653589793<=g.x-a.x?c.Ok(a.x+6.283185307179586,a.y):c.Ok(a.x,a.y))};c.Kz=function(a,e){for(var g=0;g<a;g++){var h=Math.ceil(g/2)/(a+1);0!=g%2&&(h=-h);e[g]=.5+h}};c.Hs=function(h,e){return a.j.S(h.y,1.570796326794897)&&!a.j.S(e.y,1.570796326794897)||a.j.S(h.y,-1.570796326794897)&&!a.j.S(e.y,-1.570796326794897)?!0:!1};c.Fs=function(h,e){return a.j.S(e.y,1.570796326794897)&&!a.j.S(h.y,1.570796326794897)||a.j.S(e.y,-1.570796326794897)&&
!a.j.S(h.y,-1.570796326794897)?!0:!1};c.wz=function(h,e,g){return!c.uz(h,e,g)||a.j.S(h.y,1.570796326794897)||a.j.S(h.y,-1.570796326794897)||a.j.S(e.y,1.570796326794897)||a.j.S(e.y,-1.570796326794897)?!1:!0};c.uz=function(a,e,g){return Math.abs(Math.abs(a.x-e.x)-3.141592653589793)<=g?!0:!1};c.Gs=function(h,e){return a.j.S(h.y,1.570796326794897)&&a.j.S(e.y,1.570796326794897)||a.j.S(h.y,-1.570796326794897)&&a.j.S(e.y,-1.570796326794897)?!0:!1};c.by=function(h,e,g,n){if(0<h.y){var b=new a.b;b.ma(e.x,
1.570796326794897)}else b=new a.b,b.ma(e.x,-1.570796326794897);a.j.S(h.x,b.x)||a.j.S(e.y,b.y)||(c.ac(n,b),null!=g&&g.add(0))};c.Vx=function(h,e,g,n){if(0<e.y){var b=new a.b;b.ma(h.x,1.570796326794897)}else b=new a.b,b.ma(h.x,-1.570796326794897);a.j.S(e.x,b.x)||a.j.S(h.y,b.y)||(c.ac(n,b),null!=g&&g.add(1))};c.Xx=function(h,e,g,n,b,d,f){a.j.Vc(g)?(0<1.570796326794897-h.y&&(g=new a.b,g.ma(h.x,1.570796326794897),c.ac(f,g),null!=d&&d.add(n)),0<1.570796326794897-e.y&&(g=new a.b,g.ma(e.x,1.570796326794897),
c.ac(f,g),null!=d&&d.add(n))):(0<1.570796326794897+h.y&&(g=new a.b,g.ma(h.x,-1.570796326794897),c.ac(f,g),null!=d&&d.add(b)),0<1.570796326794897+e.y&&(g=new a.b,g.ma(e.x,-1.570796326794897),c.ac(f,g),null!=d&&d.add(b)))};c.eK=function(a){if(-3.141592653589793>a.x)for(;-3.141592653589793>a.x;)a.x+=6.283185307179586;if(3.141592653589793<a.x)for(;3.141592653589793<a.x;)a.x-=6.283185307179586};return c}();a.ui=c})(B||(B={}));(function(a){var c=function(){function c(){}c.nl=function(h,e,g){if(null==h||
null==e||!a.Ya.Qo(e))throw a.g.N();if(h.s())return h;var n=h,b=n.D();if(a.T.Kc(b)){n=a.gh.qo(h,e);h=new a.i;n.o(h);for(var b=a.Ia.zd(e,h,!1),d=a.Ya.Fm(e),f=Math.floor((h.v-d.v)/d.aa())*d.aa()+d.v;f<h.B;)f>h.v+b&&f<h.B-b&&(n=a.gh.Rw(n,e,g,f)),f+=d.aa()}else{if(197==b)return h=new a.Ka(n.description),h.Wc(n,!1),c.nl(h,e,g);if(a.T.Lc(b))return h=new a.Xa(n.description),h.Bc(n,!0),c.nl(h,e,g)}return c.VG(n,e)};c.VG=function(h,e){if(null==h||null==e||!a.Ya.Qo(e))throw a.g.N();if(h.s())return h;var g;g=
h.D();197==g?(g=new a.Ka(h.description),g.Wc(h,!1)):a.T.Lc(g)?(g=new a.Xa(h.description),g.Bc(h,!0)):g=h;g=a.gh.qo(g,e);return g.s()?g:1==a.Nf.Am(e)?a.gh.aN(g,e,g!=h):c.SG(g,e,g!=h)};c.SG=function(h,e,g){if(!a.Ya.Qo(e))throw a.g.N();if(h.s())return h;var c=a.Ya.IC(e),b=0-180*c,c=360*c;2==a.Nf.Am(e)&&(b=a.Ya.Fm(e),c=b.B,b=b.v,c-=b);return a.gh.gC(h,b,c,e,g)};return c}();a.Vn=c})(B||(B={}));(function(a){var c=function(){function c(){}c.OH=function(a,e){var g=Math.abs(a%e);return isNaN(g)||g==a||g<=
Math.abs(e)/2?g:0>a?-1*(g-e):0<a?1*(g-e):0*(g-e)};c.H=function(a){return 0>a?-a:a};c.nb=function(a,e){return 0<=e?c.H(a):-c.H(a)};c.S=function(a,e){return a==e||c.H(a-e)<=c.bF*(1+(c.H(a)+c.H(e))/2)};c.Vc=function(a){return 0==a||c.H(a)<=c.bF};c.bs=function(a){a=c.OH(a,c.fv);return c.H(a)<=c.$g?a:0>a?a+c.fv:a-c.fv};c.Yz=function(a,e){a.l=c.bs(a.l);e.l=c.bs(e.l);c.H(e.l)>c.Vr&&(a.l=c.bs(a.l+c.$g),e.l=c.nb(c.$g,e.l)-e.l)};c.gg=function(a,e){e=Math.sqrt(1-e);e=(1-e)/(1+e);var g=e*e;return a/(1+e)*(1+
g*(.25+g*(.015625+1/256*g)))*c.Vr};c.pN=function(h,e,g,n,b){var d,y,f,k,m,A,p,r=0,u=A=0,v=0,q=0,x=0;m=0;var D,B,t;p=0;var z,l,C;t=new a.ca;d=new a.ca;if(null!=b)if(t.l=h,d.l=e,c.Yz(t,d),h=t.l,e=d.l,t.l=g,d.l=n,c.Yz(t,d),g=t.l,n=d.l,g=c.bs(g-h),c.S(e,n)&&(c.Vc(g)||c.S(c.H(e),c.Vr)))null!=b&&(b.l=0);else{if(c.S(e,-n)){if(c.S(c.H(e),c.Vr)){null!=b&&(b.l=2*c.gg(6378137,.0066943799901413165));return}if(c.S(c.H(g),c.$g)){null!=b&&(b.l=2*c.gg(6378137,.0066943799901413165));return}}if(c.Vc(.0066943799901413165))q=
Math.cos(e),x=Math.cos(n),null!=b&&(r=Math.sin((n-e)/2),A=Math.sin(g/2),p=2*Math.asin(Math.sqrt(r*r+q*x*A*A)),b.l=6378137*p);else{t=1-Math.sqrt(.9933056200098587);h=1-t;d=Math.atan(h*Math.tan(e));e=Math.sin(d);d=Math.cos(d);y=Math.atan(h*Math.tan(n));n=Math.sin(y);y=Math.cos(y);k=f=g;l=0;C=1;z=g;for(B=!0;1==B;)l+=1,1==C&&(m=Math.sin(z),A=Math.cos(z),r=y*m,p=d*n-e*y*A,r=Math.sqrt(r*r+p*p),A=e*n+d*y*A,p=Math.atan2(r,A),u=1E-15>c.H(r)?d*y*m/c.nb(1E-15,r):d*y*m/r,v=1-u*u,q=1E-15>c.H(v)?A-e*n/c.nb(1E-15,
v)*2:A-e*n/v*2,x=q*q,m=((-3*v+4)*t+4)*v*t/16),D=(1-m)*t*(p+m*r*(q+A*m*(2*x-1))),1==C?(z=g+D*u,1E-14>c.H(z-k)?B=!1:c.H(z)>c.$g?(C=2,z=c.$g,0>g&&(z=-z),u=0,v=1,f=k=2,p=c.$g-c.H(Math.atan(e/d)+Math.atan(n/y)),r=Math.sin(p),A=Math.cos(p),m=((-3*v+4)*t+4)*v*t/16,1E-14>c.H(u-f)?B=!1:(q=1E-15>c.H(v)?A-e*n/c.nb(1E-15,v)*2:A-e*n/v*2,x=q*q)):(0>(z-k)*(k-f)&&5<l&&(z=(2*z+3*k+f)/6),f=k,k=z)):(u=(z-g)/D,0>(u-k)*(k-f)&&5<l&&(u=(2*u+3*k+f)/6),f=k,k=u,v=1-u*u,m=u*r/(d*y),A=-Math.sqrt(c.H(1-m*m)),z=Math.atan2(m,A),
r=y*m,p=d*n-e*y*A,r=Math.sqrt(r*r+p*p),A=e*n+d*y*A,p=Math.atan2(r,A),m=((-3*v+4)*t+4)*v*t/16,1E-14>c.H(u-f)?B=!1:(q=1E-15>c.H(v)?A-e*n/c.nb(1E-15,v)*2:A-e*n/v*2,x=q*q));null!=b&&(u=Math.sqrt(1+(1/(h*h)-1)*v),u=(u-1)/(u+1),v=u*(1-.375*u*u),b.l=(1+u*u/4)/(1-u)*h*6378137*(p-v*r*(q+v/4*(A*(-1+2*x)-v/6*q*(-3+4*r*r)*(-3+4*x)))))}}};c.$g=3.141592653589793;c.Vr=1.5707963267948966;c.fv=6.283185307179586;c.bF=3.552713678800501E-15;return c}();a.nH=c})(B||(B={}));(function(a){var c=function(){function a(){}
a.prototype.uv=function(a){this.hi=a};a.prototype.GA=function(a){this.Ab=a};a.prototype.HA=function(a){this.nn=a};a.vB=function(a){return a.s()||1607!=a.D()&&1736!=a.D()?!1:!0};a.tB=function(a){return a.s()||1607!=a.D()&&1736!=a.D()||20>a.F()?!1:!0};a.uB=function(a){return a.s()||1607!=a.D()&&1736!=a.D()||20>a.F()?!1:!0};return a}();a.Wj=c})(B||(B={}));(function(a){var c=function(){function c(){}c.FH=function(h){var e=new a.Ka;e.Uy(h.R.v,h.R.C);e.wj(h.R.v,h.R.G);e.wj(h.R.B,h.R.G);e.wj(h.R.B,h.R.C);
return e};c.aT=function(h,e){var g=a.wi.local();h=new a.Pc(h);return g.$(h,e,null).next()};c.ll=function(h,e,g){return a.Zr.local().$(h,e,g,null)};c.On=function(h,e,g){return a.dv.local().$(h,e,g,null)};c.MS=function(h,e,g){var c=a.dv.local();h=new a.Pc(h);e=new a.Pc(e);g=c.$(h,e,g,null);for(c=[];null!=(e=g.next());)c.push(e);return c};c.lc=function(h,e,g){return a.bl.local().$(3,h,e,g,null)};c.nM=function(h,e,g){return a.bl.local().$(4,h,e,g,null)};c.QO=function(h,e,g){var c=a.$r.local();h=new a.Pc(h);
e=new a.Pc(e);g=c.$(h,e,g,null);for(c=[];null!=(e=g.next());)c.push(e);return c};c.kM=function(h,e,g){var c=a.Zr.local();h=new a.Pc(h);e=new a.Pc(e);g=c.$(h,e,g,null);for(c=[];null!=(e=g.next());)c.push(e);return c};c.Ga=function(h,e,g){return a.$r.local().$(h,e,g,null)};c.jT=function(h,e,g){return a.bl.local().$(2,h,e,g,null)};c.contains=function(h,e,g){return a.bl.local().$(1,h,e,g,null)};c.VL=function(h,e,g){return a.bl.local().$(16,h,e,g,null)};c.touches=function(h,e,g){return a.bl.local().$(8,
h,e,g,null)};c.tQ=function(h,e,g){return a.bl.local().$(32,h,e,g,null)};c.RO=function(h,e,g){return a.bl.local().$(1073741824,h,e,g,null)};c.py=function(h,e,g,c){return a.fI.local().$(h,e,g,c,null)};c.Fb=function(h,e,g,c){var n=null;if(null!=g){if(n=g.Se(),null!=c&&n.Qc()!=c.Qc()&&n.Nc!=c.Nc)throw a.g.cj();}else if(null!=c)throw a.g.N();h=a.ZH.local().$(h,e,null);null!==n&&null!==c&&(h=a.Tb.ih(h,n,c));return h};c.clip=function(h,e,g){return a.SH.local().$(h,a.i.Oa(e.R.v,e.R.C,e.R.B,e.R.G),g,null)};
c.xm=function(h,e,g){if(null==h||null==e)return null;h=a.UH.local().$(!0,h,e,g,null);for(e=[];null!=(g=h.next());)g.s()||e.push(g);return e.slice(0)};c.rK=function(h,e,g,n,b,d,f,k){if(!0===b)return c.VP(h,e,g,n,d,f,k);b=g;if(null!=e){if(f=e.Se(),null!=n&&f.Qc()!=n.Qc()){if(f.Nc!=n.Nc)throw a.g.cj();b=[];a.Tb.OB(g,g.length,n,f,b)}}else if(null!=n)throw a.g.N();g=a.Oz.local();if(d){h=new a.Pc(h);e=g.$(h,e,b,d,null);for(h=[];null!=(d=e.next());)h.push(d);d=h.slice(0)}else for(d=[],n=0;n<h.length;n++)d[n]=
g.$(h[n],e,b[n],null);return d};c.VP=function(h,e,g,c,b,d,f){if(null===e)throw a.g.N();if(null===c||void 0===c)c=4326!==e.Qc()?e.Se():a.Tb.Qd(9001);if(0!==c.Nc)throw a.g.N();a.Tb.OB(g,g.length,c,a.Tb.Qd(9001),g);c=a.Tz.local();if(b){h=new a.Pc(h);e=c.$(h,e,d,g,f,!1,b,null);for(g=[];null!=(d=e.next());)g.push(d);b=g.slice(0)}else{b=[];for(var n=0;n<h.length;n++)b[n]=c.$(h[n],e,d,g[n],f,!1,null)}return b};c.buffer=function(h,e,g,c,b,d,f){var n=g;if(!1===b){if(null!=e){if(b=e.Se(),null!=c&&b.Qc()!=c.Qc()){if(b.Nc!=
c.Nc)throw a.g.cj();n=a.Tb.ih(g,c,b)}}else if(null!=c)throw a.g.N();h=a.Oz.local().$(h,e,n,null)}else{if(null===e)throw a.g.N();if(null===c||void 0===c)c=4326!==e.Qc()?e.Se():a.Tb.Qd(9001);if(0!==c.Nc)throw a.g.N();n=a.Tb.ih(g,c,a.Tb.Qd(9001));h=a.Tz.local().$(h,e,d,n,f,!1,null)}return h};c.sQ=function(h,e,g,c,b,d,f){if(null!=e){var n=e.Se();if(null!=f&&n.Qc()!=f.Qc()){if(n.Nc!=f.Nc)throw a.g.cj();g=a.Tb.ih(g,f,n)}}else if(null!=f)throw a.g.N();h=new a.Pc(h);e=a.Wz.local().$(h,e,g,c,b,d,null);for(g=
[];null!=(c=e.next());)g.push(c);return g.slice(0)};c.offset=function(h,e,g,c,b,d,f){if(null!=e){var n=e.Se();if(null!=f&&n.Qc()!=f.Qc()){if(n.Nc!=f.Nc)throw a.g.cj();g=a.Tb.ih(g,f,n)}}else if(null!=f)throw a.g.N();return a.Wz.local().$(h,e,g,c,b,d,null)};c.JL=function(h){return a.Qz.local().$(h,null)};c.KL=function(h,e){var g=a.Qz.local();h=new a.Pc(h);g=g.$(h,e,null);for(h=[];null!=(e=g.next());)h.push(e);return h};c.zw=function(h,e,g){return a.bv.local().zw(h,e,g)};c.Aw=function(h,e){return a.bv.local().Aw(h,
e)};c.Bw=function(h,e,g,c){return a.bv.local().Bw(h,e,g,c)};c.Qy=function(h,e){return a.as.local().$(h,e,!1,null)};c.cP=function(h,e){return a.as.local().Ro(h,e,null)};c.fN=function(h,e,g,c,b){var n=a.Sz.local();if(null!=e){if(e=e.Se(),null!=b&&e.Qc()!=b.Qc()){if(e.Nc!=b.Nc)throw a.g.cj();g=a.Tb.ih(g,b,e)}}else if(null!=b)throw a.g.N();return n.$(h,g,c,null)};c.oq=function(h,e,g,c){var n=a.WH.local();if(null!=e){if(e=e.Se(),null!=c&&e.Qc()!=c.Qc()){if(e.Nc!=c.Nc)throw a.g.cj();g=a.Tb.ih(g,c,e)}}else if(null!=
c)throw a.g.N();return n.$(h,g,null)};c.fw=function(h,e,g,c,b){void 0===b&&(b=0);var n=a.aI.local();if(4==b)throw a.g.qe();if(0!==b)throw a.g.qe();if(null!=e){var d=e.Se();if(null!=c&&d.Qc()!=c.Qc()){if(d.Nc!=c.Nc)throw a.g.cj();g=a.Tb.ih(g,c,d)}}else if(null!=c)throw a.g.N();return n.$(h,g,e,b,null)};c.jN=function(h,e,g,n){if(null===h)return 0;if(4==n)throw a.g.qe();if(0!==n)throw a.g.qe();if(197==h.D())h=c.FH(h);else if(1736!=h.D())return 0;n=a.Ya.Em(e);h=a.Ya.Wl(h,e,n);h=a.oH.kN([h])[0];if(null!==
g){if(2!==g.Nc)throw a.g.N("Unit must be a area unit type");h=a.Tb.ih(h,a.Tb.Qd(109404),g)}return h};c.nN=function(h,e,g,c){h=a.cI.local().$(h,e,c,null);if(null!==g){if(0!==g.Nc)throw a.g.N("Unit must be a linear unit type");h=a.Tb.ih(h,a.Tb.Qd(9001),g)}return h};c.BQ=function(h,e,g){if(null===h)return 0;var c=null;if(null!=e){c=e.Se();if(0==c.Nc&&(c=a.Tb.PC(c),null==c&&null!==g))throw a.g.N();if(null!=g&&c.Qc()!=g.Qc()&&c.Nc!=g.Nc)throw a.g.cj();}else if(null!=g)throw a.g.N();return 1736==h.D()||
197==h.D()?(h=h.Mh(),null!==g?a.Tb.ih(h,c,g):h):0};c.CQ=function(h,e,g){if(null===h||h.s()||1>h.fb())return 0;var c=null;if(null!=e){if(c=e.Se(),null!=g&&c.Qc()!=g.Qc()&&c.Nc!=g.Nc)throw a.g.cj();}else if(null!=g)throw a.g.N();1736==h.D()||197==h.D()?e=h.Rf():a.T.Lc(h.D())?(e=new a.Xa(h.description),e.Bc(h,!0)):e=h;h=0;e=e.Ca();for(var b=new a.b,d=new a.b;e.kb();)for(;e.La();){var f=e.ia();f.ht(b);f.uw(d);h+=a.b.Fb(b,d)}null!==c&&null!==g&&(h=a.Tb.ih(h,c,g));return h};c.YT=function(h,e){return a.Nf.mN(h,
e)};c.IL=function(a){return void 0!==a.points?c.kH(a,void 0===a.hasZ?!1:a.hasZ,void 0===a.hasM?!1:a.hasM):void 0!==a.rings?c.Nz(a.rings,void 0===a.hasZ?!1:a.hasZ,void 0===a.hasM?!1:a.hasM,"P"):void 0!==a.paths?c.Nz(a.paths,void 0===a.hasZ?!1:a.hasZ,void 0===a.hasM?!1:a.hasM,"L"):void 0!==a.x?c.uH(a):void 0!==a.xmin?c.hH(a):null};c.uH=function(h){if(null==h.x||"NaN"==h.x)return new a.Va;var e=new a.Va(h.x,h.y);void 0!==h.z&&null!==h.z&&e.rS(h.z);void 0!==h.m&&null!==h.m&&e.bS(h.m);return e};c.hH=function(h){if(null==
h.xmin||"NaN"==h.xmin)return new a.Vj;var e=new a.Vj(h.xmin,h.ymin,h.xmax,h.ymax);void 0!==h.zmin&&null!==h.zmin&&e.setInterval(1,0,h.zmin,h.zmax);void 0!==h.mmin&&null!==h.mmin&&e.setInterval(2,0,h.mmin,h.mmax);return e};c.kH=function(h,e,g){var c=0,b=new a.pe,d=3*h.points.length;0!=d%2&&d++;2>d&&(d=2);var f=a.I.truncate(3*h.points.length/2);4>f?f=4:16>f&&(f=16);for(var d=a.Ac.kl(d,0),k=a.Ac.kl(f),f=a.Ac.kl(f),m=0;m<h.points.length;m++)d.write(2*m,h.points[m][0]),d.write(2*m+1,h.points[m][1]),k.write(m,
e||g?h.points[m][2]:NaN),f.write(m,g&&e?h.points[m][3]:NaN),c++;0!=c&&(b.resize(c),b.bm(0,d));e&&(b.Ne(1),b.bm(1,k));g&&(b.Ne(2),b.bm(2,0==e?k:f));b.ce(16777215);return b};c.Nz=function(h,e,g,c){var b,n=0,d=2;"P"==c?(b=new a.Ka,n=1,d=3):b=new a.Xa;for(var f=a.Ac.Dg(0),k=a.Ac.to(0),m=0,A=0,p=[],r=[],u=0;u<h.length;u++){var v=h[u].length;p[u]=!1;if("P"===c&&h[u][0][0]===h[u][h[u].length-1][0]&&h[u][0][1]===h[u][h[u].length-1][1]){var q=0==g?!0:h[u][0][3]===h[u][h[u].length-1][3]||void 0===h[u][0][3]&&
void 0===h[u][h[u].length-1][3];(0==e||h[u][0][2]===h[u][h[u].length-1][2]||void 0===h[u][0][2]&&void 0===h[u][h[u].length-1][2])&&q&&(p[u]=!0,--v)}v>=d?(r[u]=!1,A+=1,f.add(m),k.add(n),m+=v):r[u]=!0}c=3*m;0!=c%2&&c++;2>c&&(c=2);u=a.I.truncate(3*m/2);4>u?u=4:16>u&&(u=16);c=a.Ac.kl(c,0);n=a.Ac.kl(u);d=a.Ac.kl(u);for(u=v=0;u<h.length;u++)if(!1===r[u])for(q=0;q<h[u].length;q++){var x=!1;q===h[u].length-1&&!0===p[u]&&(x=!0);x||(c.write(2*v,h[u][q][0]),c.write(2*v+1,h[u][q][1]),n.write(v,e||g?h[u][q][2]:
NaN),d.write(v,g&&e?h[u][q][3]:NaN),v++)}0!=m&&(h=b,f.resize(A),k.resize(A),0<m&&(f.add(m),k.add(0)),h.bm(0,c),h.NF(k),h.OF(f));e&&(b.Ne(1),b.bm(1,n));g&&(b.Ne(2),b.bm(2,0==e?n:d));b.ce(16777215);return b};return c}();a.Pb=c})(B||(B={}));(function(a){var c=function(){function a(){}a.Zk=function(a){var e=0,g=0,h=a.length,c=a[g],b;for(g;g<h-1;g++)b=a[g+1],e+=(b[0]-c[0])*(b[1]+c[1]),c=b;return 0<=e};a.rotate=function(h,e,g){e=e*Math.PI/180;var c=Math.cos(e),b=Math.sin(e);if(void 0!==h.paths){e={paths:[]};
for(var d=0;d<h.paths.length;d++){for(var f=h.paths[d],k=[],m=0;m<f.length;m++){var A=f[m].slice(0);k.push(A);var p=c*(f[m][0]-g.x)-b*(f[m][1]-g.y)+g.x,r=b*(f[m][0]-g.x)+c*(f[m][1]-g.y)+g.y;A[0]=p;A[1]=r}e.paths.push(k)}return e}if(void 0!==h.rings){e={rings:[]};for(d=0;d<h.rings.length;d++){for(var f=h.rings[d],k=[],u=a.Zk(f),m=0;m<f.length;m++)A=f[m].slice(0),k.push(A),p=c*(f[m][0]-g.x)-b*(f[m][1]-g.y)+g.x,r=b*(f[m][0]-g.x)+c*(f[m][1]-g.y)+g.y,A[0]=p,A[1]=r;a.Zk(k)!==u&&k.reverse();e.rings.push(k)}return e}if(void 0!==
h.x)return e={x:c*(h.x-g.x)-b*(h.y-g.y)+g.x,y:b*(h.x-g.x)+c*(h.y-g.y)+g.y},void 0!==h.z&&(e.z=h.z),void 0!==h.m&&(e.m=h.m),e;if(void 0!==h.points){e={points:[]};h=h.points;for(m=0;m<h.length;m++)d=h[m].slice(0),d[0]=c*(h[m][0]-g.x)-b*(h[m][1]-g.y)+g.x,d[1]=b*(h[m][0]-g.x)+c*(h[m][1]-g.y)+g.y,e.points.push(d);return e}return null};a.eC=function(h,e){var g,c;if(void 0!==h.paths){g={paths:[]};for(var b=0;b<h.paths.length;b++){for(var d=h.paths[b],f=[],k=0;k<d.length;k++){var m=d[k].slice(0);f.push(m);
c=e.x-d[k][0];m[0]=d[k][0]+2*c}g.paths.push(f)}return g}if(void 0!==h.rings){g={rings:[]};for(b=0;b<h.rings.length;b++){for(var d=h.rings[b],A=a.Zk(d),f=[],k=0;k<d.length;k++)m=d[k].slice(0),f.push(m),c=e.x-d[k][0],m[0]=d[k][0]+2*c;a.Zk(f)!==A&&f.reverse();g.rings.push(f)}return g}if(void 0!==h.x)return c=e.x-h.x,g={x:h.x+2*c,y:h.y},void 0!==h.z&&(g.z=h.z),void 0!==h.m&&(g.m=h.m),g;if(void 0!==h.points){g={points:[]};b=h.points;for(k=0;k<b.length;k++)d=b[k].slice(0),c=e.x-d[0],d[0]+=2*c,g.points.push(d);
return g}return void 0!==h.xmin?(g={v:h.xmin,C:h.ymin,B:h.xmax,G:h.ymax},void 0!==h.zmin&&(g.zmin=h.zmin,g.zmax=h.zmax),void 0!==h.mmin&&(g.mmin=h.mmin,g.mmax=h.mmax),c=e.x-h.xmin,g.xmax=h.xmin+2*c,c=e.x-h.xmax,g.xmin=h.xmax+2*c,g):null};a.fC=function(h,e){var g,c;if(void 0!==h.paths){g={paths:[]};for(var b=0;b<h.paths.length;b++){for(var d=h.paths[b],f=[],k=0;k<d.length;k++){var m=d[k].slice(0);f.push(m);c=e.y-d[k][1];m[1]=d[k][1]+2*c}g.paths.push(f)}return g}if(void 0!==h.rings){g={rings:[]};for(b=
0;b<h.rings.length;b++){for(var d=h.rings[b],A=a.Zk(d),f=[],k=0;k<d.length;k++)m=d[k].slice(0),f.push(m),c=e.y-d[k][1],m[1]=d[k][1]+2*c;a.Zk(f)!==A&&f.reverse();g.rings.push(f)}return g}if(void 0!==h.x)return c=e.y-h.y,g={y:h.y+2*c,x:h.x},void 0!==h.z&&(g.z=h.z),void 0!==h.m&&(g.m=h.m),g;if(void 0!==h.points){g={points:[]};b=h.points;for(k=0;k<b.length;k++)d=b[k].slice(0),c=e.y-d[1],d[1]+=2*c,g.points.push(d);return g}return void 0!==h.xmin?(g={v:h.xmin,C:h.ymin,B:h.xmax,G:h.ymax},void 0!==h.zmin&&
(g.zmin=h.zmin,g.zmax=h.zmax),void 0!==h.mmin&&(g.mmin=h.mmin,g.mmax=h.mmax),c=e.y-h.ymin,g.ymax=h.ymin+2*c,c=e.y-h.ymax,g.ymin=h.ymax+2*c,g):null};return a}();a.Wn=c})(B||(B={}));(function(a){var c=function(){function c(){}c.jg=function(h,e){null==e&&(e=a.Od.Tf());switch(h){case 33:return new a.Va(e);case 322:return new a.yb(e);case 197:return new a.Vj(e);case 550:return new a.pe(e);case 1607:return new a.Xa(e);case 1736:return new a.Ka(e);default:throw a.g.ra("invalid argument.");}};return c}();
a.sH=c})(B||(B={}));(function(a){var c=function(){function c(h,e){this.De=a.ga.Yc(h,-1);this.oa=new a.Ur;this.tk=e}c.prototype.wR=function(a){this.oa.Dr(Math.min(this.De.size,a));this.oa.$l(a)};c.prototype.addElement=function(h,e){if(void 0===e)return this.JJ(h);e=a.I.truncate(e%this.De.size);var g=this.De.get(e);-1==g&&(g=this.oa.jh(),this.De.set(e,g));return this.oa.addElement(g,h)};c.prototype.JJ=function(h){var e=this.tk.vw(h),e=a.I.truncate(e%this.De.size),g=this.De.get(e);-1==g&&(g=this.oa.jh(),
this.De.set(e,g));return this.oa.addElement(g,h)};c.prototype.Jc=function(h,e){if(void 0===e)this.dM(h);else{e=a.I.truncate(e%this.De.size);var g=this.De.get(e);if(-1==g)throw a.g.N();for(var c=this.oa.gc(g),b=-1;-1!=c;){var d=this.oa.bb(c);this.oa.da(c)==h?(this.oa.Jc(g,b,c),-1==this.oa.gc(g)&&(this.oa.Fg(g),this.De.set(e,-1))):b=c;c=d}}};c.prototype.dM=function(c){var e=this.tk.vw(c),e=a.I.truncate(e%this.De.size),g=this.De.get(e);if(-1==g)throw a.g.N();for(var h=this.oa.gc(g),b=-1;-1!=h;){var d=
this.oa.bb(h);this.oa.da(h)==c?(this.oa.Jc(g,b,h),-1==this.oa.gc(g)&&(this.oa.Fg(g),this.De.set(e,-1))):b=h;h=d}};c.prototype.DN=function(c){c=a.I.truncate(c%this.De.size);c=this.De.get(c);return-1==c?-1:this.oa.gc(c)};c.prototype.SN=function(a){return this.oa.bb(a)};c.prototype.kd=function(c){var e=this.tk.vw(this.da(c)),e=a.I.truncate(e%this.De.size),g=this.De.get(e);if(-1==g)throw a.g.N();for(var h=this.oa.gc(g),b=-1;-1!=h;){if(h==c){this.oa.Jc(g,b,h);-1==this.oa.gc(g)&&(this.oa.Fg(g),this.De.set(e,
-1));return}b=h;h=this.oa.bb(h)}throw a.g.N();};c.prototype.da=function(a){return this.oa.da(a)};c.prototype.clear=function(){this.De=a.ga.Yc(this.De.size,-1);this.oa.clear()};c.prototype.size=function(){return this.oa.HC()};return c}();a.AH=c})(B||(B={}));(function(a){var c=function(){function c(){this.ci=new a.Fc(3);this.oa=new a.Fc(6);this.AP=!1;this.Wd=-1}c.prototype.bk=function(a){this.ci.Jc(a)};c.prototype.ou=function(){return this.ci.be()};c.prototype.Rs=function(a){this.oa.Jc(a)};c.prototype.Yx=
function(){return this.oa.be()};c.prototype.Jy=function(a,e){this.ci.L(a,1,e)};c.prototype.Gu=function(a,e){this.ci.L(a,2,e)};c.prototype.aS=function(a,e){this.ci.L(a,3,e)};c.prototype.Hy=function(a,e){this.oa.L(a,4,e)};c.prototype.dS=function(a,e){this.oa.L(a,3,e)};c.prototype.RF=function(a,e){this.oa.L(a,2,e)};c.prototype.jh=function(a){var e=this.Yx();this.oa.L(e,3,this.Wd);this.oa.L(e,4,0);this.oa.L(e,5,a);-1!=this.Wd&&this.RF(this.Wd,e);return this.Wd=e};c.prototype.Fg=function(a){this.CB(a);
var e=this.oa.O(a,2),g=this.oa.O(a,3);-1!=e?this.dS(e,g):this.Wd=g;-1!=g&&this.RF(g,e);this.Rs(a);return g};c.prototype.Dr=function(a){this.oa.de(a)};c.prototype.DC=function(a){return this.oa.O(a,5)};c.prototype.$R=function(a,e){this.oa.L(a,5,e)};c.prototype.addElement=function(a,e){return this.AO(a,e)};c.prototype.AO=function(a,e){var g=this.ou();this.Gu(g,-1);-1==this.oa.O(a,0)&&this.oa.L(a,0,g);var c=this.oa.O(a,1);this.Jy(g,c);-1!=c&&this.Gu(c,g);this.oa.L(a,1,g);this.setData(g,e);this.Hy(a,this.vq(a)+
1);this.AP&&this.aS(g,a);return g};c.prototype.Jc=function(a,e){var g=this.ge(e),c=this.bb(e);-1!=g?this.Gu(g,c):this.oa.L(a,0,c);-1!=c?this.Jy(c,g):this.oa.L(a,1,g);this.bk(e);this.Hy(a,this.vq(a)-1);return c};c.prototype.$l=function(a){this.ci.de(a)};c.prototype.getData=function(a){return this.ci.O(a,0)};c.prototype.setData=function(a,e){this.ci.L(a,0,e)};c.prototype.bb=function(a){return this.ci.O(a,2)};c.prototype.ge=function(a){return this.ci.O(a,1)};c.prototype.gc=function(a){return this.oa.O(a,
0)};c.prototype.tc=function(a){return this.oa.O(a,1)};c.prototype.clear=function(){for(var a=this.Wd;-1!=a;)a=this.Fg(a)};c.prototype.CB=function(a){for(var e=this.tc(a);-1!=e;){var g=e,e=this.ge(g);this.bk(g)}this.oa.L(a,0,-1);this.oa.L(a,1,-1);this.Hy(a,0)};c.prototype.s=function(){return 0==this.ci.size};c.prototype.HC=function(){return this.ci.size};c.prototype.vq=function(a){return this.oa.O(a,4)};c.prototype.Cw=function(a){return this.oa.O(a,3)};return c}();a.$n=c})(B||(B={}));(function(a){var c=
function(){function c(c){void 0===c?(this.bg=new a.Fc(2),this.oa=new a.Fc(4),this.Wd=-1,this.Bt=!0):(this.bg=new a.Fc(2),this.oa=new a.Fc(c?4:2),this.Wd=-1,this.Bt=c)}c.prototype.bk=function(a){this.bg.Jc(a)};c.prototype.ou=function(){return this.bg.be()};c.prototype.Rs=function(a){this.oa.Jc(a)};c.prototype.Yx=function(){return this.oa.be()};c.prototype.jh=function(){var a=this.Yx();this.Bt&&(this.oa.L(a,3,this.Wd),-1!=this.Wd&&this.oa.L(this.Wd,2,a),this.Wd=a);return a};c.prototype.Fg=function(a){for(var e=
this.gc(a);-1!=e;){var g=e,e=this.bb(e);this.bk(g)}this.Bt&&(e=this.oa.O(a,2),g=this.oa.O(a,3),-1!=e?this.oa.L(e,3,g):this.Wd=g,-1!=g&&this.oa.L(g,2,e));this.Rs(a)};c.prototype.Dr=function(a){this.oa.de(a)};c.prototype.addElement=function(a,e){var g=this.oa.O(a,1),c=this.ou();-1!=g?this.bg.L(g,1,c):this.oa.L(a,0,c);this.oa.L(a,1,c);this.bg.L(c,0,e);return c};c.prototype.$l=function(a){this.bg.de(a)};c.prototype.Jc=function(a,e,g){-1!=e?(this.bg.L(e,1,this.bg.O(g,1)),this.oa.O(a,1)==g&&this.oa.L(a,
1,e)):(this.oa.L(a,0,this.bg.O(g,1)),this.oa.O(a,1)==g&&this.oa.L(a,1,-1));this.bk(g)};c.prototype.Qv=function(a,e){var g=this.oa.O(a,1),c=this.oa.O(e,0);-1!=c&&(-1!=g?this.bg.L(g,1,c):this.oa.L(a,0,c),this.oa.L(a,1,this.oa.O(e,1)));this.Bt&&(g=this.oa.O(e,2),c=this.oa.O(e,3),-1!=g?this.oa.L(g,3,c):this.Wd=c,-1!=c&&this.oa.L(c,2,g));this.Rs(e)};c.prototype.da=function(a){return this.bg.O(a,0)};c.prototype.Vi=function(a,e){this.bg.L(a,0,e)};c.prototype.bb=function(a){return this.bg.O(a,1)};c.prototype.gc=
function(a){return this.oa.O(a,0)};c.prototype.Dm=function(a){return this.da(this.gc(a))};c.prototype.clear=function(){this.bg.Nh(!0);this.oa.Nh(!0);this.Wd=-1};c.prototype.s=function(a){return void 0===a?0==this.bg.size:-1==this.oa.O(a,0)};c.prototype.HC=function(){return this.bg.size};c.prototype.Cw=function(a){return this.oa.O(a,3)};return c}();a.Ur=c})(B||(B={}));(function(a){var c=function(){function c(){}c.kz=function(h,e,g,b,d,f,k){var n=new a.b;n.J(h);h=new a.b;h.J(e);d.vv(n);d.vv(h);e=d.ms(n);
var y=d.ms(h);0==y&&(y=d.CC());if(n.x!=h.x&&(n.y!=h.y||n.y!=d.C&&n.y!=d.G)||y>e!=f){e=d.vA(n);var y=d.vA(h),m,A=f?1:3;do e=e+A&3,m=d.vu(e),0!=k&&(b=c.kz(n,m,g,b,d,f,k)),g[b++].ma(m.x,m.y),n=m;while((e&3)!=y);0!=k&&(b=c.kz(n,h,g,b,d,f,k))}else if(d=new a.b,d.ma(h.x-n.x,h.y-n.y),0!=k&&(k=a.I.truncate(d.yJ()/k),0<k))for(d.scale(1/(k+1)),f=0;f<k;f++)n.add(d),g[b++].ma(n.x,n.y);return b};c.zd=function(a,e,g){e=e.lv();a=null!=a&&void 0!==a.Ko?a.Ko():0;g&&(e*=4,a*=1.1);return Math.max(a,e)};c.As=function(a){return 2*
Math.sqrt(2)*a};c.UJ=function(a){return Math.sqrt(2)*a};c.Cg=function(h,e,g){var b=new a.i;e.o(b);return c.zd(h,b,g)};c.rB=function(a,e,g){e=e.Ah(1,0).lv();a=null!=a?a.Ko():0;g&&(e*=4,a*=1.1);return Math.max(a,e)};c.$T=function(c,e){var g=new a.i;c.dd(g);g.Db(e);return g};c.$s=function(c,e){var g=new a.i;c.dd(g);c=new a.i;e.dd(c);g.Db(c);return g};c.fU=function(c,e){var g=c.HN(e),h=c.Ea(e),b=c.Dc(e),d=c.Fa(g);g==h?(b=c.Fa(b-1),g=c.Fa(h+1)):g==b-1?(b=c.Fa(g-1),g=c.Fa(h)):(b=c.Fa(g-1),g=c.Fa(g+1));
d=a.b.yn(b,d,g);return 0==d?0<c.oo(e):-1==d};c.CK=function(c){var e=new a.i;c.dd(e);if(e.s())return null;var g=new a.co(e,8),h=-1,b=new a.i,d=!1;do for(var f=0,k=c.ea();f<k;f++)if(c.Ti(f,b),h=g.kt(f,b,h),-1==h){if(d)throw a.g.ra("internal error");c.tm(e,!1);d=!0;g.reset(e,8);break}else d=!1;while(d);return g};c.nB=function(c){var e=new a.i;c.dd(e);for(var g=new a.co(e,8),h=-1,b=c.Ca(),d=new a.i,f=!1;b.kb();)for(;b.La();){var k=b.ia(),m=b.Jb();k.o(d);h=g.kt(m,d,h);if(-1==h){if(f)throw a.g.wa();c.tm(e,
!1);f=!0;g.reset(e,8);b.Lk();break}}return g};c.ij=function(c,e){var g=new a.i;c.dd(g);for(var h=new a.co(g,8),b=-1,d=new a.i,f=c.Ca(),k=!1;f.kb();)for(;f.La();){var m=f.ia(),A=f.Jb();m.o(d);if(d.jc(e)&&(b=h.kt(A,d,b),-1==b)){if(k)throw a.g.ra("internal error.");c.tm(g,!1);k=!0;h.reset(g,8);f.Lk();break}}return h};c.DT=function(c){var e=new a.i;c.dd(e);for(var g=new a.co(e,8),h=new a.b,b=new a.i,d=!1,f=0;f<c.F();f++)if(c.w(f,h),b.K(h),-1==g.lg(f,b)){if(d)throw a.g.wa();c.tm(e,!1);d=!0;g.reset(e,8);
f=-1}return g};c.oB=function(c,e){for(var g=new a.co(e,8),h=new a.b,b=!1,d=new a.i,f=0;f<c.F();f++)if(c.w(f,h),e.contains(h)&&(d.K(h),-1==g.lg(f,d))){if(b)throw a.g.wa();b=!0;f=new a.i;c.tm(f,!1);g.reset(f,8);f=-1}return g};c.AN=function(c,e,g){var h=new a.i,b=new a.i;c.dd(h);e.dd(b);h.P(g,g);b.P(g,g);var d=new a.i;d.K(h);d.Ga(b);c=c.Ca();e=e.Ca();var f=new a.sz;f.YF(g);var k=!1;for(f.jG();c.kb();)for(;c.La();)c.ia().o(h),h.jc(d)&&(k=!0,g=new a.i,g.K(h),f.OA(c.Jb(),g));f.$B();if(!k)return null;h=
!1;for(f.iG();e.kb();)for(;e.La();)e.ia().o(b),b.jc(d)&&(h=!0,g=new a.i,g.K(b),f.LA(e.Jb(),g));f.ZB();return h?f:null};c.BN=function(c,e,g,b,d){var h=c.D(),n=e.D(),f=new a.i,y=new a.i;c.dd(f);e.dd(y);f.P(g,g);y.P(g,g);var k=new a.i;k.K(f);k.Ga(y);var m=new a.sz;m.YF(g);var A=!1;m.jG();var p=0;for(g=c.ea();p<g;p++)if(!b||1736!=h||c.qt(p))c.Ti(p,f),f.jc(k)&&(A=!0,m.OA(p,f));m.$B();if(!A)return null;c=!1;m.iG();b=0;for(g=e.ea();b<g;b++)if(!d||1736!=n||e.qt(b))e.Ti(b,y),y.jc(k)&&(c=!0,m.LA(b,y));m.ZB();
return c?m:null};c.hU=function(a,e){return 0<a.rj(e)};c.zT=function(c,e){var g=new a.i;c.hR(e,g);var g=new a.co(g,8),h=-1,b=new a.i;c=c.Ca();c.vy(e);if(c.kb())for(;c.La();){e=c.ia();var d=c.Jb();e.dd(b);h=g.kt(d,b,h);if(-1==h)throw a.g.ra("internal error");}return g};return c}();a.Ia=c})(B||(B={}));(function(a){var c=function(){function a(a){this.Na=a}a.prototype.compare=function(a,e,c){a=a.da(c);c=this.Na.uj(e);var h=this.Na.uj(a);return c<h?-1:c==h?g.Po(e)&&g.st(a)?-1:g.Po(a)&&g.st(e)?1:0:1};return a}(),
b=function(){function a(a){this.Na=a}a.prototype.Zp=function(a,e,g){this.Na.yS(g,a,e)};a.prototype.Mo=function(a){return this.Na.uj(a)};return a}(),h;(function(a){a[a.initialize=0]="initialize";a[a.pIn=1]="pIn";a[a.pL=2]="pL";a[a.pR=3]="pR";a[a.pT=4]="pT";a[a.right=5]="right";a[a.left=6]="left";a[a.all=7]="all"})(h||(h={}));var e=function(){function e(){this.Na=null;this.gi=new a.Nd;this.ug=new a.ga(0);this.$f=[0,0]}e.prototype.Ch=function(a,e){this.gi.qa=a.qa-e;this.gi.va=a.va+e;this.ug.resize(0);
this.Ud=0;this.$f[0]=0};e.prototype.uy=function(e,g,c){if(e>g)throw a.g.N();this.gi.qa=e-c;this.gi.va=g+c;this.ug.resize(0);this.Ud=0;this.$f[0]=0};e.prototype.Fn=function(a,e){this.gi.qa=a-e;this.gi.va=a+e;this.ug.resize(0);this.Ud=0;this.$f[0]=0};e.prototype.next=function(){if(!this.Na.Vo)throw a.g.xa();if(0>this.Ud)return-1;for(var e=!0;e;)switch(this.$f[this.Ud]){case 1:e=this.uQ();break;case 2:e=this.vQ();break;case 3:e=this.wQ();break;case 4:e=this.xQ();break;case 5:e=this.BR();break;case 6:e=
this.sP();break;case 7:e=this.XJ();break;case 0:e=this.Qw();break;default:throw a.g.wa();}return-1!=this.pg?this.Bo()>>1:-1};e.JT=function(a,g,c){var h=new e;h.Na=a;h.ug.xb(20);h.Ch(g,c);return h};e.KT=function(a,g,c){var h=new e;h.Na=a;h.ug.xb(20);h.Fn(g,c);return h};e.Oa=function(a){var g=new e;g.Na=a;g.ug.xb(20);g.Ud=-1;return g};e.prototype.Qw=function(){this.pg=this.YD=this.di=this.yc=-1;if(null!=this.Na.Yd&&0<this.Na.Yd.size)return this.$f[0]=1,this.di=this.Na.Ze,!0;this.Ud=-1;return!1};e.prototype.uQ=
function(){this.yc=this.di;if(-1==this.yc)return this.pg=this.Ud=-1,!1;var a=this.Na.Co(this.yc);if(this.gi.va<a)return a=this.Na.tj(this.yc),this.di=this.Na.Di(this.yc),-1!=a&&(this.vh=this.Na.gk(a),this.$f[++this.Ud]=6),!0;if(a<this.gi.qa)return a=this.Na.tj(this.yc),this.di=this.Na.sj(this.yc),-1!=a&&(this.vh=this.Na.uq(a),this.$f[++this.Ud]=5),!0;this.$f[this.Ud]=2;this.YD=this.yc;a=this.Na.tj(this.yc);this.di=this.Na.Di(this.yc);-1!=a&&(this.vh=this.Na.gk(a),this.$f[++this.Ud]=7);return!0};e.prototype.vQ=
function(){this.yc=this.di;if(-1==this.yc)return this.$f[this.Ud]=3,this.di=this.Na.sj(this.YD),!0;if(this.Na.Co(this.yc)<this.gi.qa){var a=this.Na.tj(this.yc);this.di=this.Na.sj(this.yc);-1!=a&&(this.vh=this.Na.uq(a),this.$f[++this.Ud]=5);return!0}a=this.Na.tj(this.yc);this.di=this.Na.Di(this.yc);-1!=a&&(this.vh=this.Na.gk(a),this.$f[++this.Ud]=7);a=this.Na.sj(this.yc);-1!=a&&this.ug.add(a);return!0};e.prototype.wQ=function(){this.yc=this.di;if(-1==this.yc)return this.$f[this.Ud]=4,!0;if(this.gi.va<
this.Na.Co(this.yc)){var a=this.Na.tj(this.yc);this.di=this.Na.Di(this.yc);-1!=a&&(this.vh=this.Na.gk(a),this.$f[++this.Ud]=6);return!0}a=this.Na.tj(this.yc);this.di=this.Na.sj(this.yc);-1!=a&&(this.vh=this.Na.gk(a),this.$f[++this.Ud]=7);a=this.Na.Di(this.yc);-1!=a&&this.ug.add(a);return!0};e.prototype.xQ=function(){if(0==this.ug.size)return this.pg=this.Ud=-1,!1;this.yc=this.ug.get(this.ug.size-1);this.ug.resize(this.ug.size-1);var a=this.Na.tj(this.yc);-1!=a&&(this.vh=this.Na.gk(a),this.$f[++this.Ud]=
7);-1!=this.Na.Di(this.yc)&&this.ug.add(this.Na.Di(this.yc));-1!=this.Na.sj(this.yc)&&this.ug.add(this.Na.sj(this.yc));return!0};e.prototype.sP=function(){this.pg=this.vh;if(-1!=this.pg&&g.Po(this.Bo())&&this.Na.uj(this.Bo())<=this.gi.va)return this.vh=this.GC(),!1;this.Ud--;return!0};e.prototype.BR=function(){this.pg=this.vh;if(-1!=this.pg&&g.st(this.Bo())&&this.Na.uj(this.Bo())>=this.gi.qa)return this.vh=this.bO(),!1;this.Ud--;return!0};e.prototype.XJ=function(){this.pg=this.vh;if(-1!=this.pg&&
g.Po(this.Bo()))return this.vh=this.GC(),!1;this.Ud--;return!0};e.prototype.GC=function(){return this.Na.Df?this.Na.If.bb(this.pg):this.Na.ki.bb(this.pg)};e.prototype.bO=function(){return this.Na.Df?this.Na.If.ge(this.pg):this.Na.ki.ge(this.pg)};e.prototype.Bo=function(){return this.Na.Df?this.Na.If.da(this.pg):this.Na.ki.getData(this.pg)};return e}();a.IT=e;var g=function(){function g(a){this.Al=this.rh=this.If=this.ki=this.Hl=this.Ki=this.Yd=this.Li=null;this.Df=a;this.Vo=this.Dt=!1}g.prototype.Vp=
function(){this.Rj(!0)};g.prototype.gq=function(e,g){if(!this.Dt)throw a.g.xa();this.Li.push(new a.Nd(e,g))};g.prototype.wo=function(){if(!this.Dt)throw a.g.ra("invalid call");this.Dt=!1;this.Vo=!0;this.Df||(this.BO(),this.Jt=this.Li.length)};g.prototype.lg=function(e){if(!this.Df||!this.Vo)throw a.g.N("invalid call");if(-1==this.Ze){var g=this.Li.length;if(this.nx){var c=new a.ga(0);c.xb(2*g);this.$E(c);this.rh.xb(2*g);this.rh.resize(0);this.ZE(c);this.Hl.resize(g,-1);this.Hl.dh(-1,0,g);this.nx=
!1}else this.Hl.dh(-1,0,g);this.Ze=this.Ms()}g=this.cD(e<<1,this.Ze);c=this.If.addElement((e<<1)+1,this.Hw(g));this.TF(g,c);this.Hl.set(e,g);this.Jt++};g.prototype.remove=function(e){if(!this.Df||!this.Vo)throw a.g.ra("invalid call");var g=this.Hl.get(e);if(-1==g)throw a.g.N("the interval does not exist in the interval tree");this.Hl.set(e,-1);this.Jt--;var c=this.Hw(g),h;h=this.If.hO(c);this.If.kd(this.LN(g),c);this.If.kd(this.eO(g),c);e=this.If.size(c);0==e&&(this.If.fM(c),this.WF(h,-1));this.Ki.Jc(g);
for(var c=this.JC(h),b=this.Di(h),n=this.sj(h),g=0;!(0<e||h==this.Ze||-1!=b&&-1!=n);)h==this.Di(c)?-1!=b?(this.Sj(c,b),this.Xi(b,c),this.Sj(h,-1)):-1!=n?(this.Sj(c,n),this.Xi(n,c),this.Uj(h,-1)):this.Sj(c,-1):-1!=b?(this.Uj(c,b),this.Xi(b,c),this.Sj(h,-1)):-1!=n?(this.Uj(c,n),this.Xi(n,c),this.Uj(h,-1)):this.Uj(c,-1),this.Xi(h,-1),g++,h=c,c=this.tj(h),e=-1!=c?this.If.size(c):0,b=this.Di(h),n=this.sj(h),c=this.JC(h)};g.prototype.reset=function(){if(!this.Df||!this.Vo)throw a.g.N("invalid call");this.Rj(!1)};
g.prototype.size=function(){return this.Jt};g.prototype.Re=function(){return e.Oa(this)};g.prototype.$E=function(a){for(var e=this.Li.length,g=0;g<2*e;g++)a.add(g);this.zS(a,2*e)};g.prototype.ZE=function(a){for(var e=NaN,g=0;g<a.size;g++){var c=a.get(g),h=this.uj(c);h!=e&&(this.rh.add(c),e=h)}};g.prototype.BO=function(){var e=this.Li.length,g=new a.ga(0);g.xb(2*e);this.$E(g);this.rh.xb(2*e);this.rh.resize(0);this.ZE(g);this.Ki.de(e);this.ki.$l(2*e);var c=a.Ac.Dg(e);c.dh(-1,0,e);this.Ze=this.Ms();
for(e=0;e<g.size;e++){var h=g.get(e),b=c.get(h>>1);-1!=b?this.TF(b,this.ki.addElement(this.Hw(b),h)):(b=this.cD(h,this.Ze),c.set(h>>1,b))}};g.prototype.cD=function(e,g){var c=g,h=g,b,n=-1,d=0,f=this.rh.size-1,y=0,k=e>>1,m=NaN,A=NaN;b=!0;for(var p=this.RN(k),k=this.ON(k);b;){d<f?(y=d+a.I.truncate((f-d)/2),-1==this.rw(c)&&this.CF(c,this.rh.get(y),this.rh.get(y+1))):-1==this.rw(c)&&this.CF(c,this.rh.get(d),this.rh.get(d));var r=this.Co(c);if(k<r)-1!=g&&(g==c?(h=c,m=r,g=this.Di(c),-1!=g?A=this.Co(g):
A=NaN):A>r&&(r<m?this.Sj(h,c):this.Uj(h,c),this.Uj(c,g),this.Df&&(this.Xi(c,h),this.Xi(g,c)),h=c,m=r,g=-1,A=NaN)),f=this.MN(c),-1==f&&(f=this.Ms(),this.YR(c,f)),c=f,f=y;else if(p>r)-1!=g&&(g==c?(h=c,m=r,g=this.sj(c),-1!=g?A=this.Co(g):A=NaN):A<r&&(r<m?this.Sj(h,c):this.Uj(h,c),this.Sj(c,g),this.Df&&(this.Xi(c,h),this.Xi(g,c)),h=c,m=r,g=-1,A=NaN)),d=this.fO(c),-1==d&&(d=this.Ms(),this.iS(c,d)),c=d,d=y+1;else{b=this.tj(c);-1==b&&(b=this.TL(c),this.WF(c,b));var u=this.KJ(b,e),n=this.SL();this.lS(n,b);
this.XR(n,u);c!=g&&(r<m?this.Sj(h,c):this.Uj(h,c),this.Df&&this.Xi(c,h),-1!=g&&(A<r?this.Sj(c,g):this.Uj(c,g),this.Df&&this.Xi(g,c)));b=!1}}return n};g.prototype.Ms=function(){return this.Yd.be()};g.prototype.TL=function(a){return this.Df?this.If.nq(a):this.ki.jh(a)};g.prototype.SL=function(){return this.Ki.be()};g.prototype.Rj=function(e){e?(this.Dt=this.nx=!0,this.Vo=!1,null==this.rh?this.rh=a.Ac.Dg(0):this.rh.resize(0),null==this.Li?this.Li=[]:this.Li.length=0):this.nx=!1;this.Df?null==this.Hl?
(this.Hl=a.Ac.Dg(0),this.If=new a.bj,this.If.Hn(new c(this))):this.If.clear():null==this.ki?this.ki=new a.$n:this.ki.clear();null==this.Yd?(this.Ki=new a.Fc(3),this.Yd=new a.Fc(this.Df?8:7)):(this.Ki.Nh(!1),this.Yd.Nh(!1));this.Ze=-1;this.Jt=0};g.prototype.CF=function(a,e,g){this.SR(a,e);this.TR(a,g)};g.prototype.Co=function(a){var e=this.rw(a);if(-1==e)return NaN;e=this.uj(e);a=this.uj(this.wN(a));return e==a?e:.5*(e+a)};g.prototype.SR=function(a,e){this.Yd.L(a,0,e)};g.prototype.TR=function(a,e){this.Yd.L(a,
1,e)};g.prototype.YR=function(a,e){this.Yd.L(a,3,e)};g.prototype.iS=function(a,e){this.Yd.L(a,4,e)};g.prototype.WF=function(a,e){this.Yd.L(a,2,e)};g.prototype.Sj=function(a,e){this.Yd.L(a,5,e)};g.prototype.Uj=function(a,e){this.Yd.L(a,6,e)};g.prototype.Xi=function(a,e){this.Yd.L(a,7,e)};g.prototype.lS=function(a,e){this.Ki.L(a,0,e)};g.prototype.KJ=function(a,e){return this.Df?this.If.addElement(e,a):this.ki.addElement(a,e)};g.prototype.XR=function(a,e){this.Ki.L(a,1,e)};g.prototype.TF=function(a,
e){this.Ki.L(a,2,e)};g.prototype.gk=function(a){return this.Df?this.If.gc(a):this.ki.gc(a)};g.prototype.uq=function(a){return this.Df?this.If.tc(a):this.ki.tc(a)};g.Po=function(a){return 0==(a&1)};g.st=function(a){return 1==(a&1)};g.prototype.rw=function(a){return this.Yd.O(a,0)};g.prototype.wN=function(a){return this.Yd.O(a,1)};g.prototype.tj=function(a){return this.Yd.O(a,2)};g.prototype.MN=function(a){return this.Yd.O(a,3)};g.prototype.fO=function(a){return this.Yd.O(a,4)};g.prototype.Di=function(a){return this.Yd.O(a,
5)};g.prototype.sj=function(a){return this.Yd.O(a,6)};g.prototype.JC=function(a){return this.Yd.O(a,7)};g.prototype.Hw=function(a){return this.Ki.O(a,0)};g.prototype.LN=function(a){return this.Ki.O(a,1)};g.prototype.eO=function(a){return this.Ki.O(a,2)};g.prototype.RN=function(a){return this.Li[a].qa};g.prototype.ON=function(a){return this.Li[a].va};g.prototype.zS=function(e,g){null==this.Al&&(this.Al=new a.Rr);var c=new b(this);this.Al.sort(e,0,g,c)};g.prototype.yS=function(a,e,c){var h=this;a.xd(e,
c,function(a,e){var c=h.uj(a),b=h.uj(e);return c<b||c==b&&g.Po(a)&&g.st(e)?-1:1})};g.prototype.uj=function(a){var e=this.Li[a>>1];return g.Po(a)?e.qa:e.va};return g}();a.bq=g})(B||(B={}));(function(a){var c=function(c){function h(e,g,h,b){c.call(this);void 0===e?this.description=a.Od.Tf():void 0===h?this.description=e:(this.description=a.Od.Tf(),this.Ny(e,g),this.Ok(h,b))}D(h,c);h.prototype.D=function(){return 322};h.prototype.$b=function(){var a=this.na-this.la,g=this.ja-this.ha;return Math.sqrt(a*
a+g*g)};h.prototype.mg=function(a){var e=this.na-this.la,c=this.ja-this.ha;return Math.sqrt(e*e+c*c)<=a};h.prototype.mD=function(){return!1};h.prototype.Pf=function(){var e=new a.b;e.pc(this.oc(),this.Mb());return e};h.prototype.Fp=function(e){e.Ja();e.Qf(this.description);var g=new a.i;this.o(g);e.Cu(g);for(var g=1,c=this.description.Aa;g<c;g++)for(var h=this.description.Hd(g),b=a.pa.Wa(h);g<b;g++){var d=this.Ah(h,0);e.setInterval(h,0,d)}};h.prototype.o=function(a){a.K(this.na,this.ja,this.la,this.ha);
a.normalize()};h.prototype.Cn=function(a){a.Ja();a.Db(this.na,this.ja,this.yd(0,1,0));a.Db(this.la,this.ha,this.yd(1,1,0))};h.prototype.Oe=function(e){if(e instanceof a.Bg){this.qc();var g=new a.b;g.x=this.na;g.y=this.ja;e.Zi(g,g);this.na=g.x;this.ja=g.y;g.x=this.la;g.y=this.ha;e.Zi(g,g);this.la=g.x;this.ha=g.y}else this.qc(),g=new a.ee,g.x=this.na,g.y=this.ja,g.z=this.yd(0,1,0),g=e.Qn(g),this.na=g.x,this.ja=g.y,this.om(0,1,0,g.z),g.x=this.la,g.y=this.ha,g.z=this.yd(1,1,0),g=e.Qn(g),this.la=g.x,this.ha=
g.y,this.om(1,1,0,g.z)};h.prototype.Pa=function(){return new h(this.description)};h.prototype.kv=function(a,g){return(this.la-a-(this.na-a))*(this.ha-g+(this.ja-g))*.5};h.prototype.Ru=function(a){return a*this.$b()};h.prototype.AD=function(a){return a/this.$b()};h.prototype.sC=function(e){return a.vi.ut(this.na,this.la,e)};h.prototype.vN=function(e){return a.vi.ut(this.ja,this.ha,e)};h.prototype.xm=function(e,g){var c=new a.Ag;this.Bi(e,g,c);return c.get()};h.prototype.Bi=function(e,g,c){if(null==
c)throw a.g.N();c.mq();c=c.get();c.Qf(this.description);var h=new a.b;this.Kb(e,h);c.Ny(h.x,h.y);this.Kb(g,h);c.Ok(h.x,h.y);for(var h=1,b=this.description.Aa;h<b;h++)for(var n=this.description.Fd(h),d=a.pa.Wa(n),f=0;f<d;f++){var k=this.ld(e,n,f);c.My(n,f,k);k=this.ld(g,n,f);c.Cy(n,f,k)}};h.prototype.ld=function(e,g,c){if(0==g)return 0==c?this.Kb(e).x:this.Kb(e).y;switch(a.pa.JN(g)){case 0:return.5>e?this.gt(g,c):this.Ws(g,c);case 1:var h=this.gt(g,c);g=this.Ws(g,c);return a.vi.ut(h,g,e);case 2:throw a.g.ra("not implemented");
}throw a.g.wa();};h.prototype.Gd=function(a,g){var e=this.la-this.na,c=this.ha-this.ja,h=e*e+c*c;if(0==h)return.5;e=((a.x-this.na)*e+(a.y-this.ja)*c)/h;g||(0>e?e=0:1<e&&(e=1));return e};h.prototype.nt=function(a,g,c,h){if(a){a=this.ha-this.ja;if(0==a)return g==this.ha?-1:0;g=(g-this.ja)/a;if(0>g||1<g)return 0;null!=c&&(c[0]=this.sC(g))}else{a=this.la-this.na;if(0==a)return g==this.la?-1:0;g=(g-this.na)/a;if(0>g||1<g)return 0;null!=c&&(c[0]=this.vN(g))}null!=h&&(h[0]=g);return 1};h.prototype.xe=function(a,
g){var e=this.ha-this.ja;if(0==e)return a==this.ha?g:NaN;e=(a-this.ja)/e;a=this.sC(e);1==e&&(a=this.la);return a};h.prototype.qs=function(a,g,c){return 0<=this.ho(a.x,a.y,g,c)};h.prototype.Kh=function(a,g,c){return 0<=this.ho(a,g,c,!0)};h.prototype.Eq=function(a,g){return this.qs(a,g,!1)};h.prototype.KE=function(){if(this.ha<this.ja||this.ha==this.ja&&this.la<this.na){var a=this.na;this.na=this.la;this.la=a;a=this.ja;this.ja=this.ha;this.ha=a;for(var a=0,g=this.description.up-2;a<g;a++){var c=this.fa[a];
this.fa[a]=this.fa[a+g];this.fa[a+g]=c}}};h.prototype.rs=function(e,g){e=a.b.Oa(e,g);e.sub(this.Mb());g=new a.b;g.pc(this.oc(),this.Mb());var c=g.Ai(e);e=8.881784197001252E-16*(Math.abs(g.x*e.y)+Math.abs(g.y*e.x));return c>e?-1:c<-e?1:0};h.prototype.ho=function(e,g,c,h){var b=this.na,n=this.ja,d=e-b,f=g-n,d=Math.sqrt(d*d+f*f);if(d<=Math.max(c,6.661338147750939E-16*d))return h&&0==d?NaN:0;d=e-this.la;f=g-this.ha;d=Math.sqrt(d*d+f*f);if(d<=Math.max(c,6.661338147750939E-16*d))return h&&0==d?NaN:1;d=
this.la-this.na;f=this.ha-this.ja;h=Math.sqrt(d*d+f*f);if(0<h){var k=1/h,d=d*k,f=f*k,y=e-b,m=g-n,A=y*d+m*f,p=1.7763568394002505E-15*(Math.abs(y*d)+Math.abs(m*f)),r=d,d=-f,f=r,p=Math.max(c,p);if(A<-p||A>h+p)return NaN;if(Math.abs(y*d+m*f)<=Math.max(c,1.7763568394002505E-15*(Math.abs(y*d)+Math.abs(m*f)))&&(d=a.I.Kr(A*k,0,1),.5>=d?(f=this.na+(this.la-this.na)*d,h=this.ja+(this.ha-this.ja)*d):(f=this.la-(this.la-this.na)*(1-d),h=this.ha-(this.ha-this.ja)*(1-d)),a.b.Yv(f,h,e,g)<=c)){if(.5>d){if(a.b.Yv(f,
h,b,n)<=c)return 0}else if(a.b.Yv(f,h,this.la,this.ha)<=c)return 1;return d}}return NaN};h.prototype.lc=function(a){return null==a?!1:a==this?!0:a.constructor!==this.constructor?!1:this.sJ(a)};h.prototype.AA=function(e,g,c){var h=c?this.na:this.la;c=c?this.ja:this.ha;var b=new a.b;b.x=e.la-h;b.y=e.ha-c;return g.ml(b)>6.661338147750939E-16*g.uA(b)?(b.x=e.na-h,b.y=e.ja-c,g.ml(b)<=6.661338147750939E-16*g.uA(b)):!0};h.prototype.zA=function(e){var g=new a.b;g.x=this.la-this.na;g.y=this.ha-this.ja;if(!this.AA(e,
g,!1))return!1;g.Bp();return this.AA(e,g,!0)?!0:!1};h.ye=function(a,g){var e=a.rs(g.na,g.ja),c=a.rs(g.la,g.ha);if(0>e&&0>c||0<e&&0<c)return!1;e=g.rs(a.na,a.ja);c=g.rs(a.la,a.ha);if(0>e&&0>c||0<e&&0<c)return!1;e=a.$b();c=g.$b();return e>c?a.zA(g):g.zA(a)};h.Id=function(e,g,c){var h=a.b.Oa(NaN,NaN),b=e.la-e.na,n=e.ha-e.ja,d=g.la-g.na,f=g.ha-g.ja,k=d*n-b*f;if(0==k)return h;var m=8.881784197001252E-16*(Math.abs(d*n)+Math.abs(b*f)),A=g.na-e.na,p=g.ja-e.ja,r=d*p-A*f,u=r/k,v=Math.abs(k),d=(8.881784197001252E-16*
(Math.abs(d*p)+Math.abs(A*f))*v+m*Math.abs(r))/(k*k)+2.220446049250313E-16*Math.abs(u);if(u<-d||u>1+d)return h;f=b*p-A*n;d=f/k;b=(8.881784197001252E-16*(Math.abs(b*p)+Math.abs(A*n))*v+m*Math.abs(f))/(k*k)+2.220446049250313E-16*Math.abs(d);if(d<-b||d>1+b)return h;u=a.I.Kr(u,0,1);b=a.I.Kr(d,0,1);n=e.Kb(u);k=g.Kb(b);m=new a.b;m.pc(n,k);if(m.length()>c&&(m.add(n,k),m.scale(.5),u=e.Gd(m,!1),b=g.Gd(m,!1),e=e.Kb(u),g=g.Kb(b),e.sub(g),e.length()>c))return h;h.ma(u,b);return h};h.xJ=function(a,g,c,b){var e=
0;if(a.na==g.na&&a.ja==g.ja||a.na==g.la&&a.ja==g.ha)if(e++,!b)return 1;if(a.la==g.na&&a.ha==g.ja||a.la==g.la&&a.ha==g.ha){e++;if(2==e)return 2;if(!b)return 1}return g.Kh(a.na,a.ja,c)||g.Kh(a.la,a.ha,c)||a.Kh(g.na,g.ja,c)||a.Kh(g.la,g.ha,c)?1:b&&0!=e?0:0==h.ye(a,g)?0:1};h.ov=function(e,g,c,b,d,f){var n=0,k=e.ho(g.na,g.ja,f,!1),y=e.ho(g.la,g.ha,f,!1),m=g.ho(e.na,e.ja,f,!1),A=g.ho(e.la,e.ha,f,!1);isNaN(k)||(null!=b&&(b[n]=k),null!=d&&(d[n]=0),null!=c&&(c[n]=a.b.Oa(g.na,g.ja)),n++);isNaN(y)||(null!=b&&
(b[n]=y),null!=d&&(d[n]=1),null!=c&&(c[n]=a.b.Oa(g.la,g.ha)),n++);2==n||isNaN(m)||0==k&&0==m||0==y&&1==m||(null!=b&&(b[n]=0),null!=d&&(d[n]=m),null!=c&&(c[n]=a.b.Oa(e.na,e.ja)),n++);2==n||isNaN(A)||1==k&&0==A||1==y&&1==A||(null!=b&&(b[n]=1),null!=d&&(d[n]=A),null!=c&&(c[n]=a.b.Oa(g.la,g.ha)),n++);if(0<n)return 2==n&&null!=b&&b[0]>b[1]&&(e=b[0],b[0]=b[1],b[1]=e,null!=d&&(b=d[0],d[0]=d[1],d[1]=b),null!=c&&(d=a.b.Oa(c[0].x,c[0].y),c[0]=c[1],c[1]=d)),n;n=h.Id(e,g,f);if(isNaN(n.x))return 0;null!=c&&(c[0]=
e.Kb(n.x));null!=b&&(b[0]=n.x);null!=d&&(d[0]=n.y);return 1};h.prototype.TC=function(){return 0};h.prototype.eo=function(){};h.prototype.toString=function(){return"Line: ["+this.na.toString()+", "+this.ja.toString()+", "+this.la.toString()+", "+this.ha.toString()+"]"};return h}(a.fA);a.yb=c})(B||(B={}));(function(a){var c=function(){function a(){this.Gl=[];this.ua=-1}a.prototype.ya=function(){return this.ua};a.prototype.next=function(){if(null!=this.Gl&&0!=this.Gl.length){this.ua++;var a=this.Gl[0];
1>=this.Gl.length?this.Gl=[]:this.Gl=this.Gl.slice(1);return a}return this.Gl=null};return a}();a.MT=c})(B||(B={}));(function(a){(function(a){a[a.enumFillRuleOddEven=0]="enumFillRuleOddEven";a[a.enumFillRuleWinding=1]="enumFillRuleWinding"})(a.qI||(a.qI={}));var c=function(c){function h(e,g){c.call(this);this.Yf=!1;this.np=null;this.ap=this.bp=0;this.Uh=null;this.ng=!1;this.td=this.li=this.Fe=this.qb=this.jb=null;this.gp=this.Qa=this.cp=0;if(void 0===g)this.Yf=e,this.ng=!1,this.ta=this.ap=this.bp=
this.cp=0,this.description=a.Od.Tf();else{if(null==g)throw a.g.N();this.Yf=e;this.ng=!1;this.ta=this.ap=this.bp=this.cp=0;this.description=g}this.Uh=null;this.Qa=0}D(h,c);h.prototype.Hm=function(){return 0<this.cp};h.prototype.nv=function(){this.qc();null==this.np?this.np=new a.Va(this.description):this.np.Qf(this.description)};h.prototype.Uy=function(e,g){var c=new a.b;c.x=e;c.y=g;this.Nr(c)};h.prototype.Nr=function(a){this.nv();this.np.ic(a);this.ng=!0};h.prototype.df=function(e){if(e.s())throw a.g.N();
this.Ik(e.description);this.nv();e.copyTo(this.np);this.ng=!0};h.prototype.iv=function(){var e=1;this.ng&&(this.nv(),null==this.jb?(this.jb=a.Ac.Dg(2),this.jb.write(0,0),this.qb=a.Ac.to(2,0)):(this.jb.resize(this.jb.size+1,0),this.qb.resize(this.qb.size+1,0)),this.Yf&&this.qb.write(this.qb.size-2,1),e++);var g=this.ta;this.jb.write(this.jb.size-1,this.ta+e);this.jo(g+e);this.qb.write(this.jb.size-1,0);this.ng&&(this.Iu(g,this.np),this.ng=!1)};h.prototype.wj=function(a,g){this.iv();this.ic(this.ta-
1,a,g)};h.prototype.Lm=function(a){this.iv();this.ic(this.ta-1,a)};h.prototype.lineTo=function(a){this.iv();this.Iu(this.ta-1,a)};h.prototype.ro=function(){var a;this.Su();void 0===a&&(this.ng=!1,a=this.ea()-1);var g=this.qb.read(a);this.qb.write(a,g|1);null!=this.Fe&&(a=this.Dc(a)-1,this.Fe.write(a,1),this.li.write(a,-1))};h.$i=function(a){return h.Id[a]};h.prototype.vc=function(a){return 0!=(this.qb.read(a)&1)};h.prototype.Oo=function(a){if(this.vc(a))return!0;var e=this.Ea(a);a=this.Dc(a)-1;if(e>
a)return!1;e=this.Fa(e);a=this.Fa(a);return e.ub(a)};h.prototype.yq=function(a){return 0!=(this.qb.read(a)&2)};h.prototype.Bc=function(e,g){this.Ik(e.description);if(322==e.D()){var c=new a.Va;if(g||this.s())e.En(c),this.df(c);e.Bn(c);this.lineTo(c)}else throw a.g.wa();};h.prototype.ws=function(a){var e=0==this.ta;this.Uy(a.v,a.C);this.wj(a.v,a.G);this.wj(a.B,a.G);this.wj(a.B,a.C);this.ro();this.ng=!1;e&&this.yf(256,!1)};h.prototype.Wc=function(e,g){if(!e.s()){for(var c=0==this.ta,h=new a.Va(this.description),
b=0;4>b;b++)e.uf(g?4-b-1:b,h),0==b?this.df(h):this.lineTo(h);this.ro();this.ng=!1;c&&!g&&this.yf(256,!1)}};h.prototype.add=function(a,g){for(var e=0;e<a.ea();e++)this.Zj(a,e,!g)};h.prototype.Zj=function(a,g,c){this.Cf(-1,a,g,c)};h.prototype.lo=function(){this.Sw()};h.prototype.ys=function(e,g,c,h,b){b||0!=this.ea()||(b=!0);0>g&&(g=e.ea()-1);if(g>=e.ea()||0>c||0>h||h>e.ct(g))throw a.g.ra("index out of bounds");if(0!=h){var n=e.vc(g)&&c+h==e.ct(g);if(!n||1!=h){this.ng=!1;this.Ik(e.description);c=e.Ea(g)+
c+1;b&&(h++,c--);n&&h--;n=this.ta;this.jo(this.ta+h);this.kc();if(b){if(0==h)return;this.jb.add(this.ta);b=e.qb.read(g);b&=-5;this.Yf&&(b|=1);this.qb.write(this.qb.size-1,b);this.qb.add(0)}else this.jb.write(this.qb.size-1,this.ta);b=0;for(var d=this.description.Aa;b<d;b++){var f=this.description.Hd(b),k=a.pa.Wa(f),y=e.description.zf(f);0>y||null==e.Ba[y]?this.Ba[b].ul(k*n,a.pa.ue(f),h*k,k*n):this.Ba[b].nk(k*n,e.Ba[y],k*c,h*k,!0,k,k*n)}if(this.Hm())throw a.g.wa();if(e.yq(g))throw a.g.wa();this.ce(1993)}}};
h.prototype.Cr=function(e){this.kc();var g=this.ea();0>e&&(e=g-1);if(e>=g)throw a.g.N();for(var c=this.Ea(e),h=this.Ha(e),b=0,d=this.description.Aa;b<d;b++)if(null!=this.Ba[b]){var f=a.pa.Wa(this.description.Fd(b));this.Ba[b].oj(f*c,f*h,f*this.ta)}for(c=e+1;c<=g;c++)b=this.jb.read(c),this.jb.write(c-1,b-h);if(null==this.qb)for(c=e+1;c<=g;c++)e=this.qb.read(c),this.qb.write(c-1,e);this.jb.resize(g);this.qb.resize(g);this.ta-=h;this.rg-=h;this.ce(1993)};h.prototype.Cf=function(e,g,c,h){if(g==this)throw a.g.N();
if(c>=g.ea())throw a.g.N();var b=this.ea();if(e>b)throw a.g.N();0>e&&(e=b);0>c&&(c=g.ea()-1);this.ng=!1;this.Ik(g.description);g.kc();var n=g.Ea(c),d=g.Ha(c),f=this.ta,k=g.vc(c)&&!h?1:0;this.jo(this.ta+d);this.kc();for(var y=e<b?this.Ea(e):f,m=0,p=this.description.Aa;m<p;m++){var A=this.description.Fd(m),r=g.description.zf(A),u=a.pa.Wa(A);0<=r&&null!=g.Ba[r]?(0!=k&&this.Ba[m].nk(y*u,g.Ba[r],u*n,u,!0,u,u*f),this.Ba[m].nk((y+k)*u,g.Ba[r],u*(n+k),u*(d-k),h,u,u*(f+k))):this.Ba[m].ul(y*u,a.pa.ue(A),u*
d,u*f)}this.jb.add(f+d);for(h=b;h>=e+1;h--)n=this.jb.read(h-1),this.jb.write(h,n+d);g.yq(c);this.qb.add(0);for(h=b-1;h>=e+1;h--)b=this.qb.read(h),b&=-5,this.qb.write(h+1,b);b=g.VN().read(c);b&=-5;this.Yf&&(b|=1);this.qb.write(e,b)};h.prototype.Sw=function(){var e=-1,g=this.ea();if(e>g)throw a.g.N();0>e&&(e=g);this.ng=!1;this.kc();this.jb.add(this.ta);for(var c=g;c>=e+1;c--){var h=this.jb.read(c-1);this.jb.write(c,h+0)}this.qb.add(0);for(c=g-1;c>=e+1;c--)g=this.qb.read(c),g&=-5,this.qb.write(c+1,g);
this.Yf&&this.qb.write(e,1)};h.prototype.dD=function(e,g,c){var h=-1;0>e&&(e=this.ea());if(e>this.ea()||h>this.Ha(e)||c>g.length)throw a.g.ra("index out of bounds");if(0!=c){e==this.ea()&&(this.jb.add(this.ta),this.Yf?this.qb.add(1):this.qb.add(0));0>h&&(h=this.Ha(e));this.kc();var b=this.ta;this.jo(this.ta+c);this.kc();for(var n=0,d=this.description.Aa;n<d;n++){var f=this.description.Fd(n),k=a.pa.Wa(f);this.Ba[n].km(k*(this.Ea(e)+h+c),(b-this.Ea(e)-h)*k,this.Ba[n],k*(this.Ea(e)+h),!0,k);0==n?this.Ba[n].$p(k*
(this.Ea(e)+h),c,g,0,!0):this.Ba[n].dh(a.pa.ue(f),(this.Ea(e)+h)*k,c*k)}this.Hm()&&(this.Fe.km(this.Ea(e)+h+c,b-this.Ea(e)-h,this.Fe,this.Ea(e)+h,!0,1),this.li.km(this.Ea(e)+h+c,b-this.Ea(e)-h,this.li,this.Ea(e)+h,!0,1),this.Fe.dh(1,this.Ea(e)+h,c),this.li.dh(-1,this.Ea(e)+h,c));e+=1;for(g=this.ea();e<=g;e++)this.jb.write(e,this.jb.read(e)+c)}};h.prototype.kf=function(e,g,c){var h=this.ea();0>e&&(e=this.ea());if(e>=h||g>this.Ha(e))throw a.g.ra("index out of bounds");e==this.ea()&&(this.jb.add(this.ta),
this.Yf?this.qb.add(1):this.qb.add(0));0>g&&(g=this.Ha(e));var b=this.ta;this.jo(this.ta+1);this.kc();var n=this.Ea(e);this.Ba[0].lg(2*(n+g),c,2*b);c=1;for(var d=this.description.Aa;c<d;c++){var f=this.description.Fd(c),k=a.pa.Wa(f);this.Ba[c].ul(k*(n+g),a.pa.ue(f),k,k*b)}for(e+=1;e<=h;e++)this.jb.write(e,this.jb.read(e)+1)};h.prototype.eF=function(e,g){var c=this.ea();0>e&&(e=c-1);if(e>=c||g>=this.Ha(e))throw a.g.ra("index out of bounds");this.kc();var h=this.Ea(e);0>g&&(g=this.Ha(e)-1);h+=g;g=0;
for(var b=this.description.Aa;g<b;g++)if(null!=this.Ba[g]){var d=a.pa.Wa(this.description.Fd(g));this.Ba[g].oj(d*h,d,d*this.ta)}for(;c>=e+1;c--)h=this.jb.read(c),this.jb.write(c,h-1);this.ta--;this.rg--;this.ce(1993)};h.prototype.Rf=function(){return a.Hh.il(this,null)};h.prototype.Ja=function(){this.cp=0;this.ng=!1;this.td=this.Fe=this.li=this.qb=this.jb=null;this.EA()};h.prototype.Oe=function(e){e instanceof a.Bg?this.ZA(e,-1):this.$J(e)};h.prototype.ZA=function(e,g){if(!this.s()&&!e.XO()){this.kc();
var c=this.Ba[0],h=new a.b,b=new a.b,d,f,k;for(0>g?(d=this.Hm(),f=0,k=this.ta):(d=this.yq(g),f=this.Ea(g),k=this.Dc(g));f<k;f++){h.x=c.read(2*f);h.y=c.read(2*f+1);if(d&&(g=this.li.read(f),0<=g))switch(this.Fe.read(f)&7){case 2:b.x=this.td.read(g);b.y=this.td.read(g+1);e.Zi(b,b);this.td.write(g,b.x);this.td.write(g+1,b.y);b.x=this.td.read(g+3);b.y=this.td.read(g+4);e.Zi(b,b);this.td.write(g+3,b.x);this.td.write(g+4,b.y);break;case 4:throw a.g.wa();}e.Zi(h,h);c.write(2*f,h.x);c.write(2*f+1,h.y)}this.ce(1993)}};
h.prototype.$J=function(e){if(!this.s()){this.Ne(1);this.kc();for(var g=this.Ba[0],c=this.Ba[1],h=new a.ee,b=new a.ee,d=this.Hm(),f=0;f<this.ta;f++){h.x=g.read(2*f);h.y=g.read(2*f+1);h.z=c.read(f);if(d){var k=this.li.read(f);if(0<=k)switch(this.Fe.read(f)&7){case 2:b.x=this.td.read(k);b.y=this.td.read(k+1);b.z=this.td.read(k+2);b=e.Qn(b);this.td.write(k,b.x);this.td.write(k+1,b.y);this.td.write(k+1,b.z);b.x=this.td.read(k+3);b.y=this.td.read(k+4);b.z=this.td.read(k+5);b=e.Qn(b);this.td.write(k+3,
b.x);this.td.write(k+4,b.y);this.td.write(k+5,b.z);break;case 4:throw a.g.wa();}}h=e.Qn(h);g.write(2*f,h.x);g.write(2*f+1,h.y);c.write(f,h.z)}this.ce(1993)}};h.prototype.xv=function(){null==this.jb&&(this.jb=a.Ac.Dg(1,0),this.qb=a.Ac.to(1,0));null!=this.Fe&&(this.Fe.resize(this.rg,1),this.li.resize(this.rg,-1))};h.prototype.eo=function(e){e.ng=!1;e.cp=this.cp;e.gp=this.gp;null!=this.jb?e.jb=a.ga.lj(this.jb):e.jb=null;null!=this.qb?e.qb=a.Wk.lj(this.qb):e.qb=null;null!=this.li?e.li=a.ga.lj(this.li):
e.li=null;null!=this.Fe?e.Fe=a.Wk.lj(this.Fe):e.Fe=null;null!=this.td?e.td=a.qd.lj(this.td):e.td=null;e.bp=this.bp;e.ap=this.ap;this.gj(1024)?e.Uh=null:e.Uh=this.Uh};h.prototype.$b=function(){if(!this.gj(512))return this.bp;for(var e=this.Ca(),g=new a.av(0);e.kb();)for(;e.La();)g.add(e.ia().$b());this.bp=g.rl();this.yf(512,!1);return g.rl()};h.prototype.lc=function(a){if(a==this)return!0;if(!(a instanceof h&&c.prototype.lc.call(this,a)))return!1;var e=this.ea();return e!=a.ea()||null!=this.jb&&!this.jb.lc(a.jb,
0,e+1)||this.gp!=a.gp||null!=this.qb&&!this.qb.lc(a.qb,0,e)?!1:c.prototype.lc.call(this,a)};h.prototype.Ca=function(){return new a.GI(this)};h.prototype.wv=function(a){c.prototype.wv.call(this,a);if(this.Hm())for(a=this.Ca();a.kb();)for(;a.La();)break};h.prototype.tm=function(a,g){c.prototype.tm.call(this,a,g);if(this.Hm())for(a=this.Ca();a.kb();)for(;a.La();)break};h.prototype.qv=function(){null==this.jb||0==this.jb.size?this.ta=0:this.ta=this.jb.read(this.jb.size-1)};h.prototype.Mh=function(){if(!this.Yf)return 0;
this.ts();return this.ap};h.prototype.qt=function(a){if(!this.Yf)return!1;if(!this.gj(8))return 0!=(this.qb.read(a)&4);this.ts();return 0<this.Uh.read(a)};h.prototype.oo=function(a){if(!this.Yf)return 0;this.ts();return this.Uh.read(a)};h.prototype.ts=function(){if(this.gj(1024)){var e=this.ea();null==this.Uh?this.Uh=new a.qd(e):this.Uh.size!=e&&this.Uh.resize(e);for(var e=new a.av(0),g=new a.av(0),c=new a.b,h=0,b=this.Ca();b.kb();){g.reset();for(this.w(this.Ea(b.Qa),c);b.La();)g.add(b.ia().kv(c.x,
c.y));e.add(g.rl());var d=h++;this.Uh.write(d,g.rl())}this.ap=e.rl();this.yf(1024,!1)}};h.prototype.hl=function(){if(this.gj(8)){this.ts();var e=this.ea();if(null==this.qb||this.qb.size<e)this.qb=a.Ac.to(e+1);for(var g=1,c=0;c<e;c++){var h=this.Uh.read(c);0==c&&(g=0<h?1:-1);0<h*g?this.qb.xy(c,4):this.qb.BB(c,4)}this.yf(8,!1)}};h.prototype.Ew=function(e){var g=this.Qa,c=this.ea();if(0<=g&&g<c){if(e<this.Dc(g)){if(e>=this.Ea(g))return g;g--}else g++;if(0<=g&&g<c&&e>=this.Ea(g)&&e<this.Dc(g))return this.Qa=
g}if(5>c){for(g=0;g<c;g++)if(e<this.Dc(g))return this.Qa=g;throw a.g.ra("corrupted geometry");}g=0;for(--c;c>g;){var h=g+(c-g>>1),b=this.Ea(h);if(e<b)c=h-1;else if(g=this.Dc(h),e>=g)g=h+1;else return this.Qa=h}return this.Qa=g};h.prototype.HN=function(e){var g=this.mc(0);this.WN();var c=this.Dc(e),h=this.Ea(e);e=-1;var b=new a.b,d=new a.b;b.y=-Infinity;b.x=-Infinity;for(h+=0;h<c;h++)g.ec(2*h,d),-1==b.compare(d)&&(e=h,b.J(d));return e};h.prototype.Iw=function(){var a=this.F();if(!this.Yf)for(var a=
a-this.ea(),g=0,c=this.ea();g<c;g++)this.vc(g)&&a++;return a};h.prototype.ct=function(a){var e=this.Ha(a);this.vc(a)||e--;return e};h.prototype.Pa=function(){return new h(this.Yf,this.description)};h.prototype.fb=function(){return this.Yf?2:1};h.prototype.D=function(){return this.Yf?1736:1607};h.prototype.WN=function(){this.Su()};h.prototype.OF=function(a){this.jb=a;this.ce(16777215)};h.prototype.VN=function(){this.Su();return this.qb};h.prototype.NF=function(a){this.qb=a;this.ce(16777215)};h.prototype.ea=
function(){return null!=this.jb?this.jb.size-1:0};h.prototype.Dc=function(a){return this.jb.read(a+1)};h.prototype.Ha=function(a){return this.jb.read(a+1)-this.jb.read(a)};h.prototype.Ea=function(a){return this.jb.read(a)};h.prototype.jv=function(e,g){null==this.pb&&(this.pb=new a.Wj);g=a.dA.jR(g);var c=this.pb.hi;if(null!=c)if(c.Sx<e||g>c.cO())this.pb.uv(null);else return!0;c=a.dA.create(this,e,g);this.pb.uv(c);return!0};h.prototype.hc=function(){var a=c.prototype.hc.call(this);if(!this.sc()){var g=
this.ea();null!=this.jb&&this.jb.jj(a,0,g+1);null!=this.qb&&this.qb.jj(a,0,g)}return a};h.prototype.NC=function(a){return null!=this.Fe?this.Fe.read(a):1};h.prototype.cc=function(e,g,c){var h=this.Ew(e);if(e==this.Dc(h)-1&&!this.vc(h))throw a.g.ra("index out of bounds");this.kc();var b=this.Fe,n=1;null!=b&&(n=b.read(e)&7);switch(n){case 1:g.mq();break;case 2:throw a.g.wa();case 4:throw a.g.wa();default:throw a.g.wa();}g=g.get();c?g.Qf(a.Od.Tf()):g.Qf(this.description);h=e==this.Dc(h)-1&&this.vc(h)?
this.Ea(h):e+1;b=new a.b;this.w(e,b);g.ed(b);this.w(h,b);g.vd(b);if(!c)for(c=1,b=this.description.Aa;c<b;c++)for(var n=this.description.Fd(c),d=a.pa.Wa(n),f=0;f<d;f++){var k=this.ld(n,e,f);g.My(n,f,k);k=this.ld(n,h,f);g.Cy(n,f,k)}};h.prototype.Ti=function(e,g){if(e>=this.ea())throw a.g.N();if(this.s())g.Ja();else{if(this.yq(e))throw a.g.ra("not implemented");var c=this.mc(0),h=new a.b,b=new a.i;b.Ja();var d=this.Ea(e);for(e=this.Dc(e);d<e;d++)c.ec(2*d,h),b.Db(h);g.K(b)}};h.prototype.hR=function(e,
g){if(e>=this.ea())throw a.g.N();if(this.s())g.Ja();else{if(this.yq(e))throw a.g.ra("not implemented");var c=this.mc(0),h=new a.b,b=new a.i;b.Ja();var d=this.Ea(e);for(e=this.Dc(e);d<e;d++)c.ec(2*d,h),b.Db(h);g.K(b)}};h.prototype.dj=function(e){null==this.pb&&(this.pb=new a.Wj);if(0==e||16>this.F())return!1;e=a.Ia.nB(this);this.pb.GA(e);return!0};h.prototype.jJ=function(){null==this.pb&&(this.pb=new a.Wj);if(null!=this.pb.nn)return!0;this.pb.HA(null);var e=a.Ia.CK(this);this.pb.HA(e);return!0};h.prototype.Pp=
function(a){this.gp=a};h.prototype.Cm=function(){return this.gp};h.Id=[0,0,6,0,8,0];return h}(a.Wr);a.al=c})(B||(B={}));(function(a){var c=function(c){function h(e){c.call(this);if(void 0!==e){if(null==e)throw a.g.N();this.description=e}else this.description=a.Od.Tf();this.ta=0}D(h,c);h.prototype.Pa=function(){return new h(this.description)};h.prototype.add=function(a){this.resize(this.ta+1);this.bh(this.ta-1,a)};h.prototype.zs=function(e,g){this.resize(this.ta+1);var c=new a.b;c.ma(e,g);this.ic(this.ta-
1,c)};h.prototype.Pd=function(e,g,c){c=0>c?e.F():c;if(0>g||g>e.F()||c<g)throw a.g.N();if(g!=c){this.Ik(e.description);c-=g;var h=this.ta;this.resize(this.ta+c);this.kc();for(var b=0,n=e.description.Aa;b<n;b++){var d=e.description.Fd(b),f=a.pa.Wa(d),k=this.mc(d),d=e.mc(d);k.nk(h*f,d,g*f,c*f,!0,1,h*f)}}};h.prototype.eF=function(e){if(0>e||e>=this.F())throw a.g.ra("index out of bounds");this.kc();for(var g=0,c=this.description.Aa;g<c;g++)if(null!=this.Ba[g]){var h=a.pa.Wa(this.description.Fd(g));this.Ba[g].oj(h*
e,h,h*this.ta)}this.ta--;this.rg--;this.ce(1993)};h.prototype.resize=function(a){this.jo(a)};h.prototype.eo=function(){};h.prototype.Ja=function(){c.prototype.EA.call(this)};h.prototype.Oe=function(e){if(e instanceof a.Bg){if(!this.s()){this.kc();for(var g=this.Ba[0],c=new a.b,h=0;h<this.ta;h++)c.x=g.read(2*h),c.y=g.read(2*h+1),e.Zi(c,c),g.write(2*h,c.x),g.write(2*h+1,c.y);this.ce(1993)}}else if(!this.s()){this.kc();this.Ne(1);this.kc();for(var g=this.Ba[0],c=this.Ba[1],b=new a.ee,h=0;h<this.ta;h++){b.x=
g.read(2*h);b.y=g.read(2*h+1);b.z=c.read(h);var d=e.Qn(b);g.write(2*h,d.x);g.write(2*h+1,d.y);c.write(h,d.z)}this.ce(1993)}};h.prototype.fb=function(){return 0};h.prototype.D=function(){return 550};h.prototype.Mh=function(){return 0};h.prototype.$b=function(){return 0};h.prototype.lc=function(a){return a==this?!0:a instanceof h?c.prototype.lc.call(this,a):!1};h.prototype.fR=function(e,g){var c=this.ta,c=Math.min(c,g+1E3);if(0>g||g>=this.ta||c<g||1E3!=e.length)throw a.g.N();var h=this.mc(0),b=c-g,
d=[];h.Hp(2*g,2*b,d,0,!0);for(h=0;h<b;h++)e[h]=a.b.Oa(d[2*h],d[2*h+1]);return c};h.prototype.qv=function(){};h.prototype.xv=function(){};h.prototype.jv=function(){return!1};h.prototype.dj=function(){return!1};h.prototype.Rf=function(){return null};return h}(a.Wr);a.pe=c})(B||(B={}));(function(a){(function(a){a[a.NotDetermined=0]="NotDetermined";a[a.Structure=1]="Structure";a[a.DegenerateSegments=2]="DegenerateSegments";a[a.Clustering=3]="Clustering";a[a.Cracking=4]="Cracking";a[a.CrossOver=5]="CrossOver";
a[a.RingOrientation=6]="RingOrientation";a[a.RingOrder=7]="RingOrder";a[a.OGCPolylineSelfTangency=8]="OGCPolylineSelfTangency";a[a.OGCPolygonSelfTangency=9]="OGCPolygonSelfTangency";a[a.OGCDisconnectedInterior=10]="OGCDisconnectedInterior"})(a.NH||(a.NH={}));var c=function(){function a(a,e,g){void 0===a?(this.yh=0,this.Gk=this.Fk=-1):(this.yh=a,this.Fk=e,this.Gk=g)}a.prototype.aq=function(a){this.yh=a.yh;this.Fk=a.Fk;this.Gk=a.Gk};return a}();a.wd=c})(B||(B={}));(function(a){var c=function(){function c(){}
c.WT=function(c){if(!1===c)throw a.g.PG();};c.bG=function(a){return isNaN(a)?NaN:0===a?a:0<a?1:-1};c.Lh=function(a,e){void 0===e&&(e=0);for(var g=[],c=0;c<a;c++)g[c]=e;return g};c.Ps=function(a,e){var g,c;void 0===g&&(g=0);for(void 0===c&&(c=a.length-1);g<=c;g++)a[g]=e};c.Kr=function(a,e,g){return a<e?e:a>g?g:a};c.mU=function(){return 4};c.kg=function(a,e){var g=5381;void 0!==e?g=(e<<5)+e+(a&255):g=(g<<5)+g+(a&255);g=(g<<5)+g+(a>>8&255);g=(g<<5)+g+(a>>16&255);return(g<<5)+g+(a>>24&255)&2147483647};
c.Rh=function(){throw Error("Not Implemented");};c.iU=function(){return-Infinity};c.kU=function(){return Infinity};c.bU=function(){return 2147483647};c.QT=function(){return 2.220446049250313E-16};c.ST=function(){return 1.7976931348623157E308};c.$x=function(a){return c.JH(a)+12345&2147483647};c.FD=function(a){var e=32,g=a%c.gv|0,h=a/c.gv|0;if(0===(e&=63))return a;32>e?(a=g>>>e|h<<32-e,e=h>>e):(a=h>>e-32,e=0<=h?0:-1);return e*c.gv+(a>>>0)};c.JH=function(a){a|=0;return(1103495168*a|0)+(20077*a|0)|0};
c.truncate=function(a){return 0>a?-1*Math.floor(Math.abs(a)):Math.floor(a)};c.aH=Math.pow(2,53)-1;c.UT=-c.aH;c.pF=65536;c.zU=16777216;c.gv=c.pF*c.pF;return c}();a.I=c})(B||(B={}));(function(a){(function(a){a[a.Project=0]="Project";a[a.Union=1]="Union";a[a.Difference=2]="Difference";a[a.Proximity2D=3]="Proximity2D";a[a.Relate=4]="Relate";a[a.Equals=5]="Equals";a[a.Disjoint=6]="Disjoint";a[a.Intersects=7]="Intersects";a[a.Within=8]="Within";a[a.Contains=9]="Contains";a[a.Crosses=10]="Crosses";a[a.Touches=
11]="Touches";a[a.Overlaps=12]="Overlaps";a[a.Buffer=13]="Buffer";a[a.Distance=14]="Distance";a[a.Intersection=15]="Intersection";a[a.Clip=16]="Clip";a[a.Cut=17]="Cut";a[a.DensifyByLength=18]="DensifyByLength";a[a.DensifyByAngle=19]="DensifyByAngle";a[a.LabelPoint=20]="LabelPoint";a[a.GeodesicBuffer=21]="GeodesicBuffer";a[a.GeodeticDensifyByLength=22]="GeodeticDensifyByLength";a[a.ShapePreservingDensify=23]="ShapePreservingDensify";a[a.GeodeticLength=24]="GeodeticLength";a[a.GeodeticArea=25]="GeodeticArea";
a[a.Simplify=26]="Simplify";a[a.SimplifyOGC=27]="SimplifyOGC";a[a.Offset=28]="Offset";a[a.Generalize=29]="Generalize";a[a.SymmetricDifference=30]="SymmetricDifference";a[a.ConvexHull=31]="ConvexHull";a[a.Boundary=32]="Boundary";a[a.SimpleRelation=33]="SimpleRelation"})(a.iI||(a.iI={}));var c=function(){function c(){}c.prototype.D=function(){return null};c.NT=function(c){a.T.Th(c.D())&&(c=c.pb,null!=c&&(c.uv(null),c.GA(null)))};return c}();a.Me=c})(B||(B={}));(function(a){var c=function(c){function h(){c.apply(this,
arguments)}D(h,c);h.prototype.D=function(){return 13};h.local=function(){null===h.V&&(h.V=new h);return h.V};h.prototype.$=function(e,g,c,h,b){return e instanceof a.T?(b=new a.Pc(e),this.$(b,g,[c],!1,h).next()):!0===h?(c=new a.Pz(e,g,c,!1,b),a.wi.local().$(c,g,b)):new a.Pz(e,g,c,!1,b)};h.V=null;return h}(a.Me);a.Oz=c})(B||(B={}));(function(a){var c=function(){function c(c,e,g,b,d){this.ua=-1;this.ne=c;this.fx=e;this.Oq=g;this.BP=new a.i;this.BP.Ja();this.Vm=-1;this.Yb=d}c.prototype.next=function(){for(var a;null!=
(a=this.ne.next());)return this.ua=this.ne.ya(),this.Vm+1<this.Oq.length&&this.Vm++,this.buffer(a,this.Oq[this.Vm]);return null};c.prototype.ya=function(){return this.ua};c.prototype.buffer=function(c,e){return a.UG.buffer(c,e,this.fx,NaN,96,this.Yb)};return c}();a.Pz=c})(B||(B={}));(function(a){var c=function(c){function h(){c.apply(this,arguments)}D(h,c);h.prototype.D=function(){return 16};h.local=function(){null===h.V&&(h.V=new h);return h.V};h.prototype.$=function(e,g,c,h){return e instanceof
a.T?(e=new a.Pc(e),this.$(e,g,c,h).next()):new a.TH(e,g,c,h)};h.V=null;return h}(a.Me);a.SH=c})(B||(B={}));(function(a){var c=function(){function c(c,e,g){this.ua=-1;if(null==c)throw a.g.N();this.R=e;this.wk=c;this.ka=a.Ia.zd(g,e,!1)}c.prototype.next=function(){var c;return null!=(c=this.wk.next())?(this.ua=this.wk.ya(),a.Ed.clip(c,this.R,this.ka,0)):null};c.prototype.ya=function(){return this.ua};return c}();a.TH=c})(B||(B={}));(function(a){var c=function(c){function h(){c.apply(this,arguments)}
D(h,c);h.prototype.D=function(){return 31};h.local=function(){null===h.V&&(h.V=new h);return h.V};h.prototype.$=function(e,g,c){return e instanceof a.T?a.Rz.qB(e):new a.Rz(g,e,c)};h.V=null;return h}(a.Me);a.Qz=c})(B||(B={}));(function(a){var c=function(){function c(c,e,g){this.cE=new a.Tr;this.ua=-1;if(null==e)throw a.g.N();this.zP=c;this.Ec=!1;this.wk=e;this.Yb=g}c.prototype.next=function(){if(this.zP){if(!this.Ec){var a=this.GK(this.wk);this.Ec=!0;return a}return null}if(!this.Ec){a=this.wk.next();
if(null!=a)return this.ua=this.wk.ya(),c.qB(a);this.Ec=!0}return null};c.prototype.ya=function(){return this.ua};c.prototype.GK=function(a){for(var e;null!=(e=a.next());)this.cE.Eb(e);return this.cE.sN()};c.qB=function(h){if(c.Gh(h))return h;var e=h.D();if(a.al.Lc(e))return e=new a.Xa(h.description),e.Bc(h,!0),e;if(550==e&&2==h.F()){var g=new a.Va,e=new a.Xa(h.description);h.Sd(0,g);e.df(g);h.Sd(1,g);e.lineTo(g);return e}return a.Tr.wL(h)};c.Gh=function(c){if(c.s())return!0;var e=c.D();return 33==
e||197==e?!0:a.al.Lc(e)?!1:550==e?1==c.F()?!0:!1:1607==e?1==c.ea()&&2>=c.F()?!0:!1:1!=c.ea()?!1:2>=c.F()?!0:a.Tr.sD(c,0)};return c}();a.Rz=c})(B||(B={}));(function(a){var c=function(c){function h(){c.apply(this,arguments)}D(h,c);h.prototype.D=function(){return 17};h.local=function(){null===h.V&&(h.V=new h);return h.V};h.prototype.$=function(e,g,c,h,b){return new a.VH(e,g,c,h,b)};h.V=null;return h}(a.Me);a.UH=c})(B||(B={}));(function(a){var c=function(){function c(c,e,g,b,d){this.Ef=null;if(null==
e||null==g)throw a.g.ra("invalid argument");this.xP=c;this.rx=e;this.RD=g;c=a.Ia.$s(e,g);this.ka=a.Ia.zd(b,c,!0);this.QD=-1;this.oe=d}c.prototype.ya=function(){return 0};c.prototype.next=function(){this.gN();return++this.QD<this.Ef.length?this.Ef[this.QD]:null};c.prototype.gN=function(){if(null==this.Ef)switch(this.Ef=[],this.rx.D()){case 1607:this.iN();break;case 1736:this.hN()}};c.prototype.iN=function(){var c=new a.Xa,e=new a.Xa,g=new a.Xa;this.Ef.push(c);this.Ef.push(e);var b=[];a.$G.YG(this.xP,
this.rx,this.RD,this.ka,b,this.oe);for(var d=0;d<b.length;d++){var f=b[d];0==f.cu?c.add(f.U,!1):1==f.cu||2==f.cu?e.add(f.U,!1):3==f.cu?this.Ef.push(f.U):g.add(f.U,!1)}g.s()||c.s()&&e.s()&&!(3<=this.Ef.length)||this.Ef.push(g);c.s()&&e.s()&&3>this.Ef.length&&(this.Ef.length=0)};c.prototype.hN=function(){var c=new a.ga(0),e=new a.fd,g=e.RB(),b=e.Eb(this.rx),d=e.Eb(this.RD),f=new a.Of;try{f.Np(e,this.ka,this.oe);f.xm(g,b,d,c);var k=e.hf(b),m=new a.Ka,p=new a.Ka;this.Ef.length=0;this.Ef.push(m);this.Ef.push(p);
for(b=0;b<c.size;b++){var r,A=new a.fd,u=A.Eb(k),v=A.Eb(e.hf(c.get(b)));f.Mp(A,this.oe);var q=f.mt(u,v);r=A.hf(q);if(!r.s()){var x=e.yC(c.get(b),g);2==x?m.add(r,!1):1==x?p.add(r,!1):this.Ef.push(r);var D=new a.fd,u=D.Eb(k),v=D.Eb(e.hf(c.get(b)));f.Mp(D,this.oe);k=D.hf(f.ll(u,v))}}!k.s()&&0<c.size&&this.Ef.push(k);m.s()&&p.s()&&(this.Ef.length=0)}finally{f.xg()}};return c}();a.VH=c})(B||(B={}));(function(a){var c=function(c){function h(){c.apply(this,arguments)}D(h,c);h.prototype.D=function(){return 18};
h.local=function(){null===h.V&&(h.V=new h);return h.V};h.prototype.$=function(e,g,c){if(e instanceof a.T)return e=new a.Pc(e),this.$(e,g,c).next();if(0>=g)throw a.g.N();return new a.XH(e,g,c)};h.V=null;return h}(a.Me);a.WH=c})(B||(B={}));(function(a){var c=function(){function c(a,e){this.ua=-1;this.ne=a;this.$q=e}c.prototype.ya=function(){return this.ua};c.prototype.next=function(){var a;return null!=(a=this.ne.next())?(this.ua=this.ne.ya(),this.hM(a)):null};c.prototype.hM=function(c){if(c.s()||1>
c.fb())return c;var e=c.D();if(1736==e||1607==e)return this.Xv(c);if(a.T.Lc(e))return this.jM(c);if(197==e)return this.iM(c);throw a.g.wa();};c.prototype.jM=function(c){if(c.$b()<=this.$q)return c;var e=new a.Xa(c.description);e.Bc(c,!0);return this.Xv(e)};c.prototype.iM=function(c){var e=new a.Ka(c.description);e.Wc(c,!1);var g=new a.i;c.o(g);c=g.ba();return g.aa()<=this.$q&&c<=this.$q?e:this.Xv(e)};c.prototype.Xv=function(c){for(var e=c.Pa(),g=c.Ca();g.kb();)for(var h=!0;g.La();){var b=g.ia();if(322!=
b.D())throw a.g.ra("not implemented");var d=g.lD(),f=b.$b();if(f>this.$q){var k=Math.ceil(f/this.$q),f=new a.Va(c.description);h&&(b.En(f),e.df(f));for(var m=h=1/k,p=0,k=k-1;p<k;p++)b.uu(m,f),e.lineTo(f),m+=h;d?e.ro():(b.Bn(f),e.lineTo(f))}else d?e.ro():e.Bc(b,h);h=!1}return e};return c}();a.XH=c})(B||(B={}));(function(a){var c=function(c){function h(){c.apply(this,arguments)}D(h,c);h.local=function(){null===h.V&&(h.V=new h);return h.V};h.prototype.D=function(){return 2};h.prototype.$=function(e,
g,c,h){return e instanceof a.T?(e=new a.Pc(e),g=new a.Pc(g),this.$(e,g,c,h).next()):new a.YH(e,g,c,h)};h.ll=function(e,g,c,b){if(e.s()||g.s())return e;var n=e.fb(),d=g.fb();if(n>d)return e;var f=e.D(),k=g.D(),m=new a.i,y=new a.i,p=new a.i;e.o(m);g.o(y);p.K(m);p.Db(y);var p=a.Ia.zd(c,p,!1),r=p*Math.sqrt(2)*1.00001,A=new a.i;A.K(m);A.P(r,r);if(!A.jc(y))return e;if(1==n&&2==d)return h.UI(e,g,k,c,b);if(33==f)switch(a.al.Lc(k)?(c=new a.Xa(g.description),c.Bc(g,!0)):c=g,k){case 1736:return h.kP(e,c,p);
case 1607:return h.nP(e,c,p);case 550:return h.dN(e,c,p);case 197:return h.FM(e,c,p);case 33:return h.rO(e,c,p);default:throw a.g.N();}else if(550==f)switch(k){case 1736:return h.ZI(e,g,p);case 197:return h.TI(e,g,p);case 33:return h.WI(e,g,p)}return a.Of.ll(e,g,c,b)};h.kP=function(e,g,c){return 0==a.gd.uD(g,e,c)?e:e.Pa()};h.nP=function(e,g,c){var h=e.w();g=g.Ca();for(var b=c*Math.sqrt(2)*1.00001,n=b*b,d=new a.i;g.kb();)for(;g.La();){var f=g.ia();f.o(d);d.P(b,b);if(d.contains(h)){if(f.Eq(h,c))return e.Pa();
var k=f.Mb();if(a.b.Zb(h,k)<=n)return e.Pa();k=f.oc();if(a.b.Zb(h,k)<=n)return e.Pa()}}return e};h.dN=function(e,g,c){var h=g.mc(0);g=g.F();var b=e.w(),n=new a.b;c=c*Math.sqrt(2)*1.00001;c*=c;for(var d=0;d<g;d++)if(h.ec(2*d,n),a.b.Zb(n,b)<=c)return e.Pa();return e};h.FM=function(e,g,c){var h=new a.i;g.o(h);h.P(c,c);g=e.w();return h.contains(g)?e.Pa():e};h.rO=function(e,g,c){c=c*Math.sqrt(2)*1.00001;c*=c;var h=e.w();g=g.w();return a.b.Zb(h,g)<=c?e.Pa():e};h.ZI=function(e,g,c){var h=new a.i;g.o(h);
h.P(c,c);for(var b=e.F(),n=!1,d=[],f=0;f<b;f++)d[f]=!1;for(var k=new a.b,f=0;f<b;f++)e.w(f,k),h.contains(k)&&0!=a.gd.he(g,k,c)&&(n=!0,d[f]=!0);if(!n)return e;g=e.Pa();for(f=0;f<b;f++)d[f]||g.Pd(e,f,f+1);return g};h.TI=function(e,g,c){var h=new a.i;g.o(h);h.P(c,c);g=e.F();var b=!1;c=[];for(var n=0;n<g;n++)c[n]=!1;for(var d=new a.b,n=0;n<g;n++)e.w(n,d),h.contains(d)&&(b=!0,c[n]=!0);if(!b)return e;h=e.Pa();for(n=0;n<g;n++)c[n]||h.Pd(e,n,n+1);return h};h.WI=function(e,g,c){var h=e.mc(0),b=e.F(),n=g.w(),
d=new a.b,f=!1;g=[];for(var k=0;k<b;k++)g[k]=!1;k=c*Math.sqrt(2)*1.00001;c=k*k;for(k=0;k<b;k++)h.ec(2*k,d),a.b.Zb(d,n)<=c&&(f=!0,g[k]=!0);if(!f)return e;h=e.Pa();for(k=0;k<b;k++)g[k]||h.Pd(e,k,k+1);return h};h.UI=function(e,g,c,h,b){var n=new a.Vj;e.Fp(n);var d=new a.i;g.o(d);n.Db(d);n.P(.1*n.aa(),.1*n.ba());d=new a.Ka;d.Wc(n,!1);1736==c?d.add(g,!0):d.Wc(g,!0);return a.$r.local().$(e,d,h,b)};h.V=null;return h}(a.Me);a.Zr=c})(B||(B={}));(function(a){var c=function(){function c(a,e,g,c){this.Fq=null==
e;this.ua=-1;this.ne=a;this.fx=g;this.EP=e.next();this.Yb=c}c.prototype.next=function(){if(this.Fq)return null;var c;return null!=(c=this.ne.next())?(this.ua=this.ne.ya(),a.Zr.ll(c,this.EP,this.fx,this.Yb)):null};c.prototype.ya=function(){return this.ua};return c}();a.YH=c})(B||(B={}));(function(a){var c=function(){function c(e){this.oe=e;this.Ii=new a.i;this.Ii.Ja();this.Ng=new a.i;this.Ng.Ja()}c.prototype.Pr=function(){var a;a=this.Ii.v;this.Ii.v=this.Ng.v;this.Ng.v=a;a=this.Ii.B;this.Ii.B=this.Ng.B;
this.Ng.B=a;a=this.Ii.C;this.Ii.C=this.Ng.C;this.Ng.C=a;a=this.Ii.G;this.Ii.G=this.Ng.G;this.Ng.G=a};c.prototype.wM=function(e,g){var c=!this.Ii.jc(this.Ng);if(a.T.Kc(e.D())&&a.T.Kc(g.D())){if(e.F()>g.F())return this.gB(e,g,c);this.Pr();c=this.gB(g,e,c);this.Pr();return c}if(550==e.D()&&a.T.Kc(g.D()))return c=this.hB(g,e,c),this.Pr(),c;if(550==g.D()&&a.T.Kc(e.D()))return this.hB(e,g,c);if(550==e.D()&&550==g.D()){if(e.F()>g.F())return this.iB(e,g);this.Pr();c=this.iB(g,e);this.Pr();return c}return 0};
c.prototype.gB=function(e,g,c){var h=e.Ca(),b=g.Ca(),n=new a.i,d=new a.i,f=1.7976931348623157E308;if(!c&&this.iT(e,g,h,b))return 0;for(;h.kb();)for(;h.La();)if(e=h.ia(),e.o(n),!(n.Ou(this.Ng)>f)){for(;b.kb();)for(;b.La();)if(g=b.ia(),g.o(d),n.Ou(d)<f&&(g=e.Fb(g,c),g*=g,g<f)){if(0==g)return 0;f=g}b.Lk()}return Math.sqrt(f)};c.prototype.hB=function(e,g,c){var h=e.Ca(),b=new a.i,n=1.7976931348623157E308,d=new a.b,f,k=g.F();for(c=!c&&1736==e.D();h.kb();)for(;h.La();){var m=h.ia();m.o(b);if(!(1<k&&b.Ou(this.Ng)>
n)){for(var p=0;p<k;p++){g.w(p,d);if(c&&0!=a.gd.he(e,d,0))return 0;f=m.Gd(d,!1);d.sub(m.Kb(f));f=d.Up();if(f<n){if(0==f)return 0;n=f}}c=!1}}return Math.sqrt(n)};c.prototype.iB=function(e,g){for(var c=1.7976931348623157E308,h=new a.b,b=new a.b,d,f=e.F(),k=g.F(),m=0;m<f;m++)if(e.w(m,h),!(1<k&&this.Ng.gG(h)>c))for(var p=0;p<k;p++)if(g.w(p,b),d=a.b.Zb(h,b),d<c){if(0==d)return 0;c=d}return Math.sqrt(c)};c.prototype.iT=function(e,g,c,h){if(1736==e.D()){for(;h.kb();)if(h.La()){var b=h.ia();if(0!=a.gd.he(e,
b.oc(),0))return!0}h.Lk()}if(1736==g.D()){for(;c.kb();)if(c.La()&&(e=c.ia(),0!=a.gd.he(g,e.oc(),0)))return!0;c.Lk()}return!1};c.prototype.il=function(a,g){if(a.s()||g.s())return NaN;a.o(this.Ii);g.o(this.Ng);return this.wM(a,g)};return c}(),b=function(h){function e(){h.apply(this,arguments)}D(e,h);e.prototype.$=function(e,h,b){if(null==e||null==h)throw a.g.N();if(e.s()||h.s())return NaN;var g,n;g=e.D();n=h.D();if(33==g){if(33==n)return a.b.Fb(e.w(),h.w());if(197==n)return b=new a.i,h.o(b),b.Fb(e.w());
g=new a.pe;g.add(e);e=g}else if(197==g){if(197==n)return n=new a.i,e.o(n),b=new a.i,h.o(b),b.Fb(n);g=new a.Ka;g.Wc(e,!1);e=g}33==n?(n=new a.pe,n.add(h),h=n):197==n&&(n=new a.Ka,n.Wc(h,!1),h=n);return(new c(b)).il(e,h)};e.local=function(){null===e.V&&(e.V=new e);return e.V};e.prototype.D=function(){return 14};e.V=null;return e}(a.Me);a.ZH=b})(B||(B={}));(function(a){var c=function(){function c(a,e,g,c){this.aE=a;this.fE=e;this.oe=c;this.HD=g}c.prototype.next=function(){var a=this.aE.next();return null==
a?null:this.yz(a)};c.prototype.ya=function(){return this.aE.ya()};c.prototype.yz=function(c){var e=c.D();if(a.T.Km(e))return c;if(197==e)return e=new a.Ka(c.description),e.Wc(c,!1),this.yz(e);if(c.s())return c;if(null==c)throw a.g.wa();for(var e=c.Pa(),g=new a.yb,h=0,b=c.ea();h<b;h++)this.mH(c,h,e,g);return e};c.prototype.mH=function(c,e,g,b){if(!(2>c.Ha(e))){var h=c.Ea(e),n=c.Dc(e)-1,d=c.mc(0),f=c.vc(e),k=new a.ga(0);k.xb(c.Ha(e)+1);var m=new a.ga(0);m.xb(c.Ha(e)+1);k.add(f?h:n);k.add(h);for(h=new a.b;1<
k.size;){var p=k.tc();k.af();var r=k.tc();c.w(p,h);b.ed(h);c.w(r,h);b.vd(h);r=this.jH(b,h,d,p,r,n);0<=r?(k.add(r),k.add(p)):m.add(p)}f||m.add(k.get(0));if(m.size==k.size)g.Zj(c,e,!0);else if(2<=m.size&&(!this.HD||2!=m.size||!(f||a.b.Fb(c.Fa(m.get(0)),c.Fa(m.get(1)))<=this.fE))){e=new a.Va;b=0;for(n=m.size;b<n;b++)c.Sd(m.get(b),e),0==b?g.df(e):g.lineTo(e);f&&(this.HD||2!=m.size||g.lineTo(e),g.ro())}}};c.prototype.jH=function(a,e,g,c,b,d){var h=b-1;b<=c&&(h=d);d=b=-1;for(c+=1;c<=h;c++){g.ec(2*c,e);
var n=e.x,f=e.y;a.Kb(a.Gd(e,!1),e);e.x-=n;e.y-=f;n=e.length();n>this.fE&&n>d&&(b=c,d=n)}return b};return c}();a.$H=c})(B||(B={}));(function(a){var c=function(c){function h(){c.apply(this,arguments)}D(h,c);h.prototype.D=function(){return 29};h.prototype.$=function(e,g,c,h){return e instanceof a.T?(e=new a.Pc(e),this.$(e,g,c,h).next()):new a.$H(e,g,c,h)};h.local=function(){null===h.V&&(h.V=new h);return h.V};h.V=null;return h}(a.Me);a.Sz=c})(B||(B={}));(function(a){var c=function(c){function h(){c.apply(this,
arguments)}D(h,c);h.prototype.D=function(){return 21};h.local=function(){null===h.V&&(h.V=new h);return h.V};h.prototype.$=function(e,g,c,h,b,d,f,k){return e instanceof a.T?(k=new a.Pc(e),this.$(k,g,c,[h],b,d,!1,f).next()):!0===f?(c=new a.Uz(e,g,c,h,b,!1,!1,k),a.wi.local().$(c,g,k)):new a.Uz(e,g,c,h,b,!1,!1,k)};h.V=null;return h}(a.Me);a.Tz=c})(B||(B={}));(function(a){var c=function(){function c(c,e,g,b,d,f,k,m){if(f)throw a.g.qe();if(null==e)throw a.g.N();this.ua=-1;this.Xq=c;this.cg=e;this.ke=g;
this.Oq=b;this.Rm=d;this.Vm=-1;this.Yb=m;this.CP=new a.i;this.CP.Ja()}c.prototype.next=function(){for(var a;null!=(a=this.Xq.next());)return this.ua=this.Xq.ya(),this.Vm+1<this.Oq.length&&this.Vm++,this.oN(a,this.Oq[this.Vm]);return null};c.prototype.ya=function(){return this.ua};c.prototype.oN=function(c,e){return a.pH.buffer(c,this.cg,this.ke,e,this.Rm,this.Yb)};return c}();a.Uz=c})(B||(B={}));(function(a){var c=function(c){function h(){c.apply(this,arguments)}D(h,c);h.prototype.D=function(){return 24};
h.local=function(){null===h.V&&(h.V=new h);return h.V};h.prototype.$=function(e,g,c){if(null==g)throw a.g.N();if(e.s()||1>e.fb())return 0;if(4==c)throw a.g.qe();var h=a.Ya.Em(g),b=a.Ya.ft(h),n=a.Ya.Ts(h),b=b*(2-b),d=h.Se().Dj,f=e.D(),k;1736==f||197==f?k=e.Rf():a.T.Lc(f)?(k=new a.Xa(e.description),k.Bc(e,!0)):k=e;if(0==h.lc(g)){if(a.Ya.Qo(g)){k=a.gh.qo(k,g);1607==f&&k==e&&(k=a.T.Yj(e));e=new a.Nd;a.Ya.Fm(g).wu(e);for(var f=0,m=k.F();f<m;f++){var p=k.Fa(f);p.x=a.gh.pu(p.x,e);k.ic(f,p)}}e=k.Pa();k=a.gh.ZQ(g,
h,k,e)?e:a.Ya.Wl(k,g,h)}return this.yM(k,c,n,b,d)};h.prototype.yM=function(e,g,c,h,b){var n=new a.ca(0),d=0;for(e=e.Ca();e.kb();)for(;e.La();){var f=e.ia(),k=f.Mb(),f=f.oc();k.scale(b);f.scale(b);a.zb.Rd(c,h,k.x,k.y,f.x,f.y,n,null,null,g);d+=n.l}return d};h.V=null;return h}(a.Me);a.cI=c})(B||(B={}));(function(a){var c=function(c){function h(){c.apply(this,arguments)}D(h,c);h.prototype.D=function(){return 18};h.local=function(){null===h.V&&(h.V=new h);return h.V};h.prototype.$=function(e,g,c,h,b){return e instanceof
a.T?(e=new a.Pc(e),this.$(e,g,c,h,b).next()):new a.bI(e,c,h,g,-1,-1,b)};h.V=null;return h}(a.Me);a.aI=c})(B||(B={}));(function(a){var c=function(){function c(c,e,g,b,d,f){if(0<f)throw a.g.qe();if(4!=g&&0<d)throw a.g.qe();if(null==e)throw a.g.N();this.ua=-1;this.Xq=c;this.cg=e;this.ke=g;this.IP=b;this.HP=d}c.prototype.next=function(){for(var a;null!=(a=this.Xq.next());)return this.ua=this.Xq.ya(),this.hw(a);return null};c.prototype.ya=function(){return this.ua};c.prototype.hw=function(c){return a.ui.oq(c,
this.cg,this.ke,this.IP,this.HP,this.Yb)};return c}();a.bI=c})(B||(B={}));(function(a){(function(a){a[a.Unknown=0]="Unknown";a[a.Contains=1]="Contains";a[a.Within=2]="Within";a[a.Equals=3]="Equals";a[a.Disjoint=4]="Disjoint";a[a.Touches=8]="Touches";a[a.Crosses=16]="Crosses";a[a.Overlaps=32]="Overlaps";a[a.NoThisRelation=64]="NoThisRelation";a[a.Intersects=1073741824]="Intersects";a[a.IntersectsOrDisjoint=1073741828]="IntersectsOrDisjoint"})(a.xH||(a.xH={}));var c=function(){function c(){}c.lU=function(h,
e,g,b){if(e.s()||h.s())return 4;var n=h.D(),d=e.D(),f;a.T.Lc(n)&&(h=f=new a.Xa(h.description),f.Bc(h,!0));a.T.Lc(d)&&(e=f=new a.Xa(e.description),f.Bc(e,!0));switch(n){case 33:switch(d){case 33:return c.sO(h,e,g);case 197:return c.Id(c.BG(e,h,g));case 550:return c.Id(c.HG(e,h,g));case 1607:return c.Id(c.Az(e,h,g,b));case 1736:return c.Id(c.pz(e,h,g))}throw a.g.wa();case 197:switch(d){case 33:return c.BG(h,e,g);case 197:return c.fK(h,e,g);case 550:return c.Id(c.DG(e,h,g,b));case 1607:return c.Id(c.vz(e,
h));case 1736:return c.Id(c.lz(e,h))}throw a.g.wa();case 550:switch(d){case 33:return c.HG(h,e,g);case 197:return c.DG(h,e,g,b);case 550:return c.FG(h,e,g,b);case 1607:return c.Id(c.xz(e,h));case 1736:return c.Id(c.nz(e,h))}throw a.g.wa();case 1607:switch(d){case 33:return c.Az(h,e,g,b);case 197:return c.vz(h,e);case 550:return c.xz(h,e);case 1607:return c.iQ(h,e);case 1736:return c.Id(c.rz(e,h))}throw a.g.wa();case 1736:switch(d){case 33:return c.pz(h,e,g);case 197:return c.lz(h,e);case 550:return c.nz(h,
e);case 1607:return c.rz(h,e);case 1736:return c.oP(h,e)}throw a.g.wa();default:throw a.g.wa();}};c.sO=function(a,e,g){a=a.w();e=e.w();return c.jz(a,e,g)};c.jz=function(a,e,g){a.sub(e);return a.Up()<=g*g?3:4};c.BG=function(h,e,g){var b=new a.i;h.o(b);h=e.w();return c.ZL(b,h,g)};c.ZL=function(a,e,g){a.P(-g,-g);if(a.contains(e))return 1;a.P(g,g);return a.contains(e)?8:4};c.uM=function(a,e,g){return e.contains(g)?1:a.contains(g)?8:4};c.fK=function(h,e,g){var b=new a.i;h.o(b);h=new a.i;e.o(h);return c.MK(b,
h,g)};c.MK=function(a,e,g){var c=0;a.contains(e)&&(c|=1);e.contains(a)&&(c|=2);if(0!=c)return c;a.P(-g,-g);e.P(-g,-g);if(a.jc(e))return c=a,c.P(g,g),c=c.contains(e)?1:0,e.P(g,g),c|=e.contains(a)?2:0,0!=c?c:32;c=a;c.P(g,g);e.P(g,g);return c.jc(e)?8:4};c.HG=function(a,e,g){e=e.w();return c.JG(a,e,g)};c.JG=function(a,e,g){for(var h=0,b=a.F();h<b;h++){var d;d=a.Fa(h);d=c.jz(d,e,g);if(4!=d)return 0!=(d&2)&&1!=b?1:d}return 4};c.DG=function(h,e,g,b){var n=new a.i;e.o(n);return c.eN(h,n,g,b)};c.eN=function(a,
e,g,b){e.P(-g,-g);e.P(g,g);for(var h=g=0,n=a.F();h<n;h++){var d;d=a.Fa(h);d=c.Id(c.uM(e,e,d));if(4!=d&&(g|=d,4==b))return 1073741824}return 0==g?4:2==g?g:32};c.FG=function(a,e,g,b){for(var h=0,n=0,d=e.F();n<d;n++){var f;f=e.Fa(n);f=c.JG(a,f,g);if(4!=f&&(h++,4==b))return 1073741824}return 0<h?h==e.F()?3==b?(f=c.FG(e,a,g,1),1==f?3:0):1:32:0};c.Az=function(a,e,g,b){e=e.w();return c.XP(a,e,g,b)};c.GM=function(a,e){var g=null;a=a.pb;null!=a&&(g=a.hi);if(null!=g){g=g.Kk(e.x,e.y);if(0==g)return 4;if(1==
g)return 1}else return-1;return 0};c.XP=function(h,e,g,b){if(0==(b&1073741839))return 64;var n=c.GM(h,e);if(0<n)return n;g*=g;for(n=h.Ca();n.kb();){var d=n.Qa;if(!h.vc(d)){var f=h.Ha(d),d=h.Ea(d);if(0==f)continue;if(a.b.Zb(h.Fa(d),e)<=g||1<f&&a.b.Zb(h.Fa(d+f-1),e)<=g)return 8}if(8!=b)for(;n.La();)if(f=n.ia(),f=f.Kb(f.Gd(e,!1)),a.b.Zb(f,e)<=g)return 0!=(b&1073741828)?1073741824:1}return 0!=(b&1073741828)?4:64};c.vz=function(h,e){var g=new a.i;e.o(g);return c.rP(h,g)};c.rP=function(a,e){a=c.ao(a,e);
return 0<a?a:0};c.ao=function(a,e){a=a.pb;if(null!=a)a=a.hi;else return-1;if(null!=a){a=a.Dn(e);if(0==a)return 4;if(1==a)return 1}else return-1;return 0};c.xz=function(h,e){var g=new a.i;e.o(g);g=c.ao(h,g);return 0<g?g:0};c.fs=function(h,e){var g=new a.i;e.o(g);g=c.ao(h,g);return 0<g?g:-1==g&&(g=new a.i,h.o(g),g=c.ao(e,g),0<g)?c.Id(g):0};c.iQ=function(a,e){a=c.fs(a,e);return 0<a?a:0};c.pz=function(a,e,g){e=e.w();return c.lP(a,e,g)};c.lP=function(c,e,g){c=a.gd.he(c,e,g);if(0==c)return 4;if(1==c)return 1;
if(2==c)return 8;throw a.g.wa();};c.lz=function(h,e){var g=new a.i;e.o(g);return c.uO(h,g)};c.uO=function(a,e){a=c.ao(a,e);return 0<a?a:0};c.nz=function(a,e){a=c.fs(a,e);return 0<a?a:0};c.rz=function(a,e){a=c.fs(a,e);return 0<a?a:0};c.oP=function(a,e){a=c.fs(a,e);return 0<a?a:0};c.iR=function(c,e){var g=c.D(),h=e.D(),b;if(a.T.Th(g)&&(b=c.pb,null!=b&&(b=b.hi,null!=b))){if(33==h){var d=e.w();b=b.Kk(d.x,d.y)}else d=new a.i,e.o(d),b=b.Dn(d);if(1==b)return 1;if(0==b)return 4}if(a.T.Th(h)&&(b=e.pb,null!=
b&&(b=b.hi,null!=b))){33==g?(g=c.w(),b=b.Kk(g.x,g.y)):(g=new a.i,c.o(g),b=b.Dn(g));if(1==b)return 2;if(0==b)return 4}return 0};c.Id=function(a){0!=(a&1)&&(a=a&-2|2);0!=(a&2)&&(a=a&-3|1);return a};return c}();a.dI=c})(B||(B={}));(function(a){var c=function(c){function h(){c.apply(this,arguments)}D(h,c);h.local=function(){null===h.V&&(h.V=new h);return h.V};h.prototype.D=function(){return 15};h.prototype.$=function(e,g,c,h,b){return e instanceof a.T?(e=new a.Pc(e),g=new a.Pc(g),this.$(e,g,c,h,b).next()):
void 0===b?new a.Vz(e,g,c,h,-1):new a.Vz(e,g,c,h,b)};h.V=null;return h}(a.Me);a.$r=c})(B||(B={}));(function(a){var c=function(){function c(c,e,g,b,d){this.Fq=null==e;this.ua=-1;this.ne=c;this.cg=g;this.Ce=e.next();this.Ji=this.Ce.D();this.Yb=b;this.Xh=d;if(-1!=this.Xh&&(0>=this.Xh||7<this.Xh))throw a.g.N("bad dimension mask");}c.prototype.next=function(){if(this.Fq)return null;var a;if(null!=this.du){a=this.du.next();if(null!=a)return a;this.du=null}for(;null!=(a=this.ne.next());){this.ua=this.ne.ya();
if(-1==this.Xh)return a=this.Ga(a);this.du=this.PO(a);return a=this.du.next()}return null};c.prototype.ya=function(){return this.ua};c.prototype.Ga=function(c){var e=this.uG(c);if(null!=e)return e;var e=a.Ia.$s(this.Ce,c),g=a.Ia.zd(this.cg,e,!0),e=new a.i;this.Ce.o(e);var h=new a.i;c.o(h);e.P(2*g,2*g);e.Ga(h);e.P(100*g,100*g);g=a.Ed.clip(this.Ce,e,0,0);c=a.Ed.clip(c,e,0,0);return a.Of.mt(c,g,this.cg,this.Yb)};c.prototype.SE=function(c,e,g){var h=0;if(0!=(e&1))null==g[0]&&(g[0]=new a.pe(c)),h++;else for(var b=
0;b<g.length-1;b++)g[b]=g[b+1];if(0!=(e&2))null==g[h]&&(g[h]=new a.Xa(c)),h++;else for(b=h;b<g.length-1;b++)g[b]=g[b+1];if(0!=(e&4))null==g[h]&&(g[h]=new a.Ka(c)),h++;else for(b=h;b<g.length-1;b++)g[b]=g[b+1];if(3!=h){c=[];for(b=0;b<h;b++)c[b]=g[b];return new a.Pc(c)}return new a.Pc(g)};c.prototype.PO=function(c){var e=this.uG(c);if(null!=e){var g=[null,null,null];g[e.fb()]=e;return this.SE(c.description,this.Xh,g)}e=a.Ia.$s(this.Ce,c);g=a.Ia.zd(this.cg,e,!0);e=new a.i;this.Ce.o(e);e.P(2*g,2*g);var h=
new a.i;c.o(h);e.Ga(h);e.P(100*g,100*g);g=a.Ed.clip(this.Ce,e,0,0);e=a.Ed.clip(c,e,0,0);g=a.Of.Uw(e,g,this.cg,this.Yb);return this.SE(c.description,this.Xh,g)};c.prototype.uG=function(h){var e=a.Ia.$s(h,this.Ce),g=a.Ia.zd(this.cg,e,!1),e=h.D(),b=h.s(),d=this.Ce.s(),d=b||d;if(!d){d=new a.i;h.o(d);var f=new a.i;this.Ce.o(f);f.P(2*g,2*g);d=!d.jc(f)}if(!d)if(f=a.dI.iR(this.Ce,h),4==f)d=!0;else{if(0!=(f&2))return this.Ce;if(0!=(f&1))return h}if(d)return g=a.T.ve(e),d=a.T.ve(this.Ji),g<d?c.V(h,b):g>d?this.kF():
0==g?550==e&&33==this.Ji?this.kF():c.V(h,b):c.V(h,b);if((-1==this.Xh||4==this.Xh)&&197==e&&197==this.Ji)return g=this.Ce,e=new a.i,h.o(e),b=new a.i,g.o(b),e.Ga(b),g=new a.Vj,h.copyTo(g),g.Cu(e),g;if(197==e&&0==a.T.ve(this.Ji)||197==this.Ji&&0==a.T.ve(e))return b=197==e?h:this.Ce,h=197==e?this.Ce:h,e=new a.i,b.o(e),a.Ed.clip(h,e,g,0);if(0==a.T.ve(e)&&0<a.T.ve(this.Ji)||0<a.T.ve(e)&&0==a.T.ve(this.Ji)){g=a.Ia.Cg(this.cg,h,!1);if(550==e||33==e)return a.Of.jD(h,this.Ce,g);if(550==this.Ji||33==this.Ji)return a.Of.jD(this.Ce,
h,g);throw a.g.wa();}return-1!=this.Xh&&2!=this.Xh||1607!=e||1736!=this.Ji?-1!=this.Xh&&2!=this.Xh||1736!=e||1607!=this.Ji?null:this.rG(this.Ce,h):this.rG(h,this.Ce)};c.prototype.rG=function(c,e){var g=c,h=e,b=a.Ia.Cg(this.cg,e,!1),d=new a.i;h.o(d);var f=new a.i;g.o(f);f.P(2*b,2*b);d.Ga(f);d.P(10*b,10*b);var g=c=a.Ed.clip(c,d,0,0),f=new a.ga(0),k=-1,m=h.pb;if(null!=m){var p=m.hi;if(null!=p){k=0;f.xb(g.F()+g.ea());for(var r=new a.i,u=g.Ca();u.kb();)for(;u.La();){u.ia().o(r);var A=p.Dn(r);1==A?f.add(1):
0==A?f.add(0):(f.add(-1),k++)}}}5<e.F()&&(h=e=a.Ed.clip(e,d,0,0),m=h.pb);0>k&&(k=g.Iw());d=g.F()+h.F();if(k*h.F()>Math.log(d)*d*4)return null;d=null;k=h.Ca();null!=m&&null!=m.Ab&&(d=m.Ab);null==d&&20<h.F()&&(d=a.Ia.nB(h));h=c.Pa();m=null;p=g.Ca();r=[0,0,0,0,0,0,0,0,0];u=new a.qd(0);A=new a.Ag;c=-1;for(var v=0,q=0,x=0<f.size,D=-1;p.kb();){var D=p.Qa,B=0;c=-1;for(v=0;p.La();){var t=x?a.I.truncate(f.get(q)):-1;q++;var z=p.ia();if(0>t){if(null!=d)for(null==m?m=d.KN(z,b):m.Fn(z,b),t=m.next();-1!=t;t=m.next()){k.Sb(d.da(t));
for(var t=k.ia(),l=z.Ga(t,null,r,null,b),t=0;t<l;t++)u.add(r[t])}else for(k.Lk();k.kb();)for(;k.La();)for(t=k.ia(),l=z.Ga(t,null,r,null,b),t=0;t<l;t++)u.add(r[t]);if(0<u.size){u.xd(0,u.size,function(a,e){return a-e});var C=0;u.add(1);for(var l=-1,t=0,E=u.size;t<E;t++){var I=u.get(t);if(I!=C){var G=!1;0!=C||1!=I?(z.Bi(C,I,A),C=A.get()):(C=z,G=!0);if(2<=B){h.ys(g,D,c,v,3==B);if(1!=this.UA(e,C.Mb(),b)&&1!=this.VA(e,C,b))return null;h.Bc(C,!1);B=1;v=0}else switch(l=this.VA(e,C,b),l){case 1:G?2>B?(c=p.Jb()-
g.Ea(D),v=1,B=0==B?3:2):v++:(h.Bc(C,0==B),B=1);break;case 0:B=0;c=-1;v=0;break;default:return null}C=I}}}else{t=this.UA(e,z.Mb(),b);if(0>t)return null;1==t?(2>B&&(c=p.Jb()-g.Ea(D),B=0==B?3:2),v++):(c=-1,v=0)}u.clear(!1)}else 0!=t&&1==t&&(0==B?(B=3,c=p.Jb()-g.Ea(D)):1==B?(B=2,c=p.Jb()-g.Ea(D)):v++)}2<=B&&(h.ys(g,D,c,v,3==B),c=-1)}return h};c.prototype.UA=function(c,e,g){return a.ff.xl(c,e,g)};c.prototype.VA=function(c,e,g){var h=e.Mb();e=e.oc();var b=a.ff.xl(c,h,g),d=a.ff.xl(c,e,g);if(1==b&&0==d||
0==b&&1==d)return-1;if(0==b||0==d)return 0;if(1==b||1==d)return 1;b=new a.b;b.add(h,e);b.scale(.5);c=a.ff.xl(c,b,g);return 0==c?0:1==c?1:-1};c.V=function(a,e){return e?a:a.Pa()};c.prototype.kF=function(){null==this.$D&&(this.$D=this.Ce.Pa());return this.$D};return c}();a.Vz=c})(B||(B={}));(function(a){var c=function(c){function h(){c.apply(this,arguments)}D(h,c);h.prototype.D=function(){return 28};h.local=function(){null===h.V&&(h.V=new h);return h.V};h.prototype.$=function(e,g,c,h,b,d,f){return e instanceof
a.T?(e=new a.Pc(e),this.$(e,g,c,h,b,d,f).next()):new a.eI(e,g,c,h,b,d,f)};h.V=null;return h}(a.Me);a.Wz=c})(B||(B={}));(function(a){var c=function(){function c(a,e,g,c,b,d,f){this.ua=-1;this.ne=a;this.Pi=e;this.Da=g;this.bi=c;this.Dx=b;this.XD=d;this.oe=f}c.prototype.next=function(){var a=this.ne.next();return null!=a?(this.ua=this.ne.ya(),this.RH(a)):null};c.prototype.ya=function(){return this.ua};c.prototype.RH=function(c){var e;e=0>=this.XD?a.Ia.Cg(this.Pi,c,!1):this.XD;return a.XG.$(c,this.Da,
this.bi,this.Dx,e,this.oe)};return c}();a.eI=c})(B||(B={}));(function(a){var c=function(){function c(){}c.prototype.reset=function(){this.Pg=this.Fj=-1;this.Hq=this.Uo=!1};c.prototype.QM=function(a,g,c){for(a.Sb(g,c);a.La();){var e=a.ia(),e=e.$b();if(0!=e)return a.Jb()}for(a.Sb(g,c);a.Ow();)if(e=a.oi(),e=e.$b(),0!=e)return a.Jb();return-1};c.prototype.RM=function(a,g){for(a.Sb(g,-1);a.Ow();)if(0!=a.oi().$b())return a.Jb();return-1};c.prototype.PM=function(a,g){a.Sb(g,-1);for(a.ia();a.La();)if(0!=
a.ia().$b())return a.Jb();return-1};c.prototype.OM=function(e,g,c,h){this.Fj=this.QM(g,c,h);if(-1!=this.Fj){g.Sb(this.Fj,-1);var b=g.ia(),n=b.Kb(b.Gd(e,!1));c=a.b.Zb(n,e);h=new a.b;h.J(n);h.sub(b.Mb());n=new a.b;n.J(e);n.sub(b.Mb());this.Uo=0>h.Ai(n);this.Pg=this.PM(g,this.Fj);if(-1!=this.Pg){g.Sb(this.Pg,-1);var b=g.ia(),d=b.Gd(e,!1),d=b.Kb(d),f=a.b.Zb(d,e);f>c?this.Pg=-1:(h.J(d),h.sub(b.Mb()),n.J(e),n.sub(b.Mb()),this.Hq=0>h.Ai(n))}-1==this.Pg&&(this.Pg=this.RM(g,this.Fj),-1!=this.Pg&&(g.Sb(this.Pg,
-1),b=g.ia(),d=b.Gd(e,!1),d=b.Kb(d),f=a.b.Zb(d,e),f>c?this.Pg=-1:(h.J(d),h.sub(b.Mb()),n.J(e),n.sub(b.Mb()),this.Hq=0>h.Ai(n),e=this.Fj,this.Fj=this.Pg,this.Pg=e,e=this.Uo,this.Uo=this.Hq,this.Hq=e)))}};c.prototype.FK=function(a,g,c,h,b){c=c.Ca();this.OM(a,c,h,b);if(-1!=this.Fj&&-1==this.Pg)return this.Uo;if(-1!=this.Fj&&-1!=this.Pg){if(this.Uo==this.Hq)return this.Uo;c.Sb(this.Fj,-1);a=c.ia().Pf(1);c.Sb(this.Pg,-1);g=c.ia().Pf(0);return 0<=a.Ai(g)?!0:!1}return g};return c}(),b=function(h){function e(){h.apply(this,
arguments)}D(e,h);e.local=function(){null===e.V&&(e.V=new e);return e.V};e.prototype.D=function(){return 3};e.prototype.zw=function(e,c,h,b){void 0===b&&(b=!1);if(e.s())return new a.dl;c=c.w();var g=e,n=e.D();197==n&&(g=new a.Ka,g.Wc(e,!1),n=1736);switch(n){case 33:return this.OE(g,c);case 550:return this.BE(g,c);case 1607:case 1736:return this.dQ(g,c,h,b);default:throw a.g.ra("not implemented");}};e.prototype.Aw=function(e,c){if(e.s())return new a.dl;c=c.w();var g=e,h=e.D();197==h&&(g=new a.Ka,g.Wc(e,
!1),h=1736);switch(h){case 33:return this.OE(g,c);case 550:case 1607:case 1736:return this.BE(g,c);default:throw a.g.ra("not implemented");}};e.prototype.Bw=function(e,c,h,b){if(0>b)throw a.g.N();if(e.s())return[];c=c.w();var g=e,n=e.D();197==n&&(g=new a.Ka,g.Wc(e,!1),n=1736);switch(n){case 33:return this.IQ(g,c,h,b);case 550:case 1607:case 1736:return this.gQ(g,c,h,b);default:throw a.g.ra("not implemented");}};e.prototype.dQ=function(e,h,b,d){if(1736==e.D()&&b&&(b=new a.i,e.o(b),b=a.Ia.zd(null,b,
!1),0!=(d?a.gd.he(e,h,0):a.gd.he(e,h,b)))){var g=new a.dl(h,0,0);d&&g.UF(!0);return g}for(var n=e.Ca(),g=new a.b,f=b=-1,k=1.7976931348623157E308,m=0;n.kb();)for(;n.La();){var y=n.ia(),y=y.Kb(y.Gd(h,!1)),p=a.b.Zb(y,h);p<k?(m=1,g=y,b=n.Jb(),f=n.Qa,k=p):p==k&&m++}g=new a.dl(g,b,Math.sqrt(k));d&&(n.Sb(b,f),y=n.ia(),d=0>a.b.yn(h,y.Mb(),y.oc()),1<m&&(m=new c,m.reset(),d=m.FK(h,d,e,b,f)),g.UF(d));return g};e.prototype.OE=function(e,c){e=e.w();c=a.b.Fb(e,c);return new a.dl(e,0,c)};e.prototype.BE=function(e,
c){var g=e.mc(0);e=e.F();for(var h=0,b=0,n=0,d=1.7976931348623157E308,f=0;f<e;f++){var k=new a.b;g.ec(2*f,k);var m=a.b.Zb(k,c);m<d&&(b=k.x,n=k.y,h=f,d=m)}g=new a.dl;g.tv(b,n,h,Math.sqrt(d));return g};e.prototype.IQ=function(e,c,h,b){if(0==b)return h=[];h*=h;e=e.w();c=a.b.Zb(e,c);c<=h?(h=[],b=new a.dl,b.tv(e.x,e.y,0,Math.sqrt(c)),h[0]=b):h=[];return h};e.prototype.gQ=function(e,c,h,b){if(0==b)return b=[];var g=e.mc(0),n=e.F();e=[];var d=0;h*=h;for(var f=0;f<n;f++){var k=g.read(2*f),m=g.read(2*f+1),
y=c.x-k,p=c.y-m,y=y*y+p*p;y<=h&&(p=new a.dl,p.tv(k,m,f,Math.sqrt(y)),d++,e.push(p))}c=e.length;e.sort(function(a,e){return a.Da<e.Da?-1:a.Da==e.Da?0:1});if(b>=c)return e.slice(0);e.length=b;return e.slice(0)};e.V=null;return e}(a.Me);a.bv=b})(B||(B={}));(function(a){var c=function(c){function h(){c.apply(this,arguments)}D(h,c);h.prototype.D=function(){return 4};h.prototype.$=function(e,c,h,b,d){return a.el.py(e,c,h,b,d)};h.local=function(){null===h.V&&(h.V=new h);return h.V};h.V=null;return h}(a.Me);
a.fI=c})(B||(B={}));(function(a){var c=function(c){function h(){c.apply(this,arguments)}D(h,c);h.prototype.D=function(){return 33};h.prototype.$=function(e,c,h,b,d){return 1073741824===e?!a.hd.qy(c,h,b,4,d):a.hd.qy(c,h,b,e,d)};h.local=function(){null===h.V&&(h.V=new h);return h.V};h.V=null;return h}(a.Me);a.bl=c})(B||(B={}));(function(a){var c=function(){function c(c,e,g,b){this.oe=b;this.yP=g;this.ua=-1;if(null==c)throw a.g.N();this.wk=c;this.Pi=e}c.prototype.next=function(){var a;return null!=(a=
this.wk.next())?(this.ua=this.wk.ya(),this.Qy(a)):null};c.prototype.ya=function(){return this.ua};c.prototype.Qy=function(c){if(null==c)throw a.g.N();return a.cv.cG(c,this.Pi,this.yP,this.oe)};return c}();a.gI=c})(B||(B={}));(function(a){var c=function(c){function h(){c.apply(this,arguments)}D(h,c);h.prototype.D=function(){return 26};h.prototype.$=function(e,c,h,b){return e instanceof a.T?(e=new a.Pc(e),this.$(e,c,h,b).next()):new a.gI(e,c,h,b)};h.prototype.Ro=function(e,c,h,b,d){return 0<(void 0!==
b?a.cv.Ro(e,c,h,b,d):a.cv.Ro(e,c,!1,null,h))};h.local=function(){null===h.V&&(h.V=new h);return h.V};h.V=null;return h}(a.Me);a.as=c})(B||(B={}));(function(a){var c=function(){function a(){this.hp=0}a.prototype.hS=function(a){this.hp&=-2;this.hp|=a?1:0};a.prototype.sl=function(){return 0!=(this.hp&1)};a.prototype.LC=function(){return this.sl()?0:1};return a}();a.AT=c;var b=function(){return function(){}}(),h=function(){return function(a,e,c,g){this.x=a;this.y=e;this.Sh=c;this.yl=g}}(),e=function(){function a(a){this.me=
a}a.prototype.compare=function(a,e,c){a=a.da(c);e=this.me.$e.read(2*e);a=this.me.$e.read(2*a);e-=a;return 0>e?-1:0<e?1:0};return a}(),g=function(){function a(a){this.me=a}a.prototype.compare=function(a,e,c){e=this.me.$a[e];a=this.me.$a[a.da(c)];var g=e.sl(),h=a.sl();c=e.Zd.xe(this.me.wn,0);var b=a.Zd.xe(this.me.wn,0);c==b&&(c=Math.min(g?e.Zd.ja:e.Zd.ha,h?a.Zd.ja:a.Zd.ha),g=.5*(c-this.me.wn)+this.me.wn,g==this.me.wn&&(g=c),c=e.Zd.xe(g,0),b=a.Zd.xe(g,0));return c<b?-1:c>b?1:0};return a}(),n=function(){function e(e,
c){this.VE=new a.b;this.parent=e;this.mO=c}e.prototype.Zp=function(a,e,c){var g=this.parent,h=this.mO;c.xd(a,e,function(a,e){return g.kj(a,e,h)})};e.prototype.Mo=function(a){a=this.parent.xh.get(a);this.parent.$e.ec(2*(a>>1),this.VE);return this.VE.y+(0!=(a&1)?this.parent.Ri:-this.parent.Ri)};return e}(),d=function(){function d(e,c,g,h,b){this.SD=e.description;this.U=e;this.sg=c;this.Ri=a.Ia.Cg(this.sg,e,!1);this.pn=a.Ia.Cg(this.sg,e,!0);this.yx=g;this.wP=this.SD.Aa;this.$a=[];this.dn=[];this.Lg=
new a.$n;this.Za=new a.bj;this.Kd=new a.wd;this.GD=this.pk=b}d.prototype.Yw=function(){this.GD=!0;return(!a.T.Kc(this.U.D())||this.yB()&&this.xB(!1))&&this.OK()?a.T.Kc(this.U.D())?this.RK()?1607==this.U.D()?this.TK()?2:0:this.UK()?this.VK():0:0:2:0};d.prototype.Yy=function(e,c){var g=this.$e.read(2*e);e=this.$e.read(2*e+1);var h=this.$e.read(2*c);c=this.$e.read(2*c+1);var b=!a.Sr.Vw(g,e,h,c,this.Ri*this.Ri);return b?b:0==this.U.fb()?!1:g==h&&e==c};d.prototype.yB=function(){for(var e=this.U,c=e.Yf?
3:2,g=0,h=e.ea();g<h;g++)if(e.Ha(g)<c)return this.Kd=new a.wd(1,g,0),!1;return!0};d.prototype.xB=function(e){for(var c=this.U,g=c.Ca(),h=c.hasAttribute(1),c=h?a.Ia.rB(this.sg,c,!1):0;g.kb();)for(;g.La();){var b=g.ia();if(!(b.$b()>this.Ri)){if(e&&h){var d=b.gt(1,0),b=b.gt(1,0);if(Math.abs(b-d)>c)continue}this.Kd=new a.wd(2,g.Jb(),-1);return!1}}return!0};d.prototype.OK=function(){var c=this.U,g=null;a.T.Kc(this.U.D())&&(g=this.U);var h=(this.GD||this.pk)&&null!=g,b=c.F();this.$e=c.mc(0);this.xh=new a.ga(0);
this.xh.xb(2*b);this.wh=new a.ga(0);this.wh.xb(2*b);h&&(null==this.Bk&&(this.Bk=new a.ga(0)),this.Bk.xb(b));for(var d=c=0;d<b;d++)if(this.xh.add(2*d),this.xh.add(2*d+1),this.wh.add(2*d),this.wh.add(2*d+1),h){for(;d>=g.Dc(c);)c++;this.Bk.add(c)}(new a.Rr).sort(this.wh,0,2*b,new n(this,h));this.Za.clear();this.Za.Hn(new e(this));this.Za.de(b);g=0;for(b*=2;g<b;g++)if(h=this.wh.get(g),c=this.xh.get(h),h=c>>1,0==(c&1)){c=this.Za.addElement(h,-1);d=this.Za.ge(c);if(-1!=d&&!this.Yy(this.Za.da(d),h))return this.Kd=
new a.wd(3,h,this.Za.da(d)),!1;var f=this.Za.bb(c);if(-1!=f&&!this.Yy(this.Za.da(f),h))return this.Kd=new a.wd(3,h,this.Za.da(f)),!1}else if(c=this.Za.search(h,-1),d=this.Za.ge(c),f=this.Za.bb(c),this.Za.kd(c,-1),-1!=d&&-1!=f&&!this.Yy(this.Za.da(d),this.Za.da(f)))return this.Kd=new a.wd(3,this.Za.da(d),this.Za.da(f)),!1;return!0};d.prototype.RK=function(){return 10>this.U.F()?this.PK():this.QK()};d.prototype.QK=function(){var e=new a.fd;e.Eb(this.U);var c=new a.wd;return a.Zu.DE(!1,e,this.Ri,c,this.oe)?
(c.Fk=e.gb(c.Fk),c.Gk=e.gb(c.Gk),this.Kd.aq(c),!1):!0};d.prototype.PK=function(){for(var e=this.U,c=e.Ca(),e=e.Ca();c.kb();)for(;c.La();){var g=c.ia();if(!c.Jm()||!c.YO()){e.xR(c);do for(;e.La();){var h=e.ia(),h=g.fq(h,this.Ri,!0);if(0!=h)return this.Kd=new a.wd(2==h?5:4,c.Jb(),e.Jb()),!1}while(e.kb())}}return!0};d.prototype.UK=function(){var e=this.U;this.$a.length=0;this.dn.length=0;this.Hf=e.Ca();this.Hf.NR();var c=new a.ga(0);c.xb(10);for(var g=NaN,h=0,b=0,e=2*e.F();b<e;b++){var d=this.wh.get(b),
d=this.xh.get(d);if(0==(d&1)){var d=d>>1,n=this.$e.read(2*d),f=this.$e.read(2*d+1);if(0!=c.size&&(n!=g||f!=h)){if(!this.TE(c))return!1;null!=c&&c.clear(!1)}c.add(d);g=n;h=f}}return this.TE(c)?!0:!1};d.prototype.TK=function(){for(var e=this.U,c=Array(e.ea()),g=0,h=e.ea();g<h;g++)c[g]=e.Oo(g);var h=new b,d,n,f,k=new a.b,g=this.wh.get(0),g=this.xh.get(g),m=g>>1;this.$e.ec(2*m,k);g=this.Bk.get(m);d=c[g];n=e.Ea(g);f=e.Dc(g)-1;h.ak=m==n||m==f;h.Ev=this.pk?!d&&h.ak:h.ak;h.Sh=g;h.x=k.x;h.y=k.y;h.yl=m;for(var y=
new b,p=1,r=this.wh.size;p<r;p++)if(g=this.wh.get(p),g=this.xh.get(g),0==(g&1)){m=g>>1;this.$e.ec(2*m,k);g=this.Bk.get(m);g!=h.Sh&&(d=c[g],n=e.Ea(g),f=e.Dc(g)-1);var u,v=m==n||m==f;u=this.pk?!d&&h.ak:h.ak;y.x=k.x;y.y=k.y;y.Sh=g;y.yl=m;y.Ev=u;y.ak=v;if(y.x==h.x&&y.y==h.y)if(this.pk){if(!y.Ev||!h.Ev)if(y.Sh!=h.Sh||!y.ak&&!h.ak)return this.Kd=new a.wd(8,y.yl,h.yl),!1}else if(!y.ak||!h.ak)return this.Kd=new a.wd(5,y.yl,h.yl),!1;g=h;h=y;y=g}return!0};d.prototype.AB=function(){for(var e=this.U,c=[],g=-1,
b=!1,d=0,n=e.ea();d<n;d++)e.qt(d)&&(b=!1,g++,d<n-1&&(e.qt(d+1)||(b=!0))),c[d]=b?g:-1;var b=new a.b,d=this.wh.get(0),d=this.xh.get(d),f=d>>1;this.$e.ec(2*f,b);for(var d=this.Bk.get(f),g=new h(b.x,b.y,d,f,c[d]),e=[],k=1,n=this.wh.size;k<n;k++)if(d=this.wh.get(k),d=this.xh.get(d),0==(d&1)){f=d>>1;this.$e.ec(2*f,b);d=this.Bk.get(f);d=new h(b.x,b.y,d,f,c[d]);if(d.x==g.x&&d.y==g.y){if(d.Sh==g.Sh)return this.Kd=new a.wd(9,d.yl,g.yl),!1;0<=c[d.Sh]&&c[d.Sh]==c[g.Sh]&&(0!=e.length&&e[e.length-1]==g||e.push(g),
e.push(d))}g=d}if(0==e.length)return!0;d=new a.$n(!0);a.I.Ps(c,-1);b=-1;k=new a.b;k.Eh();g=0;for(n=e.length;g<n;g++){f=e[g];if(f.x!=k.x||f.y!=k.y)b=d.jh(0),k.x=f.x,k.y=f.y;var m=c[f.Sh];-1==m&&(m=d.jh(2),c[f.Sh]=m);d.addElement(m,b);d.addElement(b,m)}n=new a.ga(0);n.xb(10);for(g=d.Wd;-1!=g;g=d.Cw(g))if(e=d.DC(g),0==(e&1)&&0!=(e&2)){e=-1;n.add(g);for(n.add(-1);0<n.size;){b=n.tc();n.af();k=n.tc();n.af();f=d.DC(k);if(0!=(f&1)){e=0==(f&2)?b:k;break}d.$R(k,f|1);for(f=d.gc(k);-1!=f;f=d.bb(f))m=d.getData(f),
m!=b&&(n.add(m),n.add(k))}if(-1!=e){d=-1;g=0;for(n=c.length;g<n;g++)if(c[g]==e){d=g;break}this.Kd=new a.wd(10,d,-1);return!1}}return!0};d.prototype.VK=function(){var e=this.U;if(0>=e.Mh())return this.Kd=new a.wd(6,1==e.ea()?1:-1,-1),0;if(1==e.ea())return this.pk&&!this.AB()?0:2;this.gn=a.ga.Yc(e.ea(),0);this.Hx=a.ga.Yc(e.ea(),-1);for(var c=-1,h=0,b=0,d=e.ea();b<d;b++){var n=e.oo(b);this.gn.write(b,0>n?0:256);if(0<n)c=b,h=n;else{if(0==n)return this.Kd=new a.wd(6,b,-1),0;if(0>c||h<Math.abs(n))if(this.Kd=
new a.wd(7,b,-1),this.pk)return 0;this.Hx.write(b,c)}}this.kr=e.ea();this.Ll=new a.ga(0);this.Ll.xb(10);d=e.F();this.wn=NaN;e=new a.ga(0);e.xb(10);this.yp=a.ga.Yc(d,-1);this.hu=a.ga.Yc(d,-1);null!=this.Hi?this.Hi.clear(!1):this.Hi=new a.ga(0);this.Hi.xb(10);this.Za.clear();this.Za.Hn(new g(this));c=0;for(d*=2;0<this.kr&&c<d;c++)if(h=this.wh.get(c),h=this.xh.get(h),0==(h&1)){h>>=1;b=this.$e.read(2*h+1);if(b!=this.wn&&0!=e.size){if(!this.yr(e))return 0;null!=e&&e.clear(!1)}e.add(h);this.wn=b}return 0<
this.kr&&!this.yr(e)?0:this.pk?0==this.Kd.yh&&this.AB()?2:0:0==this.Kd.yh?2:1};d.prototype.TE=function(e){if(1==e.size)return!0;for(var c=0,g=e.size;c<g;c++){var h=e.get(c);this.Hf.Sb(h);var b=this.Hf.oi();this.$a.push(this.Ls(b,h,this.Hf.Qa,!0));this.Hf.ia();b=this.Hf.ia();this.$a.push(this.Ls(b,h,this.Hf.Qa,!1))}var d=this;this.$a.sort(function(a,e){return d.sM(a,e)});h=this.Lg.Wd;-1==h&&(h=this.Lg.jh(0));this.Lg.$l(this.$a.length);c=0;for(g=this.$a.length;c<g;c++)this.Lg.addElement(h,c);for(var c=
!0,n=g=-1;c;){c=!1;b=this.Lg.gc(h);if(-1==b)break;for(var f=this.Lg.bb(b);-1!=f;){g=this.Lg.getData(b);n=this.Lg.getData(f);g=this.$a[g].tn;n=this.$a[n].tn;if(g==n)if(c=!0,this.Lg.Jc(h,b),b=this.Lg.ge(f),f=this.Lg.Jc(h,f),-1==f||-1==b)break;else continue;b=f;f=this.Lg.bb(b)}}c=this.Lg.vq(h);this.Lg.CB(h);if(0<c)return this.Kd=new a.wd(5,g,n),!1;c=0;for(g=e.size;c<g;c++)this.my(this.$a[c]);this.$a.length=0;return!0};d.prototype.yr=function(e){for(var c=0,g=e.size;c<g;c++){var h=e.get(c),b=this.yp.read(h);
if(-1!=b){var d=this.Za.da(b);this.Hi.add(d);this.Za.kd(b,-1);this.my(this.$a[d]);this.$a[d]=null;this.yp.write(h,-1)}b=this.hu.read(h);-1!=b&&(d=this.Za.da(b),this.Hi.add(d),this.Za.kd(b,-1),this.my(this.$a[d]),this.$a[d]=null,this.hu.write(h,-1))}c=0;for(g=e.size;c<g;c++){h=e.get(c);this.Hf.Sb(h);b=this.Hf.oi();if(b.ja>b.ha){var n=this.Hf.Jb(),f=this.Ls(b,h,this.Hf.Qa,!0);0<this.Hi.size?(d=this.Hi.tc(),this.Hi.af(),this.$a[d]=f):(d=this.$a.length,this.$a.push(f));b=this.Za.addElement(d,-1);-1==
this.yp.read(n)?this.yp.write(n,b):this.hu.write(n,b);0==(this.gn.read(this.Hf.Qa)&3)&&this.Ll.add(b)}this.Hf.ia();b=this.Hf.ia();b.ja<b.ha&&(n=this.Hf.Bm(),f=this.Ls(b,h,this.Hf.Qa,!1),0<this.Hi.size?(d=this.Hi.tc(),this.Hi.af(),this.$a[d]=f):(d=this.$a.length,this.$a.push(f)),b=this.Za.addElement(d,-1),-1==this.yp.read(n)?this.yp.write(n,b):this.hu.write(n,b),0==(this.gn.read(this.Hf.Qa)&3)&&this.Ll.add(b))}c=0;for(g=this.Ll.size;c<g&&0<this.kr;c++)if(b=this.Ll.get(c),0==(this.gn.read(this.$a[this.Za.da(b)].Gx)&
3)){e=-1;for(var h=this.Za.ge(b),k=b,f=null,d=-1,m=0;-1!=h;){d=this.Za.da(h);f=this.$a[d];d=f.Gx;m=this.gn.read(d);if(0!=(m&3))break;k=h;h=this.Za.ge(h)}-1==h?(n=1,h=k):(e=1==(m&3)?d:this.Hx.read(d),n=0!=f.LC()?0:1,h=this.Za.bb(h));do{d=this.Za.da(h);f=this.$a[d];d=f.Gx;k=this.gn.read(d);if(0==(k&3)){if(n!=f.LC())return this.Kd=new a.wd(6,d,-1),!1;m=0==n||f.sl()?2:1;k=k&252|m;this.gn.write(d,m);if(2==m&&0==this.Kd.yh&&this.Hx.read(d)!=e&&(this.Kd=new a.wd(7,d,-1),this.pk))return!1;this.kr--;if(0==
this.kr)return!0}1==(k&3)&&(e=d);k=h;h=this.Za.bb(h);n=0!=n?0:1}while(k!=b)}null!=this.Ll?this.Ll.clear(!1):this.Ll=new a.ga(0);return!0};d.prototype.Ls=function(e,c,g,h){if(322==e.D())e=this.PL(e);else throw a.g.wa();e.tn=c;e.Gx=g;e.hp=0;e.hS(h);return e};d.prototype.PL=function(e){var g;0<this.dn.length?(g=this.dn[this.dn.length-1],--this.dn.length,e.copyTo(g.Zd)):(g=new c,g.Zd=a.fA.Yj(e));return g};d.prototype.my=function(a){322==a.Zd.D()&&this.dn.push(a)};d.prototype.eQ=function(){for(var e=this.U.F(),
c=new a.ga(0),g=0;g<e;g++)c.add(g);var h=this;c.xd(0,e,function(a,e){return h.Is(a,e)});for(g=1;g<e;g++)if(0==this.Is(c.get(g-1),c.get(g)))return this.Kd=new a.wd(3,c.get(g-1),c.get(g)),0;return 2};d.prototype.NQ=function(){return this.yB()?this.xB(!0)?2:0:0};d.prototype.LQ=function(){return this.Yw()};d.prototype.fQ=function(){for(var e=this.U.F(),c=new a.ga(0),g=0;g<e;g++)c.add(g);var h=this;c.xd(0,e,function(a,e){return h.uL(a,e)});var b=Array(e);a.I.Ps(b,!1);b[c.get(0)]=!0;for(g=1;g<e;g++){var d=
c.get(g-1),n=c.get(g);0==this.Is(d,n)?b[n]=!1:b[n]=!0}for(var c=this.U.Pa(),d=this.U,n=0,f=1,g=0;g<e;g++)b[g]?f=g+1:(n<f&&c.Pd(d,n,f),n=g+1);n<f&&c.Pd(d,n,f);c.hg(2,this.pn);return c};d.prototype.OQ=function(){var e=this.U,c=e.Ca(),g=e.Ca(),h=this.U.Pa(),b=this.U,d=e.hasAttribute(1),n=d?a.Ia.rB(this.sg,e,!0):0,f=new a.ga(0),k=new a.ga(0);f.xb(a.I.truncate(e.F()/2+1));for(k.xb(a.I.truncate(e.F()/2+1));c.kb();)if(g.kb(),!(2>e.Ha(c.Qa))){g.zR();for(var m,y,p=!0;c.La();){var r=c.ia(),u=g.oi();if(c.Jb()>
g.Jb())break;p&&(f.add(c.Jb()),k.add(g.Bm()),p=!1);y=f.tc();var v=c.Bm();if(1<v-y){var A=new a.b;A.pc(e.Fa(y),e.Fa(v));m=A.length()}else m=r.$b();y=k.tc();v=g.Jb();1<v-y?(A=new a.b,A.pc(e.Fa(y),e.Fa(v)),y=A.length()):y=u.$b();m>this.pn?f.add(c.Bm()):d&&(m=e.ld(1,f.tc(),0),r=r.Ws(1,0),Math.abs(r-m)>n&&f.add(c.Bm()));y>this.pn?k.add(g.Jb()):d&&(m=e.ld(1,k.tc(),0),r=u.Ws(1,0),Math.abs(r-m)>n&&k.add(g.Jb()))}f.tc()<k.tc()?f.size>k.size?f.af():k.af():(f.tc()!=k.tc()&&k.af(),k.af());if(2<=k.size+f.size){p=
new a.Va;u=0;for(r=f.size;u<r;u++)b.Sd(f.get(u),p),0==u?h.df(p):h.lineTo(p);for(u=k.size-1;0<u;u--)b.Sd(k.get(u),p),h.lineTo(p);b.vc(c.Qa)?h.ro():0<k.size&&(b.Sd(k.get(0),p),h.lineTo(p))}null!=f&&f.clear(!1);null!=k&&k.clear(!1)}h.hg(2,this.pn);return h};d.prototype.MQ=function(){return this.xS()};d.prototype.xS=function(){if(1736==this.U.D()&&1==this.U.Cm())return a.Of.Qj(this.U,this.pn,!0,!1,this.oe);this.Zh=new a.fd;this.Zh.Eb(this.U);0!=this.Zh.pd&&(1!=this.yx&&a.aj.$(this.Zh,this.pn,this.oe,
!0),1736==this.U.D()&&a.mm.$(this.Zh,this.Zh.$c,this.yx,!1,this.oe));this.U=this.Zh.hf(this.Zh.$c);1736==this.U.D()&&(this.U.hl(),this.U.Pp(0));this.U.hg(2,this.pn);return this.U};d.ac=function(e,c,g){if(e.s())return 1;var h=e.D();if(33==h)return 1;if(197==h)return g=new a.i,e.o(g),g.mg(a.Ia.Cg(c,e,!1))?0:1;if(a.T.Lc(h))throw a.g.wa();if(!a.T.Th(h))throw a.g.wa();var h=a.Ia.Cg(c,e,!1),b=e.rj(h);g=g?-1:b;if(-1!=g)return g;1==g&&(h=0);g=(new d(e,c,g,0,!1)).Yw();e.hg(g,h);return g};d.Ro=function(e,c,
g,h,b){null!=h&&(h.yh=0,h.Fk=-1,h.Gk=-1);if(e.s())return 1;var n=e.D();if(33==n)return 1;var f=a.Ia.Cg(c,e,!1);if(197==n)return c=new a.i,e.o(c),c.mg(f)?(null!=h&&(h.yh=2,h.Fk=-1,h.Gk=-1),0):1;if(a.T.Lc(n))return f=new a.Xa(e.description),f.Bc(e,!0),d.Ro(f,c,g,h,b);b=e.rj(f);g=g?-1:b;if(-1!=g)return g;c=new d(e,c,g,0,!1);if(550==n)g=c.eQ();else if(1607==n)g=c.NQ();else if(1736==n)g=c.LQ();else throw a.g.wa();e.hg(g,f);null!=h&&0==g&&h.aq(c.Kd);return g};d.ob=function(e,c,g,h,b){null!=h&&(h.yh=0,h.Fk=
-1,h.Gk=-1);if(e.s())return 1;var n=e.D();if(33==n)return 1;var f=a.Ia.Cg(c,e,!1);if(197==n)return c=new a.i,e.o(c),c.mg(f)?(null!=h&&(h.yh=2,h.Fk=-1,h.Gk=-1),0):1;if(a.T.Lc(n))return n=new a.Xa(e.description),n.Bc(e,!0),d.Ro(n,c,g,h,b);e=new d(e,c,-1,0,!0);if(550==n||1607==n||1736==n)c=e.Yw();else throw a.g.wa();null!=h&&h.aq(e.Kd);return c};d.cG=function(e,c,g,h){if(e.s())return e;var b=e.D();if(33==b)return e;var n=a.Ia.Cg(c,e,!1);if(197==b)return c=new a.i,e.o(c),c.mg(n)?e.Pa():e;if(a.T.Lc(b))return b=
new a.Xa(e.description),b.Bc(e,!0),d.cG(b,c,g,h);h=e.rj(n);g=g?-1:h;if(2==g)return e;e=new d(e,c,g,0,!1);if(550==b)e=e.fQ();else if(1607==b)e=e.OQ();else if(1736==b)e=e.MQ();else throw a.g.wa();return e};d.Ry=function(e,c,g,h){if(e.s())return e;var b=e.D();if(33==b)return e;var n=a.Ia.Cg(c,e,!1);if(197==b)return c=new a.i,e.o(c),c.mg(n)?e.Pa():e;if(a.T.Lc(b))return n=new a.Xa(e.description),n.Bc(e,!0),d.Ry(n,c,g,h);if(!a.T.Th(b))throw a.g.ra("OGC simplify is not implemented for this geometry type "+
b);return a.Of.Ry(e,n,!1,h)};d.prototype.kj=function(e,c,g){if(e==c)return 0;e=this.xh.get(e);var h=this.xh.get(c);c=e>>1;var b=h>>1,d=new a.b,n=new a.b;this.$e.ec(2*c,d);d.y+=0!=(e&1)?this.Ri:-this.Ri;this.$e.ec(2*b,n);n.y+=0!=(h&1)?this.Ri:-this.Ri;e=d.compare(n);return 0==e&&g?(g=this.Bk.get(c)-this.Bk.get(b),0>g?-1:0<g?1:0):e};d.prototype.Is=function(e,c){if(e==c)return 0;var g=this.U,h=g.Fa(e),b=g.Fa(c);if(h.x<b.x)return-1;if(h.x>b.x)return 1;if(h.y<b.y)return-1;if(h.y>b.y)return 1;for(h=1;h<
this.wP;h++)for(var b=this.SD.Hd(h),d=a.pa.Wa(b),n=0;n<d;n++){var f=g.ld(b,e,n),k=g.ld(b,c,n);if(f<k)return-1;if(f>k)return 1}return 0};d.prototype.uL=function(a,e){var c=this.Is(a,e);return 0==c?a<e?-1:1:c};d.prototype.sM=function(a,e){if(a===e)return 0;var c=a.Zd.Pf(a.sl()?1:0);a.sl()&&c.Bp();a=e.Zd.Pf(e.sl()?1:0);e.sl()&&a.Bp();e=c.ps();var g=a.ps();return g==e?(e=c.Ai(a),Math.abs(e)<=8.881784197001252E-16*(Math.abs(a.x*c.y)+Math.abs(a.y*c.x))&&(e--,e++),0>e?1:0<e?-1:0):e<g?-1:1};return d}();a.cv=
d})(B||(B={}));(function(a){var c=function(c){function h(){c.apply(this,arguments)}D(h,c);h.prototype.D=function(){return 30};h.local=function(){null===h.V&&(h.V=new h);return h.V};h.prototype.$=function(e,c,h,b){return e instanceof a.T?(e=new a.Pc(e),c=new a.Pc(c),this.$(e,c,h,b).next()):new a.hI(e,c,h,b)};h.On=function(e,c,b,d){var g=e.fb(),n=c.fb();if(e.s()&&c.s())return g>n?e:c;if(e.s())return c;if(c.s())return e;var f=new a.i,k=new a.i,m=new a.i;e.o(f);c.o(k);m.K(f);m.Db(k);f=a.Ia.zd(b,m,!1);
k=e.D();m=c.D();return 33==k&&33==m?h.qP(e,c,f):k!=m?0<g||0<n?g>n?e:c:550==k?h.pA(e,c,f):h.pA(c,e,f):a.Of.On(e,c,b,d)};h.qP=function(e,c,h){h=h*Math.sqrt(2)*1.00001;h*=h;var g=e.w(),b=c.w(),d=new a.pe(e.description);a.b.Zb(g,b)>h&&(d.add(e),d.add(c));return d};h.pA=function(e,c,h){var g=e.mc(0),b=e.F(),d=c.w(),n=e.Pa();h=h*Math.sqrt(2)*1.00001;var f=new a.i;e.o(f);f.P(h,h);if(f.contains(d)){h*=h;for(var f=!1,k=[],m=0;m<b;m++)k[m]=!1;for(m=0;m<b;m++){var p=g.read(2*m),r=g.read(2*m+1),p=p-d.x,r=r-d.y;
p*p+r*r<=h&&(f=!0,k[m]=!0)}if(f)for(m=0;m<b;m++)k[m]||n.Pd(e,m,m+1);else n.Pd(e,0,b),n.add(c)}else n.Pd(e,0,b),n.add(c);return n};h.V=null;return h}(a.Me);a.dv=c})(B||(B={}));(function(a){var c=function(){function c(a,e,c,b){this.Fq=null==e;this.ua=-1;this.ne=a;this.cg=c;this.QP=e.next();this.Yb=b}c.prototype.next=function(){if(this.Fq)return null;var c;return null!=(c=this.ne.next())?(this.ua=this.ne.ya(),a.dv.On(c,this.QP,this.cg,this.Yb)):null};c.prototype.ya=function(){return this.ua};return c}();
a.hI=c})(B||(B={}));(function(a){var c=function(){function a(){}a.prototype.jt=function(){this.iw=null;this.Vu=-1;this.xG=!1};return a}(),b=function(){function a(){this.jq=0;this.Ci=[]}a.prototype.TJ=function(a){this.jq+=a.Vu;this.Ci.push(a)};a.prototype.PQ=function(){this.jq-=this.Ci[this.Ci.length-1].Vu;--this.Ci.length};a.prototype.Dv=function(){return this.Ci[this.Ci.length-1]};a.prototype.lc=function(a){return a===this};return a}(),h=function(){function e(a,e,c){this.ua=-1;this.Ec=!1;this.bE=
[!1,!1,!1,!1];this.ep=[0,0,0,0];this.ox=!1;this.Gj=-1;this.So=0;this.Tm=-1;this.rn=[];this.ne=a;this.cg=e;this.Yb=c}e.ac=function(a){var e=[],c;for(c in a)e.push(Number(c));e.sort(function(a,e){return a-e});return e};e.prototype.UC=function(c){var g=this.rn[c],h=e.ac(g)[0],b=g[h],d=b.Dv().iw,b=b.Dv().xG;delete g[h];b&&(d=a.as.local().$(d,this.cg,!1,this.Yb),0==c&&33==d.D()&&(c=new a.pe(d.description),d.s()||c.add(d),d=c));return d};e.prototype.next=function(){if(this.Ec&&this.Tm==this.Gj)return null;
for(;!this.FS(););if(-1==this.Gj)return null;if(this.ox){for(this.Tm++;;){if(this.Tm>this.Gj||0>this.Tm)throw a.g.wa();if(this.bE[this.Tm])break}this.ua++;return this.UC(this.Tm)}this.ua=0;this.Tm=this.Gj;return this.UC(this.Gj)};e.prototype.ya=function(){return this.ua};e.prototype.FS=function(){if(this.Ec)return!0;var e=null;null!=this.ne&&(e=this.ne.next(),null==e&&(this.Ec=!0,this.ne=null));if(null!=e){var c=e.fb();this.bE[c]=!0;c>=this.Gj&&!this.ox&&(this.SA(c,!1,e),c>this.Gj&&!this.ox&&this.vR(c))}if(0<
this.So)for(c=0;c<=this.Gj;c++)for(;1<this.ep[c];)if(e=this.jL(c),0!=e.length)e=a.Of.oM(e,this.cg,this.Yb),this.SA(c,!0,e);else break;return this.Ec};e.prototype.jL=function(a){for(var c=[],g=[],h=this.rn[a],b=e.ac(h),d=0;d<b.length;d++){var f=b[d],k=h[f];if(this.Ec||1E4<k.jq&&1<k.Ci.length){this.ep[a]-=k.Ci.length;for(this.So-=k.Ci.length;0<k.Ci.length;)c.push(k.Dv().iw),k.PQ();g.push(f)}}for(d=0;d<g.length;d++)delete h[g[d]];return c};e.prototype.vR=function(a){for(var e=0;e<a;e++)this.rn[e]=[],
this.So-=this.ep[e],this.ep[e]=0};e.prototype.SA=function(a,h,d){var g=new c;g.jt();g.iw=d;d=e.$g(d);g.Vu=d;d=e.Wf(d);if(a+1>this.rn.length)for(var n=0,f=Math.max(2,a+1);n<f;n++)this.rn.push([]);n=this.rn[a][d];void 0===n&&(n=new b,this.rn[a][d]=n);g.xG=h;n.TJ(g);this.ep[a]++;this.So++;this.Gj=Math.max(this.Gj,a)};e.Wf=function(e){return 0<e?a.I.truncate(Math.log(e)/Math.log(4)+.5):0};e.$g=function(e){var c=e.D();if(a.T.Th(c))return e.F();if(33==c)return 1;if(197==c)return 4;if(a.T.Lc(c))return 2;
throw a.g.wa();};return e}();a.jI=h})(B||(B={}));(function(a){var c=function(c){function h(){c.apply(this,arguments)}D(h,c);h.prototype.D=function(){return 1};h.prototype.$=function(e,c,h,b){return void 0===b?new a.jI(e,c,h):this.xM(e,c,h,b)};h.prototype.xM=function(e,c,h,b){e=new a.Pc([e,c]);return this.$(e,h,b).next()};h.local=function(){null===h.V&&(h.V=new h);return h.V};h.V=null;return h}(a.Me);a.wi=c})(B||(B={}));(function(a){var c;(function(a){a[a.nextPath=0]="nextPath";a[a.nextSegment=1]=
"nextSegment";a[a.iterate=2]="iterate"})(c||(c={}));c=function(){function c(c,e,g,b){this.dr=new a.i;this.LP=c;this.MP=e;this.Wo=b;this.hn=-1;this.qk=!1;var h=c.pb;null!=h&&(h=b?h.nn:h.Ab,null!=h&&(this.Ec=!1,this.ka=g,this.Ab=h,this.au=this.Ab.Re(),this.Xo=this.qk=!0,this.Hb=0,b?this.hn=e.ea():this.bd=e.Ca()));this.qk||(h=e.pb,null!=h&&(h=b?h.nn:h.Ab,null!=h&&(this.Ec=!1,this.ka=g,this.Ab=h,this.au=this.Ab.Re(),this.qk=!0,this.Xo=!1,this.Hb=0,b?this.hn=c.ea():this.bd=c.Ca())));this.qk||(this.th=
b?a.Ia.BN(c,e,g,1<=c.rj(0),1<=e.rj(0)):a.Ia.AN(c,e,g))}c.prototype.next=function(){if(this.qk){if(this.Ec)return!1;for(var c=!0;c;)switch(this.Hb){case 0:c=this.nQ();break;case 1:c=this.oQ();break;case 2:c=this.$w();break;default:throw a.g.ra("internal error");}return this.Ec?!1:!0}return null==this.th?!1:this.th.next()};c.prototype.jk=function(){return this.qk?this.Xo?this.Ab.da(this.Rq):this.Wo?this.hn:this.bd.Jb():this.th.jk(this.th.Ff)};c.prototype.ek=function(){return this.qk?this.Xo?this.Wo?
this.hn:this.bd.Jb():this.Ab.da(this.Rq):this.th.ek(this.th.mf)};c.prototype.Fw=function(){if(!this.Wo)throw a.g.ra("internal error");return this.qk?this.Xo?this.Ab.uC(this.Rq):this.dr:this.th.Fw(this.th.Ff)};c.prototype.jw=function(){if(!this.Wo)throw a.g.ra("internal error");return this.qk?this.Xo?this.dr:this.Ab.uC(this.Rq):this.th.jw(this.th.mf)};c.prototype.nQ=function(){if(!this.Wo){if(!this.bd.kb())return this.Ec=!0,!1;this.Hb=1;return!0}if(-1==--this.hn)return this.Ec=!0,!1;this.Xo?this.MP.Ti(this.hn,
this.dr):this.LP.Ti(this.hn,this.dr);this.au.Ch(this.dr,this.ka);this.Hb=2;return!0};c.prototype.oQ=function(){if(!this.bd.La())return this.Hb=0,!0;var a=this.bd.ia();this.au.Fn(a,this.ka);this.Hb=2;return!0};c.prototype.$w=function(){this.Rq=this.au.next();return-1==this.Rq?(this.Hb=this.Wo?0:1,!0):!1};return c}();a.cl=c})(B||(B={}));(function(a){a=a.kI||(a.kI={});a[a.enumClosed=1]="enumClosed";a[a.enumHasNonlinearSegments=2]="enumHasNonlinearSegments";a[a.enumOGCStartPolygon=4]="enumOGCStartPolygon";
a[a.enumCalcMask=4]="enumCalcMask"})(B||(B={}));(function(a){var c=function(){function c(){}c.Fb=function(h,e,g,b,d,f,k,m,p){var n=[0,0,0],y=[0,0,0],r=[0,0,0],u=[0,0,0,0],v=new a.ca(0),q=new a.ca(0),x=new a.ca(0);if(null!=k||null!=m||null!=p)if(a.j.Ih(e))a.zg.Fb(h,g,b,d,f,k,m,p);else{d=a.u.W(d);g=a.u.W(g);var A=a.u.W(d-g);if(a.j.S(b,f)&&(a.j.S(g,d)||a.j.S(a.j.H(b),1.570796326794897)))null!=k&&(k.l=0),null!=m&&(m.l=0),null!=p&&(p.l=0);else{if(a.j.S(b,-f)){if(a.j.S(a.j.H(b),1.570796326794897)){null!=
k&&(k.l=2*a.u.gg(h,e));null!=m&&(m.l=0<b?a.u.W(3.141592653589793-a.u.W(d)):a.u.W(d));null!=p&&(p.l=0<b?a.u.W(d):a.u.W(3.141592653589793-a.u.W(d)));return}a.j.S(a.j.H(A),3.141592653589793)&&(null!=k&&(k.l=2*a.u.gg(h,e)),null!=m&&(m.l=0),null!=p&&(p.l=0))}else{if(a.j.S(a.j.H(b),1.570796326794897)||a.j.S(a.j.H(f),1.570796326794897)){a.Xj.Fb(h,e,g,b,d,f,k,m,p);return}if(a.j.S(g,d)||a.j.S(a.j.H(A),3.141592653589793)){a.Xj.Fb(h,e,g,b,d,f,k,m,p);return}if(a.j.Vc(b)){a.Xj.Fb(h,e,g,b,d,f,k,m,p);return}}var D=
Math.sqrt(1-e);d=a.u.W(d-g);g=0;a.u.wm(e,b,g,v,q,x);n[0]=v.l;n[1]=q.l;n[2]=x.l;a.u.wm(e,f,d,v,q,x);y[0]=v.l;y[1]=q.l;y[2]=x.l;r[0]=0;r[1]=0;r[2]=-1*e*a.u.n(1,e,b)*Math.sin(b);0>d?a.u.Ep(r,y,n,u,0):a.u.Ep(r,n,y,u,0);for(var q=[0,0,0],x=[0,0,0],B=[0,0,0],n=[0,0,0],v=[0,0,0],t=Math.acos(u[2]/1),z=1-e,F=Math.tan(t),C=1+F*F/z,l=2*r[2]*F/z,F=Math.sqrt(l*l-4*C*(r[2]*r[2]/z-1)),C=2*C,z=(-l+F)/C,l=(-l-F)/C,F=Math.tan(t),C=F*z+r[2],t=(z+l)/2,r=(C+(F*l+r[2]))/2,F=a.u.Sn(z-t,C-r),z=r/D*1.570796326794897,l=0;100>
l;l++){C=a.u.Tk(e,z);C=C*C/Math.cos(z)*(Math.sin(z)-r*C/(1*(1-e)));if(a.j.Vc(C))break;z-=C}var r=a.u.n(1,e,z)*Math.cos(z),r=Math.sqrt((r-t)*(r+t)),F=1-F/r,F=F*(2-F),C=a.u.jm(q),t=a.u.jm(x),z=a.u.jm(B),E=a.u.Qr(B,q),l=a.u.Qr(B,x);a.u.Uu(B,q,n);a.u.Uu(B,x,v);q=Math.acos(E/(z*C));x=Math.acos(l/(z*t));x*=a.j.nb(1,a.u.Qr(n,v));if(1.570796326794897<=a.j.H(q)&&1.570796326794897<=a.j.H(x)||3.141592653589793<a.j.H(q-x))q=(3.141592653589793-a.j.H(q))*a.j.nb(1,q),x=(3.141592653589793-a.j.H(x))*a.j.nb(1,x);n=
a.u.Si(F,x);v=a.u.q(r,F,a.u.Si(F,q));n=a.u.q(r,F,n);n=a.j.H(n-v)*h;q=new a.ca(0);x=new a.ca(0);B=u[1]/1;B*=-a.j.nb(1,A);v=Math.acos(B)*a.j.nb(1,A);c.gf(h,e,g,b,n,v,q,x);a.j.S(d,q.l)&&a.j.S(f,x.l)||(F=a.u.Sn(a.u.W(d-q.l),f-x.l),c.gf(h,e,g,b,n,a.u.W(v+3.141592653589793),q,x),C=a.u.Sn(a.u.W(d-q.l),f-x.l),C<F&&(v=a.u.W(v+3.141592653589793)));q=[0,0,0,0];x=[0,0,0,0];r=[0,0,0];F=[0,0,0];h=[0,0,0];g=[0,0,0];b=[0,0,0];B=[0,0,0];r[0]=0;r[1]=0;r[2]=D;F[0]=0;F[1]=0;F[2]=0;a.u.Ep(F,r,y,q,0);a.j.Vc(f)?(h[0]=y[0],
h[1]=y[1],h[2]=1,g[0]=1*Math.cos(d)-1*Math.sin(d),g[1]=1*Math.sin(d)+1*Math.cos(d)):(e=a.u.n(1,e,f)*Math.cos(f),h[0]=0,h[1]=0,y[2]+=Math.tan(1.570796326794897-a.j.H(f))*e*a.j.nb(1,f),g[0]=e*Math.cos(d)-e*Math.sin(d),g[1]=e*Math.sin(d)+e*Math.cos(d));g[2]=y[2];a.u.Ep(y,g,h,x,1);a.u.Uu(x,q,b);a.u.Uu(x,u,B);B=a.u.Qr(b,B)/(a.u.jm(b)*a.u.jm(B));B*=a.j.nb(1,A);d=Math.acos(B)*-a.j.nb(1,A);0<v&&0<d?d=a.u.W(d+3.141592653589793):0>v&&0>d&&(d=a.u.W(d+3.141592653589793));null!=k&&(k.l=n);null!=m&&(m.l=v);null!=
p&&(p.l=d)}}};c.gf=function(c,e,g,b,d,f,k,m){var h=[0,0,0],n=[0,0,0],p=[0,0,0],y=[0,0,0],r=[0,0,0],u=[0,0,0],v=[0,0,0],q=[0,0,0,0],x=new a.ca(0),A=new a.ca(0),D=new a.ca(0),B=new a.ca(0),t=new a.ca(0),z=new a.ca(0);if(null!=k&&null!=m)if(a.j.Ih(e))a.zg.gf(c,g,b,d,f,k,m);else if(a.j.Vc(d))null!=k&&(k.l=g),null!=m&&(m.l=b);else if(f=a.u.W(f),0>d&&(d=a.j.H(d),f=a.u.W(f+3.141592653589793)),g=a.u.W(g),b=a.u.W(b),1.570796326794897<a.j.H(b)&&(g=a.u.W(g+3.141592653589793),b=a.j.nb(3.141592653589793,b)-b),
a.j.S(a.j.H(b),1.570796326794897)||a.j.Vc(b)||a.j.Vc(f)||a.j.S(a.j.H(f),3.141592653589793))a.Xj.gf(c,e,g,b,d,f,k,m);else{var F=Math.sqrt(1-e);c=d/c;a.u.wm(e,b,0,B,t,z);h[0]=B.l;h[1]=t.l;h[2]=t.l;v[0]=0;v[1]=0;v[2]=-1*e*a.u.n(1,e,b)*Math.sin(b);B=a.u.n(1,e,b);t=a.u.W(1.570796326794897-f);z=Math.sin(t);d=Math.cos(b);b=Math.sin(b);r[0]=B*d-b*z;r[1]=Math.cos(t);r[2]=(1-e)*B*b+d*z;0>f?a.u.Ep(v,r,h,q,0):a.u.Ep(v,h,r,q,0);h=Math.acos(q[2]/1);q=Math.atan2(-q[1],-q[0]);b=1-e;r=Math.tan(h);t=1+r*r/b;B=2*v[2]*
r/b;r=Math.sqrt(B*B-4*t*(v[2]*v[2]/b-1));t*=2;b=(-B+r)/t;B=(-B-r)/t;r=Math.tan(h);t=r*b+v[2];h=(b+B)/2;v=(t+(r*B+v[2]))/2;r=a.u.Sn(b-h,t-v);F=v/F*1.570796326794897;for(b=0;100>b;b++){B=a.u.Tk(e,F);B=B*B/Math.cos(F)*(Math.sin(F)-v*B/(1*(1-e)));if(a.j.Vc(B))break;F-=B}F=a.u.n(1,e,F)*Math.cos(F);F=Math.sqrt((F-h)*(F+h));v=1-r/F;v*=2-v;u=Math.acos(a.u.Qr(u,n)/(a.u.jm(u)*a.u.jm(n)));u*=a.j.nb(1,n[0]);f=(a.u.q(F,v,a.u.Si(v,u))+c*a.j.nb(1,f))/a.u.gg(F,v);f=a.u.W(1.570796326794897*f);f=a.u.xn(v,f);a.u.n(F,
v,f);r=a.u.W(q+g);g=Math.cos(r);f=Math.sin(r);p[0]=y[0]*g+y[1]*-f;p[1]=y[0]*f+y[1]*g;p[2]=y[2];a.u.JK(e,p[0],p[1],p[2],D,A,x);null!=k&&(k.l=A.l);null!=m&&(m.l=D.l)}};return c}();a.$z=c})(B||(B={}));(function(a){var c=function(){function e(e){this.Na=null;this.Ar=new a.b;this.Br=new a.b;this.a=e}e.prototype.compare=function(a,e,c){this.a.uc(e,this.Ar);this.a.uc(a.da(c),this.Br);return this.Ar.compare(this.Br)};return e}(),b=function(){function e(e){this.nf=new a.b;this.ln=new a.b;this.a=e}e.prototype.bh=
function(a){this.nf.J(a)};e.prototype.compare=function(a,e){this.a.uc(a.da(e),this.ln);return this.nf.compare(this.ln)};return e}(),h=function(a){function e(e){a.call(this,e.a,e.ka,!1);this.ab=e}D(e,a);e.prototype.compare=function(a,e,c){if(this.Zf)return-1;var g=this.ab.Cd.Dm(this.ab.lh(e));a=a.da(c);var h=this.ab.Cd.Dm(this.ab.lh(a));this.Cl=c;return this.JB(e,g,a,h)};return e}(a.hA),e=function(a){function e(e){a.call(this,e.a,e.ka);this.ab=e}D(e,a);e.prototype.compare=function(a,e){if(this.Zf)return-1;
a=this.ab.Cd.Dm(this.ab.lh(a.da(e)));this.Cl=e;return this.KB(e,a)};return e}(a.JI),g=function(){function g(){this.zc=this.Ue=this.Zm=this.Cd=this.Kg=this.nd=this.$a=this.a=null;this.og=!1;this.Xg=this.Kl=this.Vd=this.Lj=this.Mg=this.Hj=this.sf=this.Ld=null;this.Yg=this.rp=this.Tx=this.ka=0;this.Ht=this.Nm=!1;this.mn=new a.b;this.Ck=new a.b;this.$a=new a.Fc(8);this.nd=new a.Fc(5);this.Kg=new a.Ur;this.Cd=new a.Ur;this.og=!1;this.Xg=new a.b;this.Xg.ma(0,0);this.ka=0;this.Yg=-1;this.Nm=!1;this.a=null;
this.Ue=new a.bj;this.zc=new a.bj;this.Mg=new a.ga(0);this.Lj=new a.gA;this.sf=new a.ga(0);this.Hj=new a.ga(0);this.Zm=new a.Va}g.prototype.GS=function(e,c){var g=new a.Bg;g.Oy();e.Oe(g);this.Op(e);this.Nm=!1;this.ka=c;this.Tx=c*c;c=this.Xy();e.Oe(g);c||(this.JM(),c||this.Xy());-1!=this.Yg&&(this.a.bf(this.Yg),this.Yg=-1);this.a=null;return this.Nm};g.prototype.KS=function(a,e){this.Op(a);this.Nm=!1;this.ka=e;this.Tx=e*e;this.og=!1;this.Xy();this.og||(this.og=1==a.xo(e,!0,!1));-1!=this.Yg&&(this.a.bf(this.Yg),
this.Yg=-1);this.a=null};g.prototype.Uf=function(a,e){return this.$a.O(a,0+e)};g.prototype.zy=function(a,e,c){this.$a.L(a,0+e,c)};g.prototype.lh=function(a){return this.$a.O(a,2)};g.prototype.UR=function(a,e){this.$a.L(a,2,e)};g.prototype.FC=function(a,e){return this.$a.O(a,3+e)};g.prototype.Eo=function(a){return this.$a.O(a,7)};g.prototype.Nk=function(a,e){this.$a.L(a,7,e)};g.prototype.Go=function(a,e){return this.$a.O(a,3+this.Do(a,e))};g.prototype.Qp=function(a,e,c){this.$a.L(a,3+this.Do(a,e),
c)};g.prototype.ZN=function(a,e){return this.$a.O(a,5+this.Do(a,e))};g.prototype.Sp=function(a,e,c){this.$a.L(a,5+this.Do(a,e),c)};g.prototype.rq=function(a){return this.nd.O(a,0)};g.prototype.RR=function(a,e){this.nd.L(a,0,e)};g.prototype.ow=function(a){return this.nd.O(a,4)};g.prototype.Lp=function(a,e){this.nd.L(a,4,e)};g.prototype.fk=function(a){return this.nd.O(a,1)};g.prototype.dm=function(a,e){this.nd.L(a,1,e)};g.prototype.nw=function(a){return this.nd.O(a,3)};g.prototype.Hr=function(a,e){this.nd.L(a,
3,e)};g.prototype.Ul=function(a){var e=this.nd.be(),c=this.Kg.jh();this.RR(e,c);-1!=a?(this.Kg.addElement(c,a),this.a.lb(a,this.Yg,e),this.Lp(e,this.a.gb(a))):this.Lp(e,-1);return e};g.prototype.aM=function(a){this.nd.Jc(a)};g.prototype.QA=function(a,e){this.Kg.addElement(this.rq(a),e);this.a.lb(e,this.Yg,a)};g.prototype.rr=function(a){var e=this.$a.be(),c=this.Cd.jh();this.UR(e,c);-1!=a&&this.Cd.addElement(c,a);return e};g.prototype.RA=function(a,e){this.Cd.addElement(this.lh(a),e)};g.prototype.Ns=
function(a){this.$a.Jc(a);a=this.Mg.Qs(a);0<=a&&this.Mg.QE(a)};g.prototype.yi=function(e,c){if(-1==this.Uf(e,0))this.zy(e,0,c);else if(-1==this.Uf(e,1))this.zy(e,1,c);else throw a.g.wa();this.Av(e,c)};g.prototype.Av=function(a,e){var c=this.fk(e);if(-1!=c){var g=this.Go(c,e);this.Sp(g,e,a);this.Qp(a,e,g);this.Qp(c,e,a);this.Sp(a,e,c)}else this.Sp(a,e,a),this.Qp(a,e,a),this.dm(e,a)};g.prototype.Do=function(a,e){return this.Uf(a,0)==e?0:1};g.prototype.Tl=function(a,e){var c=this.nw(e);-1!=c&&(this.Ue.kd(c,
-1),this.Hr(e,-1));var g,c=this.fk(e);if(-1!=c){var h=g=c,b;do{b=!1;var d=this.Do(g,e),n=this.FC(g,d);if(this.Uf(g,d+1&1)==a){this.Os(g);this.Cd.Fg(this.lh(g));this.Ns(g);if(g==n){c=-1;break}c==g&&(c=this.fk(e),h=n,b=!0)}g=n}while(g!=h||b);if(-1!=c){do d=this.Do(g,e),n=this.FC(g,d),this.zy(g,d,a),g=n;while(g!=h);g=this.fk(a);-1!=g?(h=this.Go(g,a),b=this.Go(c,a),h==g?(this.dm(a,c),this.Av(g,a),this.dm(a,g)):b==c&&this.Av(c,a),this.Qp(c,a,h),this.Sp(h,a,c),this.Qp(g,a,b),this.Sp(b,a,g)):this.dm(a,c)}}c=
this.rq(a);g=this.rq(e);for(h=this.Kg.gc(g);-1!=h;h=this.Kg.bb(h))this.a.lb(this.Kg.da(h),this.Yg,a);this.Kg.Qv(c,g);this.aM(e)};g.prototype.YP=function(a,e){var c=this.Uf(a,0),g=this.Uf(a,1),h=this.Uf(e,0),b=this.Uf(e,1);this.Cd.Qv(this.lh(a),this.lh(e));e==this.fk(c)&&this.dm(c,a);e==this.fk(g)&&this.dm(g,a);this.Os(e);this.Ns(e);c==h&&g==b||g==h&&c==b||(this.zm(c,this.mn),this.zm(h,this.Ck),this.mn.ub(this.Ck)?(c!=h&&this.Tl(c,h),g!=b&&this.Tl(g,b)):(g!=h&&this.Tl(g,h),c!=b&&this.Tl(c,b)))};g.prototype.Os=
function(a){var e=this.Uf(a,1);this.SB(a,this.Uf(a,0));this.SB(a,e)};g.prototype.SB=function(a,e){var c=this.Go(a,e),g=this.ZN(a,e),h=this.fk(e);c!=a?(this.Qp(g,e,c),this.Sp(c,e,g),h==a&&this.dm(e,c)):this.dm(e,-1)};g.prototype.YA=function(a,e,c){var g=this.Cd.gc(a),h=this.Cd.da(g);a=this.se(h);var b=this.se(this.a.X(h));this.a.Tp(h,e,c,!0);for(g=this.Cd.bb(g);-1!=g;g=this.Cd.bb(g)){var h=this.Cd.da(g),d=this.se(h)==a;this.a.Tp(h,e,c,d)}g=e.Io(c,0).Mb();e=e.Io(c,e.kk(c)-1).oc();this.yG(a,g);this.yG(b,
e)};g.prototype.PB=function(a,e,c){var g=this.lh(a),h=this.Uf(a,0),b=this.Uf(a,1),d=this.rr(-1);this.Mg.add(d);this.Nk(d,-3);this.sf.add(d);this.yi(d,h);a=1;for(e=e.kk(c);a<e;a++)c=this.Ul(-1),this.Hj.add(c),this.sf.add(c),this.yi(d,c),d=this.rr(-1),this.Mg.add(d),this.Nk(d,-3),this.sf.add(d),this.yi(d,c);this.yi(d,b);for(g=this.Cd.gc(g);-1!=g;g=this.Cd.bb(g))if(b=this.Cd.da(g),this.se(b)==h){a=0;do 0<a&&(d=this.sf.get(a-1),this.QA(d,b),-1==this.ow(d)&&this.Lp(d,this.a.gb(b))),d=this.sf.get(a),a+=
2,this.RA(d,b),b=this.a.X(b);while(a<this.sf.size)}else{a=this.sf.size-1;do a<this.sf.size-2&&(d=this.sf.get(a+1),this.QA(d,b),0>this.ow(d)&&this.Lp(d,this.a.gb(b))),d=this.sf.get(a),a-=2,this.RA(d,b),b=this.a.X(b);while(0<=a)}this.sf.clear(!1)};g.prototype.se=function(a){return this.a.Ra(a,this.Yg)};g.prototype.UE=function(e,c,g){var h=this.Uf(c,0),b=new a.b;this.zm(h,b);var d=new a.b,n=this.Uf(c,1);this.zm(n,d);var f=g.kk(e),k=g.Io(e,0),m=new a.b;k.ht(m);if(!b.ub(m)){if(!this.og){var p=b.compare(this.Xg),
m=m.compare(this.Xg);0>p*m&&(this.og=!0)}this.lC(h,this.sf);this.Hj.add(h)}!this.og&&1<f&&(p=b.compare(d),k=k.oc(),b.compare(k)!=p||k.compare(d)!=p?this.og=!0:0>k.compare(this.Xg)&&(this.og=!0));k=g.Io(e,f-1);e=k.oc();d.ub(e)||(this.og||(p=d.compare(this.Xg),m=e.compare(this.Xg),0>p*m&&(this.og=!0)),this.lC(n,this.sf),this.Hj.add(n));this.sf.add(c);d=0;for(n=this.sf.size;d<n;d++)e=this.sf.get(d),g=this.Eo(e),a.Fc.Zw(g)&&(this.zc.kd(g,-1),this.Nk(e,-1)),e!=c&&-3!=this.Eo(e)&&(this.Mg.add(e),this.Nk(e,
-3));this.sf.clear(!1)};g.prototype.NK=function(a,e){this.Ld.compare(this.zc,this.zc.da(a),e);this.Ld.Zf&&(this.Ld.lq(),this.dC(a,e))};g.prototype.dC=function(e,c){this.Nm=!0;e=this.zc.da(e);c=this.zc.da(c);var g,h;h=this.Cd.Dm(this.lh(e));var b=this.Cd.Dm(this.lh(c));g=this.a.cc(h);null==g&&(null==this.Vd&&(this.Vd=new a.yb),this.a.Oc(h,this.Vd),g=this.Vd);h=this.a.cc(b);null==h&&(null==this.Kl&&(this.Kl=new a.yb),this.a.Oc(b,this.Kl),h=this.Kl);this.Lj.zn(g);this.Lj.zn(h);this.Lj.Ga(this.ka,!0)&&
(this.og=!0);this.fG(e,c,-1,this.Lj);this.Lj.clear()};g.prototype.VM=function(e,c){this.Nm=!0;c=this.zc.da(c);var g,h=this.Cd.Dm(this.lh(c));g=this.a.cc(h);null==g&&(null==this.Vd&&(this.Vd=new a.yb),this.a.Oc(h,this.Vd),g=this.Vd);h=this.qC(e);this.Lj.zn(g);this.a.Jk(h,this.Zm);this.Lj.Tw(this.ka,this.Zm,!0);this.fG(c,-1,e,this.Lj);this.Lj.clear()};g.prototype.DO=function(){if(0!=this.Mg.size)for(;0!=this.Mg.size;){if(this.Mg.size>Math.max(100,this.a.pd)){this.Mg.clear(!1);this.og=!0;break}var a=
this.Mg.tc();this.Mg.af();this.Nk(a,-1);-1!=this.TO(a)&&this.CO(a);this.Mm=!1}};g.prototype.CO=function(a){var e;this.Mm?(e=this.zc.vs(this.lE,this.iE,a,!0),this.Mm=!1):e=this.zc.PA(a);-1==e?this.YP(this.zc.da(this.zc.tC()),a):(this.Nk(a,e),this.Ld.Zf&&(this.Ld.lq(),this.dC(this.Ld.Cl,e)))};g.prototype.TO=function(e){var c=this.Uf(e,0);e=this.Uf(e,1);this.zm(c,this.mn);this.zm(e,this.Ck);if(a.b.Zb(this.mn,this.Ck)<=this.Tx)return this.og=!0,-1;var g=this.mn.compare(this.Xg),h=this.Ck.compare(this.Xg);
return 0>=g&&0<h?e:0>=h&&0<g?c:-1};g.prototype.HM=function(){var e=new a.ga(0);e.xb(this.a.pd);for(var c=this.a.Gp(),g=c.next();-1!=g;g=c.next())-1!=this.a.Ra(g,this.Yg)&&e.add(g);this.a.Mu(e,e.size);this.IM(e)};g.prototype.IM=function(e){this.Ue.clear();this.Ue.de(e.size);this.Ue.Hn(new c(this.a));var g=new a.b;g.Eh();for(var h=-1,b=new a.b,d=0,n=e.size;d<n;d++){var f=e.get(d);this.a.uc(f,b);b.ub(g)?(f=this.a.Ra(f,this.Yg),this.Tl(h,f)):(h=this.se(f),this.a.uc(f,g),f=this.Ue.qm(f),this.Hr(h,f))}};
g.prototype.JM=function(){var e=new a.ga(0);e.xb(this.a.pd);for(var c=this.Ue.gc(-1);-1!=c;c=this.Ue.bb(c))e.add(this.Ue.da(c));this.Ue.clear();this.a.Mu(e,e.size);for(var c=0,g=e.size;c<g;c++){var h=e.get(c),b=this.se(h),h=this.Ue.qm(h);this.Hr(b,h)}};g.prototype.lC=function(e,c){var g=this.fk(e);if(-1!=g){var h=g;do a.Fc.Zw(this.Eo(h))&&c.add(h),h=this.Go(h,e);while(h!=g)}};g.prototype.yG=function(a,e){for(a=this.Kg.gc(this.rq(a));-1!=a;a=this.Kg.bb(a))this.a.Yi(this.Kg.da(a),e)};g.prototype.fG=
function(a,e,c,g){this.Os(a);-1!=e&&this.Os(e);this.UE(0,a,g);-1!=e&&this.UE(1,e,g);-1!=c&&(g.nf.w(this.mn),this.zm(c,this.Ck),this.Ck.ub(this.mn)||this.Hj.add(c));c=0;for(var h=this.Hj.size;c<h;c++){var b=this.Hj.get(c),d=this.nw(b);-1!=d&&(this.Ue.kd(d,-1),this.Hr(b,-1))}c=this.lh(a);h=-1!=e?this.lh(e):-1;this.YA(c,g,0);-1!=e&&this.YA(h,g,1);this.PB(a,g,0);-1!=e&&this.PB(e,g,1);this.Cd.Fg(c);this.Ns(a);-1!=e&&(this.Cd.Fg(h),this.Ns(e));c=0;for(h=this.Hj.size;c<h;c++)b=this.Hj.get(c),b==this.rp&&
(this.Ht=!0),d=this.nw(b),-1==d&&(d=this.Ue.PA(this.qC(b)),-1==d?(a=this.se(this.Ue.da(this.Ue.tC())),this.Tl(a,b)):this.Hr(b,d));this.Hj.clear(!1)};g.prototype.zm=function(a,e){this.a.SC(this.ow(a),e)};g.prototype.qC=function(a){return this.Kg.Dm(this.rq(a))};g.prototype.Xy=function(){this.Ht=!1;this.rp=-1;null==this.Ld&&(this.zc.Ct=!1,this.Ld=new h(this),this.zc.Qm=this.Ld);var c=new a.ga(0),g=null,d=null,n=0;this.iE=this.lE=-1;this.Mm=!1;for(var f=this.Ue.gc(-1);-1!=f;){n++;this.Mm=!1;var k=this.Ue.da(f);
this.rp=this.se(k);this.a.uc(k,this.Xg);this.Ld.XF(this.Xg.y,this.Xg.x);var m,p=this.fk(this.rp);m=-1==p;if(!m){k=p;do{var r=this.Eo(k);-1==r?(this.Mg.add(k),this.Nk(k,-3)):-3!=r&&c.add(r);k=this.Go(k,this.rp)}while(k!=p)}if(0<c.size){this.Mm=1==c.size&&1==this.Mg.size;m=0;for(p=c.size;m<p;m++)k=this.zc.da(c.get(m)),this.Nk(k,-2);var u=-2,v=-2;m=0;for(p=c.size;m<p;m++){r=c.get(m);if(-2==u){var q=this.zc.ge(r);-1!=q?(k=this.zc.da(q),k=this.Eo(k),-2!=k&&(u=q)):u=-1}-2==v&&(r=this.zc.bb(r),-1!=r?(k=
this.zc.da(r),k=this.Eo(k),-2!=k&&(v=r)):v=-1);if(-2!=u&&-2!=v)break}m=0;for(p=c.size;m<p;m++)r=c.get(m),k=this.zc.da(r),this.zc.kd(r,-1),this.Nk(k,-1);c.clear(!1);this.lE=-1!=u?u:-1;this.iE=-1!=v?v:-1;-1!=u&&-1!=v?this.Mm||this.NK(u,v):-1==u&&-1==v&&(this.Mm=!1)}else m&&(null==g&&(g=new e(this)),g.bh(this.Xg),this.zc.sF(g),g.Zf&&(g.lq(),this.VM(this.rp,g.Cl)));this.DO();this.Ht?(this.Ht=!1,null==d&&(d=new b(this.a)),d.bh(this.Xg),f=this.Ue.sF(d)):f=this.Ue.bb(f)}return this.Nm};g.prototype.Op=function(e){this.a=
e;this.Yg=this.a.re();this.$a.de(e.pd+32);this.nd.de(e.pd);this.Kg.Dr(e.pd);this.Kg.$l(e.pd);this.Cd.Dr(e.pd+32);this.Cd.$l(e.pd+32);for(e=this.a.$c;-1!=e;e=this.a.we(e))if(a.T.Kc(this.a.Lb(e)))for(f=this.a.Vb(e);-1!=f;f=this.a.bc(f)){var c=this.a.Ha(f),g=this.a.Cb(f),h=this.Ul(g),b=this.rr(g);this.yi(b,h);k=this.a.X(g);g=0;for(c-=2;g<c;g++){var d=this.a.X(k),n=this.Ul(k);this.yi(b,n);b=this.rr(k);this.yi(b,n);k=d}this.a.vc(f)?(n=this.Ul(k),this.yi(b,n),b=this.rr(k),this.yi(b,n),this.yi(b,h)):(n=
this.Ul(k),this.yi(b,n))}else for(var f=this.a.Vb(e);-1!=f;f=this.a.bc(f))for(var k=this.a.Cb(f),h=0,c=this.a.Ha(f);h<c;h++)this.Ul(k),k=this.a.X(k);this.HM()};return g}();a.aA=g})(B||(B={}));(function(a){var c=function(c){function h(e,g,h){c.call(this);if(void 0!==e)if(void 0!==h){this.description=a.Od.Tf();var b=new a.ee;b.K(e,g,h);this.Py(b)}else if(void 0!==g)this.description=a.Od.Tf(),this.ic(e,g);else if(e instanceof a.pa)this.description=e;else if(e instanceof a.b)this.description=a.Od.Tf(),
this.ic(e);else throw a.g.N();else this.description=a.Od.Tf()}D(h,c);h.prototype.w=function(e){if(void 0!==e){if(this.sc())throw a.g.ra("This operation should not be performed on an empty geometry.");e.ma(this.fa[0],this.fa[1])}else{if(this.sc())throw a.g.ra("This operation should not be performed on an empty geometry.");e=new a.b;e.ma(this.fa[0],this.fa[1]);return e}};h.prototype.ic=function(a,c){"number"===typeof a?(this.qc(),null==this.fa&&this.ko(),this.fa[0]=a,this.fa[1]=c):(this.qc(),this.ic(a.x,
a.y))};h.prototype.Lw=function(){if(this.sc())throw a.g.ra("This operation should not be performed on an empty geometry.");var e=new a.ee;e.x=this.fa[0];e.y=this.fa[1];this.description.WC()?e.z=this.fa[2]:e.z=a.pa.ue(1);return e};h.prototype.Py=function(e){this.qc();var c=this.hasAttribute(1);c||a.pa.nD(1,e.z)||(this.Ne(1),c=!0);null==this.fa&&this.ko();this.fa[0]=e.x;this.fa[1]=e.y;c&&(this.fa[2]=e.z)};h.prototype.lk=function(){if(this.sc())throw a.g.ra("This operation should not be performed on an empty geometry.");
return this.fa[0]};h.prototype.qS=function(a){this.setAttribute(0,0,a)};h.prototype.mk=function(){if(this.sc())throw a.g.ra("This operation should not be performed on an empty geometry.");return this.fa[1]};h.prototype.$F=function(a){this.setAttribute(0,1,a)};h.prototype.lO=function(){return this.ld(1,0)};h.prototype.rS=function(a){this.setAttribute(1,0,a)};h.prototype.NN=function(){return this.ld(2,0)};h.prototype.bS=function(a){this.setAttribute(2,0,a)};h.prototype.Qc=function(){return this.nC(3,
0)};h.prototype.ld=function(e,c){var g=this.description.zf(e);return 0<=g?this.fa[this.description.fj(g)+c]:a.pa.ue(e)};h.prototype.nC=function(e,c){var g=this.description.zf(e);return 0<=g?this.fa[this.description.fj(g)+c]:a.pa.ue(e)};h.prototype.setAttribute=function(a,c,h){this.qc();var e=this.description.zf(a);0>e&&(this.Ne(a),e=this.description.zf(a));null==this.fa&&this.ko();this.fa[this.description.fj(e)+c]=h};h.prototype.D=function(){return 33};h.prototype.fb=function(){return 0};h.prototype.Ja=
function(){this.qc();null!=this.fa&&(this.fa[0]=NaN,this.fa[1]=NaN)};h.prototype.nm=function(e){if(null!=this.fa){for(var c=a.Od.iu(e,this.description),h=[],b=0,d=0,f=e.Aa;d<f;d++){var k=e.Hd(d),m=a.pa.Wa(k);if(-1==c[d])for(var p=a.pa.ue(k),k=0;k<m;k++)h[b]=p,b++;else for(p=this.description.fj(c[d]),k=0;k<m;k++)h[b]=this.fa[p],b++,p++}this.fa=h}this.description=e};h.prototype.ko=function(){this.iF(this.description.le.length);h.ob(this.description.le,this.fa,this.description.le.length);this.fa[0]=
NaN;this.fa[1]=NaN};h.prototype.Oe=function(e){if(e instanceof a.Bg){if(!this.sc()){var c=this.w();e.Zi(c,c);this.ic(c)}}else this.sc()||(this.Ne(1),c=this.Lw(),this.Py(e.Qn(c)))};h.prototype.copyTo=function(e){if(33!=e.D())throw a.g.N();e.qc();null==this.fa?(e.Ja(),e.fa=null,e.Qf(this.description)):(e.Qf(this.description),e.iF(this.description.le.length),h.ob(this.fa,e.fa,this.description.le.length))};h.prototype.Pa=function(){return new h(this.description)};h.prototype.s=function(){return this.sc()};
h.prototype.sc=function(){return null==this.fa||isNaN(this.fa[0])||isNaN(this.fa[1])};h.prototype.Fp=function(a){a.Ja();this.description!=a.description&&a.Qf(this.description);a.Db(this)};h.prototype.o=function(a){this.sc()?a.Ja():(a.v=this.fa[0],a.C=this.fa[1],a.B=this.fa[0],a.G=this.fa[1])};h.prototype.Cn=function(a){if(this.sc())a.Ja();else{var e=this.Lw();a.v=e.x;a.C=e.y;a.Je=e.z;a.B=e.x;a.G=e.y;a.ig=e.z}};h.prototype.Ah=function(e,c){var g=new a.Nd;if(this.sc())return g.Ja(),g;e=this.ld(e,c);
g.qa=e;g.va=e;return g};h.prototype.iF=function(e){if(null==this.fa)this.fa=a.I.Lh(e);else if(this.fa.length<e){for(var c=this.fa.slice(0),h=this.fa.length;h<e;h++)c[h]=0;this.fa=c}};h.ob=function(a,c,h){if(0<h)for(h=0;h<a.length;h++)c[h]=a[h]};h.prototype.lc=function(a){if(a==this)return!0;if(!(a instanceof h)||this.description!=a.description)return!1;if(this.sc())return a.sc()?!0:!1;for(var e=0,c=this.description.le.length;e<c;e++)if(this.fa[e]!=a.fa[e])return!1;return!0};h.prototype.hc=function(){var e=
this.description.hc();if(!this.sc())for(var c=0,h=this.description.le.length;c<h;c++)var b=this.fa[c],b=a.I.truncate(b^b>>>32),e=a.I.kg(b,e);return e};h.prototype.Rf=function(){return null};return h}(a.T);a.Va=c})(B||(B={}));(function(a){var c=function(){function a(a,e,c){void 0!==a&&(this.x=a,this.y=e,this.z=c)}a.Oa=function(c,e,g){var h=new a;h.x=c;h.y=e;h.z=g;return h};a.prototype.K=function(a,e,c){this.x=a;this.y=e;this.z=c};a.prototype.Lu=function(){this.z=this.y=this.x=0};a.prototype.normalize=
function(){var a=this.length();0==a&&(this.x/=a,this.y/=a,this.z/=a)};a.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};a.prototype.sub=function(c){return new a(this.x-c.x,this.y-c.y,this.z-c.z)};a.prototype.Ap=function(c){return new a(this.x*c,this.y*c,this.z*c)};a.prototype.FA=function(){this.x=NaN};a.prototype.pv=function(){return isNaN(this.x)};return a}();a.ee=c})(B||(B={}));(function(a){var c=function(){function c(a,e,c){this.gu=this.Yt=null;this.Gf=
e;this.KP=e.y-c;this.JP=e.y+c;this.xp=0;this.ix=a;this.ka=c;this.UP=c*c;this.jx=0!=c;this.xt=!1}c.prototype.result=function(){return 0!=this.xp?1:0};c.prototype.DJ=function(c){c=c.Kb(c.Gd(this.Gf,!1));return a.b.Zb(c,this.Gf)<=this.UP?!0:!1};c.prototype.WB=function(a){if(!this.jx&&(this.ix&&this.Gf.ub(a.Mb())||this.Gf.ub(a.oc())))this.xt=!0;else if(a.ja==this.Gf.y&&a.ja==a.ha){if(this.ix&&!this.jx){var e=Math.max(a.na,a.la);this.Gf.x>Math.min(a.na,a.la)&&this.Gf.x<e&&(this.xt=!0)}}else{var c=!1,e=
Math.max(a.na,a.la);this.Gf.x>e?c=!0:this.Gf.x>=Math.min(a.na,a.la)&&(c=0<a.nt(!0,this.Gf.y,this.gu,null)&&this.gu[0]<=this.Gf.x);if(c){if(this.Gf.y==a.Mb().y){if(this.Gf.y<a.oc().y)return}else if(this.Gf.y==a.oc().y&&this.Gf.y<a.Mb().y)return;this.xp=this.ix?this.xp^1:this.xp+(a.Mb().y>a.oc().y?1:-1)}}};c.prototype.zr=function(a){var e=a.Ah(0,1);if(e.qa>this.JP||e.va<this.KP)return!1;if(this.jx&&this.DJ(a))return!0;if(e.qa>this.Gf.y||e.va<this.Gf.y)return!1;null==this.Yt&&(this.Yt=[null,null,null,
null,null]);null==this.gu&&(this.gu=[0,0,0]);e=a.TC(this.Yt);if(0<e)for(a=0;a<e;a++){var c=this.Yt[a].get();this.WB(c);if(this.xt)return!0}else if(this.WB(a),this.xt)return!0;return!1};c.V=function(a,e,g){e=new c(0==a.Cm(),e,g);for(a=a.Ca();a.kb();)for(;a.La();)if(g=a.ia(),e.zr(g))return-1;return e.result()};c.Bd=function(h,e,g,b){var d=new a.i;h.dd(d);d.P(b,b);var n=new c(0==h.Cm(),g,b);h=h.Ca();var f=new a.i;f.K(d);f.B=g.x+b;f.C=g.y-b;f.G=g.y+b;g=e.xw(f,b);for(b=g.next();-1!=b;b=g.next())if(h.Sb(e.da(b)),
h.La()&&(b=h.ia(),n.zr(b)))return-1;return n.result()};c.xl=function(h,e,g){if(h.s())return 0;var b=new a.i;h.dd(b);b.P(g,g);if(!b.contains(e))return 0;b=h.pb;if(null!=b){var d=b.hi;if(null!=d){d=d.Kk(e.x,e.y);if(1==d)return 1;if(0==d)return 0}b=b.Ab;if(null!=b)return c.Bd(h,b,e,g)}return c.V(h,e,g)};c.aP=function(h,e,g,b){if(h.s())return 0;var d=new a.i;h.dd(d);d.P(b,b);if(!d.contains(e,g))return 0;d=h.pb;if(null!=d&&(d=d.hi,null!=d)){d=d.Kk(e,g);if(1==d)return 1;if(0==d)return 0}return c.V(h,a.b.Oa(e,
g),b)};c.$O=function(a,e,g){return e.s()?0:c.xl(a,e.w(),g)};c.vD=function(h,e,g,b,d){var n=new a.i;h.dd(n);n.P(b,b);if(!n.contains(g))return 0;var f=new c(!0,g,b);if(null!=d){var k=new a.i;k.K(n);k.B=g.x+b;k.C=g.y-b;k.G=g.y+b;h=h.Ca();b=d.xw(k,b);for(k=b.next();-1!=k;k=b.next())if(h.Sb(d.da(k),e),h.La()&&h.Qa==e&&(k=h.ia(),f.zr(k)))return-1}else if(h=h.Ca(),h.vy(e),h.kb())for(;h.La();)if(k=h.ia(),f.zr(k))return-1;return f.result()};c.tD=function(h,e,g){var b=new a.i;h.dd(b);b.P(g,g);if(!b.contains(e))return 0;
e=new c(!1,e,g);for(g=h.Ca();g.kb();)if(!(0>h.oo(g.Qa))){for(e.xp=0;g.La();)if(b=g.ia(),e.zr(b))return-1;if(0!=e.xp)return 1}return e.result()};c.$i=function(h,e,g,b,d){var n=h.Ca();n.vy(e);if(!n.kb()||!n.La())throw a.g.ra("corrupted geometry");for(e=2;2==e&&n.La();)e=n.ia().Kb(.5),e=c.vD(h,g,e,b,d);if(2==e)throw a.g.ra("internal error");return 1==e?!0:!1};c.An=function(a,e){a=a.F();return 16>a?!1:2*a+Math.log(a)/Math.log(2)*1*e<1*a*e};return c}();a.ff=c})(B||(B={}));(function(a){var c=function(a){function c(e){a.call(this,
!0,e)}D(c,a);c.prototype.Pa=function(){return new c(this.description)};c.prototype.fb=function(){return 2};c.prototype.D=function(){return 1736};return c}(a.al);a.Ka=c})(B||(B={}));(function(a){(function(a){a[a.PiPOutside=0]="PiPOutside";a[a.PiPInside=1]="PiPInside";a[a.PiPBoundary=2]="PiPBoundary"})(a.pI||(a.pI={}));var c=function(){function c(){}c.uD=function(c,e,g){c=a.ff.$O(c,e,g);return 0==c?0:1==c?1:2};c.he=function(c,e,g){c=a.ff.xl(c,e,g);return 0==c?0:1==c?1:2};c.CH=function(c,e,g,b){c=a.ff.aP(c,
e,g,b);return 0==c?0:1==c?1:2};c.gU=function(c,e,g,b){return 0==a.ff.vD(c,e,g,b,null)?0:1};c.tD=function(c,e,g){return 0==a.ff.tD(c,e,g)?0:1};c.ZS=function(h,e,g,b,d){if(e.length<g||d.length<g)throw a.g.N();for(var n=0;n<g;n++)d[n]=c.he(h,e[n],b)};c.eT=function(h,e,g,b,d){if(e.length/2<g||d.length<g)throw a.g.N();for(var n=0;n<g;n++)d[n]=c.CH(h,e[2*n],e[2*n+1],b)};c.nG=function(h,e,g,b,d){if(1736==h.D())c.ZS(h,e,g,b,d);else if(197==h.D()){var n=new a.i;h.o(n);c.jP(n,e,g,b,d)}else throw a.g.ra("invalid_call");
};c.nU=function(h,e,g,b,d){if(1736==h.D())c.eT(h,e,g,b,d);else if(197==h.D()){var n=new a.i;h.o(n);c.mP(n,e,g,b,d)}else throw a.g.xa();};c.jP=function(c,e,g,b,d){if(e.length<g||d.length<g)throw a.g.N();if(c.s())for(b=0;b<g;b++)d[b]=0;else for(c.P(.5*-b,.5*-b),c.P(.5*b,.5*b),b=0;b<g;b++)c.contains(e[b])?d[b]=1:c.contains(e[b])?d[b]=2:d[b]=0};c.mP=function(c,e,g,b,d){if(e.length/2<g||d.length<g)throw a.g.N();if(c.s())for(b=0;b<g;b++)d[b]=0;else for(c.P(.5*-b,.5*-b),c.P(.5*b,.5*b),b=0;b<g;b++)c.contains(e[2*
b],e[2*b+1])?d[b]=1:c.contains(e[2*b],e[2*b+1])?d[b]=2:d[b]=0};c.lT=function(a,e,c,b,d){for(var g=0;g<c;g++)d[g]=a.Eq(e[g],b)?2:0};c.hT=function(a,e,c,b,d){var g=a.pb,h=null;null!=g&&(h=g.hi);for(var g=c,n=0;n<c;n++)if(d[n]=1,null!=h){var f=e[n];0==h.Kk(f.x,f.y)&&(d[n]=0,g--)}if(0!=g)for(a=a.Ca();a.kb()&&0!=g;)for(;a.La()&&0!=g;)for(h=a.ia(),n=0;n<c&&0!=g;n++)1==d[n]&&h.Eq(e[n],b)&&(d[n]=2,g--);for(n=0;n<c;n++)1==d[n]&&(d[n]=0)};c.oG=function(h,e,g,b,d){var n=h.D();if(1607==n)c.hT(h,e,g,b,d);else if(a.T.Lc(n))c.lT(h,
e,g,b,d);else throw a.g.ra("Invalid call.");};return c}();a.gd=c})(B||(B={}));(function(a){var c=function(a){function c(e,c){2==arguments.length?(a.call(this,!1,e.description),this.df(e),this.lineTo(c)):a.call(this,!1,e)}D(c,a);c.prototype.Pa=function(){return new c(this.description)};c.prototype.fb=function(){return 1};c.prototype.D=function(){return 1607};return c}(a.al);a.Xa=c})(B||(B={}));(function(a){var c=function(){function a(){}a.GT=function(){};return a}();a.RT=c})(B||(B={}));(function(a){var c=
function(){function c(){}c.Rv=function(a){return a*c.rQ};c.aG=function(a,g){return c.cR(g-a)};c.kR=function(e){if(-360<=e&&720>e)return 0>e?e+=360:360<=e&&(e-=360),e;e=a.vi.gH(e);0>e&&(e+=360);return e};c.cR=function(a){a=c.kR(a);180<a&&(a-=360);return a};c.OT=.0174532925199433;c.rQ=57.29577951308232;return c}(),b=function(){function h(){}h.qo=function(e,c){var g=new a.i;e.o(g);var h=a.Ya.Fm(c),b=new a.i;b.K(h);b.v=g.v;b.B=g.B;b.P(.01*b.ba(),0);h=a.Ia.zd(c,g,!1);return b.contains(g)?e:a.Ed.clip(e,
b,h,0)};h.Rw=function(e,c,b,d){if(!a.Ya.Qo(c))throw a.g.N();var g=a.Ia.Cg(c,e,!1),n=a.Ya.Fm(c),f=a.Ya.Em(c),k=f.Se().Dj,m=a.Ya.ft(f),f=a.Ya.Ts(f),m=m*(2-m),p=new a.Nd;n.wu(p);var r=[[0,0],[0,0]];2==a.Nf.Am(c)?(r[0][0]=h.pu(d,p),r[0][1]=n.Vs(),a.Ya.tu(),n=r[0][0]*k):n=d*k;var u=new a.ca,v=new a.fd;e=v.Eb(e);for(var y=[0],q=new a.b,x=new a.b,D=new a.b,B=new a.b,t=new a.b,z=new a.b,A=v.Vb(e);-1!=A;A=v.bc(A)){var C=v.Cb(A);v.w(C,D);for(var l=!1,E=C=v.X(C);-1!=E;E=v.X(E)){if(E==C){if(l)break;l=!0}v.w(E,
B);if((g<d-D.x&&B.x-d>g||g<d-B.x&&D.x-d>g||g<-B.y&&D.y>g)&&!(Math.abs(D.x-B.x)>=.5*p.aa())&&(2==a.Nf.Am(c)?(r[0][0]=h.pu(D.x,p),r[0][1]=D.y,r[1][0]=h.pu(B.x,p),r[1][1]=B.y,a.Ya.YQ(),t.x=r[0][0]*k,t.y=r[0][1]*k,z.x=r[1][0]*k,z.y=r[1][1]*k):(t.x=D.x*k,t.y=D.y*k,z.x=B.x*k,z.y=B.y*k),z.x=6.283185307179586*(B.x-D.x)/p.aa()+t.x,x.x=n,x.y=h.yH(f,m,t,z,n,b),!isNaN(x.y))){a.zb.Rd(f,m,t.x,t.y,z.x,z.y,u,null,null,b);var I=u.l;a.zb.Rd(f,m,t.x,t.y,x.x,x.y,u,null,null,b);var G=u.l;2==a.Nf.Am(c)?(r[0][0]=x.x/k,
r[0][1]=x.y/k,a.Ya.qN(),q.y=r[0][1],q.x=d):(q.x=d,q.y=x.y/k);y[0]=0<I?a.I.Kr(G/I,0,1):.5;0!=y[0]&&1!=y[0]&&(I=v.Ua(E),v.Mr(I,y,1),v.ic(v.X(I),q.x,q.y))}D.J(B)}}return v.hf(e)};h.aN=function(e,c,b){if(e.s())return e;var g=a.Ya.IC(c);return h.gC(e,0-180*g,360*g,c,b)};h.yH=function(e,c,b,d,f,k){if(3.141592653589793<=Math.abs(b.x-d.x)||!h.Jv(b.x,d.x,f))return NaN;var g;b.x>d.x?g=d:(g=b,b=d);d=new a.ca(0);var n=new a.ca(0),m=new a.ca(0);a.zb.Rd(e,c,g.x,g.y,b.x,b.y,n,d,null,k);var p=n.l,r=0,u=1,v=new a.b;
for(v.J(g);p*(u-r)>1E-12*e;){var y=.5*(r+u);a.zb.dk(e,c,g.x,g.y,p*y,d.l,n,m,k);v.x=n.l;v.y=m.l;if(v.x==f)break;if(h.Jv(g.x,v.x,f))u=y;else if(h.Jv(b.x,v.x,f))r=y;else return NaN}return v.y};h.Jv=function(a,g,h){a=c.Rv(a);g=c.aG(a,c.Rv(g));h=c.aG(a,c.Rv(h));return 0==h||0<g&&0<h&&h<=g||0>g&&0>h&&h>=g?!0:!1};h.pu=function(a,c){var e=c.va-c.qa;return c.Sy(a-Math.floor((a-c.qa)/e)*e)};h.eU=function(e,c,h,b){var g=new a.Nd;g.K(c,h);h=b.aa();e=Math.floor((e-c)/h)*h+e;for(g=g.Af();Math.abs(e-g)>Math.abs(e+
h-g);)e+=h;return e};h.cU=function(e,c,h,b,d){var g;h.y>b.y?g=b:(g=h,h=b);b=new a.Nd;b.K(g.y,h.y);if(!b.contains(0)||3.141592653589793<=Math.abs(g.x-h.x))return NaN;if(g.x==h.x)return g.x;var n=new a.ca(0),f=new a.ca(0),k=new a.ca(0);a.zb.Rd(e,c,g.x,g.y,h.x,h.y,f,n,null,d);var m=f.l,p=0,r=1,u=new a.b;for(u.J(g);m*(r-p)>1E-12*e;){var v=.5*(p+r);a.zb.dk(e,c,g.x,g.y,m*v,n.l,f,k,d);u.x=f.l;u.y=k.l;b.K(g.y,u.y);if(0==u.y)break;if(b.contains(0))r=v;else if(b.K(h.y,u.y),b.contains(0))p=v;else return NaN}return u.x};
h.gC=function(e,c,h,b,d){var g=new a.i;e.o(g);if(g.s())return e;var n=new a.Nd;g.wu(n);var f=new a.Nd;f.K(c,c+h);if(f.contains(n)&&f.va!=n.va)return e;var k=new a.i;k.K(g);var m=e.D();if(33==m){k=d?e:e.vm();g=k.lk();if(g<f.qa||g>=f.va||g==f.va)g+=Math.ceil((f.qa-g)/h)*h,g=f.Sy(g),k.qS(g);return k}if(550==m){k=d?e:e.vm();b=k.mc(0);m=2*k.F();e=!1;for(d=0;d<m;d+=2)if(g=b.read(d),g<f.qa||g>=f.va||g==f.va)e=!0,g+=Math.ceil((f.qa-g)/h)*h,g=f.Sy(g),b.write(d,g);e&&k.ce(1993);return k}if(f.contains(n))return e;
if(197==m)return h=d?e:e.vm(),g.Ga(k),h.Cu(g),h;var p=.1*Math.max(g.ba(),g.aa());k.P(0,p);f=e;e=b.Ko();d=a.wi.local();for(var r=new a.Bg,u=0;;){var v=Math.floor((n.qa-c)/h),y=Math.ceil((n.va-c)/h);if(3<y-v){v=Math.floor(.5*(y+v));k.v=g.v-p;k.B=c+h*v;var q=a.Ed.clip(f,k,e,0);k.v=k.B;k.B=g.B+p;var x=a.Ed.clip(f,k,e,0);r.Nn((v-y)*h,0);x.Oe(r);1736==m?f=d.$(q,x,b,null):(f=q,f.add(x,!1));f.o(g);g.wu(n);u++}else break}k.v=c;k.B=c+h;c=new a.i;c.K(k);c.P(e,0);c=Math.floor((g.v-k.v)/h)*h;0!=c?(k.move(c,0),
r.Nn(-c,0)):r.IF();c=1607==m?new a.Xa(f.description):new a.Ka(f.description);n=new a.i;for(p=new a.i;g.B>k.v;){u=a.Ed.clip(f,k,e,0);u.o(p);if(1607==m?!u.s()&&(p.aa()>e||p.ba()>e):!u.s()&&(1736!=m||p.aa()>e))u.Oe(r),u.o(p),c.o(n),n.P(e,e),n.jc(p)&&1736==m?c=d.$(c,u,b,null):c.add(u,!1);k.move(h,0);r.shift(-h,0)}return c};h.ZQ=function(e,c,h,b){var g=new a.pe(h.description);g.Pd(h,0,-1);var g=a.Ya.Wl(g,e,c),d=h.F();b.Ja();if(!a.Ya.Qo(e)||d!=g.F())return!1;var n=new a.i;h.o(n);var f=new a.i;g.o(f);n=
n.aa();f=f.aa();if(0!=n&&0!=f){if(f/=n,e=a.Ya.Fm(c).aa()/a.Ya.Fm(e).aa(),1E-10<Math.abs(f/e-1))return!1}else if(0!=n||0!=f)return!1;b.add(h,!1);for(h=0;h<d;h++)e=g.Fa(h),b.ic(h,e);return!0};h.dU=function(){throw a.g.qe();};return h}();a.gh=b})(B||(B={}));(function(a){(function(a){a[a.rightSide=1]="rightSide"})(a.sI||(a.sI={}));var c=function(){function c(c,e,g){this.Nq=new a.b;void 0===c?this.tn=-1:(this.Nq.J(c),this.tn=e,this.Da=g,this.Ut=0)}c.prototype.UF=function(a){this.Ut=a?this.Ut|1:this.Ut&
-2};c.prototype.s=function(){return 0>this.tn};c.prototype.pw=function(){if(this.s())throw a.g.ra("invalid call");return new a.Va(this.Nq.x,this.Nq.y)};c.prototype.gb=function(){if(this.s())throw a.g.ra("invalid call");return this.tn};c.prototype.sw=function(){if(this.s())throw a.g.ra("invalid call");return this.Da};c.prototype.Xw=function(){return 0!=(this.Ut&1)};c.prototype.tv=function(a,e,c,b){this.Nq.x=a;this.Nq.y=e;this.tn=c;this.Da=b};return c}();a.dl=c})(B||(B={}));(function(a){var c=function(){function c(){}
c.prototype.Fn=function(e,c){this.Vg.resize(0);this.ai.length=0;this.Aj=-1;e.dd(this.Kj);this.Kj.P(c,c);this.Kj.jc(this.Ab.Qb)?((this.Iq=a.T.Lc(e.D()))?(this.rE=e.Mb(),this.qE=e.oc(),this.ka=c):this.ka=NaN,this.Vg.add(this.Ab.Ze),this.ai.push(this.Ab.Qb),this.ar=this.Ab.sq(this.Ab.Ze)):this.ar=-1};c.prototype.Ch=function(a,c){this.Vg.resize(0);this.ai.length=0;this.Aj=-1;this.Kj.K(a);this.Kj.P(c,c);this.ka=NaN;this.Kj.jc(this.Ab.Qb)?(this.Vg.add(this.Ab.Ze),this.ai.push(this.Ab.Qb),this.ar=this.Ab.sq(this.Ab.Ze),
this.Iq=!1):this.ar=-1};c.prototype.next=function(){if(0==this.Vg.size)return-1;this.Aj=this.ar;var e=null,c=null,h,d=null,f=null;this.Iq&&(e=new a.b,c=new a.b,d=new a.i);for(var k=!1;!k;){for(;-1!=this.Aj;){h=this.Ab.kw(this.Ab.Us(this.Aj));if(h.jc(this.Kj))if(this.Iq){if(e.J(this.rE),c.J(this.qE),d.K(h),d.P(this.ka,this.ka),0<d.Nv(e,c)){k=!0;break}}else{k=!0;break}this.Aj=this.Ab.at(this.Aj)}if(-1==this.Aj){h=this.Vg.tc();var m=this.ai[this.ai.length-1];null==f&&(f=[],f[0]=new a.i,f[1]=new a.i,
f[2]=new a.i,f[3]=new a.i);b.BF(m,f);this.Vg.af();--this.ai.length;for(m=0;4>m;m++){var p=this.Ab.zo(h,m);if(-1!=p&&0<this.Ab.gO(p)&&f[m].jc(this.Kj))if(this.Iq){if(e.J(this.rE),c.J(this.qE),d.K(f[m]),d.P(this.ka,this.ka),0<d.Nv(e,c)){var r=new a.i;r.K(f[m]);this.Vg.add(p);this.ai.push(r)}}else r=new a.i,r.K(f[m]),this.Vg.add(p),this.ai.push(r)}if(0==this.Vg.size)return-1;this.Aj=this.Ab.sq(this.Vg.get(this.Vg.size-1))}}this.ar=this.Ab.at(this.Aj);return this.Aj};c.HL=function(e,g,h){var b=new c;
b.Ab=e;b.Kj=new a.i;b.Vg=new a.ga(0);b.ai=[];b.Fn(g,h);return b};c.GL=function(e,g,h){var b=new c;b.Ab=e;b.Kj=new a.i;b.Vg=new a.ga(0);b.ai=[];b.Ch(g,h);return b};c.FL=function(e){var g=new c;g.Ab=e;g.Kj=new a.i;g.Vg=new a.ga(0);g.ai=[];return g};return c}();a.TT=c;var b=function(){function h(e,c){this.Ye=new a.Fc(11);this.qh=new a.Fc(5);this.Jq=[];this.Rt=new a.ga(0);this.Qb=new a.i;this.Rj(e,c)}h.prototype.reset=function(a,c){this.Ye.Nh(!1);this.qh.Nh(!1);this.Jq.length=0;this.Rt.clear(!1);this.Rj(a,
c)};h.prototype.lg=function(a,c){return this.lt(a,c,0,this.Qb,this.Ze,!1,-1)};h.prototype.kt=function(a,c,h){h=-1==h?this.Ze:this.KC(h);var e=this.ba(h),g=this.CN(h);return this.lt(a,c,e,g,h,!1,-1)};h.prototype.da=function(a){return this.yN(a)};h.prototype.uC=function(a){return this.kw(this.Us(a))};h.prototype.ba=function(a){return this.Xs(a)};h.prototype.CN=function(e){var c=new a.i;c.K(this.Qb);var h=this.Xs(e);e=this.EC(e);for(var b=0;b<2*h;b+=2){var d=a.I.truncate(3&e>>b);0==d?(c.v=.5*(c.v+c.B),
c.C=.5*(c.C+c.G)):1==d?(c.B=.5*(c.v+c.B),c.C=.5*(c.C+c.G)):(2==d?c.B=.5*(c.v+c.B):c.v=.5*(c.v+c.B),c.G=.5*(c.C+c.G))}return c};h.prototype.gO=function(a){return this.Kw(a)};h.prototype.KN=function(a,g){return c.HL(this,a,g)};h.prototype.xw=function(a,g){return c.GL(this,a,g)};h.prototype.Re=function(){return c.FL(this)};h.prototype.Rj=function(e,c){if(0>c||32<2*c)throw a.g.N("invalid height");this.GP=c;this.Qb.K(e);this.Ze=this.Ye.be();this.Ku(this.Ze,0);this.Eu(this.Ze,0);this.LF(this.Ze,0);this.HF(this.Ze,
0)};h.prototype.lt=function(e,c,b,d,f,k,m){if(!d.contains(c))return 0==b?-1:this.lt(e,c,0,this.Qb,this.Ze,k,m);if(!k)for(var g=f;-1!=g;g=this.UN(g))this.Ku(g,this.Kw(g)+1);g=new a.i;g.K(d);d=f;var n=[];n[0]=new a.i;n[1]=new a.i;n[2]=new a.i;for(n[3]=new a.i;b<this.GP&&this.IK(d);b++){h.BF(g,n);for(var p=!1,r=0;4>r;r++)if(n[r].contains(c)){var p=!0,u=this.zo(d,r);-1==u&&(u=this.OL(d,r));this.Ku(u,this.Kw(u)+1);d=u;g.K(n[r]);break}if(!p)break}return this.zO(e,c,b,g,d,k,f,m)};h.prototype.zO=function(a,
c,h,b,d,f,k,m){var e=this.AC(d);if(f){if(d==k)return m;this.mM(m);f=m}else f=this.QL(),this.By(f,a),this.IR(this.Us(f),c);this.gS(f,d);-1!=e?(this.Ju(f,e),this.Fu(e,f)):this.DF(d,f);this.Fy(d,f);this.Eu(d,this.Zs(d)+1);this.HK(d)&&this.$M(h,b,d);return f};h.prototype.mM=function(a){var e=this.KC(a),c=this.AC(e),h=this.$N(a),b=this.at(a);this.sq(e)==a?(-1!=b?this.Ju(b,-1):this.Fy(e,-1),this.DF(e,b)):c==a?(this.Fu(h,-1),this.Fy(e,h)):(this.Ju(b,h),this.Fu(h,b));this.Ju(a,-1);this.Fu(a,-1);this.Eu(e,
this.Zs(e)-1)};h.BF=function(a,c){var e=.5*(a.v+a.B),g=.5*(a.C+a.G);c[0].K(e,g,a.B,a.G);c[1].K(a.v,g,e,a.G);c[2].K(a.v,a.C,e,g);c[3].K(e,a.C,a.B,g)};h.prototype.HK=function(a){return 8==this.Zs(a)&&!this.VC(a)};h.prototype.$M=function(a,c,h){var e,g,b=this.sq(h);do g=this.Us(b),e=this.qh.O(b,0),g=this.kw(g),this.lt(e,g,a,c,h,!0,b),b=e=this.at(b);while(-1!=b)};h.prototype.IK=function(a){return 8<=this.Zs(a)||this.VC(a)};h.prototype.VC=function(a){return-1!=this.zo(a,0)||-1!=this.zo(a,1)||-1!=this.zo(a,
2)||-1!=this.zo(a,3)};h.prototype.OL=function(a,c){var e=this.Ye.be();this.MR(a,c,e);this.Ku(e,0);this.Eu(e,0);this.Tj(e,a);this.HF(e,this.Xs(a)+1);this.LF(e,c<<2*this.Xs(a)|this.EC(a));return e};h.prototype.QL=function(){var e=this.qh.be(),c;0<this.Rt.size?(c=this.Rt.tc(),this.Rt.af()):(c=this.Jq.length,this.Jq.push(new a.i));this.JR(e,c);return e};h.prototype.zo=function(a,c){return this.Ye.O(a,c)};h.prototype.MR=function(a,c,h){this.Ye.L(a,c,h)};h.prototype.sq=function(a){return this.Ye.O(a,4)};
h.prototype.DF=function(a,c){this.Ye.L(a,4,c)};h.prototype.AC=function(a){return this.Ye.O(a,5)};h.prototype.Fy=function(a,c){this.Ye.L(a,5,c)};h.prototype.EC=function(a){return this.Ye.O(a,6)};h.prototype.LF=function(a,c){this.Ye.L(a,6,c)};h.prototype.Zs=function(a){return this.Ye.O(a,7)};h.prototype.Kw=function(a){return this.Ye.O(a,8)};h.prototype.Eu=function(a,c){this.Ye.L(a,7,c)};h.prototype.Ku=function(a,c){this.Ye.L(a,8,c)};h.prototype.UN=function(a){return this.Ye.O(a,9)};h.prototype.Tj=function(a,
c){this.Ye.L(a,9,c)};h.prototype.Xs=function(a){return this.Ye.O(a,10)};h.prototype.HF=function(a,c){this.Ye.L(a,10,c)};h.prototype.yN=function(a){return this.qh.O(a,0)};h.prototype.By=function(a,c){this.qh.L(a,0,c)};h.prototype.$N=function(a){return this.qh.O(a,1)};h.prototype.at=function(a){return this.qh.O(a,2)};h.prototype.Ju=function(a,c){this.qh.L(a,1,c)};h.prototype.Fu=function(a,c){this.qh.L(a,2,c)};h.prototype.KC=function(a){return this.qh.O(a,3)};h.prototype.gS=function(a,c){this.qh.L(a,
3,c)};h.prototype.Us=function(a){return this.qh.O(a,4)};h.prototype.JR=function(a,c){this.qh.L(a,4,c)};h.prototype.kw=function(a){return this.Jq[a]};h.prototype.IR=function(a,c){this.Jq[a].K(c)};return h}();a.co=b})(B||(B={}));(function(a){(function(a){a[a.Outside=0]="Outside";a[a.Inside=1]="Inside";a[a.Border=2]="Border"})(a.wH||(a.wH={}));var c=function(){function a(a,c){this.Hg=null;this.SP=c;this.Hg=a}a.prototype.Bu=function(a,c){this.PD!=c&&a.flush();this.PD=c};a.prototype.XB=function(a,c){for(var e=
0;e<c;)for(var g=a[e++],h=a[e++],b=a[e++]*this.SP;g<h;g++)this.Hg[b+(g>>4)]|=this.PD<<2*(g&15)};return a}();a.VT=c;var b=function(){function h(a,c,h){this.Hg=null;this.Qx=this.Sx=this.zE=this.xE=this.Qq=this.VD=this.tf=this.Pl=0;this.ii=this.Nj=this.sk=null;this.jt(a,c,h)}h.create=function(e,c,b){if(!h.Cc(e))throw a.g.N();return h.Id(e,c,b)};h.ti=function(e,c,b){if(!h.Cc(e))throw a.g.N();return h.ye(e,c,b)};h.jR=function(e){switch(e){case 0:e=1024;break;case 1:e=16384;break;case 2:e=262144;break;
default:throw a.g.ra("Internal Error");}return e};h.Cc=function(a){return a.s()||1607!=a.D()&&1736!=a.D()?!1:!0};h.prototype.KM=function(e,c){c=c.Ca();for(var g=new a.b,h=new a.b;c.kb();)for(;c.La();){var b=c.ia();if(322!=b.D())throw a.g.ra("Internal Error");e.Zi(b.Mb(),g);e.Zi(b.oc(),h);this.ii.zv(g.x,g.y,h.x,h.y)}this.ii.fF(a.ev.$u)};h.prototype.LM=function(){throw a.g.ra("Internal Error");};h.prototype.cw=function(e,c){for(var g=1;4>g;g++)e.zv(c[g-1].x,c[g-1].y,c[g].x,c[g].y);e.zv(c[3].x,c[3].y,
c[0].x,c[0].y);this.ii.fF(a.ev.$u)};h.prototype.kG=function(e,c,h){for(var g=[null,null,null,null],b=0;b<g.length;b++)g[b]=new a.b;c=c.Ca();h=this.Nj.TS(h)+1.5;for(var b=new a.b,d=new a.b,n=new a.b,f=new a.b,k=new a.b,m=new a.i,p=new a.b;c.kb();){var r=!1,u=!0;for(p.ma(0,0);c.La();){var v=c.ia();f.x=v.na;f.y=v.ja;k.x=v.la;k.y=v.ha;m.Ja();m.Db(f.x,f.y);m.Oj(k.x,k.y);if(this.sk.rD(m)){this.Nj.Zi(k,k);u?(this.Nj.Zi(f,f),p.J(f),u=!1):f.J(p);b.pc(k,f);var v=b.length(),q=.5>v;0==v?b.ma(1,0):(q||p.J(k),
b.scale(h/v),d.ma(-b.y,b.x),n.ma(b.y,-b.x),f.sub(b),k.add(b),g[0].add(f,d),g[1].add(f,n),g[2].add(k,n),g[3].add(k,d),q?r=!0:this.cw(e,g))}else r&&(this.cw(e,g),r=!1),u=!0}r&&this.cw(e,g)}};h.prototype.fz=function(e){return a.I.truncate(e*this.VD+this.xE)};h.prototype.gz=function(e){return a.I.truncate(e*this.Qq+this.zE)};h.Id=function(a,c,b){return new h(a,c,b)};h.ye=function(a,c,b){return new h(a,c,b)};h.prototype.jt=function(e,g,h){this.tf=Math.max(a.I.truncate(2*Math.sqrt(h)+.5),64);this.Pl=a.I.truncate((2*
this.tf+31)/32);this.sk=new a.i;this.Sx=g;h=0;for(var b=this.tf,d=this.Pl;8<=b;)h+=b*d,b=a.I.truncate(b/2),d=a.I.truncate((2*b+31)/32);this.Hg=a.I.Lh(h,0);this.ii=new a.ev;h=new c(this.Hg,this.Pl,this);this.ii.vS(this.tf,this.tf,h);e.o(this.sk);this.sk.P(g,g);var b=new a.i,d=a.i.Oa(1,1,this.tf-2,this.tf-2),n=g*d.aa();g*=d.ba();b.K(this.sk.Af(),Math.max(n,this.sk.aa()),Math.max(g,this.sk.ba()));this.Qx=this.Sx;this.Nj=new a.Bg;this.Nj.wO(b,d);new a.Bg;switch(e.D()){case 550:h.Bu(this.ii,2);this.LM();
break;case 1607:h.Bu(this.ii,2);this.kG(this.ii,e,this.Qx);break;case 1736:h.Bu(this.ii,1),this.KM(this.Nj,e),h.Bu(this.ii,2),this.kG(this.ii,e,this.Qx)}this.VD=this.Nj.mb;this.Qq=this.Nj.eb;this.xE=this.Nj.Nb;this.zE=this.Nj.Ob;this.BK()};h.prototype.BK=function(){this.ii.flush();for(var e=0,c=this.tf*this.Pl,h=this.tf,b=a.I.truncate(this.tf/2),d=this.Pl,f=a.I.truncate((2*b+31)/32);8<h;){for(h=0;h<b;h++)for(var k=2*h,m=2*h+1,p=0;p<b;p++){var r=2*p,u=2*p+1,v=r>>4,r=2*(r&15),q=u>>4,u=2*(u&15),x=this.Hg[e+
d*k+v]>>r&3,x=x|this.Hg[e+d*k+q]>>u&3,x=x|this.Hg[e+d*m+v]>>r&3,x=x|this.Hg[e+d*m+q]>>u&3;this.Hg[c+f*h+(p>>4)]|=x<<2*(p&15)}h=b;d=f;e=c;b=a.I.truncate(h/2);f=a.I.truncate((2*b+31)/32);c=e+d*h}};h.prototype.Kk=function(a,c){if(!this.sk.contains(a,c))return 0;a=this.fz(a);c=this.gz(c);if(0>a||a>=this.tf||0>c||c>=this.tf)return 0;a=this.Hg[this.Pl*c+(a>>4)]>>2*(a&15)&3;return 0==a?0:1==a?1:2};h.prototype.Dn=function(e){if(!e.Ga(this.sk))return 0;var c=this.fz(e.v),h=this.fz(e.B),b=this.gz(e.C);e=this.gz(e.G);
0>c&&(c=0);0>b&&(b=0);h>=this.tf&&(h=this.tf-1);e>=this.tf&&(e=this.tf-1);if(c>h||b>e)return 0;for(var d=Math.max(h-c,1)*Math.max(e-b,1),f=0,k=this.Pl,m=this.tf,p=0;;){if(32>d||16>m){for(d=b;d<=e;d++)for(var r=c;r<=h;r++)if(p=this.Hg[f+k*d+(r>>4)]>>2*(r&15)&3,1<p)return 2;if(0==p)return 0;if(1==p)return 1}f+=k*m;m=a.I.truncate(m/2);k=a.I.truncate((2*m+31)/32);c=a.I.truncate(c/2);b=a.I.truncate(b/2);h=a.I.truncate(h/2);e=a.I.truncate(e/2);d=Math.max(h-c,1)*Math.max(e-b,1)}};h.prototype.cO=function(){return this.tf*
this.Pl};return h}();a.dA=b})(B||(B={}));(function(a){(function(a){a[a.contains=1]="contains";a[a.within=2]="within";a[a.equals=3]="equals";a[a.disjoint=4]="disjoint";a[a.touches=8]="touches";a[a.crosses=16]="crosses";a[a.overlaps=32]="overlaps";a[a.unknown=0]="unknown";a[a.intersects=1073741824]="intersects"})(a.zI||(a.zI={}));var c=function(){function a(){}a.Oa=function(e,c,h,b,d,f,k,m){var g=new a;g.Wt=e;g.Jl=c;g.Oi=h;g.ji=b;g.dE=d;g.tU=f;g.uU=k;g.vU=m;return g};return a}(),b=function(){function c(){}
c.vT=function(e,g,h){if(!c.pQ(e))return!1;var b=a.Ia.Cg(g,e,!1);g=!1;a.Wj.vB(e)&&(g=g||e.jv(b,h));b=e.D();1736!=b&&1607!=b||!a.Wj.tB(e)||0==h||(g=g||e.dj(h));1736!=b&&1607!=b||!a.Wj.uB(e)||0==h||(g=g||e.jJ());return g};c.pQ=function(e){return a.Wj.vB(e)||a.Wj.tB(e)||a.Wj.uB(e)};return c}();a.rT=b;b=function(){function h(){this.Tg=[]}h.qy=function(e,c,b,d,f){var g=e.D(),n=c.D();if(197==g){if(197==n)return h.AQ(e,c,b,d);if(33==n)return 2==d?d=1:1==d&&(d=2),h.Iz(c,e,b,d)}else if(33==g){if(197==n)return h.Iz(e,
c,b,d);if(33==n)return h.eR(e,c,b,d)}if(e.s()||c.s())return 4==d?!0:!1;var k=new a.i;e.o(k);var m=new a.i;c.o(m);var p=new a.i;p.K(k);p.Db(m);b=a.Ia.zd(b,p,!1);if(h.nj(k,m,b))return 4==d?!0:!1;k=!1;a.al.Lc(g)&&(g=new a.Xa(e.description),g.Bc(e,!0),e=g,g=1607);a.al.Lc(n)&&(n=new a.Xa(c.description),n.Bc(c,!0),c=n,n=1607);if(197!=g&&197!=n){if(e.fb()<c.fb()||33==g&&550==n)2==d?d=1:1==d&&(d=2)}else 1736!=g&&197!=n&&(2==d?d=1:1==d&&(d=2));switch(g){case 1736:switch(n){case 1736:k=h.vr(e,c,b,d,f);break;
case 1607:k=h.Vl(e,c,b,d,f);break;case 33:k=h.ur(e,c,b,d,f);break;case 550:k=h.tr(e,c,b,d,f);break;case 197:k=h.xD(e,c,b,d,f)}break;case 1607:switch(n){case 1736:k=h.Vl(c,e,b,d,f);break;case 1607:k=h.ey(e,c,b,d,f);break;case 33:k=h.xr(e,c,b,d,f);break;case 550:k=h.wr(e,c,b,d,f);break;case 197:k=h.WE(e,c,b,d)}break;case 33:switch(n){case 1736:k=h.ur(c,e,b,d,f);break;case 1607:k=h.xr(c,e,b,d,f);break;case 550:k=h.pr(c,e,b,d,f)}break;case 550:switch(n){case 1736:k=h.tr(c,e,b,d,f);break;case 1607:k=h.wr(c,
e,b,d,f);break;case 550:k=h.Wx(e,c,b,d,f);break;case 33:k=h.pr(e,c,b,d,f);break;case 197:k=h.oA(e,c,b,d)}break;case 197:switch(n){case 1736:k=h.xD(c,e,b,d,f);break;case 1607:k=h.WE(c,e,b,d);break;case 550:k=h.oA(c,e,b,d)}}return k};h.AQ=function(e,c,b,d){if(e.s()||c.s())return 4==d?!0:!1;var g=new a.i,n=new a.i,f=new a.i;e.o(g);c.o(n);f.K(g);f.Db(n);e=a.Ia.zd(b,f,!1);switch(d){case 4:return h.nj(g,n,e);case 2:return h.Bz(n,g,e);case 1:return h.Bz(g,n,e);case 3:return h.ye(g,n,e);case 8:return h.kT(g,
n,e);case 32:return h.fT(g,n,e);case 16:return h.cT(g,n,e)}return!1};h.Iz=function(e,c,b,d){if(e.s()||c.s())return 4==d?!0:!1;e=e.w();var g=new a.i,n=new a.i;c.o(g);n.K(e);n.Db(g);c=a.Ia.zd(b,n,!1);switch(d){case 4:return h.ru(e,g,c);case 2:return h.bx(e,g,c);case 1:return h.YL(e,g,c);case 3:return h.KA(e,g,c);case 8:return h.ax(e,g,c)}return!1};h.eR=function(e,c,b,d){if(e.s()||c.s())return 4==d?!0:!1;e=e.w();c=c.w();var g=new a.i;g.K(e);g.Db(c);b=a.Ia.zd(b,g,!1);switch(d){case 4:return h.rM(e,c,
b);case 2:return h.hz(c,e,b);case 1:return h.hz(e,c,b);case 3:return h.dB(e,c,b)}return!1};h.vr=function(a,c,b,d,f){switch(d){case 4:return h.dT(a,c,b);case 2:return h.su(c,a,b,f);case 1:return h.su(a,c,b,f);case 3:return h.TG(a,c,b);case 8:return h.vH(a,c,b);case 32:return h.bH(a,c,b,f)}return!1};h.Vl=function(a,c,b,d,f){switch(d){case 4:return h.gT(a,c,b);case 1:return h.dy(a,c,b,f);case 8:return h.zH(a,c,b,f);case 16:return h.lR(a,c,b)}return!1};h.ur=function(a,c,b,d){switch(d){case 4:return h.YS(a,
c,b);case 1:return h.qQ(a,c,b);case 8:return h.lH(a,c,b)}return!1};h.tr=function(a,c,b,d){switch(d){case 4:return h.OS(a,c,b);case 1:return h.hQ(a,c,b);case 8:return h.iH(a,c,b);case 16:return h.dR(a,c,b)}return!1};h.xD=function(a,c,b,d,f){if(h.ER(a,c,b))return 4==d?!0:!1;if(4==d)return!1;switch(d){case 2:return h.DH(a,c,b);case 1:return h.WP(a,c,b);case 3:return h.OG(a,c,b);case 8:return h.eH(a,c,b,f);case 32:return h.WG(a,c,b,f);case 16:return h.zQ(a,c,b,f)}return!1};h.ey=function(a,c,b,d){switch(d){case 4:return h.EI(a,
c,b);case 2:return h.JE(c,a,b);case 1:return h.JE(a,c,b);case 3:return h.QI(a,c,b);case 8:return h.cF(a,c,b);case 32:return h.$I(a,c,b);case 16:return h.LE(a,c,b)}return!1};h.xr=function(a,c,b,d){switch(d){case 4:return h.yI(a,c,b);case 1:return h.KH(a,c,b);case 8:return h.MG(a,c,b)}return!1};h.wr=function(a,c,b,d){switch(d){case 4:return h.vI(a,c,b);case 1:return h.IH(a,c,b);case 8:return h.fJ(a,c,b);case 16:return h.QH(a,c,b)}return!1};h.WE=function(a,c,b,d){if(h.nI(a,c,b))return 4==d?!0:!1;if(4==
d)return!1;switch(d){case 2:return h.WJ(a,c,b);case 1:return h.GH(a,c,b);case 3:return h.MI(a,c,b);case 8:return h.cJ(a,c,b);case 32:return h.XI(a,c,b);case 16:return h.MH(a,c,b)}return!1};h.Wx=function(a,c,b,d){switch(d){case 4:return h.xI(a,c,b);case 2:return h.kA(c,a,b);case 1:return h.kA(a,c,b);case 3:return h.LI(a,c,b);case 32:return h.bJ(a,c,b)}return!1};h.pr=function(a,c,b,d){switch(d){case 4:return h.lA(a,c,b);case 2:return h.HJ(a,c,b);case 1:return h.PH(a,c,b);case 3:return h.mu(a,c,b)}return!1};
h.oA=function(a,c,b,d){switch(d){case 4:return h.uI(a,c,b);case 2:return h.LG(a,c,b);case 1:return h.LH(a,c,b);case 3:return h.DI(a,c,b);case 8:return h.eJ(a,c,b);case 16:return h.mI(a,c,b)}return!1};h.TG=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);if(!h.ye(g,d,b))return!1;g=h.fc(e,c,!1);if(4==g||1==g||2==g)return!1;if(h.jA(e,c,b))return!0;g=e.$b();d=c.$b();return Math.abs(g-d)>4*Math.max(e.F(),c.F())*b?!1:h.Vv(e,c,b,!0)};h.dT=function(a,c,b){var e=h.fc(a,c,!0);return 4==e?!0:1==e||2==e||
1073741824==e?!1:h.ZC(a,c,b)};h.vH=function(a,c,b){var e=h.fc(a,c,!1);return 4==e||1==e||2==e?!1:h.AE(a,c,b,null)};h.bH=function(a,c,b,d){var e=h.fc(a,c,!1);return 4==e||1==e||2==e?!1:h.wD(a,c,b,d)};h.su=function(e,c,b,d){var g=new a.i,n=new a.i;e.o(g);c.o(n);if(!h.rc(g,n,b))return!1;g=h.fc(e,c,!1);return 4==g||2==g?!1:1==g?!0:h.bC(e,c,b,d)};h.gT=function(a,c,b){var e=h.fc(a,c,!0);return 4==e?!0:1==e||1073741824==e?!1:h.ZC(a,c,b)};h.zH=function(a,c,b,d){var e=h.fc(a,c,!1);return 4==e||1==e?!1:h.CE(a,
c,b,d)};h.lR=function(a,c,b){var e=h.fc(a,c,!1);return 4==e||1==e?!1:h.YC(a,c,b,null)};h.dy=function(e,c,b,d){var g=new a.i,n=new a.i;e.o(g);c.o(n);if(!h.rc(g,n,b))return!1;g=h.fc(e,c,!1);return 4==g?!1:1==g?!0:h.jC(e,c,b,d)};h.YS=function(e,c,h){return 0==a.gd.uD(e,c,h)?!0:!1};h.lH=function(a,c,b){c=c.w();return h.yD(a,c,b)};h.qQ=function(a,c,b){c=c.w();return h.YB(a,c,b)};h.OS=function(e,c,b){var g=h.fc(e,c,!1);if(4==g)return!0;if(1==g)return!1;g=new a.i;e.o(g);g.P(b,b);for(var d=new a.b,f=0;f<
c.F();f++)if(c.w(f,d),g.contains(d)){var n=a.gd.he(e,d,b);if(1==n||2==n)return!1}return!0};h.iH=function(e,c,h){var g=this.fc(e,c,!1);if(4==g||1==g)return!1;g=new a.i;e.o(g);g.P(h,h);var b,d=!1,f;f=e;for(var n=!1,k=0;k<c.F();k++){b=c.Fa(k);if(g.contains(b))if(b=a.gd.he(f,b,h),2==b)d=!0;else if(1==b)return!1;n||(!a.ff.An(e,c.F()-1)||null!=e.pb&&null!=e.pb.Ab?f=e:(f=new a.Ka,e.copyTo(f),f.dj(1)),n=!0)}return d?!0:!1};h.dR=function(e,c,h){var g=this.fc(e,c,!1);if(4==g||1==g)return!1;var b=new a.i,g=
new a.i,d=new a.i;e.o(b);c.o(d);g.K(b);g.P(h,h);var d=b=!1,f,n;n=e;for(var k=!1,m=0;m<c.F();m++){f=c.Fa(m);g.contains(f)?(f=a.gd.he(n,f,h),0==f?d=!0:1==f&&(b=!0)):d=!0;if(b&&d)return!0;k||(!a.ff.An(e,c.F()-1)||null!=e.pb&&null!=e.pb.Ab?n=e:(n=new a.Ka,e.copyTo(n),n.dj(1)),k=!0)}return!1};h.hQ=function(e,c,h){var g=new a.i,b=new a.i;e.o(g);c.o(b);if(!this.rc(g,b,h))return!1;b=this.fc(e,c,!1);if(4==b)return!1;if(1==b)return!0;var b=!1,d,f;f=e;for(var n=!1,k=0;k<c.F();k++){d=c.Fa(k);if(!g.contains(d))return!1;
d=a.gd.he(f,d,h);if(1==d)b=!0;else if(0==d)return!1;n||(!a.ff.An(e,c.F()-1)||null!=e.pb&&null!=e.pb.Ab?f=e:(f=new a.Ka,e.copyTo(f),f.dj(1)),n=!0)}return b};h.OG=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);if(!h.ye(g,d,b))return!1;g=new a.Ka;g.Wc(c,!1);return h.Vv(e,g,b,!0)};h.ER=function(e,c,b){var g=h.fc(e,c,!1);if(4==g)return!0;if(1==g||2==g)return!1;var d=new a.i,g=new a.i;e.o(d);c.o(g);if(h.rc(g,d,b))return!1;d=new a.b;g.Yl(d);c=a.gd.he(e,d,b);if(0!=c)return!1;g.YE(d);c=a.gd.he(e,d,
b);if(0!=c)return!1;g.Zl(d);c=a.gd.he(e,d,b);if(0!=c)return!1;g.aF(d);c=a.gd.he(e,d,b);if(0!=c)return!1;c=e.mc(0);d=new a.i;d.K(g);d.P(b,b);for(var f=0,n=e.F();f<n;f++){var k=c.read(2*f),m=c.read(2*f+1);if(d.contains(k,m))return!1}return!h.cA(e,g,b)};h.eH=function(e,c,b,d){var g=h.fc(e,c,!1);if(4==g||1==g||2==g)return!1;var g=new a.i,f=new a.i;e.o(g);c.o(f);if(h.rc(f,g,b))return!1;if(f.aa()<=b&&f.ba()<=b)return c=c.qq(),h.yD(e,c,b);if(f.aa()<=b||f.ba()<=b)return g=new a.Xa,f=new a.Va,c.uf(0,f),g.df(f),
c.uf(2,f),g.lineTo(f),h.CE(e,g,b,d);g=new a.Ka;g.Wc(c,!1);return h.AE(e,g,b,d)};h.WG=function(e,c,b,d){var g=h.fc(e,c,!1);if(4==g||1==g||2==g)return!1;var g=new a.i,f=new a.i;e.o(g);c.o(f);if(h.rc(f,g,b)||f.aa()<=b||f.ba()<=b)return!1;g=new a.Ka;g.Wc(c,!1);return h.wD(e,g,b,d)};h.DH=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);return h.rc(d,g,b)};h.WP=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);if(!h.rc(g,d,b))return!1;g=h.fc(e,c,!1);if(4==g||2==g)return!1;if(1==g)return!0;if(d.aa()<=
b&&d.ba()<=b)return c=c.qq(),h.YB(e,c,b);if(d.aa()<=b||d.ba()<=b)return d=new a.Xa,g=new a.Va,c.uf(0,g),d.df(g),c.uf(2,g),d.lineTo(g),h.jC(e,d,b,null);d=new a.Ka;d.Wc(c,!1);return h.bC(e,d,b,null)};h.zQ=function(e,c,b,d){var g=new a.i,f=new a.i;e.o(g);c.o(f);if(h.rc(f,g,b)||f.ba()>b&&f.aa()>b||f.ba()<=b&&f.aa()<=b)return!1;g=new a.Xa;f=new a.Va;c.uf(0,f);g.df(f);c.uf(2,f);g.lineTo(f);return h.YC(e,g,b,d)};h.QI=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);return h.ye(g,d,b)&&4!=h.fc(e,c,!1)?
h.jA(e,c,b)?!0:h.Vv(e,c,b,!1):!1};h.EI=function(e,c,b){return 4==this.fc(e,c,!1)?!0:(new a.cl(e,c,b,!0)).next()?!this.ED(e,c,b):!1};h.cF=function(e,c,b){if(4==h.fc(e,c,!1))return!1;var g=new a.qd(0);if(0!=h.Zv(e,c,b,g))return!1;for(var d=new a.pe,f=0;f<g.size;f+=2){var n=g.read(f),k=g.read(f+1);d.zs(n,k)}e=e.Rf();c=c.Rf();e.Pd(c,0,c.F());return h.lu(e,d,b)};h.LE=function(e,c,b){if(4==h.fc(e,c,!1))return!1;var g=new a.qd(0);if(0!=h.Zv(e,c,b,g))return!1;for(var d=new a.pe,f=0;f<g.size;f+=2){var n=g.read(f),
k=g.read(f+1);d.zs(n,k)}e=e.Rf();c=c.Rf();e.Pd(c,0,c.F());return!h.lu(e,d,b)};h.$I=function(a,c,b){return 4==h.fc(a,c,!1)?!1:h.iA(a,c,b)};h.JE=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);return h.rc(g,d,b)&&4!=h.fc(e,c,!1)?h.Wf(c,e,b,!1):!1};h.yI=function(a,c,b){if(4==h.fc(a,c,!1))return!0;c=c.w();return!h.ex(a,c,b)};h.MG=function(a,c,b){if(4==h.fc(a,c,!1))return!1;c=c.w();return h.bw(a,c,b)};h.KH=function(a,c,b){if(4==h.fc(a,c,!1))return!1;c=c.w();return h.bA(a,c,b)};h.vI=function(a,c,
b){return 4==h.fc(a,c,!1)?!0:!h.eA(a,c,b,!1)};h.fJ=function(e,c,b){if(4==this.fc(e,c,!1))return!1;var g=e.Ca(),h=new a.i,d=new a.i,f=new a.i;e.o(h);c.o(d);h.P(b,b);d.P(b,b);f.K(h);f.Ga(d);var n,k,h=null;n=e.pb;null!=n?(k=n.Ab,h=n.nn,null==k&&(k=n=a.Ia.ij(e,f))):k=n=a.Ia.ij(e,f);var m=k.Re(),p=null;null!=h&&(p=h.Re());var r=new a.b,u=new a.b,v=!1,q=b*b,h=new a.Wk(c.F());for(n=0;n<c.F();n++)h.write(n,0);for(n=0;n<c.F();n++)if(c.w(n,r),f.contains(r))if(d.K(r.x,r.y,r.x,r.y),null==p||(p.Ch(d,b),-1!=p.next())){m.Ch(d,
b);for(var x=m.next();-1!=x;x=m.next())if(g.Sb(k.da(x)),x=g.ia(),x.Kb(x.Gd(r,!1),u),a.b.Zb(r,u)<=q){h.write(n,1);v=!0;break}}if(!v)return!1;e=e.Rf();g=new a.pe;d=new a.b;for(n=0;n<c.F();n++)0!=h.read(n)&&(c.w(n,d),g.zs(d.x,d.y));return this.lu(e,g,b)};h.QH=function(e,c,b){if(4==this.fc(e,c,!1))return!1;var g=e.Ca(),h=new a.i,d=new a.i,f=new a.i;e.o(h);c.o(d);h.P(b,b);d.P(b,b);f.K(h);f.Ga(d);var n,k,h=null;n=e.pb;null!=n?(k=n.Ab,h=n.nn,null==k&&(k=n=a.Ia.ij(e,f))):k=n=a.Ia.ij(e,f);var m=k.Re(),p=null;
null!=h&&(p=h.Re());var r=new a.b,u=new a.b,v=!1,q=!1,x=b*b,h=new a.Wk(c.F());for(n=0;n<c.F();n++)h.write(n,0);for(n=0;n<c.F();n++)if(c.w(n,r),f.contains(r))if(d.K(r.x,r.y,r.x,r.y),null!=p&&(p.Ch(d,b),-1==p.next()))q=!0;else{m.Ch(d,b);for(var D=!1,B=m.next();-1!=B;B=m.next())if(g.Sb(k.da(B)),B=g.ia(),B.Kb(B.Gd(r,!1),u),a.b.Zb(r,u)<=x){h.write(n,1);D=v=!0;break}D||(q=!0)}else q=!0;if(!v||!q)return!1;e=e.Rf();g=new a.pe;d=new a.b;for(n=0;n<c.F();n++)0!=h.read(n)&&(c.w(n,d),g.zs(d.x,d.y));return!this.lu(e,
g,b)};h.IH=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);if(!h.rc(g,d,b)||4==h.fc(e,c,!1)||!h.eA(e,c,b,!0))return!1;e=e.Rf();return!h.nA(e,c,b)};h.MI=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);return d.ba()>b&&d.aa()>b?!1:h.ye(g,d,b)};h.nI=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);return h.rc(d,g,b)?!1:!h.cA(e,d,b)};h.cJ=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);if(d.ba()<=b&&d.aa()<=b)return d=c.qq(),h.bw(e,d,b);if(d.ba()<=b||d.aa()<=b)return d=new a.Xa,
g=new a.Va,c.uf(0,g),d.df(g),c.uf(2,g),d.lineTo(g),h.cF(e,d,b);e=e.Ca();c=new a.i;g=new a.i;c.K(d);g.K(d);c.P(-b,-b);g.P(b,b);for(var d=!1,f=new a.i,n=new a.i;e.kb();)for(;e.La();){e.ia().o(f);n.K(c);n.Ga(f);if(!n.s()&&(n.ba()>b||n.aa()>b))return!1;n.K(g);n.Ga(f);n.s()||(d=!0)}return d};h.XI=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);if(h.rc(g,d,b)||h.rc(d,g,b)||h.rc(d,g,b)||d.ba()>b&&d.aa()>b||d.ba()<=b&&d.aa()<=b)return!1;g=new a.Xa;d=new a.Va;c.uf(0,d);g.df(d);c.uf(2,d);g.lineTo(d);
return h.iA(e,g,b)};h.WJ=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);if(!h.rc(d,g,b)||d.ba()<=b&&d.aa()<=b)return!1;if(d.ba()<=b||d.aa()<=b)return h.rc(d,g,b);e=e.Ca();c=new a.i;c.K(d);c.P(-b,-b);for(var d=!1,g=new a.i,f=new a.i;e.kb();)for(;e.La();)e.ia().o(g),c.jl(g)?d=!0:(f.K(c),f.Ga(g),!f.s()&&(f.ba()>b||f.aa()>b)&&(d=!0));return d};h.GH=function(e,c,b){var g=new a.i,d=new a.i;c.o(d);e.o(g);if(!h.rc(g,d,b)||d.ba()>b&&d.aa()>b)return!1;if(d.ba()<=b&&d.aa()<=b)return c=c.qq(),h.bA(e,c,
b);g=new a.Xa;d=new a.Va;c.uf(0,d);g.df(d);c.uf(2,d);g.lineTo(d);return h.Wf(g,e,b,!1)};h.MH=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);if(h.rc(d,g,b)||d.ba()<=b&&d.aa()<=b)return!1;if(d.ba()<=b||d.aa()<=b)return g=new a.Xa,d=new a.Va,c.uf(0,d),g.df(d),c.uf(2,d),g.lineTo(d),h.LE(e,g,b);e=e.Ca();c=new a.i;g=new a.i;g.K(d);c.K(d);g.P(-b,-b);c.P(b,b);for(var f=d=!1,n=new a.i,k=new a.i;e.kb();)for(;e.La();)if(e.ia().o(n),f||c.contains(n)||(f=!0),d||(k.K(g),k.Ga(n),!k.s()&&(k.ba()>b||k.aa()>
b)&&(d=!0)),d&&f)return!0;return!1};h.LI=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);return h.ye(g,d,b)?h.OI(e,c,b)?!0:h.Pw(e,c,b,!1,!0,!1):!1};h.xI=function(a,c,b){return!h.nA(a,c,b)};h.bJ=function(a,c,b){return h.Pw(a,c,b,!1,!1,!0)};h.kA=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);return h.rc(g,d,b)?h.Pw(c,e,b,!0,!1,!1):!1};h.lu=function(e,c,b){b*=b;for(var g=new a.b,h=new a.b,d=0;d<c.F();d++){c.w(d,h);for(var f=!1,n=0;n<e.F();n++)if(e.w(n,g),a.b.Zb(g,h)<=b){f=!0;break}if(!f)return!1}return!0};
h.mu=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);return h.ye(g,d,b)};h.lA=function(a,c,b){c=c.w();return h.or(a,c,b)};h.HJ=function(a,c,b){return h.mu(a,c,b)};h.PH=function(a,c,b){return!h.lA(a,c,b)};h.DI=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);return d.ba()>b||d.aa()>b?!1:h.ye(g,d,b)};h.uI=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);if(h.rc(d,g,b))return!1;c=new a.i;c.K(d);c.P(b,b);b=new a.b;for(d=0;d<e.F();d++)if(e.w(d,b),c.contains(b))return!1;return!0};h.eJ=function(e,
c,b){var g=new a.i,h=new a.i,d=new a.i;c.o(g);if(g.ba()<=b&&g.aa()<=b)return!1;if(g.ba()<=b||g.aa()<=b){c=new a.b;var f=!1;h.K(g);d.K(g);h.P(b,b);g.ba()>b?d.P(0,-b):d.P(-b,0);for(var n=0;n<e.F();n++)if(e.w(n,c),h.contains(c)){if(g.ba()>b){if(c.y>d.C&&c.y<d.G)return!1}else if(c.x>d.v&&c.x<d.B)return!1;f=!0}return f}h.K(g);d.K(g);h.P(b,b);d.P(-b,-b);c=new a.b;f=!1;for(n=0;n<e.F();n++)if(e.w(n,c),h.contains(c)){if(d.jl(c))return!1;f=!0}return f};h.LG=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);
if(!h.rc(d,g,b))return!1;if(d.ba()<=b&&d.aa()<=b)return h.ye(g,d,b);if(d.ba()<=b||d.aa()<=b){c=!1;var g=new a.i,f=new a.i;g.K(d);f.K(d);d.ba()>b?g.P(0,-b):g.P(-b,0);f.P(b,b);for(var n=new a.b,k=0;k<e.F();k++){e.w(k,n);if(!f.contains(n))return!1;d.ba()>b?n.y>g.C&&n.y<g.G&&(c=!0):n.x>g.v&&n.x<g.B&&(c=!0)}return c}c=!1;g=new a.i;f=new a.i;g.K(d);f.K(d);g.P(-b,-b);f.P(b,b);n=new a.b;for(k=0;k<e.F();k++){e.w(k,n);if(!f.contains(n))return!1;g.jl(n)&&(c=!0)}return c};h.LH=function(e,c,b){var g=new a.i,d=
new a.i;e.o(g);c.o(d);if(!h.rc(g,d,b)||d.ba()>b||d.aa()>b)return!1;c=c.qq();return!h.or(e,c,b)};h.mI=function(e,c,b){var g=new a.i,d=new a.i;e.o(g);c.o(d);if(h.rc(d,g,b)||d.ba()<=b&&d.aa()<=b)return!1;if(d.ba()<=b||d.aa()<=b){c=new a.i;g=new a.i;c.K(d);d.ba()>b?c.P(0,-b):c.P(-b,0);g.K(d);g.P(b,b);for(var f=new a.b,n=!1,k=!1,m=0;m<e.F();m++)if(e.w(m,f),n||(d.ba()>b?f.y>c.C&&f.y<c.G&&(n=!0):f.x>c.v&&f.x<c.B&&(n=!0)),k||g.contains(f)||(k=!0),n&&k)return!0;return!1}c=new a.i;g=new a.i;c.K(d);c.P(-b,-b);
g.K(d);g.P(b,b);f=new a.b;k=n=!1;for(m=0;m<e.F();m++)if(e.w(m,f),!n&&c.jl(f)&&(n=!0),k||g.contains(f)||(k=!0),n&&k)return!0;return!1};h.dB=function(e,c,b){return a.b.Zb(e,c)<=b*b?!0:!1};h.rM=function(e,c,b){return a.b.Zb(e,c)>b*b?!0:!1};h.hz=function(a,c,b){return h.dB(a,c,b)};h.KA=function(e,c,b){var g=new a.i;g.K(e);return h.ye(g,c,b)};h.ru=function(e,c,b){var g=new a.i;g.K(c);g.P(b,b);return!g.contains(e)};h.ax=function(e,c,b){if(c.ba()<=b&&c.aa()<=b)return!1;var g=new a.i,h=new a.i;g.K(c);g.P(b,
b);if(!g.contains(e))return!1;if(c.ba()<=b||c.aa()<=b){h.K(c);c.ba()>b?h.P(0,-b):h.P(-b,0);if(c.ba()>b){if(e.y>h.C&&e.y<h.G)return!1}else if(e.x>h.v&&e.x<h.B)return!1;return!0}h.K(c);h.P(-b,-b);return h.jl(e)?!1:!0};h.bx=function(e,c,b){if(c.ba()<=b&&c.aa()<=b)return!0;if(c.ba()<=b||c.aa()<=b){var g=new a.i;g.K(c);c.ba()>b?g.P(0,-b):g.P(-b,0);var h=!1;c.ba()>b?e.y>g.C&&e.y<g.G&&(h=!0):e.x>g.v&&e.x<g.B&&(h=!0);return h}g=new a.i;g.K(c);g.P(-b,-b);return g.jl(e)};h.YL=function(a,c,b){return h.KA(a,
c,b)};h.ye=function(a,c,b){return h.rc(a,c,b)&&h.rc(c,a,b)};h.nj=function(e,c,b){var g=new a.i;g.K(c);g.P(b,b);return!e.jc(g)};h.kT=function(e,c,b){if(e.ba()<=b&&e.aa()<=b){var g=e.Af();return h.ax(g,c,b)}if(c.ba()<=b&&c.aa()<=b)return g=c.Af(),h.ax(g,e,b);e.ba()>b&&e.aa()>b&&(c.ba()<=b||c.aa()<=b)?g=c:(g=e,e=c);if(g.ba()<=b||g.aa()<=b){if(e.ba()<=b||e.aa()<=b){c=new a.yb;var d=new a.yb,f=[0,0],n=[0,0],k=new a.b;g.Yl(k);c.ed(k);g.Zl(k);c.vd(k);e.Yl(k);d.ed(k);e.Zl(k);d.vd(k);c.Ga(d,null,f,n,b);return 1!=
c.Ga(d,null,null,null,b)?!1:0==f[0]||1==f[1]||0==n[0]||1==n[1]}c=new a.i;d=new a.i;c.K(e);c.P(-b,-b);d.K(c);d.Ga(g);return!d.s()&&(d.ba()>b||d.aa()>b)?!1:!0}e.P(b,b);d=new a.i;d.K(g);d.Ga(e);return d.s()||!d.s()&&d.ba()>b&&d.aa()>b?!1:!0};h.fT=function(e,c,b){if(h.rc(e,c,b)||h.rc(c,e,b)||e.ba()<=b&&e.aa()<=b||c.ba()<=b&&c.aa()<=b)return!1;if(e.ba()<=b||e.aa()<=b){if(c.ba()>b&&c.aa()>b)return!1;var g=new a.yb,d=new a.yb,f=[0,0],n=[0,0],k=new a.b;e.Yl(k);g.ed(k);e.Zl(k);g.vd(k);c.Yl(k);d.ed(k);c.Zl(k);
d.vd(k);g.Ga(d,null,f,n,b);return 2!=g.Ga(d,null,null,null,b)?!1:(0<f[0]||1>f[1])&&(0<n[0]||1>n[1])}if(c.ba()<=b||c.aa()<=b)return!1;g=new a.i;g.K(e);g.Ga(c);return g.s()||g.ba()<=b||g.aa()<=b?!1:!0};h.Bz=function(e,c,b){if(!h.rc(e,c,b))return!1;if(e.ba()<=b&&e.aa()<=b)return e=e.Af(),h.bx(e,c,b);if(c.ba()<=b&&c.aa()<=b)return c=c.Af(),h.bx(c,e,b);if(e.ba()<=b||e.aa()<=b)return h.rc(e,c,b);if(c.ba()<=b||c.aa()<=b){var g=new a.i;g.K(e);g.P(-b,-b);if(g.jl(c))return!0;e=new a.i;e.K(g);e.Ga(c);return e.s()||
e.ba()<=b&&e.aa()<=b?!1:!0}return h.rc(e,c,b)};h.cT=function(e,c,b){if(h.rc(e,c,b)||h.rc(c,e,b)||e.ba()<=b&&e.aa()<=b||c.ba()<=b&&c.aa()<=b||c.ba()>b&&c.aa()>b&&e.ba()>b&&e.aa()>b)return!1;var g;e.ba()>b&&e.aa()>b?g=c:(g=e,e=c);if(e.ba()>b&&e.aa()>b){c=new a.i;var d=new a.i;d.K(e);d.P(-b,-b);c.K(d);c.Ga(g);return c.s()||c.ba()<=b&&c.aa()<=b?!1:!0}c=new a.yb;var d=new a.yb,f=[0,0],n=[0,0],k=new a.b;g.Yl(k);c.ed(k);g.Zl(k);c.vd(k);e.Yl(k);d.ed(k);e.Zl(k);d.vd(k);c.Ga(d,null,f,n,b);return 1!=c.Ga(d,
null,null,null,b)?!1:0<f[0]&&1>f[1]&&0<n[0]&&1>n[1]};h.ZC=function(e,c,b){var g,h,d=new a.i,f=new a.i,n=new a.cl(e,c,b,!0);if(!n.next())return!0;if(this.ED(e,c,b))return!1;var k;k=e;var m;m=null;1736==c.D()&&(m=c);var p=!1,r=!1;do{g=n.jk();h=n.ek();h=c.Fa(c.Ea(h));d.K(n.Fw());d.P(b,b);if(d.contains(h)&&(h=a.gd.he(k,h,0),0!=h)||1736==c.D()&&(g=e.Fa(e.Ea(g)),f.K(n.jw()),f.P(b,b),f.contains(g)&&(h=a.gd.he(m,g,0),0!=h)))return!1;p||(!a.ff.An(e,c.ea()-1)||null!=e.pb&&null!=e.pb.Ab?k=e:(k=new a.Ka,e.copyTo(k),
k.dj(1)),p=!0);1736!=c.D()||r||(r=c,!a.ff.An(r,e.ea()-1)||null!=c.pb&&null!=c.pb.Ab?m=c:(m=new a.Ka,r.copyTo(m),m.dj(1)),r=!0)}while(n.next());return!0};h.rc=function(e,c,b){var g=new a.i;g.K(e);g.P(b,b);return g.contains(c)};h.lm=function(e,c,b){var g=new a.i;g.K(c);g.P(b,b);c=new a.b;e.Yl(c);if(!g.contains(c))return!0;e.YE(c);if(!g.contains(c))return!0;e.aF(c);if(!g.contains(c))return!0;e.Zl(c);return g.contains(c)?!1:!0};h.jA=function(e,c,b){if(e.ea()!=c.ea()||e.F()!=c.F())return!1;var g=new a.b,
h=new a.b,d=!0;b*=b;for(var f=0;f<e.ea();f++){if(e.Dc(f)!=c.Dc(f)){d=!1;break}for(var n=e.Ea(f);n<c.Dc(f);n++)if(e.w(n,g),c.w(n,h),a.b.Zb(g,h)>b){d=!1;break}if(!d)break}return d?!0:!1};h.OI=function(e,c,b){if(e.F()!=c.F())return!1;var g=new a.b,h=new a.b,d=!0;b*=b;for(var f=0;f<e.F();f++)if(e.w(f,g),c.w(f,h),a.b.Zb(g,h)>b){d=!1;break}return d?!0:!1};h.Pw=function(e,c,b,h,d,f){var g=!1,n;e.F()>c.F()?(h&&(h=!1,g=!0),n=c):(n=e,e=c);c=null;if(d||f||g){c=new a.Wk(e.F());for(var k=0;k<e.F();k++)c.write(k,
0)}var k=new a.i,m=new a.i,p=new a.i;n.o(k);e.o(m);k.P(b,b);m.P(b,b);p.K(k);p.Ga(m);for(var m=new a.b,r=new a.b,u=!0,v=a.Ia.oB(e,p),q=v.Re(),x=b*b,D=0;D<n.F();D++)if(n.w(D,m),p.contains(m)){var B=!1;k.K(m.x,m.y,m.x,m.y);q.Ch(k,b);for(var t=q.next();-1!=t&&!(t=v.da(t),e.w(t,r),a.b.Zb(m,r)<=x&&((d||f||g)&&c.write(t,1),B=!0,h));t=q.next());if(!B&&(u=!1,d||h))return!1}else{if(d||h)return!1;u=!1}if(f&&u)return!1;if(h)return!0;for(k=0;k<e.F();k++)if(1==c.read(k)){if(f)return!0}else if(d||g)return!1;return f?
!1:!0};h.nA=function(e,c,b){var g;e.F()>c.F()?g=c:(g=e,e=c);c=new a.i;var h=new a.i,d=new a.i;g.o(c);e.o(h);c.P(b,b);h.P(b,b);d.K(c);d.Ga(h);for(var h=new a.b,f=new a.b,n=b*b,k=a.Ia.oB(e,d),m=k.Re(),p=0;p<g.F();p++)if(g.w(p,h),d.contains(h)){c.K(h.x,h.y,h.x,h.y);m.Ch(c,b);for(var r=m.next();-1!=r;r=m.next())if(e.w(k.da(r),f),a.b.Zb(h,f)<=n)return!0}return!1};h.Vv=function(a,c,b,d){return h.Wf(a,c,b,d)&&h.Wf(c,a,b,d)};h.Wf=function(e,g,b,d){function f(a,e){return u.IB(a,e)}var n=!0,k=[0,0],m=[0,0],
p=0,r=new a.ga(0),u=new h,v,q=new a.i,x=new a.i,D=new a.i;e.o(q);g.o(x);q.P(b,b);x.P(b,b);D.K(q);D.Ga(x);e=e.Ca();var x=g.Ca(),B=null,t=B=null,z=g.pb;null!=z?(B=z.Ab,t=z.nn,null==B&&(B=a.Ia.ij(g,D))):B=a.Ia.ij(g,D);g=B.Re();z=null;for(null!=t&&(z=t.Re());e.kb();)for(;e.La();){var y=!1,C=e.ia();C.o(q);if(!q.jc(D))return!1;if(null!=z&&(z.Ch(q,b),-1==z.next()))return n=!1;t=C.$b();g.Fn(C,b);for(v=g.next();-1!=v;v=g.next()){x.Sb(B.da(v));v=x.ia();var l=C.Ga(v,null,k,m,b);if(2==l&&(!d||m[0]<=m[1])){var l=
k[0],A=k[1],E=m[0],I=m[1];if(l*t<=b&&(1-A)*t<=b){y=!0;p=0;r.resize(0);u.Tg.length=0;for(var G=e.Jb(),E=!0;E;){if(e.La()){C=e.ia();t=C.$b();l=C.Ga(v,null,k,m,b);if(2==l&&(!d||m[0]<=m[1])&&(l=k[0],A=k[1],l*t<=b&&(1-A)*t<=b)){G=e.Jb();continue}if(x.La()&&(v=x.ia(),l=C.Ga(v,null,k,m,b),2==l&&(!d||m[0]<=m[1])&&(l=k[0],A=k[1],l*t<=b&&(1-A)*t<=b))){G=e.Jb();continue}}E=!1}G!=e.Jb()&&(e.Sb(G),e.ia());break}else G=e.Jb(),v=c.Oa(G,e.Qa,l,A,x.Jb(),x.Qa,E,I),u.Tg.push(v),r.add(r.size)}}if(!y){if(p==u.Tg.length)return!1;
1<r.size-p&&r.xd(p,r.size,f);for(y=0;p<u.Tg.length;p++)if(v=u.Tg[r.get(p)],!(v.Oi<y&&v.ji<y)){if(t*(v.Oi-y)>b)return!1;y=v.ji;if(t*(1-y)<=b||1==y)break}if(t*(1-y)>b)return!1;p=0;r.resize(0);u.Tg.length=0}}return n};h.iA=function(e,c,b){if(1>h.Zv(e,c,b,null))return!1;var g=new a.i,d=new a.i;e.o(g);c.o(d);var f=h.lm(g,d,b),g=h.lm(d,g,b);return f&&g?!0:f&&!g?!h.Wf(c,e,b,!1):g&&!f?!h.Wf(e,c,b,!1):!h.Wf(e,c,b,!1)&&!h.Wf(c,e,b,!1)};h.Zv=function(e,g,b,d){function f(a,e){return x.IB(a,e)}var n,k;e.Iw()>
g.Iw()?(n=g,k=e):(n=e,k=g);e=n.Ca();g=k.Ca();var m=[0,0],p=[0,0],r=-1,u=0,v,q=new a.ga(0),x=new h,D,B=new a.i,t=new a.i,z=new a.i;n.o(B);k.o(t);B.P(b,b);t.P(b,b);z.K(B);z.Ga(t);n=null;null!=d&&(n=new a.b);v=t=t=null;var y=k.pb;null!=y?(t=y.Ab,v=y.nn,null==t&&(t=a.Ia.ij(k,z))):t=a.Ia.ij(k,z);k=t.Re();y=null;for(null!=v&&(y=v.Re());e.kb();)for(v=0;e.La();){var C=e.ia();C.o(B);if(B.jc(z)&&(null==y||(y.Ch(B,b),-1!=y.next()))){var l=C.$b();k.Fn(C,b);for(var A=k.next();-1!=A;A=k.next()){var E=t.da(A);g.Sb(E);
D=g.ia();var I=D.$b(),G=C.Ga(D,null,m,p,b);if(0<G){var A=m[0],r=p[0],H=2==G?m[1]:NaN,K=2==G?p[1]:NaN;if(2==G){if(l*(H-A)>b)return r=1;var J=l*(H-A);if(g.La()){D=g.ia();G=C.Ga(D,null,m,null,b);if(2==G){var G=m[0],w=m[1],G=l*(w-G);if(J+G>b)return r=1}g.Sb(E);g.ia()}if(!g.wl()){g.oi();D=g.oi();G=C.Ga(D,null,m,null,b);if(2==G&&(G=m[0],w=m[1],G=l*(w-G),J+G>b))return r=1;g.Sb(E);g.ia()}if(e.La()){E=e.Jb();C=e.ia();G=C.Ga(D,null,m,null,b);if(2==G&&(G=m[0],w=m[1],G=l*(w-G),J+G>b))return r=1;e.Sb(E);e.ia()}if(!e.wl()){E=
e.Jb();e.oi();C=e.oi();G=C.Ga(D,null,m,null,b);if(2==G&&(G=m[0],w=m[1],G=I*(w-G),J+G>b))return r=1;e.Sb(E);e.ia()}D=c.Oa(e.Jb(),e.Qa,A,H,g.Jb(),g.Qa,r,K);x.Tg.push(D);q.add(q.size)}r=0;null!=d&&(C.Kb(A,n),d.add(n.x),d.add(n.y))}}if(u<x.Tg.length){q.xd(u,q.size,f);C=0;for(A=x.Tg[q.get(u)].Jl;u<x.Tg.length;u++)if(D=x.Tg[q.get(u)],!(D.Oi<C&&D.ji<C))if(l*(D.Oi-C)>b)v=l*(D.ji-D.Oi),C=D.ji,A=D.Jl;else{D.Jl!=A?(v=l*(D.ji-D.Oi),A=D.Jl):v+=l*(D.ji-D.Oi);if(v>b)return r=1;C=D.ji;if(1==C)break}l*(1-C)>b&&(v=
0);u=0;q.resize(0);x.Tg.length=0}}}return r};h.ED=function(e,c,b){var g=e.Ca(),h=c.Ca();for(e=new a.cl(e,c,b,!1);e.next();){c=e.jk();var d=e.ek();g.Sb(c);h.Sb(d);c=g.ia();if(0<h.ia().Ga(c,null,null,null,b))return!0}return!1};h.eA=function(e,c,b,h){var g=e.Ca(),d=new a.i,f=new a.i,n=new a.i;e.o(d);c.o(f);d.P(b,b);d.contains(f);f.P(b,b);n.K(d);n.Ga(f);d=e.pb;null!=d?(d=d.Ab,null==d&&(d=a.Ia.ij(e,n))):d=a.Ia.ij(e,n);e=d.Re();for(var k=new a.b,m=new a.b,p=b*b,r=0;r<c.F();r++)if(c.w(r,k),n.contains(k)){f.K(k.x,
k.y,k.x,k.y);e.Ch(f,b);for(var u=!1,v=e.next();-1!=v;v=e.next())if(g.Sb(d.da(v)),v=g.ia(),v.Kb(v.Gd(k,!1),m),a.b.Zb(m,k)<=p){u=!0;break}if(h){if(!u)return!1}else if(u)return!0}return h?!0:!1};h.ex=function(e,c,b){var g=new a.b,h=b*b,d=e.Ca();e=e.pb;if(null!=e&&(e=e.Ab,null!=e)){var f=new a.i;f.K(c);b=e.xw(f,b);for(f=b.next();-1!=f;f=b.next())if(d.Sb(e.da(f)),d.La()){var f=d.ia(),n=f.Gd(c,!1);f.Kb(n,g);if(a.b.Zb(c,g)<=h)return!0}return!1}for(e=new a.i;d.kb();)for(;d.La();)if(f=d.ia(),f.o(e),e.P(b,
b),e.contains(c)&&(n=f.Gd(c,!1),f.Kb(n,g),a.b.Zb(c,g)<=h))return!0;return!1};h.bA=function(a,c,b){return h.ex(a,c,b)&&!h.bw(a,c,b)};h.bw=function(a,c,b){a=a.Rf();return!h.or(a,c,b)};h.cA=function(e,c,b){if(e.Hm()){var g=new a.yb(c.v,c.C,c.v,c.G),h=new a.yb(c.v,c.G,c.B,c.G),d=new a.yb(c.B,c.G,c.B,c.C);c=new a.yb(c.B,c.C,c.v,c.C);for(e=e.Ca();e.kb();)for(;e.La();){var f=e.ia();if(f.jc(g,b)||f.jc(h,b)||f.jc(d,b)||f.jc(c,b))return!0}}else{g=new a.i;g.K(c);g.P(b,b);b=e.mc(0);h=new a.b;d=new a.b;c=new a.b;
for(var f=new a.b,n=0,k=e.ea();n<k;n++)for(var m=!0,p=e.Ea(n),r=e.Dc(n);p<r;p++)if(m)b.ec(2*p,d),m=!1;else{b.ec(2*p,h);c.J(d);f.J(h);if(0!=g.Nv(c,f))return!0;d.J(h)}}return!1};h.fc=function(e,c,b){var g=e.D(),d=c.D();if(a.T.Th(g)){var f=e.pb;if(null!=f&&(f=f.hi,null!=f))if(33==d){var n=c.w(),n=f.Kk(n.x,n.y);if(1==n)return 1;if(0==n)return 4}else{n=new a.i;c.o(n);n=f.Dn(n);if(1==n)return 1;if(0==n)return 4;if(b&&a.T.Th(d)&&h.zz(c,f))return 1073741824}}if(a.T.Th(d)&&(f=c.pb,null!=f&&(f=f.hi,null!=f)))if(33==
g){e=e.w();n=f.Kk(e.x,e.y);if(1==n)return 2;if(0==n)return 4}else{c=new a.i;e.o(c);n=f.Dn(c);if(1==n)return 2;if(0==n)return 4;if(b&&a.T.Th(g)&&h.zz(e,f))return 1073741824}return 0};h.zz=function(e,c){for(var g=e.F(),b=new a.b,h=0;h<g;h++)if(e.w(h,b),1==c.Kk(b.x,b.y))return!0;return!1};h.AE=function(e,c,b,h){for(var g=1<=e.rj(0)&&1<=c.rj(0),d=e.Ca(),f=c.Ca(),n=[0,0],k=[0,0],m=new a.cl(e,c,b,!1),p=!1;m.next();){var r=m.jk(),u=m.ek();d.Sb(r);f.Sb(u);r=d.ia();u=f.ia().Ga(r,null,k,n,b);if(2==u){p=n[0];
u=n[1];r=r.$b();if(g&&(u-p)*r>b)return!1;p=!0}else if(0!=u){p=n[0];r=k[0];if(0<p&&1>p&&0<r&&1>r)return!1;p=!0}}if(!p)return!1;d=new a.i;f=new a.i;g=new a.i;e.o(d);c.o(f);d.P(1E3*b,1E3*b);f.P(1E3*b,1E3*b);g.K(d);g.Ga(f);return 10<e.F()&&(e=a.Ed.clip(e,g,b,0),e.s())||10<c.F()&&(c=a.Ed.clip(c,g,b,0),c.s())?!1:a.el.vr(e,c,b,"F********",h)};h.wD=function(e,c,b,d){var g=1<=e.rj(0)&&1<=c.rj(0),f=new a.i,n=new a.i,k=new a.i;e.o(f);c.o(n);for(var m=!1,p=h.lm(f,n,b),r=h.lm(n,f,b),u=e.Ca(),v=c.Ca(),q=[0,0],
x=[0,0],D=new a.cl(e,c,b,!1);D.next();){var B=D.jk(),t=D.ek();u.Sb(B);v.Sb(t);t=u.ia();B=v.ia().Ga(t,null,x,q,b);if(2==B){var B=q[0],z=q[1],t=t.$b();if(g&&(z-B)*t>b&&(m=!0,p&&r))return!0}else if(0!=B&&(B=q[0],t=x[0],0<B&&1>B&&0<t&&1>t))return!0}g=new a.i;u=new a.i;g.K(f);g.P(1E3*b,1E3*b);u.K(n);u.P(1E3*b,1E3*b);k.K(g);k.Ga(u);f="";f=m?f+"**":f+"T*";if(p){if(10<c.F()&&(c=a.Ed.clip(c,k,b,0),c.s()))return!1;f+="****"}else f+="T***";if(r){if(10<e.F()&&(e=a.Ed.clip(e,k,b,0),e.s()))return!1;f+="***"}else f+=
"T**";return a.el.vr(e,c,b,f.toString(),d)};h.bC=function(e,c,b,d){var g=[!1],f=h.wB(e,c,b,g);if(g[0])return f;g=new a.i;c.o(g);g.P(1E3*b,1E3*b);return 10<e.F()&&(e=a.Ed.clip(e,g,b,0),e.s())?!1:a.el.su(e,c,b,d)};h.wB=function(e,c,b,h){h[0]=!1;for(var g=e.Ca(),d=c.Ca(),f=[0,0],n=[0,0],k=new a.cl(e,c,b,!1),m=!1;k.next();){var p=k.jk(),r=k.ek();g.Sb(p,-1);d.Sb(r,-1);p=g.ia();p=d.ia().Ga(p,null,n,f,b);if(0!=p&&(m=!0,1==p&&(p=f[0],r=n[0],0<p&&1>p&&0<r&&1>r)))return h[0]=!0,!1}if(!m){h[0]=!0;f=new a.i;
e.o(f);f.P(b,b);k=e;m=!1;n=new a.i;h=0;for(g=c.ea();h<g;h++)if(0<c.Ha(h)){c.Ti(h,n);if(f.jc(n)){if(d=c.Fa(c.Ea(h)),d=a.ff.xl(k,d,0),0==d)return!1}else return!1;m||(!a.ff.An(e,c.ea()-1)||null!=e.pb&&null!=e.pb.Ab?k=e:(d=new a.Ka,e.copyTo(d),d.dj(1),k=d),m=!0)}if(1==e.ea()||1607==c.D())return!0;f=new a.i;c.o(f);f.P(b,b);n=c;k=!1;b=new a.i;h=0;for(g=e.ea();h<g;h++)if(0<e.Ha(h)){e.Ti(h,b);if(f.jc(b)&&(d=e.Fa(e.Ea(h)),d=a.ff.xl(n,d,0),1==d))return!1;k||(!a.ff.An(c,e.ea()-1)||null!=c.pb&&null!=c.pb.Ab?
n=c:(d=new a.Ka,c.copyTo(d),d.dj(1),n=d),k=!0)}return!0}return!1};h.CE=function(e,c,b,h){for(var g=e.Ca(),d=c.Ca(),f=[0,0],n=[0,0],k=new a.cl(e,c,b,!1),m=!1;k.next();){var p=k.jk(),r=k.ek();g.Sb(p);d.Sb(r);p=g.ia();p=d.ia().Ga(p,null,n,f,b);if(2==p)m=!0;else if(0!=p){m=f[0];p=n[0];if(0<m&&1>m&&0<p&&1>p)return!1;m=!0}}if(!m)return!1;d=new a.i;f=new a.i;g=new a.i;e.o(d);c.o(f);d.P(1E3*b,1E3*b);f.P(1E3*b,1E3*b);g.K(d);g.Ga(f);return 10<e.F()&&(e=a.Ed.clip(e,g,b,0),e.s())||10<c.F()&&(c=a.Ed.clip(c,g,
b,0),c.s())?!1:a.el.Vl(e,c,b,"F********",h)};h.YC=function(e,c,b,d){for(var g=e.Ca(),f=c.Ca(),n=[0,0],k=[0,0],m=new a.cl(e,c,b,!1),p=!1;m.next();){var r=m.jk(),u=m.ek();g.Sb(r);f.Sb(u);r=g.ia();r=f.ia().Ga(r,null,k,n,b);if(2==r)p=!0;else if(0!=r){p=n[0];r=k[0];if(0<p&&1>p&&0<r&&1>r)return!0;p=!0}}if(!p)return!1;f=new a.i;n=new a.i;k=new a.i;m=new a.i;g=new a.i;e.o(f);c.o(n);return h.lm(n,f,b)?(k.K(f),k.P(1E3*b,1E3*b),m.K(n),m.P(1E3*b,1E3*b),g.K(k),g.Ga(m),10<e.F()&&(e=a.Ed.clip(e,g,b,0),e.s())||10<
c.F()&&(c=a.Ed.clip(c,g,b,0),c.s())?!1:b=a.el.Vl(e,c,b,"T********",d)):b=a.el.Vl(e,c,b,"T*****T**",d)};h.jC=function(e,c,b,d){var g=[!1],f=h.wB(e,c,b,g);if(g[0])return f;g=new a.i;c.o(g);g.P(1E3*b,1E3*b);return 10<e.F()&&(e=a.Ed.clip(e,g,b,0),e.s())?!1:a.el.dy(e,c,b,d)};h.YB=function(e,c,b){return 1==a.gd.he(e,c,b)?!0:!1};h.yD=function(e,c,b){return 2==a.gd.he(e,c,b)?!0:!1};h.or=function(e,c,b){var g=new a.b;b*=b;for(var h=0;h<e.F();h++)if(e.w(h,g),a.b.Zb(g,c)<=b)return!1;return!0};h.prototype.IB=
function(a,c){a=this.Tg[a];c=this.Tg[c];return a.Jl<c.Jl||a.Jl==c.Jl&&(a.Wt<c.Wt||a.Wt==c.Wt&&(a.Oi<c.Oi||a.Oi==c.Oi&&(a.ji<c.ji||a.ji==c.ji&&a.dE<c.dE)))?-1:1};return h}();a.hd=b})(B||(B={}));(function(a){var c;(function(a){a[a.InteriorInterior=0]="InteriorInterior";a[a.InteriorBoundary=1]="InteriorBoundary";a[a.InteriorExterior=2]="InteriorExterior";a[a.BoundaryInterior=3]="BoundaryInterior";a[a.BoundaryBoundary=4]="BoundaryBoundary";a[a.BoundaryExterior=5]="BoundaryExterior";a[a.ExteriorInterior=
6]="ExteriorInterior";a[a.ExteriorBoundary=7]="ExteriorBoundary";a[a.ExteriorExterior=8]="ExteriorExterior"})(c||(c={}));var b;(function(a){a[a.AreaAreaPredicates=0]="AreaAreaPredicates";a[a.AreaLinePredicates=1]="AreaLinePredicates";a[a.LineLinePredicates=2]="LineLinePredicates";a[a.AreaPointPredicates=3]="AreaPointPredicates";a[a.LinePointPredicates=4]="LinePointPredicates";a[a.PointPointPredicates=5]="PointPointPredicates"})(b||(b={}));c=function(){function c(){this.Xd=0;this.h=new a.gs;this.A=
[0,0,0,0,0,0,0,0,0];this.Ta=[0,0,0,0,0,0,0,0,0];this.Y=[!1,!1,!1,!1,!1,!1,!1,!1,!1];this.Nl=this.$t=-1}c.py=function(e,c,b,h,d){if(9!=h.length)throw a.g.ra("relation string length has to be 9 characters");for(var g=0;9>g;g++){var f=h.charAt(g);if("*"!=f&&"T"!=f&&"F"!=f&&"0"!=f&&"1"!=f&&"2"!=f)throw a.g.ra("relation string");}g=this.YN(h,e.fb(),c.fb());if(0!=g)return a.hd.qy(e,c,b,g,d);g=new a.i;e.o(g);f=new a.i;c.o(f);var n=new a.i;n.K(g);n.Db(f);b=a.Ia.zd(b,n,!1);e=this.NB(e,b);c=this.NB(c,b);if(e.s()||
c.s())return this.rR(e,c,h);g=c.D();f=!1;switch(e.D()){case 1736:switch(g){case 1736:f=this.vr(e,c,b,h,d);break;case 1607:f=this.Vl(e,c,b,h,d);break;case 33:f=this.ur(e,c,b,h,d);break;case 550:f=this.tr(e,c,b,h,d)}break;case 1607:switch(g){case 1736:f=this.Vl(c,e,b,this.Lo(h),d);break;case 1607:f=this.ey(e,c,b,h,d);break;case 33:f=this.xr(e,c,b,h,d);break;case 550:f=this.wr(e,c,b,h,d)}break;case 33:switch(g){case 1736:f=this.ur(c,e,b,this.Lo(h),d);break;case 1607:f=this.xr(c,e,b,this.Lo(h),d);break;
case 33:f=this.KQ(e,c,b,h);break;case 550:f=this.pr(c,e,b,this.Lo(h),d)}break;case 550:switch(g){case 1736:f=this.tr(c,e,b,this.Lo(h),d);break;case 1607:f=this.wr(c,e,b,this.Lo(h),d);break;case 550:f=this.Wx(e,c,b,h,d);break;case 33:f=this.pr(e,c,b,h,d)}break;default:f=!1}return f};c.vr=function(e,g,b,h,d){var f=new c;f.pi();f.si(h);f.vF();var n=new a.i,k=new a.i;e.o(n);g.o(k);h=!1;a.hd.nj(n,k,b)&&(f.Bs(e,g),h=!0);h||(n=a.hd.fc(e,g,!1),4==n?(f.Bs(e,g),h=!0):1==n?(f.Bv(g),h=!0):2==n&&(f.$A(e),h=!0));
h||(h=new a.fd,e=h.Eb(e),g=h.Eb(g),f.In(h,b,d),f.so(e,g),f.h.xg());return c.Mf(f.A,f.Hc)};c.su=function(e,g,b,h){var d=new c;d.pi();d.si("T*****F**");d.vF();var f=new a.i,n=new a.i;e.o(f);g.o(n);var k=!1;a.hd.nj(f,n,b)&&(d.Bs(e,g),k=!0);k||(f=a.hd.fc(e,g,!1),4==f?(d.Bs(e,g),k=!0):1==f?(d.Bv(g),k=!0):2==f&&(d.$A(e),k=!0));if(k)return f=this.Mf(d.A,d.Hc);k=new a.fd;e=k.Eb(e);f=k.Eb(g);a.aj.$(k,b,h,!1);b=k.hf(f).Rf();k.xo(0,!0,!0);a.mm.$(k,e,-1,!1,h);if(0==k.F(e))return!1;a.mm.$(k,f,-1,!1,h);d.Op(k,
h);g=0==k.F(f);if(!g&&(d.so(e,f),d.h.xg(),f=this.Mf(d.A,d.Hc),!f))return f;e=k.hf(e);k=new a.fd;e=k.Eb(e);f=k.Eb(b);d.Op(k,h);d.Xd=0;d.pi();d.si(g?"T*****F**":"******F**");d.wy();d.so(e,f);d.h.xg();return f=this.Mf(d.A,d.Hc)};c.Vl=function(e,g,b,h,d){var f=new c;f.pi();f.si(h);f.wy();var n=new a.i,k=new a.i;e.o(n);g.o(k);h=!1;a.hd.nj(n,k,b)&&(f.Cs(e,g),h=!0);h||(n=a.hd.fc(e,g,!1),4==n?(f.Cs(e,g),h=!0):1==n&&(f.aB(g),h=!0));h||(h=new a.fd,e=h.Eb(e),g=h.Eb(g),f.In(h,b,d),f.Jg=f.h.uo(),c.es(g,f.h,f.Jg),
f.so(e,g),f.h.vo(f.Jg),f.h.xg());return c.Mf(f.A,f.Hc)};c.dy=function(e,g,b,h){var d=new c;d.pi();d.si("T*****F**");d.wy();var f=new a.i,n=new a.i;e.o(f);g.o(n);var k=!1;a.hd.nj(f,n,b)&&(d.Cs(e,g),k=!0);k||(f=a.hd.fc(e,g,!1),4==f?(d.Cs(e,g),k=!0):1==f&&(d.aB(g),k=!0));if(k)return b=this.Mf(d.A,d.Hc);k=new a.fd;e=k.Eb(e);g=k.Eb(g);d.In(k,b,h);if(0==k.F(e))return!1;d.so(e,g);d.h.xg();return b=this.Mf(d.A,d.Hc)};c.tr=function(e,g,b,h,d){var f=new c;f.pi();f.si(h);f.wF();var n=new a.i,k=new a.i;e.o(n);
g.o(k);h=!1;a.hd.nj(n,k,b)&&(f.Ds(e),h=!0);h||(n=a.hd.fc(e,g,!1),4==n?(f.Ds(e),h=!0):1==n&&(f.cK(),h=!0));h||(h=new a.fd,e=h.Eb(e),g=h.Eb(g),f.In(h,b,d),f.Pv(e,g),f.h.xg());return c.Mf(f.A,f.Hc)};c.ey=function(e,g,b,h,d){var f=new c;f.pi();f.si(h);f.ZR();h=new a.i;var n=new a.i;e.o(h);g.o(n);var k=!1;a.hd.nj(h,n,b)&&(f.CD(e,g),k=!0);k||4!=a.hd.fc(e,g,!1)||(f.CD(e,g),k=!0);k||(h=new a.fd,e=h.Eb(e),g=h.Eb(g),f.In(h,b,d),f.ph=f.h.uo(),f.Jg=f.h.uo(),c.es(e,f.h,f.ph),c.es(g,f.h,f.Jg),f.so(e,g),f.h.vo(f.ph),
f.h.vo(f.Jg),f.h.xg());return c.Mf(f.A,f.Hc)};c.wr=function(e,g,b,h,d){var f=new c;f.pi();f.si(h);f.KF();h=new a.i;var n=new a.i;e.o(h);g.o(n);var k=!1;a.hd.nj(h,n,b)&&(f.dx(e),k=!0);k||4!=a.hd.fc(e,g,!1)||(f.dx(e),k=!0);k||(h=new a.fd,e=h.Eb(e),g=h.Eb(g),f.In(h,b,d),f.ph=f.h.uo(),c.es(e,f.h,f.ph),f.Pv(e,g),f.h.vo(f.ph),f.h.xg());return c.Mf(f.A,f.Hc)};c.Wx=function(e,g,b,h,d){var f=new c;f.pi();f.si(h);f.PF();h=new a.i;var n=new a.i;e.o(h);g.o(n);var k=!1;a.hd.nj(h,n,b)&&(f.PE(),k=!0);k||(h=new a.fd,
e=h.Eb(e),g=h.Eb(g),f.In(h,b,d),f.Pv(e,g),f.h.xg());return c.Mf(f.A,f.Hc)};c.ur=function(e,g,b,h){var d=new c;d.pi();d.si(h);d.wF();var f=new a.i;e.o(f);g=g.w();var n=!1;a.hd.ru(g,f,b)&&(d.Ds(e),n=!0);n||(b=a.gd.he(e,g,b),1==b?(d.A[0]=0,d.A[2]=2,d.A[3]=-1,d.A[5]=1,d.A[6]=-1):2==b?(d.A[6]=-1,0!=e.Mh()?(d.A[0]=-1,d.A[3]=0,d.A[2]=2,d.A[5]=1):(d.A[0]=0,d.A[3]=-1,d.A[5]=-1,b=new a.i,e.o(b),d.A[2]=0==b.ba()&&0==b.aa()?-1:1)):d.Ds(e));return this.Mf(d.A,h)};c.xr=function(e,g,b,h,d){var f=new c;f.pi();f.si(h);
f.KF();var n=new a.i;e.o(n);h=g.w();var k=!1;a.hd.ru(h,n,b)&&(f.dx(e),k=!0);if(!k){var n=null,m=k=!1;if(f.Y[0]||f.Y[6])a.hd.ex(e,h,b)?(f.Y[0]&&(n=a.Hh.il(e,d),m=!a.hd.or(n,h,b),k=!0,f.A[0]=m?-1:0),f.A[6]=-1):(f.A[0]=-1,f.A[6]=0);f.Y[3]&&(null!=n&&n.s()?f.A[3]=-1:(k||(null==n&&(n=a.Hh.il(e,d)),m=!a.hd.or(n,h,b),k=!0),f.A[3]=m?0:-1));f.Y[5]&&(null!=n&&n.s()?f.A[5]=-1:k&&!m?f.A[5]=0:(null==n&&(n=a.Hh.il(e,d)),d=a.hd.mu(n,g,b),f.A[5]=d?-1:0));f.Y[2]&&(0!=e.$b()?f.A[2]=1:(d=new a.pe(e.description),d.Pd(e,
0,e.F()),e=a.hd.mu(d,g,b),f.A[2]=e?-1:0))}return this.Mf(f.A,f.Hc)};c.pr=function(e,g,b,h){var d=new c;d.pi();d.si(h);d.PF();var f=new a.i;e.o(f);g=g.w();var n=!1;a.hd.ru(g,f,b)&&(d.PE(),n=!0);if(!n){f=!1;n=!0;b*=b;for(var k=0;k<e.F();k++){var m=e.Fa(k);a.b.Zb(m,g)<=b?f=!0:n=!1;if(f&&!n)break}f?(d.A[0]=0,d.A[2]=n?-1:0,d.A[6]=-1):(d.A[0]=-1,d.A[2]=0,d.A[6]=0)}return c.Mf(d.A,h)};c.KQ=function(e,g,b,h){e=e.w();g=g.w();for(var d=[],f=0;9>f;f++)d[f]=-1;a.b.Zb(e,g)<=b*b?d[0]=0:(d[2]=0,d[6]=0);d[8]=2;return c.Mf(d,
h)};c.Mf=function(a,c){for(var e=0;9>e;e++)switch(c.charAt(e)){case "T":if(-1==a[e])return!1;break;case "F":if(-1!=a[e])return!1;break;case "0":if(0!=a[e])return!1;break;case "1":if(1!=a[e])return!1;break;case "2":if(2!=a[e])return!1}return!0};c.rR=function(e,c,b){var g=[-1,-1,-1,-1,-1,-1,-1,-1,-1];if(e.s()&&c.s()){for(var h=0;9>h;h++)g[h]=-1;return this.Mf(g,b)}h=!1;e.s()&&(e=c,h=!0);g[0]=-1;g[1]=-1;g[3]=-1;g[4]=-1;g[6]=-1;g[7]=-1;g[8]=2;c=e.D();a.T.Kc(c)?1736==c?0!=e.Mh()?(g[2]=2,g[5]=1):(g[5]=
-1,c=new a.i,e.o(c),g[2]=0==c.ba()&&0==c.aa()?0:1):(c=0!=e.$b(),g[2]=c?1:0,g[5]=a.Hh.No(e)?0:-1):(g[2]=0,g[5]=-1);h&&this.qG(g);return this.Mf(g,b)};c.YN=function(a,g,b){return c.mT(a)?3:c.NS(a)?4:c.nT(a,g,b)?8:c.CR(a,g,b)?16:c.yQ(a)?1:c.LK(a,g,b)?32:0};c.mT=function(a){return"T"==a.charAt(0)&&"*"==a.charAt(1)&&"F"==a.charAt(2)&&"*"==a.charAt(3)&&"*"==a.charAt(4)&&"F"==a.charAt(5)&&"F"==a.charAt(6)&&"F"==a.charAt(7)&&"*"==a.charAt(8)?!0:!1};c.NS=function(a){return"F"==a.charAt(0)&&"F"==a.charAt(1)&&
"*"==a.charAt(2)&&"F"==a.charAt(3)&&"F"==a.charAt(4)&&"*"==a.charAt(5)&&"*"==a.charAt(6)&&"*"==a.charAt(7)&&"*"==a.charAt(8)?!0:!1};c.nT=function(a,c,b){if(0==c&&0==b)return!1;if(2!=c||2!=b)if("F"==a.charAt(0)&&"*"==a.charAt(1)&&"*"==a.charAt(2)&&"T"==a.charAt(3)&&"*"==a.charAt(4)&&"*"==a.charAt(5)&&"*"==a.charAt(6)&&"*"==a.charAt(7)&&"*"==a.charAt(8)||1==c&&1==b&&"F"==a.charAt(0)&&"T"==a.charAt(1)&&"*"==a.charAt(2)&&"*"==a.charAt(3)&&"*"==a.charAt(4)&&"*"==a.charAt(5)&&"*"==a.charAt(6)&&"*"==a.charAt(7)&&
"*"==a.charAt(8))return!0;return 0!=b&&"F"==a.charAt(0)&&"*"==a.charAt(1)&&"*"==a.charAt(2)&&"*"==a.charAt(3)&&"T"==a.charAt(4)&&"*"==a.charAt(5)&&"*"==a.charAt(6)&&"*"==a.charAt(7)&&"*"==a.charAt(8)?!0:!1};c.CR=function(a,c,b){return c>b?"T"==a.charAt(0)&&"*"==a.charAt(1)&&"*"==a.charAt(2)&&"*"==a.charAt(3)&&"*"==a.charAt(4)&&"*"==a.charAt(5)&&"T"==a.charAt(6)&&"*"==a.charAt(7)&&"*"==a.charAt(8)?!0:!1:1==c&&1==b&&"0"==a.charAt(0)&&"*"==a.charAt(1)&&"*"==a.charAt(2)&&"*"==a.charAt(3)&&"*"==a.charAt(4)&&
"*"==a.charAt(5)&&"*"==a.charAt(6)&&"*"==a.charAt(7)&&"*"==a.charAt(8)?!0:!1};c.yQ=function(a){return"T"==a.charAt(0)&&"*"==a.charAt(1)&&"*"==a.charAt(2)&&"*"==a.charAt(3)&&"*"==a.charAt(4)&&"*"==a.charAt(5)&&"F"==a.charAt(6)&&"F"==a.charAt(7)&&"*"==a.charAt(8)?!0:!1};c.LK=function(a,c,b){if(c==b){if(1!=c)return"T"==a.charAt(0)&&"*"==a.charAt(1)&&"T"==a.charAt(2)&&"*"==a.charAt(3)&&"*"==a.charAt(4)&&"*"==a.charAt(5)&&"T"==a.charAt(6)&&"*"==a.charAt(7)&&"*"==a.charAt(8)?!0:!1;if("1"==a.charAt(0)&&
"*"==a.charAt(1)&&"T"==a.charAt(2)&&"*"==a.charAt(3)&&"*"==a.charAt(4)&&"*"==a.charAt(5)&&"T"==a.charAt(6)&&"*"==a.charAt(7)&&"*"==a.charAt(8))return!0}return!1};c.es=function(a,c,b){a=c.ya(a);for(var e=c.Be;-1!=e;e=c.Bf(e))if(0!=(c.md(e)&a)){var g=c.te(e);if(-1==g)c.fm(e,b,0);else{var h=g,d=0;do 0!=(c.Gg(h)&a)&&d++,h=c.Wb(c.sa(h));while(h!=g);c.fm(e,b,d)}}};c.Lo=function(a){var e;e=""+a.charAt(0);e+=a.charAt(3);e+=a.charAt(6);e+=a.charAt(1);e+=a.charAt(4);e+=a.charAt(7);e+=a.charAt(2);e+=a.charAt(5);
return e+=a.charAt(8)};c.prototype.pi=function(){for(var a=0;9>a;a++)this.A[a]=-2,this.Ta[a]=-2};c.qG=function(a){var e=a[1],c=a[2],b=a[5];a[1]=a[3];a[2]=a[6];a[5]=a[7];a[3]=e;a[6]=c;a[7]=b};c.prototype.si=function(a){this.Hc=a;for(a=0;9>a;a++)"*"!=this.Hc.charAt(a)?(this.Y[a]=!0,this.Xd++):this.Y[a]=!1};c.prototype.SF=function(){for(var a=0;9>a;a++)this.Y[a]&&-2==this.A[a]&&(this.A[a]=-1,this.Y[a]=!1)};c.prototype.dc=function(a){if(-2==this.A[a])return!1;if(-1==this.A[a])return this.Y[a]=!1,this.Xd--,
!0;if("T"!=this.Hc.charAt(a)&&"F"!=this.Hc.charAt(a)){if(this.A[a]<this.Ta[a])return!1;this.Y[a]=!1;this.Xd--;return!0}this.Y[a]=!1;this.Xd--;return!0};c.prototype.vF=function(){this.$t=0;this.Ta[0]=2;this.Ta[1]=1;this.Ta[2]=2;this.Ta[3]=1;this.Ta[4]=1;this.Ta[5]=1;this.Ta[6]=2;this.Ta[7]=1;this.Ta[8]=2;this.Y[8]&&(this.A[8]=2,this.Y[8]=!1,this.Xd--)};c.prototype.wy=function(){this.$t=1;this.Nl=3;this.Ta[0]=1;this.Ta[1]=0;this.Ta[2]=2;this.Ta[3]=1;this.Ta[4]=0;this.Ta[5]=1;this.Ta[6]=1;this.Ta[7]=
0;this.Ta[8]=2;this.Y[8]&&(this.A[8]=2,this.Y[8]=!1,this.Xd--)};c.prototype.ZR=function(){this.$t=2;this.Nl=4;this.Ta[0]=1;this.Ta[1]=0;this.Ta[2]=1;this.Ta[3]=0;this.Ta[4]=0;this.Ta[5]=0;this.Ta[6]=1;this.Ta[7]=0;this.Ta[8]=2;this.Y[8]&&(this.A[8]=2,this.Y[8]=!1,this.Xd--)};c.prototype.wF=function(){this.Nl=3;this.Ta[0]=0;this.Ta[1]=-1;this.Ta[2]=2;this.Ta[3]=0;this.Ta[4]=-1;this.Ta[5]=1;this.Ta[6]=0;this.Ta[7]=-1;this.Ta[8]=2;this.Y[1]&&(this.A[1]=-1,this.Y[1]=!1,this.Xd--);this.Y[4]&&(this.A[4]=
-1,this.Y[4]=!1,this.Xd--);this.Y[7]&&(this.A[7]=-1,this.Y[7]=!1,this.Xd--);this.Y[8]&&(this.A[8]=2,this.Y[8]=!1,this.Xd--)};c.prototype.KF=function(){this.Nl=4;this.Ta[0]=0;this.Ta[1]=-1;this.Ta[2]=1;this.Ta[3]=0;this.Ta[4]=-1;this.Ta[5]=0;this.Ta[6]=0;this.Ta[7]=-1;this.Ta[8]=2;this.Y[1]&&(this.A[1]=-1,this.Y[1]=!1,this.Xd--);this.Y[4]&&(this.A[4]=-1,this.Y[4]=!1,this.Xd--);this.Y[7]&&(this.A[7]=-1,this.Y[7]=!1,this.Xd--);this.Y[8]&&(this.A[8]=2,this.Y[8]=!1,this.Xd--)};c.prototype.PF=function(){this.Nl=
5;this.Ta[0]=0;this.Ta[1]=-1;this.Ta[2]=0;this.Ta[3]=-1;this.Ta[4]=-1;this.Ta[5]=-1;this.Ta[6]=0;this.Ta[7]=-1;this.Ta[8]=2;this.Y[1]&&(this.A[1]=-1,this.Y[1]=!1,this.Xd--);this.Y[3]&&(this.A[3]=-1,this.Y[3]=!1,this.Xd--);this.Y[4]&&(this.A[4]=-1,this.Y[4]=!1,this.Xd--);this.Y[5]&&(this.A[5]=-1,this.Y[5]=!1,this.Xd--);this.Y[7]&&(this.A[7]=-1,this.Y[7]=!1,this.Xd--);this.Y[8]&&(this.A[8]=2,this.Y[8]=!1,this.Xd--)};c.prototype.aK=function(a,c,b){var e=!0;this.Y[0]&&(this.HO(a,c,b),e=e&&this.dc(0));
this.Y[1]&&(this.eD(a,c,1),e=e&&this.dc(1));this.Y[2]&&(this.fD(a,c,b,2),e=e&&this.dc(2));this.Y[3]&&(this.eD(a,b,3),e=e&&this.dc(3));this.Y[4]&&(this.gK(a,c,b),e=e&&this.dc(4));this.Y[5]&&(this.eB(a,b,5),e=e&&this.dc(5));this.Y[6]&&(this.fD(a,b,c,6),e=e&&this.dc(6));this.Y[7]&&(this.eB(a,c,7),e=e&&this.dc(7));return e};c.prototype.Bs=function(a,c){this.A[0]=-1;this.A[1]=-1;this.A[3]=-1;this.A[4]=-1;this.iq(a,this.Y[2]?2:-1,this.Hc.charAt(2),this.Y[5]?5:-1,this.Hc.charAt(5));this.iq(c,this.Y[6]?6:
-1,this.Hc.charAt(6),this.Y[7]?7:-1,this.Hc.charAt(7))};c.prototype.iq=function(e,c,b,h,d){if(-1!=c||-1!=h)("T"!=b&&"F"!=b&&-1!=c||"T"!=d&&"F"!=d&&-1!=h?0!=e.Mh():1)?(-1!=c&&(this.A[c]=2),-1!=h&&(this.A[h]=1)):(-1!=h&&(this.A[h]=-1),-1!=c&&(b=new a.i,e.o(b),this.A[c]=0==b.ba()&&0==b.aa()?0:1))};c.prototype.Bv=function(a){this.A[2]=2;this.A[3]=-1;this.A[4]=-1;this.A[5]=1;this.A[6]=-1;this.A[7]=-1;this.iq(a,this.Y[0]?0:-1,this.Hc.charAt(0),this.Y[1]?1:-1,this.Hc.charAt(1))};c.prototype.$A=function(a){this.Bv(a);
c.qG(this.A)};c.prototype.Cs=function(e,c){this.A[0]=-1;this.A[1]=-1;this.A[3]=-1;this.A[4]=-1;if(this.Y[6]){var g=this.Hc.charAt(6),g="T"!=g&&"F"!=g?0!=c.$b():!0;this.A[6]=g?1:0}this.Y[7]&&(g=a.Hh.No(c),this.A[7]=g?0:-1);this.iq(e,this.Y[2]?2:-1,this.Hc.charAt(2),this.Y[5]?5:-1,this.Hc.charAt(5))};c.prototype.aB=function(e){if(this.Y[0]){var c=this.Hc.charAt(0),c="T"!=c&&"F"!=c?0!=e.$b():!0;this.A[0]=c?1:0}this.Y[1]&&(e=a.Hh.No(e),this.A[1]=e?0:-1);this.A[2]=2;this.A[3]=-1;this.A[4]=-1;this.A[5]=
1;this.A[6]=-1;this.A[7]=-1};c.prototype.Ds=function(a){this.A[0]=-1;this.A[3]=-1;this.A[6]=0;this.iq(a,this.Y[2]?2:-1,this.Hc.charAt(2),this.Y[5]?5:-1,this.Hc.charAt(5))};c.prototype.cK=function(){this.A[0]=0;this.A[2]=2;this.A[3]=-1;this.A[5]=1;this.A[6]=-1};c.prototype.CD=function(e,c){this.A[0]=-1;this.A[1]=-1;this.A[3]=-1;this.A[4]=-1;if(this.Y[2]){var g=this.Hc.charAt(2),g="T"!=g&&"F"!=g?0!=e.$b():!0;this.A[2]=g?1:0}this.Y[5]&&(g=a.Hh.No(e),this.A[5]=g?0:-1);this.Y[6]&&(g=this.Hc.charAt(6),
g="T"!=g&&"F"!=g?0!=c.$b():!0,this.A[6]=g?1:0);this.Y[7]&&(g=a.Hh.No(c),this.A[7]=g?0:-1)};c.prototype.dx=function(e){this.A[0]=-1;this.A[3]=-1;if(this.Y[2]){var c=this.Hc.charAt(2),c="T"!=c&&"F"!=c?0!=e.$b():!0;this.A[2]=c?1:0}this.Y[5]&&(e=a.Hh.No(e),this.A[5]=e?0:-1);this.A[6]=0};c.prototype.PE=function(){this.A[0]=-1;this.A[2]=0;this.A[6]=0};c.prototype.bK=function(a,c,b){var e=!0;this.Y[0]&&(this.IO(a,c),e=e&&this.dc(0));this.Y[1]&&(this.EO(a,c,b,this.Jg),e=e&&this.dc(1));this.Y[2]&&(this.FO(a,
c),e=e&&this.dc(2));this.Y[3]&&(this.kK(a,c,b,this.Jg),e=e&&this.dc(3));this.Y[4]&&(this.hK(a,c,b,this.Jg),e=e&&this.dc(4));this.Y[5]&&(this.iK(a,c,b),e=e&&this.dc(5));this.Y[6]&&(this.BM(a,c),e=e&&this.dc(6));this.Y[7]&&(this.AM(a,c,b,this.Jg),e=e&&this.dc(7));return e};c.prototype.uP=function(a,c,b){var e=!0;this.Y[0]&&(this.LO(a,c,b,this.ph,this.Jg),e=e&&this.dc(0));this.Y[1]&&(this.gD(a,c,b,this.ph,this.Jg,1),e=e&&this.dc(1));this.Y[2]&&(this.hD(a,c,b,2),e=e&&this.dc(2));this.Y[3]&&(this.gD(a,
b,c,this.Jg,this.ph,3),e=e&&this.dc(3));this.Y[4]&&(this.mK(a,c,b,this.ph,this.Jg),e=e&&this.dc(4));this.Y[5]&&(this.fB(a,b,this.ph,5),e=e&&this.dc(5));this.Y[6]&&(this.hD(a,b,c,6),e=e&&this.dc(6));this.Y[7]&&(this.fB(a,c,this.Jg,7),e=e&&this.dc(7));return e};c.prototype.bB=function(a,c,b){var e=!0;this.Y[0]&&(this.JO(a,c),e=e&&this.dc(0));this.Y[2]&&(this.GO(a,c),e=e&&this.dc(2));this.Y[3]&&(this.lK(a,c,b),e=e&&this.dc(3));this.Y[5]&&(this.jK(a,c),e=e&&this.dc(5));this.Y[6]&&(this.CM(a,c),e=e&&this.dc(6));
return e};c.prototype.DD=function(a,c,b){var e=!0;this.Y[0]&&(this.MO(a,c,b,this.ph),e=e&&this.dc(0));this.Y[2]&&(this.KO(a,b),e=e&&this.dc(2));this.Y[3]&&(this.oK(a,c,b,this.ph),e=e&&this.dc(3));this.Y[5]&&(this.nK(a,c,b,this.ph),e=e&&this.dc(5));this.Y[6]&&(this.DM(a,c,b),e=e&&this.dc(6));return e};c.prototype.JQ=function(a,c,b){var e=!0;this.Y[0]&&(this.NO(a,c,b),e=e&&this.dc(0));this.Y[2]&&(this.iD(a,c,b,2),e=e&&this.dc(2));this.Y[6]&&(this.iD(a,b,c,6),e=e&&this.dc(6));return e};c.prototype.HO=
function(a,c,b){2!=this.A[0]&&(a=this.h.Qe(a),0!=(a&c)&&0!=(a&b)&&(this.A[0]=2))};c.prototype.eD=function(a,c,b){if(1!=this.A[b]){var e=this.h.Qe(this.h.sa(a));0!=(this.h.Qe(a)&c)&&0!=(e&c)&&(this.A[b]=1)}};c.prototype.fD=function(a,c,b,h){2!=this.A[h]&&(a=this.h.Qe(a),0!=(a&c)&&0==(a&b)&&(this.A[h]=2))};c.prototype.gK=function(a,c,b){if(1!=this.A[4]){var e=this.h.Gg(a);0!=(e&c)&&0!=(e&b)?this.A[4]=1:0!=this.A[4]&&1!=this.h.tb(this.h.fe(this.h.sa(a)),this.ni)&&(a=this.h.md(this.h.jf(a)),0!=(a&c)&&
0!=(a&b)&&(this.A[4]=0))}};c.prototype.eB=function(a,c,b){if(1!=this.A[b]){var e=this.h.Qe(this.h.sa(a));0==(this.h.Qe(a)&c)&&0==(e&c)&&(this.A[b]=1)}};c.prototype.IO=function(a,c){if(1!=this.A[0]){var e=this.h.Qe(this.h.sa(a));0!=(this.h.Qe(a)&c)&&0!=(e&c)&&(this.A[0]=1)}};c.prototype.EO=function(a,c,b,h){if(0!=this.A[1]&&1!=this.h.tb(this.h.fe(this.h.sa(a)),this.ni)){var e=this.h.jf(a),g=this.h.md(e);0==(g&c)&&0!=(this.h.Qe(a)&c)&&(a=this.h.Sf(e,h),0!=(g&b)&&0!=a%2&&(this.A[1]=0))}};c.prototype.FO=
function(a,c){2!=this.A[2]&&0!=(this.h.Gg(a)&c)&&(this.A[2]=2)};c.prototype.kK=function(a,c,b,h){if(1!=this.A[3]){var e=this.h.Gg(a);0!=(e&c)&&0!=(e&b)?this.A[3]=1:0!=this.A[3]&&1!=this.h.tb(this.h.fe(this.h.sa(a)),this.ni)&&(e=this.h.jf(a),a=this.h.md(e),0!=(a&c)&&(c=this.h.Sf(e,h),0!=(a&b)&&0==c%2&&(this.A[3]=0)))}};c.prototype.hK=function(a,c,b,h){if(0!=this.A[4]&&1!=this.h.tb(this.h.fe(this.h.sa(a)),this.ni)){var e=this.h.jf(a);a=this.h.md(e);0!=(a&c)&&(c=this.h.Sf(e,h),0!=(a&b)&&0!=c%2&&(this.A[4]=
0))}};c.prototype.iK=function(a,c,b){1!=this.A[5]&&(a=this.h.Gg(a),0!=(a&c)&&0==(a&b)&&(this.A[5]=1))};c.prototype.BM=function(a,c){if(1!=this.A[6]){var e=this.h.Qe(this.h.sa(a));0==(this.h.Qe(a)&c)&&0==(e&c)&&(this.A[6]=1)}};c.prototype.AM=function(a,c,b,h){if(0!=this.A[7]&&1!=this.h.tb(this.h.fe(this.h.sa(a)),this.ni)){var e=this.h.jf(a),g=this.h.md(e);0==(g&c)&&0==(this.h.Qe(a)&c)&&(a=this.h.Sf(e,h),0!=(g&b)&&0!=a%2&&(this.A[7]=0))}};c.prototype.LO=function(a,c,b,h,d){if(1!=this.A[0]){var e=this.h.Gg(a);
0!=(e&c)&&0!=(e&b)?this.A[0]=1:0!=this.A[0]&&1!=this.h.tb(this.h.fe(this.h.sa(a)),this.ni)&&(a=this.h.jf(a),e=this.h.md(a),0!=(e&c)&&0!=(e&b)&&(c=this.h.Sf(a,h),d=this.h.Sf(a,d),0==c%2&&0==d%2&&(this.A[0]=0)))}};c.prototype.gD=function(a,c,b,h,d,f){if(0!=this.A[f]&&1!=this.h.tb(this.h.fe(this.h.sa(a)),this.ni)){a=this.h.jf(a);var e=this.h.md(a);0!=(e&c)&&0!=(e&b)&&(c=this.h.Sf(a,h),d=this.h.Sf(a,d),0==c%2&&0!=d%2&&(this.A[f]=0))}};c.prototype.hD=function(a,c,b,h){1!=this.A[h]&&(a=this.h.Gg(a),0!=
(a&c)&&0==(a&b)&&(this.A[h]=1))};c.prototype.mK=function(a,c,b,h,d){if(0!=this.A[4]&&1!=this.h.tb(this.h.fe(this.h.sa(a)),this.ni)){a=this.h.jf(a);var e=this.h.md(a);0!=(e&c)&&0!=(e&b)&&(c=this.h.Sf(a,h),d=this.h.Sf(a,d),0!=c%2&&0!=d%2&&(this.A[4]=0))}};c.prototype.fB=function(a,c,b,h){0!=this.A[h]&&1!=this.h.tb(this.h.fe(this.h.sa(a)),this.ni)&&(a=this.h.jf(a),0==(this.h.md(a)&c)&&0!=this.h.Sf(a,b)%2&&(this.A[h]=0))};c.prototype.JO=function(a,c){0!=this.A[0]&&0==(this.h.md(a)&c)&&0!=(this.h.pj(this.h.mw(a))&
c)&&(this.A[0]=0)};c.prototype.GO=function(a,c){2!=this.A[2]&&0!=(this.h.md(a)&c)&&(this.A[2]=2)};c.prototype.lK=function(a,c,b){0!=this.A[3]&&(a=this.h.md(a),0!=(a&c)&&0!=(a&b)&&(this.A[3]=0))};c.prototype.jK=function(a,c){1!=this.A[5]&&0!=(this.h.md(a)&c)&&(this.A[5]=1)};c.prototype.CM=function(a,c){0!=this.A[6]&&0==(this.h.md(a)&c)&&0==(this.h.pj(this.h.mw(a))&c)&&(this.A[6]=0)};c.prototype.MO=function(a,c,b,h){if(0!=this.A[0]){var e=this.h.md(a);0!=(e&c)&&0!=(e&b)&&0==this.h.Sf(a,h)%2&&(this.A[0]=
0)}};c.prototype.KO=function(a,c){1!=this.A[2]&&(-1!=this.h.te(a)?this.A[2]=1:0!=this.A[2]&&0==(this.h.md(a)&c)&&(this.A[2]=0))};c.prototype.oK=function(a,c,b,h){if(0!=this.A[3]){var e=this.h.md(a);0!=(e&c)&&0!=(e&b)&&0!=this.h.Sf(a,h)%2&&(this.A[3]=0)}};c.prototype.nK=function(a,c,b,h){if(0!=this.A[5]){var e=this.h.md(a);0!=(e&c)&&0==(e&b)&&0!=this.h.Sf(a,h)%2&&(this.A[5]=0)}};c.prototype.DM=function(a,c,b){0!=this.A[6]&&(a=this.h.md(a),0==(a&c)&&0!=(a&b)&&(this.A[6]=0))};c.prototype.NO=function(a,
c,b){0!=this.A[0]&&(a=this.h.md(a),0!=(a&c)&&0!=(a&b)&&(this.A[0]=0))};c.prototype.iD=function(a,c,b,h){0!=this.A[h]&&(a=this.h.md(a),0!=(a&c)&&0==(a&b)&&(this.A[h]=0))};c.prototype.so=function(e,c){var g=!1;e=this.h.ya(e);c=this.h.ya(c);this.ni=this.h.Eg();for(var b=this.h.Be;-1!=b;b=this.h.Bf(b)){var h=this.h.te(b);if(-1==h){if(-1!=this.Nl)switch(this.Nl){case 3:g=this.bB(b,e,c);break;case 4:g=this.DD(b,e,c);break;default:throw a.g.ra("internal error");}}else{var d=h;do{var f=d;if(1!=this.h.tb(f,
this.ni)){do{switch(this.$t){case 0:g=this.aK(f,e,c);break;case 1:g=this.bK(f,e,c);break;case 2:g=this.uP(f,e,c);break;default:throw a.g.ra("internal error");}if(g)break;this.h.Bb(f,this.ni,1);f=this.h.Wb(f)}while(f!=d&&!g)}if(g)break;d=this.h.Wb(this.h.sa(f))}while(d!=h);if(g)break}}g||this.SF();this.h.kh(this.ni)};c.prototype.Pv=function(e,c){var g=!1;e=this.h.ya(e);c=this.h.ya(c);for(var b=this.h.Be;-1!=b;b=this.h.Bf(b)){switch(this.Nl){case 3:g=this.bB(b,e,c);break;case 4:g=this.DD(b,e,c);break;
case 5:g=this.JQ(b,e,c);break;default:throw a.g.wa();}if(g)break}g||this.SF()};c.prototype.Op=function(a,c){this.h.Mp(a,c)};c.prototype.In=function(a,c,b){this.tM(a,c,b);this.Op(a,b)};c.prototype.tM=function(e,c,b){a.aj.$(e,c,b,!1);e.xo(0,!0,!0);for(c=e.$c;-1!=c;c=e.we(c))1736==e.Lb(c)&&a.mm.$(e,c,-1,!1,b)};c.NB=function(e,c){var g=e.D();if(a.T.Lc(g))return g=new a.Xa(e.description),g.Bc(e,!0),g;if(197==g){g=new a.i;e.o(g);if(g.ba()<=c&&g.aa()<=c)return g=new a.Va(e.description),e.Af(g),g;if(g.ba()<=
c||g.aa()<=c)return g=new a.Xa(e.description),c=new a.Va,e.uf(0,c),g.df(c),e.uf(2,c),g.lineTo(c),g;g=new a.Ka(e.description);g.Wc(e,!1);return g}return e};return c}();a.el=c})(B||(B={}));(function(a){var c=function(){function e(e){this.Dl=new a.ga(0);this.Ot=new a.ga(0);this.Ar=new a.b;this.Br=new a.b;this.a=e;this.Tq=-1}e.prototype.cc=function(a){return this.a.cc(this.Jw(a))};e.prototype.ot=function(a){var e=this.tw(a);a=this.vC(a);if(this.a.Ua(e)==a){var c=e,e=a;a=c}this.a.uc(e,this.Ar);this.a.uc(a,
this.Br);return this.Ar.y<this.Br.y};e.prototype.Jw=function(a){var e=this.tw(a);a=this.vC(a);return this.a.X(e)==a?e:a};e.prototype.tw=function(a){return this.Dl.get(a)};e.prototype.vC=function(a){return this.Ot.get(a)};e.prototype.hC=function(a){this.Dl.set(a,this.Tq);this.Tq=a};e.prototype.GE=function(e){if(-1!=this.Tq){var c=this.Tq;this.Tq=this.Dl.get(c);this.Dl.set(c,e);this.Ot.set(c,this.a.X(e));return c}null==this.Dl&&(this.Dl=new a.ga(0),this.Ot=new a.ga(0));c=this.Dl.size;this.Dl.add(e);
this.Ot.add(this.a.X(e));return c};e.prototype.Dw=function(a){return this.a.rd(this.tw(a))};return e}();a.BT=c;var b=function(){function e(e){this.me=e;this.Vd=new a.yb;this.Kl=new a.yb;this.eE=0;this.on=null;this.zx=-1}e.prototype.compare=function(a,e,c){c=a.da(c);var b=this.me.$a,g;this.zx==e?g=this.eE:(this.on=b.cc(e),null==this.on?(a=b.a,a.Oc(b.Jw(e),this.Vd),this.on=this.Vd,g=this.Vd.xe(this.me.Zg,0)):g=this.on.xe(this.me.Zg,0),this.eE=g,this.zx=e);a=b.cc(c);var h;null==a?(a=b.a,a.Oc(b.Jw(c),
this.Kl),a=this.Kl,h=this.Kl.xe(this.me.Zg,0)):h=a.xe(this.me.Zg,0);g==h&&(e=b.ot(e),c=b.ot(c),c=Math.min(e?this.on.ha:this.on.ja,c?a.ha:a.ja),e=.5*(c+this.me.Zg),e==this.me.Zg&&(e=c),g=this.on.xe(e,0),h=a.xe(e,0));return g<h?-1:g>h?1:0};e.prototype.reset=function(){this.zx=-1};return e}(),h=function(){function e(){this.Rl=this.Dk=null;this.Za=new a.bj;this.Za.lM();this.Ld=new b(this);this.Za.Hn(this.Ld)}e.prototype.XM=function(){var e=!1;this.Qt&&(e=this.YM());if(1==this.a.ea(this.U)){var c=this.a.Vb(this.U),
e=this.a.Gw(c);this.a.Dy(c,!0);return 0>e?(e=this.a.Cb(c),this.a.lF(e),this.a.Wi(c,this.a.Ua(e)),!0):!1}this.Ak=this.a.Uv();this.kn=this.a.Uv();for(c=this.a.Vb(this.U);-1!=c;c=this.a.bc(c))this.a.Rp(c,this.Ak,0),this.a.Rp(c,this.kn,-1);c=new a.ga(0);this.Zg=NaN;var b=new a.b;this.lr=this.a.ea(this.U);this.fn=this.a.re();this.br=this.a.re();for(var h=this.Dk.gc(this.Dk.Wd);-1!=h;h=this.Dk.bb(h)){var d=this.Dk.getData(h);this.a.uc(d,b);b.y!=this.Zg&&0!=c.size&&(e=this.yr(c)||e,this.Ld.reset(),c.clear(!1));
c.add(d);this.Zg=b.y;if(0==this.lr)break}0<this.lr&&(e=this.yr(c)||e,c.clear(!1));this.a.bf(this.fn);this.a.bf(this.br);for(c=this.a.Vb(this.U);-1!=c;)if(3==this.a.Ei(c,this.Ak)){this.a.Dy(c,!0);b=c;for(c=this.a.Ei(c,this.kn);-1!=c;)h=this.a.Ei(c,this.kn),this.a.bQ(this.U,this.a.bc(b),c),b=c,c=h;c=this.a.bc(b)}else this.a.Dy(c,!1),c=this.a.bc(c);this.a.ty(this.Ak);this.a.ty(this.kn);return e};e.prototype.yr=function(a){return this.WQ(a)};e.prototype.WQ=function(e){var b=!1;null==this.$a&&(this.$a=
new c(this.a));null==this.Rl?(this.Rl=new a.ga(0),this.Rl.xb(16)):this.Rl.clear(!1);this.VQ(e);for(var g=0,h=e.size;g<h;g++){var d=e.get(g);-1!=d&&this.bD(d,-1)}for(g=0;g<this.Rl.size&&0<this.lr;g++)if(e=this.Rl.get(g),d=this.$a.Dw(this.Za.da(e)),h=-1,0==this.a.Ei(d,this.Ak)){for(var d=this.Za.ge(e),f=e,k;-1!=d;){var m=this.Za.da(d),p=this.$a.Dw(m),r=this.a.Ei(p,this.Ak);if(0!=r){h=p;break}f=d;d=this.Za.ge(d)}-1==d?(k=!0,d=f):(m=this.Za.da(d),k=this.$a.ot(m),d=this.Za.bb(d),k=!k);do{m=this.Za.da(d);
p=this.$a.Dw(m);r=this.a.Ei(p,this.Ak);if(0==r&&(k!=this.$a.ot(m)&&(b=this.a.Cb(p),this.a.lF(b),this.a.Wi(p,this.a.Ua(b)),b=!0),this.a.Rp(p,this.Ak,k?3:2),k||(f=this.a.Ei(h,this.kn),this.a.Rp(h,this.kn,p),this.a.Rp(p,this.kn,f)),this.lr--,0==this.lr))return b;h=p;f=d;d=this.Za.bb(d);k=!k}while(f!=e)}return b};e.prototype.VQ=function(a){for(var e=0,c=a.size;e<c;e++){var b=a.get(e),g=this.a.Ra(b,this.fn),h=this.a.Ra(b,this.br);if(-1!=g){var d=this.Za.da(g);this.$a.hC(d);this.a.lb(b,this.fn,-1)}-1!=
h&&(d=this.Za.da(h),this.$a.hC(d),this.a.lb(b,this.br,-1));d=-1;-1!=g&&-1!=h?(this.Za.kd(g,-1),this.Za.kd(h,-1),a.set(e,-1)):d=-1!=g?g:h;-1!=d&&(this.bD(b,d)||this.Za.kd(d,-1),a.set(e,-1))}};e.prototype.bD=function(e,c){var b=new a.b,g=new a.b;this.a.uc(e,b);var h=this.a.X(e);this.a.uc(h,g);var d=!1;if(b.y<g.y){var d=!0,f=this.$a.GE(e),k;-1==c?k=this.Za.addElement(f,-1):(k=c,this.Za.Vi(k,f));f=this.a.Ra(h,this.fn);-1==f?this.a.lb(h,this.fn,k):this.a.lb(h,this.br,k);h=this.a.rd(e);0==this.a.Ei(h,this.Ak)&&
this.Rl.add(k)}h=this.a.Ua(e);this.a.uc(h,g);b.y<g.y&&(d=!0,f=this.$a.GE(h),-1==c?k=this.Za.addElement(f,-1):(k=c,this.Za.Vi(k,f)),f=this.a.Ra(h,this.fn),-1==f?this.a.lb(h,this.fn,k):this.a.lb(h,this.br,k),h=this.a.rd(e),0==this.a.Ei(h,this.Ak)&&this.Rl.add(k));return d};e.$=function(a,c,b,h){var g=new e;g.a=a;g.U=c;g.Dk=b;g.Qt=h;return g.XM()};e.prototype.YM=function(){var e=new a.ga(0),c=new a.ga(0),b=-1,h=-1,d=new a.b;d.Eh();for(var f=-1,k=-1,m=-1,p=new a.b,r=this.Dk.gc(this.Dk.Wd);-1!=r;r=this.Dk.bb(r)){var u=
this.Dk.getData(r);this.a.uc(u,p);var v=this.a.rd(u);d.ub(p)&&k==v?(-1==h&&(b=this.a.Uv(),h=this.a.re()),-1==m&&(m=c.size,this.a.lb(f,h,m),c.add(1),-1==this.a.Ei(v,b)&&(this.a.Rp(v,b,f),e.add(v))),this.a.lb(u,h,m),c.JF(c.tc()+1)):(m=-1,d.J(p));f=u;k=v}if(0==e.size)return!1;d=new a.ga(0);f=new a.ga(0);k=0;for(m=e.size;k<m;k++){var v=e.get(k),q=this.a.Ei(v,b),u=this.a.Ra(q,h);d.clear(!1);f.clear(!1);d.add(q);f.add(u);for(u=this.a.X(q);u!=q;u=this.a.X(u)){var x=u,p=this.a.Ra(x,h);if(-1!=p)if(0==f.size)f.add(p),
d.add(x);else if(f.tc()==p){var r=d.tc(),D=this.a.X(r),q=this.a.X(x);this.a.Sc(r,q);this.a.Tc(q,r);this.a.Sc(x,D);this.a.Tc(D,x);x=[!1];D=this.a.aD(this.U,D,this.a.Cb(v),x);this.a.lb(u,h,-1);x[0]&&this.a.Dh(v,q);u=this.a.Ha(v);q=this.a.Ha(D);u-=q;this.a.hm(v,u);c.set(p,c.get(p)-1);1==c.get(p)&&(c.set(p,0),f.af(),d.af());u=q=r}else d.add(u),f.add(p)}}this.a.ty(b);this.a.bf(h);return!0};return e}();a.AI=h})(B||(B={}));(function(a){var c=function(){function c(){}c.prototype.Ag=function(){this.Mx=this.ib=
null};c.prototype.get=function(){return this.Mx};c.prototype.set=function(c){this.Mx=c;if(null!=c)throw 322==c.D()&&(this.ib=c),a.g.wa();};c.prototype.create=function(c){if(322==c)this.mq();else throw a.g.ra("Not Implemented");};c.prototype.mq=function(){null==this.ib&&(this.ib=new a.yb);this.Mx=this.ib};return c}();a.Ag=c})(B||(B={}));(function(a){a=a.FI||(a.FI={});a[a.enumLineSeg=1]="enumLineSeg";a[a.enumBezierSeg=2]="enumBezierSeg";a[a.enumArcSeg=4]="enumArcSeg";a[a.enumNonlinearSegmentMask=6]=
"enumNonlinearSegmentMask";a[a.enumSegmentMask=7]="enumSegmentMask";a[a.enumDensified=8]="enumDensified"})(B||(B={}));(function(a){var c=function(){return function(a){this.ri=a;this.dz=this.ez=1;this.ky=this.jy=this.ly=0}}(),b=function(){function b(){this.op=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.Ij=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.nf=new a.Va;this.ka=this.fu=0;this.an=[];this.ir=[];this.bu=[];this.qp=[];this.Jx=[]}b.prototype.ny=function(a){if(null!=a){for(var e=0,c=a.length;e<c;e++)this.oR(a[e]);
a.length=0}};b.prototype.oR=function(a){a.ri=null;this.qp.push(a)};b.prototype.nu=function(a){if(0===this.qp.length)var e=new c(a);else e=this.qp[this.qp.length-1],e.ri=a,--this.qp.length;return e};b.prototype.dO=function(a,c){return 0==a?this.ir[c]:this.bu[c]};b.prototype.Zx=function(){this.fu>=this.Jx.length&&this.Jx.push(new a.Ag);var e=this.Jx[this.fu];this.fu++;return e};b.prototype.clear=function(){this.ny(this.an);this.ny(this.ir);this.ny(this.bu);this.fu=0};b.prototype.zn=function(a){this.an.push(this.nu(a))};
b.prototype.kk=function(a){return 0==a?this.ir.length:this.bu.length};b.prototype.Io=function(a,c){return this.dO(a,c).ri};b.prototype.Ga=function(e,c){if(2!=this.an.length)throw a.g.wa();this.ka=e;var b=a.vi.Ty(.01*e),g=!1,h=this.an[0],d=this.an[1];if(c||0!=(h.ri.fq(d.ri,e,!0)&5)){if(322==h.ri.D()&&(c=h.ri,322==d.ri.D())){var f=d.ri,k=a.yb.ov(c,f,null,this.op,this.Ij,e);if(0==k)throw a.yb.ov(c,f,null,this.op,this.Ij,e),a.g.wa();e=Array(9);a.I.Ps(e,null);for(var m=0;m<k;m++){var p=this.op[m],r=this.Ij[m],
u=h.ky,v=1;0==p?(u=h.ly,v=h.ez):1==p&&(u=h.jy,v=h.dz);var q=d.ky,x=1;0==r?(q=d.ly,x=d.ez):1==r&&(q=d.jy,x=d.dz);var D=new a.b;u==q?(u=new a.b,c.Kb(p,u),p=new a.b,f.Kb(r,p),r=v+x,x/=r,a.vi.BD(u,p,x,D),a.b.Zb(D,u)+a.b.Zb(D,p)>b&&(g=!0)):u>q?(c.Kb(p,D),p=new a.b,f.Kb(r,p),a.b.Zb(D,p)>b&&(g=!0)):(f.Kb(r,D),u=new a.b,c.Kb(p,u),a.b.Zb(D,u)>b&&(g=!0));e[m]=D}h=0;d=-1;for(m=0;m<=k;m++)x=m<k?this.op[m]:1,x!=h&&(b=this.Zx(),c.Bi(h,x,b),-1!=d&&b.get().ed(e[d]),m!=k&&b.get().vd(e[m]),h=x,this.ir.push(this.nu(b.get()))),
d=m;c=[0,0,0,0,0,0,0,0,0];for(m=0;m<k;m++)c[m]=m;1<k&&this.Ij[0]>this.Ij[1]&&(x=this.Ij[0],this.Ij[0]=this.Ij[1],this.Ij[1]=x,m=c[0],c[0]=c[1],c[1]=m);h=0;d=-1;for(m=0;m<=k;m++)x=m<k?this.Ij[m]:1,x!=h&&(b=this.Zx(),f.Bi(h,x,b),-1!=d&&(h=c[d],b.get().ed(e[h])),m!=k&&(h=c[m],b.get().vd(e[h])),h=x,this.bu.push(this.nu(b.get()))),d=m;return g}throw a.g.wa();}return!1};b.prototype.Tw=function(e,c,b){c.copyTo(this.nf);if(1!=this.an.length)throw a.g.wa();this.ka=e;var g=this.an[0];if(b||g.ri.qs(c.w(),e,
!0))if(322==g.ri.D()){e=g.ri;var h=e.Gd(c.w(),!1);this.op[0]=h;var d=g.ky;b=1;0==h?(d=g.ly,b=g.ez):1==h&&(d=g.jy,b=g.dz);g=new a.b;0==d?(d=new a.b,e.Kb(h,d),c=c.w(),a.vi.BD(d,c,1/(b+1),g)):0<d?(g=new a.b,e.Kb(h,g)):g=c.w();b=0;h=-1;for(d=0;1>=d;d++){c=1>d?this.op[d]:1;if(c!=b){var f=this.Zx();e.Bi(b,c,f);-1!=h&&f.get().ed(g);1!=d&&f.get().vd(g);b=c;this.ir.push(this.nu(f.get()))}h=d}this.nf.ic(g)}else throw a.g.wa();};return b}();a.gA=b})(B||(B={}));(function(a){var c=function(){function c(c){this.Pq=
this.yj=this.ib=null;this.zk=this.Ee=this.Gc=this.ze=this.Sg=this.Qa=0;this.ab=null;this.zl=!1;this.ze=-1;this.Sg=this.Gc=0;this.Qa=-1;this.ab=c;this.Ee=this.eq(this.Sg);this.zl=!1;this.yj=null;this.zk=-1;this.Pq=new a.b}c.Yn=function(b,e){if(0>e||e>=b.F())throw a.g.Uc();var g=new c(b),h=b.Ew(e);g.Gc=e-b.Ea(h);g.Sg=h+1;g.Qa=h;g.Ee=g.eq(g.Qa);g.zk=g.ab.Ea(g.Qa);return g};c.Un=function(b,e,g){if(0>e||e>=b.ea()||0>g)throw a.g.Uc();var h=b.vc(e)?0:1;if(g>=b.Ha(e)-h)throw a.g.Uc();b=new c(b);b.ze=-1;b.Gc=
g;b.Qa=e;b.Sg=b.Gc+1;b.Ee=b.eq(b.Sg);b.zk=b.ab.Ea(b.Qa);return b};c.prototype.xR=function(c){if(this.ab!=c.ab)throw a.g.xa();this.ze=c.ze;this.Gc=c.Gc;this.Qa=c.Qa;this.Sg=c.Sg;this.Ee=c.Ee;this.zl=c.zl;this.zk=c.zk;this.yj=null};c.prototype.ia=function(){this.ze!=this.Gc&&this.JA();if(this.zl)this.Gc=(this.Gc+1)%this.Ee;else{if(this.Gc==this.Ee)throw a.g.Uc();this.Gc++}return this.yj};c.prototype.oi=function(){if(this.zl)this.Gc=(this.Ee+this.Gc-1)%this.Ee;else{if(0==this.Gc)throw a.g.Uc();this.Gc--}this.Gc!=
this.ze&&this.JA();return this.yj};c.prototype.yR=function(){this.ze=-1;this.Gc=0};c.prototype.zR=function(){this.Gc=this.Ee;this.ze=-1};c.prototype.Sb=function(a,e){void 0===e&&(e=-1);if(0<=this.Qa&&this.Qa<this.ab.ea()){var c=this.uJ();if(a>=c&&a<this.ab.Dc(this.Qa)){this.ze=-1;this.Gc=a-c;return}}c=0<=e&&e<this.ab.ea()&&a>=this.ab.Ea(e)&&a<this.ab.Dc(e)?e:this.ab.Ew(a);this.Sg=c+1;this.Qa=c;this.ze=-1;this.Gc=a-this.ab.Ea(c);this.Ee=this.eq(c);this.zk=this.ab.Ea(this.Qa)};c.prototype.kb=function(){this.Qa=
this.Sg;if(this.Qa>=this.ab.ea())return!1;this.ze=-1;this.Gc=0;this.Ee=this.eq(this.Qa);this.zk=this.ab.Ea(this.Qa);this.Sg++;return!0};c.prototype.Lk=function(){this.Ee=this.Gc=this.ze=-1;this.Sg=0;this.zk=this.Qa=-1};c.prototype.vy=function(c){if(0>c)throw a.g.Uc();this.Sg=c;this.zk=this.Ee=this.Gc=this.ze=this.Qa=-1};c.prototype.eq=function(a){if(this.ab.sc())return 0;var e=1;this.ab.vc(a)&&(e=0);return this.ab.Ha(a)-e};c.prototype.lD=function(){return this.ze==this.Ee-1&&this.ab.vc(this.Qa)};
c.prototype.NR=function(){this.zl=!0};c.prototype.Jb=function(){return this.ab.jb.f[this.Qa]+this.ze};c.prototype.uJ=function(){return this.ab.Ea(this.Qa)};c.prototype.Bm=function(){return this.lD()?this.ab.Ea(this.Qa):this.Jb()+1};c.prototype.wl=function(){return 0==this.ze};c.prototype.Jm=function(){return this.ze==this.Ee-1};c.prototype.La=function(){return this.Gc<this.Ee};c.prototype.Ow=function(){return 0<this.Gc};c.prototype.vm=function(){var a=new c(this.ab);a.ze=this.ze;a.Gc=this.Gc;a.Ee=
this.Ee;a.Qa=this.Qa;a.Sg=this.Sg;a.ab=this.ab;a.zl=this.zl;return a};c.prototype.JA=function(){if(0>this.Gc||this.Gc>=this.Ee)throw a.g.Uc();this.ze=this.Gc;var c=this.Jb();this.ab.kc();var e=this.ab.Fe,b=1;null!=e&&(b=e.read(c)&7);e=this.ab.description;switch(b){case 1:null==this.ib&&(this.ib=new a.yb);this.yj=this.ib;break;case 2:throw a.g.ra("internal error");case 4:throw a.g.wa();default:throw a.g.wa();}this.yj.Qf(e);b=this.Bm();this.ab.uc(c,this.Pq);this.yj.ed(this.Pq);this.ab.uc(b,this.Pq);
this.yj.vd(this.Pq);for(var d=1,f=e.Aa;d<f;d++)for(var k=e.Hd(d),m=a.pa.Wa(k),p=0;p<m;p++){var r=this.ab.ld(k,c,p);this.yj.My(k,p,r);r=this.ab.ld(k,b,p);this.yj.Cy(k,p,r)}};c.prototype.YO=function(){return this.Qa==this.ab.ea()-1};return c}();a.GI=c})(B||(B={}));(function(a){var c=function(){function c(c){c instanceof a.T?(this.ZD=c,this.ua=-1,this.Wh=1):(this.DP=c.slice(0),this.ua=-1,this.Wh=c.length)}c.prototype.ya=function(){return this.ua};c.prototype.next=function(){return this.ua<this.Wh-1?
(this.ua++,null!=this.ZD?this.ZD:this.DP[this.ua]):null};return c}();a.Pc=c})(B||(B={}));(function(a){var c=function(){return function(){this.next=null}}(),b=function(){function b(){this.Cp=this.ju=this.ku=this.vj=this.eh=0;this.aC=!1;this.eG=0;this.am=this.wf=this.Vk=this.hh=null;this.Mk=0;this.Kv=null;this.vj=this.eh=-1}b.prototype.vS=function(e,c,b){this.eh=e;this.vj=c;this.hh=this.Vk=null;this.Cp=0;this.Kv=b;null==this.am&&(this.am=a.I.Lh(384,0));this.hG()};b.prototype.aa=function(){return this.eh};
b.prototype.ba=function(){return this.vj};b.prototype.flush=function(){0<this.Mk&&(this.Kv.XB(this.am,this.Mk),this.Mk=0)};b.prototype.hG=function(){if(0<this.Cp){for(var a=0;a<this.vj;a++){for(var c=this.Vk[a];null!=c;){var b=c,c=c.next;b.next=null}this.Vk[a]=null}this.hh=null}this.ku=this.vj;this.ju=-1;this.Cp=0};b.prototype.fF=function(a){this.aC=a==b.$u;for(a=this.ku;a<=this.ju;a++)this.VJ(),this.PJ(a),this.vM();this.hG()};b.prototype.zv=function(e,b,h,d){if(b!=d){var g=1;b>d&&(g=e,e=h,h=g,g=
b,b=d,d=g,g=-1);if(!(0>d||b>=this.vj)){0>e&&0>h?h=e=-1:e>=this.eh&&h>=this.eh&&(h=e=this.eh);var f=(h-e)/(d-b);d>this.vj&&(d=this.vj,h=f*(d-b)+e);0>b&&(e=f*(0-b)+e,b=0);var k=Math.max(this.eh+1,8388607);-8388607>e?(b=(0-e)/f+b,e=0):e>k&&(b=(this.eh-e)/f+b,e=this.eh);-8388607>h?d=(0-e)/f+b:h>k&&(d=(this.eh-e)/f+b);b=a.I.truncate(b);d=a.I.truncate(d);b!=d&&(h=new c,h.x=a.I.truncate(4294967296*e),h.y=b,h.G=d,h.pM=a.I.truncate(4294967296*f),h.dir=g,null==this.Vk&&(this.Vk=a.I.Lh(this.vj,null)),h.next=
this.Vk[h.y],this.Vk[h.y]=h,h.y<this.ku&&(this.ku=h.y),h.G>this.ju&&(this.ju=h.G),this.Cp++)}}};b.prototype.VJ=function(){if(null!=this.hh){for(var a=!1,c=null,b=this.hh;null!=b;)if(b.y++,b.y==b.G){var h=b,b=b.next;null!=c?c.next=b:this.hh=b;h.next=null}else b.x+=b.pM,null!=c&&c.x>b.x&&(a=!0),c=b,b=b.next;a&&(this.hh=this.dG(this.hh))}};b.prototype.PJ=function(a){if(!(a>=this.vj)){var e=this.Vk[a];if(null!=e){this.Vk[a]=null;e=this.dG(e);this.Cp-=this.eG;a=this.hh;for(var c=!0,b=e,h=null;null!=a&&
null!=b;)a.x>b.x?(c&&(this.hh=b),c=b.next,b.next=a,null!=h&&(h.next=b),h=b,b=c):(c=a.next,a.next=b,null!=h&&(h.next=a),h=a,a=c),c=!1;null==this.hh&&(this.hh=e)}}};b.Mz=function(a,c){return 0>a?0:a>c?c:a};b.prototype.vM=function(){if(null!=this.hh)for(var e=0,c=this.hh,h=a.I.truncate(a.I.FD(c.x)),d=c.next;null!=d;d=d.next)if(e=this.aC?e^1:e+d.dir,d.x>c.x){var f=a.I.truncate(a.I.FD(d.x));0!=e&&(c=b.Mz(h,this.eh),h=b.Mz(f,this.eh),h>c&&c<this.eh&&(this.am[this.Mk++]=c,this.am[this.Mk++]=h,this.am[this.Mk++]=
d.y,this.Mk==this.am.length&&(this.Kv.XB(this.am,this.Mk),this.Mk=0)));c=d;h=f}};b.prototype.dG=function(e){for(var c=0,h=e;null!=h;h=h.next)c++;this.eG=c;if(1==c)return e;null==this.wf?this.wf=a.I.Lh(Math.max(c,16),null):this.wf.length<c&&(this.wf=a.I.Lh(Math.max(c,2*this.wf.length),null));for(var d=0,h=e;null!=h;h=h.next)this.wf[d++]=h;2==c?this.wf[0].x>this.wf[1].x&&(e=this.wf[0],this.wf[0]=this.wf[1],this.wf[1]=e):b.pP(this.wf,c,function(a,e){return a==e?0:a.x<e.x?-1:a.x>e.x?1:0});e=this.wf[0];
this.wf[0]=null;h=e;for(d=1;d<c;d++)h.next=this.wf[d],h=this.wf[d],this.wf[d]=null;h.next=null;return e};b.pP=function(a,c,b){if(c==a.length)a.sort(b);else{var e=a.slice(0,0),g=a.slice(c);c=a.slice(0,c).sort(b);a.length=0;a.push.apply(a,e.concat(c).concat(g))}};b.$u=0;b.sT=1;return b}();a.ev=b})(B||(B={}));(function(a){var c=function(){function c(){}c.prototype.Jh=function(a,e){var c=this.a.Ra(a,this.vp);this.yk==c&&(this.yk=this.$d.bb(this.yk));this.Xm==c&&(this.Xm=this.$d.bb(this.Xm));this.$d.Jc(this.Ox,
c);this.hj(a);if(e&&(c=this.a.rd(a),-1!=c&&this.a.Cb(c)==a)){e=this.a.X(a);if(e!=a){var b=this.a.rd(e);if(b==c){this.a.Dh(c,e);return}e=this.a.Ua(a);if(e!=a&&(b=this.a.rd(e),b==c)){this.a.Dh(c,e);return}}this.a.Dh(c,-1);this.a.Wi(c,-1)}};c.prototype.yA=function(){for(var c=!1,e=0,b=new a.b;;){e++;null==this.nh?(this.nh=new a.ga(0),this.Mq=new a.ga(0),this.ie=new a.ga(0)):(this.nh.clear(!1),this.Mq.clear(!1),this.ie.clear(!1));for(var d=this.Xm,f=0,k=!0;d!=this.yk;){var m=this.$d.getData(d),p=new a.b;
this.a.uc(m,p);k&&(this.a.uc(m,b),k=!1);var p=this.a.Ua(m),r=this.a.X(m);-559038737!=this.a.Ra(p,this.fg)&&(this.nh.add(p),this.a.lb(p,this.fg,-559038737),this.Mq.add(m),this.ie.add(f++));-559038737!=this.a.Ra(r,this.fg)&&(this.nh.add(r),this.a.lb(r,this.fg,-559038737),this.Mq.add(m),this.ie.add(f++));d=this.$d.bb(d)}if(2>this.nh.size)break;var u=this;this.ie.xd(0,this.ie.size,function(a,e){return u.mJ(a,e)});d=0;for(f=this.ie.size;d<f;d++)k=this.ie.get(d),k=this.nh.get(k),this.a.lb(k,this.fg,d),
p=new a.b,this.a.uc(k,p);p=this.zJ(b);d=0;for(f=this.ie.size;d<f;d++)k=this.ie.get(d),-1!=k&&(k=this.nh.get(k),this.a.lb(k,this.fg,-1));if(p)c=!0;else break}return c};c.prototype.zJ=function(a){for(var e=!1,c=!0;c;){var c=!1,b=0;-1==this.ie.get(b)&&(b=this.fl(b));for(var h=this.fl(b),d=0,f=this.ie.size;d<f&&-1!=b&&-1!=h&&b!=h;d++){var k=this.ie.get(b),h=this.ie.get(h),k=this.nh.get(k),h=this.nh.get(h),m=this.a.X(k);this.a.pt(m,a)||(m=this.a.Ua(k));var p=this.a.X(h);this.a.pt(p,a)||(p=this.a.Ua(h));
var r=this.os(m,k),u=this.os(p,h),v=r?this.a.Ua(m):this.a.X(m),q=u?this.a.Ua(p):this.a.X(p),x=!1;this.io(m)?x=!0:this.io(p)?x=!0:this.io(k)?x=!0:this.io(h)?x=!0:this.io(v)?x=!0:this.io(q)&&(x=!0);!x&&this.a.Cq(k,h)&&(x=!0,this.BA(r,u,m,k,p,h));!x&&this.a.Cq(v,q)&&(x=!0,this.BA(!r,!u,m,v,p,q));x&&(e=!0);c=c||x;b=this.fl(b);h=this.fl(b)}}if(!e)for(b=0,-1==this.ie.get(b)&&(b=this.fl(b)),h=this.fl(b),d=0,f=this.ie.size;d<f&&-1!=b&&-1!=h&&b!=h;d++)k=this.ie.get(b),h=this.ie.get(h),k=this.nh.get(k),h=this.nh.get(h),
m=this.a.X(k),this.a.pt(m,a)||(m=this.a.Ua(k)),p=this.a.X(h),this.a.pt(p,a)||(p=this.a.Ua(h)),r=this.os(m,k),u=this.os(p,h),v=r?this.a.Ua(m):this.a.X(m),q=u?this.a.Ua(p):this.a.X(p),this.qJ(r,u,k,m,v,h,p,q)&&(e=!0),b=this.fl(b),h=this.fl(b);return e};c.prototype.CJ=function(){1736==this.a.Lb(this.U)&&1==this.a.Cm(this.U)&&(new a.Of).DQ(this.Qt,this.a,this.U,this.oe);var c=!1,e=!0;this.fg=this.vp=-1;var b=this.a.F(this.U),d=new a.ga(0);d.xb(b);for(var f=this.a.Vb(this.U);-1!=f;f=this.a.bc(f))for(var k=
this.a.Cb(f),m=0,p=this.a.Ha(f);m<p;m++)d.add(k),k=this.a.X(k);var r=this.a.cd.f,u=this.a.cd.Ic;this.a.wb.kc();var v=this.a.wb.Ba[0].f;d.xd(0,b,function(a,e){var c=r[u*a],b=r[u*e],g=v[2*c],c=v[2*c+1],h=v[2*b],b=v[2*b+1],g=c<b?-1:c>b?1:g<h?-1:g>h?1:0;0==g&&(g=r[u*a+3],b=r[u*e+3],g=g<b?-1:g==b?0:1);return g});this.vp=this.a.re();this.$d=new a.$n;this.Ox=this.$d.jh(0);this.$d.$l(b);for(f=0;f<b;f++)k=d.get(f),m=this.$d.addElement(this.Ox,k),this.a.lb(k,this.vp,m);this.fg=this.a.re();this.yk=-1;for(this.sA()&&
(c=!0);e;){e=!1;b=0;d=!1;do{d=!1;this.Xm=-1;for(var p=0,f=new a.b,m=new a.b,q=this.$d.gc(this.Ox);-1!=q;)k=this.$d.getData(q),-1!=this.Xm?(this.a.uc(k,m),f.ub(m))?p++:(f.J(m),this.yk=q,0<p&&(k=this.yA())&&(d=!0,-1!=this.yk&&(k=this.$d.getData(this.yk),this.a.uc(k,f))),this.Xm=q=this.yk,p=0):(this.Xm=q,this.a.uc(this.$d.getData(q),f),p=0),-1!=q&&(q=this.$d.bb(q));this.yk=-1;0<p&&(k=this.yA())&&(d=!0);if(10<b++)throw a.g.wa();d&&this.tJ();this.sA()&&(d=!0);e=e||d&&!1;c=c||d}while(d)}this.a.bf(this.vp);
this.a.bf(this.fg);return c=a.AI.$(this.a,this.U,this.$d,this.Qt)||c};c.prototype.os=function(a,e){return this.a.X(e)==a?!1:!0};c.prototype.qJ=function(a,e,c,b,d,f,k,m){if(b==k)return this.hj(c),this.hj(f),!1;var g=this.a.Ra(c,this.fg),h=this.a.Ra(d,this.fg),n=this.a.Ra(f,this.fg),p=this.a.Ra(m,this.fg);c=[0,0,0,0,0,0,0,0];var r=[0,0,0,0];c[0]=0;r[0]=g;c[1]=0;r[1]=h;c[2]=1;r[2]=n;c[3]=1;r[3]=p;for(g=1;4>g;g++){h=r[g];n=c[g];for(p=g-1;0<=p&&r[p]>h;)r[p+1]=r[p],c[p+1]=c[p],p--;r[p+1]=h;c[p+1]=n}r=0;
0!=c[0]&&(r|=1);0!=c[1]&&(r|=2);0!=c[2]&&(r|=4);0!=c[3]&&(r|=8);if(5!=r&&10!=r)return!1;a==e?a?(this.a.Sc(m,b),this.a.Tc(b,m),this.a.Sc(d,k),this.a.Tc(k,d)):(this.a.Tc(m,b),this.a.Sc(b,m),this.a.Tc(d,k),this.a.Sc(k,d)):a?(this.a.Tc(b,f),this.a.Sc(f,b),this.a.Tc(k,d),this.a.Sc(d,k)):(this.a.Sc(b,f),this.a.Tc(f,b),this.a.Sc(k,d),this.a.Tc(d,k));return!0};c.prototype.BA=function(a,c,b,d,f,k){this.pU?this.BJ():this.AJ(a,c,b,d,f,k)};c.prototype.BJ=function(){throw a.g.ra("not implemented.");};c.prototype.AJ=
function(a,c,b,d,f,k){if(a!=c)a?(this.a.Sc(b,f),this.a.Tc(f,b),this.a.Sc(k,d),this.a.Tc(d,k),this.pm(f,b),this.Jh(f,!0),this.a.Ui(f,!0),this.hj(b),this.pm(k,d),this.Jh(k,!0),this.a.Ui(k,!1)):(this.a.Sc(f,b),this.a.Tc(b,f),this.a.Sc(d,k),this.a.Tc(k,d),this.pm(f,b),this.Jh(f,!0),this.a.Ui(f,!1),this.hj(b),this.pm(k,d),this.Jh(k,!0),this.a.Ui(k,!0)),this.hj(d);else{var e=a?b:d,g=c?f:k;a=a?d:b;c=c?k:f;f=!1;this.a.Sc(e,g);this.a.Sc(g,e);this.a.Tc(a,c);this.a.Tc(c,a);for(k=c;k!=g;)b=this.a.Ua(k),d=this.a.X(k),
this.a.Tc(k,d),this.a.Sc(k,b),f=f||k==e,k=d;f||(b=this.a.Ua(g),d=this.a.X(g),this.a.Tc(g,d),this.a.Sc(g,b));this.pm(g,e);this.Jh(g,!0);this.a.Ui(g,!1);this.hj(e);this.pm(c,a);this.Jh(c,!0);this.a.Ui(c,!1);this.hj(a)}};c.prototype.sA=function(){for(var a=!1,c=this.a.Vb(this.U);-1!=c;){for(var b=this.a.Cb(c),d=0,f=this.a.Ha(c);d<f&&1<f;){var k=this.a.Ua(b),m=this.a.X(b);this.a.Cq(k,m)?(a=!0,this.Jh(b,!1),this.a.vf(b,!0),this.Jh(m,!1),this.a.vf(m,!0),b=k,d=0,f=this.a.Ha(c)):(b=m,d++)}if(2>this.a.Ha(c)){a=
this.a.Cb(c);d=0;for(f=this.a.Ha(c);d<f;d++)this.Jh(a,!1),a=this.a.X(a);c=this.a.Cr(c);a=!0}else c=this.a.bc(c)}return a};c.prototype.io=function(a){for(var c=!1;;){var b=this.a.X(a),h=this.a.Ua(a);if(b==a)return this.Jh(a,!0),this.a.Ui(a,!1),!0;if(!this.a.Cq(b,h))break;c=!0;this.hj(h);this.hj(b);this.Jh(a,!0);this.a.Ui(a,!1);this.pm(b,h);this.Jh(b,!0);this.a.Ui(b,!0);if(b==h)break;a=h}return c};c.prototype.tJ=function(){for(var a=0,c=this.$d.gc(this.$d.Wd);-1!=c;c=this.$d.bb(c)){var b=this.$d.getData(c);
this.a.im(b,-1)}for(var d=0,f=this.a.Vb(this.U);-1!=f;)if(c=this.a.Cb(f),-1==c||-1!=this.a.rd(c))b=f,f=this.a.bc(f),this.a.yu(b);else{this.a.im(c,f);for(var k=1,b=this.a.X(c);b!=c;b=this.a.X(b))this.a.im(b,f),k++;this.a.Jr(f,!1);this.a.hm(f,k);this.a.Wi(f,this.a.Ua(c));d+=k;a++;f=this.a.bc(f)}for(c=this.$d.gc(this.$d.Wd);-1!=c;c=this.$d.bb(c))b=this.$d.getData(c),-1==this.a.rd(b)&&(f=this.a.aD(this.U,b,b,null),d+=this.a.Ha(f),a++);this.a.gm(this.U,a);this.a.Pk(this.U,d);a=0;for(d=this.a.$c;-1!=d;d=
this.a.we(d))a+=this.a.F(d);this.a.ZF(a)};c.prototype.fl=function(a){for(var c=0,b=this.ie.size-1;c<b;c++)if(a=(a+1)%this.ie.size,-1!=this.ie.get(a))return a;return-1};c.prototype.pm=function(a,c){var e=this.a.Ra(c,this.vp),b=this.a.Ra(c,this.fg);this.a.Zy(a,c);this.a.lb(c,this.vp,e);this.a.lb(c,this.fg,b)};c.prototype.hj=function(a){var c=this.a.Ra(a,this.fg);-1!=c&&(this.ie.set(c,-1),this.a.lb(a,this.fg,-1))};c.$=function(a,e,b,d,f){var g=new c;g.a=a;g.U=e;g.yx=b;g.Qt=d;g.oe=f;return g.CJ()};c.prototype.mJ=
function(c,e){var b=this.nh.get(c),h=new a.b;this.a.uc(b,h);var b=new a.b,d=this.nh.get(e);this.a.uc(d,b);if(h.ub(b))return 0;c=this.Mq.get(c);d=new a.b;this.a.uc(c,d);e=this.Mq.get(e);c=new a.b;this.a.uc(e,c);e=new a.b;e.pc(h,d);h=new a.b;h.pc(b,c);return a.b.cq(e,h)};return c}();a.mm=c})(B||(B={}));(function(a){(function(a){a[a.Local=0]="Local";a[a.Geographic=1]="Geographic";a[a.Projected=2]="Projected";a[a.Unknown=3]="Unknown"})(a.HI||(a.HI={}));(function(a){a[a.Integer32=0]="Integer32";a[a.Integer64=
1]="Integer64";a[a.FloatingPoint=2]="FloatingPoint"})(a.rI||(a.rI={}));var c=function(){function c(){this.fo="";this.mi=0;this.Sl=null}c.prototype.Qc=function(){return this.mi};c.prototype.Ko=function(){var c=.001;0!=this.mi?c=a.ls.SM(this.mi):null!=this.Sl&&(c=a.mA.TM(this.Sl));return c};c.prototype.Se=function(){if(0!=this.mi)return a.Tb.Qd(a.ls.cC(this.mi));if(null!=this.Sl)return a.mA.UM(this.Sl)};c.Am=function(c){if(0!=c.mi){if(!0===a.ls.WO(c.mi))return 1;if(!0===a.ls.ZO(c.mi))return 2}return 3};
c.create=function(b){if(0>=b)throw a.g.N("Invalid or unsupported wkid: "+b);var e=new c;e.mi=b;return e};c.NL=function(b){if(null==b||0==b.length)throw a.g.N("Cannot create SpatialReference from null or empty text.");var e=new c;e.Sl=b;return e};c.prototype.lc=function(a){return this==a?!0:null==a||this.constructor!=a.constructor||this.mi!=a.mi||0==this.mi&&this.Sl!==a.Sl?!1:!0};c.mN=function(c,e){var b=Math.PI/180,h=new a.ca;a.nH.pN(c.w().x*b,c.w().y*b,e.w().x*b,e.w().y*b,h);return h.l};c.prototype.toString=
function(){return"[ tol: "+this.xq()+"; wkid: "+this.Qc()+"; wkt: "+this.Sl+"]"};c.prototype.hc=function(){if(""!==this.fo)return this.fo;var a=this.toString();if(Array.prototype.reduce)return this.fo="S"+a.split("").reduce(function(a,c){a=(a<<5)-a+c.charCodeAt(0);return a&a},0);var c=0;if(0===a.length)return"";for(var b=0;b<a.length;b++)c=(c<<5)-c+a.charCodeAt(b),c&=c;return this.fo="S"+c};c.prototype.xq=function(){return this.Ko()};c.jU=!0;c.ET=2147483645;c.FT=9007199254740990;return c}();a.Nf=
c})(B||(B={}));(function(a){function c(a,c){89.99999<c?c=89.99999:-89.99999>c&&(c=-89.99999);c*=.017453292519943;return[111319.49079327169*a,3189068.5*Math.log((1+Math.sin(c))/(1-Math.sin(c)))]}function b(a,c,e){a=a/6378137*57.29577951308232;return e?[a,57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*c/6378137)))]:[a-360*Math.floor((a+180)/360),57.29577951308232*(1.5707963267948966-2*Math.atan(Math.exp(-1*c/6378137)))]}function h(c,e){var b=c.vm();if(33===c.D()){var g=e(b.lk(),b.mk());
b.ic(g[0],g[1])}else if(197===c.D())g=e(c.R.v,c.R.C,!0),c=e(c.R.B,c.R.G,!0),b.K(g[0],g[1],c[0],c[1]);else for(g=new a.b,c=0;c<b.F();c++){b.w(c,g);var h=e(g.x,g.y,!0);g.ma(h[0],h[1]);b.ic(c,g)}return b}function e(a){return h(a,b)}function g(a){return h(a,c)}var d=function(){function c(){}c.Xr=function(c){var e=Math.PI/180,b=Math.sin(c.y*e);return a.b.Oa(6378137*c.x*e,3167719.6636462314*(b/(1-.006694379990197414*b*b)-6.111035746609262*Math.log((1-.0818191908429643*b)/(1+.0818191908429643*b))))};c.Wu=
function(c,e,b,g){var h=1/298.257223563,d=Math.sin(b);b=Math.cos(b);var f=(1-h)*Math.tan(c);c=1/Math.sqrt(1+f*f);for(var k=f*c,m=Math.atan2(f,b),f=c*d*c*d,n=1-f,p=2.7233160610754688E11*n/4.040829998466145E13,r=1+p/16384*(4096+p*(-768+p*(320-175*p))),u=p/1024*(256+p*(-128+p*(74-47*p))),p=g/(6356752.31424518*r),v=2*Math.PI,q,x,D,B;1E-12<Math.abs(p-v);)D=Math.cos(2*m+p),q=Math.sin(p),x=Math.cos(p),B=u*q*(D+u/4*(x*(-1+2*D*D)-u/6*D*(-3+4*q*q)*(-3+4*D*D))),v=p,p=g/(6356752.31424518*r)+B;g=k*q-c*x*b;n=h/
16*n*(4+h*(4-3*n));return a.b.Oa((e+(Math.atan2(q*d,c*x-k*q*b)-(1-n)*h*Math.sqrt(f)*(p+n*q*(D+n*x*(-1+2*D*D)))))/(Math.PI/180),Math.atan2(k*x+c*q*b,(1-h)*Math.sqrt(f+g*g))/(Math.PI/180))};c.cN=function(a,c,e,b){var g=1/298.257223563,h=b-c,d=Math.atan((1-g)*Math.tan(a)),f=Math.atan((1-g)*Math.tan(e)),k=Math.sin(d),d=Math.cos(d),m=Math.sin(f),f=Math.cos(f),n=h,p,r=1E3,u,v,q,x,D,B,t;do{q=Math.sin(n);x=Math.cos(n);v=Math.sqrt(f*q*f*q+(d*m-k*f*x)*(d*m-k*f*x));if(0===v)return 0;x=k*m+d*f*x;D=Math.atan2(v,
x);B=d*f*q/v;u=1-B*B;q=x-2*k*m/u;isNaN(q)&&(q=0);t=g/16*u*(4+g*(4-3*u));p=n;n=h+(1-t)*g*B*(D+t*v*(q+t*x*(-1+2*q*q)))}while(1E-12<Math.abs(n-p)&&0<--r);if(0===r)return k=b-c,{azimuth:Math.atan2(Math.sin(k)*Math.cos(e),Math.cos(a)*Math.sin(e)-Math.sin(a)*Math.cos(e)*Math.cos(k)),geodesicDistance:6371009*Math.acos(Math.sin(a)*Math.sin(e)+Math.cos(a)*Math.cos(e)*Math.cos(b-c))};a=2.7233160610754688E11*u/4.040829998466145E13;c=a/1024*(256+a*(-128+a*(74-47*a)));return{azimuth:Math.atan2(f*Math.sin(n),d*
m-k*f*Math.cos(n)),lN:6356752.31424518*(1+a/16384*(4096+a*(-768+a*(320-175*a))))*(D-c*v*(q+c/4*(x*(-1+2*q*q)-c/6*q*(-3+4*v*v)*(-3+4*q*q)))),yU:Math.atan2(d*Math.sin(n),d*m*Math.cos(n)-k*f)}};c.oT=function(c){var e=c.hasAttribute(1),b=c.hasAttribute(2),g=[],h=c.ea(),d=null,f=null;e&&(d=c.mc(1));b&&(f=c.mc(2));for(var k=new a.b,m=0;m<h;m++){for(var n=c.Ea(m),p=c.Ha(m),r=0,u=0,v=NaN,q=NaN,x=NaN,D=NaN,B=c.vc(m),t=[],z=n;z<n+p;z++){c.w(z,k);var D=x=NaN,C=[k.x,k.y];e&&(x=d.get(z),C.push(x));b&&(h=f.get(z),
C.push(D));z==n&&B&&(r=k.x,u=k.y,v=x,q=D);t.push(C)}!B||r==k.x&&u==k.y&&(!e||isNaN(v)&&isNaN(x)||v==x)&&(!b||isNaN(q)&&isNaN(D)||q==D)||t.push(t[0].slice(0));g.push(t)}return g};c.fw=function(a,e){a=c.oT(a);var b=Math.PI/180;637.100877151506>e&&(e=637.100877151506);for(var g=[],h=0;h<a.length;h++){var d=a[h],f;g.push(f=[]);f.push([d[0][0],d[0][1]]);var k,m,n,p,r,u;k=d[0][0]*b;m=d[0][1]*b;for(r=0;r<d.length-1;r++)if(n=d[r+1][0]*b,p=d[r+1][1]*b,k!==n||m!==p){p=c.cN(m,k,p,n);n=p.azimuth;p=p.lN;var v=
p/e;if(1<v){for(u=1;u<=v-1;u++){var q=c.Wu(m,k,n,u*e);f.push([q.x,q.y])}u=c.Wu(m,k,n,(p+Math.floor(v-1)*e)/2);f.push([u.x,u.y])}m=c.Wu(m,k,n,p);f.push([m.x,m.y]);k=m.x*b;m=m.y*b}}return{mF:g}};c.kN=function(e){for(var b=[],g=0;g<e.length;g++){var h=e[g],h=c.fw(h,1E4);b.push(h)}e=[];for(var d,f,k=0;k<b.length;k++){for(var h=b[k],m=0,g=0;g<h.mF.length;g++){var n=h.mF[g];d=c.Xr(a.b.Oa(n[0][0],n[0][1]));f=c.Xr(a.b.Oa(n[n.length-1][0],n[n.length-1][1]));var p=f.x*d.y-d.x*f.y,r;for(r=0;r<n.length-1;r++)d=
c.Xr(a.b.Oa(n[r+1][0],n[r+1][1])),f=c.Xr(a.b.Oa(n[r][0],n[r][1])),p+=f.x*d.y-d.x*f.y;p/=4046.87;m+=p}e.push(m/-2*4046.85642)}return e};return c}();a.oH=d;d=function(){function c(){}c.oy=function(a,e,b,g,h,d,f){c.AG[a.hc()]=e;0==isNaN(b)&&(c.CG[a.hc()]=b);0==isNaN(g)&&(c.iz[a.hc()]=g);0==isNaN(h)&&(c.lG[a.hc()]=h);c.EG[a.hc()]=d;null!==f&&(c.GG[a.hc()]=f)};c.xu=function(a,e,b){c.IG[a.hc()+"-"+e.hc()]=b};c.Em=function(e){e=c.AG[e.hc()];if(void 0==e)throw a.g.qe();return e};c.IC=function(e){e=c.CG[e.hc()];
if(void 0==e)throw a.g.qe();return e};c.ft=function(e){e=c.iz[e.hc()];if(void 0==e)throw a.g.qe();return e};c.Ts=function(e){e=c.lG[e.hc()];if(void 0==e)throw a.g.qe();return e};c.Fm=function(e){e=c.GG[e.hc()];if(void 0==e)throw a.g.qe();return a.i.Oa(e[0],e[1],e[2],e[3])};c.Qo=function(e){e=c.EG[e.hc()];if(void 0==e)throw a.g.qe();return e};c.Wl=function(e,b,g){if(b.lc(g))return e;var h=c.IG[b.hc()+"-"+g.hc()];if(void 0!==h)return h(e,b,g);throw a.g.qe();};c.tu=function(){throw a.g.qe();};c.qN=function(){throw a.g.qe();
};c.YQ=function(){throw a.g.qe();};c.TN=function(){throw a.g.qe();};c.qR=function(){var c=a.Nf.create(102100),b=a.Nf.create(3857),h=a.Nf.create(4326);a.Ya.oy(c,h,NaN,NaN,NaN,!1,null);a.Ya.oy(h,h,1,.0033528106647474805,6378137,!0,[-180,-90,180,90]);a.Ya.oy(b,h,NaN,NaN,NaN,!1,null);a.Ya.xu(c,h,e);a.Ya.xu(h,c,g);a.Ya.xu(b,h,e);a.Ya.xu(h,b,g)};c.AG=[];c.CG=[];c.iz=[];c.lG=[];c.EG=[];c.GG=[];c.IG=[];return c}();a.Ya=d})(B||(B={}));B.Ya.qR();(function(a){var c=function(){function c(a){this.f=null;this.qg=
-1;this.Xc=this.size=this.We=0;this.Ic=a}c.prototype.Jc=function(a){a<this.We?(this.f[a*this.Ic]=this.qg,this.qg=a):this.We--;this.size--};c.prototype.O=function(a,c){return this.f[a*this.Ic+c]};c.prototype.L=function(a,c,b){this.f[a*this.Ic+c]=b};c.prototype.be=function(){var c=this.qg;if(-1==c){if(this.We==this.Xc){c=0!=this.Xc?a.I.truncate(3*(this.Xc+1)/2):1;2147483647<c&&(c=2147483647);if(c==this.Xc)throw a.g.Uc();this.Gm(c)}c=this.We;this.We++}else this.qg=this.f[c*this.Ic];this.size++;for(var e=
c*this.Ic+this.Ic,b=c*this.Ic;b<e;b++)this.f[b]=-1;return c};c.prototype.Pj=function(c){var e=this.qg;if(-1==e){if(this.We==this.Xc){e=0!=this.Xc?a.I.truncate(3*(this.Xc+1)/2):1;2147483647<e&&(e=2147483647);if(e==this.Xc)throw a.g.Uc();this.Gm(e)}e=this.We;this.We++}else this.qg=this.f[e*this.Ic];this.size++;for(var b=e*this.Ic,h=this.Ic,d=0;d<h;d++)this.f[b+d]=c[d];return e};c.prototype.Nh=function(a){this.qg=-1;this.size=this.We=0;a&&(this.f=null,this.Xc=0)};c.prototype.de=function(a){a>this.Xc&&
this.Gm(a)};c.prototype.Pu=function(a,c,b){var e=this.f[this.Ic*c+b];this.f[this.Ic*c+b]=this.f[this.Ic*a+b];this.f[this.Ic*a+b]=e};c.Zk=function(){return-2};c.lm=function(){return-3};c.Zw=function(a){return 0<=a};c.prototype.Gm=function(a){null==this.f&&(this.f=[]);this.Xc=a};return c}();a.Fc=c;c=function(){function c(a){this.f=new Int32Array(0);this.qg=-1;this.Xc=this.size=this.We=0;this.Ic=a}c.prototype.Jc=function(a){a<this.We?(this.f[a*this.Ic]=this.qg,this.qg=a):this.We--;this.size--};c.prototype.O=
function(a,c){return this.f[a*this.Ic+c]};c.prototype.L=function(a,c,b){this.f[a*this.Ic+c]=b};c.prototype.be=function(){var c=this.qg;if(-1==c){if(this.We==this.Xc){c=0!=this.Xc?a.I.truncate(3*(this.Xc+1)/2):1;2147483647<c&&(c=2147483647);if(c==this.Xc)throw a.g.Uc();this.Gm(c)}c=this.We;this.We++}else this.qg=this.f[c*this.Ic];this.size++;for(var e=c*this.Ic;e<c*this.Ic+this.Ic;e++)this.f[e]=-1;return c};c.prototype.Pj=function(c){var e=this.qg;if(-1==e){if(this.We==this.Xc){e=0!=this.Xc?a.I.truncate(3*
(this.Xc+1)/2):1;2147483647<e&&(e=2147483647);if(e==this.Xc)throw a.g.Uc();this.Gm(e)}e=this.We;this.We++}else this.qg=this.f[e*this.Ic];this.size++;for(var b=e*this.Ic,h=0;h<c.length;h++)this.f[b+h]=c[h];return e};c.prototype.Nh=function(a){this.qg=-1;this.size=this.We=0;a&&(this.f=null,this.Xc=0)};c.prototype.de=function(a){a>this.Xc&&this.Gm(a)};c.prototype.Pu=function(a,c,b){var e=this.f[this.Ic*c+b];this.f[this.Ic*c+b]=this.f[this.Ic*a+b];this.f[this.Ic*a+b]=e};c.Zk=function(){return-2};c.lm=
function(){return-3};c.Zw=function(a){return 0<=a};c.prototype.Gm=function(a){null==this.f&&(this.f=new Int32Array(0));var c=new Int32Array(this.Ic*a);c.set(this.f,0);this.f=c;this.Xc=a};return c}();a.II=c;!0===a.ah.Sk&&(a.Fc=a.II)})(B||(B={}));(function(a){var c;(function(a){a[a.enumInputModeBuildGraph=0]="enumInputModeBuildGraph";a[a.enumInputModeSimplifyAlternate=4]="enumInputModeSimplifyAlternate";a[a.enumInputModeSimplifyWinding=5]="enumInputModeSimplifyWinding";a[a.enumInputModeIsSimplePolygon=
7]="enumInputModeIsSimplePolygon"})(c||(c={}));var b=function(){function c(c){this.me=c;this.Zg=NaN;this.LD=new a.Ag;this.MD=new a.Ag;this.Aq=new a.Nd;this.Bq=new a.Nd}c.prototype.compare=function(a,c,e){a=a.da(e);this.me.iy(c,this.LD);this.me.iy(a,this.MD);c=this.LD.get();a=this.MD.get();this.Aq.K(c.na,c.la);this.Bq.K(a.na,a.la);if(this.Aq.va<this.Bq.qa)return-1;if(this.Aq.qa>this.Bq.va)return 1;e=c.ja==c.ha;var b=a.ja==a.ha;if(e||b){if(e&&b)return 0;if(c.ja==a.ja&&c.na==a.na)return e?1:-1;if(c.ha==
a.ha&&c.la==a.la)return e?-1:1}e=c.xe(this.Zg,this.Aq.qa);b=a.xe(this.Zg,this.Bq.qa);e==b&&(e=Math.min(c.ha,a.ha),b=.5*(e+this.Zg),b==this.Zg&&(b=e),e=c.xe(b,this.Aq.qa),b=a.xe(b,this.Bq.qa));return e<b?-1:e>b?1:0};c.prototype.$F=function(a){this.Zg=a};return c}(),h=function(){function c(c){this.ab=c;this.uE=new a.Ag;this.nf=new a.b;this.xx=new a.Nd}c.prototype.eS=function(a){this.nf.J(a)};c.prototype.compare=function(a,c){this.ab.iy(a.da(c),this.uE);a=this.uE.get();this.xx.K(a.na,a.la);if(this.nf.x<
this.xx.qa)return-1;if(this.nf.x>this.xx.va)return 1;a=a.xe(this.nf.y,this.nf.x);return this.nf.x<a?-1:this.nf.x>a?1:0};return c}();c=function(){function c(){this.OD=this.Vh=this.Yh=this.px=this.Pm=this.je=this.xc=this.Ig=this.Td=null;this.sn=this.eg=-1;this.ND=!0;this.tx=!1;this.qx=NaN;this.ei=new a.wd;this.EK=2147483647;this.DK=a.I.truncate(-2147483648);this.Kf=this.Md=this.Ek=this.lp=this.Bl=this.kp=this.Zq=this.Be=-1;this.ta=0}c.prototype.Mv=function(a){this.qx=a};c.prototype.Ul=function(){null==
this.Td&&(this.Td=new a.Fc(8));var c=this.Td.be();this.Td.L(c,1,0);return c};c.prototype.kQ=function(){null==this.xc&&(this.xc=new a.Fc(8));var c=this.xc.be();this.xc.L(c,2,0);this.xc.L(c,3,0);var e=this.xc.be();this.xc.L(e,2,0);this.xc.L(e,3,0);this.GF(c,e);this.GF(e,c);return c};c.prototype.FE=function(){null==this.je&&(this.je=new a.Fc(8));var c=this.je.be();this.je.L(c,2,0);return c};c.prototype.QR=function(a,c){this.Td.L(a,7,c)};c.prototype.em=function(a,c){this.Td.L(a,2,c)};c.prototype.PR=function(a,
c){this.Td.L(a,1,c)};c.prototype.fS=function(a,c){this.Td.L(a,3,c)};c.prototype.cS=function(a,c){this.Td.L(a,4,c)};c.prototype.Lp=function(a,c){this.Td.L(a,5,c)};c.prototype.uN=function(a){return this.Td.O(a,5)};c.prototype.OR=function(a,c){this.Td.L(a,6,c)};c.prototype.IJ=function(a,c){this.OR(c,a)};c.prototype.FF=function(a,c){this.xc.L(a,1,c)};c.prototype.GF=function(a,c){this.xc.L(a,4,c)};c.prototype.Rk=function(a,c){this.xc.L(a,5,c)};c.prototype.Qk=function(a,c){this.xc.L(a,6,c)};c.prototype.VR=
function(a,c){this.xc.L(a,2,c)};c.prototype.Du=function(a,c){this.xc.L(a,3,c)};c.prototype.zC=function(a){return this.xc.O(a,3)};c.prototype.Ir=function(a,c){this.xc.L(a,7,c)};c.prototype.zG=function(a,c){if(-1!=this.ql(a))for(c=c?-1:a,a=this.ql(a);-1!=a;a=this.zq(a))this.a.lb(this.Gi(a),this.lp,c)};c.prototype.Tu=function(a,c){-1!=a&&(this.zG(a,c),this.zG(this.sa(a),c))};c.prototype.Gr=function(a,c){this.je.L(a,1,c)};c.prototype.yg=function(a,c){this.je.L(a,2,c)};c.prototype.cm=function(a,c){this.je.L(a,
3,c);this.LR(a,this.tN(c));this.KR(c,a)};c.prototype.KR=function(a,c){this.je.L(a,4,c)};c.prototype.LR=function(a,c){this.je.L(a,5,c)};c.prototype.AF=function(a,c){this.je.L(a,6,c)};c.prototype.yF=function(a,c){this.je.L(a,7,c)};c.prototype.xF=function(a,c){this.Pm.write(a,c)};c.prototype.zF=function(a,c){this.px.write(a,c)};c.prototype.bT=function(c){var e=0,b=0,g=this.pC(c),h=new a.b,d=new a.b,f=new a.b;this.tq(g,h);d.J(h);var k=g;do this.pl(k,f),b+=a.b.Fb(d,f),this.Pe(this.sa(k))!=c&&(e+=(f.x-
h.x-(d.x-h.x))*(f.y-h.y+(d.y-h.y))*.5),d.J(f),k=this.Wb(k);while(k!=g);this.Pm.write(c,e);this.px.write(c,b)};c.prototype.GQ=function(c){var e=new b(this),g=new a.bj;g.de(a.I.truncate(this.ta/2));g.Hn(e);for(var d=new a.ga(0),f=this.Eg(),k=null,m=0,p=new a.b,r=this.Be;-1!=r;r=this.Bf(r)){m++;var u=this.te(r);if(-1!=u){d.cf(0);if(!this.VS(g,f,d,u)){this.w(r,p);e.$F(p.y);var v=u;do{var q=this.tb(v,f);-1!=q&&(g.kd(q,-1),this.Bb(v,f,-2));v=this.Wb(this.sa(v))}while(u!=v);v=u;do q=this.tb(v,f),-1==q&&
(q=g.addElement(v,-1),d.add(q)),v=this.Wb(this.sa(v));while(u!=v)}for(u=d.size-1;0<=u;u--)q=d.get(u),v=g.da(q),this.Bb(this.sa(v),f,q),this.FQ(g,q,c)}else-1==this.mw(r)&&(null==k&&(k=new h(this)),this.w(r,p),k.eS(p),v=g.GR(k),u=this.Ek,-1!=v&&(q=g.da(v),this.Pe(q)==this.Pe(this.sa(q))&&(q=this.BC(g,v)),-1!=q&&(u=this.Pe(q))),this.IJ(u,r))}this.kh(f)};c.prototype.FQ=function(a,c,e){var b=a.da(c),g=this.Pe(b);if(-1==this.ym(g)){var h=this.BC(a,c),d=this.sa(b),f=this.Pe(d);this.yo(g);this.yo(f);var k=
this.ym(g),m=this.ym(f);-1==h&&-1==k&&(f==g?(this.cm(f,this.Ek),k=m=this.Ek):(-1==m&&(this.cm(f,this.Ek),m=this.Ek),this.cm(g,f),k=f));if(-1!=h){var n=this.Pe(h);-1==m&&(0>=this.yo(n)?(m=this.ym(n),this.cm(f,m)):(this.cm(f,n),m=n),f==g&&(k=m))}-1==k&&this.WS(g,f);0==e?this.aR(a,c,b,h,g,f):5==e?this.bR(a,c,b,d,g,f):4==e&&this.$Q(b,h,g,f)}};c.prototype.aR=function(a,c,e,b,h,d){var g=this.pj(h);if(-1!=b){var f=this.pj(d),k=this.pj(this.Pe(b));b=g&f&k;k^=k&this.Gg(e);k|=b;0!=k&&(this.yg(d,f|k),this.yg(h,
k|g),g=g||k)}for(c=a.bb(c);-1!=c;c=a.bb(c)){b=a.da(c);e=this.Pe(this.sa(b));h=this.pj(e);d=this.Gg(b);f=this.Pe(b);k=this.pj(f);b=h&k&g;g^=g&d;g|=b;if(0==g)break;this.yg(e,h|g);this.yg(f,k|g)}};c.prototype.bR=function(c,e,b,h,d,f){if(d!=f){b=this.tb(b,this.Kf);b+=this.tb(h,this.Kf);h=0;var g=new a.ga(0),k=new a.ga(0);k.add(0);for(var m=c.gc(-1);m!=e;m=c.bb(m)){var n=c.da(m),p=this.sa(n),r=this.Pe(n),u=this.Pe(p);if(r!=u){n=this.tb(n,this.Kf);n+=this.tb(p,this.Kf);h+=n;p=!1;0!=g.size&&g.tc()==u&&(k.af(),
g.af(),p=!0);if(-1==this.ym(u))throw a.g.wa();p&&this.ym(u)==r||(k.add(h),g.add(r))}}h+=b;0!=g.size&&g.tc()==f&&(k.af(),g.af());0!=h?0==k.tc()&&(c=this.a.$c,c=this.ya(c),this.yg(d,c)):0!=k.tc()&&(c=this.a.$c,c=this.ya(c),this.yg(d,c))}};c.prototype.$Q=function(a,c,e,b){var g=this.ya(this.a.$c);if(-1==c)this.yg(b,this.sn),a=this.tb(a,this.eg),0!=(a&1)?this.yg(e,g):this.yg(e,this.sn);else{var h=this.pj(b);0==h&&(h=this.pj(this.Pe(c)),this.yg(b,h));a=this.tb(a,this.eg);0!=(a&1)?this.yg(e,h==g?this.sn:
g):this.yg(e,h)}};c.prototype.VS=function(a,c,e,b){var g=b,h=-1,d=-1,f=0;do{if(2==f)return!1;var k=this.tb(g,c);if(-1!=k){if(-1!=h)return!1;h=k}else{if(-1!=d)return!1;d=g}f++;g=this.Wb(this.sa(g))}while(b!=g);if(-1==d||-1==h)return!1;this.Bb(a.da(h),c,-2);a.Vi(h,d);e.add(h);return!0};c.prototype.WS=function(a,c){var e=this.yo(a);if(0!=e){var b=this.yo(c);0<e&&0>b?this.cm(a,c):0>e&&0<b?this.cm(a,c):(e=this.ym(c),-1!=e&&this.cm(a,e))}};c.prototype.RL=function(c,e){this.lp=this.a.re();for(var b=0,g=
e.size;b<g;b++){var h=e.get(b),d=this.a.Ra(h,this.Bl),f=this.a.Vf(this.a.rd(h)),k=this.a.Lb(f);if(a.T.Kc(k)){var m=this.a.X(h);if(-1!=m){var n=this.a.Ra(m,this.Bl);if(d!=n){var p=this.kQ(),r=this.sa(p),u=this.Ig.be();this.Ig.L(u,0,h);this.Ig.L(u,1,-1);this.Ir(p,u);this.FF(p,d);u=this.te(d);-1==u?(this.em(d,p),this.Rk(p,r),this.Qk(r,p)):(d=this.fe(u),this.Rk(u,r),this.Qk(r,u),this.Qk(d,p),this.Rk(p,d));this.FF(r,n);d=this.te(n);-1==d?(this.em(n,r),this.Qk(p,r),this.Rk(r,p)):(n=this.fe(d),this.Rk(d,
p),this.Qk(p,d),this.Qk(n,r),this.Rk(r,n));f=this.ya(f);0==c?(this.Bb(r,this.Md,0),this.Bb(p,this.Md,1736==k?f:0)):5==c?(n=new a.b,this.a.w(h,n),h=new a.b,this.a.w(m,h),d=m=0,0>n.compare(h)?m=1:d=-1,this.Bb(r,this.Md,0),this.Bb(p,this.Md,0),this.Bb(p,this.Kf,m),this.Bb(r,this.Kf,d)):7==c?(this.Bb(r,this.Md,this.sn),this.Bb(p,this.Md,1736==k?f:0)):4==c&&(this.Bb(r,this.Md,0),this.Bb(p,this.Md,0),this.Bb(p,this.eg,1),this.Bb(r,this.eg,1));k=1736==k?this.DK:0;this.Du(p,f|k);this.Du(r,f|k)}}}}};c.prototype.ZP=
function(a,c){var e=this.ql(c);if(-1!=e){var b=this.ql(a);this.Ig.L(e,1,b);this.Ir(a,e);this.Ir(c,-1)}a=this.sa(a);c=this.sa(c);e=this.ql(c);-1!=e&&(b=this.ql(a),this.Ig.L(e,1,b),this.Ir(a,e),this.Ir(c,-1))};c.prototype.AS=function(c){function e(a,c){return g.lL(a,c)}var b=new a.ga(0);b.xb(10);for(var g=this,h=this.Be;-1!=h;h=this.Bf(h)){b.clear(!1);var d=this.te(h);if(-1!=d){var f=d;do b.add(f),f=this.Wb(this.sa(f));while(f!=d);if(1<b.size){f=!0;if(2<b.size)b.xd(0,b.size,e),b.add(b.get(0));else if(0<
this.kL(b.get(0),b.get(1))){var k=b.get(0);b.set(0,b.get(1));b.set(1,k)}else f=!1;for(var m=k=b.get(0),p=this.jf(m),r=this.sa(m),u=-1,v=1,q=b.size;v<q;v++){var x=b.get(v),D=this.sa(x),B=this.qj(D);if(B==p&&x!=m){if(0==c)u=this.zC(m)|this.zC(x),this.Du(m,u),this.Du(r,u),this.Bb(m,this.Md,this.tb(m,this.Md)|this.tb(x,this.Md)),this.Bb(r,this.Md,this.tb(r,this.Md)|this.tb(D,this.Md));else if(-1!=this.Kf)u=this.tb(m,this.Kf)+this.tb(x,this.Kf),D=this.tb(r,this.Kf)+this.tb(D,this.Kf),this.Bb(m,this.Kf,
u),this.Bb(r,this.Kf,D);else{if(7==c){this.ei=new a.wd(5,h,-1);return}-1!=this.eg&&(u=this.tb(m,this.eg)+this.tb(x,this.eg),D=this.tb(r,this.eg)+this.tb(D,this.eg),this.Bb(m,this.eg,u),this.Bb(r,this.eg,D))}this.ZP(m,x);this.Wv(x);u=m;b.set(v,-1);x==k&&(b.set(0,-1),k=-1)}else this.Tu(u,!1),u=-1,m=x,p=B,r=D}this.Tu(u,!1);u=-1;if(f){k=-1;v=0;for(q=b.size;v<q;v++)if(x=b.get(v),-1!=x)if(-1==k)m=k=x,p=this.jf(m),r=this.sa(m);else if(x!=m&&(D=this.sa(x),B=this.qj(D),this.Qk(r,x),this.Rk(x,r),m=x,p=B,r=
D,7==c&&(this.tb(x,this.Md)|this.tb(this.fe(x),this.Md))==(this.sn|1))){this.ei=new a.wd(5,h,-1);return}this.em(h,k)}else{k=-1;v=0;for(q=b.size;v<q;v++)if(x=b.get(v),-1!=x){k=x;break}d!=k&&this.em(h,k)}}}}};c.prototype.AK=function(){for(var c=-1,e=this.Eg(),b=this.Be;-1!=b;b=this.Bf(b)){var h=this.te(b);if(-1!=h){var d=h;do{if(1!=this.tb(d,e)){var f=this.FE();this.Gr(f,d);this.yF(f,c);-1!=c&&this.AF(c,f);var c=f,k=0,m=d;do k|=this.tb(m,this.Md),this.VR(m,f),this.Bb(m,e,1),m=this.Wb(m);while(m!=d);
this.yg(f,k)}d=this.Wb(this.sa(d))}while(d!=h)}}f=this.FE();this.Gr(f,-1);this.yF(f,c);-1!=c&&this.AF(c,f);this.Ek=f;this.Pm=a.qd.Yc(this.je.size,NaN);this.px=a.qd.Yc(this.je.size,NaN);this.xF(this.Ek,Infinity);this.zF(this.Ek,Infinity);this.kh(e)};c.prototype.EN=function(a,c,e){c=-1!=c?c:this.te(a);if(-1==c)return-1;for(a=c;;){if(1!=this.tb(c,e))return c;c=this.Wb(this.sa(c));if(c==a)return-1}};c.prototype.uR=function(){for(var a=this.Eg(),c=this.Be;-1!=c;c=this.Bf(c))for(var e=-1;;){var b=this.EN(c,
e,a);if(-1==b)break;for(var e=this.Wb(this.sa(b)),h=b;;){var d=this.Wb(h),f=this.fe(h),k=this.sa(h);if(f==k){this.bM(h);if(e==h||e==k)e=-1;if(h==b||f==b){b=d;if(h==b||f==b)break;h=d;continue}}else this.Bb(h,a,1);h=d;if(h==b)break}}};c.prototype.Ay=function(c,e,b,h){this.xg();this.ND=h;this.a=c;this.kp=this.a.RB();c=new a.ga(0);c.xb(null!=b?this.a.F(b.get(0)):this.a.pd);var g=0,d=1,f=null!=b?b.get(0):this.a.$c;for(h=1;-1!=f;){this.a.EF(f,this.kp,d);for(var d=d<<1,k=this.a.Vb(f);-1!=k;k=this.a.bc(k))for(var m=
this.a.Cb(k),n=0,p=this.a.Ha(k);n<p;n++)c.add(m),m=this.a.X(m);a.T.Km(this.a.Lb(f))||(g+=this.a.ea(f));null!=b?(f=h<b.size?b.get(h):-1,h++):f=this.a.we(f)}this.sn=d;this.ta=c.size;this.a.Mu(c,this.ta);null==this.Ig&&(this.Ig=new a.Fc(2),this.Td=new a.Fc(8),this.xc=new a.Fc(8),this.je=new a.Fc(8));this.Ig.de(this.ta);this.Td.de(this.ta+10);this.xc.de(2*this.ta+32);this.je.de(Math.max(32,g));this.Bl=this.a.re();b=new a.b;h=0;g=new a.b;b.Eh();for(d=0;d<=this.ta;d++)if(d<this.ta?(m=c.get(d),this.a.w(m,
g)):g.Eh(),!b.ub(g)){if(h<d){m=this.Ul();for(p=n=-1;h<d;h++)p=c.get(h),this.a.lb(p,this.Bl,m),f=this.Ig.be(),this.Ig.L(f,0,p),this.Ig.L(f,1,n),n=f,k=this.a.rd(p),f=this.a.Vf(k),f=this.ya(f),this.PR(m,this.md(m)|f);this.QR(m,n);this.Lp(m,this.a.gb(p));-1!=this.Zq&&this.cS(this.Zq,m);this.fS(m,this.Zq);this.Zq=m;-1==this.Be&&(this.Be=m)}h=d;b.J(g)}this.Md=this.Eg();5==e&&(this.Kf=this.Eg());4==e&&(this.eg=this.Eg());this.RL(e,c);0==this.ei.yh&&(this.AS(e),0==this.ei.yh&&(isNaN(this.qx)||this.ZK()?(this.AK(),
0==this.ei.yh&&(this.kh(this.Md),this.Md=-1,this.ND&&this.GQ(e))):this.tx=!0))};c.prototype.Wv=function(a){var c=this.Wb(a),e=this.fe(a),b=this.sa(a),g=this.Wb(b),h=this.fe(b);c!=b&&(this.Qk(h,c),this.Rk(c,h));e!=b&&(this.Qk(e,g),this.Rk(g,e));e=this.qj(a);this.te(e)==a&&(g!=a?this.em(e,g):this.em(e,-1));g=this.qj(b);this.te(g)==b&&(c!=b?this.em(g,c):this.em(g,-1));this.xc.Jc(a);this.xc.Jc(b)};c.prototype.BC=function(a,c){for(;;)if(c=a.ge(c),-1!=c){var e=a.da(c);if(this.Pe(e)!=this.Pe(this.sa(e)))return e}else return-1};
c.prototype.Mp=function(a,c,e){void 0===e&&(e=!0);this.Ay(a,0,null,e)};c.prototype.tF=function(c,e){var b=new a.ga(0);b.add(e);this.Ay(c,4,b,1736==c.Lb(e))};c.prototype.uF=function(c,e){var b=new a.ga(0);b.add(e);this.Ay(c,5,b,!0)};c.prototype.xg=function(){null!=this.a&&(-1!=this.kp&&(this.a.tR(this.kp),this.kp=-1),-1!=this.Bl&&(this.a.bf(this.Bl),this.Bl=-1),-1!=this.lp&&(this.a.bf(this.lp),this.lp=-1),-1!=this.Md&&(this.kh(this.Md),this.Md=-1),-1!=this.Kf&&(this.kh(this.Kf),this.Kf=-1),-1!=this.eg&&
(this.kh(this.eg),this.eg=-1),this.a=null,this.Td.Nh(!0),this.Ig.Nh(!0),this.Zq=this.Be=-1,null!=this.xc&&this.xc.Nh(!0),null!=this.Yh&&(this.Yh.length=0),null!=this.Vh&&(this.Vh.length=0),null!=this.OD&&(this.OD.length=0),null!=this.je&&this.je.Nh(!0),this.Ek=-1,this.Pm=null)};c.prototype.te=function(a){return this.Td.O(a,2)};c.prototype.w=function(a,c){this.a.SC(this.uN(a),c)};c.prototype.md=function(a){return this.Td.O(a,1)};c.prototype.Bf=function(a){return this.Td.O(a,4)};c.prototype.mw=function(a){return this.Td.O(a,
6)};c.prototype.ol=function(a){return this.Td.O(a,7)};c.prototype.zq=function(a){return this.Ig.O(a,1)};c.prototype.Gi=function(a){return this.Ig.O(a,0)};c.prototype.Sf=function(a,c){c=this.Vh[c];return c.size<=a?-1:c.read(a)};c.prototype.fm=function(a,c,e){c=this.Vh[c];c.size<=a&&c.resize(this.Td.size,-1);c.write(a,e)};c.prototype.uo=function(){null==this.Vh&&(this.Vh=[]);for(var c=a.ga.Yc(this.Td.Xc,-1),e=0,b=this.Vh.length;e<b;e++)if(null==this.Vh[e])return this.Vh[e]=c,e;this.Vh.push(c);return this.Vh.length-
1};c.prototype.vo=function(a){this.Vh[a]=null};c.prototype.qj=function(a){return this.xc.O(a,1)};c.prototype.jf=function(a){return this.qj(this.sa(a))};c.prototype.sa=function(a){return this.xc.O(a,4)};c.prototype.fe=function(a){return this.xc.O(a,5)};c.prototype.Wb=function(a){return this.xc.O(a,6)};c.prototype.Pe=function(a){return this.xc.O(a,2)};c.prototype.Qe=function(a){return this.pj(this.xc.O(a,2))};c.prototype.ql=function(a){return this.xc.O(a,7)};c.prototype.tq=function(a,c){this.w(this.qj(a),
c)};c.prototype.pl=function(a,c){this.w(this.jf(a),c)};c.prototype.Gg=function(a){return this.xc.O(a,3)&this.EK};c.prototype.tb=function(a,c){c=this.Yh[c];return c.size<=a?-1:c.read(a)};c.prototype.Bb=function(a,c,e){c=this.Yh[c];c.size<=a&&c.resize(this.xc.size,-1);c.write(a,e)};c.prototype.Eg=function(){null==this.Yh&&(this.Yh=[]);for(var c=a.ga.Yc(this.xc.Xc,-1),e=0,b=this.Yh.length;e<b;e++)if(null==this.Yh[e])return this.Yh[e]=c,e;this.Yh.push(c);return this.Yh.length-1};c.prototype.kh=function(a){this.Yh[a]=
null};c.prototype.bM=function(a){var c=this.Pe(a),e=this.Wb(a);e==this.sa(a)&&(e=this.Wb(e),e==a&&(e=-1));this.pC(c)==a&&this.Gr(c,e);e=this.Pm.read(c);isNaN(e)||(this.xF(c,NaN),this.zF(c,NaN));this.Tu(a,!0);this.Wv(a)};c.prototype.cM=function(a){for(var c=0,e=a.size;c<e;c++){var b=a.get(c),g=this.Pe(this.sa(b));this.Gr(this.Pe(b),-1);this.Gr(g,-1);this.Tu(b,!0);this.Wv(b)}};c.prototype.pC=function(a){return this.je.O(a,1)};c.prototype.pj=function(a){return this.je.O(a,2)};c.prototype.ym=function(a){return this.je.O(a,
3)};c.prototype.tN=function(a){return this.je.O(a,4)};c.prototype.yo=function(a){var c=this.Pm.read(a);isNaN(c)&&(this.bT(a),c=this.Pm.read(a));return c};c.prototype.ya=function(a){return this.a.yC(a,this.kp)};c.prototype.se=function(a){return this.a.Ra(a,this.Bl)};c.prototype.GN=function(a){return this.a.Ra(a,this.lp)};c.prototype.FN=function(a,c){var e=this.te(a);if(-1==e)return-1;var b=e,g=-1,h=-1;do{if(this.jf(b)==c)return b;if(-1==g){g=this.te(c);if(-1==g)break;h=g}if(this.jf(h)==a)return b=
this.sa(h);b=this.Wb(this.sa(b));h=this.Wb(this.sa(h))}while(b!=e&&h!=g);return-1};c.prototype.iy=function(c,e){e.mq();e=e.get();var b=new a.b;this.tq(c,b);e.ed(b);this.pl(c,b);e.vd(b)};c.prototype.lL=function(c,e){if(c==e)return 0;var b=new a.b;this.pl(c,b);var g=new a.b;this.pl(e,g);if(b.ub(g))return 0;e=new a.b;this.tq(c,e);c=new a.b;c.pc(b,e);b=new a.b;b.pc(g,e);return a.b.cq(c,b)};c.prototype.kL=function(c,e){if(c==e)return 0;var b=new a.b;this.pl(c,b);var g=new a.b;this.pl(e,g);if(b.ub(g))return 0;
e=new a.b;this.tq(c,e);c=new a.b;c.pc(b,e);b=new a.b;b.pc(g,e);return 0<=b.y&&0<c.y?a.b.cq(c,b):0};c.prototype.ZK=function(){for(var c=a.vi.Ty(this.qx),e=new a.b,b=new a.b,h=new a.b,d=new a.b,f=new a.b,k=this.Be;-1!=k;k=this.Bf(k)){var m=this.te(k);if(-1!=m){var p=m;this.tq(p,e);this.pl(p,b);f.pc(b,e);var r=f.Up();do{var u=p,p=this.Wb(this.sa(p));if(p!=u){this.pl(p,h);d.pc(h,e);var u=d.Up(),v=d.Ai(f);if(v*v/(u*r)*Math.min(u,r)<=c)return!1;f.J(d);r=u;b.J(h)}}while(p!=m)}}return!0};return c}();a.gs=
c})(B||(B={}));(function(a){var c=function(){function c(){this.h=null;this.TD=new a.b;this.UD=new a.b;this.Qg=null;this.Gq=!1;this.Ym=-1}c.prototype.Te=function(a){return a<this.Qg.length?this.Qg[a]:!1};c.prototype.xm=function(c,e,b,d){var g=a.T.ve(this.h.a.Lb(b));if(2==a.T.ve(this.h.a.Lb(e))&&1==g)this.WL(c,e,b,d);else throw a.g.wa();};c.prototype.Mp=function(c,e){null==this.h&&(this.h=new a.gs);this.h.Mp(c,e)};c.prototype.Np=function(c,e,b){a.aj.$(c,e,b,!0);for(e=c.$c;-1!=e;e=c.we(e))1736==c.Lb(e)&&
a.mm.$(c,e,-1,this.Gq,b);this.Mp(c,b)};c.prototype.EB=function(a,c,b,d,f){var e=this.h.a;if(1736==e.Lb(a))for(a=e.Vb(a);-1!=a;a=e.bc(a)){var g=e.Cb(a);this.h.se(g);this.h.se(e.X(g));var h=this.h.GN(g);if(-1!=h){var k=this.h.tb(h,b);if(1!=k&&2!=k)if(this.Te(this.h.Qe(h))){this.h.Bb(h,b,1);var k=e.Cf(c,-1),m=h,n=this.h.se(g),p=1;do{var r=this.tl(g,f);e.zi(k,r);-1!=d&&this.h.fm(n,d,1);this.h.Bb(m,b,1);var m=this.h.Wb(m),u;do r=1==p?e.X(g):e.Ua(g),u=-1!=r?this.h.se(r):-1;while(u==n);var v=this.h.qj(m);
if(v!=u){do r=1==p?e.Ua(g):e.X(g),u=-1!=r?this.h.se(r):-1;while(u==n);v!=u?(u=v,r=this.h.Gi(this.h.ol(u))):p=-p}n=u;g=r}while(m!=h);e.Gn(k,!0)}else this.h.Bb(h,b,2)}}};c.prototype.UB=function(){for(var c=this.h.Eg(),e=new a.ga(0),b=this.h.Be;-1!=b;b=this.h.Bf(b)){var d=this.h.te(b),f=d;if(-1!=d){do{if(1!=this.h.tb(f,c)){var k=this.h.sa(f);this.h.Bb(k,c,1);this.h.Bb(f,c,1);this.Te(this.h.Qe(f))&&this.Te(this.h.Qe(k))&&e.add(f)}f=this.h.Wb(this.h.sa(f))}while(f!=d)}}this.h.kh(c);this.h.cM(e)};c.prototype.tl=
function(a,c){return-1==c?a:this.kO(a,c)};c.prototype.kO=function(a,c){var e=this.h.a,b,h,d=this.h.ol(this.h.se(a));do{b=this.h.Gi(d);h=e.Vf(e.rd(b));if(h==c)return b;d=this.h.zq(d)}while(-1!=d);return a};c.prototype.Xp=function(c,e,b){this.UB();var g=this.h.a,h=g.jg(1736),d=this.h.Eg();this.pG(c,e,h,b,d,-1);this.h.kh(d);a.mm.$(g,h,1,this.Gq,null);return h};c.prototype.pG=function(a,c,b,d,f,k){this.EB(a,b,f,k,d);-1!=c&&this.EB(c,b,f,k,d);a=this.h.a;for(c=this.h.Be;-1!=c;c=this.h.Bf(c)){var e=this.h.te(c);
if(-1!=e){var g=e;do{var h=this.h.tb(g,f);if(1!=h&&2!=h)if(this.Te(this.h.Qe(g))){var h=a.Cf(b,-1),m=g;do{var n=this.h.ql(m);-1!=n?n=this.h.Gi(n):(n=this.h.Gi(this.h.ql(this.h.sa(m))),n=this.h.a.X(n));n=this.tl(n,d);a.zi(h,n);this.h.Bb(m,f,1);-1!=k&&(n=this.h.se(n),this.h.fm(n,k,1));m=this.h.Wb(m)}while(m!=g);a.Gn(h,!0)}else this.h.Bb(g,f,2);g=this.h.Wb(this.h.sa(g))}while(g!=e)}}};c.prototype.RS=function(c,e,b){var g=this.h.a,h=g.jg(1736),d=g.jg(1607),f=g.jg(550);this.UB();var k=-1,m=this.h.Eg(),
p=this.h.uo();this.pG(c,e,h,b,m,p);for(c=this.h.Be;-1!=c;c=this.h.Bf(c))if(e=this.h.te(c),-1!=e){var r=e;do{var u=this.h.tb(r,m),v=this.h.tb(this.h.sa(r),m),u=u|v;if(2==u)if(u=this.h.Gg(r),this.Te(u)){var q=g.Cf(d,-1),x=r,u=this.Au(c,g),u=this.tl(u,b);g.zi(q,u);this.h.fm(c,p,1);do{u=this.h.jf(x);v=this.Au(u,g);v=this.tl(v,b);g.zi(q,v);this.h.Bb(x,m,1);this.h.Bb(this.h.sa(x),m,1);this.h.fm(u,p,1);x=this.h.Wb(x);u=this.h.tb(x,m);v=this.h.tb(this.h.sa(x),m);u|=v;if(2!=u)break;u=this.h.Gg(x);if(!this.Te(u)){this.h.Bb(x,
m,1);this.h.Bb(this.h.sa(x),m,1);break}}while(x!=r)}else this.h.Bb(r,m,1),this.h.Bb(this.h.sa(r),m,1);r=this.h.Wb(this.h.sa(r))}while(r!=e)}for(c=this.h.Be;-1!=c;c=this.h.Bf(c))u=this.h.Sf(c,p),1!=u&&(u=this.h.md(c),this.Te(u)&&(-1==k&&(k=g.Cf(f,-1)),e=this.h.ol(c),-1!=e&&(e=this.h.Gi(e),u=this.tl(e,b),g.zi(k,u))));this.h.vo(p);this.h.kh(m);a.mm.$(g,h,1,this.Gq,null);b=[];b[0]=f;b[1]=d;b[2]=h;return b};c.prototype.Au=function(a,c){var e=-1;for(a=this.h.ol(a);-1!=a;a=this.h.zq(a)){var b=this.h.Gi(a);
-1==e&&(e=b);var h=this.h.ya(c.Vf(c.rd(b)));if(this.Te(h)){e=b;break}}return e};c.prototype.fy=function(c,e){for(var b=this.h.qj(e),h=this.h.jf(e),d=0,f=0,k=this.h.ol(b);-1!=k;k=this.h.zq(k)){var m=this.h.Gi(k),p=c.rd(m),r=this.h.ya(c.Vf(p)),u=c.X(m),v=c.Ua(m),p=c.Cb(p);p==m&&(this.Ym=e);-1!=u&&this.h.se(u)==h?(d++,this.Te(r)&&(p==u&&(this.Ym=this.h.Wb(e)),f++)):-1!=v&&this.h.se(v)==h&&(d--,this.Te(r)&&(p==v&&(this.Ym=this.h.Wb(e)),f--))}this.h.w(b,this.TD);this.h.w(h,this.UD);b=a.b.Fb(this.TD,this.UD);
return(0!=f?f:d)*b};c.prototype.Ao=function(a){return this.h.Gg(a)|this.h.Qe(a)|this.h.Qe(this.h.sa(a))};c.prototype.sG=function(a){for(var c=this.h.sa(this.h.fe(a)),b=-1;c!=a;){if(this.Te(this.Ao(c))){if(-1!=b)return-1;b=c}c=this.h.sa(this.h.fe(c))}return-1!=b?this.h.sa(b):-1};c.prototype.tG=function(a){for(var c=this.h.sa(this.h.Wb(a)),b=-1;c!=a;){if(this.Te(this.Ao(c))){if(-1!=b)return-1;b=c}c=this.h.sa(this.h.Wb(c))}return-1!=b?this.h.sa(b):-1};c.prototype.jF=function(c,e,b,d,f){var g=this.h.a,
h=c,k=this.h.sa(h);this.h.Bb(h,b,1);this.h.Bb(k,b,1);var m=this.fy(g,h);this.Ym=-1;for(var n=h,p=-1,r=!1,u=1;;){var v=this.h.fe(h);if(v==k)break;k=this.h.Wb(k);if(this.h.sa(v)!=k)if(h=this.sG(h),-1==h)break;else r=!0,k=this.h.sa(h);else h=v;if(h==c){p=c;break}v=this.Ao(h);if(!this.Te(v))break;this.h.Bb(h,b,1);this.h.Bb(k,b,1);n=h;m+=this.fy(g,h);u++}if(-1==p)for(h=c,k=this.h.sa(h),p=h;;){c=this.h.Wb(h);if(c==k)break;k=this.h.fe(k);if(this.h.sa(c)!=k)if(h=this.tG(h),-1==h){r=!0;break}else k=this.h.sa(h);
else h=c;v=this.Ao(h);if(!this.Te(v))break;this.h.Bb(h,b,1);this.h.Bb(k,b,1);p=h;m+=this.fy(g,h);u++}else if(-1!=this.Ym&&(n=this.Ym,p=this.h.fe(this.Ym),this.h.sa(p)!=this.h.Wb(this.h.sa(n))&&(p=this.sG(n),-1==p)))throw a.g.wa();0<=m||(h=p,p=this.h.sa(n),n=this.h.sa(h));b=g.Cf(e,-1);h=n;n=this.h.qj(n);r=this.h.jf(p)==n&&r;m=this.Au(n,g);m=this.tl(m,f);g.zi(b,m);-1!=d&&this.h.fm(n,d,1);n=0;for(u=r?a.I.truncate((u+1)/2):-1;;){c=this.h.jf(h);m=this.Au(c,g);m=this.tl(m,f);g.zi(b,m);n++;-1!=d&&this.h.fm(c,
d,1);r&&n==u&&(b=g.Cf(e,-1),g.zi(b,m));if(h==p)break;c=this.h.Wb(h);if(this.h.fe(this.h.sa(h))!=this.h.sa(c)){if(h=this.tG(h),-1==h)throw a.g.wa();}else h=c}};c.prototype.Yp=function(a){for(var c=this.h.a.jg(1607),b=this.h.Eg(),h=this.h.Be;-1!=h;h=this.h.Bf(h)){var d=this.h.te(h),f=d;do 1!=this.h.tb(f,b)&&this.Te(this.Ao(f))&&this.jF(f,c,b,-1,a),f=this.h.Wb(this.h.sa(f));while(f!=d)}this.h.kh(b);return c};c.prototype.SS=function(a){for(var c=this.h.a,b=c.jg(1607),h=c.jg(550),d=this.h.Eg(),f=this.h.uo(),
k=-1,m=this.h.Be;-1!=m;m=this.h.Bf(m)){var p=this.h.te(m),r=p;do{var u=this.h.tb(r,d);1!=u&&(u=this.Ao(r),this.Te(u)&&this.jF(r,b,d,f,a));r=this.h.Wb(this.h.sa(r))}while(r!=p)}for(m=this.h.Be;-1!=m;m=this.h.Bf(m))u=this.h.Sf(m,f),1!=u&&(u=this.h.md(m),this.Te(u)&&(-1==k&&(k=c.Cf(h,-1)),p=this.h.ol(m),-1!=p&&(p=this.h.Gi(p),p=this.tl(p,a),c.zi(k,p))));this.h.kh(d);this.h.vo(f);a=[];a[0]=h;a[1]=b;return a};c.prototype.Pn=function(){for(var a=this.h.a,c=a.jg(550),b=a.Cf(c,-1),d=this.h.Be;-1!=d;d=this.h.Bf(d))if(this.Te(this.h.md(d))){for(var f=
-1,k=this.h.ol(d);-1!=k;k=this.h.zq(k)){var m=this.h.Gi(k);-1==f&&(f=m);var p=this.h.ya(a.Vf(a.rd(m)));if(this.Te(p)){f=m;break}}a.zi(b,f)}return c};c.prototype.Im=function(a){this.Qg=[];for(var c=0;c<a;c++)this.Qg[c]=!1};c.qF=function(c,e,b,d){var g=c.Pa(),h=Array(1E3);a.I.Ps(h,null);var f=a.I.Lh(1E3,0),k=c.F(),m=!0,n=2==e.fb();if(1!=e.fb()&&2!=e.fb())throw a.g.wa();for(var p=0;p<k;){var r=a.I.truncate(c.fR(h,p)-p);n?a.gd.nG(e,h,r,b,f):a.gd.oG(e,h,r,b,f);for(var u=0,v=0;v<r;v++){var q=0==f[v];d||
(q=!q);q&&(m&&(m=!1,g.Pd(c,0,p)),u!=v&&g.Pd(c,p+u,p+v),u=v+1)}m||u==r||g.Pd(c,p+u,p+r);p+=r}return m?c:g};c.jD=function(b,e,g){return b instanceof a.pe?c.qF(b,e,g,!0):e instanceof a.Va?b.s()||e.s()?b.Pa():a.aj.HE(g,b,e)?a.aj.gL(b,e):b.Pa():c.mG(b,e,g,!0)};c.mt=function(b,e,g,d){var h=new a.i;b.o(h);var f=new a.i;e.o(f);var k=new a.i;k.K(h);k.Db(f);g=a.Ia.zd(g,k,!0);k=new a.i;k.K(f);f=a.Ia.As(g);k.P(f,f);if(!h.jc(k)){if(b.fb()<=e.fb())return c.Cc(c.ob(b.Pa()),b,"\x26");if(b.fb()>e.fb())return c.Cc(c.ob(e.Pa()),
b,"\x26")}f=new c;h=new a.fd;k=h.Eb(c.ob(b));e=h.Eb(c.ob(e));f.Np(h,g,d);d=f.mt(k,e);b=c.Cc(h.hf(d),b,"\x26");a.T.Kc(b.D())&&(b.hg(2,g),1736==b.D()&&b.hl());return b};c.mG=function(c,e,b,d){if(c.s())return c.Pa();if(e.s())return d?c.Pa():null;var g=[null],h=[0],f=2==e.fb();if(1!=e.fb()&&2!=e.fb())throw a.g.wa();g[0]=c.w();f?a.gd.nG(e,g,1,b,h):a.gd.oG(e,g,1,b,h);e=0==h[0];d||(e=!e);return e?c.Pa():c};c.PT=function(b,e,g){return b instanceof a.pe?c.qF(b,e,g,!1):e instanceof a.Va?b.s()?b.Pa():e.s()?
b:a.aj.HE(g,b,e)?b.Pa():b:c.mG(b,e,g,!1)};c.prototype.ME=function(c,e,b,d,f){if(c.s())return c;var g=new a.fd;c=g.Eb(c);return this.Qj(g,c,e,b,d,f)};c.prototype.EQ=function(c,e,b,d,f,k){if(f&&550!=c.Lb(e)){var g=new a.aA;g.KS(c,b);g.og?(a.aj.$(c,b,k,!0),f=!1):this.h.Mv(b)}else a.aj.$(c,b,k,!0),f=!1;d&&550!=c.Lb(e)?this.h.uF(c,e):this.h.tF(c,e);if(this.h.tx)return this.h.xg(),this.h=null,this.Qj(c,e,b,d,!1,k);this.h.Mv(NaN);k=this.h.ya(e);this.Im(k+1);this.Qg[k]=!0;if(1736==c.Lb(e)||d&&550!=c.Lb(e))return c.Pp(e,
0),e=this.Xp(e,-1,-1),c=c.hf(e),c.Pp(0),f?c.hg(1,0):(c.hg(2,b),c.hl()),c;if(1607==c.Lb(e))return e=this.Yp(-1),c=c.hf(e),f||c.hg(2,b),c;if(550==c.Lb(e))return e=this.Pn(),c=c.hf(e),f||c.hg(2,b),c;throw a.g.wa();};c.prototype.Qj=function(c,e,b,d,f,k){this.h=new a.gs;try{return this.EQ(c,e,b,d,f,k)}finally{this.h.xg()}};c.Qj=function(a,e,b,d,f){return(new c).ME(a,e,b,d,f)};c.prototype.DQ=function(c,e,b){this.Gq=c;this.h=new a.gs;c=e.Cm(b);var g=e.Lb(b);1!=c||550==g?this.h.tF(e,b):this.h.uF(e,b);if(!this.h.tx)if(this.h.Mv(NaN),
g=this.h.ya(b),this.Im(g+1),this.Qg[g]=!0,1736==e.Lb(b)||1==c&&550!=e.Lb(b))e.Pp(b,0),c=this.Xp(b,-1,-1),e.Vy(c,b),e.sy(c);else if(1607==e.Lb(b))c=this.Yp(-1),e.Vy(c,b),e.sy(c);else if(550==e.Lb(b))c=this.Pn(),e.Vy(c,b),e.sy(c);else throw a.g.ra("internal error");};c.Ry=function(a,e,b,d){var g=new c;g.Gq=!0;return g.ME(a,e,!1,b,d)};c.prototype.ll=function(c,e){var b=a.T.ve(this.h.a.Lb(c)),h=a.T.ve(this.h.a.Lb(e));if(b>h)return c;var d=this.h.ya(c),f=this.h.ya(e);this.Im((d|f)+1);this.Qg[this.h.ya(c)]=
!0;if(2==b&&2==h)return this.Xp(c,e,-1);if(1==b&&2==h||1==b&&1==h)return this.Yp(-1);if(0==b)return this.Pn();throw a.g.wa();};c.prototype.TB=function(c,e){var b=a.T.ve(this.h.a.Lb(c)),h=a.T.ve(this.h.a.Lb(e));if(b>h)return c;if(b<h)return e;var d=this.h.ya(c),f=this.h.ya(e);this.Im((d|f)+1);this.Qg[this.h.ya(c)]=!0;this.Qg[this.h.ya(e)]=!0;this.Qg[this.h.ya(c)|this.h.ya(e)]=!0;if(2==b&&2==h)return this.Xp(c,e,-1);if(1==b&&1==h)return this.Yp(-1);if(0==b&&0==h)return this.Pn();throw a.g.wa();};c.prototype.mt=
function(c,e){var b=a.T.ve(this.h.a.Lb(c)),h=a.T.ve(this.h.a.Lb(e)),d=this.h.ya(c),f=this.h.ya(e);this.Im((d|f)+1);this.Qg[this.h.ya(c)|this.h.ya(e)]=!0;d=-1;1<this.h.a.wp.Aa&&(d=c);if(2==b&&2==h)return this.Xp(c,e,d);if(1==b&&0<h||1==h&&0<b)return this.Yp(d);if(0==b||0==h)return this.Pn();throw a.g.wa();};c.prototype.Uw=function(c,e){var b=a.T.ve(this.h.a.Lb(c)),h=a.T.ve(this.h.a.Lb(e)),d=this.h.ya(c),f=this.h.ya(e);this.Im((d|f)+1);this.Qg[this.h.ya(c)|this.h.ya(e)]=!0;d=-1;1<this.h.a.wp.Aa&&(d=
c);if(2==b&&2==h)return this.RS(c,e,d);if(1==b&&0<h||1==h&&0<b)return this.SS(d);if(0==b||0==h)return b=[],b[0]=this.Pn(),b;throw a.g.wa();};c.prototype.On=function(c,e){var b=a.T.ve(this.h.a.Lb(c)),h=a.T.ve(this.h.a.Lb(e)),d=this.h.ya(c),f=this.h.ya(e);this.Im((d|f)+1);this.Qg[this.h.ya(c)]=!0;this.Qg[this.h.ya(e)]=!0;if(2==b&&2==h)return this.Xp(c,e,-1);if(1==b&&1==h)return this.Yp(-1);if(0==b&&0==h)return this.Pn();throw a.g.wa();};c.ob=function(c){var e=c.D();return 197==e?(e=new a.Ka(c.description),
c.s()||e.Wc(c,!1),e):33==e?(e=new a.pe(c.description),c.s()||e.add(c),e):322==e?(e=new a.Xa(c.description),c.s()||e.Bc(c,!0),e):c};c.Cc=function(c,e,b){var g=c.D();return 197==g?(e=new a.Ka(c.description),c.s()||e.Wc(c,!1),e):33!=g||"|"!=b&&"^"!=b?322==g?(e=new a.Xa(c.description),c.s()||e.Bc(c,!0),e):33==g&&"-"==b&&33==e.D()||550==g&&"\x26"==b&&33==e.D()?(e=new a.Va(c.description),c.s()||c.Sd(0,e),e):c:(e=new a.pe(c.description),c.s()||e.add(c),e)};c.ll=function(b,e,g,d){if(b.s()||e.s()||b.fb()>
e.fb())return c.Cc(c.ob(b),b,"-");var h=new a.i;b.o(h);var f=new a.i;e.o(f);if(!h.jc(f))return c.Cc(c.ob(b),b,"-");var k=new a.i;k.K(h);k.Db(f);g=a.Ia.zd(g,k,!0);f=new c;h=new a.fd;k=h.Eb(c.ob(b));e=h.Eb(c.ob(e));f.Np(h,g,d);d=f.ll(k,e);d=h.hf(d);b=c.Cc(d,b,"-");a.T.Kc(b.D())&&(b.hg(2,g),1736==b.D()&&b.hl());return b};c.TB=function(b,e,g,d){if(b.fb()>e.fb())return c.Cc(c.ob(b),b,"|");if(b.fb()<e.fb()||b.s())return c.Cc(c.ob(e),b,"|");if(e.s())return c.Cc(c.ob(b),b,"|");var h=new a.i;b.o(h);var f=
new a.i;e.o(f);var k=new a.i;k.K(h);k.Db(f);g=a.Ia.zd(g,k,!0);if(!h.jc(f.IN(g,g)))switch(b=c.ob(b),e=c.ob(e),b.D()){case 550:return b=a.T.Yj(b),b.Pd(e,0,-1),b;case 1607:return b=a.T.Yj(b),b.add(e,!1),b;case 1736:return b=a.T.Yj(b),b.add(e,!1),b;default:throw a.g.wa();}f=new c;h=new a.fd;k=h.Eb(c.ob(b));e=h.Eb(c.ob(e));f.Np(h,g,d);e=f.TB(k,e);b=c.Cc(h.hf(e),b,"|");a.T.Kc(b.D())&&(b.hg(2,g),1736==b.D()&&b.hl());return b};c.oM=function(b,e,g){if(2>b.length)throw a.g.N("not enough geometries to dissolve");
for(var h=0,d=0,f=b.length;d<f;d++)h=Math.max(b[d].fb(),h);var k=new a.i;k.Ja();for(var m=new a.fd,p=-1,r=0,u=-1,d=0,f=b.length;d<f;d++)if(b[d].fb()==h)if(b[d].s())-1==u&&(u=d);else{u=d;-1==p?p=m.Eb(c.ob(b[d])):m.YJ(p,c.ob(b[d]));var v=new a.i;b[d].dd(v);k.Db(v);r++}if(2>r)return c.ob(b[u]);b=2==h;e=a.Ia.zd(0==h?e:null,k,!0);return(new c).Qj(m,p,e,b,!0,g)};c.Uw=function(b,e,g,d){var h=[null,null,null],f=new a.i;b.o(f);var k=new a.i;e.o(k);var m=new a.i;m.K(f);m.Db(k);g=a.Ia.zd(g,m,!0);m=new a.i;m.K(k);
k=a.Ia.As(g);m.P(k,k);if(!f.jc(m)){if(b.fb()<=e.fb())return b=c.Cc(c.ob(b.Pa()),b,"\x26"),h[b.fb()]=b,h;if(b.fb()>e.fb())return b=c.Cc(c.ob(e.Pa()),b,"\x26"),h[b.fb()]=b,h}k=new c;f=new a.fd;m=f.Eb(c.ob(b));e=f.Eb(c.ob(e));k.Np(f,g,d);d=k.Uw(m,e);for(e=0;e<d.length;e++)k=c.Cc(f.hf(d[e]),b,"\x26"),a.T.Kc(k.D())&&(k.hg(2,g),1736==k.D()&&k.hl()),h[k.fb()]=k;return h};c.On=function(b,e,g,d){if(b.fb()>e.fb())return c.Cc(c.ob(b),b,"^");if(b.fb()<e.fb()||b.s())return c.Cc(c.ob(e),b,"^");if(e.s())return c.Cc(c.ob(b),
b,"^");var h=new a.i;b.o(h);var f=new a.i;e.o(f);var k=new a.i;k.K(h);k.Db(f);g=a.Ia.zd(g,k,!0);f=new c;h=new a.fd;k=h.Eb(c.ob(b));e=h.Eb(c.ob(e));f.Np(h,g,d);d=f.On(k,e);b=c.Cc(h.hf(d),b,"^");a.T.Kc(b.D())&&(b.hg(2,g),1736==b.D()&&b.hl());return b};c.uT=function(c,e,b){e=e.D();b=b.D();return 550==c.D()&&(33==e||33==b)&&1>=c.F()?(b=new a.Va(c.description),c.s()||c.Sd(0,b),b):c};c.prototype.ZM=function(a,c){var e=this.h.a;a=e.Cf(a,-1);for(var b=c.size,h=0;h<b;h++){var d=c.get(h);e.zi(a,d)}e.Gn(a,!0)};
c.prototype.WR=function(a,c){for(var e=this.h.a,b=e.$c;-1!=b;b=e.we(b))if(b==c)for(var h=e.Vb(b);-1!=h;h=e.bc(h)){var d=e.Cb(h);if(-1!=d)for(var f=e.X(d);-1!=f;){var d=this.h.se(d),k=this.h.se(f),d=this.h.FN(d,k);-1!=d&&(k=this.h.sa(d),this.h.Bb(d,a,1),this.h.Bb(k,a,2));d=f;f=e.X(d)}}};c.prototype.XQ=function(c,e,b,d){b=this.h.ya(b);d=this.h.ya(d);var g=new a.ga(0);g.xb(256);for(var h=this.h.a,f=this.h.Eg(),k=this.h.Be;-1!=k;k=this.h.Bf(k)){var m=this.h.te(k);if(-1!=m){var p=m;do{if(1!=this.h.tb(p,
f)){var n=p,r=p,u=!1,v=0;do{this.h.Bb(n,f,1);if(!u){var q=this.h.Gg(n);0!=(q&d)&&0!=(this.h.Qe(n)&b)&&(r=n,u=!0)}u&&(g.add(this.h.Gi(this.h.ol(this.h.qj(n)))),-1!=c&&(q=this.h.Gg(n),0!=(q&d)&&(q=this.h.tb(n,c),v|=q)));n=this.h.Wb(n)}while(n!=r);u&&0<this.h.yo(this.h.Pe(r))&&(n=h.jg(1736),this.ZM(n,g),-1!=e&&h.EF(n,e,v));g.clear(!1)}p=this.h.Wb(this.h.sa(p))}while(p!=m)}}this.h.kh(f)};c.prototype.WL=function(a,c,b,d){this.h.uR();var e=-1;-1!=a&&(e=this.h.Eg(),this.WR(e,b));this.XQ(e,a,c,b);var g=this.h.a;
a=0;for(e=g.$c;-1!=e;e=g.we(e))e!=c&&e!=b&&(d.add(e),a++);d.xd(0,a,function(a,c){a=g.Gw(g.Vb(a));c=g.Gw(g.Vb(c));return a<c?-1:a==c?0:1})};c.prototype.xg=function(){null!=this.h&&(this.h.xg(),this.h=null)};return c}();a.Of=c})(B||(B={}));(function(a){var c=function(){function c(a){void 0!==a?this.Ly(a):this.IF()}c.prototype.Lu=function(){this.Ob=this.Nb=this.sb=this.rb=this.eb=this.mb=0};c.prototype.lc=function(a){return this==a?!0:a instanceof c?this.mb==a.mb&&this.rb==a.rb&&this.Nb==a.Nb&&this.sb==
a.sb&&this.eb==a.eb&&this.Ob==a.Ob:!1};c.prototype.hc=function(){a.I.Rh();a.I.Rh();a.I.Rh();a.I.Rh();a.I.Rh();return a.I.Rh()};c.prototype.Zi=function(a,c){var e=this.sb*a.x+this.eb*a.y+this.Ob;c.x=this.mb*a.x+this.rb*a.y+this.Nb;c.y=e};c.prototype.multiply=function(a){c.multiply(this,a,this)};c.multiply=function(a,c,b){var e,g,h,d,f;e=a.mb*c.mb+a.sb*c.rb;g=a.rb*c.mb+a.eb*c.rb;h=a.Nb*c.mb+a.Ob*c.rb+c.Nb;d=a.mb*c.sb+a.sb*c.eb;f=a.rb*c.sb+a.eb*c.eb;a=a.Nb*c.sb+a.Ob*c.eb+c.Ob;b.mb=e;b.rb=g;b.Nb=h;b.sb=
d;b.eb=f;b.Ob=a};c.prototype.vm=function(){var a=new c;a.mb=this.mb;a.rb=this.rb;a.Nb=this.Nb;a.sb=this.sb;a.eb=this.eb;a.Ob=this.Ob;return a};c.prototype.$y=function(c){if(!c.s()){for(var e=[],b=0;4>b;b++)e[b]=new a.b;c.hy(e);this.US(e,e);c.Ey(e,4)}};c.prototype.US=function(c,e){for(var b=0;b<c.length;b++){var h=new a.b,d=c[b];h.x=this.mb*d.x+this.rb*d.y+this.Nb;h.y=this.sb*d.x+this.eb*d.y+this.Ob;e[b]=h}};c.prototype.wO=function(a,c){a.s()||c.s()||0==a.aa()||0==a.ba()?this.Lu():(this.rb=this.sb=
0,this.mb=c.aa()/a.aa(),this.eb=c.ba()/a.ba(),this.Nb=c.v-a.v*this.mb,this.Ob=c.C-a.C*this.eb)};c.prototype.TS=function(c){var e=new a.b,b=new a.b;e.ma(this.mb,this.sb);b.ma(this.rb,this.eb);e.sub(e);var h=.5*e.Up();e.ma(this.mb,this.sb);b.ma(this.rb,this.eb);e.add(b);e=.5*e.Up();return c*(h>e?Math.sqrt(h):Math.sqrt(e))};c.prototype.IF=function(){this.mb=1;this.sb=this.Nb=this.rb=0;this.eb=1;this.Ob=0};c.prototype.XO=function(){return 1==this.mb&&1==this.eb&&0==this.rb&&0==this.Nb&&0==this.sb&&0==
this.Ob};c.prototype.mg=function(a){return Math.abs(this.mb*this.eb-this.sb*this.rb)<=2*a*(Math.abs(this.mb*this.eb)+Math.abs(this.sb*this.rb))};c.prototype.Nn=function(a,c){this.mb=1;this.rb=0;this.Nb=a;this.sb=0;this.eb=1;this.Ob=c};c.prototype.Ly=function(a,c){void 0!==c?(this.mb=a,this.sb=this.Nb=this.rb=0,this.eb=c,this.Ob=0):this.Ly(a,a)};c.prototype.Oy=function(){this.mb=0;this.rb=1;this.Nb=0;this.sb=1;this.Ob=this.eb=0};c.prototype.jS=function(a){this.kS(Math.cos(a),Math.sin(a))};c.prototype.kS=
function(a,c){this.mb=a;this.rb=-c;this.Nb=0;this.sb=c;this.eb=a;this.Ob=0};c.prototype.shift=function(a,c){this.Nb+=a;this.Ob+=c};c.prototype.scale=function(a,c){this.mb*=a;this.rb*=a;this.Nb*=a;this.sb*=c;this.eb*=c;this.Ob*=c};c.prototype.rotate=function(a){var e=new c;e.jS(a);this.multiply(e)};c.prototype.inverse=function(a){if(void 0!==a){var c=this.mb*this.eb-this.rb*this.sb;0==c?a.Lu():(c=1/c,a.Nb=(this.rb*this.Ob-this.Nb*this.eb)*c,a.Ob=(this.Nb*this.sb-this.mb*this.Ob)*c,a.mb=this.eb*c,a.rb=
-this.rb*c,a.sb=-this.sb*c,a.eb=this.mb*c)}else this.inverse(this)};return c}();a.Bg=c})(B||(B={}));(function(a){var c=function(){function c(){}c.prototype.Lu=function(){this.fh=this.Ob=this.Nb=this.Le=this.Ie=this.He=this.Ke=this.eb=this.rb=this.ef=this.sb=this.mb=0};c.prototype.Ly=function(a,c,b){this.mb=a;this.rb=this.ef=this.sb=0;this.eb=c;this.Ie=this.He=this.Ke=0;this.Le=b;this.fh=this.Ob=this.Nb=0};c.prototype.$y=function(c){if(c.s())return c;for(var e=new a.ee[8],b=0;8>b;b++)e[b]=new a.ee;
c.hy(e);this.transform(e,8,e);c.Ey(e);return c};c.prototype.transform=function(c,e,b){for(var g=0;g<e;g++){var h=new a.ee,d=c[g];h.x=this.mb*d.x+this.rb*d.y+this.He*d.z+this.Nb;h.y=this.sb*d.x+this.eb*d.y+this.Ie*d.z+this.Ob;h.z=this.ef*d.x+this.Ke*d.y+this.Le*d.z+this.fh;b[g]=h}};c.prototype.Qn=function(c){var e=new a.ee;e.x=this.mb*c.x+this.rb*c.y+this.He*c.z+this.Nb;e.y=this.sb*c.x+this.eb*c.y+this.Ie*c.z+this.Ob;e.z=this.ef*c.x+this.Ke*c.y+this.Le*c.z+this.fh;return e};c.prototype.Ap=function(a){c.multiply(this,
a,this)};c.multiply=function(a,c,b){var e,g,h,d,f,k,m,p,r,u,v;e=a.mb*c.mb+a.sb*c.rb+a.ef*c.He;g=a.mb*c.sb+a.sb*c.eb+a.ef*c.Ie;h=a.mb*c.ef+a.sb*c.Ke+a.ef*c.Le;d=a.rb*c.mb+a.eb*c.rb+a.Ke*c.He;f=a.rb*c.sb+a.eb*c.eb+a.Ke*c.Ie;k=a.rb*c.ef+a.eb*c.Ke+a.Ke*c.Le;m=a.He*c.mb+a.Ie*c.rb+a.Le*c.He;p=a.He*c.sb+a.Ie*c.eb+a.Le*c.Ie;r=a.He*c.ef+a.Ie*c.Ke+a.Le*c.Le;u=a.Nb*c.mb+a.Ob*c.rb+a.fh*c.He+c.Nb;v=a.Nb*c.sb+a.Ob*c.eb+a.fh*c.Ie+c.Ob;a=a.Nb*c.ef+a.Ob*c.Ke+a.fh*c.Le+c.fh;b.mb=e;b.sb=g;b.ef=h;b.rb=d;b.eb=f;b.Ke=
k;b.He=m;b.Ie=p;b.Le=r;b.Nb=u;b.Ob=v;b.fh=a};c.inverse=function(c,e){var b=c.mb*(c.eb*c.Le-c.Ke*c.Ie)-c.sb*(c.rb*c.Le-c.Ke*c.He)+c.ef*(c.rb*c.Ie-c.eb*c.He);if(0!=b){var h,d,f,k,m,p,r,u,v,q;u=1/b;b=(c.eb*c.Le-c.Ke*c.Ie)*u;f=-(c.rb*c.Le-c.Ke*c.He)*u;p=(c.rb*c.Ie-c.eb*c.He)*u;h=-(c.sb*c.Le-c.Ie*c.ef)*u;k=(c.mb*c.Le-c.ef*c.He)*u;r=-(c.mb*c.Ie-c.sb*c.He)*u;d=(c.sb*c.Ke-c.ef*c.eb)*u;m=-(c.mb*c.Ke-c.ef*c.rb)*u;u*=c.mb*c.eb-c.sb*c.rb;v=-(c.Nb*b+c.Ob*f+c.fh*p);q=-(c.Nb*h+c.Ob*k+c.fh*r);c=-(c.Nb*d+c.Ob*m+c.fh*
u);e.mb=b;e.sb=h;e.ef=d;e.rb=f;e.eb=k;e.Ke=m;e.He=p;e.Ie=r;e.Le=u;e.Nb=v;e.Ob=q;e.fh=c}else throw a.g.ra("math singularity");};c.prototype.vm=function(){var a=new c;a.mb=this.mb;a.sb=this.sb;a.ef=this.ef;a.rb=this.rb;a.eb=this.eb;a.Ke=this.Ke;a.He=this.He;a.Ie=this.Ie;a.Le=this.Le;a.Nb=this.Nb;a.Ob=this.Ob;a.fh=this.fh;return a};return c}();a.ZT=c})(B||(B={}));(function(a){var c=function(c){function e(a){if(void 0!==a)c.call(this,a.hc(),a);else{c.call(this);this.Jf=[];this.Jf[0]=0;this.Aa=1;this.Wg=
[];for(a=0;10>a;a++)this.Wg[a]=-1;this.Wg[this.Jf[0]]=0}this.To=!0}D(e,c);e.prototype.Ne=function(a){this.hasAttribute(a)||(this.Wg[a]=0,this.xA())};e.prototype.removeAttribute=function(c){if(0==c)throw a.g.N("Position attribue cannot be removed");this.hasAttribute(c)&&(this.Wg[c]=-1,this.xA())};e.prototype.reset=function(){this.Jf[0]=0;this.Aa=1;for(var a=0;a<this.Wg.length;a++)this.Wg[a]=-1;this.Wg[this.Jf[0]]=0;this.To=!0};e.prototype.qw=function(){return b.ww().add(this)};e.Tf=function(){return b.ww().iO()};
e.Zn=function(){return b.ww().jO()};e.prototype.pJ=function(){var c=this.hc();return new a.pa(c,this)};e.prototype.xA=function(){for(var a=this.Aa=0,c=0;10>a;a++)0<=this.Wg[a]&&(this.Jf[c]=a,this.Wg[a]=c,c++,this.Aa++);this.To=!0};e.prototype.hc=function(){this.To&&(this.tk=this.jj(),this.To=!1);return this.tk};e.prototype.lc=function(a){if(null==a)return!1;if(a==this)return!0;if(!(a instanceof e)||a.Aa!=this.Aa)return!1;for(var c=0;c<this.Aa;c++)if(this.Jf[c]!=a.Jf[c])return!1;return this.To!=a.To?
!1:!0};e.prototype.qD=function(a){if(a.Aa!=this.Aa)return!1;for(var c=0;c<this.Aa;c++)if(this.Jf[c]!=a.Jf[c])return!1;return!0};e.iu=function(a,c){for(var e=[],b=0;b<a.Aa;b++)e[b]=-1;for(var b=0,g=a.Aa;b<g;b++)e[b]=c.zf(a.Hd(b));return e};e.PN=function(a,c){a=new e(a);a.Ne(c);return a.qw()};e.QN=function(a,c){for(var b=null,g=0;10>g;g++)!a.hasAttribute(g)&&c.hasAttribute(g)&&(null==b&&(b=new e(a)),b.Ne(g));return null!=b?b.qw():a};e.bo=function(a,c){a=new e(a);a.removeAttribute(c);return a.qw()};
return e}(a.pa);a.Od=c;var b=function(){function a(){this.map=[];var a=new c;this.add(a);a=new c;a.Ne(1);this.add(a)}a.ww=function(){return a.lI};a.prototype.iO=function(){return a.Yn};a.prototype.jO=function(){return a.Zn};a.prototype.add=function(c){var e=c.hc();if(null!=a.Yn&&a.Yn.hc()==e&&c.qD(a.Yn))return a.Yn;if(null!=a.Zn&&a.Zn.hc()==e&&c.qD(a.Zn))return a.Zn;var b=null;void 0!==this.map[e]&&(b=this.map[e]);null==b&&(b=c.pJ(),1==b.Aa?a.Yn=b:2==b.Aa&&1==b.Hd(1)?a.Zn=b:this.map[e]=b);return b};
a.lI=new a;return a}()})(B||(B={}));var P=0==f.version.indexOf("4."),O;(function(a){a[a.Linear=0]="Linear";a[a.Angular=1]="Angular";a[a.Area=2]="Area";a[a.LinearOrAngular=3]="LinearOrAngular"})(O||(O={}));var L={feet:9002,kilometers:9036,meters:9001,miles:9035,"nautical-miles":9030,yards:9096},M={acres:109402,ares:109463,hectares:109401,"square-feet":109405,"square-kilometers":109414,"square-meters":109404,"square-miles":109413,"square-yards":109442},R={degrees:9102,radians:9101};void 0===a.prototype.getCacheValue&&
k.extend(a,{cache:null,getCacheValue:function(a){if(null===this.cache||void 0===this.cache)this.cache={};return this.cache[a]},setCacheValue:function(a,c){if(null===this.cache||void 0===this.cache)this.cache={};this.cache[a]=c}});var Q=B.Nf.create(4326),T=B.Nf.create(102100);return function(){function b(){}b.extendedSpatialReferenceInfo=function(a){if(null===a)return null;a=C(a);var c=a.Se();return{tolerance:a.xq(),unitType:null==c?-1:c.Nc,unitID:null==c?-1:c.Qc(),unitBaseFactor:null==c?0:c.Dj,unitSquareDerivative:null==
c?0:B.Tb.PC(c).Qc()}};b.clip=function(a,b){if(null===a)return null;b=B.Pb.clip(E(a),E(b),c(a));return r(b,a.spatialReference)};b.cut=function(a,b){b=E(b);b=B.Pb.xm(E(a),b,c(a));for(var h=[],e=0;e<b.length;e++)h.push(r(b[e],a.spatialReference));return h};b.contains=function(a,b){if(null===a||null===b)throw Error("Illegal Argument Exception");return B.Pb.contains(E(a),E(b),c(a))};b.crosses=function(a,b){if(null===a||null===b)throw Error("Illegal Argument Exception");return B.Pb.VL(E(a),E(b),c(a))};
b.distance=function(a,b,h){if(null===a||null===b)throw Error("Illegal Argument Exception");return B.Pb.Fb(E(a),E(b),c(a),B.Tb.Qd(z(h,3)))};b.equals=function(a,b){return null===a&&null!==b||null===b&&null!==a?!1:B.Pb.lc(E(a),E(b),c(a))};b.intersects=function(a,b){if(null===a||null===b)throw Error("Illegal Argument Exception");return B.Pb.RO(E(a),E(b),c(a))};b.touches=function(a,b){if(null===a||null===b)throw Error("Illegal Argument Exception");return B.Pb.touches(E(a),E(b),c(a))};b.within=function(a,
b){if(null===a||null===b)throw Error("Illegal Argument Exception");return B.Pb.jT(E(a),E(b),c(a))};b.disjoint=function(a,b){if(null===a||null===b)throw Error("Illegal Argument Exception");return B.Pb.nM(E(a),E(b),c(a))};b.overlaps=function(a,b){if(null===a||null===b)throw Error("Illegal Argument Exception");return B.Pb.tQ(E(a),E(b),c(a))};b.relate=function(a,b,h){if(null===a||null===b)throw Error("Illegal Argument Exception");return B.Pb.py(E(a),E(b),c(a),h)};b.isSimple=function(a){if(null===a)throw Error("Illegal Argument Exception");
return B.Pb.cP(E(a),c(a))};b.simplify=function(a){if(null===a)throw Error("Illegal Argument Exception");var b=B.Pb.Qy(E(a),c(a));return r(b,a.spatialReference)};b.convexHull=function(d,f){void 0===f&&(f=!1);if(null===d)throw Error("Illegal Argument Exception");return d instanceof a?(f=B.Pb.JL(E(d),c(d)),r(f,d.spatialReference)):b.NI(d,f)};b.NI=function(a,c){for(var b=[],e=0;e<a.length;e++)b.push(E(a[e]));b=B.Pb.KL(b,c);for(e=0;e<b.length;e++)b[e]=r(b[e],a[0].spatialReference);return b};b.difference=
function(d,f){if(null===d||null===f)throw Error("Illegal Argument Exception");return d instanceof a?(f=B.Pb.ll(E(d),E(f),c(d)),r(f,d.spatialReference)):b.XL(d,f)};b.XL=function(a,b){for(var h=[],e=0;e<a.length;e++)h.push(E(a[e]));h=B.Pb.kM(h,E(b),c(b));for(e=0;e<h.length;e++)h[e]=r(h[e],b.spatialReference);return h};b.symmetricDifference=function(d,f){if(null===d||null===f)throw Error("Illegal Argument Exception");return d instanceof a?(f=B.Pb.On(E(d),E(f),c(d)),r(f,d.spatialReference)):b.tO(d,f)};
b.tO=function(a,b){for(var h=[],e=0;e<a.length;e++)h.push(E(a[e]));h=B.Pb.MS(h,E(b),c(b));for(e=0;e<h.length;e++)h[e]=r(h[e],b.spatialReference);return h};b.intersect=function(d,f){if(null===d||null===f)throw Error("Illegal Argument Exception");return d instanceof a?(f=B.Pb.Ga(E(d),E(f),c(d)),r(f,d.spatialReference)):b.EM(d,f)};b.EM=function(a,b){for(var h=[],e=0;e<a.length;e++)h.push(E(a[e]));h=B.Pb.QO(h,E(b),c(b));for(e=0;e<h.length;e++)h[e]=r(h[e],b.spatialReference);return h};b.union=function(b,
d){void 0===d&&(d=null);if(null===b)return null;b instanceof a&&(b=[b],null!==d&&b.push(d));if(0===b.length)return null;d=[];for(var h=0;h<b.length;h++)d.push(E(b[h]));return r(B.Pb.aT(d,c(b[0])),b[0].spatialReference)};b.offset=function(d,f,h,e,g,k){var m=0;if(null!=e&&void 0!=e)switch(e){case "round":m=0;break;case "bevel":m=1;break;case "miter":m=2;break;case "square":m=3}return d instanceof a?(f=B.Pb.offset(E(d),c(d),f,m,g,k,B.Tb.Qd(z(h,3))),r(f,d.spatialReference)):b.qO(d,f,h,m,g,k)};b.qO=function(a,
b,h,e,g,d){if(null===a)return null;if(0===a.length)return[];for(var f=[],k=0;k<a.length;k++)f.push(E(a[k]));b=B.Pb.sQ(f,c(a[0]),b,e,g,d,B.Tb.Qd(z(h,3)));for(k=0;k<b.length;k++)b[k]=r(b[k],a[0].spatialReference);return b};b.buffer=function(d,f,h,e){void 0===e&&(e=!1);if(d instanceof a)return f=B.Pb.buffer(E(d),c(d),f,B.Tb.Qd(z(h,3)),!1,0,NaN),r(f,d.spatialReference);if("[object Array]"!==Object.prototype.toString.call(f)){for(var g=[],k=0;k<d.length;k++)g.push(f);f=g}if(f.length!=d.length){if(0==f.length)throw Error("Illegal Argument Exception");
for(var g=[],m=0,k=0;k<d.length;k++)void 0===f[k]?g.push(m):(g.push(f[k]),m=f[k]);f=g}return b.vG(d,f,h,!1,e,"geodesic",NaN)};b.geodesicBuffer=function(d,f,h,e,g,k){if(d instanceof a)return void 0===g&&(g=NaN),f=B.Pb.buffer(E(d),c(d),f,B.Tb.Qd(z(h,0)),!0,v(e),g),r(f,d.spatialReference);if("[object Array]"!==Object.prototype.toString.call(f)){for(var m=[],p=0;p<d.length;p++)m.push(f);f=m}if(f.length!=d.length){if(0==f.length)throw Error("Illegal Argument Exception");for(var m=[],n=0,p=0;p<d.length;p++)void 0===
f[p]?m.push(n):(m.push(f[p]),n=f[p]);f=m}return b.vG(d,f,h,!0,e,g,k)};b.vG=function(a,b,h,e,g,d,f){if(null===a)return null;if(0===a.length)return[];void 0===f&&(f=NaN);for(var k=[],m=0;m<a.length;m++)k.push(E(a[m]));b=B.Pb.rK(k,c(a[0]),b,B.Tb.Qd(z(h,0)),e,g,v(d),f);for(m=0;m<b.length;m++)b[m]=r(b[m],a[0].spatialReference);return b};b.nearestCoordinate=function(a,c,b){void 0===b&&(b=!0);c=B.Pb.zw(E(a),E(c),b);return{coordinate:r(c.pw(),a.spatialReference),distance:c.sw(),isRightSide:c.Xw(),vertexIndex:c.gb(),
isEmpty:c.s()}};b.nearestVertex=function(a,c){c=B.Pb.Aw(E(a),E(c));return{coordinate:r(c.pw(),a.spatialReference),distance:c.sw(),isRightSide:c.Xw(),vertexIndex:c.gb(),isEmpty:c.s()}};b.nearestVertices=function(a,c,b,e){c=E(c);b=B.Pb.Bw(E(a),c,b,e);e=[];for(c=0;c<b.length;c++)!1===b[c].s()&&e.push({coordinate:r(b[c].pw(),a.spatialReference),distance:b[c].sw(),isRightSide:b[c].Xw(),vertexIndex:b[c].gb(),isEmpty:b[c].s()});return e};b.generalize=function(a,b,h,e){b=B.Pb.fN(E(a),c(a),b,h,B.Tb.Qd(z(e,
3)));return r(b,a.spatialReference)};b.densify=function(a,b,h){b=B.Pb.oq(E(a),c(a),b,B.Tb.Qd(z(h,3)));return r(b,a.spatialReference)};b.geodesicDensify=function(a,b,h,e){void 0===e&&(e=0);b=B.Pb.fw(E(a),c(a),b,B.Tb.Qd(z(h,3)),e);return r(b,a.spatialReference)};b.rotate=function(a,c,b){if(void 0===b||null===b)switch(a.type){case "point":b=a;break;case "extent":b=P?a.get("center"):a.getCenter();break;default:b=P?a.get("extent").get("center"):a.getExtent().getCenter()}c=P?B.Wn.rotate(a.toJSON(),c,b.toJSON()):
B.Wn.rotate(a.toJson(),c,b.toJson());P?(c=x(c),c.set("spatialReference",a.spatialReference)):(c=p(c),c.setSpatialReference(a.spatialReference));return c};b.flipHorizontal=function(a,c){if(void 0===c||null===c)switch(a.type){case "point":c=a;break;case "extent":c=P?a.get("center"):a.getCenter();break;default:c=P?a.get("extent").get("center"):a.getExtent().getCenter()}c=P?B.Wn.eC(a.toJSON(),c.toJSON()):B.Wn.eC(a.toJson(),c.toJson());P?(c=x(c),c.set("spatialReference",a.spatialReference)):(c=p(c),c.setSpatialReference(a.spatialReference));
return c};b.flipVertical=function(a,c){if(void 0===c||null===c)switch(a.type){case "point":c=a;break;case "extent":c=P?a.get("center"):a.getCenter();break;default:c=P?a.get("extent").get("center"):a.getExtent().getCenter()}c=P?B.Wn.fC(a.toJSON(),c.toJSON()):B.Wn.fC(a.toJson(),c.toJson());P?(c=x(c),c.set("spatialReference",a.spatialReference)):(c=p(c),c.setSpatialReference(a.spatialReference));return c};b.planarArea=function(a,b){if(null===a)throw Error("Illegal Argument Exception");return B.Pb.BQ(E(a),
c(a),B.Tb.Qd(z(b,2)))};b.planarLength=function(a,b){if(null===a)throw Error("Illegal Argument Exception");return B.Pb.CQ(E(a),c(a),B.Tb.Qd(z(b,3)))};b.geodesicArea=function(a,b,h){if(null===a)throw Error("Illegal Argument Exception");return B.Pb.jN(E(a),c(a),B.Tb.Qd(z(b,2)),v(h))};b.geodesicLength=function(a,b,h){if(null===a)throw Error("Illegal Argument Exception");return B.Pb.nN(E(a),c(a),B.Tb.Qd(z(b,0)),v(h))};return b}()})},"esri/widgets/support/AnchorElementViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/watchUtils ../../core/Accessor ../../core/Evented ../../core/HandleRegistry ../../core/watchUtils".split(" "),
function(w,l,f,a,d,b,q,t,m,k){return function(p){function q(){var a=p.call(this)||this;a._anchorHandles=new m;a.location=null;a.screenLocation=null;a.screenLocationEnabled=!1;a.view=null;a._anchorHandles.add([k.watch(a,"screenLocationEnabled,location,view.size",function(){return a._updateScreenPointAndHandle()}),k.watch(a,"view, view.ready",function(){return a._wireUpView()})]);return a}f(q,p);q.prototype.destroy=function(){this.view=null;this._anchorHandles&&this._anchorHandles.destroy();this._viewpointHandle=
this._anchorHandles=null};q.prototype._wireUpView=function(){var a=this;this._anchorHandles.remove("view");this._viewpointHandle=null;if(this.get("view.ready")){this._setScreenLocation();var d=this.view,d=b.pausable(d,"3d"===d.type?"camera":"viewpoint",function(){return a._viewpointChange()});this._anchorHandles.add(d,"view");this._viewpointHandle=d;this._toggleWatchingViewpoint()}};q.prototype._viewpointChange=function(){this._setScreenLocation();this.emit("view-change")};q.prototype._updateScreenPointAndHandle=
function(){this._setScreenLocation();this._toggleWatchingViewpoint()};q.prototype._toggleWatchingViewpoint=function(){var a=this._viewpointHandle,b=this.screenLocationEnabled;a&&(this.location&&b?a.resume():a.pause())};q.prototype._setScreenLocation=function(){var a=this.location,b=this.view,d=this.screenLocationEnabled,f=this.get("view.ready"),a=d&&a&&f?b.toScreen(a.x,a.y,a.z):null;this._set("screenLocation",a)};a([d.property()],q.prototype,"location",void 0);a([d.property({readOnly:!0})],q.prototype,
"screenLocation",void 0);a([d.property()],q.prototype,"screenLocationEnabled",void 0);a([d.property()],q.prototype,"view",void 0);return q=a([d.subclass("esri.widgets.support.AnchorElementViewModel")],q)}(d.declared(q,t))})},"dojo/fx/easing":function(){define(["../_base/lang"],function(w){var l={linear:function(f){return f},quadIn:function(f){return Math.pow(f,2)},quadOut:function(f){return f*(f-2)*-1},quadInOut:function(f){f*=2;return 1>f?Math.pow(f,2)/2:-1*(--f*(f-2)-1)/2},cubicIn:function(f){return Math.pow(f,
3)},cubicOut:function(f){return Math.pow(f-1,3)+1},cubicInOut:function(f){f*=2;return 1>f?Math.pow(f,3)/2:(Math.pow(f-2,3)+2)/2},quartIn:function(f){return Math.pow(f,4)},quartOut:function(f){return-1*(Math.pow(f-1,4)-1)},quartInOut:function(f){f*=2;return 1>f?Math.pow(f,4)/2:-.5*(Math.pow(f-2,4)-2)},quintIn:function(f){return Math.pow(f,5)},quintOut:function(f){return Math.pow(f-1,5)+1},quintInOut:function(f){f*=2;return 1>f?Math.pow(f,5)/2:(Math.pow(f-2,5)+2)/2},sineIn:function(f){return-1*Math.cos(Math.PI/
2*f)+1},sineOut:function(f){return Math.sin(Math.PI/2*f)},sineInOut:function(f){return-1*(Math.cos(Math.PI*f)-1)/2},expoIn:function(f){return 0==f?0:Math.pow(2,10*(f-1))},expoOut:function(f){return 1==f?1:-1*Math.pow(2,-10*f)+1},expoInOut:function(f){if(0==f)return 0;if(1==f)return 1;f*=2;if(1>f)return Math.pow(2,10*(f-1))/2;--f;return(-1*Math.pow(2,-10*f)+2)/2},circIn:function(f){return-1*(Math.sqrt(1-Math.pow(f,2))-1)},circOut:function(f){return Math.sqrt(1-Math.pow(f-1,2))},circInOut:function(f){f*=
2;return 1>f?-.5*(Math.sqrt(1-Math.pow(f,2))-1):.5*(Math.sqrt(1-Math.pow(f-2,2))+1)},backIn:function(f){return Math.pow(f,2)*(2.70158*f-1.70158)},backOut:function(f){--f;return Math.pow(f,2)*(2.70158*f+1.70158)+1},backInOut:function(f){f*=2;if(1>f)return Math.pow(f,2)*(3.5949095*f-2.5949095)/2;f-=2;return(Math.pow(f,2)*(3.5949095*f+2.5949095)+2)/2},elasticIn:function(f){if(0==f||1==f)return f;--f;return-1*Math.pow(2,10*f)*Math.sin(2*(f-.075)*Math.PI/.3)},elasticOut:function(f){return 0==f||1==f?f:
Math.pow(2,-10*f)*Math.sin(2*(f-.075)*Math.PI/.3)+1},elasticInOut:function(f){if(0==f)return 0;f*=2;if(2==f)return 1;var a=.3*1.5,d=a/4;if(1>f)return--f,-.5*Math.pow(2,10*f)*Math.sin(2*(f-d)*Math.PI/a);--f;return.5*Math.pow(2,-10*f)*Math.sin(2*(f-d)*Math.PI/a)+1},bounceIn:function(f){return 1-l.bounceOut(1-f)},bounceOut:function(f){return f<1/2.75?7.5625*Math.pow(f,2):f<2/2.75?7.5625*Math.pow(f-1.5/2.75,2)+.75:f<2.5/2.75?7.5625*Math.pow(f-2.25/2.75,2)+.9375:7.5625*Math.pow(f-2.625/2.75,2)+.984375},
bounceInOut:function(f){return.5>f?l.bounceIn(2*f)/2:l.bounceOut(2*f-1)/2+.5}};w.setObject("dojo.fx.easing",l);return l})},"esri/widgets/Spinner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ./support/widget ../core/accessorSupport/decorators ./Widget ../core/promiseUtils ../core/watchUtils ./support/AnchorElementViewModel".split(" "),function(w,l,f,a,d,b,q,t,m,k){return function(p){function q(a){a=p.call(this)||this;a._animationDelay=
500;a._animationPromise=null;a.location=null;a.view=null;a.visible=!1;a.viewModel=new k;return a}f(q,p);q.prototype.postInitialize=function(){var a=this;this.own([m.watch(this,"visible",function(b){return a._visibleChange(b)})])};q.prototype.destroy=function(){this._cancelAnimationPromise()};q.prototype.show=function(a){var b=this,d=a.location;a=a.promise;d&&(this.viewModel.location=d);this.visible=!0;a&&a.always(function(){return b.hide()})};q.prototype.hide=function(){this.visible=!1};q.prototype.render=
function(){var a=this.visible,b=!!this.viewModel.screenLocation,a=(f={},f["esri-spinner--start"]=a&&b,f["esri-spinner--finish"]=!a&&b,f),f=this._getPositionStyles();return d.tsx("div",{class:"esri-spinner",classes:a,styles:f});var f};q.prototype._cancelAnimationPromise=function(){this._animationPromise&&(this._animationPromise.cancel(),this._animationPromise=null)};q.prototype._visibleChange=function(a){var b=this;a?this.viewModel.screenLocationEnabled=!0:(this._cancelAnimationPromise(),this._animationPromise=
t.after(this._animationDelay).then(function(){b.viewModel.screenLocationEnabled=!1;b._animationPromise=null}))};q.prototype._getPositionStyles=function(){var a=this.viewModel.screenLocation;return a?{left:a.x+"px",top:a.y+"px"}:{}};a([b.aliasOf("viewModel.location")],q.prototype,"location",void 0);a([b.aliasOf("viewModel.view")],q.prototype,"view",void 0);a([b.property(),d.renderable()],q.prototype,"visible",void 0);a([b.property({type:k}),d.renderable(["viewModel.screenLocation","viewModel.screenLocationEnabled"])],
q.prototype,"viewModel",void 0);return q=a([b.subclass("esri.widgets.Spinner")],q)}(b.declared(q))})},"esri/views/ui/DefaultUI":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/watchUtils ./UI ./Component ../../widgets/Attribution ../../widgets/Compass ../../widgets/Zoom ../../widgets/NavigationToggle dojo/dom-geometry".split(" "),function(w,l,f,a,d,b,q,t,m,k,p,x,z){return function(v){function r(a){a=
v.call(this)||this;a._defaultPositionLookup=null;a.components=[];return a}f(r,v);r.prototype.initialize=function(){this._handles.add([b.init(this,"components",this._componentsWatcher.bind(this)),b.init(this,"view",this._updateViewAwareWidgets.bind(this))])};r.prototype._findComponentPosition=function(a){if(!this._defaultPositionLookup){var b=z.isBodyLtr();this._defaultPositionLookup={attribution:"manual",compass:b?"top-left":"top-right","navigation-toggle":b?"top-left":"top-right",zoom:b?"top-left":
"top-right"}}return this._defaultPositionLookup[a]};r.prototype._removeComponents=function(a){var b=this;a.forEach(function(a){if(a=b.find(a))b.remove(a),a.destroy()})};r.prototype._updateViewAwareWidgets=function(a){var b=this;this.components.forEach(function(d){(d=(d=b.find(d))&&d.widget)&&void 0!==d.view&&d.set("view",a)})};r.prototype._componentsWatcher=function(a,b){this._removeComponents(b);this._addComponents(a)};r.prototype._addComponents=function(a){var b=this;this.initialized&&a.forEach(function(a){return b.add(b._createComponent(a),
b._findComponentPosition(a))})};r.prototype._createComponent=function(a){var b=this._createWidget(a);if(b)return new t({id:a,node:b})};r.prototype._createWidget=function(a){if("attribution"===a)return this._createAttribution();if("compass"===a)return this._createCompass();if("navigation-toggle"===a)return this._createNavigationToggle();if("zoom"===a)return this._createZoom()};r.prototype._createAttribution=function(){return new m({view:this.view})};r.prototype._createCompass=function(){return new k({view:this.view})};
r.prototype._createNavigationToggle=function(){return new x({view:this.view})};r.prototype._createZoom=function(){return new p({view:this.view})};a([d.property()],r.prototype,"components",void 0);return r=a([d.subclass("esri.views.ui.DefaultUI")],r)}(d.declared(q))})},"esri/views/ui/UI":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ./Component ../../core/Accessor ../../core/HandleRegistry ../../core/watchUtils dojo/_base/lang dojo/dom-class dojo/dom-construct dojo/dom-style".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z){function v(a){return"object"!==typeof a||a&&a.isInstanceOf&&a.isInstanceOf(b)||!("component"in a||"index"in a||"position"in a)?null:a}var r={left:0,top:0,bottom:0,right:0},u={bottom:30,top:15,right:15,left:15};return function(q){function l(){var a=q.call(this)||this;a._cornerNameToContainerLookup={};a._positionNameToContainerLookup={};a._components=[];a._handles=new t;a.padding=u;a.view=null;a._initContainers();return a}f(l,q);l.prototype.initialize=function(){this._handles.add([m.init(this,
"view.padding, container",this._applyViewPadding.bind(this)),m.init(this,"padding",this._applyUIPadding.bind(this))])};l.prototype.destroy=function(){this.container=null;this._components.forEach(function(a){a.destroy()});this._components.length=0;this._handles.destroy()};Object.defineProperty(l.prototype,"container",{set:function(a){var c=this._get("container");a!==c&&(a&&(p.add(a,"esri-ui"),this._attachContainers(a)),c&&(p.remove(c,"esri-ui"),z.set(c,{top:"",bottom:"",left:"",right:""}),x.empty(c)),
this._set("container",a))},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"height",{get:function(){var a=this.get("view.height")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.top+b.bottom),0)},enumerable:!0,configurable:!0});l.prototype.castPadding=function(a){return"number"===typeof a?{bottom:a,top:a,right:a,left:a}:k.mixin({},u,a)};Object.defineProperty(l.prototype,"width",{get:function(){var a=this.get("view.width")||0;if(0===a)return a;var b=this._getViewPadding();
return Math.max(a-(b.left+b.right),0)},enumerable:!0,configurable:!0});l.prototype.add=function(a,d){var c=this,f;if(Array.isArray(a))a.forEach(function(a){return c.add(a,d)});else{var k=v(a);k&&(f=k.index,d=k.position,a=k.component);d&&"object"===typeof d&&(f=d.index,d=d.position);!a||d&&!this._isValidPosition(d)||(a&&a.isInstanceOf&&a.isInstanceOf(b)||(a=new b({node:a})),this._place({component:a,position:d,index:f}),this._components.push(a))}};l.prototype.remove=function(a){if(a){if(Array.isArray(a))return a.map(this.remove,
this);if(a=this.find(a)){var c=this._components.indexOf(a);a.node.parentNode&&a.node.parentNode.removeChild(a.node);return this._components.splice(c,1)[0]}}};l.prototype.empty=function(a){var c=this;if(Array.isArray(a))return a.map(function(a){return c.empty(a)}).reduce(function(a,c){return a.concat(c)});a=a||"manual";if("manual"===a)return Array.prototype.slice.call(this._manualContainer.children).filter(function(a){return!p.contains(a,"esri-ui-corner")}).map(function(a){return c.remove(a)});if(this._isValidPosition(a))return Array.prototype.slice.call(this._cornerNameToContainerLookup[a].children).map(this.remove,
this)};l.prototype.move=function(a,b){var c=this;Array.isArray(a)&&a.forEach(function(a){return c.move(a,b)});if(a){var d,f=v(a)||v(b);f&&(d=f.index,b=f.position,a=f.component||a);(!b||this._isValidPosition(b))&&(a=this.remove(a))&&this.add(a,{position:b,index:d})}};l.prototype.find=function(a){return a?a&&a.isInstanceOf&&a.isInstanceOf(b)?this._findByComponent(a):"string"===typeof a?this._findById(a):this._findByNode(a.domNode||a):null};l.prototype._getViewPadding=function(){return this.get("view.padding")||
r};l.prototype._attachContainers=function(a){x.place(this._manualContainer,a);x.place(this._innerContainer,a)};l.prototype._initContainers=function(){var a=x.create("div",{className:"esri-ui-inner-container esri-ui-corner-container"}),b=x.create("div",{className:"esri-ui-inner-container esri-ui-manual-container"}),d=x.create("div",{className:"esri-ui-top-left esri-ui-corner"},a),f=x.create("div",{className:"esri-ui-top-right esri-ui-corner"},a),m=x.create("div",{className:"esri-ui-bottom-left esri-ui-corner"},
a),p=x.create("div",{className:"esri-ui-bottom-right esri-ui-corner"},a);this._innerContainer=a;this._manualContainer=b;this._cornerNameToContainerLookup={"top-left":d,"top-right":f,"bottom-left":m,"bottom-right":p};this._positionNameToContainerLookup=k.mixin({manual:b},this._cornerNameToContainerLookup)};l.prototype._isValidPosition=function(a){return!!this._positionNameToContainerLookup[a]};l.prototype._place=function(a){var c=a.component,b=a.index;a=this._positionNameToContainerLookup[a.position||
"manual"];var d;-1<b?(d=Array.prototype.slice.call(a.children),0===b?this._placeComponent(c,a,"first"):b>=d.length?this._placeComponent(c,a,"last"):this._placeComponent(c,d[b],"before")):this._placeComponent(c,a,"last")};l.prototype._placeComponent=function(a,b,d){var c=a.widget;c&&!c._started&&"function"===typeof c.postMixInProperties&&"function"===typeof c.buildRendering&&"function"===typeof c.postCreate&&"function"===typeof c.startup&&a.widget.startup();x.place(a.node,b,d)};l.prototype._applyViewPadding=
function(){var a=this.container;a&&z.set(a,this._toPxPosition(this._getViewPadding()))};l.prototype._applyUIPadding=function(){this._innerContainer&&z.set(this._innerContainer,this._toPxPosition(this.padding))};l.prototype._toPxPosition=function(a){return{top:this._toPxUnit(a.top),left:this._toPxUnit(a.left),right:this._toPxUnit(a.right),bottom:this._toPxUnit(a.bottom)}};l.prototype._toPxUnit=function(a){return 0===a?0:a+"px"};l.prototype._findByComponent=function(a){var c=null,b;this._components.some(function(d){(b=
d===a)&&(c=d);return b});return c};l.prototype._findById=function(a){var c=null,b;this._components.some(function(d){(b=d.id===a)&&(c=d);return b});return c};l.prototype._findByNode=function(a){var c=null,b;this._components.some(function(d){(b=d.node===a)&&(c=d);return b});return c};a([d.property()],l.prototype,"container",null);a([d.property({dependsOn:["view.height"]})],l.prototype,"height",null);a([d.property()],l.prototype,"padding",void 0);a([d.cast("padding")],l.prototype,"castPadding",null);
a([d.property()],l.prototype,"view",void 0);a([d.property({dependsOn:["view.width"]})],l.prototype,"width",null);return l=a([d.subclass("esri.views.ui.UI")],l)}(d.declared(q))})},"esri/views/ui/Component":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor dojo/dom dojo/dom-class".split(" "),function(w,l,f,a,d,b,q,t){return function(b){function k(){var a=null!==b&&b.apply(this,arguments)||
this;a.widget=null;return a}f(k,b);k.prototype.destroy=function(){this.widget&&this.widget.destroy();this.node=null};Object.defineProperty(k.prototype,"id",{get:function(){return this._get("id")||this.get("node.id")},set:function(a){this._set("id",a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"node",{set:function(a){var b=this._get("node");a!==b&&(a&&t.add(a,"esri-component"),b&&t.remove(b,"esri-component"),this._set("node",a))},enumerable:!0,configurable:!0});k.prototype.castNode=
function(a){if(!a)return this._set("widget",null),null;if("string"===typeof a||a&&"nodeType"in a)return this._set("widget",null),q.byId(a);a&&"function"===typeof a.render&&!a.domNode&&(a.domNode=document.createElement("div"));this._set("widget",a);return a.domNode};a([d.property()],k.prototype,"id",null);a([d.property()],k.prototype,"node",null);a([d.cast("node")],k.prototype,"castNode",null);a([d.property({readOnly:!0})],k.prototype,"widget",void 0);return k=a([d.subclass("esri.views.ui.Component")],
k)}(d.declared(b))})},"esri/widgets/Attribution":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./support/widget ./Widget ./Attribution/AttributionViewModel".split(" "),function(w,l,f,a,d,b,q,t){return function(m){function k(a){a=m.call(this)||this;a._isOpen=!1;a._attributionTextOverflowed=!1;a._prevSourceNodeHeight=0;a.view=null;a.viewModel=new t;return a}f(k,m);k.prototype.render=function(){var a=(d={},
d["esri-attribution--open"]=this._isOpen,d);return b.tsx("div",{bind:this,class:"esri-attribution esri-widget",classes:a,onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),b.tsx("div",{class:"esri-attribution__powered-by"},"Powered by ",b.tsx("a",{target:"_blank",href:"http://www.esri.com/",class:"esri-attribution__link"},"Esri")));var d};k.prototype._renderSourcesNode=function(){var a=this._isOpen,d=this._isInteractive(),f=d?0:-1,k=this.get("viewModel.attributionText"),
a=(m={},m["esri-attribution__sources--open"]=a,m["esri-interactive"]=d,m);return b.tsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:"esri-attribution__sources",classes:a,innerHTML:k,role:d?"button":void 0,tabIndex:f});var m};k.prototype._afterSourcesNodeCreate=function(a){this._prevSourceNodeHeight=a.clientWidth};k.prototype._afterSourcesNodeUpdate=function(a){var b=!1,d=a.clientHeight;a=a.scrollWidth>=a.clientWidth;var f=this._attributionTextOverflowed!==
a;this._attributionTextOverflowed=a;f&&(b=!0);this._isOpen&&(a=d<this._prevSourceNodeHeight,this._prevSourceNodeHeight=d,a&&(this._isOpen=!1,b=!0));b&&this.scheduleRender()};k.prototype._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)};k.prototype._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed};a([d.aliasOf("viewModel.view")],k.prototype,"view",void 0);a([d.property({type:t}),b.renderable(["attributionText","state","view.size"])],k.prototype,
"viewModel",void 0);a([b.accessibleHandler()],k.prototype,"_toggleState",null);return k=a([d.subclass("esri.widgets.Attribution")],k)}(d.declared(q))})},"esri/widgets/Attribution/AttributionViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../geometry/support/webMercatorUtils ../../core/HandleRegistry ../../core/Accessor ../../core/lang ../../core/watchUtils ../../geometry/Extent".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p){return function(x){function t(a){a=x.call(this,a)||this;a._handles=new q;a._pendingAttributionItemsByLayerId={};a._attributionDataByLayerId={};a.itemDelimiter=" | ";a.items=[];a.view=null;a._updateAttributionItems=a._updateAttributionItems.bind(a);return a}f(t,x);t.prototype.initialize=function(){this._handles.add(k.init(this,"view",this._viewWatcher))};t.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(t.prototype,
"attributionText",{get:function(){return this.items.join(this.itemDelimiter)},enumerable:!0,configurable:!0});Object.defineProperty(t.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});t.prototype._viewWatcher=function(a){var b=this,d=this._handles;d&&d.remove();a&&(d.add([a.allLayerViews.on("change",function(a){b._addLayerViews(a.added);0<a.removed.length&&(a.removed.forEach(function(a){d.remove(a.uid)}),b._updateAttributionItems())}),
k.init(a,"stationary",this._updateAttributionItems)]),this._addLayerViews(a.allLayerViews))};t.prototype._addLayerViews=function(a){var b=this;a.forEach(function(a){b._handles.has(a.uid)||b._handles.add(k.init(a,"suspended",b._updateAttributionItems),a.uid)})};t.prototype._updateAttributionItems=function(){var a=this,b=[];this._getActiveLayerViews().forEach(function(d){var f=d.layer;if(!f.hasAttributionData)d=f.get("copyright"),a._isUnique(b,d)&&b.push(d);else if(f&&f.tileInfo){var k=a._attributionDataByLayerId;
if(k[f.uid])d=a._getDynamicAttribution(k[f.uid],a.view,f),a._isUnique(b,d)&&b.push(d);else{var c=a._pendingAttributionItemsByLayerId;a._inProgress(c[f.uid])||(c[f.uid]=f.fetchAttributionData().then(function(b){b=a._createContributionIndex(b,a._isBingLayer(f));delete c[f.uid];k[f.uid]=b;a._updateAttributionItems()}))}}});this._itemsChanged(this.items,b)&&this._set("items",b)};t.prototype._itemsChanged=function(a,b){return a.length!==b.length||a.some(function(a,d){return a!==b[d]})};t.prototype._inProgress=
function(a){return a&&!a.isFulfilled()};t.prototype._getActiveLayerViews=function(){return this.get("view.allLayerViews").filter(function(a){return!a.suspended&&a.get("layer.attributionVisible")})};t.prototype._isUnique=function(a,b){return b&&-1===a.indexOf(b)};t.prototype._isBingLayer=function(a){return-1!==a.declaredClass.toLowerCase().indexOf("vetiledlayer")};t.prototype._createContributionIndex=function(a,d){a=a.contributors;var f={};if(!a)return f;a.forEach(function(a,k){var c=a.coverageAreas;
c&&c.forEach(function(c){var r=c.bbox,u=c.zoomMin-(d&&c.zoomMin?1:0),v=c.zoomMax-(d&&c.zoomMax?1:0);a={extent:b.geographicToWebMercator(new p({xmin:r[1],ymin:r[0],xmax:r[3],ymax:r[2]})),attribution:a.attribution||"",score:m.isDefined(c.score)?c.score:100,id:k};for(c=u;c<=v;c++)f[c]=f[c]||[],f[c].push(a)})});f.maxKey=Math.max.apply(null,Object.keys(f));return f};t.prototype._getDynamicAttribution=function(a,b,d){var f=b.extent;b=d.tileInfo.scaleToZoom(b.scale);b=Math.min(a.maxKey,Math.round(b));if(!f||
!m.isDefined(b)||-1>=b)return"";a=a[b];var k=f.center.clone().normalize(),c={};return a.filter(function(a){var b=!c[a.id]&&a.extent.contains(k);b&&(c[a.id]=!0);return b}).sort(function(a,c){return c.score-a.score||a.objectId-c.objectId}).map(function(a){return a.attribution}).join(", ")};a([d.property({dependsOn:["items","itemDelimiter"],readOnly:!0})],t.prototype,"attributionText",null);a([d.property()],t.prototype,"itemDelimiter",void 0);a([d.property({readOnly:!0})],t.prototype,"items",void 0);
a([d.property({dependsOn:["view.ready"],readOnly:!0})],t.prototype,"state",null);a([d.property()],t.prototype,"view",void 0);return t=a([d.subclass("esri.widgets.Attribution.AttributionViewModel")],t)}(d.declared(t))})},"esri/widgets/Compass":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./support/widget ./Widget ./Compass/CompassViewModel dojo/i18n!./Compass/nls/Compass".split(" "),function(w,l,f,a,d,
b,q,t,m){return function(k){function p(a){a=k.call(this)||this;a.view=null;a.viewModel=new t;return a}f(p,k);p.prototype.reset=function(){};p.prototype.render=function(){var a=this.viewModel.orientation,d=this.viewModel.state,f="disabled"===d,k="compass"===("rotation"===d?"rotation":"compass"),d=(p={},p["esri-disabled"]=f,p["esri-interactive"]=!f,p),p=(q={},q["esri-icon-compass"]=k,q["esri-icon-dial"]=!k,q);return b.tsx("div",{bind:this,class:"esri-compass esri-widget-button esri-widget",classes:d,
onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:f?-1:0,"aria-label":m.reset,title:m.reset},b.tsx("span",{"aria-hidden":"true",class:"esri-compass__icon",classes:p,styles:this._toRotationTransform(a)}),b.tsx("span",{class:"esri-icon-font-fallback-text"},m.reset));var p,q};p.prototype._reset=function(){this.reset()};p.prototype._toRotationTransform=function(a){return{transform:"rotateZ("+a.z+"deg)"}};a([d.aliasOf("viewModel.view")],p.prototype,"view",void 0);a([d.property({type:t}),
b.renderable(["viewModel.orientation","viewModel.state"])],p.prototype,"viewModel",void 0);a([d.aliasOf("viewModel.reset")],p.prototype,"reset",null);a([b.accessibleHandler()],p.prototype,"_reset",null);return p=a([d.subclass("esri.widgets.Compass")],p)}(d.declared(q))})},"esri/widgets/Compass/CompassViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/HandleRegistry ../../core/Accessor ../../core/watchUtils".split(" "),
function(w,l,f,a,d,b,q,t){return function(m){function k(a){a=m.call(this,a)||this;a._handles=new b;a.orientation={x:0,y:0,z:0};a.view=null;a._updateForCamera=a._updateForCamera.bind(a);a._updateForRotation=a._updateForRotation.bind(a);a._updateRotationWatcher=a._updateRotationWatcher.bind(a);return a}f(k,m);k.prototype.initialize=function(){this._handles.add(t.init(this,"view",this._updateRotationWatcher))};k.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(k.prototype,
"canShowNorth",{get:function(){var a=this.get("view.spatialReference");return a&&(a.isWebMercator||a.isWGS84)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"state",{get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"},enumerable:!0,configurable:!0});k.prototype.reset=function(){if(this.get("view.ready")){var a={};"2d"===this.view.type?a.rotation=0:a.heading=0;this.view.goTo(a)}};k.prototype._updateForRotation=function(a){void 0!==a&&
null!==a&&(this.orientation={z:a})};k.prototype._updateForCamera=function(a){a&&(this.orientation={x:0,y:0,z:-a.heading})};k.prototype._updateRotationWatcher=function(a){this._handles.removeAll();a&&("2d"===a.type?this._handles.add(t.init(this,"view.rotation",this._updateForRotation)):this._handles.add(t.init(this,"view.camera",this._updateForCamera)))};a([d.property({dependsOn:["view.spatialReference.isWebMercator","view.spatialReference.wkid"],readOnly:!0})],k.prototype,"canShowNorth",null);a([d.property()],
k.prototype,"orientation",void 0);a([d.property({dependsOn:["view.ready","canShowNorth"],readOnly:!0})],k.prototype,"state",null);a([d.property()],k.prototype,"view",void 0);a([d.property()],k.prototype,"reset",null);return k=a([d.subclass("esri.widgets.CompassViewModel")],k)}(d.declared(q))})},"esri/widgets/Zoom":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./support/widget ./Widget ./Zoom/IconButton ./Zoom/ZoomViewModel dojo/i18n!./Zoom/nls/Zoom".split(" "),
function(w,l,f,a,d,b,q,t,m,k){return function(p){function q(a){a=p.call(this)||this;a.view=null;a.viewModel=new m;return a}f(q,p);q.prototype.postInitialize=function(){this._zoomInButton=new t({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus",title:k.zoomIn});this._zoomOutButton=new t({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus",title:k.zoomOut})};Object.defineProperty(q.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,
configurable:!0});q.prototype.render=function(){var a=this.viewModel,d=(f={},f["esri-zoom--horizontal"]="horizontal"===this.layout,f);this._zoomInButton.enabled="ready"===a.state&&a.canZoomIn;this._zoomOutButton.enabled="ready"===a.state&&a.canZoomOut;return b.tsx("div",{class:"esri-zoom esri-widget",classes:d},this._zoomInButton.render(),this._zoomOutButton.render());var f};q.prototype.zoomIn=function(){};q.prototype.zoomOut=function(){};a([d.property({value:"vertical"}),b.renderable()],q.prototype,
"layout",null);a([d.aliasOf("viewModel.view"),b.renderable()],q.prototype,"view",void 0);a([d.property({type:m}),b.renderable(["viewModel.canZoomIn","viewModel.canZoomOut","viewModel.state"])],q.prototype,"viewModel",void 0);a([d.aliasOf("viewModel.zoomIn")],q.prototype,"zoomIn",null);a([d.aliasOf("viewModel.zoomOut")],q.prototype,"zoomOut",null);return q=a([d.subclass("esri.widgets.Zoom")],q)}(d.declared(q))})},"esri/widgets/Zoom/IconButton":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../support/widget ../Widget".split(" "),
function(w,l,f,a,d,b,q){return function(q){function m(){var a=null!==q&&q.apply(this,arguments)||this;a.enabled=!0;a.iconClass="";a.title="";return a}f(m,q);m.prototype.render=function(){var a=this.enabled?0:-1,d=(f={},f["esri-disabled"]=!this.enabled,f["esri-interactive"]=this.enabled,f),f=(m={},m[this.iconClass]=!!this.iconClass,m);return b.tsx("div",{bind:this,class:"esri-widget-button esri-widget",classes:d,onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:a,title:this.title},
b.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon",classes:f}),b.tsx("span",{class:"esri-icon-font-fallback-text"},this.title));var f,m};m.prototype._triggerAction=function(){this.action.call(this)};a([d.property()],m.prototype,"action",void 0);a([d.property(),b.renderable()],m.prototype,"enabled",void 0);a([d.property(),b.renderable()],m.prototype,"iconClass",void 0);a([d.property(),b.renderable()],m.prototype,"title",void 0);a([b.accessibleHandler()],m.prototype,"_triggerAction",
null);return m=a([d.subclass("esri.widgets.IconButton")],m)}(d.declared(q))})},"esri/widgets/Zoom/ZoomViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ./ZoomConditions3D ./ZoomConditions2D ../../core/Accessor".split(" "),function(w,l,f,a,d,b,q,t){return function(m){function k(a){a=m.call(this,a)||this;a.canZoomIn=null;a.canZoomOut=null;a.zoomIn=a.zoomIn.bind(a);a.zoomOut=a.zoomOut.bind(a);
return a}f(k,m);k.prototype.destroy=function(){this.view=null};Object.defineProperty(k.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"view",{set:function(a){a?"2d"===a.type?this._zoomConditions=new q({view:a}):"3d"===a.type&&(this._zoomConditions=new b):this._zoomConditions=null;this._set("view",a)},enumerable:!0,configurable:!0});k.prototype.zoomIn=function(){this.canZoomIn&&this._zoomToFactor(.5)};
k.prototype.zoomOut=function(){this.canZoomOut&&this._zoomToFactor(2)};k.prototype._zoomToFactor=function(a){"ready"===this.state&&this.view.goTo({scale:this.get("view.scale")*a})};a([d.property()],k.prototype,"_zoomConditions",void 0);a([d.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],k.prototype,"canZoomIn",void 0);a([d.property({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],k.prototype,"canZoomOut",void 0);a([d.property({dependsOn:["view.ready"],readOnly:!0})],k.prototype,
"state",null);a([d.property()],k.prototype,"view",null);a([d.property()],k.prototype,"zoomIn",null);a([d.property()],k.prototype,"zoomOut",null);return k=a([d.subclass("esri.widgets.Zoom.ZoomViewModel")],k)}(d.declared(t))})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor".split(" "),function(w,l,f,a,d,b){return function(b){function q(){var a=
null!==b&&b.apply(this,arguments)||this;a.canZoomIn=!0;a.canZoomOut=!0;return a}f(q,b);a([d.property({readOnly:!0})],q.prototype,"canZoomIn",void 0);a([d.property({readOnly:!0})],q.prototype,"canZoomOut",void 0);return q=a([d.subclass("esri.widgets.Zoom.ZoomConditions3D")],q)}(d.declared(b))})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor".split(" "),
function(w,l,f,a,d,b){return function(b){function q(){return null!==b&&b.apply(this,arguments)||this}f(q,b);Object.defineProperty(q.prototype,"canZoomIn",{get:function(){var a=this.get("view.scale"),b=this.get("view.constraints.effectiveMaxScale");return 0===b||a>b},enumerable:!0,configurable:!0});Object.defineProperty(q.prototype,"canZoomOut",{get:function(){var a=this.get("view.scale"),b=this.get("view.constraints.effectiveMinScale");return 0===b||a<b},enumerable:!0,configurable:!0});a([d.property({dependsOn:["view.ready",
"view.scale"],readOnly:!0})],q.prototype,"canZoomIn",null);a([d.property({dependsOn:["view.ready","view.scale"],readOnly:!0})],q.prototype,"canZoomOut",null);a([d.property()],q.prototype,"view",void 0);return q=a([d.subclass("esri.widgets.Zoom.ZoomConditions2D")],q)}(d.declared(b))})},"esri/widgets/NavigationToggle":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators ./support/widget ./Widget ./NavigationToggle/NavigationToggleViewModel dojo/i18n!./NavigationToggle/nls/NavigationToggle".split(" "),
function(w,l,f,a,d,b,q,t,m){return function(k){function p(a){a=k.call(this)||this;a.view=null;a.viewModel=new t;return a}f(p,k);Object.defineProperty(p.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});p.prototype.toggle=function(){};p.prototype.render=function(){var a="disabled"===this.get("viewModel.state"),d="pan"===this.get("viewModel.navigationMode"),f=(k={},k["esri-disabled"]=a,k["esri-navigation-toggle--horizontal"]=
"horizontal"===this.layout,k),k=(p={},p["esri-navigation-toggle__button--active"]=d,p),d=(q={},q["esri-navigation-toggle__button--active"]=!d,q);return b.tsx("div",{bind:this,class:"esri-navigation-toggle esri-widget",classes:f,onclick:this._toggle,onkeydown:this._toggle,tabIndex:a?-1:0,"aria-label":m.toggle,title:m.toggle},b.tsx("div",{class:b.join("esri-navigation-toggle__button esri-widget-button","esri-navigation-toggle__button--pan"),classes:k},b.tsx("span",{class:"esri-icon-pan"})),b.tsx("div",
{class:b.join("esri-navigation-toggle__button esri-widget-button","esri-navigation-toggle__button--rotate"),classes:d},b.tsx("span",{class:"esri-icon-rotate"})));var k,p,q};p.prototype._toggle=function(){this.toggle()};a([d.property({value:"vertical"}),b.renderable()],p.prototype,"layout",null);a([d.aliasOf("viewModel.view"),b.renderable()],p.prototype,"view",void 0);a([d.property({type:t}),b.renderable(["viewModel.state","viewModel.navigationMode"])],p.prototype,"viewModel",void 0);a([d.aliasOf("viewModel.toggle")],
p.prototype,"toggle",null);a([b.accessibleHandler()],p.prototype,"_toggle",null);return p=a([d.subclass("esri.widgets.NavigationToggle")],p)}(d.declared(q))})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/watchUtils ../../core/Accessor ../../core/HandleRegistry".split(" "),function(w,l,f,a,d,b,q,t){return function(m){function k(a){a=
m.call(this,a)||this;a._handles=new t;a.navigationMode="pan";a.view=null;a.toggle=a.toggle.bind(a);return a}f(k,m);k.prototype.initialize=function(){this._handles.add(b.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};k.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(k.prototype,"state",{get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"},enumerable:!0,configurable:!0});k.prototype.toggle=
function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};k.prototype._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};a([d.property({dependsOn:["view.ready"],readOnly:!0})],k.prototype,"state",null);a([d.property()],k.prototype,"navigationMode",void 0);a([d.property()],k.prototype,"view",void 0);a([d.property()],k.prototype,"toggle",null);return k=a([d.subclass("esri.widgets.NavigationToggleViewModel")],
k)}(d.declared(q))})},"esri/views/animation/easing":function(){define(["require","exports"],function(w,l){function f(a){return a}function a(a){var b=2*(a-Math.sqrt((a-1)*a)),d=b/2/a;return function(f){return f<d?a*f*f:b*f-b+1}}function d(a,d){return function(b){return b<d?d*a(b/d):1-a((1-b)/(1-d))*(1-d)}}Object.defineProperty(l,"__esModule",{value:!0});l.linear=f;l.inQuad=function(a){return a*a};l.outQuad=function(a){return 1-l.inQuad(1-a)};l.inOutQuad=function(a){return.5>a?l.inQuad(2*a)/2:(l.outQuad(2*
(a-.5))+1)/2};l.inCubic=function(a){return a*a*a};l.outCubic=function(a){return 1-l.inCubic(1-a)};l.inOutCubic=function(a){return.5>a?l.inCubic(2*a)/2:(l.outCubic(2*(a-.5))+1)/2};l.inQuart=function(a){return a*a*a*a};l.outQuart=function(a){return 1-l.inQuart(1-a)};l.inOutQuart=function(a){return.5>a?l.inQuart(2*a)/2:(l.outQuart(2*(a-.5))+1)/2};l.inQuint=function(a){return a*a*a*a*a};l.outQuint=function(a){return 1-l.inQuint(1-a)};l.inOutQuint=function(a){return.5>a?l.inQuint(2*a)/2:(l.outQuint(2*
(a-.5))+1)/2};l.inSine=function(a){return-Math.cos(a*Math.PI/2)+1};l.outSine=function(a){return 1-l.inSine(1-a)};l.inOutSine=function(a){return.5>a?l.inSine(2*a)/2:(l.outSine(2*(a-.5))+1)/2};l.inExpo=function(a){return Math.pow(2,10*(a-1))};l.outExpo=function(a){return 1-l.inExpo(1-a)};l.inOutExpo=function(a){return.5>a?l.inExpo(2*a)/2:(l.outExpo(2*(a-.5))+1)/2};l.inCirc=function(a){return-(Math.sqrt(1-a*a)-1)};l.outCirc=function(a){return 1-l.inCirc(1-a)};l.inOutCirc=function(a){return.5>a?l.inCirc(2*
a)/2:(l.outCirc(2*(a-.5))+1)/2};l.inCoastQuad=d(a(1),1);l.outCoastQuad=d(a(1),0);l.inOutCoastQuad=d(a(1),.5);l.inCoastCubic=d(a(2),1);l.outCoastCubic=d(a(2),0);l.inOutCoastCubic=d(a(2),.5);l.inCoastQuart=d(a(3),1);l.outCoastQuart=d(a(3),0);l.inOutCoastQuart=d(a(3),.5);l.inCoastQuint=d(a(4),1);l.outCoastQuint=d(a(4),0);l.inOutCoastQuint=d(a(4),.5);l.named={linear:f,"in-quad":l.inQuad,"out-quad":l.outQuad,"in-out-quad":l.inOutQuad,"in-cubic":l.inCubic,"out-cubic":l.outCubic,"in-out-cubic":l.inOutCubic,
"in-quart":l.inQuart,"out-quart":l.outQuart,"in-out-quart":l.inOutQuart,"in-quint":l.inQuint,"out-quint":l.outQuint,"in-out-quint":l.inOutQuint,"in-sine":l.inSine,"out-sine":l.outSine,"in-out-sine":l.inOutSine,"in-expo":l.inExpo,"out-expo":l.outExpo,"in-out-expo":l.inOutExpo,"in-circ":l.inCirc,"out-circ":l.outCirc,"in-out-circ":l.inOutCirc}})},"esri/geometry/ScreenPoint":function(){define(["./Point"],function(w){return w.createSubclass({declaredClass:"esri.geometry.ScreenPoint",verifySR:function(){}})})},
"esri/views/support/screenshotUtils":function(){define(["require","exports","dojo/_base/lang"],function(w,l,f){Object.defineProperty(l,"__esModule",{value:!0});l.adjustScreenshotSettings=function(a,d){a=f.mixin({format:"png",quality:100},a||{});var b,q;a.includePadding?(b=d.width,q=d.height):(b=d.width-d.padding.left-d.padding.right,q=d.height-d.padding.top-d.padding.bottom);var t=b/q;void 0!==a.width&&void 0===a.height?a.height=a.width/t:void 0!==a.height&&void 0===a.width&&(a.width=t*a.height);
void 0!==a.height&&(a.height=Math.floor(a.height));void 0!==a.width&&(a.width=Math.floor(a.width));a.area||a.includePadding||(a.area={x:d.padding.left,y:d.padding.top,width:b,height:q});return a};l.resampleHermite=function(a,d,b,f,t,m,k){void 0===k&&(k=!0);var p=d/t;b/=m;for(var q=Math.ceil(p/2),l=Math.ceil(b/2),v=0;v<m;v++)for(var r=0;r<t;r++){for(var u=4*(r+(k?m-v-1:v)*t),C=0,E=0,c=0,D=0,B=0,I=0,G=0,H=(v+.5)*b,K=Math.floor(v*b);K<(v+1)*b;K++)for(var J=Math.abs(H-(K+.5))/l,w=(r+.5)*p,J=J*J,O=Math.floor(r*
p);O<(r+1)*p;O++){var L=Math.abs(w-(O+.5))/q,C=Math.sqrt(J+L*L);-1<=C&&1>=C&&(C=2*C*C*C-3*C*C+1,0<C&&(L=4*(O+K*d),G+=C*a[L+3],c+=C,255>a[L+3]&&(C=C*a[L+3]/250),D+=C*a[L],B+=C*a[L+1],I+=C*a[L+2],E+=C))}f[u]=D/E;f[u+1]=B/E;f[u+2]=I/E;f[u+3]=G/c}}})},"esri/views/support/WebGLRequirements":function(){define(["require","exports","../../core/Error","../../core/sniff"],function(w,l,f,a){Object.defineProperty(l,"__esModule",{value:!0});l.check=function(){var d=null;a("esri-webgl")?a("esri-webgl-major-performance-caveat")?
d=new f("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check if your GPU is blacklisted."):a("esri-webgl-high-precision-fragment")?a("esri-webgl-vertex-shader-samplers")?a("esri-webgl-element-index-uint")||(d=new f("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.")):d=new f("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):
d=new f("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):d=new f("webgl:required","WebGL is required but not supported.");return d}})},"esri/views/3d/environment/SceneViewEnvironment":function(){define(["dojo/_base/lang","../../../webscene/Environment","../../../webscene/Lighting","./SceneViewLighting","./SceneViewAtmosphere"],function(w,l,f,a,d){var b=l.createSubclass({declaredClass:"esri.views.3d.environment.SceneViewEnvironment",
properties:{atmosphere:{type:d,json:{read:!1}},atmosphereEnabled:{value:!0,json:{read:!1}},starsEnabled:{value:!0,json:{read:!1}},lighting:{set:function(b){if(b)if(this.lighting)null!=b.date&&(this.lighting.date=b.date),null!=b.defaultDate&&(this.lighting.defaultDate=b.defaultDate),null!=b.displayUTCOffset&&(this.lighting.displayUTCOffset=b.displayUTCOffset),this.lighting.directShadowsEnabled=b.directShadowsEnabled,null!=b.ambientOcclusionEnabled&&(this.lighting.ambientOcclusionEnabled=b.ambientOcclusionEnabled),
null!=b.cameraTrackingEnabled&&(this.lighting.cameraTrackingEnabled=b.cameraTrackingEnabled);else if(b instanceof a)this._set("lighting",b);else if(b instanceof f){var d={directShadowsEnabled:b.directShadowsEnabled};null!=b.date&&(d.date=b.date);null!=b.displayUTCOffset&&(d.displayUTCOffset=b.displayUTCOffset);null!=b.defaultDate&&(d.defaultDate=b.defaultDate);this._set("lighting",new a(d))}else this._set("lighting",new a(b));else this.lighting||this._set("lighting",new a)}}},getDefaults:function(){return w.mixin(this.inherited(arguments),
{atmosphere:{}})},atmosphere:null,atmosphereEnabled:!0,starsEnabled:!0,clone:function(){return new b({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled})}});return b})},"esri/views/3d/environment/SceneViewLighting":function(){define(["../../../core/Evented","../../../webscene/Lighting"],function(w,l){var f=new Date,a={target:null,date:null},d={target:null,timezoneOffset:0};return l.createSubclass([w],{declaredClass:"esri.views.3d.environment.SceneViewLighting",
properties:{cameraTrackingEnabled:{value:!0},ambientOcclusionEnabled:{value:!1},defaultDate:{get:function(){return new Date(this._get("defaultDate"))},set:function(a){var b=this._get("date")===this._get("defaultDate");a=new Date(a);this._set("defaultDate",a);b&&this._set("date",a)}},date:{cast:function(a){return a},set:function(a){null!=a&&(this._set("date",new Date(a)),this.positionTimezoneInfo.autoUpdated=!1,this._emitDateWillChange())}}},constructor:function(){this.positionTimezoneInfo={hours:0,
minutes:0,seconds:0,autoUpdated:!0};this._autoUpdateDate=null;var a=(new Date).getFullYear(),a=new Date("March 15, "+a+" 12:00:00 UTC");this._set("defaultDate",a);this._set("date",a)},autoUpdate:function(a,f){var b=this._calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=f.hours;this.positionTimezoneInfo.minutes=f.minutes;this.positionTimezoneInfo.seconds=f.seconds;if(null!=a){this.positionTimezoneInfo.autoUpdated=!0;var m=this.date&&this.date.getTime();this._set("date",
new Date(a));this._emitDateWillChange()}f=this._calculateTimezoneOffset(this.positionTimezoneInfo);b!==f&&(d.target=this,d.timezoneOffset=f,this.emit("timezone-will-change",d));if(null!=a)return m!==a.getTime()},_calculateTimezoneOffset:function(a){return Math.round(a.hours+a.minutes/60+a.seconds/3600)},_emitDateWillChange:function(){a.target=this;f.setTime(this._get("date").getTime());a.date=f;this.emit("date-will-change",a)}})})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define(["../../../core/Accessor"],
function(w){return w.createSubclass({properties:{quality:{}},quality:"low",_qualitySetter:function(l){-1!==["low","high"].indexOf(l)&&this._set("quality",l)},clone:function(){return new this.constructor({quality:this.quality})}})})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("../../../core/declare ../../../core/Accessor ../../../core/Evented ../../../core/promiseUtils ../../../core/watchUtils ../../../core/HandleRegistry ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../../../geometry/SpatialReference ../support/sunUtils ../support/earthUtils ./EnvironmentRenderer ../webgl-engine/lighting/Lightsources ../lib/glMatrix".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v){var r=v.vec3d,u=new Date,C={hours:0,minutes:0,seconds:0},E=[.5773502691896258,-.5773502691896258,.5773502691896258],c=r.createFrom(.22,.22,.33),D=r.createFrom(.22,.22,.22);w=w([l,f],{declaredClass:"esri.views.3d.environment.SceneViewEnvironmentManager",referencePointUpdateDelay:200,referencePointUpdateInterval:3E3,referencePointUpdateDistThreshold:1E6,properties:{updating:{dependsOn:["noReferencePositionQueries"],readOnly:!0,get:function(){return!this.noReferencePositionQueries&&
(!!this._referencePosUpdateQuery||!!this._referencePosMapCoordsRequested)}},noReferencePositionQueries:{},view:{},_environmentRenderer:{}},constructor:function(){this._viewHandles=new b;this._environmentRenderer=null;this._viewConnected=this._trackingEnabled=this._preserveAbsoluteDateTime=!1;this._referencePosResetPreserveAbsoluteTime=null;this._resetReferencePosition()},destroy:function(){this._viewHandles.destroy();this.disposeRendering()},disposeRendering:function(){this._environmentRenderer&&
(this._environmentRenderer.destroy(),this._environmentRenderer=null);this._resetReferencePosition(!0)},updateReadyChange:function(a){a&&!this._viewConnected?(this._viewConnected=!0,this.connectView(this.view)):!a&&this._viewConnected&&(this._viewConnected=!1,this.disconnectView(this.view))},connectView:function(a){this._environmentRenderer=new x({view:a});this._viewHandles.add([d.on(this.view,"environment.lighting","date-will-change",this._lightingDateHandler.bind(this)),this.view.watch("interacting,stationary",
this._interactingStationaryHandler.bind(this)),this.view.watch("environment.lighting.directShadowsEnabled,environment.lighting.ambientOcclusionEnabled",this._updateRenderParamsHandler.bind(this)),this.view.watch("spatialReference",this._spatialReferenceHandler.bind(this)),d.init(this.view,"viewingMode",this._viewingModeHandler.bind(this)),d.init(this.view,"environment.lighting.cameraTrackingEnabled",this._updateCameraTracking.bind(this),!0),this.watch("noReferencePositionQueries",this._cameraHandler.bind(this,
null))]);this._updateRenderParamsHandler();this._updateLightParams();this._cameraHandler()},_updateCameraTracking:function(a){if(this._trackingEnabled=a)a=d.on(this,"view.navigation","currentViewChanged",this._cameraHandler.bind(this,null),this._cameraHandler.bind(this,null),null,!0),this._viewHandles.add(a,"camera");else{if(a=this.get("view.environment.lighting"))a.positionTimezoneInfo.autoUpdated=!1;this._viewHandles.remove("camera")}},disconnectView:function(a){this.disposeRendering();this._viewHandles.removeAll()},
_lightingDateHandler:function(a){if(a=a.date){var c=this.view.environment.lighting;if(!c.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;var b=this.view.spatialReference;if(!(b.isWGS84||b.isWebMercator||(b=this.view.camera.position,this._referencePosMapCoords&&this._referencePosMapCoords.equals(b)))){this._requestReferencePositionUpdate(b);return}this._preupdateTracking(a);this._referencePosWGS84&&(b=p.positionToTimezone(this._referencePosWGS84,C),c.autoUpdate(null,b),this._trackingEnabled&&
(c.positionTimezoneInfo.autoUpdated=!0))}this._updateLightParams(a)}},_preupdateTracking:function(a){!this._trackingEnabled&&this.get("view.environment.lighting.cameraTrackingEnabled")&&this._cameraHandler(a)},_cameraHandler:function(a){var c=this.view.camera;if(c){var b=this.view.spatialReference;b.isWGS84||b.isWebMercator?this._cameraHandlerGlobal(c,a):this._cameraHandlerLocal(c,a)}},_cameraHandlerGlobal:function(a,c){a=a.position;this._referencePosWGS84||(this._referencePosWGS84=new q({spatialReference:m.WGS84}));
a.spatialReference.isWebMercator?t.webMercatorToGeographic(a,!1,this._referencePosWGS84):(this._referencePosWGS84.x=a.x,this._referencePosWGS84.y=a.y);this._referencePosWGS84.z=a.z;this._autoUpdateTimezone(a,c)||this._updateLightParams(c)},_cameraHandlerLocal:function(a,c){a=a.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(a))&&this._requestReferencePositionUpdate(a,!0);this.view.mapCoordsHelper&&this._referencePosWGS84&&(this._referencePosWGS84.z=
a.z*this.view.mapCoordsHelper.unitInMeters,this._referencePosChanged())},_interactingStationaryHandler:function(){!this.view.interacting&&this.view.stationary&&this._executePendingReferencePositionUpdate()},_mainLight:new z.MainLight,_ambientLight:new z.AmbientLight,_moonLight:new z.FillLight,_updateLightParams:function(a){var b=this.view.environment.lighting;a=a||b.date;var b=this.view._stage,d;this._referencePosWGS84?(d=k.computeColorAndIntensity(a,this._referencePosWGS84),k.computeDirection(a,
this._referencePosWGS84,this.view.viewingMode,d.diffuse.direction)):d={diffuse:{color:[1,1,1],intensity:.55,direction:E},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0};r.scale(d.diffuse.color,d.diffuse.intensity*Math.PI,this._mainLight.intensity);r.negate(d.diffuse.direction,this._mainLight.direction);r.scale(d.ambient.color,d.ambient.intensity,this._ambientLight.intensity);r.lerp(c,D,d.globalFactor,this._moonLight.intensity);r.scale(this._moonLight.intensity,(1-.5*d.globalFactor)*
(1-.4*d.noonFactor*(1-d.globalFactor)));r.set(d.diffuse.direction,this._moonLight.direction);b.setLighting({lights:[this._mainLight,this._ambientLight,this._moonLight],globalFactor:d.globalFactor,groundLightingFactor:1-d.noonFactor});this._updateRenderParamsHandler()},_autoUpdateTimezone:function(a,c){if(!this.view.get("environment.lighting.cameraTrackingEnabled"))return!1;u.setTime((c||this.view.environment.lighting.date).getTime());a=p.positionToTimezone(a,C);var b=this.view.environment.lighting.positionTimezoneInfo;
if(!b.autoUpdated)b=a;else if(b.hours===a.hours&&b.minutes===a.minutes&&b.seconds===a.seconds)return!1;var d=u.getUTCHours()-(a.hours-b.hours),f=u.getUTCMinutes()-(a.minutes-b.minutes),b=u.getUTCSeconds()-(a.seconds-b.seconds);u.setUTCHours(d);u.setUTCMinutes(f);u.setUTCSeconds(b);return c?!1:this.view.environment.lighting.autoUpdate(u,a)},_updateRenderParamsHandler:function(){var a=this.view._stage,c=!0;this._referencePosWGS84&&(c=k.computeShadowsEnabled(this._referencePosWGS84,this.view.viewingMode));
a&&a.setRenderParams({shadowMap:this.view.environment.lighting.directShadowsEnabled&&c,ssao:this.view.environment.lighting.ambientOcclusionEnabled})},_spatialReferenceHandler:function(){this._resetReferencePosition()},_viewingModeHandler:function(a){this._resetReferencePosition()},_resetReferencePosition:function(a){this._cancelReferencePosUpdates();this._referencePosWGS84=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;a||this.notifyChange("updating")},
_requestReferencePositionUpdate:function(c,b){if(this.view.mapCoordsHelper.canProject()&&!this.noReferencePositionQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(c):this._referencePosMapCoordsRequested=c.clone(),this._referencePosResetPreserveAbsoluteTime=!!b,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&!this.view.interacting&&this.view.stationary)){var d=this,f=this._referencePosUpdateQuery=a.after(this.referencePointUpdateDelay).then(function(){if(d._referencePosUpdateQuery===
f)return d._doReferencePositionUpdateQuery(function(){return d._referencePosUpdateQuery!==f})}).always(function(){d._referencePosUpdateQuery===f&&(d._referencePosUpdateQuery=null,d._referencePosUpdateTimer||d._executePendingReferencePositionUpdate(),d.notifyChange("updating"))}),k=this._referencePosUpdateTimer=a.after(this.referencePointUpdateInterval).then(function(){d._referencePosUpdateTimer===k&&(d._referencePosUpdateTimer=null,d._referencePosUpdateQuery||d._executePendingReferencePositionUpdate())});
this.notifyChange("updating")}},_doReferencePositionUpdateQuery:function(a){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;return this.view.mapCoordsHelper.toGeographic(this._referencePosMapCoords).then(function(c){if(!a()&&
!isNaN(c[0])&&!isNaN(c[1])){var b=this._referencePosMapCoords.z*this.view.mapCoordsHelper.unitInMeters;this._referencePosWGS84?(this._referencePosWGS84.x=c[0],this._referencePosWGS84.y=c[1],this._referencePosWGS84.z=b):this._referencePosWGS84=new q({x:c[0],y:c[1],z:b,spatialReference:m.WGS84});this._referencePosChanged()}}.bind(this))},_executePendingReferencePositionUpdate:function(){var a=this._referencePosMapCoordsRequested;a&&this._requestReferencePositionUpdate(a,this._referencePosResetPreserveAbsoluteTime)},
_referencePosChanged:function(){this._preserveAbsoluteDateTime?this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84)||this._updateLightParams()},_exceedsReferencePosDistThreshold:function(a){return this._referencePosMapCoords?(a=this._referencePosMapCoords.distance(a),this.view.mapCoordsHelper&&(a*=this.view.mapCoordsHelper.unitInMeters),a>this.referencePointUpdateDistThreshold):!0},_cancelReferencePosUpdates:function(){this._referencePosUpdateTimer=this._referencePosUpdateQuery=
null}});w.FIXED_LIGHT_DIRECTION=E;return w})},"esri/views/3d/support/sunUtils":function(){define(["./mathUtils","../lib/glMatrix","../lib/SunCalc"],function(w,l,f){var a=l.vec3d,d=l.mat4d,b=w.lerp,q=d.identity(),t={azimuth:0,altitude:0},m={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:Math.PI/3,altitude:Math.PI/
3}}},k={ambient:{color:a.create(),intensity:0},diffuse:{color:a.create(),intensity:0,direction:a.create()}},p={settings:m,computeDirection:function(b,k,m,u){u||(u=a.create());var r=d.identity(q);if("global"===m)f.getPosition(b,0,0,t),a.set3(0,0,-1,u),d.rotateX(r,-t.azimuth),d.rotateY(r,-t.altitude);else{var v=p.settings.planarDirection;m=v.globalAngles;v=(k.z-v.localAltitude)/(v.globalAltitude-v.localAltitude);v=w.clamp(v,0,1);1>v?(f.getPosition(b,k.y,k.x,t),t.azimuth=(1-v)*t.azimuth+v*m.azimuth,
t.altitude=(1-v)*t.altitude+v*m.altitude):(t.azimuth=m.azimuth,t.altitude=m.altitude);a.set3(0,-1,0,u);d.rotateZ(r,-t.azimuth);d.rotateX(r,-t.altitude)}d.multiplyVec3(r,u);return u},computeShadowsEnabled:function(a,b){return"global"===b?!0:a.z<p.settings.planarDirection.localAltitude},computeColorAndIntensity:function(d,v){var r,u,q,t=v.z;u=p.settings;a.set3(1,1,1,k.ambient.color);k.ambient.intensity=u.global.ambient;a.set3(1,1,1,k.diffuse.color);k.diffuse.intensity=u.global.diffuse;t=(t-u.local.altitude)/
(u.global.altitude-u.local.altitude);t=w.clamp(t,0,1);k.globalFactor=t;v=f.getTimes(d,v.y,v.x);if(1>t){u=d.valueOf();var c,D;v.polarException===f.POLAR_EXCEPTION.MIDNIGHT_SUN?(c=u-36E5*(d.getHours()+48)-6E4*d.getMinutes(),D=c+432E6):v.polarException===f.POLAR_EXCEPTION.POLAR_NIGHT?(c=u-2,D=u-1):(c=v.sunrise.valueOf(),D=v.sunset.valueOf());var B=D-c;q=c+B/2;var l=B/4;r=q-l;var l=q+l,z=.06*B,B=c-z/2;c+=z/2;var H=D-z/2,K=D+z/2;D=m.local;var J=[.01,D.ambientAtNight],P=[.8,.8,1],O=[.01,.01,.01],L=[D.diffuseAtTwilight,
D.ambientAtTwilight],M=[1,.75,.75],R=[.8,.8,1],Q=[.9*D.diffuseAtNoon,D.ambientAtNoon],T=[1,.98,.98],A=[.98,.98,1],V=[D.diffuseAtNoon,D.ambientAtNoon],S=[1,1,1],h=[1,1,1];D=[0,0];var e=[0,0],z=[0,0];u<B||u>K?(D=J,e=O,z=P):u<c?(z=c-B,D=x(u-B,z,J,L),e=x(u-B,z,O,M),z=x(u-B,z,P,R)):u<r?(z=r-c,D=x(u-c,z,L,Q),e=x(u-c,z,M,T),z=x(u-c,z,R,A)):u<q?(z=q-r,D=x(u-r,z,Q,V),e=x(u-r,z,T,S),z=x(u-r,z,A,h)):u<l?(z=l-q,D=x(u-q,z,V,Q),e=x(u-q,z,S,T),z=x(u-q,z,h,A)):u<H?(z=H-l,D=x(u-l,z,Q,L),e=x(u-l,z,T,M),z=x(u-l,z,A,
R)):u<K&&(z=K-H,D=x(u-H,z,L,J),e=x(u-H,z,M,O),z=x(u-H,z,R,P));u=D[0];q=e;r=D[1];a.lerp(z,k.ambient.color,t,k.ambient.color);k.ambient.intensity=b(r,k.ambient.intensity,t);a.lerp(q,k.diffuse.color,t,k.diffuse.color);k.diffuse.intensity=b(u,k.diffuse.intensity,t)}t=d.valueOf();v.polarException===f.POLAR_EXCEPTION.MIDNIGHT_SUN?(d=t-36E5*(d.getHours()+48)-6E4*d.getMinutes(),v=d+432E6):v.polarException===f.POLAR_EXCEPTION.POLAR_NIGHT?(d=t-2,v=t-1):(d=v.sunrise.valueOf(),v=v.sunset.valueOf());d=1-w.clamp(Math.abs(t-
(d+(v-d)/2))/432E5,0,1);k.noonFactor=d;return k}},x=function(a,b,d,f){for(var k=[],m=0;m<d.length;m++)k[m]=(f[m]-d[m])*a/b+d[m];return k};return p})},"esri/views/3d/lib/SunCalc":function(){define([],function(){function w(a){return new Date(864E5*(a+.5-2440588))}function l(a,b){return r(p(a)*x(c)-z(b)*p(c),x(a))}function f(a,b){return v(p(b)*x(c)+x(b)*p(c)*p(a))}function a(a,c,b){return r(p(a),x(a)*p(c)-z(b)*x(c))}function d(a,c,b){return v(p(c)*p(b)+x(c)*x(b)*x(a))}function b(a){return C*(1.9148*
p(a)+.02*p(2*a)+3E-4*p(3*a))}function q(a,c){a=C*(357.5291+.98560028*a);var d=b(a);a=a+d+102.9372*C+k;c||(c={dec:0,ra:0});c.dec=f(a,0);c.ra=l(a,0);return c}function t(a,c,b){return 2451545+a+.0053*p(c)-.0069*p(2*b)}function m(a){var c=C*(134.963+13.064993*a),b=C*(93.272+13.22935*a);a=C*(218.316+13.176396*a)+6.289*C*p(c);b=5.128*C*p(b);c=385001-20905*x(c);return{ra:l(a,b),dec:f(a,b),dist:c}}var k=Math.PI,p=Math.sin,x=Math.cos,z=Math.tan,v=Math.asin,r=Math.atan2,u=Math.acos,C=k/180,E={dec:0,ra:0},c=
23.4397*C,D={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(c,b,f,k){f=C*-f;b*=C;var m=c.valueOf()/864E5-.5+2440588-2451545;c=q(m,E);f=C*(280.16+360.9856235*m)-f-c.ra;k||(k={azimuth:0,altitude:0});k.azimuth=a(f,b,c.dec);k.altitude=d(f,b,c.dec);return k}},B=[[-.83,"sunrise","sunset"]];D.addTime=function(a,c,b){B.push([a,c,b])};D.getTimes=function(a,c,d){function m(a){var c=v,e=E;a=u((p(a)-p(c)*p(e))/(x(c)*x(e)));return t(9E-4+(a+r)/(2*k)+q,l,z)}var r=C*-d,v=C*c,q=Math.round(a.valueOf()/
864E5-.5+2440588-2451545-9E-4-r/(2*k));a=9E-4+(0+r)/(2*k)+q;var l=C*(357.5291+.98560028*a);c=b(l);var z=l+c+102.9372*C+k,E=f(z,0);a=t(a,l,z);c={solarNoon:w(a),nadir:w(a-.5),polarException:D.POLAR_EXCEPTION.NORMAL};var I,G,H,V;d=0;for(I=B.length;d<I;d+=1)G=B[d],H=m(G[0]*C),V=a-(H-a),c[G[1]]=w(V),c[G[2]]=w(H);c.polarException=function(a){a=(p(a)-p(v)*p(E))/(x(v)*x(E));return-1>a?D.POLAR_EXCEPTION.MIDNIGHT_SUN:1<a?D.POLAR_EXCEPTION.POLAR_NIGHT:D.POLAR_EXCEPTION.NORMAL}(B[0][0]*C);return c};D.getMoonPosition=
function(c,b,f){f=C*-f;b*=C;var k=c.valueOf()/864E5-.5+2440588-2451545;c=m(k);f=C*(280.16+360.9856235*k)-f-c.ra;k=d(f,b,c.dec);k+=.017*C/z(k+10.26*C/(k+5.1*C));return{azimuth:a(f,b,c.dec),altitude:k,distance:c.dist}};D.getMoonFraction=function(a){var c=a.valueOf()/864E5-.5+2440588-2451545;a=q(c);c=m(c);a=u(p(a.dec)*p(c.dec)+x(a.dec)*x(c.dec)*x(a.ra-c.ra));a=r(149598E3*p(a),c.dist-149598E3*x(a));return(1+x(a))/2};return D})},"esri/views/3d/support/earthUtils":function(){define(["dojo/_base/lang","./mathUtils",
"../../../geometry/Point","../../../geometry/SpatialReference","../../../geometry/support/webMercatorUtils"],function(w,l,f,a,d){var b=6378137*Math.PI,q=new f(0,0,a.WGS84),t={earthRadius:6378137,halfEarthCircumference:b,earthCircumference:2*b,metersPerDegree:b/180,getGreatCircleDistance:function(a,b,d,f){void 0===d&&void 0===f&&w.isObject(a)&&w.isObject(b)&&(d=b.get("longitude"),f=b.get("latitude"),b=a.get("latitude"),a=a.get("longitude"));b=l.deg2rad(b);f=l.deg2rad(f);a=l.deg2rad(a);var k=l.deg2rad(d);
d=Math.sin((b-f)/2);a=Math.sin((a-k)/2);b=12756274*l.asin(Math.sqrt(d*d+Math.cos(b)*Math.cos(f)*a*a));return b=Math.round(1E4*b)/1E4},getGreatCircleSpanAt:function(a,b,d){var k=b.spatialReference,m=new f(b.x,a.y,k),p=new f(d.x,a.y,k);b=new f(a.x,b.y,k);a=new f(a.x,d.y,k);return{lon:this.getGreatCircleDistance(m,p),lat:this.getGreatCircleDistance(b,a)}},getLonDeltaForDistance:function(a,b,d){a=d/6378137;b=l.deg2rad(b);a=Math.sin(a/2);b=Math.cos(b);b=2*l.asin(Math.sqrt(a*a/(b*b)));return l.rad2deg(b)},
getLatDeltaForDistance:function(a,b,d){return l.rad2deg(d/6378137)},getLatLonDeltaForDistance:function(a,b,d){return{lat:this.getLatDeltaForDistance(a,b,d),lon:this.getLonDeltaForDistance(a,b,d)}},getMaxCameraAltitude:function(a){a=l.deg2rad(a/2);return 6378137*(1-Math.sin(a))/Math.sin(a)},getViewExtentDistance:function(a,b){b=l.deg2rad(b/2);return 12756274*l.acos((Math.pow(a+6378137,2)+Math.pow(6378137,2)-Math.pow((a+6378137)*Math.cos(b)-Math.sqrt(Math.pow(Math.cos(b)*(a+6378137),2)-a*a-12756274*
a),2))/(12756274*(a+6378137)))},computeCarthesianDistance:function(a,b){function d(a){var b=l.deg2rad(a.get("latitude")),d=l.deg2rad(a.get("longitude")),f=Math.cos(b);a=6378137+(a.z||0);return[Math.cos(d)*f*a,Math.sin(b)*a,-Math.sin(d)*f*a]}a=d(a);b=d(b);b=[b[0]-a[0],b[1]-a[1],b[2]-a[2]];return Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2])},longitudeToTimezone:function(a,b){a/=15;b||(a=Math.round(a));return a},positionToTimezone:function(b,f){b.spatialReference.wkid!==a.WGS84.wkid?d.webMercatorToGeographic(b,
!1,q):(q.x=b.x,q.y=b.y);q.z=b.z;f||(f={hours:0,minutes:0,seconds:0});f.hours=t.longitudeToTimezone(q.x,!0);b=f.hours%1;f.hours-=b;f.minutes=60*b;b=f.minutes%1;f.minutes-=b;f.seconds=Math.round(60*b);return f}};return t})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("../../../core/watchUtils ../support/ExternalRenderer ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars ../webgl-engine/lib/RenderSlot".split(" "),function(w,l,f,a,d,b,q){return l.createSubclass({declaredClass:"esri.views.3d.environment.EnvironmentRenderer",
properties:{view:{},viewingMode:{dependsOn:["view.viewingMode"],get:function(){return this.get("view.viewingMode")||"global"}},atmosphereQuality:{dependsOn:["view.environment.atmosphereEnabled","view.environment.atmosphere.quality"],get:function(){return this.get("view.environment.atmosphereEnabled")?this.get("view.environment.atmosphere.quality")||"none":"none"}},starsEnabled:{dependsOn:["view.environment.starsEnabled"],get:function(){return this.get("view.environment.starsEnabled")||!1}},transparent:{dependsOn:["view.basemapTerrain.opacity",
"view.basemapTerrain.wireframe"],get:function(){var a=this.get("view.basemapTerrain");return a&&a._renderer.isTransparent()}},_atmosphere:{},_stars:{},needsRender:{dependsOn:["_stars.needsRender","_atmosphere.needsRender"],get:function(){return!!(this._needsRender||this._atmosphere&&this._atmosphere.needsRender||this._stars&&this._stars.needsRender)}}},constructor:function(){this._STANDARD_SLOT=q.BACKGROUND;this._SPECIAL_SLOT=q.POSTPROCESSING_ATMOSPHERE;this._slots=[this._STANDARD_SLOT,this._SPECIAL_SLOT];
this._stars=this._atmosphere=this._atmosphereReadyPromise=this._AtmosphereClass=null;this._needsRender=!0;this.notifyChange("needsRender")},initialize:function(){this.view._stage.addExternalRenderer(this._slots,this);this._basemapTerrainHandle=w.when(this.view,"basemapTerrain",this._updateBasemapTerrain.bind(this))},destroy:function(){this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null);this._stars&&(this._stars.destroy(),this._stars=null);this._basemapTerrainHandle&&this._basemapTerrainHandle.remove();
this.view&&(this.view._stage.removeExternalRenderer(this),this.view=null)},setup:function(a){this.watch("viewingMode,atmosphereQuality,transparent,visible",this._updateAtmosphere.bind(this));this._updateAtmosphere();this.watch("starsEnabled,transparent,visible",this._updateStars.bind(this));this._updateStars();this.watch("view.basemapTerrain.loaded",function(){this._needsRender=!0;this.notifyChange("needsRender")}.bind(this))},resetNeedsRender:function(){this._atmosphere&&(this._atmosphere.resetNeedsRender?
this._atmosphere.resetNeedsRender():this._atmosphere.didRender&&(this._atmosphere.needsRender=!1,this._atmosphere.didRender=!1));this._stars&&(this._stars.resetNeedsRender?this._stars.resetNeedsRender():this._stars.didRender&&(this._stars.needsRender=!1,this._stars.didRender=!1));this.didRender&&(this.didRender=this._needsRender=!1,this.notifyChange("needsRender"))},render:function(a){if(!this.get("view.basemapTerrain.loaded")&&"global"===this.viewingMode)return!1;if(!this._stars&&!this._atmosphere)return!0;
this._stars&&this._stars.render(a);this._atmosphere&&this._atmosphere.render(a);return this._stars&&this._stars.didRender||this._atmosphere&&this._atmosphere.didRender},_updateStars:function(){var a=this._getAtmosphereSlot();this.starsEnabled&&!this._stars?(this._stars=new b({view:this.view,slot:a}),this._stars.initializeRenderContext(this.renderContext)):!this.starsEnabled&&this._stars?(this._stars.destroy(),this._stars=null):this._stars&&(this._stars.slot=a);this._needsRender=!0;this.notifyChange("needsRender")},
_updateAtmosphere:function(){var a=this._getAtmosphereSlot();this._atmosphere&&(this._atmosphere.slot=a);if(this._updateAtmosphereClass(this.renderContext)){this._needsRender=!0;this.notifyChange("needsRender");var b=function(){this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null)}.bind(this);if(this._AtmosphereClass){this._atmosphereReadyPromise&&(this._atmosphereReadyPromise.cancel(),this._atmosphereReadyPromise=null);var d=new this._AtmosphereClass({view:this.view,slot:a});d.initializeRenderContext(this.renderContext);
this._atmosphere?this._atmosphereReadyPromise=d.then(function(){b();this._atmosphereReadyPromise=null;this._atmosphere=d}.bind(this)):this._atmosphere=d;d.then(function(){this._updateBasemapTerrain()}.bind(this))}else b(),this._updateBasemapTerrain()}},_updateAtmosphereClass:function(b){var m=this._AtmosphereClass;"none"===this.atmosphereQuality?this._AtmosphereClass=null:"high"===this.atmosphereQuality&&!this.transparent&&a.isSupported(b)?this._AtmosphereClass="local"===this.viewingMode?f:a:this._AtmosphereClass=
"local"===this.viewingMode?f:d;return this._AtmosphereClass!==m},_getAtmosphereSlot:function(){return this.transparent&&"global"===this.viewingMode?this._SPECIAL_SLOT:this._STANDARD_SLOT},_updateBasemapTerrain:function(){var b=this.get("view.basemapTerrain");b&&(b.velvetOverground=!(!this._AtmosphereClass||this._AtmosphereClass===a))}})})},"esri/views/3d/support/ExternalRenderer":function(){define("../../../core/declare ../../../core/Accessor ../../../core/Promise dojo/Deferred dojo/aspect dojo/_base/lang".split(" "),
function(w,l,f,a,d,b){return w([l,f],{"-chains-":b.mixin(l._meta.chains,{setup:"after",initializeRenderContext:"after",uninitializeRenderContext:"before"}),properties:{gl:{readOnly:!0,get:function(){return this._gl}},needsRender:{value:!0},visible:{value:!0}},constructor:function(){this.didRender=!1;this.renderContext=null;this.watch("visible",function(){this.needsRender=!0}.bind(this));this._contextDfd=new a},initialize:function(){this.addResolvingPromise(this._contextDfd.promise);d.around(this,
"render",function(a){return function(){return this.isRejected()?this.didRender=!0:this.isResolved()?!this.visible||a.apply(this,arguments)?this.didRender=!0:!1:!1}.bind(this)}.bind(this));this.then(function(){this.destroyed||this.setup(this.renderContext)}.bind(this))},needsRender:!0,visible:!0,initializeRenderContext:function(a){this.renderContext=a;this._contextDfd.resolve()},uninitializeRenderContext:function(a){},setup:function(a){},render:function(a){return!1}})})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("dojo/text!./materials/SimpleAtmosphereMaterial.xml dojo/Deferred ../support/ExternalRenderer ../lib/glMatrix ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/Texture ../webgl-engine/lib/Util ../webgl-engine/lib/GLTextureRep ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ./resources/SimpleAtmosphereTexture ../../webgl/Program ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/DefaultVertexAttributeLocations".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r){var u=a.vec2d,C=a.vec3d,E=a.mat4d,c=t.VertexAttrConstants,D=E.create();return f.createSubclass({declaredClass:"esri.views.3d.environment.PanoramicAtmosphere",properties:{view:{},needsRender:{value:!1},slot:{value:p.BACKGROUND,set:function(a){this.needsRender=!0;this._set("slot",a)}}},constructor:function(){this._renderData={texV:u.create(),silCircleCenter:C.create(),silCircleV1:C.create(),silCircleV2:C.create()};this._textureRep=this._texture=null;this.slot=
p.BACKGROUND},initialize:function(){this._textureDfd=new l;this.addResolvingPromise(this._textureDfd.promise)},destroy:function(){this._textureRep&&(this._texture&&(this._textureRep.release("SimpleAtmosphere"),this._textureRep.getTexture("SimpleAtmosphere").unload()),this._textureRep=null);this._program&&(this._program.dispose(),this._program=null);this._textureDfd&&(this._textureDfd.cancel(),this._textureDfd=null)},initializeRenderContext:function(a){this._textureRep=new m({SimpleAtmosphere:new q(x,
"SimpleAtmosphere",{wrapClamp:!0})},a.programRep,function(){return this.view._stage.getCamera().viewport}.bind(this),a.rctx);this._texture=this._textureRep.aquire("SimpleAtmosphere",void 0,void 0,function(a){this._texture=a.getGLTexture();this._textureDfd.resolve();this._textureDfd=null}.bind(this))},setup:function(a){var c=this._createGeometryData(),b=this.renderContext.rctx;this._renderer=new d(c,v.Pos3,null,b);a.shaderSnippets.vsSimpleAtmosphere||a.shaderSnippets._parse(w);this._program=new z(b,
a.shaderSnippets.vsSimpleAtmosphere,a.shaderSnippets.fsSimpleAtmosphere,r.Default3D,["PANORAMIC"])},render:function(a){if(a.slot!==this.slot||a.pass!==k.MATERIAL||!this._textureRep.getIsLoaded("SimpleAtmosphere"))return!1;var c=this.renderContext.rctx,b=c.gl,d=this._program;c.bindProgram(d);c.bindTexture(this._texture);d.setUniform1i("tex",0);d.setUniformMatrix4fv("proj",a.camera.projectionMatrix);E.toRotationMat(a.camera.viewMatrix,D);d.setUniformMatrix4fv("view",D);d.setUniform4f("color",1,1,1,
1);d.setUniform3fv("lightDirection",a.lightingData.direction);c.setFaceCullingEnabled(!0);c.setDepthFunction(b.LEQUAL);c.setBlendingEnabled(!0);c.setDepthWriteEnabled(!1);this._renderer.render(this._program);c.setDepthWriteEnabled(!0);c.setBlendingEnabled(!1);c.setDepthFunction(b.LESS);c.setFaceCullingEnabled(!1);return!0},_createGeometryData:function(){for(var a=b.createPolySphereGeometry(1,2),d=a.getFaces(),f=d[0].indices[c.POSITION],k=0;k<f.length;k+=3){var m=f[k];f[k]=f[k+2];f[k+2]=m}a=a.getVertexAttr();
f=a[c.NORMAL].data;for(k=0;k<f.length;k++)f[k]=-f[k];return{faces:d[0],vertexAttr:a}}})})},"esri/views/3d/webgl-engine/lib/GeometryRenderer":function(){define("require exports ../materials/internal/MaterialUtil ./DefaultVertexAttributeLocations ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Util ../../../webgl/enums".split(" "),function(w,l,f,a,d,b,q,t){return function(){function m(k,m,x,t){this._drawMode=4;this._layout=m;var p=k.faces;this._count=p.indices[p.positionKey].length;
p=new Float32Array(this._count*q.getStride(m)/4);x?x(k,void 0,void 0,null,m,p,0):f.fillInterleaved(k,void 0,void 0,null,m,p,0);this._rctx=t;this._vao=new d(t,a.Default3D,{geometry:m},{geometry:b.createVertex(t,35044,p)})}m.prototype.enablePointRendering=function(a){this._drawMode=a?0:4};m.prototype.render=function(a){var b=this._rctx;b.bindVAO(this._vao);q.assertCompatibleVertexAttributeLocations(this._vao,a);b.drawArrays(this._drawMode,0,this._count)};return m}()})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("require exports ../../lib/IdGen ../../lib/gl-matrix ../../lib/ComponentUtils ../../lib/Util ../../parts/Model ../../lib/screenSizePerspectiveUtils ../../../../webgl/Util ../../../support/aaBoundingBox".split(" "),
function(w,l,f,a,d,b,q,t,m,k){function p(a,c,b,d,f,h){if(void 0===f||3!==h)for(f=0;f<h;++f)b[d+f]=a[c+f];else{var e=a[c],g=a[c+1];a=a[c+2];b[d]=f[0]*e+f[4]*g+f[8]*a+f[12];b[d+1]=f[1]*e+f[5]*g+f[9]*a+f[13];b[d+2]=f[2]*e+f[6]*g+f[10]*a+f[14]}return h}function x(a,c,b,d,f,h){for(var e=a.length,g=0;g<e;++g){for(var k=b*a[g],m=0;m<b;++m)d[f+m]=c[k+m];f+=h}}function z(a,c,b,d,f,h){d=new Uint8Array(d.buffer);f*=4;h*=4;var e=a.length;if(4===b)for(b=0;b<e;++b){var g=4*a[b];d[f]=c[g];d[f+1]=c[g+1];d[f+2]=c[g+
2];d[f+3]=c[g+3];f+=h}else if(3===b)for(b=0;b<e;++b)g=3*a[b],d[f]=c[g],d[f+1]=c[g+1],d[f+2]=c[g+2],d[f+3]=255,f+=h}function v(a,c,b,d,f){var h=u(c,b,K);k.setMin(G,a.getBBMin());k.setMax(G,a.getBBMax());if(C(G,c,h,d)){var h=a.getPrimitiveIndices(),e=a.getIndices(),g=a.getPosition(),m=h?h.length:e.length/3;if(1E4<m&&(a=a.getChildren(),void 0!==a)){for(h=0;8>h;++h)void 0!==a[h]&&v(a[h],c,b,d,f);return}r(c,b,0,m,e,g,h,f)}}function r(c,b,d,f,k,h,e,g){var m=h.data;h=h.size;var p=c[0],r=c[1];c=c[2];var u=
b[0]-p,v=b[1]-r;for(b=b[2]-c;d<f;d++){var q=e?e[d]:d,x=h*k[3*q],D=h*k[3*q+1],t=h*k[3*q+2],B=m[x],l=m[x+1],z=m[x+2],x=m[D]-B,C=m[D+1]-l,D=m[D+2]-z,E=m[t]-B,I=m[t+1]-l,t=m[t+2]-z,G=v*t-I*b,H=b*E-t*u,A=u*I-E*v,K=x*G+C*H+D*A,B=p-B,w=r-l,T=c-z,l=w*D-C*T,z=T*x-D*B,M=B*C-x*w;if(K>J){G=B*G+w*H+T*A;if(0>G||G>K)continue;H=u*l+v*z+b*M;if(0>H||G+H>K)continue}else if(K<-J){G=B*G+w*H+T*A;if(0<G||G<K)continue;H=u*l+v*z+b*M;if(0<H||G+H<K)continue}else continue;K=(E*l+I*z+t*M)/K;0<=K&&(G=P,a.vec3d.set3(x,C,D,O),a.vec3d.set3(E,
I,t,L),x=a.vec3d.normalize(a.vec3d.cross(O,L,G)),g(K,x,q))}}function u(c,b,d){return a.vec3d.set3(1/(b[0]-c[0]),1/(b[1]-c[1]),1/(b[2]-c[2]),d)}function C(a,c,b,d){var f=(a[0]-d-c[0])*b[0],h=(a[3]+d-c[0])*b[0],e=Math.min(f,h),f=Math.max(f,h),h=(a[1]-d-c[1])*b[1],g=(a[4]+d-c[1])*b[1],e=Math.max(e,Math.min(h,g)),f=Math.min(f,Math.max(h,g));if(e>f)return!1;h=(a[2]-d-c[2])*b[2];a=(a[5]+d-c[2])*b[2];e=Math.max(e,Math.min(h,a));f=Math.min(f,Math.max(h,a));return e<=f}function E(a,c,b,d){if(void 0!==a)return b.aquire(a,
c,d)}function c(a,c){void 0!==a&&c.release(a)}function D(a,c){c=c?D(c):{};for(var b in a){var d=a[b];d&&d.forEach&&(d=B(d));null==d&&b in c||(c[b]=d)}return c}function B(a){var c=[];a.forEach(function(a){return c.push(a)});return c}Object.defineProperty(l,"__esModule",{value:!0});var I=a.mat4d.create(),G=k.create(),H=b.VertexAttrConstants;l.__Material_idGen=new f;l.__GLMaterial_id=0;l.IDENTITY=a.mat4d.identity();l.fill=p;l.fillInterleaved=function(a,c,b,d,f,h,e,g){for(var k=m.getStride(f)/4,p=0;p<
f.length;p++){var r=f[p],u=e+r.offset/4,r=r.name,v=a.vertexAttr[r];if(null!=v&&(null==g||null!=g[r]))switch(r){case "uv0":x(a.faces.indices[r],v.data,v.size,h,u,k);break;case "region":for(var r=a.faces.indices[r],q=v.data,D=v.size,v=h,t=k,v=new Uint16Array(v.buffer),u=2*u,t=2*t,B=r.length,l=0;l<B;++l){for(var C=D*r[l],E=0;E<D;++E)v[u+E]=q[C+E];u+=t}break;case "color":if(d&&d.color)if(r=a.faces.indices[r],q=v.data,D=d.color,l=v.size,v=h,t=k,v=new Uint8Array(v.buffer),u*=4,t*=4,B=r.length,4===l)for(l=
0;l<B;++l)C=4*r[l],v[u]=q[C]*D[0],v[u+1]=q[C+1]*D[1],v[u+2]=q[C+2]*D[2],v[u+3]=q[C+3]*D[3],u+=t;else{if(3===l)for(E=255*D[3],l=0;l<B;++l)C=3*r[l],v[u]=q[C]*D[0],v[u+1]=q[C+1]*D[1],v[u+2]=q[C+2]*D[2],v[u+3]=E,u+=t}else z(a.faces.indices[r],v.data,v.size,h,u,k);break;case "symbolColor":z(a.faces.indices[r],v.data,v.size,h,u,k);break;default:if(D=r===H.POSITION?c:r===H.NORMAL?b:void 0,void 0!==D&&3===v.size)for(r=a.faces.indices[r],q=v.data,v=h,t=k,B=r.length,l=0;l<B;++l){var I=3*r[l],C=q[I],E=q[I+1],
I=q[I+2];v[u]=D[0]*C+D[4]*E+D[8]*I+D[12];v[u+1]=D[1]*C+D[5]*E+D[9]*I+D[13];v[u+2]=D[2]*C+D[6]*E+D[10]*I+D[14];u+=t}else x(a.faces.indices[r],v.data,v.size,h,u,k)}}};l.triangleVertexArrayToWireframeLines=function(a,c,b,d){for(b=Math.floor(b/3)-1;0<=b;b--){var f=c+3*b*d,h=c+6*b*d+5*d;p(a,f,a,h,null,d);h-=d;p(a,f+d,a,h,null,d);h-=d;p(a,f+d,a,h,null,d);h-=d;p(a,f+2*d,a,h,null,d);h-=d;p(a,f+2*d,a,h,null,d);h-=d;p(a,f,a,h,null,d)}};l.intersectTriangleGeometry=function(a,c,f,m,p,h,e){b.assert("triangle"===
a.data.primitiveType);c=c.componentVisibilities;m=m.tolerance;var g=a.getBoundingInfo(0);if(1<a.getComponentCount()){if(f=u(p,h,K),k.setMin(G,g.getBBMin()),k.setMax(G,g.getBBMax()),C(G,p,f,m))for(var g=a.getComponentCount(),n=a.data.faces[0],q=n.indices[n.positionKey],n=a.data.vertexAttributes[n.positionKey],x=a.data.componentOffsets,D=0;D<g;D++)if(d.getVisibility(c,D)){var t=a.getComponentAABB(D,G);C(t,p,f,m)&&r(p,h,x[D]/3,x[D+1]/3,q,n,void 0,e)}}else d.getVisibility(c,0)&&v(g,p,h,m,e)};var K=a.vec3d.create(),
J=Math.pow(2,-52),P=a.vec3d.create(),O=a.vec3d.create(),L=a.vec3d.create();l.transformToWorld=function(c,b,d){return a.vec4d.set4(c[0]-b[0],c[1]-b[1],c[2]-b[2],1,d)};l.transformToView=function(c,b,d,f){a.mat4d.translate(d,b,I);d=I;return a.mat4d.multiplyVec4(d,c,f)};l.transformToProjection=function(c,b,d,f){f[0]=c[0]+d[0];f[1]=c[1]+d[1];f[2]=c[2]+d[2];f[3]=c[3];return a.mat4d.multiplyVec4(b,f)};l.transformToNDC=function(c,b){return a.vec4d.scale(c,1/Math.abs(c[3]),b)};l.applyScreenSizePerspectiveScale=
function(a,c,b,d,f){return t.scale(a,d,b,f)};l.verticalOffsetAtDistance=function(a,c,d,f,k){var h=d.screenLength||0;k&&(h=t.scale(h,f,c,k));return b.clamp(h*Math.tan(.5*a.fovY)/(.5*a.fullHeight)*c,d.minWorldLength||0,null!=d.maxWorldLength?d.maxWorldLength:Infinity)};l.basicMaterialConstructor=function(a,c){var d=!0,f=0,k=l.__Material_idGen.gen(c);a.getId=function(){return k};var h;a.getParentStage=function(){return h};a.addParentStage=function(a){b.assert(void 0===h,"Material can only be added to a single Stage");
h=a};a.removeParentStage=function(a){h=void 0};a.setVisible=function(c){d!==c&&(d=c,a.notifyDirty("matChanged"))};a.isVisible=function(){return d};a.notifyDirty=function(c){h&&h.notifyDirty(q.ContentType.MATERIAL,a,c)};a.setRenderPriority=function(a){f=a;this.notifyDirty("matChanged")};a.getRenderPriority=function(){return f}};l.aquireIfNotUndefined=E;l.releaseIfNotUndefined=c;var M=a.mat4.create();l.bindView=function(c,b,d){a.mat4d.translate(b,c,M);d.setUniform3fv("localOrigin",c);d.setUniformMatrix4fv("view",
M)};l.bindCamPos=function(a,c,b){b.setUniform3f("camPos",c[3]-a[0],c[7]-a[1],c[11]-a[2])};l.bindVerticalOffset=function(a,c,b){if(a){var d=c.fovY;c=c.viewport[3];var f=void 0;void 0===f&&(f=R);f.screenLength=a.screenLength;f.perDistance=Math.tan(.5*d)/(.5*c);f.minWorldLength=a.minWorldLength;f.maxWorldLength=a.maxWorldLength;a=f;b.setUniform4f("verticalOffset",a.screenLength,a.perDistance,a.minWorldLength,a.maxWorldLength)}};l.bindScreenSizePerspective=function(a,c,b){void 0===b&&(b="screenSizePerspectiveAlignment");
if(a){var d=a.parameters;c.setUniform4f(b,d.divisor,d.offset,d.minPixelSize,a.paddingPixelsOverride)}};l.basicGLMaterialConstructor=function(a,c){var b=l.__GLMaterial_id++;a.getId=function(){return b};a.getMaterialId=function(){return c.getId()};a.isVisible=function(){return c.isVisible()};a.getRenderPriority=function(){return c.getRenderPriority()}};l.singleTextureGLMaterialConstructor=function(a,b,d,f){var k=E(d.textureId,d.initTexture,b,f);a.updateTexture=function(a){d.textureId!==a&&(c(d.textureId,
b),d.textureId=a,k=E(d.textureId,d.initTexture,b,f))};a.renderTexture=function(a){(a=b.getTexture(d.textureId))&&a.dirty&&a.redraw&&a.redraw()};a.bindTexture=function(a,c){void 0!==k&&(c.setUniform1i("tex",0),a.bindTexture(k.getGLTexture()))};a.bindTextureSize=function(a,c){void 0!==k&&(a=k.getGLTexture(),c.setUniform2f("texSize",a.descriptor.width,a.descriptor.height))};a.dispose=function(){c(d.textureId,b)}};l.multiTextureGLMaterialConstructor=function(a,b,d,f){for(var k=f.length,h=Array(k),e=0;e<
k;e++)h[e]=E(d[f[e][0]],d[f[e][1]],b);a.updateTextures=function(a){for(var e=0;e<k;e++){var g=d[f[e][0]],m=a[f[e][0]];g!==m&&(c(g,b),d[f[e][0]]=m,h[e]=E(m,d[f[e][1]],b))}};a.bindTextures=function(a,c){for(var e=0;e<k;e++)void 0!==h[e]&&(c.setUniform1i(f[e][2],e),a.bindTexture(h[e].getGLTexture(),e));a.setActiveTexture(0)};a.bindOneTexture=function(a,c,e){c.setUniform1i(f[e][2],e);a.bindTexture(h[e].getGLTexture(),e);a.setActiveTexture(0)};a.disposeTextures=function(){for(var a=0;a<k;a++)c(d[f[a][0]],
b)}};l.copyParameters=D;l.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var R={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}})},"esri/views/3d/webgl-engine/lib/IdGen":function(){define(["require","exports"],function(w,l){return function(){function f(){this._count=0}f.prototype.gen=function(a){null==a&&(a="a");return a+"_"+this._count++};return f}()})},"esri/views/3d/webgl-engine/lib/gl-matrix":function(){define([],function(){var w={};(function(l,f){f(l,!0);f(l,!1)})(w,function(l,
f){var a={};(function(){if("undefined"!=typeof Float32Array){var c=new Float32Array(1),b=new Int32Array(c.buffer);a.invsqrt=function(a){c[0]=a;b[0]=1597463007-(b[0]>>1);var d=c[0];return d*(1.5-.5*a*d*d)}}else a.invsqrt=function(a){return 1/Math.sqrt(a)}})();var d=Array;"undefined"!=typeof Float32Array&&(d=f?Float32Array:Array);var b={create:function(a){var c=new d(3);a?(c[0]=a[0],c[1]=a[1],c[2]=a[2]):c[0]=c[1]=c[2]=0;return c},createFrom:function(a,b,f){var c=new d(3);c[0]=a;c[1]=b;c[2]=f;return c},
set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},set3:function(a,b,d,f){f[0]=a;f[1]=b;f[2]=d;return f},add:function(a,b,d){if(!d||a===d)return a[0]+=b[0],a[1]+=b[1],a[2]+=b[2],a;d[0]=a[0]+b[0];d[1]=a[1]+b[1];d[2]=a[2]+b[2];return d},subtract:function(a,b,d){if(!d||a===d)return a[0]-=b[0],a[1]-=b[1],a[2]-=b[2],a;d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];return d},multiply:function(a,b,d){if(!d||a===d)return a[0]*=b[0],a[1]*=b[1],a[2]*=b[2],a;d[0]=a[0]*b[0];d[1]=a[1]*b[1];d[2]=a[2]*b[2];
return d},max:function(a,b,d){d[0]=Math.max(a[0],b[0]);d[1]=Math.max(a[1],b[1]);d[2]=Math.max(a[2],b[2]);return d},min:function(a,b,d){d[0]=Math.min(a[0],b[0]);d[1]=Math.min(a[1],b[1]);d[2]=Math.min(a[2],b[2]);return d},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];return b},scale:function(a,b,d){if(!d||a===d)return a[0]*=b,a[1]*=b,a[2]*=b,a;d[0]=a[0]*b;d[1]=a[1]*b;d[2]=a[2]*b;return d},normalize:function(a,b){b||(b=a);var c=a[0],d=a[1];a=a[2];var f=Math.sqrt(c*c+d*d+a*a);if(!f)return b[0]=
0,b[1]=0,b[2]=0,b;if(1===f)return b[0]=c,b[1]=d,b[2]=a,b;f=1/f;b[0]=c*f;b[1]=d*f;b[2]=a*f;return b},cross:function(a,b,d){d||(d=a);var c=a[0],f=a[1];a=a[2];var k=b[0],m=b[1];b=b[2];d[0]=f*b-a*m;d[1]=a*k-c*b;d[2]=c*m-f*k;return d},length:function(a){var c=a[0],b=a[1];a=a[2];return Math.sqrt(c*c+b*b+a*a)},length2:function(a){var c=a[0],b=a[1];a=a[2];return c*c+b*b+a*a},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},direction:function(a,b,d){d||(d=a);var c=a[0]-b[0],f=a[1]-b[1];a=a[2]-b[2];
b=Math.sqrt(c*c+f*f+a*a);if(!b)return d[0]=0,d[1]=0,d[2]=0,d;b=1/b;d[0]=c*b;d[1]=f*b;d[2]=a*b;return d},lerp:function(a,b,d,f){f||(f=a);f[0]=a[0]+d*(b[0]-a[0]);f[1]=a[1]+d*(b[1]-a[1]);f[2]=a[2]+d*(b[2]-a[2]);return f},dist:function(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return Math.sqrt(c*c+d*d+a*a)},dist2:function(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return c*c+d*d+a*a}},q=null,t=new d(4);b.unproject=function(a,b,d,f,k){k||(k=a);q||(q=r.create());var c=q;t[0]=2*(a[0]-f[0])/f[2]-1;t[1]=
2*(a[1]-f[1])/f[3]-1;t[2]=2*a[2]-1;t[3]=1;r.multiply(d,b,c);if(!r.inverse(c))return null;r.multiplyVec4(c,t);if(0===t[3])return null;k[0]=t[0]/t[3];k[1]=t[1]/t[3];k[2]=t[2]/t[3];return k};var m=b.createFrom(1,0,0),k=b.createFrom(0,1,0),p=b.createFrom(0,0,1);b.rotationTo=function(a,d,f){f||(f=u.create());var c=b.dot(a,d),r=b.create();if(1<=c)u.set(C,f);else if(-.999999>c)b.cross(m,a,r),1E-6>r.length&&b.cross(k,a,r),1E-6>r.length&&b.cross(p,a,r),b.normalize(r),u.fromAxisAngle(r,Math.PI,f);else{var c=
Math.sqrt(2*(1+c)),v=1/c;b.cross(a,d,r);f[0]=r[0]*v;f[1]=r[1]*v;f[2]=r[2]*v;f[3]=.5*c;u.normalize(f)}1<f[3]?f[3]=1:-1>f[3]&&(f[3]=-1);return f};var x=b.create(),z=b.create();b.project=function(a,d,f,k){k||(k=a);b.direction(d,f,x);b.subtract(a,d,z);a=b.dot(x,z);b.scale(x,a,k);b.add(k,d,k)};b.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+"]"};var v={create:function(a){var c=new d(9);a?(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[8]=a[8]):c[0]=c[1]=c[2]=c[3]=
c[4]=c[5]=c[6]=c[7]=c[8]=0;return c},createFrom:function(a,b,f,k,m,p,r,u,v){var c=new d(9);c[0]=a;c[1]=b;c[2]=f;c[3]=k;c[4]=m;c[5]=p;c[6]=r;c[7]=u;c[8]=v;return c},determinant:function(a){var c=a[3],b=a[4],d=a[5],f=a[6],k=a[7],m=a[8];return a[0]*(m*b-d*k)+a[1]*(-m*c+d*f)+a[2]*(k*c-b*f)},inverse:function(a,b){var c=a[0],d=a[1],f=a[2],k=a[3],m=a[4],p=a[5],r=a[6],u=a[7];a=a[8];var q=a*m-p*u,x=-a*k+p*r,t=u*k-m*r,l=c*q+d*x+f*t;if(!l)return null;l=1/l;b||(b=v.create());b[0]=q*l;b[1]=(-a*d+f*u)*l;b[2]=(p*
d-f*m)*l;b[3]=x*l;b[4]=(a*c-f*r)*l;b[5]=(-p*c+f*k)*l;b[6]=t*l;b[7]=(-u*c+d*r)*l;b[8]=(m*c-d*k)*l;return b},multiply:function(a,b,d){d||(d=a);var c=a[0],f=a[1],k=a[2],m=a[3],p=a[4],r=a[5],u=a[6],v=a[7];a=a[8];var q=b[0],x=b[1],t=b[2],l=b[3],D=b[4],z=b[5],C=b[6],h=b[7];b=b[8];d[0]=q*c+x*m+t*u;d[1]=q*f+x*p+t*v;d[2]=q*k+x*r+t*a;d[3]=l*c+D*m+z*u;d[4]=l*f+D*p+z*v;d[5]=l*k+D*r+z*a;d[6]=C*c+h*m+b*u;d[7]=C*f+h*p+b*v;d[8]=C*k+h*r+b*a;return d},multiplyVec2:function(a,b,d){d||(d=b);var c=b[0];b=b[1];d[0]=c*
a[0]+b*a[3]+a[6];d[1]=c*a[1]+b*a[4]+a[7];return d},multiplyVec3:function(a,b,d){d||(d=b);var c=b[0],f=b[1];b=b[2];d[0]=c*a[0]+f*a[3]+b*a[6];d[1]=c*a[1]+f*a[4]+b*a[7];d[2]=c*a[2]+f*a[5]+b*a[8];return d},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},identity:function(a){a||(a=v.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},transpose:function(a,b){if(!b||a===b){b=a[1];var c=a[2],d=a[5];a[1]=a[3];
a[2]=a[6];a[3]=b;a[5]=a[7];a[6]=c;a[7]=d;return a}b[0]=a[0];b[1]=a[3];b[2]=a[6];b[3]=a[1];b[4]=a[4];b[5]=a[7];b[6]=a[2];b[7]=a[5];b[8]=a[8];return b},toMat4:function(a,b){b||(b=r.create());b[15]=1;b[14]=0;b[13]=0;b[12]=0;b[11]=0;b[10]=a[8];b[9]=a[7];b[8]=a[6];b[7]=0;b[6]=a[5];b[5]=a[4];b[4]=a[3];b[3]=0;b[2]=a[2];b[1]=a[1];b[0]=a[0];return b},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+"]"}},r={create:function(a){var c=new d(16);4===
arguments.length?(c[0]=arguments[0],c[1]=arguments[1],c[2]=arguments[2],c[3]=arguments[3],c[4]=arguments[4],c[5]=arguments[5],c[6]=arguments[6],c[7]=arguments[7],c[8]=arguments[8],c[9]=arguments[9],c[10]=arguments[10],c[11]=arguments[11],c[12]=arguments[12],c[13]=arguments[13],c[14]=arguments[14],c[15]=arguments[15]):a&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);return c},
createFrom:function(a,b,f,k,m,p,r,u,v,q,x,t,l,z,C,E){var c=new d(16);c[0]=a;c[1]=b;c[2]=f;c[3]=k;c[4]=m;c[5]=p;c[6]=r;c[7]=u;c[8]=v;c[9]=q;c[10]=x;c[11]=t;c[12]=l;c[13]=z;c[14]=C;c[15]=E;return c},createFromMatrixRowMajor:function(a){var c=new d(16);c[0]=a[0];c[4]=a[1];c[8]=a[2];c[12]=a[3];c[1]=a[4];c[5]=a[5];c[9]=a[6];c[13]=a[7];c[2]=a[8];c[6]=a[9];c[10]=a[10];c[14]=a[11];c[3]=a[12];c[7]=a[13];c[11]=a[14];c[15]=a[15];return c},createFromMatrix:function(a){var c=new d(16);c[0]=a[0];c[1]=a[1];c[2]=
a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b},setRowMajor:function(a,b){b[0]=a[0];b[4]=a[1];b[8]=a[2];b[12]=a[3];b[1]=a[4];b[5]=a[5];b[9]=a[6];b[13]=a[7];b[2]=a[8];b[6]=a[9];b[10]=a[10];b[14]=
a[11];b[3]=a[12];b[7]=a[13];b[11]=a[14];b[15]=a[15];return b},identity:function(a){a||(a=r.create());a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},transpose:function(a,b){if(!b||a===b){b=a[1];var c=a[2],d=a[3],f=a[6],k=a[7],m=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=b;a[6]=a[9];a[7]=a[13];a[8]=c;a[9]=f;a[11]=a[14];a[12]=d;a[13]=k;a[14]=m;return a}b[0]=a[0];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=a[1];b[5]=a[5];b[6]=a[9];
b[7]=a[13];b[8]=a[2];b[9]=a[6];b[10]=a[10];b[11]=a[14];b[12]=a[3];b[13]=a[7];b[14]=a[11];b[15]=a[15];return b},determinant:function(a){var c=a[0],b=a[1],d=a[2],f=a[3],k=a[4],m=a[5],p=a[6],r=a[7],u=a[8],v=a[9],q=a[10],x=a[11],t=a[12],l=a[13],z=a[14];a=a[15];return t*v*p*f-u*l*p*f-t*m*q*f+k*l*q*f+u*m*z*f-k*v*z*f-t*v*d*r+u*l*d*r+t*b*q*r-c*l*q*r-u*b*z*r+c*v*z*r+t*m*d*x-k*l*d*x-t*b*p*x+c*l*p*x+k*b*z*x-c*m*z*x-u*m*d*a+k*v*d*a+u*b*p*a-c*v*p*a-k*b*q*a+c*m*q*a},inverse:function(a,b){b||(b=a);var c=a[0],d=
a[1],f=a[2],k=a[3],m=a[4],p=a[5],r=a[6],u=a[7],v=a[8],q=a[9],x=a[10],t=a[11],l=a[12],z=a[13],C=a[14];a=a[15];var D=c*p-d*m,h=c*r-f*m,e=c*u-k*m,g=d*r-f*p,n=d*u-k*p,E=f*u-k*r,w=v*z-q*l,N=v*C-x*l,U=v*a-t*l,Y=q*C-x*z,W=q*a-t*z,ca=x*a-t*C,X=D*ca-h*W+e*Y+g*U-n*N+E*w;if(!X)return null;X=1/X;b[0]=(p*ca-r*W+u*Y)*X;b[1]=(-d*ca+f*W-k*Y)*X;b[2]=(z*E-C*n+a*g)*X;b[3]=(-q*E+x*n-t*g)*X;b[4]=(-m*ca+r*U-u*N)*X;b[5]=(c*ca-f*U+k*N)*X;b[6]=(-l*E+C*e-a*h)*X;b[7]=(v*E-x*e+t*h)*X;b[8]=(m*W-p*U+u*w)*X;b[9]=(-c*W+d*U-k*w)*
X;b[10]=(l*n-z*e+a*D)*X;b[11]=(-v*n+q*e-t*D)*X;b[12]=(-m*Y+p*N-r*w)*X;b[13]=(c*Y-d*N+f*w)*X;b[14]=(-l*g+z*h-C*D)*X;b[15]=(v*g-q*h+x*D)*X;return b},toRotationMat:function(a,b){b||(b=r.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b},toMat3:function(a,b){b||(b=v.create());b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[4];b[4]=a[5];b[5]=a[6];b[6]=a[8];b[7]=a[9];b[8]=a[10];return b},toInverseMat3:function(a,
b){var c=a[0],d=a[1],f=a[2],k=a[4],m=a[5],p=a[6],r=a[8],u=a[9];a=a[10];var q=a*m-p*u,x=-a*k+p*r,t=u*k-m*r,l=c*q+d*x+f*t;if(!l)return null;l=1/l;b||(b=v.create());b[0]=q*l;b[1]=(-a*d+f*u)*l;b[2]=(p*d-f*m)*l;b[3]=x*l;b[4]=(a*c-f*r)*l;b[5]=(-p*c+f*k)*l;b[6]=t*l;b[7]=(-u*c+d*r)*l;b[8]=(m*c-d*k)*l;return b},multiply:function(a,b,d){d||(d=a);var c=a[0],f=a[1],k=a[2],m=a[3],p=a[4],r=a[5],u=a[6],v=a[7],q=a[8],x=a[9],t=a[10],l=a[11],z=a[12],C=a[13],B=a[14];a=a[15];var h=b[0],e=b[1],g=b[2],n=b[3],D=b[4],E=
b[5],w=b[6],U=b[7],Y=b[8],W=b[9],ca=b[10],X=b[11],aa=b[12],da=b[13],ea=b[14];b=b[15];d[0]=h*c+e*p+g*q+n*z;d[1]=h*f+e*r+g*x+n*C;d[2]=h*k+e*u+g*t+n*B;d[3]=h*m+e*v+g*l+n*a;d[4]=D*c+E*p+w*q+U*z;d[5]=D*f+E*r+w*x+U*C;d[6]=D*k+E*u+w*t+U*B;d[7]=D*m+E*v+w*l+U*a;d[8]=Y*c+W*p+ca*q+X*z;d[9]=Y*f+W*r+ca*x+X*C;d[10]=Y*k+W*u+ca*t+X*B;d[11]=Y*m+W*v+ca*l+X*a;d[12]=aa*c+da*p+ea*q+b*z;d[13]=aa*f+da*r+ea*x+b*C;d[14]=aa*k+da*u+ea*t+b*B;d[15]=aa*m+da*v+ea*l+b*a;return d},multiplyVec3:function(a,b,d){d||(d=b);var c=b[0],
f=b[1];b=b[2];d[0]=a[0]*c+a[4]*f+a[8]*b+a[12];d[1]=a[1]*c+a[5]*f+a[9]*b+a[13];d[2]=a[2]*c+a[6]*f+a[10]*b+a[14];return d},multiplyVec4:function(a,b,d){d||(d=b);var c=b[0],f=b[1],k=b[2];b=b[3];d[0]=a[0]*c+a[4]*f+a[8]*k+a[12]*b;d[1]=a[1]*c+a[5]*f+a[9]*k+a[13]*b;d[2]=a[2]*c+a[6]*f+a[10]*k+a[14]*b;d[3]=a[3]*c+a[7]*f+a[11]*k+a[15]*b;return d},translate:function(a,b,d){var c=b[0],f=b[1];b=b[2];var k,m,p,r,u,v,q,x,t,l,z,C;if(!d||a===d)return a[12]=a[0]*c+a[4]*f+a[8]*b+a[12],a[13]=a[1]*c+a[5]*f+a[9]*b+a[13],
a[14]=a[2]*c+a[6]*f+a[10]*b+a[14],a[15]=a[3]*c+a[7]*f+a[11]*b+a[15],a;k=a[0];m=a[1];p=a[2];r=a[3];u=a[4];v=a[5];q=a[6];x=a[7];t=a[8];l=a[9];z=a[10];C=a[11];d[0]=k;d[1]=m;d[2]=p;d[3]=r;d[4]=u;d[5]=v;d[6]=q;d[7]=x;d[8]=t;d[9]=l;d[10]=z;d[11]=C;d[12]=k*c+u*f+t*b+a[12];d[13]=m*c+v*f+l*b+a[13];d[14]=p*c+q*f+z*b+a[14];d[15]=r*c+x*f+C*b+a[15];return d},scale:function(a,b,d){var c=b[0],f=b[1];b=b[2];if(!d||a===d)return a[0]*=c,a[1]*=c,a[2]*=c,a[3]*=c,a[4]*=f,a[5]*=f,a[6]*=f,a[7]*=f,a[8]*=b,a[9]*=b,a[10]*=
b,a[11]*=b,a;d[0]=a[0]*c;d[1]=a[1]*c;d[2]=a[2]*c;d[3]=a[3]*c;d[4]=a[4]*f;d[5]=a[5]*f;d[6]=a[6]*f;d[7]=a[7]*f;d[8]=a[8]*b;d[9]=a[9]*b;d[10]=a[10]*b;d[11]=a[11]*b;d[12]=a[12];d[13]=a[13];d[14]=a[14];d[15]=a[15];return d},maxScale:function(a){return Math.max(Math.max(Math.sqrt(a[0]*a[0]+a[4]*a[4]+a[8]*a[8]),Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])),Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))},rotate:function(a,b,d,f){var c=d[0],k=d[1];d=d[2];var m=Math.sqrt(c*c+k*k+d*d),p,r,u,v,q,x,t,l,z,C,B,h,e,g,n,
D,E,I,w,Y;if(!m)return null;1!==m&&(m=1/m,c*=m,k*=m,d*=m);p=Math.sin(b);r=Math.cos(b);u=1-r;b=a[0];m=a[1];v=a[2];q=a[3];x=a[4];t=a[5];l=a[6];z=a[7];C=a[8];B=a[9];h=a[10];e=a[11];g=c*c*u+r;n=k*c*u+d*p;D=d*c*u-k*p;E=c*k*u-d*p;I=k*k*u+r;w=d*k*u+c*p;Y=c*d*u+k*p;c=k*d*u-c*p;k=d*d*u+r;f?a!==f&&(f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]):f=a;f[0]=b*g+x*n+C*D;f[1]=m*g+t*n+B*D;f[2]=v*g+l*n+h*D;f[3]=q*g+z*n+e*D;f[4]=b*E+x*I+C*w;f[5]=m*E+t*I+B*w;f[6]=v*E+l*I+h*w;f[7]=q*E+z*I+e*w;f[8]=b*Y+x*c+C*k;f[9]=
m*Y+t*c+B*k;f[10]=v*Y+l*c+h*k;f[11]=q*Y+z*c+e*k;return f},rotateX:function(a,b,d){var c=Math.sin(b);b=Math.cos(b);var f=a[4],k=a[5],m=a[6],p=a[7],r=a[8],u=a[9],v=a[10],q=a[11];d?a!==d&&(d[0]=a[0],d[1]=a[1],d[2]=a[2],d[3]=a[3],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[4]=f*b+r*c;d[5]=k*b+u*c;d[6]=m*b+v*c;d[7]=p*b+q*c;d[8]=f*-c+r*b;d[9]=k*-c+u*b;d[10]=m*-c+v*b;d[11]=p*-c+q*b;return d},rotateY:function(a,b,d){var c=Math.sin(b);b=Math.cos(b);var f=a[0],k=a[1],m=a[2],p=a[3],r=a[8],u=a[9],
v=a[10],q=a[11];d?a!==d&&(d[4]=a[4],d[5]=a[5],d[6]=a[6],d[7]=a[7],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=f*b+r*-c;d[1]=k*b+u*-c;d[2]=m*b+v*-c;d[3]=p*b+q*-c;d[8]=f*c+r*b;d[9]=k*c+u*b;d[10]=m*c+v*b;d[11]=p*c+q*b;return d},rotateZ:function(a,b,d){var c=Math.sin(b);b=Math.cos(b);var f=a[0],k=a[1],m=a[2],p=a[3],r=a[4],u=a[5],v=a[6],q=a[7];d?a!==d&&(d[8]=a[8],d[9]=a[9],d[10]=a[10],d[11]=a[11],d[12]=a[12],d[13]=a[13],d[14]=a[14],d[15]=a[15]):d=a;d[0]=f*b+r*c;d[1]=k*b+u*c;d[2]=m*b+v*c;
d[3]=p*b+q*c;d[4]=f*-c+r*b;d[5]=k*-c+u*b;d[6]=m*-c+v*b;d[7]=p*-c+q*b;return d},frustum:function(a,b,d,f,k,m,p){p||(p=r.create());var c=b-a,u=f-d,v=m-k;p[0]=2*k/c;p[1]=0;p[2]=0;p[3]=0;p[4]=0;p[5]=2*k/u;p[6]=0;p[7]=0;p[8]=(b+a)/c;p[9]=(f+d)/u;p[10]=-(m+k)/v;p[11]=-1;p[12]=0;p[13]=0;p[14]=-(m*k*2)/v;p[15]=0;return p},perspective:function(a,b,d,f,k){a=d*Math.tan(a*Math.PI/360);b*=a;return r.frustum(-b,b,-a,a,d,f,k)},ortho:function(a,b,d,f,k,m,p){p||(p=r.create());var c=b-a,u=f-d,v=m-k;p[0]=2/c;p[1]=0;
p[2]=0;p[3]=0;p[4]=0;p[5]=2/u;p[6]=0;p[7]=0;p[8]=0;p[9]=0;p[10]=-2/v;p[11]=0;p[12]=-(a+b)/c;p[13]=-(f+d)/u;p[14]=-(m+k)/v;p[15]=1;return p},lookAt:function(a,b,d,f){f||(f=r.create());var c,k,m,p,u,v,q,x,t=a[0],l=a[1];a=a[2];m=d[0];p=d[1];k=d[2];q=b[0];d=b[1];c=b[2];if(t===q&&l===d&&a===c)return r.identity(f);b=t-q;d=l-d;q=a-c;x=1/Math.sqrt(b*b+d*d+q*q);b*=x;d*=x;q*=x;c=p*q-k*d;k=k*b-m*q;m=m*d-p*b;(x=Math.sqrt(c*c+k*k+m*m))?(x=1/x,c*=x,k*=x,m*=x):m=k=c=0;p=d*m-q*k;u=q*c-b*m;v=b*k-d*c;(x=Math.sqrt(p*
p+u*u+v*v))?(x=1/x,p*=x,u*=x,v*=x):v=u=p=0;f[0]=c;f[1]=p;f[2]=b;f[3]=0;f[4]=k;f[5]=u;f[6]=d;f[7]=0;f[8]=m;f[9]=v;f[10]=q;f[11]=0;f[12]=-(c*t+k*l+m*a);f[13]=-(p*t+u*l+v*a);f[14]=-(b*t+d*l+q*a);f[15]=1;return f},fromRotationTranslation:function(a,b,d){d||(d=r.create());var c=a[0],f=a[1],k=a[2],m=a[3],p=c+c,u=f+f,v=k+k;a=c*p;var q=c*u,c=c*v,x=f*u,f=f*v,k=k*v,p=m*p,u=m*u,m=m*v;d[0]=1-(x+k);d[1]=q+m;d[2]=c-u;d[3]=0;d[4]=q-m;d[5]=1-(a+k);d[6]=f+p;d[7]=0;d[8]=c+u;d[9]=f-p;d[10]=1-(a+x);d[11]=0;d[12]=b[0];
d[13]=b[1];d[14]=b[2];d[15]=1;return d},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+"]"}},u={create:function(a){var c=new d(4);a?(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3]):c[0]=c[1]=c[2]=c[3]=0;return c},createFrom:function(a,b,f,k){var c=new d(4);c[0]=a;c[1]=b;c[2]=f;c[3]=k;return c},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},identity:function(a){a||
(a=u.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}},C=u.identity();u.calculateW=function(a,b){var c=a[0],d=a[1],f=a[2];if(!b||a===b)return a[3]=-Math.sqrt(Math.abs(1-c*c-d*d-f*f)),a;b[0]=c;b[1]=d;b[2]=f;b[3]=-Math.sqrt(Math.abs(1-c*c-d*d-f*f));return b};u.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};u.inverse=function(a,b){var c=a[0],d=a[1],f=a[2],k=a[3],c=(c=c*c+d*d+f*f+k*k)?1/c:0;if(!b||a===b)return a[0]*=-c,a[1]*=-c,a[2]*=-c,a[3]*=c,a;b[0]=-a[0]*c;b[1]=-a[1]*c;b[2]=-a[2]*
c;b[3]=a[3]*c;return b};u.conjugate=function(a,b){if(!b||a===b)return a[0]*=-1,a[1]*=-1,a[2]*=-1,a;b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=a[3];return b};u.length=function(a){var c=a[0],b=a[1],d=a[2];a=a[3];return Math.sqrt(c*c+b*b+d*d+a*a)};u.normalize=function(a,b){b||(b=a);var c=a[0],d=a[1],f=a[2];a=a[3];var k=Math.sqrt(c*c+d*d+f*f+a*a);if(0===k)return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b;k=1/k;b[0]=c*k;b[1]=d*k;b[2]=f*k;b[3]=a*k;return b};u.add=function(a,b,d){if(!d||a===d)return a[0]+=b[0],a[1]+=b[1],
a[2]+=b[2],a[3]+=b[3],a;d[0]=a[0]+b[0];d[1]=a[1]+b[1];d[2]=a[2]+b[2];d[3]=a[3]+b[3];return d};u.multiply=function(a,b,d){d||(d=a);var c=a[0],f=a[1],k=a[2];a=a[3];var m=b[0],p=b[1],r=b[2];b=b[3];d[0]=c*b+a*m+f*r-k*p;d[1]=f*b+a*p+k*m-c*r;d[2]=k*b+a*r+c*p-f*m;d[3]=a*b-c*m-f*p-k*r;return d};u.multiplyVec3=function(a,b,d){d||(d=b);var c=b[0],f=b[1],k=b[2];b=a[0];var m=a[1],p=a[2];a=a[3];var r=a*c+m*k-p*f,u=a*f+p*c-b*k,v=a*k+b*f-m*c,c=-b*c-m*f-p*k;d[0]=r*a+c*-b+u*-p-v*-m;d[1]=u*a+c*-m+v*-b-r*-p;d[2]=v*
a+c*-p+r*-m-u*-b;return d};u.scale=function(a,b,d){if(!d||a===d)return a[0]*=b,a[1]*=b,a[2]*=b,a[3]*=b,a;d[0]=a[0]*b;d[1]=a[1]*b;d[2]=a[2]*b;d[3]=a[3]*b;return d};u.toMat3=function(a,b){b||(b=v.create());var c=a[0],d=a[1],f=a[2],k=a[3],m=c+c,p=d+d,r=f+f;a=c*m;var u=c*p,c=c*r,q=d*p,d=d*r,f=f*r,m=k*m,p=k*p,k=k*r;b[0]=1-(q+f);b[1]=u+k;b[2]=c-p;b[3]=u-k;b[4]=1-(a+f);b[5]=d+m;b[6]=c+p;b[7]=d-m;b[8]=1-(a+q);return b};u.toMat4=function(a,b){b||(b=r.create());var c=a[0],d=a[1],f=a[2],k=a[3],m=c+c,p=d+d,u=
f+f;a=c*m;var v=c*p,c=c*u,q=d*p,d=d*u,f=f*u,m=k*m,p=k*p,k=k*u;b[0]=1-(q+f);b[1]=v+k;b[2]=c-p;b[3]=0;b[4]=v-k;b[5]=1-(a+f);b[6]=d+m;b[7]=0;b[8]=c+p;b[9]=d-m;b[10]=1-(a+q);b[11]=0;b[12]=0;b[13]=0;b[14]=0;b[15]=1;return b};u.slerp=function(a,b,d,f){f||(f=a);var c=a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3],k,m;if(1<=Math.abs(c))return f!==a&&(f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3]),f;k=Math.acos(c);m=Math.sqrt(1-c*c);if(.001>Math.abs(m))return f[0]=.5*a[0]+.5*b[0],f[1]=.5*a[1]+.5*b[1],f[2]=.5*a[2]+.5*b[2],
f[3]=.5*a[3]+.5*b[3],f;c=Math.sin((1-d)*k)/m;d=Math.sin(d*k)/m;f[0]=a[0]*c+b[0]*d;f[1]=a[1]*c+b[1]*d;f[2]=a[2]*c+b[2]*d;f[3]=a[3]*c+b[3]*d;return f};u.fromRotationMatrix=function(a,b){b||(b=u.create());var c=a[0]+a[4]+a[8],d;if(0<c)d=Math.sqrt(c+1),b[3]=.5*d,d=.5/d,b[0]=(a[7]-a[5])*d,b[1]=(a[2]-a[6])*d,b[2]=(a[3]-a[1])*d;else{d=u.fromRotationMatrix.s_iNext=u.fromRotationMatrix.s_iNext||[1,2,0];c=0;a[4]>a[0]&&(c=1);a[8]>a[3*c+c]&&(c=2);var f=d[c],k=d[f];d=Math.sqrt(a[3*c+c]-a[3*f+f]-a[3*k+k]+1);b[c]=
.5*d;d=.5/d;b[3]=(a[3*k+f]-a[3*f+k])*d;b[f]=(a[3*f+c]+a[3*c+f])*d;b[k]=(a[3*k+c]+a[3*c+k])*d}return b};v.toQuat4=u.fromRotationMatrix;(function(){var a=v.create();u.fromAxes=function(c,b,d,f){a[0]=b[0];a[3]=b[1];a[6]=b[2];a[1]=d[0];a[4]=d[1];a[7]=d[2];a[2]=c[0];a[5]=c[1];a[8]=c[2];return u.fromRotationMatrix(a,f)}})();u.identity=function(a){a||(a=u.create());a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};u.fromAngleAxis=function(a,b,d){d||(d=u.create());a*=.5;var c=Math.sin(a);d[3]=Math.cos(a);d[0]=c*b[0];
d[1]=c*b[1];d[2]=c*b[2];return d};u.toAngleAxis=function(c,b){b||(b=c);var d=c[0]*c[0]+c[1]*c[1]+c[2]*c[2];0<d?(b[3]=2*Math.acos(c[3]),d=a.invsqrt(d),b[0]=c[0]*d,b[1]=c[1]*d,b[2]=c[2]*d):(b[3]=0,b[0]=1,b[1]=0,b[2]=0);return b};u.str=function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"};var E={create:function(a){var c=new d(4);a?(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3]):c[0]=c[1]=c[2]=c[3]=0;return c},createFrom:function(a,b,f,k){var c=new d(4);c[0]=a;c[1]=b;c[2]=f;c[3]=k;return c},set:function(a,
b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},identity:function(a){a||(a=E.create());a[0]=1;a[1]=0;a[2]=0;a[3]=1;return a},transpose:function(a,b){if(!b||a===b)return b=a[1],a[1]=a[2],a[2]=b,a;b[0]=a[0];b[1]=a[2];b[2]=a[1];b[3]=a[3];return b},determinant:function(a){return a[0]*a[3]-a[2]*a[1]},inverse:function(a,b){b||(b=a);var c=a[0],d=a[1],f=a[2];a=a[3];var k=c*a-f*d;if(!k)return null;k=1/k;b[0]=a*k;b[1]=-d*k;b[2]=-f*k;b[3]=c*k;return b},multiply:function(a,b,d){d||(d=a);var c=a[0],f=a[1],
k=a[2];a=a[3];d[0]=c*b[0]+f*b[2];d[1]=c*b[1]+f*b[3];d[2]=k*b[0]+a*b[2];d[3]=k*b[1]+a*b[3];return d},rotate:function(a,b,d){d||(d=a);var c=a[0],f=a[1],k=a[2];a=a[3];var m=Math.sin(b);b=Math.cos(b);d[0]=c*b+f*m;d[1]=c*-m+f*b;d[2]=k*b+a*m;d[3]=k*-m+a*b;return d},multiplyVec2:function(a,b,d){d||(d=b);var c=b[0];b=b[1];d[0]=c*a[0]+b*a[1];d[1]=c*a[2]+b*a[3];return d},scale:function(a,b,d){d||(d=a);var c=a[1],f=a[2],k=a[3],m=b[0];b=b[1];d[0]=a[0]*m;d[1]=c*b;d[2]=f*m;d[3]=k*b;return d},str:function(a){return"["+
a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}};f=f?"":"d";l["glMath"+f]=a;l["vec2"+f]={create:function(a){var c=new d(2);a?(c[0]=a[0],c[1]=a[1]):(c[0]=0,c[1]=0);return c},createFrom:function(a,b){var c=new d(2);c[0]=a;c[1]=b;return c},add:function(a,b,d){d||(d=b);d[0]=a[0]+b[0];d[1]=a[1]+b[1];return d},subtract:function(a,b,d){d||(d=b);d[0]=a[0]-b[0];d[1]=a[1]-b[1];return d},multiply:function(a,b,d){d||(d=b);d[0]=a[0]*b[0];d[1]=a[1]*b[1];return d},divide:function(a,b,d){d||(d=b);d[0]=a[0]/b[0];d[1]=a[1]/
b[1];return d},scale:function(a,b,d){d||(d=a);d[0]=a[0]*b;d[1]=a[1]*b;return d},dist:function(a,b){var c=b[0]-a[0];a=b[1]-a[1];return Math.sqrt(c*c+a*a)},dist2:function(a,b){var c=b[0]-a[0];a=b[1]-a[1];return c*c+a*a},set:function(a,b){b[0]=a[0];b[1]=a[1];return b},set2:function(a,b,d){d[0]=a;d[1]=b;return d},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];return b},normalize:function(a,b){b||(b=a);var c=a[0]*a[0]+a[1]*a[1];0<c?(c=Math.sqrt(c),b[0]=a[0]/c,b[1]=a[1]/c):b[0]=b[1]=0;return b},cross:function(a,
b,d){a=a[0]*b[1]-a[1]*b[0];if(!d)return a;d[0]=d[1]=0;d[2]=a;return d},length:function(a){var c=a[0];a=a[1];return Math.sqrt(c*c+a*a)},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]},direction:function(a,b,d){d||(d=a);var c=a[0]-b[0];a=a[1]-b[1];b=c*c+a*a;if(!b)return d[0]=0,d[1]=0,d[2]=0,d;b=1/Math.sqrt(b);d[0]=c*b;d[1]=a*b;return d},lerp:function(a,b,d,f){f||(f=a);f[0]=a[0]+d*(b[0]-a[0]);f[1]=a[1]+d*(b[1]-a[1]);return f},str:function(a){return"["+a[0]+", "+a[1]+"]"}};l["vec3"+f]=b;l["vec4"+f]={create:function(a){var c=
new d(4);a?(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3]):(c[0]=0,c[1]=0,c[2]=0,c[3]=0);return c},createFrom:function(a,b,f,k){var c=new d(4);c[0]=a;c[1]=b;c[2]=f;c[3]=k;return c},add:function(a,b,d){d||(d=b);d[0]=a[0]+b[0];d[1]=a[1]+b[1];d[2]=a[2]+b[2];d[3]=a[3]+b[3];return d},subtract:function(a,b,d){d||(d=b);d[0]=a[0]-b[0];d[1]=a[1]-b[1];d[2]=a[2]-b[2];d[3]=a[3]-b[3];return d},multiply:function(a,b,d){d||(d=b);d[0]=a[0]*b[0];d[1]=a[1]*b[1];d[2]=a[2]*b[2];d[3]=a[3]*b[3];return d},divide:function(a,b,
d){d||(d=b);d[0]=a[0]/b[0];d[1]=a[1]/b[1];d[2]=a[2]/b[2];d[3]=a[3]/b[3];return d},scale:function(a,b,d){d||(d=a);d[0]=a[0]*b;d[1]=a[1]*b;d[2]=a[2]*b;d[3]=a[3]*b;return d},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},set:function(a,b){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},set4:function(a,b,d,f,k){k[0]=a;k[1]=b;k[2]=d;k[3]=f;return k},negate:function(a,b){b||(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b},lerp:function(a,b,d,f){f||(f=a);f[0]=a[0]+d*(b[0]-
a[0]);f[1]=a[1]+d*(b[1]-a[1]);f[2]=a[2]+d*(b[2]-a[2]);f[3]=a[3]+d*(b[3]-a[3]);return f},str:function(a){return"["+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+"]"}};l["mat2"+f]=E;l["mat3"+f]=v;l["mat4"+f]=r;l["quat4"+f]=u});return w})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["require","exports"],function(w,l){function f(a,b){if(null!=a){var d=a.isVisibleBit,c=a.data,f=8*c.BYTES_PER_ELEMENT;return b<c.length*f?x(d,c,b,f):!a.isVisibleBit}return!0}function a(a){return null===a.component?
-1:a.component}function d(a,d,k,c,m){f(d,c)&&b(a,d,k,k[c],k[c+1]-1,m)}function b(a,b,d,c,f,k){d=(b=0<a.length?a[a.length-1]:null)?b.range[1]:-1;var m=b?b.options:null;d>=c||(d+1===c&&m===k?b.range[1]=f:a.push({range:[c,f],options:k}))}function q(a){void 0===a&&(a=!0);return{isVisibleBit:!a,data:new Uint32Array(0)}}function t(a,b){return k(a,b,!0)}function m(a,b){return k(a,b,!1)}function k(a,b,d){var c=!1;a=a||v;c=a.isVisibleBit;a=a.data;b=z(b);var f=8*a.BYTES_PER_ELEMENT,k=a.length*f;d=d===c;if(0===
a.length||0===b)c=!d;else if(k<b&&!d)c=!0;else{for(var m=r[f],k=r[0],p=0;p<a.length-1;p++)if(c=!d&&a[p]!==m||d&&a[p]!==k)return c;c=a.length-1;b=r[(b-1)%f+1];c=!d&&(a[c]&b)!==b||d&&(a[c]&b)!==k}return c}function p(a){return 0<a.length}function x(a,b,d,c){var f=d/c|0;return 0!==(b[f]&1<<d-f*c)===a}function z(a){return Math.max(0,a.length-1)}Object.defineProperty(l,"__esModule",{value:!0});l.updateVisibility=function(a,b,d,c){if(d<z(b)){null==a&&(a=q());var f=a.isVisibleBit,k=a.data,m=8*k.BYTES_PER_ELEMENT,
p=d/m|0,r=d-m*p;b=(z(b)-1)/m|0;var u=k;c=c===f;d<u.length*m||!c||(d=Math.max(p+1,Math.ceil(1.5*u.length)),d=Math.min(d,b+1),k=new Uint32Array(d),k.set(u));p<k.length&&(k[p]=k[p]&~(1<<r)|(c?1:0)<<r);a.data=k}return a};l.getVisibility=f;l.hideAllComponents=function(a){if(null==a)a=q(!1);else{a.isVisibleBit=!0;for(var b=0;b<a.data.length;b++)a.data[b]=0}return a};l.unhideAllComponents=function(a){var b;if(null!=a)for(b=a,b.isVisibleBit=!1,a=0;a<b.data.length;a++)b.data[a]=0;return b};l.generateVisibleIndexRanges=
function(a,b){var d;if(a)if(p(b))if(0===a.data.length)d=[],b=[[b[0],b[b.length-1]-1]],d=a.isVisibleBit?d:b;else{d=[];for(var c=a.isVisibleBit,f=a.data,k=8*f.BYTES_PER_ELEMENT,m=f.length*k,r=z(b),u=!1,v=0;v<m&&v<r;v++){var q=x(c,f,v,k);if(q!==u){var t=b[v];q?d.push([t,0]):(u=d[d.length-1],u[1]=t-1);u=q}}a=!a.isVisibleBit;r>m&&a&&!u?d.push([b[m],b[r]-1]):u&&(u=d[d.length-1],u[1]=b[a?r:Math.min(r,m)]-1)}else d=[],d=a.isVisibleBit?d:null;else d=null;return d};l.addHighlight=function(b,d,f,c){b=b||[];
d={component:d,options:f,id:c};b.push(d);d=a(d);for(f=b.length-1;0<f&&d<a(b[f-1]);)c=[b[f],b[f-1]],b[f-1]=c[0],b[f]=c[1],--f;return b};l.removeHighlight=function(a,b){return a?(a=a.filter(function(a){return a.id!==b}),0===a.length?null:a):a};l.generateHighlightedIndexRanges=function(a,f,k){if(f){if(p(k)){for(var c=k[0],r=k[k.length-1]-1,u=[],v=!m(a,k),q=0;q<f.length;++q){var x=f[q].options,t=f[q].component;if(null!==t)d(u,a,k,t,x);else if(v)b(u,a,k,c,r,x);else for(t=0;t<z(k);++t)d(u,a,k,t,x)}return 0<
u.length?u:null}var v=!a||!a.isVisibleBit;return v?f.map(function(a){return{range:null,options:a.options}}):null}return null};l.defaultVisibilities=q;l.isAllVisible=function(a,b){return!m(a,b)};l.isAllHidden=function(a,b){return!t(a,b)};l.hasVisible=t;l.hasHidden=m;var v=q();l.createOffsets=function(a){return Array.isArray(a)?new Uint32Array(a):a};l.hasComponent=function(a,b){return b<z(a)};l.hasComponents=p;var r=[];for(w=0;65>w;w++)r.push(Math.pow(2,w)-1);l.componentCount=z})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["require",
"exports","./gl-matrix"],function(w,l,f){function a(a,c){if(!a)throw a=Error("dummy"),a.stack&&console.log(a.stack),new Q(c);}function d(a,c,b){return a<c?c:a>b?b:a}function b(a){return a/180*Math.PI}function q(a){return 180*a/Math.PI}function t(a,c,b){f.mat4d.multiply(c,a,z);f.mat4d.inverse(z);for(a=0;8>a;++a)f.mat4d.multiplyVec4(z,v[a],r),f.vec3d.set3(r[0]/r[3],r[1]/r[3],r[2]/r[3],b[a])}function m(a,c,b,d){f.vec3d.subtract(a,c,C);f.vec3d.subtract(b,c,E);f.vec3d.cross(E,C,d);f.vec3d.normalize(d);
d[3]=-f.vec3d.dot(d,a)}function k(a,c,b,d){var h=6378137/Math.sqrt(1-l.ECCENTRICITY_SQUARED*Math.pow(Math.sin(a),2)),e=Math.cos(a);d[0]=(h+b)*Math.cos(c)*e;d[1]=(h*(1-l.ECCENTRICITY_SQUARED)+b)*Math.sin(a);d[2]=-(h+b)*Math.sin(c)*e}function p(a){for(var c in a)return c}function x(a,c){a[12]=c[0];a[13]=c[1];a[14]=c[2]}Object.defineProperty(l,"__esModule",{value:!0});var z=f.mat4d.create(),v=[f.vec4d.createFrom(-1,-1,-1,1),f.vec4d.createFrom(1,-1,-1,1),f.vec4d.createFrom(1,1,-1,1),f.vec4d.createFrom(-1,
1,-1,1),f.vec4d.createFrom(-1,-1,1,1),f.vec4d.createFrom(1,-1,1,1),f.vec4d.createFrom(1,1,1,1),f.vec4d.createFrom(-1,1,1,1)],r=f.vec4d.create(),u=[f.vec3d.create(),f.vec3d.create(),f.vec3d.create(),f.vec3d.create(),f.vec3d.create(),f.vec3d.create(),f.vec3d.create(),f.vec3d.create()],C=f.vec3d.create(),E=f.vec3d.create(),c=f.vec3d.create(),D=f.vec3d.create(),B=f.vec3d.create(),I=f.vec3d.create(),G=f.vec3d.create(),H=f.vec3d.create(),K=f.vec3d.create(),J=f.vec3d.create(),P=f.vec3d.create(),O=f.vec3d.create(),
L=f.vec3d.create(),M=f.vec3d.create(),R=f.vec3d.createFrom(0,0,0),Q=function(){function a(a){this.message=a}a.prototype.toString=function(){return"AssertException: "+this.message};return a}();l.AssertException=Q;l.EARTH_RADIUS=6378137;l.METER2FEET=3.28084;l.ECCENTRICITY_SQUARED=.0066943799901414;l.VertexAttrConstants={POSITION:"position",NORMAL:"normal",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region"};l.assert=a;l.verify=function(a,
c){a||(console.log("Verify failed: "+c),console.log(Error("dummy").stack))};l.createQuadVertexUvBuffer=function(a){void 0===a&&(a=Float32Array);a=new a(20);a[0]=-1;a[1]=-1;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=-1;a[7]=0;a[8]=1;a[9]=0;a[10]=-1;a[11]=1;a[12]=0;a[13]=0;a[14]=1;a[15]=1;a[16]=1;a[17]=0;a[18]=1;a[19]=1;return a};l.isPowerOfTwo=function(a){return 0===(a&a-1)};l.lerp=function(a,c,b){return a+(c-a)*b};l.clamp=d;l.fallbackIfUndefined=function(a,c){return void 0===a?c:a};l.hex2rgb=function(a){a=
Math.floor(a);return[(a>>16&255)/255,(a>>8&255)/255,(a&255)/255]};l.rgb2hex=function(a){var c=d(Math.round(255*a[0]),0,255),b=d(Math.round(255*a[1]),0,255);a=d(Math.round(255*a[2]),0,255);return"0x"+((c<<16)+(b<<8)+a).toString(16)};l.dec2hex=function(a){a=a.toString(16);return"00000000".substr(0,8-a.length)+a};l.deg2rad=b;l.rad2deg=q;l.azimuthElevationAngle2Direction=function(a,c){a=1.5*Math.PI-a;c=.5*Math.PI-c;return[Math.cos(a)*Math.sin(c),Math.cos(c),Math.sin(a)*Math.sin(c)]};l.rayPlane=function(a,
c,b,d){var h=f.vec3d.dot(b,c);if(0===h)return!1;b=-(f.vec3d.dot(b,a)+b[3])/h;f.vec3d.add(a,f.vec3d.scale(c,b,d),d);return!0};l.raySphere=function(a,c,b,d,h){b=b||R;var e=f.vec3d.subtract(a,b,C);b=f.vec3d.dot(c,c);var g=2*f.vec3d.dot(c,e);d=f.vec3d.dot(e,e)-d*d;d=g*g-4*b*d;if(0>d)return!1;e=Math.sqrt(d);d=(-g-e)/(2*b);b=(-g+e)/(2*b);if(0>d||b<d&&0<b)d=b;return 0<d?(f.vec3d.add(a,f.vec3d.scale(c,d,h),h),!0):!1};l.rayTriangle3D=function(a,c,b,d,h,e,g,k,m){void 0===m&&(m=f.vec3d.create());var p=d[g]-
b[e],r=d[g+1]-b[e+1],n=d[g+2]-b[e+2];d=h[k]-b[e];g=h[k+1]-b[e+1];h=h[k+2]-b[e+2];var u=c[1]*h-g*c[2],v=c[2]*d-h*c[0],q=c[0]*g-d*c[1];k=p*u+r*v+n*q;if(-1E-5<k&&1E-5>k)return!1;k=1/k;var x=a[0]-b[e],t=a[1]-b[e+1];a=a[2]-b[e+2];m[1]=k*(x*u+t*v+a*q);if(0>m[1]||1<m[1])return!1;b=t*n-r*a;a=a*p-n*x;p=x*r-p*t;m[2]=k*(c[0]*b+c[1]*a+c[2]*p);if(0>m[2]||1<m[1]+m[2])return!1;m[0]=k*(d*b+g*a+h*p);return!0};l.rayBoxTest=function(a,c,b,d){var h,e=(b[0]-a[0])/c[0],g=(d[0]-a[0])/c[0];e>g&&(h=e,e=g,g=h);var f=(b[1]-
a[1])/c[1],k=(d[1]-a[1])/c[1];f>k&&(h=f,f=k,k=h);if(e>k||f>g)return!1;f>e&&(e=f);k<g&&(g=k);b=(b[2]-a[2])/c[2];a=(d[2]-a[2])/c[2];b>a&&(h=b,b=a,a=h);if(e>a||b>g)return!1;a<g&&(g=a);return 0>g?!1:!0};l.rayRay2D=function(a,c,b,d,h,e){void 0===e&&(e=f.vec2d.create());var g=(d[h]-b[h])*(c[0]-a[0])-(d[0]-b[0])*(c[h]-a[h]);if(0===g)return!1;b=((d[0]-b[0])*(a[h]-b[h])-(d[h]-b[h])*(a[0]-b[0]))/g;e[0]=a[0]+b*(c[0]-a[0]);e[1]=a[h]+b*(c[h]-a[h]);return!0};l.matrix2frustum=t;l.matrix2frustumPlanes=function(a,
c,b,d){void 0===d&&(d=b,b=u);t(a,c,b);m(b[4],b[0],b[3],d[0]);m(b[1],b[5],b[6],d[1]);m(b[4],b[5],b[1],d[2]);m(b[3],b[2],b[6],d[3]);m(b[0],b[1],b[2],d[4]);m(b[5],b[4],b[7],d[5])};l.point2plane=m;l.project=function(c,b,d,k,h){h||(h=c);r[0]=c[0];r[1]=c[1];r[2]=c[2];r[3]=1;f.mat4d.multiplyVec4(b,r);2<h.length&&(h[2]=-r[2]);f.mat4d.multiplyVec4(d,r);a(0!==r[3]);h[0]=r[0]/r[3];h[1]=r[1]/r[3];h[2]=r[2]/r[3];h[0]=(.5*h[0]+.5)*k[2]+k[0];h[1]=(.5*h[1]+.5)*k[3]+k[1]};l.geodeticToGeocentricLatidude=function(a){return Math.atan((1-
l.ECCENTRICITY_SQUARED)*Math.tan(a))};l.latLon2positionWGS84Ellipsoid=k;l.pos2latLon=function(a,c){var b=f.vec3d.length(a);c[0]=Math.asin(d(a[1]/b,-1,1));c[1]=(0>a[2]?1:-1)*Math.acos(d(a[0]/(Math.cos(c[0])*b),-1,1));c[0]=q(c[0]);c[1]=q(c[1]);c[2]=b};l.pos2latLonWGS84Ellipsoid=function(a,c){var b=a[0],d=-a[2],h=a[1],e=Math.sqrt(Math.pow(6378137,2)*(1-l.ECCENTRICITY_SQUARED));a=Math.sqrt(Math.pow(b,2)+Math.pow(d,2));var g=Math.atan2(6378137*h,e*a),b=Math.atan2(d,b),d=Math.atan2(h+Math.pow(Math.sqrt((Math.pow(6378137,
2)-Math.pow(e,2))/Math.pow(e,2)),2)*e*Math.pow(Math.sin(g),3),a-6378137*l.ECCENTRICITY_SQUARED*Math.pow(Math.cos(g),3));a=a/Math.cos(d)-6378137/Math.sqrt(1-l.ECCENTRICITY_SQUARED*Math.pow(Math.sin(d),2))+l.EARTH_RADIUS;c[0]=d;c[1]=b;c[2]=a};l.computeGlobeTransformation=function(a,d,m){var p=b(a[0]);a=b(a[1]);k(p,a,d,c);f.mat4d.translate(m,c);f.mat4d.rotateY(m,.5*Math.PI+a);f.mat4d.rotateX(m,.5*Math.PI-p);return m};l.readUInt16=function(a,c){return a[c]+(a[c+1]<<8)};l.readUInt32=function(a,c){return a[c]+
(a[c+1]<<8)+(a[c+2]<<16)+(a[c+3]<<24)};l.setIfDefined=function(a,c,b){void 0!==c[a]&&(b[a]=c[a])};l.array2object=function(a,c){var b={};if(void 0!==c)for(var d=0;d<a.length;d++){var h=a[d];b[c(h)]=h}else for(c=0;c<a.length;c++)h=a[c],b[h]=h;return b};l.object2array=function(a){var c=[],b;for(b in a)c.push(a[b]);return c};l.mergeObjects=function(a,c,b){void 0===b&&(b={});if(b!==a)for(var d in a)b[d]=a[d];if(b!==c)for(var h in c)b[h]=c[h];return b};l.subtractObjects=function(a,c){var b={},d;for(d in a)void 0===
c[d]&&(b[d]=a[d]);return b};l.intersectObjects=function(a,c){var b={},d;for(d in a)void 0!==c[d]&&(b[d]=a[d]);return b};l.getFirstObjectKey=p;l.getFirstObjectValue=function(a){return a[p(a)]};l.objectEmpty=function(a){for(var c in a)return!1;return!0};l.arraysEqual=function(a,c){if(a.length!==c.length)return!1;for(var b=0,d=a.length;b<d;++b)if(a[b]!==c[b])return!1;return!0};l.arrayRemove=function(a,c){var b=a.indexOf(c);return-1!==b?(a[b]=a[a.length-1],a.pop(),c):null};l.byteBuffer2base64image=function(c,
b,d,f,h){var e=4*b;a(c.length===e*d,"buffer length must match image resolution");var g=document.createElement("canvas");g.width=b;g.height=d;var k=g.getContext("2d");b=k.getImageData(0,0,b,d);for(var m=b.data,p=0;p<d;++p)for(var r=p*e,u=(d-1-p)*e,v=0;v<e;++v)m[r++]=c[u++];k.putImageData(b,0,0);return g.toDataURL(f,h)};l.cround=function(a){return Math.round(100*a)/100};l.logWithBase=function(a,c){return Math.log(a)/Math.log(c)};l.setMatrixTranslation=x;l.setMatrixTranslation3=function(a,c,b,d){a[12]=
c;a[13]=b;a[14]=d};l.getMatrixTranslation=function(a,c){void 0===c&&(c=f.vec3d.create());c[0]=a[12];c[1]=a[13];c[2]=a[14];return c};l.createTranslationMatrix=function(a,c){a=f.mat4d.identity(a);x(a,c);return a};l.fovx2fovy=function(a,c,b){return 2*Math.atan(b*Math.tan(.5*a)/c)};l.fovy2fovx=function(a,c,b){return 2*Math.atan(c*Math.tan(.5*a)/b)};l.fovx2fovd=function(a,c,b){return 2*Math.atan(Math.sqrt(c*c+b*b)*Math.tan(.5*a)/c)};l.fovy2fovd=function(a,c,b){return 2*Math.atan(Math.sqrt(c*c+b*b)*Math.tan(.5*
a)/b)};l.fovd2fovx=function(a,c,b){return 2*Math.atan(c*Math.tan(.5*a)/Math.sqrt(c*c+b*b))};l.fovd2fovy=function(a,c,b){return 2*Math.atan(b*Math.tan(.5*a)/Math.sqrt(c*c+b*b))};l.nextHighestPowerOfTwo=function(a){--a;for(var c=1;32>c;c<<=1)a|=a>>c;return a+1};l.lineSegmentLineSegmentDistance3D=function(a,c,b,k){var h,e,g;D[0]=a[0]-b[0];D[1]=a[1]-b[1];D[2]=a[2]-b[2];B[0]=k[0]-b[0];B[1]=k[1]-b[1];B[2]=k[2]-b[2];if(1E-4>Math.abs(B[0])&&1E-4>Math.abs(B[1])&&1E-4>Math.abs(B[2]))return[!1];I[0]=c[0]-a[0];
I[1]=c[1]-a[1];I[2]=c[2]-a[2];if(1E-4>Math.abs(I[0])&&1E-4>Math.abs(I[1])&&1E-4>Math.abs(I[2]))return[!1];c=D[0]*B[0]+D[1]*B[1]+D[2]*B[2];k=B[0]*I[0]+B[1]*I[1]+B[2]*I[2];h=D[0]*I[0]+D[1]*I[1]+D[2]*I[2];e=B[0]*B[0]+B[1]*B[1]+B[2]*B[2];g=(I[0]*I[0]+I[1]*I[1]+I[2]*I[2])*e-k*k;if(1E-4>Math.abs(g))return[!1];h=d((c*k-h*e)/g,0,1);c=d((c+k*h)/e,0,1);G[0]=a[0]+h*I[0];G[1]=a[1]+h*I[1];G[2]=a[2]+h*I[2];H[0]=b[0]+c*B[0];H[1]=b[1]+c*B[1];H[2]=b[2]+c*B[2];return[!0,f.vec3d.dist(G,H),G,H]};l.pointLineSegmentDistance2D=
function(a,c,b){O[0]=c[0]-a[0];O[1]=c[1]-a[1];O[2]=0;L[0]=b[0]-a[0];L[1]=b[1]-a[1];L[2]=0;M[0]=b[0];M[1]=b[1];M[2]=0;c=f.vec3d.dot(L,O);b=f.vec3d.length(O);c=d(c/(b*b),0,1);P[0]=O[0]*c;P[1]=O[1]*c;K[0]=a[0]+P[0];K[1]=a[1]+P[1];f.vec3d.subtract(M,K,J);a=f.vec3d.length(J);c=f.vec3d.length(L);b=f.vec3d.length(O);var k=f.vec3d.length(P);if(k>c||k>b)a=Number.MAX_VALUE;return a};w=function(){var a=window.performance||{};if(a.now)return function(){return a.now()};if(a.webkitNow)return function(){return a.webkitNow()};
if(a.mozNow)return function(){return a.mozNow()};if(a.msNow)return function(){return a.msNow()};if(a.oNow)return function(){return a.oNow()};var c;c=a.timing&&a.timing.navigationStart?a.timing.navigationStart:Date.now();return function(){return Date.now()-c}}();l.performance={now:w}})},"esri/views/3d/webgl-engine/parts/Model":function(){define("require exports dojo/string ../lib/ModelContentType ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util ../lib/gl-matrix".split(" "),function(w,l,f,a,d,
b,q,t){var m=q.assert,k=q.verify,p=t.vec3d,x=t.mat4d,z=q.logWithBase;return function(){function v(){this.dirtySet=new d(this);this._uniqueIdx=0;this._id2origin={};this.content={};for(var b in a)this.content[a[b]]={}}v.prototype.getAll=function(a){a=this.content[a];m(void 0!==a);return a};v.prototype.get=function(a,b){return this.getAll(a)[b]};v.prototype.add=function(b,d){var f=this.content[b];m(void 0!==f);var k=d.getId();m(null==f[k],"Model/Stage already contains object to be added");f[k]=d;b===
a.LAYER&&this.notifyDirty(b,d,"layerAdded")};v.prototype.remove=function(b,d){var f=this.content[b];m(void 0!==f);var k=f[d];m(void 0!==k,"Model/Stage doesn't contain object to be removed");delete f[d];b===a.TEXTURE&&k.unload();b===a.LAYER&&this.notifyDirty(b,k,"layerRemoved");return k};v.prototype.getDirtySet=function(){return this.dirtySet};v.prototype.notifyDirty=function(a,b,d,f){this.dirtySet.handleUpdate(b,d,f)};v.prototype.getOrigin=function(a,b,d){void 0===d&&(d=10);var f=0;b=b*d/1E4;1<b&&
(f=Math.ceil(z(b,2)));b=1E4*Math.pow(2,f);d=Math.round(a[0]/b);var c=Math.round(a[1]/b);a=Math.round(a[2]/b);var f=f+"_"+d+"_"+c+"_"+a,k=this._id2origin[f];null==k&&(k={vec3:p.createFrom(d*b,c*b,a*b),id:f},this._id2origin[f]=k);return k};v.prototype.getGeometryRenderGeometries=function(a,d,f){var k=a.getId(),c=d.geometry,m=c.getData(),p=!!c.singleUse,r=d.materials,u=d.instanceParameters,v=a.getCombinedStaticTransformation(d),q=x.maxScale(v),t=d.origin,c=c.getBoundingInfo(0),l=d.getId()+"#0",z=this._uniqueIdx++;
a=new b(m,c,r[0],v,d.customTransformation,q,a.getCastShadow(),p,k,l,z);a.origin=t||this.getOrigin(a.center,a.bsRadius);a.instanceParameters=u;f.push(a)};v.prototype.updateRenderGeometryTransformation=function(a,b,d){a.getCombinedStaticTransformation(b,d.transformation);d.updateTransformation(d.transformation)};v.prototype.formatDebugInfo=function(b){var d=[];if(b){d[0]="\x3ctable\x3e";for(var k in a)b=a[k],d[0]+="\x3ctr\x3e\x3ctd\x3e"+b+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Object.keys(this.getAll(b)).length+
"\x3c/td\x3e\x3c/tr\x3e";d[0]+="\x3c/table\x3e";d[1]=this.dirtySet.formatDebugInfo(!0)}else{d[0]="";for(k in a)b=a[k],d[0]+=f.pad(String(Object.keys(this.getAll(b)).length),6," ")+" "+b+", ";d[1]=this.dirtySet.formatDebugInfo(!1)}return d};v.prototype.validateContent=function(){var b=this.getAll(a.OBJECT),d;for(d in b)this.validateObject(b[d]);var b=this.getAll(a.LAYER),f;for(f in b)this.validateLayer(b[f]);f=this.getAll(a.MATERIAL);for(var k in f)this.validateMaterial(f[k])};v.prototype.validateObject=
function(b){b=b.geometryRecords;for(var d=0;d<b.length;++d){var f=b[d];m(null!=this.get(a.GEOMETRY,f.geometry.id));var p=f.geometry.numGroups;m(p<=f.materials.length,"object materials do not match geometry groups");k(p===f.materials.length,"object materials do not match geometry groups");for(var c=0;c<p;++c)m(null!=this.get(a.MATERIAL,f.materials[c].getId()))}};v.prototype.validateLayer=function(b){b=b.getObjects();for(var d=0;d<b.length;++d){var f=this.get(a.OBJECT,b[d].getId());m(null!=f)}};v.prototype.validateMaterial=
function(b){b=b.getAllTextureIds();for(var d=0;d<b.length;++d){var f=this.get(a.TEXTURE,b[d]);m(null!=f)}};v.ContentType=a;return v}()})},"esri/views/3d/webgl-engine/lib/ModelContentType":function(){define(["require","exports"],function(w,l){return function(){function f(){}f.LAYER="layers";f.OBJECT="objects";f.GEOMETRY="geometries";f.MATERIAL="materials";f.TEXTURE="textures";return f}()})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define(["require","exports","./ModelContentType","./ModelDirtyTypesTs",
"./Util"],function(w,l,f,a,d){var b=d.objectEmpty,q=d.assert;return function(){function a(a){this._residentGeomRecords={};this._dirtyGeomRecords={};this._dirtyMaterials={};this._model=a}Object.defineProperty(a.prototype,"residentLayerCount",{get:function(){return Object.keys(this._residentGeomRecords).length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"residentObjectCount",{get:function(){var a=0,b;for(b in this._residentGeomRecords)a+=Object.keys(this._residentGeomRecords[b]).length;
return a},enumerable:!0,configurable:!0});a.prototype._getResidentGeometryRecords=function(){return this._residentGeomRecords};a.prototype._getDirtyGeometryRecords=function(){return this._dirtyGeomRecords};a.prototype.getDirtyMaterials=function(){return b(this._dirtyMaterials)?null:this._dirtyMaterials};a.prototype.clearDirtyMaterials=function(){this._dirtyMaterials={}};a.prototype.hasDirtyGeometryRecords=function(){for(var a in this._dirtyGeomRecords)for(var d in this._dirtyGeomRecords[a]){var f=
this._dirtyGeomRecords[a][d];if(f&&!b(f))return!0}return!1};a.prototype.handleUpdate=function(a,b,d){q(this[b],"ModelDirtySet doesn't know how to process "+b);return this[b](a,d)};a.prototype.shaderTransformationChanged=function(a){if(a=this._residentGeomRecords[a.getId()])for(var b in a){var d=this._model.content[f.OBJECT][b];if(d&&d.hasVolativeTransformation()){var d=a[b],m;for(m in d)for(var q=0,v=d[m][1];q<v.length;q++)v[q].shaderTransformationChanged()}}};a.prototype.getAddRemoveUpdateList=function(a){return this.getAddRemoveUpdateListFilteredByLayers(Object.keys(this._dirtyGeomRecords),
a)};a.prototype.getAddRemoveUpdateListFilteredByLayers=function(a,d){for(var k=[],m=[],t=[],v=0;v<a.length;v++){var r=a[v];if(r in this._dirtyGeomRecords){for(var u in this._dirtyGeomRecords[r]){var l=this._dirtyGeomRecords[r][u];if(l){var E=this._createObjectRecordObjIfNonexistent(this._residentGeomRecords,r,u),c;for(c in l){var D=l[c],B=D[0],I=D[1],D=D[2],G=I&2&&D&1;if(I&4||G){var H=E[c];H?m.push.apply(m,H[1]):4===I&&q(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");d&&H&&delete E[c]}if(I&
1||G){var H=[B,[]],K=this._model.get(f.OBJECT,u);this._model.getGeometryRenderGeometries(K,B,H[1]);k.push.apply(k,H[1]);d&&(E[c]=H)}if(I&2&&!G)if(H=E[c],K=this._model.get(f.OBJECT,u),H){I=H[1];G=I.length;if(D&16)for(H=0;H<G;H++){var w=I[H];this._model.updateRenderGeometryTransformation(K,B,w)}for(H=0;H<G;H++)w=I[H],t.push({renderGeometry:w,updateType:D})}else q(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}b(E)&&delete this._residentGeomRecords[r][u]}}b(this._residentGeomRecords[r])&&
delete this._residentGeomRecords[r]}d&&delete this._dirtyGeomRecords[r]}return[k,m,t]};a.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(Object.keys(this._residentGeomRecords))};a.prototype.getResidentRenderGeometriesFilteredByLayers=function(a){for(var b=[],d=0;d<a.length;d++){var f=a[d];if(f in this._residentGeomRecords)for(var m in this._residentGeomRecords[f]){var v=this._residentGeomRecords[f][m];if(v)for(var r in v)b.push.apply(b,v[r][1])}}return b};
a.prototype.componentVisibilityChanged=function(a,b,d){if(null!=b)this._componentPropertyChanged(a,b,d,2);else{b=0;for(var f=a.getGeometryRecords();b<f.length;b++)this._componentPropertyChanged(a,f[b],d,2)}};a.prototype.componentHighlightChanged=function(a,b,d){if(null!=b)this._componentPropertyChanged(a,b,d,32);else{b=0;for(var f=a.getGeometryRecords();b<f.length;b++)this._componentPropertyChanged(a,f[b],d,32)}};a.prototype.vertexAttrsUpdated=function(a,b,d){this._updateOrCreateDirtyRecord(a,b,d,
2,0,0,2,5,4)};a.prototype.colorAttrsUpdated=function(a,b,d){this._updateOrCreateDirtyRecord(a,b,d,2,0,0,2,5,8)};a.prototype.matChanged=function(a){this._dirtyMaterials[a.getId()]=!0};a.prototype.layerAdded=function(a){for(var b=a.getObjects(),d=0;d<b.length;d++)this.layObjectAdded(a,b[d])};a.prototype.layerRemoved=function(a){for(var b=a.getObjects(),d=0;d<b.length;d++)this.layObjectRemoved(a,b[d])};a.prototype.layObjectAdded=function(a,b){a=a.getId();for(var d=b.getGeometryRecords(),f=0;f<d.length;f++)this.objGeometryAdded(b,
d[f],a)};a.prototype.layObjectRemoved=function(a,b){a=a.getId();for(var d=b.getGeometryRecords(),f=0;f<d.length;f++)this.objGeometryRemoved(b,d[f],a)};a.prototype.layObjectReplaced=function(a,b){this.layObjectRemoved(a,b[0]);this.layObjectAdded(a,b[1])};a.prototype.objDirty=function(a,b){b=b||this._getParentLayerId(a);var d=a.getId(),d=this._createObjectRecordObjIfNonexistent(this._residentGeomRecords,b,d),f;for(f in d)this._updateOrCreateDirtyRecord(a,d[f][0],b,2,0,2,0,5,1)};a.prototype.objTransformation=
function(a,b){b=b||this._getParentLayerId(a);var d=a.getId(),d=this._createObjectRecordObjIfNonexistent(this._residentGeomRecords,b,d),f;for(f in d)this._updateOrCreateDirtyRecord(a,d[f][0],b,2,0,0,2,5,16)};a.prototype.objGeometryAdded=function(a,b,d){this._updateOrCreateDirtyRecord(a,b,d,1,4,0,0,0)};a.prototype.objGeometryRemoved=function(a,b,d){this._updateOrCreateDirtyRecord(a,b,d,4,1,2,0,0)};a.prototype.objGeometryReplaced=function(a,b){this.objGeometryRemoved(a,b[0]);this.objGeometryAdded(a,
b[1])};a.prototype.objGeometryTransformation=function(a,b){this.objGeometryReplaced(a,b)};a.prototype._componentPropertyChanged=function(a,b,d,f){this._updateOrCreateDirtyRecord(a,b,d,2,0,0,2,5,f)};a.prototype._updateOrCreateDirtyRecord=function(a,b,d,f,t,v,r,u,l){d=d||this._getParentLayerId(a);var k=a.getId();a=b.getId();d=this._createObjectRecordObjIfNonexistent(this._dirtyGeomRecords,d,k);(k=d[a])?(b=k[1],b&t?delete d[a]:b&v?(k[1]=f,k[2]=l):b&r?k[2]|=l:b&u||q(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")):
d[a]=[b,f,l]};a.prototype._createObjectRecordObjIfNonexistent=function(a,b,d){a[b]||(a[b]={});a[b][d]||(a[b][d]={});return a[b][d]};a.prototype._getParentLayerId=function(a){return a.parentLayer.id};a.prototype.formatDebugInfo=function(a){var b=["ADD","UPD",void 0,"REM"];if(a)return"";a="";for(var d in this._dirtyGeomRecords)for(var f in this._dirtyGeomRecords[d]){var m=this._dirtyGeomRecords[d][f];if(m){0<a.length&&(a+="\n");a+=d+"."+f;var v=[],r;for(r in m){var u=m[r][1];v[u]||(v[u]=[]);v[u].push(m[r][0].geometry.id)}for(m=
0;m<v.length;m++)if(v[m])for(a+=" "+b[m-1]+": ",u=0;u<v[m].length;u++)a+=v[m][u]+", "}}return a};return a}()})},"esri/views/3d/webgl-engine/lib/ModelDirtyTypesTs":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define(["require","exports","./gl-matrix"],function(w,l,f){var a=f.vec3d,d=f.mat4d;return function(){function b(b,d,f,k,p,x,l,v,r,u,C){this.shaderTransformationDirty=!0;this.data=
b.toRenderData();this.componentOffsets=b.componentOffsets;this.boundingInfo=d;this.material=f;this.origin=null;this.center=a.create();this.bsRadius=0;this.transformation=null;this.calculateShaderTransformation=p;k&&this.updateTransformation(k,x);this.castShadow=l;this.singleUse=v;this.name=r;this.uniqueName=u;this.idx=C;this.canBeMerged=!0;this.instanceParameters={}}b.prototype.updateTransformation=function(a,b){this.transformation=a;this.shaderTransformationDirty=!0;this.bsRadius=this.getBoundingSphere(a,
b,this.center)};b.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0};b.prototype.getBoundingSphere=function(a,b,f){b=b||d.maxScale(a);d.multiplyVec3(a,this.boundingInfo.getCenter(),f);return this.boundingInfo.getBSRadius()*b};Object.defineProperty(b.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0});b.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&
(this.shaderTransformation||(this.shaderTransformation=d.create()),d.set(this.calculateShaderTransformation(this.transformation),this.shaderTransformation),this.shaderTransformationDirty=!1),this.shaderTransformation):this.transformation};return b}()})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["require","exports","./Util"],function(w,l,f){function a(a){return Math.abs(a*a*a)}function d(b,d,f,m){void 0===m&&(m=k);var p=f.parameters;f=f.paddingPixelsOverride;m.scale=
Math.min(p.divisor/(d-p.offset),1);m.factor=a(b);m.minPixelSize=p.minPixelSize;m.paddingPixels=f;return m}function b(a,b){return Math.max(f.lerp(a*b.scale,a,b.factor),b.minPixelSize*(1+2*b.paddingPixels/a))}function q(a,f,k){a=d(a,f,k);a.minPixelSize=0;a.paddingPixels=0;return b(1,a)}Object.defineProperty(l,"__esModule",{value:!0});l.getSettings=function(a){return new t(a,l.defaultDescription)};l.getLabelSettings=function(a){var b=l.defaultDescription.curvatureDependent;return new t(a,{curvatureDependent:{min:{curvature:b.min.curvature,
tiltAngle:b.min.tiltAngle,scaleFallOffFactor:m.curvatureDependent.min.scaleFallOffFactor},max:{curvature:b.max.curvature,tiltAngle:b.max.tiltAngle,scaleFallOffFactor:m.curvatureDependent.max.scaleFallOffFactor}},scaleStart:l.defaultDescription.scaleStart,scaleFallOffRange:l.defaultDescription.scaleFallOffRange,minPixelSize:m.minPixelSize})};l.perspectiveFactor=a;l.scaleFactor=d;l.applyScaleFactor=b;l.applyScaleFactorVec2=function(a,b,d){void 0===d&&(d=[0,0]);var k=Math.min(Math.max(b.scale,b.minPixelSize*
(1+2*b.paddingPixels/a[1])/a[1]),1);d[0]=f.lerp(a[0]*k,a[0],b.factor);d[1]=f.lerp(a[1]*k,a[1],b.factor);return d};l.precomputeScale=q;l.precomputeScaleFactor=function(a,b,d,f){f.scale=q(a,b,d);f.factor=0;f.minPixelSize=d.parameters.minPixelSize;f.paddingPixels=d.paddingPixelsOverride;return f};l.applyPrecomputedScaleFactorVec2=function(a,b,d){void 0===d&&(d=[0,0]);b=Math.min(Math.max(b.scale,b.minPixelSize*(1+2*b.paddingPixels/a[1])/a[1]),1);d[0]=a[0]*b;d[1]=a[1]*b;return d};l.scale=function(a,f,
k,m){return b(a,d(f,k,m))};var t=function(){function a(a,b,d,f){void 0===d&&(d={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0});this.viewingMode=a;this.description=b;this.parameters=d;this._paddingPixelsOverride=f;"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=
this.calculateCurvatureDependentParametersGlobal)}Object.defineProperty(a.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!0,configurable:!0});a.prototype.update=function(a){if(this.parameters&&this.parameters.camera.fovY===a.fovY&&this.parameters.camera.distance===a.distance)return!1;this.calculateParameters(a,this.parameters);return!0};a.prototype.overridePadding=function(b){return b!==this.paddingPixelsOverride?new a(this.viewingMode,
this.description,this.parameters,b):this};a.prototype.calculateParameters=function(a,b){var d=this.description,f=d.scaleStart,k=d.scaleFallOffRange,d=d.minPixelSize,c=a.fovY,m=a.distance,p=this.calculateCurvatureDependentParameters(a),r=this.coverageCompensation(a,p),v=p.tiltAngle,p=p.scaleFallOffFactor,m=Math.sin(v)*m,v=.5*Math.PI-v-c*(.5-f*r),f=m/Math.cos(v),k=(f-m/Math.cos(v+c*k*r)*p)/(1-p);b.camera.fovY=a.fovY;b.camera.distance=a.distance;b.offset=k;b.divisor=f-k;b.minPixelSize=d;return b};a.prototype.calculateCurvatureDependentParametersLocal=
function(a,b){void 0===b&&(b=p);b.tiltAngle=this.description.curvatureDependent.min.tiltAngle;b.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;return b};a.prototype.calculateCurvatureDependentParametersGlobal=function(a,b){void 0===b&&(b=p);var d=this.description.curvatureDependent;a=1+a.distance/x;var k=[d.min.curvature,d.max.curvature],m=k[0];a=f.clamp((Math.sqrt(a*a-1)-m)/(k[1]-m),0,1);k=[d.min,d.max];d=k[0];k=k[1];b.tiltAngle=f.lerp(d.tiltAngle,k.tiltAngle,a);b.scaleFallOffFactor=
f.lerp(d.scaleFallOffFactor,k.scaleFallOffFactor,a);return b};a.prototype.surfaceCoverageCompensationLocal=function(a,b){return(a.fovY-b.tiltAngle)/a.fovY};a.prototype.surfaceCoverageCompensationGlobal=function(a,b){var d=x*x;b=b.tiltAngle+.5*Math.PI;var f=a.fovY;a=a.distance;a=a*a+d-2*Math.cos(b)*a*x;var k=Math.sqrt(a);return(Math.acos(Math.sqrt(a-d)/k)-Math.asin(x/(k/Math.sin(b)))+.5*f)/f};return a}();l.defaultDescription={curvatureDependent:{min:{curvature:f.deg2rad(10),tiltAngle:f.deg2rad(12),
scaleFallOffFactor:.5},max:{curvature:f.deg2rad(70),tiltAngle:f.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0};var m={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};l.copyParameters=function(a,b){b.camera.distance=a.camera.distance;b.camera.fovY=a.camera.fovY;b.divisor=a.divisor;b.offset=a.offset;b.minPixelSize=a.minPixelSize;return b};var k={scale:0,factor:0,minPixelSize:0,paddingPixels:0},p={tiltAngle:0,scaleFallOffFactor:0},
x=6378137})},"esri/views/webgl/Util":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/Error"],function(w,l,f,a){return function(){function d(){}d.vertexCount=function(a,f){return a.vertexBuffers[f].size/d.getStride(a.layout[f])};d.getStride=function(a){return a[0].stride};d.getBytesPerElement=function(a){switch(a){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw Error("Unknown data type");
}};d.addDescriptor=function(a,f,t,m,k,p){var b=d.getBytesPerElement(m);if(0<a.length){var q=a[0].stride,v=q+b*t;a.forEach(function(a){return a.stride=v});a.push({name:f,count:t,type:m,offset:q,stride:v,normalized:k,divisor:p})}else a.push({name:f,count:t,type:m,offset:0,stride:b*t,normalized:k,divisor:p})};d.assertCompatibleVertexAttributeLocations=function(a,d){(a=a.locations===d.locations)||console.error("VertexAttributeLocations are incompatible");return a};d.hasAttribute=function(a,d){for(var b=
0;b<a.length;b++)if(a[b].name===d)return!0;return!1};d.findAttribute=function(a,d){for(var b=0;b<a.length;b++)if(a[b].name===d)return a[b];return null};d.copyFramebufferToTexture=function(a,d,f,m,k){void 0===k&&(k=0);var b=a.getBoundFramebufferObject(),q=a.getBoundTexture(0);a.bindFramebuffer(d);a.bindTexture(f,0);a.gl.copyTexImage2D(a.gl.TEXTURE_2D,k,f.descriptor.pixelFormat,m[0],m[1],m[2],m[3],0);a.gl.flush();a.bindFramebuffer(b);a.bindTexture(q,0)};d.assert=function(b,d){if(!b)throw new a(d);};
d.setBaseInstanceOffset=function(a,d){var b={},m;for(m in a)b[m]=a[m].map(function(a){return a.divisor?f({},a,{baseInstance:d}):a});return b};return d}()})},"esri/views/3d/support/aaBoundingBox":function(){define(["require","exports","./aaBoundingRect","../../../geometry/Extent"],function(w,l,f,a){function d(a){return a[0]>=a[3]?0:a[3]-a[0]}function b(a){return a[1]>=a[4]?0:a[4]-a[1]}function q(a){return a[2]>=a[5]?0:a[5]-a[2]}function t(a){return 6===a.length}Object.defineProperty(l,"__esModule",
{value:!0});l.create=function(a){void 0===a&&(a=l.ZERO);return[a[0],a[1],a[2],a[3],a[4],a[5]]};l.fromExtent=function(a){return[a.xmin,a.ymin,a.zmin,a.xmax,a.ymax,a.zmax]};l.toExtent=function(b,d){return isFinite(b[2])||isFinite(b[5])?new a({xmin:b[0],xmax:b[3],ymin:b[1],ymax:b[4],zmin:b[2],zmax:b[5],spatialReference:d}):new a({xmin:b[0],xmax:b[3],ymin:b[1],ymax:b[4],spatialReference:d})};l.fromMinMax=function(a,b){return[a[0],a[1],a[2],b[0],b[1],b[2]]};l.expand=function(a,b,d){void 0===d&&(d=a);var k=
b.declaredClass;"esri.geometry.Extent"===k?(d[0]=Math.min(a[0],b.xmin),d[1]=Math.min(a[1],b.ymin),d[3]=Math.max(a[3],b.xmax),d[4]=Math.max(a[4],b.ymax),b.hasZ&&(d[2]=Math.min(a[2],b.zmin),d[5]=Math.max(a[5],b.zmax))):"esri.geometry.Point"===k?(d[0]=Math.min(a[0],b.x),d[1]=Math.min(a[1],b.y),d[3]=Math.max(a[3],b.x),d[4]=Math.max(a[4],b.y),b.hasZ&&(d[2]=Math.min(a[2],b.z),d[5]=Math.max(a[5],b.z))):t(b)?(d[0]=Math.min(a[0],b[0]),d[1]=Math.min(a[1],b[1]),d[2]=Math.min(a[2],b[2]),d[3]=Math.max(a[3],b[3]),
d[4]=Math.max(a[4],b[4]),d[5]=Math.max(a[5],b[5])):f.is(b)?(d[0]=Math.min(a[0],b[0]),d[1]=Math.min(a[1],b[1]),d[3]=Math.max(a[3],b[2]),d[4]=Math.max(a[4],b[3])):Array.isArray(b)&&(2===b.length?(d[0]=Math.min(a[0],b[0]),d[1]=Math.min(a[1],b[1]),d[3]=Math.max(a[3],b[0]),d[4]=Math.max(a[4],b[1])):3===b.length&&(d[0]=Math.min(a[0],b[0]),d[1]=Math.min(a[1],b[1]),d[2]=Math.min(a[2],b[2]),d[3]=Math.max(a[3],b[0]),d[4]=Math.max(a[4],b[1]),d[5]=Math.max(a[5],b[2])));return d};l.expandBuffer=function(a,b,d,
f,q){void 0===q&&(q=a);var k=a[0],m=a[1],p=a[2],x=a[3],t=a[4];a=a[5];for(var c=0;c<f;c++)k=Math.min(k,b[d+3*c]),m=Math.min(m,b[d+3*c+1]),p=Math.min(p,b[d+3*c+2]),x=Math.max(x,b[d+3*c]),t=Math.max(t,b[d+3*c+1]),a=Math.max(a,b[d+3*c+2]);q[0]=k;q[1]=m;q[2]=p;q[3]=x;q[4]=t;q[5]=a;return q};l.allFinite=function(a){for(var b=0;6>b;b++)if(!isFinite(a[b]))return!1;return!0};l.width=d;l.depth=b;l.height=q;l.center=function(a,f){void 0===f&&(f=[0,0,0]);f[0]=a[0]+d(a)/2;f[1]=a[1]+b(a)/2;f[2]=a[2]+q(a)/2;return f};
l.size=function(a,f){void 0===f&&(f=[0,0,0]);f[0]=d(a);f[1]=b(a);f[2]=q(a);return f};l.containsPoint=function(a,b){return b[0]>=a[0]&&b[1]>=a[1]&&b[2]>=a[2]&&b[0]<=a[3]&&b[1]<=a[4]&&b[2]<=a[5]};l.containsPointWithMargin=function(a,b,d){return b[0]>=a[0]-d&&b[1]>=a[1]-d&&b[2]>=a[2]-d&&b[0]<=a[3]+d&&b[1]<=a[4]+d&&b[2]<=a[5]+d};l.contains=function(a,b){return b[0]>=a[0]&&b[1]>=a[1]&&b[2]>=a[2]&&b[3]<=a[3]&&b[4]<=a[4]&&b[5]<=a[5]};l.intersects=function(a,b){return Math.max(b[0],a[0])<=Math.min(b[3],a[3])&&
Math.max(b[1],a[1])<=Math.min(b[4],a[4])&&Math.max(b[2],a[2])<=Math.min(b[5],a[5])};l.offset=function(a,b,d,f,q){void 0===q&&(q=a);q[0]=a[0]+b;q[1]=a[1]+d;q[2]=a[2]+f;q[3]=a[3]+b;q[4]=a[4]+d;q[5]=a[5]+f;return q};l.setMin=function(a,b,d){void 0===d&&(d=a);d[0]=b[0];d[1]=b[1];d[2]=b[2];d!==a&&(d[3]=a[3],d[4]=a[4],d[5]=a[5]);return d};l.setMax=function(a,b,d){void 0===d&&(d=a);d[3]=b[0];d[4]=b[1];d[5]=b[2];d!==a&&(d[0]=a[0],d[1]=a[1],d[2]=a[2]);return a};l.set=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=
b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];return a};l.toRect=function(a,b){b||(b=f.create());b[0]=a[0];b[1]=a[1];b[2]=a[3];b[3]=a[4];return b};l.fromRect=function(a,b){a[0]=b[0];a[1]=b[1];a[3]=b[2];a[4]=b[3];return a};l.is=t;l.isPoint=function(a){return 0===d(a)&&0===b(a)&&0===q(a)};l.equals=function(a,b,d){if(null==a||null==b)return a===b;if(!t(a)||!t(b))return!1;if(d)for(var f=0;f<a.length;f++){if(!d(a[f],b[f]))return!1}else for(f=0;f<a.length;f++)if(a[f]!==b[f])return!1;return!0};l.POSITIVE_INFINITY=
[-Infinity,-Infinity,-Infinity,Infinity,Infinity,Infinity];l.NEGATIVE_INFINITY=[Infinity,Infinity,Infinity,-Infinity,-Infinity,-Infinity];l.ZERO=[0,0,0,0,0,0]})},"esri/views/3d/support/aaBoundingRect":function(){define(["require","exports"],function(w,l){function f(a){return a[0]>=a[2]?0:a[2]-a[0]}function a(a){return a[1]>=a[3]?0:a[3]-a[1]}function d(a){return 4===a.length}Object.defineProperty(l,"__esModule",{value:!0});l.create=function(a){void 0===a&&(a=l.ZERO);return[a[0],a[1],a[2],a[3]]};l.fromExtent=
function(a){return[a.xmin,a.ymin,a.xmax,a.ymax]};l.expand=function(a,f,t){void 0===t&&(t=a);var b=f.declaredClass;"esri.geometry.Extent"===b?(t[0]=Math.min(a[0],f.xmin),t[1]=Math.min(a[1],f.ymin),t[2]=Math.max(a[2],f.xmax),t[3]=Math.max(a[3],f.ymax)):"esri.geometry.Point"===b?(t[0]=Math.min(a[0],f.x),t[1]=Math.min(a[1],f.y),t[2]=Math.max(a[2],f.x),t[3]=Math.max(a[3],f.y)):d(f)?(t[0]=Math.min(a[0],f[0]),t[1]=Math.min(a[1],f[1]),t[2]=Math.max(a[2],f[2]),t[3]=Math.max(a[3],f[3])):!Array.isArray(f)||
2!==f.length&&3!==f.length||(t[0]=Math.min(a[0],f[0]),t[1]=Math.min(a[1],f[1]),t[2]=Math.max(a[2],f[0]),t[3]=Math.max(a[3],f[1]));return t};l.allFinite=function(a){for(var b=0;4>b;b++)if(!isFinite(a[b]))return!1;return!0};l.width=f;l.height=a;l.center=function(b,d){void 0===d&&(d=[0,0]);d[0]=b[0]+f(b)/2;d[1]=b[1]+a(b)/2;return d};l.containsPoint=function(a,d){return d[0]>=a[0]&&d[1]>=a[1]&&d[0]<=a[2]&&d[1]<=a[3]};l.containsPointWithMargin=function(a,d,f){return d[0]>=a[0]-f&&d[1]>=a[1]-f&&d[0]<=a[2]+
f&&d[1]<=a[3]+f};l.intersects=function(a,d){return Math.max(d[0],a[0])<=Math.min(d[2],a[2])&&Math.max(d[1],a[1])<=Math.min(d[3],a[3])};l.offset=function(a,d,f,m){void 0===m&&(m=a);m[0]=a[0]+d;m[1]=a[1]+f;m[2]=a[2]+d;m[3]=a[3]+f;return m};l.setMin=function(a,d,f){void 0===f&&(f=a);f[0]=d[0];f[1]=d[1];f!==a&&(f[2]=a[2],f[3]=a[3]);return f};l.setMax=function(a,d,f){void 0===f&&(f=a);f[2]=d[0];f[3]=d[1];f!==a&&(f[0]=a[0],f[1]=a[1]);return a};l.set=function(a,d){a[0]=d[0];a[1]=d[1];a[2]=d[2];a[3]=d[3];
return a};l.is=d;l.isPoint=function(b){return(0===f(b)||!isFinite(b[0]))&&(0===a(b)||!isFinite(b[1]))};l.equals=function(a,f,t){if(null==a||null==f)return a===f;if(!d(a)||!d(f))return!1;if(t)for(var b=0;b<a.length;b++){if(!t(a[b],f[b]))return!1}else for(b=0;b<a.length;b++)if(a[b]!==f[b])return!1;return!0};l.POSITIVE_INFINITY=[-Infinity,-Infinity,Infinity,Infinity];l.NEGATIVE_INFINITY=[Infinity,Infinity,-Infinity,-Infinity];l.ZERO=[0,0,0,0]})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["require",
"exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});l.Default3D={position:0,normal:1,uv0:2,color:3,instanceColor:3,size:4,auxpos1:5,symbolColor:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12}})},"esri/views/webgl/VertexArrayObject":function(){define(["require","exports"],function(w,l){return function(){function f(a,d,b,q,t){this._locations=this._layout=this._glName=this._context=null;this._indexBuffer=this._buffers=void 0;this._initialized=
!1;this._context=a;this._layout=b;this._buffers=q;this._locations=d;t&&(this._indexBuffer=t);this._id=f._nextId++}Object.defineProperty(f.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"vertexBuffers",{get:function(){return this._buffers},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"indexBuffer",{get:function(){return this._indexBuffer},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});f.prototype.dispose=function(a){void 0===a&&(a=!0);if(this._context){var d=this._context.extensions.vao;d&&this._glName&&(d.deleteVertexArrayOES(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);
if(a){for(var b in this._buffers)this._buffers[b].dispose(),delete this._buffers[b];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}this._context=null}};f.prototype.initialize=function(){if(!this._initialized){var a=this._context.extensions.vao;if(a){var d=a.createVertexArrayOES();a.bindVertexArrayOES(d);this._bindLayout();a.bindVertexArrayOES(null);this._glName=d}this._initialized=!0}};f.prototype.bind=function(){this.initialize();var a=this._context.extensions.vao;a?a.bindVertexArrayOES(this.glName):
(this._context.bindVAO(null),this._bindLayout())};f.prototype._bindLayout=function(){var a=this._buffers,d=this._context.extensions.vao,b=this._layout,f=this._indexBuffer;a||console.error("Vertex buffer dictionary is empty!");var t=this._context.gl,m,k,p=0,x;for(x in a)for((m=a[x])||console.error("Vertex buffer is uninitialized!"),(k=b[x])||console.error("Vertex element descriptor is empty!"),this._context.bindBuffer(m),p=0;p<k.length;++p){m=k[p];var l=this._locations[m.name],v=m.baseInstance?m.baseInstance*
m.stride:0;void 0===l&&console.error("There is no location for vertex attribute '"+m.name+"' defined.");m.baseInstance&&!m.divisor&&console.error("Vertex attribute '"+m.name+"' uses baseInstanceOffset without divisor.");if(4>=m.count){if(t.enableVertexAttribArray(l),t.vertexAttribPointer(l,m.count,m.type,m.normalized,m.stride,m.offset+v),m.divisor&&0<m.divisor){var r=this._context.extensions.angleInstancedArrays;r&&r.vertexAttribDivisorANGLE(l,m.divisor)}}else if(16===m.count&&5126===m.type)for(var u=
0;4>u;u++)t.enableVertexAttribArray(l+u),t.vertexAttribPointer(l+u,4,m.type,m.normalized,m.stride,m.offset+16*u+v),m.divisor&&0<m.divisor&&(r=this._context.extensions.angleInstancedArrays)&&r.vertexAttribDivisorANGLE(l+u,m.divisor);else console.error("Unsupported vertex attribute element count: "+m.count)}f&&(d?t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,f.glName):this._context.bindBuffer(f))};f.prototype.unbind=function(){this.initialize();var a=this._context.extensions.vao;a?a.bindVertexArrayOES(null):
this._unbindLayout()};f.prototype._unbindLayout=function(){var a=this._buffers,d=this._layout,b=this._locations,f=this._context;a||console.error("Vertex buffer dictionary is empty!");var t=f.gl,m,k,p,x=0,l=0,v;for(v in a){(m=a[v])||console.error("Vertex buffer is uninitialized!");k=d[v];x=0;for(l=k.length;x<l;++x)p=k[x],t.disableVertexAttribArray(b[p.name]);f.unbindBuffer(m.bufferType)}(a=this._indexBuffer)&&f.unbindBuffer(a.bufferType)};f._nextId=0;return f}()})},"esri/views/webgl/BufferObject":function(){define(["require",
"exports"],function(w,l){return function(){function f(a,d,b,q,t){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=void 0;this._context=a;this._bufferType=d;this._usage=b;this._id=f._nextId++;this._glName=this._context.gl.createBuffer();q&&this.setData(q,t)}f.createIndex=function(a,d,b,q){return new f(a,34963,d,b,q)};f.createVertex=function(a,d,b){return new f(a,34962,d,b)};Object.defineProperty(f.prototype,"id",{get:function(){return this._id},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"usage",{get:function(){return this._usage},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"bufferType",{get:function(){return this._bufferType},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"indexType",{get:function(){return this._indexType},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"byteSize",{get:function(){return 34962===this._bufferType?this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!0,configurable:!0});f.prototype.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context=null)};f.prototype.setData=function(a,d){if(a){if("number"===typeof a){if(0>a&&console.error("Buffer size cannot be negative!"),
34963===this._bufferType&&d)switch(this._indexType=d,this._size=a,d){case 5123:a*=2;break;case 5125:a*=4}}else d=a.byteLength,a instanceof Uint16Array&&(d/=2,this._indexType=5123),a instanceof Uint32Array&&(d/=4,this._indexType=5125),this._size=d;d=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferData(this._bufferType,a,this._usage);this._context.bindVAO(d)}};f.prototype.setSubData=function(a,d,b,f){void 0===d&&(d=0);void 0===b&&(b=0);if(a){(0>
d||d>=this._size)&&console.error("offset is out of range!");var q=d,m=b,k=f,p=a.byteLength;a instanceof Uint16Array&&(p/=2,q*=2,m*=2,k*=2);a instanceof Uint32Array&&(p/=4,q*=4,m*=4,k*=4);void 0===f&&(f=p-1);b>=f&&console.error("end must be bigger than start!");d+b-f>this._size&&console.error("An attempt to write beyond the end of the buffer!");d=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferSubData(this._bufferType,q,(a instanceof ArrayBuffer?
a:a.buffer).slice(m,k));this._context.bindVAO(d)}};f._nextId=0;return f}()})},"esri/views/webgl/enums":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});l.BASE_TEXTURE_UNIT=33984})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define(["./GeometryData","./BufferVectorMath","./Util","./gl-matrix"],function(w,l,f,a){function d(a,d,f,k,m){if(Math.abs(b.dot(d,a))>m)return!1;b.cross(a,d,f);b.normalize(f);b.cross(f,a,k);b.normalize(k);return!0}
var b=a.vec3,q=a.vec4,t=a.vec3d,m=f.VertexAttrConstants,k=l.Vec3Compact,p=t.create(),x=t.create(),z={createSphereGeometry:function(a,d,k,p,q,c,x){a=a||50;p=void 0!==p?p:-Math.PI;q=void 0!==q?q:2*Math.PI;c=void 0!==c?c:.5*-Math.PI;x=void 0!==x?x:Math.PI;var r=Math.max(3,Math.floor(d)||8),u=Math.max(2,Math.floor(k)||6),v=(r+1)*(u+1);k=new Float32Array(3*v);d=new Float32Array(3*v);var v=new Float32Array(2*v),t,l,z=[],C=b.create(),E=0;for(l=0;l<=u;l++){var D=[],M=l/u,R=c+M*x,Q=Math.cos(R);for(t=0;t<=
r;t++){var T=t/r,A=p+T*q,V=Math.cos(A)*Q*a,S=Math.sin(R)*a,A=-Math.sin(A)*Q*a;k[3*E]=V;k[3*E+1]=S;k[3*E+2]=A;b.set3(V,S,A,C);b.normalize(C);d[3*E]=C[0];d[3*E+1]=C[1];d[3*E+2]=C[2];v[2*E]=T;v[2*E+1]=M;D.push(E);++E}z.push(D)}a=new Uint32Array(2*r*(u-1)*3);for(l=E=0;l<u;l++)for(t=0;t<r;t++)p=z[l][t],q=z[l][t+1],c=z[l+1][t+1],x=z[l+1][t],0===l?(a[E++]=p,a[E++]=c,a[E++]=x):l===u-1?(a[E++]=p,a[E++]=q,a[E++]=c):(a[E++]=p,a[E++]=q,a[E++]=c,a[E++]=c,a[E++]=x,a[E++]=p);f.assert(E===a.length);r={};r[m.POSITION]=
a;r[m.NORMAL]=a;r[m.UV0]=a;u={};u[m.POSITION]={size:3,data:k};u[m.NORMAL]={size:3,data:d};u[m.UV0]={size:2,data:v};return new w(u,r)},createPolySphereGeometry:function(a,b,d){function f(b,d){b>d&&(b=d+(d=b,0));var f=b.toString()+"."+d.toString();if(r[f])return r[f];var m=c.length;c.length+=3;k.add(c,3*b,c,3*d,c,m);k.scale(c,m,a/k.length(c,m));m/=3;return r[f]=m}var p,c;d?(c=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],d=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]):(d=a*(1+Math.sqrt(5))/2,c=[-a,
d,0,a,d,0,-a,-d,0,a,-d,0,0,-a,d,0,a,d,0,-a,-d,0,a,-d,d,0,-a,d,0,a,-d,0,-a,-d,0,a],d=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);for(p=0;p<c.length;p+=3)k.scale(c,p,a/k.length(c,p));var r={};for(p=0;p<b;p++){for(var u=d.length,v=new Uint32Array(4*u),q=0;q<u;q+=3){var x=d[q],t=d[q+1],l=d[q+2],z=f(x,t),O=f(t,l),L=f(l,x),M=4*q;v[M]=x;v[M+1]=z;v[M+2]=L;v[M+3]=t;v[M+4]=O;v[M+5]=z;v[M+6]=l;v[M+7]=L;v[M+8]=O;v[M+9]=z;
v[M+10]=O;v[M+11]=L}d=v;r={}}b=new Float32Array(c);for(p=0;p<b;p+=3)k.normalize(b,p);c=new Float32Array(c);p={};p[m.POSITION]=d;p[m.NORMAL]=d;d={};d[m.POSITION]={size:3,data:c};d[m.NORMAL]={size:3,data:b};return new w(d,p)},createPointGeometry:function(a,b,d,f,k,c,p){var r=new Float32Array(3);r[0]=b?b[0]:0;r[1]=b?b[1]:0;r[2]=b?b[2]:0;b=new Float32Array(3);b[0]=a?a[0]:0;b[1]=a?a[1]:0;b[2]=a?a[2]:1;if(null==c)a=new Float32Array(2),a[0]=0,a[1]=0;else{a=new Float32Array(c.length);for(var u=0;u<c.length;u++)a[u]=
c[u]}c=new Uint8Array(4);c[0]=d?255*d[0]:255;c[1]=d?255*d[1]:255;c[2]=d?255*d[2]:255;c[3]=d&&3<d.length?255*d[3]:255;d=new Float32Array(2);d[0]=null!=f&&2==f.length?f[0]:1;d[1]=null!=f&&2==f.length?f[1]:1;if(null!=k){var v=new Float32Array(4);v[0]=k[0];v[1]=k[1];v[2]=k[2];v[3]=k[3]}if(null!=p){var q=new Float32Array(4);q[0]=p[0];q[1]=p[1];q[2]=p[2];q[3]=p[3]}u=new Uint32Array(1);u[0]=0;f={};f[m.POSITION]=u;f[m.NORMAL]=u;f[m.UV0]=u;f[m.COLOR]=u;f[m.SIZE]=u;null!=k&&(f[m.AUXPOS1]=u);null!=p&&(f[m.AUXPOS2]=
u);u={};u[m.POSITION]={size:3,data:r};u[m.NORMAL]={size:3,data:b};u[m.UV0]={size:a.length,data:a};u[m.COLOR]={size:4,data:c};u[m.SIZE]={size:2,data:d};null!=k&&(u[m.AUXPOS1]={size:4,data:v});null!=p&&(u[m.AUXPOS2]={size:4,data:q});return new w(u,f,w.DefaultOffsets,"point")},createPointArrayGeometry:function(a,b){for(var d=new Float32Array(3*a.length),f=new Float32Array(b?3*a.length:3),k=new Uint32Array(a.length),c=new Uint32Array(a.length),p=0;p<a.length;p++)d[3*p]=a[p][0],d[3*p+1]=a[p][1],d[3*p+
2]=a[p][2],b&&(f[3*p]=b[p][0],f[3*p+1]=b[p][1],f[3*p+2]=b[p][2]),k[p]=p,c[p]=0;b||(f[0]=0,f[1]=1,f[2]=0);a=new Float32Array(2);a[0]=0;a[1]=0;p={};p[m.POSITION]=k;p[m.NORMAL]=b?k:c;p[m.UV0]=c;b={};b[m.POSITION]={size:3,data:d};b[m.NORMAL]={size:3,data:f};b[m.UV0]={size:2,data:a};return new w(b,p,w.DefaultOffsets,"point")},createTriangleGeometry:function(){var a=new Float32Array(9);a[0]=0;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=100;a[6]=100;a[7]=0;a[8]=0;var b=new Uint32Array(3);b[0]=0;b[1]=1;b[2]=2;var d=
new Float32Array(3);d[0]=0;d[1]=1;d[2]=0;var f=new Uint32Array(3);f[0]=0;f[1]=0;f[2]=0;var k=new Float32Array(2);k[0]=0;k[1]=0;var c=new Uint32Array(3);c[0]=0;c[1]=0;c[2]=0;var p={};p[m.POSITION]=b;p[m.NORMAL]=f;p[m.UV0]=c;b={};b[m.POSITION]={size:3,data:a};b[m.NORMAL]={size:3,data:d};b[m.UV0]={size:2,data:k};return new w(b,p)},createSquareGeometry:function(a){var b,d,f=new Float32Array(12);if(a)for(b=0;4>b;b++)for(d=0;3>d;d++)f[3*b+d]=a[b][d];else f[0]=-1,f[1]=-1,f[2]=0,f[3]=1,f[4]=-1,f[5]=0,f[6]=
1,f[7]=1,f[8]=0,f[9]=-1,f[10]=1,f[11]=0;d=new Uint32Array(6);d[0]=0;d[1]=1;d[2]=2;d[3]=2;d[4]=3;d[5]=0;a=new Float32Array(3);a[0]=0;a[1]=0;a[2]=1;var k=new Uint32Array(6);for(b=0;6>b;b++)k[b]=0;b=new Float32Array(8);b[0]=0;b[1]=0;b[2]=1;b[3]=0;b[4]=1;b[5]=1;b[6]=0;b[7]=1;var c=new Uint8Array(4);c[0]=255;c[1]=255;c[2]=255;c[3]=255;var p={};p[m.POSITION]=d;p[m.NORMAL]=k;p[m.UV0]=d;p[m.COLOR]=k;d={};d[m.POSITION]={size:3,data:f};d[m.NORMAL]={size:3,data:a};d[m.UV0]={size:2,data:b};d[m.COLOR]={size:4,
data:c};return new w(d,p)},createBoxGeometry:function(){var a,b,d=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],f=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],k=[0,0,1,0,1,1,0,1],c=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],p=Array(36);for(a=0;6>a;a++)for(b=0;6>b;b++)p[6*a+b]=a;var q=Array(36);for(a=0;6>a;a++)q[6*a+0]=0,q[6*a+1]=1,q[6*a+2]=2,q[6*a+3]=2,q[6*a+4]=3,q[6*a+5]=0;return function(a){var b;Array.isArray(a)||
(a=[a,a,a]);var r=new Float32Array(24);for(b=0;8>b;b++)r[3*b]=d[b][0]*a[0],r[3*b+1]=d[b][1]*a[1],r[3*b+2]=d[b][2]*a[2];a={};a[m.POSITION]=new Uint32Array(c);a[m.NORMAL]=new Uint32Array(p);a[m.UV0]=new Uint32Array(q);b={};b[m.POSITION]={size:3,data:r};b[m.NORMAL]={size:3,data:new Float32Array(f)};b[m.UV0]={size:2,data:new Float32Array(k)};return new w(b,a)}}(),createDiamondGeometry:function(){var a=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],b=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,
1,-1,0,0,-1,1,-1,-1,0],d=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],f=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];return function(k){var c;Array.isArray(k)||(k=[k,k,k]);var p=new Float32Array(18);for(c=0;6>c;c++)p[3*c]=a[c][0]*k[0],p[3*c+1]=a[c][1]*k[1],p[3*c+2]=a[c][2]*k[2];k={};k[m.POSITION]=new Uint32Array(d);k[m.NORMAL]=new Uint32Array(f);c={};c[m.POSITION]={size:3,data:p};c[m.NORMAL]={size:3,data:new Float32Array(b)};return new w(c,k)}}(),createTetrahedronGeometry:function(){var a=
b.createFrom(-.5,0,-.5),d=b.createFrom(.5,0,-.5),f=b.createFrom(0,0,.5),k=b.createFrom(0,.5,0),p=b.create(),c=b.create(),q=b.create(),x=b.create(),t=b.create();b.subtract(a,k,p);b.subtract(a,d,c);b.cross(p,c,q);b.normalize(q,q);b.subtract(d,k,p);b.subtract(d,f,c);b.cross(p,c,x);b.normalize(x,x);b.subtract(f,k,p);b.subtract(f,a,c);b.cross(p,c,t);b.normalize(t,t);var l=[a,d,f,k],z=[0,-1,0,q[0],q[1],q[2],x[0],x[1],x[2],t[0],t[1],t[2]],K=[0,1,2,3,1,0,3,2,1,3,0,2],J=[0,0,0,1,1,1,2,2,2,3,3,3];return function(a){var c;
Array.isArray(a)||(a=[a,a,a]);var b=new Float32Array(12);for(c=0;4>c;c++)b[3*c]=l[c][0]*a[0],b[3*c+1]=l[c][1]*a[1],b[3*c+2]=l[c][2]*a[2];a={};a[m.POSITION]=new Uint32Array(K);a[m.NORMAL]=new Uint32Array(J);c={};c[m.POSITION]={size:3,data:b};c[m.NORMAL]={size:3,data:new Float32Array(z)};return new w(c,a)}}(),createConeGeometry:function(a,d,f,k){var p=0,c=b.createFrom(0,p,0),r=b.createFrom(0,p+a,0),u=b.createFrom(0,-1,0),v=b.createFrom(0,1,0);k&&(p=a,r=b.createFrom(0,0,0),c=b.createFrom(0,p,0),u=b.createFrom(0,
1,0),v=b.createFrom(0,-1,0));var c=[r,c],u=[u,v],v=f+2,q=0,r=Math.sqrt(a*a+d*d);if(k)for(k=f-1;0<=k;k--)q=2*Math.PI/f*k,x=b.createFrom(Math.cos(q)*d,p,Math.sin(q)*d),c.push(x),q=b.createFrom(a*Math.cos(q)/r,-d/r,a*Math.sin(q)/r),u.push(q);else for(k=0;k<f;k++){var q=2*Math.PI/f*k,x=b.createFrom(Math.cos(q)*d,p,Math.sin(q)*d);c.push(x);q=b.createFrom(a*Math.cos(q)/r,d/r,a*Math.sin(q)/r);u.push(q)}a=new Uint32Array(6*(f+2));f=new Uint32Array(6*(f+2));p=d=0;for(k=3;k<c.length;k++)a[d++]=1,a[d++]=k-1,
a[d++]=k,f[p++]=0,f[p++]=0,f[p++]=0;a[d++]=c.length-1;a[d++]=2;a[d++]=1;f[p++]=0;f[p++]=0;f[p++]=0;for(k=3;k<c.length;k++)a[d++]=k,a[d++]=k-1,a[d++]=0,f[p++]=k,f[p++]=k-1,f[p++]=1;a[d++]=0;a[d++]=2;a[d++]=c.length-1;f[p++]=1;f[p++]=2;f[p++]=u.length-1;p=1;Array.isArray(p)||(p=[p,p,p]);d=new Float32Array(3*v);for(k=0;k<v;k++)d[3*k]=c[k][0]*p[0],d[3*k+1]=c[k][1]*p[1],d[3*k+2]=c[k][2]*p[2];c=new Float32Array(3*v);for(k=0;k<v;k++)c[3*k]=u[k][0],c[3*k+1]=u[k][1],c[3*k+2]=u[k][2];u={};u[m.POSITION]=a;u[m.NORMAL]=
f;v={};v[m.POSITION]={size:3,data:d};v[m.NORMAL]={size:3,data:c};return new w(v,u)},createCylinderGeometry:function(a,d,f,k,p,c){k||(k=b.createFrom(1,0,0));p||(p=b.createFrom(0,0,0));c=void 0===c?!0:c;var r=b.create();b.normalize(k,r);k=b.create();b.scale(r,Math.abs(a),k);var u=b.create();b.scale(k,-.5,u);b.add(u,p);var v=b.createFrom(0,1,0);Math.abs(.2>1-b.dot(r,v))&&b.set3(0,0,1,v);var q=b.create();b.cross(r,v,q);b.normalize(q);b.cross(q,r,v);var x=2*f+(c?2:0),t=f+(c?2:0);p=new Float32Array(3*x);
a=new Float32Array(3*t);var l=new Float32Array(2*x),z=new Uint32Array(3*f*(c?4:2)),C=new Uint32Array(3*f*(c?4:2));c&&(p[3*(x-2)+0]=u[0],p[3*(x-2)+1]=u[1],p[3*(x-2)+2]=u[2],l[2*(x-2)]=0,l[2*(x-2)+1]=0,p[3*(x-1)+0]=p[3*(x-2)+0]+k[0],p[3*(x-1)+1]=p[3*(x-2)+1]+k[1],p[3*(x-1)+2]=p[3*(x-2)+2]+k[2],l[2*(x-1)]=1,l[2*(x-1)+1]=1,a[3*(t-2)+0]=-r[0],a[3*(t-2)+1]=-r[1],a[3*(t-2)+2]=-r[2],a[3*(t-1)+0]=r[0],a[3*(t-1)+1]=r[1],a[3*(t-1)+2]=r[2]);var r=function(a,c,b){z[a]=c;C[a]=b},E,M,R=0,Q=b.create(),T=b.create();
for(E=0;E<f;E++)M=2*Math.PI/f*E,b.scale(v,Math.sin(M),Q),b.scale(q,Math.cos(M),T),b.add(Q,T),a[3*E+0]=Q[0],a[3*E+1]=Q[1],a[3*E+2]=Q[2],b.scale(Q,d),b.add(Q,u),p[3*E+0]=Q[0],p[3*E+1]=Q[1],p[3*E+2]=Q[2],l[2*E+0]=E/f,l[2*E+1]=0,p[3*(E+f)+0]=p[3*E+0]+k[0],p[3*(E+f)+1]=p[3*E+1]+k[1],p[3*(E+f)+2]=p[3*E+2]+k[2],l[2*(E+f)+0]=E/f,l[2*E+1]=1,M=(E+1)%f,r(R++,E,E),r(R++,E+f,E),r(R++,M,M),r(R++,M,M),r(R++,E+f,E),r(R++,M+f,M);if(c){for(E=0;E<f;E++)M=(E+1)%f,r(R++,x-2,t-2),r(R++,E,t-2),r(R++,M,t-2);for(E=0;E<f;E++)M=
(E+1)%f,r(R++,E+f,t-1),r(R++,x-1,t-1),r(R++,M+f,t-1)}d={};d[m.POSITION]=z;d[m.NORMAL]=C;d[m.UV0]=z;f={};f[m.POSITION]={size:3,data:p};f[m.NORMAL]={size:3,data:a};f[m.UV0]={size:2,data:l};return new w(f,d)},createTubeGeometry:function(a,b,d,k,m){d=d||10;k=null!=k?k:!0;f.assert(1<a.length);for(var c=[],p=[],r=0;r<d;r++){c.push([0,-r-1,-((r+1)%d)-1]);var u=r/d*2*Math.PI;p.push([Math.cos(u)*b,Math.sin(u)*b])}return z.createPathExtrusionGeometry(p,a,[[0,0,0]],c,k,m)},createPathExtrusionGeometry:function(a,
k,p,x,l,c){var r,u=a.length,v=new Float32Array(k.length*u*3+(6*p.length||0)),z=new Float32Array(k.length*u+(2*p.length||0)),C=new Float32Array(k.length*u*3+(p?6:0)),E=0,J=0,P=0,O=(k.length-1)*u*6+6*x.length,L=new Uint32Array(O),O=new Uint32Array(O),M=0,R=0,Q=b.create(),T=b.create(),A=b.create(),V=b.create();b.create();var S=b.create();b.create();b.create();var h=b.create(),e=b.create(),g=b.create(),n=b.create(),y=b.create();b.create();b.create();var F=b.create(),N=b.create(),U=b.create(),Y=q.create();
b.set3(0,1,0,n);b.subtract(k[1],k[0],T);b.normalize(T);l?(b.add(k[0],c,g),b.normalize(g,A)):b.set3(0,0,1,A);d(T,A,S,A,.99619469809)||d(T,n,S,A,.99619469809)||d(T,n,S,A,.99619469809);b.set(A,V);b.set(S,N);for(r=0;r<p.length;r++)b.scale(S,p[r][0],h),b.scale(A,p[r][2],g),b.add(h,g),b.add(h,k[0]),v[E++]=h[0],v[E++]=h[1],v[E++]=h[2],z[P++]=0;C[J++]=-T[0];C[J++]=-T[1];C[J++]=-T[2];for(r=0;r<x.length;r++)L[M++]=0<x[r][0]?x[r][0]:-x[r][0]-1+p.length,L[M++]=0<x[r][1]?x[r][1]:-x[r][1]-1+p.length,L[M++]=0<x[r][2]?
x[r][2]:-x[r][2]-1+p.length,O[R++]=0,O[R++]=0,O[R++]=0;var W=p.length;r=p.length-1;for(var ca,X=0;X<k.length;X++){ca=!1;if(0<X){b.set(T,Q);X<k.length-1?(b.subtract(k[X+1],k[X],T),b.normalize(T)):ca=!0;b.add(Q,T,y);b.normalize(y);b.add(k[X-1],V,F);Y[0]=y[0];Y[1]=y[1];Y[2]=y[2];Y[3]=-t.dot(y,k[X]);if(f.rayPlane(F,Q,Y,g))b.subtract(g,k[X]),b.normalize(g,A),b.cross(y,A,S),b.normalize(S);else{var aa=y,da=N,ea=n,ia=S,ba=A;d(aa,V,ia,ba,.99619469809)||d(aa,da,ia,ba,.99619469809)||d(aa,ea,ia,ba,.99619469809)}b.set(A,
V);b.set(S,N)}l&&(b.add(k[X],c,g),b.normalize(g,U));for(aa=0;aa<u;aa++)if(b.scale(S,a[aa][0],h),b.scale(A,a[aa][1],g),b.add(h,g),b.normalize(h,e),C[J++]=e[0],C[J++]=e[1],C[J++]=e[2],l?z[P++]=b.dot(h,U):z[P++]=h[2],b.add(h,k[X]),v[E++]=h[0],v[E++]=h[1],v[E++]=h[2],!ca)for(da=(aa+1)%u,L[M++]=W+aa,L[M++]=W+u+aa,L[M++]=W+da,L[M++]=W+da,L[M++]=W+u+aa,L[M++]=W+u+da,da=0;6>da;da++)O[R++]=L[M-6+da]-r;W+=u}ca=k[k.length-1];for(r=0;r<p.length;r++)b.scale(S,p[r][0],h),b.scale(A,p[r][1],g),b.add(h,g),b.add(h,
ca),v[E++]=h[0],v[E++]=h[1],v[E++]=h[2],z[P++]=0;a=J/3;C[J++]=T[0];C[J++]=T[1];C[J++]=T[2];u=W-u;for(r=0;r<x.length;r++)L[M++]=0<=x[r][0]?W+x[r][0]:-x[r][0]-1+u,L[M++]=0<=x[r][2]?W+x[r][2]:-x[r][2]-1+u,L[M++]=0<=x[r][1]?W+x[r][1]:-x[r][1]-1+u,O[R++]=a,O[R++]=a,O[R++]=a;x={};x[m.POSITION]=L;x[m.NORMAL]=O;L={};L[m.POSITION]={size:3,data:v};L.zOffset={size:1,data:z};L[m.NORMAL]={size:3,data:C};return new w(L,x)},createPolylineGeometry:function(a){f.assert(1<a.length,"createPolylineGeometry(): polyline needs at least 2 points");
f.assert(3===a[0].length,"createPolylineGeometry(): malformed vertex");for(var b=new Float32Array(3*a.length),d=new Uint32Array(2*(a.length-1)),k=0,p=0,c=0;c<a.length;c++){for(var q=0;3>q;q++)b[k++]=a[c][q];0<c&&(d[p++]=c-1,d[p++]=c)}a={};k={};a[m.POSITION]=d;k[m.POSITION]={size:3,data:b};return new w(k,a,w.DefaultOffsets,"line")},addVertexColors:function(a,b,d){var f,k,c;if(d){var p={};d=a.getVertexAttr();for(c in d)p[c]=d[c];a=a.getFaces();d=Array(a.length);for(k=0;k<a.length;k++){f={};for(c in a[k].indices)f[c]=
a[k].indices[c];d[k]={type:a[k].type,indices:f,positionKey:a[k].positionKey}}a=new w(d,p)}b=b||[1,1,1,1];c=new Uint8Array(4);c[0]=255*b[0];c[1]=255*b[1];c[2]=255*b[2];c[3]=255*(3<b.length?b[3]:1);a.getVertexAttr()[m.COLOR]={size:4,data:c};d=a.getFaces();for(k=0;k<d.length;k++)b=d[k],f=new Uint32Array(b.indices[b.positionKey].length),b.indices[m.COLOR]=f;return a},addNormals:function(a){var b=a.getVertexAttr();a=a.getFaces();for(var d=l.Vec3Compact.subtract,f=a.map(function(a){return a.indices.position.length/
3}).reduce(function(a,c){return a+c}),f=new Float32Array(3*f),k=b.position.data,c=0,m=0;m<a.length;m++){for(var q=a[m].indices.position,v=new Uint32Array(q.length),z=0;z<q.length;z+=3){d(k,3*q[z],k,3*q[z+2],x,0);d(k,3*q[z],k,3*q[z+1],p,0);t.cross(p,x);t.normalize(p);var H=c/3;f[c++]=p[0];f[c++]=p[1];f[c++]=p[2];v[z]=H;v[z+1]=H;v[z+2]=H}a[m].indices.normal=v}b.normal={size:3,data:f}},cgToGIS:function(a){var b=a.getVertexAttr();a=b.position.data;var b=b.normal.data,d,f;if(b)for(d=0;d<b.length;d+=3)f=
b[d+1],b[d+1]=-b[d+2],b[d+2]=f;if(a)for(d=0;d<a.length;d+=3)f=a[d+1],a[d+1]=-a[d+2],a[d+2]=f}};return z})},"esri/views/3d/webgl-engine/lib/GeometryData":function(){define(["require","exports","./Util","./ComponentUtils"],function(w,l,f,a){function d(a,b){var d=a.reduce(function(a,d){d=d.indices[b];return a+(null==d?0:d.length)},0),f=new Uint32Array(d),k=0,m=0;a.forEach(function(a){var d=a.indices[b];if(null!=d){var p=d.length,r=d.byteLength;f.set(d,k);a.indices[b]=new Uint32Array(f.buffer,m,p);k+=
p;m+=r}});return f}function b(a){var b={},d;d=f.getFirstObjectValue(a);d=d.data.length/d.size;if(d>q||null==t){for(;d>q;)q*=2;t=new Uint32Array(q);for(var m=0;m<q;m++)t[m]=m}d=new Uint32Array(t.buffer,0,d);for(var l in a)b[l]=d;return b}var q=1,t=null;return function(){function m(k,p,q,t){void 0===p&&(p=m.DefaultIndices);void 0===q&&(q=m.DefaultOffsets);void 0===t&&(t="triangle");var v=[],r={},u={},x=Array.isArray(k);x?(v=k,u=p):(u=k,r=p,r===m.DefaultIndices&&(r=b(u)));if(x)if(1<v.length&&(q=v.map(function(a){return a.componentRange[0]}),
q.push(v[v.length-1].componentRange[1]+1),q=new Uint32Array(q)),1===v.length){p=v[0];for(var l in u)k=p.indices,r[l]=k[l]}else for(l in u)r[l]=d(v,l);else{k=f.getFirstObjectValue(r).length;x=p=void 0;q===m.DefaultOffsets?(p=0,x=k):(p=q[0],x=q[q.length-1]);var c=x-p,z=p*Uint32Array.BYTES_PER_ELEMENT;k={};for(l in r)k[l]=new Uint32Array(r[l].buffer,z,c);v.push({type:t,positionKey:"position",indices:k,componentRange:[p,x-1]})}this._id=m.getNewId();this._faces=v;this._vertexAttributes=u;this._indices=
r;this._componentOffsets=a.createOffsets(q);this._primitiveType=t}Object.defineProperty(m.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"faces",{get:function(){return this._faces},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"indices",{get:function(){return this._indices},enumerable:!0,
configurable:!0});Object.defineProperty(m.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"indexCount",{get:function(){return this._indices.position.length},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"positionKey",{get:function(){return"position"},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,
configurable:!0});m.prototype.toRenderData=function(){return{id:this._id.toString(),faces:this._faces[0],vertexAttr:this._vertexAttributes}};m.prototype.estimateGpuMemoryUsage=function(){var a=0;this._indices.position&&(a+=12*this._indices.position.length);this._indices.normal&&(a+=12*this._indices.normal.length);this._indices.uv0&&(a+=8*this._indices.uv0.length);this._indices.color&&(a+=4*this._indices.color.length);return a};m.prototype.getId=function(){return this.id};m.prototype.getFaces=function(){return this.faces};
m.prototype.getVertexAttr=function(){return this.vertexAttributes};m.getNewId=function(){return m._id++};m._id=0;m.AxisOrder={CG:0,GIS:1};m.DefaultIndices={};m.DefaultOffsets=new Uint32Array(0);return m}()})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});(function(f){f.length=function(a,d){var b=a[d],f=a[d+1];a=a[d+2];return Math.sqrt(b*b+f*f+a*a)};f.normalize=function(a,d){var b=a[d],f=a[d+
1],t=a[d+2],b=1/Math.sqrt(b*b+f*f+t*t);a[d]*=b;a[d+1]*=b;a[d+2]*=b};f.scale=function(a,d,b){a[d]*=b;a[d+1]*=b;a[d+2]*=b};f.add=function(a,d,b,f,t,m){void 0===m&&(m=d);t=t||a;t[m]=a[d]+b[f];t[m+1]=a[d+1]+b[f+1];t[m+2]=a[d+2]+b[f+2]};f.subtract=function(a,d,b,f,t,m){void 0===m&&(m=d);t=t||a;t[m]=a[d]-b[f];t[m+1]=a[d+1]-b[f+1];t[m+2]=a[d+2]-b[f+2]}})(l.Vec3Compact||(l.Vec3Compact={}))})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("require exports ./IdGen ./Util ./DDSUtil ./gl-matrix ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/enums ./DefaultVertexBufferLayouts ./DefaultVertexAttributeLocations".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v){function r(b,c,d,f,k,m,p){p=!1!==p;var r=new Image;r.onerror=function(){m(null);r.onerror=void 0;r.onload=void 0};r.onload=function(){a.assert(1<=r.width&&1<=r.height);d.samplingMode=p?9987:9729;d.hasMipmap=p;if(!p&&33071===d.wrapMode||a.isPowerOfTwo(r.width)&&a.isPowerOfTwo(r.height))d.width=r.width,d.height=r.height,c=new t(b,d,r);else var c=u(b,r,d,f,k);b.bindTexture(c);m(c);r.onerror=void 0;r.onload=void 0};r.src=c}function u(b,c,d,f,r){var u=a.nextHighestPowerOfTwo(c.width),
x=a.nextHighestPowerOfTwo(c.height);a.assert(u!==c.width||x!==c.height);d.width=u;d.height=x;var l=new t(b,d),B=q.createWithAttachments(b,l,{colorTarget:0,depthStencilTarget:0});c=new t(b,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!!d.flipped,maxAnisotropy:8,preMultiplyAlpha:d.preMultiplyAlpha},c);b.bindFramebuffer(B);void 0===r&&(r=b.getViewport(),r=[r.x,r.y,r.width,r.height]);b.setViewport(0,0,u,x);f=f.get("texOnly");u=C.identity();b.bindProgram(f);f.setUniformMatrix4fv("model",
u);f.setUniformMatrix4fv("view",u);f.setUniformMatrix4fv("proj",u);f.setUniform4f("color",1,1,1,1);f.setUniform1i("tex",0);f=new k(b,v.Default3D,{geometry:z.Pos3Tex},{geometry:p.createVertex(b,35044,a.createQuadVertexUvBuffer())});b.bindTexture(c,0);b.bindVAO(f);b.setDepthTestEnabled(!1);b.setBlendingEnabled(!1);b.drawArrays(5,0,m.vertexCount(f,"geometry"));b.setDepthTestEnabled(!0);b.bindFramebuffer(null);b.setViewport(r[0],r[1],r[2],r[3]);f.dispose(!0);c.dispose();b.bindFramebuffer(null);B.detachColorTexture();
B.dispose();d.hasMipmap&&l.generateMipmap();return l}var C=b.mat4d;return function(){function b(a,d,f){this.data=a;this.id=b.idGen.gen(d);this.unloadFunc=void 0;this.params=f||{};this.params.wrapClamp=this.params.wrapClamp||!1;this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1;this.estimatedTexMemRequiredMB=b.estimateTexMemRequiredMB(this.data,this.params)}b.estimateTexMemRequiredMB=function(a,
b){return null==a?0:a instanceof ArrayBuffer||a instanceof Uint8Array?a.byteLength/1E6:a instanceof Image||a instanceof ImageData||a instanceof HTMLCanvasElement?1.3*a.width*a.height*4/1E6:1.3*b.width*b.height*4/1E6||0};b.prototype.getId=function(){return this.id};b.prototype.getEstimatedTexMemRequiredMB=function(){return this.estimatedTexMemRequiredMB};b.prototype.dispose=function(){this.data=void 0};b.prototype.deferredLoading=function(){return"string"===typeof this.data};b.prototype.getWidth=function(){return this.params.width};
b.prototype.getHeight=function(){return this.params.height};b.prototype.initializeThroughUpload=function(c,f,k,m,p){var q=this.data;f.flipped=!this.params.noUnpackFlip;f.samplingMode=this.params.mipmap?9987:9729;f.hasMipmap=this.params.mipmap;f.wrapMode=this.params.wrapClamp?33071:10497;f.preMultiplyAlpha=this.params.preMultiplyAlpha;if("string"===typeof q)r(c,q,f,k,m,p,this.params.mipmap);else{if(q instanceof Image||q instanceof ImageData||q instanceof HTMLCanvasElement)this.params.width=q.width,
this.params.height=q.height,!this.params.mipmap&&this.params.wrapClamp||a.isPowerOfTwo(q.width)&&a.isPowerOfTwo(q.height)?(f.width=q.width,f.height=q.height,f=new t(c,f,q)):f=u(c,q,f,k,m);else if(q instanceof ArrayBuffer&&this.params.encoding===b.DDS_ENCODING)f=d.createDDSTexture(c,f,q,this.params.mipmap);else if(q instanceof Uint8Array&&this.params.encoding===b.DDS_ENCODING)f=d.createDDSTexture(c,f,q.buffer,this.params.mipmap);else if(q instanceof Uint8Array)a.assert(0<this.params.width&&0<this.params.height),
f.pixelFormat=1===this.params.components?6409:6408,f.width=this.params.width,f.height=this.params.height,f=new t(c,f,q);else{if(null!==q)throw console.warn("Unsupported image data"),Error("Unsupported image data");f=new t(c,f,null)}c.bindTexture(f);p(f)}this.data=void 0};b.prototype.setUnloadFunc=function(a){this.unloadFunc=a};b.prototype.unload=function(){void 0!==this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)};b.idGen=new f;b.DDS_ENCODING="image/vnd-ms.dds";return b}()})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["require",
"exports","../../../webgl/Texture","../../../webgl/enums"],function(w,l,f,a){function d(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}Object.defineProperty(l,"__esModule",{value:!0});var b=d("DXT1"),q=d("DXT3"),t=d("DXT5");l.createDDSTexture=function(a,d,p,x){var k=new Int32Array(p,0,31);if(542327876!==k[0])return console.error("Invalid magic number in DDS header"),null;if(!(k[20]&4))return console.error("Unsupported format, must contain a FourCC code"),
null;var m=k[21],r;switch(m){case b:m=8;r=33776;break;case q:m=16;r=33778;break;case t:m=16;r=33779;break;default:return console.error("Unsupported FourCC code:",String.fromCharCode(m&255,m>>8&255,m>>16&255,m>>24&255)),null}var u=1;k[2]&131072&&!1!==x&&(u=Math.max(1,k[7]));x=k[4];var l=k[3],E=k[1]+4,c,D;d.samplingMode=1<u?9987:9729;d.hasMipmap=1<u;d.width=k[4];d.height=k[3];d=new f(a,d);a.bindTexture(d);for(k=0;;++k){k<u&&(D=Math.floor((x+3)/4)*Math.floor((l+3)/4)*m,c=new Uint8Array(p,E,D));a.gl.compressedTexImage2D(a.gl.TEXTURE_2D,
k,r,x,l,0,c);E+=D;if(1===x&&1===l||1===u)break;x=Math.max(1,x>>1);l=Math.max(1,l>>1)}return d}})},"esri/views/webgl/Texture":function(){define(["require","exports"],function(w,l){return function(){function f(a,d,b){this._glName=this._context=null;this._id=-1;this._desc=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;this._boundToUnits=new Set;this._context=a;this._desc={pixelFormat:d.pixelFormat,internalFormat:d.internalFormat,dataType:d.dataType,target:d.target?d.target:3553,samplingMode:d.samplingMode?
d.samplingMode:9729,wrapMode:d.wrapMode?d.wrapMode:10497,maxAnisotropy:d.maxAnisotropy,flipped:void 0!==d.flipped?d.flipped:!1,hasMipmap:void 0!==d.hasMipmap?d.hasMipmap:!1,level:void 0!==d.level?d.level:0,unpackAlignment:d.unpackAlignment?d.unpackAlignment:4,width:d.width,height:d.height,preMultiplyAlpha:void 0!==d.preMultiplyAlpha?d.preMultiplyAlpha:!1};this._id=++f._nextId;this.setData(b)}Object.defineProperty(f.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});f.prototype.dispose=function(){var a=this;if(this._context){if(this._glName){var d=this._context.gl;this._boundToUnits.forEach(function(b){a._context.bindTexture(null,b)});d.deleteTexture(this._glName);this._glName=null}this._context=null}};f.prototype.resize=function(a,d){var b=this._desc;if(b.width!==a||b.height!==
d)b.width=a,b.height=d,this.setData(null)};f.prototype.setData=function(a){var d=this._context.gl;this._glName||(this._glName=d.createTexture());void 0===a&&(a=null);null===a&&(this._desc.width=this._desc.width||4,this._desc.height=this._desc.height||4);var b=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var q=this._desc;f._validateTexture(q);d.pixelStorei(d.UNPACK_ALIGNMENT,q.unpackAlignment);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,q.flipped?1:0);d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
q.preMultiplyAlpha);a instanceof ImageData||a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement?(q.width&&q.height&&console.assert(a.width===q.width&&a.height===q.height),d.texImage2D(d.TEXTURE_2D,q.level,q.internalFormat?q.internalFormat:q.pixelFormat,q.pixelFormat,q.dataType,a),void 0===this._desc.width&&(this._desc.width=a.width),void 0===this._desc.height&&(this._desc.height=a.height)):(null!=q.width&&null!=q.height||console.error("Width and height must be specified!"),
d.texImage2D(d.TEXTURE_2D,q.level,q.internalFormat?q.internalFormat:q.pixelFormat,q.width,q.height,0,q.pixelFormat,q.dataType,a));q.hasMipmap&&this.generateMipmap();f._applySamplingMode(d,this._desc);f._applyWrapMode(d,this._desc);f._applyAnisotropicFilteringParameters(this._context,this._desc);this._context.bindTexture(b,0)};f.prototype.updateData=function(a,d,b,f,l,m){m||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");
var k=this._context.gl,p=this._desc,q=this._context.getBoundTexture(0);this._context.bindTexture(this,0);(0>d||0>b||f>p.width||l>p.height||d+f>p.width||b+l>p.height)&&console.error("An attempt to update out of bounds of the texture!");m instanceof ImageData||m instanceof HTMLImageElement||m instanceof HTMLCanvasElement||m instanceof HTMLVideoElement?(console.assert(m.width===f&&m.height===l),k.texSubImage2D(k.TEXTURE_2D,a,d,b,p.pixelFormat,p.dataType,m)):k.texSubImage2D(k.TEXTURE_2D,a,d,b,f,l,p.pixelFormat,
p.dataType,m);this._context.bindTexture(q,0)};f.prototype.generateMipmap=function(){var a=this._desc;a.hasMipmap||(a.hasMipmap=!0,f._validateTexture(a));9729===a.samplingMode?(this._samplingModeDirty=!0,a.samplingMode=9985):9728===a.samplingMode&&(this._samplingModeDirty=!0,a.samplingMode=9984);a=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var d=this._context.gl;d.generateMipmap(d.TEXTURE_2D);this._context.bindTexture(a,0)};f.prototype.setSamplingMode=function(a){a!==this._desc.samplingMode&&
(this._desc.samplingMode=a,f._validateTexture(this._desc),this._samplingModeDirty=!0)};f.prototype.setWrapMode=function(a){a!==this._desc.wrapMode&&(this._desc.wrapMode=a,f._validateTexture(this._desc),this._wrapModeDirty=!0)};f.prototype.applyChanges=function(){var a=this._context.gl,d=this._desc;this._samplingModeDirty&&(f._applySamplingMode(a,d),this._samplingModeDirty=!1);this._wrapModeDirty&&(f._applyWrapMode(a,d),this._wrapModeDirty=!1)};f.prototype.setBoundToUnit=function(a,d){d?this._boundToUnits.add(a):
this._boundToUnits.delete(a)};f._isPowerOfTwo=function(a){return 0===(a&a-1)};f._validateTexture=function(a){(0>a.width||0>a.height)&&console.error("Negative dimension parameters are not allowed!");f._isPowerOfTwo(a.width)&&f._isPowerOfTwo(a.height)||(33071!==a.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),a.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};f._applySamplingMode=function(a,d){var b=d.samplingMode;if(9985===b||9987===
b)b=9729;else if(9984===b||9986===b)b=9728;a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,b);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,d.samplingMode)};f._applyWrapMode=function(a,d){a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,d.wrapMode);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,d.wrapMode)};f._applyAnisotropicFilteringParameters=function(a,d){if(null!=d.maxAnisotropy){var b=a.extensions.textureFilterAnisotropic;b&&(a=a.gl,a.texParameterf(a.TEXTURE_2D,b.TEXTURE_MAX_ANISOTROPY_EXT,
d.maxAnisotropy))}};f._nextId=0;return f}()})},"esri/views/webgl/FramebufferObject":function(){define(["require","exports","./Texture"],function(w,l,f){return function(){function a(d,b,q,l){this._colorAttachment=this._stencilAttachment=this._depthAttachment=this._glName=this._context=null;this._initialized=!1;this._context=d;this._desc={colorTarget:b.colorTarget,depthStencilTarget:b.depthStencilTarget,width:b.width,height:b.height,multisampled:b.multisampled};this._id=a._nextId++;q&&(d=void 0,q instanceof
f?(this._colorAttachment=q,d=q.descriptor):(d=q,this._colorAttachment=new f(this._context,d)),0!==this._desc.colorTarget&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),a._validateTextureDimensions(d,this._desc));l&&(this._context.extensions.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),q=void 0,l instanceof
f?(this._depthStencilTexture=l,q=this._depthStencilTexture.descriptor):(q=l,this._depthStencilTexture=new f(this._context,q)),a._validateTextureDimensions(q,this._desc))}a.create=function(d,b){return new a(d,b)};a.createWithAttachments=function(d,b,f,l){return new a(d,f,b,l)};Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof f?this._colorAttachment:null},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this._context&&this._glName&&(this._disposeColorAttachment(),this._disposeDepthStencilAttachments(),this._context.gl.deleteFramebuffer(this._glName),this._glName=null)};a.prototype.attachColorTexture=function(d){if(d){a._validateTextureDimensions(d.descriptor,this._desc);this._disposeColorAttachment();if(this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;b.framebufferTexture2D(b.FRAMEBUFFER,
b.COLOR_ATTACHMENT0,b.TEXTURE_2D,d.glName,0)}this._colorAttachment=d}};a.prototype.detachColorTexture=function(){var a=void 0;if(this._colorAttachment instanceof f){a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;this._context.gl.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0)}this._colorAttachment=null}return a};a.prototype.attachDepthStencilTexture=function(d){if(d){var b=d.descriptor;34041!==b.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");
34042!==b.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");this._context.extensions.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");a._validateTextureDimensions(b,this._desc);4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),b=this._context.gl,b.framebufferTexture2D(b.FRAMEBUFFER,
b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,d.glName,0));this._depthStencilTexture=d}};a.prototype.detachDepthStencilTexture=function(){var a=this._depthStencilTexture;if(a&&this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;this._context.gl.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,null,0)}this._depthStencilTexture=null;return a};a.prototype.copyToTexture=function(a,b,f,l,m,k,p){(0>a||0>b||0>m||0>k)&&console.error("Offsets cannot be negative!");
(0>=f||0>=l)&&console.error("Copy width and height must be greater than zero!");var d=this._desc,q=p.descriptor;3553!==p.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");(a+f>d.width||b+l>d.height||m+f>q.width||k+l>q.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");d=this._context;d.bindTexture(p);d.bindFramebuffer(this);d.gl.copyTexSubImage2D(3553,0,m,k,a,b,f,l)};a.prototype.readPixels=function(a,b,f,l,m,k,p){(0>=
f||0>=l)&&console.error("Copy width and height must be greater than zero!");p||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(a,b,f,l,m,k,p)};a.prototype.resize=function(d,b){var q=this._desc;if(q.width!==d||q.height!==b)if(this._initialized)q.width=d,q.height=b,this._colorAttachment instanceof f?(l=this._colorAttachment,q=l.descriptor,q.width=d,q.height=b,this._colorAttachment.dispose(),this._colorAttachment=new f(this._context,
q),a._validateTextureDimensions(l.descriptor,this._desc)):this._colorAttachment&&this._disposeColorAttachment(),null!=this._depthStencilTexture?(q=this._depthStencilTexture.descriptor,q.width=d,q.height=b,this._depthStencilTexture.dispose(),this._depthStencilTexture=new f(this._context,q)):(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments(),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1;else{q.width=d;
q.height=b;if(this._colorAttachment instanceof f){var l=this._colorAttachment;l.resize(d,b)}this._depthStencilTexture&&this._depthStencilTexture.resize(d,b)}};a.prototype.initialize=function(){if(this._initialized)return!1;var a=this._context.gl;this._glName&&a.deleteFramebuffer(this._glName);var b=a.createFramebuffer(),q=this._desc;a.bindFramebuffer(a.FRAMEBUFFER,b);if(!this._colorAttachment)if(0===q.colorTarget)this._colorAttachment=new f(this._context,{target:3553,pixelFormat:6408,dataType:5121,
samplingMode:9728,wrapMode:33071,width:q.width,height:q.height});else{var l=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,l);a.renderbufferStorage(a.RENDERBUFFER,a.RGBA4,q.width,q.height);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,l);this._colorAttachment=l}this._colorAttachment instanceof f&&a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this._colorAttachment.glName,0);switch(q.depthStencilTarget){case 1:case 3:l=a.createRenderbuffer();
a.bindRenderbuffer(a.RENDERBUFFER,l);var m=1===q.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT;a.renderbufferStorage(a.RENDERBUFFER,1===q.depthStencilTarget?a.DEPTH_COMPONENT16:a.DEPTH_STENCIL,q.width,q.height);a.framebufferRenderbuffer(a.FRAMEBUFFER,m,a.RENDERBUFFER,l);this._depthAttachment=l;break;case 2:l=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,l);a.renderbufferStorage(a.RENDERBUFFER,a.STENCIL_INDEX8,q.width,q.height);a.framebufferRenderbuffer(a.FRAMEBUFFER,
a.STENCIL_ATTACHMENT,a.RENDERBUFFER,l);this._stencilAttachment=l;break;case 4:this._depthStencilTexture||(this._context.extensions.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new f(this._context,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:q.width,height:q.height})),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,
a.TEXTURE_2D,this._depthStencilTexture.glName,0)}a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=b;return this._initialized=!0};a.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof f){var a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0)}a.dispose()}else this._colorAttachment instanceof
WebGLRenderbuffer&&(a=this._colorAttachment,b=this._context.gl,this._initialized&&(this._context.bindFramebuffer(this),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(a));this._colorAttachment=null};a.prototype._disposeDepthStencilAttachments=function(){var a=this._context.gl;if(this._depthAttachment){if(this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;b.framebufferRenderbuffer(b.FRAMEBUFFER,1===this._desc.depthStencilTarget?
b.DEPTH_ATTACHMENT:b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,null)}a.deleteRenderbuffer(this._depthAttachment);this._depthAttachment=null}this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),b=this._context.gl,b.framebufferRenderbuffer(b.FRAMEBUFFER,b.STENCIL_ATTACHMENT,b.RENDERBUFFER,null)),a.deleteRenderbuffer(this._stencilAttachment),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),a=this._context.gl,
a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};a._validateTextureDimensions=function(a,b){console.assert(0<=a.width&&0<=a.height);3553!==a.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==b.width&&0<=b.width&&void 0!==b.height&&0<=b.height?b.width===a.width&&b.height===a.height||console.error("Color attachment texture must match the framebuffer's!"):(b.width=a.width,b.height=
a.height)};a._nextId=0;return a}()})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});l.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}];l.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}];l.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},
{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];l.Pos3TexCol=[{name:"position",count:3,type:5126,offset:0,stride:24,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:24,normalized:!1},{name:"color",count:4,type:5121,offset:20,stride:24,normalized:!1}];l.Pos3TexRegion=[{name:"position",count:3,type:5126,offset:0,stride:28,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:28,normalized:!1},{name:"region",count:4,type:5123,offset:20,stride:28,normalized:!1}];
l.Pos3TexRegionCol=[{name:"position",count:3,type:5126,offset:0,stride:44,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:44,normalized:!1},{name:"region",count:4,type:5123,offset:32,stride:44,normalized:!1},{name:"color",count:4,type:5121,offset:40,stride:44,normalized:!1}];l.Pos3Norm=[{name:"position",count:3,type:5126,offset:0,stride:24,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:24,normalized:!1}];l.Pos3NormTex=[{name:"position",count:3,type:5126,offset:0,stride:32,
normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:32,normalized:!1}];l.Pos3NormCol=[{name:"position",count:3,type:5126,offset:0,stride:28,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:28,normalized:!1},{name:"color",count:4,type:5121,offset:24,stride:28,normalized:!1}];l.Pos3NormTexCol=[{name:"position",count:3,type:5126,offset:0,stride:36,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:36,
normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:36,normalized:!1},{name:"color",count:4,type:5121,offset:32,stride:36,normalized:!1}];l.Pos3NormTexRegion=[{name:"position",count:3,type:5126,offset:0,stride:40,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:40,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:40,normalized:!1},{name:"region",count:4,type:5123,offset:32,stride:40,normalized:!1}];l.Pos3NormTexRegionCol=[{name:"position",count:3,type:5126,offset:0,
stride:44,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:44,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:44,normalized:!1},{name:"region",count:4,type:5123,offset:32,stride:44,normalized:!1},{name:"color",count:4,type:5121,offset:40,stride:44,normalized:!1}];l.Pos3NormSymcol=[{name:"position",count:3,type:5126,offset:0,stride:28,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:28,normalized:!1},{name:"symbolColor",count:4,type:5121,offset:24,stride:28,
normalized:!1}];l.Pos3NormTexSymcol=[{name:"position",count:3,type:5126,offset:0,stride:36,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:36,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:36,normalized:!1},{name:"symbolColor",count:4,type:5121,offset:32,stride:36,normalized:!1}];l.Pos3NormColSymcol=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"color",count:4,type:5121,
offset:24,stride:32,normalized:!1},{name:"symbolColor",count:4,type:5121,offset:28,stride:32,normalized:!1}];l.Pos3NormTexColSymcol=[{name:"position",count:3,type:5126,offset:0,stride:40,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:40,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:40,normalized:!1},{name:"color",count:4,type:5121,offset:32,stride:40,normalized:!1},{name:"symbolColor",count:4,type:5121,offset:36,stride:40,normalized:!1}];l.Pos3NormTexRegionSymcol=
[{name:"position",count:3,type:5126,offset:0,stride:44,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:44,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:44,normalized:!1},{name:"region",count:4,type:5123,offset:32,stride:44,normalized:!1},{name:"symbolColor",count:4,type:5121,offset:40,stride:44,normalized:!1}];l.Pos3NormTexRegionColSymcol=[{name:"position",count:3,type:5126,offset:0,stride:48,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:48,normalized:!1},
{name:"uv0",count:2,type:5126,offset:24,stride:48,normalized:!1},{name:"region",count:4,type:5123,offset:32,stride:48,normalized:!1},{name:"color",count:4,type:5121,offset:40,stride:48,normalized:!1},{name:"symbolColor",count:4,type:5121,offset:44,stride:48,normalized:!1}];l.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];l.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}];l.Model=
[{name:"model",count:16,type:5126,offset:0,stride:128,normalized:!1,divisor:1},{name:"modelNormal",count:16,type:5126,offset:64,stride:128,normalized:!1,divisor:1}];l.ModelCol=[{name:"model",count:16,type:5126,offset:0,stride:144,normalized:!1,divisor:1},{name:"modelNormal",count:16,type:5126,offset:64,stride:144,normalized:!1,divisor:1},{name:"instanceColor",count:4,type:5126,offset:128,stride:144,normalized:!1,divisor:1}]})},"esri/views/3d/webgl-engine/lib/GLTextureRep":function(){define("require exports ./Util ../../../../core/Logger ../../../webgl/Texture ../../../webgl/enums".split(" "),
function(w,l,f,a,d,b){var q=a.getLogger("esri.views.3d.webgl-engine.lib.GLTextureRep"),t=function(){function a(a){this._glTexture=null;this._refCount=0;this._glTexture=a}a.prototype.incRefCnt=function(){++this._refCount};a.prototype.decRefCnt=function(){--this._refCount;f.assert(0<=this._refCount)};a.prototype.getRefCnt=function(){return this._refCount};a.prototype.setGLTexture=function(a){this._glTexture=a};a.prototype.getGLTexture=function(){return this._glTexture};return a}();return function(){function a(a,
b,d,f){this.NUM_PARALLEL=8;this.textures=a;this._programRepository=b;this.getViewportToRestore=d;this._rctx=f;this.NUM_PARALLEL=8;this.id2textureRef={};this.loading={};this._queue=[];this.listeners=[];this.maxMaxAnisotropy=(this.afExt=f.extensions.textureFilterAnisotropic)?f.parameters.maxMaxAnisotropy:1;this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy);this._needsRender=!0;this._fallbackTextureData=new Uint8Array(256);this._fallbackTextureTransparentData=new Uint8Array(256);for(a=0;a<this._fallbackTextureData.length;++a)this._fallbackTextureData[a]=
255,this._fallbackTextureTransparentData[a]=0!==(a+1)%4?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8}}a.prototype.resetNeedsRender=function(){this._needsRender=!1};a.prototype.needsRender=function(){return this._needsRender};a.prototype.aquire=function(a,b,m,l){var k=this,p=this.id2textureRef[a];if(null==p){b=this.textures[a];f.assert(void 0!==b);b.setUnloadFunc(this._unload.bind(this));m=!0===m;var u=this._createGLTextureDescription(b),
p=new t(m?new d(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData):new d(this._rctx,this._fallbackTextureDesc,this._fallbackTextureData));f.assert(null==this.id2textureRef[a]);this.id2textureRef[a]=p;if(b.initializeThroughRender)a=b.initializeThroughRender(this._rctx,u),p.setGLTexture(a),l&&l(p);else if(b.deferredLoading())this.getLoadingCount()<this.NUM_PARALLEL?this._loadImage(a,u,l):this._queue.push([a,u,l]);else try{b.initializeThroughUpload(this._rctx,u,this._programRepository,
this.getViewportToRestore(),function(a){p.setGLTexture(a);k._needsRender=!0;l&&l(p)})}catch(C){q.error("#aquire","Error loading texture: "+C.toString()),p=new t(new d(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData))}this._needsRender=!0}p.incRefCnt();return p};a.prototype.release=function(a){a=this.id2textureRef[a];void 0!==a&&(a.decRefCnt(),f.assert(0<=a.getRefCnt()))};a.prototype.getLoadingCount=function(){return Object.keys(this.loading).length};a.prototype.getIsLoaded=
function(a){if(null==this.id2textureRef[a]||void 0!==this.loading[a])return!1;for(var b=0;b<this._queue.length;++b)if(this._queue[b][0]===a)return!1;return!0};a.prototype.addTextureListener=function(a){f.assert(-1===this.listeners.indexOf(a));this.listeners.push(a)};a.prototype.removeTextureListener=function(a){a=this.listeners.indexOf(a);f.assert(-1!==a);this.listeners.splice(a,1)};a.prototype.getTexture=function(a){return this.textures[a]};a.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy};
a.prototype._unload=function(a){var b=this.id2textureRef[a];void 0!==b&&(b.getGLTexture().dispose(),delete this.id2textureRef[a]);this.next(a)};a.prototype._createGLTextureDescription=function(a){return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&a.params&&a.params.mipmap&&!a.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:a.params&&a.params.wrapClamp?33071:void 0}};a.prototype.next=function(a){if(a in this.loading){delete this.loading[a];var b=Object.keys(this.id2textureRef),
d=Object.keys(this.loading);this.listeners.forEach(function(f){f(a,b,d)});this.processQueue()}};a.prototype._loadImage=function(a,b,d){var k=this;f.assert(null==this.loading[a]);this.loading[a]=!0;var m=this.textures[a];f.assert(void 0!==m);setTimeout(function(){var f=k.id2textureRef[a];f&&f.getRefCnt()&&m.initializeThroughUpload(k._rctx,b,k._programRepository,k.getViewportToRestore(),function(b){k.next(a);k._needsRender=!0;f&&f.getRefCnt()&&(f.setGLTexture(b),d&&d(f))})},0)};a.prototype.processQueue=
function(){for(var a=[],b=0;b<this._queue.length;++b){var d=this._queue[b][0],f=this.id2textureRef[d];void 0!==f&&(0===f.getRefCnt()?(f.getGLTexture().dispose(),delete this.id2textureRef[d]):a.push(this._queue[b]))}this._queue=a;a=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,this._queue.length);for(b=0;b<a;++b)this._loadImage(this._queue[b][0],this._queue[b][1],this._queue[b][2]);this._queue.splice(0,a)};return a}()})},"esri/views/3d/webgl-engine/lib/RenderPass":function(){define(["require",
"exports"],function(w,l){var f;w=f||(f={});w[w.MATERIAL=0]="MATERIAL";w[w.MATERIAL_DEPTH=1]="MATERIAL_DEPTH";w[w.MATERIAL_NORMAL=2]="MATERIAL_NORMAL";w[w.MATERIAL_DEPTH_SHADOWMAP=3]="MATERIAL_DEPTH_SHADOWMAP";w[w.MATERIAL_HIGHLIGHT=4]="MATERIAL_HIGHLIGHT";w[w.MAX_PASS=5]="MAX_PASS";return f})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["require","exports"],function(w,l){var f;w=f||(f={});w[w.BACKGROUND=0]="BACKGROUND";w[w.INTERNAL_MATERIAL=1]="INTERNAL_MATERIAL";w[w.STENCIL_MATERIAL=
2]="STENCIL_MATERIAL";w[w.OPAQUE_TERRAIN=3]="OPAQUE_TERRAIN";w[w.OPAQUE_MATERIAL=4]="OPAQUE_MATERIAL";w[w.OPAQUE_EXTERNAL=5]="OPAQUE_EXTERNAL";w[w.TRANSPARENT_MATERIAL=6]="TRANSPARENT_MATERIAL";w[w.TRANSPARENT_EXTERNAL=7]="TRANSPARENT_EXTERNAL";w[w.TRANSPARENT_TERRAIN=8]="TRANSPARENT_TERRAIN";w[w.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS";w[w.POSTPROCESSING_HIGHLIGHT=10]="POSTPROCESSING_HIGHLIGHT";w[w.POSTPROCESSING_ATMOSPHERE=11]="POSTPROCESSING_ATMOSPHERE";w[w.HUDMATERIAL1=12]="HUDMATERIAL1";w[w.HUDMATERIAL2=
13]="HUDMATERIAL2";w[w.LINE_CALLOUTS=14]="LINE_CALLOUTS";w[w.LINE_CALLOUTS_HUD_DEPTH=15]="LINE_CALLOUTS_HUD_DEPTH";w[w.MAX_SLOTS=16]="MAX_SLOTS";return f})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define([],function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/webgl/Program":function(){define(["require","exports","dojo/has"],function(w,l,f){return function(){function a(d,b,f,l,m){void 0===m&&(m={});this._glName=this._context=null;this._locations={};this._id=void 0;this._initialized=!1;this._fShader=this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4=
{};d||console.error("RenderingContext isn't initialized!");0===b.length&&console.error("Shaders source should not be empty!");this._context=d;this._vertexShaderSource=b;this._fragmentShaderSource=f;if(Array.isArray(m))for(d=0;d<m.length;d++)this._defines[m[d]]="1";else this._defines=m;this._id=a._nextId++;this._locations=l}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});a.prototype.getDefine=function(a){return this._defines[a]};a.prototype.dispose=function(){if(this._context){var a=this._context.gl;this._vShader&&(a.deleteShader(this._vShader),this._vShader=null);this._fShader&&(a.deleteShader(this._fShader),this._fShader=null);this._glName&&(a.deleteProgram(this._glName),this._glName=null);this._context=null}};a.prototype.initialize=
function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var a=this._context.gl,b=a.createProgram();a.attachShader(b,this._vShader);a.attachShader(b,this._fShader);for(var f in this._locations)a.bindAttribLocation(b,this._locations[f],f);a.linkProgram(b);a.getProgramParameter(b,a.LINK_STATUS)||console.error("Could not initialize shader\nVALIDATE_STATUS: "+a.getProgramParameter(b,
a.VALIDATE_STATUS)+", gl error ["+a.getError()+"]infoLog: "+a.getProgramInfoLog(b));this._glName=b;this._initialized=!0}};a.prototype.getUniformLocation=function(a){this.initialize();void 0===this._nameToUniformLocation[a]&&(this._nameToUniformLocation[a]=this._context.gl.getUniformLocation(this._glName,a));return this._nameToUniformLocation[a]};a.prototype.hasUniform=function(a){return null!==this.getUniformLocation(a)};a.prototype.getAttribLocation=function(a){this.initialize();void 0===this._nameToAttribLocation[a]&&
(this._nameToAttribLocation[a]=this._context.gl.getAttribLocation(this._glName,a));return this._nameToAttribLocation[a]};a.prototype.setUniform1i=function(a,b){var d=this._nameToUniform1[a];if(void 0===d||b!==d)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(a),b),this._nameToUniform1[a]=b};a.prototype.setUniform1f=function(a,b){var d=this._nameToUniform1[a];if(void 0===d||b!==d)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(a),
b),this._nameToUniform1[a]=b};a.prototype.setUniform1fv=function(d,b){var f=this._nameToUniform2[d];void 0!==f&&a._arraysEqual(b,f)||(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(d),b),void 0===f?this._nameToUniform2[d]=new Float32Array(b):f.set(b))};a.prototype.setUniform2f=function(a,b,f){var d=this._nameToUniform2[a];if(void 0===d||b!==d[0]||f!==d[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(a),b,f),void 0===d?this._nameToUniform2[a]=
new Float32Array([b,f]):(d[0]=b,d[1]=f)};a.prototype.setUniform2fv=function(d,b){var f=this._nameToUniform2[d];void 0!==f&&a._arraysEqual(b,f)||(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(d),b),void 0===f?this._nameToUniform2[d]=new Float32Array(b):f.set(b))};a.prototype.setUniform3f=function(a,b,f,l){var d=this._nameToUniform3[a];if(void 0===d||b!==d[0]||f!==d[1]||l!==d[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(a),
b,f,l),void 0===d?this._nameToUniform3[a]=new Float32Array([b,f,l]):(d[0]=b,d[1]=f,d[2]=l)};a.prototype.setUniform3fv=function(d,b){var f=this._nameToUniform3[d];void 0!==f&&a._arraysEqual(b,f)||(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(d),b),void 0===f?this._nameToUniform3[d]=new Float32Array(b):f.set(b))};a.prototype.setUniform4f=function(a,b,f,l,m){var d=this._nameToUniform4[a];if(void 0===d||b!==d[0]||f!==d[1]||l!==d[2]||m!==d[3])this._context.bindProgram(this),
this._context.gl.uniform4f(this.getUniformLocation(a),b,f,l,m),void 0===d?this._nameToUniform4[a]=new Float32Array([b,f,l,m]):(d[0]=b,d[1]=f,d[2]=l,d[3]=m)};a.prototype.setUniform4fv=function(d,b){var f=this._nameToUniform4[d];void 0!==f&&a._arraysEqual(b,f)||(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(d),b),void 0===f?this._nameToUniform4[d]=new Float32Array(b):f.set(b))};a.prototype.setUniformMatrix3fv=function(d,b,f){void 0===f&&(f=!1);var q=this._nameToUniformMatrix3[d];
void 0!==q&&(9===q.length?a._matrix3Equal(q,b):a._arraysEqual(b,q))||(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(d),f,b),void 0===q?this._nameToUniformMatrix3[d]=new Float32Array(b):q.set(b))};a.prototype.setUniformMatrix4fv=function(d,b,f){void 0===f&&(f=!1);var q=this._nameToUniformMatrix4[d];void 0!==q&&(16===q.length?a._matrix4Equal(q,b):a._arraysEqual(b,q))||(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(d),
f,b),void 0===q?this._nameToUniformMatrix4[d]=new Float32Array(b):q.set(b))};a._padToThree=function(a){var b=a.toString();1E3>a&&(b=("  "+a).slice(-3));return b};a.prototype._addLineNumbers=function(d){var b=2;return d.replace(/\n/g,function(){return"\n"+a._padToThree(b++)+":"})};a.prototype._loadShader=function(a){var b=35633===a?this._vertexShaderSource:this._fragmentShaderSource,d="",f;for(f in this._defines)d+="#define "+f+" "+this._defines[f]+"\n";b=d+b;d=this._context.gl;a=d.createShader(a);
d.shaderSource(a,b);d.compileShader(a);d.getShaderParameter(a,d.COMPILE_STATUS)||(console.error(d.getShaderInfoLog(a)),console.error(this._addLineNumbers(b)));return a};a._matrix4Equal=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};a._matrix3Equal=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&
a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]};a._arraysEqual=function(a,b){if(a.length!==b.length)return!1;for(var d=0;d<a.length;++d)if(a[d]!==b[d])return!1;return!0};a._nextId=0;return a}()})},"esri/views/3d/environment/RealisticAtmosphere":function(){define("dojo/text!./materials/RealisticAtmosphereMaterial.xml ../../../core/watchUtils ../../../core/HandleRegistry ../support/ExternalRenderer ../lib/glMatrix ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/OffscreenRenderingHelper ../support/earthUtils ../../webgl/Program ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/DefaultVertexAttributeLocations".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v){var r=p.earthRadius,u=d.vec3d,C=d.vec2d,E=d.vec4d;d=.02*Math.PI;p=.004*Math.PI;var c=u.createFrom(1/Math.pow(.65,4),1/Math.pow(.57,4),1/Math.pow(.475,4)),D=u.create(c);u.scale(D,d);u.add(D,u.createFrom(p,p,p));var B=(1- -.99999*-.99999)/(2+-.99999*-.99999)*1.5;a=a.createSubclass({declaredClass:"esri.views.3d.environment.RealisticAtmosphere",properties:{view:{},planar:{value:!1,set:function(a){a=!!a;a!==this.planar&&this._update();this._set("planar",a)}},needsRender:{value:!1}},
constructor:function(){this._handles=new f;this._lowerElevationBoundRadius=0;this._earthRadius=r;this._renderer=this._skyPlanarProgram=this._skyProgram=this._hazePlanarProgram=this._hazeProgram=null;this._renderData={texDepth:C.create(),v3CameraPos:u.create(),v3CameraUp:u.create(),v3CameraRight:u.create(),v3CameraDir:u.create(),v3CameraCenter:u.create(),halfSizeNearPlane:C.create(),v2CameraCenterOffset:C.create(),v4SphereComp:E.create(),v4AtmosParams1:E.create(),v4AtmosParams2:E.create(),v4AtmosParams3:E.create(),
v3InvWavelength:c,v3InvWavelengthScaled:D,v4Radii:E.create(),fScale:0,fScaleDepth:.25,fLowerAlphaBlendBound:0,fScaleOverScaleDepth:0,fOneOverScaleDepth:0,fScaleDepthBlue:.05,fOneOverScaleDepthBlue:20,fScaleOverScaleDepthBlue:0,g:-.99999,g2:-.99999*-.99999,fMiePhaseCoefficients:B,showTest:0,nearFar:C.create()};this._updateRadius(r);this._hazeSlot=m.POSTPROCESSING_ATMOSPHERE;this._skySlot=m.BACKGROUND},destroy:function(){this._handles&&(this._handles.destroy(),this._handles=null);this._hazeProgram&&
(this._hazeProgram.dispose(),this._hazeProgram=null);this._hazePlanarProgram&&(this._hazePlanarProgram.dispose(),this._hazePlanarProgram=null);this._skyProgram&&(this._skyProgram.dispose(),this._skyProgram=null);this._skyPlanarProgram&&(this._skyPlanarProgram.dispose(),this._skyPlanarProgram=null)},setup:function(a){var c=q.createSquareGeometry(),d={faces:c.getFaces()[0],vertexAttr:c.getVertexAttr()},c=this.renderContext.rctx;this._renderer=new b(d,z.Pos3Tex,null,c);var f=this._update.bind(this);
this._handles.add(l.on(this,"view.navigation","currentViewChanged",function(a){f(a.camera)},function(){f()},null,!0));var d=this._updateElevation.bind(this),k=this._updateVisibleElevationBounds.bind(this);this._handles.add(l.on(this,"view.basemapTerrain","elevation-change",d,d));this._handles.add(l.on(this,"view.basemapTerrain","elevation-bounds-change",k,k));a.shaderSnippets.fsRealisticAtmosphere||a.shaderSnippets._parse(w);this._hazeProgram=new x(c,a.shaderSnippets.vsRealisticAtmosphere,a.shaderSnippets.fsRealisticAtmosphere,
v.Default3D,["HAZE"]);this._skyProgram=new x(c,a.shaderSnippets.vsRealisticAtmosphere,a.shaderSnippets.fsRealisticAtmosphere,v.Default3D);this._hazePlanarProgram=new x(c,a.shaderSnippets.vsRealisticAtmosphere,a.shaderSnippets.fsRealisticAtmosphere,v.Default3D,["HAZE","PLANAR"]);this._skyPlanarProgram=new x(c,a.shaderSnippets.vsRealisticAtmosphere,a.shaderSnippets.fsRealisticAtmosphere,v.Default3D,["PLANAR"])},render:function(a){if(!(a.slot!=this._hazeSlot&&a.slot!=this._skySlot||a.pass!=t.MATERIAL||
a.slot==this._hazeSlot&&a.options.earlyOcclusionPixelDraw)){var c,b=this.renderContext.rctx,d=b.gl,f=a.offscreenRenderingHelper,k=!1;if(a.slot==this._hazeSlot){c=this.planar?this._hazePlanarProgram:this._hazeProgram;b.bindProgram(c);b.setBlendFunctionSeparate(d.ONE,d.ONE_MINUS_SRC_COLOR,d.ZERO,d.ONE);f.detachDepthTextureFromBuffer();var k=!0,m=f.getDepthTexture();b.bindTexture(m,0);c.setUniform1i("tDepth",0);c.setUniform4fv("v4SphereComp",this._renderData.v4SphereComp)}a.slot==this._skySlot&&(c=this.planar?
this._skyPlanarProgram:this._skyProgram,b.bindProgram(c),b.setBlendFunctionSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA),c.setUniform4fv("v4SphereComp",this._renderData.v4SphereComp),c.setUniform4fv("v4AtmosParams3",this._renderData.v4AtmosParams3));c.setUniform3fv("v3InvWavelength",this._renderData.v3InvWavelength);c.setUniform3fv("v3InvWavelengthScaled",this._renderData.v3InvWavelengthScaled);c.setUniform3fv("v3LightDir",a.lightingData.direction);c.setUniform3fv("v3CameraPos",
this._renderData.v3CameraPos);c.setUniform3fv("v3CameraUp",this._renderData.v3CameraUp);c.setUniform3fv("v3CameraRight",this._renderData.v3CameraRight);c.setUniform3fv("v3CameraDir",this._renderData.v3CameraDir);c.setUniform2fv("nearFar",this._renderData.nearFar);c.setUniform2fv("halfSizeNearPlane",this._renderData.halfSizeNearPlane);c.setUniform2fv("v2CameraCenterOffset",this._renderData.v2CameraCenterOffset);c.setUniform4fv("v4Radii",this._renderData.v4Radii);c.setUniform4fv("v4AtmosParams1",this._renderData.v4AtmosParams1);
c.setUniform4fv("v4AtmosParams2",this._renderData.v4AtmosParams2);c.setUniform1f("showTest",this._renderData.showTest);b.setDepthTestEnabled(!1);b.setBlendingEnabled(!0);this._renderer.render(c);b.setBlendingEnabled(!1);b.setDepthTestEnabled(!0);b.setBlendFunctionSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);k&&f.restoreDepthTextureToBuffer();return!0}},_setEnableTestImage:function(a){this._renderData.showTest=a?1:0;this.needsRender=!0},_adjustRadiusForTesselation:function(a){return a*
Math.cos(Math.PI/Math.pow(2,4)/16)},_normalizeRadius:function(a){a=this._adjustRadiusForTesselation(a);return Math.max(r-1E4,Math.min(a,r))},_updateElevation:function(){if(this.get("view.basemapTerrain.ready")){var a=this._adjustRadiusForTesselation(r+this.view.basemapTerrain.rootTiles[0].elevationBounds[0]);a!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=a,this._earthRadius=-1,this._updateVisibleElevationBounds())}},_updateVisibleElevationBounds:function(){var a=this._adjustRadiusForTesselation(r+
this.view.basemapTerrain.getElevationBounds()[0]);return 0>this._earthRadius||a<this._earthRadius?this._updateRadius(a):!1},_updateRadius:function(a){this._earthRadius=a;var c=a*a,b=a/10*10.25,d=b*b,f=1/(b-a),k=f/.25,m=f/.05,p=.3*(b-a)+a,r=1/(b-p),u=this._renderData;E.set4(f,.25,k,4,u.v4AtmosParams1);E.set4(-.99999,.05,m,20,u.v4AtmosParams2);E.set4(-.99999*-.99999,B,p,r,u.v4AtmosParams3);E.set4(a,c,b,d,u.v4Radii);u.fScale=f;u.fLowerAlphaBlendBound=p;u.fScaleOverScaleDepth=k;u.fScaleOverScaleDepthBlue=
m;this._update();return!0},_update:function(a){if(a=a||this.get("view.navigation.currentCamera")){u.negate(a.viewForward,this._renderData.v3CameraDir);u.set(a.viewUp,this._renderData.v3CameraUp);u.set(a.viewRight,this._renderData.v3CameraRight);if(this.planar){var c=this.view.renderCoordsHelper;this._renderData.fCameraHeight=c.getAltitude(a.eye)/c.unitInMeters+r}else this._renderData.fCameraHeight=u.length(a.eye);this._renderData.fCameraHeight2=this._renderData.fCameraHeight*this._renderData.fCameraHeight;
this._renderData.fC=this._renderData.fCameraHeight2-this._renderData.v4Radii[3];this._renderData.fCSur=this._renderData.fCameraHeight2-this._renderData.v4Radii[1];this._renderData.v4SphereComp=E.createFrom(this._renderData.fCameraHeight,this._renderData.fCameraHeight2,this._renderData.fC,this._renderData.fCSur);u.set(a.eye,this._renderData.v3CameraPos);u.set(a.center,this._renderData.v3CameraCenter);C.set2(Math.tan(a.fovX/2)/(a.width/a.fullWidth),Math.tan(a.fovY/2)/(a.height/a.fullHeight),this._renderData.halfSizeNearPlane);
C.set2((a.padding[3]+a.width/2)/a.fullWidth-.5,(a.padding[2]+a.height/2)/a.fullHeight-.5,this._renderData.v2CameraCenterOffset);C.set2(a.near,a.far,this._renderData.nearFar);this.needsRender=!0}}});a.isSupported=function(a){return k.supportsDepthTexture(a.rctx.extensions)};return a})},"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":function(){define("require exports ./Util dojo/text!../materials/internal/offscreen.xml ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Program ../../../webgl/Util ../../../webgl/enums ./DefaultVertexBufferLayouts ./DefaultVertexAttributeLocations".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z){var v={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},r={target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:0,height:0};return function(){function p(a,b){this._hudVisibilityTexture=null;this._enabled=!1;this.height=this.width=0;this._programRep=a;this._rctx=b;this.height=this.width=null}p.prototype.enable=function(){if(!this.getEnableState()){var a=this._rctx;this._enabled=!0;this.framebuffer=
d.createWithAttachments(a,v,{colorTarget:0,depthStencilTarget:a.extensions.depthTexture?4:3});this.quadVAO=this.createQuadVAO(a)}};p.prototype.disable=function(){this.getEnableState()&&(this._enabled=!1,this.framebuffer.dispose(),this.quadVAO.dispose(!0),this._depthStencilTextureCached=this.quadVAO=this.framebuffer=null)};p.prototype.createQuadVAO=function(a){var b=new Float32Array([-1,-1,-1,-1,1,-1,1,-1,-1,1,-1,1,1,1,1,1]);return new q(a,z.Default3D,{geometry:x.Pos2Tex},{geometry:t.createVertex(a,
35044,b)})};p.prototype.setEnableState=function(a){a?this.enable():this.disable()};p.prototype.getEnableState=function(){return this._enabled};p.prototype.getColorTexture=function(){return this.framebuffer.colorTexture};p.prototype.getDepthTexture=function(){return p.supportsDepthTexture(this._rctx.extensions)?this.framebuffer.depthStencilTexture||this._depthStencilTextureCached:null};p.prototype.getHUDVisibilityTexture=function(){return this._hudVisibilityTexture};p.supportsDepthTexture=function(a){return!!a.depthTexture};
p.prototype.initializeFrame=function(a){f.assert(this.getEnableState());var b=this._rctx,c=b.gl;a=a.fullViewport;this.width=a[2];this.height=a[3];this.framebuffer.resize(this.width,this.height);b.bindFramebuffer(this.framebuffer);b.setStencilWriteMask(255);b.setClearStencil(0);b.setClearColor(0,0,0,1);b.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT)};p.prototype.renderHUDVisibility=function(a){var d=this._rctx,c=d.gl;this._hudVisibilityTexture||(this._hudVisibilityTexture=new b(d,
r));this._hudVisibilityTexture.resize(this.width,this.height);var f=this.framebuffer.detachColorTexture();this.framebuffer.attachColorTexture(this._hudVisibilityTexture);d.bindFramebuffer(this.framebuffer);d.setClearColor(0,0,0,1);d.clear(c.COLOR_BUFFER_BIT);a();c.flush();this.framebuffer.detachColorTexture();this.framebuffer.attachColorTexture(f)};p.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};p.prototype.getFramebuffer=function(){return this.framebuffer};p.prototype.detachDepthTextureFromBuffer=
function(){this._depthStencilTextureCached=this.framebuffer.depthStencilTexture;this.framebuffer.detachDepthStencilTexture()};p.prototype.restoreDepthTextureToBuffer=function(){this.framebuffer.attachDepthStencilTexture(this._depthStencilTextureCached);this._depthStencilTextureCached=null};p.prototype.drawQuad=function(a){f.assert(this.getEnableState());a=this._rctx;var b=a.gl,c=this._programRep.get("offscreenProgram");a.bindFramebuffer();a.setDepthTestEnabled(!1);a.clear(b.COLOR_BUFFER_BIT);a.bindProgram(c);
c.setUniform1i("tex",1);a.bindTexture(this.framebuffer.colorTexture,1);a.bindVAO(this.quadVAO);a.drawArrays(5,0,k.vertexCount(this.quadVAO,"geometry"));a.setDepthTestEnabled(!0)};p.loadShaders=function(b,d,c,f){b._parse(a);b=new m(f,b.vsOffscreenRenderer,b.fsOffscreenRenderer,z.Default3D);c.add("offscreenProgram",b)};return p}()})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("dojo/text!./materials/SimpleAtmosphereMaterial.xml dojo/Deferred ../../../core/watchUtils ../support/ExternalRenderer ../lib/glMatrix ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/Texture ../webgl-engine/lib/Util ../webgl-engine/lib/GLTextureRep ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ./resources/SimpleAtmosphereTexture ../support/earthUtils ../../webgl/Program ../webgl-engine/lib/DefaultVertexAttributeLocations".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r){var u=z.earthRadius,C=d.vec3d,E=d.vec2d,c=d.mat4d,D=t.VertexAttrConstants,B=(u-1E4)/u,I=(u+3E5)/u,G=-1E4/3E5,H=1-G;return a.createSubclass({declaredClass:"esri.views.3d.environment.SimpleAtmosphere",properties:{view:{},needsRender:{value:!1},slot:{value:p.BACKGROUND,set:function(a){this.needsRender=!0;this._set("slot",a)}}},constructor:function(){this._renderData={texV:E.create(),silCircleCenter:C.create(),silCircleV1:C.create(),silCircleV2:C.create()};this._textureRep=
this._texture=null},initialize:function(){this._textureDfd=new l;this.addResolvingPromise(this._textureDfd.promise)},destroy:function(){this._currentViewChangedHandle&&(this._currentViewChangedHandle.remove(),this._currentViewChangedHandle=null);this._textureRep&&(this._texture&&(this._textureRep.release("SimpleAtmosphere"),this._textureRep.getTexture("SimpleAtmosphere").unload()),this._textureRep=null);this._program&&(this._program.dispose(),this._program=null);this._textureDfd&&(this._textureDfd.cancel(),
this._textureDfd=null)},initializeRenderContext:function(a){this._textureRep=new m({SimpleAtmosphere:new q(x,"SimpleAtmosphere",{wrapClamp:!0})},a.programRep,function(){return this.view._stage.getCamera().viewport}.bind(this),a.rctx);this._texture=this._textureRep.aquire("SimpleAtmosphere",void 0,void 0,function(a){this._texture=a.getGLTexture();this._textureDfd.resolve();this._textureDfd=null}.bind(this))},setup:function(a){var c=this._createRibbonGeometryData();this._renderer=new b(c,[{name:"position",
count:3,type:5126,offset:0,stride:12,normalized:!1}],null,a.rctx);this._currentViewChangedHandle=f.on(this,"view.navigation","currentViewChanged",function(a){this._update(a.camera)}.bind(this),function(){this._update(this.get("view.navigation.currentCamera"))}.bind(this),null,!0);a.shaderSnippets.vsSimpleAtmosphere||a.shaderSnippets._parse(w);this._program=new v(a.rctx,a.shaderSnippets.vsSimpleAtmosphere,a.shaderSnippets.fsSimpleAtmosphere,r.Default3D)},render:function(a){if(a.slot!==this.slot||a.pass!==
k.MATERIAL)return!1;var c=this.renderContext.rctx,b=c.gl,d=this._program;c.bindProgram(d);d.setUniform4f("color",1,1,1,1);d.setUniformMatrix4fv("proj",a.camera.projectionMatrix);d.setUniformMatrix4fv("view",a.camera.viewMatrix);d.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter);d.setUniform3fv("silCircleV1",this._renderData.silCircleV1);d.setUniform3fv("silCircleV2",this._renderData.silCircleV2);d.setUniform2fv("texV",this._renderData.texV);c.bindTexture(this._texture,0);d.setUniform1i("tex",
0);d.setUniform3fv("lightDirection",a.lightingData.direction);c.setDepthFunction(b.LEQUAL);c.setBlendingEnabled(!0);c.setDepthWriteEnabled(!1);this._renderer.render(d);c.setBlendingEnabled(!1);c.setDepthWriteEnabled(!0);c.setDepthFunction(b.LESS);return!0},_update:function(a){var c=C.create(),b=C.create(),d=C.create(),f=this.view.renderCoordsHelper.getAltitude(a.eye);C.scale(a.eye,(u+50)/C.length(a.eye),d);this._computeSilhouetteCircle(d,a.center,a.up,u);C.add(this._renderData.silCircleCenter,this._renderData.silCircleV2,
c);C.scale(c,I,b);var d=this._computeScreenRimWidth(d,a.up,c,b),k=0,m=1,p=1;50>f?(k=.001953125,m=.1015625):500>f?(p=(f-50)/450,k=.001953125*(1-p)+.001953125*p,m=.1015625*(1-p)+.21875*p):5E3>f?(p=(f-500)/4500,k=.001953125*(1-p)+.001953125*p,m=.21875*(1-p)+.51171875*p):5E4>f&&(p=(f-5E3)/45E3,k=.001953125*(1-p)+.001953125*p,m=.51171875*(1-p)+.4140625*p);f=G+k*H;p=G+d*m*H;50<C.length(a.eye)-u&&(this._computeSilhouetteCircle(a.eye,a.center,a.up,u),C.add(this._renderData.silCircleCenter,this._renderData.silCircleV2,
c),C.scale(c,I,b),a=this._computeScreenRimWidth(a.eye,a.up,c,b),a=t.clamp((a-1.5)/(d-1.5),0,1),f=G+a*k*H,p=G+t.lerp(1,d*m,a)*H);E.set2(f,p,this._renderData.texV);this.needsRender=!0},_computeSilhouetteCircle:function(a,c,b,d){var f=C.length(a),k=d*Math.sqrt(f*f-d*d)/f,m=this._renderData.silCircleV1,p=this._renderData.silCircleV2;C.scale(a,Math.sqrt(d*d-k*k)/f,this._renderData.silCircleCenter);C.cross(a,c,m);1>C.length2(m)&&C.cross(a,b,m);C.scale(m,k/C.length(m));C.cross(m,a,p);C.scale(p,k/C.length(p));
return k},_computeScreenRimWidth:function(a,b,d,f){var k=c.create();c.lookAt(a,d,b,k);a=this.view.navigation.currentCamera;t.project(d,k,a.projectionMatrix,a.viewport);t.project(f,k,a.projectionMatrix,a.viewport);return C.dist(d,f)/a.height},_createRibbonGeometryData:function(){for(var a=new Float32Array(768),c=new Uint32Array(768),b=0;128>b;b++){var d=6*b;a[d+0]=b;a[d+1]=B;a[d+2]=0;a[d+3]=b;a[d+4]=I;a[d+5]=1;var f=2*b,k=127===b?0:f+2;c[d+0]=f;c[d+1]=f+1;c[d+2]=k+1;c[d+3]=k+1;c[d+4]=k;c[d+5]=f}b=
{};b[D.POSITION]=c;c={};c[D.POSITION]={size:3,data:a};return{faces:{type:"triangle",indices:b,positionKey:D.POSITION},vertexAttr:c}}})})},"esri/views/3d/environment/Stars":function(){define("dojo/text!./materials/StarMaterial.xml require ../../../request ../../../core/watchUtils ../../../core/promiseUtils ../../../core/Error ../../../core/Logger ../lib/glMatrix ../support/ExternalRenderer ../webgl-engine/lib/GeometryRenderer ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../../webgl/Program ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Util".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C){var E=t.mat4d;t=t.mat3d;var c=p.VertexAttrConstants,D="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),B=q.getLogger("esri.views.3d.environment.Stars"),I=t.toMat4(t.createFrom(1,0,0,0,.9174771405229186,.39778850739794974,0,-.39778850739794974,.9174771405229186)),G=t.toMat4(t.createFrom(1,0,0,0,.9174771405229186,-.39778850739794974,
0,.39778850739794974,.9174771405229186)),H=null;return m.createSubclass({properties:{view:{},numBinaryFloats:{value:2},numBinaryUInt8:{value:1},bytesPerStar:{value:9},needsRender:{value:!1},slot:{value:v.BACKGROUND,set:function(a){this.needsRender=!0;this._set("slot",a)}}},constructor:function(){this._renderData={model:E.identity()};this.slot=v.BACKGROUND;this._vertexBufferLayout=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:20,
normalized:!1},{name:"size",count:1,type:5126,offset:16,stride:20,normalized:!1}]},initialize:function(){this._loadDataPromise=this._loadBrightStarCatalogue();this.addResolvingPromise(this._loadDataPromise)},destroy:function(){this._loadDataPromise.isFulfilled()||this._loadDataPromise.cancel("Atmosphere has been removed.");this._dateHandle&&(this._dateHandle.remove(),this._dateHandle=null);this._program&&(this._program.dispose(),this._program=null)},setup:function(c){this._numStars=this._starData.byteLength/
this.bytesPerStar;var b=new Float32Array(this._starData,0,this._numStars*this.numBinaryFloats),d=new Uint8Array(this._starData,this._numStars*this.numBinaryFloats*4,this._numStars*this.numBinaryUInt8),b=this._createStarGeometryData(b,d);this._renderer=new k(b,this._vertexBufferLayout,this._fillInterleaved,c.rctx);this._renderer.enablePointRendering(!0);this._dateHandle=a.init(this,"view.environment.lighting.date",this._update.bind(this));c.shaderSnippets.vertexShaderStar||c.shaderSnippets._parse(w);
this._program=new r(c.rctx,c.shaderSnippets.vertexShaderStar,c.shaderSnippets.fragmentShaderStar,u.Default3D)},render:function(a){if(a.slot!==this.slot||a.pass!==z.MATERIAL)return!1;var c=this.renderContext.rctx,b=c.gl,d=this._program;c.bindProgram(d);d.setUniformMatrix4fv("view",a.camera.viewMatrix);d.setUniformMatrix4fv("proj",a.camera.projectionMatrix);d.setUniform4fv("viewport",a.camera.fullViewport);d.setUniformMatrix4fv("model",this._renderData.model);c.setDepthFunction(b.LEQUAL);c.setBlendingEnabled(!0);
c.setBlendFunctionSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);c.setDepthWriteEnabled(!1);this._renderer.render(d);c.setBlendingEnabled(!1);c.setDepthWriteEnabled(!0);c.setDepthFunction(b.LESS);return!0},_fillInterleaved:function(a,b,d,f,k,m,p){var r=C.getStride(k);d=r/4;var u=x.fill,q=a.faces.indices[c.POSITION],v=a.vertexAttr[c.POSITION].data;f=p+C.findAttribute(k,"position").offset/4;for(var l=0;l<q.length;++l){var h=3*q[l];u(v,h,m,f,b,3);f+=d}b=a.faces.indices[c.COLOR];
q=a.vertexAttr[c.COLOR].data;f=p+C.findAttribute(k,"color").offset;v=new Uint8Array(m.buffer);for(l=0;l<b.length;++l)h=4*b[l],u(q,h,v,f,null,4),f+=r;r=a.faces.indices[c.SIZE];a=a.vertexAttr[c.SIZE].data;f=p+C.findAttribute(k,"size").offset/4;for(l=0;l<r.length;++l)m[f]=a[r[l]],f+=d},_computeDayDuration:function(a){var c=new Date(a.getFullYear(),0,1,11,58,56),b=new Date(a.getFullYear()+1,0,1,11,58,55);return(a-c)/(b-c)},_update:function(a){if(a){var c=a.getHours()/12,b=a.getMinutes()/60*(2/24),d=a.getSeconds()/
60*(2/1440),c=(c+b+d-.9972222)%2;a=2*this._computeDayDuration(a);b=E.create(G);E.rotateZ(b,-a*Math.PI);E.multiply(I,b,b);E.rotateZ(b,-c*Math.PI);this._renderData.model=b;this.needsRender=!0}},_hexToRGB:function(a){return[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)]},_unpackUint8Attributes:function(a){return 192<=a?[2.9,a-192]:160<=a?[2.5,a-160]:128<=a?[2,a-128]:96<=a?[1.5,a-96]:64<=a?[1,a-64]:32<=a?[.7,a-32]:[.4,a]},_createStarGeometryData:function(a,
b){for(var d=new Float32Array(3*this._numStars),f=new Uint8Array(4*this._numStars),k=new Float32Array(this._numStars),m=new Uint32Array(this._numStars),p=0;p<this._numStars;p++){var r=2*p,u=3*p,q=4*p,v=a[r+0],r=a[r+1];d[u+0]=-Math.cos(v)*Math.sin(r);d[u+1]=-Math.sin(v)*Math.sin(r);d[u+2]=-Math.cos(r);u=this._unpackUint8Attributes(b[p]);v=this._hexToRGB(D[u[1]]);f[q+0]=255*v[0];f[q+1]=255*v[1];f[q+2]=255*v[2];f[q+3]=255;k[p]=u[0];m[p]=p}a={};a[c.POSITION]=m;a[c.NORMAL]=m;a[c.UV0]=m;a[c.COLOR]=m;a[c.SIZE]=
m;m={};m[c.POSITION]={size:3,data:d};m[c.COLOR]={size:4,data:f};m[c.SIZE]={size:1,data:k};return{faces:{type:"point",indices:a,positionKey:c.POSITION},vertexAttr:m}},_verifyStartData:function(a){if(!a)throw new b("stars:no-data-received","Failed to create stars because star catalogue is missing");a=a.byteLength/this.bytesPerStar;if(0!==a%1||5E4<a||5E3>a)throw new b("stars:invalid-data","Failed to create stars because star catalogue data is invalid");},_loadBrightStarCatalogue:function(){return H?
(this._starData=H,d.resolve()):f(l.toUrl("./resources/stars.wsv"),{responseType:"array-buffer",failOk:!0}).then(function(a){a=a.data;this._verifyStartData(a);this._starData=H=a}.bind(this)).otherwise(function(a){B.error("loadBrightStarCatalogue",a.message);throw a;})}})})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["require","exports","../../lib/glMatrix"],function(w,l,f){Object.defineProperty(l,"__esModule",{value:!0});var a=f.vec3d;w=function(){return function(d,b,f){void 0===
d&&(d=a.create());void 0===b&&(b=a.createFrom(.57735,.57735,.57735));void 0===f&&(f=!0);this.intensity=d;this.direction=b;this.castShadows=f}}();l.MainLight=w;w=function(){return function(d,b){void 0===d&&(d=a.create());void 0===b&&(b=a.createFrom(.57735,.57735,.57735));this.intensity=a.create();this.direction=a.create();this.intensity=d;this.direction=b}}();l.FillLight=w;w=function(){return function(d){void 0===d&&(d=a.create());this.intensity=d}}();l.AmbientLight=w;w=function(){return function(){this.sh=
{r:[0],g:[0],b:[0]}}}();l.SphericalHarmonicsLight=w})},"esri/views/3d/constraints/SceneViewConstraints":function(){define(["../../../core/Accessor","./SceneViewAltitudeConstraint","./SceneViewClipDistanceConstraint","./SceneViewTiltConstraint","./SceneViewCollisionConstraint"],function(w,l,f,a,d){return w.createSubclass([],{declaredClass:"esri.views.3d.constraints.SceneViewConstraints",properties:{tilt:a,altitude:l,clipDistance:f,collision:d},getDefaults:function(a){var b={};a.tilt||(b.tilt={});a.altitude||
(b.altitude={});a.clipDistance||(b.clipDistance={});a.collision||(b.collision={});return b},scale:function(a){this.tilt.scale(a);this.altitude.scale(a);this.clipDistance.scale(a)}})})},"esri/views/3d/constraints/SceneViewAltitudeConstraint":function(){define(["../../../core/Accessor","../support/earthUtils"],function(w,l){var f=-l.earthRadius;l=4*l.earthRadius;w=w.createSubclass([],{declaredClass:"esri.views.3d.constraints.SceneViewAltitudeConstraint",properties:{mode:{value:"auto"},min:{value:f,
set:function(a){this._set("min",a);this._get("max")<a&&this._set("max",a);this.mode="manual"}},max:{value:l,set:function(a){this._set("max",a);this._get("min")>a&&this._set("min",a);this.mode="manual"}}},autoUpdate:function(a,d){"auto"===this.mode&&(this._get("min")!==a&&this._set("min",a),this._get("max")!==d&&this._set("max",d))},scale:function(a){this._set("max",this._get("max")*a);this._set("min",this._get("min")*a)}});w.MIN_DEFAULT=f;w.MAX_DEFAULT=l;return w})},"esri/views/3d/constraints/SceneViewClipDistanceConstraint":function(){define(["../../../core/Accessor"],
function(w){return w.createSubclass([],{declaredClass:"esri.views.3d.constraints.SceneViewClipDistanceConstraint",properties:{near:{value:0,cast:function(l){return Math.max(1E-8,l)},set:function(l){this._set("near",l);l>=this._get("far")&&(this.far=l+1E-9);this.mode="manual"}},far:{value:0,cast:function(l){return Math.max(1E-8,l)},set:function(l){this._set("far",l);l<=this._near&&(this.near=l-1E-9);this.mode="manual"}},mode:{value:"auto"}},autoUpdate:function(l,f){"auto"===this.mode&&(this._get("near")!==
l&&this._set("near",l),this._get("far")!==f&&this._set("far",f))},scale:function(l){this._set("near",this._get("near")*l);this._set("far",this._get("far")*l)}})})},"esri/views/3d/constraints/SceneViewTiltConstraint":function(){define(["../../../core/Accessor","../support/mathUtils"],function(w,l){w=w.createSubclass([],{declaredClass:"esri.views.3d.constraints.SceneViewTiltConstraint",properties:{mode:{value:"auto"},max:{value:.5,cast:function(f){return l.clamp(f,.5,179.5)},set:function(f){this._set("max",
f);this.mode="manual"}}},autoUpdate:function(f){"auto"===this.mode&&this._get("max")!==f&&this._set("max",f)},scale:function(f){}});w.MAX_DEFAULT=.5;w.MIN_DEFAULT=179.5;return w})},"esri/views/3d/constraints/SceneViewCollisionConstraint":function(){define(["../../../core/Accessor"],function(w){return w.createSubclass([],{declaredClass:"esri.views.3d.constraints.SceneViewCollisionConstraint",properties:{enabled:!0}})})},"esri/views/3d/input/SceneInputManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/watchUtils ../../../core/Accessor ../../../core/HandleRegistry ../../../core/accessorSupport/decorators ../../input/InputManager ../../input/BrowserEventSource ../../input/ViewEvents ../../input/handlers/PreventContextMenu ./handlers/pinch/PinchNavigationGlobal ./handlers/pinch/PinchNavigationLocal ./handlers/DoubleClickZoom ./handlers/DragPan ./handlers/DragRotate ./handlers/DragZoom ./handlers/KeyPan ./handlers/MouseWheelZoom ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/PointerDownCancelAnimation ./handlers/TwoFingerTilt ./NavigationHelper".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c,D,B,I,G,H,K){w=function(b){function l(){var a=null!==b&&b.apply(this,arguments)||this;a._handles=new q;return a}f(l,b);l.prototype.initialize=function(){var a=this;this.viewEvents=new p.ViewEvents(this.view);this._handles.add([d.whenNot(this.view,"ready",function(){return a._disconnect()}),d.when(this.view,"ready",function(){return a._connect()})])};l.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this._disconnect()};
Object.defineProperty(l.prototype,"primaryDragAction",{get:function(){return this._get("primaryDragAction")},set:function(a){"pan"!==a&&"rotate"!==a||a===this._get("primaryDragAction")||(this._set("primaryDragAction",a),this._updateMode())},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"mode",{get:function(){return this._get("mode")},set:function(a){"default"!==a&&"pro"!==a||a===this._get("mode")||(this._set("mode",a),this._updateMode())},enumerable:!0,configurable:!0});l.prototype._disconnect=
function(){this.viewEvents.disconnect();this._source&&(this._source.destroy(),this._source=null);this._inputManager&&(this._inputManager.destroy(),this._inputManager=null)};l.prototype._connect=function(){var a=this.view;this._source=new k.BrowserEventSource(this.view.canvas);var b=new m.InputManager(this._source);this._inputManager=b;b.installHandlers("prevent-context-menu",[new x.PreventContextMenu]);this._modeDragPan=new u.DragPan(a,"primary");this._modeDragRotate=new C.DragRotate(a,"secondary",
"center");this._modeDragZoom=new E.DragZoom(a,"tertiary");this._pinchNavigation="global"===this.view.viewingMode?new z.PinchNavigationGlobal(a,new K.NavigationHelper(a.navigation.picker)):new v.PinchNavigationLocal(a,new K.NavigationHelper(a.navigation.picker));b.installHandlers("navigation",[new G.PointerDownCancelAnimation(a),new r.DoubleClickZoom(a),new c.KeyPan(a,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j"}),new D.MouseWheelZoom(a),new I.SingleKeyResetTilt(a,
"p"),new B.SingleKeyResetHeading(a,"n"),this._pinchNavigation,new H.TwoFingerTilt(a),new C.DragRotate(a,"primary","eye",["b"]),new C.DragRotate(a,"secondary","center",["b"]),new u.DragPan(a,"tertiary",["b"]),this._modeDragPan,this._modeDragRotate,this._modeDragZoom]);this.viewEvents.connect(b);this._updateMode()};l.prototype._updateMode=function(){var a=this.primaryDragAction,a=J.get(this.mode).get(a);this._modeDragPan&&(this._modeDragPan.pointerType=a.pan);this._modeDragRotate&&(this._modeDragRotate.pointerType=
a.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerType=a.zoom)};a([t.property()],l.prototype,"view",void 0);a([t.property({value:"pan"})],l.prototype,"primaryDragAction",null);a([t.property({value:"default"})],l.prototype,"mode",null);a([t.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],l.prototype,"latestPointerType",void 0);a([t.property()],l.prototype,"_inputManager",void 0);return l=a([t.subclass("esri.views.3d.input.SceneInputManager")],l)}(t.declared(b));var J=new Map;
l=new Map;b=new Map;l.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});l.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});b.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});b.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});J.set("default",l);J.set("pro",b);return w})},"esri/views/input/InputManager":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor ../../core/now ./keys ./recognizers ../../core/Logger ./handlers/LatestPointerType".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p){Object.defineProperty(l,"__esModule",{value:!0});var x=k.getLogger("esri.views.input.InputManager");w=function(b){function k(a,d){a=b.call(this)||this;a._pointerCaptures=new Map;a._nameToGroup={};a._handlers=[];a._currentPropagation=null;a._sourceEvents=new Set;a._keyModifiers=new Set;a._activeKeyModifiers=new Set;a.primaryKey=t.primaryKey;a.latestPointerType="mouse";a._installRecognizers();return a}f(k,b);k.prototype.normalizeCtorArgs=function(a,b){this._browserEvents=
a;this._browserEvents.onEventReceived=this._onEventReceived.bind(this);this._recognizers=b;this._recognizers||(this._recognizers=m.defaults.map(function(a){return new a}));return{}};k.prototype.destroy=function(){for(var a=0,b=Object.keys(this._nameToGroup);a<b.length;a++)this.uninstallHandlers(b[a])};k.prototype.installHandlers=function(a,b){var d=this;if(this._nameToGroup[a])x.error("There is already an InputHandler group registered under the name `"+a+"`");else if(0===b.length)x.error("Can't register a group of zero handlers");
else{var c={name:a,handlers:b.map(function(a,c){return{handler:a,active:!0,removed:!1,priorityIndex:0,eventCallback:null,uninstallCallback:null}})};this._nameToGroup[a]=c;a=function(a){var b=c.handlers[a];f._handlers.push(b);b.handler.onInstall({updateDependencies:function(){d.updateDependencies()},emit:function(a,c,f,k){d._emitInputEvent(b.priorityIndex,a,c,f,k)},setPointerCapture:function(a,f){d._setPointerCapture(c,b,a,f)},setEventCallback:function(a){b.eventCallback=a},setUninstallCallback:function(a){b.uninstallCallback=
a}})};var f=this;for(b=c.handlers.length-1;0<=b;b--)a(b);this.updateDependencies()}};k.prototype.uninstallHandlers=function(a){var b=this._nameToGroup[a];b?(b.handlers.forEach(function(a){a.removed=!0;a.uninstallCallback()}),delete this._nameToGroup[a],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):x.error("There is no InputHandler group registered under the name `"+a+"`")};k.prototype.hasHandlers=function(a){return void 0!==
this._nameToGroup[a]};k.prototype.updateDependencies=function(){var a=new Set,b=new Set;this._handlersPriority=[];for(var d=this._handlers.length-1;0<=d;d--){var c=this._handlers[d];c.priorityIndex=d;this._handlersPriority.push(c)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(d=this._handlersPriority.length-1;0<=d;d--){c=this._handlersPriority[d];c.priorityIndex=d;var f=c.handler.hasSideEffects;if(!f)for(var k=0,m=c.handler.outgoingEventTypes;k<m.length;k++)if(a.has(m[k])){f=
!0;break}if(f)for(k=0,m=c.handler.incomingEventMatches;k<m.length;k++){var p=m[k];a.add(p.eventType);for(var r=0,p=p.keyModifiers;r<p.length;r++){var q=p[r];t.isSystemModifier(q)||b.add(q)}}c.active=f}this._sourceEvents=a;this._keyModifiers=b;0<this._pointerCaptures.size&&this._sourceEvents.add("pointer-capture-lost");0<this._keyModifiers.size&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up"));this._browserEvents&&(this._browserEvents.activeEvents=this._sourceEvents)};k.prototype._setLatestPointerType=
function(a){this._set("latestPointerType",a)};k.prototype._onEventReceived=function(a,b){"pointer-capture-lost"===a&&this._pointerCaptures.delete(b.native.pointerId);this._updateKeyModifiers(a,b);this._emitInputEventFromSource(a,b,b.native.timestamp)};k.prototype._updateKeyModifiers=function(a,b){var d=this;if(b){var c=!1,f=function(){if(!c){var a=new Set;d._activeKeyModifiers.forEach(function(c){a.add(c)});d._activeKeyModifiers=a;c=!0}},k=function(a,c){c&&!d._activeKeyModifiers.has(a)?(f(),d._activeKeyModifiers.add(a)):
!c&&d._activeKeyModifiers.has(a)&&(f(),d._activeKeyModifiers.delete(a))};if("key-down"===a||"key-up"===a){var m=b.key;this._keyModifiers.has(m)&&k(m,"key-down"===a)}a=b.native;k("Alt",!(!a||!a.altKey));k("Ctrl",!(!a||!a.ctrlKey));k("Shift",!(!a||!a.shiftKey));k("Meta",!(!a||!a.metaKey));k("Primary",this._activeKeyModifiers.has(this.primaryKey))}};k.prototype._installRecognizers=function(){var a=this;this._latestPointerTypeHandler=new p.LatestPointerType(function(b){return a._setLatestPointerType(b)});
0<this._recognizers.length&&this.installHandlers("default",this._recognizers);this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler])};k.prototype._setPointerCapture=function(a,b,d,c){a=a.name+"-"+b.priorityIndex;b=this._pointerCaptures.get(d.pointerId)||new Set;this._pointerCaptures.set(d.pointerId,b);c?(b.add(a),1===b.size&&this._browserEvents&&this._browserEvents.setPointerCapture(d,!0)):(b.delete(a),0===b.size&&(this._pointerCaptures.delete(d.pointerId),this._browserEvents&&
this._browserEvents.setPointerCapture(d,!1)))};k.prototype._garbageCollectRemovedHandlers=function(){this._handlers=this._handlers.filter(function(a){return!a.removed});this.updateDependencies()};k.prototype._emitInputEventFromSource=function(a,b,d){this._emitInputEvent(0,a,b,d)};k.prototype._emitInputEvent=function(a,b,d,c,f){c=void 0!==c?c:this._currentPropagation?this._currentPropagation.timestamp:q();b=new z(b,d,c,f||this._activeKeyModifiers);this._currentPropagation?this._currentPropagation.addedEvents.push(b):
this._doNewPropagation(a,b)};k.prototype._doNewPropagation=function(a,b){for(a=this._currentPropagation={events:[b],addedEvents:[],currentHandler:this._handlersPriority[a],needsHandlerGarbageCollect:!1,timestamp:b.timestamp};a.currentHandler;){if(a.currentHandler.removed)a.needsHandlerGarbageCollect=!0;else{b=a.events;var d=[];a.addedEvents=[];for(var c=0;c<b.length;c++){var f=b[c];a.currentHandler.active&&a.currentHandler.eventCallback(f);f.shouldStopPropagation()||d.push(f)}a.events=d.concat(a.addedEvents)}a.currentHandler=
this._handlersPriority[a.currentHandler.priorityIndex+1]}a.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers();this._currentPropagation=null};k.prototype._compareHandlerPriority=function(a,b){if(a.handler.hasSideEffects!==b.handler.hasSideEffects)return a.handler.hasSideEffects?1:-1;for(var d=0,c=a.handler.incomingEventMatches;d<c.length;d++)for(var f=c[d],k=function(a){if(f.eventType!==a.eventType)return"continue";var c=f.keyModifiers.filter(function(c){return-1!==a.keyModifiers.indexOf(c)});
if(c.length===f.keyModifiers.length!==(c.length===a.keyModifiers.length))return{value:f.keyModifiers.length>a.keyModifiers.length?-1:1}},m=0,p=b.handler.incomingEventMatches;m<p.length;m++){var r=k(p[m]);if("object"===typeof r)return r.value}return a.priorityIndex>b.priorityIndex?-1:1};k.prototype._sortHandlersPriority=function(a){for(var b=[],d=0;d<a.length;d++){for(var c=a[d],f=0;f<b.length&&0<=this._compareHandlerPriority(c,b[f]);)f++;b.splice(f,0,c)}return b};a([d.property({readOnly:!0})],k.prototype,
"latestPointerType",void 0);return k=a([d.subclass("esri.views.input.InputManager")],k)}(d.declared(b));l.InputManager=w;var z=function(){function a(a,b,d,f){this.type=a;this.data=b;this.timestamp=d;this.modifiers=f;this._stopPropagation=!1}a.prototype.stopPropagation=function(){this._stopPropagation=!0};a.prototype.shouldStopPropagation=function(){return this._stopPropagation};return a}()})},"esri/views/input/keys":function(){define(["require","exports","../../core/sniff"],function(w,l,f){Object.defineProperty(l,
"__esModule",{value:!0});l.primaryKey=f("mac")?"Meta":"Ctrl";var a={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(w=48;58>w;w++)a[w]=String.fromCharCode(w);for(w=1;25>w;w++)a[111+w]="F"+w;for(w=65;91>w;w++)a[w]=[String.fromCharCode(w+32),String.fromCharCode(w)];var d={Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown"};l.eventKey=function(b){if(void 0!==
b.key)return d[b.key]||b.key;var f=a[b.keyCode];return Array.isArray(f)?b.shiftKey?f[1]:f[0]:f};l.isSystemModifier=function(a){switch(a){case "Ctrl":case "Alt":case "Shift":case "Meta":case "Primary":return!0}}})},"esri/views/input/recognizers":function(){define("require exports ./recognizers/Drag ./recognizers/PointerClickHoldAndDrag ./recognizers/SingleAndDoubleClick ./recognizers/VerticalTwoFingerDrag".split(" "),function(w,l,f,a,d,b){Object.defineProperty(l,"__esModule",{value:!0});l.defaults=
[a.PointerClickHoldAndDrag,d.SingleAndDoubleClick,f.Drag,b.VerticalTwoFingerDrag]})},"esri/views/input/recognizers/Drag":function(){define("require exports ../../../core/tsSupport/extendsHelper ../InputHandler ./support ../../../core/now".split(" "),function(w,l,f,a,d,b){Object.defineProperty(l,"__esModule",{value:!0});w=function(a){function q(){var b=a.call(this,"recognizers.Drag",!1)||this;b._startStateModifiers=new Set;b._activePointers=[];b._activePointerMap=new Map;b._isDragging=!1;b._drag=b.registerOutgoing("drag");
b.registerIncoming("pointer-drag",b._handlePointerDrag.bind(b));b.registerIncoming("pointer-down",b._handlePointerDown.bind(b));b.registerIncoming("pointer-up",b._handlePointerUpAndPointerLost.bind(b));b.registerIncoming("pointer-capture-lost",b._handlePointerUpAndPointerLost.bind(b));return b}f(q,a);q.prototype._createPayload=function(a,b){return{action:a,pointers:this._activePointers.map(function(a){return a.data}),startState:this._startState,previousState:this._previousState,currentState:b}};q.prototype._fitCircleLSQ=
function(){var a=this._activePointers.map(function(a){return a.data.currentEvent});return d.fitCircleLSQ(a)};q.prototype._createDragState=function(){for(var a=this._fitCircleLSQ(),d=0,f=0,q=this._activePointers;f<q.length;f++){for(var l=q[f],v=this._pointerAngle(l,a),v=v-l.lastAngle;v>Math.PI;)v-=2*Math.PI;for(;v<-Math.PI;)v+=2*Math.PI;v=l.lastAngle+v;l.lastAngle=v;d+=v-l.initialAngle}d/=this._activePointers.length;return{angle:d,radius:a.radius,center:a.center,timestamp:b()}};q.prototype._updateMultiPointer=
function(a){var b=a.startEvent.native.pointerId,d=this._activePointerMap.get(b),f=!d;f?(d={data:null,initialAngle:0,lastAngle:0},this._activePointers.push(d),this._activePointerMap.set(b,d),d.data={startEvent:a.startEvent,previousEvent:a.previousEvent,currentEvent:a.currentEvent},a=this._fitCircleLSQ(),d.initialAngle=this._pointerAngle(d,a),d.lastAngle=d.initialAngle):d.data={startEvent:d.data.startEvent,previousEvent:a.previousEvent,currentEvent:a.currentEvent};f&&this._isDragging&&this._updateInitialAngles();
return d};q.prototype._pointerAngle=function(a,b){a=a.data.currentEvent;return Math.atan2(a.y-b.center.y,a.x-b.center.x)};q.prototype._updateInitialAngles=function(){for(var a=this._createDragState(),b=0,d=this._activePointers;b<d.length;b++){var f=d[b];f.initialAngle=this._pointerAngle(f,a)}};q.prototype._emitStart=function(a){this._updateInitialAngles();var b=this._createDragState();this._previousState=this._startState=b;this._startStateModifiers=a.modifiers;this._isDragging=!0;for(var d=0,f=this._activePointers;d<
f.length;d++){var m=f[d];m.data={previousEvent:m.data.currentEvent,startEvent:m.data.currentEvent,currentEvent:m.data.currentEvent}}this._drag.emit(this._createPayload("start",b),a.timestamp)};q.prototype._emitUpdate=function(a){a=this._createDragState();this._drag.emit(this._createPayload("update",a),void 0,this._startStateModifiers);this._previousState=a};q.prototype._emitEnd=function(){var a=this._createDragState();this._drag.emit(this._createPayload("end",a),void 0,this._startStateModifiers);
this._startState=this._previousState=null;this._isDragging=!1};q.prototype._handlePointerDown=function(a){a=a.data;this._isDragging&&this._emitEnd();this._updateMultiPointer({startEvent:a,previousEvent:a,currentEvent:a})};q.prototype._removeMultiPointer=function(a){var b=a.native.pointerId,d=this._activePointerMap.get(b);d&&(this._isDragging&&(this._updateMultiPointer({startEvent:d.data.startEvent,previousEvent:d.data.currentEvent,currentEvent:a}),this._emitEnd()),this._activePointerMap.delete(b),
a=this._activePointers.indexOf(d),this._activePointers.splice(a,1),this._isDragging&&this._updateInitialAngles())};q.prototype._handlePointerUpAndPointerLost=function(a){this._removeMultiPointer(a.data)};q.prototype._handlePointerDrag=function(a){var b=a.data;switch(b.action){case "start":this._isDragging||this._emitStart(a);break;case "update":this._isDragging||this._emitStart(a),this._updateMultiPointer(b),this._emitUpdate(a)}};return q}(a.InputHandler);l.Drag=w})},"esri/views/input/InputHandler":function(){define(["require",
"exports","./EventMatch","../../core/Logger"],function(w,l,f,a){Object.defineProperty(l,"__esModule",{value:!0});var d=a.getLogger("esri.views.input.InputHandler");w=function(){function a(a,b){this._manager=null;this._incoming={};this._outgoing={};this._outgoingEventTypes=this._incomingEventTypes=this._incomingEventMatches=null;this._name=a;this._hasSideEffects=b}Object.defineProperty(a.prototype,"incomingEventMatches",{get:function(){if(!this._incomingEventMatches){this._incomingEventMatches=[];
for(var a in this._incoming)for(var b=0,d=this._incoming[a];b<d.length;b++)this._incomingEventMatches.push(d[b].match)}return this._incomingEventMatches},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"incomingEventTypes",{get:function(){this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(function(a){return a.eventType}));return this._incomingEventTypes},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"outgoingEventTypes",{get:function(){this._outgoingEventTypes||
(this._outgoingEventTypes=Object.keys(this._outgoing));return this._outgoingEventTypes},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasSideEffects",{get:function(){return this._hasSideEffects},enumerable:!0,configurable:!0});a.prototype.onInstall=function(a){var b=this;this._manager?d.error("This InputHandler has already been registered with an InputManager"):(a.setEventCallback(function(a){return b._handleEvent(a)}),a.setUninstallCallback(function(){return b._onUninstall()}),
this._manager=a)};a.prototype.onUninstall=function(){};a.prototype.registerIncoming=function(a,d,p){var k=this;"function"===typeof d?(p=d,d=[]):d=d||[];a="string"===typeof a?new f.EventMatch(a,d):a;var m=function(){k._incomingEventTypes=null;k._incomingEventMatches=null};d=function(a){var b=k._incoming[a.match.eventType];b&&(a=b.indexOf(a),b.splice(a,1),m(),k._manager&&k._manager.updateDependencies())};p=new b(a,p,{onPause:d,onRemove:d,onResume:function(a){var b=k._incoming[a.match.eventType];b&&
-1===b.indexOf(a)&&(b.push(a),m(),k._manager&&k._manager.updateDependencies())}});d=this._incoming[a.eventType];d||(d=[],this._incoming[a.eventType]=d);d.push(p);m();this._manager&&this._manager.updateDependencies();return p};a.prototype.registerOutgoing=function(a){var b=this;if(this._outgoing[a])throw Error("There is already a callback registered for this outgoing InputEvent: "+a);var d=new q(a,{onEmit:function(a,d,f,k){b._manager.emit(a.eventType,d,f,k)},onRemove:function(a){delete b._outgoing[a.eventType];
b._manager.updateDependencies()}});this._outgoing[a]=d;this._outgoingEventTypes=null;this._manager&&this._manager.updateDependencies();return d};a.prototype.startCapturingPointer=function(a){this._manager.setPointerCapture(a,!0)};a.prototype.stopCapturingPointer=function(a){this._manager.setPointerCapture(a,!1)};a.prototype._onUninstall=function(){this._manager?(this.onUninstall(),this._manager=null):d.error("This InputHandler is not registered with an InputManager")};a.prototype._handleEvent=function(a){var b=
this._incoming[a.type];if(b)for(var d=0;d<b.length;d++){var f=b[d];if(f.match.matches(a)&&(f.callback(a),a.shouldStopPropagation()))break}};return a}();l.InputHandler=w;var b=function(){function a(a,b,d){this.match=a;this._callback=b;this._handler=d}a.prototype.pause=function(){this._handler.onPause(this)};a.prototype.resume=function(){this._handler.onResume(this)};a.prototype.remove=function(){this._handler.onRemove(this)};Object.defineProperty(a.prototype,"callback",{get:function(){return this._callback},
enumerable:!0,configurable:!0});return a}(),q=function(){function a(a,b){this.eventType=a;this._removed=!1;this._handler=b}a.prototype.emit=function(a,b,d){if(!this._removed)this._handler.onEmit(this,a,b,d)};a.prototype.remove=function(){this._removed=!0;this._handler.onRemove(this)};return a}()})},"esri/views/input/EventMatch":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});w=function(){function f(a,d){void 0===d&&(d=[]);this.eventType=a;this.keyModifiers=
d}f.prototype.matches=function(a){if(a.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;a=a.modifiers;for(var d=0,b=this.keyModifiers;d<b.length;d++)if(!a.has(b[d]))return!1;return!0};return f}();l.EventMatch=w})},"esri/views/input/recognizers/support":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});l.manhattanDistance=function(f,a){return Math.abs(a.x-f.x)+Math.abs(a.y-f.y)};l.fitCircleLSQ=function(f,a){a?(a.radius=0,a.center.x=
0,a.center.y=0):a={radius:0,center:{x:0,y:0}};if(0===f.length)return a;if(1===f.length)return a.center.x=f[0].x,a.center.y=f[0].y,a;if(2===f.length){var d=f[0];f=f[1];var b=[f.x-d.x,f.y-d.y],q=b[0],b=b[1];a.radius=Math.sqrt(q*q+b*b)/2;a.center.x=(d.x+f.x)/2;a.center.y=(d.y+f.y)/2;return a}for(var l=0,m=0,k=0;k<f.length;k++)l+=f[k].x,m+=f[k].y;for(var l=l/f.length,m=m/f.length,p=f.map(function(a){return a.x-l}),x=f.map(function(a){return a.y-m}),z=d=a=0,v=0,r=q=0,k=b=0;k<p.length;k++){var u=p[k],C=
x[k],E=u*u,c=C*C;a+=E;d+=c;z+=u*C;v+=E*u;q+=c*C;r+=u*c;b+=C*E}k=a;p=z;x=d;v=.5*(v+r);q=.5*(q+b);b=k*x-z*p;r=(v*x-q*p)/b;q=(k*q-z*v)/b;return{radius:Math.sqrt(r*r+q*q+(a+d)/f.length),center:{x:r+l,y:q+m}}}})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler","./support"],function(w,l,f,a,d){Object.defineProperty(l,"__esModule",{value:!0});l.DefaultParameters={maximumClickDelay:300,movementUntilDrag:1.5,
holdDelay:500};w=function(a){function b(b,d,f){void 0===b&&(b=l.DefaultParameters.maximumClickDelay);void 0===d&&(d=l.DefaultParameters.movementUntilDrag);void 0===f&&(f=l.DefaultParameters.holdDelay);var k=a.call(this,"recognizers.PointerClickHoldAndDrag",!1)||this;k.maximumClickDelay=b;k.movementUntilDrag=d;k.holdDelay=f;k._pointerState=new Map;k._modifiers=new Set;k._pointerDrag=k.registerOutgoing("pointer-drag");k._pointerClick=k.registerOutgoing("pointer-click");k._pointerHold=k.registerOutgoing("hold");
k.registerIncoming("pointer-down",k._handlePointerDown.bind(k));k.registerIncoming("pointer-up",k._handlePointerUpOrLost.bind(k));k.registerIncoming("pointer-capture-lost",k._handlePointerUpOrLost.bind(k));k._moveHandle=k.registerIncoming("pointer-move",k._handlePointerMove.bind(k));k._moveHandle.pause();return k}f(b,a);b.prototype.onUninstall=function(){this._pointerState.forEach(function(a){0!==a.holdTimeout&&(clearTimeout(a.holdTimeout),a.holdTimeout=0)});a.prototype.onUninstall.call(this)};b.prototype._handlePointerDown=
function(a){var b=this,d=a.data,f=d.native.pointerId,q=0;0===this._pointerState.size&&(q=setTimeout(function(){var d=b._pointerState.get(f);d&&(d.isDragging||(b._pointerHold.emit(d.previousEvent,void 0,a.modifiers),d.holdEmitted=!0),d.holdTimeout=0)},this.holdDelay));1===this._pointerState.size&&this._pointerState.forEach(function(a){0!==a.holdTimeout&&(clearTimeout(a.holdTimeout),a.holdTimeout=0)});this._pointerState.set(f,{startEvent:d,previousEvent:d,startTimestamp:a.timestamp,totalMovement:0,
isDragging:!1,downButton:d.native.button,holdTimeout:q});this.startCapturingPointer(d.native);this._moveHandle.resume()};b.prototype._createPointerDragData=function(a,b,d){return{action:a,startEvent:b.startEvent,previousEvent:b.previousEvent,currentEvent:d}};b.prototype._handlePointerMove=function(a){var b=a.data,f=this._pointerState.get(b.native.pointerId);f&&(f.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",f,b),void 0,this._modifiers):(f.totalMovement+=d.manhattanDistance(b,
f.previousEvent),f.totalMovement>this.movementUntilDrag&&(f.isDragging=!0,f.previousEvent=f.startEvent,this._modifiers=a.modifiers,0!==f.holdTimeout&&clearTimeout(f.holdTimeout),this._pointerDrag.emit(this._createPointerDragData("start",f,f.startEvent),f.startTimestamp),this._pointerDrag.emit(this._createPointerDragData("update",f,b)))),f.previousEvent=b)};b.prototype._handlePointerUpOrLost=function(a){var b=a.data,d=b.native.pointerId,f=this._pointerState.get(d);f&&(0!==f.holdTimeout&&clearTimeout(f.holdTimeout),
f.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",f,b),void 0,this._modifiers):f.downButton===b.native.button&&a.timestamp-f.startTimestamp<=this.maximumClickDelay&&!f.holdEmitted&&this._pointerClick.emit(b),this._pointerState.delete(d),this.stopCapturingPointer(b.native),0===this._pointerState.size&&this._moveHandle.pause())};return b}(a.InputHandler);l.PointerClickHoldAndDrag=w})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define(["require","exports","../../../core/tsSupport/extendsHelper",
"../InputHandler","./support"],function(w,l,f,a,d){Object.defineProperty(l,"__esModule",{value:!0});w=function(a){function b(b,d,f){void 0===b&&(b=250);void 0===d&&(d=10);void 0===f&&(f=35);var k=a.call(this,"recognizers.SingleAndDoubleClick",!1)||this;k.maximumDoubleClickDelay=b;k.maximumDoubleClickDistance=d;k.maximumDoubleTouchDistance=f;k._pointerState=new Map;k._click=k.registerOutgoing("click");k._doubleClick=k.registerOutgoing("double-click");k.registerIncoming("pointer-click",k._handlePointerClick.bind(k));
return k}f(b,a);b.prototype.onUninstall=function(){this._pointerState.forEach(function(a){0!==a.doubleClickTimeout&&(clearTimeout(a.doubleClickTimeout),a.doubleClickTimeout=0)})};b.prototype._pointerId=function(a){a=a.native;return"mouse"===a.pointerType?a.pointerId+":"+a.button:""+a.pointerType};b.prototype._handlePointerClick=function(a){var b=a.data,f=this._pointerId(b),p=this._pointerState.get(f);if(p){clearTimeout(p.doubleClickTimeout);p.doubleClickTimeout=0;var q="touch"===b.native.pointerType?
this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;d.manhattanDistance(p.event.data,b)>q?(this._doubleClickTimeoutExceeded(f),this._startClick(a)):(this._doubleClick.emit(b,void 0,p.event.modifiers),this._pointerState.delete(f))}else this._startClick(a)};b.prototype._startClick=function(a){var b=this,d=this._pointerId(a.data);this._pointerState.set(d,{event:a,doubleClickTimeout:setTimeout(function(){return b._doubleClickTimeoutExceeded(d)},this.maximumDoubleClickDelay)})};b.prototype._doubleClickTimeoutExceeded=
function(a){var b=this._pointerState.get(a);this._click.emit(b.event.data,void 0,b.event.modifiers);b.doubleClickTimeout=0;this._pointerState.delete(a)};return b}(a.InputHandler);l.SingleAndDoubleClick=w})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(w,l,f,a){Object.defineProperty(l,"__esModule",{value:!0});w=function(a){function b(b,d){void 0===b&&(b=20);void 0===d&&(d=40);var f=a.call(this,
"recognizers.VerticalTwoFingerDrag",!1)||this;f._threshold=b;f._maxDelta=d;f._failed=!1;f._active=!1;f._vertical=f.registerOutgoing("vertical-two-finger-drag");f._artificalDragEnd=f.registerOutgoing("drag");f.registerIncoming("drag",f._handleDrag.bind(f));return f}f(b,a);Object.defineProperty(b.prototype,"failed",{get:function(){return this._failed},enumerable:!0,configurable:!0});b.prototype._handleDrag=function(a){if(2===a.data.pointers.length)switch(a.data.action){case "start":this._handleDragStart(a);
break;case "update":this._handleDragUpdate(a);break;case "end":this._handleDragEnd(a)}};b.prototype._handleDragStart=function(a){this._failed=!1;this._dragStartCenter=a.data.currentState.center};b.prototype._handleDragUpdate=function(a){this._failed||(this._active?(this._vertical.emit({delta:a.data.currentState.center.y-this._thresholdReachedCenter.y,action:"update"}),a.stopPropagation()):(this._failed=!this._checkDeltaConstraint(a.data),!this._failed&&this._checkThresholdReached(a.data)&&(this._active=
!0,this._thresholdReachedCenter=a.data.currentState.center,this._artificalDragEnd.emit({action:"end",currentState:a.data.currentState,previousState:a.data.previousState,startState:a.data.startState,pointers:a.data.pointers}),this._vertical.emit({delta:a.data.currentState.center.y-this._thresholdReachedCenter.y,action:"begin"}),a.stopPropagation())))};b.prototype._handleDragEnd=function(a){this._active&&(this._vertical.emit({delta:a.data.currentState.center.y-this._thresholdReachedCenter.y,action:"end"}),
a.stopPropagation());this._active=!1};b.prototype._checkDeltaConstraint=function(a){var b=Math.abs(a.pointers[0].startEvent.x-a.pointers[1].startEvent.x),d=Math.abs(a.pointers[0].startEvent.y-a.pointers[1].startEvent.y),f=Math.abs(a.pointers[0].currentEvent.y-a.pointers[1].currentEvent.y),p=Math.abs(a.pointers[0].currentEvent.x-a.pointers[1].currentEvent.x);return Math.abs(a.currentState.center.x-a.startState.center.x)<this._threshold&&Math.abs(p-b)<=this._maxDelta&&Math.abs(f-d)<=this._maxDelta};
b.prototype._checkThresholdReached=function(a){return Math.min(Math.abs(a.pointers[0].currentEvent.y-a.pointers[0].startEvent.y),Math.abs(a.pointers[1].currentEvent.y-a.pointers[1].startEvent.y),Math.abs(a.currentState.center.y-a.startState.center.y))>=this._threshold};return b}(a.InputHandler);l.VerticalTwoFingerDrag=w})},"esri/views/input/handlers/LatestPointerType":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(w,l,f,a){Object.defineProperty(l,
"__esModule",{value:!0});w=function(a){function b(b){var d=a.call(this,"LatestPointerInteraction",!0)||this;d._onChange=b;d._value="mouse";d.registerIncoming("pointer-down",function(a){d._setValue("touch"===a.data.native.pointerType?"touch":"mouse")});d._moveHandler=d.registerIncoming("pointer-move",function(a){d._setValue("touch"===a.data.native.pointerType?"touch":"mouse")});d._moveHandler.pause();return d}f(b,a);b.prototype._setValue=function(a){a!==this._value&&("touch"===a?this._moveHandler.resume():
this._moveHandler.pause(),this._value=a,this._onChange(a))};return b}(a.InputHandler);l.LatestPointerType=w})},"esri/views/input/BrowserEventSource":function(){define(["require","exports","./keys","../../core/libs/pep/pep","dojo/sniff"],function(w,l,f,a,d){Object.defineProperty(l,"__esModule",{value:!0});var b=d("trident"),q=d("edge"),t=d("chrome"),m=d("ff"),k=d("safari");w=function(){function d(b){this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._element=b;a.applyLocal(b);
b.getAttribute("tabindex")||b.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointerDown,"pointer-move":this._handlePointer,"pointer-up":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._initialCssTouchAction=b.style.touchAction;b.style.touchAction="none"}d.prototype.destroy=function(){var a=this;this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(function(b){a._element.releasePointerCapture(b)});
this._activePointerCaptures=null;this._element.style.touchAction=this._initialCssTouchAction};Object.defineProperty(d.prototype,"onEventReceived",{set:function(a){this._callback=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"activeEvents",{set:function(a){var b=this,d;for(d in this._active)a&&a.has(d)||(this._element.removeEventListener(p[d],this._active[d]),delete this._active[d]);a&&a.forEach(function(a){if(!b._active[a]&&p[a]){var d=(b._eventHandlers[a]||b._handleDefault).bind(b,
a);b._element.addEventListener(p[a],d);b._active[a]=d}})},enumerable:!0,configurable:!0});d.prototype.setPointerCapture=function(a,b){b?(this._element.setPointerCapture(a.pointerId),this._activePointerCaptures.add(a.pointerId)):(this._element.releasePointerCapture(a.pointerId),this._activePointerCaptures.delete(a.pointerId))};d.prototype._updateNormalizedPointerLikeEvent=function(a,b){var d=this._element.getBoundingClientRect();b.x=a.clientX-Math.round(d.left);b.y=a.clientY-Math.round(d.top);return b};
d.prototype._handleKey=function(a,b){var d=f.eventKey(b);d&&"key-up"===a&&this._keyDownState.delete(d);b={native:b,key:d,repeat:d&&this._keyDownState.has(d)};d&&"key-down"===a&&this._keyDownState.add(b.key);this._callback(a,b)};d.prototype._handlePointerDown=function(a,b){b=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0});this._callback(a,b)};d.prototype._handlePointer=function(a,b){var d=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0});b.preventDefault();this._callback(a,
d)};d.prototype._handleMouseWheel=function(a,d){d.preventDefault();var f=d.deltaY;switch(d.deltaMode){case 0:if(b||q)f=f/document.documentElement.clientHeight*600;break;case 1:f*=30;break;case 2:f*=900}b||q?f*=.7:t||k?f*=.6:m&&(f*=1.375);var p=Math.abs(f);100<p&&(f=f/p*200/(1+Math.exp(-.02*(p-100))));d=this._updateNormalizedPointerLikeEvent(d,{native:d,x:0,y:0,deltaY:f});this._callback(a,d)};d.prototype._handlePointerCaptureLost=function(a,b){this._activePointerCaptures.delete(b.pointerId);this._handleDefault(a,
b)};d.prototype._handleDefault=function(a,b){var d={native:b};b.preventDefault();this._callback(a,d)};return d}();l.BrowserEventSource=w;var p={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu"}})},"esri/core/libs/pep/pep":function(){define(function(){function w(a,c){c=c||Object.create(null);
var b=document.createEvent("Event");b.initEvent(a,c.bubbles||!1,c.cancelable||!1);a=2;for(var e;a<k.length;a++)e=k[a],b[e]=c[e]||p[a];b.buttons=c.buttons||0;a=0;a=c.pressure?c.pressure:b.buttons?.5:0;b.x=b.clientX;b.y=b.clientY;b.pointerId=c.pointerId||0;b.width=c.width||0;b.height=c.height||0;b.pressure=a;b.tiltX=c.tiltX||0;b.tiltY=c.tiltY||0;b.pointerType=c.pointerType||"";b.hwTimestamp=c.hwTimestamp||0;b.isPrimary=c.isPrimary||!1;return b}function l(){this.array=[];this.size=0}function f(a,c,b,
e){this.addCallback=a.bind(e);this.removeCallback=c.bind(e);this.changedCallback=b.bind(e);G&&(this.observer=new G(this.mutationWatcher.bind(this)))}function a(a){return"body /shadow-deep/ "+d(a)}function d(a){return'[touch-action\x3d"'+a+'"]'}function b(a){return"{ -ms-touch-action: "+a+"; touch-action: "+a+"; touch-action-delay: none; }"}function q(){if(P){K.forEach(function(c){String(c)===c?(J+=d(c)+b(c)+"\n",O&&(J+=a(c)+b(c)+"\n")):(J+=c.selectors.map(d)+b(c.rule)+"\n",O&&(J+=c.selectors.map(a)+
b(c.rule)+"\n"))});var c=document.createElement("style");c.textContent=J;document.head.appendChild(c)}}function t(a){if(!C.pointermap.has(a))throw a=Error("InvalidPointerId"),a.name="InvalidPointerId",a;}function m(a){if(!a.ownerDocument.contains(a))throw a=Error("InvalidStateError"),a.name="InvalidStateError",a;}var k="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget pageX pageY".split(" "),p=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,
0,null,0,0],x=window.Map&&window.Map.prototype.forEach?Map:l;l.prototype={set:function(a,c){if(void 0===c)return this.delete(a);this.has(a)||this.size++;this.array[a]=c},has:function(a){return void 0!==this.array[a]},delete:function(a){this.has(a)&&(delete this.array[a],this.size--)},get:function(a){return this.array[a]},clear:function(){this.size=this.array.length=0},forEach:function(a,c){return this.array.forEach(function(b,e){a.call(c,b,e,this)},this)}};var z="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget buttons pointerId width height pressure tiltX tiltY pointerType hwTimestamp isPrimary type target currentTarget which pageX pageY timeStamp".split(" "),
v=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],r={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},u="undefined"!==typeof SVGElementInstance,C={pointermap:new x,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(a,c){var b=c.events;b&&(b.forEach(function(a){c[a]&&(this.eventMap[a]=c[a].bind(c))},this),this.eventSources[a]=c,this.eventSourceList.push(c))},register:function(a){for(var c=
this.eventSourceList.length,b=0,e;b<c&&(e=this.eventSourceList[b]);b++)e.register.call(e,a)},unregister:function(a){for(var c=this.eventSourceList.length,b=0,e;b<c&&(e=this.eventSourceList[b]);b++)e.unregister.call(e,a)},contains:function(a,c){try{return a.contains(c)}catch(ca){return!1}},down:function(a){a.bubbles=!0;this.fireEvent("pointerdown",a)},move:function(a){a.bubbles=!0;this.fireEvent("pointermove",a)},up:function(a){a.bubbles=!0;this.fireEvent("pointerup",a)},enter:function(a){a.bubbles=
!1;this.fireEvent("pointerenter",a)},leave:function(a){a.bubbles=!1;this.fireEvent("pointerleave",a)},over:function(a){a.bubbles=!0;this.fireEvent("pointerover",a)},out:function(a){a.bubbles=!0;this.fireEvent("pointerout",a)},cancel:function(a){a.bubbles=!0;this.fireEvent("pointercancel",a)},leaveOut:function(a){this.out(a);this.propagate(a,this.leave,!1)},enterOver:function(a){this.over(a);this.propagate(a,this.enter,!0)},eventHandler:function(a){if(!a._handledByPE){var c=a.type;(c=this.eventMap&&
this.eventMap[c])&&c(a);a._handledByPE=!0}},listen:function(a,c){c.forEach(function(c){this.addEvent(a,c)},this)},unlisten:function(a,c){c.forEach(function(c){this.removeEvent(a,c)},this)},addEvent:function(a,c){a.addEventListener(c,this.boundHandler)},removeEvent:function(a,c){a.removeEventListener(c,this.boundHandler)},makeEvent:function(a,c){this.captureInfo[c.pointerId]&&(c.relatedTarget=null);a=new w(a,c);c.preventDefault&&(a.preventDefault=c.preventDefault);a._target=a._target||c.target;return a},
fireEvent:function(a,c){a=this.makeEvent(a,c);return this.dispatchEvent(a)},cloneEvent:function(a){for(var c=Object.create(null),b,e=0;e<z.length;e++)b=z[e],c[b]=a[b]||v[e],u&&("target"===b||"relatedTarget"===b)&&c[b]instanceof SVGElementInstance&&(c[b]=c[b].correspondingUseElement);a.preventDefault&&(c.preventDefault=function(){a.preventDefault()});return c},getTarget:function(a){var c=this.captureInfo[a.pointerId];if(!c)return a._target;if(a._target===c||!(a.type in r))return c},propagate:function(a,
c,b){for(var e=a.target,d=[];!e.contains(a.relatedTarget)&&e!==document;)d.push(e),e=e.parentNode;b&&d.reverse();d.forEach(function(b){a.target=b;c.call(this,a)},this)},setCapture:function(a,c){this.captureInfo[a]&&this.releaseCapture(a);this.captureInfo[a]=c;var b=new w("gotpointercapture");b.pointerId=a;this.implicitRelease=this.releaseCapture.bind(this,a);document.addEventListener("pointerup",this.implicitRelease);document.addEventListener("pointercancel",this.implicitRelease);b._target=c;this.asyncDispatchEvent(b)},
releaseCapture:function(a){var c=this.captureInfo[a];if(c){var b=new w("lostpointercapture");b.pointerId=a;this.captureInfo[a]=void 0;document.removeEventListener("pointerup",this.implicitRelease);document.removeEventListener("pointercancel",this.implicitRelease);b._target=c;this.asyncDispatchEvent(b)}},dispatchEvent:function(a){var c=this.getTarget(a);if(c)return c.dispatchEvent(a)},asyncDispatchEvent:function(a){requestAnimationFrame(this.dispatchEvent.bind(this,a))}};C.boundHandler=C.eventHandler.bind(C);
var E={shadow:function(a){if(a)return a.shadowRoot||a.webkitShadowRoot},canTarget:function(a){return a&&!!a.elementFromPoint},targetingShadow:function(a){a=this.shadow(a);if(this.canTarget(a))return a},olderShadow:function(a){var c=a.olderShadowRoot;!c&&(a=a.querySelector("shadow"))&&(c=a.olderShadowRoot);return c},allShadows:function(a){var c=[];for(a=this.shadow(a);a;)c.push(a),a=this.olderShadow(a);return c},searchRoot:function(a,c,b){if(a){var e=a.elementFromPoint(c,b),d;for(d=this.targetingShadow(e);d;){if(a=
d.elementFromPoint(c,b))return e=this.targetingShadow(a),this.searchRoot(e,c,b)||a;d=this.olderShadow(d)}return e}},owner:function(a){for(;a.parentNode;)a=a.parentNode;a.nodeType!==Node.DOCUMENT_NODE&&a.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(a=document);return a},findTarget:function(a){var c=a.clientX,b=a.clientY;a=this.owner(a.target);a.elementFromPoint(c,b)||(a=document);return this.searchRoot(a,c,b)}},c=Array.prototype.forEach.call.bind(Array.prototype.forEach),D=Array.prototype.map.call.bind(Array.prototype.map),
B=Array.prototype.slice.call.bind(Array.prototype.slice),I=Array.prototype.filter.call.bind(Array.prototype.filter),G=window.MutationObserver||window.WebKitMutationObserver,H={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};f.prototype={watchSubtree:function(a){this.observer&&E.canTarget(a)&&this.observer.observe(a,H)},enableOnSubtree:function(a){this.watchSubtree(a);a===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(a)},
installNewSubtree:function(a){c(this.findElements(a),this.addElement,this)},findElements:function(a){return a.querySelectorAll?a.querySelectorAll("[touch-action]"):[]},removeElement:function(a){this.removeCallback(a)},addElement:function(a){this.addCallback(a)},elementChanged:function(a,c){this.changedCallback(a,c)},concatLists:function(a,c){return a.concat(B(c))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},
isElement:function(a){return a.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(a){var c=D(a,this.findElements,this);c.push(I(a,this.isElement));return c.reduce(this.concatLists,[])},mutationWatcher:function(a){a.forEach(this.mutationHandler,this)},mutationHandler:function(a){"childList"===a.type?(this.flattenMutationTree(a.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(a.removedNodes).forEach(this.removeElement,this)):"attributes"===a.type&&this.elementChanged(a.target,
a.oldValue)}};var K=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],J="",P=window.PointerEvent||window.MSPointerEvent,O=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,L=C.pointermap,M=[1,4,2,8,16],R=!1;try{R=1===(new MouseEvent("test",{buttons:1})).buttons}catch(Y){}var Q={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(a){C.listen(a,this.events)},unregister:function(a){C.unlisten(a,
this.events)},lastTouches:[],isEventSimulatedFromTouch:function(a){var c=this.lastTouches,b=a.clientX;a=a.clientY;for(var e=0,d=c.length,g;e<d&&(g=c[e]);e++){var f=Math.abs(a-g.y);if(25>=Math.abs(b-g.x)&&25>=f)return!0}},prepareEvent:function(a){var c=C.cloneEvent(a),b=c.preventDefault;c.preventDefault=function(){a.preventDefault();b()};c.pointerId=this.POINTER_ID;c.isPrimary=!0;c.pointerType=this.POINTER_TYPE;return c},prepareButtonsForMove:function(a,c){var b=L.get(this.POINTER_ID);a.buttons=0!==
c.which&&b?b.buttons:0;c.buttons=a.buttons},mousedown:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=L.get(this.POINTER_ID),b=this.prepareEvent(a);R||(b.buttons=M[b.button],c&&(b.buttons|=c.buttons),a.buttons=b.buttons);L.set(this.POINTER_ID,a);c&&0!==c.buttons?C.move(b):C.down(b)}},mousemove:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=this.prepareEvent(a);R||this.prepareButtonsForMove(c,a);c.button=-1;L.set(this.POINTER_ID,a);C.move(c)}},mouseup:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=
L.get(this.POINTER_ID),b=this.prepareEvent(a);if(!R){var e=M[b.button];b.buttons=c?c.buttons&~e:0;a.buttons=b.buttons}L.set(this.POINTER_ID,a);b.buttons&=~M[b.button];0===b.buttons?C.up(b):C.move(b)}},mouseover:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=this.prepareEvent(a);R||this.prepareButtonsForMove(c,a);c.button=-1;L.set(this.POINTER_ID,a);C.enterOver(c)}},mouseout:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=this.prepareEvent(a);R||this.prepareButtonsForMove(c,a);c.button=
-1;C.leaveOut(c)}},cancel:function(a){a=this.prepareEvent(a);C.cancel(a);this.deactivateMouse()},deactivateMouse:function(){L.delete(this.POINTER_ID)}},T=C.captureInfo,A=E.findTarget.bind(E),V=E.allShadows.bind(E),S=C.pointermap,h,e={events:["touchstart","touchmove","touchend","touchcancel"],register:function(a){h.enableOnSubtree(a)},unregister:function(a){},elementAdded:function(a){var c=a.getAttribute("touch-action"),b=this.touchActionToScrollType(c);b&&(a._scrollType=b,C.listen(a,this.events),
V(a).forEach(function(a){a._scrollType=b;C.listen(a,this.events)},this))},elementRemoved:function(a){a._scrollType=void 0;C.unlisten(a,this.events);V(a).forEach(function(a){a._scrollType=void 0;C.unlisten(a,this.events)},this)},elementChanged:function(a,c){var b=a.getAttribute("touch-action"),e=this.touchActionToScrollType(b);c=this.touchActionToScrollType(c);e&&c?(a._scrollType=e,V(a).forEach(function(a){a._scrollType=e},this)):c?this.elementRemoved(a):e&&this.elementAdded(a)},scrollTypes:{EMITTER:"none",
XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(a){var c=this.scrollTypes;if("none"===a)return"none";if(a===c.XSCROLLER)return"X";if(a===c.YSCROLLER)return"Y";if(c.SCROLLER.exec(a))return"XY"},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(0===S.size||1===S.size&&S.has(1))this.firstTouch=a.identifier,this.firstXY={X:a.clientX,Y:a.clientY},this.scrolling=
!1,this.cancelResetClickCount()},removePrimaryPointer:function(a){a.isPrimary&&(this.firstXY=this.firstTouch=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var a=function(){this.clickCount=0;this.resetId=null}.bind(this);this.resetId=setTimeout(a,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(a){var c=0;if("touchstart"===a||"touchmove"===a)c=1;return c},touchToPointer:function(a){var c=this.currentTouchEvent,
b=C.cloneEvent(a),e=b.pointerId=a.identifier+2;b.target=T[e]||A(b);b.bubbles=!0;b.cancelable=!0;b.detail=this.clickCount;b.button=0;b.buttons=this.typeToButtons(c.type);b.width=a.radiusX||a.webkitRadiusX||0;b.height=a.radiusY||a.webkitRadiusY||0;b.pressure=a.force||a.webkitForce||.5;b.isPrimary=this.isPrimaryTouch(a);b.pointerType=this.POINTER_TYPE;b.altKey=c.altKey;b.ctrlKey=c.ctrlKey;b.metaKey=c.metaKey;b.shiftKey=c.shiftKey;var d=this;b.preventDefault=function(){d.scrolling=!1;d.firstXY=null;c.preventDefault()};
return b},processTouches:function(a,c){var b=a.changedTouches;this.currentTouchEvent=a;a=0;for(var e;a<b.length;a++)e=b[a],c.call(this,this.touchToPointer(e))},shouldScroll:function(a){if(this.firstXY){var c;c=a.currentTarget._scrollType;if("none"===c)c=!1;else if("XY"===c)c=!0;else{a=a.changedTouches[0];var b="Y"===c?"X":"Y";c=Math.abs(a["client"+c]-this.firstXY[c])>=Math.abs(a["client"+b]-this.firstXY[b])}this.firstXY=null;return c}},findTouch:function(a,c){for(var b=0,e=a.length,d;b<e&&(d=a[b]);b++)if(d.identifier===
c)return!0},vacuumTouches:function(a){var c=a.touches;if(S.size>=c.length){var b=[];S.forEach(function(a,e){1===e||this.findTouch(c,e-2)||b.push(a.out)},this);b.forEach(this.cancelOut,this)}},touchstart:function(a){this.vacuumTouches(a);this.setPrimaryTouch(a.changedTouches[0]);this.dedupSynthMouse(a);this.scrolling||(this.clickCount++,this.processTouches(a,this.overDown))},overDown:function(a){S.set(a.pointerId,{target:a.target,out:a,outTarget:a.target});C.enterOver(a);C.down(a)},touchmove:function(a){this.scrolling||
(this.shouldScroll(a)?(this.scrolling=!0,this.touchcancel(a)):(a.preventDefault(),this.processTouches(a,this.moveOverOut)))},moveOverOut:function(a){var c=S.get(a.pointerId);if(c){var b=c.out,e=c.outTarget;C.move(a);b&&e!==a.target&&(b.relatedTarget=a.target,a.relatedTarget=e,b.target=e,a.target?(C.leaveOut(b),C.enterOver(a)):(a.target=e,a.relatedTarget=null,this.cancelOut(a)));c.out=a;c.outTarget=a.target}},touchend:function(a){this.dedupSynthMouse(a);this.processTouches(a,this.upOut)},upOut:function(a){this.scrolling||
(C.up(a),C.leaveOut(a));this.cleanUpPointer(a)},touchcancel:function(a){this.processTouches(a,this.cancelOut)},cancelOut:function(a){C.cancel(a);C.leaveOut(a);this.cleanUpPointer(a)},cleanUpPointer:function(a){S.delete(a.pointerId);this.removePrimaryPointer(a)},dedupSynthMouse:function(a){var c=Q.lastTouches;a=a.changedTouches[0];this.isPrimaryTouch(a)&&(a={x:a.clientX,y:a.clientY},c.push(a),c=function(a,c){c=a.indexOf(c);-1<c&&a.splice(c,1)}.bind(null,c,a),setTimeout(c,2500))}};h=new f(e.elementAdded,
e.elementRemoved,e.elementChanged,e);var g=C.pointermap,n=window.MSPointerEvent&&"number"===typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,y={events:"MSPointerDown MSPointerMove MSPointerUp MSPointerOut MSPointerOver MSPointerCancel MSGotPointerCapture MSLostPointerCapture".split(" "),register:function(a){C.listen(a,this.events)},unregister:function(a){C.unlisten(a,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(a){var c=a;n&&(c=C.cloneEvent(a),c.pointerType=
this.POINTER_TYPES[a.pointerType]);return c},cleanup:function(a){g.delete(a)},MSPointerDown:function(a){g.set(a.pointerId,a);a=this.prepareEvent(a);C.down(a)},MSPointerMove:function(a){a=this.prepareEvent(a);C.move(a)},MSPointerUp:function(a){var c=this.prepareEvent(a);C.up(c);this.cleanup(a.pointerId)},MSPointerOut:function(a){a=this.prepareEvent(a);C.leaveOut(a)},MSPointerOver:function(a){a=this.prepareEvent(a);C.enterOver(a)},MSPointerCancel:function(a){var c=this.prepareEvent(a);C.cancel(c);this.cleanup(a.pointerId)},
MSLostPointerCapture:function(a){a=C.makeEvent("lostpointercapture",a);C.dispatchEvent(a)},MSGotPointerCapture:function(a){a=C.makeEvent("gotpointercapture",a);C.dispatchEvent(a)}},F,N;window.navigator.msPointerEnabled?(F=function(a){t(a);m(this);0!==C.pointermap.get(a).buttons&&this.msSetPointerCapture(a)},N=function(a){t(a);this.msReleasePointerCapture(a)}):(F=function(a){t(a);m(this);0!==C.pointermap.get(a).buttons&&C.setCapture(a,this)},N=function(a){t(a);C.releaseCapture(a,this)});var U=window.PointerEvent||
window.MSPointerEvent;return{dispatcher:C,Installer:f,PointerEvent:w,PointerMap:x,targetFinding:E,applyGlobal:function(){q();window.PointerEvent||(window.PointerEvent=w,window.navigator.msPointerEnabled?(Object.defineProperty(window.navigator,"maxTouchPoints",{value:window.navigator.msMaxTouchPoints,enumerable:!0}),C.registerSource("ms",y)):(C.registerSource("mouse",Q),void 0!==window.ontouchstart&&C.registerSource("touch",e)),C.register(document));window.Element&&!Element.prototype.setPointerCapture&&
Object.defineProperties(Element.prototype,{setPointerCapture:{value:F},releasePointerCapture:{value:N}})},applyLocal:function(a){U||(window.PointerEvent||(window.navigator.msPointerEnabled?C.registerSource("ms",y):(C.registerSource("mouse",Q),void 0!==window.ontouchstart&&C.registerSource("touch",e)),C.register(document)),window.Element&&!Element.prototype.setPointerCapture&&(a.setPointerCapture=F.bind(a),a.releasePointerCapture=N.bind(a)),a.getAttribute("touch-action")||a.setAttribute("touch-action",
"none"))}}})},"esri/views/input/ViewEvents":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./InputHandler","../../geometry/ScreenPoint"],function(w,l,f,a,d){function b(a){return!!t[a]}function q(a){for(var d=0;d<a.length;d++)if(!b(a[d]))return!1;return!0}Object.defineProperty(l,"__esModule",{value:!0});var t={click:!0,"double-click":!0,hold:!0,drag:!0,"key-down":!0,"key-up":!0,"pointer-down":!0,"pointer-move":!0,"pointer-up":!0,"mouse-wheel":!0},m;(function(a){a[a.Left=
0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right"})(m||(m={}));w=function(){function a(a){this.handlers=new Map;this.counter=0;this.view=a;this.inputManager=null}a.prototype.connect=function(a){var b=this;a&&this.disconnect();this.inputManager=a;this.handlers.forEach(function(a,d){return b.inputManager.installHandlers(d,[a])})};a.prototype.disconnect=function(){var a=this;this.inputManager&&this.handlers.forEach(function(b,d){return a.inputManager.uninstallHandlers(d)});this.inputManager=null};
a.prototype.destroy=function(){this.disconnect();this.handlers.clear();this.view=null};a.prototype.register=function(a,d,f){var m=this;a=Array.isArray(a)?a:a.split(",");if(!q(a))return a.some(b)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;var p=Array.isArray(d)?d:[];f=Array.isArray(d)?f:d;var v=this.createUniqueGroupName();d=new k(this.view,a,p,f);this.handlers.set(v,d);this.inputManager&&this.inputManager.installHandlers(v,
[d]);return{remove:function(){return m.removeHandler(v)}}};a.prototype.removeHandler=function(a){this.handlers.has(a)&&this.handlers.delete(a);this.inputManager&&this.inputManager.uninstallHandlers(a)};a.prototype.createUniqueGroupName=function(){this.counter+=1;return"viewEvents_"+this.counter};return a}();l.ViewEvents=w;var k=function(a){function b(b,d,f,k){var m=a.call(this,"esri.views.input.ViewEventHandler",!0)||this;m.view=b;for(b=0;b<d.length;b++)switch(d[b]){case "click":m.registerIncoming("click",
f,function(a){return k(m.wrapClick(a))});break;case "double-click":m.registerIncoming("double-click",f,function(a){return k(m.wrapDoubleClick(a))});break;case "hold":m.registerIncoming("hold",f,function(a){return k(m.wrapHold(a))});break;case "drag":m.registerIncoming("drag",f,function(a){return k(m.wrapDrag(a))});break;case "key-down":m.registerIncoming("key-down",f,function(a){return k(m.wrapKeyDown(a))});break;case "key-up":m.registerIncoming("key-up",f,function(a){return k(m.wrapKeyUp(a))});break;
case "pointer-down":m.registerIncoming("pointer-down",f,function(a){return k(m.wrapPointer(a,"pointer-down"))});break;case "pointer-move":m.registerIncoming("pointer-move",f,function(a){return k(m.wrapPointer(a,"pointer-move"))});break;case "pointer-up":m.registerIncoming("pointer-up",f,function(a){return k(m.wrapPointer(a,"pointer-up"))});break;case "mouse-wheel":m.registerIncoming("mouse-wheel",f,function(a){return k(m.wrapMouseWheel(a))})}return m}f(b,a);b.prototype.wrapClick=function(a){var b=
a.data.x,f=a.data.y;return{type:"click",button:"touch"===a.data.native.pointerType?0:a.data.native.button,x:b,y:f,native:a.data.native,timestamp:a.timestamp,screenPoint:new d(b,f),mapPoint:this.view.toMap(b,f),stopPropagation:function(){return a.stopPropagation()}}};b.prototype.wrapDoubleClick=function(a){var b=a.data.x,d=a.data.y;return{type:"double-click",button:"touch"===a.data.native.pointerType?0:a.data.native.button,x:b,y:d,native:a.data.native,timestamp:a.timestamp,mapPoint:this.view.toMap(b,
d),stopPropagation:function(){return a.stopPropagation()}}};b.prototype.wrapHold=function(a){var b=a.data.x,d=a.data.y;return{type:"hold",button:"touch"===a.data.native.pointerType?0:a.data.native.button,x:b,y:d,native:a.data.native,timestamp:a.timestamp,mapPoint:this.view.toMap(b,d),stopPropagation:function(){return a.stopPropagation()}}};b.prototype.wrapDrag=function(a){return{type:"drag",action:a.data.action,x:a.data.currentState.center.x,y:a.data.currentState.center.y,origin:{x:a.data.startState.center.x,
y:a.data.startState.center.y},native:a.data.pointers[0].currentEvent.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};b.prototype.wrapKeyDown=function(a){return{type:"key-down",key:a.data.key,repeat:a.data.repeat,native:a.data.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};b.prototype.wrapKeyUp=function(a){return{type:"key-up",key:a.data.key,native:a.data.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};
b.prototype.wrapPointer=function(a,b){return{type:b,x:a.data.x,y:a.data.y,pointerId:a.data.native.pointerId,pointerType:a.data.native.pointerType,native:a.data.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};b.prototype.wrapMouseWheel=function(a){return{type:"mouse-wheel",x:a.data.x,y:a.data.y,deltaY:a.data.deltaY,native:a.data.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};return b}(a.InputHandler)})},"esri/views/input/handlers/PreventContextMenu":function(){define(["require",
"exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(w,l,f,a){Object.defineProperty(l,"__esModule",{value:!0});w=function(a){function b(){var b=a.call(this,"PreventContextMenu",!0)||this;b.registerIncoming("context-menu",function(a){a.data.native.preventDefault()});return b}f(b,a);return b}(a.InputHandler);l.PreventContextMenu=w;l.default=w})},"esri/views/3d/input/handlers/pinch/PinchNavigationGlobal":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/glMatrix ../../util ./PinchNavigationBase ./MomentumNavigationGlobal".split(" "),
function(w,l,f,a,d,b,q){Object.defineProperty(l,"__esModule",{value:!0});var t;(function(a){a[a.Horizontal=0]="Horizontal";a[a.Vertical=1]="Vertical"})(t=l.PanMode||(l.PanMode={}));var m=a.vec3d.create(),k=16/180*Math.PI;w=function(b){function p(f,k){var m=b.call(this,f,k)||this;m.view=f;m._rotation={axis:a.vec3d.create(),valueSmooth:new d.ExponentialFalloff(.05)};m._panning={axis:a.vec3d.create(),plane:{distance:0,normal:a.vec3d.create()},planarCenterScene:a.vec3d.create()};m._scaling={valueSmooth:new d.ExponentialFalloff(.05),
centerScreen:a.vec2.create()};m._beginScenePoints={points:[],center:a.vec3d.create()};m._panMode=t.Horizontal;m._navigationSphereRadius=0;m._tmpN=a.vec3d.create();m._tmp2d=a.vec2.create();m._tmpPickPointScreen=a.vec2.create();m._tmpPickPointScene=a.vec3d.create();m._tmpCurrentPoints=[];m._tmpCurrentCenter=a.vec3d.create();m._tmpD=a.vec3d.create();m._horizonPointScreen=a.vec3d.create();m._horizonPointScene=a.vec3d.create();m._momentumNavigation=new q.MomentumNavigationGlobal(m,k);return m}f(p,b);Object.defineProperty(p.prototype,
"momentum",{get:function(){return this._momentumNavigation},enumerable:!0,configurable:!0});p.prototype.onNavigationBegin=function(b){var d=this._tmpPickPointScreen,f=this._tmpPickPointScene,m=this._helper;this._rotation.valueSmooth.reset();this._scaling.valueSmooth.reset();a.vec2.set2(b.data.currentState.center.x,this.view.height-b.data.currentState.center.y,d);m.picker.pickPointInScreen(d,f)?this._navigationSphereRadius=a.vec3d.length(f):(this._navigationSphereRadius=Math.max(a.vec3d.length(this.beginCamera.center),
.9*m.earthUtils.earthRadius),this._helper.spherical.makeRenderCoordSpherePoint(this._navigationSphereRadius,this.beginCamera,d,f));this._panMode=t.Horizontal;3E4>this.view.renderCoordsHelper.getAltitude(this.beginCamera.eye)&&(this._navigationSphereRadius>a.vec3d.length(this.beginCamera.eye)?this._panMode=t.Vertical:(a.vec3d.normalize(f,this._tmpN),Math.abs(.5*Math.PI-Math.acos(a.vec3d.dot(this.beginCamera.viewForward,this._tmpN)))<k&&(this._panMode=t.Vertical)));if(this._panMode===t.Horizontal)this._computeSpherePoints(b,
"startEvent",this._navigationSphereRadius,this.beginCamera,this._beginScenePoints.points),m.spherical.computePointCenter(this._beginScenePoints.points,this._navigationSphereRadius,this._beginScenePoints.center);else{a.vec3d.set(this.beginCamera.viewForward,this._panning.plane.normal);a.vec3d.normalize(this._panning.plane.normal);a.vec3d.negate(this._panning.plane.normal);var p=a.vec3d.dot(f,this._panning.plane.normal),q=this._horizonPointScreen;a.vec3d.set3(d[0],this.view.height,0,q);var c=this._horizonPointScene,
l=a.vec3d.length(this.beginCamera.eye),x=this._navigationSphereRadius;this._helper.spherical.makeRenderCoordSpherePoint(l<x?l-100:x,this.beginCamera,q,c);this.beginCamera.projectPoint(c,q);d[1]=Math.min(d[1],.9*q[1]);m.picker.pickPointInScreen(d,f)&&(p=a.vec3d.dot(f,this._panning.plane.normal));this._panning.plane.distance=p;a.vec2.set2(b.data.currentState.center.x,this.view.height-b.data.currentState.center.y,this._tmp2d);this._helper.planar.intersectPlaneFromScreenPoint(this._panning.plane,this.beginCamera,
this._tmp2d,this._panning.planarCenterScene)}};p.prototype.onNavigationUpdate=function(b,d){var f=this._helper,k=b.data.pointers.length,p=1<k;if(this._panMode===t.Horizontal){var q=this._navigationSphereRadius;if(p){var c=b.data.startState.radius/b.data.currentState.radius,v=.001875*Math.min(Math.max(b.data.currentState.radius,40),120);this._scaling.valueSmooth.gain=v;this._scaling.valueSmooth.update(c);f.spherical.applyZoom(q,this.view,d,this._scaling.valueSmooth.value);a.vec2.set2(b.data.currentState.center.x,
this.view.height-b.data.currentState.center.y,this._scaling.centerScreen);this.momentum.addScaleValue(b.timestamp,this._scaling.valueSmooth.value)}c=this._tmpCurrentPoints;v=this._tmpCurrentCenter;this._computeSpherePoints(b,"currentEvent",q,d,c);f.spherical.computePointCenter(c,q,v);var c=this._panning.axis,l=f.spherical.rotationFromPoints(q,this._beginScenePoints.center,v,c);f.applyRotation(d,m,c,l);l=this._tmp2d;a.vec2.set2(b.data.currentState.center.x,this.view.height-b.data.currentState.center.y,
l);this.momentum.addPanValue(b.timestamp,l,v,c);if(p){p=this._rotation.axis;c=this._tmpCurrentPoints;a.vec3d.normalize(this._beginScenePoints.center,p);this._computeSpherePoints(b,"currentEvent",q,d,c);q=0;if(2===k)q=f.rotationFromPointsAroundAxis(c[0],this._beginScenePoints.points[0],p);else{for(v=0;v<k;v++)q+=f.rotationFromPointsAroundAxis(c[v],this._beginScenePoints.points[v],p);q/=k}k=this._rotation.valueSmooth.value;q=f.normalizeRotationDelta(q-k);v=.00125*Math.min(Math.max(b.data.currentState.radius,
40),120);this._rotation.valueSmooth.gain=v;this._rotation.valueSmooth.update(k+q);k=this._rotation.valueSmooth.value;this.momentum.addRotationValue(b.timestamp,k);f.applyRotation(d,m,p,k)}}else k=this._panning.plane,p&&(c=b.data.startState.radius/b.data.currentState.radius,v=.001875*Math.min(Math.max(b.data.currentState.radius,40),120),this._scaling.valueSmooth.gain=v,this._scaling.valueSmooth.update(c),this.momentum.addScaleValue(b.timestamp,this._scaling.valueSmooth.value),this.momentum.setVerticalParameters(k,
this._panning.planarCenterScene),f.planar.applyZoom(k,this.view,d,this._panning.planarCenterScene,this._scaling.valueSmooth.value)),v=this._tmpCurrentCenter,a.vec2.set2(b.data.currentState.center.x,this.view.height-b.data.currentState.center.y,this._tmp2d),this._helper.planar.intersectPlaneFromScreenPoint(k,d,this._tmp2d,v),k=this._tmpD,a.vec3d.subtract(v,this._panning.planarCenterScene,k),a.vec3d.subtract(d.eye,k),a.vec3d.subtract(d.center,k),d.markViewDirty(),l=this._tmp2d,a.vec2.set2(b.data.currentState.center.x,
this.view.height-b.data.currentState.center.y,l),this.momentum.addPanValue(b.timestamp,l,v,k),p&&(p=this._rotation.axis,a.vec3d.set(this._panning.planarCenterScene,p),q=b.data.currentState.angle,k=this._rotation.valueSmooth.value,q=f.normalizeRotationDelta(q-k),v=.00125*Math.min(Math.max(b.data.currentState.radius,40),120),this._rotation.valueSmooth.gain=v,this._rotation.valueSmooth.update(k+q),k=this._rotation.valueSmooth.value,this.momentum.addRotationValue(b.timestamp,k),f.applyRotation(d,m,p,
k));d.markViewDirty()};p.prototype.onNavigationEnd=function(a){this._panMode===t.Horizontal?this.momentum.setParameters(this._navigationSphereRadius,this._scaling.centerScreen,this._beginScenePoints.center,this._panMode):this.momentum.setParameters(this._navigationSphereRadius,this._scaling.centerScreen,this._panning.planarCenterScene,this._panMode)};p.prototype._computeSpherePoints=function(b,d,f,k,m){m.length=b.data.pointers.length;for(var p=this._tmp2d,c=0;c<m.length;c++){var r=b.data.pointers[c];
p[0]=r[d].x;p[1]=this.view.height-r[d].y;void 0===m[c]&&(m[c]=a.vec3d.create());this._helper.spherical.makeRenderCoordSpherePoint(f,k,p,m[c])}return m};return p}(b.PinchNavigationBase);l.PinchNavigationGlobal=w})},"esri/views/3d/input/util":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});w=function(){function f(a){this._gain=a}f.prototype.reset=function(a){this._value=a};Object.defineProperty(f.prototype,"gain",{set:function(a){this._gain=a},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"value",{get:function(){return void 0===this._value?0:this._value},enumerable:!0,configurable:!0});f.prototype.update=function(a){this._value=void 0===this._value?a:this._gain*a+(1-this._gain)*this._value};return f}();l.ExponentialFalloff=w})},"esri/views/3d/input/handlers/pinch/PinchNavigationBase":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../input/InputHandler ../../../lib/glMatrix ../../../webgl-engine/lib/Camera".split(" "),
function(w,l,f,a,d,b){Object.defineProperty(l,"__esModule",{value:!0});w=function(a){function q(f,k){var m=a.call(this,"esri.views.3d.input.handlers.PinchTest",!0)||this;m.view=f;m._helper=k;m._lastEndTimestamp=0;m._dragNavigationActive=!1;m._beginCamera=new b;m._tmpvec2d=d.vec2.create();m.registerIncoming("drag",function(a){return m._handleDrag(a)});m.registerIncoming("pointer-down",function(a){return m.stopMomentumNavigation()});m.registerIncoming("two-finger-drag-vertical",function(a){return m.stopMomentumNavigation()});
return m}f(q,a);q.prototype.stopMomentumNavigation=function(){this.momentum&&this.momentum.stop()};q.prototype.destroy=function(){this.momentum&&this.momentum.destroy()};q.prototype.applyNavigationConstraints=function(){var a=this.view.navigation;a.fixTargetUpVector();a.constrainTargetEyeByElevationAndMoveLookAt();a.targetAndCurrentChanged()};Object.defineProperty(q.prototype,"beginCamera",{get:function(){return this._beginCamera},enumerable:!0,configurable:!0});q.prototype.computePlanePoints=function(a,
b,f,q,l){l.length=a.data.pointers.length;for(var k=this._tmpvec2d,m=0;m<l.length;m++){var p=a.data.pointers[m];k[0]=p[b].x;k[1]=this.view.height-p[b].y;void 0===l[m]&&(l[m]=d.vec3d.create());this._helper.planar.intersectPlaneFromScreenPoint(f,q,k,l[m])}return l};q.prototype._handleDrag=function(a){if(1!==a.data.pointers.length||"mouse"!==a.data.pointers[0].currentEvent.native.pointerType){var b=a.timestamp-this._lastEndTimestamp,b=this.momentum&&this.momentum.active&&40>b;switch(a.data.action){case "start":if(b)break;
this._navigationBegin(a);break;case "update":if(b)break;this._dragNavigationActive?this._navigationUpdate(a):this._navigationBegin(a);break;case "end":this._dragNavigationActive&&(this._lastEndTimestamp=a.timestamp,this._navigationEnd(a))}a.stopPropagation()}};q.prototype._navigationBegin=function(a){var b=this.view.navigation;this.stopMomentumNavigation();this._dragNavigationActive=!0;this.beginCamera.copyFrom(b.currentCamera);b.begin(this);this.onNavigationBegin(a)};q.prototype._navigationUpdate=
function(a){if(!(.002>(a.data.currentState.timestamp-a.data.previousState.timestamp)/1E3)){var b=this.view.navigation.targetCamera;b.eye=this.beginCamera.eye;b.center=this.beginCamera.center;b.up=this.beginCamera.up;this.onNavigationUpdate(a,b);this.applyNavigationConstraints()}};q.prototype._navigationEnd=function(a){this.onNavigationEnd(a);this._dragNavigationActive=!1;this.momentum&&this.momentum.initiate();this.view.navigation.end(this)};return q}(a.InputHandler);l.PinchNavigationBase=w})},"esri/views/3d/webgl-engine/lib/Camera":function(){define(["require",
"exports","./Util","./gl-matrix"],function(w,l,f,a){function d(a,b){var d=b[0]-a[0],f=b[1]-a[1],k=b[2]-a[2];a=b[3]-a[3];return d*d+f*f+k*k+a*a}function b(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function q(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]}var t=a.vec3d,m=a.vec4d,k=a.mat4d;w=function(){function a(a,b,d){this._viewUp=t.create();this._viewForward=t.create();this._viewRight=t.create();this._viewport=m.create();this._padding=m.create();this._fov=55/180*Math.PI;this._near=
0;this._far=1E3;this._viewDirty=!0;this._viewMatrix=k.create();this._projectionDirty=!0;this._projectionMatrix=k.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=k.create();this._frustumPlanesDirty=!0;this._frustumPlanes=[m.create(),m.create(),m.create(),m.create(),m.create(),m.create()];this._fullViewport=null;this.aboveGround=!0;this._eye=t.create(a);this._center=t.create(b);this._up=void 0!==d?t.create(d):t.create([0,0,1]);this._padding=m.create()}Object.defineProperty(a.prototype,
"eye",{get:function(){return this._eye},set:function(a){this._compareAndSetView(a,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"center",{get:function(){return this._center},set:function(a){this._compareAndSetView(a,this._center)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"up",{get:function(){return this._up},set:function(a){this._compareAndSetView(a,this._up)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewMatrix",{get:function(){this._ensureViewClean();
return this._viewMatrix},set:function(a){k.set(a,this._viewMatrix);this._viewDirty=!1;this._frustumPlanesDirty=this._viewInverseTransposeMatrixDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewForward",{get:function(){this._ensureViewClean();return this._viewForward},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewUp",{get:function(){this._ensureViewClean();return this._viewUp},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"viewRight",{get:function(){this._ensureViewClean();return this._viewRight},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"near",{get:function(){return this._near},set:function(a){this._near!==a&&(this._near=a,this._frustumPlanesDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"far",{get:function(){return this._far},set:function(a){this._far!==a&&(this._far=a,this._frustumPlanesDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"viewport",{get:function(){return this._viewport},set:function(a){this.x=a[0];this.y=a[1];this.width=a[2];this.height=a[3]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"x",{get:function(){return this._viewport[0]},set:function(a){a+=this._padding[3];this._viewport[0]!==a&&(this._viewport[0]=a,this._frustumPlanesDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"y",{get:function(){return this._viewport[1]},
set:function(a){a+=this._padding[2];this._viewport[1]!==a&&(this._viewport[1]=a,this._frustumPlanesDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._viewport[2]},set:function(a){a-=this._padding[1]+this._padding[3];this._viewport[2]!==a&&(this._viewport[2]=a,this._frustumPlanesDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._viewport[3]},
set:function(a){a-=this._padding[0]+this._padding[2];this._viewport[3]!==a&&(this._viewport[3]=a,this._frustumPlanesDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"fullViewport",{get:function(){this._fullViewport||(this._fullViewport=m.create());this._fullViewport[0]=this._viewport[0]-this._padding[3];this._fullViewport[1]=this._viewport[1]-this._padding[2];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"padding",{get:function(){return this._padding},
set:function(a){if(this._padding[0]!==a[0]||this._padding[1]!==a[1]||this._padding[2]!==a[2]||this._padding[3]!==a[3])this._viewport[0]+=a[3]-this._padding[3],this._viewport[1]+=a[2]-this._padding[2],this._viewport[2]-=a[1]+a[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=a[0]+a[2]-(this._padding[0]+this._padding[2]),m.set(a,this._padding),this._frustumPlanesDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var a=
this.width,b=this.height,d=this.near*Math.tan(this.fovY/2),f=d*this.aspect;k.frustum(-f*(1+2*this._padding[3]/a),f*(1+2*this._padding[1]/a),-d*(1+2*this._padding[2]/b),d*(1+2*this._padding[0]/b),this.near,this.far,this._projectionMatrix);this._projectionDirty=!1}return this._projectionMatrix},set:function(a){k.set(a,this._projectionMatrix);this._projectionDirty=!1;this._frustumPlanesDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fov",{get:function(){return this._fov},
set:function(a){this._fov=a;this._frustumPlanesDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fovX",{get:function(){return f.fovd2fovx(this._fov,this.width,this.height)},set:function(a){this._fov=f.fovx2fovd(a,this.width,this.height);this._frustumPlanesDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"fovY",{get:function(){return f.fovd2fovy(this._fov,this.width,this.height)},set:function(a){this._fov=
f.fovy2fovd(a,this.width,this.height);this._frustumPlanesDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"distance",{get:function(){return t.dist(this._center,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"frustumPoints",{get:function(){return this.computeFrustumPoints()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"frustumPlanes",{get:function(){this._frustumPlanesDirty&&(this._frustumPlanes=this._computeFrustumPlanes(this._frustumPlanes),
this._frustumPlanesDirty=!1);return this._frustumPlanes},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"viewInverseTransposeMatrix",{get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=k.create()),k.inverse(this.viewMatrix,this._viewInverseTransposeMatrix),k.transpose(this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"perPixelRatio",{get:function(){return Math.tan(this.fovX/2)/this.width},enumerable:!0,configurable:!0});a.prototype.copyFrom=function(a){t.set(a._eye,this._eye);t.set(a._center,this._center);t.set(a._up,this._up);m.set(a._viewport,this._viewport);m.set(a._padding,this._padding);this._near=a._near;this._far=a._far;this._fov=a._fov;this.aboveGround=a.aboveGround;a._viewDirty?this._viewDirty=!0:(k.set(a._viewMatrix,this._viewMatrix),t.set(a._viewRight,
this._viewRight),t.set(a._viewUp,this._viewUp),t.set(a._viewForward,this._viewForward),this._viewDirty=!1);a._projectionDirty?this._projectionDirty=!0:(k.set(a._projectionMatrix,this._projectionMatrix),this._projectionDirty=!1);a._frustumPlanesDirty?this._frustumPlanesDirty=!0:(a.copyFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1);a._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?k.set(a._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix):
this._viewInverseTransposeMatrix=k.create(a._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);a._fullViewport?this._fullViewport?m.set(a._fullViewport,this._fullViewport):this._fullViewport=m.create(a._fullViewport):this._fullViewport=null;return this};a.prototype.copy=function(){var b=new a;b.copyFrom(this);return b};a.prototype.equals=function(a){return b(this._eye,a._eye)&&b(this._center,a._center)&&b(this._up,a._up)&&q(this._viewport,a._viewport)&&q(this._padding,a._padding)&&
this._near===a._near&&this._far===a._far&&this._fov===a._fov};a.prototype.almostEquals=function(a,b){b=t.dist(this._eye,this._center)*(b||5E-4);b*=b;return t.dist2(a._eye,this._eye)<b&&t.dist2(a._center,this._center)<b&&.001>Math.abs(a._fov-this._fov)&&.5>d(a._padding,this._padding)&&.5>d(a._viewport,this._viewport)};a.prototype.markViewDirty=function(){this._frustumPlanesDirty=this._viewDirty=!0};a.prototype.computePixelSizeAt=function(a){return 2*t.dist(a,this._eye)*Math.tan(this.fovX/2)/this.width};
a.prototype.computePixelSizeAtDist=function(a){return 2*a*Math.tan(this.fovX/2)/this.width};a.prototype.computeDistanceFromRadius=function(a,b){return a/Math.tan(Math.min(this.fovX,this.fovY)/(2*(b||1)))};a.prototype.copyFrustumPlanes=function(a){if(!a){a=Array(6);for(var b=0;6>b;++b)a[b]=m.create()}for(var d=this.frustumPlanes,b=0;6>b;b++)m.set(d[b],a[b]);return a};a.prototype.computeFrustumPoints=function(a){if(!a){a=Array(8);for(var b=0;8>b;++b)a[b]=t.create()}f.matrix2frustum(this.viewMatrix,
this.projectionMatrix,a);return a};a.prototype.setGLViewport=function(a){var b=this.viewport,d=this.padding;a.setViewport(b[0]-d[3],b[1]-d[2],b[2]+d[1]+d[3],b[3]+d[0]+d[2])};a.prototype.applyProjection=function(a,b,d){void 0===d&&(d=!1);a!==p&&t.set(a,p);p[3]=1;d&&(b[2]=-p[2]);k.multiplyVec4(this.projectionMatrix,p);t.scale(p,1/Math.abs(p[3]));a=this.fullViewport;b[0]=f.lerp(0,a[0]+a[2],.5+.5*p[0]);b[1]=f.lerp(0,a[1]+a[3],.5+.5*p[1]);d||(b[2]=.5*(p[2]+1));return b};a.prototype.projectPoint=function(a,
b,d){void 0===d&&(d=!1);k.multiplyVec3(this.viewMatrix,a,p);return this.applyProjection(p,b,d)};a.prototype.unprojectPoint=function(a,b,d){void 0===d&&(d=!1);if(d)return console.error("Camera.unprojectPoint() not yet implemented for linear Z"),null;k.multiply(this.projectionMatrix,this.viewMatrix,x);if(!k.inverse(x))return null;d=this.fullViewport;p[0]=2*(a[0]-d[0])/d[2]-1;p[1]=2*(a[1]-d[1])/d[3]-1;p[2]=2*a[2]-1;p[3]=1;k.multiplyVec4(x,p);if(0===p[3])return null;b[0]=p[0]/p[3];b[1]=p[1]/p[3];b[2]=
p[2]/p[3];return b};a.prototype.computeUpOnSphere=function(){t.subtract(this.center,this.eye,z);var a=t.length(this.center);1>a?t.set3(0,0,1,this.up):Math.abs(t.dot(z,this.center))>.9999*t.length(z)*a||(t.cross(z,this.center,this.up),t.cross(this.up,z,this.up),t.normalize(this.up))};a.prototype._compareAndSetView=function(a,d){b(a,d)||(t.set(a,d),this._frustumPlanesDirty=this._viewDirty=!0)};a.prototype._computeFrustumPlanes=function(a){if(!a){a=Array(6);for(var b=0;6>b;++b)a[b]=m.create()}f.matrix2frustumPlanes(this.viewMatrix,
this.projectionMatrix,a);return a};a.prototype._ensureViewClean=function(){this._viewDirty&&(k.lookAt(this._eye,this._center,this._up,this._viewMatrix),t.set3(-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10],this._viewForward),t.set3(this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9],this._viewUp),t.set3(this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8],this._viewRight),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};return a}();var p=m.create(),x=k.create(),
z=t.create();return w})},"esri/views/3d/input/handlers/pinch/MomentumNavigationGlobal":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/glMatrix ./MomentumNavigationBase ./PinchNavigationGlobal".split(" "),function(w,l,f,a,d,b){Object.defineProperty(l,"__esModule",{value:!0});var q=a.vec3d.create();w=function(d){function m(b,f){b=d.call(this,b,f)||this;b._panAxisOrDirection=a.vec3d.create();b._centerOnScreen=a.vec2.create();b._centerOnSphere=a.vec3d.create();
b._tmpSphereCenter=a.vec3d.create();b._tmpScaleAxis=a.vec3d.create();b._verticalPlane={distance:0,normal:a.vec3d.create()};b._verticalCenter=a.vec3d.create();return b}f(m,d);m.prototype.setParameters=function(b,d,f,m){this._radius=b;a.vec2.set(d,this._centerOnScreen);a.vec3d.set(f,this._centerOnSphere);this._mode=m};m.prototype.addPanValue=function(b,d,f,m){this.pan.estimator.add(d[0],d[1],f,.001*b);a.vec3d.set(m,this._panAxisOrDirection)};m.prototype.addRotationValue=function(a,b){this.rotation.estimator.add(b,
.001*a)};m.prototype.addScaleValue=function(a,b){this.zoom.estimator.add(b,.001*a)};m.prototype.setVerticalParameters=function(b,d){a.vec3d.set(d,this._verticalCenter);a.vec3d.set(b.normal,this._verticalPlane.normal);this._verticalPlane.distance=b.distance};m.prototype.onUpdate=function(d,f,m){var k=this._radius,p=this._centerOnScreen,r=this._centerOnSphere;if(this.zoom.momentum){var u=this.zoom.momentum.valueDelta(d,f);this._mode===b.PanMode.Horizontal?(this.helper.spherical.applyZoom(k,this.view,
m,u),this.helper.spherical.makeRenderCoordSpherePoint(k,m,p,this._tmpSphereCenter),k=this.helper.spherical.rotationFromPoints(k,r,this._tmpSphereCenter,this._tmpScaleAxis),this.helper.applyRotation(m,q,this._tmpScaleAxis,k)):this.helper.planar.applyZoom(this._verticalPlane,this.view,m,this._verticalCenter,u)}this.pan.momentum&&(this._mode===b.PanMode.Horizontal?(k=this.helper.spherical.rotationFromPoints(this._radius,this.pan.momentum.dataOldest,this.pan.momentum.dataNewest,this._panAxisOrDirection),
k/=this.pan.momentum.dataTimeDelta,k*=this.pan.momentum.velocityFactor(d),this.helper.applyRotation(m,q,this._panAxisOrDirection,k*f)):(k=a.vec3d.dist(this.pan.momentum.dataOldest,this.pan.momentum.dataNewest),k/=this.pan.momentum.dataTimeDelta,k*=this.pan.momentum.velocityFactor(d),a.vec3d.normalize(this._panAxisOrDirection),a.vec3d.scale(this._panAxisOrDirection,k*f),a.vec3d.subtract(m.eye,this._panAxisOrDirection),a.vec3d.subtract(m.center,this._panAxisOrDirection),m.markViewDirty()));this.rotation.momentum&&
(d=this.rotation.momentum.valueDelta(d,f),this.helper.applyRotation(m,q,r,d))};return m}(d.MomentumNavigationBase);l.MomentumNavigationGlobal=w})},"esri/views/3d/input/handlers/pinch/MomentumNavigationBase":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","../../../../navigation/Momentum"],function(w,l,f,a){Object.defineProperty(l,"__esModule",{value:!0});w=function(){function d(b,d){this.pinchNavigation=b;this._helper=d;this.zoom={momentum:null,estimator:new a.ZoomMomentumEstimator(.05),
enabled:!0};this.rotation={momentum:null,estimator:new a.RotationMomentumEstimator(.05,3,.05,.95),enabled:!0};this.pan={momentum:null,estimator:new a.ScreenspaceMomentumEstimator(.05,600,6,.82),enabled:!0};this._elapsedTime=0;this._active=!1}d.prototype.destroy=function(){this.stop()};Object.defineProperty(d.prototype,"active",{get:function(){return this._active},enumerable:!0,configurable:!0});d.prototype.doFrameUpdate=function(a){this._onUpdate(.001*a)};d.prototype.stop=function(){this.pan.estimator.reset();
this.rotation.estimator.reset();this.zoom.estimator.reset();this._active=!1};d.prototype.initiate=function(){this._active||(this._elapsedTime=0,this.pan.momentum=null,this.zoom.momentum=null,this.rotation.momentum=null,this.zoom.enabled&&(this.zoom.momentum=this.zoom.estimator.evaluateMomentum()),!this.zoom.momentum&&this.rotation.enabled&&(this.rotation.momentum=this.rotation.estimator.evaluateMomentum()),this.zoom.momentum||this.rotation.momentum||!this.pan.enabled||(this.pan.momentum=this.pan.estimator.evaluateMomentum()),
this._active=null!=(this.zoom.momentum||this.rotation.momentum||this.pan.momentum))};Object.defineProperty(d.prototype,"helper",{get:function(){return this._helper},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"view",{get:function(){return this.pinchNavigation.view},enumerable:!0,configurable:!0});d.prototype._onUpdate=function(a){this.active&&(this.zoom.momentum&&this.zoom.momentum.isFinished(this._elapsedTime)&&(this.zoom.momentum=null),this.rotation.momentum&&this.rotation.momentum.isFinished(this._elapsedTime)&&
(this.rotation.momentum=null),this.pan.momentum&&this.pan.momentum.isFinished(this._elapsedTime)&&(this.pan.momentum=null),this.zoom.momentum||this.rotation.momentum||this.pan.momentum?(this.view.navigation.targetCamera.copyFrom(this.view.navigation.currentCamera),this.onUpdate(this._elapsedTime,a,this.view.navigation.targetCamera),this.pinchNavigation.applyNavigationConstraints(),this._elapsedTime+=a):this.stop())};return d}();l.MomentumNavigationBase=w})},"esri/views/navigation/Momentum":function(){define(["require",
"exports","../../core/tsSupport/extendsHelper","./ValueHistory","../3d/lib/glMatrix"],function(w,l,f,a,d){Object.defineProperty(l,"__esModule",{value:!0});var b=function(){function a(a,b,d){this._initialVelocity=a;this._stopVelocity=b;this._friction=d;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(a.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0});a.prototype.isFinished=
function(a){return a>this.duration};Object.defineProperty(a.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});a.prototype.value=function(a){a=Math.min(a,this.duration);var b=1-this._friction;return this._initialVelocity*(Math.pow(b,a)-1)/Math.log(b)};a.prototype.valueDelta=function(a,b){var d=this.value(a);return this.value(a+b)-d};return a}();l.Momentum=b;w=function(){function d(b,d,f,k){void 0===b&&(b=.05);this._minimumInitialVelocity=d;this._stopVelocity=
f;this._friction=k;this._history=new a.ValueHistory(1E3*b)}d.prototype.add=function(a,b){void 0!==b&&(b*=1E3);this._history.add(a,b)};d.prototype.reset=function(){this._history.reset()};Object.defineProperty(d.prototype,"stopVelocity",{get:function(){return this._stopVelocity},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});d.prototype.evaluateMomentum=function(){var a=this._evaluateVelocity();return null!==
a?new b(a,this._stopVelocity,this._friction):null};d.prototype._evaluateVelocity=function(){var a=this._history,b=a.oldest,a=a.newest;if(b&&a){var d=(a.timeStamp-b.timeStamp)/1E3;if(0<d&&(b=(a.value-b.value)/d,Math.abs(b)>=this._minimumInitialVelocity))return b}return null};return d}();l.MomentumEstimator=w;var q=function(a){function b(b,d,f){return a.call(this,b,d,f)||this}f(b,a);b.prototype.value=function(b){b=a.prototype.value.call(this,b);return Math.exp(b)};b.prototype.valueDelta=function(b,
d){var f=a.prototype.value.call(this,b);b=a.prototype.value.call(this,b+d);return Math.exp(b-f)};return b}(b);l.ZoomMomentum=q;var t=function(a){function b(b,d,f,k){void 0===b&&(b=.05);void 0===d&&(d=4);void 0===f&&(f=.01);void 0===k&&(k=.95);return a.call(this,b,d,f,k)||this}f(b,a);b.prototype.add=function(b,d){a.prototype.add.call(this,Math.log(b),d)};b.prototype.evaluateMomentum=function(){var a=this._evaluateVelocity();return null!==a?new q(a,this.stopVelocity,this.friction):null};return b}(w);
l.ZoomMomentumEstimator=t;w=function(a){function b(b,d,f,k){void 0===b&&(b=.05);void 0===d&&(d=4);void 0===f&&(f=.01);void 0===k&&(k=.95);return a.call(this,b,d,f,k)||this}f(b,a);b.prototype.add=function(b,d){var f=this._history.newest;if(f){f=f.value;for(b-=f;b>Math.PI;)b-=2*Math.PI;for(;b<-Math.PI;)b+=2*Math.PI;b=f+b}a.prototype.add.call(this,b,d)};return b}(w);l.RotationMomentumEstimator=w;var m=function(a){function b(b,d,f,k,m,p){b=a.call(this,b,d,f)||this;b.dataOldest=k;b.dataNewest=m;b.dataTimeDelta=
p;return b}f(b,a);b.prototype.velocityFactor=function(a){a=Math.min(a,this.duration);return Math.pow(1-this.friction,a)};b.prototype.valueFromInitialVelocity=function(a,b){b=Math.min(b,this.duration);var d=1-this.friction;return a*(Math.pow(d,b)-1)/Math.log(d)};return b}(b);l.ScreenspaceMomentum=m;w=function(){function b(b,d,f,k){void 0===b&&(b=.05);this._minimumInitialVelocity=d;this._stopVelocity=f;this._friction=k;this._entryPool=[];this._history=new a.ValueHistory(1E3*b)}b.prototype.add=function(a,
b,f,k){void 0!==k&&(k*=1E3);var m;0!==this._entryPool.length?(m=this._entryPool.pop(),m.x=a,m.y=b,d.vec3d.set(f,m.data)):m={x:a,y:b,data:d.vec3d.create(f)};this._history.add(m,k)};b.prototype.reset=function(){for(var a=0,b=this._history.values;a<b.length;a++)this._entryPool.push(b[a].value);this._history.reset()};Object.defineProperty(b.prototype,"stopVelocity",{get:function(){return this._stopVelocity},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"friction",{get:function(){return this._friction},
enumerable:!0,configurable:!0});b.prototype.evaluateMomentum=function(){var a=this._evaluateVelocity(),b=this._history.oldest,d=this._history.newest;return null!==a?new m(a,this._stopVelocity,this._friction,b.value.data,d.value.data,.001*(d.timeStamp-b.timeStamp)):null};b.prototype._evaluateVelocity=function(){var a=this._history,b=a.oldest,d=a.newest;if(b&&d&&(a=.001*(d.timeStamp-b.timeStamp),0<a)){var f=d.value.x-b.value.x,b=d.value.y-b.value.y,b=Math.sqrt(f*f+b*b)/a;if(Math.abs(b)>=this._minimumInitialVelocity)return b}return null};
return b}();l.ScreenspaceMomentumEstimator=w})},"esri/views/navigation/ValueHistory":function(){define(["require","exports","../../core/now"],function(w,l,f){Object.defineProperty(l,"__esModule",{value:!0});w=function(){function a(a){this._maximumAge=a;this._values=[]}Object.defineProperty(a.prototype,"values",{get:function(){return this._values},enumerable:!0,configurable:!0});a.prototype.reset=function(){this._values=[]};a.prototype.add=function(a,b){b=void 0!==b?b:f();this._values.push({value:a,
timeStamp:b});this._cleanup(b)};Object.defineProperty(a.prototype,"newest",{get:function(){var a=this._values.length;if(0<a)return this._values[a-1]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"oldest",{get:function(){if(0<this._values.length)return this._values[0]},enumerable:!0,configurable:!0});a.prototype._cleanup=function(a){for(;0<this._values.length;)if(this._values[0].timeStamp+this._maximumAge<a)this._values.shift();else break};return a}();l.ValueHistory=w})},"esri/views/3d/input/handlers/pinch/PinchNavigationLocal":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/glMatrix ../../util ./PinchNavigationBase ./MomentumNavigationLocal".split(" "),
function(w,l,f,a,d,b,q){Object.defineProperty(l,"__esModule",{value:!0});var t;(function(a){a[a.Horizontal=0]="Horizontal";a[a.Vertical=1]="Vertical"})(t=l.PanMode||(l.PanMode={}));var m=20/180*Math.PI,k=a.vec3d.createFrom(0,0,1);w=function(b){function p(f,k){var m=b.call(this,f,k)||this;m.view=f;m._rotation={valueSmooth:new d.ExponentialFalloff(.05)};m._scaling={valueSmooth:new d.ExponentialFalloff(.05)};m._planeHorizontal={normal:a.vec3d.create(),distance:0};m._planeVertical={normal:a.vec3d.create(),
distance:0};m._beginCenterHorizontal=a.vec3d.create();m._beginCenterVertical=a.vec3d.create();m._tmpPoints=[];m._tmpPickPointScreen=a.vec2.create();m._tmpPickPointScene=a.vec3d.create();m._tmpBwd=a.vec3d.create();m._tmpUp=a.vec3d.create();m._tmpD=a.vec3d.create();m._tmpC3=a.vec3d.create();m._tmpC2=a.vec2.create();m._momentumNavigation=new q.MomentumNavigationLocal(m,k);return m}f(p,b);Object.defineProperty(p.prototype,"momentum",{get:function(){return this._momentumNavigation},enumerable:!0,configurable:!0});
p.prototype.onNavigationBegin=function(b){var d=this._helper,f=this._tmpPickPointScreen,p=this._tmpPickPointScene;this._rotation.valueSmooth.reset();this._scaling.valueSmooth.reset();a.vec2.set2(b.data.currentState.center.x,this.view.height-b.data.currentState.center.y,f);this._planeHorizontal.distance=0;a.vec3d.set(k,this._planeHorizontal.normal);d.picker.pickPointInScreen(f,p)||d.picker.pickFreePointInScreen(f,p);f=this._tmpBwd;a.vec3d.negate(this.beginCamera.viewForward,f);var q=this._tmpUp;a.vec3d.set(k,
q);var l=a.vec3d.dot(f,q);this._mode=Math.asin(0>l?-l:l)>=m?t.Horizontal:t.Vertical;this._planeHorizontal.distance=a.vec3d.dot(this._planeHorizontal.normal,p);0>a.vec3d.dot(this._planeHorizontal.normal,this.beginCamera.eye)-this._planeHorizontal.distance&&(a.vec3d.negate(this._planeHorizontal.normal),this._planeHorizontal.distance*=-1);this._mode===t.Vertical&&(a.vec3d.scale(q,l),a.vec3d.subtract(f,q,this._planeVertical.normal),a.vec3d.normalize(this._planeVertical.normal),this._planeVertical.distance=
a.vec3d.dot(this._planeVertical.normal,p),this.computePlanePoints(b,"currentEvent",this._planeVertical,this.beginCamera,this._tmpPoints),d.planar.computePointCenter(this._tmpPoints,this._beginCenterVertical));this.computePlanePoints(b,"currentEvent",this._planeHorizontal,this.beginCamera,this._tmpPoints);d.planar.computePointCenter(this._tmpPoints,this._beginCenterHorizontal)};p.prototype.onNavigationUpdate=function(b,d){var f=this._helper,k=1<b.data.pointers.length,m=this._mode===t.Horizontal?this._planeHorizontal:
this._planeVertical,p=this._mode===t.Horizontal?this._beginCenterHorizontal:this._beginCenterVertical;if(k){var c=b.data.startState.radius/b.data.currentState.radius,q=.001875*Math.min(Math.max(b.data.currentState.radius,40),120);this._scaling.valueSmooth.gain=q;this._scaling.valueSmooth.update(c);f.planar.applyZoom(m,this.view,d,p,this._scaling.valueSmooth.value);this.momentum.addScaleValue(b.timestamp,this._scaling.valueSmooth.value,m,p)}q=this._tmpC3;this.computePlanePoints(b,"currentEvent",m,
d,this._tmpPoints);f.planar.computePointCenter(this._tmpPoints,q);m=this._tmpD;a.vec3d.subtract(q,p,m);a.vec3d.subtract(d.eye,m);a.vec3d.subtract(d.center,m);d.markViewDirty();c=this._tmpC2;a.vec2.set2(b.data.currentState.center.x,b.data.currentState.center.y,c);this.momentum.addPanValue(b.timestamp,c,q,m);k&&(k=this._planeHorizontal.normal,a.vec3d.set(this._planeHorizontal.normal,k),q=b.data.currentState.angle,m=this._rotation.valueSmooth.value,c=f.normalizeRotationDelta(q-m),q=.00125*Math.min(Math.max(b.data.currentState.radius,
40),120),this._rotation.valueSmooth.gain=q,this._rotation.valueSmooth.update(m+c),q=this._rotation.valueSmooth.value,this.momentum.addRotationValue(b.timestamp,p,k,q),f.applyRotation(d,p,k,q))};p.prototype.onNavigationEnd=function(a){};return p}(b.PinchNavigationBase);l.PinchNavigationLocal=w})},"esri/views/3d/input/handlers/pinch/MomentumNavigationLocal":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","../../../lib/glMatrix","./MomentumNavigationBase"],function(w,
l,f,a,d){Object.defineProperty(l,"__esModule",{value:!0});w=function(b){function d(d,f){d=b.call(this,d,f)||this;d._scaleState={plane:{distance:0,normal:a.vec3d.create()},center:a.vec3d.create()};d._rotationState={center:a.vec3d.create(),axis:a.vec3d.create()};d._panState={direction:a.vec3d.create()};d.pan.enabled=!1;return d}f(d,b);d.prototype.addPanValue=function(b,d,f,p){this.pan.estimator.add(d[0],d[1],f,.001*b);a.vec3d.set(p,this._panState.direction);a.vec3d.normalize(this._panState.direction)};
d.prototype.addRotationValue=function(b,d,f,p){this.rotation.estimator.add(p,.001*b);a.vec3d.set(d,this._rotationState.center);a.vec3d.set(f,this._rotationState.axis)};d.prototype.addScaleValue=function(b,d,f,p){this.zoom.estimator.add(d,.001*b);this._scaleState.plane.distance=f.distance;a.vec3d.set(f.normal,this._scaleState.plane.normal);a.vec3d.set(p,this._scaleState.center)};d.prototype.onUpdate=function(b,d,f){if(this.zoom.momentum){var k=this.zoom.momentum.valueDelta(b,d);this.helper.planar.applyZoom(this._scaleState.plane,
this.view,f,this._scaleState.center,k)}this.pan.momentum&&(a.vec3d.normalize(this._panState.direction),k=a.vec3d.dist(this.pan.momentum.dataOldest,this.pan.momentum.dataNewest),k/=this.pan.momentum.dataTimeDelta,k*=this.pan.momentum.velocityFactor(b),a.vec3d.scale(this._panState.direction,k*d),a.vec3d.subtract(f.eye,this._panState.direction),a.vec3d.subtract(f.center,this._panState.direction),f.markViewDirty());this.rotation.momentum&&(b=this.rotation.momentum.valueDelta(b,d),this.helper.applyRotation(f,
this._rotationState.center,this._rotationState.axis,b))};return d}(d.MomentumNavigationBase);l.MomentumNavigationLocal=w})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler","../../../input/handlers/support"],function(w,l,f,a,d){Object.defineProperty(l,"__esModule",{value:!0});w=function(a){function b(b,d){var f=a.call(this,"esri.views.3d.input.handlers.DoubleClickZoom",!0)||this;f.view=b;
f.registerIncoming("double-click",d,function(a){return f._handleDoubleClick(a)});return f}f(b,a);b.prototype._handleDoubleClick=function(a){var b=a.data;d.eventMatchesPointerType(b.native,"primary")&&(this.view.navigation.zoom.stepScreen(Math.log(.5)/Math.log(.6),[b.x,this.view.height-b.y]),a.stopPropagation())};return b}(a.InputHandler);l.DoubleClickZoom=w})},"esri/views/input/handlers/support":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});
l.eventMatchesPointerType=function(f,a){switch(a){case "primary":return"touch"===f.pointerType||0===f.button;case "secondary":return"touch"!==f.pointerType&&2===f.button;case "tertiary":return"touch"!==f.pointerType&&1===f.button}}})},"esri/views/3d/input/handlers/DragPan":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler","./support"],function(w,l,f,a,d){Object.defineProperty(l,"__esModule",{value:!0});w=function(a){function b(b,d,f){var k=
a.call(this,"esri.views.3d.input.handlers.DragPan",!0)||this;k.view=b;k.pointerType=d;k.registerIncoming("drag",f,function(a){return k._handleDrag(a)});return k}f(b,a);b.prototype._handleDrag=function(a){var b=a.data;if(!(1<b.pointers.length)){var f=b.pointers[0];if(d.eventMatchesPointerType(f.startEvent.native,this.pointerType)){var f=[f.currentEvent.x,this.view.height-f.currentEvent.y],p=this.view.navigation.pan;switch(b.action){case "start":p.begin(f,a.timestamp);break;case "update":p.update(f,
a.timestamp);break;case "end":p.end(f,a.timestamp)}a.stopPropagation()}}};return b}(a.InputHandler);l.DragPan=w})},"esri/views/3d/input/handlers/support":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});l.eventMatchesPointerType=function(f,a){switch(a){case "primary":return"touch"===f.pointerType||0===f.button;case "secondary":return"touch"!==f.pointerType&&2===f.button;case "tertiary":return"touch"!==f.pointerType&&1===f.button}}})},"esri/views/3d/input/handlers/DragRotate":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../input/InputHandler ./support ../../navigation/NavigationConstants".split(" "),
function(w,l,f,a,d,b){Object.defineProperty(l,"__esModule",{value:!0});w=function(a){function q(d,f,p,q){var k=a.call(this,"esri.views.3d.input.handlers.DragRotate",!0)||this;k.view=d;k.pointerType=f;k.pivotPoint=p;k.registerIncoming("drag",q,function(a){return k._handleDrag(a)});switch(p){case "center":k._navigationPivot=b.Rotate.PivotPoint.POI;break;case "eye":k._navigationPivot=b.Rotate.PivotPoint.EYE}return k}f(q,a);q.prototype._handleDrag=function(a){var b=a.data;if(!(1<b.pointers.length)){var f=
b.pointers[0];if(d.eventMatchesPointerType(f.startEvent.native,this.pointerType)){var f=[f.currentEvent.x,this.view.height-f.currentEvent.y],m=this.view.navigation.rotate;switch(b.action){case "start":m.begin(f,this._navigationPivot);break;case "update":m.update(f,this._navigationPivot);break;case "end":m.end(f)}a.stopPropagation()}}};return q}(a.InputHandler);l.DragRotate=w})},"esri/views/3d/navigation/NavigationConstants":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,
"__esModule",{value:!0});l.Pan={Direction:{LEFT:1,RIGHT:2,FORWARD:4,BACKWARD:8,UP:16,DOWN:32},Mode:{HORIZONTAL:0,VERTICAL:1},Momentum:{DURATION_SHORT:1,DURATION_LONG:3,DURATION_LONG_VEL:8,INPUT_FILTER:.2,BUFFER_SIZE:5,MINIMUM_VELOCITY:300},Vertical:{ELEVATION_THRESHOLD:3E4,ANGLE_THRESHOLD:8/180*Math.PI}};l.Rotate={PivotPoint:{POI:1,EYE:2}}})},"esri/views/3d/input/handlers/DragZoom":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler","./support"],
function(w,l,f,a,d){Object.defineProperty(l,"__esModule",{value:!0});w=function(a){function b(b,d,f){var k=a.call(this,"esri.views.3d.input.handlers.DragZoom"+d,!0)||this;k.view=b;k.pointerType=d;k.registerIncoming("drag",f,function(a){return k._handleDrag(a)});return k}f(b,a);b.prototype._handleDrag=function(a){var b=a.data;if(!(1<b.pointers.length)){var f=b.pointers[0];if(d.eventMatchesPointerType(f.startEvent.native,this.pointerType)){var f=[f.currentEvent.x,this.view.height-f.currentEvent.y],
p=this.view.navigation.zoom;switch(b.action){case "start":p.begin(f);break;case "update":p.update(f);break;case "end":p.end(f)}a.stopPropagation()}}};return b}(a.InputHandler);l.DragZoom=w})},"esri/views/3d/input/handlers/KeyPan":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler","../../navigation/NavigationConstants"],function(w,l,f,a,d){Object.defineProperty(l,"__esModule",{value:!0});var b=d.Pan.Direction;w=function(a){function d(d,f,
p){var k=a.call(this,"esri.views.3d.input.handlers.KeyPan",!0)||this;k.view=d;k.keys=f;k._keyToDirection=(m={},m[f.left]=b.LEFT,m[f.right]=b.RIGHT,m[f.forward]=b.FORWARD,m[f.backward]=b.BACKWARD,m[f.up]=b.UP,m[f.down]=b.DOWN,m);k.registerIncoming("key-down",p,function(a){return k._handleKeyDown(a)});k.registerIncoming("key-up",p,function(a){return k._handleKeyUp(a)});return k;var m}f(d,a);d.prototype._handleKeyDown=function(a){a.data.repeat||this._handleKey(a,!0)};d.prototype._handleKeyUp=function(a){this._handleKey(a,
!1)};d.prototype._handleKey=function(a,b){var d=this._keyToDirection[a.data.key];null!=d&&(b?this.view.navigation.pan.beginContinuous(d):this.view.navigation.pan.endContinuous(d),a.stopPropagation())};return d}(a.InputHandler);l.KeyPan=w})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(w,l,f,a){Object.defineProperty(l,"__esModule",{value:!0});w=function(a){function b(b,d){var f=
a.call(this,"esri.views.3d.input.handlers.MouseWheelZoom",!0)||this;f.view=b;f.registerIncoming("mouse-wheel",d,function(a){return f._handleMouseWheel(a)});return f}f(b,a);b.prototype._handleMouseWheel=function(a){var b=a.data;this.view.navigation.zoom.stepScreen(-1/60*b.deltaY,[b.x,this.view.height-b.y]);a.stopPropagation()};return b}(a.InputHandler);l.MouseWheelZoom=w})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper",
"./SingleKey"],function(w,l,f,a){Object.defineProperty(l,"__esModule",{value:!0});w=function(a){function b(b,d,f){f=a.call(this,"esri.views.3d.input.handlers.SingleKeyResetHeading",d,f)||this;f.view=b;f.key=d;return f}f(b,a);b.prototype.activate=function(){this.view.goTo({heading:0})};return b}(a.SingleKey);l.SingleKeyResetHeading=w})},"esri/views/3d/input/handlers/SingleKey":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(w,
l,f,a){Object.defineProperty(l,"__esModule",{value:!0});w=function(a){function b(b,d,f){var k=a.call(this,b,!0)||this;k.key=d;k.registerIncoming("key-down",f,function(a){return k._handleKeyDown(a)});return k}f(b,a);b.prototype._handleKeyDown=function(a){a.data.key===this.key&&(this.activate(),a.stopPropagation())};return b}(a.InputHandler);l.SingleKey=w})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./SingleKey"],
function(w,l,f,a){Object.defineProperty(l,"__esModule",{value:!0});w=function(a){function b(b,d,f){f=a.call(this,"esri.views.3d.input.handlers.SingleKeyResetTilt",d,f)||this;f.view=b;f.key=d;return f}f(b,a);b.prototype.activate=function(){this.view.goTo({tilt:0})};return b}(a.SingleKey);l.SingleKeyResetTilt=w})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(w,l,f,a){Object.defineProperty(l,
"__esModule",{value:!0});w=function(a){function b(b,d){var f=a.call(this,"esri.views.3d.input.handlers.PointerDownCancelAnimation",!0)||this;f.view=b;f.registerIncoming("pointer-down",d,function(a){return f._handlePointerDown(a)});return f}f(b,a);b.prototype._handlePointerDown=function(a){this.view.navigation.stop()};return b}(a.InputHandler);l.PointerDownCancelAnimation=w})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper",
"../../../input/InputHandler","../../navigation/NavigationConstants"],function(w,l,f,a,d){Object.defineProperty(l,"__esModule",{value:!0});w=function(a){function b(b,d){void 0===d&&(d=!1);var f=a.call(this,"esri.views.3d.input.handlers.TwoFingerTilt",!0)||this;f.view=b;f._invert=d;f.registerIncoming("vertical-two-finger-drag",function(a){return f._handleTwoFinger(a)});return f}f(b,a);b.prototype._handleTwoFinger=function(a){var b=this.view,f=[0,-a.data.delta*(this._invert?-1:1)];switch(a.data.action){case "begin":b.navigation.rotate.begin(f,
d.Rotate.PivotPoint.POI);break;case "update":b.navigation.rotate.update(f,d.Rotate.PivotPoint.POI);break;case "end":b.navigation.rotate.end(f)}};return b}(a.InputHandler);l.TwoFingerTilt=w})},"esri/views/3d/input/NavigationHelper":function(){define("require exports ../lib/glMatrix ../support/earthUtils ../webgl-engine/lib/Util ../support/mathUtils".split(" "),function(w,l,f,a,d,b){Object.defineProperty(l,"__esModule",{value:!0});w=function(){function b(b){this.picker=b;this.earthUtils=a;this._axisTmp1=
f.vec3d.create();this._axisTmp2=f.vec3d.create();this._axisTmp3=f.vec3d.create();this._tmpTransform2=f.mat4d.create();this.spherical=new t(this);this.planar=new q(this)}b.prototype.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;return a};b.prototype.rotationFromPointsAroundAxis=function(a,b,d){var k=this._axisTmp1,m=this._axisTmp2,p=this._axisTmp3;f.vec3d.set(a,m);f.vec3d.set(b,p);a=f.vec3d.dot(m,d);b=f.vec3d.dot(p,d);f.vec3d.scale(d,a,k);f.vec3d.subtract(m,
k);f.vec3d.normalize(m);f.vec3d.scale(d,b,k);f.vec3d.subtract(p,k);f.vec3d.normalize(p);a=f.vec3d.dot(m,p);f.vec3d.cross(d,m,k);d=f.vec3d.dot(p,k);return Math.atan2(d,a)};b.prototype.applyRotation=function(a,b,d,m){var k=this._tmpTransform2;f.mat4d.identity(k);f.mat4d.rotate(k,m,d);f.vec3d.subtract(a.eye,b);f.mat4d.multiplyVec3(k,a.eye,a.eye);f.vec3d.add(a.eye,b);f.vec3d.subtract(a.center,b);f.mat4d.multiplyVec3(k,a.center,a.center);f.vec3d.add(a.center,b);f.mat4d.multiplyVec3(k,a.up,a.up);a.markViewDirty()};
return b}();l.NavigationHelper=w;var q=function(){function a(a){this._helper=a;this._tmpForward=f.vec3d.create();this._tmpP0=f.vec3d.create();this._tmpP1=f.vec3d.create()}a.prototype.applyZoom=function(a,b,d,m,q){a=this._tmpForward;q=1-q;f.vec3d.subtract(m,d.eye,a);var k=f.vec3d.length(a),p=k*(1-q);0<=q&&4>p&&(p=4);p=b.navigation.limitAltitude(p,m,a);1E-6>Math.abs(k-p)||(q=-(p-k)/k,f.vec3d.scale(a,q),f.vec3d.add(d.eye,a),f.vec3d.lerp(d.center,m,q),b.navigation.fixTargetUpVector(),d.markViewDirty())};
a.prototype.intersectPlaneFromScreenPoint=function(a,b,d,m){var k=this._tmpP0,p=this._tmpP1;this._helper.picker.createPickRay(d,null,b.viewMatrix,k,p);f.vec3d.subtract(p,k);b=f.vec3d.dot(a.normal,p);if(0===b)return!1;a=f.vec3d.dot(a.normal,k)-a.distance;f.vec3d.add(k,f.vec3d.scale(p,-a/b,m),m);return!0};a.prototype.computePointCenter=function(a,b){f.vec3d.set3(0,0,0,b);for(var d=0;d<a.length;d++)f.vec3d.add(b,a[d]);f.vec3d.scale(b,1/a.length)};return a}(),t=function(){function a(a){this._helper=a;
this._tmpForward=f.vec3d.create();this._tmpP0=f.vec3d.create();this._tmpP1=f.vec3d.create();this._tmpAxis=f.vec3d.create();this._tmpTransform=f.mat4d.create()}a.prototype.applyZoom=function(a,b,d,m){var k=this._tmpForward;f.vec3d.subtract(d.center,d.eye,k);a/=f.vec3d.length(d.center);var p=1-a,q=f.vec3d.length(k),l;l=b.navigation.limitAltitude(q*m,d.center,k);m=l/q;1E-6>Math.abs(q-l)||(f.vec3d.scale(d.center,a+p*m),f.vec3d.scale(k,m),f.vec3d.subtract(d.center,k,d.eye),d.markViewDirty(),b.navigation.applyConstraints(d))};
a.prototype.makeRenderCoordSpherePoint=function(a,b,d,m){this._helper.picker.createPickRay(d,null,b.viewMatrix,this._tmpP0,this._tmpP1);f.vec3d.subtract(this._tmpP1,b.eye);this.intersect(a,b.eye,this._tmpP1,m)||this.closestPointOnSilhouette(a,b.eye,this._tmpP0,m)};a.prototype.intersect=function(a,b,f,m){return d.raySphere(b,f,null,a,m)};a.prototype.closestPointOnSilhouette=function(a,d,m,q){var k=this._tmpAxis,p=this._tmpTransform;f.vec3d.cross(d,m,k);f.vec3d.cross(k,d,q);f.vec3d.scale(q,1/f.vec3d.length(q)*
a);a=-b.asin(a/f.vec3d.length(d));f.mat4d.identity(p);f.mat4d.rotate(p,a,k);f.mat4d.multiplyVec3(p,q)};a.prototype.rotationFromPoints=function(a,b,d,m){f.vec3d.cross(b,d,m);return-Math.acos(1-f.vec3d.dist2(b,d)/(2*a*a))};a.prototype.computePointCenter=function(a,b,d){f.vec3d.set3(0,0,0,d);for(var k=0;k<a.length;k++)f.vec3d.add(d,a[k]);f.vec3d.normalize(d);f.vec3d.scale(d,b)};return a}()})},"esri/views/3d/support/cameraUtils":function(){define("dojo/_base/lang ../../../geometry/SpatialReference ../../../config ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../../../Camera ../lib/glMatrix ./mathUtils ./earthUtils ./projectionUtils ./cameraUtilsPlanar ./cameraUtilsSpherical".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x){function z(a,c){return"global"===a.viewingMode?x[c]:p[c]}function v(c,d,f){var m=c.renderSpatialReference,p=D.set(d.viewForward,G),p=E(c,d.eye,p,d.up,H);c=c.spatialReference||l.WGS84;k.vectorToVector(d.eye,m,B,c)||(c=l.WGS84,k.vectorToVector(d.eye,m,B,c));return f?(f.position.x=B[0],f.position.y=B[1],f.position.z=B[2],f.position.spatialReference=c,f.heading=p.heading,f.tilt=p.tilt,f.fov=t.rad2deg(d.fov),f):new b(new a(B,c),p.heading,p.tilt,t.rad2deg(d.fov))}function r(a,
c,b){var d=a.navigation.currentCamera,k=d.fovX,d=d.width/2;"global"===a.viewingMode&&null!=b&&(c*=Math.cos(t.deg2rad(b)));c/=a.renderCoordsHelper.unitInMeters;return d/(39.37*f.screenDPI/c)/Math.tan(k/2)}function u(a,c,b){var d=a.navigation.currentCamera;c=39.37*f.screenDPI/(d.width/2/(c*Math.tan(d.fovX/2)));"global"===a.viewingMode&&(c/=Math.cos(t.deg2rad(b)));return c*=a.renderCoordsHelper.unitInMeters}function C(a,d,f,m,p,r){var q=a.renderSpatialReference;d=c(a,m.heading,m.tilt,d,f,p);a=k.vectorToPoint(d.eye,
q,a.spatialReference||l.WGS84);if(!a)return null;if(!r)return new b(a,d.heading,d.tilt,m.fov);r.position=a;r.heading=d.heading;r.tilt=d.tilt;r.fov=m.fov;return r}function E(a,c,b,d,f){return z(a,"directionToHeadingTilt")(c,b,d,f)}function c(b,d,f,m,p,r){var q=D.create(),u=b.renderSpatialReference;if(m&&m instanceof a){var v=m;k.pointToVector(v,q,b.renderSpatialReference);null==v.z&&("global"===b.viewingMode?b._pickRay([0,0,0],q):b._pickRay([q[0],q[1]-1,q[2]],q),null!=b.basemapTerrain&&(v=b.basemapTerrain.getElevation(v),
null!=v&&b.renderCoordsHelper.setAltitude(v,q)))}else m?D.set(m,q):D.set(b.navigation.currentCamera.center,q);m&&m instanceof a||(m=k.vectorToPoint(q,u,b.spatialReference||l.WGS84));p=Math.max(p,b.navigation.minPoiDist);u=f;f=p;if(!(v=r&&r.noReset))var x=m,v=b.engineToScreen(b.navigation.currentCamera.center),h=b.toScreen(x),x=v.x-h.x,v=v.y-h.y,v=!(Math.sqrt(x*x+v*v)>5*Math.max(b.width,b.height));v?(u=z(b,"eyeTiltToLookAtTilt")(q,f,u),u=b.navigation.constraints.tilt.apply(u,f),u=z(b,"lookAtTiltToEyeTilt")(q,
f,u)):(d=0,u=b.navigation.constraints.tilt.min(f));f=u;d=z(b,"eyeForCenterWithHeadingTilt")(q,p,d,f);d.center=q;return r&&r.noReset||"global"!==b.viewingMode||(q=b.renderCoordsHelper.fromRenderCoords(d.eye,K,b.spatialReference)?b.basemapTerrain&&(b.basemapTerrain.getElevation(K)||0)>K.z-1:!1,!q)?d:(q=b.navigation.constraints.tilt.min(p),c(b,0,q,m,p,w.mixin({},r,{noReset:!0})))}var D=q.vec3d,B=D.create(),I=D.create(),G=D.create(),H={heading:0,tilt:0},K=new a,J=new t.Cyclical(-2.0037508342788905E7,
2.0037508342788905E7);return{externalToInternal:function(a,c){var b=a.renderSpatialReference,d=z(a,"headingTiltToDirectionUp"),f=D.create();return k.pointToVector(c.position,f,b)?(b=d(f,c.heading,c.tilt),D.add(b.direction,f),a=a.navigation.getCameraIntersectTerrain(f,b.direction,b.up),a.fov=t.deg2rad(c.fov),a):null},internalToExternal:v,scaleToDistance:r,distanceToScale:u,fromExtent:function(f,p,r,q,u){q instanceof b&&(u=q,q={});var v="global"===f.viewingMode,x=f.renderSpatialReference,t=f.spatialReference||
l.WGS84,z=l.WebMercator,C=p.spatialReference||z,h,e=0;null!=p.zmax&&null!=p.zmin&&(h=(p.zmax+p.zmin)/2,e=p.zmax-p.zmin);if(v){var v=new a(p.xmin,p.ymin,C),g=new a(p.xmax,p.ymax,C),v=d.project(v,z),g=d.project(g,z);if(null===v||null===g)return;p=new a(J.center(v.x,g.x),(g.y+v.y)/2,z);null!=h&&(p.z=h);h=m.getGreatCircleSpanAt(p,v,g);z=h.lon;C=h.lat;J.diff(v.x,g.x)>J.range/2&&(z+=m.halfEarthCircumference);z=Math.min(z,m.halfEarthCircumference);C=Math.min(C,m.halfEarthCircumference)}else d.canProject(p,
t)&&(p=d.project(p,t)),z=p.xmax-p.xmin,C=p.ymax-p.ymin,p=new a({x:p.xmin+.5*z,y:p.ymin+.5*C,z:h,spatialReference:t});h=f.navigation.currentCamera;r=c(f,r.heading,r.tilt,p,Math.max(1/Math.tan(h.fovX/2)*z*.5,1/Math.tan(h.fovY/2)*C*.5,1/Math.tan(h.fov/2)*e*.5)/1,q);x=k.vectorToPoint(r.eye,x,t);if(!x)return null;u||(u=new b);u.position=x;u.heading=r.heading;u.tilt=r.tilt;u.fov=f.camera.fov;return u},toExtent:function(a,c,b,d,f){var r;r=a.renderSpatialReference;c||(b||(b=a.navigation.currentCamera),c=
v(a,b,f));if(b)f=k.vectorToPoint(b.center,r,a.spatialReference||l.WGS84),r=b.distance;else{f=a.toMap(a.screenCenter);if(!f)return null;r=m.computeCarthesianDistance(c.position,f)}b||(b=a.navigation.currentCamera);c=2*r*Math.tan(b.fovX/2)*1;b=2*r*Math.tan(b.fovY/2)*1;return"global"===a.viewingMode?x.toExtent(a,f,c,b,d):p.toExtent(a,f,c,b,d)},fromCenterScale:function(a,c,b,d,f,k){b=r(a,b,c.latitude);return C(a,c,b,d,f,k)},fromCenterDistance:C,directionToHeadingTilt:E,eyeHeadingTiltForCenterPointAtDistance:c,
scaleToZoom:function(a,c){return(a=a.get("basemapTerrain.tilingScheme"))?a.levelAtScale(c):void 0},zoomToScale:function(a,c){return(a=a.get("basemapTerrain.tilingScheme"))?a.scaleAtLevel(c):void 0},computeScale:function(a,c,b){var d=a.renderSpatialReference;c||(c=a.navigation.currentCamera);var f;f=l.WGS84;c.center?(k.vectorToVector(c.center,d,I,f),f=I[1],c=c.distance):(f=c.position.latitude,k.pointToVector(c.position,B,d),k.pointToVector(b,I,d),c=D.dist(B,I));return u(a,c,f)}}})},"esri/views/3d/support/projectionUtils":function(){define("../../../geometry/SpatialReference ../../../geometry/Point ./mathUtils ./earthUtils ../lib/glMatrix ../webgl-engine/lib/BufferVectorMath".split(" "),
function(w,l,f,a,d,b){var q=d.vec3d,t=d.mat4d,m=b.Vec3Compact,k=q.create(),p=q.create(),x=q.create(),z=f.deg2rad(1),v=f.rad2deg(1),r,u,C,E,c=new w({wkt:'\r\n      GEOCCS["Spherical geocentric",\r\n        DATUM["Not specified",\r\n          SPHEROID["Sphere",'+a.earthRadius+',0]],\r\n        PRIMEM["Greenwich",0.0,\r\n          AUTHORITY["EPSG","8901"]],\r\n        UNIT["m",1.0],\r\n        AXIS["Geocentric X",OTHER],\r\n        AXIS["Geocentric Y",EAST],\r\n        AXIS["Geocentric Z",NORTH]\r\n      ]\r\n    '}),
D=a.earthRadius,B=function(a){return a===c?1:a.isWGS84?2:a.isWebMercator?3:0};w=function(a,c,b,d){b[d++]=a[c++];b[d++]=a[c++];b[d]=a[c]};var I=function(a,c,b,d){var k=.4999999*Math.PI,m=z*a[c+1],m=f.clamp(m,-k,k),k=Math.sin(m);b[d++]=z*a[c]*D;b[d++]=D/2*Math.log((1+k)/(1-k));b[d]=a[c+2]},G=function(a,c,b,d){var f=D+a[c+2],k=z*a[c+1];a=z*a[c];c=Math.cos(k);b[d++]=Math.cos(a)*c*f;b[d++]=Math.sin(a)*c*f;b[d]=Math.sin(k)*f},H=[void 0,G,w,I],K=[void 0,function(a,c,b,d){var k=m.length(a,c),p=f.asin(a[c+
2]/k);a=(0<a[c+1]?1:-1)*f.acos(a[c]/(Math.cos(p)*k));b[d++]=v*a;b[d++]=v*p;b[d]=k-D},w,function(a,c,b,d){b[d++]=v*(a[c++]/D);b[d++]=v*(Math.PI/2-2*Math.atan(Math.exp(-1*a[c++]/D)));b[d]=a[c]}];return{SphericalRenderSpatialReference:c,vectorToVector:function(a,c,b,d){2===a.length?(k[0]=a[0],k[1]=a[1],k[2]=0,a=k):a===b&&(q.set(a,k),a=k);return this.bufferToBuffer(a,c,0,b,d,0,1)},pointToVector:function(a,c,b){k[0]=a.x;k[1]=a.y;var d=a.z;k[2]=void 0!==d?d:0;return this.bufferToBuffer(k,a.spatialReference,
0,c,b,0,1)},vectorToPoint:function(a,c,b,d){"esri.SpatialReference"===b.declaredClass?(d=b,b=new l({spatialReference:d})):d=d||b.spatialReference;return this.bufferToBuffer(a,c,0,k,d,0,1)?(b.x=k[0],b.y=k[1],b.z=k[2],b.spatialReference=d,b):null},xyzToVector:function(a,c,b,d,f,m){k[0]=a;k[1]=c;k[2]=b;return this.bufferToBuffer(k,d,0,f,m,0,1)},bufferToBuffer:function(a,c,b,d,f,k,m){m=m||1;r!==c&&(u=B(c),r=c);C!==f&&(E=B(f),C=f);m=b+3*m;if(u!==E||0===u&&!c.equals(f))if(0<u&&0<E)if(2!==E){var q=H[E];
if(2!==u)for(f=K[u];b<m;b+=3,k+=3)f(a,b,p,0,c.wkid),q(p,0,d,k);else for(;b<m;b+=3,k+=3)q(a,b,d,k)}else for(f=K[u];b<m;b+=3,k+=3)f(a,b,d,k,c.wkid);else return!1;else if(d!==a||b!==k)for(;b<m;b++,k++)d[k]=a[b];return!0},computeLinearTransformation:function(a,c,b,d){var f=B(a),k=B(d);if(f===k&&(0!==f||a.equals(d)))return t.identity(b),t.translate(b,c),!0;if(1===k){if(d=K[f])return d(c,0,p,0,a.wkid),G(p,0,x,0),d=z*p[0],c=z*p[1],a=Math.sin(d),d=Math.cos(d),f=Math.sin(c),c=Math.cos(c),b[0]=-a,b[4]=-f*d,
b[8]=c*d,b[12]=x[0],b[1]=d,b[5]=-f*a,b[9]=c*a,b[13]=x[1],b[2]=0,b[6]=c,b[10]=f,b[14]=x[2],b[3]=0,b[7]=0,b[11]=0,b[15]=1,!0}else if(3===k&&(2===f||1===f))return K[f](c,0,p,0,a.wkid),a=z*p[1],I(p,0,x,0),t.identity(b),t.translate(b,x),a=1/Math.cos(a),t.scale(b,[a,a,1]),!0;return!1},mbsToMbs:function(a,c,b,d){var f=B(c),k=B(d);if(f===k&&(0!==f||c.equals(d)))return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],!0;if(1===k){if(d=K[f])return d(a,0,p,0,c.wkid),G(p,0,b,0),b[3]=a[3],!0}else if(3===k&&(2===f||1===
f))return K[f](a,0,p,0,c.wkid),c=z*p[1],c=Math.abs(c)+Math.asin(a[3]/(D+a[2])),I(p,0,b,0),b[3]=c>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(c)*a[3],!0;return!1},extentToBoundingBox:function(a,c,b){if(null==a)return!1;var d;k[0]=null!=a.xmin?a.xmin:0;k[1]=null!=a.ymin?a.ymin:0;k[2]=null!=a.zmin?a.zmin:0;d=this.bufferToBuffer(k,a.spatialReference,0,c,b,0,1);k[0]=null!=a.xmax?a.xmax:0;k[1]=null!=a.ymax?a.ymax:0;k[2]=null!=a.zmax?a.zmax:0;d=d&&this.bufferToBuffer(k,a.spatialReference,0,c,b,3,1);null==
a.xmin&&(c[0]=-Infinity);null==a.ymin&&(c[1]=-Infinity);null==a.zmin&&(c[2]=-Infinity);null==a.xmax&&(c[3]=Infinity);null==a.ymax&&(c[4]=Infinity);null==a.zmax&&(c[5]=Infinity);return d},extentToBoundingRect:function(a,c,b){if(null==a)return!1;var d;k[0]=null!=a.xmin?a.xmin:0;k[1]=null!=a.ymin?a.ymin:0;k[2]=null!=a.zmin?a.zmin:0;d=this.bufferToBuffer(k,a.spatialReference,0,k,b,0,1);c[0]=k[0];c[1]=k[1];k[0]=null!=a.xmax?a.xmax:0;k[1]=null!=a.ymax?a.ymax:0;k[2]=null!=a.zmax?a.zmax:0;d=d&&this.bufferToBuffer(k,
a.spatialReference,0,k,b,0,1);c[2]=k[0];c[3]=k[1];null==a.xmin&&(c[0]=-Infinity);null==a.ymin&&(c[1]=-Infinity);null==a.xmax&&(c[2]=Infinity);null==a.ymax&&(c[3]=Infinity);return d},webMercator:{x2lon:function(a){return a/D},y2lat:function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/D))},lon2x:function(a){return a*D},lat2y:function(a){a=Math.sin(a);return D/2*Math.log((1+a)/(1-a))}}}})},"esri/views/3d/support/cameraUtilsPlanar":function(){define(["../../../geometry/Extent","./mathUtils","./projectionUtils",
"../lib/glMatrix","./cameraUtilsInternal"],function(w,l,f,a,d){function b(a,b,d){a=t.create();var f=t.create();m.identity(x);m.rotateZ(x,-l.deg2rad(b));m.rotateX(x,l.deg2rad(d));m.multiplyVec3(x,p,a);t.scale(a,-1);m.multiplyVec3(x,k,f);return{direction:a,up:f}}var q={headingTiltToDirectionUp:b,directionToHeadingTilt:function(a,b,f,m){return d.directionToHeadingTilt(b,f,m,p,k)},eyeForCenterWithHeadingTilt:function(a,d,f,k){var c=b(a,f,k);a=t.add(t.scale(c.direction,-d,t.create()),a);return{up:c.up,
eye:a,heading:f,tilt:k}},lookAtTiltToEyeTilt:function(a,b,d){return l.rad2deg(d)},eyeTiltToLookAtTilt:function(a,b,d){return l.deg2rad(d)},toExtent:function(a,b,d,k,c){var m=a.renderSpatialReference;a=a.map&&a.spatialReference||b.spatialReference;f.pointToVector(b,z,m);f.pointToVector(b,v,m);z[0]-=d/2;v[0]+=d/2;z[1]-=k/2;v[1]+=k/2;f.vectorToVector(z,m,z,a);f.vectorToVector(v,m,v,a);c?(c.xmin=z[0],c.ymin=z[1],c.xmax=v[0],c.ymax=v[1],c.spatialReference=a):c=new w(z[0],z[1],v[0],v[1],a);return c}},t=
a.vec3d,m=a.mat4d,k=t.createFrom(0,1,0),p=t.createFrom(0,0,1),x=m.create(),z=t.create(),v=t.create();return q})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["./mathUtils","../lib/glMatrix"],function(w,l){var f=l.vec3d,a=f.create(),d=f.create();return{directionToHeadingTilt:function(b,q,l,m,k){var p=a;f.normalize(b,p);var x=f.dot(p,m),t=0<x,x=Math.abs(x);.99<x&&(x=Math.abs(f.dot(q,m)),.99>x?(f.set(q,p),t&&f.scale(p,-1)):p=null);q=0;p&&(f.scale(m,f.dot(m,p),d),f.subtract(p,d),q=f.dot(p,
k)/(f.length(p)*f.length(k)),f.cross(p,k,d),q=(0<f.dot(d,m)?1:-1)*w.rad2deg(w.acos(q)));b=w.rad2deg(w.acos(-f.dot(m,b)/f.length(b)));return l?(l.heading=q,l.tilt=b,l):{heading:q,tilt:b}}}})},"esri/views/3d/support/cameraUtilsSpherical":function(){define("../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry/support/webMercatorUtils ./mathUtils ./earthUtils ../lib/glMatrix ./cameraUtilsInternal".split(" "),function(w,l,f,a,d,b,q){function t(c,b,d){var f=x.create(),k=x.create();
x.cross(c,v,E);0===x.dot(E,E)&&x.cross(c,r,E);z.identity(C);z.rotate(C,-a.deg2rad(b),c);z.rotate(C,-a.deg2rad(d),E);x.cross(E,c,k);x.normalize(k);z.multiplyVec3(C,k);x.normalize(c,f);z.multiplyVec3(C,x.negate(f));return{direction:f,up:k}}function m(a){var c=a[1];a[1]=-a[2];a[2]=c}function k(a,c){c=t(c,a.heading,a.tilt);a.up=c.up;return a}var p={headingTiltToDirectionUp:t,directionToHeadingTilt:function(a,b,d,f){var k=E,m=c;x.normalize(a,k);x.cross(k,v,c);0===x.dot(c,c)&&x.cross(k,r,c);x.cross(c,k,
m);return q.directionToHeadingTilt(b,d,f,k,m)},eyeForCenterWithHeadingTilt:function(c,b,d,f){var p={eye:x.create(),tilt:f,heading:d},r=E;r[0]=c[0];r[1]=c[2];r[2]=-c[1];d=a.deg2rad(d);var q=a.deg2rad(f);f=Math.sin(d);d=Math.cos(d);var u=Math.sin(q),v=Math.cos(q),l=x.length(r);if(1E-8>Math.abs(q))q=b+l;else var t=l/u,z=a.asin(b/t),q=t*Math.sin(Math.PI-q-z);var t=u*b,v=v*b,z=d*t,C=q-v,B=C*C,D=b*b*u*u,u=d*d*D,D=f*f*D,G=r[1]*C,w=u*(u+B-r[1]*r[1]);if(0>w)return x.scale(r,q/l,p.eye),p.tilt=0,p;var h=Math.sqrt(w),
w=u+B,G=0<d?-h+G:h+G;if(1E-8>Math.abs(w))return 1E-8>l?(p.eye[0]=0,p.eye[1]=0,p.eye[2]=b):x.scale(r,q/l,p.eye),p.tilt=0,m(p.eye),k(p,c);p.eye[1]=G/w;w=p.eye[1]*p.eye[1];b=1-w;G=Math.sqrt(b);z=u*w+D-2*z*p.eye[1]*G*C+b*B;if(1E-8>Math.abs(z))return x.scale(r,q/l,p.eye),p.tilt=0,m(p.eye),k(p,c);p.eye[0]=(b*(q*r[0]-v*r[0])-t*G*(r[0]*p.eye[1]*d+r[2]*f))/z;p.eye[2]=(b*(q*r[2]-v*r[2])-t*G*(r[2]*p.eye[1]*d-r[0]*f))/z;x.scale(p.eye,q);m(p.eye);return k(p,c)},lookAtTiltToEyeTilt:function(c,b,d){c=x.length(c);
b=a.asin(b/(Math.sqrt(b*b+c*c-2*b*c*Math.cos(Math.PI-d))/Math.sin(d)));return a.rad2deg(d-b)},eyeTiltToLookAtTilt:function(c,b,d){d=a.deg2rad(d);c=x.length(c);return a.asin(b/(c/Math.sin(d)))+d},toExtent:function(c,b,k,m,p){var r;r=b.latitude;b=b.longitude;var q=d.getLonDeltaForDistance(b,r,k)/2;k=b-q;b+=q;r=a.deg2rad(r);q=d.earthRadius;r=(1+Math.sin(r))/(1-Math.sin(r));var v=(r+1)*Math.tan(m/q/2);r=1.5*Math.PI-2*Math.atan(.5*(v+Math.sqrt(4*r+v*v)));m=r+m/q;q=function(c){var b=Math.PI/2;c=a.cyclical2PI.normalize(c,
-b);c>b&&(c=Math.PI-c);return c};r=q(r);m=q(m);m<r&&(q=m,m=r,r=q);r=Math.max(a.rad2deg(r),-90);m=Math.min(a.rad2deg(m),90);b=u.monotonic(k,b);180<b-k&&(q=(b-k-180)/2,k+=q,b-=q);p?(p.xmin=k,p.ymin=r,p.xmax=b,p.ymax=m,p.spatialReference=w.WGS84):p=new l(k,r,b,m,w.WGS84);c.spatialReference&&c.spatialReference.isWebMercator&&f.geographicToWebMercator(p,!1,p);return p}},x=b.vec3d,z=b.mat4d,v=x.createFrom(0,0,1),r=x.normalize(x.createFrom(1,1,1)),u=new a.Cyclical(-180,180),C=z.create(),E=x.create(),c=x.create();
return p})},"esri/views/3d/support/viewpointUtils":function(){define("../../../geometry/SpatialReference ../../../geometry/Geometry ../../../geometry/Point ../../../geometry/Extent ../../../geometry/support/webMercatorUtils ../../../core/Error ../../../core/promiseUtils ../../../Camera ../../../Viewpoint ../../../Graphic ../lib/glMatrix ./mathUtils ./projectionUtils ./cameraUtils ./aaBoundingBox ./aaBoundingRect ./intersectionUtils".split(" "),function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C){function E(a){return 360-
x.cyclicalDeg.normalize(a)}function c(a){return x.cyclicalDeg.normalize(360-a)}function D(a,c,b){if(!c)return null;var e=a.spatialReference||w.WGS84,g;if(c.camera){g=c.get("camera.position.spatialReference");if(!d.canProject(g,e))return null;c=c.camera.clone();g.equals(e)||(a=d.project(c.position,e),c.position=a);return c}if((g=c.get("targetGeometry.spatialReference"))&&!d.canProject(g,e))return null;var h=a.navigation.currentCamera;g=v.internalToExternal(a,h);var k={noReset:!1};null!=c.rotation&&
(g.heading=E(c.rotation),k.noReset=!0);null!=b&&(g.tilt=b);if(c.targetGeometry instanceof f){var m=c.targetGeometry;b=c.targetGeometry.clone();c=null!=c.scale?v.scaleToDistance(a,c.scale,m.latitude):h.distance;c=v.eyeHeadingTiltForCenterPointAtDistance(a,g.heading,g.tilt,b,c,k);a=z.vectorToPoint(c.eye,a.renderSpatialReference,e);return new t(a,c.heading,c.tilt,g.fov)}return v.fromExtent(a,c.targetGeometry.extent,g,k)}function B(a,c,b,e){var d=b.scale;null==d&&null!=b.zoom&&(d=v.zoomToScale(a,b.zoom));
null==d&&null!=b.distance&&(c=c.center||c,d=v.distanceToScale(a,b.distance,c.latitude));null==d&&e&&(d="function"===typeof e?e():e);return d}function I(a,b,d,k,m){if(!(b&&d.position||b&&d.direction||d.position&&d.direction))return!1;var p=a.spatialReference||w.WGS84,n=a.renderSpatialReference,r=d.direction;b&&d.position&&(r=null);d.position&&z.pointToVector(d.position,h,n);b&&z.pointToVector(b,e,n);if(r){var q=new f(d.position||b);q.x+=r[0];q.y+=r[1];2<r.length&&(q.z+=r[2]);z.pointToVector(q,g,n);
A.subtract(g,d.position?h:e)}d.position&&r?(m.camera.position=new f(d.position),v.directionToHeadingTilt(a,h,g,k.up,m.camera),A.add(h,g,e),a.navigation.getCenterIntersectTerrain(h,e,e),m.targetGeometry=z.vectorToPoint(e,n,p),m.scale=v.distanceToScale(a,A.dist(h,e),m.targetGeometry.latitude)):b&&r?(m.targetGeometry=new f(b),m.scale=B(a,m.targetGeometry,d,function(){return v.computeScale(a,k)}),b=v.scaleToDistance(a,m.scale,b.latitude),A.scale(g,b/A.length(g),h),A.add(h,e),m.camera.position=z.vectorToPoint(h,
n,p),v.directionToHeadingTilt(a,h,g,k.up,m.camera)):(m.targetGeometry=new f(b),m.camera.position=new f(d.position),A.subtract(e,h,g),v.directionToHeadingTilt(a,h,g,k.up,m.camera),m.scale=v.distanceToScale(a,A.dist(h,e),m.targetGeometry.latitude));m.rotation=c(m.camera.heading);return!0}function G(a,c){var b=!1;null!=c.heading?(a.heading=c.heading,b=!0):null!=c.rotation&&(a.heading=E(c.rotation),b=!0);null!=c.tilt&&(a.tilt=c.tilt,b=!0);null!=c.fov&&(a.fov=c.fov);return b}function H(a,b,e){var d=a.spatialReference||
w.WGS84;b=b||v.externalToInternal(a,e.camera);e.targetGeometry=z.vectorToPoint(b.center,a.renderSpatialReference,d);e.scale=v.computeScale(a,b);e.rotation=c(e.camera.heading);return e}function K(a,c,b){if(c){var e=[];if(!c.hasZ&&a.basemapTerrain){var d;d=c.isInstanceOf(f)?c:c.centroid||c.center;y[2]=d?a.basemapTerrain.getElevation(d)||0:0}ca[c.declaredClass](c,function(a){e.push(a[0],a[1],a[2])},y);var g=e.length/3;if(0!==g&&(d=Array(e.length),z.bufferToBuffer(e,c.spatialReference,0,d,a.spatialReference,
0,g)))for(c.hasZ&&(b.hasZ=!0),a=0;a<d.length;a+=3)c.hasZ?(y[0]=d[a+0],y[1]=d[a+1],y[2]=d[a+2]):(y[0]=d[a+0],y[1]=d[a+1]),r.expand(b.boundingBox,y)}}function J(a,c,b){return a.whenViewForGraphic(c).then(function(a){if(a&&a.whenGraphicBounds)return a.whenGraphicBounds(c)}).then(function(a){var c=a.boundingBox;r.expand(b.boundingBox,c);a.screenSpaceObjects&&a.screenSpaceObjects.forEach(function(a){b.screenSpaceObjects.push(a)});isFinite(c[2])&&(b.hasZ=!0)}).otherwise(function(){K(a,c.geometry,b)})}function P(a,
c,b){if(Array.isArray(c)&&2===c.length&&"number"===typeof c[0]&&"number"===typeof c[1])W.x=c[0],W.y=c[1],W.z=void 0,W.spatialReference=w.WGS84,K(a,W,b);else{if(c&&c.forEach)return q.eachAlways(c.map(function(c){return P(a,c,b)}));if(c instanceof l)K(a,c,b);else if(c instanceof k)return J(a,c,b)}return q.resolve()}function O(a,b,e,d){if(b.camera)return L(a,e,b.camera,d);d.scale=b.scale;d.rotation=b.rotation;d.targetGeometry=b.targetGeometry?b.targetGeometry.clone():null;d.camera=null;null!=e.heading?
d.rotation=c(e.heading):null!=e.rotation&&(d.rotation=e.rotation);b=B(a,d.targetGeometry,e);null!=b&&(d.scale=b);d.camera=D(a,d,e.tilt);return d}function L(a,c,b,e){e.camera=b.clone();e.camera.fov=a.camera.fov;c=a.spatialReference;b=e.camera.position.spatialReference;if(!d.canProject(b,c))return null;b.equals(c)||(c=d.project(e.camera.position,c),e.camera.position=c);return H(a,null,e)}function M(a,c,b,e){if(!b)return null;e.targetGeometry=b.clone();var d=a.navigation.getCameraIntersectTerrain();
if(I(a,e.targetGeometry,c,d,e))return e;v.internalToExternal(a,d,e.camera);var g={noReset:!1};G(e.camera,c)&&(g.noReset=!0);e.scale=B(a,e.targetGeometry,c);null==e.scale&&(z.pointToVector(b,y,a.renderSpatialReference),C.frustumPoint(d.frustumPlanes,y)?e.scale=v.distanceToScale(a,A.dist(d.eye,y),b.latitude):e.scale=v.computeScale(a,d));return v.fromCenterScale(a,e.targetGeometry,e.scale,e.camera,g,e.camera)?e:null}function R(a,c,b,e){e.targetGeometry=b.clone();var d=a.navigation.getCameraIntersectTerrain();
v.internalToExternal(a,d,e.camera);d={noReset:!1};G(e.camera,c)&&(d.noReset=!0);return v.fromExtent(a,b,e.camera,d,e.camera)?e:null}function Q(a,c){if(!c||!a.spatialReference)return null;a={};if(null!=c.declaredClass||Array.isArray(c))a.target=c;else{for(var b in c)a[b]=c[b];c.center&&!a.target&&(a.target=c.center)}return a}function T(a){a&&(a.rotation=c(a.camera.heading));return q.resolve(a)}var A=p.vec3d,V=p.mat3d,S=p.mat4d,h=A.create(),e=A.create(),g=A.create(),n={heading:0,tilt:0},y=A.create(),
F=S.create(),N=V.create(),U=r.create(),Y=u.create(),W=new f;p=function(a,c,b){for(var e=a.hasZ,d=0;d<a.rings.length;d++)for(var g=a.rings[d],f=0;f<g.length;f++)b[0]=g[f][0],b[1]=g[f][1],e&&(b[2]=g[f][2]),c(b)};var ca={"esri.geometry.Point":function(a,c,b){b[0]=a.x;b[1]=a.y;a.hasZ&&(b[2]=a.z);c(b)},"esri.geometry.Polygon":p,"esri.geometry.Circle":p,"esri.geometry.Polyline":function(a,c,b){for(var e=a.hasZ,d=0;d<a.paths.length;d++)for(var g=a.paths[d],f=0;f<g.length;f++)b[0]=g[f][0],b[1]=g[f][1],e&&
(b[2]=g[f][2]),c(b)},"esri.geometry.Multipoint":function(a,c,b){var e=a.points;a=a.hasZ;for(var d=0;d<e.length;d++)b[0]=e[d][0],b[1]=e[d][1],a&&(b[2]=e[d][2]),c(b)},"esri.geometry.Extent":function(a,c,b){a.hasZ?(c(A.set3(a.xmin,a.ymin,a.zmin,b)),c(A.set3(a.xmax,a.ymin,a.zmin,b)),c(A.set3(a.xmin,a.ymax,a.zmin,b)),c(A.set3(a.xmax,a.ymax,a.zmin,b)),c(A.set3(a.xmin,a.ymin,a.zmax,b)),c(A.set3(a.xmax,a.ymin,a.zmax,b)),c(A.set3(a.xmin,a.ymax,a.zmax,b)),c(A.set3(a.xmax,a.ymax,a.zmax,b))):(c(A.set3(a.xmin,
a.ymin,b[2],b)),c(A.set3(a.xmax,a.ymin,b[2],b)),c(A.set3(a.xmin,a.ymax,b[2],b)),c(A.set3(a.xmax,a.ymax,b[2],b)))}},X={create:function(c,e){var d=Q(c,e);if(!d)return q.reject(new b("viewpointutils-create:no-target","Missing target for creating viewpoint"));var h=new m({camera:new t({fov:c.camera.fov})}),k=null!=d.scale||null!=d.zoom||null!=d.distance;if(d.target instanceof m)return T(O(c,d.target,d,h));if(d.target instanceof t)return T(L(c,d,d.target,h));if(d.target instanceof a)return e=d.target.xmin===
d.target.xmax||d.target.ymin===d.target.ymax,k||e?T(M(c,d,d.target.center,h)):T(R(c,d,d.target,h));var p={boundingBox:r.create(r.NEGATIVE_INFINITY),spatialReference:c.spatialReference,hasZ:!1,screenSpaceObjects:[]};return P(c,d.target,p).then(function(){if(isFinite(p.boundingBox[0])){r.center(p.boundingBox,y);W.x=y[0];W.y=y[1];W.z=y[2];W.spatialReference=c.spatialReference;var a;isFinite(W.z)&&p.hasZ?a=r.isPoint(p.boundingBox):(W.z=void 0,a=u.isPoint(r.toRect(p.boundingBox,Y)));if(k||a)return M(c,
d,W,h);a=p.boundingBox;var b;b=p.screenSpaceObjects;var e=X.DEFAULT_FRAME_COVERAGE;if(b.length){for(var m=Number.NEGATIVE_INFINITY,q=0;q<b.length;q++)var l=b[q].screenSpaceBoundingRect,m=Math.max(m,Math.abs(l[0]),Math.abs(l[1]),Math.abs(l[2]),Math.abs(l[3]));b=e-m/Math.min(c.width,c.height)*2}else b=e;q=W;e=b;h.targetGeometry=q.clone();b=c.navigation.getCameraIntersectTerrain();m=0;q.hasZ?m=q.z:c.basemapTerrain&&(m=c.basemapTerrain.getElevation(q));A.set3(q.x,q.y,m,y);z.computeLinearTransformation(c.spatialReference,
y,F,c.renderSpatialReference);S.toMat3(F,N);V.transpose(N);r.set(U,r.NEGATIVE_INFINITY);q=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(l=0;l<q.length;l++){var x=q[l],t=a[x[2]];isFinite(t)||(t=m);A.set3(a[x[0]],a[x[1]],t,y);z.vectorToVector(y,c.spatialReference,y,c.renderSpatialReference);r.expand(U,V.multiplyVec3(N,y))}a=r.width(U);m=r.height(U);q=r.depth(U);l=1/Math.tan(b.fovY/2);a=Math.max(.5*Math.sqrt(a*a+q*q)*Math.max(l,1/Math.tan(b.fovX/2))+.5*m,.5*m*l+.5*Math.max(a,
q))/e;v.internalToExternal(c,b,h.camera);b={noReset:!1};G(h.camera,d)&&(b.noReset=!0);h.scale=v.distanceToScale(c,a,h.targetGeometry.latitude);a=v.fromCenterScale(c,h.targetGeometry,h.scale,h.camera,b,h.camera)?h:null;return a}a=c.navigation.getCameraIntersectTerrain();I(c,null,d,a,h)?a=h:d.position?(A.set(a.viewForward,g),v.directionToHeadingTilt(c,a.eye,g,a.up,n),h.camera.position=new f(d.position),a=h.camera,b=n.heading,e=d.heading,null==e&&null!=d.rotation&&(e=E(d.rotation)),null==e&&b&&(e="function"===
typeof b?b():b),a.heading=e,a=h.camera,b=n.tilt,b=null!=d.tilt?d.tilt:null!=b?"function"===typeof b?b():b:void 0,a.tilt=b,a=H(c,null,h)):(a=z.vectorToPoint(a.center,c.renderSpatialReference,W,c.spatialReference),a=M(c,d,a,h));return a}).then(function(a){return T(a)})},rotationToHeading:E,headingToRotation:c,toCamera:D,fromCamera:function(a,c,b){b||(b=new m);b.camera=c.clone();return H(a,null,b)},fromInternalCamera:function(a,c,b){b||(b=new m({camera:new t}));v.internalToExternal(a,c,b.camera);return H(a,
c,b)},DEFAULT_FRAME_COVERAGE:.66};return X})},"esri/views/3d/support/intersectionUtils":function(){define(["../lib/glMatrix"],function(w){function l(b,d,f,k){k.clip[0]=0;k.clip[1]=f?k.len:Number.MAX_VALUE;for(f=0;f<b.length;f++){var m;var q=b[f],l=d;m=k;var v=a.dot(q,m.dir),l=-a.dot(l,q)-q[3];0>l&&0<=v?m=!1:-1E-6<v&&1E-6>v?m=!0:!(0>l||0>v)||0>l&&0>v?(l/=v,0<v?l<m.clip[1]&&(m.clip[1]=l):l>m.clip[0]&&(m.clip[0]=l),m=m.clip[0]<=m.clip[1]):m=!0;if(!m)return!1}return!0}function f(b,f,m,k){b?(m&&k&&(d.len=
a.dist(f,m)),a.set(b,d.dir)):k?(d.len=a.dist(f,m),a.scale(a.subtract(m,f,d.dir),1/d.len)):a.normalize(a.subtract(m,f,d.dir));return d}var a=w.vec3d;w=w.vec2d;var d={dir:a.create(),len:0,clip:w.create()},b={planeSphere:function(a,b,d){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]<d},frustumSphere:function(a,d,f){for(var k=0;6>k;k++)if(!b.planeSphere(a[k],d,f))return!1;return!0},frustumRay:function(a,b,d,k){d=f(k,b,d,!1);return l(a,b,null,d)},frustumPoint:function(b,d){for(var f=0;6>f;f++){var k=b[f];if(0>
-a.dot(d,k)-k[3])return!1}return!0},frustumLineSegment:function(a,b,d,k){k=f(k,b,d,!0);return l(a,b,d,k)}};return b})},"esri/views/3d/webgl-engine/Stage":function(){define("require exports ./parts/Model ./parts/View ./lib/Selector ./lib/Camera ./lib/gl-matrix ./lib/Util ./lib/ModelContentType ./lighting/Lightsources".split(" "),function(w,l,f,a,d,b,q,t,m,k){w=q.vec2d;l=q.vec2;var p=q.vec3d;q=function(){function r(b,m,r){this._intersectTolerance=d.DEFAULT_TOLERANCE;this._viewContent=[];this._externalIntersectionHandlers=
[];this.container=m;this.viewingMode=b;this.model=new f;this.view=new a(m,this,this.model.getDirtySet(),r);this._validateHUDSelector=new d(this.viewingMode);this._validateHUDSelector.enableHUDSelection=!1;this.view.setLighting({lights:[new k.MainLight(p.createFrom(.7,.7,.7)),new k.AmbientLight(p.createFrom(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})}r.prototype.setNeedsRender=function(){this.view.setNeedsRender()};r.prototype.dispose=function(){this.view.dispose();this.model=this.view=null};
r.prototype.frame=function(a,d){void 0===d&&(d=0);var f=Math.max(1E-6,a.getBSRadius());d=Math.max(2,d+2);d*=f;var f=this.getCamera(),c=p.create(f.viewForward);p.scale(c,-(1.5*d/Math.tan(f.fov)));p.set(a.getCenter(),f.center);p.add(f.center,c,f.eye);f=new b(f.eye,f.center,f.up);this.setCamera(f)};r.prototype.beginMod=function(){r.DebugSettings.fineGrainedContentValidation&&this.model.validateContent()};r.prototype.endMod=function(a){void 0===a&&(a=!1);r.DebugSettings.fineGrainedContentValidation&&
!a&&this.model.validateContent()};r.prototype.add=function(a,b){this.model.add(a,b);"function"===typeof b.addParentStage&&b.addParentStage(this)};r.prototype.remove=function(a,b){a=this.model.remove(a,b);"function"===typeof a.removeParentStage&&a.removeParentStage(this);return a};r.prototype.notifyDirty=function(a,b,d,c){this.model.notifyDirty(a,b,d,c)};r.prototype.processDirty=function(){var a=this.model.getDirtySet(),b=a.getDirtyMaterials();if(a.hasDirtyGeometryRecords()||b){r.DebugSettings.endFrameContentValidation&&
this.model.validateContent();r.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));var d=a.getAddRemoveUpdateListFilteredByLayers(this._viewContent,!0);(0<d[0].length+d[1].length+d[2].length||b)&&this.view.modify(d[0],d[1],d[2],b);r.DebugSettings.logDirtySet&&(console.log("RGs add: "+d[0].map(function(a){return a.uniqueName})),console.log("RGs remove: "+d[1].map(function(a){return a.uniqueName})));a.getAddRemoveUpdateList(!0);a.clearDirtyMaterials();
this.view.setNeedsRender()}};r.prototype.processDirtyLayer=function(a){var b=this.model.getDirtySet(),d=b.getDirtyMaterials();a=b.getAddRemoveUpdateListFilteredByLayers([a],!0);(0<a[0].length+a[1].length+a[2].length||d)&&this.view.modify(a[0],a[1],a[2],d);b.clearDirtyMaterials();this.view.setNeedsRender()};r.prototype.get=function(a,b){return this.model.get(a,b)};r.prototype.getAll=function(a){return this.model.getAll(a)};r.prototype.addTextureListener=function(a){this.view.addTextureListener(a)};
r.prototype.removeTextureListener=function(a){this.view.removeTextureListener(a)};r.prototype.getContainer=function(){return this.container};r.prototype.getCamera=function(){return this.view.getCamera()};r.prototype.setCamera=function(a){this.view.setCamera(a)};r.prototype.getViewParams=function(a){return this.view.getViewParams(a)};r.prototype.setViewParams=function(a){this.view.setViewParams(a)};r.prototype.getLayers=function(){return this.model.getAll(m.LAYER)};r.prototype.setLighting=function(a){this.view.setLighting(a)};
r.prototype.getCanvas=function(){return this.view.getCanvas()};r.prototype.setRenderParams=function(a){this.view.setRenderParams(a)};r.prototype.getRenderParams=function(){return this.view.getRenderParams()};r.prototype.has=function(a){return this.view.has(a)};r.prototype.getViewContent=function(){return this._viewContent.slice(0)};r.prototype.setViewContent=function(a){var b=t.array2object(this._viewContent),d=t.array2object(a),c=t.subtractObjects(d,b),b=t.subtractObjects(b,d);this.processDirty();
d=this.model.getDirtySet();c=d.getResidentRenderGeometriesFilteredByLayers(t.object2array(c));b=d.getResidentRenderGeometriesFilteredByLayers(t.object2array(b));this.view.modify(c,b,[]);this._viewContent=a.slice(0)};r.prototype.addToViewContent=function(a){for(var b=[],d=0;d<a.length;d++)-1===this._viewContent.indexOf(a[d])&&b.push(a[d]);0<a.length&&(this.processDirty(),a=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(b),this.view.modify(a,[],[]),this._viewContent.push.apply(this._viewContent,
b))};r.prototype.removeFromViewContent=function(a){this.processDirty();for(var b=this.model.getDirtySet(),d=this._viewContent,c=[],f=0;f<a.length;f++){var k=d.indexOf(a[f]);-1<k&&(d[k]=d[d.length-1],d.pop(),c.push(a[f]))}a=b.getResidentRenderGeometriesFilteredByLayers(c);this.view.modify([],a,[])};r.prototype.getViewFrustumObjects=function(){return this.view.getFrustumObjects()};r.prototype.getLocalOrigin=function(a,b,d){return this.model.getOrigin(a,b,d)};r.prototype.getFrameTask=function(){return this.view.getFrameTask()};
r.prototype.requestScreenCapture=function(a,b){this.view.requestScreenCapture(a,b)};r.prototype.getAllTexturesLoaded=function(){return this.view.getAllTexturesLoaded()};r.prototype.getTextureLoaded=function(a){return this.view.getTextureLoaded(a)};r.prototype.addExternalRenderer=function(a,b){"function"===typeof b.intersect&&this._externalIntersectionHandlers.push(b);return this.view.addExternalRenderer(a,b)};r.prototype.removeExternalRenderer=function(a){var b=this._externalIntersectionHandlers.indexOf(a);
-1<b&&this._externalIntersectionHandlers.splice(b,1);return this.view.removeExternalRenderer(a)};r.prototype.getContentDebugStrings=function(a){return this.model.formatDebugInfo(a)};r.prototype.getRenderStats=function(){return this.view.getCombinedStats()};r.prototype.getRenderStatString=function(a){var b=this.getRenderStats(),d="";if(a){var d=d+"\x3ctable\x3e",c;for(c in b)d+="\x3ctr\x3e\x3ctd\x3e"+c+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Math.round(b[c])+"\x3c/td\x3e\x3c/tr\x3e";d+=
"\x3c/table\x3e"}else for(c in b)d+=c+": "+b[c]+"\n";return d};r.prototype.pick=function(a,b,d,c){var f=p.create(),k=p.create();this.view.getPickRay(a,f,k);return this.pickRay(f,k,a,a,b,d,c)};r.prototype.pickRayWithBeginPoint=function(a,b,d,c,f){this.view.pickRayWithBeginPoint(a,b,d,c,f)};r.prototype.pickRay=function(a,b,k,c,m,r,q){c=this.view.getCamera();k||(k=x,c.projectPoint(b,k));var u;if(m){u=Array(m.length);for(var l=0;l<u.length;l++)u[l]=this.model.get(f.ContentType.LAYER,m[l])}else{u=[];m=
this.getViewContent();for(var t=this.model.getAll(f.ContentType.LAYER),l=0;l<m.length;l++){var C=t[m[l]];C&&"VISIBLE"===C.getState()&&u.push(C)}}q?q.init(u,a,b,k,c,this._intersectTolerance,r):q=new d(this.viewingMode,u,a,b,k,c,this._intersectTolerance,r);for(l=0;l<this._externalIntersectionHandlers.length;l++)this._externalIntersectionHandlers[l].intersect(q,a,b,k);if(q.getHudResults().length){l=q.getHudResults();l.sort(function(a,b){return b.dist-a.dist});b=l[l.length-1];k=z;c.projectPoint(b.center,
k);k[0]=Math.round(k[0]);k[1]=Math.round(k[1]);m=v;this.view.getPickRay(k,a,m);t=p.dist(b.center,a)/p.dist(a,m)*.99;this._validateHUDSelector.init(u,a,m,k,c,this._intersectTolerance,r);for(l=0;l<this._externalIntersectionHandlers.length;l++)this._externalIntersectionHandlers[l].intersect(this._validateHUDSelector,a,m,k);if(null==this._validateHUDSelector.getMinResult().dist||t<=this._validateHUDSelector.getMinResult().dist)q.getMinResult().set(b.target,b.name,b.dist,b.normal,b.priority),q.getMinResult().setIntersector("stage")}return q};
r.prototype.getIntersectTolerance=function(){return this._intersectTolerance};r.prototype.setIntersectTolerance=function(a){void 0===a&&(a=1E-5);this._intersectTolerance=a};r.prototype.getTextureGraphicsRenderer=function(){return this.view.getTextureGraphicsRenderer()};r.DebugSettings={fineGrainedContentValidation:!1,endFrameContentValidation:!1,logDirtySet:!1};r.ModelContentType=m;return r}();var x=w.create(),z=l.create(),v=p.create();return q})},"esri/views/3d/webgl-engine/parts/View":function(){define("require exports ../../../../core/Logger ../lib/GLTextureRep ../lib/GLMaterialRep ../lib/ShaderSnippets ../lib/GLSLShaderRep ../lib/TextureRenderer ../lib/gl-matrix ../lib/webgl-utils ./Model ./Viewport ../materials/repository ../lib/SSAOHelperObscurance ../lib/HighlightHelper ../lib/OffscreenRenderingHelper ../lib/tracer ../../../webgl/RenderingContext ../lib/ProgramRepository ../lighting/Lightsources ../../../support/screenshotUtils".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c,D,B){var I=m.vec3d,G=m.vec4d,H=f.getLogger("esri.views.3d.webgl-engine.parts.View");return function(){function f(b,c,f,k){var m=this;this._backgroundColor=G.createFrom(1,1,1,1);this._lightDirection=I.createFrom(0,1,0);this._didRender=!1;this._idleSuspend=this._needsRender=!0;this._shouldRender=!1;this._screenCaptureQueue=[];this._container=b;this._stage=c;this._initializeContext(k);this._initializeShaders(k);this._textureRep=new a(c.getAll(p.ContentType.TEXTURE),
this._programRepository,function(){return m._viewport.getCamera().viewport},this._rctx);this._materialRep=new d(this._textureRep,this._programRepository);this._viewport=new x(this._programRepository,this._materialRep,this._textureRep,this._rctx);this._initializeViewportCamera();this._textureRenderer=new t(this._rctx,this._canvas,this._programRepository,this._materialRep,this._textureRep,f);this._initializeFrameTask()}f.prototype._initializeFrameTask=function(){var a=this;this._frameTask={preRender:function(){C.begin();
a._stage.processDirty();a.needsRender()?(a._shouldRender=!0,a._viewport.getCamera().setGLViewport(a._rctx),a._rctx.setClearColor.apply(a._rctx,a._backgroundColor),a._rctx.clear(16640)):a._shouldRender=!1},render:function(){a._shouldRender&&(a._didRender=!0,a._viewport.render(a._lightDirection,null))},postRender:function(){C.end()},update:function(){a._performScreenCaptures();a.resetNeedsRender()}}};f.prototype._initializeViewportCamera=function(){var a=this._container.getBoundingClientRect(),b=this._viewport.getCamera();
b.viewport[2]=a.width;b.viewport[3]=a.height;this._viewport.setCamera(b)};f.prototype._initializeContext=function(a){this._canvas=a.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var b=k.setupWebGL(this._canvas,{alpha:a.alpha||!1,antialias:!1,depth:!0,stencil:null==a.stencil?!0:a.stencil});this._gl=C.instrumentContext(b[0]);this._rctx=new E(b[0],{disabledExtensions:a.deactivatedWebGLExtensions});!a.alpha&&
this._rctx.contextAttributes.alpha&&H.error("WebGL context has alpha channel even though no alpha channel was requested");this._container.appendChild(this._canvas)};f.prototype._initializeShaders=function(a){this._shaderSnippets=new b({fsprecisionf:"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\nprecision highp float;\nprecision highp sampler2D;\n#else\nprecision mediump float;\nprecision mediump sampler2D;\n#endif\n",vsprecisionf:"\nprecision highp float;\nprecision highp sampler2D;\n",viewingMode:"global"===
a.viewingMode?"#define VIEWING_MODE_GLOBAL 1 \n":" #define VIEWING_MODE_LOCAL 1 \n"});this._shaderRep=new q;this._programRepository=new c;z.initializeShaders(this._shaderSnippets,this._shaderRep,this._programRepository,this._rctx);r.loadShaders(this._shaderSnippets,this._shaderRep,this._programRepository,this._rctx);v.loadShaders(this._shaderSnippets,this._shaderRep,this._programRepository,this._rctx);u.loadShaders(this._shaderSnippets,this._shaderRep,this._programRepository,this._rctx)};f.prototype.dispose=
function(){this._viewport.dispose();this._viewport=null;this._textureRenderer.dispose();this._textureRenderer=null;this._programRepository.dispose();this._programRepository=null;this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._gl=this._canvas=this._container=null};f.prototype.getCombinedStats=function(){return this._viewport.getCombinedStats()};f.prototype.setNeedsRender=function(){this._didRender=!1;this._needsRender=!0};f.prototype.resetNeedsRender=function(){this._didRender&&
(this._didRender=this._needsRender=!1);this._viewport.resetNeedsRender();this._textureRep.resetNeedsRender()};f.prototype.needsRender=function(){return this._needsRender||!this._idleSuspend||this._viewport.needsRender()||this._textureRep.needsRender()};f.prototype.getFrameTask=function(){return this._frameTask};f.prototype.setLighting=function(a){I.set3(0,0,0,this._lightDirection);for(var b=0,c=a.lights;b<c.length;b++){var d=c[b];if(d instanceof D.MainLight){I.negate(d.direction,this._lightDirection);
break}}this._viewport.setLighting(a);this._needsRender=!0};f.prototype.getMainLightDirection=function(){return this._lightDirection};f.prototype.getViewParams=function(a){var b=this._viewport.getViewParams(a);if(!a||a.backgroundColor)b.backgroundColor=this._backgroundColor;return b};f.prototype.setViewParams=function(a){this._needsRender=!0;a.backgroundColor&&(this._backgroundColor=a.backgroundColor);this._viewport.setViewParams(a)};f.prototype.setRenderParams=function(a){this._needsRender=!0;void 0!==
a.idleSuspend&&(this._idleSuspend=!!a.idleSuspend);this._viewport.setRenderParams(a)};f.prototype.getRenderParams=function(){var a=this._viewport.getRenderParams();a.anisotropicFiltering=this._textureRep.getMaxAnisotropy();a.idleSuspend=this._idleSuspend;return a};Object.defineProperty(f.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0});f.prototype.has=function(a){return"s3tc"===a?!!this._rctx.extensions.compressedTextureS3TC:"standardDerivatives"===a?
!!this._rctx.extensions.standardDerivatives:"shaderTextureLOD"===a?!!this._rctx.extensions.shaderTextureLOD:"angleInstancedArrays"===a?!!this._rctx.extensions.angleInstancedArrays:!1};f.prototype.getFrustumObjects=function(){return this._viewport.getFrustumObjects()};f.prototype.modify=function(a,b,c,d){this._viewport.modify(a,b,c,d)};f.prototype.setCamera=function(a){this._viewport.setCamera(a)};f.prototype.getCamera=function(){return this._viewport.getCamera()};f.prototype.getPickRay=function(a,
b,c){this._viewport.getPickRay(a,b,c)};f.prototype.pickRayWithBeginPoint=function(a,b,c,d,f){this._viewport.pickRayWithBeginPoint(a,b,c,d,f)};f.prototype.getCanvas=function(){return this._canvas};f.prototype.getTextureGraphicsRenderer=function(){return this._textureRenderer};f.prototype.requestScreenCapture=function(a,b){this._screenCaptureQueue.push({settings:a||{},callback:b});this._needsRender=!0};f.prototype.getAllTexturesLoaded=function(){return 0===this._textureRep.getLoadingCount()};f.prototype.getTextureLoaded=
function(a){return this._textureRep.getIsLoaded(a)};f.prototype.addTextureListener=function(a){this._textureRep.addTextureListener(a)};f.prototype.removeTextureListener=function(a){this._textureRep.removeTextureListener(a)};f.prototype.addExternalRenderer=function(a,b){return this._viewport.addExternalRenderer(a,b)?(b.initializeRenderContext({rctx:this._rctx,gl:this._rctx.gl,shaderSnippets:this._shaderSnippets,shaderRep:this._shaderRep,programRep:this._programRepository,textureRep:this._textureRep}),
!0):!1};f.prototype.removeExternalRenderer=function(a){return this._viewport.removeExternalRenderer(a)?(a.uninitializeRenderContext({rctx:this._rctx,gl:this._rctx.gl}),!0):!1};f.prototype._performScreenCaptures=function(){if(0!==this._screenCaptureQueue.length){for(var a=0;a<this._screenCaptureQueue.length;a++){var b=this._screenCaptureQueue[a],c=0,d=0,f=this._canvas.width,k=this._canvas.height,m=this._canvas.width,p=this._canvas.height,r=b.settings.area;r&&(c=r.x,d=r.y,f=r.width,k=r.height);void 0!==
b.settings.width&&void 0!==b.settings.height?(r=b.settings.width/b.settings.height,k*r<f?(r*=k,c+=Math.floor((f-r)/2),f=Math.floor(r)):(r=f/r,d+=Math.floor((k-r)/2),k=Math.floor(r)),m=b.settings.width,p=b.settings.height):(m=f,p=k);var q=this._canvas,r=null;if(0!==c||0!==d||f!==this._canvas.width||k!==this._canvas.height||m!==this._canvas.width||p!==this._canvas.height){this._resizeCanvas||(this._resizeCanvas=document.createElement("canvas"));this._resizeCanvas.width=m;this._resizeCanvas.height=p;
var u=this._resizeCanvas.getContext("2d"),r=new Uint8Array(f*k*4);this._gl.readPixels(c,this._canvas.height-(d+k),f,k,6408,5121,r);c=u.getImageData(0,0,m,p);B.resampleHermite(r,f,k,c.data,m,p,!0);u.putImageData(c,0,0);q=this._resizeCanvas;u=null}f={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"}[b.settings.format?b.settings.format.toLowerCase():"png"];k=1;void 0!==b.settings.quality&&(k=b.settings.quality/100);f={dataURL:q.toDataURL(f,k),x:0,y:0,width:m,height:p};b.settings.returnByteBuffer&&
(f.data=r);b.callback(f)}this._screenCaptureQueue=[]}};return f}()})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define(["require","exports","./Util"],function(w,l,f){var a=function(){function a(a){this.refCnt=0;this.glMaterial=a}a.prototype.incRefCnt=function(){++this.refCnt};a.prototype.decRefCnt=function(){--this.refCnt;f.assert(0<=this.refCnt)};a.prototype.getRefCnt=function(){return this.refCnt};a.prototype.getGLMaterial=function(){return this.glMaterial};return a}();return function(){function d(a,
d){this.textureRep=a;this.programRep=d;this.id2glMaterialRef={}}d.prototype.aquire=function(a){return this.aquireExt(a,"color")};d.prototype.aquireDepthShadowMap=function(a){return this.aquireExt(a,"depthShadowMap")};d.prototype.aquireDepth=function(a){return this.aquireExt(a,"depth")};d.prototype.aquireNormal=function(a){return this.aquireExt(a,"normal")};d.prototype.aquireHighlight=function(a){return this.aquireExt(a,"highlight")};d.prototype.aquireExt=function(b,d){var f;f=b.getId()+"_"+d;var m=
this.id2glMaterialRef[f];null==m?(b=(m=b.getGLMaterials()[d])?new m(b,this.programRep,this.textureRep):void 0,m=new a(b),this.id2glMaterialRef[f]=m):b=m.getGLMaterial();m.incRefCnt();b&&this.increaseProgramReferences(b);return b};d.prototype.release=function(a){this.releaseExt(a,"color")};d.prototype.releaseDepth=function(a){this.releaseExt(a,"depth")};d.prototype.releaseNormal=function(a){this.releaseExt(a,"normal")};d.prototype.releaseDepthShadowMap=function(a){this.releaseExt(a,"depthShadowMap")};
d.prototype.releaseHighlight=function(a){this.releaseExt(a,"highlight")};d.prototype.releaseExt=function(a,d){a=a+"_"+d;d=this.id2glMaterialRef[a];d.decRefCnt();if(0===d.getRefCnt()){if(d=d.getGLMaterial())this.decreaseProgramReferences(d),void 0!==d.dispose&&d.dispose();delete this.id2glMaterialRef[a]}};d.prototype.updateMaterialParameters=function(a){var b=this.id2glMaterialRef[a+"_color"];b&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_depth"])&&b.getGLMaterial()&&
this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_depthShadowMap"])&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_normal"])&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(a=this.id2glMaterialRef[a+"_highlight"])&&a.getGLMaterial()&&this.updateParamsForMat(a.getGLMaterial())};d.prototype.updateParamsForMat=function(a){a.updateParameters&&a.updateParameters()};d.prototype.increaseProgramReferences=function(a){if(a.getAllPrograms){a=
a.getAllPrograms();for(var b=0;b<a.length;b++)this.programRep.increaseRefCount(a[b])}else this.programRep.increaseRefCount(a.getProgram())};d.prototype.decreaseProgramReferences=function(a){if(a.getAllPrograms){a=a.getAllPrograms();for(var b=0;b<a.length;b++)this.programRep.decreaseRefCount(a[b])}else this.programRep.decreaseRefCount(a.getProgram())};return d}()})},"esri/views/3d/webgl-engine/lib/ShaderSnippets":function(){define(["require","exports","./Util","dojox/xml/parser"],function(w,l,f,a){return function(){function d(a){var b=
f.VertexAttrConstants,d;for(d in b)this[b[d]]=f.VertexAttrConstants[d];if(a)for(var m in a)this[m]=a[m]}d.prototype._parse=function(b){b=a.parse(b).getElementsByTagName("snippet");for(var d=/\$[a-zA-Z0-9]+[ \t]*/,l=/[\$\s]+/g,m=0;m<b.length;m++){var k=b[m].getAttribute("name");f.assert(null==this[k]);for(var p=b[m].textContent;;){var x=p.match(d);if(null==x)break;var z=this[x[0].replace(l,"")];f.assert(void 0!==z);p=p.replace(x[0],z)}this[k]=p}};return d}()})},"dojox/xml/parser":function(){define(["dojo/_base/kernel",
"dojo/_base/lang","dojo/_base/array","dojo/_base/window","dojo/_base/sniff"],function(w){w.getObject("xml.parser",!0,dojox);dojox.xml.parser.parse=function(l,f){var a=w.doc,d;f=f||"text/xml";if(l&&w.trim(l)&&"DOMParser"in w.global){d=(new DOMParser).parseFromString(l,f);l=d.documentElement;if("parsererror"==l.nodeName&&"http://www.mozilla.org/newlayout/xml/parsererror.xml"==l.namespaceURI){if(a=l.getElementsByTagNameNS("http://www.mozilla.org/newlayout/xml/parsererror.xml","sourcetext")[0])a=a.firstChild.data;
throw Error("Error parsing text "+l.firstChild.data+" \n"+a);}return d}if("ActiveXObject"in w.global){a=function(a){return"MSXML"+a+".DOMDocument"};a=["Microsoft.XMLDOM",a(6),a(4),a(3),a(2)];w.some(a,function(a){try{d=new ActiveXObject(a)}catch(t){return!1}return!0});if(l&&d&&(d.async=!1,d.loadXML(l),l=d.parseError,0!==l.errorCode))throw Error("Line: "+l.line+"\nCol: "+l.linepos+"\nReason: "+l.reason+"\nError Code: "+l.errorCode+"\nSource: "+l.srcText);if(d)return d}else if(a.implementation&&a.implementation.createDocument){if(l&&
w.trim(l)&&a.createElement){f=a.createElement("xml");f.innerHTML=l;var b=a.implementation.createDocument("foo","",null);w.forEach(f.childNodes,function(a){b.importNode(a,!0)});return b}return a.implementation.createDocument("","",null)}return null};dojox.xml.parser.textContent=function(l,f){if(1<arguments.length)return dojox.xml.parser.replaceChildren(l,(l.ownerDocument||w.doc).createTextNode(f)),f;if(void 0!==l.textContent)return l.textContent;var a="";l&&w.forEach(l.childNodes,function(d){switch(d.nodeType){case 1:case 5:a+=
dojox.xml.parser.textContent(d);break;case 3:case 2:case 4:a+=d.nodeValue}});return a};dojox.xml.parser.replaceChildren=function(l,f){var a=[];w.isIE&&w.forEach(l.childNodes,function(d){a.push(d)});dojox.xml.parser.removeChildren(l);w.forEach(a,w.destroy);w.isArray(f)?w.forEach(f,function(a){l.appendChild(a)}):l.appendChild(f)};dojox.xml.parser.removeChildren=function(l){for(var f=l.childNodes.length;l.hasChildNodes();)l.removeChild(l.firstChild);return f};dojox.xml.parser.innerXML=function(l){return l.innerXML?
l.innerXML:l.xml?l.xml:"undefined"!=typeof XMLSerializer?(new XMLSerializer).serializeToString(l):null};return dojox.xml.parser})},"esri/views/3d/webgl-engine/lib/GLSLShaderRep":function(){define(["require","exports","./Util"],function(w,l,f){return function(){function a(){this.shaders={}}a.prototype.add=function(a,b){f.assert(null==this.shaders[a]);this.shaders[a]=b};a.prototype.get=function(a){f.assert(void 0!==this.shaders[a]);return this.shaders[a]};return a}()})},"esri/views/3d/webgl-engine/lib/TextureRenderer":function(){define("require exports ./Renderer ./Camera ./Util ./gl-matrix ../materials/internal/TexOnlyGLMaterial ./ModelDirtyTypesTs ./RenderPass ./HighlightUtils ./ComponentUtils ../../../webgl/FramebufferObject ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Util ../../../webgl/Texture ../../support/debugFlags ../lighting/Lightsources ../../../webgl/enums ./DefaultVertexBufferLayouts ./DefaultVertexAttributeLocations".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c,D,B){var I=b.vec3d,G=b.vec4d,H=b.mat4d;w=function(){function a(a,b,c,d,k,m){var p=this;this._acquiredTextures={};this._clearColor=G.createFrom(0,0,0,0);this._id2origin={};this._uniqueIdx=0;this._rctx=a;this._canvas=b;this._programRep=c;this._materialRep=d;this._textureRep=k;this._modelDirtySet=m;this._renderer=new f(c,d,k,this._rctx,!0);this._renderer.onHasHighlightsChanged=function(a){if(p.onHasHighlightsChanged)p.onHasHighlightsChanged(a)};this._renderer.setLighting({lights:[new E.AmbientLight(I.createFrom(1,
1,1))],groundLightingFactor:1,globalFactor:0})}a.prototype.dispose=function(){for(var a in this._acquiredTextures)this._acquiredTextures[a].fbo.dispose(),this._textureRep.release(a);this._acquiredTextures=null;this._renderer.dispose();this._renderer=null};a.prototype.addRenderGeometries=function(a){var b=this;a.forEach(function(a){null==a.origin&&(a.origin=b.getOrigin(a.center,a.bsRadius));a.idx=b._uniqueIdx++});this._renderer.modify(a,[])};a.prototype.removeRenderGeometries=function(a){this._renderer.modify([],
a)};a.prototype.updateRenderGeometries=function(a,b){a=a.map(function(a){return{renderGeometry:a,updateType:b}});this._renderer.modify([],[],a,{})};a.prototype.updateRenderOrder=function(a){0<Object.keys(a).length&&this._renderer.modifyRenderOrder(a)};a.prototype.setBackgroundColor=function(a){this._clearColor=a};a.prototype.addRenderGeometryHighlight=function(a,b){var c=a.instanceParameters,d=k.generateHighlightId();c.componentHighlights=p.addHighlight(c.componentHighlights,null,b,d);this.updateRenderGeometries([a],
32);return d};a.prototype.removeRenderGeometryHighlight=function(a,b){var c=a.instanceParameters;c.componentHighlights=p.removeHighlight(c.componentHighlights,b);this.updateRenderGeometries([a],32)};a.prototype.isEmpty=function(){return this._renderer.isEmpty()};a.prototype.processDirtyMaterials=function(){var a=this._modelDirtySet.getDirtyMaterials();a&&this._renderer.modify([],[],[],a);this._modelDirtySet.clearDirtyMaterials()};Object.defineProperty(a.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},
enumerable:!0,configurable:!0});a.prototype.draw=function(a,b){return this.drawPass(m.MATERIAL,a,b)};a.prototype.drawHighlights=function(a,b){return this.drawPass(m.MATERIAL_HIGHLIGHT,a,b)};a.prototype.drawPass=function(a,b,c){if(this.isEmpty()&&!C.OVERLAY_DRAW_TEST_TEXTURE)return!1;this.processDirtyMaterials();if(a===m.MATERIAL_HIGHLIGHT&&!this.hasHighlights)return!1;var d=b.getId(),f,k=this._rctx,p=k.gl;if(this._acquiredTextures[d])f=this._acquiredTextures[d].fbo;else{f=this._textureRep.aquire(d).getGLTexture();
f=x.createWithAttachments(this._rctx,f,{colorTarget:0,depthStencilTarget:0});var r=Object.keys(this._acquiredTextures).length;this._acquiredTextures[d]={texture:b,fbo:f,idx:r}}b=c.width;r=c.height;if(f.width!==b||f.height!==r)f.resize(b,r),f.colorTexture.setSamplingMode(9729);J.near=1;J.far=1E4;k.bindFramebuffer(f);k.setDepthTestEnabled(!1);k.setBlendFunctionSeparate(770,771,1,771);k.setClearColor.apply(k,this._clearColor);k.clear(p.COLOR_BUFFER_BIT);this._renderer.setPixelRatio(c.pixelRatio||1);
for(p=0;p<c.views.length;p++)f=c.views[p],J.viewport=f.viewport,H.ortho(0,f.extent[2]-f.extent[0],0,f.extent[3]-f.extent[1],J.near,J.far,J.projectionMatrix),H.identity(J.viewMatrix),H.translate(J.viewMatrix,[-f.extent[0],-f.extent[1],0]),J.setGLViewport(this._rctx),C.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(b,r,K[this._acquiredTextures[d].idx%K.length]),this._renderer.renderGeometryPass(a,J);k.setDepthTestEnabled(!0);k.setBlendFunctionSeparate(770,771,1,771);k.bindFramebuffer(null);k.setViewport(0,
0,this._canvas.width,this._canvas.height);return!0};a.prototype._drawTestTexture=function(a,b,c){var d=this._rctx,f=d.gl;if(!this._testPatternMat){for(var k=new Uint8Array(a*b*4),m=0,p=0;p<b;p++)for(var l=0;l<a;l++){var h=Math.floor(l/10),e=Math.floor(p/10);2>h||2>e||10*h>a-20||10*e>b-20?(k[m++]=255,k[m++]=255,k[m++]=255,k[m++]=255):(k[m++]=255,k[m++]=255,k[m++]=255,h&1&&e&1?k[m++]=l&1^p&1?0:255:k[m++]=h&1^e&1?0:128)}a=new u(d,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:a,
height:b},k);this._testPatternMat=new q(this._programRep,a,[1,1,1,1],!0,f.ALWAYS);this._testPatternBindParams={proj:H.identity(),view:H.identity(),nearFar:[-1,1],origin:[0,0,0]};f=new Float32Array([-1,-1,0,0,0,1,-1,0,1,0,-1,1,0,0,1,1,1,0,1,1]);this._quadVAO=new z(d,B.Default3D,{geometry:D.Pos3Tex},{geometry:v.createVertex(d,35044,f)})}this._testPatternMat.setColor([c[0],c[1],c[2],1]);this._testPatternMat.bind(d,this._testPatternBindParams);this._testPatternMat.bindView(d,this._testPatternBindParams);
d.bindVAO(this._quadVAO);d.drawArrays(5,0,r.vertexCount(this._quadVAO,"geometry"));this._testPatternMat.release(d)};a.prototype.getOrigin=function(a,b){var c=0;b=10*b/1E4;1<b&&(c=Math.ceil(d.logWithBase(b,2)));b=1E4*Math.pow(2,c);var f=Math.round(a[0]/b),k=Math.round(a[1]/b);a=Math.round(a[2]/b);var c=c+"_"+f+"_"+k+"_"+a,m=this._id2origin[c];null==m&&(m={vec3:I.createFrom(f*b,k*b,a*b),id:c},this._id2origin[c]=m);return m};return a}();var K=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],J=new a;return w})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("require exports ./IntervalUtilities ./ModelDirtyTypesTs ./Float32ArrayList ./InstanceBufferData ../lighting/SceneLighting ../materials/internal/SimpleGLMaterial ./LinearDepthTextureHelper ./NormalTextureHelper ./HighlightTextureHelper ./RenderPass ./RenderSlot ./RenderContext ./ExternalRendererContainer ./StencilRenderingHelper ./Util ./gl-matrix ./ComponentUtils ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Util ./FxaaRenderPass ./SmaaRenderPass ../../../webgl/enums ./DefaultVertexAttributeLocations ../../../webgl/Profiling ../materials/HUDMaterial".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c,D,B,I,G,H,K,J,P,O,L){var M=C.assert,R=C.objectEmpty,Q=C.getFirstObjectValue,T=C.setMatrixTranslation3;w=E.vec2d;var A=E.vec4d,V=E.mat4d,S=C.VertexAttrConstants,h=V.identity();C=function(){function a(a,b,c,d,f){this._lighting=new q.SceneLighting;this._mat2dataMerged={};this._mat2dataInstanced={};this._renderOrder=[];this._externalRenderers=new r;this._renderContext=new v;this._framesRendered=0;this._isRendering=!1;this._highlights=[];this._pixelRatio=
1;this._threshold=1535;this._needsRender=!0;this._fallbackDepthStencilTexture=null;this._stats=new e;this.ssaoEnabled=!1;this.renderOptions={antialiasing:"smaa",earlyOcclusionPixelDraw:!1};this._programRep=a;this._materialRep=b;this._textureRep=c;this._orderedRendering=f;this._rctx=d;b=d.gl;this._fxaaPass=new H(d);this._smaaPass=new K(d);this._selectionMaterial=new t(a,A.createFrom(.1,.2,.9,.4),b.EQUAL);this._selectionMaterialLines=new t(a,A.createFrom(.1,.2,.9,.4),b.EQUAL,b.LINES);this._renderContext.lightingData=
this._lighting.getOld();d.setDepthTestEnabled(!0);d.setFaceCullingEnabled(!0);d.setBlendingEnabled(!1);d.setBlendFunctionSeparate(770,771,1,771);this._bindParameters={view:null,proj:null,viewInvTransp:null,nearFar:null,lightingData:null,viewport:null,framebufferTex:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null,instanceParameters:null,depthFBO:null,normalFBO:null,extensions:{angleInstancedArrays:d.extensions.angleInstancedArrays}};this._linearDepthTextureHelper=new m(d);this._normalTextureHelper=
new k(d);this._highlightTextureHelper=new p(d);this._stencilRenderingHelper=new u(d);this._initializeFramebufferTexture()}a.prototype._initializeFramebufferTexture=function(){var a=this._rctx.gl,a=this._rctx.contextAttributes.alpha?a.RGBA:a.RGB,b=new D(this._rctx,{target:3553,pixelFormat:a,dataType:5121,samplingMode:9728,wrapMode:33071,width:4,height:4});this._framebuffer={format:a,texture:b}};a.prototype.dispose=function(){for(var a in this._mat2dataMerged){this._releaseMaterials(a);var b=this._mat2dataMerged[a],
c;for(c in b.origin2data)b.origin2data[c].vao.dispose(!0)}this._mat2dataMerged=null;for(a in this._mat2dataInstanced)for(c in this._releaseMaterials(a),b=this._mat2dataInstanced[a],b.origin2data)b.origin2data[c].vao.dispose(!0);this._mat2dataInstanced=null;this._framebuffer.texture.dispose();this._framebuffer.texture=null;this._linearDepthTextureHelper.getEnableState()&&this._linearDepthTextureHelper.disable();this._normalTextureHelper.getEnableState()&&this._normalTextureHelper.disable();this._highlightTextureHelper.getEnableState()&&
this._highlightTextureHelper.setEnableState(!1);this._stencilRenderingHelper.getEnableState()&&this._stencilRenderingHelper.setEnableState(!1);this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null)};a.prototype.setLighting=function(a){this._lighting.set(a)};a.prototype.setPixelRatio=function(a){this._pixelRatio=a;this._needsRender=!0};a.prototype.getPixelRatio=function(){return this._pixelRatio};a.prototype.addExternalRenderer=function(a,
b){this._externalRenderers.addRenderer(a,b);return!0};a.prototype.removeExternalRenderer=function(a){this._externalRenderers.removeRenderer(a);return!0};a.prototype.getExternalRenderers=function(){return this._externalRenderers};a.prototype.resetNeedsRender=function(){this._needsRender=!1;this._externalRenderers.resetNeedsRender()};a.prototype.needsRender=function(){return this._needsRender||this._externalRenderers.needsRender()};a.prototype.getCombinedStats=function(){this._stats.VBOallocatedSize=
0;this._stats.VBOoptimalSize=0;this._stats.VBOusedSize=0;for(var a in this._mat2dataInstanced){var b=this._mat2dataInstanced[a],c;for(c in b.origin2data){var e=b.origin2data[c];this._stats.VBOallocatedSize+=e.buffer.getArray().length;this._stats.VBOusedSize+=e.buffer.getSize();this._stats.VBOoptimalSize+=e.optimalCount}}for(a in this._mat2dataMerged)for(c in b=this._mat2dataMerged[a],b.origin2data)e=b.origin2data[c],this._stats.VBOallocatedSize+=e.buffer.getArray().length,this._stats.VBOusedSize+=
e.buffer.getSize(),this._stats.VBOoptimalSize+=e.optimalCount;this._stats.VBOallocatedSize*=.00390625;this._stats.VBOusedSize*=.00390625;this._stats.VBOoptimalSize*=.00390625;return this._stats};a.prototype._addHighlight=function(a){var b=this._getInstance(a,!0)||this._getInstance(a,!1);if(null===b)console.error("No instance found for RenderGeometry {name: '"+a.name+"', uniqueName: '"+a.uniqueName+"'}");else if(this._highlights.push(b),this._orderedRendering&&this._sortHighlightsByRenderOrder(),this._needsRender=
!0,this.onHasHighlightsChanged)this.onHasHighlightsChanged(this.hasHighlights)};a.prototype._removeHighlight=function(a){var b=this._highlights.length;this._highlights=this._highlights.filter(function(b){return b.uniqueName!==a.uniqueName});if(b!==this._highlights.length){if(this.onHasHighlightsChanged)this.onHasHighlightsChanged(this.hasHighlights);this._needsRender=!0}};Object.defineProperty(a.prototype,"hasHighlights",{get:function(){return 0<this._highlights.length},enumerable:!0,configurable:!0});
a.prototype._renderHUDVisibility=function(a){var b=this,c=L.shouldRenderVisibilityDuringRenderPass(a.pass),e=a.offscreenRenderingHelper&&a.offscreenRenderingHelper.getEnableState();c&&e&&a.offscreenRenderingHelper.renderHUDVisibility(function(){b._renderInternalSlot(z.OCCLUSION_PIXELS,a)})};a.prototype.renderGeometrySlots=function(a){this._externalRenderers.render(z.INTERNAL_MATERIAL,a);this._renderInternalSlot(z.STENCIL_MATERIAL,a);this._externalRenderers.render(z.OPAQUE_TERRAIN,a);this._renderInternalSlot(z.OPAQUE_MATERIAL,
a);this._externalRenderers.render(z.OPAQUE_EXTERNAL,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep);this._renderInternalSlot(z.TRANSPARENT_MATERIAL,a);this.renderOptions.earlyOcclusionPixelDraw&&(this._renderHUDVisibility(a),this._renderInternalSlot(z.LINE_CALLOUTS,this._renderContext));this._externalRenderers.render(z.TRANSPARENT_EXTERNAL,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep);this._externalRenderers.render(z.TRANSPARENT_TERRAIN,a)};a.prototype._renderHighlights=function(a,
b,c){var e=!!c&&c.getEnableState()&&(this.hasHighlights||this._externalRenderers.needsHighlight());this._highlightTextureHelper.setEnableState(e);if(e){e=null;c.profilingCallback&&(e=O.startMeasurement(this._renderContext.rctx));this._highlightTextureHelper.setupFBOs(a);this._highlightTextureHelper.prepareHighlightPass();this.renderGeometryPass(x.MATERIAL_HIGHLIGHT,a,null,null);this._rctx.clear(this._rctx.gl.DEPTH_BUFFER_BIT);this._renderInternalSlot(z.LINE_CALLOUTS_HUD_DEPTH,this._renderContext);
this._renderInternalSlot(z.HUDMATERIAL1,this._renderContext);this._renderInternalSlot(z.HUDMATERIAL2,this._renderContext);this._highlightTextureHelper.finish(b);var d=this._highlightTextureHelper.getHighlightFBO();c.render(a,b,d);null!==e&&c.profilingCallback&&e.stop(function(a){c.profilingCallback&&c.profilingCallback(a)})}};a.prototype._renderUnordered=function(a,b,c,e,d,f){var g=this._rctx;this._isRendering=!0;this._stats.reset();this._updateGlobalUniforms(a.projectionMatrix);this._renderContext.pass=
x.MATERIAL;this._renderContext.camera=a;this._renderContext.shadowMap=b;this._renderContext.ssaoHelper=c;this._renderContext.offscreenRenderingHelper=d;this._renderContext.stencilRenderingHelper=this._stencilRenderingHelper;this._renderContext.depth=this._linearDepthTextureHelper.getDepthFBO();this._renderContext.normals=this._normalTextureHelper.getNormalFBO();this._renderContext.highlight=this._highlightTextureHelper.getHighlightFBO();this._renderContext.options=this.renderOptions;this._renderContext.rctx=
this._rctx;this._renderContext.lightingData=this._lighting.getOld();d.setEnableState(!0);d.initializeFrame(a);this._externalRenderers.render(z.BACKGROUND,this._renderContext);this.renderGeometrySlots(this._renderContext);this._externalRenderers.render(z.POSTPROCESSING_ATMOSPHERE,this._renderContext);this.renderOptions.earlyOcclusionPixelDraw||(this._renderHUDVisibility(this._renderContext),this._renderInternalSlot(z.LINE_CALLOUTS,this._renderContext));switch(this.renderOptions.antialiasing){case "none":b=
a.viewport;b=V.ortho(b[0],b[2],b[1],b[3],-1,1);d.drawQuad(b);this._fxaaPass.disable();this._smaaPass.disable();break;case "fxaa":this._smaaPass.disable();this._fxaaPass.render({colorTexture:d.getColorTexture()},null);break;case "smaa":this._fxaaPass.disable(),this._smaaPass.render({colorTexture:d.getColorTexture()},null)}g.bindFramebuffer(null);this._renderContext.framebufferTex=d.getColorTexture();this._renderInternalSlot(z.LINE_CALLOUTS_HUD_DEPTH,this._renderContext);this._renderInternalSlot(z.HUDMATERIAL1,
this._renderContext);this._renderInternalSlot(z.HUDMATERIAL2,this._renderContext);this._renderHighlights(a,e,f);this._framesRendered++;this._isRendering=!1};a.prototype._renderGeometryPassOrderedHighlight=function(a){this._renderInternalHighlights(this._highlights)};a.prototype._renderGeometryPassOrderedMaterial=function(a){for(var b=null,c=0;c<this._renderOrder.length;c++){var e=this._renderOrder[c][1];if(e.instanced){var d=e.instanced||e.merged,f=d[a.pass];!f||f.isVisible&&!f.isVisible()||(this._renderInternalInstanced(d,
f,this._bindParameters,Infinity),b=null)}e.merged&&(d=e.merged,!(f=d[a.pass])||f.isVisible&&!f.isVisible()||(e=f.getProgram(),e!==b&&(e.setUniformMatrix4fv("model",h),e.hasUniform("modelNormal")&&e.setUniformMatrix4fv("modelNormal",h)),b=e,this._renderInternalMerged(d,f,this._bindParameters,Infinity)))}};a.prototype._renderGeometryPassOrdered=function(a){var b=a.camera;this._bindParameters.view=b.viewMatrix;this._bindParameters.proj=b.projectionMatrix;this._bindParameters.viewInvTransp=b.viewInverseTransposeMatrix;
n[0]=b.near;n[1]=b.far;this._bindParameters.nearFar=n;this._bindParameters.lightingData=this._lighting.getOld();this._bindParameters.viewport=b.fullViewport;this._bindParameters.framebufferTex=this._framebuffer.texture;this._bindParameters.pixelRatio=this._pixelRatio;this._bindParameters.instanceParameters=void 0;this._bindParameters.depthFBO=this._linearDepthTextureHelper.getDepthFBO();this._bindParameters.normalFBO=this._normalTextureHelper.getNormalFBO();a.isHighlightPass?this._renderGeometryPassOrderedHighlight(a):
this._renderGeometryPassOrderedMaterial(a)};a.prototype._renderOrdered=function(a,b){this._stats.reset();this.renderGeometryPass(a,b);this._framesRendered++};a.prototype.render=function(a,b,c,e,d,f){this._orderedRendering?this._renderOrdered(x.MATERIAL,a):this._renderUnordered(a,b,c,e,f,d)};a.prototype.renderAuxiliaryBuffers=function(a,b,c,e,d){d=this.ssaoEnabled;this._linearDepthTextureHelper.setEnableState(d);d&&(this._linearDepthTextureHelper.setupFBOs(a),this._linearDepthTextureHelper.prepareDepthPass(),
this.renderGeometryPass(x.MATERIAL_DEPTH,a,b,c),this._linearDepthTextureHelper.finish(e));this._normalTextureHelper.setEnableState(this.ssaoEnabled);this.ssaoEnabled&&(this._normalTextureHelper.setupFBOs(a),this._normalTextureHelper.prepareNormalPass(),this.renderGeometryPass(x.MATERIAL_NORMAL,a,b,c),this._normalTextureHelper.finish(e));this.ssaoEnabled&&c.computeSSAO(a,e,this._linearDepthTextureHelper.getDepthFBO(),this._normalTextureHelper.getNormalFBO());c.bindAll(this._programRep)};a.prototype.renderGeometryPass=
function(a,b,c,e){this._isRendering=!0;this._updateGlobalUniforms(b.projectionMatrix);this._renderContext.pass=a;this._renderContext.camera=b;this._renderContext.shadowMap=c;this._renderContext.ssaoHelper=e;this._renderContext.depth=this._linearDepthTextureHelper.getDepthFBO();this._renderContext.normals=this._normalTextureHelper.getNormalFBO();this._renderContext.rctx=this._rctx;this._orderedRendering?this._renderGeometryPassOrdered(this._renderContext):this._renderGeometryPassUnordered(this._renderContext);
this._isRendering=!1};a.prototype._renderGeometryPassUnordered=function(a){this.renderGeometrySlots(a)};a.prototype._renderInternalHighlights=function(a,b){void 0===b&&(b=null);for(var c=0;c<a.length;++c){var e=a[c],d=e.matData[x.MATERIAL_HIGHLIGHT];!d||null!==b&&!d.beginSlot(b)||d.isVisible&&!d.isVisible()||this._renderInternalHighlight(e,this._bindParameters,x.MATERIAL_HIGHLIGHT)}};a.prototype._renderInternalSlotMaterial=function(a,b){for(var c in this._mat2dataInstanced){var e=this._mat2dataInstanced[c],
d=e[b.pass];d&&d.beginSlot(a)&&(!d.isVisible||d.isVisible())&&this._renderInternalInstanced(e,d,this._bindParameters,a)}for(var e=this._programRep.getProgramsUsingUniform("model"),d=this._programRep.getProgramsUsingUniform("modelNormal"),f=0;f<e.length;f++){var g=e[f];g.setUniformMatrix4fv("model",h);-1<d.indexOf(g)&&g.setUniformMatrix4fv("modelNormal",h)}for(c in this._mat2dataMerged)e=this._mat2dataMerged[c],(d=e[b.pass])&&d.beginSlot(a)&&(!d.isVisible||d.isVisible())&&this._renderInternalMerged(e,
d,this._bindParameters,a);a===z.STENCIL_MATERIAL&&this._stencilRenderingHelper.finish()};a.prototype._renderInternalSlotHighlights=function(a,b){this._renderInternalHighlights(this._highlights,a)};a.prototype._renderInternalSlot=function(a,b){this._bindParameters.view=b.camera.viewMatrix;this._bindParameters.proj=b.camera.projectionMatrix;this._bindParameters.viewInvTransp=b.camera.viewInverseTransposeMatrix;this._bindParameters.cameraAboveGround=b.camera.aboveGround;this._bindParameters.fovY=b.camera.fovY;
this._bindParameters.poiDistance=b.camera.distance;n[0]=b.camera.near;n[1]=b.camera.far;var c=this._renderContext.offscreenRenderingHelper;this._bindParameters.nearFar=n;this._bindParameters.lightingData=this._lighting.getOld();this._bindParameters.viewport=b.camera.fullViewport;this._bindParameters.framebufferTex=c?c.getColorTexture():null;this._bindParameters.shadowMap=b.shadowMap;this._bindParameters.shadowMappingEnabled=!!b.shadowMap&&b.shadowMap.getEnableState();this._bindParameters.ssaoEnabled=
!!b.ssaoHelper&&b.ssaoHelper.getEnableState();this._bindParameters.pixelRatio=this._pixelRatio;this._bindParameters.instanceParameters=void 0;this._bindParameters.depthFBO=this._linearDepthTextureHelper.getDepthFBO();this._bindParameters.hudVisibilityTexture=c?c.getHUDVisibilityTexture():null;b.isHighlightPass?this._renderInternalSlotHighlights(a,b):this._renderInternalSlotMaterial(a,b)};a.prototype._renderInternalInstanced=function(a,b,c,e){var d=this._rctx,f=d.gl,g=!1,h=b.getDrawMode(d),k=this._bindParameters.extensions.angleInstancedArrays,
m;for(m in a.origin2data){var p=a.origin2data[m];c.origin=p.origin;e===z.STENCIL_MATERIAL&&(this._stencilRenderingHelper.setEnableState(!0),this._stencilRenderingHelper.prepareStencilWritePass());var n=!1;if(b.instanced)for(var r in p.perGeometryDataInfo){var q=p.perGeometryDataInfo[r];g||(b.bind(d,c),g=!0);d.bindVAO(q.vao);var u=b.getProgram();G.assertCompatibleVertexAttributeLocations(q.vao,u);n||(b.bindView(d,c),n=!0);var u=q.to-q.from,v=q.refCount;h===f.TRIANGLES&&(this._stats.trianglesRendered+=
v*u/3);k.drawArraysInstancedANGLE(h,q.from,u,v);this._stats.drawCallsAngleInstanced++;this._stats.instancesDrawnAngle+=v}else{var q=p.instances,l;for(l in q)u=q[l],v=u.displayedIndexRange,v&&0===v.length||(g||(b.bind(d,c),g=!0),n||(d.bindVAO(p.vao),b.bindView(d,c),n=!0),b.bindInstance(d,u),this._stats.drawCallsInstanced++,h===f.TRIANGLES&&(this._stats.trianglesRendered+=(u.to-u.from)/3),v?this._drawArraysFaceRange(v,u.from,h):d.drawArrays(h,u.from,u.to-u.from))}}d.bindVAO(null);g&&b.release(d,c)};
a.prototype._renderInternalHighlight=function(a,b,c){var e=this._rctx,d=e.gl;c=a.matData[c];var f=c.getDrawMode(e),g=a.instance,k=g.highlightedIndexRange,m=this._renderContext.offscreenRenderingHelper,m=(m?m.getDepthTexture():null)||this._getFallbackDepthTexture(),p=c.getProgram(),n=this._bindParameters.extensions.angleInstancedArrays;b.origin=a.originData.origin;if(c.instanced&&"instanced"===a.type){var r=a.instancedVAO;c.bind(e,b);e.bindVAO(r);G.assertCompatibleVertexAttributeLocations(r,p);c.bindView(e,
b);for(a=0;a<k.length;a++){var q=k[a],r=q.range?q.range[0]+g.from:g.from,q=q.range?q.range[1]-q.range[0]+1:g.to-g.from;e.bindTexture(m,5);p.setUniform1i("depthTex",5);p.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]);n.drawArraysInstancedANGLE(f,r,q,1);f===d.TRIANGLES&&(this._stats.trianglesRendered+=1*q/3);this._stats.drawCallsHighlight++}}else if("merged"===a.type||"instanced"===a.type&&!c.instanced)for(r=a.originData.vao,c.bind(e,
b),e.bindVAO(r),c.bindView(e,b),"instanced"===a.type?c.bindInstance(e,g):p.setUniformMatrix4fv("model",h),a=0;a<k.length;a++)q=k[a],r=q.range?q.range[0]+g.from:g.from,q=q.range?q.range[1]-q.range[0]+1:g.to-g.from,e.bindTexture(m,5),c.getProgram().setUniform1i("depthTex",5),p.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]),e.drawArrays(f,r,q),f===d.TRIANGLES&&(this._stats.trianglesRendered+=q/3),this._stats.drawCallsHighlight++;else console.error("_renderInternalHighlight: incompatible istance type");
e.bindVAO(null);c.release(e,b)};a.prototype._drawArraysFaceRange=function(a,b,c){for(var e=this._rctx,d=0;d<a.length;d++){var f=a[d];e.drawArrays(c,f[0]+b,f[1]-f[0]+1)}this._stats.drawCallsFragmented+=a.length-1};a.prototype._renderInternalMerged=function(a,b,c,e){var d=this._rctx,f=d.gl,g=!1,h;for(h in a.origin2data){var k=a.origin2data[h];c.origin=k.origin;e===z.STENCIL_MATERIAL&&(this._stencilRenderingHelper.setEnableState(!0),this._stencilRenderingHelper.prepareStencilWritePass());if(!k.displayedIndexRange||
0!==k.displayedIndexRange.length){g||(b.bind(d,c),g=!0);var m=b.getProgram();d.bindVAO(k.vao);G.assertCompatibleVertexAttributeLocations(k.vao,m);b.bindView(d,c);this._stats.drawCallsMerged++;m=b.getDrawMode(d);m===f.TRIANGLES&&(this._stats.trianglesRendered+=k.vao.vertexBuffers.geometry.size/3);k.displayedIndexRange?this._drawArraysFaceRange(k.displayedIndexRange,0,m):d.drawArrays(m,0,G.vertexCount(k.vao,"geometry"))}}g&&b.release(d,c)};a.prototype._updateGlobalUniforms=function(a){for(var b=this._programRep.getProgramsUsingUniform("proj"),
c=0;c<b.length;c++)b[c].setUniformMatrix4fv("proj",a);if(this._lighting){b=this._programRep.getProgramsUsingUniform("lightingMainDirection");for(c=0;c<b.length;c++)this._lighting.setUniforms(b[c]);b=this._programRep.getProgramsUsingUniform("lightDirection");for(c=0;c<b.length;c++)this._lighting.setUniforms(b[c])}};a.prototype.print=function(){var a=Object.keys(this._mat2dataMerged).length,b=Object.keys(this._mat2dataInstanced).length;console.log("number of materials (merged/instanced): "+a+"/"+b);
var a=0,c;for(c in this._mat2dataMerged){var b=this._mat2dataMerged[c],e;for(e in b.origin2data)a+=Object.keys(b.origin2data[e].instances).length}var d=0;for(c in this._mat2dataInstanced)for(e in b=this._mat2dataInstanced[c],b.origin2data)d+=Object.keys(b.origin2data[e].instances).length;console.log("number of instances (merged/instanced): "+a+"/"+d)};a.prototype.isEmpty=function(){for(var a in this._mat2dataInstanced){var b=this._mat2dataInstanced[a],c;for(c in b.origin2data)if(!R(b.origin2data[c].instances))return!1}for(a in this._mat2dataMerged)for(c in b=
this._mat2dataMerged[a],b.origin2data)if(!R(b.origin2data[c].instances))return!1;return!0};a.prototype.modify=function(a,b,c,e){this._isRendering&&console.warn("Renderer.modify called while rendering");var d=[],f=[];this._mergedOrInstanced(a,d,f);a=[];var g=[];this._mergedOrInstanced(b,a,g);var h={};c&&this._performUpdates(c,h);c=[];this._modifyMerged(d,a,c,h);this._modifyInstanced(f,g,c);this._updateMergedFaceranges(h);this._releaseMaterials(c);d=this._highlights.length;if(b&&0<b.length&&0<d&&(this._highlights=
this._highlights.filter(function(a){return!b.some(function(b){return b.uniqueName===a.uniqueName})}),d!==this._highlights.length&&this.onHasHighlightsChanged))this.onHasHighlightsChanged(this.hasHighlights);this._updateHighlightVAOs();this._modifyMaterials(e);this._needsRender=!0};a.prototype._isInstanced=function(a){var b=!1,c=Q(a.data.faces.indices).length,b=(b=(b=b||!1===a.material.canBeMerged)||a.material.instanced)||a.material.isBackdrop;return a.singleUse?b:b=b||c>this._threshold};a.prototype._mergedOrInstanced=
function(a,b,c){for(var e=0;e<a.length;++e)1>Q(a[e].data.faces.indices).length||(this._isInstanced(a[e])?c.push(a[e]):b.push(a[e]))};a.prototype._performUpdates=function(a,b){for(var c=0;c<a.length;c++){var e=a[c],d=e.renderGeometry,f=this._isInstanced(d),e=e.updateType;e&2&&this._updateFaceranges(d,f,b);if(e&32){var g=this._getInstance(d,f);g&&this._updateHighlightFaceranges(d,g.instance)}e&4||!f&&e&16?this._updateVertexAttributes(d,f):f&&e&16?this._updateInstanceTransformation(d,f):e&8&&this._updateColorAttributes(d)}};
a.prototype._updateFaceranges=function(a,b,e){var d=a.material.getId(),f=a.origin.id,g=(b?this._mat2dataInstanced:this._mat2dataMerged)[d].origin2data[f],h=g.instances[a.uniqueName];h&&(h.displayedIndexRange=c.generateVisibleIndexRanges(a.instanceParameters.componentVisibilities,a.componentOffsets),b||(e[this._modifiedMergedFacerangesKey(d,f)]=g),this._updateHighlightFaceranges(a,h))};a.prototype._updateHighlightFaceranges=function(a,b){if(b){var e=b.highlightedIndexRange,d;d=c.generateHighlightedIndexRanges(a.instanceParameters.componentVisibilities,
a.instanceParameters.componentHighlights,a.componentOffsets);(b.highlightedIndexRange=d)&&!e?this._addHighlight(a):!d&&e&&this._removeHighlight(a)}};a.prototype._updateMergedFaceranges=function(a){for(var b in a){var c=a[b];c.displayedIndexRange=[];var e=c.instances,d=!0,g;for(g in e){var h=e[g];h.displayedIndexRange?(c.displayedIndexRange.push.apply(c.displayedIndexRange,f.offsetIntervals(h.displayedIndexRange,h.from)),d=!1):c.displayedIndexRange.push([h.from,h.to-1])}c.displayedIndexRange=d?null:
f.mergeIntervals(c.displayedIndexRange)}};a.prototype._updateVertexAttributes=function(a,b){var c=a.material,e=c.getId(),e=(b?this._mat2dataInstanced:this._mat2dataMerged)[e].origin2data[a.origin.id],d=e.instances[a.uniqueName],f,g;b||(f=a.origin.vec3,T(y,-f[0],-f[1],-f[2]),V.multiply(y,a.transformation,F),V.inverse(F,N),V.transpose(N),f=F,g=N);b=G.getStride(c.getVertexBufferLayout());var h=b/4;M(d.from+c.getOutputAmount(Q(a.data.faces.indices).length)/h===d.to,"material VBO layout has changed");
c.fillInterleaved(a.data,f,g,a.instanceParameters,e.buffer.getArray(),d.from*h);e.vao.vertexBuffers.geometry.setSubData(e.buffer.getArray(),d.from*b,d.from*b,d.to*b)};a.prototype._updateInstanceTransformation=function(a,b){var c=a.origin.vec3,e=(b?this._mat2dataInstanced:this._mat2dataMerged)[a.material.getId()].origin2data[a.origin.id];b=e.instances[a.uniqueName];T(y,-c[0],-c[1],-c[2]);V.multiply(y,a.transformation,b.transformation);V.inverse(b.transformation,b.transformationNormal);V.transpose(b.transformationNormal,
b.transformationNormal);c=e.perGeometryDataInfo[a.data.id];if(e=c.instanceBufferData)a=e.getSlot(a.idx),e.fill(a,0,b.transformation),e.fill(a,16,b.transformationNormal),a=4*e.getOffset(a),b=G.getStride(c.vao.layout.instance),c.vao.vertexBuffers.instance.setSubData(e.getArray(),a,a,a+b)};a.prototype._updateColorAttributes=function(a){var b=a.material,c=b.getId(),e=a.origin.id,c=(this._isInstanced(a)?this._mat2dataInstanced:this._mat2dataMerged)[c].origin2data[e],e=c.instances[a.uniqueName],d=(f={},
f[S.COLOR]=!0,f[S.SYMBOLCOLOR]=!0,f),f=G.getStride(b.getVertexBufferLayout())/4;M(e.from+b.getOutputAmount(Q(a.data.faces.indices).length)/f===e.to,"material VBO layout has changed");b.fillInterleaved(a.data,void 0,void 0,a.instanceParameters,c.buffer.getArray(),e.from*f,d);c.vao.vertexBuffers.geometry.setSubData(c.buffer.getArray(),e.from*f*4,e.from*f*4,e.to*f*4);var f};a.prototype._modifyMerged=function(a,b,e,f){var h=this._rctx;a=this._compMat2delta(a,b,!1);for(var k in a){b=a[k];for(var m in b){var p=
b[m],n=p.optimalCount,r=p.material,q=r.getVertexBufferLayout(),u=G.getStride(q)/4,v=this._mat2dataMerged[k];if(null==v){M(0<n);var l=r.getRenderPriority(),v={origin2data:{}};v[x.MATERIAL]=this._materialRep.aquire(r);v[x.MATERIAL_DEPTH_SHADOWMAP]=this._materialRep.aquireDepthShadowMap(r);v[x.MATERIAL_NORMAL]=this._materialRep.aquireNormal(r);v[x.MATERIAL_DEPTH]=this._materialRep.aquireDepth(r);v[x.MATERIAL_HIGHLIGHT]=this._materialRep.aquireHighlight(r);this._mat2dataMerged[k]=v;this._orderedRendering&&
this._insertIntoRenderOrder(v,l,"merged")}l=v.origin2data[m];null==l&&(M(0<n),l={instances:{},vao:new B(h,P.Default3D,{geometry:q},{geometry:I.createVertex(h,35044)}),buffer:new d(n),optimalCount:0,origin:p.origin},v.origin2data[m]=l);if(0<n){var q=l.buffer.getSize(),t=l.buffer.getArray(),v=n<p.sparseCount/2,z=l.buffer.resize(v?n:p.sparseCount),C=p.toRemove;if(v||z){for(var q=0,E=l.buffer.getArray(),v=0;v<C.length;++v)z=l.instances[C[v].uniqueName],l.optimalCount-=(z.to-z.from)*u,delete l.instances[C[v].uniqueName];
var v={},D;for(D in l.instances)z=l.instances[D],M(null==v[z.from]),v[z.from]=z;for(var H in v){var z=v[H],w=z.from*u,A=z.to*u;E.set(t.subarray(w,A),q);z.from=q/u;q+=A-w;z.to=q/u}M(q===l.optimalCount)}else for(v=0;v<C.length;++v)z=C[v].uniqueName,M(void 0!==l.instances[z]),w=l.instances[z].from*u,A=l.instances[z].to*u,l.buffer.erase(w,A),delete l.instances[z],l.optimalCount-=A-w;T(y,-p.origin[0],-p.origin[1],-p.origin[2]);t=p.toAdd;p=!1;for(v=0;v<t.length;++v)C=t[v],w=C.data,V.multiply(y,C.transformation,
F),V.inverse(F,N),V.transpose(N),z=q,r.fillInterleaved(w,F,N,C.instanceParameters,l.buffer.getArray(),q),w=r.getOutputAmount(Q(w.faces.indices).length),E=z+w,M(null==l.instances[C.uniqueName]),A=c.generateVisibleIndexRanges(C.instanceParameters.componentVisibilities,C.componentOffsets),z=new g(C.name,z/u,E/u,A,void 0,void 0,C.idx),l.instances[C.uniqueName]=z,this._updateHighlightFaceranges(C,z),A&&(p=!0),l.optimalCount+=w,q+=w;M(l.optimalCount===n);n=new Float32Array(l.buffer.getArray().buffer,0,
l.buffer.getSize());l.vao.vertexBuffers.geometry.setData(n);if(p||l.displayedIndexRange)f[this._modifiedMergedFacerangesKey(k,m)]=l}else M(0===n),l.vao.dispose(!0),l.vao=null,delete v.origin2data[m],0===Object.keys(v.origin2data).length&&(e.push(k),delete this._mat2dataMerged[k],this._orderedRendering&&this._removeFromRenderOrder(v,"merged"))}}};a.prototype._modifyInstanced=function(a,e,f){a=this._compMat2delta(a,e,!0);e=this._rctx;for(var h in a){var k=a[h],m;for(m in k){var p=k[m];if(0===p.optimalCount)p=
this._mat2dataInstanced[h],p.origin2data[m].vao.dispose(!0),delete p.origin2data[m],0===Object.keys(p.origin2data).length&&(f.push(h),delete this._mat2dataInstanced[h],this._orderedRendering&&this._removeFromRenderOrder(p,"instanced"));else{var n=p.material,r=this._mat2dataInstanced[h];if(null==r){var q=n.getRenderPriority(),r={origin2data:{}};r[x.MATERIAL]=this._materialRep.aquire(n);r[x.MATERIAL_DEPTH_SHADOWMAP]=this._materialRep.aquireDepthShadowMap(n);r[x.MATERIAL_NORMAL]=this._materialRep.aquireNormal(n);
r[x.MATERIAL_DEPTH]=this._materialRep.aquireDepth(n);r[x.MATERIAL_HIGHLIGHT]=this._materialRep.aquireHighlight(n);this._mat2dataInstanced[h]=r;this._orderedRendering&&this._insertIntoRenderOrder(r,q,"instanced")}var u=n.getVertexBufferLayout(),v=r[x.MATERIAL].instanced?n.getInstanceBufferLayout():void 0,l=v&&G.findAttribute(v,"instanceColor"),t=v&&G.findAttribute(v,"instanceFeatureAttribute"),z=G.getStride(u)/4,q=r.origin2data[m];null==q&&(q={instances:{},vao:new B(e,P.Default3D,{geometry:u},{geometry:I.createVertex(e,
35044)}),buffer:new d(p.optimalCount),optimalCount:0,perGeometryDataInfo:{},origin:p.origin},r.origin2data[m]=q);var r=q.buffer.getSize(),C=q.buffer.getArray(),E=p.optimalCount<p.sparseCount/2,D=q.buffer.resize(E?p.optimalCount:p.sparseCount),H;for(H in p.perGeometryDelta){var w=q.perGeometryDataInfo[H];if(w&&w.instanceBufferData){var A=p.perGeometryDelta[H].removeCount;0<A&&w.instanceBufferData.prepareFree(A)}}var K=p.toRemove;if(E||D){for(E=0;E<K.length;++E){D=K[E];delete q.instances[D.uniqueName];
H=D.data.id;var J=w=q.perGeometryDataInfo[H];0===--J.refCount&&null==p.dataId2refCount[H]?(q.optimalCount-=(J.to-J.from)*z,delete q.perGeometryDataInfo[H]):w.instanceBufferData&&w.instanceBufferData.free(D.idx)}var r=0,E=q.buffer.getArray(),D={},F;for(F in q.perGeometryDataInfo)J=q.perGeometryDataInfo[F],M(null==D[J.from]),D[J.from]=J;for(var N in D)J=D[N],A=J.from*z,w=J.to*z,E.set(C.subarray(A,w),r),J.from=r/z,r+=w-A,J.to=r/z;for(var L in q.instances)A=q.instances[L],A.from=q.perGeometryDataInfo[A.dataId].from,
A.to=q.perGeometryDataInfo[A.dataId].to}else for(E=0;E<K.length;++E)D=K[E],delete q.instances[D.uniqueName],H=D.data.id,w=q.perGeometryDataInfo[H],0===--w.refCount&&null==p.dataId2refCount[H]?(A=w.from*z,w=w.to*z,q.buffer.erase(A,w),q.optimalCount-=w-A,delete q.perGeometryDataInfo[H]):w.instanceBufferData&&w.instanceBufferData.free(D.idx);T(y,-p.origin[0],-p.origin[1],-p.origin[2]);for(H in p.perGeometryDelta)(w=q.perGeometryDataInfo[H])&&w.instanceBufferData&&(E=p.perGeometryDelta[H].addCount,0<
E&&w.instanceBufferData.prepareAllocate(E));C=p.toAdd;for(E=0;E<C.length;++E)if(D=C[E],A=D.data,H=A.id,w=q.perGeometryDataInfo[H],null==w?(n.fillInterleaved(A,void 0,void 0,void 0,q.buffer.getArray(),r),K=n.getOutputAmount(Q(A.faces.indices).length),A=r/z,r+=K,w=r/z,q.optimalCount+=K,w={refCount:1,from:A,to:w,vao:null,instanceBufferData:null},v&&(A=G.getStride(v)/4,w.vao=new B(e,P.Default3D,{geometry:u,instance:v},{geometry:q.vao.vertexBuffers.geometry,instance:I.createVertex(e,35044)}),w.instanceBufferData=
new b(A,p.perGeometryDelta[H].addCount)),q.perGeometryDataInfo[H]=w):++w.refCount,M(w.from*z<=q.buffer.getSize()&&w.to*z<=q.buffer.getSize()),A=V.create(),V.multiply(y,D.transformation,A),K=c.generateVisibleIndexRanges(D.instanceParameters.componentVisibilities,D.componentOffsets),A=new g(D.name,w.from,w.to,K,A,D.instanceParameters,D.idx,H),q.instances[D.uniqueName]=A,this._updateHighlightFaceranges(D,A),w=w.instanceBufferData)K=w.allocate(D.idx),w.fill(K,0,A.transformation),w.fill(K,16,A.transformationNormal),
l&&w.fill(K,l.offset/4,D.instanceParameters.color),t&&w.fill(K,t.offset/4,D.instanceParameters.featureAttribute);M(q.optimalCount===p.optimalCount);n=new Float32Array(q.buffer.getArray().buffer,0,q.buffer.getSize());q.vao.vertexBuffers.geometry.setData(n);for(H in q.perGeometryDataInfo)if(u=q.perGeometryDataInfo[H],u.vao&&(n=u.vao.vertexBuffers.instance))v=p.perGeometryDelta[H],0<v.addCount+v.removeCount&&(u=u.instanceBufferData.compact(),n.setData(u))}}}};a.prototype._compMat2delta=function(a,b,
c){var e={};this._updateMat2delta(a,!0,c,e);this._updateMat2delta(b,!1,c,e);return e};a.prototype._updateMat2delta=function(a,b,c,e){for(var d=0;d<a.length;++d){var f=a[d],g=f.origin,h=f.material,k=h.getId(),m=c?this._mat2dataInstanced[k]:this._mat2dataMerged[k],m=m&&m.origin2data[g.id],p=e[k];null==p&&(p={},e[k]=p);k=p[g.id];if(null==k){k={optimalCount:null==m?0:m.optimalCount,sparseCount:null==m?0:m.buffer.getSize(),material:h,toAdd:[],toRemove:[],perGeometryDelta:null,origin:g.vec3};if(c){var n=
{};if(void 0!==m)for(var r in m.perGeometryDataInfo)n[r]=m.perGeometryDataInfo[r].refCount;k.dataId2refCount=n;k.perGeometryDelta={}}p[g.id]=k}g=h.getOutputAmount(Q(f.data.faces.indices).length);c?(h=f.data.id,m=k.perGeometryDelta[h],m||(m={addCount:0,removeCount:0},k.perGeometryDelta[h]=m),b?(m.addCount++,null==k.dataId2refCount[h]&&(k.dataId2refCount[h]=0),1===++k.dataId2refCount[h]&&(k.optimalCount+=g,k.sparseCount+=g),k.toAdd.push(f)):(m.removeCount++,0===--k.dataId2refCount[h]&&(delete k.dataId2refCount[h],
k.optimalCount-=g),k.toRemove.push(f))):b?(k.optimalCount+=g,k.sparseCount+=g,k.toAdd.push(f)):(k.optimalCount-=g,k.toRemove.push(f))}};a.prototype._modifiedMergedFacerangesKey=function(a,b){return a+"_"+b};a.prototype._insertIntoRenderOrder=function(a,b,c){for(var e=a[x.MATERIAL].getMaterialId(),d=this._renderOrder.length,f=0;f<d&&this._renderOrder[f][0]>=b;){var g=this._renderOrder[f][1];if(g.id===e){M(!g[c],"matData for type already exists");g[c]=a;return}f++}e={id:e,instanced:null,merged:null};
e[c]=a;this._renderOrder.splice(f,0,[b,e])};a.prototype._removeFromRenderOrder=function(a,b){var c=a[x.MATERIAL].getMaterialId();for(a=0;this._renderOrder[a][1].id!==c;)a++;c=this._renderOrder[a][1];c[b]=null;c.instanced||c.merged||this._renderOrder.splice(a,1)};a.prototype._sortHighlightsByRenderOrder=function(){this._highlights.sort(function(a,b){a=a.matData[x.MATERIAL].getRenderPriority();b=b.matData[x.MATERIAL].getRenderPriority();return a>b?-1:b>a?1:0})};a.prototype._updateRenderOrder=function(a,
b){for(var c=b.length,e=0;e<c&&b[e][1].id!==a;)e++;if(e<c){a=b[e][1];a=(a.merged||a.instanced)[x.MATERIAL].getRenderPriority();var d=b[e][0];if(a!==b[e][0])for(b[e][0]=a,d=a>d?-1:1,e+=d;-1<e&&e<c&&d*b[e][0]>d*a;){var f=b[e];b[e]=b[e-d];b[e-d]=f;e+=d}}};a.prototype._modifyMaterials=function(a){for(var b in a)this._materialRep.updateMaterialParameters(b)};a.prototype.modifyRenderOrder=function(a){if(this._orderedRendering){for(var b in a)this._updateRenderOrder(b,this._renderOrder);this._sortHighlightsByRenderOrder();
this._needsRender=!0}};a.prototype._releaseMaterials=function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++)this._materialRep.release(a[b]),this._materialRep.releaseDepthShadowMap(a[b]),this._materialRep.releaseNormal(a[b]),this._materialRep.releaseDepth(a[b]),this._materialRep.releaseHighlight(a[b]);else this._materialRep.release(a),this._materialRep.releaseDepthShadowMap(a),this._materialRep.releaseNormal(a),this._materialRep.releaseDepth(a),this._materialRep.releaseHighlight(a)};a.prototype._getInstance=
function(a,b){var c=a.material.getId(),c=(b?this._mat2dataInstanced:this._mat2dataMerged)[c];if(!c)return null;var e=c.origin2data[a.origin.id];if(!e)return null;var d=e.instances[a.uniqueName];return d?{uniqueName:a.uniqueName,instance:d,matData:c,originData:e,type:b?"instanced":"merged",instancedVAO:null,instancedVAOBaseInstance:null}:null};a.prototype._createBaseInstanceVAO=function(a){var b=this._rctx,c=a.instance;if("instanced"===a.type&&a.originData.perGeometryDataInfo){var e=a.originData.perGeometryDataInfo[c.dataId],
d=e.instanceBufferData;d&&(e=e.vao,c=d.getSlot(c.idx),a.instancedVAOBaseInstance!==c&&(d=G.setBaseInstanceOffset(e.layout,c),a.instancedVAO=new B(b,e.locations,d,e.vertexBuffers,e.indexBuffer),a.instancedVAOBaseInstance=c))}};a.prototype._updateHighlightVAOs=function(){for(var a=0;a<this._highlights.length;++a)this._createBaseInstanceVAO(this._highlights[a])};a.prototype._getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new D(this._rctx,{target:3553,
pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255])));return this._fallbackDepthStencilTexture};return a}();var e=function(){function a(){this.reset()}a.prototype.reset=function(){this.VBOusedSize=this.VBOoptimalSize=this.VBOallocatedSize=this.instancesDrawnAngle=this.drawCallsHighlight=this.drawCallsFragmented=this.drawCallsMerged=this.drawCallsAngleInstanced=this.drawCallsInstanced=this.trianglesRendered=0};return a}(),g=function(){return function(a,
b,c,e,d,f,g,h){this.name=a;this.from=b;this.to=c;this.displayedIndexRange=e;this.transformation=d;this.instanceParameters=f;this.idx=g;this.dataId=h;null!=d&&(this.transformationNormal=V.create(),V.set(d,this.transformationNormal),V.inverse(this.transformationNormal,this.transformationNormal),V.transpose(this.transformationNormal,this.transformationNormal))}}(),n=w.create(),y=V.identity(),F=V.create(),N=V.create();return C})},"esri/views/3d/webgl-engine/lib/IntervalUtilities":function(){define(["require",
"exports"],function(w,l){return function(){function f(){}f.copyIntervals=function(a){for(var d=[],b=0;b<a.length;b++){var f=a[b];d.push([f[0],f[1]])}return d};f.convertFaceToIndexRange=function(a,d){for(var b=0;b<a.length;b++){var f=a[b];f[0]*=d;f[1]=f[1]*d+(d-1)}};f.sortIntervals=function(a){return a.sort(function(a,b){return a[0]===b[0]?a[1]>b[1]?1:a[1]<b[1]?-1:0:a[0]>b[0]?1:a[0]<b[0]?-1:0})};f.intersectIntervals=function(a,d){if(0>=a.length)return[];for(var b=[],f=0;f<a.length;f++){var l=a[f];
l[1]<d[0]||l[0]>d[1]||(l=[l[0],l[1]],l[0]<d[0]&&(l[0]=d[0]),l[1]>d[1]&&(l[1]=d[1]),b.push(l))}return b};f.mergeIntervals=function(a){if(0>=a.length)return[];var d=[];a=this.sortIntervals(a);d.push(a[0]);for(var b=1;b<a.length;b++){var f=d[d.length-1];f[1]+1<a[b][0]?d.push(a[b]):f[1]<a[b][1]&&(f[1]=a[b][1],d.pop(),d.push(f))}return d};f.invertIntervals=function(a,d){for(var b=[],f=0,l=0;l<a.length;l++){var m=a[l];m[0]>f&&b.push([f,m[0]-1]);f=m[1]+1}f<=d&&b.push([f,d]);return b};f.offsetIntervals=function(a,
d){for(var b=[],f=0;f<a.length;f++){var l=a[f];b.push([l[0]+d,l[1]+d])}return b};return f}()})},"esri/views/3d/webgl-engine/lib/Float32ArrayList":function(){define(["require","exports","./Util"],function(w,l,f){return function(){function a(a){null==a?a=16:65536>a&&(a=f.nextHighestPowerOfTwo(a));this.array=new Float32Array(a);this.size=0}a.prototype.resize=function(a,b){void 0===b&&(b=!1);this.size=a;var d;if(this.size>this.array.length){for(a=this.array.length||1;a<this.size;)a*=2;d=new Float32Array(a);
b&&d.set(this.array);this.array=d;return!0}if(this.size<=this.array.length/2){a=this.array.length;for(d=2*this.size;a>=d;)a=Math.floor(a/2);d=new Float32Array(a);b&&d.set(this.array.subarray(0,a));this.array=d;return!0}return!1};a.prototype.append=function(a){var b=this.size;this.resize(this.size+a.length,!0);this.array.set(a,b)};a.prototype.erase=function(a,b){for(;a<b;++a)this.array[a]=0};a.prototype.getArray=function(){return this.array};a.prototype.getSize=function(){return this.size};return a}()})},
"esri/views/3d/webgl-engine/lib/InstanceBufferData":function(){define(["require","exports","./Util"],function(w,l,f){return function(){function a(a,b){null==b&&(b=4);var d=f.nextHighestPowerOfTwo(b*a);this.array=new Float32Array(d);this.zeroItem=new Float32Array(a);this.endSlot=0;this.perInstanceDataSize=a;this.emptySlots=[];this.emptySlotsIdx=0;this.id2slot={};this.slot2id=Array(b)}a.prototype.prepareFree=function(a){this.emptySlots.length+=a};a.prototype.free=function(a){a=this.id2slot[a];null!=
a&&(this.emptySlots[this.emptySlotsIdx++]=a,this.slot2id[a]=void 0)};a.prototype.prepareAllocate=function(a){a-=this.emptySlotsIdx;0<a&&this._resizeArray((this.endSlot+a)*this.perInstanceDataSize)};a.prototype.allocate=function(a){var b;b=0<this.emptySlotsIdx?this.emptySlots[--this.emptySlotsIdx]:this.endSlot++;this.id2slot[a]=b;this.slot2id[b]=a;return b};a.prototype.getSlot=function(a){return this.id2slot[a]};a.prototype.getOffset=function(a){return a*this.perInstanceDataSize};a.prototype.getArray=
function(){return this.array};a.prototype.fill=function(a,b,f){this.array.set(f,a*this.perInstanceDataSize+b)};a.prototype.compact=function(){if(0<this.emptySlotsIdx){this.emptySlots.length=this.emptySlotsIdx;for(this.emptySlots.sort(function(a,b){return a-b});0<this.emptySlotsIdx&&this.emptySlots[this.emptySlotsIdx-1]===this.endSlot;)this.emptySlotsIdx--,this.endSlot--;for(;0<this.emptySlotsIdx;){this.emptySlotsIdx--;var a=this.endSlot-1,b=this.emptySlots[this.emptySlotsIdx],f=a*this.perInstanceDataSize,
l=b*this.perInstanceDataSize;this.array.set(this.array.subarray(f,f+this.perInstanceDataSize),l);this.array.set(this.zeroItem,f);f=this.slot2id[a];this.slot2id[a]=void 0;this.slot2id[b]=f;this.id2slot[f]=b;this.endSlot--}}this._resizeArray(this.endSlot*this.perInstanceDataSize);this.emptySlots.length=0;return this.array};a.prototype._resizeArray=function(a){var b;if(a>this.array.length){for(b=this.array.length||1;b<a;)b*=2;a=new Float32Array(b);a.set(this.array);this.array=a}else if(a<=this.array.length/
2){b=this.array.length;for(a*=2;b>=a;)b/=2;a=new Float32Array(b);a.set(this.array.subarray(0,b));this.array=a}};return a}()})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define(["require","exports","./SphericalHarmonics","../../lib/glMatrix"],function(w,l,f,a){Object.defineProperty(l,"__esModule",{value:!0});var d=a.vec3d,b=a.vec4d,q=d.create();w=function(){function a(){this._renderLighting={main:{intensity:d.create(),direction:d.createFrom(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],
g:[0],b:[0]}}};this._shOrder=2;this._oldDirection=d.create();this._oldSpecular=b.create();this._oldDiffuse=b.create();this._oldAmbient=b.create()}a.prototype.setUniforms=function(a,b){void 0===b&&(b=!1);b||a.getDefine("GROUND_NORMAL_SHADING")?a.setUniform1f("lightingFixedFactor",(1-this._info.groundLightingFactor)*(1-this._info.globalFactor)):a.setUniform1f("lightingFixedFactor",0);a.setUniform1f("lightingGlobalFactor",this._info.globalFactor);a.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction);
a.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity);a.setUniform1f("ambientBoostFactor",.4);b=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?a.setUniform3f("lightingAmbientSH0",b.r[0],b.g[0],b.b[0]):1===this._shOrder?(a.setUniform4f("lightingAmbientSH_R",b.r[0],b.r[1],b.r[2],b.r[3]),a.setUniform4f("lightingAmbientSH_G",b.g[0],b.g[1],b.g[2],b.g[3]),a.setUniform4f("lightingAmbientSH_B",b.b[0],b.b[1],b.b[2],b.b[3])):2===this._shOrder&&(a.setUniform3f("lightingAmbientSH0",
b.r[0],b.g[0],b.b[0]),a.setUniform4f("lightingAmbientSH_R1",b.r[1],b.r[2],b.r[3],b.r[4]),a.setUniform4f("lightingAmbientSH_G1",b.g[1],b.g[2],b.g[3],b.g[4]),a.setUniform4f("lightingAmbientSH_B1",b.b[1],b.b[2],b.b[3],b.b[4]),a.setUniform4f("lightingAmbientSH_R2",b.r[5],b.r[6],b.r[7],b.r[8]),a.setUniform4f("lightingAmbientSH_G2",b.g[5],b.g[6],b.g[7],b.g[8]),a.setUniform4f("lightingAmbientSH_B2",b.b[5],b.b[6],b.b[7],b.b[8]));a.setUniform3fv("lightDirection",this._oldDirection)};a.prototype.set=function(a){this._info=
a;f.combineLights(a.lights,this._shOrder,this._renderLighting.main,this._renderLighting.sphericalHarmonics);d.negate(this._renderLighting.main.direction,this._oldDirection);a=1/Math.PI;this._oldAmbient[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*a;this._oldAmbient[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*a;this._oldAmbient[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*a;this._oldAmbient[3]=1;this._oldDiffuse[0]=this._renderLighting.main.intensity[0]*a;
this._oldDiffuse[1]=this._renderLighting.main.intensity[1]*a;this._oldDiffuse[2]=this._renderLighting.main.intensity[2]*a;this._oldDiffuse[3]=1;a=d.set(this._oldDiffuse,q);d.scale(a,.4*this._info.globalFactor);d.add(this._oldAmbient,a)};Object.defineProperty(a.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0});a.prototype.getOld=function(){return{ambient:this._oldAmbient,diffuse:this._oldDiffuse,specular:this._oldSpecular,direction:this._oldDirection,
helper:this}};return a}();l.SceneLighting=w})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("require exports ./Lightsources ../lib/LongVectorMath ../../lib/glMatrix ../../support/mathUtils".split(" "),function(w,l,f,a,d,b){function q(a){return(a+1)*(a+1)}function t(a){return b.clamp(Math.floor(Math.sqrt(a)-1),0,2)}function m(a,b,c){var d=a[0],f=a[1];a=a[2];c=c||[];c.length=q(b);0<=b&&(c[0]=.28209479177);1<=b&&(c[1]=.4886025119*d,c[2]=.4886025119*a,c[3]=.4886025119*f);
2<=b&&(c[4]=1.09254843059*d*f,c[5]=1.09254843059*f*a,c[6]=.31539156525*(3*a*a-1),c[7]=1.09254843059*d*a,c[8]=.54627421529*(d*d-f*f));return c}function k(a,b){a=q(a);b=b||{r:[],g:[],b:[]};b.r.length=b.g.length=b.b.length=a;for(var c=0;c<a;c++)b.r[c]=b.g[c]=b.b[c]=0;return b}function p(b,d){for(var f=t(d.r.length),k=0;k<b.length;k++){var p=b[k];z.negate(p.direction,c);m(c,f,C);a.elementwiseProduct(C,D);a.scalarProduct(C,p.intensity[0],E);a.add(d.r,E);a.scalarProduct(C,p.intensity[1],E);a.add(d.g,E);
a.scalarProduct(C,p.intensity[2],E);a.add(d.b,E)}return d}function x(a,b){m(c,0,C);for(var d=0;d<a.length;d++){var f=a[d];b.r[0]+=C[0]*D[0]*f.intensity[0]*4*Math.PI;b.g[0]+=C[0]*D[0]*f.intensity[1]*4*Math.PI;b.b[0]+=C[0]*D[0]*f.intensity[2]*4*Math.PI}return b}Object.defineProperty(l,"__esModule",{value:!0});var z=d.vec3d;l.numberOfCoefficients=q;l.numberOfCoefficientsInBand=function(a){return 2*a+1};l.orderFromNumberOfCoefficients=t;l.computeCoefficients=m;l.initSHCoefficients=k;l.projectFillLights=
p;l.projectAmbientLights=x;l.combineLights=function(b,c,d,m){k(c,m.sh);z.set3(0,0,0,d.intensity);var q=!1,l=v,t=r;c=u;l.length=0;t.length=0;for(var C=c.length=0;C<b.length;C++){var B=b[C];B instanceof f.MainLight&&!q?(z.set(B.direction,d.direction),d.intensity[0]=B.intensity[0],d.intensity[1]=B.intensity[1],d.intensity[2]=B.intensity[2],d.castShadows=B.castShadows,q=!0):B instanceof f.MainLight||B instanceof f.FillLight?l.push(B):B instanceof f.AmbientLight?t.push(B):B instanceof f.SphericalHarmonicsLight&&
c.push(B)}p(l,m.sh);x(t,m.sh);for(b=0;b<c.length;b++)B=c[b],a.add(m.sh.r,B.sh.r),a.add(m.sh.g,B.sh.g),a.add(m.sh.b,B.sh.b)};var v=[],r=[],u=[],C=[0],E=[0],c=z.create(),D=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});l.dotProduct=function(f,a){for(var d=0,b=0;b<f.length;b++)d+=f[b]*a[b];return d};l.elementwiseProduct=
function(f,a,d){d=d||f;d.length=f.length;for(var b=0;b<f.length;b++)d[b]=f[b]*a[b];return d};l.scalarProduct=function(f,a,d){d=d||f;d.length=f.length;for(var b=0;b<f.length;b++)d[b]=f[b]*a;return d};l.add=function(f,a,d){d=d||f;d.length=f.length;for(var b=0;b<f.length;b++)d[b]=f[b]+a[b];return d}})},"esri/views/3d/webgl-engine/materials/internal/SimpleGLMaterial":function(){define("require exports dojo/text!./SimpleGLMaterial.xml ./MaterialUtil ../../lib/RenderSlot ../../../../webgl/Program ../../../../webgl/enums ../../lib/DefaultVertexAttributeLocations".split(" "),
function(w,l,f,a,d,b,q,t){return function(){function m(b,d,f,m){void 0===m&&(m=4);this.id=a.__GLMaterial_id++;this.program=b.get("simple");this.color=d;this.depthFunc=f;this.drawMode=m}m.prototype.getId=function(){return this.id};m.prototype.beginSlot=function(a){return a===d.INTERNAL_MATERIAL};m.prototype.getProgram=function(){return this.program};m.prototype.bind=function(b,d){b.bindProgram(this.program);this.program.setUniformMatrix4fv("model",a.IDENTITY);this.program.setUniformMatrix4fv("proj",
d.proj);this.program.setUniform4fv("color",this.color);b.setBlendingEnabled(!0);b.setBlendFunctionSeparate(b.gl.SRC_ALPHA,b.gl.ONE_MINUS_SRC_ALPHA,b.gl.ONE,b.gl.ONE_MINUS_SRC_ALPHA);b.setDepthTestEnabled(!0);void 0!==this.depthFunc&&b.setDepthFunction(this.depthFunc)};m.prototype.release=function(a){void 0!==this.depthFunc&&a.setDepthFunction(513);a.setBlendingEnabled(!1)};m.prototype.bindView=function(b,d){a.bindView(d.origin,d.view,this.program)};m.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",
b.transformation)};m.prototype.getDrawMode=function(a){return this.drawMode};m.loadShaders=function(a,d,m,q){a._parse(f);a=new b(q,a.vertexShaderSimple,a.fragmentShaderSimple,t.Default3D);m.add("simple",a)};return m}()})},"esri/views/3d/webgl-engine/lib/LinearDepthTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject","../../../webgl/enums"],function(w,l,f,a,d){return function(){function b(a){this._rctx=a;this._depthFBO=void 0;this.height=this.width=this.viewportToRestore=
null}b.prototype.setEnableState=function(a){a!==this.getEnableState()&&(a?this.enable():this.disable())};b.prototype.getEnableState=function(){return void 0!==this._depthFBO};b.prototype.getDepthFBO=function(){return this._depthFBO};b.prototype.enable=function(){f.assert(!this.getEnableState());this._depthFBO=a.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1})};b.prototype.disable=function(){f.assert(this.getEnableState());
this._depthFBO.dispose();this._depthFBO=void 0};b.prototype.setupFBOs=function(a){f.assert(this.getEnableState());this.viewportToRestore=a=a.fullViewport;this.width=a[2];this.height=a[3];this._rctx.setViewport(0,0,this.width,this.height)};b.prototype.prepareDepthPass=function(){f.assert(this.getEnableState());var a=this._rctx,b=a.gl;this._depthFBO.resize(this.width,this.height);a.bindFramebuffer(this._depthFBO);a.setClearColor(0,0,0,0);a.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT)};b.prototype.finish=
function(a){var b=this._rctx;b.bindFramebuffer(a);b.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])};return b}()})},"esri/views/3d/webgl-engine/lib/NormalTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject","../../../webgl/enums"],function(w,l,f,a,d){return function(){function b(a){this.rctx=a;this.normalFBO=void 0;this.height=this.width=this.viewportToRestore=null}b.prototype.setEnableState=
function(a){a!==this.getEnableState()&&(a?this.enable():this.disable())};b.prototype.getEnableState=function(){return void 0!==this.normalFBO};b.prototype.getNormalFBO=function(){return this.normalFBO};b.prototype.enable=function(){f.assert(!this.getEnableState());this.normalFBO=a.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1})};b.prototype.disable=function(){f.assert(this.getEnableState());
this.normalFBO.dispose();this.normalFBO=void 0};b.prototype.setupFBOs=function(a){f.assert(this.getEnableState());this.viewportToRestore=a=a.viewport;this.width=a[2];this.height=a[3];this.rctx.setViewport(0,0,this.width,this.height)};b.prototype.prepareNormalPass=function(){f.assert(this.getEnableState());var a=this.rctx,b=a.gl;this.normalFBO.resize(this.width,this.height);a.bindFramebuffer(this.normalFBO);a.setClearColor(0,0,0,0);a.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT)};b.prototype.finish=
function(a){var b=this.rctx;b.bindFramebuffer(a);b.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])};return b}()})},"esri/views/3d/webgl-engine/lib/HighlightTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject","../../../webgl/enums"],function(w,l,f,a,d){return function(){function b(a){this._rctx=a;this.height=this.width=this.viewportToRestore=this.fbo2=this.fbo=null}b.prototype.setEnableState=
function(a){a!==this.getEnableState()&&(a?this.enable():this.disable())};b.prototype.getEnableState=function(){return null!==this.fbo};b.prototype.getHighlightFBO=function(){return this.fbo};b.prototype.getBlurFBO=function(){return this.fbo2};b.prototype.enable=function(){f.assert(!this.getEnableState());this.fbo=a.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1})};b.prototype.disable=
function(){f.assert(this.getEnableState());this.fbo.dispose();this.fbo=null};b.prototype.setupFBOs=function(a){f.assert(this.getEnableState());this.viewportToRestore=a=a.fullViewport;this.width=a[2];this.height=a[3];this._rctx.setViewport(0,0,this.width,this.height)};b.prototype.prepareHighlightPass=function(){f.assert(this.getEnableState());var a=this._rctx,b=a.gl;this.fbo.resize(this.width,this.height);a.bindFramebuffer(this.fbo);a.setClearColor(0,0,0,0);a.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT)};
b.prototype.finish=function(a){var b=this._rctx;b.bindFramebuffer(a);b.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])};return b}()})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["require","exports","./RenderSlot","./RenderPass"],function(w,l,f,a){return function(){function d(){this.normals=this.lightingData=this.highlight=this.depth=this.camera=null;this.pass=a.MATERIAL;this.shadowMap=null;this.slot=f.BACKGROUND;
this.options=this.rctx=this.framebufferTex=this.stencilRenderingHelper=this.offscreenRenderingHelper=this.ssaoHelper=null}Object.defineProperty(d.prototype,"isHighlightPass",{get:function(){return this.pass===a.MATERIAL_HIGHLIGHT},enumerable:!0,configurable:!0});return d}()})},"esri/views/3d/webgl-engine/lib/ExternalRendererContainer":function(){define(["require","exports","./RenderSlot"],function(w,l,f){return function(){function a(){this.renderersChanged=!1;this.renderers=[];this.slots=[];for(var a=
0;a<f.MAX_SLOTS;++a)this.slots[a]=[]}a.prototype.addRenderer=function(a,b){this.renderers.push(b);for(var d=0;d<a.length;++d)this.slots[a[d]].push(b);this.renderersChanged=!0};a.prototype.removeRenderer=function(a){this.renderers=this.renderers.filter(function(b){return b!==a});for(var b=0;b<this.slots.length;++b)this.slots[b]=this.slots[b].filter(function(b){return b!==a});this.renderersChanged=!0};a.prototype.render=function(a,b){b.slot=a;var d=0;for(a=this.slots[a];d<a.length;d++){var f=a[d];f.render(b)&&
(f.didRender=!0)}};a.prototype.needsRender=function(){if(this.renderersChanged)return!0;for(var a=0,b=this.renderers;a<b.length;a++)if(b[a].needsRender)return!0;return!1};a.prototype.needsHighlight=function(){for(var a=0,b=this.renderers;a<b.length;a++)if(b[a].needsHighlight)return!0;return!1};a.prototype.resetNeedsRender=function(){this.renderersChanged=!1;for(var a=0,b=this.renderers;a<b.length;a++){var f=b[a];f.resetNeedsRender?f.resetNeedsRender():f.didRender&&(f.needsRender=!1,f.didRender=!1)}};
return a}()})},"esri/views/3d/webgl-engine/lib/StencilRenderingHelper":function(){define(["require","exports","./Util","../../../webgl/enums"],function(w,l,f,a){return function(){function a(a){this._enabled=!1;this._rctx=a}a.prototype.enable=function(){this._enabled=!0;this._rctx.setStencilTestEnabled(!0)};a.prototype.disable=function(){this._enabled=!1;this._rctx.setStencilTestEnabled(!1)};a.prototype.getIsSupported=function(){return!!this._rctx.contextAttributes.stencil};a.prototype.setEnableState=
function(a){a?this.enable():this.disable()};a.prototype.getEnableState=function(){return this._enabled};a.prototype.prepareStencilWritePass=function(){f.assert(this.getEnableState());var a=this._rctx;a.setClearStencil(0);a.setStencilFunction(519,1,255);a.setStencilOp(7680,7680,7681);a.setStencilWriteMask(255)};a.prototype.finish=function(){if(this.getEnableState()){var a=this._rctx;a.setStencilFunction(519,0,0);a.setStencilOp(7680,7680,7680);a.setStencilWriteMask(0)}};a.prototype.enableStencilRead=
function(){this.getEnableState()&&this._rctx.setStencilFunction(517,1,255)};a.prototype.disableStencilRead=function(){this.getEnableState()&&this._rctx.setStencilFunction(519,0,0)};return a}()})},"esri/views/3d/webgl-engine/lib/FxaaRenderPass":function(){define("require exports ../../../webgl/Program ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/enums".split(" "),function(w,l,f,a,d,b){return function(){function b(a){this.isEnabled=!1;this.vertexAttributeLocations={position:0};
this.vertexBufferLayout=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}b.prototype.enable=function(){if(!this.isEnabled){var b=this.rctx;this.program=new f(b,"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate \x3d (position + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(position, -1, 1);\n      }","\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x \x3d pos.x + float(off.x) * rcpFrame.x;\n        float y \x3d pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -\x3e actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN \x3d FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN \x3d FxaaLuma(rgbN);\n        float lumaW \x3d FxaaLuma(rgbW);\n        float lumaM \x3d FxaaLuma(rgbM);\n        float lumaE \x3d FxaaLuma(rgbE);\n        float lumaS \x3d FxaaLuma(rgbS);\n        float rangeMin \x3d min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax \x3d max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range \x3d rangeMax - rangeMin;\n        if (range \x3c max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL \x3d rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL \x3d (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL \x3d abs(lumaL - lumaM);\n        float blendL \x3d max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL \x3d min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL +\x3d (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *\x3d vec3(1.0/9.0);\n        float lumaNW \x3d FxaaLuma(rgbNW);\n        float lumaNE \x3d FxaaLuma(rgbNE);\n        float lumaSW \x3d FxaaLuma(rgbSW);\n        float lumaSE \x3d FxaaLuma(rgbSE);\n        float edgeVert \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan \x3d edgeHorz \x3e\x3d edgeVert;\n        float lengthSign \x3d horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN \x3d lumaW;\n          lumaS \x3d lumaE;\n        }\n        float gradientN \x3d abs(lumaN - lumaM);\n        float gradientS \x3d abs(lumaS - lumaM);\n        lumaN \x3d (lumaN + lumaM) * 0.5;\n        lumaS \x3d (lumaS + lumaM) * 0.5;\n        if (gradientN \x3c gradientS)\n        {\n          lumaN \x3d lumaS;\n          lumaN \x3d lumaS;\n          gradientN \x3d gradientS;\n          lengthSign *\x3d -1.0;\n        }\n        vec2 posN;\n        posN.x \x3d pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y \x3d pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *\x3d FXAA_SEARCH_THRESHOLD;\n        vec2 posP \x3d posN;\n        vec2 offNP \x3d horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN \x3d lumaN;\n        float lumaEndP \x3d lumaN;\n        bool doneN \x3d false;\n        bool doneP \x3d false;\n        posN +\x3d offNP * vec2(-1.0, -1.0);\n        posP +\x3d offNP * vec2( 1.0,  1.0);\n        for(int i \x3d 0; i \x3c FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN \x3d FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP \x3d FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN \x3d doneN || (abs(lumaEndN - lumaN) \x3e\x3d gradientN);\n          doneP \x3d doneP || (abs(lumaEndP - lumaN) \x3e\x3d gradientN);\n          if(doneN \x26\x26 doneP) { break; }\n          if(!doneN) {\n            posN -\x3d offNP;\n          }\n          if(!doneP) {\n            posP +\x3d offNP;\n          }\n        }\n        float dstN \x3d horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP \x3d horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN \x3d dstN \x3c dstP;\n        lumaEndN \x3d directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) \x3c 0.0) \x3d\x3d ((lumaEndN - lumaN) \x3c 0.0)) {\n          lengthSign \x3d 0.0;\n        }\n        float spanLength \x3d (dstP + dstN);\n        dstN \x3d directionN ? dstN : dstP;\n        float subPixelOffset \x3d (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF \x3d texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord \x3d fCoordinate;\n        // if (screenCoord.x \x3c 0.5) {\n          color.rgb \x3d FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x \x3c 0.501 \x26\x26 screenCoord.x \x3e 0.499) {\n        //   color.rgb \x3d vec3(1,0,0);\n        // } else {\n        //   color \x3d texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a \x3d 1.0;\n        gl_FragColor \x3d color;\n      }",
this.vertexAttributeLocations);var m=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new a(b,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new d(b,34962,35044,m)});this.isEnabled=!0}};b.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)};b.prototype.render=function(a,b){this.enable();var d=this.rctx;d.bindVAO(this.vao);d.bindFramebuffer(b);var f=0,m=0;null!=b?(f=b.descriptor.width,m=b.descriptor.height):
(f=d.gl.canvas.width,m=d.gl.canvas.height);d.bindProgram(this.program);d.bindTexture(a.colorTexture,0);this.program.setUniform1i("uColorTexture",0);this.program.setUniform2f("uRcpFrameDimension",1/f,1/m);d.setFaceCullingEnabled(!1);d.drawArrays(4,0,3)};return b}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../../webgl/Program ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/FramebufferObject ../../support/imageUtils ../../../webgl/enums".split(" "),
function(w,l,f,a,d,b,q,t,m){return function(){function k(a){this.isEnabled=!1;this.vertexAttributeLocations={vPosition:0};this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}k.prototype.enable=function(){if(!this.isEnabled){var b=this.rctx;this.programEdgeDetect=new f(b,"\n      #define SHADER_NAME SMAA::EdgeDetect\n      precision highp float;\n      precision highp int;\n\n      uniform vec4 uResolution;\n      attribute vec2 vPosition;\n\n      varying vec2 fTexCoord;\n      varying vec4 fOffset[3];\n\n      void SMAAEdgeDetectionVS( vec2 texcoord ) {\n        fOffset[0] \x3d texcoord.xyxy + uResolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 ); // WebGL port note: Changed sign in W component\n        fOffset[1] \x3d texcoord.xyxy + uResolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 ); // WebGL port note: Changed sign in W component\n        fOffset[2] \x3d texcoord.xyxy + uResolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 ); // WebGL port note: Changed sign in W component\n      }\n\n      void main() {\n        fTexCoord \x3d (vPosition + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(vPosition, 0, 1);\n        SMAAEdgeDetectionVS( fTexCoord );\n      }",
"\n      #define SHADER_NAME SMAA::EdgeDetect\n      precision highp float;\n      precision highp int;\n\n      #define SMAA_THRESHOLD 0.05\n      #define SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR 2\n      #define SMAA_USE_COLOR_EDGE_DETECTION 0\n\n      uniform sampler2D tColor;\n\n      varying vec2 fTexCoord;\n      varying vec4 fOffset[3];\n\n      vec4 SMAALumaEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {\n        // Calculate the threshold:\n        vec2 threshold \x3d vec2(SMAA_THRESHOLD, SMAA_THRESHOLD);\n\n        // Calculate lumas:\n        vec3 weights \x3d vec3(0.2126, 0.7152, 0.0722);\n        float L \x3d dot(texture2D(colorTex, texcoord).rgb, weights);\n\n        float Lleft \x3d dot(texture2D(colorTex, offset[0].xy).rgb, weights);\n        float Ltop  \x3d dot(texture2D(colorTex, offset[0].zw).rgb, weights);\n\n        // We do the usual threshold:\n        vec4 delta;\n        delta.xy \x3d abs(L - vec2(Lleft, Ltop));\n        vec2 edges \x3d step(threshold, delta.xy);\n\n        // Then discard if there is no edge:\n        if (dot(edges, vec2(1.0, 1.0)) \x3d\x3d 0.0) discard;\n\n        // Calculate right and bottom deltas:\n        float Lright \x3d dot(texture2D(colorTex, offset[1].xy).rgb, weights);\n        float Lbottom  \x3d dot(texture2D(colorTex, offset[1].zw).rgb, weights);\n        delta.zw \x3d abs(L - vec2(Lright, Lbottom));\n\n        // Calculate the maximum delta in the direct neighborhood:\n        vec2 maxDelta \x3d max(delta.xy, delta.zw);\n\n        // Calculate left-left and top-top deltas:\n        float Lleftleft \x3d dot(texture2D(colorTex, offset[2].xy).rgb, weights);\n        float Ltoptop \x3d dot(texture2D(colorTex, offset[2].zw).rgb, weights);\n        delta.zw \x3d abs(vec2(Lleft, Ltop) - vec2(Lleftleft, Ltoptop));\n\n        // Calculate the final maximum delta:\n        maxDelta \x3d max(maxDelta.xy, delta.zw);\n        float finalDelta \x3d max(maxDelta.x, maxDelta.y);\n\n        // Local contrast adaptation:\n        edges.xy *\x3d step(finalDelta, float(SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR) * delta.xy);\n\n        return vec4( edges, 0.0, 0.0 );\n      }\n\n      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {\n        vec2 threshold \x3d vec2( SMAA_THRESHOLD, SMAA_THRESHOLD );\n\n        // Calculate color deltas:\n        vec4 delta;\n        vec3 C \x3d texture2D( colorTex, texcoord ).rgb;\n\n        vec3 Cleft \x3d texture2D( colorTex, offset[0].xy ).rgb;\n        vec3 t \x3d abs( C - Cleft );\n        delta.x \x3d max( max( t.r, t.g ), t.b );\n\n        vec3 Ctop \x3d texture2D( colorTex, offset[0].zw ).rgb;\n        t \x3d abs( C - Ctop );\n        delta.y \x3d max( max( t.r, t.g ), t.b );\n\n        // We do the usual threshold:\n        vec2 edges \x3d step( threshold, delta.xy );\n\n        // Then discard if there is no edge:\n        if ( dot( edges, vec2( 1.0, 1.0 ) ) \x3d\x3d 0.0 )\n            discard;\n\n        // Calculate right and bottom deltas:\n        vec3 Cright \x3d texture2D( colorTex, offset[1].xy ).rgb;\n        t \x3d abs( C - Cright );\n        delta.z \x3d max( max( t.r, t.g ), t.b );\n\n        vec3 Cbottom  \x3d texture2D( colorTex, offset[1].zw ).rgb;\n        t \x3d abs( C - Cbottom );\n        delta.w \x3d max( max( t.r, t.g ), t.b );\n\n        // Calculate the maximum delta in the direct neighborhood:\n        float maxDelta \x3d max( max( max( delta.x, delta.y ), delta.z ), delta.w );\n\n        // Calculate left-left and top-top deltas:\n        vec3 Cleftleft  \x3d texture2D( colorTex, offset[2].xy ).rgb;\n        t \x3d abs( C - Cleftleft );\n        delta.z \x3d max( max( t.r, t.g ), t.b );\n\n        vec3 Ctoptop \x3d texture2D( colorTex, offset[2].zw ).rgb;\n        t \x3d abs( C - Ctoptop );\n        delta.w \x3d max( max( t.r, t.g ), t.b );\n\n        // Calculate the final maximum delta:\n        maxDelta \x3d max( max( maxDelta, delta.z ), delta.w );\n\n        // Local contrast adaptation in action:\n        edges.xy *\x3d step( maxDelta, float(SMAA_LOCAL_CONTRAST_ADAPTATION_FACTOR) * delta.xy );\n\n        return vec4( edges, 0.0, 0.0 );\n      }\n\n      void main() {\n        #if SMAA_USE_COLOR_EDGE_DETECTION\n          gl_FragColor \x3d SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );\n        #else\n          gl_FragColor \x3d SMAALumaEdgeDetectionPS( fTexCoord, fOffset, tColor );\n        #endif\n      }",
this.vertexAttributeLocations);this.programBlendWeights=new f(b,"\n      #define SHADER_NAME SMAA::BlendWeights\n      precision highp float;\n      precision highp int;\n\n      #define SMAA_MAX_SEARCH_STEPS 8\n\n      uniform vec4 uResolution;\n      attribute vec2 vPosition;\n\n      varying vec2 fTexCoord;\n      varying vec4 fOffset[3];\n      varying vec2 fPixCoord;\n\n      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {\n        fPixCoord \x3d texcoord * uResolution.zw;\n        fOffset[0] \x3d texcoord.xyxy + uResolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );\n        fOffset[1] \x3d texcoord.xyxy + uResolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );\n        fOffset[2] \x3d vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * uResolution.xxyy * float( SMAA_MAX_SEARCH_STEPS );\n      }\n\n      void main() {\n        fTexCoord \x3d (vPosition + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(vPosition, 0, 1);\n        SMAABlendingWeightCalculationVS( fTexCoord );\n      }",
"\n      #define SHADER_NAME SMAA::BlendWeights\n      precision highp float;\n      precision highp int;\n\n      #define SMAA_MAX_SEARCH_STEPS 8\n      #define SMAA_AREATEX_MAX_DISTANCE 16\n      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )\n      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )\n\n      #define SMAASampleLevelZeroOffset( tex, coord, offset ) texture2D( tex, coord + float( offset ) * uResolution.xy, 0.0 )\n\n      uniform sampler2D tEdges;\n      uniform sampler2D tArea;\n      uniform sampler2D tSearch;\n      uniform vec4 uResolution;\n\n      varying vec2 fTexCoord;\n      varying vec4 fOffset[3];\n      varying vec2 fPixCoord;\n\n      vec2 round( vec2 x ) {\n        return sign( x ) * floor( abs( x ) + 0.5 );\n      }\n\n      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {\n        e.r \x3d bias + e.r * scale;\n        return 255.0 * texture2D( searchTex, e, 0.0 ).r;\n      }\n\n      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n        vec2 e \x3d vec2( 0.0, 1.0 );\n        for ( int i \x3d 0; i \x3c SMAA_MAX_SEARCH_STEPS; i ++ ) {\n          e \x3d texture2D( edgesTex, texcoord, 0.0 ).rg;\n          texcoord -\x3d vec2( 2.0, 0.0 ) * uResolution.xy;\n          if ( ! ( texcoord.x \x3e end \x26\x26 e.g \x3e 0.8281 \x26\x26 e.r \x3d\x3d 0.0 ) ) break;\n        }\n        texcoord.x +\x3d 0.25 * uResolution.x;\n        texcoord.x +\x3d uResolution.x;\n        texcoord.x +\x3d 2.0 * uResolution.x;\n        texcoord.x -\x3d uResolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);\n        return texcoord.x;\n      }\n\n      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n        vec2 e \x3d vec2( 0.0, 1.0 );\n        for ( int i \x3d 0; i \x3c SMAA_MAX_SEARCH_STEPS; i ++ ) {\n          e \x3d texture2D( edgesTex, texcoord, 0.0 ).rg;\n          texcoord +\x3d vec2( 2.0, 0.0 ) * uResolution.xy;\n          if ( ! ( texcoord.x \x3c end \x26\x26 e.g \x3e 0.8281 \x26\x26 e.r \x3d\x3d 0.0 ) ) break;\n        }\n        texcoord.x -\x3d 0.25 * uResolution.x;\n        texcoord.x -\x3d uResolution.x;\n        texcoord.x -\x3d 2.0 * uResolution.x;\n        texcoord.x +\x3d uResolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );\n        return texcoord.x;\n      }\n\n      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n        vec2 e \x3d vec2( 1.0, 0.0 );\n        for ( int i \x3d 0; i \x3c SMAA_MAX_SEARCH_STEPS; i ++ ) {\n          e \x3d texture2D( edgesTex, texcoord, 0.0 ).rg;\n          texcoord +\x3d vec2( 0.0, 2.0 ) * uResolution.xy;\n          if ( ! ( texcoord.y \x3e end \x26\x26 e.r \x3e 0.8281 \x26\x26 e.g \x3d\x3d 0.0 ) ) break;\n        }\n        texcoord.y -\x3d 0.25 * uResolution.y;\n        texcoord.y -\x3d uResolution.y;\n        texcoord.y -\x3d 2.0 * uResolution.y;\n        texcoord.y +\x3d uResolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );\n        return texcoord.y;\n      }\n\n      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {\n        vec2 e \x3d vec2( 1.0, 0.0 );\n        for ( int i \x3d 0; i \x3c SMAA_MAX_SEARCH_STEPS; i ++ ) {\n          e \x3d texture2D( edgesTex, texcoord, 0.0 ).rg;\n          texcoord -\x3d vec2( 0.0, 2.0 ) * uResolution.xy;\n          if ( ! ( texcoord.y \x3c end \x26\x26 e.r \x3e 0.8281 \x26\x26 e.g \x3d\x3d 0.0 ) ) break;\n        }\n        texcoord.y +\x3d 0.25 * uResolution.y;\n        texcoord.y +\x3d uResolution.y;\n        texcoord.y +\x3d 2.0 * uResolution.y;\n        texcoord.y -\x3d uResolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );\n        return texcoord.y;\n      }\n\n      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {\n        vec2 texcoord \x3d float( SMAA_AREATEX_MAX_DISTANCE ) * round( 4.0 * vec2( e1, e2 ) ) + dist;\n        texcoord \x3d SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );\n        texcoord.y +\x3d SMAA_AREATEX_SUBTEX_SIZE * offset;\n        return texture2D( areaTex, texcoord, 0.0 ).rg;\n      }\n\n      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {\n        vec4 weights \x3d vec4( 0.0, 0.0, 0.0, 0.0 );\n        vec2 e \x3d texture2D( edgesTex, texcoord ).rg;\n        if ( e.g \x3e 0.0 ) {\n          vec2 d;\n          vec2 coords;\n          coords.x \x3d SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );\n          coords.y \x3d offset[ 1 ].y;\n          d.x \x3d coords.x;\n          float e1 \x3d texture2D( edgesTex, coords, 0.0 ).r;\n          coords.x \x3d SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );\n          d.y \x3d coords.x;\n          d \x3d d * uResolution.z - pixcoord.x;\n          vec2 sqrt_d \x3d sqrt( abs( d ) );\n          coords.y -\x3d 1.0 * uResolution.y;\n          float e2 \x3d SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 1, 0 ) ).r;\n          weights.rg \x3d SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );\n        }\n        if ( e.r \x3e 0.0 ) {\n          vec2 d;\n          vec2 coords;\n          coords.y \x3d SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );\n          coords.x \x3d offset[ 0 ].x;\n          d.x \x3d coords.y;\n          float e1 \x3d texture2D( edgesTex, coords, 0.0 ).g;\n          coords.y \x3d SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );\n          d.y \x3d coords.y;\n          d \x3d d * uResolution.w - pixcoord.y;\n          vec2 sqrt_d \x3d sqrt( abs( d ) );\n          coords.y -\x3d 1.0 * uResolution.y;\n          float e2 \x3d SMAASampleLevelZeroOffset( edgesTex, coords, ivec2( 0, 1 ) ).g;\n          weights.ba \x3d SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );\n\n          // for some reason the following lines are necessary to prevent\n          // texture lookup precision issues on some Intel integrated graphics chips\n          vec4 dbg \x3d (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);\n          weights.r +\x3d 0.00000001 * dot(vec4(0,1,0,1),dbg);\n        }\n        return weights;\n      }\n\n      void main() {\n        gl_FragColor \x3d SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );\n      }",
this.vertexAttributeLocations);this.programBlur=new f(b,"\n      #define SHADER_NAME SMAA::NeighborhoodBlending\n      precision highp float;\n      precision highp int;\n\n      uniform vec4 uResolution;\n      attribute vec2 vPosition;\n\n      varying vec2 fTexCoord;\n      varying vec4 fOffset[2];\n\n      void SMAANeighborhoodBlendingVS( vec2 texcoord ) {\n        fOffset[0] \x3d texcoord.xyxy + uResolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );\n        fOffset[1] \x3d texcoord.xyxy + uResolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );\n      }\n\n      void main() {\n        fTexCoord \x3d (vPosition + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(vPosition, 0, 1);\n\n        SMAANeighborhoodBlendingVS(fTexCoord);\n      }",
"\n      #define SHADER_NAME SMAA::NeighborhoodBlending\n      precision highp float;\n      precision highp int;\n\n      #define SMAA_DEBUG_SPLIT_VIEW 0\n\n      uniform sampler2D tBlendWeights;\n      uniform sampler2D tColor;\n      uniform vec4 uResolution;\n\n      varying vec2 fTexCoord;\n      varying vec4 fOffset[2];\n\n      vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {\n        vec4 a;\n        a.xz \x3d texture2D( blendTex, texcoord ).xz;\n        a.y \x3d texture2D( blendTex, offset[ 1 ].zw ).g;\n        a.w \x3d texture2D( blendTex, offset[ 1 ].xy ).a;\n\n        if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) \x3c 1e-5 ) {\n          return texture2D( colorTex, texcoord, 0.0 );\n        } else {\n          vec2 offset;\n          offset.x \x3d a.a \x3e a.b ? a.a : -a.b;\n          offset.y \x3d a.g \x3e a.r ? -a.g : a.r;\n\n          if ( abs( offset.x ) \x3e abs( offset.y )) {\n            offset.y \x3d 0.0;\n          } else {\n            offset.x \x3d 0.0;\n          }\n\n          vec4 C \x3d texture2D( colorTex, texcoord, 0.0 );\n          texcoord +\x3d sign( offset ) * uResolution.xy;\n          vec4 Cop \x3d texture2D( colorTex, texcoord, 0.0 );\n\n          float s \x3d abs( offset.x ) \x3e abs( offset.y ) ? abs( offset.x ) : abs( offset.y );\n          //C.xyz \x3d pow(C.xyz, vec3(2.2));\n          //Cop.xyz \x3d pow(Cop.xyz, vec3(2.2));\n          vec4 mixed \x3d mix(C, Cop, s);\n          //mixed.xyz \x3d pow(mixed.xyz, vec3(1.0 / 2.2));\n\n          return mixed;\n        }\n      }\n\n      void main() {\n        gl_FragColor \x3d SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );\n\n        #if SMAA_DEBUG_SPLIT_VIEW // split the view in the middle and display the unprocessed image on the right\n          // test stuff\n          if (fTexCoord.x \x3e 0.5) {\n            if (fTexCoord.x \x3c 0.5 + uResolution.x) {\n              gl_FragColor \x3d vec4(0, 0, 1, 1);\n            } else {\n              gl_FragColor \x3d texture2D(tColor, fTexCoord);\n            }\n          }\n        #endif // DEBUG\n      }",
this.vertexAttributeLocations);var k=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new a(b,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new d(b,34962,35044,k)});this.tmpFramebufferEdges=q.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.tmpFramebufferBlend=q.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,
wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.textureArea=this.loadTextureFromBase64("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAKAAAAIwCAIAAACOVPcQAACBeklEQVR42u39W4xlWXrnh/3WWvuciIzMrKxrV8/0rWbY0+SQFKcb4owIkSIFCjY9AC1BT/LYBozRi+EX+cV+8IMsYAaCwRcBwjzMiw2jAWtgwC8WR5Q8mDFHZLNHTarZGrLJJllt1W2qKrsumZWZcTvn7L3W54e1vrXX3vuciLPPORFR1XE2EomorB0nVuz//r71re/y/1eMvb4Cb3N11xV/PP/2v4UBAwJG/7H8urx6/25/Gf8O5hypMQ0EEEQwAqLfoN/Z+97f/SW+/NvcgQk4sGBJK6H7N4PFVL+K+e0N11yNfkKvwUdwdlUAXPHHL38oa15f/i/46Ih6SuMSPmLAYAwyRKn7dfMGH97jaMFBYCJUgotIC2YAdu+LyW9vvubxAP8kAL8H/koAuOKP3+q6+xGnd5kdYCeECnGIJViwGJMAkQKfDvB3WZxjLKGh8VSCCzhwEWBpMc5/kBbjawT4HnwJfhr+pPBIu7uu+OOTo9vsmtQcniMBGkKFd4jDWMSCRUpLjJYNJkM+IRzQ+PQvIeAMTrBS2LEiaiR9b/5PuT6Ap/AcfAFO4Y3dA3DFH7/VS+M8k4baEAQfMI4QfbVDDGIRg7GKaIY52qAjTAgTvGBAPGIIghOCYAUrGFNgzA7Q3QhgCwfwAnwe5vDejgG44o/fbm1C5ZlYQvQDARPAIQGxCWBM+wWl37ZQESb4gImexGMDouhGLx1Cst0Saa4b4AqO4Hk4gxo+3DHAV/nx27p3JziPM2pVgoiia5MdEzCGULprIN7gEEeQ5IQxEBBBQnxhsDb5auGmAAYcHMA9eAAz8PBol8/xij9+C4Djlim4gJjWcwZBhCBgMIIYxGAVIkH3ZtcBuLdtRFMWsPGoY9rN+HoBji9VBYdwD2ZQg4cnO7OSq/z4rU5KKdwVbFAjNojCQzTlCLPFSxtamwh2jMUcEgg2Wm/6XgErIBhBckQtGN3CzbVacERgCnfgLswhnvqf7QyAq/z4rRZm1YglYE3affGITaZsdIe2FmMIpnOCap25I6jt2kCwCW0D1uAD9sZctNGXcQIHCkINDQgc78aCr+zjtw3BU/ijdpw3zhCwcaONwBvdeS2YZKkJNJsMPf2JKEvC28RXxxI0ASJyzQCjCEQrO4Q7sFArEzjZhaFc4cdv+/JFdKULM4px0DfUBI2hIsy06BqLhGTQEVdbfAIZXYMPesq6VoCHICzUyjwInO4Y411//LYLs6TDa9wvg2CC2rElgAnpTBziThxaL22MYhzfkghz6GAs2VHbbdM91VZu1MEEpupMMwKyVTb5ij9+u4VJG/5EgEMMmFF01cFai3isRbKbzb+YaU/MQbAm2XSMoUPAmvZzbuKYRIFApbtlrfFuUGd6vq2hXNnH78ZLh/iFhsQG3T4D1ib7k5CC6vY0DCbtrohgLEIClXiGtl10zc0CnEGIhhatLBva7NP58Tvw0qE8yWhARLQ8h4+AhQSP+I4F5xoU+VilGRJs6wnS7ruti/4KvAY/CfdgqjsMy4pf8fodQO8/gnuX3f/3xi3om1/h7THr+co3x93PP9+FBUfbNUjcjEmhcrkT+8K7ml7V10Jo05mpIEFy1NmCJWx9SIKKt+EjAL4Ez8EBVOB6havuT/rByPvHXK+9zUcfcbb254+9fydJknYnRr1oGfdaiAgpxu1Rx/Rek8KISftx3L+DfsLWAANn8Hvw0/AFeAGO9DFV3c6D+CcWbL8Dj9e7f+T1k8AZv/d7+PXWM/Z+VvdCrIvuAKO09RpEEQJM0Ci6+B4xhTWr4cZNOvhktabw0ta0rSJmqz3Yw5/AKXwenod7cAhTmBSPKf6JBdvH8IP17h95pXqw50/+BFnj88fev4NchyaK47OPhhtI8RFSvAfDSNh0Ck0p2gLxGkib5NJj/JWCr90EWQJvwBzO4AHcgztwAFN1evHPUVGwfXON+0debT1YeGON9Yy9/63X+OguiwmhIhQhD7l4sMqlG3D86Suc3qWZ4rWjI1X7u0Ytw6x3rIMeIOPDprfe2XzNgyj6PahhBjO4C3e6puDgXrdg+/5l948vF3bqwZetZ+z9Rx9zdIY5pInPK4Nk0t+l52xdK2B45Qd87nM8fsD5EfUhIcJcERw4RdqqH7Yde5V7m1vhNmtedkz6EDzUMF/2jJYWbC+4fzzA/Y+/8PPH3j9dcBAPIRP8JLXd5BpAu03aziOL3VVHZzz3CXWDPWd+SH2AnxIqQoTZpo9Ckc6HIrFbAbzNmlcg8Ag8NFDDAhbJvTBZXbC94P7t68EXfv6o+21gUtPETU7bbkLxvNKRFG2+KXzvtObonPP4rBvsgmaKj404DlshFole1Glfh02fE7bYR7dZ82oTewIBGn1Md6CG6YUF26X376oevOLzx95vhUmgblI6LBZwTCDY7vMq0op5WVXgsObOXJ+1x3qaBl9j1FeLxbhU9w1F+Wiba6s1X/TBz1LnUfuYDi4r2C69f1f14BWfP+p+W2GFKuC9phcELMYRRLur9DEZTUdEH+iEqWdaM7X4WOoPGI+ZYD2+wcQ+y+ioHUZ9dTDbArzxmi/bJI9BND0Ynd6lBdve/butBw8+f/T9D3ABa3AG8W3VPX4hBin+bj8dMMmSpp5pg7fJ6xrBFE2WQQEWnV8Qg3FbAWzYfM1rREEnmvkN2o1+acG2d/9u68GDzx91v3mAjb1zkpqT21OipPKO0b9TO5W0nTdOmAQm0TObts3aBKgwARtoPDiCT0gHgwnbArzxmtcLc08HgF1asN0C4Ms/fvD5I+7PhfqyXE/b7RbbrGyRQRT9ARZcwAUmgdoz0ehJ9Fn7QAhUjhDAQSw0bV3T3WbNa59jzmiP6GsWbGXDX2ytjy8+f9T97fiBPq9YeLdBmyuizZHaqXITnXiMUEEVcJ7K4j3BFPurtB4bixW8wTpweL8DC95szWMOqucFYGsWbGU7p3TxxxefP+r+oTVktxY0v5hbq3KiOKYnY8ddJVSBxuMMVffNbxwIOERShst73HZ78DZrHpmJmH3K6sGz0fe3UUj0eyRrSCGTTc+rjVNoGzNSv05srAxUBh8IhqChiQgVNIIBH3AVPnrsnXQZbLTm8ammv8eVXn/vWpaTem5IXRlt+U/LA21zhSb9cye6jcOfCnOwhIAYXAMVTUNV0QhVha9xjgA27ODJbLbmitt3tRN80lqG6N/khgot4ZVlOyO4WNg3OIMzhIZQpUEHieg2im6F91hB3I2tubql6BYNN9Hj5S7G0G2tahslBWKDnOiIvuAEDzakDQKDNFQT6gbn8E2y4BBubM230YIpBnDbMa+y3dx0n1S0BtuG62lCCXwcY0F72T1VRR3t2ONcsmDjbmzNt9RFs2LO2hQNyb022JisaI8rAWuw4HI3FuAIhZdOGIcdjLJvvObqlpqvWTJnnQbyi/1M9O8UxWhBs//H42I0q1Yb/XPGONzcmm+ri172mHKvZBpHkJaNJz6v9jxqiklDj3U4CA2ugpAaYMWqNXsdXbmJNd9egCnJEsphXNM+MnK3m0FCJ5S1kmJpa3DgPVbnQnPGWIDspW9ozbcO4K/9LkfaQO2KHuqlfFXSbdNzcEcwoqNEFE9zcIXu9/6n/ym/BC/C3aJLzEKPuYVlbFnfhZ8kcWxV3dbv4bKl28566wD+8C53aw49lTABp9PWbsB+knfc/Li3eVizf5vv/xmvnPKg5ihwKEwlrcHqucuVcVOxEv8aH37E3ZqpZypUulrHEtIWKUr+txHg+ojZDGlwnqmkGlzcVi1dLiNSJiHjfbRNOPwKpx9TVdTn3K05DBx4psIk4Ei8aCkJahRgffk4YnEXe07T4H2RR1u27E6wfQsBDofUgjFUFnwC2AiVtA+05J2zpiDK2Oa0c5fmAecN1iJzmpqFZxqYBCYhFTCsUNEmUnIcZ6aEA5rQVhEywG6w7HSW02XfOoBlQmjwulOFQAg66SvJblrTEX1YtJ3uG15T/BH1OfOQeuR8g/c0gdpT5fx2SKbs9EfHTKdM8A1GaJRHLVIwhcGyydZsbifAFVKl5EMKNU2Hryo+06BeTgqnxzYjThVySDikbtJPieco75lYfKAJOMEZBTjoITuWHXXZVhcUDIS2hpiXHV9Ku4u44bN5OYLDOkJo8w+xJSMbhBRHEdEs9JZUCkQrPMAvaHyLkxgkEHxiNkx/x2YB0mGsQ8EUWj/stW5YLhtS5SMu+/YBbNPDCkGTUybN8krRLBGPlZkVOA0j+a1+rkyQKWGaPHPLZOkJhioQYnVZ2hS3zVxMtgC46KuRwbJNd9nV2PHgb36F194ecf/Yeu2vAFe5nm/bRBFrnY4BauE8ERmZRFUn0k8hbftiVYSKMEme2dJCJSCGYAlNqh87bXOPdUkGy24P6d1ll21MBqqx48Fvv8ZHH8HZFY7j/uAq1xMJUFqCSUlJPmNbIiNsmwuMs/q9CMtsZsFO6SprzCS1Z7QL8xCQClEelpjTduDMsmWD8S1PT152BtvmIGvUeDA/yRn83u/x0/4qxoPHjx+PXY9pqX9bgMvh/Nz9kpP4pOe1/fYf3axUiMdHLlPpZCNjgtNFAhcHEDxTumNONhHrBduW+vOyY++70WWnPXj98eA4kOt/mj/5E05l9+O4o8ePx67HFqyC+qSSnyselqjZGaVK2TadbFLPWAQ4NBhHqDCCV7OTpo34AlSSylPtIdd2AJZlyzYQrDJ5lcWGNceD80CunPLGGzsfD+7wRb95NevJI5docQ3tgCyr5bGnyaPRlmwNsFELViOOx9loebGNq2moDOKpHLVP5al2cymWHbkfzGXL7kfRl44H9wZy33tvt+PB/Xnf93e+nh5ZlU18wCiRUa9m7kib9LYuOk+hudQNbxwm0AQqbfloimaB2lM5fChex+ylMwuTbfmXQtmWlenZljbdXTLuOxjI/fDDHY4Hjx8/Hrse0zXfPFxbUN1kKqSCCSk50m0Ajtx3ub9XHBKHXESb8iO6E+qGytF4nO0OG3SXzbJlhxBnKtKyl0NwybjvYCD30aMdjgePHz8eu56SVTBbgxJMliQ3Oauwg0QHxXE2Ez/EIReLdQj42Gzb4CLS0YJD9xUx7bsi0vJi5mUbW1QzL0h0PFk17rtiIPfJk52MB48fPx67npJJwyrBa2RCCQRTbGZSPCxTPOiND4G2pYyOQ4h4jINIJh5wFU1NFZt+IsZ59LSnDqBjZ2awbOku+yInunLcd8VA7rNnOxkPHj9+PGY9B0MWJJNozOJmlglvDMXDEozdhQWbgs/U6oBanGzLrdSNNnZFjOkmbi5bNt1lX7JLLhn3vXAg9/h4y/Hg8ePHI9dzQMEkWCgdRfYykYKnkP7D4rIujsujaKPBsB54vE2TS00ccvFY/Tth7JXeq1hz+qgVy04sAJawTsvOknHfCwdyT062HA8eP348Zj0vdoXF4pilKa2BROed+9fyw9rWRXeTFXESMOanvDZfJuJaSXouQdMdDJZtekZcLLvEeK04d8m474UDuaenW44Hjx8/Xns9YYqZpszGWB3AN/4VHw+k7WSFtJ3Qicuqb/NlVmgXWsxh570xg2UwxUw3WfO6B5nOuO8aA7lnZxuPB48fPx6znm1i4bsfcbaptF3zNT78eFPtwi1OaCNOqp1x3zUGcs/PN++AGD1+fMXrSVm2baTtPhPahbPhA71wIHd2bXzRa69nG+3CraTtPivahV/55tXWg8fyRY/9AdsY8VbSdp8V7cKrrgdfM//z6ILQFtJ2nxHtwmuoB4/kf74+gLeRtvvMaBdeSz34+vifx0YG20jbfTa0C6+tHrwe//NmOG0L8EbSdp8R7cLrrQe/996O+ai3ujQOskpTNULa7jOjXXj99eCd8lHvoFiwsbTdZ0a78PrrwTvlo966pLuRtB2fFe3Cm6oHP9kNH/W2FryxtN1nTLvwRurBO+Kj3pWXHidtx2dFu/Bm68Fb81HvykuPlrb7LGkX3mw9eGs+6h1Y8MbSdjegXcguQLjmevDpTQLMxtJ2N6NdyBZu9AbrwVvwUW+LbteULUpCdqm0HTelXbhNPe8G68Gb8lFvVfYfSNuxvrTdTWoXbozAzdaDZzfkorOj1oxVxlIMlpSIlpLrt8D4hrQL17z+c3h6hU/wv4Q/utps4+bm+6P/hIcf0JwQ5oQGPBL0eKPTYEXTW+eL/2DKn73J9BTXYANG57hz1cEMviVf/4tf5b/6C5pTQkMIWoAq7hTpOJjtAM4pxKu5vg5vXeUrtI09/Mo/5H+4z+Mp5xULh7cEm2QbRP2tFIKR7WM3fPf/jZ3SWCqLM2l4NxID5zB72HQXv3jj/8mLR5xXNA5v8EbFQEz7PpRfl1+MB/hlAN65qgDn3wTgH13hK7T59bmP+NIx1SHHU84nLOITt3iVz8mNO+lPrjGAnBFqmioNn1mTyk1ta47R6d4MrX7tjrnjYUpdUbv2rVr6YpVfsGG58AG8Ah9eyUN8CX4WfgV+G8LVWPDGb+Zd4cU584CtqSbMKxauxTg+dyn/LkVgA+IR8KHtejeFKRtTmLLpxN6mYVLjYxwXf5x2VofiZcp/lwKk4wGOpYDnoIZPdg/AAbwMfx0+ge9dgZvYjuqKe4HnGnykYo5TvJbG0Vj12JagRhwKa44H95ShkZa5RyLGGdfYvG7aw1TsF6iapPAS29mNS3NmsTQZCmgTzFwgL3upCTgtBTRwvGMAKrgLn4evwin8+afJRcff+8izUGUM63GOOuAs3tJkw7J4kyoNreqrpO6cYLQeFUd7TTpr5YOTLc9RUUogUOVJQ1GYJaFLAW0oTmKyYS46ZooP4S4EON3xQ5zC8/CX4CnM4c1PE8ApexpoYuzqlP3d4S3OJP8ZDK7cKWNaTlqmgDiiHwl1YsE41w1zT4iRTm3DBqxvOUsbMKKDa/EHxagtnta072ejc3DOIh5ojvh8l3tk1JF/AV6FU6jh3U8HwEazLgdCLYSQ+MYiAI2ltomkzttUb0gGHdSUUgsIYjTzLG3mObX4FBRaYtpDVNZrih9TgTeYOBxsEnN1gOCTM8Bsw/ieMc75w9kuAT6A+/AiHGvN/+Gn4KRkiuzpNNDYhDGFndWRpE6SVfm8U5bxnSgVV2jrg6JCKmneqey8VMFgq2+AM/i4L4RUbfSi27lNXZ7R7W9RTcq/q9fk4Xw3AMQd4I5ifAZz8FcVtm9SAom/dyN4lczJQW/kC42ZrHgcCoIf1oVMKkVItmMBi9cOeNHGLqOZk+QqQmrbc5YmYgxELUUN35z2iohstgfLIFmcMV7s4CFmI74L9+EFmGsi+tGnAOD4Yk9gIpo01Y4cA43BWGygMdr4YZekG3OBIUXXNukvJS8tqa06e+lSDCtnqqMFu6hWHXCF+WaYt64m9QBmNxi7Ioy7D+fa1yHw+FMAcPt7SysFLtoG4PXAk7JOA3aAxBRqUiAdU9Yp5lK3HLSRFtOim0sa8euEt08xvKjYjzeJ2GU7YawexrnKI9tmobInjFXCewpwriY9+RR4aaezFhMhGCppKwom0ChrgFlKzyPKkGlTW1YQrE9HJqu8hKGgMc6hVi5QRq0PZxNfrYNgE64utmRv6KKHRpxf6VDUaOvNP5jCEx5q185My/7RKz69UQu2im5k4/eownpxZxNLwiZ1AZTO2ZjWjkU9uaB2HFn6Q3u0JcsSx/qV9hTEApRzeBLDJQXxYmTnq7bdLa3+uqFrxLJ5w1TehnNHx5ECvCh2g2c3hHH5YsfdaSKddztfjQ6imKFGSyFwlLzxEGPp6r5IevVjk1AMx3wMqi1NxDVjLBiPs9tbsCkIY5we5/ML22zrCScFxnNtzsr9Wcc3CnD+pYO+4VXXiDE0oc/vQQ/fDK3oPESJMYXNmJa/DuloJZkcTpcYE8lIH8Dz8DJMiynNC86Mb2lNaaqP/+L7f2fcE/yP7/Lde8xfgSOdMxvOixZf/9p3+M4hT1+F+zApxg9XfUvYjc8qX2lfOOpK2gNRtB4flpFu9FTKCp2XJRgXnX6olp1zyYjTKJSkGmLE2NjUr1bxFM4AeAAHBUFIeSLqXR+NvH/M9fOnfHzOD2vCSyQJKzfgsCh+yi/Mmc35F2fUrw7miW33W9hBD1vpuUojFphIyvg7aTeoymDkIkeW3XLHmguMzbIAJejN6B5MDrhipE2y6SoFRO/AK/AcHHZHNIfiWrEe/C6cr3f/yOvrQKB+zMM55/GQdLDsR+ifr5Fiuu+/y+M78LzOE5dsNuXC3PYvYWd8NXvphLSkJIasrlD2/HOqQ+RjcRdjKTGWYhhVUm4yxlyiGPuMsZR7sMCHUBeTuNWA7if+ifXgc/hovftHXs/DV+Fvwe+f8shzMiMcweFgBly3//vwJfg5AN4450fn1Hd1Rm1aBLu22Dy3y3H2+OqMemkbGZ4jozcDjJf6596xOLpC0eMTHbKnxLxH27uZ/bMTGs2jOaMOY4m87CfQwF0dw53oa1k80JRuz/XgS+8fX3N9Af4qPIMfzKgCp4H5TDGe9GGeFPzSsZz80SlPTxXjgwJmC45njzgt2vbQ4b4OAdUK4/vWhO8d8v6EE8fMUsfakXbPpFJeLs2ubM/qdm/la3WP91uWhxXHjoWhyRUq2iJ/+5mA73zwIIo+LoZ/SgvIRjAd1IMvvn98PfgOvAJfhhm8scAKVWDuaRaK8aQ9f7vuPDH6Bj47ZXau7rqYJ66mTDwEDU6lLbCjCK0qTXyl5mnDoeNRxanj3FJbaksTk0faXxHxLrssgPkWB9LnA/MFleXcJozzjwsUvUG0X/QCve51qkMDXp9mtcyOy3rwBfdvVJK7D6/ACSzg3RoruIq5UDeESfEmVclDxnniU82vxMLtceD0hGZWzBNPMM/jSPne2OVatiTKUpY5vY7gc0LdUAWeWM5tH+O2I66AOWw9xT2BuyRVLGdoDHUsVRXOo/c+ZdRXvFfnxWyIV4upFLCl9eAL7h8Zv0QH8Ry8pA2cHzQpGesctVA37ZtklBTgHjyvdSeKY/RZw/kJMk0Y25cSNRWSigQtlULPTw+kzuJPeYEkXjQRpoGZobYsLF79pyd1dMRHInbgFTZqNLhDqiIsTNpoex2WLcy0/X6rHcdMMQvFSd5dWA++4P7xv89deACnmr36uGlL69bRCL6BSZsS6c0TU2TKK5gtWCzgAOOwQcurqk9j8whvziZSMLcq5hbuwBEsYjopUBkqw1yYBGpLA97SRElEmx5MCInBY5vgLk94iKqSWmhIGmkJ4Bi9m4L645J68LyY4wsFYBfUg5feP/6gWWm58IEmKQM89hq7KsZNaKtP5TxxrUZZVkNmMJtjbKrGxLNEbHPJxhqy7lAmbC32ZqeF6lTaknRWcYaFpfLUBh/rwaQycCCJmW15Kstv6jRHyJFry2C1ahkkIW0LO75s61+owxK1y3XqweX9m5YLM2DPFeOjn/iiqCKJ+yKXF8t5Yl/kNsqaSCryxPq5xWTFIaP8KSW0RYxqupaUf0RcTNSSdJZGcKYdYA6kdtrtmyBckfKXwqk0pHpUHlwWaffjNRBYFPUDWa8e3Lt/o0R0CdisKDM89cX0pvRHEfM8ca4t0s2Xx4kgo91MPQJ/0c9MQYq0co8MBh7bz1fio0UUHLR4aAIOvOmoYO6kwlEVODSSTliWtOtH6sPkrtctF9ZtJ9GIerBskvhdVS5cFNv9s1BU0AbdUgdK4FG+dRnjFmDTzniRMdZO1QhzMK355vigbdkpz9P6qjUGE5J2qAcXmwJ20cZUiAD0z+pGMx6xkzJkmEf40Hr4qZfVg2XzF9YOyoV5BjzVkUJngKf8lgNYwKECEHrCNDrWZzMlflS3yBhr/InyoUgBc/lKT4pxVrrC6g1YwcceK3BmNxZcAtz3j5EIpqguh9H6wc011YN75cKDLpFDxuwkrPQmUwW4KTbj9mZTwBwLq4aQMUZbHm1rylJ46dzR0dua2n3RYCWZsiHROeywyJGR7mXKlpryyCiouY56sFkBWEnkEB/raeh/Sw4162KeuAxMQpEkzy5alMY5wamMsWKKrtW2WpEWNnReZWONKWjrdsKZarpFjqCslq773PLmEhM448Pc3+FKr1+94vv/rfw4tEcu+lKTBe4kZSdijBrykwv9vbCMPcLQTygBjzVckSLPRVGslqdunwJ4oegtFOYb4SwxNgWLCmD7T9kVjTv5YDgpo0XBmN34Z/rEHp0sgyz7lngsrm4lvMm2Mr1zNOJYJ5cuxuQxwMGJq/TP5emlb8fsQBZviK4t8hFL+zbhtlpwaRSxQRWfeETjuauPsdGxsBVdO7nmP4xvzSoT29pRl7kGqz+k26B3Oy0YNV+SXbbQas1ctC/GarskRdFpKczVAF1ZXnLcpaMuzVe6lZ2g/1ndcvOVgRG3sdUAY1bKD6achijMPdMxV4muKVorSpiDHituH7rSTs7n/4y5DhRXo4FVBN4vO/zbAcxhENzGbHCzU/98Mcx5e7a31kWjw9FCe/zNeYyQjZsWb1uc7U33pN4Mji6hCLhivqfa9Ss6xLg031AgfesA/l99m9fgvnaF9JoE6bYKmkGNK3aPbHB96w3+DnxFm4hs0drLsk7U8kf/N/CvwQNtllna0rjq61sH8L80HAuvwH1tvBy2ChqWSCaYTaGN19sTvlfzFD6n+iKTbvtayfrfe9ueWh6GJFoxLdr7V72a5ZpvHcCPDzma0wTO4EgbLyedxstO81n57LYBOBzyfsOhUKsW1J1BB5vr/tz8RyqOFylQP9Tvst2JALsC5lsH8PyQ40DV4ANzYa4dedNiKNR1s+x2wwbR7q4/4cTxqEk4LWDebfisuo36JXLiWFjOtLrlNWh3K1rRS4xvHcDNlFnNmWBBAl5SWaL3oPOfnvbr5pdjVnEaeBJSYjuLEkyLLsWhKccadmOphZkOPgVdalj2QpSmfOsADhMWE2ZBu4+EEJI4wKTAuCoC4xwQbWXBltpxbjkXJtKxxabo9e7tyhlgb6gNlSbUpMh+l/FaqzVwewGu8BW1Zx7pTpQDJUjb8tsUTW6+GDXbMn3mLbXlXJiGdggxFAoUrtPS3wE4Nk02UZG2OOzlk7fRs7i95QCLo3E0jtrjnM7SR3uS1p4qtS2nJ5OwtQVHgOvArLBFijZUV9QtSl8dAY5d0E0hM0w3HS2DpIeB6m/A1+HfhJcGUq4sOxH+x3f5+VO+Ds9rYNI7zPXOYWPrtf8bYMx6fuOAX5jzNR0PdsuON+X1f7EERxMJJoU6GkTEWBvVolVlb5lh3tKCg6Wx1IbaMDdJ+9sUCc5KC46hKGCk3IVOS4TCqdBNfUs7Kd4iXf2RjnT/LLysJy3XDcHLh/vde3x8DoGvwgsa67vBk91G5Pe/HbOe7xwym0NXbtiuuDkGO2IJDh9oQvJ4cY4vdoqLDuoH9Zl2F/ofsekn8lkuhIlhQcffUtSjytFyp++p6NiE7Rqx/lodgKVoceEp/CP4FfjrquZaTtj2AvH5K/ywpn7M34K/SsoYDAdIN448I1/0/wveW289T1/lX5xBzc8N5IaHr0XMOQdHsIkDuJFifj20pBm5jzwUv9e2FhwRsvhAbalCIuIw3bhJihY3p6nTFFIZgiSYjfTf3aXuOjmeGn4bPoGvwl+CFzTRczBIuHBEeImHc37/lGfwZR0cXzVDOvaKfNHvwe+suZ771K/y/XcBlsoN996JpBhoE2toYxOznNEOS5TJc6Id5GEXLjrWo+LEWGNpPDU4WAwsIRROu+1vM+0oW37z/MBN9kqHnSArwPfgFJ7Cq/Ai3Ie7g7ncmI09v8sjzw9mzOAEXoIHxURueaAce5V80f/DOuuZwHM8vsMb5wBzOFWM7wymTXPAEvm4vcFpZ2ut0VZRjkiP2MlmLd6DIpbGSiHOjdnUHN90hRYmhTnmvhzp1iKDNj+b7t5hi79lWGwQ+HN9RsfFMy0FXbEwhfuczKgCbyxYwBmcFhhvo/7a44v+i3XWcwDP86PzpGQYdWh7csP5dBvZ1jNzdxC8pBGuxqSW5vw40nBpj5JhMwvOzN0RWqERHMr4Lv1kWX84xLR830G3j6yqZ1a8UstTlW+qJPOZ+sZ7xZPKTJLhiNOAFd6tk+jrTH31ncLOxid8+nzRb128HhUcru/y0Wn6iT254YPC6FtVSIMoW2sk727AhvTtrWKZTvgsmckfXYZWeNRXx/3YQ2OUxLDrbHtN11IwrgXT6c8dATDwLniYwxzO4RzuQqTKSC5gAofMZ1QBK3zQ4JWobFbcvJm87FK+6JXrKahLn54m3p+McXzzYtP8VF/QpJuh1OwieElEoI1pRxPS09FBrkq2tWCU59+HdhNtTIqKm8EBrw2RTOEDpG3IKo2Y7mFdLm3ZeVjYwVw11o/oznceMve4CgMfNym/utA/d/ILMR7gpXzRy9eDsgLcgbs8O2Va1L0zzIdwGGemTBuwROHeoMShkUc7P+ISY3KH5ZZeWqO8mFTxQYeXTNuzvvK5FGPdQfuu00DwYFY9dyhctEt+OJDdnucfpmyhzUJzfsJjr29l8S0bXBfwRS9ZT26tmMIdZucch5ZboMz3Nio3nIOsYHCGoDT4kUA9MiXEp9Xsui1S8th/kbWIrMBxDGLodWUQIWcvnXy+9M23xPiSMOiRPqM+YMXkUN3gXFrZJwXGzUaMpJfyRS9ZT0lPe8TpScuRlbMHeUmlaKDoNuy62iWNTWNFYjoxFzuJs8oR+RhRx7O4SVNSXpa0ZJQ0K1LAHDQ+D9IepkMXpcsq5EVCvClBUIzDhDoyKwDw1Lc59GbTeORivugw1IcuaEOaGWdNm+Ps5fQ7/tm0DjMegq3yM3vb5j12qUId5UZD2oxDSEWOZMSqFl/W+5oynWDa/aI04tJRQ2eTXusg86SQVu/nwSYwpW6wLjlqIzwLuxGIvoAvul0PS+ZNz0/akp/pniO/8JDnGyaCkzbhl6YcqmK/69prxPqtpx2+Km9al9sjL+rwMgHw4jE/C8/HQ3m1vBuL1fldbzd8mOueVJ92syqdEY4KJjSCde3mcRw2TA6szxedn+zwhZMps0XrqEsiUjnC1hw0TELC2Ek7uAAdzcheXv1BYLagspxpzSAoZZUsIzIq35MnFQ9DOrlNB30jq3L4pkhccKUAA8/ocvN1Rzx9QyOtERs4CVsJRK/DF71kPYrxYsGsm6RMh4cps5g1DOmM54Ly1ii0Hd3Y/BMk8VWFgBVmhqrkJCPBHAolwZaWzLR9Vb7bcWdX9NyUYE+uB2BKfuaeBUcjDljbYVY4DdtsVWvzRZdWnyUzDpjNl1Du3aloAjVJTNDpcIOVVhrHFF66lLfJL1zJr9PQ2nFJSBaKoDe+sAvLufZVHVzYh7W0h/c6AAZ+7Tvj6q9j68G/cTCS/3n1vLKHZwNi+P+pS0WkZNMBMUl+LDLuiE4omZy71r3UFMwNJV+VJ/GC5ixVUkBStsT4gGKh0Gm4Oy3qvq7Lbmq24nPdDuDR9deR11XzP4vFu3TYzfnIyiSVmgizUYGqkIXNdKTY9pgb9D2Ix5t0+NHkVzCdU03suWkkVZAoCONCn0T35gAeW38de43mf97sMOpSvj4aa1KYUm58USI7Wxxes03bAZdRzk6UtbzMaCQ6IxO0dy7X+XsjoD16hpsBeGz9dfzHj+R/Hp8nCxZRqkEDTaCKCSywjiaoMJ1TITE9eg7Jqnq8HL6gDwiZb0u0V0Rr/rmvqjxKuaLCX7ZWXTvAY+uvm3z8CP7nzVpngqrJpZKwWnCUjIviYVlirlGOzPLI3SMVyp/elvBUjjDkNhrtufFFErQ8pmdSlbK16toBHlt/HV8uHMX/vEGALkV3RJREiSlopxwdMXOZPLZ+ix+kAHpMKIk8UtE1ygtquttwxNhphrIZ1IBzjGF3IIGxGcBj6q8bHJBG8T9vdsoWrTFEuebEZuVxhhClH6P5Zo89OG9fwHNjtNQTpD0TG9PJLEYqvEY6Rlxy+ZZGfL0Aj62/bnQCXp//eeM4KzfQVJbgMQbUjlMFIm6TpcfWlZje7NBSV6IsEVmumWIbjiloUzQX9OzYdo8L1wjw2PrrpimONfmfNyzKklrgnEkSzT5QWYQW40YShyzqsRmMXbvVxKtGuYyMKaU1ugenLDm5Ily4iT14fP11Mx+xJv+zZ3MvnfdFqxU3a1W/FTB4m3Qfsyc1XUcdVhDeUDZXSFHHLQj/Y5jtC7ZqM0CXGwB4bP11i3LhOvzPGygYtiUBiwQV/4wFO0majijGsafHyRLu0yG6q35cL1rOpVxr2s5cM2jJYMCdc10Aj6q/blRpWJ//+dmm5psMl0KA2+AFRx9jMe2WbC4jQxnikd4DU8TwUjRVacgdlhmr3bpddzuJ9zXqr2xnxJfzP29RexdtjDVZqzkqa6PyvcojGrfkXiJ8SEtml/nYskicv0ivlxbqjemwUjMw5evdg8fUX9nOiC/lf94Q2i7MURk9nW1MSj5j8eAyV6y5CN2S6qbnw3vdA1Iwq+XOSCl663udN3IzLnrt+us25cI1+Z83SXQUldqQq0b5XOT17bGpLd6ssN1VMPf8c+jG8L3NeCnMdF+Ra3fRa9dft39/LuZ/3vwHoHrqGmQFafmiQw6eyzMxS05K4bL9uA+SKUQzCnSDkqOGokXyJvbgJ/BHI+qvY69//4rl20NsmK2ou2dTsyIALv/91/8n3P2Aao71WFGi8KKv1fRC5+J67Q/507/E/SOshqN5TsmYIjVt+kcjAx98iz/4SaojbIV1rexE7/C29HcYD/DX4a0rBOF5VTu7omsb11L/AWcVlcVZHSsqGuXLLp9ha8I//w3Mv+T4Ew7nTBsmgapoCrNFObIcN4pf/Ob/mrvHTGqqgAupL8qWjWPS9m/31jAe4DjA+4+uCoQoT/zOzlrNd3qd4SdphFxsUvYwGWbTWtISc3wNOWH+kHBMfc6kpmpwPgHWwqaSUG2ZWWheYOGQGaHB+eQ/kn6b3pOgLV+ODSn94wDvr8Bvb70/LLuiPPEr8OGVWfDmr45PZyccEmsVXZGe1pRNX9SU5+AVQkNTIVPCHF/jGmyDC9j4R9LfWcQvfiETmgMMUCMN1uNCakkweZsowdYobiMSlnKA93u7NzTXlSfe+SVbfnPQXmg9LpYAQxpwEtONyEyaueWM4FPjjyjG3uOaFmBTWDNgBXGEiQpsaWhnAqIijB07Dlsy3fUGeP989xbWkyf+FF2SNEtT1E0f4DYYVlxFlbaSMPIRMk/3iMU5pME2SIWJvjckciebkQuIRRyhUvkHg/iUljG5kzVog5hV7vIlCuBrmlhvgPfNHQM8lCf+FEGsYbMIBC0qC9a0uuy2wLXVbLBaP5kjHokCRxapkQyzI4QEcwgYHRZBp+XEFTqXFuNVzMtjXLJgX4gAid24Hjwc4N3dtVSe+NNiwTrzH4WVUOlDobUqr1FuAgYllc8pmzoVrELRHSIW8ViPxNy4xwjBpyR55I6J220qQTZYR4guvUICJiSpr9gFFle4RcF/OMB7BRiX8sSfhpNSO3lvEZCQfLUVTKT78Ek1LRLhWN+yLyTnp8qWUZ46b6vxdRGXfHVqx3eI75YaLa4iNNiK4NOW7wPW6lhbSOF9/M9qw8e/aoB3d156qTzxp8pXx5BKAsYSTOIIiPkp68GmTq7sZtvyzBQaRLNxIZ+paozHWoLFeExIhRBrWitHCAHrCF7/thhD8JhYz84wg93QRV88wLuLY8zF8sQ36qF1J455bOlgnELfshKVxYOXKVuKx0jaj22sczTQqPqtV/XDgpswmGTWWMSDw3ssyUunLLrVPGjYRsH5ggHeHSWiV8kT33ycFSfMgkoOK8apCye0J6VW6GOYvffgU9RWsukEi2kUV2nl4dOYUzRik9p7bcA4ggdJ53LxKcEe17B1R8eqAd7dOepV8sTXf5lhejoL85hUdhDdknPtKHFhljOT+bdq0hxbm35p2nc8+Ja1Iw+tJykgp0EWuAAZYwMVwac5KzYMslhvgHdHRrxKnvhTYcfKsxTxtTETkjHO7rr3zjoV25lAQHrqpV7bTiy2aXMmUhTBnKS91jhtR3GEoF0oLnWhWNnYgtcc4N0FxlcgT7yz3TgNIKkscx9jtV1ZKpWW+Ub1tc1eOv5ucdgpx+FJy9pgbLE7xDyXb/f+hLHVGeitHOi6A7ybo3sF8sS7w7cgdk0nJaOn3hLj3uyD0Zp5pazFIUXUpuTTU18d1EPkDoX8SkmWTnVIozEdbTcZjoqxhNHf1JrSS/AcvHjZ/SMHhL/7i5z+POsTUh/8BvNfYMTA8n+yU/MlTZxSJDRStqvEuLQKWwDctMTQogUDyQRoTQG5Kc6oQRE1yV1jCA7ri7jdZyK0sYTRjCR0Hnnd+y7nHxNgTULqw+8wj0mQKxpYvhjm9uSUxg+TTy7s2GtLUGcywhXSKZN275GsqlclX90J6bRI1aouxmgL7Q0Nen5ziM80SqMIo8cSOo+8XplT/5DHNWsSUr/6lLN/QQ3rDyzLruEW5enpf7KqZoShEduuSFOV7DLX7Ye+GmXb6/hnNNqKsVXuMDFpb9Y9eH3C6NGEzuOuI3gpMH/I6e+zDiH1fXi15t3vA1czsLws0TGEtmPEJdiiFPwlwKbgLHAFk4P6ZyPdymYYHGE0dutsChQBl2JcBFlrEkY/N5bQeXQ18gjunuMfMfsBlxJSx3niO485fwO4fGD5T/+3fPQqkneWVdwnw/3bMPkW9Wbqg+iC765Zk+xcT98ibKZc2EdgHcLoF8cSOo/Oc8fS+OyEULF4g4sJqXVcmfMfsc7A8v1/yfGXmL9I6Fn5pRwZhsPv0TxFNlAfZCvG+Oohi82UC5f/2IsJo0cTOm9YrDoKhFPEUr/LBYTUNht9zelHXDqwfPCIw4owp3mOcIQcLttWXFe3VZ/j5H3cIc0G6oPbCR+6Y2xF2EC5cGUm6wKC5tGEzhsWqw5hNidUiKX5gFWE1GXh4/Qplw4sVzOmx9QxU78g3EF6wnZlEN4FzJ1QPSLEZz1KfXC7vd8ssGdIbNUYpVx4UapyFUHzJoTOo1McSkeNn1M5MDQfs4qQuhhX5vQZFw8suwWTcyYTgioISk2YdmkhehG4PkE7w51inyAGGaU+uCXADabGzJR1fn3lwkty0asIo8cROm9Vy1g0yDxxtPvHDAmpu+PKnM8Ix1wwsGw91YJqhteaWgjYBmmQiebmSpwKKzE19hx7jkzSWOm66oPbzZ8Yj6kxVSpYjVAuvLzYMCRo3oTQecOOjjgi3NQ4l9K5/hOGhNTdcWVOTrlgYNkEXINbpCkBRyqhp+LdRB3g0OU6rMfW2HPCFFMV9nSp+uB2woepdbLBuJQyaw/ZFysXrlXwHxI0b0LovEkiOpXGA1Ijagf+KUNC6rKNa9bQnLFqYNkEnMc1uJrg2u64ELPBHpkgWbmwKpJoDhMwNbbGzAp7Yg31wS2T5rGtzit59PrKhesWG550CZpHEzpv2NGRaxlNjbMqpmEIzygJqQfjypycs2pg2cS2RY9r8HUqkqdEgKTWtWTKoRvOBPDYBltja2SO0RGjy9UHtxwRjA11ujbKF+ti5cIR9eCnxUg6owidtyoU5tK4NLji5Q3HCtiyF2IqLGYsHViOXTXOYxucDqG0HyttqYAKqYo3KTY1ekyDXRAm2AWh9JmsVh/ccg9WJ2E8YjG201sPq5ULxxX8n3XLXuMInbft2mk80rRGjCGctJ8/GFdmEQ9Ug4FlE1ll1Y7jtiraqm5Fe04VV8lvSVBL8hiPrfFVd8+7QH3Qbu2ipTVi8cvSGivc9cj8yvH11YMHdNSERtuOslM97feYFOPKzGcsI4zW0YGAbTAOaxCnxdfiYUmVWslxiIblCeAYr9VYR1gM7GmoPrilunSxxeT3DN/2eBQ9H11+nk1adn6VK71+5+Jfct4/el10/7KBZfNryUunWSCPxPECk1rdOv1WVSrQmpC+Tl46YD3ikQYcpunSQgzVB2VHFhxHVGKDgMEY5GLlQnP7FMDzw7IacAWnO6sBr12u+XanW2AO0wQ8pknnFhsL7KYIqhkEPmEXFkwaN5KQphbkUmG72wgw7WSm9RiL9QT925hkjiVIIhphFS9HKI6/8QAjlpXqg9W2C0apyaVDwKQwrwLY3j6ADR13ZyUNByQXHQu6RY09Hu6zMqXRaNZGS/KEJs0cJEe9VH1QdvBSJv9h09eiRmy0V2uJcqHcShcdvbSNg5fxkenkVprXM9rDVnX24/y9MVtncvbKY706anNl3ASll9a43UiacVquXGhvq4s2FP62NGKfQLIQYu9q1WmdMfmUrDGt8eDS0cXozH/fjmUH6Jruvm50hBDSaEU/2Ru2LEN/dl006TSc/g7tfJERxGMsgDUEr104pfWH9lQaN+M4KWQjwZbVc2rZVNHsyHal23wZtIs2JJqtIc/WLXXRFCpJkfE9jvWlfFbsNQ9pP5ZBS0zKh4R0aMFj1IjTcTnvi0Zz2rt7NdvQb2mgbju1plsH8MmbnEk7KbK0b+wC2iy3aX3szW8xeZvDwET6hWZYwqTXSSG+wMETKum0Dq/q+x62gt2ua2ppAo309TRk9TPazfV3qL9H8z7uhGqGqxNVg/FKx0HBl9OVUORn8Q8Jx9gFttGQUDr3tzcXX9xGgN0EpzN9mdZ3GATtPhL+CjxFDmkeEU6x56kqZRusLzALXVqkCN7zMEcqwjmywDQ6OhyUe0Xao1Qpyncrg6wKp9XfWDsaZplElvQ/b3sdweeghorwBDlHzgk1JmMc/wiERICVy2VJFdMjFuLQSp3S0W3+sngt2njwNgLssFGVQdJ0tu0KH4ky1LW4yrbkuaA6Iy9oz/qEMMXMMDWyIHhsAyFZc2peV9hc7kiKvfULxCl9iddfRK1f8kk9qvbdOoBtOg7ZkOZ5MsGrSHsokgLXUp9y88smniwWyuFSIRVmjplga3yD8Uij5QS1ZiM4U3Qw5QlSm2bXjFe6jzzBFtpg+/YBbLAWG7OPynNjlCw65fukGNdkJRf7yM1fOxVzbxOJVocFoYIaGwH22mIQkrvu1E2nGuebxIgW9U9TSiukPGU+Lt++c3DJPKhyhEEbXCQLUpae2exiKy6tMPe9mDRBFCEMTWrtwxN8qvuGnt6MoihKWS5NSyBhbH8StXoAz8PLOrRgLtOT/+4vcu+7vDLnqNvztOq7fmd8sMmY9Xzn1zj8Dq8+XVdu2Nv0IIySgEdQo3xVHps3Q5i3fLFsV4aiqzAiBhbgMDEd1uh8qZZ+lwhjkgokkOIv4xNJmyncdfUUzgB4oFMBtiu71Xumpz/P+cfUP+SlwFExwWW62r7b+LSPxqxn/gvMZ5z9C16t15UbNlq+jbGJtco7p8wbYlL4alSyfWdeuu0j7JA3JFNuVAwtst7F7FhWBbPFNKIUORndWtLraFLmMu7KFVDDOzqkeaiN33YAW/r76wR4XDN/yN1z7hejPau06EddkS/6XThfcz1fI/4K736fO48vlxt2PXJYFaeUkFS8U15XE3428xdtn2kc8GQlf1vkIaNRRnOMvLTWrZbElEHeLWi1o0dlKPAh1MVgbbVquPJ5+Cr8LU5/H/+I2QlHIU2ClXM9G8v7Rr7oc/hozfUUgsPnb3D+I+7WF8kNO92GY0SNvuxiE+2Bt8prVJTkzE64sfOstxuwfxUUoyk8VjcTlsqe2qITSFoSj6Epd4KsT6BZOWmtgE3hBfir8IzZDwgV4ZTZvD8VvPHERo8v+vL1DASHTz/i9OlKueHDjK5Rnx/JB1Vb1ioXdBra16dmt7dgik10yA/FwJSVY6XjA3oy4SqM2frqDPPSRMex9qs3XQtoWxMj7/Er8GWYsXgjaVz4OYumP2+9kbxvny/6kvWsEBw+fcb5bInc8APdhpOSs01tEqIkoiZjbAqKMruLbJYddHuHFRIyJcbdEdbl2sVLaySygunutBg96Y2/JjKRCdyHV+AEFtTvIpbKIXOamknYSiB6KV/0JetZITgcjjk5ZdaskBtWO86UF0ap6ozGXJk2WNiRUlCPFir66lzdm/SLSuK7EUdPz8f1z29Skq6F1fXg8+5UVR6bszncP4Tn4KUkkdJ8UFCY1zR1i8RmL/qQL3rlei4THG7OODlnKko4oI01kd3CaM08Ia18kC3GNoVaO9iDh+hWxSyTXFABXoau7Q6q9OxYg/OVEMw6jdbtSrJ9cBcewGmaZmg+bvkUnUUaGr+ZfnMH45Ivevl61hMcXsxYLFTu1hTm2zViCp7u0o5l+2PSUh9bDj6FgYypufBDhqK2+oXkiuHFHR3zfj+9PtA8oR0xnqX8qn+sx3bFODSbbF0X8EUvWQ8jBIcjo5bRmLOljDNtcqNtOe756h3l0VhKa9hDd2l1eqmsnh0MNMT/Cqnx6BInumhLT8luljzQ53RiJeA/0dxe5NK0o2fA1+GLXr6eNQWHNUOJssQaTRlGpLHKL9fD+IrQzTOMZS9fNQD4AnRNVxvTdjC+fJdcDDWQcyB00B0t9BDwTxXgaAfzDZ/DBXzRnfWMFRwuNqocOmX6OKNkY63h5n/fFcB28McVHqnXZVI27K0i4rDLNE9lDKV/rT+udVbD8dFFu2GGZ8mOt0kAXcoX3ZkIWVtw+MNf5NjR2FbivROHmhV1/pj2egv/fMGIOWTIWrV3Av8N9imV9IWml36H6cUjqEWNv9aNc+veb2sH46PRaHSuMBxvtW+twxctq0z+QsHhux8Q7rCY4Ct8lqsx7c6Sy0dl5T89rIeEuZKoVctIk1hNpfavER6yyH1Vvm3MbsUHy4ab4hWr/OZPcsRBphnaV65/ZcdYPNNwsjN/djlf9NqCw9U5ExCPcdhKxUgLSmfROpLp4WSUr8ojdwbncbvCf+a/YzRaEc6QOvXcGO256TXc5Lab9POvB+AWY7PigWYjzhifbovuunzRawsO24ZqQQAqguBtmpmPB7ysXJfyDDaV/aPGillgz1MdQg4u5MYaEtBNNHFjkRlSpd65lp4hd2AVPTfbV7FGpyIOfmNc/XVsPfg7vzaS/3nkvLL593ANLvMuRMGpQIhiF7kUEW9QDpAUbTWYBcbp4WpacHHY1aacqQyjGZS9HI3yCBT9kUZJhVOD+zUDvEH9ddR11fzPcTDQ5TlgB0KwqdXSavk9BC0pKp0WmcuowSw07VXmXC5guzSa4p0UvRw2lbDiYUx0ExJJRzWzi6Gm8cnEkfXXsdcG/M/jAJa0+bmCgdmQ9CYlNlSYZOKixmRsgiFxkrmW4l3KdFKv1DM8tk6WxPYJZhUUzcd8Kdtgrw/gkfXXDT7+avmfVak32qhtkg6NVdUS5wgkru1YzIkSduTW1FDwVWV3JQVJVuieTc0y4iDpFwc7/BvSalvKdQM8sv662cevz/+8sQVnjVAT0W2wLllw1JiMhJRxgDjCjLQsOzSFSgZqx7lAW1JW0e03yAD3asC+GD3NbQhbe+mN5GXH1F83KDOM4n/e5JIuH4NpdQARrFPBVptUNcjj4cVMcFSRTE2NpR1LEYbYMmfWpXgP9KejaPsLUhuvLCsVXznAG9dfx9SR1ud/3hZdCLHb1GMdPqRJgqDmm76mHbvOXDtiO2QPUcKo/TWkQ0i2JFXpBoo7vij1i1Lp3ADAo+qvG3V0rM//vFnnTE4hxd5Ka/Cor5YEdsLVJyKtDgVoHgtW11pWSjolPNMnrlrVj9Fv2Qn60twMwKPqr+N/wvr8z5tZcDsDrv06tkqyzESM85Ycv6XBWA2birlNCXrI6VbD2lx2L0vQO0QVTVVLH4SE67fgsfVXv8n7sz7/85Z7cMtbE6f088wSaR4kCkCm10s6pKbJhfqiUNGLq+0gLWC6eUAZFPnLjwqtKd8EwGvWX59t7iPW4X/eAN1svgRVSY990YZg06BD1ohLMtyFTI4pKTJsS9xREq9EOaPWiO2gpms7397x6nQJkbh+Fz2q/rqRROX6/M8bJrqlVW4l6JEptKeUFuMYUbtCQ7CIttpGc6MY93x1r1vgAnRXvY5cvwWPqb9uWQm+lP95QxdNMeWhOq1x0Db55C7GcUv2ZUuN6n8iKzsvOxibC//Yfs9Na8r2Rlz02vXXDT57FP/zJi66/EJSmsJKa8QxnoqW3VLQ+jZVUtJwJ8PNX1NQCwfNgdhhHD9on7PdRdrdGPF28rJr1F+3LBdeyv+8yYfLoMYet1vX4upNAjVvwOUWnlNXJXlkzk5Il6kqeoiL0C07qno+/CYBXq/+utlnsz7/Mzvy0tmI4zm4ag23PRN3t/CWryoUVJGm+5+K8RJ0V8Hc88/XHUX/HfiAq7t+BH+x6v8t438enWmdJwFA6ZINriLGKv/95f8lT9/FnyA1NMVEvQyaXuu+gz36f/DD73E4pwqpLcvm/o0Vle78n//+L/NPvoefp1pTJye6e4A/D082FERa5/opeH9zpvh13cNm19/4v/LDe5xMWTi8I0Ta0qKlK27AS/v3/r+/x/2GO9K2c7kVMonDpq7//jc5PKCxeNPpFVzaRr01wF8C4Pu76hXuX18H4LduTr79guuFD3n5BHfI+ZRFhY8w29TYhbbLi/bvBdqKE4fUgg1pBKnV3FEaCWOWyA+m3WpORZr/j+9TKJtW8yBTF2/ZEODI9/QavHkVdGFp/Pjn4Q+u5hXapsP5sOH+OXXA1LiKuqJxiMNbhTkbdJTCy4llEt6NnqRT4dhg1V3nbdrm6dYMecA1yTOL4PWTE9L5VzPFlLBCvlG58AhehnN4uHsAYinyJ+AZ/NkVvELbfOBUuOO5syBIEtiqHU1k9XeISX5bsimrkUUhnGDxourN8SgUsCZVtKyGbyGzHXdjOhsAvOAswSRyIBddRdEZWP6GZhNK/yjwew9ehBo+3jEADu7Ay2n8mDc+TS7awUHg0OMzR0LABhqLD4hJEh/BEGyBdGlSJoXYXtr+3HS4ijzVpgi0paWXtdruGTknXBz+11qT1Q2inxaTzQCO46P3lfLpyS4fou2PH/PupwZgCxNhGlj4IvUuWEsTkqMWm6i4xCSMc9N1RDQoCVcuGItJ/MRWefais+3synowi/dESgJjkilnWnBTGvRWmaw8oR15257t7CHmCf8HOn7cwI8+NQBXMBEmAa8PMRemrNCEhLGEhDQKcGZWS319BX9PFBEwGTbRBhLbDcaV3drFcDqk5kCTd2JF1Wp0HraqBx8U0wwBTnbpCadwBA/gTH/CDrcCs93LV8E0YlmmcyQRQnjBa8JESmGUfIjK/7fkaDJpmD2QptFNVJU1bbtIAjjWQizepOKptRjbzR9Kag6xZmMLLjHOtcLT3Tx9o/0EcTT1XN3E45u24AiwEypDJXihKjQxjLprEwcmRKclaDNZCVqr/V8mYWyFADbusiY5hvgFoU2vio49RgJLn5OsReRFN6tabeetiiy0V7KFHT3HyZLx491u95sn4K1QQSPKM9hNT0wMVvAWbzDSVdrKw4zRjZMyJIHkfq1VAVCDl/bUhNKlGq0zGr05+YAceXVPCttVk0oqjVwMPt+BBefx4yPtGVkUsqY3CHDPiCM5ngupUwCdbkpd8kbPrCWHhkmtIKLEetF2499eS1jZlIPGYnlcPXeM2KD9vLS0bW3ktYNqUllpKLn5ZrsxlIzxvDu5eHxzGLctkZLEY4PgSOg2IUVVcUONzUDBEpRaMoXNmUc0tFZrTZquiLyKxrSm3DvIW9Fil+AkhXu5PhEPx9mUNwqypDvZWdKlhIJQY7vn2OsnmBeOWnYZ0m1iwbbw1U60by5om47iHRV6fOgzjMf/DAZrlP40Z7syxpLK0lJ0gqaAK1c2KQKu7tabTXkLFz0sCftuwX++MyNeNn68k5Buq23YQhUh0SNTJa1ioQ0p4nUG2y0XilF1JqODqdImloPS4Bp111DEWT0jJjVv95uX9BBV7eB3bUWcu0acSVM23YZdd8R8UbQUxJ9wdu3oMuhdt929ME+mh6JXJ8di2RxbTi6TbrDquqV4aUKR2iwT6aZbyOwEXN3DUsWr8Hn4EhwNyHuXHh7/pdaUjtR7vnDh/d8c9xD/s5f501eQ1+CuDiCvGhk1AN/4Tf74RfxPwD3toLarR0zNtsnPzmS64KIRk861dMWCU8ArasG9T9H0ZBpsDGnjtAOM2+/LuIb2iIUGXNgl5ZmKD/Tw8TlaAuihaFP5yrw18v4x1898zIdP+DDAX1bM3GAMvPgRP/cJn3zCW013nrhHkrITyvYuwOUkcHuKlRSW5C6rzIdY4ppnF7J8aAJbQepgbJYBjCY9usGXDKQxq7RZfh9eg5d1UHMVATRaD/4BHK93/1iAgYZ/+jqPn8Dn4UExmWrpa3+ZOK6MvM3bjwfzxNWA2dhs8+51XHSPJiaAhGSpWevEs5xHLXcEGFXYiCONySH3fPWq93JIsBiSWvWyc3CAN+EcXoT7rCSANloPPoa31rt/5PUA/gp8Q/jDD3hyrjzlR8VkanfOvB1XPubt17vzxAfdSVbD1pzAnfgyF3ycadOTOTXhpEUoLC1HZyNGW3dtmjeXgr2r56JNmRwdNNWaQVBddd6rh4MhviEB9EFRD/7RGvePvCbwAL4Mx/D6M541hHO4D3e7g6PafdcZVw689z7NGTwo5om7A8sPhccT6qKcl9NJl9aM/9kX+e59Hh1yPqGuCCZxuITcsmNaJ5F7d0q6J3H48TO1/+M57085q2icdu2U+W36Ldllz9Agiv4YGljoEN908EzvDOrBF98/vtJwCC/BF2AG75xxEmjmMIcjxbjoaxqOK3/4hPOZzhMPBpYPG44CM0dTVm1LjLtUWWVz1Bcf8tEx0zs8O2A2YVHRxKYOiy/aOVoAaMu0i7ubu43njjmd4ibMHU1sIDHaQNKrZND/FZYdk54oCXetjq7E7IVl9eAL7t+oHnwXXtLx44czzoRFHBztYVwtH1d+NOMkupZ5MTM+gUmq90X+Bh9zjRlmaQ+m7YMqUL/veemcecAtOJ0yq1JnVlN27di2E0+Klp1tAJ4KRw1eMI7aJjsO3R8kPSI3fUFXnIOfdQe86sIIVtWDL7h//Ok6vj8vwDk08NEcI8zz7OhBy+WwalzZeZ4+0XniRfst9pAJqQHDGLzVQ2pheZnnv1OWhwO43/AgcvAEXEVVpa4db9sGvNK8wjaENHkfFQ4Ci5i7dqnQlPoLQrHXZDvO3BIXZbJOBrOaEbML6sFL798I4FhKihjHMsPjBUZYCMFr6nvaArxqXPn4lCa+cHfSa2cP27g3Z3ziYTRrcbQNGLQmGF3F3cBdzzzX7AILx0IB9rbwn9kx2G1FW3Inic+ZLIsVvKR8Zwfj0l1fkqo8LWY1M3IX14OX3r9RKTIO+d9XzAI8qRPGPn/4NC2n6o4rN8XJ82TOIvuVA8zLKUHRFgBCetlDZlqR1gLKjS39xoE7Bt8UvA6BxuEDjU3tFsEijgA+615tmZkXKqiEENrh41iLDDZNq4pKTWR3LZfnos81LOuNa15cD956vLMsJd1rqYp51gDUQqMYm2XsxnUhD2jg1DM7SeuJxxgrmpfISSXVIJIS5qJJSvJPEQ49DQTVIbYWJ9QWa/E2+c/oPK1drmC7WSfJRNKBO5Yjvcp7Gc3dmmI/Xh1kDTEuiSnWqQf37h+fTMhGnDf6dsS8SQfQWlqqwXXGlc/PEZ/SC5mtzIV0nAshlQdM/LvUtYutrEZ/Y+EAFtq1k28zQhOwLr1AIeANzhF8t9qzTdZf2qRKO6MWE9ohBYwibbOmrFtNmg3mcS+tB28xv2uKd/agYCvOP+GkSc+0lr7RXzyufL7QbkUpjLjEWFLqOIkAGu2B0tNlO9Eau2W1qcOUvVRgKzypKIQZ5KI3q0MLzqTNRYqiZOqmtqloIRlmkBHVpHmRYV6/HixbO6UC47KOFJnoMrVyr7wYz+SlW6GUaghYbY1I6kkxA2W1fSJokUdSh2LQ1GAimRGm0MT+uu57H5l7QgOWxERpO9moLRPgTtquWCfFlGlIjQaRly9odmzMOWY+IBO5tB4sW/0+VWGUh32qYk79EidWKrjWuiLpiVNGFWFRJVktyeXWmbgBBzVl8anPuXyNJlBJOlKLTgAbi/EYHVHxWiDaVR06GnHQNpJcWcK2jJtiCfG2sEHLzuI66sGrMK47nPIInPnu799935aOK2cvmvubrE38ZzZjrELCmXM2hM7UcpXD2oC3+ECVp7xtIuxptJ0jUr3sBmBS47TVxlvJ1Sqb/E0uLdvLj0lLr29ypdd/eMX3f6lrxGlKwKQxEGvw0qHbkbwrF3uHKwVENbIV2wZ13kNEF6zD+x24aLNMfDTCbDPnEikZFyTNttxWBXDaBuM8KtI2rmaMdUY7cXcUPstqTGvBGSrFWIpNMfbdea990bvAOC1YX0qbc6smDS1mPxSJoW4fwEXvjMmhlijDRq6qale6aJEuFGoppYDoBELQzLBuh/mZNx7jkinv0EtnUp50lO9hbNK57lZaMAWuWR5Yo9/kYwcYI0t4gWM47Umnl3YmpeBPqSyNp3K7s2DSAS/39KRuEN2bS4xvowV3dFRMx/VFcp2Yp8w2nTO9hCXtHG1kF1L4KlrJr2wKfyq77R7MKpFKzWlY9UkhYxyHWW6nBWPaudvEAl3CGcNpSXPZ6R9BbBtIl6cHL3gIBi+42CYXqCx1gfGWe7Ap0h3luyXdt1MKy4YUT9xSF01G16YEdWsouW9mgDHd3veyA97H+Ya47ZmEbqMY72oPztCGvK0onL44AvgC49saZKkWRz4veWljE1FHjbRJaWv6ZKKtl875h4CziFCZhG5rx7tefsl0aRT1bMHZjm8dwL/6u7wCRysaQblQoG5yAQN5zpatMNY/+yf8z+GLcH/Qn0iX2W2oEfXP4GvwQHuIL9AYGnaO3zqAX6946nkgqZNnUhx43DIdQtMFeOPrgy/y3Yd85HlJWwjLFkU3kFwq28xPnuPhMWeS+tDLV9Otllq7pQCf3uXJDN9wFDiUTgefHaiYbdfi3b3u8+iY6TnzhgehI1LTe8lcd7s1wJSzKbahCRxKKztTLXstGAiu3a6rPuQs5pk9TWAan5f0BZmGf7Ylxzzk/A7PAs4QPPPAHeFQ2hbFHszlgZuKZsJcUmbDC40sEU403cEjczstOEypa+YxevL4QBC8oRYqWdK6b7sK25tfE+oDZgtOQ2Jg8T41HGcBE6fTWHn4JtHcu9S7uYgU5KSCkl/mcnq+5/YBXOEr6lCUCwOTOM1taOI8mSxx1NsCXBEmLKbMAg5MkwbLmpBaFOPrNSlO2HnLiEqW3tHEwd8AeiQLmn+2gxjC3k6AxREqvKcJbTEzlpLiw4rNZK6oJdidbMMGX9FULKr0AkW+2qDEPBNNm5QAt2Ik2nftNWHetubosHLo2nG4vQA7GkcVCgVCgaDixHqo9UUn1A6OshapaNR/LPRYFV8siT1cCtJE0k/3WtaNSuUZYKPnsVIW0xXWnMUxq5+En4Kvw/MqQmVXnAXj9Z+9zM98zM/Agy7F/qqj2Nh67b8HjFnPP3iBn/tkpdzwEJX/whIcQUXOaikeliCRGUk7tiwF0rItwMEhjkZ309hikFoRAmLTpEXWuHS6y+am/KB/fM50aLEhGnSMwkpxzOov4H0AvgovwJ1iGzDLtJn/9BU+fAINfwUe6FHSLhu83viV/+/HrOePX+STT2B9uWGbrMHHLldRBlhS/CJQmcRxJFqZica01XixAZsYiH1uolZxLrR/SgxVIJjkpQP4PE9sE59LKLr7kltSBogS5tyszzH8Fvw8/AS8rNOg0xUS9fIaHwb+6et8Q/gyvKRjf5OusOzGx8evA/BP4IP11uN/grca5O0lcsPLJ5YjwI4QkJBOHa0WdMZYGxPbh2W2nR9v3WxEWqgp/G3+6VZbRLSAAZ3BhdhAaUL33VUSw9yjEsvbaQ9u4A/gGXwZXoEHOuU1GSj2chf+Mo+f8IcfcAxfIKVmyunRbYQVnoevwgfw3TXXcw++xNuP4fhyueEUNttEduRVaDttddoP0eSxLe2LENk6itYxlrxBNBYrNNKSQmeaLcm9c8UsaB5WyO6675yyQIAWSDpBVoA/gxmcwEvwoDv0m58UE7gHn+fJOa8/Ywan8EKRfjsopF83eCglX/Sfr7OeaRoQfvt1CGvIDccH5BCvw1sWIzRGC/66t0VTcLZQZtm6PlAasbOJ9iwWtUo7biktTSIPxnR24jxP1ZKaqq+2RcXM9OrBAm/AAs7hDJ5bNmGb+KIfwCs8a3jnjBrOFeMjHSCdbKr+2uOLfnOd9eiA8Hvvwwq54VbP2OqwkB48Ytc4YEOiH2vTXqodabfWEOzso4qxdbqD5L6tbtNPECqbhnA708DZH4QOJUXqScmUlks7Ot6FBuZw3n2mEbaUX7kDzxHOOQk8nKWMzAzu6ZZ8sOFw4RK+6PcuXo9tB4SbMz58ApfKDXf3szjNIIbGpD5TKTRxGkEMLjLl+K3wlWXBsCUxIDU+jbOiysESqAy1MGUJpXgwbTWzNOVEziIXZrJ+VIztl1PUBxTSo0dwn2bOmfDRPD3TRTGlfbCJvO9KvuhL1hMHhB9wPuPRLGHcdOWG2xc0U+5bQtAJT0nRTewXL1pgk2+rZAdeWmz3jxAqfNQQdzTlbF8uJ5ecEIWvTkevAHpwz7w78QujlD/Lr491bD8/1vhM2yrUQRrWXNQY4fGilfctMWYjL72UL/qS9eiA8EmN88nbNdour+PBbbAjOjIa4iBhfFg6rxeKdEGcL6p3EWR1Qq2Qkhs2DrnkRnmN9tG2EAqmgPw6hoL7Oza7B+3SCrR9tRftko+Lsf2F/mkTndN2LmzuMcKTuj/mX2+4Va3ki16+nnJY+S7MefpkidxwnV+4wkXH8TKnX0tsYzYp29DOOoSW1nf7nTh2akYiWmcJOuTidSaqESrTYpwjJJNVGQr+rLI7WsqerHW6Kp/oM2pKuV7T1QY9gjqlZp41/WfKpl56FV/0kvXQFRyeQ83xaTu5E8p5dNP3dUF34ihyI3GSpeCsywSh22ZJdWto9winhqifb7VRvgktxp13vyjrS0EjvrRfZ62uyqddSWaWYlwTPAtJZ2oZ3j/Sgi/mi+6vpzesfAcWNA0n8xVyw90GVFGuZjTXEQy+6GfLGLMLL523f5E0OmxVjDoOuRiH91RKU+vtoCtH7TgmvBLvtFXWLW15H9GTdVw8ow4IlRLeHECN9ym1e9K0I+Cbnhgv4Yu+aD2HaQJ80XDqOzSGAV4+4yCqBxrsJAX6ZTIoX36QnvzhhzzMfFW2dZVLOJfo0zbce5OvwXMFaZ81mOnlTVXpDZsQNuoYWveketKb5+6JOOsgX+NTm7H49fUTlx+WLuWL7qxnOFh4BxpmJx0p2gDzA/BUARuS6phR+pUsY7MMboAHx5xNsSVfVZcYSwqCKrqon7zM+8ecCkeS4nm3rINuaWvVNnMRI1IRpxTqx8PZUZ0Br/UEduo3B3hNvmgZfs9gQPj8vIOxd2kndir3awvJ6BLvoUuOfFWNYB0LR1OQJoUySKb9IlOBx74q1+ADC2G6rOdmFdJcD8BkfualA+BdjOOzP9uUhGUEX/TwhZsUduwRr8wNuXKurCixLBgpQI0mDbJr9dIqUuV+92ngkJZ7xduCk2yZKbfWrH1VBiTg9VdzsgRjW3CVXCvAwDd+c1z9dWw9+B+8MJL/eY15ZQ/HqvTwVdsZn5WQsgRRnMaWaecu3jFvMBEmgg+FJFZsnSl0zjB9OqPYaBD7qmoVyImFvzi41usesV0julaAR9dfR15Xzv9sEruRDyk1nb+QaLU67T885GTls6YgcY+UiMa25M/pwGrbCfzkvR3e0jjtuaFtnwuagHTSb5y7boBH119HXhvwP487jJLsLJ4XnUkHX5sLbS61dpiAXRoZSCrFJ+EjpeU3puVfitngYNo6PJrAigKktmwjyQdZpfq30mmtulaAx9Zfx15Xzv+cyeuiBFUs9zq8Kq+XB9a4PVvph3GV4E3y8HENJrN55H1X2p8VyqSKwVusJDKzXOZzplWdzBUFK9e+B4+uv468xvI/b5xtSAkBHQaPvtqWzllVvEOxPbuiE6+j2pvjcKsbvI7txnRErgfH7LdXqjq0IokKzga14GzQ23SSbCQvO6r+Or7SMIr/efOkkqSdMnj9mBx2DRsiY29Uj6+qK9ZrssCKaptR6HKURdwUYeUWA2kPzVKQO8ku2nU3Anhs/XWkBx3F/7wJtCTTTIKftthue1ty9xvNYLY/zo5KSbIuKbXpbEdSyeRyYdAIwKY2neyoc3+k1XUaufYga3T9daMUx/r8z1s10ITknIO0kuoMt+TB8jK0lpayqqjsJ2qtXAYwBU932zinimgmd6mTRDnQfr88q36NAI+tv24E8Pr8zxtasBqx0+xHH9HhlrwsxxNUfKOHQaZBITNf0uccj8GXiVmXAuPEAKSdN/4GLHhs/XWj92dN/uetNuBMnVR+XWDc25JLjo5Mg5IZIq226tmCsip2zZliL213YrTlL2hcFjpCduyim3M7/eB16q/blQsv5X/esDRbtJeabLIosWy3ycavwLhtxdWzbMmHiBTiVjJo6lCLjXZsi7p9PEPnsq6X6wd4bP11i0rD5fzPm/0A6brrIsllenZs0lCJlU4abakR59enZKrKe3BZihbTxlyZ2zl1+g0wvgmA166/bhwDrcn/7Ddz0eWZuJvfSESug6NzZsox3Z04FIxz0mUjMwVOOVTq1CQ0AhdbBGVdjG/CgsfUX7esJl3K/7ytWHRv683praW/8iDOCqWLLhpljDY1ZpzK75QiaZoOTpLKl60auHS/97oBXrv+umU9+FL+5+NtLFgjqVLCdbmj7pY5zPCPLOHNCwXGOcLquOhi8CmCWvbcuO73XmMUPab+ug3A6/A/78Bwe0bcS2+tgHn4J5pyS2WbOck0F51Vq3LcjhLvZ67p1ABbaL2H67bg78BfjKi/jr3+T/ABV3ilLmNXTI2SpvxWBtt6/Z//D0z/FXaGbSBgylzlsEGp+5//xrd4/ae4d8DUUjlslfIYS3t06HZpvfQtvv0N7AHWqtjP2pW08QD/FLy//da38vo8PNlKHf5y37Dxdfe/oj4kVIgFq3koLReSR76W/bx//n9k8jonZxzWTANVwEniDsg87sOSd/z7//PvMp3jQiptGVWFX2caezzAXwfgtzYUvbr0iozs32c3Uge7varH+CNE6cvEYmzbPZ9hMaYDdjK4V2iecf6EcEbdUDVUARda2KzO/JtCuDbNQB/iTeL0EG1JSO1jbXS+nLxtPMDPw1fh5+EPrgSEKE/8Gry5A73ui87AmxwdatyMEBCPNOCSKUeRZ2P6Myb5MRvgCHmA9ywsMifU+AYXcB6Xa5GibUC5TSyerxyh0j6QgLVpdyhfArRTTLqQjwe4HOD9s92D4Ap54odXAPBWLAwB02igG5Kkc+piN4lvODIFGAZgT+EO4Si1s7fjSR7vcQETUkRm9O+MXyo9OYhfe4xt9STQ2pcZRLayCV90b4D3jR0DYAfyxJ+eywg2IL7NTMXna7S/RpQ63JhWEM8U41ZyQGjwsVS0QBrEKLu8xwZsbi4wLcCT+OGidPIOCe1PiSc9Qt+go+vYqB7cG+B9d8cAD+WJPz0Am2gxXgU9IneOqDpAAXOsOltVuMzpdakJXrdPCzXiNVUpCeOos5cxnpQT39G+XVLhs1osQVvJKPZyNq8HDwd4d7pNDuWJPxVX7MSzqUDU6gfadKiNlUFTzLeFHHDlzO4kpa7aiKhBPGKwOqxsBAmYkOIpipyXcQSPlRTf+Tii0U3EJGaZsDER2qoB3h2hu0qe+NNwUooYU8y5mILbJe6OuX+2FTKy7bieTDAemaQyQ0CPthljSWO+xmFDIYiESjM5xKd6Ik5lvLq5GrQ3aCMLvmCA9wowLuWJb9xF59hVVP6O0CrBi3ZjZSNOvRy+I6klNVRJYRBaEzdN+imiUXQ8iVF8fsp+W4JXw7WISW7fDh7lptWkCwZ4d7QTXyBPfJMYK7SijjFppGnlIVJBJBYj7eUwtiP1IBXGI1XCsjNpbjENVpSAJ2hq2LTywEly3hUYazt31J8w2+aiLx3g3fohXixPfOMYm6zCGs9LVo9MoW3MCJE7R5u/WsOIjrqBoHUO0bJE9vxBpbhsd3+Nb4/vtPCZ4oZYCitNeYuC/8UDvDvy0qvkiW/cgqNqRyzqSZa/s0mqNGjtKOoTm14zZpUauiQgVfqtQiZjq7Q27JNaSK5ExRcrGCXO1FJYh6jR6CFqK7bZdQZ4t8g0rSlPfP1RdBtqaa9diqtzJkQ9duSryi2brQXbxDwbRUpFMBHjRj8+Nt7GDKgvph9okW7LX47gu0SpGnnFQ1S1lYldOsC7hYteR574ZuKs7Ei1lBsfdz7IZoxzzCVmmVqaSySzQbBVAWDek+N4jh9E/4VqZrJjPwiv9BC1XcvOWgO8275CVyBPvAtTVlDJfZkaZGU7NpqBogAj/xEHkeAuJihWYCxGN6e8+9JtSegFXF1TrhhLGP1fak3pebgPz192/8gB4d/6WT7+GdYnpH7hH/DJzzFiYPn/vjW0SgNpTNuPIZoAEZv8tlGw4+RLxy+ZjnKa5NdFoC7UaW0aduoYse6+bXg1DLg6UfRYwmhGEjqPvF75U558SANrElK/+MdpXvmqBpaXOa/MTZaa1DOcSiLaw9j0NNNst3c+63c7EKTpkvKHzu6bPbP0RkuHAVcbRY8ijP46MIbQeeT1mhA+5PV/inyDdQipf8LTvMXbwvoDy7IruDNVZKTfV4CTSRUYdybUCnGU7KUTDxLgCknqUm5aAW6/1p6eMsOYsphLzsHrE0Y/P5bQedx1F/4yPHnMB3/IOoTU9+BL8PhtjuFKBpZXnYNJxTuv+2XqolKR2UQgHhS5novuxVySJhBNRF3SoKK1XZbbXjVwWNyOjlqWJjrWJIy+P5bQedyldNScP+HZ61xKSK3jyrz+NiHG1hcOLL/+P+PDF2gOkekKGiNWKgJ+8Z/x8Iv4DdQHzcpZyF4v19I27w9/yPGDFQvmEpKtqv/TLiWMfn4sofMm9eAH8Ao0zzh7h4sJqYtxZd5/D7hkYPneDzl5idlzNHcIB0jVlQ+8ULzw/nc5/ojzl2juE0apD7LRnJxe04dMz2iOCFNtGFpTuXA5AhcTRo8mdN4kz30nVjEC4YTZQy4gpC7GlTlrePKhGsKKgeXpCYeO0MAd/GH7yKQUlXPLOasOH3FnSphjHuDvEu4gB8g66oNbtr6eMbFIA4fIBJkgayoXriw2XEDQPJrQeROAlY6aeYOcMf+IVYTU3XFlZufMHinGywaW3YLpObVBAsbjF4QJMsVUSayjk4voPsHJOQfPWDhCgDnmDl6XIRerD24HsGtw86RMHOLvVSHrKBdeVE26gKB5NKHzaIwLOmrqBWJYZDLhASG16c0Tn+CdRhWDgWXnqRZUTnPIHuMJTfLVpkoYy5CzylHVTGZMTwkGAo2HBlkQplrJX6U+uF1wZz2uwS1SQ12IqWaPuO4baZaEFBdukksJmkcTOm+YJSvoqPFzxFA/YUhIvWxcmSdPWTWwbAKVp6rxTtPFUZfKIwpzm4IoMfaYQLWgmlG5FME2gdBgm+J7J+rtS/XBbaVLsR7bpPQnpMFlo2doWaVceHk9+MkyguZNCJ1He+kuHTWyQAzNM5YSUg/GlTk9ZunAsg1qELVOhUSAK0LABIJHLKbqaEbHZLL1VA3VgqoiOKXYiS+HRyaEKgsfIqX64HYWbLRXy/qWoylIV9gudL1OWBNgBgTNmxA6b4txDT4gi3Ri7xFSLxtXpmmYnzAcWDZgY8d503LFogz5sbonDgkKcxGsWsE1OI+rcQtlgBBCSOKD1mtqYpIU8cTvBmAT0yZe+zUzeY92fYjTtGipXLhuR0ePoHk0ofNWBX+lo8Z7pAZDk8mEw5L7dVyZZoE/pTewbI6SNbiAL5xeygW4xPRuLCGbhcO4RIeTMFYHEJkYyEO9HmJfXMDEj/LaH781wHHZEtqSQ/69UnGpzH7LKIAZEDSPJnTesJTUa+rwTepI9dLJEawYV+ZkRn9g+QirD8vF8Mq0jFQ29js6kCS3E1+jZIhgPNanHdHFqFvPJLHqFwQqbIA4jhDxcNsOCCQLDomaL/dr5lyJaJU6FxPFjO3JOh3kVMcROo8u+C+jo05GjMF3P3/FuDLn5x2M04xXULPwaS6hBYki+MrMdZJSgPHlcB7nCR5bJ9Kr5ACUn9jk5kivdd8tk95SOGrtqu9lr2IhK65ZtEl7ZKrp7DrqwZfRUSN1el7+7NJxZbywOC8neNKTch5vsTEMNsoCCqHBCqIPRjIPkm0BjvFODGtto99rCl+d3wmHkW0FPdpZtC7MMcVtGFQjJLX5bdQ2+x9ypdc313uj8xlsrfuLgWXz1cRhZvJYX0iNVBRcVcmCXZs6aEf3RQF2WI/TcCbKmGU3IOoDJGDdDub0+hYckt6PlGu2BcxmhbTdj/klhccLGJMcqRjMJP1jW2ETqLSWJ/29MAoORluJ+6LPffBZbi5gqi5h6catQpmOT7/OFf5UorRpLzCqcMltBLhwd1are3kztrSzXO0LUbXRQcdLh/RdSZ+swRm819REDrtqzC4es6Gw4JCKlSnjYVpo0xeq33PrADbFLL3RuCmObVmPN+24kfa+AojDuM4umKe2QwCf6EN906HwjujaitDs5o0s1y+k3lgbT2W2i7FJdnwbLXhJUBq/9liTctSmFC/0OqUinb0QddTWamtjbHRFuWJJ6NpqZ8vO3fZJ37Db+2GkaPYLGHs7XTTdiFQJ68SkVJFVmY6McR5UycflNCsccHFaV9FNbR4NttLxw4pQ7wJd066Z0ohVbzihaxHVExd/ay04oxUKWt+AsdiQ9OUyZ2krzN19IZIwafSTFgIBnMV73ADj7V/K8u1MaY2sJp2HWm0f41tqwajEvdHWOJs510MaAqN4aoSiPCXtN2KSi46dUxHdaMquar82O1x5jqhDGvqmoE9LfxcY3zqA7/x3HA67r9ZG4O6Cuxu12/+TP+eLP+I+HErqDDCDVmBDO4larujNe7x8om2rMug0MX0rL1+IWwdwfR+p1TNTyNmVJ85ljWzbWuGv8/C7HD/izjkHNZNYlhZcUOKVzKFUxsxxN/kax+8zPWPSFKw80rJr9Tizyj3o1gEsdwgWGoxPezDdZ1TSENE1dLdNvuKL+I84nxKesZgxXVA1VA1OcL49dFlpFV5yJMhzyCmNQ+a4BqusPJ2bB+xo8V9u3x48VVIEPS/mc3DvAbXyoYr6VgDfh5do5hhHOCXMqBZUPhWYbWZECwVJljLgMUWOCB4MUuMaxGNUQDVI50TQ+S3kFgIcu2qKkNSHVoM0SHsgoZxP2d5HH8B9woOk4x5bPkKtAHucZsdykjxuIpbUrSILgrT8G7G5oCW+K0990o7E3T6AdW4TilH5kDjds+H64kS0mz24grtwlzDHBJqI8YJQExotPvoC4JBq0lEjjQkyBZ8oH2LnRsQ4Hu1QsgDTJbO8fQDnllitkxuVskoiKbRF9VwzMDvxHAdwB7mD9yCplhHFEyUWHx3WtwCbSMMTCUCcEmSGlg4gTXkHpZXWQ7kpznK3EmCHiXInqndkQjunG5kxTKEeGye7jWz9cyMR2mGiFQ15ENRBTbCp+Gh86vAyASdgmJq2MC6hoADQ3GosP0QHbnMHjyBQvQqfhy/BUbeHd5WY/G/9LK/8Ka8Jd7UFeNWEZvzPb458Dn8DGLOe3/wGL/4xP+HXlRt+M1PE2iLhR8t+lfgxsuh7AfO2AOf+owWhSZRYQbd622hbpKWKuU+XuvNzP0OseRDa+mObgDHJUSc/pKx31QdKffQ5OIJpt8GWjlgTwMc/w5MPCR/yl1XC2a2Yut54SvOtMev55Of45BOat9aWG27p2ZVORRvnEk1hqWMVUmqa7S2YtvlIpspuF1pt0syuZS2NV14mUidCSfzQzg+KqvIYCMljIx2YK2AO34fX4GWdu5xcIAb8MzTw+j/lyWM+Dw/gjs4GD6ehNgA48kX/AI7XXM/XAN4WHr+9ntywqoCakCqmKP0rmQrJJEErG2Upg1JObr01lKQy4jskWalKYfJ/EDLMpjNSHFEUAde2fltaDgmrNaWQ9+AAb8I5vKjz3L1n1LriB/BXkG/wwR9y/oRX4LlioHA4LzP2inzRx/DWmutRweFjeP3tNeSGlaE1Fde0OS11yOpmbIp2u/jF1n2RRZviJM0yBT3IZl2HWImKjQOxIyeU325b/qWyU9Moj1o07tS0G7qJDoGHg5m8yeCxMoEH8GU45tnrNM84D2l297DQ9t1YP7jki/7RmutRweEA77/HWXOh3HCxkRgldDQkAjNTMl2Iloc1qN5JfJeeTlyTRzxURTdn1Ixv2uKjs12AbdEWlBtmVdk2k7FFwj07PCZ9XAwW3dG+8xKzNFr4EnwBZpy9Qzhh3jDXebBpYcpuo4fQ44u+fD1dweEnHzI7v0xuuOALRUV8rXpFyfSTQYkhd7IHm07jpyhlkCmI0ALYqPTpUxXS+z4jgDj1Pflvmz5ecuItpIBxyTHpSTGWd9g1ApfD/bvwUhL4nT1EzqgX7cxfCcNmb3mPL/qi9SwTHJ49oj5ZLjccbTG3pRmlYi6JCG0mQrAt1+i2UXTZ2dv9IlQpN5naMYtviaXlTrFpoMsl3bOAFEa8sqPj2WCMrx3Yjx99qFwO59Aw/wgx+HlqNz8oZvA3exRDvuhL1jMQHPaOJ0+XyA3fp1OfM3qObEVdhxjvynxNMXQV4+GJyvOEFqeQBaIbbO7i63rpxCltdZShPFxkjM2FPVkn3TG+Rp9pO3l2RzFegGfxGDHIAh8SteR0C4HopXzRF61nheDw6TFN05Ebvq8M3VKKpGjjO6r7nhudTEGMtYM92HTDaR1FDMXJ1eThsbKfywyoWwrzRSXkc51flG3vIid62h29bIcFbTGhfV+faaB+ohj7dPN0C2e2lC96+XouFByen9AsunLDJZ9z7NExiUc0OuoYW6UZkIyx2YUR2z6/TiRjyKMx5GbbjLHvHuf7YmtKghf34LJfx63Yg8vrvN2zC7lY0x0tvKezo4HmGYDU+Gab6dFL+KI761lDcNifcjLrrr9LWZJctG1FfU1uwhoQE22ObjdfkSzY63CbU5hzs21WeTddH2BaL11Gi7lVdlxP1nkxqhnKhVY6knS3EPgVGg1JpN5cP/hivujOelhXcPj8HC/LyI6MkteVjlolBdMmF3a3DbsuAYhL44dxzthWSN065xxUd55Lmf0wRbOYOqH09/o9WbO2VtFdaMb4qBgtFJoT1SqoN8wPXMoXLb3p1PUEhxfnnLzGzBI0Ku7FxrKsNJj/8bn/H8fPIVOd3rfrklUB/DOeO+nkghgSPzrlPxluCMtOnDL4Yml6dK1r3vsgMxgtPOrMFUZbEUbTdIzii5beq72G4PD0DKnwjmBULUVFmy8t+k7fZ3pKc0Q4UC6jpVRqS9Umv8bxw35flZVOU1X7qkjnhZlsMbk24qQ6Hz7QcuL6sDC0iHHki96Uh2UdvmgZnjIvExy2TeJdMDZNSbdZyAHe/Yd1xsQhHiKzjh7GxQ4yqMPaywPkjMamvqrYpmO7Knad+ZQC5msCuAPWUoxrxVhrGv7a+KLXFhyONdTMrZ7ke23qiO40ZJUyzgYyX5XyL0mV7NiUzEs9mjtbMN0dERqwyAJpigad0B3/zRV7s4PIfXSu6YV/MK7+OrYe/JvfGMn/PHJe2fyUdtnFrKRNpXV0Y2559aWPt/G4BlvjTMtXlVIWCnNyA3YQBDmYIodFz41PvXPSa6rq9lWZawZ4dP115HXV/M/tnFkkrBOdzg6aP4pID+MZnTJ1SuuB6iZlyiox4HT2y3YBtkUKWooacBQUDTpjwaDt5poBHl1/HXltwP887lKKXxNUEyPqpGTyA699UqY/lt9yGdlUKra0fFWS+36iylVWrAyd7Uw0CZM0z7xKTOduznLIjG2Hx8cDPLb+OvK6Bv7n1DYci4CxUuRxrjBc0bb4vD3rN5Zz36ntLb83eVJIB8LiIzCmn6SMPjlX+yNlTjvIGjs+QzHPf60Aj62/jrzG8j9vYMFtm1VoRWCJdmw7z9N0t+c8cxZpPeK4aTRicS25QhrVtUp7U578chk4q04Wx4YoQSjFryUlpcQ1AbxZ/XVMknIU//OGl7Q6z9Zpxi0+3yFhSkjUDpnCIUhLWVX23KQ+L9vKvFKI0ZWFQgkDLvBoylrHNVmaw10zwCPrr5tlodfnf94EWnQ0lFRWy8pW9LbkLsyUVDc2NSTHGDtnD1uMtchjbCeb1mpxFP0YbcClhzdLu6lfO8Bj6q+bdT2sz/+8SZCV7VIxtt0DUn9L7r4cLYWDSXnseEpOGFuty0qbOVlS7NNzs5FOGJUqQpl2Q64/yBpZf90sxbE+//PGdZ02HSipCbmD6NItmQ4Lk5XUrGpDMkhbMm2ZVheNYV+VbUWTcv99+2NyX1VoafSuC+AN6q9bFIMv5X/eagNWXZxEa9JjlMwNWb00akGUkSoepp1/yRuuqHGbUn3UdBSTxBU6SEVklzWRUkPndVvw2PrrpjvxOvzPmwHc0hpmq82npi7GRro8dXp0KXnUQmhZbRL7NEVp1uuZmO45vuzKsHrktS3GLWXODVjw+vXXLYx4Hf7njRPd0i3aoAGX6W29GnaV5YdyDj9TFkakje7GHYzDoObfddHtOSpoi2SmzJHrB3hM/XUDDEbxP2/oosszcRlehWXUvzHv4TpBVktHqwenFo8uLVmy4DKLa5d3RtLrmrM3aMFr1183E4sewf+85VWeg1c5ag276NZrM9IJVNcmLEvDNaV62aq+14IAOGFsBt973Ra8Xv11YzXwNfmft7Jg2oS+XOyoC8/cwzi66Dhmgk38kUmP1CUiYWOX1bpD2zWXt2FCp7uq8703APAa9dfNdscR/M/bZLIyouVxqJfeWvG9Je+JVckHQ9+CI9NWxz+blX/KYYvO5n2tAP/vrlZ7+8/h9y+9qeB/Hnt967e5mevX10rALDWK//FaAT5MXdBXdP0C/BAes792c40H+AiAp1e1oH8HgH94g/Lttx1gp63op1eyoM/Bvw5/G/7xFbqJPcCXnmBiwDPb/YKO4FX4OjyCb289db2/Noqicw4i7N6TVtoz8tNwDH+8x/i6Ae7lmaQVENzJFb3Di/BFeAwz+Is9SjeQySpPqbLFlNmyz47z5a/AF+AYFvDmHqibSXTEzoT4Gc3OALaqAP4KPFUJ6n+1x+rGAM6Zd78bgJ0a8QN4GU614vxwD9e1Amy6CcskNrczLx1JIp6HE5UZD/DBHrFr2oNlgG4Odv226BodoryjGJ9q2T/AR3vQrsOCS0ctXZi3ruLlhpFDJYl4HmYtjQCP9rhdn4suySLKDt6wLcC52h8xPlcjju1fn+yhuw4LZsAGUuo2b4Fx2UwQu77uqRHXGtg92aN3tQCbFexc0uk93vhTXbct6y7MulLycoUljx8ngDMBg1tvJjAazpEmOtxlzclvj1vQf1Tx7QlPDpGpqgtdSKz/d9/hdy1vTfFHSmC9dGDZbLiezz7Ac801HirGZsWjydfZyPvHXL/Y8Mjzg8BxTZiuwKz4Eb8sBE9zznszmjvFwHKPIWUnwhqfVRcd4Ck0K6ate48m1oOfrX3/yOtvAsJ8zsPAM89sjnddmuLuDPjX9Bu/L7x7xpMzFk6nWtyQfPg278Gn4Aekz2ZgOmU9eJ37R14vwE/BL8G3aibCiWMWWDQ0ZtkPMnlcGeAu/Ag+8ZyecU5BPuy2ILD+sQqyZhAKmn7XZd+jIMTN9eBL7x95xVLSX4On8EcNlXDqmBlqS13jG4LpmGbkF/0CnOi3H8ETOIXzmnmtb0a16Tzxj1sUvQCBiXZGDtmB3KAefPH94xcUa/6vwRn80GOFyjEXFpba4A1e8KQfFF+259tx5XS4egYn8fQsLGrqGrHbztr+uByTahWuL1NUGbDpsnrwBfePPwHHIf9X4RnM4Z2ABWdxUBlqQ2PwhuDxoS0vvqB1JzS0P4h2nA/QgTrsJFn+Y3AOjs9JFC07CGWX1oNX3T/yHOzgDjwPn1PM3g9Jk9lZrMEpxnlPmBbjyo2+KFXRU52TJM/2ALcY57RUzjObbjqxVw++4P6RAOf58pcVsw9Daje3htriYrpDOonre3CudSe6bfkTEgHBHuDiyu5MCsc7BHhYDx7ePxLjqigXZsw+ijMHFhuwBmtoTPtOxOrTvYJDnC75dnUbhfwu/ZW9AgYd+peL68HD+0emKquiXHhWjJg/UrkJYzuiaL3E9aI/ytrCvAd4GcYZMCkSQxfUg3v3j8c4e90j5ZTPdvmJJGHnOCI2nHS8081X013pHuBlV1gB2MX1YNmWLHqqGN/TWmG0y6clJWthxNUl48q38Bi8vtMKyzzpFdSDhxZ5WBA5ZLt8Jv3895DduBlgbPYAj8C4B8hO68FDkoh5lydC4FiWvBOVqjYdqjiLv92t8yPDjrDaiHdUD15qkSURSGmXJwOMSxWAXYwr3zaAufJ66l+94vv3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/wHuD9tQd4f+0B3l97gPfXHuD9tQd4f+0B3l97gG8LwP8G/AL8O/A5OCq0Ys2KIdv/qOIXG/4mvFAMF16gZD+2Xvu/B8as5+8bfllWyg0zaNO5bfXj6vfhhwD86/Aq3NfRS9t9WPnhfnvCIw/CT8GLcFTMnpntdF/z9V+PWc/vWoIH+FL3Znv57PitcdGP4R/C34avw5fgRVUInCwbsn1yyA8C8zm/BH8NXoXnVE6wVPjdeCI38kX/3+Ct9dbz1pTmHFRu+Hm4O9Ch3clr99negxfwj+ER/DR8EV6B5+DuQOnTgUw5rnkY+FbNU3gNXh0o/JYTuWOvyBf9FvzX663HH/HejO8LwAl8Hl5YLTd8q7sqA3wbjuExfAFegQdwfyDoSkWY8swzEf6o4Qyewefg+cHNbqMQruSL/u/WWc+E5g7vnnEXgDmcDeSGb/F4cBcCgT+GGRzDU3hZYburAt9TEtHgbM6JoxJ+6NMzzTcf6c2bycv2+KK/f+l6LBzw5IwfqZJhA3M472pWT/ajKxnjv4AFnMEpnBTPND6s2J7qHbPAqcMK74T2mZ4VGB9uJA465It+/eL1WKhYOD7xHOkr1ajK7d0C4+ke4Hy9qXZwpgLr+Znm/uNFw8xQOSy8H9IzjUrd9+BIfenYaylf9FsXr8fBAadnPIEDna8IBcwlxnuA0/Wv6GAWPd7dDIKjMdSWueAsBj4M7TOd06qBbwDwKr7oleuxMOEcTuEZTHWvDYUO7aHqAe0Bbq+HEFRzOz7WVoTDQkVds7A4sIIxfCQdCefFRoIOF/NFL1mPab/nvOakSL/Q1aFtNpUb/nFOVX6gzyg/1nISyDfUhsokIzaBR9Kxm80s5mK+6P56il1jXic7nhQxsxSm3OwBHl4fFdLqi64nDQZvqE2at7cWAp/IVvrN6/BFL1mPhYrGMBfOi4PyjuSGf6wBBh7p/FZTghCNWGgMzlBbrNJoPJX2mW5mwZfyRffXo7OFi5pZcS4qZUrlViptrXtw+GQoyhDPS+ANjcGBNRiLCQDPZPMHuiZfdFpPSTcQwwKYdRNqpkjm7AFeeT0pJzALgo7g8YYGrMHS0iocy+YTm2vyRUvvpXCIpQ5pe666TJrcygnScUf/p0NDs/iAI/nqDHC8TmQT8x3NF91l76oDdQGwu61Z6E0ABv7uO1dbf/37Zlv+Zw/Pbh8f1s4Avur6657/+YYBvur6657/+YYBvur6657/+YYBvur6657/+aYBvuL6657/+VMA8FXWX/f8zzcN8BXXX/f8zzcNMFdbf93zP38KLPiK6697/uebtuArrr/u+Z9vGmCusP6653/+1FjwVdZf9/zPN7oHX339dc//fNMu+irrr3v+50+Bi+Zq6697/uebA/jz8Pudf9ht/fWv517J/XUzAP8C/BAeX9WCDrUpZ3/dEMBxgPcfbtTVvsYV5Yn32u03B3Ac4P3b8I+vxNBKeeL9dRMAlwO83959qGO78sT769oB7g3w/vGVYFzKE++v6wV4OMD7F7tckFkmT7y/rhHgpQO8b+4Y46XyxPvrugBeNcB7BRiX8sT767oAvmCA9woAHsoT76+rBJjLBnh3txOvkifeX1dswZcO8G6N7sXyxPvr6i340gHe3TnqVfLE++uKAb50gHcXLnrX8sR7gNdPRqwzwLu7Y/FO5Yn3AK9jXCMGeHdgxDuVJ75VAI8ljP7PAb3/RfjcZfePHBB+79dpfpH1CanN30d+mT1h9GqAxxJGM5LQeeQ1+Tb+EQJrElLb38VHQ94TRq900aMIo8cSOo+8Dp8QfsB8zpqE1NO3OI9Zrj1h9EV78PqE0WMJnUdeU6E+Jjyk/hbrEFIfeWbvId8H9oTRFwdZaxJGvziW0Hn0gqYB/wyZ0PwRlxJST+BOw9m77Amj14ii1yGM/txYQudN0qDzGe4EqfA/5GJCagsHcPaEPWH0esekSwmjRxM6b5JEcZ4ww50ilvAOFxBSx4yLW+A/YU8YvfY5+ALC6NGEzhtmyZoFZoarwBLeZxUhtY4rc3bKnjB6TKJjFUHzJoTOozF2YBpsjcyxDgzhQ1YRUse8+J4wenwmaylB82hC5w0zoRXUNXaRBmSMQUqiWSWkLsaVqc/ZE0aPTFUuJWgeTei8SfLZQeMxNaZSIzbII4aE1Nmr13P2hNHjc9E9guYNCZ032YlNwESMLcZiLQHkE4aE1BFg0yAR4z1h9AiAGRA0jyZ03tyIxWMajMPWBIsxYJCnlITU5ShiHYdZ94TR4wCmSxg9jtB5KyPGYzymAYexWEMwAPIsAdYdV6aObmNPGD0aYLoEzaMJnTc0Ygs+YDw0GAtqxBjkuP38bMRWCHn73xNGjz75P73WenCEJnhwyVe3AEe8TtKdJcYhBl97wuhNAObK66lvD/9J9NS75v17wuitAN5fe4D31x7g/bUHeH/tAd5fe4D3AO+vPcD7aw/w/toDvL/2AO+vPcD7aw/w/toDvAd4f/24ABzZ8o+KLsSLS+Pv/TqTb3P4hKlQrTGh+fbIBT0Axqznnb+L/V2mb3HkN5Mb/nEHeK7d4IcDld6lmDW/iH9E+AH1MdOw/Jlu2T1xNmY98sv4wHnD7D3uNHu54WUuOsBTbQuvBsPT/UfzNxGYzwkP8c+Yz3C+r/i6DcyRL/rZ+utRwWH5PmfvcvYEt9jLDS/bg0/B64DWKrQM8AL8FPwS9beQCe6EMKNZYJol37jBMy35otdaz0Bw2H/C2Smc7+WGB0HWDELBmOByA3r5QONo4V+DpzR/hFS4U8wMW1PXNB4TOqYz9urxRV++ntWCw/U59Ty9ebdWbrgfRS9AYKKN63ZokZVygr8GZ/gfIhZXIXPsAlNjPOLBby5c1eOLvmQ9lwkOy5x6QV1j5TYqpS05JtUgUHUp5toHGsVfn4NX4RnMCe+AxTpwmApTYxqMxwfCeJGjpXzRF61nbcHhUBPqWze9svwcHJ+S6NPscKrEjug78Dx8Lj3T8D4YxGIdxmJcwhi34fzZUr7olevZCw5vkOhoClq5zBPZAnygD/Tl9EzDh6kl3VhsHYcDEb+hCtJSvuiV69kLDm+WycrOTArHmB5/VYyP6jOVjwgGawk2zQOaTcc1L+aLXrKeveDwZqlKrw8U9Y1p66uK8dEzdYwBeUQAY7DbyYNezBfdWQ97weEtAKYQg2xJIkuveAT3dYeLGH+ShrWNwZgN0b2YL7qznr3g8JYAo5bQBziPjx7BPZ0d9RCQp4UZbnFdzBddor4XHN4KYMrB2qHFRIzzcLAHQZ5the5ovui94PCWAPefaYnxIdzRwdHCbuR4B+tbiy96Lzi8E4D7z7S0mEPd+eqO3cT53Z0Y8SV80XvB4Z0ADJi/f7X113f+7p7/+UYBvur6657/+YYBvur6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+aYBvuL6657/+VMA8FXWX/f8z58OgK+y/rrnf75RgLna+uue//lTA/CV1V/3/M837aKvvv6653++UQvmauuve/7nTwfAV1N/3fM/fzr24Cuuv+75nz8FFnxl9dc9//MOr/8/glixwRuUfM4AAAAASUVORK5CYII\x3d",
9729,6407);this.textureSearch=this.loadTextureFromBase64("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAAAhCAAAAABIXyLAAAAAOElEQVRIx2NgGAWjYBSMglEwEICREYRgFBZBqDCSLA2MGPUIVQETE9iNUAqLR5gIeoQKRgwXjwAAGn4AtaFeYLEAAAAASUVORK5CYII\x3d",9728,6409);this.isEnabled=!0}};k.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),
this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)};k.prototype.render=function(a,b){this.enable();var d=this.rctx,f=0,k=0;null!=b?(f=b.descriptor.width,k=b.descriptor.height):(f=d.gl.canvas.width,k=d.gl.canvas.height);d.bindVAO(this.vao);d.setFaceCullingEnabled(!0);d.setCullFace(1029);
d.setFrontFace(2305);d.setBlendingEnabled(!1);d.setDepthTestEnabled(!1);d.setViewport(0,0,f,k);this.tmpFramebufferEdges.resize(f,k);d.bindFramebuffer(this.tmpFramebufferEdges);d.setClearColor(0,0,0,1);d.clear(d.gl.COLOR_BUFFER_BIT);d.bindProgram(this.programEdgeDetect);d.bindTexture(a.colorTexture,0);this.programEdgeDetect.setUniform1i("tColor",0);this.programEdgeDetect.setUniform4f("uResolution",1/f,1/k,f,k);d.drawArrays(4,0,3);this.tmpFramebufferBlend.resize(f,k);d.bindFramebuffer(this.tmpFramebufferBlend);
d.setClearColor(0,0,1,1);d.clear(d.gl.COLOR_BUFFER_BIT);d.bindProgram(this.programBlendWeights);this.programBlendWeights.setUniform4f("uResolution",1/f,1/k,f,k);d.bindTexture(this.textureSearch,1);this.programBlendWeights.setUniform1i("tSearch",1);d.bindTexture(this.textureArea,2);this.programBlendWeights.setUniform1i("tArea",2);d.bindTexture(this.tmpFramebufferEdges.colorTexture,3);this.programBlendWeights.setUniform1i("tEdges",3);d.drawArrays(4,0,3);d.bindFramebuffer(b);d.setClearColor(0,1,0,1);
d.clear(d.gl.COLOR_BUFFER_BIT);d.bindProgram(this.programBlur);this.programBlur.setUniform4f("uResolution",1/f,1/k,f,k);d.bindTexture(a.colorTexture,0);this.programBlur.setUniform1i("tColor",0);d.bindTexture(this.tmpFramebufferBlend.colorTexture,1);this.programBlur.setUniform1i("tBlendWeights",1);d.drawArrays(4,0,3);d.setBlendingEnabled(!0);d.setDepthTestEnabled(!0)};k.prototype.loadTextureFromBase64=function(a,d,f){var k=new b(this.rctx,{pixelFormat:f,dataType:5121,wrapMode:33071,samplingMode:d},
null);t.dataUriToImage(a).then(function(a){k.resize(a.width,a.height);k.setData(a)});return k};return k}()})},"esri/views/3d/support/imageUtils":function(){define(["require","exports","dojo/Deferred","../../../core/urlUtils","../../../request"],function(w,l,f,a,d){function b(a){var b=!1,d=new Image,k=new f(function(){b=!0;d.src=""}),p=function(){b||k.reject()};d.onload=function(){b||k.resolve(d)};d.onerror=p;d.onabort=p;d.src=a;return k.promise}Object.defineProperty(l,"__esModule",{value:!0});l.dataURItoBlob=
function(a){var b=atob(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];for(var d=new ArrayBuffer(b.length),f=new Uint8Array(d),p=0;p<b.length;p++)f[p]=b.charCodeAt(p);return new Blob([d],{type:a})};l.dataUriToImage=b;l.requestImage=function(f){return a.isDataProtocol(f)?b(f):d(f,{responseType:"image",allowImageDataAccess:!0}).then(function(a){return a.data})}})},"esri/views/webgl/Profiling":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});
l.startMeasurement=function(a){if(!a.extensions.disjointTimerQuery)return null;var d=new f;d.start(a);return d};var f=function(){function a(){}a.prototype.start=function(a){this._rctx=a;a=a.extensions.disjointTimerQuery;this._query=a.createQueryEXT();a.beginQueryEXT(a.TIME_ELAPSED_EXT,this._query)};a.prototype.stop=function(a,b){void 0===b&&(b=50);this._cb=a;this._checkInterval=b;a=this._rctx.extensions.disjointTimerQuery;a.endQueryEXT(a.TIME_ELAPSED_EXT);this._checkQueryResult()};a.prototype._checkQueryResult=
function(){var a=this._rctx.extensions.disjointTimerQuery,b=a.getQueryObjectEXT(this._query,a.QUERY_RESULT_AVAILABLE_EXT),f=this._rctx.gl.getParameter(a.GPU_DISJOINT_EXT);b&&!f?(a=a.getQueryObjectEXT(this._query,a.QUERY_RESULT_EXT),this._cb(a/1E6)):f?this._cb(null):setTimeout(this._checkQueryResult.bind(this),this._checkInterval)};return a}()})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./HUDMaterial.xml ./internal/MaterialUtil ../lib/Util ../../../webgl/Util ./internal/MaterialBase ./internal/GLMaterialTextureBase ../lib/gl-matrix ../lib/RenderSlot ../lib/RenderPass ../lib/ShaderVariations ../lib/ComponentUtils ../../support/aaBoundingRect ../lib/screenSizePerspectiveUtils".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u){function C(a,b){void 0===b&&(b=O);if(a.textureIsSignedDistanceField){var c=a.anchorPos;a=a.distanceFieldBoundingBox;var e=b;e[0]=c[0]*(a[2]-a[0])+a[0];e[1]=c[1]*(a[3]-a[1])+a[1]}else E.set(a.anchorPos,b);return b}var E=k.vec2d,c=k.vec3d,D=k.mat3d,B=k.mat4d,I={"bottom-left":[0,0],bottom:[.5,0],"bottom-right":[1,0],left:[0,.5],center:[.5,.5],right:[1,.5],"top-left":[0,1],top:[.5,1],"top-right":[1,1]},G=[{name:"position",count:3,type:5126,offset:0,stride:76,
normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:76,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:76,normalized:!1},{name:"color",count:4,type:5121,offset:32,stride:76,normalized:!1},{name:"size",count:2,type:5126,offset:36,stride:76,normalized:!1},{name:"auxpos1",count:4,type:5126,offset:44,stride:76,normalized:!1},{name:"auxpos2",count:4,type:5126,offset:60,stride:76,normalized:!1}],H={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,
color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,anchorPos:I.center,shaderPolygonOffset:1E-5,polygonOffset:!1,
textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1};w=function(k){function m(a,b){b=k.call(this,b)||this;b._textureDirty=!1;b.params=d.copyParameters(a,H);"string"===typeof b.params.anchorPos&&(b.params.anchorPos=I[b.params.anchorPos]);return b}f(m,k);m.prototype.dispose=function(){};m.prototype.getParameterValues=function(){var a=this.params;return{color:a.color,texCoordScale:a.texCoordScale,polygonOffset:a.polygonOffset,anchorPos:a.anchorPos,screenOffset:a.screenOffset,verticalOffset:a.verticalOffset,
screenSizePerspective:a.screenSizePerspective,screenSizePerspectiveAlignment:a.screenSizePerspectiveAlignment,shaderPolygonOffset:a.shaderPolygonOffset,textureIsSignedDistanceField:a.textureIsSignedDistanceField,outlineColor:a.outlineColor,outlineSize:a.outlineSize,distanceFieldBoundingBox:a.distanceFieldBoundingBox,vvSizeEnabled:a.vvSizeEnabled,vvSizeMinSize:a.vvSizeMinSize,vvSizeMaxSize:a.vvSizeMaxSize,vvSizeOffset:a.vvSizeOffset,vvSizeFactor:a.vvSizeFactor,vvColorEnabled:a.vvColorEnabled,vvColorValues:a.vvColorValues,
vvColorColors:a.vvColorColors,textureId:a.textureId,occlusionTest:a.occlusionTest,binaryHighlightOcclusion:a.binaryHighlightOcclusion,centerOffsetUnits:a.centerOffsetUnits,debugDrawBorder:a.debugDrawBorder,drawInSecondSlot:a.drawInSecondSlot}};m.prototype.setParameterValues=function(a){for(var c in a)"textureId"===c&&b.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[c]=a[c];this.notifyDirty("matChanged")};m.prototype.getParams=function(){return this.params};
m.prototype.getOutputAmount=function(a){return 114*a};m.prototype.getInstanceBufferLayout=function(){};m.prototype.getVertexBufferLayout=function(){return G};m.prototype.fillInterleaved=function(a,c,e,f,g,h){var k=4*h,m=a.faces.indices[b.VertexAttrConstants.POSITION],p=a.vertexAttr[b.VertexAttrConstants.POSITION].data,n=h+q.findAttribute(G,b.VertexAttrConstants.POSITION).offset/4;for(f=0;f<m.length;++f){var r=3*m[f];d.fill(p,r,g,n,c,3);n+=19;d.fill(p,r,g,n,c,3);n+=19;d.fill(p,r,g,n,c,3);n+=19;d.fill(p,
r,g,n,c,3);n+=19;d.fill(p,r,g,n,c,3);n+=19;d.fill(p,r,g,n,c,3);n+=19}c=a.faces.indices[b.VertexAttrConstants.NORMAL];p=a.vertexAttr[b.VertexAttrConstants.NORMAL].data;n=h+q.findAttribute(G,b.VertexAttrConstants.NORMAL).offset/4;for(f=0;f<c.length;++f)r=3*c[f],d.fill(p,r,g,n,e,3),n+=19,d.fill(p,r,g,n,e,3),n+=19,d.fill(p,r,g,n,e,3),n+=19,d.fill(p,r,g,n,e,3),n+=19,d.fill(p,r,g,n,e,3),n+=19,d.fill(p,r,g,n,e,3),n+=19;f=a.vertexAttr[b.VertexAttrConstants.UV0].data;null==f||3>=f.length?(e=r=0,c=this.params.texCoordScale[0],
p=this.params.texCoordScale[1]):(r=a.vertexAttr[b.VertexAttrConstants.UV0].data[0],e=a.vertexAttr[b.VertexAttrConstants.UV0].data[1],c=a.vertexAttr[b.VertexAttrConstants.UV0].data[2],p=a.vertexAttr[b.VertexAttrConstants.UV0].data[3]);c=Math.min(1.99999,c+1);p=Math.min(1.99999,p+1);n=h+q.findAttribute(G,b.VertexAttrConstants.UV0).offset/4;for(f=0;f<m.length;++f)g[n]=r,g[n+1]=e,n+=19,g[n]=c,g[n+1]=e,n+=19,g[n]=c,g[n+1]=p,n+=19,g[n]=c,g[n+1]=p,n+=19,g[n]=r,g[n+1]=p,n+=19,g[n]=r,g[n+1]=e,n+=19;m=a.faces.indices[b.VertexAttrConstants.COLOR];
e=a.vertexAttr[b.VertexAttrConstants.COLOR].data;k+=q.findAttribute(G,b.VertexAttrConstants.COLOR).offset;c=new Uint8Array(g.buffer);for(f=0;f<m.length;++f)r=4*m[f],d.fill(e,r,c,k,null,4),k+=76,d.fill(e,r,c,k,null,4),k+=76,d.fill(e,r,c,k,null,4),k+=76,d.fill(e,r,c,k,null,4),k+=76,d.fill(e,r,c,k,null,4),k+=76,d.fill(e,r,c,k,null,4),k+=76;r=a.faces.indices[b.VertexAttrConstants.SIZE];k=a.vertexAttr[b.VertexAttrConstants.SIZE].data;m=h+q.findAttribute(G,b.VertexAttrConstants.SIZE).offset/4;for(f=0;f<
r.length;++f)e=k[2*r[f]],c=k[2*r[f]+1],g[m]=e,g[m+1]=c,m+=19,g[m]=e,g[m+1]=c,m+=19,g[m]=e,g[m+1]=c,m+=19,g[m]=e,g[m+1]=c,m+=19,g[m]=e,g[m+1]=c,m+=19,g[m]=e,g[m+1]=c,m+=19;if(null!=a.faces.indices[b.VertexAttrConstants.AUXPOS1]&&null!=a.vertexAttr[b.VertexAttrConstants.AUXPOS1])for(k=a.faces.indices[b.VertexAttrConstants.AUXPOS1],m=a.vertexAttr[b.VertexAttrConstants.AUXPOS1].data,e=h+q.findAttribute(G,"auxpos1").offset/4,f=0;f<k.length;++f)r=4*k[f],d.fill(m,r,g,e,null,4),e+=19,d.fill(m,r,g,e,null,
4),e+=19,d.fill(m,r,g,e,null,4),e+=19,d.fill(m,r,g,e,null,4),e+=19,d.fill(m,r,g,e,null,4),e+=19,d.fill(m,r,g,e,null,4),e+=19;if(null!=a.faces.indices[b.VertexAttrConstants.AUXPOS2]&&null!=a.vertexAttr[b.VertexAttrConstants.AUXPOS2])for(k=a.faces.indices[b.VertexAttrConstants.AUXPOS2],a=a.vertexAttr[b.VertexAttrConstants.AUXPOS2].data,h+=q.findAttribute(G,"auxpos2").offset/4,f=0;f<k.length;++f)r=4*k[f],d.fill(a,r,g,h,null,4),h+=19,d.fill(a,r,g,h,null,4),h+=19,d.fill(a,r,g,h,null,4),h+=19,d.fill(a,
r,g,h,null,4),h+=19,d.fill(a,r,g,h,null,4),h+=19,d.fill(a,r,g,h,null,4),h+=19};m.prototype.intersect=function(a,d,f,k,m,p,n,r){if(k.isSelection&&k.enableHUDSelection&&!v.isAllHidden(d.componentVisibilities,a.data.componentOffsets)){d=this.params;p=m=1;r&&(p=r(h),m=p[0],p=p[5]);r=a.getData().getVertexAttr()[b.VertexAttrConstants.POSITION];var q=a.getData().getVertexAttr()[b.VertexAttrConstants.SIZE];a=a.getData().getVertexAttr()[b.VertexAttrConstants.NORMAL];b.assert(3<=r.size);for(var l=k.point,x=
k.camera,t=C(d),z=0;z<r.data.length/r.size;z++){var E=z*r.size;c.set3(r.data[E],r.data[E+1],r.data[E+2],L);B.multiplyVec3(f,L,L);E=z*q.size;g[0]=q.data[E]*m;g[1]=q.data[E+1]*p;B.multiplyVec3(x.viewMatrix,L);E=z*a.size;c.set3(a.data[E],a.data[E+1],a.data[E+2],M);this.applyVerticalOffsetTransformation(L,M,f,x,P);x.applyProjection(L,R);if(-1<R[0]){var E=Math.floor(R[0]),D=Math.floor(R[1]);u.applyPrecomputedScaleFactorVec2(g,P.factor,g);var E=E-e-(0<t[0]?g[0]*t[0]:0),y=E+g[0]+2*e,D=D-e-(0<t[1]?g[1]*t[1]:
0),H=D+g[1]+2*e;if(d.textureIsSignedDistanceField)var w=d.outlineSize/2,G=d.distanceFieldBoundingBox,E=E+g[0]*G[0],D=D+g[1]*G[1],y=y-g[0]*(1-G[2]),H=H-g[1]*(1-G[3]),E=E-w,y=y+w,D=D-w,H=H+w;l[0]>E&&l[0]<y&&l[1]>D&&l[1]<H&&(y=k.p0,D=k.p1,B.multiplyVec3(B.inverse(x.viewMatrix,V),L,T),R[0]=l[0],R[1]=l[1],x.unprojectPoint(R,L),E=c.negate(k.getDirection(),c.create()),y=c.dist(y,L)/c.dist(y,D),n(y,E,-1,1,!0,T))}}}};m.prototype.normalAndViewAngle=function(a,b,e,d){void 0===d&&(d=S);D.multiplyVec3(B.toMat3(b,
A),a,d.normal);B.multiplyVec3(e.viewInverseTransposeMatrix,d.normal);d.cosAngle=c.dot(Q,n);return d};m.prototype.updateScaleInfo=function(a,b,c){b=this.params;b.screenSizePerspective?a.factor=u.precomputeScaleFactor(S.cosAngle,c,b.screenSizePerspective,a.factor):(a.factor.scale=1,a.factor.factor=0,a.factor.minPixelSize=0,a.factor.paddingPixels=0);b.screenSizePerspectiveAlignment?(a.scaleAlignment=u.precomputeScale(S.cosAngle,c,b.screenSizePerspectiveAlignment),a.minPixelSizeAlignment=b.screenSizePerspectiveAlignment.parameters.minPixelSize):
(a.scaleAlignment=a.factor.scale,a.minPixelSizeAlignment=a.factor.minPixelSize)};m.prototype.applyVerticalOffsetTransformation=function(a,b,e,f,g,h){var k=this.params;if(!k.verticalOffset||!k.verticalOffset.screenLength)return g&&(k.screenSizePerspective||k.screenSizePerspectiveAlignment)?(f=this.normalAndViewAngle(b,e,f),k=c.length(a),this.updateScaleInfo(g,f.cosAngle,k)):g&&(g.factor.scale=1,g.scaleAlignment=1),h?c.set(a,h):a;b=this.normalAndViewAngle(b,e,f);e=c.length(a);f=d.verticalOffsetAtDistance(f,
e,k.verticalOffset,b.cosAngle,k.screenSizePerspectiveAlignment||k.screenSizePerspective);g&&this.updateScaleInfo(g,b.cosAngle,e);return c.add(a,c.scale(b.normal,f),h)};m.prototype.getGLMaterials=function(){return{color:K,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:J}};m.prototype.getAllTextureIds=function(){return[this.params.textureId]};m.prototype.setTextureDirty=function(){this._textureDirty=!0};m.prototype.calculateRelativeScreenBounds=function(a,b,c){void 0===c&&(c=r.create());
var e=this.params,d=c;void 0===d&&(d=O);E.set(e.anchorPos,d);d[0]*=-a[0];d[1]*=-a[1];d[0]+=e.screenOffset[0]*b;d[1]+=e.screenOffset[1]*b;c[2]=c[0]+a[0];c[3]=c[1]+a[1];return c};m.prototype.calculateAnchorPosForRendering=function(a){return C(this.params,a)};m.loadShaders=function(b,c,e,d){b._parse(a);var f=function(a){a.addDefine("OcclTest","OCCL_TEST");a.addDefine("SDF","SIGNED_DISTANCE_FIELD");a.addDefine("vvSize","VV_SIZE");a.addDefine("vvColor","VV_COLOR");a.addDefine("verticalOffset","VERTICAL_OFFSET");
a.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");a.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN")},g=new z("hud",["vertexShaderHUD","fragmentShaderHUD"],null,e,c,b,d);f(g);g.addDefine("debugDrawBorder","DEBUG_DRAW_BORDER");e.addShaderVariations("hud-material-shader-variations",g);g=new z("hudHighlight",["vertexShaderHUD","fragmentShaderHUDHighlight"],null,e,c,b,d);f(g);g.addDefine("binaryHighlightOcclusion","BINARY_HIGHLIGHT_OCCLUSION");e.addShaderVariations("hud-material-highlight-shader-variations",
g);b=new z("hudOcclusionTestPixel",["vertexShaderOcclusionTestPixel","fragmentShaderSimple"],null,e,c,b,d);b.addDefine("verticalOffset","VERTICAL_OFFSET");b.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");b.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN");e.addShaderVariations("hud-material-occlusion-test-pixel-shader-variations",b)};m.shouldRenderVisibilityDuringRenderPass=function(a){return a===x.MATERIAL||x.MATERIAL_HIGHLIGHT};return m}(t.MaterialBase);m=function(a){function b(b,
c,e){e=a.call(this,b,b.getParams(),c,e)||this;e.programRep=c;e.params=d.copyParameters(b.getParams());e.selectProgram();e.selectSlot();return e}f(b,a);b.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?p.HUDMATERIAL2:p.HUDMATERIAL1};b.prototype.beginSlot=function(a){return a===this.mainSlot};b.prototype.getProgram=function(){return this.program};b.prototype.getAllPrograms=function(){return[this.program]};b.prototype.updateParameters=function(){var a=this.material.getParams(),
b=this.params;b.color=a.color;b.texCoordScale=a.texCoordScale;b.polygonOffset=a.polygonOffset;b.anchorPos=a.anchorPos;b.screenOffset=a.screenOffset;b.verticalOffset=a.verticalOffset;b.screenSizePerspective=a.screenSizePerspective;b.screenSizePerspectiveAlignment=a.screenSizePerspectiveAlignment;b.shaderPolygonOffset=a.shaderPolygonOffset;b.textureIsSignedDistanceField=a.textureIsSignedDistanceField;b.outlineColor=a.outlineColor;b.outlineSize=a.outlineSize;b.vvSizeEnabled=a.vvSizeEnabled;b.vvSizeMinSize=
a.vvSizeMinSize;b.vvSizeMaxSize=a.vvSizeMaxSize;b.vvSizeOffset=a.vvSizeOffset;b.vvSizeFactor=a.vvSizeFactor;b.vvColorEnabled=a.vvColorEnabled;b.vvColorValues=a.vvColorValues;b.vvColorColors=a.vvColorColors;this.updateTexture(a.textureId);this.selectProgram();this.selectSlot()};b.prototype.bindRender=function(a,b){var c=this.params,e=this.getProgram();this.bindTexture(a,e);e.setUniform1i("hudVisibilityTexture",1);a.bindTexture(b.hudVisibilityTexture,1);a.setActiveTexture(0);e.setUniform4fv("overrideColor",
c.color);e.setUniform1f("pixelRatio",b.pixelRatio);c.textureIsSignedDistanceField&&(e.setUniform4fv("outlineColor",c.outlineColor),e.setUniform1f("outlineSize",c.outlineSize));c.vvSizeEnabled&&(e.setUniform3fv("vvSizeMinSize",c.vvSizeMinSize),e.setUniform3fv("vvSizeMaxSize",c.vvSizeMaxSize),e.setUniform3fv("vvSizeOffset",c.vvSizeOffset),e.setUniform3fv("vvSizeFactor",c.vvSizeFactor));c.vvColorEnabled&&(e.setUniform1fv("vvColorValues",c.vvColorValues),e.setUniform4fv("vvColorColors",c.vvColorColors));
e.setUniform2fv("texScale",c.texCoordScale);e.setUniform2f("screenOffset",2*c.screenOffset[0],2*c.screenOffset[1]);e.setUniform2fv("anchorPos",C(c));c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setBlendingEnabled(!0);a.setBlendFunction(1,771)};b.prototype.bindProjection=function(a,b){this.material._textureDirty&&(this.renderTexture(a),this.material._textureDirty=!1);var c=b.cameraAboveGround?1:-1,e=this.getProgram(),f=this.params;a.bindProgram(e);e.setUniform1f("cameraGroundRelative",
c);e.setUniform1f("polygonOffset",f.shaderPolygonOffset);e.setUniform4fv("viewport",b.viewport);d.bindVerticalOffset(f.verticalOffset,b,e);e.setUniformMatrix4fv("viewNormal",b.viewInvTransp);f.screenSizePerspective&&(d.bindScreenSizePerspective(f.screenSizePerspective,e,"screenSizePerspective"),d.bindScreenSizePerspective(f.screenSizePerspectiveAlignment||f.screenSizePerspective,e,"screenSizePerspectiveAlignment"))};b.prototype.releaseRender=function(a){a.setPolygonOffsetFillEnabled(!1);a.setBlendFunction(770,
771);a.setBlendingEnabled(!1)};b.prototype.bindView=function(a,b){a=b.origin;var c=this.getProgram();d.bindView(a,b.view,c);d.bindCamPos(a,b.viewInvTransp,c)};b.prototype.bindInstance=function(a,b){a=this.getProgram();a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return b}(m.GLMaterialTextureBase);var K=function(a){function b(b,c,e){b=a.call(this,b,c,e)||this;b.isOcclusionSlot=
!1;return b}f(b,a);b.prototype.selectProgram=function(){var a=this.params;this.programOcclusionTestPixel=this.programRep.getShaderVariationsProgram("hud-material-occlusion-test-pixel-shader-variations",[!!a.verticalOffset,!!a.screenSizePerspective,"screen"===a.centerOffsetUnits]);this.program=this.programRep.getShaderVariationsProgram("hud-material-shader-variations",[a.occlusionTest,a.textureIsSignedDistanceField,!!a.vvSizeEnabled,!!a.vvColorEnabled,!!a.verticalOffset,!!a.screenSizePerspective,"screen"===
a.centerOffsetUnits,!!a.debugDrawBorder])};b.prototype.getDrawMode=function(a){a=a.gl;return this.isOcclusionSlot?a.POINTS:a.TRIANGLES};b.prototype.release=function(a){a.setDepthFunction(a.gl.LESS);this.isOcclusionSlot||this.releaseRender(a)};b.prototype.bind=function(a,b){var c=a.gl;this.bindProjection(a,b);var e=this.getProgram();a.setDepthFunction(c.LEQUAL);this.isOcclusionSlot?e.setUniform4f("color",1,1,1,1):(this.bindRender(a,b),this.bindTexture(a,e))};b.prototype.getProgram=function(){return this.isOcclusionSlot?
this.programOcclusionTestPixel:this.program};b.prototype.getAllPrograms=function(){return[this.programOcclusionTestPixel,this.program]};b.prototype.beginSlot=function(a){if(this.params.occlusionTest)return this.isOcclusionSlot=a===p.OCCLUSION_PIXELS,a===p.OCCLUSION_PIXELS||a===this.mainSlot;this.isOcclusionSlot=!1;return a===this.mainSlot};return b}(m),J=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}f(b,a);b.prototype.selectProgram=function(){var a=this.params;this.program=
this.programRep.getShaderVariationsProgram("hud-material-highlight-shader-variations",[a.occlusionTest,a.textureIsSignedDistanceField,!!a.vvSizeEnabled,!!a.vvColorEnabled,!!a.verticalOffset,!!a.screenSizePerspective,"screen"===a.centerOffsetUnits,a.binaryHighlightOcclusion])};b.prototype.bind=function(a,b){this.bindProjection(a,b);this.bindRender(a,b)};b.prototype.release=function(a){this.releaseRender(a)};return b}(m),P={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},
O=[0,0],L=c.create(),M=c.create(),R=c.create(),Q=c.create(),T=c.create(),A=D.create(),V=B.create(),S={normal:Q,cosAngle:0},h=B.create();B.identity(h);var e=1,g=[0,0],n=[0,0,1];return w})},"esri/views/3d/webgl-engine/materials/internal/MaterialBase":function(){define(["require","exports","./MaterialUtil","../../lib/ModelContentType"],function(w,l,f,a){Object.defineProperty(l,"__esModule",{value:!0});w=function(){function d(a){this.visible=!0;this.renderPriority=0;this.parentStage=null;this.id=f.__Material_idGen.gen(a)}
d.prototype.getId=function(){return this.id};d.prototype.getParentStage=function(){return this.parentStage};d.prototype.addParentStage=function(a){this.parentStage=a};d.prototype.removeParentStage=function(a){this.parentStage=null};d.prototype.setVisible=function(a){this.visible!==a&&(this.visible=a,this.notifyDirty("matChanged"))};d.prototype.isVisible=function(){return this.visible};d.prototype.notifyDirty=function(b){this.parentStage&&this.parentStage.notifyDirty(a.MATERIAL,this,b)};d.prototype.setRenderPriority=
function(a){this.renderPriority=a;this.notifyDirty("matChanged")};d.prototype.getRenderPriority=function(){return this.renderPriority};return d}();l.MaterialBase=w;l.default=w})},"esri/views/3d/webgl-engine/materials/internal/GLMaterialTextureBase":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","./GLMaterialBase","./MaterialUtil"],function(w,l,f,a,d){Object.defineProperty(l,"__esModule",{value:!0});w=function(a){function b(b,f,k,p,q){void 0===q&&(q=!1);b=a.call(this,
b,k,p)||this;b.params=f;b.textureRep=p;b.initTransparent=q;b.glTextureRef=d.aquireIfNotUndefined(f.textureId,f.initTexture,p,q);return b}f(b,a);b.prototype.updateTexture=function(a){var b=this.params;b.textureId!==a&&(d.releaseIfNotUndefined(b.textureId,this.textureRep),b.textureId=a,this.glTextureRef=d.aquireIfNotUndefined(b.textureId,b.initTexture,this.textureRep,this.initTransparent))};b.prototype.renderTexture=function(a){(a=this.textureRep.getTexture(this.params.textureId))&&a.dirty&&a.redraw&&
a.redraw()};b.prototype.bindTexture=function(a,b){null!=this.glTextureRef&&(b.setUniform1i("tex",0),a.bindTexture(this.glTextureRef.getGLTexture()))};b.prototype.bindTextureSize=function(a,b){null!=this.glTextureRef&&(a=this.glTextureRef.getGLTexture(),b.setUniform2f("texSize",a.descriptor.width,a.descriptor.height))};b.prototype.dispose=function(){d.releaseIfNotUndefined(this.params.textureId,this.textureRep)};return b}(a.default);l.GLMaterialTextureBase=w;l.default=w})},"esri/views/3d/webgl-engine/materials/internal/GLMaterialBase":function(){define(["require",
"exports","./MaterialUtil"],function(w,l,f){Object.defineProperty(l,"__esModule",{value:!0});w=function(){function a(a,b,q){this.id=f.__GLMaterial_id++;this.material=a}a.prototype.getId=function(){return this.id};a.prototype.getMaterialId=function(){return this.material.getId()};a.prototype.isVisible=function(){return this.material.isVisible()};a.prototype.getRenderPriority=function(){return this.material.getRenderPriority()};return a}();l.GLMaterialBase=w;l.default=w})},"esri/views/3d/webgl-engine/lib/ShaderVariations":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/_base/lang ./Util ../../../webgl/Program ./DefaultVertexAttributeLocations".split(" "),
function(w,l,f,a,d,b,q){return function(){function f(a,b,f,q,l,v,r){this.variables=[];this.sealed=!1;this.programCache={};d.assert(2===b.length,"you must specify shader snippet prefixes for vertex and fragment shaders");this.programNamePrefix=a;this.shaderSnippetPrefixes=b;this.baseDefines=f;this.programRep=q;this.shaderRep=l;this.snippets=v;this.rctx=r;this.baseDefines=f?f.slice():[]}f.prototype.addDefine=function(a,b,f,q){d.assert(!this.sealed,"you cannot add another variable after the first program has been generated");
d.assert(!!a,"you must specify a program name suffix");this.variables.push({programNameSuffixes:["",a],shaderNameSuffixes:q||a,defineStr:b,affectsShaderTypes:f||[!0,!0]})};f.prototype.addBinaryShaderSnippetSuffix=function(a,b,f){d.assert(!this.sealed,"you cannot add another variable after the first program has been generated");d.assert(!!a,"you must specify a program name suffix");this.variables.push({programNameSuffixes:["",a],shaderSnippetSuffixes:["",b],affectsShaderTypes:f||[!0,!0]})};f.prototype.addNaryShaderSnippetSuffix=
function(a,b){d.assert(!this.sealed,"you cannot add another variable after the first program has been generated");var f=a.map(function(a){d.assert(null!=a.value,"value must always be specified");return a.value});this.variables.push({values:f,programNameSuffixes:a.map(function(a,b){return null!=a.programNameSuffix?a.programNameSuffix:f[b]}),shaderSnippetSuffixes:a.map(function(a,b){return null!=a.shaderSnippetSuffix?a.shaderSnippetSuffix:f[b]}),affectsShaderTypes:b||[!0,!0]})};f.prototype.getShaderVariation=
function(b){d.assert(b.length===this.variables.length,"you must specify a value for each variable");for(var f=this.programNamePrefix,m=a.clone(this.shaderSnippetPrefixes),q=a.clone(this.shaderSnippetPrefixes),l=a.clone(this.baseDefines),v=0;v<this.variables.length;v++){var r=this.variables[v],u=b[v],t=void 0;r.values?(t=r.values.indexOf(u.toString()),d.assert(0<=t,"invalid value "+u+" for variable "+v)):t=u?1:0;f+=r.programNameSuffixes[t];for(u=0;2>u;u++)r.affectsShaderTypes[u]&&(r.shaderSnippetSuffixes&&
(m[u]+=r.shaderSnippetSuffixes[t],q[u]+=r.shaderSnippetSuffixes[t]),r.defineStr&&t&&(l.push(r.defineStr),q[u]+=r.shaderNameSuffixes))}return{programName:f,shaderSnippetNames:m,shaderNames:q,defines:l}};f.prototype.getProgram=function(a,f,p){void 0===f&&(f=this.snippets);void 0===p&&(p=this.rctx);this.sealed=!0;var k=a.reduce(function(a,b){return a+b.toString()},"");if(this.programCache[k])return this.programCache[k];a=this.getShaderVariation(a);var m=this.programRep.get(a.programName);if(m)return m;
var l=a.shaderSnippetNames[0],m=f[l];d.assert(null!=m,"shader snippet '"+l+"' does not exist");l=a.shaderSnippetNames[1];f=f[l];d.assert(null!=f,"shader snippet '"+l+"' does not exist");m=new b(p,m,f,q.Default3D,a.defines);this.programCache[k]=m;this.programRep.add(a.programName,m);return m};return f}()})},"esri/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial":function(){define("require exports dojo/text!./TexOnlyGLMaterial.xml ./MaterialUtil ../../lib/RenderSlot ../../lib/gl-matrix ../../../../webgl/Program ../../../../webgl/enums ../../lib/DefaultVertexAttributeLocations".split(" "),
function(w,l,f,a,d,b,q,t,m){var k=b.vec4d.createFrom(1,1,1,1);return function(){function b(b,d,f,k,m){this.id=a.__GLMaterial_id++;this.program=b.get("texOnly");this.color=f;this.depthFunc=m;this.blend=k;this.texGLName=d}b.prototype.getId=function(){return this.id};b.prototype.beginSlot=function(a){return a===d.INTERNAL_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.setColor=function(a){this.color=a};b.prototype.bind=function(b,d){b.bindProgram(this.program);this.program.setUniformMatrix4fv("model",
a.IDENTITY);this.program.setUniformMatrix4fv("proj",d.proj);this.program.setUniform4fv("color",void 0!==this.color?this.color:k);this.program.setUniform1i("tex",0);b.bindTexture(this.texGLName,0);this.blend&&(b.setBlendingEnabled(!0),b.setBlendFunctionSeparate(b.gl.SRC_ALPHA,b.gl.ONE_MINUS_SRC_ALPHA,b.gl.ONE,b.gl.ONE_MINUS_SRC_ALPHA));b.setDepthTestEnabled(!0);void 0!==this.depthFunc&&b.setDepthFunction(this.depthFunc)};b.prototype.release=function(a){void 0!==this.depthFunc&&a.setDepthFunction(513);
this.blend&&a.setBlendingEnabled(!1)};b.prototype.bindView=function(b,d){a.bindView(d.origin,d.view,this.program)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};b.loadShaders=function(a,b,d,k){a._parse(f);a=new q(k,a.vertexShaderTexOnly,a.fragmentShaderTexOnly,m.Default3D);d.add("texOnly",a)};return b}()})},"esri/views/3d/webgl-engine/lib/HighlightUtils":function(){define(["require","exports",
"./IdGen"],function(w,l,f){Object.defineProperty(l,"__esModule",{value:!0});var a=new f;l.generateHighlightId=function(){return a.gen("highlight")}})},"esri/views/3d/support/debugFlags":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor".split(" "),function(w,l,f,a,d,b){return new (function(b){function q(){var a=null!==b&&b.apply(this,arguments)||this;a.SCENEVIEW_HITTEST_RETURN_SELECTOR=
!1;a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1;a.HIGHLIGHTS_VISUALIZE_BLOCKS=!1;a.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;a.DECONFLICTOR_SHOW_OUTLINES=!1;a.DECONFLICTOR_SHOW_GRID=!1;a.LABELS_SHOW_BORDER=!1;a.OVERLAY_DRAW_TEST_TEXTURE=!1;a.OVERLAY_SHOW_CENTER=!1;return a}f(q,b);a([d.property()],q.prototype,"SCENEVIEW_HITTEST_RETURN_SELECTOR",void 0);a([d.property()],q.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0);a([d.property()],q.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0);a([d.property()],
q.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);a([d.property()],q.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0);a([d.property()],q.prototype,"DECONFLICTOR_SHOW_GRID",void 0);a([d.property()],q.prototype,"LABELS_SHOW_BORDER",void 0);a([d.property()],q.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0);a([d.property()],q.prototype,"OVERLAY_SHOW_CENTER",void 0);return q=a([d.subclass()],q)}(d.declared(b)))})},"esri/views/3d/webgl-engine/lib/webgl-utils":function(){define([],function(){var w=function(l,
f){for(var a=["webgl","experimental-webgl","webkit-3d","moz-webgl"],d=null,b=0;b<a.length;++b){try{d=l.getContext(a[b],f)}catch(q){}if(d)break}return d};return{create3DContext:w,setupWebGL:function(l,f){function a(a){var b=l.parentNode;b&&(b.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+a+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}
if(!window.WebGLRenderingContext)return a('This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e'),[null,'This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e'];f=w(l,f);return f?[f]:(a('It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'),
[null,'It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'])},detectWebGL:function(){var l;try{l=window.WebGLRenderingContext}catch(a){l=[!1,0]}var f;try{f=w(document.createElement("canvas"))}catch(a){f=[!1,1]}l?f?(l=f,l=[!0,{VERSION:l.getParameter(l.VERSION),SHADING_LANGUAGE_VERSION:l.getParameter(l.SHADING_LANGUAGE_VERSION),VENDOR:l.getParameter(l.VENDOR),RENDERER:l.getParameter(l.RENDERER),
EXTENSIONS:l.getSupportedExtensions(),MAX_TEXTURE_SIZE:l.getParameter(l.MAX_TEXTURE_SIZE),MAX_RENDERBUFFER_SIZE:l.getParameter(l.MAX_RENDERBUFFER_SIZE),MAX_VERTEX_TEXTURE_IMAGE_UNITS:l.getParameter(l.MAX_VERTEX_TEXTURE_IMAGE_UNITS)}]):l=[!1,1]:l=[!1,0];return l}}})},"esri/views/3d/webgl-engine/parts/Viewport":function(){define("require exports dojo/has ../lib/PerformanceTimer ../lib/Camera ../lib/Util ../lib/gl-matrix ./Visualizer".split(" "),function(w,l,f,a,d,b,q,t){var m=q.vec3;w=q.vec4d;var k=
q.mat4d,p=[0,0],x=k.create(),z=[w.create(),w.create(),w.create(),w.create(),w.create(),w.create()];return function(){function a(a,b,f,k){this._content={};this._frustumCullingEnabled=!0;this._maxFarNearRatio=2E4;this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,visualizerRenderTimer:null,viewportRenderTimer:null};this._needsRender=!0;this._rctx=k;this._gl=k.gl;this._visualizer=new t(a,b,f,this._rctx);this._camera=new d(m.createFrom(0,100,-100),m.createFrom(0,0,0))}a.prototype.getCombinedStats=
function(){var a={},b=this._visualizer.getCombinedStats(),d;for(d in b)a[d]=b[d];a.renderGeometriesTotal=this._stats.renderGeometriesTotal;a.renderGeometriesVisible=this._stats.renderGeometriesVisible;void 0!==this._gl.getUsedTextureMemory&&(a.textureMemory=this._gl.getUsedTextureMemory());void 0!==this._gl.getUsedRenderbufferMemory&&(a.renderbufferMemory=this._gl.getUsedRenderbufferMemory());void 0!==this._gl.getUsedVBOMemory&&(a.VBOMemory=this._gl.getUsedVBOMemory());if(void 0!==this._gl.getUsedTextureMemoryStats){var b=
this._gl.getUsedTextureMemoryStats(),f;for(f in b)a["texMem type: "+f]=b[f]}return a};a.prototype.dispose=function(){this._visualizer.dispose();this._visualizer=null};a.prototype.setLighting=function(a){this._visualizer.setLighting(a)};a.prototype.getViewParams=function(a){var b=this._visualizer.getViewParams(a);if(!a||a.frustumCullingEnabled)b.frustumCullingEnabled=this._frustumCullingEnabled;if(!a||a.maxFarNearRatio)b.maxFarNearRatio=this._maxFarNearRatio;return b};a.prototype.setViewParams=function(a){void 0!==
a.frustumCullingEnabled&&(this._frustumCullingEnabled=a.frustumCullingEnabled);void 0!==a.maxFarNearRatio&&(this._maxFarNearRatio=-1===a.maxFarNearRatio?2E4:a.maxFarNearRatio);this._visualizer.setViewParams(a);this._needsRender=!0};a.prototype.setRenderParams=function(a){this._visualizer.setRenderParams(a)};a.prototype.getRenderParams=function(){return this._visualizer.getRenderParams()};a.prototype.getFrustumObjects=function(){var a={},b;for(b in this._content)a[this._content[b].name]=1;return a};
a.prototype.modify=function(a,b,d,f){this._visualizer.modify(a,b,d,f);this._content=this._visualizer.getContent()};a.prototype.getContent=function(){return this._content};a.prototype.setCamera=function(a){this._camera.copyFrom(a);this._updateNearFar();this._needsRender=!0};a.prototype.getCamera=function(){return this._camera};a.prototype.getPickRay=function(a,b,d){return this.pickRayWithBeginPoint(a,void 0,this._camera.viewMatrix,b,d)};a.prototype.pickRayWithBeginPoint=function(a,b,d,f,c){return this._visualizer.getPickRay(a,
b,this._camera,d,f,c)};a.prototype.addExternalRenderer=function(a,b){return this._visualizer.addExternalRenderer(a,b)};a.prototype.removeExternalRenderer=function(a){return this._visualizer.removeExternalRenderer(a)};a.prototype.getExternalRenderers=function(){return this._visualizer.getExternalRenderers()};a.prototype.render=function(a,b){this._updateNearFar();this._visualizer.render(this._camera,a,b)};a.prototype.resetNeedsRender=function(){this._needsRender=!1;this._visualizer.resetNeedsRender()};
a.prototype.needsRender=function(){return this._needsRender||this._visualizer.needsRender()};a.prototype._updateNearFar=function(){if(this._frustumCullingEnabled||0<this._maxFarNearRatio)p[1]=0,this._computeFrustumCullingAndNearFar(this._camera.eye,p),0<this._maxFarNearRatio&&0<p[1]&&(this._camera.far=p[1],this._camera.near=Math.max(p[0],this._camera.far/this._maxFarNearRatio))};a.prototype._computeFrustumCullingAndNearFar=function(a,d){k.perspective(this._camera.fovY,this._camera.aspect,1,10,x);
b.matrix2frustumPlanes(this._camera.viewMatrix,x,z);this._stats.renderGeometriesTotal=0;this._stats.renderGeometriesVisible=0;a=-Number.MAX_VALUE;var f=-Number.MAX_VALUE,m=z[0][0],c=z[0][1],p=z[0][2],r=z[0][3],q=z[1][0],l=z[1][1],u=z[1][2],v=z[1][3],t=z[2][0],w=z[2][1],O=z[2][2],L=z[2][3],M=z[3][0],R=z[3][1],Q=z[3][2],T=z[3][3],A=z[4][0],V=z[4][1],S=z[4][2],h=z[4][3],e=z[5][3],g;for(g in this._content){var n=this._content[g];this._stats.renderGeometriesTotal++;if(!n.material.isBackdrop){var y=n.center,
F=y[0],N=y[1],y=y[2],n=n.bsRadius;if(m*F+c*N+p*y+r>n)continue;if(q*F+l*N+u*y+v>n)continue;if(t*F+w*N+O*y+L>n)continue;if(M*F+R*N+Q*y+T>n)continue;N=A*F+V*N+S*y;F=N+n;N=-N+n;F>a&&(a=F);N>f&&(f=N)}this._stats.renderGeometriesVisible++}g=a!==-Number.MAX_VALUE;0<this._stats.renderGeometriesVisible&&g&&(d[0]=.99*Math.max(1-(a+h),2),d[1]=1.01*Math.max(10+(f+e),d[0]+1))};return a}()})},"esri/views/3d/webgl-engine/lib/PerformanceTimer":function(){define(["require","exports","./Util"],function(w,l,f){return function(){function a(a){this._filterSampleIndex=
0;this._lastTime=NaN;this._numMeasurements=this._totalTime=0;this._filterSamples=Array(a);this.reset();this._filterSize=a}a.prototype.reset=function(){for(var a=this._filterSampleIndex=0;a<this._filterSize;a++)this._filterSamples[a]=NaN};a.prototype.start=function(){this._tsStart=f.performance.now()};a.prototype.stop=function(){this._lastTime=f.performance.now()-this._tsStart;this._totalTime+=this._lastTime;this._numMeasurements++;this._filterSize&&(this._filterSamples[this._filterSampleIndex]=this._lastTime,
this._filterSampleIndex=(this._filterSampleIndex+1)%this._filterSize);return this._lastTime};a.prototype.getLast=function(){return this._lastTime};a.prototype.getLastFiltered=function(){for(var a=0,b=0;b<this._filterSamples.length;b++)a+=this._filterSamples[b];return a/this._filterSamples.length};a.prototype.getAverage=function(){return this._totalTime/this._numMeasurements};a.prototype.getTotal=function(){return this._totalTime};a.prototype.getNumMeasurements=function(){return this._numMeasurements};
return a}()})},"esri/views/3d/webgl-engine/parts/Visualizer":function(){define("require exports ../lib/Renderer ../lib/SSAOHelperObscurance ../lib/ShadowMap ../lib/NearFarCalc ../lib/Util ../lib/gl-matrix ../lib/RenderPass ../lib/HighlightHelper ../lib/OffscreenRenderingHelper".split(" "),function(w,l,f,a,d,b,q,t,m,k,p){var x=t.vec3d,z=t.mat4d,v=q.assert;return function(){function r(m,r,q,c){this._drawSSAOMapDebugQuad=this._drawShadowMapDebugQuad=!1;this._needsRender=!0;this._content={};this._rctx=
c;this._renderer=new f(m,r,q,this._rctx,!1);this._programRep=m;this._shadowMap=new d(m,this._rctx);this._ssaoHelper=new a(m,q,this._rctx,this.setNeedsRender.bind(this));this._nearFarCalc=new b;this._highlightHelper=new k(m,q,this._rctx);this._offscreenRenderingHelper=new p(m,this._rctx)}r.prototype.getCombinedStats=function(){return this._renderer.getCombinedStats()};r.prototype.dispose=function(){this._renderer.dispose();this._shadowMap.getEnableState()&&this._shadowMap.setEnableState(!1);this._shadowMap.dispose();
this._ssaoHelper.getEnableState()&&this._ssaoHelper.setEnableState(!1);this._ssaoHelper.dispose();this._highlightHelper.getEnableState()&&this._highlightHelper.setEnableState(!1);this._offscreenRenderingHelper.getEnableState()&&this._offscreenRenderingHelper.setEnableState(!1)};r.prototype.setLighting=function(a){this._renderer.setLighting(a)};r.prototype.getViewParams=function(a){var b=a||{};if(!a||a.pixelRatio)b.pixelRatio=this._renderer.getPixelRatio();return b};r.prototype.setViewParams=function(a){null!=
a.pixelRatio&&this._renderer.setPixelRatio(a.pixelRatio)};r.prototype.setRenderParams=function(a){void 0!==a.shadowMapResolution&&!1===this._shadowMap.getEnableState()&&this._shadowMap.setTextureResolution(a.shadowMapResolution);void 0!==a.shadowMap&&a.shadowMap!==this._shadowMap.getEnableState()&&this._shadowMap.setEnableState(a.shadowMap);void 0!==a.shadowMapMaxCascades&&this._shadowMap.setMaxNumCascades(a.shadowMapMaxCascades);!0!==this._highlightHelper.getEnableState()&&this._highlightHelper.setEnableState(!0);
void 0!==a.ssao&&a.ssao!==this._ssaoHelper.getEnableState()&&this._ssaoHelper.setEnableState(a.ssao);void 0!==a.ssaoAttenuation&&this._ssaoHelper.setAttenuation(a.ssaoAttenuation);void 0!==a.ssaoRadius&&this._ssaoHelper.setRadius(a.ssaoRadius);void 0!==a.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter.");void 0!==a.ssaoSamples&&this._ssaoHelper.setSamples(a.ssaoSamples);void 0!==a.drawShadowMapDebugQuad&&(this._drawShadowMapDebugQuad=a.drawShadowMapDebugQuad);
void 0!==a.drawSSAODebugQuad&&(this._drawSSAOMapDebugQuad=a.drawSSAODebugQuad);this._ssaoHelper.getEnableState()?this._renderer.ssaoEnabled=!0:this._renderer.ssaoEnabled=!1;void 0!==a.offscreenRendering&&a.offscreenRendering!==this._offscreenRenderingHelper.getEnableState()&&this._offscreenRenderingHelper.setEnableState(a.offscreenRendering);void 0!==a.antialiasingEnabled&&(this._renderer.renderOptions.antialiasing=a.antialiasingEnabled?"smaa":"none");void 0!==a.earlyOcclusionPixelDraw&&(this._renderer.renderOptions.earlyOcclusionPixelDraw=
a.earlyOcclusionPixelDraw);void 0!==a.defaultHighlightOptions&&this._highlightHelper.setDefaultOptions(a.defaultHighlightOptions);this._needsRender=!0};r.prototype.getRenderParams=function(){var a={};this._shadowMap.getIsSupported()&&(a.shadowMap=this._shadowMap.getEnableState(),a.shadowMapResolution=this._shadowMap.getTextureResolution(),a.shadowMapMaxCascades=this._shadowMap.getMaxNumCascades());this._ssaoHelper.getIsSupported()&&(a.ssao=this._ssaoHelper.getEnableState(),a.ssaoAttenuation=this._ssaoHelper.getAttenuation(),
a.ssaoRadius=this._ssaoHelper.getRadius(),a.ssaoFilterRadius=this._ssaoHelper.getFilterRadius(),a.ssaoSamples=this._ssaoHelper.getSamples());return a};r.prototype.modify=function(a,b,d,c){this._renderer.modify(a,b,d,c);for(c=0;c<b.length;++c)delete this._content[b[c].uniqueName];for(c=0;c<a.length;++c)this._content[a[c].uniqueName]=a[c];for(c=0;c<d.length;++c)v(this._content[d[c].renderGeometry.uniqueName]===d[c].renderGeometry)};r.prototype.getContent=function(){return this._content};r.prototype.getPickRay=
function(a,b,d,c,f,k){x.unproject(x.createFrom(a[0],a[1],0),c,d.projectionMatrix,d.fullViewport,f);x.unproject(x.createFrom(a[0],a[1],1),c,d.projectionMatrix,d.fullViewport,k)};r.prototype.getProjectionMatrix=function(a,b,d,c,f){b=q.fovx2fovy(b,a[2],a[3]);z.perspective(180*b/Math.PI,a[2]/a[3],d,c,f)};r.prototype.addExternalRenderer=function(a,b){return this._renderer.addExternalRenderer(a,b)};r.prototype.removeExternalRenderer=function(a){return this._renderer.removeExternalRenderer(a)};r.prototype.getExternalRenderers=
function(){return this._renderer.getExternalRenderers()};r.prototype.resetNeedsRender=function(){this._needsRender=!1;this._renderer.resetNeedsRender()};r.prototype.needsRender=function(){return this._needsRender||this._renderer.needsRender()};r.prototype.setNeedsRender=function(){this._needsRender=!0};r.prototype.render=function(a,b,d){var c=a.viewport,f;if(this._shadowMap.getEnableState()){f=this._nearFarCalc.calculateSceneNearFar(a,this._content);this._shadowMap.prepare(a,b,this._content,f);b=
this._shadowMap.getCascades();for(f=0;f<b.length;++f){var k=b[f];k.camera.setGLViewport(this._rctx);this._renderer.renderGeometryPass(m.MATERIAL_DEPTH_SHADOWMAP,k.camera)}this._shadowMap.finish(d);a.setGLViewport(this._rctx)}this._shadowMap.bindAll(this._programRep);this._renderer.renderAuxiliaryBuffers(a,this._shadowMap,this._ssaoHelper,d,this._offscreenRenderingHelper);this._renderer.render(a,this._shadowMap,this._ssaoHelper,d,this._highlightHelper,this._offscreenRenderingHelper);this._drawShadowMapDebugQuad&&
this._shadowMap.getEnableState()&&(a=z.ortho(c[0],c[2],c[1],c[3],-1,1),this._shadowMap.drawDebugQuad(a));this._drawSSAOMapDebugQuad&&this._ssaoHelper.getEnableState()&&(a=z.ortho(c[0],c[2],c[1],c[3],-1,1),this._ssaoHelper.drawQuad(a))};return r}()})},"esri/views/3d/webgl-engine/lib/SSAOHelperObscurance":function(){define("require exports ../../../../core/Logger ./Util ./gl-matrix dojo/text!../materials/internal/ssao.xml ../../../webgl/Program ../../../webgl/Texture ../../../webgl/FramebufferObject ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Util ../../support/imageUtils ../../../webgl/enums ./DefaultVertexBufferLayouts ./DefaultVertexAttributeLocations".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u){var C=d.vec3d,E=d.vec4d,c=f.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelperObscurance");w=function(){function d(a,b,c,d){this._enabled=!1;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=E.create();this._rctx=c;this._programRep=a;this._textureRep=b;this._requestRender=d;this._emptyTexture=new t(c,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:4,height:4},null)}d.prototype.dispose=function(){this._emptyTexture.dispose();
this._emptyTexture=null};d.prototype.getIsSupported=function(){var a=this._rctx,b=-1!==a.parameters.versionString.indexOf("WebGL 0.93"),c=-1!==a.parameters.versionString.indexOf("WebGL 0.94");return a.extensions.standardDerivatives&&!(b||c)};d.prototype.setEnableState=function(a){a?this.enable():this.disable()};d.prototype.getEnableState=function(){return this._enabled};d.prototype.enable=function(){var a=this;if(!this.getEnableState())if(this.getIsSupported()){this._enabled=!0;var b={target:3553,
pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},d={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=m.createWithAttachments(this._rctx,b,d);this._blur0FBO=m.createWithAttachments(this._rctx,b,d);this._blur1FBO=m.createWithAttachments(this._rctx,b,d);z.dataUriToImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAIAAAAlC+aJAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAqf0lEQVR42gTBB5ydB2EY8G/v8b7v7Xnv9mmcdFp3WpasZUuWFzZgDJgkhgwoSdM2JbTNjzZA06ZNgaRJWtKSEgjDGNuA8UYeWpZkbZ10uj3efu977317j/7/4De/8ef9vCow2VUGGHzRhuQ+t08GvhZb+jy85wOu/68JzwtQSCZedpsvC8SL6NJNNwZoHMaZiMoCrjrPATpGJFxvRCYMKqTCBsyVw8h5B6ROArU3+8HOGLe3Ay+UABow3D4wEcfOakDbjh2h594mikMNcI62ISNzIius0bfeN+QHrv+L7M53FHq1XC29breFgmCjwPHQ/fo88OIg9kvDdQPhB93G8yk6DtRYFT64fR/jQn0NIcIgYHylyFjVHPBboCB7HQ5sXuoZqQCHqKUjtvKNpvxkivqlZe514DOA/Keethib6OkOw204MMTjY3HX8VIGFeITgBEApGRFY3hyKyPeRWK/NNa2huJeLKzBJAimiY7ZQbAh0HwPEP9jxHhs6he37z8+KWqdeD7TCttNwgHftJpfzCq/iOJbKrxap2Ymet8zwVEoNReE7T4aI6t2mBuO4Meyh3vHAeK2+KvLzWHEgSCJpgR5EvP7QPFLyeDWWrqc1iVz6LwPI7GEpOEExCwzVZwtKtDGyzRW5tGyz5WA7HLtfrOIHp9T9kXQB1z7E10eYMytTs5QOuci8E+YIk9W/roj5nxvjVVLaM+30x/09CPGIdQlfsOe/WqxoS9Sf5bVv+drIqyP6uNrQMxFGDPSt1PurVE/UcuV9ci35bmCPTiIjsuZZjZCePj01iMbKBYa7UyVIDI+MDMSAV7sw6CSjKEG0IqwXhEkVtFwFJQ9D3q9q2RE8xEzuxvCN0Bq0pAFH7IMZEW3/zQU6rQ8Dw1bqPE2XCxtht8B/Hsg/yzu3CUcGdb6PW6QCVRs7bYKDwDQfYefmmJO2O/d4LyOzns2kA3kt7Bxrn1ZZ4hlYFs+uYpAnNDyDI36VE+6wLadkEwTwQIdYovCIM8SEVS24D+ktuqjWIT4yWFEN/zEfsqIWkFfKQsW8DNVyLEDKWwZ6ew8x5ojpAmh7DbTuiCGFcW/DXl5hO7Y/BztDCbwqtMaxcanBq59oBYuVIAM2o2twXHduUpDjChd7xinXHoB5OKsvd/jlrN+SnHoir0dn1hWWSbrDzj0Nd6x3PUb1LYyVIpv9AHW9sPW+aEhU8peULyaAG12TddDnq0zVg5S+vfnVLQBwjt3PcU9k0feDfAkCjohqkfBRgeVfcx1xYcTzRYoNbVPbCQ/mmC66x3pMpN7IPDeT7a2+TYYDYj41QNoEoGVQhPLlIPb8k2yMZlM2gNIiEu4nfIZFKeDW08qY9ds2wLoLWIt2yJuYrXnWhNbytRVs1sHIw6qhoE/sYJsJArzFLNdUzxalSOyF3oIBU2ttqZFumoEj6XoZVOHKWSJDoGe+WGZmObQuA4f+uap/u15hOEW1LveusgkSWNvivQRRg7bAQWcd+wUcmN/DTkr6XeHmX/pVnYkebSt/RBNP8PhsXnqFhfUu/ozIH++g98KYa+EnqoRZtFucB/WVPy5MoJEyH+RgSeFoTuDS3Rjpi7Iog/+N2aD7N9oJkprVsWpNOqZ5JsMfDKSID//tUCyQrANUm4Q/czDP1mKVTo2lrM6uuJh9RV3pMc1ylB/5zpYs3EWgR87+hDYZY06VIzFYd+HxTY9FyARG0RytMQAJujsU3Pz/qPlwVVI99+KBosYv4qQOzQP4WWCfPVd5eSjvPMmAkY0LFL9lX5vMfDKgtMADu3pCrNLctVht8XYBr6KRvBkWte8jafxscvmLE7tITB4IxDf4GJ/7YdtklZdgOO6z62Bj4ADitP0UfcQAiwSnoEgw44j+mCCpjb7zL2IcBSOYLS5ArdRgU/EJrsgnLhuAgv6ylO+fTYJZMPiFVUt4bafDNpq8gW2/+Wc1LSVejMjel0a5Yg2kUT1DzSmbB3aGVsieORVfXAq7vYkeQUZKUHxZlufMOFKsneeaJYoxjH4j6q2BObSoPx+o2RkzKti/lyb2uC7h60bB4z9maJ4tnFpvw/fQ8zfJ3IAAiSE6G2X40l/PFI+xGgcAjM+/31BL8p1KGRn8kFaztzEFxsAfOxjR910VTxaqsh6/z5RGNebzyWtoossscYHUPKL91d9BhtQTclREMGf6PoMnmDJ6orHxKl7RZO9DwAIBqRCqlbTHs8hf0fa/1ZcPuxk/I42xYnbafCqgGGatSnGPUaE/1azHhdzw/rok76dX+vslH00lkxaRKfW/wwn3mJTQOH5bu/vzgMJNnTuAvJMFL3p9f90ttxSrfnxNusCI0spKhX0O7XBAHcouivCT56YhuFE+A4vrQr7VfSfeXbsbpt4rbhpwuNPNBagcd8A6DO4PgSzeDQ6lGlIevQ2yGyG3fn49mPgnTNJZqVuLwC8E3FFyBozgL47rtOWlrXOd1s/dRPjgYmLAzl2dWFOGk+bW+PStap2Xm/ERvzJdDYd4fd16N3x3ooL/FzJ8PEPT4H4WRk5ygiRK97yrjHU5p/69gdFfUdLiDlYG0NeFYyjRmZNdLM6mDPgwceejmpR8ek2Pm02WQ3ZqW5nCDTpL9931LtJdladOI0oZjCwoGICD1xZV4cYZxIgzhjekCf9wh4+jDU5IjvsdEm/12T6e0aJ5YqnS7ROWkWBX3FAnboqd7c6kAcAxZwBS3bSAZcH0F6pV/7AkfvSEzW3fzrp1VvQjkL3wetuK7N/CV692ve/zNVq5KYktPLl/CMDhNzFjT6ZOIK3RgxqBaLxgL8Aoc+F8MeP7gFuRpXbCDtlAbL10NvMh/tsocPBVQx9SFIIiN0CNzcipYWwz5GmjGWiarABr7U30U+uUNtF9/saPWDaKnox3JOtzsKvq1INHtwgug+a9C8U+XIiPGGIWaCNg7RE1WFxot+t3g22M6JFGzGOpSzmpS+ODP4Q6RwuwVKDW0f8olQHYv4Iwf51NAr0mmJoXL1TpxX/Jwq9m3b+wiCKtLfiNrWV4I/5xBkDPvnpZ+Q8EN/Czdf1bA+T5A6JpRxP74kwUm8y12j7Jd+fsDMtag5nJvLUigJjbnooZikOBpxD6T+Nk7Ln0kFZlhujYcHz/L1UK05AHRt+gErP4E4f5gKsX+O8TCsbUG1hHj2+vX3Ng7bL0R3a5KytLaPmeay0xND+gBfUj9Phq/2xfYKS87H3ta1Qso4H9Ca6X0hoMdy/IXM7QuhIVg9ZbI2oBRhk6xpX8qoHNrL9POGnrNERY9igV1x61qKLAvFcGoiRcch1N+k7LK/5D0D3eIobCG4s2iADwB67+vJqtk0Tc1TMkgQLKKRG4Bl48I3u2FQq/lO3XbK9g21Br2Wrcyobb2DqyLVhQbWbiwX3JdQGgLjIbjStUiveYGF6IpjdMZj6eyO1pSwXCSByV38TzEY2/VEpeAXdtABk0qq9aZB+cGf+ukGgq26f4iAJfso+9b38L3dfnIImHIwH4TRyf4e78yxS+Uxq6TugN4xw5XDxOoluqXYDJhgyxre24BJr10njnXjpWcTtWbdv4aXNbXQq03s36vFSR1oz9oxk321YuwoQdbNCsfy3tHAmMcnpdcCnnvFu3ffTYs/Ph90bPfqToDdPLPaNcCKivoo0Rwkqbsk1bPVbJpYxGIKUfXH4pK6H8fghaPY13icA4JO+NLuCpoYlHDM9EB75+kNH/n6o9zE+TRnBkkL8xiqWY+Q9ZzaAg4+fLzZjhNfw3w/gUQRFiPz+fPeS0b8aFIJGPC+rr24QY6gIO9YVpEO6A2aaeyYdXRMVVLdKluURo78cBmBt9EtRzeNaKwWKt2E84X3D5pkIp/iAp5BlCgOpbCJAGniU3QBwNA46JmID4zirCmjDcPth6PehZa+zDdAvOqltgXj53q4T5ealBjQn4yoLHxl7ENmhUxeNvsVRYwtikoW6UeUxgr9EMFvwiR9UeuVRYKur4GLqMtLds4H9c7GxNSJGLKubjwZ8TGOXLmgCr4e5uEw7XWCj+lNk1wMUOZOC/mXXfhLtvOu24Kyd7Rq3dEnkuAFo8DA4pyLpJ0zioo44oRxXdESQO1rq81ulq3WDJXbt3ADVNIjWg2a/R+JYnI2PeepVLB6LPzi5eMUa2/jvGWrYA0pIsd2Ax6mPHbLgJuQbN3uQNGGu19WDg/3b6lAnBRn9N3KlQsrLj5LkBOCnwk7P3pLX1ljdnh8cnPPerTvbJmSkWHISCPCTNYii/Dg4JrjaCNS+3DAPRwm9DyJkalkLQz4YsGNLFveiCyw6cE4MzvjUgRAl0jAQclYHdAaYaFVABepI4sP/oeepxPi9oGlSi3tpWIX0FzAOuE71y02MAmdQrbkGPmClGtJGKw+fOHi4cTrPd5qF/4KGkWmwqPqRP9fyB03ZL2FMBtc/W3/43eT17zGJUY+tBegRFjLJktlYf8TKpkmzJai8GvczudWw+UeEPcTZGuLLoFGDpv5YDH7ZFo4P1jmZ3TCjEotNcBqm155Pjm3NzFEKWKF7KcVY72eG4IF507vbNnbj9CwxsimhPW5KBT/cwpfvy/YzvJdcA+6n/B0d85Em9Jpj0SJ6LewBcL7Fw//+NzPSGw1uSqy9jfTmcJuyMzyA57DcJ7BZOkbPIcUXsDPjoMXY/keYYLd0Rax9ZOgJqJzTsb8onXqy1r3kKf8mbdIKVceTSXiiGi4/HR7Pt5tt27+BzW2VM1tj6lqIToB4087XR9bgOfSFKyGf5eeM2J0YhpmrH9/Uu2+28qDSL1av08BUz/i2dTounIci36M4SXJfQvpHifh6TOnD1lTMejVlfZUXf66md5FwdmEaOG1150HxOMK+gQNbgOZs0N1/lb7CJLdA8ILbK7RYCYPhDrXAb+xLMG4f8mFkDpBeyS5+tXLxfxPxJxjk++79i5TfpbnAivqN+HcMfaKsuVEQwkWRTQ6/a5BboYuIP2CsCo3BHucNjYkXfHt7YLxqKU/w4c/bdMrAM0RpawTOtWVdL3+l+Mr9a6KGHjzCdL+Pcs82YJuhXDZ2rh2NZcStekK3eqM4bjnwp/7yMa1OFl1OV3t6QPCo35w0tr2V7Copy7J1Es2x8Vv/HFIPufBxivtOv7nfIH2UelqlYzTdYMRhlOaizWtwONQqix3wIN5egwKRjEqW/h7rM7j0/YG2BRMfQkYeQJUQeo9nCmVps09F9focPDhOOXQUQMjU5dVeslBdgwfdev4kpssy+ovCLglTwJ6SUOXLRMTn3S0pz10x5bTC15u11cl30Nk9Jrzr0xP8nKHV48h0J54cVJqaeI9qlm1gjOB1k0QhXwFP2ObcgC+t0r1ti6P/KzA/SXo/IN0SMFjq9ZuIrLr9A1akw429QOUM5B5UEmUvRmTAe60bM1yWrYMPpCFXI/q4RWB0CWq9rGRvUP6uaKQ/IG34bkpJkt3ViM6N0IEnJx4orp2D+v9I4duJatlZ7BHsJdqYiWJ5E3tNwoeEVCoY2xmtrCoYT1IXAPjUwBP+UKQvs1zFNa06XEMiWsMnUtTlALgZWDlM1hWo28GbMfiUPvgdt/o7pfRflcM/cqANpekRiR1c1GDZum7sabObAKJGAiHtLqegHQC9DUL/UQuHsMQHtHGasfv6lruN/s+g4LNBZ8IJFEA+CQPYmvAjW3wuu8Em2BOLwXwZlFGfMPA9gYvg7ivh8mmQV+jMZCwMKS/nJW8SwW8HazdipRdLct7AJkj40MeOWg3QPwIrXSSc0ovjYScZv/py9VCo137HQyowz7J1BdefseFZXLWQTNmHRNUYHKOArrc1Ld3Tuhw9+iusRlGgUILvkENzEP00tfai71AkRVocwA0+urjxvsVO2au4HpYHBLzTXC5UGH9S7qA+0j8DO6I9fVCSn0La27FII/Qbem53DIga6BQMqMD2zzG2vQobkLxi4skm+av45lv9+w+7UIYVvifAu/74qdQWePGbEC300M0D1rtJrtekESHiIQhLqFk1c20F3oyQ/1MLh3NF2TCvWlpMoB11+RF/m885P9EFQfa2INC4bf0oSDykNB1c7ThJKog6qH/NiRykcxtxc2BiNWPBGQs03Gqy95X23pK3XS3Id6JoO1j/fb+rDEHXOWYCdF5p3D/MD/9Mrf9+0tmM5+43b29zk5/TG88Wc7/BuItg64CzAGDFRsPDYMwC4GPHTsRewpMoEvw7U5wNabW1NhdM5YstTBJvmeCl7EufAXYGheRUrgK3lAcnaBjUtvX7A1YCYrVzG4BI+Fs3u211IAOjITr3qxz1iQhYAzxcC97nqQcC/gNJ/ksGu21JMSvl4BgZhY+tDS2kbAZC/0+j2RmMSIBqxviUr8mBMw5m0irMJ0A6wqp4q7OS54rtv3SYfwE31V4hYBefEWo9yP7E3S6Ry/zAdvd68APdrcHzIBj1kQVNtfTmSN4Y1lvHcX/BxRMGVgizNziT1a+NL4f1ZGrBBLkAbTppStCqqHPLZhyPiDx3SKmtw205TO2WxMEQqkULr7vCn91BzmndvbHWFAu8GiSrgAZyZNMScbS5iAArlhrh5G4HedwL/wH2E6v+bbD1O455A4uBvlNoAUNKwqPsjk9+loTuhkiXwuigelze5UHCb/AJNKw2cc+G4CfE/Z0ZwVsDXSAOfr9R/gpL/ghGMJOL8BA2mOuKNInxFF6AW/7uErMW8sNkEBOBtXXXEbm30CCTJbxe6EOIbec+RTjqvdUflOP7AfgnkC8nhSIm3neEOmts61kCO/o2RP02eqWjJjzYn3A/WgFSoyAwj64gKr0H3nFCK7pZt2FDmwwcSqB3YBMgY3HXWDAoBqr9PHSGIeh/l/QZXZpL2wpO7AylAwZ87Pce3z6xUVvn4SNt0I8zpte4alIJpNWn8cjfSE4UKTvooupk8qPXRvFrmj6smvX17qSIX9baO7HYIjg6IqOvJIEg3tVQ9qyR25F2fx7JpzrMHwCdjgkYRexElPxR1RDICwMQssAVuoCZADE5CJ9ZJS8LV/rUdEFDlFhrI1yQ+/EEZmII9DDLO54bQvrj5cmbQPfa7cH/UOQXdKzucZ2IOklamgTnaRQuwQ/+x1PS39leFqUqIMbQ9x6YH8xs9TiGTviU6lvwehYNuM1i85I+gNg8DiEuTIIk2iOce93t0LQ0udyF6JpSw2dw9G1nJVmKfxT36xJryH6PzgQR9qRD1Mm5e37Mygzm/LbTyeGse9tUbxKBlqB2FtLmQgRT0XuwlEeSNxcWvzw98AE28vXwWr2FlIrAWsXu9Qf2Q3c/wgIo6RZJ5GQlejmceYZfebOaO8nDj/iTnf8s2C9IEEsxD0K57+JXP2Utf9NInQAnGuzKs458w4LXRbgQ9GaWxz4G11+LwAVYeMNM7iHu6gv4qVhtn2OYKeKRJRdJHF61unu1ms8j/2aR7OYTz6aWX1mXRDFnB7aepsLG4BHvkkwVYqa/DYsRNiB3CDPZ2q5Kr5L8oC6j5ULS3/jzu6tf88tQ1tTXmBhfdwgUwXDbbt33gD8woaq7sVQiLnSMXLTtZzY89fkny98x1N8pSu8ETpNAIhg/T8GIQvlae9NA9hx0Nc/krzNurU+PlTodk7+HO9MBugPzcYk8hFtQfN/X7klPxXMLqKf25wcIYKZhb/Htf+L1Uc18kw5jZOGML5c98ZDc5yHfzmVjvWqAh2URb7rTpwH7Z5Z+n7SJeCIdOVzgdwzy80P8Hd9okBHiZ/rd9S+Vrvw4zFlirKiTK6TcVpw1zP5HqVhBXt6RhPfu3IsNMMHfNPSZVSonE3UuRpsMiGM3OJSv93QnDntYsYtdGVuljAmJA47Bndeazv44WQHWORbVjGCIspejDdhnQEoI5OYlcXg5yt52/BHhWJF2Rgxn5H7RStg/JEAf9XnV5j1UAfm2Iy+qgJmEmxTPRFm9jxx0wK5FwlHNEHBPdTZ53Mfs/p00dG2Ren4MbqsBCHPX40CcaD98IfZyAX/LGkYN+CRygtyrER/0WGlb84sVrjlknK7HuCRx0us3BOkONLiBYUCABPNb+cChaP1nBEzlW6DhhQp4wS7EaP8jKzkYuZbKviVem6ZHQsCk7QpfziL22v/or/9J1/1wUns39AYhbg+CwWbwRuSzsQTe07J0eMfvMWHVtaiDsBwCaUJapcqMVu/+bgG9YOOvJ0rvKPZQBrhYhc4Z5hMKxupj1xvFyWmg1W5N56lDJHzoDx/cuAshRzC4RgMiLb4Q2pN8r9bnJc+XUvwe3YZ5fcMVHyusfcuXdpv27i51WA0lbuZsfK3s5de9lWW9zXCCmTWIWhI18QtJZ9RNj1RbAC/ACLbCUo/Cit3JZCjjtKR+f5zdBJtOH2uWGr47tDtauNpKbom3Vu6n4oxtJhFDmzaT2pc62ZPu0gKZ4cnId/Bp195CRRtJRKMX3+4KNbD9NDEARUw+Dj82NV0k8VggVL8EZM8rwKmwWWb4ZiA9mmtNR/6rbulcqybAyYcAajMrvmsCHZJlu0CItUtWhsU38uDA04ET8wqzujLFgSgRRzt+kXEaAKwDm59pL/0Y4byu6kKl7cTK+UR9vb7pvG1tF02qxaRg1uiHnx+g7wOFJdw86CMbIvQEdeeHfeLxFBSPJn5VXZvyXLVsJVZjFpf/G5N9TGEn4xIAIx1aZlnqNx48+fxpszhYt1rUyHKHyqS/reuRCO8KEKE/+p90d4cP7dOZGBZrAe4Q2Cr6VoWFGp7KU8jzB6QbTf++mX28Qt7b0RpHxG638hMdZDlOSXXCsLeIhHkEgDBnDc48xzage9HPIxbGocP0yslbVL0Ed92bnx3d/O9vKImgbfPx20LzQCP7f6r+b/H2tmDTlvc+6g0PHKeaeAe5lUU2I63NVlYI5Hba+5RBXfNRT+s/tQ4/PTEt6013TMhfYY1q4O1CPEUaPZSt/QOqj9rMG3KYH1yhRG/UXcb6yZcW8U+k+wPZPCgBlgpNu8Kf+VLERKyNT9vbszywFAMfMpx9lkOsgwtg4j67egVCDgb+ZEV+Y3qxbUuniUxWX3sxPzIPegZS/ka7kue5Y0IwTZu5WqyB9RSCfE3Uwk57704/vV7o8av3lyOVAoQ+jppahwoMNvpxOGpVqrkEMMvAXy4/1nLZ7CXbF+Kq4DobenxfVH8/pClZz8kcJjJSt/V/IWS/l38JjraIQDwVzDZtH9eDrv81QfiKDZ1jLt12E1ftzmRWhx30rpGsWMCynxugBxI8c3BRcxANJ0r34OFhMkV49Gt40u53T1vkZujkMataE3APzs1g0F8IXsmQDntQsdKFNf6iGH8VLQGmiW3JPBuidQduZTq7OqgW5JykjNnmiYjhbLj8+P7cqCWZYZRrkQTaRDf45QL5RUW9XKQDYn5MF6gY8ryV/nXW3qQrGXcQEKwbvgo4z6HJe/l20BOgwI4GgQJQVMNVFiLM3ZsX3olzj1B2we3+Guo/EO8csQZWY33MdXWPW08uYR5nM+10sH+4/+NzncE/GNbn6voapCiKV4hwCWxfwQ78q7g/B6aP81fbEJ+wCzml/1fZcKYdX5lgUa+LB/huzhEU6bsC/HuPnLhb8Wg6ni/HtV9Ygzwe4IyOGaVdivTDbEOW8wcpQLHx/7eC3Zi8sy8oXu5DhE+kw1u06LV7AqFiBTzxumkfMOCJAaDW1i2H8GXwYpRK1uBaofc2xGWoiG1SfQOZZd0xdeJz8d58GK/YijySB0J9Q+cPTWd/fav6mWhmSO8Q1NbxYhNAcb578XuSsC1uvGTGXkoqnwE2LrPE4WXsNmR+dr37NhPqTXwkhI99/qiruLWDhPRfke3BzfdO0Ym4QFzArH8aMPeu75kh1CseVwnsv8eZgrp91VD2VNU2J07EI+ZuhsZro1D0FpfMsrN9T7l9p9GKTy9r7nBy5t7G3PJk57ic3KRV0fbnLkfXYjF0cMEtFJzX6tUctEsk76FuiYm6EKzekXpHANhG2gts8KgF2qDT9Ady9p3FJLXcvD25D//CQrhEA4ctzFtu/O1u7KgeZ1Lgehq0AnjThaOUIIg7oyTm6DQFQGxYkfvTSD5z57MAe02y8MhnHbc3kWCVWgQS5KFidDa1hijkDgK9HylNiIkH7XUrO8mGx+CxPLJ6RBdr/s20MPBsaIkt9iU5tym3LEP0dJx732kMJwDPoVwVGRLds0r/XgQ5tHsywG8kAgXM0DB7PeFzbWyWa93IoiNSjCBLB+zoOu2+108JuNch6SnYLid74PzEj7llBoIHpx7hDqyxHrF/GasXOcNsJUiWOCPPptVgZcrbrM+/gYSTsRQGWXfwbi+2QpryYDX91ZRFe+c74jbKkPWQeYJdeasX+669/9kssmTPRZwQeXKLpE1E+wMyRDnkcUh+wZGLtPCR7U1wokVAtb7GMvgxlM9qyhlaafSIiZSV2vD+PkAeQIjhlvNRwBAevJgfJOo8qbpPQ2lV3ymUV1TQolwR8JBjKHETgw/91SRAJYKWvUwY46fq3dmcPUTKvlFYHq4cWmVrkV/zqAmy8WLPDahcp4/cpPwdQXMEimgoAXgeHsB/4wcD4WgpYL2kvse//ZIdm06Q86YrrHN/K2SfRJ33m8q3c8ZOC98HW3tg6JanGyYpF7dQgLGiKVfQ9BSfnsWrmyqiJkSrmImzcgVGKVKYrTVWN7tf6d09g6JtyFuSLqhgFsKE9Fy0wFs608u58BMfHhXUar/Ce5muvzisF6JoXe2fcbJTln4mpowiRCwa1bKE6YQTUT9l2z2PjQjcg7OFOC2z8RtLwKey7nwpOL7UIOmIcqMA0iv93CeLhhdhHK4m+WVcKc6sqRqPbXLI16EKsbTpOrc4BMRmvPYq2zwSQVf6zmEllfa8DyVodxwKuwDoOxBniJSY0GaSTDsOqaQq/TpWPIHx64a5xoLT7VUtdG8H8OA3t0HiED0CijKwqttKb740UfZbUfUqGDsNpefiSl7rr/f83Q50h3RzmP+FgiNLqYstIw1HsxCxO+NEcqIwD1RLyafv9PRS1ILpg6J3x9QLGncu4++SB34Fv9pKDJ2lVkflsOoIdszZhLGgK6yT3sT6qIAYAGSBuEik+gu6XOLEgRo4G9MPE8n3jPXHO7aczYZ1+58G+f9MLf5MHd1ldxDeLWLZJoN9pgofnfxs6YhJmWY95DHASjIJ7z4lgpx/SPVFkL0J+49CDoRHdmCHKHKzSLUtPev6OAMuUMQEEHouvSjVNk/k3u7co8aJ+6ADVeEupccQgcHC7UHvmhdNBOLdkMUixyPyK5y5ExMa1LU8oJ3sOnIx+RekN9rAOLaHYPY+Mg+Y7XM8dkgU5p0NAOF36Npi5F2nrS0C9fUadVLAZStsYtK4z94LmF/r8P5vHAT/Fou9Tm8cbjNGvPSpfGe9jhgGmhEpo965JlCczvY8rexaSSe7OVjwZnN2Ob0XkI0+vIwpbCs8lTFWA3WPBZ+j2YdrQXUIbCB4f3E+ES1oGFtWgKXRWKbVP8KnH6tCcoS3ie6H7TTq8e/HEl2l9buU/IptFZByo+5URfMLrQ3UGn29p2sMOyh5u9PYYuA+tOC9Dtsn0O61GrW8Vd1aH6ESfgC5Jg/P8EeGoNSrO1RuOKZ6QOKuKyDdGpj3XS1dR40xjXig7TSGmF9BUEK49IG27ZCocDx5yYHgIKBh8yjbftWO9QPkIibON4Mkgr6TQvea8SNccZVMwuqhXXh1GcPOknL/us4J3nxgC/7gSJD6ZPnuEYD5h5xabgNFEADolRV4z8cp5UeJB0vLK0bCTjKuGoBUQPwToZ9JDn5+w5NxIp4QtgLQBtgfDq1Oc+biHviY+Jm56YXtd9rtk2tlOP76Fb93EUwCcuET2W7HdYPAfxuz11rhA9bgJiSxErg86pGuTrrkL8nelqi1o1VcikcTFPFpXBsQkF9hrfTG5MedxuuME2ltj2r/X8zXK+ZOiW1l5EdKm0wYA6zzCzH/b+cGOyASKNKByGzhU+dk/DSiX2v6GbD0sUznKsJdgSIpDB5vsOUmpSXMKxhQJdBh2zQB9Uga2d7mF1i5Z8Pb/mg0GVkuNZFeFdf6/sQsRJ50cShX0xvFi14EdTAyK5xklct0uG9dU9Ly1BB7e4OdFA2kzjJ4+m4cGSTZsV7nWyCf6oBZWxqinVt+YsTvf6sQA1rUNjuKCtq0KP8EGoOrnXterJwiZH5WDOMJ9wiaTF4E1V6uuU/1KwyzJ+H1nMWLaG9MzrZDB0QJOUnUSxKEth9LU1tb7gYILPvJutypcbbUg/cb8KOPnEjRaCOkwJVQYECuiICK6u6V6FnMA4Qdf4LKiO9CPrEHjf0QCB60rN/YDmrSfSJweSDouFYaper4DVl9KMj8Qq4nhIkrzSCV1VtB8Pv6oXTxphryWz16RTVKqPbbKq9zbQasDtcKWRE9WvP3FNcsICp2kRWQCpSzS+z4+Er1rJgNglbTAWRqrATd8ElRNLkfMfFJWHPwNMPW7vUSOpc9im7UGfizlYOdvT787XWsxMF36s1xPyQov0uMDNuh7HVeyHWziyzKJnJFH1zyJG7twS5yiydQvr+9XtYK/mjNWUEdhgM3TJsWQEK3aaE+HqwUhLE1b65h42a1E3HMqoXuC4BzlnNuEIgryVdgYucd4NsTHd+tf+jBWV+6h6kT2CgOBmdI7gEfBrIYkOCO9tZGY+K770tcEjoG+l/rLT2tDByN06xhRUokM4Ltw8U/fNh/ydTjO4JddSFJ0n6Z9SMiz3lreKURYDM2Z+Szp9+zXvKr6SE29NRrJAGbmRjkSxi3sOErHFrB10tJ2uuT+/tem+j2qexl1P1B2DlgxMa8kS4WHKFWv0vqTQxY7YqnQN8jE+lmv3woeUknMmJciOh8HaLQ2A4uHN+oXYqBkyrckpNz2iLo5vZD/nuEEs/JWzZsCcp2U8YtsPcGQNdIOqvcZRD40+RjBs4WmDr7pU77XhyaIrC93dqsR+qa8BHQOWj4Bu7/Ha59bpCbhRoXY5nTHcgXGvNW2VGXpouirMtJDL3cggbY4AV6rYdtSbnCb2FR0Z3oEVYPa38SZH/o+79XTKl48AVc9BeBWAJbggJXJboVa3PUkSLquk/t1LtVD19MizUfx5LVJ+bJeSq5krVfq1glKB5TIifOV/Do4YI96WDkPPZoWbriIDEdfqy828yhXsnn3/Q6xwJvxVRu4ckHYGnN8zaBRAdlIQwaphWujvdJ4yQCnsPlge7wXDKQuPB5N5wTIyBk/4aw/x/R8SmxQAIM6p4hOxgaYEqGMRpnHcImrDOAMzoXe5VuTKeSPwTmd9FAoKsDOcbGwJsRslfufhCPDSOeWxn4MGty5kg1UIKiP9KtE0xsFPeMLKY0a93YsRVF6su0Tt99uEIYYhogYODAIeFhKqEoyScLyLpjtsnsKTisrwea2HklEPbCjoHgxYi/aPGvA4ZvW8U1dmnMPBgKzwPWT0KUDrRhLPZrT5vB4pMbfon/pNjubIqSAql2YwbQQ66PYVPKvacgMpbKeSS7HSboMBqsLqOFLRlY6bT9QfjaHB7bGfcHQrij1HeGzjphnmbYO359jhvWcLnotM4nsaKU84N3l6nyqRVAQ2K1lrzE659W4Y8ff/hhirkxkgauyvgHNf5Azu8xxk+geLrsjEjx7wK9Z5DodQgqFhp5dO0L4xmvV4M0Y0SFL0OEAVJhhZCKKOnUEM+8TXV/ijaeWGRfwFcNXeQQ4Y7jPytH+ZKzujr6KtApadQaVPlBtAUtg9thT+0kGoo/CvMwOHLTWLuQAvZKzCXc2eFg388gR0yblNUY5JXJ0oFq8N6Et7LKFG367qbWxTUnt3vgemDfAeCT3iMX9+ixihTYoJQGQduFd2K61cIwIDy42PwyyfBAlB69X7pGJWNsTubeIzIBLt1b4a6OQB8ptWFIGIquvVlHu0wqhWx6QJPCQW+8z2h0mDaBT+D9Wddq+oAV60yhIgprTSh7klj8n15U6kkIEZluuJjvLpLZU1QoduLnoIodg37XTJlN/Y0gfKIMzYFZ03d5Wt7iluXVifzY6pDCEoLJ9wOz5Hy6CR/+zuPZFZd4t60NpSxXp6rd3nWq2NfD+YRwSdCNRPK6Lu8LkjZpvlgn+wl0xjLLDD1ixtN0kEMsMAhr8NFsCh6wXAOvrUOc0oEDDrlq9fZH0o8qXnYcv+cXGJweDpW6T2+Lt5q9nFKfv5/JnuxsfcdFm4RMa+wwv/5WLaaPCuv93AxVUQE4R4hKhMQ0H+TkXrcoWciBXUUSWJatVI4SzzvRkzb5PRI+wBz2lOju72rUh1j7mdyWptDkPB/q48dgfBzSCRDyLK/iwy+4+Ndx/I5XmXXV5dlkcnObFaHFJvI5aKgJzGYQ6qpcZ4zooB37BkE9QnAQ5rfxPDVE0hJ2oN6rBryoUXU3OiuuHV/IygkyxwkqeK+YUcsBo5CdWKXw1IC1oZd3U4uKEx93sE1J80d0cKwYmHeqt4jBHVC3p84ObsRrrlbAlJtJcKYXRdj/HwATFUYLcKM1oAAAAABJRU5ErkJggg\x3d\x3d").then(function(b){a._noiseTexture=
new t(a._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:K,height:K},b);a._requestRender()})}else c.warn("SSAO is not supported for this browser or hardware")};d.prototype.getQuadVAO=function(){if(!this._quadVAO){var a=new Float32Array([-1,-1,1,-1,-1,1,1,1]);this._quadVAO=new k(this._rctx,u.Default3D,{geometry:r.Pos2},{geometry:p.createVertex(this._rctx,35044,a)})}return this._quadVAO};d.prototype.disable=function(){this.getEnableState()&&(this._enabled=!1,this._quadVAO&&this._quadVAO.dispose(!0),
this._noiseTexture&&this._noiseTexture.dispose(),this._blur1FBO.dispose(),this._blur0FBO.dispose(),this._ssaoFBO.dispose(),this._ssaoFBO=this._blur0FBO=this._blur1FBO=this._noiseTexture=this._quadVAO=null)};d.prototype.setAttenuation=function(a){this._attenuation=a};d.prototype.getAttenuation=function(){return this._attenuation};d.prototype.setRadius=function(a){this._radius=a};d.prototype.getRadius=function(){return this._radius};d.prototype.getFilterRadius=function(){return 4};d.prototype.setSamples=
function(a){this._samples=a};d.prototype.getSamples=function(){return this._samples};d.prototype.computeSSAO=function(b,c,d,f){if(this._noiseTexture){a.assert(this.getEnableState());var k=this._rctx,m=d.width,p=d.height,r=m/this._BLUR_F,h=p/this._BLUR_F;this._ssaoFBO.resize(m,p);this._blur0FBO.resize(r,h);this._blur1FBO.resize(r,h);r=1*m;h=1*p;k.bindFramebuffer(this._ssaoFBO);E.set(b.fullViewport,this._viewportToRestore);k.setViewport(0,0,m,p);var e=this._programRep.get(8>=this._samples?"ssao8":16>=
this._samples?"ssao16":32>=this._samples?"ssao32":"ssao64"),g=this._programRep.get("blur"),n=b.projectionMatrix;D[0]=-2/(r*n[0]);D[1]=-2/(h*n[5]);D[2]=(1-n[2])/n[0];D[3]=(1+n[6])/n[5];n=0===n[11];e.setUniform2f("rnmScale",m/K,p/K);e.setUniform3fv("pSphere",8>=this._samples?B:16>=this._samples?I:32>=this._samples?G:H);k.bindProgram(e);e.setUniform1f("numSpiralTurns",this._samples<J.length?J[this._samples]:5779);e.setUniform4fv("projInfo",new Float32Array(D));m=1/b.computePixelSizeAtDist(1);e.setUniform1f("projScale",
1*m);e.setUniform2f("screenDimensions",r,h);n?(e.setUniform2f("nearFar",b.near,b.far),e.setUniform2f("zScale",0,-1)):(e.setUniform2f("nearFar",b.near,b.far),e.setUniform2f("zScale",1,0));var q=2*this._radius,p=C.dist(b.eye,b.center),q=20*b.computePixelSizeAtDist(p),q=Math.max(.1,q);e.setUniform1f("radius",q);e.setUniform1f("intensity",4*this._attenuation/Math.pow(q,6));e.setUniform1i("rnm",0);e.setUniform1i("normalMap",1);e.setUniform1i("depthMap",2);k.bindTexture(this._noiseTexture,0);k.bindTexture(f.colorTexture,
1);k.bindTexture(d.colorTexture,2);d=this.getQuadVAO();k.bindVAO(d);k.drawArrays(5,0,x.vertexCount(d,"geometry"));k.bindTexture(this._ssaoFBO.colorTexture,0);k.setViewport(0,0,r/this._BLUR_F,h/this._BLUR_F);k.bindFramebuffer(this._blur0FBO);g.setUniform2f("screenDimensions",r,h);g.setUniform1i("tex",0);g.setUniform1i("normalMap",1);g.setUniform1i("depthMap",2);g.setUniform2f("blurSize",0,1*this._BLUR_F/h);g.setUniform1i("radius",4);g.setUniform1f("g_BlurFalloff",.08);g.setUniform2f("nearFar",b.near,
b.far);5E4<p&&(m=Math.max(0,m-(p-5E4)));g.setUniform1f("projScale",m);n?g.setUniform2f("zScale",0,-1):g.setUniform2f("zScale",1,0);k.drawArrays(5,0,x.vertexCount(d,"geometry"));g.setUniform2f("blurSize",1*this._BLUR_F/r,0);k.bindFramebuffer(this._blur1FBO);k.bindTexture(this._blur0FBO.colorTexture,0);k.drawArrays(5,0,x.vertexCount(d,"geometry"));k.bindFramebuffer(c);k.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}};d.prototype.setUniforms=
function(a){var b=this.getEnableState()&&this._noiseTexture,c=this._rctx;c.bindTexture(b?this._blur1FBO.colorTexture:this._emptyTexture,6);c.setActiveTexture(0);a.setUniform1i("ssaoTex",6);b?a.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):a.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};d.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("viewportPixelSz");for(var b=0;b<a.length;b++)this.setUniforms(a[b])};
d.prototype.drawQuad=function(b){a.assert(this.getEnableState());var c=this._programRep.get("showDepth");this._debugQuadVAO||(this._debugQuadVAO=new k(this._rctx,u.Default3D,{geometry:r.Pos2Tex},{geometry:p.createVertex(this._rctx,35044,P)}));var d=this._rctx;d.setDepthTestEnabled(!1);c.setUniformMatrix4fv("proj",new Float32Array(b));c.setUniform1i("depthTex",0);d.bindTexture(this._ssaoFBO.colorTexture,0);d.bindVAO(this._debugQuadVAO);d.drawArrays(5,0,x.vertexCount(this._debugQuadVAO,"geometry"));
d.setDepthTestEnabled(!0)};d.loadShaders=function(c,d,f,k){a.assert(null==c.samples);c._parse(b);d=new q(k,c.vertexShaderShowDepth,c.fragmentShaderShowDepth,u.Default3D);var m=c.createFsSSAOSrcObscurance,p=new q(k,c.vsUVQuad,m,u.Default3D,{NUM_TAP_SAMPLES:"8"}),r=new q(k,c.vsUVQuad,m,u.Default3D,{NUM_TAP_SAMPLES:"16"}),l=new q(k,c.vsUVQuad,m,u.Default3D,{NUM_TAP_SAMPLES:"32"}),m=new q(k,c.vsUVQuad,m,u.Default3D,{NUM_TAP_SAMPLES:"64"});c=new q(k,c.vsUVQuad,c.fsBlurEdgeAware,u.Default3D,{RADIUS:(4).toString()});
f.add("showDepth",d);f.add("ssao8",p);f.add("ssao16",r);f.add("ssao32",l);f.add("ssao64",m);f.add("blur",c)};return d}();var D=E.create(),B=new Float32Array([.186937,0,0,.677503,0,0,-.782832,.128424,.557187,.248064,.460317,-.659755,.062892,.918659,.312829,-.241031,-.814826,.224206,-.642866,.132138,-.45016,.145727,-.590568,-.626141,.005017,-.002234,.012668]),I=new Float32Array([.186937,0,0,.700542,0,0,-.864858,-.481795,-.111713,-.624773,.102853,-.730153,-.387172,.260319,.007229,-.222367,-.642631,-.707697,
-.01336,-.014956,.169662,.122575,.1544,-.456944,-.177141,.85997,-.42346,-.131631,.814545,.524355,-.779469,.007991,.624833,.308092,.209288,.35969,.359331,-.184533,-.377458,.192633,-.482999,-.065284,.233538,.293706,-.055139,.417709,-.386701,.442449,-.301656,-.836426,.408344]),G=new Float32Array([.837372,0,0,.723531,-.467287,.034157,.169582,-.31169,-.881801,.696236,.455215,-.204568,-.304514,.528086,.626381,-.053116,.222507,.037523,.199755,.311291,.916799,-.681552,-.516264,.501792,-.37127,.021088,.737477,
-.029503,.209188,-.95298,-.573731,.009962,-.154202,-.257345,-.905958,.282747,.370779,.527867,-.669424,-.601758,-.191278,-.708243,.271796,.782684,.535565,-.006867,-.015312,-.017276,.419958,.265628,.233036,-.543898,.554747,-.174055,-.079242,.053475,-.099539,.372042,-.339267,-.357362,.015781,-.011352,.042707,-.340564,-.272507,-.067725,.799249,-.127948,.586808,.450015,.01965,-.416454,-.506524,.323229,.206546,-.087316,-.311097,.466049,.146374,-.34528,-.045904,-.152614,-.926686,-.287529,-.665726,-.032904,
.246643,.248703,.637193,-.062541,-.073706,.495925,-.315143,.05946,-.116042,.075586]),H=new Float32Array([.186937,0,0,.605726,-.313457,-.097616,.003541,.781245,.283011,-.225029,-.373279,.274442,-.047511,.04992,-.226365,.627629,-.623617,-.463628,.133094,-.318299,.528128,.262035,.100234,-.09012,.178335,-.426972,-.666048,-.27306,-.207352,.05514,-.613649,-.063395,.060608,-.283391,-.41382,-.087565,.136768,.506126,.484137,-.593808,-.344603,.453164,.675326,.124799,-.697865,-.33502,.411337,-.09337,-.15271,
.002908,-.063582,.366733,-.699739,.401148,-.519536,-.585625,-.508413,.106482,-.428709,-.260221,.012847,-.118806,.016962,-.188182,.49945,.452364,.586617,.722539,-.23302,.111295,.202827,.066695,-.036503,.315842,.896467,-.039109,-.270116,-.080062,.613435,.508787,.538656,-.352275,.566869,-.666275,.887876,-.138341,-.434135,-.444711,.269156,.119506,-.029457,-.077316,.754474,.274125,-.13876,-.37082,-.73268,.332723,.568545,-.203992,.878922,-.430778,.541154,-.546752,.11786,-3.93E-4,-.083318,.059333,-.341406,
-.117017,-.318568,-.262425,-.457913,.848753,.89229,-.30157,.322416,.742328,.032262,.643827,.048091,-.078044,-.49908,.064858,.549944,-.796252,-.230688,.88978,-.010153,.397241,-.27645,.405666,-.46593,.131187,-.600166,.333834,-.078219,.73837,-.870169,-.411658,-.222175,-.492421,.741454,.293757,-.591244,.389112,-.388324,.792346,.578552,.088459,-.121858,-.437241,-.472535,-.374835,.302427,.721264,.057485,.204085,-.126575,.510325,.481492,-.579888,-.29411,-.82136,.156404,-.819717,-.042466,.456573,.079884,
.07019,.179002,.220279,.970222,-.088025,-.299911,-.234627,-.820794,.912112,.243306,.317869,.241336,.161841,-.721568,.301135,-.635993,-.0939,-.514731,-.089673,.850964,-.905087,.314604,-.098397]),K=64,J=[1,1,1,2,3,2,5,2,3,2,3,3,5,5,3,4,7,5,5,7,9,8,5,5,7,7,7,8,5,8,11,12,7,10,13,8,11,8,7,14,11,11,13,12,13,19,17,13,11,18,19,11,11,14,17,21,15,16,17,18,13,17,11,17,19,18,25,18,19,19,29,21,19,27,31,29,21,18,17,29,31,31,23,18,25,26,25,23,19,34,19,27,21,25,39,29,17,21,27,29],P=new Float32Array([0,0,0,0,512,
0,1,0,0,512,0,1,512,512,1,1]);return w})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("./Camera ./Util ./gl-matrix ../../../../core/Logger ../../../webgl/Texture ../../../webgl/FramebufferObject ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/Util".split(" "),function(w,l,f,a,d,b,q,t,m,k,p){var x=f.vec2d,z=f.vec3d,v=f.vec4d,r=f.mat3d,u=f.mat4d,C=f.mat4,E=a.getLogger("esri.views.3d.webgl-engine.lib.ShadowMap");
return function(a,f){function c(a,b){z.set3(a[b],a[b+3],a[b+6],sa);return sa}var D=f.gl,G,H=4096,K,J=new d(f,{target:D.TEXTURE_2D,pixelFormat:D.RGBA,dataType:D.UNSIGNED_BYTE,samplingMode:D.NEAREST,width:4,height:4}),P=1,O=2,L=[0,0,0,0,0];this.dispose=function(){J.dispose();J=null};var M=function(){this.camera=new w;this.lightMat=u.create()},R=[],Q,T,A;for(Q=0;4>Q;++Q)R[Q]=new M;this.getIsSupported=function(){return f.extensions.standardDerivatives};this.setTextureResolution=function(a){H=a};this.getTextureResolution=
function(){return H};this.setMaxNumCascades=function(a){O=l.clamp(Math.floor(a),1,4)};this.getMaxNumCascades=function(){return O};this.setEnableState=function(a){a?this.enable():this.disable()};this.getEnableState=function(){return void 0!==G};this.getDepthTexture=function(){return G};this.enable=function(){this.getEnableState()||(this.getIsSupported()?(G=new d(f,{target:D.TEXTURE_2D,pixelFormat:D.RGBA,dataType:D.UNSIGNED_BYTE,wrapMode:D.CLAMP_TO_EDGE,samplingMode:D.NEAREST,flipped:!0,width:H,height:H}),
K=b.createWithAttachments(f,G,{colorTarget:0,depthStencilTarget:1,width:H,height:H})):E.warn("Shadow maps are not supported for this browser or hardware"))};this.disable=function(){this.getEnableState()&&K&&(K.dispose(),G=K=void 0)};var V=u.create(),S=u.create(),h=v.create(),e=Array(8);for(Q=0;8>Q;++Q)e[Q]=v.create();var g=z.create(),n=z.create(),y=x.create(),F=x.create(),N=x.create(),U=x.create(),Y=x.create(),W=u.create(),ca=z.create();this.prepare=function(a,b,d,k){l.assert(this.getEnableState());
u.multiply(a.projectionMatrix,a.viewMatrix,V);var m=k[0],p=k[1];2>m&&(m=2);2>p&&(p=2);m>=p&&(m=2,p=4);P=Math.min(1+Math.floor(l.logWithBase(p/m,4)),O);d=Math.pow(p/m,1/P);for(k=0;k<P+1;++k)L[k]=m*Math.pow(d,k);u.inverse(V,S);u.lookAt([0,0,0],[-b[0],-b[1],-b[2]],[0,1,0],W);d=a.viewMatrix;a=a.projectionMatrix;for(k=0;k<P;++k){var r=R[k],m=-L[k],p=-L[k+1],m=(a[10]*m+a[14])/Math.abs(a[11]*m+a[15]),p=(a[10]*p+a[14])/Math.abs(a[11]*p+a[15]);l.assert(m<p);for(T=0;8>T;++T)for(v.set4(0===T%4||3==T%4?-1:1,
0===T%4||1==T%4?-1:1,4>T?m:p,1,h),u.multiplyVec4(S,h,e[T]),A=0;3>A;++A)e[T][A]/=e[T][3];z.negate(e[0],ca);u.translate(W,ca,r.camera.viewMatrix);for(T=0;8>T;++T)u.multiplyVec3(r.camera.viewMatrix,e[T]);z.set(e[0],g);z.set(e[0],n);for(T=1;8>T;++T)for(A=0;3>A;++A)g[A]=Math.min(g[A],e[T][A]),n[A]=Math.max(n[A],e[T][A]);g[2]-=200;n[2]+=200;r.camera.near=-n[2];r.camera.far=-g[2];m=1/e[0][3];p=1/e[4][3];l.assert(m<p);var q=m+Math.sqrt(m*p),t=Math.sin(Math.acos(d[2]*b[0]+d[6]*b[1]+d[10]*b[2])),q=q/t,m=e,
C=q,B=t,t=y,E=F,w=N,G=U,q=Y;x.set2(0,0,ba);for(var I=void 0,I=0;4>I;++I)x.add(ba,m[I],ba);x.scale(ba,.25);x.set2(0,0,la);for(I=4;8>I;++I)x.add(la,m[I],la);x.scale(la,.25);x.lerp(m[4],m[5],.5,qa[0]);x.lerp(m[5],m[6],.5,qa[1]);x.lerp(m[6],m[7],.5,qa[2]);x.lerp(m[7],m[4],.5,qa[3]);for(var J=0,M=x.dist2(qa[0],ba),I=1;4>I;++I){var Q=x.dist2(qa[I],ba);Q<M&&(M=Q,J=I)}x.subtract(qa[J],m[J+4],ja);I=ja[0];ja[0]=-ja[1];ja[1]=I;x.subtract(la,ba,ra);x.lerp(ja,ra,B);x.normalize(ja);J=B=void 0;B=J=x.dot(x.subtract(m[0],
ba,ga),ja);for(I=1;8>I;++I)M=x.dot(x.subtract(m[I],ba,ga),ja),M<B?B=M:M>J&&(J=M);x.set(ba,t);x.scale(ja,B-C,ga);x.add(t,ga,t);for(var Q=-1,X=1,I=C=M=0;8>I;++I){x.subtract(m[I],t,ha);x.normalize(ha);var aa=ja[0]*ha[1]-ja[1]*ha[0];0<aa?aa>Q&&(Q=aa,M=I):aa<X&&(X=aa,C=I)}l.verify(0<Q,"leftArea");l.verify(0>X,"rightArea");x.scale(ja,B,na);x.add(na,ba,na);x.scale(ja,J,oa);x.add(oa,ba,oa);ka[0]=-ja[1];ka[1]=ja[0];E=l.rayRay2D(t,m[C],oa,x.add(oa,ka,ga),1,E);w=l.rayRay2D(t,m[M],oa,ga,1,w);G=l.rayRay2D(t,m[M],
na,x.add(na,ka,ga),1,G);m=l.rayRay2D(t,m[C],na,ga,1,q);l.verify(E,"rayRay");l.verify(w,"rayRay");l.verify(G,"rayRay");l.verify(m,"rayRay");w=y;m=F;t=U;G=Y;q=r.camera.projectionMatrix;x.scale(x.subtract(t,G,ma),.5);Z[0]=ma[0];Z[1]=ma[1];Z[2]=0;Z[3]=ma[1];Z[4]=-ma[0];Z[5]=0;Z[6]=ma[0]*ma[0]+ma[1]*ma[1];Z[7]=ma[0]*ma[1]-ma[1]*ma[0];Z[8]=1;Z[6]=-x.dot(c(Z,0),w);Z[7]=-x.dot(c(Z,1),w);w=x.dot(c(Z,0),t)+Z[6];E=x.dot(c(Z,1),t)+Z[7];I=x.dot(c(Z,0),G)+Z[6];G=x.dot(c(Z,1),G)+Z[7];w=-(w+I)/(E+G);Z[0]+=Z[1]*w;
Z[3]+=Z[4]*w;Z[6]+=Z[7]*w;w=1/(x.dot(c(Z,0),t)+Z[6]);E=1/(x.dot(c(Z,1),t)+Z[7]);Z[0]*=w;Z[3]*=w;Z[6]*=w;Z[1]*=E;Z[4]*=E;Z[7]*=E;Z[2]=Z[1];Z[5]=Z[4];Z[8]=Z[7];Z[7]+=1;w=x.dot(c(Z,1),m)+Z[7];E=x.dot(c(Z,2),m)+Z[8];I=x.dot(c(Z,1),t)+Z[7];G=x.dot(c(Z,2),t)+Z[8];w=-.5*(w/E+I/G);Z[1]+=Z[2]*w;Z[4]+=Z[5]*w;Z[7]+=Z[8]*w;w=x.dot(c(Z,1),m)+Z[7];E=x.dot(c(Z,2),m)+Z[8];I=-E/w;Z[1]*=I;Z[4]*=I;Z[7]*=I;q[0]=Z[0];q[1]=Z[1];q[2]=0;q[3]=Z[2];q[4]=Z[3];q[5]=Z[4];q[6]=0;q[7]=Z[5];q[8]=0;q[9]=0;q[10]=1;q[11]=0;q[12]=Z[6];
q[13]=Z[7];q[14]=0;q[15]=Z[8];r.camera.projectionMatrix[10]=2/(g[2]-n[2]);r.camera.projectionMatrix[14]=-(g[2]+n[2])/(g[2]-n[2]);u.multiply(r.camera.projectionMatrix,r.camera.viewMatrix,r.lightMat);m=H/2;r.camera.viewport[0]=0===k%2?0:m;r.camera.viewport[1]=0===Math.floor(k/2)?0:m;r.camera.viewport[2]=m;r.camera.viewport[3]=m}ea=void 0;L[P]=100*p;f.bindFramebuffer(K);f.bindTexture(null,7);f.setClearColor(1,1,1,1);f.clear(D.COLOR_BUFFER_BIT|D.DEPTH_BUFFER_BIT);f.setBlendingEnabled(!1)};var X=[];this.getCascades=
function(){for(var a=0;a<P;++a)X[a]=R[a];X.length=P;return X};this.finish=function(a){l.assert(this.getEnableState());f.bindFramebuffer(a)};this.bind=function(a){var b=this.getEnableState();f.bindTexture(b?G:J,7);f.bindProgram(a);a.setUniform1i("depthTex",7);a.setUniform1f("depthHalfPixelSz",b?.5/H:-1);a.setUniform1i("shadowMapNum",P);a.setUniform4f("shadowMapDistance",L[0],L[1],L[2],L[3])};this.bindAll=function(a){a=a.getProgramsUsingUniform("shadowMapDistance");for(var b=0;b<a.length;b++)this.bind(a[b])};
var aa=C.create(),da=new Float32Array(64),ea;this.bindView=function(a,b){if(this.getEnableState()){if(!ea||ea[0]!==b[0]||ea[1]!==b[1]||ea[2]!==b[2]){var c;ea=ea||z.create();z.set(b,ea);for(T=0;T<P;++T)for(C.translate(R[T].lightMat,b,aa),c=0;16>c;++c)da[16*T+c]=aa[c]}a.setUniformMatrix4fv("shadowMapMatrix",da)}};M=new Float32Array(16);M[0]=0;M[1]=0;M[2]=0;M[3]=0;M[4]=256;M[5]=0;M[6]=1;M[7]=0;M[8]=0;M[9]=256;M[10]=0;M[11]=1;M[12]=256;M[13]=256;M[14]=1;M[15]=1;var ia=new q(f,m.Default3D,{geometry:k.Pos2Tex},
{geometry:t.createVertex(f,D.STATIC_DRAW,M)});this.drawDebugQuad=function(b){l.assert(this.getEnableState());var c=a.get("showDepth");f.setDepthTestEnabled(!1);f.bindProgram(c);c.setUniformMatrix4fv("proj",b);c.setUniform1i("depthTex",0);f.bindTexture(G,0);f.bindVAO(ia);p.assertCompatibleVertexAttributeLocations(ia,c);f.drawArrays(D.TRIANGLE_STRIP,0,p.vertexCount(ia,"geometry"));f.setDepthTestEnabled(!0)};var ba=x.create(),la=x.create(),qa=[x.create(),x.create(),x.create(),x.create()],ja=x.create(),
ra=x.create(),ga=x.create(),ha=x.create(),na=x.create(),oa=x.create(),ka=x.create(),sa=z.create(),ma=x.create(),Z=r.create()}})},"esri/views/3d/webgl-engine/lib/NearFarCalc":function(){define(["require","exports","./Util","./gl-matrix","./ComponentUtils"],function(w,l,f,a,d){w=a.vec3d;var b=a.vec4d,q=a.mat4d;a=function(){function a(){this._context={content:[],near:[],far:[],nearSpecial:[],farSpecial:[],bestNear:0,bestFar:0,bestNear2:0,bestFar2:0};this._boundingInfoHelper=new t}a.prototype._resetContext=
function(){var a=this._context;a.content.length=0;a.near.length=0;a.far.length=0;a.nearSpecial.length=0;a.farSpecial.length=0;a.bestNear=Number.MAX_VALUE;a.bestFar=-Number.MAX_VALUE;return this._context};a.prototype.calculateSceneNearFar=function(a,b){var f=this._resetContext(),k=a.viewMatrix,m=k[2],c=k[6],r=k[10],q=k[14],l=0,v;for(v in b)if(k=b[v],!d.isAllHidden(k.instanceParameters.componentVisibilities,k.componentOffsets)&&k.castShadow){var x=void 0,t=void 0;k.hasShaderTransformation?(x=k.getBoundingSphere(k.getShaderTransformation(),
null,p),t=p):(x=k.bsRadius,t=k.center);var z=m*t[0]+c*t[1]+r*t[2]+q,t=z-x,x=z+x;f.content[l]=k;f.near[l]=-x;f.far[l]=-t;++l}if(0===l)return[f.bestNear,f.bestFar];for(b=0;b<l;++b)f.near[b]>f.bestFar&&(f.bestFar=f.near[b]),2<f.near[b]&&f.far[b]<f.bestNear&&(f.bestNear=f.far[b]);f.bestNear2=Math.max(.5*f.bestNear,2);f.bestFar2=2*f.bestFar;for(b=c=m=0;b<l;++b)f.near[b]<f.bestNear&&(f.near[b]>=f.bestNear2?f.bestNear=f.near[b]:f.nearSpecial[m++]=b),f.far[b]>f.bestFar&&(f.far[b]<=f.bestFar2?f.bestFar=f.far[b]:
f.farSpecial[c++]=b);if(0===m&&0===c)return[f.bestNear,f.bestFar];f.nearSpecial.length=m;f.farSpecial.length=c;f.nearSpecial.sort(function(a,b){return f.near[a]<f.near[b]?-1:f.near[a]>f.near[b]?1:0});f.farSpecial.sort(function(a,b){return f.far[a]<f.far[b]?1:f.far[a]>f.far[b]?-1:0});this._boundingInfoHelper.init(a,f);for(b=0;b<m;++b)f.near[f.nearSpecial[b]]<f.bestNear&&(k=f.content[f.nearSpecial[b]],a=k.boundingInfo,this._boundingInfoHelper.includeNearBoundingInfoRec(a,k.getShaderTransformation()));
for(b=0;b<c;++b)f.far[f.farSpecial[b]]>f.bestFar&&(k=f.content[f.farSpecial[b]],a=k.boundingInfo,this._boundingInfoHelper.includeFarBoundingInfoRec(a,k.getShaderTransformation()));return[f.bestNear,f.bestFar]};return a}();var t=function(){function a(){this._clippingHelper=new m;this._planes=[b.create(),b.create(),b.create(),b.create(),b.create(),b.create()];this._viewProj=q.create();this._view=q.create()}a.prototype.init=function(a,b){this._context=b;q.set(a.viewMatrix,this._view);q.multiply(a.projectionMatrix,
this._view,this._viewProj);a.copyFrustumPlanes(this._planes);this._clippingHelper.init(b)};a.prototype.includeNearBoundingInfoRec=function(a,b){var d=a.getBSRadius(),f=a.getCenter();q.multiplyVec3(b,f,p);var f=p[0],k=p[1],c=p[2],d=d*Math.sqrt(Math.max(Math.max(b[0]*b[0]+b[4]*b[4]+b[8]*b[8],b[1]*b[1]+b[5]*b[5]+b[9]*b[9]),b[2]*b[2]+b[6]*b[6]+b[10]*b[10]));if(!(this._planes[0][0]*f+this._planes[0][1]*k+this._planes[0][2]*c+this._planes[0][3]>d||this._planes[1][0]*f+this._planes[1][1]*k+this._planes[1][2]*
c+this._planes[1][3]>d||this._planes[2][0]*f+this._planes[2][1]*k+this._planes[2][2]*c+this._planes[2][3]>d||this._planes[3][0]*f+this._planes[3][1]*k+this._planes[3][2]*c+this._planes[3][3]>d||(f=this._view[2]*f+this._view[6]*k+this._view[10]*c+this._view[14],k=f+d,2>-(f-d)||-k>=this._context.bestNear)))if(-k>this._context.bestNear2)this._context.bestNear=-k;else{if(100<d&&(d=a.getChildren(),void 0!==d)){for(a=0;8>a;++a)void 0!==d[a]&&this.includeNearBoundingInfoRec(d[a],b);return}this._clippingHelper.intersectFrustumAABB(this._viewProj,
b,a.getBBMin(),a.getBBMax())}};a.prototype.includeFarBoundingInfoRec=function(a,b){var d=a.getBSRadius(),f=a.getCenter();q.multiplyVec3(b,f,p);var f=p[0],k=p[1],c=p[2],d=d*Math.sqrt(Math.max(Math.max(b[0]*b[0]+b[4]*b[4]+b[8]*b[8],b[1]*b[1]+b[5]*b[5]+b[9]*b[9]),b[2]*b[2]+b[6]*b[6]+b[10]*b[10]));if(!(this._planes[0][0]*f+this._planes[0][1]*k+this._planes[0][2]*c+this._planes[0][3]>d||this._planes[1][0]*f+this._planes[1][1]*k+this._planes[1][2]*c+this._planes[1][3]>d||this._planes[2][0]*f+this._planes[2][1]*
k+this._planes[2][2]*c+this._planes[2][3]>d||this._planes[3][0]*f+this._planes[3][1]*k+this._planes[3][2]*c+this._planes[3][3]>d||(f=this._view[2]*f+this._view[6]*k+this._view[10]*c+this._view[14]-d,-f<=this._context.bestFar)))if(-f<this._context.bestFar2)this._context.bestFar=-f;else{if(100<d&&(d=a.getChildren(),void 0!==d)){for(a=0;8>a;++a)void 0!==d[a]&&this.includeFarBoundingInfoRec(d[a],b);return}this._clippingHelper.intersectFrustumAABB(this._viewProj,b,a.getBBMin(),a.getBBMax())}};return a}(),
m=function(){function a(){this._clipP=Array(8);for(var a=0;8>a;++a)this._clipP[a]=b.create()}a.prototype.init=function(a){this._context=a};a.prototype.intersectFrustumAABB=function(a,b,d,f){q.multiply(a,b,x);for(a=0;8>a;++a){b=this._clipP[a];var m=0===a||3===a||4===a||7===a?d[0]:f[0],c=0===a||1===a||4===a||5===a?d[1]:f[1],p=4>a?d[2]:f[2];b[0]=x[0]*m+x[4]*c+x[8]*p+x[12];b[1]=x[1]*m+x[5]*c+x[9]*p+x[13];b[2]=x[2]*m+x[6]*c+x[10]*p+x[14];b[3]=x[3]*m+x[7]*c+x[11]*p+x[15]}for(a=0;12>a;++a){d=this._clipTriangle(this._clipP[k[a][0]],
this._clipP[k[a][1]],this._clipP[k[a][2]]);f=!0;for(b=0;b<d.length;++b)if(m=d[b][3],2<=m){f=!1;break}if(!f)for(b=0;b<d.length;++b)m=d[b][3],m<this._context.bestNear&&(this._context.bestNear=m),m>this._context.bestFar&&(this._context.bestFar=m)}};a.prototype._inside=function(a,b){if(0===b)return a[0]>=-a[3];if(1===b)return a[1]>=-a[3];if(2===b)return a[0]<=a[3];if(3===b)return a[1]<=a[3];f.assert(!1)};a.prototype._intersect=function(a,d,f){var k=0;0===f?k=(-a[3]-a[0])/(d[0]-a[0]+d[3]-a[3]):1===f?k=
(-a[3]-a[1])/(d[1]-a[1]+d[3]-a[3]):2===f?k=(a[3]-a[0])/(d[0]-a[0]-d[3]+a[3]):3===f&&(k=(a[3]-a[1])/(d[1]-a[1]-d[3]+a[3]));return b.lerp(a,d,k,b.create())};a.prototype._clipTriangle=function(a,b,d){a=[a,b,d];for(b=0;4>b;++b){d=a;a=[];for(var f=0;f<d.length;++f){var k=d[f],c=d[(f+1)%d.length];this._inside(c,b)?(this._inside(k,b)||a.push(this._intersect(k,c,b)),a.push(c)):this._inside(k,b)&&a.push(this._intersect(k,c,b))}}return a};return a}(),k=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,
7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],p=w.create(),x=q.create();return a})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("require exports ./Util ./gl-matrix dojo/text!../materials/internal/highlight.xml ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/VertexArrayObject ../../../webgl/BufferObject ../../../webgl/Util ../../../webgl/enums ./DefaultVertexBufferLayouts ./DefaultVertexAttributeLocations ../../support/debugFlags".split(" "),function(w,l,
f,a,d,b,q,t,m,k,p,x,z,v){var r=a.vec4d;return function(){function a(a,b,c){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};this.blur1Fbo=this.blur0Fbo=this.quadVAO=null;this._rctx=c;this.viewportToRestore=r.create();this.programRep=a;this.defaultOptions={color:new Float32Array([1,0,1,1]),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05}}a.prototype._gridUpdateResources=function(a,
d){var c=this._rctx,f=this._grid,k=!1;null===f.coverageMipmap&&(f.coverageMipmap=[a],k=!0);if(f.viewportWidth!==a.width||f.viewportHeight!==a.height)k=!0,f.viewportWidth=a.width,f.viewportHeight=a.height;f.coverageMipmap[0]=a;f.cellPixelSize!==d&&(f.cellPixelSize=d,k=!0);if(k){for(d=1;d<f.coverageMipmap.length;d++)f.coverageMipmap[d].dispose();f.mipmapLevels=Math.ceil(Math.log(f.cellPixelSize)*Math.LOG2E);f.coverageMipmap.length=f.mipmapLevels+1;for(d=0;d<f.mipmapLevels;d++)k=f.coverageMipmap[d],
k=b.createWithAttachments(c,{target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(k.width/2),height:Math.ceil(k.height/2)},{colorTarget:0,depthStencilTarget:0,width:Math.ceil(k.width/2),height:Math.ceil(k.height/2)}),f.coverageMipmap[d+1]=k}var k=Math.ceil(a.height/f.cellPixelSize),p=Math.ceil(a.width/f.cellPixelSize);if(!f.vao||f.verticalCellCount!==k||f.horizontalCellCount!==p){f.verticalCellCount=k;f.horizontalCellCount=p;a=k+1;d=p+1;for(var k=1/k,p=1/p,
r=new Float32Array(24*a*d),q=0,l=0;l<a;l++)for(var v=0;v<d;v++)r[q+0]=(v-.5)*p*2-1,r[q+1]=(l-.5)*k*2-1,r[q+2]=v*p,r[q+3]=l*k,r[q+4]=(v+.5)*p*2-1,r[q+5]=(l-.5)*k*2-1,r[q+6]=v*p,r[q+7]=l*k,r[q+8]=(v-.5)*p*2-1,r[q+9]=(l+.5)*k*2-1,r[q+10]=v*p,r[q+11]=l*k,r[q+12]=(v-.5)*p*2-1,r[q+13]=(l+.5)*k*2-1,r[q+14]=v*p,r[q+15]=l*k,r[q+16]=(v+.5)*p*2-1,r[q+17]=(l-.5)*k*2-1,r[q+18]=v*p,r[q+19]=l*k,r[q+20]=(v+.5)*p*2-1,r[q+21]=(l+.5)*k*2-1,r[q+22]=v*p,r[q+23]=l*k,q+=24;f.vao&&f.vao.dispose(!0);f.vao=new t(c,z.Default3D,
{geometry:x.Pos2Tex},{geometry:m.createVertex(c,35044,r)})}};a.prototype._gridComputeMipmap=function(){var a=this._rctx,b=this._grid,c=this.programRep.get("conservative-downsample");a.bindVAO(this.quadVAO);for(var d=0;d<b.mipmapLevels;d++){a.bindFramebuffer(b.coverageMipmap[d+1]);a.bindTexture(b.coverageMipmap[d].colorTexture,0);var f=b.coverageMipmap[d+1].width,m=b.coverageMipmap[d+1].height;a.bindProgram(c);c.setUniform1i("tex",0);c.setUniform2f("invFramebufferDim",1/f,1/m);a.setViewport(0,0,f,
m);a.drawArrays(5,0,k.vertexCount(this.quadVAO,"geometry"))}};a.prototype.createQuadVAO=function(){var a=this._rctx,b=new Float32Array([-1,-1,1,-1,-1,1,1,1]);return new t(a,z.Default3D,{geometry:x.Pos2},{geometry:m.createVertex(a,35044,b)})};Object.defineProperty(a.prototype,"profilingCallback",{get:function(){return v.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(a){return console.log(a)}:null},enumerable:!0,configurable:!0});a.prototype.getIsSupported=function(){return!0};a.prototype.setEnableState=function(a){a?
this.enable():this.disable()};a.prototype.getEnableState=function(){return null!==this.blur0Fbo};a.prototype.enable=function(){this.quadVAO=this.createQuadVAO();var a={colorTarget:0,depthStencilTarget:0,width:0,height:0},d={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=b.createWithAttachments(this._rctx,d,a);this.blur1Fbo=b.createWithAttachments(this._rctx,d,a)};a.prototype.disable=function(){this.getEnableState()&&(this.quadVAO.dispose(!0),
this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.blur1Fbo=this.blur0Fbo=this.quadVAO=null)};a.prototype.getHighlightFBO=function(){return this.blur0Fbo};a.prototype.render=function(a,b,c){var d=!v.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,m=v.HIGHLIGHTS_VISUALIZE_BLOCKS,p=this._rctx;f.assert(this.getEnableState());r.set(a.fullViewport,this.viewportToRestore);a=Math.ceil(c.width/1);var q=Math.ceil(c.height/1);this.blur0Fbo.resize(a,q);this.blur1Fbo.resize(a,q);p.bindVAO(this.quadVAO);p.setDepthWriteEnabled(!1);
p.setDepthTestEnabled(!1);p.setBlendingEnabled(!1);var l=null,u=l=null,x=null;if(d){var t=this._grid;this._gridUpdateResources(c,32);this._gridComputeMipmap();u=t.vao;x=4;l=this.programRep.get("highlight-blur-grid-5");p.bindProgram(l);p.bindTexture(t.coverageMipmap[t.mipmapLevels].colorTexture,1);l.setUniform1i("coverageTex",1)}else u=this.quadVAO,x=5,l=this.programRep.get("highlight-blur-5"),p.bindProgram(l);p.bindVAO(u);p.bindFramebuffer(this.blur0Fbo);p.setViewport(0,0,a,q);p.setClearColor(0,0,
0,0);p.clear(p.gl.COLOR_BUFFER_BIT);l.setUniform1i("tex",0);p.bindTexture(c.colorTexture,0);l.setUniform2f("blurSize",1/a,0);p.drawArrays(x,0,k.vertexCount(u,"geometry"));p.bindFramebuffer(this.blur1Fbo);p.clear(p.gl.COLOR_BUFFER_BIT);p.bindTexture(this.blur0Fbo.colorTexture,0);l.setUniform2f("blurSize",0,1/q);p.drawArrays(x,0,k.vertexCount(u,"geometry"));p.bindFramebuffer(b);p.setBlendingEnabled(!0);p.setBlendFunctionSeparate(770,771,1,771);p.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],
this.viewportToRestore[2],this.viewportToRestore[3]);d?(l=this.programRep.get(m?"highlight-apply-grid-debug":"highlight-apply-grid"),p.bindProgram(l),l.setUniform1i("coverageTex",2),p.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,2)):(l=this.programRep.get("highlight-apply"),p.bindProgram(l));l.setUniform1i("tex",0);p.bindTexture(this.blur1Fbo.colorTexture,0);l.setUniform1i("origin",1);p.bindTexture(c.colorTexture,1);l.setUniform4fv("color",this.defaultOptions.color);
l.setUniform1f("outlineSize",8.6);l.setUniform1f("blurSize",.4);l.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded);p.drawArrays(x,0,k.vertexCount(u,"geometry"));p.bindVAO(null);p.setDepthWriteEnabled(!0);p.setDepthTestEnabled(!0);p.setBlendingEnabled(!1)};a.prototype.setDefaultOptions=function(a){this.defaultOptions=a};a.loadShaders=function(a,b,c,f){a._parse(d);b=0;for(var k=["3",
"5","7","9"];b<k.length;b++){var m=k[b];c.add("highlight-blur-"+m,new q(f,a.vsHighlightBlurFastGaussian,a.fsHighlightBlurFastGaussian,z.Default3D,{GAUSSIAN_SAMPLES:m}));c.add("highlight-blur-grid-"+m,new q(f,a.vsHighlightBlurFastGaussian,a.fsHighlightBlurFastGaussian,z.Default3D,{GAUSSIAN_SAMPLES:m,GRID_OPTIMIZATION:"true"}))}c.add("highlight-apply",new q(f,a.vsHighlightApply,a.fsHighlightApply,z.Default3D));c.add("highlight-apply-grid",new q(f,a.vsHighlightApply,a.fsHighlightApply,z.Default3D,["GRID_OPTIMIZATION"]));
c.add("highlight-apply-grid-debug",new q(f,a.vsHighlightApply,a.fsHighlightApply,z.Default3D,["GRID_OPTIMIZATION","GRID_DEBUG"]));c.add("conservative-downsample",new q(f,a.vsConservativeDownsample,a.fsConservativeDownsample,z.Default3D))};return a}()})},"esri/views/3d/webgl-engine/materials/repository":function(){define("dojo/text!./internal/util.xml dojo/text!./internal/hud.xml ./BillboardMaterial ./ColorMaterial ./HUDMaterial ./LineCalloutMaterial ./LeafCardMaterial ./Material ./RibbonLineMaterial ./WaterMaterial ./internal/SimpleGLMaterial ./internal/TexOnlyGLMaterial ./internal/BlendLayers".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z){return{initializeShaders:function(v,r,u,C){v._parse(w);v._parse(l);p.loadShaders(v,r,u,C);x.loadShaders(v,r,u,C);t.loadShaders(v,r,u,C);f.loadShaders(v,r,u,C);d.loadShaders(v,r,u,C);b.loadShaders(v,r,u,C);q.loadShaders(v,r,u,C);m.loadShaders(v,r,u,C);k.loadShaders(v,r,u,C);z.loadShaders(v,r,u,C);a.loadShaders(v,r,u,C)}}})},"esri/views/3d/webgl-engine/materials/BillboardMaterial":function(){define("dojo/text!./BillboardMaterial.xml ./internal/MaterialUtil ../lib/RenderSlot ../../../webgl/Program ../lib/DefaultVertexAttributeLocations ../lib/DefaultVertexBufferLayouts ../../../webgl/Util".split(" "),
function(w,l,f,a,d,b,q){var t=function(a,d){l.basicMaterialConstructor(this,d);var f=b.Pos3NormTex;this.getSize=function(){return 1.05};this.dispose=function(){};this.getTextureId=function(){return a};this.getOutputAmount=function(a){var b=q.getStride(f)/4;return a*b*6};this.getVertexBufferLayout=function(){return f};this.fillInterleaved=function(a,b,d,f,c,k){f=l.fill;var m=a.faces.indices.va,p=a.vertexAttr.va.data,r=a.vertexAttr.tc4.data,q=a.vertexAttr.n0.data,v=a.vertexAttr.n1.data,u=a.vertexAttr.n2.data;
a=a.vertexAttr.n3.data;for(var x=0;x<m.length;++x){var t=4*m[x],z=3*m[x];k+=f(p,t,c,k,b,3);k+=f(q,z,c,k,d,3);c[k++]=r[t];c[k++]=r[t+1];k+=f(p,t,c,k,b,3);k+=f(v,z,c,k,d,3);c[k++]=r[t+2]+1;c[k++]=r[t+1];k+=f(p,t,c,k,b,3);k+=f(u,z,c,k,d,3);c[k++]=r[t+2]+1;c[k++]=r[t+3]+1;k+=f(p,t,c,k,b,3);k+=f(u,z,c,k,d,3);c[k++]=r[t+2]+1;c[k++]=r[t+3]+1;k+=f(p,t,c,k,b,3);k+=f(a,z,c,k,d,3);c[k++]=r[t];c[k++]=r[t+3]+1;k+=f(p,t,c,k,b,3);k+=f(q,z,c,k,d,3);c[k++]=r[t];c[k++]=r[t+1]}};this.intersect=function(){};this.getGLMaterials=
function(){return{color:m,depthShadowMap:p,normal:void 0,depth:k,highlight:void 0}};this.getAllTextureIds=function(){return[a]}},m=function(a,b,d){l.basicGLMaterialConstructor(this,a);var k=f.TRANSPARENT_MATERIAL,m=b.get("billboard");l.singleTextureGLMaterialConstructor(this,d,{textureId:a.getTextureId()});this.beginSlot=function(a){return k===a};this.getProgram=function(){return m};this.bind=function(a,b){a.bindProgram(m);this.bindTexture(a,m);a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,
a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);a.setDepthTestEnabled(!0)};this.release=function(a){};this.bindView=function(a,b){l.bindView(b.origin,b.view,m)};this.bindInstance=function(a,b){m.setUniformMatrix4fv("model",b.transformation);m.setUniformMatrix4fv("modelNormal",b.transformationNormal)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},k=function(a,b,d,k){l.basicGLMaterialConstructor(this,a);var m=f.TRANSPARENT_MATERIAL,p=null==k?b.get("billboardDepth"):b.get("billboardDepthShadowMap");
l.singleTextureGLMaterialConstructor(this,d,{textureId:a.getTextureId()});this.beginSlot=function(a){return m===a};this.getProgram=function(){return p};this.bind=function(a,b){a.bindProgram(p);this.bindTexture(a,p);p.setUniform2fv("nearFar",b.nearFar)};this.release=function(a){};this.bindView=function(a,b){l.bindView(b.origin,b.view,p)};this.bindInstance=function(a,b){p.detUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},p=function(a,b,d){k.call(this,
a,b,d,!0)};t.loadShaders=function(b,f,k,m){b._parse(w);var p=new a(m,b.vertexShaderBillboard,b.fragmentShaderBillboard,d.Default3D),r=f.get("fsDepthTextured");f=f.get("fsDepthTexturedShadowMap");r=new a(m,b.vertexShaderBillboardDepth,r.source,d.Default3D,r.defines);b=new a(m,b.vertexShaderBillboardDepth,f.source,d.Default3D,f.defines);k.add("billboard",p);k.add("billboardDepth",r);k.add("billboardDepthShadowMap",b)};return t})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("dojo/_base/lang dojo/text!./ColorMaterial.xml ./internal/MaterialUtil ../lib/RenderSlot ../lib/Util ../../../webgl/Program ../lib/DefaultVertexAttributeLocations ../lib/DefaultVertexBufferLayouts ../../../webgl/Util".split(" "),
function(w,l,f,a,d,b,q,t,m){d=function(a,b){f.basicMaterialConstructor(this,b);a=a||{};a.color=a.color||[1,1,1,1];a.polygonOffset=a.polygonOffset||!1;a.vertexColors=a.vertexColors||!1;var d=t.Pos3Col;this.getParams=function(){return a};this.setColor=function(b){a.color=b;this.notifyDirty("matChanged")};this.getColor=function(){return a.color};this.setTransparent=function(b){a.transparent=b;this.notifyDirty("matChanged")};this.getTransparent=function(b){return a.transparent};this.dispose=function(){};
this.getOutputAmount=function(a){var b=m.getStride(d)/4;return a*b};this.getVertexBufferLayout=function(){return d};this.fillInterleaved=function(a,b,k,m,c,p,q){f.fillInterleaved(a,b,k,m,d,c,p,q)};this.intersect=f.intersectTriangleGeometry;this.getGLMaterials=function(){return{color:k,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:p}};this.getAllTextureIds=function(){return[]}};var k=function(b,d,k){f.basicGLMaterialConstructor(this,b);var m=w.clone(b.getParams()),p=d.get("colorMaterial"),
q=b.getColor();this.beginSlot=function(b){return b===(1>q[3]?a.TRANSPARENT_MATERIAL:a.OPAQUE_MATERIAL)};this.getProgram=function(){return p};this.updateParameters=function(){m.color=b.getColor();m.transparent=b.getTransparent()};this.bind=function(a,b){a.bindProgram(p);p.setUniform4fv("eColor",m.color);a.setFaceCullingEnabled(!1);m.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(1,1));m.transparent&&(a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,
a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA));a.setDepthTestEnabled(!0)};this.release=function(a){a.setPolygonOffsetFillEnabled(!1);m.transparent&&a.setBlendingEnabled(!1)};this.bindView=function(a,b){f.bindView(b.origin,b.view,p)};this.bindInstance=function(a,b){p.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},p=function(b,d,k){f.basicGLMaterialConstructor(this,b);var m=w.clone(b.getParams()),p=d.get("colorMaterial"),q=[1,1,1,1];this.beginSlot=function(b){return b===
(1>q[3]?a.TRANSPARENT_MATERIAL:a.OPAQUE_MATERIAL)};this.getProgram=function(){return p};this.updateParameters=function(){m.color=b.getColor();m.transparent=b.getTransparent()};this.bind=function(a,b){a.bindProgram(p);p.setUniform4fv("eColor",m.color);a.setFaceCullingEnabled(!1);m.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(1,1))};this.release=function(a){a.setPolygonOffsetFillEnabled(!1)};this.bindView=function(a,b){f.bindView(b.origin,b.view,p)};this.bindInstance=function(a,
b){p.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){return a.gl.TRIANGLES}};d.programs=null;d.loadShaders=function(a,d,f,k){a._parse(l);a=new b(k,a.vertexShaderColorMaterial,a.fragmentShaderColorMaterial,q.Default3D);f.add("colorMaterial",a)};return d})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/text!./LineCalloutMaterial.xml ./internal/MaterialUtil ../lib/Util ../../../webgl/Util ./internal/MaterialBase ./internal/GLMaterialBase ../lib/RenderSlot ../lib/ShaderVariations".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p){function x(a,b,d){3===d.length?a.setUniform4f(b,d[0],d[1],d[2],1):a.setUniform4fv(b,d)}var z=b.VertexAttrConstants,v=[{name:"position",count:3,type:5126,offset:0,stride:48,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:48,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:48,normalized:!1},{name:"auxpos1",count:4,type:5126,offset:32,stride:48,normalized:!1}],r={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,
0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world"};w=function(b){function c(a,f){f=b.call(this,f)||this;f.params=d.copyParameters(a,r);f._uniqueMaterialIdentifier=c.uniqueMaterialIdentifier(f.params);return f}f(c,b);Object.defineProperty(c.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0});c.prototype.dispose=function(){};c.prototype.getGLMaterials=function(){return{color:u,
depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};c.prototype.getAllTextureIds=function(){return[]};c.prototype.fillAttributeData=function(a,b,c,f,k,m){var p=a.faces.indices[b];a=a.vertexAttr[b].data;if(p&&a)for(b=c+q.findAttribute(v,b).offset/4,c=0;c<p.length;c++)for(var r=f*p[c],l=0;6>l;l++)d.fill(a,r,m,b,k,f),b+=12};c.prototype.fillInterleaved=function(a,b,c,d,f,k,m){this.fillAttributeData(a,z.POSITION,k,3,b,f);this.fillAttributeData(a,z.NORMAL,k,3,c,f);this.fillAttributeData(a,
z.AUXPOS1,k,4,null,f);a=k+q.findAttribute(v,z.UV0).offset/4;b=0;for(c=C;b<c.length;b++)d=c[b],f[a+0]=d[0],f[a+1]=d[1],a+=12};c.prototype.getOutputAmount=function(a){return 288*a};c.prototype.getInstanceBufferLayout=function(){};c.prototype.getVertexBufferLayout=function(){return v};c.prototype.intersect=function(a,b,c,d,f,k,m,p){};c.prototype.getParameterValues=function(){var a=this.params;return{verticalOffset:a.verticalOffset,screenSizePerspective:a.screenSizePerspective,screenOffset:a.screenOffset,
centerOffsetUnits:a.centerOffsetUnits,color:[a.color[0],a.color[1],a.color[2],a.color[3]],size:a.size,borderColor:a.borderColor,occlusionTest:a.occlusionTest,shaderPolygonOffset:a.shaderPolygonOffset,depthHUDAlignStart:a.depthHUDAlignStart}};c.prototype.setParameterValues=function(a){var b=!1,d;for(d in a){var f=a[d];void 0!==f&&(b=!0,Array.isArray(f)?this.params[d]=f.slice():this.params[d]=f)}b&&(this._uniqueMaterialIdentifier=c.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))};
c.uniqueMaterialIdentifier=function(a){return JSON.stringify({screenOffset:a.screenOffset||[0,0],centerOffsetUnits:a.centerOffsetUnits||"world"})};c.loadShaders=function(b,c,d,f){b._parse(a);b=new p("lineCallout",["vertexShaderLineCallout","fragmentShaderLineCallout"],null,d,c,b,f);b.addDefine("occlTest","OCCL_TEST");b.addDefine("verticalOffset","VERTICAL_OFFSET");b.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");b.addDefine("depthHud","DEPTH_HUD");b.addDefine("depthHudAlignStart","DEPTH_HUD_ALIGN_START");
b.addDefine("centerOffsetUnitsScreen","CENTER_OFFSET_UNITS_SCREEN");d.addShaderVariations("line-callout-material-shader-variations",b)};return c}(t.MaterialBase);var u=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;b.isRenderSlot=!0;b.programRep=c;b.updateParameters();return b}f(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.selectProgram=function(){var a=this.params;this.renderProgram=this.programRep.getShaderVariationsProgram("line-callout-material-shader-variations",
[!!a.occlusionTest,!!a.verticalOffset,!!a.screenSizePerspective,!1,!!a.depthHUDAlignStart,"screen"===a.centerOffsetUnits]);this.depthProgram=this.programRep.getShaderVariationsProgram("line-callout-material-shader-variations",[!!a.occlusionTest,!!a.verticalOffset,!!a.screenSizePerspective,!0,!!a.depthHUDAlignStart,"screen"===a.centerOffsetUnits])};b.prototype.beginSlot=function(a){switch(a){case k.LINE_CALLOUTS:return this.isRenderSlot=!0;case k.LINE_CALLOUTS_HUD_DEPTH:return this.isRenderSlot=!1,
!0}return!1};Object.defineProperty(b.prototype,"program",{get:function(){return this.isRenderSlot?this.renderProgram:this.depthProgram},enumerable:!0,configurable:!0});b.prototype.getAllPrograms=function(){return[this.renderProgram,this.depthProgram]};b.prototype.getProgram=function(){return this.program};b.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};b.prototype.bind=function(a,b){var c=b.cameraAboveGround?1:-1,f=this.program,k=this.params;a.bindProgram(f);f.setUniform1f("cameraGroundRelative",
c);f.setUniform1f("polygonOffset",k.shaderPolygonOffset);f.setUniform4fv("viewport",b.viewport);f.setUniformMatrix4fv("viewNormal",b.viewInvTransp);f.setUniform1i("hudVisibilityTexture",0);a.bindTexture(b.hudVisibilityTexture,0);x(f,"color",k.color);f.setUniform2f("screenOffset",k.screenOffset[0],k.screenOffset[1]);this.bindBorder(a,b);d.bindVerticalOffset(k.verticalOffset,b,f);this.bindSizing(a,b);d.bindScreenSizePerspective(k.screenSizePerspective,f);this.isRenderSlot?this.bindRender(a,b):this.bindHUDDepth(a,
b)};b.prototype.bindRender=function(a,b){a.setBlendFunctionSeparate(1,771,770,771);a.setBlendingEnabled(!0);a.setDepthWriteEnabled(!1)};b.prototype.bindHUDDepth=function(a,b){a.setColorMask(!1,!1,!1,!1);a.setDepthWriteEnabled(!0);a.setBlendingEnabled(!1);a.setDepthTestEnabled(!0)};b.prototype.bindView=function(a,b){a=this.program;d.bindView(b.origin,b.view,a);d.bindCamPos(b.origin,b.viewInvTransp,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);
a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.release=function(a,b){this.isRenderSlot?this.releaseRender(a,b):this.releaseHUDDepth(a,b)};b.prototype.releaseRender=function(a,b){a.setBlendingEnabled(!1);a.setBlendFunction(770,771);a.setDepthWriteEnabled(!0)};b.prototype.releaseHUDDepth=function(a,b){a.setColorMask(!0,!0,!0,!0)};b.prototype.bindSizing=function(a,b){a=this.program;var c=this.params;a.setUniform2f("pixelToNDC",2/b.viewport[2],2/b.viewport[3]);a.setUniform1f("lineSize",
Math.ceil(c.size))};b.prototype.bindBorder=function(a,b){a=this.program;b=this.params;null!==b.borderColor?(x(a,"borderColor",b.borderColor),a.setUniform1f("borderSize",1)):(a.setUniform4f("borderColor",0,0,0,0),a.setUniform1f("borderSize",0))};return b}(m.GLMaterialBase),C=[[0,0],[1,0],[0,1],[1,0],[1,1],[0,1]];return w})},"esri/views/3d/webgl-engine/materials/LeafCardMaterial":function(){define("dojo/text!./LeafCardMaterial.xml ./internal/MaterialUtil ../lib/Util ../lib/gl-matrix ../lib/RenderSlot ../../../webgl/Program ../lib/DefaultVertexAttributeLocations ../../../webgl/Util".split(" "),
function(w,l,f,a,d,b,q,t){function m(){u=(9301*u+49297)%233280;return u/233280}var k=a.vec3,p=a.mat4,x=a.mat4d;a=function(a,b,c,d,q,u){l.basicMaterialConstructor(this,u);var C=[{name:"position",count:3,type:5126,offset:0,stride:44,normalized:!1},{name:"normal",count:4,type:5126,offset:12,stride:44,normalized:!1},{name:"uv0",count:4,type:5126,offset:28,stride:44,normalized:!1}],B=t.getStride(C)/4;this.getAmbient=function(){return b};this.getDiffuse=function(){return c};this.getSpecular=function(){return d};
this.getShininess=function(){return q};this.dispose=function(){};this.getTextureId=function(){return a};this.getOutputAmount=function(a){var b=0,c;for(c=0;c<a/6;c++)0===c%1&&(b+=6);a=b;for(c=b=0;c<a/6;c++)0===c%1&&(b+=6);return b*B};this.getVertexBufferLayout=function(){return C};this.reduce=function(a,b){var c=a.position,d=a.normal;a=a.uv0;for(var f=[],k=[],m=[],p=0,r=0;r<c.length/6;r++)if(0===r%b)for(var q=0;6>q;q++)f[p]=c[6*r+q],k[p]=d[6*r+q],m[p]=a[6*r+q],p++;return{position:f,normal:k,uv0:m}};
this.fillInterleaved=function(a,b,c,d,r,q){d=l.fill;var v=this.reduce(a.faces.indices,1),v=this.reduce(v,1),u=this.getOutputAmount(a.faces.indices.position.length);f.assert(u===v.position.length*B);var t=v.position,z=v.normal,C=v.uv0,v=a.vertexAttr.position.data,E=a.vertexAttr.normal.data,h=a.vertexAttr.uv0.data,e=k.create();a=t.length/6;for(var u=q,g=k.createFrom(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),n=k.createFrom(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),y=0;y<a;++y){for(var w=
k.create(),D=k.create(),H=[100,100,-100,-100],G=k.create(),I=0;6>I;++I){var K=6*y+I,J=3*t[K],P=3*z[K],K=2*C[K];w[0]+=v[J+0];w[1]+=v[J+1];w[2]+=v[J+2];D[0]+=E[P+0];D[1]+=E[P+1];D[2]+=E[P+2];P=h[K+0];K=h[K+1];H[0]=Math.min(H[0],P);H[1]=Math.min(H[1],K);H[2]=Math.max(H[2],P);H[3]=Math.max(H[3],K);0===I&&k.set3(v[J+0],v[J+1],v[J+2],G)}w[0]/=6;w[1]/=6;w[2]/=6;D[0]/=6;D[1]/=6;D[2]/=6;w[0]+=.1*(2*m()-1);w[1]+=.1*(2*m()-1);w[2]+=.1*(2*m()-1);void 0!==b&&(x.multiplyVec3(b,G,G),x.multiplyVec3(b,w,w),x.multiplyVec3(c,
D,D));k.add(w,e,e);k.max(g,w,g);k.min(n,w,n);H[0]+=.01;H[1]+=.01;H[2]-=.01;H[3]-=.01;for(I=0;4>I;I++)H[I]=Math.min(H[I],.99999);I=2*m()*Math.PI;G=1.41*k.dist(G,w);q+=d(w,0,r,q,void 0,3);q+=d(D,0,r,q,void 0,3);r[q++]=0;r[q++]=H[0];r[q++]=H[1];r[q++]=I;r[q++]=G;q+=d(w,0,r,q,void 0,3);q+=d(D,0,r,q,void 0,3);r[q++]=0;r[q++]=H[2]+1;r[q++]=H[1];r[q++]=I;r[q++]=G;q+=d(w,0,r,q,void 0,3);q+=d(D,0,r,q,void 0,3);r[q++]=0;r[q++]=H[2]+1;r[q++]=H[3]+1;r[q++]=I;r[q++]=G;q+=d(w,0,r,q,void 0,3);q+=d(D,0,r,q,void 0,
3);r[q++]=0;r[q++]=H[2]+1;r[q++]=H[3]+1;r[q++]=I;r[q++]=G;q+=d(w,0,r,q,void 0,3);q+=d(D,0,r,q,void 0,3);r[q++]=0;r[q++]=H[0];r[q++]=H[3]+1;r[q++]=I;r[q++]=G;q+=d(w,0,r,q,void 0,3);q+=d(D,0,r,q,void 0,3);r[q++]=0;r[q++]=H[0];r[q++]=H[1];r[q++]=I;r[q++]=G}e[0]/=a;e[1]/=a;e[2]/=a;b=k.create();k.add(g,n,b);k.scale(b,.5,b);q=k.create();k.subtract(g,n,q);q[0]=Math.abs(q[0])/2;q[1]=Math.abs(q[1])/2;q[2]=Math.abs(q[2])/2;t=k.create(e);t[1]-=(g[1]-n[1])/3;g=k.create();n=k.create();v=k.create();z=[k.create(),
k.create(),k.create(),k.create()];e=[0,0,0,0];C=p.create();for(y=0;y<a;++y){k.set3(r[u],r[u+1],r[u+2],v);k.subtract(v,t,g);k.normalize(g,g);n=k.subtract(v,b,n);k.normalize(n,n);h=Math.abs(k.dot(n,[1,0,0]));I=Math.abs(k.dot(n,[0,1,0]));E=Math.abs(k.dot(n,[0,0,1]));h=h*Math.abs(b[0]-v[0])/q[0];h+=I*Math.abs(b[1]-v[1])/q[1];h+=E*Math.abs(b[2]-v[2])/q[2];for(I=0;4>I;I++)p.identity(C),p.rotate(C,.8*(2*m()-1),[0,1,0],C),p.rotate(C,.8*(2*m()-1),[1,0,0],C),p.multiplyVec3(C,g,z[I]),e[I]=.5+.5*h-.2*(2*m()-
1);E=.8+.3*(2*m()-1);for(I=0;6>I;++I){var O;switch(I){case 0:O=0;break;case 1:O=1;break;case 2:O=2;break;case 3:O=2;break;case 4:O=3;break;case 5:O=0}u+=3;u+=d(z[O],0,r,u,c,3);r[u++]=e[O];u+=3;r[u++]*=E}}};this.intersect=function(){};this.getGLMaterials=function(){return{color:z,depthShadowMap:r,normal:void 0,depth:v,highlight:void 0}};this.getAllTextureIds=function(){return[a]}};var z=function(a,b,c){l.basicGLMaterialConstructor(this,a);var f=d.TRANSPARENT_MATERIAL,k=b.get("leafCard");l.singleTextureGLMaterialConstructor(this,
c,{textureId:a.getTextureId()});this.beginSlot=function(a){return f===a};this.getProgram=function(){return k};var m=a.getAmbient(),p=a.getDiffuse(),r=a.getSpecular(),q=a.getShininess();this.bind=function(a,b){a.bindProgram(k);this.bindTexture(a,k);k.setUniform3fv("ambient",m);k.setUniform3fv("diffuse",p);k.setUniform3fv("specular",r);k.setUniform1f("shininess",q);k.setUniform1f("trafoScale",1);a.setBlendingEnabled(!1);a.setDepthTestEnabled(!0)};this.release=function(a){};this.bindView=function(a,
b){l.bindView(b.origin,b.view,k);l.bindCamPos(b.origin,b.viewInvTransp,k)};this.bindInstance=function(a,b){k.setUniformMatrix4fv("model",b.transformation);k.setUniformMatrix4fv("modelNormal",b.transformationNormal);a=b.transformation;k.setUniform1f("trafoScale",(Math.sqrt(a[0]*a[0]+a[4]*a[4]+a[8]*a[8])+Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])+Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))/3)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},v=function(a,b,c,f){l.basicGLMaterialConstructor(this,a);
var k=d.TRANSPARENT_MATERIAL,m=null==f?b.get("leafCardDepth"):b.get("leafCardDepthShadowMap");l.singleTextureGLMaterialConstructor(this,c,{textureId:a.getTextureId()});this.beginSlot=function(a){return k===a};this.getProgram=function(){return m};this.bind=function(a,b){a.bindProgram(m);this.bindTexture(a,m);m.setUniform2fv("nearFar",b.nearFar)};this.release=function(a){};this.bindView=function(a,b){l.bindView(b.origin,b.view,m)};this.bindInstance=function(a,b){m.setUniformMatrix4fv("model",b.transformation);
a=b.transformation;m.setUniform1f("trafoScale",(Math.sqrt(a[0]*a[0]+a[4]*a[4]+a[8]*a[8])+Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])+Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))/3)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},r=function(a,b,c){v.call(this,a,b,c,!0)};a.loadShaders=function(a,d,c,f){a._parse(w);var k=new b(f,a.vertexShaderLeafCard,a.fragmentShaderLeafCard,q.Default3D),m=d.get("fsDepthTextured");d=d.get("fsDepthTexturedShadowMap");m=new b(f,a.vertexShaderLeafCardDepth,m.source,
q.Default3D,m.defines);a=new b(f,a.vertexShaderLeafCardDepth,d.source,q.Default3D,d.defines);c.add("leafCard",k);c.add("leafCardDepth",m);c.add("leafCardDepthShadowMap",a)};var u=1234;return a})},"esri/views/3d/webgl-engine/materials/Material":function(){define("dojo/text!./Material.xml ./internal/MaterialUtil ../../../webgl/Program ../lib/ShaderVariations ../lib/Util ../lib/gl-matrix ../lib/RenderSlot ../lib/DefaultVertexAttributeLocations ../lib/DefaultVertexBufferLayouts ../../../webgl/Util ../../layers/graphics/graphicUtils".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p){function x(a,b){var e=b.vvSizeEnabled;b.vvSizeEnabled?(a.setUniform3fv("vvSizeMinSize",b.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",b.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",b.vvSizeOffset),a.setUniform3fv("vvSizeFactor",b.vvSizeFactor)):e&&a.setUniform3fv("vvSizeValue",b.vvSizeValue);e&&(a.setUniform3fv("vvSymbolAnchor",b.vvSymbolAnchor),p.computeObjectRotation(b.vvSymbolRotation[2],b.vvSymbolRotation[0],b.vvSymbolRotation[1],c.identity(G)),a.setUniformMatrix3fv("vvSymbolRotation",
c.toMat3(G,I)));b.vvColorEnabled&&(a.setUniform1fv("vvColorValues",b.vvColorValues),a.setUniform4fv("vvColorColors",b.vvColorColors))}function z(a,b){a.vvSizeEnabled=b.vvSizeEnabled;a.vvSizeMinSize=b.vvSizeMinSize;a.vvSizeMaxSize=b.vvSizeMaxSize;a.vvSizeOffset=b.vvSizeOffset;a.vvSizeFactor=b.vvSizeFactor;a.vvSizeValue=b.vvSizeValue;a.vvSymbolAnchor=b.vvSymbolAnchor;a.vvSymbolRotation=b.vvSymbolRotation}function v(a,b){C.set(a,B);return C.multiply(b,B)}var r=d.assert,u=b.vec3,C=b.vec4,E=b.mat3,c=b.mat4,
D,B=C.create(),I=E.create(),G=c.create(),H=u.create(),K=u.create(),J=u.createFrom(0,0,1),P=u.create(),O=u.create(),L=u.create(),M=u.create();d=function(a,b){l.basicMaterialConstructor(this,b);a=a||{};a.ambient=a.ambient||[.2,.2,.2];a.diffuse=a.diffuse||[.8,.8,.8];a.specular=a.specular||[0,0,0];a.externalColor=a.externalColor||[1,1,1,1];a.colorMixMode=a.colorMixMode||"multiply";a.shininess=a.shininess||10;a.opacity=void 0!==a.opacity?a.opacity:1;a.layerOpacity=void 0!==a.layerOpacity?a.layerOpacity:
1;a.blendModeOneOne=a.blendModeOneOne||!1;a.inverseWindingOrder=a.inverseWindingOrder||!1;a.vertexColors=a.vertexColors||!1;a.symbolColors=a.symbolColors||!1;a.flipV=a.flipV||!1;a.doubleSided=a.doubleSided||!1;a.cullFace=a.cullFace||void 0;a.instanced=a.instanced||!1;this.instanced=!!a.instanced;a.groundNormalShading=a.groundNormalShading||!1;a.writeStencil=a.writeStencil||!1;a.textureId||(a.reflTextureId=void 0);a.receiveSSAO=void 0!==a.receiveSSAO?a.receiveSSAO:!0;a.castShadows=void 0!==a.castShadows?
a.castShadows:!0;a.verticalOffset=a.verticalOffset||null;a.screenSizePerspective=a.screenSizePerspective||null;a.vvSizeEnabled=a.vvSizeEnabled||!1;a.vvSizeMinSize=a.vvSizeMinSize||[1,1,1];a.vvSizeMaxSize=a.vvSizeMaxSize||[100,100,100];a.vvSizeOffset=a.vvSizeOffset||[0,0,0];a.vvSizeFactor=a.vvSizeFactor||[1,1,1];a.vvSizeValue=a.vvSizeValue||[1,1,1];a.vvColorEnabled=a.vvColorEnabled||!1;a.vvColorValues=a.vvColorValues||[0,0,0,0,0,0,0,0];a.vvColorColors=a.vvColorColors||[1,0,0,0,1,0,0,0,1,0,0,0,1,0,
0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0];a.vvSymbolAnchor=a.vvSymbolAnchor||[0,0,0];a.vvSymbolRotation=a.vvSymbolRotation||[0,0,0];b="Pos3";a.groundNormalShading||(b+="Norm");a.textureId&&(b=a.atlasRegions?b+"TexRegion":b+"Tex");a.vertexColors&&(b+="Col");a.symbolColors&&(b+="Symcol");var c=m[b],d=null;a.instanced&&(d=[],k.addDescriptor(d,"model",16,5126,!1,1),k.addDescriptor(d,"modelNormal",16,5126,!1,1),-1<a.instanced.indexOf("color")&&k.addDescriptor(d,"instanceColor",4,5126,!1,1),-1<a.instanced.indexOf("featureAttribute")&&
k.addDescriptor(d,"instanceFeatureAttribute",4,5126,!1,1));var f=this.isVisible.bind(this);this.isVisible=function(){return f()&&0<a.opacity&&0<a.layerOpacity};this.dispose=function(){};this.getParams=function(){return a};this.getParameterValues=function(){var b={ambient:a.ambient,diffuse:a.diffuse,specular:a.specular,externalColor:a.externalColor,colorMixMode:a.colorMixMode,shininess:a.shininess,opacity:a.opacity,layerOpacity:a.layerOpacity,transparent:a.transparent,polygonOffset:a.polygonOffset,
reflectivity:a.reflectivity,atlasRegions:a.atlasRegions,flipV:a.flipV,doubleSided:a.doubleSided,cullFace:a.cullFace,writeStencil:a.writeStencil,receiveSSAO:a.receiveSSAO,castShadows:a.castShadows,verticalOffset:a.verticalOffset,screenSizePerspective:a.screenSizePerspective,vvSizeEnabled:a.vvSizeEnabled,vvSizeMinSize:a.vvSizeMinSize,vvSizeMaxSize:a.vvSizeMaxSize,vvSizeOffset:a.vvSizeOffset,vvSizeFactor:a.vvSizeFactor,vvSizeValue:a.vvSizeValue,vvColorEnabled:a.vvColorEnabled,vvColorValues:a.vvColorValues,
vvColorColors:a.vvColorColors,groundNormalShading:a.groundNormalShading,vvSymbolAnchor:a.vvSymbolAnchor,vvSymbolRotation:a.vvSymbolRotation};a.textureId&&(b.textureId=a.textureId,b.initTexture=a.initTexture);return b};this.setParameterValues=function(b){for(var c in b)"textureId"===c&&r(a.textureId,"Can only change texture of material that already has a texture"),"castShadows"===c&&r(b.castShadows===a.castShadows,"Can not change shadow casting behavior."),a[c]=b[c];this.notifyDirty("matChanged")};
this.getOutputAmount=function(a){var b=k.getStride(c)/4;return a*b};this.getVertexBufferLayout=function(){return c};this.getInstanceBufferLayout=function(){return d};this.fillInterleaved=function(a,b,e,d,f,g,h){l.fillInterleaved(a,b,e,d,c,f,g,h)};this.intersect=function(b,c,e,d,f,g,h,k){if(null!=a.verticalOffset){k=d.camera;u.set3(e[12],e[13],e[14],L);var m=u.subtract(L,k.eye,M),p=u.length(m),n=u.scale(m,1/p),r=null,m=null;switch(d.viewingMode){case "global":m=u.normalize(L,P);break;case "local":m=
u.set(J,P)}a.screenSizePerspective&&(r=u.dot(m,n));k=l.verticalOffsetAtDistance(k,p,a.verticalOffset,r,a.screenSizePerspective);u.scale(m,k);E.multiplyVec3(d.transformInverseRotation,m,O);f=u.subtract(f,O,H);g=u.subtract(g,O,K)}l.intersectTriangleGeometry(b,c,e,d,f,g,h)};this.getGLMaterials=function(){return{color:A,depthShadowMap:a.castShadows?S:null,normal:h,depth:V,highlight:e}};this.getAllTextureIds=function(){var b=[];a.textureId&&b.push(a.textureId);a.reflTextureId&&b.push(a.reflTextureId);
return b}};d.paramsFromOldConstructor=function(a,b,c,e,d,f,h,k,m,p,r,q,l){return{textureId:a,transparent:b,ambient:c,diffuse:e,specular:d,shininess:f,opacity:h,polygonOffset:k,initTexture:m,reflTextureId:p,reflectivity:r,flipV:q,doubleSided:l,cullFace:void 0}};var R=function(a,b){var c=a.gl;(b.cullFace?"none"===b.cullFace:b.transparent)?a.setFaceCullingEnabled(!1):(a.setFaceCullingEnabled(!0),"front"===b.cullFace&&a.setCullFace(c.FRONT))},Q=function(a,b){var c=a.gl;(b.cullFace?"none"===b.cullFace:
b.transparent)?a.setFaceCullingEnabled(!0):(a.setFaceCullingEnabled(!1),"front"===b.cullFace&&a.setCullFace(c.BACK))},T=function(a,b){return a?q.TRANSPARENT_MATERIAL:b?q.STENCIL_MATERIAL:q.OPAQUE_MATERIAL},A=function(a,b,c){l.basicGLMaterialConstructor(this,a);var e=l.copyParameters(a.getParams()),d=T(e.transparent,e.writeStencil);l.singleTextureGLMaterialConstructor(this,c,e);var f=l.aquireIfNotUndefined(e.reflTextureId,e.reflInitTexture,c);f&&(f=f.getGLTexture());r(!(e.atlasRegions&&e.reflTextureId),
"Atlas texture with reflection is not yet supported");var g=e.textureId?e.atlasRegions?"AtlasTextured":"Textured":"none";this.instanced=D&&e.instanced;var h=!!this.instanced&&-1<this.instanced.indexOf("color"),k=!D&&e.instanced&&-1<e.instanced.indexOf("color"),m=[[null,null],[null,null]],p,n=null;this._loadPrograms=function(){m[0][0]=this._loadProgram(!1,!1);m[1][0]=this._loadProgram(!0,!1);e.receiveSSAO?(m[0][1]=this._loadProgram(!1,!0),m[1][1]=this._loadProgram(!0,!0),p=m[0].concat(m[1])):(m[0][1]=
m[0][0],m[1][1]=m[1][0],p=[m[0][0],m[1][0]])};this._loadProgram=function(a,c){return b.getShaderVariationsProgram("material",[g,!!e.reflTextureId,e.vertexColors,e.symbolColors,e.flipV,e.doubleSided,!!this.instanced,h,a,c,!!e.vvSizeEnabled,!!e.vvColorEnabled,null!=e.verticalOffset,null!=e.screenSizePerspective,e.groundNormalShading])};this._loadPrograms();var q="AtlasTextured"===g,u=this.dispose;this.dispose=function(){u();l.releaseIfNotUndefined(e.reflTextureId,c)};this.beginSlot=function(a){return d===
a};this.getProgram=function(){return n||m[0][0]};this.getAllPrograms=function(){return p};this.updateParameters=function(){var b=a.getParams();e.ambient=b.ambient;e.diffuse=b.diffuse;e.specular=b.specular;e.externalColor=b.externalColor;e.colorMixMode=b.colorMixMode;e.shininess=b.shininess;e.opacity=b.opacity;e.layerOpacity=b.layerOpacity;e.polygonOffset=b.polygonOffset;e.reflectivity=b.reflectivity;e.flipV=b.flipV;e.doubleSided=b.doubleSided;e.cullFace=b.cullFace;e.receiveSSAO=b.receiveSSAO;e.castShadows=
b.castShadows;e.verticalOffset=b.verticalOffset;e.screenSizePerspective=b.screenSizePerspective;z(e,b);e.vvColorEnabled=b.vvColorEnabled;e.vvColorValues=b.vvColorValues;e.vvColorColors=b.vvColorColors;e.transparent!=b.transparent&&(d=T(b.transparent),e.transparent=b.transparent);e.groundNormalShading=b.groundNormalShading;e.initTexture=b.initTexture;this.updateTexture(b.textureId);b.atlasRegions&&(e.atlasRegions=b.atlasRegions);e.blendModeOneOne=b.blendModeOneOne;e.inverseWindingOrder=b.inverseWindingOrder;
this._loadPrograms()};this.bind=function(a,b){var c=a.gl;n=m[b.shadowMappingEnabled?1:0][b.ssaoEnabled?1:0];a.bindProgram(n);n.setUniform3fv("ambient",e.ambient);n.setUniform3fv("diffuse",e.diffuse);n.setUniform3fv("specular",e.specular);n.setUniform4fv("externalColor",e.externalColor);n.setUniform1i("colorMixMode",l.colorMixModes[e.colorMixMode]);n.setUniform1f("shininess",e.shininess);n.setUniform1f("opacity",e.opacity);n.setUniform1f("layerOpacity",e.layerOpacity);l.bindVerticalOffset(e.verticalOffset,
b,n);l.bindScreenSizePerspective(e.screenSizePerspective,n);x(n,e);this.bindTexture(a,n);q&&this.bindTextureSize(a,n);a.setBlendFunctionSeparate(c.SRC_ALPHA,c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA);void 0!==f&&(n.setUniform1i("reflTex",1),a.bindTexture(f,1),n.setUniform1f("reflectivity",e.reflectivity));e.inverseWindingOrder&&a.setFrontFace(c.CW);e.transparent?(a.setBlendingEnabled(!0),e.blendModeOneOne?(a.setBlendFunction(c.ONE,c.ONE),a.setDepthWriteEnabled(!1)):a.setBlendFunctionSeparate(c.SRC_ALPHA,
c.ONE_MINUS_SRC_ALPHA,c.ONE,c.ONE_MINUS_SRC_ALPHA)):a.setBlendingEnabled(!1);e.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(2,2));R(a,e);a.setDepthTestEnabled(!0)};this.release=function(a,b){b=a.gl;a.setPolygonOffsetFillEnabled(!1);Q(a,e);a.setBlendingEnabled(!1);a.setBlendFunctionSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA);a.setDepthWriteEnabled(!0);a.setFrontFace(b.CCW)};this.bindView=function(a,b){n=m[b.shadowMappingEnabled?1:0][b.ssaoEnabled?
1:0];a=b.origin;l.bindView(a,b.view,n);l.bindCamPos(a,b.viewInvTransp,n);b.shadowMappingEnabled&&b.shadowMap.bindView(n,a)};this.bindInstance=function(a,b){n.setUniformMatrix4fv("model",b.transformation);n.setUniformMatrix4fv("modelNormal",b.transformationNormal);b.instanceParameters&&k&&(a=b.instanceParameters.color)&&n.setUniform4fv("externalColor",v(a,e.externalColor))};this.getDrawMode=function(a){return a.gl.TRIANGLES}},V=function(a,b,c,e){l.basicGLMaterialConstructor(this,a);var d=l.copyParameters(a.getParams());
this.instanced=D&&d.instanced;var f=k.hasAttribute(a.getVertexBufferLayout(),"uv0")?"Textured":"none",g=b.getShaderVariationsProgram("material-depth",[f,d.flipV,!!this.instanced,!!e,!!d.vvSizeEnabled,null!=d.verticalOffset,null!=d.screenSizePerspective]),h=T(d.transparent,d.writeStencil);l.singleTextureGLMaterialConstructor(this,c,d);this.beginSlot=function(a){return h===a};this.getProgram=function(){return g};this.updateParameters=function(){var b=a.getParams();d.initTexture=b.initTexture;d.cullFace=
b.cullFace;d.inverseWindingOrder=b.inverseWindingOrder;d.flipV=b.flipV;z(d,b);this.updateTexture(b.textureId)};this.bind=function(a,b){var c=a.gl;a.bindProgram(g);g.setUniform2fv("nearFar",b.nearFar);d.inverseWindingOrder&&a.setFrontFace(c.CW);l.bindVerticalOffset(d.verticalOffset,b,g);l.bindScreenSizePerspective(d.screenSizePerspective,g);x(g,d);this.bindTexture(a,g);R(a,d);a.setDepthTestEnabled(!0)};this.release=function(a){var b=a.gl;Q(a,d);d.inverseWindingOrder&&a.setFrontFace(b.CCW)};this.bindView=
function(a,b){l.bindView(b.origin,b.view,g);d.screenSizePerspective&&l.bindCamPos(b.origin,b.viewInvTransp,g)};this.bindInstance=function(a,b){g.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},S=function(a,b,c){V.call(this,a,b,c,!0)},h=function(a,b,c){l.basicGLMaterialConstructor(this,a);var e=l.copyParameters(a.getParams()),d=k.hasAttribute(a.getVertexBufferLayout(),"uv0")?"Textured":"none";this.instanced=D&&e.instanced;var f=b.getShaderVariationsProgram("material-normal",
[d,e.flipV,!!this.instanced,!!e.vvSizeEnabled,null!=e.verticalOffset,null!=e.screenSizePerspective]),g=T(e.transparent,e.writeStencil);l.singleTextureGLMaterialConstructor(this,c,e);this.beginSlot=function(a){return g===a};this.getProgram=function(){return f};this.updateParameters=function(){var b=a.getParams();e.initTexture=b.initTexture;e.cullFace=b.cullFace;e.inverseWindingOrder=b.inverseWindingOrder;e.flipV=b.flipV;z(e,b);this.updateTexture(b.textureId)};this.bind=function(a,b){var c=a.gl;a.bindProgram(f);
this.bindTexture(a,f);f.setUniformMatrix4fv("viewNormal",b.viewInvTransp);l.bindVerticalOffset(e.verticalOffset,b,f);l.bindScreenSizePerspective(e.screenSizePerspective,f);x(f,e);R(a,e);e.inverseWindingOrder&&a.setFrontFace(c.CW);a.setDepthTestEnabled(!0)};this.release=function(a){var b=a.gl;Q(a,e);e.inverseWindingOrder&&a.setFrontFace(b.CCW)};this.bindView=function(a,b){l.bindView(b.origin,b.view,f);e.screenSizePerspective&&l.bindCamPos(b.origin,b.viewInvTransp,f)};this.bindInstance=function(a,b){f.setUniformMatrix4fv("model",
b.transformation);f.setUniformMatrix4fv("modelNormal",b.transformationNormal)};this.getDrawMode=function(a){return a.gl.TRIANGLES}},e=function(a,b,c,e){l.basicGLMaterialConstructor(this,a);var d=l.copyParameters(a.getParams());e=k.hasAttribute(a.getVertexBufferLayout(),"uv0")?"Textured":"none";this.instanced=D&&d.instanced;var f=b.getShaderVariationsProgram("material-highlight",[e,d.flipV,!!this.instanced,!!d.vvSizeEnabled,null!=d.verticalOffset,null!=d.screenSizePerspective]),g=T(d.transparent,d.writeStencil);
l.singleTextureGLMaterialConstructor(this,c,d);this.beginSlot=function(a){return g===a};this.getProgram=function(){return f};this.updateParameters=function(){var b=a.getParams();d.initTexture=b.initTexture;d.cullFace=b.cullFace;d.inverseWindingOrder=b.inverseWindingOrder;d.flipV=b.flipV;z(d,b);this.updateTexture(b.textureId)};this.bind=function(a,b){var c=a.gl;a.bindProgram(f);this.bindTexture(a,f);l.bindVerticalOffset(d.verticalOffset,b,f);l.bindScreenSizePerspective(d.screenSizePerspective,f);x(f,
d);R(a,d);d.inverseWindingOrder&&a.setFrontFace(c.CW);a.setDepthTestEnabled(!0)};this.release=function(a){var b=a.gl;Q(a,d);d.inverseWindingOrder&&a.setFrontFace(b.CW)};this.bindView=function(a,b){l.bindView(b.origin,b.view,f);d.screenSizePerspective&&l.bindCamPos(b.origin,b.viewInvTransp,f)};this.bindInstance=function(a,b){f.setUniformMatrix4fv("model",b.transformation);f.setUniformMatrix4fv("modelNormal",b.transformationNormal)};this.getDrawMode=function(a){return a.gl.TRIANGLES}};d.loadShaders=
function(b,c,e,d){b._parse(w);D=d.extensions.angleInstancedArrays;d.extensions.shaderTextureLOD;d.extensions.standardDerivatives;var g=new a("phong",["vsPhong","fsPhong"],null,e,c,b,d);g.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);g.addBinaryShaderSnippetSuffix("Refl","Refl",[!1,!0]);g.addDefine("Color","VERTEXCOLORS");g.addDefine("symbolColor","SYMBOLVERTEXCOLORS");g.addDefine("FlipV","FLIPV");g.addDefine("DoubleSided",
"DOUBLESIDED");g.addDefine("Instanced","INSTANCED");g.addDefine("InstColor","INSTANCEDCOLOR");g.addDefine("ReceiveShadows","RECEIVE_SHADOWS");g.addDefine("ReceiveSSAO","RECEIVE_SSAO");g.addDefine("vvSize","VV_SIZE");g.addDefine("vvColor","VV_COLOR");g.addDefine("VerticalOffset","VERTICAL_OFFSET");g.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");g.addDefine("groundNormalShading","GROUND_NORMAL_SHADING");e.addShaderVariations("material",g);g=new a("depth",["vsDepth","fsDepth"],null,e,
c,b,d);g.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);g.addDefine("FlipV","FLIPV");g.addDefine("Instanced","INSTANCED");g.addDefine("ShadowMap","BIAS_SHADOWMAP");g.addDefine("vvSize","VV_SIZE");g.addDefine("VerticalOffset","VERTICAL_OFFSET");g.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");e.addShaderVariations("material-depth",g);g=new a("normal",["vsNormal","fsNormal"],null,e,c,b,d);g.addNaryShaderSnippetSuffix([{value:"none",
programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},{value:"AtlasTextured"}]);g.addDefine("FlipV","FLIPV");g.addDefine("Instanced","INSTANCED");g.addDefine("vvSize","VV_SIZE");g.addDefine("VerticalOffset","VERTICAL_OFFSET");g.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");e.addShaderVariations("material-normal",g);g=new a("highlight",["vsHighlight","fsHighlight"],null,e,c,b,d);g.addNaryShaderSnippetSuffix([{value:"none",programNameSuffix:"",shaderSnippetSuffix:""},{value:"Textured"},
{value:"AtlasTextured"}]);g.addDefine("FlipV","FLIPV");g.addDefine("Instanced","INSTANCED");g.addDefine("vvSize","VV_SIZE");g.addDefine("VerticalOffset","VERTICAL_OFFSET");g.addDefine("screenSizePerspective","SCREEN_SIZE_PERSPECTIVE");e.addShaderVariations("material-highlight",g);var g=new f(d,b.vsDepth,b.fsDepth,t.Default3D,["BIAS_SHADOWMAP 1"]),h=new f(d,b.vsDepthTextured,b.fsDepthTextured,t.Default3D,["BIAS_SHADOWMAP 1"]),k=new f(d,b.vsDepth,b.fsDepth,t.Default3D),m=new f(d,b.vsDepthTextured,b.fsDepthTextured,
t.Default3D),p=new f(d,b.vsNormal,b.fsNormal,t.Default3D),n=new f(d,b.vsNormalTextured,b.fsNormalTextured,t.Default3D),r=new f(d,b.vsHighlight,b.fsHighlight,t.Default3D);d=new f(d,b.vsHighlightTextured,b.fsHighlightTextured,t.Default3D);e.add("depthShadowMap",g);e.add("depthTexturedShadowMap",h);e.add("depth",k);e.add("depthTextured",m);e.add("normal",p);e.add("normalTextured",n);e.add("highlight",r);e.add("highlightTextured",d);c.add("fsDepth",{source:b.fsDepth});c.add("fsDepthTextured",{source:b.fsDepthTextured});
c.add("fsDepthShadowMap",{source:b.fsDepthShadowMap,defines:["BIAS_SHADOWMAP 1"]});c.add("fsDepthTexturedShadowMap",{source:b.fsDepthTextured,defines:["BIAS_SHADOWMAP 1"]});c.add("vsDepth",{source:b.vsDepth});c.add("fsNormal",{source:b.fsNormal})};return d})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("require exports ../../../../geometry/SpatialReference ../../../../geometry/Point ../../../../geometry/support/webMercatorUtils ../../lib/glMatrix".split(" "),function(w,l,f,a,d,
b){function q(a,b){var k=a.spatialReference;k.equals(b)||(k.isWebMercator&&b.wkid===f.WGS84.wkid?d.webMercatorToGeographic(a,!1,a):b.isWebMercator&&k.wkid===f.WGS84.wkid&&d.geographicToWebMercator(a,!1,a))}function t(a){if(Array.isArray(a)){for(var b=0;b<a.length;b++)if(!t(a[b]))return!1;return!0}return null==a||0<=a}Object.defineProperty(l,"__esModule",{value:!0});var m=b.vec4d,k=b.mat4d,p=[1,1,1];l.computeCentroid=function(b,d){if("extent"===b.type)return b.center;if("polygon"===b.type)return b.centroid;
for(var f=0,k=0,m=0,p=b.hasZ,l=0,c=0,x=b.paths;c<x.length;c++){for(var t=x[c],z=0,w=t;z<w.length;z++){var H=w[z],f=f+H[0],k=k+H[1];p&&(m+=H[2])}l+=t.length}b=new a({x:f/l,y:k/l,z:p?m/l:void 0,spatialReference:b.spatialReference});d&&q(b,d);return b};l.convertToSR=q;l.enlargeExtent=function(a,b,d){if(a){b||(b=m.create());var f=.5*a.width*(d-1);d=.5*a.height*(d-1);a.width<1E-7*a.height?f+=d/20:a.height<1E-7*a.width&&(d+=f/20);m.set4(a.xmin-f,a.ymin-d,a.xmax+f,a.ymax+d,b);return b}return null};l.updateVertexAttributeAuxpos1w=
function(a,b){for(var d=0;d<a.geometries.length;++d){var f=a.geometries[d].data.vertexAttributes.auxpos1;f&&f.data[3]!==b&&(f.data[3]=b,a.geometryVertexAttrsUpdated(d))}};l.mixinColorAndOpacity=function(a,b){var d=[1,1,1,1];null!=a&&(d[0]=a[0],d[1]=a[1],d[2]=a[2]);null!==b&&void 0!==b?d[3]=b:null!=a&&3<a.length&&(d[3]=a[3]);return d};l.overrideColor=function(a,b,d,f,k){k=k.slice();for(var m=0;3>m;++m)a&&null!=a[m]?k[m]=a[m]:d&&null!=d[m]&&(k[m]=d[m]);null!=b?k[3]=b:null!=f&&(k[3]=f);return k};l.computeObjectScale=
function(a,b,d,f){void 0===a&&(a=p);void 0===f&&(f=1);var k=Array(3);if(null==b||null==d)k[0]=1,k[1]=1,k[2]=1;else{for(var m=void 0,r=0,c=2;0<=c;c--){var q=a[c],l=void 0,v=null!=q,x=0===c&&!m&&!v,t=d[c];"symbolValue"===q||x?l=0!==t?b[c]/t:1:v&&"proportional"!==q&&isFinite(q)&&(l=0!==t?q/t:1);null!=l&&(m=k[c]=l,r=Math.max(r,Math.abs(l)))}for(c=2;0<=c;c--)null==k[c]?k[c]=m:0===k[c]&&(k[c]=.001*r)}for(c=2;0<=c;c--)k[c]/=f;return k};l.computeSizeWithResourceSize=function(a,b){var d=b.width,f=b.depth,
k=b.height;b=b.isPrimitive?10:1;if(null==d&&null==k&&null==f)return[b*a[0],b*a[1],b*a[2]];for(var d=[d,f,k],m,f=0;3>f;f++)if(k=d[f],null!=k){m=k/a[f];break}for(f=0;3>f;f++)null==d[f]&&(d[f]=a[f]*m);return d};l.validateSymbolLayerSize=function(a){null!=a.isPrimitive&&(a=[a.width,a.depth,a.height]);return t(a)?null:"Symbol sizes may not be negative values"};l.computeObjectRotation=function(a,b,d,f){void 0===f&&(f=k.identity());a=a||0;b=b||0;d=d||0;0!==a&&k.rotateZ(f,-a/180*Math.PI,f);0!==b&&k.rotateX(f,
b/180*Math.PI,f);0!==d&&k.rotateY(f,d/180*Math.PI,f);return f}})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("dojo/_base/lang dojo/text!./RibbonLineMaterial.xml ./internal/MaterialUtil ../lib/Util ../lib/gl-matrix ../lib/RenderSlot ../lib/ComponentUtils ../../../webgl/Program ../lib/DefaultVertexAttributeLocations ../lib/DefaultVertexBufferLayouts ../../../webgl/Util".split(" "),function(w,l,f,a,d,b,q,t,m,k,p){var x=[255,255,255,255],z=[0,0,0,0],v=d.vec3d,r=d.vec2d,
u=d.mat4d,C=v.create(),E=v.create(),c=v.create(),D=v.create(),B=r.create(),I=r.create(),G=v.create(),H=v.create();d=function(b,d){f.basicMaterialConstructor(this,d);var m=a.VertexAttrConstants;b=b||{};b.color=b.color||[1,1,1,1];b.width=b.width||0;b.type=b.type||"screen";b.join=b.join||"miter";b.miterLimit="miter"===b.join?b.miterLimit||5:b.miterLimit;var r="wall"===b.type?2:4,l=k.Pos3Tex;"wall"!==b.type&&(l=[{name:"position",count:3,type:5126,offset:0,stride:64,normalized:!1},{name:"uv0",count:2,
type:5126,offset:12,stride:64,normalized:!1},{name:"auxpos1",count:3,type:5126,offset:20,stride:64,normalized:!1},{name:"auxpos2",count:3,type:5126,offset:32,stride:64,normalized:!1},{name:"color",count:4,type:5126,offset:44,stride:64,normalized:!1},{name:"size",count:1,type:5126,offset:60,stride:64,normalized:!1}]);this.canBeMerged=!1;this.getParams=function(){return b};this.getParameterValues=function(){var a={color:b.color,width:b.width,type:b.type,join:b.join,polygonOffset:b.polygonOffset};"miter"===
b.join&&(a.miterLimit=b.miterLimit);return a};this.setParameterValues=function(c){for(var d in c)c.hasOwnProperty(d)&&(a.assert("type"!==d,"RibbonLineMaterial: type cannot be changed after creation"),b[d]=c[d]);this.notifyDirty("matChanged")};this.dispose=function(){};this.getOutputAmount=function(a){return((a/2+1-2)*r+4)*p.getStride(l)/4};this.getVertexBufferLayout=function(){return l};this.fillInterleaved=function(a,c,d,f,k,h){d=a.vertexAttr[m.POSITION].data;f=a.vertexAttr[m.COLOR]?a.vertexAttr[m.COLOR].data:
x;var e=a.vertexAttr[m.SIZE]?a.vertexAttr[m.SIZE].data:z;(a=a.faces&&a.faces.indices&&a.faces.indices.position)&&a.length!=2*(d.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");if("wall"===b.type){f=h;e=d.length/3;h=0;a=d[0];for(var g=d[1],p=d[2],r,q,l,v=0;v<e;v++){var u=3*v;r=a;q=g;l=p;a=d[u];g=d[u+1];p=d[u+2];c&&(a=c[0]*a+c[4]*g+c[8]*p+c[12],g=c[1]*a+c[5]*g+c[9]*p+c[13],p=c[2]*a+c[6]*g+c[10]*p+c[14]);h+=Math.sqrt((a-r)*(a-r)+(g-q)*(g-q)+(p-l)*(p-l));k[f++]=a;k[f++]=g;k[f++]=
p;k[f++]=h;k[f++]=-1;k[f++]=a;k[f++]=g;k[f++]=p;k[f++]=h;k[f++]=1}}else{a=d.length/3;g=d[0];p=d[1];r=d[2];q=0;c&&(g=c[0]*g+c[4]*p+c[8]*r+c[12],p=c[1]*g+c[5]*p+c[9]*r+c[13],r=c[2]*g+c[6]*p+c[10]*r+c[14]);l=g;var v=p,u=r,t=d[3],C=d[4],B=d[5];c&&(t=c[0]*t+c[4]*C+c[8]*B+c[12],C=c[1]*t+c[5]*C+c[9]*B+c[13],B=c[2]*t+c[6]*C+c[10]*B+c[14]);for(var E=0;E<a;E++){var w=3*E;E<a-1&&(t=d[w+3],C=d[w+4],B=d[w+5],c&&(t=c[0]*t+c[4]*C+c[8]*B+c[12],C=c[1]*t+c[5]*C+c[9]*B+c[13],B=c[2]*t+c[6]*C+c[10]*B+c[14]));q+=Math.sqrt((l-
g)*(l-g)+(v-p)*(v-p)+(u-r)*(u-r));k[h++]=l;k[h++]=v;k[h++]=u;k[h++]=q;k[h++]=0===E?-1.2:-1;k[h++]=g;k[h++]=p;k[h++]=r;k[h++]=t;k[h++]=C;k[h++]=B;k[h++]=f[0];k[h++]=f[1];k[h++]=f[2];k[h++]=f[3];k[h++]=e[0];k[h++]=l;k[h++]=v;k[h++]=u;k[h++]=q;k[h++]=0===E?1.2:1;k[h++]=g;k[h++]=p;k[h++]=r;k[h++]=t;k[h++]=C;k[h++]=B;k[h++]=f[0];k[h++]=f[1];k[h++]=f[2];k[h++]=f[3];k[h++]=e[0];0<E&&E<a-1&&(k[h++]=l,k[h++]=v,k[h++]=u,k[h++]=q,k[h++]=-1.2,k[h++]=g,k[h++]=p,k[h++]=r,k[h++]=t,k[h++]=C,k[h++]=B,k[h++]=f[0],
k[h++]=f[1],k[h++]=f[2],k[h++]=f[3],k[h++]=e[0],k[h++]=l,k[h++]=v,k[h++]=u,k[h++]=q,k[h++]=1.2,k[h++]=g,k[h++]=p,k[h++]=r,k[h++]=t,k[h++]=C,k[h++]=B,k[h++]=f[0],k[h++]=f[1],k[h++]=f[2],k[h++]=f[3],k[h++]=e[0]);g=l;p=v;r=u;l=t;v=C;u=B}}};this.intersect=function(d,f,k,p,r,h,e){if(p.isSelection&&!q.isAllHidden(f.componentVisibilities,d.data.componentOffsets)){f=d.getData().getVertexAttr(m.position).position.data;d=d.getData().getVertexAttr(m.SIZE).size;d=(d&&d.data[0])+b.width;r=Number.MAX_VALUE;var g,
n;h=p.camera;for(var l=p.point,x=0;x<f.length-5;x+=3){C[0]=f[x];C[1]=f[x+1];C[2]=f[x+2];u.multiplyVec3(k,C);E[0]=f[x+3];E[1]=f[x+4];E[2]=f[x+5];u.multiplyVec3(k,E);h.projectPoint(C,B);h.projectPoint(E,I);if(0>B[2]&&0<I[2])v.subtract(C,E,c),g=h.frustumPlanes,n=-(v.dot(g[4],C)+g[4][3]),g=n/v.dot(c,g[4]),v.scale(c,g,c),v.add(C,c,C),h.projectPoint(C,B);else if(0<B[2]&&0>I[2])v.subtract(E,C,c),g=h.frustumPlanes,n=-(v.dot(g[4],E)+g[4][3]),g=n/v.dot(c,g[4]),v.scale(c,g,c),v.add(E,c,E),h.projectPoint(E,I);
else if(0>B[2]&&0>I[2])continue;g=a.pointLineSegmentDistance2D(B,I,l);g<r&&(r=g,v.set(C,G),v.set(E,H))}k=p.p0;p=p.p1;r<d/2+4&&(f=a.lineSegmentLineSegmentDistance3D(G,H,k,p),d=Number.MAX_VALUE,f[0]&&(v.subtract(f[2],k,D),d=v.length(D)/v.dist(k,p)),e(d,D))}};this.getGLMaterials=function(){return{color:K,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:J}};this.getAllTextureIds=function(){return[]}};var K=function(a,c){f.basicGLMaterialConstructor(this,a);var d=w.clone(a.getParams());d.miterLimit=
"miter"===d.join?d.miterLimit:0;delete d.join;var k=c.get("ribbonLine_"+d.type);this.updateParameters=function(){var b=a.getParams();d.polygonOffset=b.polygonOffset;d.color=b.color;d.width=b.width;d.miterLimit="miter"===b.join?b.miterLimit:0};this.beginSlot=function(a){return a===b.TRANSPARENT_MATERIAL};this.getProgram=function(){return k};this.bind=function(a,b){a.bindProgram(k);k.setUniform4fv("eColor",d.color);k.setUniform1f("miterLimit",d.miterLimit);k.setUniform1f("nearPlane",b.nearFar[0]);"screen"===
d.type?(k.setUniform2fv("screenSize",[b.viewport[2],b.viewport[3]]),k.setUniform1f("extLineWidth",d.width*b.pixelRatio)):k.setUniform1f("extLineWidth",d.width);d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(1<=d.color[3])};this.release=function(a){d.polygonOffset&&a.setPolygonOffsetFillEnabled(!1);
a.setBlendingEnabled(!1);a.setDepthWriteEnabled(!0)};this.bindView=function(a,b){f.bindView(b.origin,b.view,k)};this.bindInstance=function(a,b){k.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){return a.gl.TRIANGLE_STRIP}},J=function(a,c){f.basicGLMaterialConstructor(this,a);var d=w.clone(a.getParams());d.miterLimit="miter"===d.join?d.miterLimit:0;delete d.join;var k=c.get("ribbonLineHighlight_"+d.type);this.updateParameters=function(){var b=a.getParams();d.polygonOffset=
b.polygonOffset;d.color=b.color;d.width=b.width;d.miterLimit="miter"===b.join?b.miterLimit:0};this.beginSlot=function(a){return a===b.OPAQUE_MATERIAL};this.getProgram=function(){return k};this.bind=function(a,b){a.bindProgram(k);k.setUniform4fv("eColor",d.color);k.setUniform1f("miterLimit",d.miterLimit);k.setUniform1f("nearPlane",b.nearFar[0]);"screen"===d.type?(k.setUniform2fv("screenSize",[b.viewport[2],b.viewport[3]]),k.setUniform1f("extLineWidth",d.width*b.pixelRatio)):k.setUniform1f("extLineWidth",
d.width);d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setFaceCullingEnabled(!1);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(1<=d.color[3])};this.release=function(a){d.polygonOffset&&a.setPolygonOffsetFillEnabled(!1);a.setDepthWriteEnabled(!0)};this.bindView=function(a,b){f.bindView(b.origin,b.view,k)};this.bindInstance=function(a,b){k.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){return a.gl.TRIANGLE_STRIP}};d.loadShaders=function(a,
b,c,d){a._parse(l);b=new t(d,a.vsRibbonLine,a.fsRibbonLine,m.Default3D,["SCREENSCALE"]);var f=new t(d,a.vsRibbonLine,a.fsRibbonLineHighlight,m.Default3D,["SCREENSCALE"]),k=new t(d,a.vsRibbonLine,a.fsRibbonLine,m.Default3D),p=new t(d,a.vsRibbonLine,a.fsRibbonLineHighlight,m.Default3D),r=new t(d,a.vsRibbonLine,a.fsRibbonLine,m.Default3D,["WALL"]);a=new t(d,a.vsRibbonLine,a.fsRibbonLineHighlight,m.Default3D,["WALL"]);c.add("ribbonLine_screen",b);c.add("ribbonLineHighlight_screen",f);c.add("ribbonLine_strip",
k);c.add("ribbonLineHighlight_strip",p);c.add("ribbonLine_wall",r);c.add("ribbonLineHighlight_wall",a)};return d})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("dojo/text!./WaterMaterial.xml ./internal/MaterialUtil ../lib/RenderSlot ../../../webgl/Program ../lib/DefaultVertexAttributeLocations ../lib/DefaultVertexBufferLayouts ../../../webgl/Util".split(" "),function(w,l,f,a,d,b,q){var t=function(a,d,f,t,v,r){l.basicMaterialConstructor(this,r);var k=b.Pos3;this.dispose=
function(){};this.getNoiseTextureId=function(){return a};this.getReflTextureId=function(){return d};this.getColor=function(){return f};this.getScale=function(){return t};this.getSpeed=function(){return v};this.getOutputAmount=function(a){return a*q.getStride(k)/4};this.getVertexBufferLayout=function(){return k};this.fillInterleaved=function(a,b,c,d,f,m,p){l.fillInterleaved(a,b,c,d,k,f,m,p)};this.intersect=l.intersectTriangleGeometry;this.getGLMaterials=function(){return{color:m,depthShadowMap:void 0,
normal:void 0,depth:void 0,highlight:void 0}};this.getAllTextureIds=function(){return[a,d]}},m=function(a,b,d){l.basicGLMaterialConstructor(this,a);var k=f.TRANSPARENT_MATERIAL,m=b.get("water");b={noiseTextureId:a.getNoiseTextureId(),reflTextureId:a.getReflTextureId()};l.multiTextureGLMaterialConstructor(this,d,b,[["noiseTextureId",void 0,"noiseTex"],["reflTextureId",void 0,"reflTex"]]);var p=a.getColor(),q=a.getScale(),x=a.getSpeed(),t=Date.now();this.beginSlot=function(a){return k===a};this.getProgram=
function(){return m};this.bind=function(a,b){a.bindProgram(m);this.bindTextures(a,m);m.setUniform3fv("color",p);m.setUniform1f("scale",q);a=(Date.now()-t)/1E5*x;a-=Math.floor(a);m.setUniform1f("speed",a);b.shadowMappingEnabled||m.setUniform1f("depthHalfPixelSz",-1)};this.release=function(a){};this.bindView=function(a,b){a=b.origin;l.bindView(a,b.view,m);l.bindCamPos(a,b.viewInvTransp,m);b.shadowMappingEnabled&&b.shadowMap.bindView(m,a)};this.bindInstance=function(a,b){m.setUniformMatrix4fv("model",
b.transformation)};this.getDrawMode=function(a){return a.gl.TRIANGLES}};t.loadShaders=function(b,f,m,q){b._parse(w);b=new a(q,b.vertexShaderWater,b.fragmentShaderWater,d.Default3D);m.add("water",b)};return t})},"esri/views/3d/webgl-engine/materials/internal/BlendLayers":function(){define(["dojo/text!./BlendLayers.xml","../../../../webgl/Program","../../lib/DefaultVertexAttributeLocations"],function(w,l,f){return{loadShaders:function(a,d,b,q){a._parse(w);a=new l(q,a.vertexShaderBlendLayers,a.fragmentShaderBlendLayers,
f.Default3D);b.add("blendLayers",a)}}})},"esri/views/3d/webgl-engine/lib/tracer":function(){define(["require","exports","./webgl-debug"],function(w,l,f){Object.defineProperty(l,"__esModule",{value:!0});var a=null,d=[];l.enabled=!1;l.begin=function(){l.enabled&&(a=[])};l.trace=function(b){l.enabled&&null!=a&&a.push(b)};l.end=function(){if(l.enabled){var b=a;a=null;b&&(d.forEach(function(a){return a(b)}),d.length=0);return b}};l.instrumentContext=function(b){return l.enabled?f.makeDebugContext(b,void 0,
function(b,d){l.enabled&&a&&a.push("gl."+b+"("+f.glFunctionArgsToString(b,d)+")")}):b};l.request=function(a){d.push(a)}})},"esri/views/3d/webgl-engine/lib/webgl-debug":function(){define([],function(){function w(a){if(null==m){m={};k={};for(var b in a)"number"==typeof a[b]&&(m[a[b]]=b,k[b]=a[b])}}function l(){if(null==m)throw"WebGLDebugUtils.init(ctx) not called";}function f(a){l();var b=m[a];return void 0!==b?"gl."+b:"/*UNKNOWN WebGL ENUM*/ 0x"+a.toString(16)+""}function a(a,b,d,m){a=t[a];if(void 0!==
a&&(a=a[b],void 0!==a&&a[d])){if("object"===typeof a[d]&&void 0!==a[d].enumBitwiseOr){b=a[d].enumBitwiseOr;d=0;a=[];for(var p=0;p<b.length;++p){var q=k[b[p]];0!==(m&q)&&(d|=q,a.push(f(q)))}return d===m?a.join(" | "):f(m)}return f(m)}return null===m?"null":void 0===m?"undefined":m.toString()}function d(a,b,d){a.__defineGetter__(d,function(){return b[d]});a.__defineSetter__(d,function(a){b[d]=a})}function b(k,m,q,l){function p(a,b){return function(){q&&q(b,arguments);var c=a[b].apply(a,arguments),d=
l.getError();0!=d&&(v[d]=!0,m(d,b,arguments));return c}}l=l||k;w(k);m=m||function(b,c,d){for(var k="",m=d.length,p=0;p<m;++p)k+=(0==p?"":", ")+a(c,m,p,d[p]);b="WebGL error "+f(b)+" in "+c+"("+k+")";window.console&&window.console.error?window.console.error(b):window.console&&window.console.log&&window.console.log(b)};var v={},x={},t;for(t in k)if("function"==typeof k[t])if("getExtension"!=t)x[t]=p(k,t);else{var c=p(k,t);x[t]=function(){var a=c.apply(k,arguments);return b(a,m,q,l)}}else d(x,k,t);x.getError=
function(){for(var a in v)if(v.hasOwnProperty(a)&&v[a])return v[a]=!1,a;return k.NO_ERROR};return x}function q(a){var b=a.getParameter(a.MAX_VERTEX_ATTRIBS),d=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,d);for(var f=0;f<b;++f)a.disableVertexAttribArray(f),a.vertexAttribPointer(f,4,a.FLOAT,!1,0,0),a.vertexAttrib1f(f,0);a.deleteBuffer(d);b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(f=0;f<b;++f)a.activeTexture(a.TEXTURE0+f),a.bindTexture(a.TEXTURE_CUBE_MAP,null),a.bindTexture(a.TEXTURE_2D,null);
a.activeTexture(a.TEXTURE0);a.useProgram(null);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.disable(a.BLEND);a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.blendColor(0,0,0,0);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.ONE,a.ZERO);a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(-1);a.colorMask(!0,!0,!0,!0);a.cullFace(a.BACK);a.depthFunc(a.LESS);
a.depthMask(!0);a.depthRange(0,1);a.frontFace(a.CCW);a.hint(a.GENERATE_MIPMAP_HINT,a.DONT_CARE);a.lineWidth(1);a.pixelStorei(a.PACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);a.UNPACK_COLORSPACE_CONVERSION_WEBGL&&a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL);a.polygonOffset(0,0);a.sampleCoverage(1,!1);a.scissor(0,0,a.canvas.width,a.canvas.height);a.stencilFunc(a.ALWAYS,0,
4294967295);a.stencilMask(4294967295);a.stencilOp(a.KEEP,a.KEEP,a.KEEP);a.viewport(0,0,a.canvas.width,a.canvas.height);for(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);a.getError(););}var t={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},
bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,
1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,
1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},m=null,k=null;return{init:w,mightBeEnum:function(a){l();return void 0!==m[a]},
glEnumToString:f,glFunctionArgToString:a,glFunctionArgsToString:function(b,d){for(var f="",k=d.length,m=0;m<k;++m)f+=(0==m?"":", ")+a(b,k,m,d[m]);return f},makeDebugContext:b,makeLostContextSimulatingCanvas:function(a){function b(a){return"function"==typeof a?a:function(b){a.handleEvent(b)}}function f(){for(var a=Object.keys(L),b=0;b<a.length;++b)delete L[a]}function k(){++J;G||K==J&&a.loseContext()}function m(a,b){var c=a[b];return function(){k();if(!G)return c.apply(a,arguments)}}function p(a){return{statusMessage:a,
preventDefault:function(){P=!0}}}function l(a){for(var b in a)"function"==typeof a[b]?c[b]=m(a,b):d(c,a,b);c.getError=function(){k();if(!G)for(var a;a=t.getError();)L[a]=!0;for(a in L)if(L[a])return delete L[a],a;return c.NO_ERROR};var f="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(b=0;b<f.length;++b){var p=f[b];c[p]=function(b){return function(){k();if(G)return null;var c=b.apply(a,arguments);c.__webglDebugContextLostId__=I;H.push(c);
return c}}(a[p])}f="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");for(b=0;b<f.length;++b)p=f[b],c[p]=function(b){return function(){k();return G?null:b.apply(a,arguments)}}(c[p]);f="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");
for(b=0;b<f.length;++b)p=f[b],c[p]=function(b){return function(){k();return G?!1:b.apply(a,arguments)}}(c[p]);c.checkFramebufferStatus=function(b){return function(){k();return G?c.FRAMEBUFFER_UNSUPPORTED:b.apply(a,arguments)}}(c.checkFramebufferStatus);c.getAttribLocation=function(b){return function(){k();return G?-1:b.apply(a,arguments)}}(c.getAttribLocation);c.getVertexAttribOffset=function(b){return function(){k();return G?0:b.apply(a,arguments)}}(c.getVertexAttribOffset);c.isContextLost=function(){return G};
return c}var t,c,w=[],B=[];c={};var I=1,G=!1,H=[],K=0,J=0,P=!1,O=0,L={};a.getContext=function(b){return function(){var d=b.apply(a,arguments);if(d instanceof WebGLRenderingContext){if(d!=t){if(t)throw"got different context";t=d;c=l(t)}return c}return d}}(a.getContext);(function(a){var c=a.addEventListener;a.addEventListener=function(d,f,k){switch(d){case "webglcontextlost":w.push(b(f));break;case "webglcontextrestored":B.push(b(f));break;default:c.apply(a,arguments)}}})(a);a.loseContext=function(){if(!G){G=
!0;K=0;for(++I;t.getError(););f();L[t.CONTEXT_LOST_WEBGL]=!0;var b=p("context lost"),c=w.slice();setTimeout(function(){for(var d=0;d<c.length;++d)c[d](b);0<=O&&setTimeout(function(){a.restoreContext()},O)},0)}};a.restoreContext=function(){G&&B.length&&setTimeout(function(){if(!P)throw"can not restore. webglcontestlost listener did not call event.preventDefault";for(var a=0;a<H.length;++a){var b=H[a];b instanceof WebGLBuffer?t.deleteBuffer(b):b instanceof WebGLFramebuffer?t.deleteFramebuffer(b):b instanceof
WebGLProgram?t.deleteProgram(b):b instanceof WebGLRenderbuffer?t.deleteRenderbuffer(b):b instanceof WebGLShader?t.deleteShader(b):b instanceof WebGLTexture&&t.deleteTexture(b)}q(t);G=!1;J=0;P=!1;for(var a=B.slice(),b=p("context restored"),c=0;c<a.length;++c)a[c](b)},0)};a.loseContextInNCalls=function(a){if(G)throw"You can not ask a lost contet to be lost";K=J+a};a.getNumCalls=function(){return J};a.setRestoreTimeout=function(a){O=a};return a},resetToInitialState:q}})},"esri/views/webgl/RenderingContext":function(){define(["require",
"exports","./enums","./Extensions"],function(w,l,f,a){return function(){function d(b,d){this.gl=null;this._extensions=void 0;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=
!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._lineWidth=1;this._clearColor={r:0,g:0,b:0,a:0};this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=
this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap={};this.gl=b;this._extensions=new a(b,d);d=b.getParameter(b.VIEWPORT);this._viewport={x:d[0],y:d[1],width:d[2],height:d[3]};d=this.extensions.textureFilterAnisotropic;this._parameters={versionString:b.getParameter(b.VERSION),maxVertexTextureImageUnits:b.getParameter(b.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:b.getParameter(b.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:d?b.getParameter(d.MAX_TEXTURE_MAX_ANISOTROPY_EXT):
void 0,maxTextureImageUnits:b.getParameter(b.MAX_TEXTURE_IMAGE_UNITS)};this.enforceState()}Object.defineProperty(d.prototype,"extensions",{get:function(){return this._extensions},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0});d.prototype.dispose=function(){this.bindVAO(null);
this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap={};this.gl=null};d.prototype.setBlendingEnabled=function(a){this._blendEnabled!==a&&(!0===a?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=a)};d.prototype.setBlendColor=function(a,d,f,m){if(a!==this._blendColorState.r||d!==this._blendColorState.g||f!==this._blendColorState.b||m!==this._blendColorState.a)this.gl.blendColor(a,d,f,m),this._blendColorState.r=a,this._blendColorState.g=d,this._blendColorState.b=
f,this._blendColorState.a=m};d.prototype.setBlendFunction=function(a,d){if(a!==this._blendFunctionState.srcRGB||d!==this._blendFunctionState.dstRGB)this.gl.blendFunc(a,d),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=a,this._blendFunctionState.dstRGB=d,this._blendFunctionState.dstAlpha=d};d.prototype.setBlendFunctionSeparate=function(a,d,f,m){if(this._blendFunctionState.srcRGB!==a||this._blendFunctionState.srcAlpha!==f||this._blendFunctionState.dstRGB!==d||this._blendFunctionState.dstAlpha!==
m)this.gl.blendFuncSeparate(a,d,f,m),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=f,this._blendFunctionState.dstRGB=d,this._blendFunctionState.dstAlpha=m};d.prototype.setBlendEquation=function(a){this._blendEquationState.mode!==a&&(this.gl.blendEquation(a),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=a)};d.prototype.setBlendEquationSeparate=function(a,d){if(this._blendEquationState.mode!==a||this._blendEquationState.modeAlpha!==d)this.gl.blendEquationSeparate(a,
d),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=d};d.prototype.setColorMask=function(a,d,f,m){if(this._colorMaskState.r!==a||this._colorMaskState.g!==d||this._colorMaskState.b!==f||this._colorMaskState.a!==m)this.gl.colorMask(a,d,f,m),this._colorMaskState.r=a,this._colorMaskState.g=d,this._colorMaskState.b=f,this._colorMaskState.a=m};d.prototype.setClearColor=function(a,d,f,m){if(this._clearColor.r!==a||this._clearColor.g!==d||this._clearColor.b!==f||this._clearColor.a!==m)this.gl.clearColor(a,
d,f,m),this._clearColor.r=a,this._clearColor.g=d,this._clearColor.b=f,this._clearColor.a=m};d.prototype.setFaceCullingEnabled=function(a){this._polygonCullingEnabled!==a&&(!0===a?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=a)};d.prototype.setPolygonOffsetFillEnabled=function(a){this._polygonOffsetFillEnabled!==a&&(!0===a?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=a)};d.prototype.setPolygonOffset=
function(a,d){if(this._polygonOffset[0]!==a||this._polygonOffset[1]!==d)this._polygonOffset[0]=a,this._polygonOffset[1]=d,this.gl.polygonOffset(a,d)};d.prototype.setCullFace=function(a){this._cullFace!==a&&(this.gl.cullFace(a),this._cullFace=a)};d.prototype.setFrontFace=function(a){this._frontFace!==a&&(this.gl.frontFace(a),this._frontFace=a)};d.prototype.setScissorTestEnabled=function(a){this._scissorTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),
this._scissorTestEnabled=a)};d.prototype.setScissorRect=function(a,d,f,m){if(this._scissorRect.x!==a||this._scissorRect.y!==d||this._scissorRect.width!==f||this._scissorRect.height!==m)this.gl.scissor(a,d,f,m),this._scissorRect.x=a,this._scissorRect.y=d,this._scissorRect.width=f,this._scissorRect.height=m};d.prototype.setDepthTestEnabled=function(a){this._depthTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=a)};d.prototype.setClearDepth=
function(a){this._clearDepth!==a&&(this.gl.clearDepth(a),this._clearDepth=a)};d.prototype.setDepthFunction=function(a){this._depthFunction!==a&&(this.gl.depthFunc(a),this._depthFunction=a)};d.prototype.setDepthWriteEnabled=function(a){this._depthWriteEnabled!==a&&(this.gl.depthMask(a),this._depthWriteEnabled=a)};d.prototype.setDepthRange=function(a,d){if(this._depthRange.zNear!==a||this._depthRange.zFar!==d)this.gl.depthRange(a,d),this._depthRange.zNear=a,this._depthRange.zFar=d};d.prototype.setStencilTestEnabled=
function(a){this._stencilTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=a)};d.prototype.setClearStencil=function(a){a!==this._clearStencil&&(this.gl.clearStencil(a),this._clearStencil=a)};d.prototype.setStencilFunction=function(a,d,f){if(this._stencilFunction.func!==a||this._stencilFunction.ref!==d||this._stencilFunction.mask!==f)this.gl.stencilFunc(a,d,f),this._stencilFunction.face=1032,this._stencilFunction.func=a,this._stencilFunction.ref=
d,this._stencilFunction.mask=f};d.prototype.setStencilFunctionSeparate=function(a,d,f,m){if(this._stencilFunction.face!==a||this._stencilFunction.func!==d||this._stencilFunction.ref!==f||this._stencilFunction.mask!==m)this.gl.stencilFuncSeparate(a,d,f,m),this._stencilFunction.face=a,this._stencilFunction.func=d,this._stencilFunction.ref=f,this._stencilFunction.mask=m};d.prototype.setStencilWriteMask=function(a){this._stencilWriteMask!==a&&(this.gl.stencilMask(a),this._stencilWriteMask=a)};d.prototype.setStencilOp=
function(a,d,f){if(this._stencilOperation.fail!==a||this._stencilOperation.zFail!==d||this._stencilOperation.zPass!==f)this.gl.stencilOp(a,d,f),this._stencilOperation.face=1032,this._stencilOperation.fail=a,this._stencilOperation.zFail=d,this._stencilOperation.zPass=f};d.prototype.setStencilOpSeparate=function(a,d,f,m){if(this._stencilOperation.face!==a||this._stencilOperation.fail!==d||this._stencilOperation.zFail!==f||this._stencilOperation.zPass!==m)this.gl.stencilOpSeparate(a,d,f,m),this._stencilOperation.face=
a,this._stencilOperation.face=a,this._stencilOperation.fail=d,this._stencilOperation.zFail=f,this._stencilOperation.zPass=m};d.prototype.setLineWidth=function(a){var b=this._lineWidth;this._lineWidth!==a&&(this.gl.lineWidth(a),this._lineWidth=a);return b};d.prototype.setActiveTexture=function(a){var b=this._activeTextureUnit;0<=a&&a!==this._activeTextureUnit&&(this.gl.activeTexture(f.BASE_TEXTURE_UNIT+a),this._activeTextureUnit=a);return b};d.prototype.clear=function(a){a&&this.gl.clear(a)};d.prototype.drawArrays=
function(a,d,f){this.gl.drawArrays(a,d,f)};d.prototype.drawElements=function(a,d,f,m){5123===f?this.gl.drawElements(a,d,f,m):5125===f&&this._extensions.elementIndexUint?this.gl.drawElements(a,d,f,m):console.warn("Data type is uint however extension OES_Element_index_unit is not supported therefore this draw call cannot be made")};d.prototype.drawArraysInstanced=function(a,d,f,m){this._extensions.angleInstancedArrays?this._extensions.angleInstancedArrays.drawArraysInstancedANGLE(a,d,f,m):console.error("Extension ANGLE_instanced_arrays isn't supported!")};
d.prototype.drawElementsInstanced=function(a,d,f,m,k){this._extensions.angleInstancedArrays?5125!==f||this._extensions.elementIndexUint?this._extensions.angleInstancedArrays.drawElementsInstancedANGLE(a,d,f,m,k):console.error("Extension OES_Element_index_unit is not supported!"):console.error("Extension ANGLE_instanced_arrays isn't supported!")};d.prototype.setViewport=function(a,d,f,m){var b=this._viewport;if(b.x!==a||b.y!==d||b.width!==f||b.height!==m)b.x=a,b.y=d,b.width=f,b.height=m,this.gl.viewport(a,
d,f,m)};d.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};d.prototype.bindProgram=function(a){a?this._activeShaderProgram!==a&&(a.initialize(),this.gl.useProgram(a.glName),this._activeShaderProgram=a):(this.gl.useProgram(null),this._activeShaderProgram=null)};d.prototype.bindTexture=function(a,f){void 0===f&&(f=0);-1===d._MAX_TEXTURE_IMAGE_UNITS&&(d._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));
(f>=d._MAX_TEXTURE_IMAGE_UNITS||0>f)&&console.error("Input texture unit is out of range of available units!");var b=this._textureUnitMap[f];this.setActiveTexture(f);null==a||null==a.glName?(null!=b&&(this.gl.bindTexture(b.descriptor.target,null),b.setBoundToUnit(f,!1)),this._textureUnitMap[f]=null):b&&b.id===a.id?a.applyChanges():(this.gl.bindTexture(a.descriptor.target,a.glName),a.setBoundToUnit(f,!0),a.applyChanges(),this._textureUnitMap[f]=a)};d.prototype.bindFramebuffer=function(a){a?this._activeFramebuffer!==
a&&(a.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.glName),this._activeFramebuffer=a):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null)};d.prototype.bindBuffer=function(a){a&&(34962===a.bufferType?this._activeVertexBuffer=d._bindBuffer(this.gl,a,a.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=d._bindBuffer(this.gl,a,a.bufferType,this._activeIndexBuffer))};d.prototype.unbindBuffer=function(a){34962===a?this._activeVertexBuffer=d._bindBuffer(this.gl,
null,a,this._activeVertexBuffer):this._activeIndexBuffer=d._bindBuffer(this.gl,null,a,this._activeIndexBuffer)};d.prototype.bindVAO=function(a){a?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===a.id||(a.bind(),this._activeVertexArrayObject=a):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};d.prototype.getBoundTexture=function(a){return this._textureUnitMap[a]};d.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer};
d.prototype.getBoundVAO=function(){return this._activeVertexArrayObject};d.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);for(var a=0;a<this.parameters.maxTextureImageUnits;a++)this.bindTexture(null,a);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);
this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,
this.gl.canvas.height)};d.prototype.enforceState=function(){var a=this.gl,d=this._extensions.vao;d&&d.bindVertexArrayOES(null);for(var l=0;l<this.parameters.maxVertexAttributes;l++)a.disableVertexAttribArray(l);this._activeVertexBuffer?a.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):a.bindBuffer(34962,null);this._activeIndexBuffer?a.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):a.bindBuffer(34963,null);if(d&&this._activeVertexArrayObject){if(d=
this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(d)}a.bindFramebuffer(a.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null);a.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);a.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);!0===this._blendEnabled?a.enable(this.gl.BLEND):a.disable(this.gl.BLEND);a.blendEquationSeparate(this._blendEquationState.mode,
this._blendEquationState.modeAlpha);a.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);a.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);a.clearDepth(this._clearDepth);a.clearStencil(this._clearStencil);a.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);a.cullFace(this._cullFace);a.depthFunc(this._depthFunction);
a.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST);a.depthMask(this._depthWriteEnabled);a.frontFace(this._frontFace);a.lineWidth(this._lineWidth);!0===this._polygonCullingEnabled?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE);a.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?a.enable(a.POLYGON_OFFSET_FILL):a.disable(a.POLYGON_OFFSET_FILL);a.scissor(this._scissorRect.x,
this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?a.enable(a.SCISSOR_TEST):a.disable(a.SCISSOR_TEST);a.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);a.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);!0===this._stencilTestEnabled?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST);a.stencilMask(this._stencilWriteMask);for(d=
0;d<this.parameters.maxTextureImageUnits;d++)a.activeTexture(f.BASE_TEXTURE_UNIT+d),a.bindTexture(3553,null),(l=this._textureUnitMap[d])&&a.bindTexture(l.descriptor.target,l.glName);a.activeTexture(f.BASE_TEXTURE_UNIT+this._activeTextureUnit);a.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)};d._bindBuffer=function(a,d,f,m){if(!d)return a.bindBuffer(f,null),null;if(m===d)return m;a.bindBuffer(f,d.glName);return d};d._MAX_TEXTURE_IMAGE_UNITS=-1;return d}()})},
"esri/views/webgl/Extensions":function(){define(["require","exports"],function(w,l){return function(){function f(a,d){this._colorBufferFloatInit=this._textureFloatLinearInit=this._textureFloatInit=this._disjointTimerQueryInit=this._compressedTextureS3TCInit=this._shaderTextureLODInit=this._textureFilterAnisotropicInit=this._depthTextureInit=this._elementIndexUintInit=this._standardDerivativesInit=this._angleInstancedArraysInit=this._vaoInit=!1;this._gl=a;d&&d.disabledExtensions&&(a=d.disabledExtensions,
a.vao&&(this._vao=null,this._vaoInit=!0),a.angleInstancedArrays&&(this._angleInstancedArrays=null,this._angleInstancedArraysInit=!0),a.standardDerivatives&&(this._standardDerivatives=null,this._standardDerivativesInit=!0),a.elementIndexUint&&(this._elementIndexUint=null,this._elementIndexUintInit=!0),a.depthTexture&&(this._depthTexture=null,this._depthTextureInit=!0),a.textureFilterAnisotropic&&(this._textureFilterAnisotropic=null,this._textureFilterAnisotropicInit=!0),a.compressedTextureS3TC&&(this._compressedTextureS3TC=
null,this._compressedTextureS3TCInit=!0),a.shaderTextureLOD&&(this._shaderTextureLOD=null,this._shaderTextureLODInit=!0),a.disjointTimerQuery&&(this._disjointTimerQuery=null,this._disjointTimerQueryInit=!0),a.textureFloat&&(this._textureFloat=null,this._textureFloatInit=!0),a.textureFloatLinear&&(this._textureFloatLinear=null,this._textureFloatLinearInit=!0),a.colorBufferFloat&&(this._colorBufferFloat=null,this._colorBufferFloatInit=!0))}Object.defineProperty(f.prototype,"vao",{get:function(){this._vaoInit||
(this._vao=this._gl.getExtension("OES_vertex_array_object")||this._gl.getExtension("MOZ_OES_vertex_array_object")||this._gl.getExtension("WEBKIT_OES_vertex_array_object"),this._vaoInit=!0);return this._vao},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"angleInstancedArrays",{get:function(){this._angleInstancedArraysInit||(this._angleInstancedArrays=this._gl.getExtension("ANGLE_instanced_arrays"),this._angleInstancedArraysInit=!0);return this._angleInstancedArrays},enumerable:!0,
configurable:!0});Object.defineProperty(f.prototype,"standardDerivatives",{get:function(){this._standardDerivativesInit||(this._standardDerivatives=this._gl.getExtension("OES_standard_derivatives"),this._standardDerivativesInit=!0);return this._standardDerivatives},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"elementIndexUint",{get:function(){this._elementIndexUintInit||(this._elementIndexUint=this._gl.getExtension("OES_element_index_uint"),this._elementIndexUintInit=!0);return this._elementIndexUint},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"depthTexture",{get:function(){this._depthTextureInit||(this._depthTexture=this._gl.getExtension("WEBGL_depth_texture")||this._gl.getExtension("MOZ_WEBGL_depth_texture")||this._gl.getExtension("WEBKIT_WEBGL_depth_texture"),this._depthTextureInit=!0);return this._depthTexture},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"textureFilterAnisotropic",{get:function(){this._textureFilterAnisotropicInit||(this._textureFilterAnisotropic=
this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this._textureFilterAnisotropicInit=!0);return this._textureFilterAnisotropic},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"shaderTextureLOD",{get:function(){this._shaderTextureLODInit||(this._shaderTextureLOD=this._gl.getExtension("EXT_shader_texture_lod"),this._shaderTextureLODInit=!0);return this._shaderTextureLOD},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"compressedTextureS3TC",{get:function(){this._compressedTextureS3TCInit||(this._compressedTextureS3TC=this._gl.getExtension("WEBGL_compressed_texture_s3tc"),this._compressedTextureS3TCInit=!0);return this._compressedTextureS3TC},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"disjointTimerQuery",{get:function(){this._disjointTimerQueryInit||(this._disjointTimerQuery=this._gl.getExtension("EXT_disjoint_timer_query"),
this._disjointTimerQueryInit=!0);return this._disjointTimerQuery},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"textureFloat",{get:function(){this._textureFloatInit||(this._textureFloat=this._gl.getExtension("OES_texture_float"),this._textureFloatInit=!0);return this._textureFloat},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"textureFloatLinear",{get:function(){this._textureFloatLinearInit||(this._textureFloatLinear=this._gl.getExtension("OES_texture_float_linear"),
this._textureFloatLinearInit=!0);return this._textureFloatLinear},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"colorBufferFloat",{get:function(){this._colorBufferFloatInit||(this._colorBufferFloat=this._gl.getExtension("EXT_color_buffer_float"),this._colorBufferFloatInit=!0);return this._colorBufferFloat},enumerable:!0,configurable:!0});return f}()})},"esri/views/3d/webgl-engine/lib/ProgramRepository":function(){define(["require","exports","./Util"],function(w,l,f){return function(){function a(){this.shaderVariators=
{};this._nextId=0;this._programsByName={};this._namesById=[];this._programRefCount=[];this._commonUniforms={model:[],modelNormal:[],lightDirection:[],proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}a.prototype.dispose=function(){for(var a in this._programsByName)this._programsByName[a].dispose();this._programRefCount=this._namesById=this._programsByName=null};a.prototype.add=function(a,b){f.assert(null==this._programsByName[a]);this._programsByName[a]=b;this._namesById[b.id]=
a};a.prototype.get=function(a){return this._programsByName[a]};a.prototype.addShaderVariations=function(a,b){this.shaderVariators[a]=b};a.prototype.getShaderVariations=function(a){return this.shaderVariators[a]};a.prototype.getShaderVariationsProgram=function(a,b,f,l){return(a=this.getShaderVariations(a))&&a.getProgram(b,f,l)};a.prototype.getProgramsUsingUniform=function(a){return this._commonUniforms[a]||[]};a.prototype.increaseRefCount=function(a){var b=a.id;this._programRefCount[b]?this._programRefCount[b]++:
(this._programRefCount[b]=1,this._findCommonUniforms(a))};a.prototype.decreaseRefCount=function(a){var b=a.id;1<this._programRefCount[b]?this._programRefCount[b]--:(this._forgetCommonUniforms(a),this._programRefCount[b]=0)};a.prototype._getNextId=function(){return this._nextId++};a.prototype._findCommonUniforms=function(a){for(var b in this._commonUniforms)a.hasUniform(b)&&(f.assert(-1===this._commonUniforms[b].indexOf(a),"common uniforms of program have already been determined"),this._commonUniforms[b].push(a))};
a.prototype._forgetCommonUniforms=function(a){for(var b in this._commonUniforms){var d=this._commonUniforms[b],f=d.indexOf(a);-1<f&&(d[f]=d[d.length-1],d.pop())}};return a}()})},"esri/views/3d/webgl-engine/lib/Selector":function(){define("require exports dojo/has ./PerformanceTimer ./gl-matrix ./Object3D".split(" "),function(w,l,f,a,d,b){var q=d.vec3d.create(),t=d.vec3d.create();w=function(){function a(a,b,f,p,q,l,t,c){void 0===c&&(c=!1);this.dir=d.vec3d.create();this.normalDir=null;this.minResult=
new m;this.maxResult=new m;this.transform=d.mat4d.create();this._transformInverse=new k({value:this.transform},d.mat4d.inverse,d.mat4d.create);this._transformInverseTranspose=new k(this._transformInverse,d.mat4d.transpose,d.mat4d.create);this._transformTranspose=new k({value:this.transform},d.mat4d.transpose,d.mat4d.create);this._transformInverseRotation=new k({value:this.transform},d.mat4d.toInverseMat3,d.mat3d.create);this.enableTerrain=this.enableHUDSelection=!0;this.enableInvisibleTerrain=!1;
this.enableBackfacesTerrain=!0;this.performanceInfo={queryDuration:0,numObjectsTested:0};this.viewingMode=a||"global";this.intersectObject=this.intersectObject.bind(this);this.init(b,f,p,q,l,t,c)}a.prototype.init=function(a,b,f,k,m,p,q){b&&f&&d.vec3d.subtract(f,b,this.dir);this.minResult.init(b,f);this.maxResult.init(b,f);this.numObjectsTested=0;this.point=k;this.camera=m;this.isSelection=q;this.layers=a;this.p0=b;this.p1=f;this.hudResults=[];null==p&&(p=1E-5);this.tolerance=p;if(this.layers)for(a=
0;a<this.layers.length;++a)if(b=this.layers[a],f=b.getSpatialQueryAccelerator?b.getSpatialQueryAccelerator():void 0)f.forEachAlongRay(this.p0,this.dir,this.intersectObject);else for(b=b.getObjects(),f=0;f<b.length;++f)this.intersectObject(b[f])};Object.defineProperty(a.prototype,"transformInverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"transformInverseTranspose",{get:function(){return this._transformInverseTranspose.value},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"transformInverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"transformTranspose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0});a.prototype.getDirection=function(){this.normalDir||(this.normalDir=d.vec3d.create(),d.vec3d.normalize(this.dir,this.normalDir));return this.normalDir};a.prototype.intersectObject=
function(a){var b=this;this.numObjectsTested++;for(var f=a.getId(),k=a.getGeometryRecords(),p=a.objectTransformation,l,x=0;x<k.length;x++){var c=k[x],w=c.geometry,B=c.materials,I=c.instanceParameters;l=w.getId();d.mat4d.set(p,this.transform);d.mat4d.multiply(this.transform,c.getShaderTransformation());this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate();d.mat4d.multiplyVec3(this.transformInverse,
this.p0,q);d.mat4d.multiplyVec3(this.transformInverse,this.p1,t);B[0].intersect(w,I,this.transform,this,q,t,function(c,d,k,p,r,q){0<=c&&(r?(r=new m,r.set(a,f,c,d,p,q,l,k),b.hudResults.push(r)):((null==b.minResult.priority||p>=b.minResult.priority)&&(null==b.minResult.dist||c<b.minResult.dist)&&b.minResult.set(a,f,c,d,p,null,l,k),(null==b.maxResult.priority||p>=b.maxResult.priority)&&(null==b.maxResult.dist||c>b.maxResult.dist)&&b.maxResult.set(a,f,c,d,p,null,l,k)))},c.customTransformation)}};a.prototype.getMinResult=
function(){return this.minResult};a.prototype.getMaxResult=function(){return this.maxResult};a.prototype.getHudResults=function(){return this.hudResults};a.DEFAULT_TOLERANCE=1E-5;return a}();var m=function(){function a(a,b){this.normal=d.vec3d.create();this.init(a,b)}a.prototype.getIntersectionPoint=function(a){if(null==this.dist)return!1;d.vec3d.lerp(this.p0,this.p1,this.dist,a);return!0};a.prototype.set=function(a,f,k,m,p,q,l,c){this.dist=k;d.vec3d.set(m,this.normal);this.targetType=a?a instanceof
b?"StageObject":"StagePoint":"None";this.target=a;this.name=f;this.priority=p;this.center=q?d.vec3d.create(q):null;this.geometryId=l;this.triangleNr=c};a.prototype.setIntersector=function(a){this.intersector=a};a.prototype.init=function(a,b){this.dist=void 0;this.targetType="None";this.priority=this.name=this.target=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="stage";this.p0=a;this.p1=b};return a}(),k=function(){function a(a,b,d){this.original=a;this.update=b;this.dirty=
!0;this.transform=d()}a.prototype.invalidate=function(){this.dirty=!0};Object.defineProperty(a.prototype,"value",{get:function(){this.dirty&&(this.update(this.original.value,this.transform),this.dirty=!1);return this.transform},enumerable:!0,configurable:!0});return a}();return w})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("require exports ./IdGen ./Util ./gl-matrix ./ComponentUtils ./HighlightUtils ./ModelContentType ./GeometryRecord".split(" "),function(w,l,f,a,d,b,q,t,m){var k=
a.assert,p=d.mat4d,x=d.vec3d;w=function(){function a(b){void 0===b&&(b={});this._bvObjectSpace=new z;this._bvWorldSpace=new z;this._bvDirty=!0;this._hasVolatileTransformation=!1;this.id=a._idGen.gen(b.idHint);this.name=b.name;this.castShadow=null!=b.castShadow?b.castShadow:!0;this.metadata=b.metadata;this.objectTransformation=p.identity();this._initializeGeometryRecords(b.geometries,b.materials,b.transformations)}a.prototype._initializeGeometryRecords=function(a,b,d){if(Array.isArray(a)){k(b.length===
a.length,"Object3D: materials don't match geometries");k(d.length===a.length,"Object3D: transformations don't match geometries");this.geometryRecords=Array(a.length);this.geometries=a.slice();for(var f=0;f<a.length;f++)k(Array.isArray(b[f]),"Object3D: materials parameter must be array of array"),this.geometryRecords[f]=new m(a[f],b[f].slice(),p.create(d[f]),{});this._hasVolatileTransformation=!1}else this.geometryRecords=[],this.geometries=[]};a.prototype.getId=function(){return this.id};Object.defineProperty(a.prototype,
"parentLayer",{get:function(){return this._parentLayer},set:function(a){k(null==this._parentLayer||null==a,"Object3D can only be added to a single Layer");this._parentLayer=a},enumerable:!0,configurable:!0});a.prototype.getParentLayer=function(){return this.parentLayer};a.prototype.addParentLayer=function(a){this.parentLayer=a};a.prototype.removeParentLayer=function(a){this.parentLayer=null};a.prototype.getNumGeometryRecords=function(){return this.geometryRecords.length};a.prototype.getFirstGeometryIndex=
function(a){a=this.geometries.indexOf(a);k(-1<a,"Object3D.getFirstGeometryIndex: geometry not found");return a};a.prototype.findGeometryRecords=function(a){for(var b=[],d=0;d<this.geometries.length;d++)this.geometries[d]===a&&b.push(this.geometryRecords[d]);return b};a.prototype.getGeometryRecord=function(a){k(0<=a&&a<this.geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range");return this.geometryRecords[a]};a.prototype.getGeometryRecords=function(){return this.geometryRecords};
a.prototype.addGeometry=function(a,b,d,f,c,q){k(Array.isArray(b),"Object3D.addGeometry: materials must be array");this.geometries.push(a);a=new m(a,b.slice(),p.create(d),f||{},c,q);this.geometryRecords.push(a);this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.customTransformation});this._notifyDirty("objGeometryAdded",a);this._invalidateBoundingVolume();return a};a.prototype.hasGeometry=function(a){return-1<this.geometries.indexOf(a)};a.prototype.removeGeometry=function(a){var b=
this.geometryRecords.splice(a,1)[0];this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.customTransformation});this.geometries.splice(a,1);this._notifyDirty("objGeometryRemoved",b);this._invalidateBoundingVolume();return b};a.prototype.geometryVertexAttrsUpdated=function(a){this._notifyDirty("vertexAttrsUpdated",this.geometryRecords[a]);this._invalidateBoundingVolume()};a.prototype.geometryColorAttrsUpdated=function(a){this._notifyDirty("colorAttrsUpdated",this.geometryRecords[a])};
a.prototype.isAllHidden=function(){for(var a=0,d=this.geometryRecords;a<d.length;a++){var f=d[a],k=f.instanceParameters.componentVisibilities,f=f.geometry.getData().componentOffsets;if(!b.isAllHidden(k,f))return!1}return!0};a.prototype.isAllVisible=function(){for(var a=0,d=this.geometryRecords;a<d.length;a++){var f=d[a],k=f.instanceParameters.componentVisibilities,f=f.geometry.getData().componentOffsets;if(!b.isAllVisible(k,f))return!1}return!0};a.prototype.hasComponents=function(){for(var a=!1,d=
0;d<this.geometries.length&&!(a=this.geometries[d].getData(),a=b.hasComponents(a.componentOffsets));d++);return a};a.prototype.setComponentVisibility=function(a,d,f){var k=a.instanceParameters.componentVisibilities,c=a.geometry.getData().componentOffsets;d=b.updateVisibility(k,c,d,f);a.instanceParameters.componentVisibilities=d;this._notifyDirty("componentVisibilityChanged",a)};a.prototype.getComponentVisibility=function(a,d){return b.getVisibility(a.instanceParameters.componentVisibilities,d)};a.prototype.hideAllComponents=
function(){for(var a=0,d=this.geometryRecords;a<d.length;a++){var f=d[a],k=b.hideAllComponents(f.instanceParameters.componentVisibilities);f.instanceParameters.componentVisibilities=k}this._notifyDirty("componentVisibilityChanged")};a.prototype.unhideAllComponents=function(){for(var a=0,d=this.geometryRecords;a<d.length;a++){var f=d[a],k=b.unhideAllComponents(f.instanceParameters.componentVisibilities);f.instanceParameters.componentVisibilities=k}this._notifyDirty("componentVisibilityChanged")};a.prototype._setComponentHighlight=
function(a,d,f,k){d=b.addHighlight(a.instanceParameters.componentHighlights,d,f,k);a.instanceParameters.componentHighlights=d};a.prototype.setComponentHighlight=function(a,b,d){var f=q.generateHighlightId();this._setComponentHighlight(a,b,d,f);this._notifyDirty("componentHighlightChanged");return f};a.prototype.highlightAllComponents=function(a){for(var b=q.generateHighlightId(),d=0,f=this.geometryRecords;d<f.length;d++)this._setComponentHighlight(f[d],null,a,b);this._notifyDirty("componentHighlightChanged");
return b};a.prototype.removeHighlights=function(a){for(var d=0,f=this.geometryRecords;d<f.length;d++){var k=f[d].instanceParameters,c=b.removeHighlight(k.componentHighlights,a);k.componentHighlights=c}this._notifyDirty("componentHighlightChanged")};a.prototype.getFaceRangeIndexFromTriangleNr=function(a){var b=this.metadata.faceRanges;if(null!=b)for(var d=0;d<b.length;d++)if(b[d][0]<=a&&b[d][1]>=a)return d};a.prototype.getFaceRangeFromTriangleNr=function(a){a=this.getFaceRangeIndexFromTriangleNr(a);
var b=this.metadata.faceRanges;return a?[b[a]]:null};a.prototype.setGeometryTransformation=function(a,b){k(0<=a&&a<this.geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var d=this.geometryRecords[a];b=new m(d.geometry,d.materials,p.create(b),d.instanceParameters);this.geometryRecords[a]=b;this._notifyDirty("objGeometryReplaced",[d,b]);this._invalidateBoundingVolume()};a.prototype.getObjectTransformation=function(){return p.create(this.objectTransformation)};a.prototype.setObjectTransformation=
function(a){p.set(a,this.objectTransformation);this._invalidateBoundingVolume();this._notifyDirty("objTransformation")};a.prototype.getCombinedStaticTransformation=function(a,b){b=b||p.create();p.multiply(this.objectTransformation,a.getStaticTransformation(),b);return b};a.prototype.getCombinedShaderTransformation=function(a,b){b=b||p.create();p.multiply(this.objectTransformation,a.getShaderTransformation(),b);return b};a.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation};
a.prototype.getCastShadow=function(){return this.castShadow};a.prototype.setCastShadow=function(a){this.castShadow=a};a.prototype.getMetadata=function(){return this.metadata};a.prototype.getName=function(){return this.name};a.prototype.getBBMin=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin};a.prototype.getBBMax=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax};a.prototype.getCenter=function(a){this._validateBoundingVolume();
return a?this._bvObjectSpace.center:this._bvWorldSpace.center};a.prototype.getBSRadius=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius};a.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var a=0;a<this.geometryRecords.length;++a)for(var b=this.geometries[a],d=this.geometryRecords[a],f=b.getNumGroups(),c=0;c<f;++c){var k=b.getBoundingInfo(c);
this._calculateTransformedBoundingVolume(k,this._bvObjectSpace,d.getShaderTransformation());this._calculateTransformedBoundingVolume(k,this._bvWorldSpace,this.getCombinedShaderTransformation(d))}x.lerp(this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5,this._bvObjectSpace.center);x.lerp(this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5,this._bvWorldSpace.center);for(var d=x.create(),m=x.create(),q=this._getScaleFactor(this.objectTransformation),a=0;a<this.geometryRecords.length;++a)for(var b=
this.geometries[a],l=this.geometryRecords[a].getShaderTransformation(),v=this._getScaleFactor(l),f=b.getNumGroups(),c=0;c<f;++c){k=b.getBoundingInfo(c);p.multiplyVec3(l,k.getCenter(),d);var t=x.dist(d,this._bvObjectSpace.center),k=k.getBSRadius()*v;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,t+k);p.multiplyVec3(this.objectTransformation,d,m);t=x.dist(m,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,t+k*q)}this._bvDirty=!1}};a.prototype._calculateTransformedBoundingVolume=
function(a,b,d){var f=a.getBBMin();a=a.getBBMax();for(var c=x.create(),k=x.create(),m=-1;3>m;++m){x.set(f,c);x.set(a,k);-1<m&&(c[m]=a[m],k[m]=f[m]);p.multiplyVec3(d,c);p.multiplyVec3(d,k);for(var r=0;3>r;++r)b.bbMin[r]=Math.min(b.bbMin[r],c[r],k[r]),b.bbMax[r]=Math.max(b.bbMax[r],c[r],k[r])}};a.prototype._getScaleFactor=function(a){return Math.max(Math.max(Math.sqrt(a[0]*a[0]+a[4]*a[4]+a[8]*a[8]),Math.sqrt(a[1]*a[1]+a[5]*a[5]+a[9]*a[9])),Math.sqrt(a[2]*a[2]+a[6]*a[6]+a[10]*a[10]))};a.prototype._invalidateBoundingVolume=
function(){this._bvDirty=!0;this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace)};a.prototype._notifyDirty=function(a,b,d,f){this._parentLayer&&(d=d||t.OBJECT,this._parentLayer.notifyDirty(a,b,d,f||this))};a._idGen=new f;return a}();var z=function(){function a(){this.bbMin=x.create();this.bbMax=x.create();this.center=x.create();this.bsRadius=0}a.prototype.init=function(){x.set3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.bbMin);x.set3(-Number.MAX_VALUE,-Number.MAX_VALUE,
-Number.MAX_VALUE,this.bbMax);x.set3(0,0,0,this.center);this.bsRadius=0};a.prototype.getCenter=function(){return this.center};a.prototype.getBSRadius=function(){return this.bsRadius};return a}();return w})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define(["require","exports","./IdGen"],function(w,l,f){return function(){function a(d,b,f,l,m,k){this.id=a._idGen.gen(d.getId());this.geometry=d;this.materials=b;this.transformation=f;this.instanceParameters=l;this.origin=m;this.customTransformation=
k}a.prototype.getId=function(){return this.id};a.prototype.getStaticTransformation=function(){return this.transformation};a.prototype.getShaderTransformation=function(){return this.customTransformation?this.customTransformation(this.transformation):this.transformation};a._idGen=new f;return a}()})},"esri/views/3d/support/CombinedElevationProvider":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ./Evented".split(" "),
function(w,l,f,a,d,b,q){return function(b){function m(a){var d=b.call(this)||this;d.providers={im:[],ground:[],scene:[]};d.handles=new Map;d.elevationChange=function(a){d.emit("elevation-change",a)};return d}f(m,b);m.prototype.getElevation=function(a,b){var d=-Infinity,f=!1;if("scene"===b)for(var k=0,m=this.providers.im;k<m.length;k++){var p=m[k],p=p.getElevation(a,b);null!=p&&(d=Math.max(p,d),!f&&isFinite(d)&&(f=!0))}if(!f)for(f=0,k=this.providers.ground;f<k.length;f++)p=k[f],p=p.getElevation(a,
b),null!=p&&(d=Math.max(p,d));if("scene"===b)for(f=0,k=this.providers.scene;f<k.length;f++)p=k[f],p=p.getElevation(a,b),null!=p&&(d=Math.max(p,d));return isFinite(d)?d:null};m.prototype.register=function(a,b){this.handles.set(b,b.on("elevation-change",this.elevationChange));this.providers[a].push(b)};m.prototype.unregister=function(a){this.handles.has(a)&&(this.handles.get(a).remove(),this.handles.delete(a));for(var b=0,d=Object.keys(this.providers);b<d.length;b++){var f=d[b],k=this.providers[f].indexOf(a);
-1<k&&this.providers[f].splice(k,1)}};a([d.property({constructOnly:!0})],m.prototype,"view",void 0);a([d.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],m.prototype,"spatialReference",void 0);return m=a([d.subclass("esri.views.3d.support.CombinedElevationProvider")],m)}(d.declared(b,q.Evented))})},"esri/views/3d/support/Evented":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});w=function(){function f(){this._listeners={}}
f.prototype.hasEventListener=function(a){return null!=this._listeners[a]&&0<this._listeners[a].size};f.prototype.on=function(a,d){var b=this;null==this._listeners[a]&&(this._listeners[a]=new Map);var f={};this._listeners[a].set(f,d);return{remove:function(){return b._listeners[a].delete(f)}}};f.prototype.emit=function(a,d){null!=this._listeners[a]&&this._listeners[a].forEach(function(a){return a(d)})};return f}();l.Evented=w})},"esri/views/3d/support/HighlightOptions":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../Color".split(" "),
function(w,l,f,a,d,b,q){return function(b){function m(){var a=null!==b&&b.apply(this,arguments)||this;a.color=new q([0,255,255]);a.haloOpacity=1;a.fillOpacity=.25;return a}f(m,b);m.toEngineOptions=function(a){return{color:new Float32Array(q.toUnitRGBA(a.color)),haloOpacity:a.haloOpacity,haloOpacityOccluded:.25*a.haloOpacity,fillOpacity:a.fillOpacity,fillOpacityOccluded:.25*a.fillOpacity}};a([d.property({type:q})],m.prototype,"color",void 0);a([d.property()],m.prototype,"haloOpacity",void 0);a([d.property()],
m.prototype,"fillOpacity",void 0);return m=a([d.subclass()],m)}(d.declared(b))})},"esri/views/3d/support/RenderCoordsHelper":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../geometry/SpatialReference ../../../geometry/Point ../../../geometry/support/scaleUtils ../lib/glMatrix ./earthUtils ./mathUtils ./projectionUtils ../webgl-engine/lib/BufferVectorMath ../webgl-engine/lib/Util".split(" "),function(w,l,f,a,d,b,q,t,m,k,p,x){w=function(){function b(a){this.spatialReference=
a}b.prototype.toRenderCoords=function(a,b,c){return a instanceof d?k.pointToVector(a,b,this.spatialReference):k.vectorToVector(a,b,c,this.spatialReference)};b.prototype.fromRenderCoords=function(b,f,c){return f instanceof d||f instanceof a?k.vectorToPoint(b,this.spatialReference,f,c):k.vectorToVector(b,this.spatialReference,f,c)};b.prototype.viewAngle=function(a,b){this.worldUpAtPosition(a,z);q.vec3d.subtract(b,a,r);a=q.vec3d.length(r);return 0===a?0:m.acos(q.vec3d.dot(r,z)/a)};return b}();(function(a){var d=
function(a){function b(b){b=a.call(this,b||k.SphericalRenderSpatialReference)||this;b.unitInMeters=1;return b}f(b,a);b.prototype.getAltitude=function(a,c){void 0===c&&(c=0);return b.getAltitude(a,c)};b.prototype.setAltitude=function(a,c,d){void 0===d&&(d=0);b.setAltitude(a,c,d)};b.prototype.setAltitudeOfTransformation=function(a,c){b.setAltitudeOfTransformation(a,c)};b.prototype.worldUpAtPosition=function(a,c){return b.worldUpAtPosition(a,c)};b.prototype.intersectManifold=function(a,c,d,f){return b.intersectManifold(a,
c,d,f)};b.getAltitude=function(a,b){void 0===b&&(b=0);return p.Vec3Compact.length(a,b)-t.earthRadius};b.setAltitude=function(a,b,c){void 0===c&&(c=0);c=c||0;a=(a+t.earthRadius)/p.Vec3Compact.length(b,c);p.Vec3Compact.scale(b,c,a)};b.setAltitudeOfTransformation=function(a,c){b.setAltitude(a,c,12)};b.worldUpAtPosition=function(a,b){return q.vec3d.normalize(a||[0,0,0],b||z)};b.intersectManifold=function(a,b,c,d){void 0===d&&(d=q.vec3d.create());return x.raySphere(a,b,null,t.earthRadius+c,d)};return b}(a);
a.Spherical=d;d=function(a){function c(c){var d=a.call(this,c)||this;d.unitInMeters=b.getMetersPerUnitForSR(c);return d}f(c,a);c.prototype.getAltitude=function(a,b){void 0===b&&(b=0);return c.getAltitude(a,b)};c.prototype.setAltitude=function(a,b,d){void 0===d&&(d=0);c.setAltitude(a,b,d)};c.prototype.setAltitudeOfTransformation=function(a,b){c.setAltitudeOfTransformation(a,b)};c.prototype.worldUpAtPosition=function(a,b){return c.worldUpAtPosition(a,b)};c.prototype.intersectManifold=function(a,b,d,
f){return c.intersectManifold(a,b,d,f)};c.getAltitude=function(a,b){return b?a[b+2]:a[2]};c.setAltitude=function(a,b,c){c?b[c+2]=a:b[2]=a};c.setAltitudeOfTransformation=function(a,b){c.setAltitude(a,b,12)};c.worldUpAtPosition=function(a,b){return b?q.vec3d.set(c.worldUp,b):c.worldUp};c.intersectManifold=function(a,b,d,f){void 0===f&&(f=q.vec3d.create());q.vec4d.set4(c.worldUp[0],c.worldUp[1],c.worldUp[2],-d,v);return!x.rayPlane(a,b,v,f)||0>q.vec3d.dot(q.vec3d.subtract(f,a,r),b)?!1:!0};c.worldUp=[0,
0,1];return c}(a);a.Planar=d})(w||(w={}));var z=q.vec3d.create(),v=q.vec4d.create(),r=q.vec3d.create();return w})},"esri/views/3d/support/MapCoordsHelper":function(){define("dojo/Evented dojo/Deferred ../../../core/declare ../../../portal/support/geometryServiceUtils ../../../tasks/support/ProjectParameters ../../../geometry/SpatialReference ../../../geometry/Point ../../../geometry/support/scaleUtils".split(" "),function(w,l,f,a,d,b,q,t){return f(w,{unitInMeters:1,spatialReference:null,constructor:function(b,
d,f){this.spatialReference=d;this.unitInMeters=t.getMetersPerUnitForSR(this.spatialReference);(this.geometryService=f)||a.create(b&&b.portalItem).then(function(a){this.geometryService=a}.bind(this)).otherwise(function(){})},toGeographic:function(a){var f=new l,m=!0,x=this.spatialReference;if(!this.geometryService)return f.reject("Must specify geometryService in esri/config"),f;Array.isArray(a[0])&&"number"!==typeof a[0]||(a=[a],m=!1);a.forEach(function(b,d){b instanceof q||(a[d]=new q(b,x))});var t=
new d({geometries:a,outSR:b.WGS84});this.geometryService.project(t).then(function(a){try{a=a.map(function(a){return[a.x,a.y]}),f.resolve(m?a:a[0])}catch(r){f.reject(r)}},function(a){f.reject(a)});return f.promise},canProject:function(){return!!this.geometryService}})})},"esri/views/3d/support/ResourceController":function(){define("../../../core/declare ../../../core/Scheduler ../../../core/HandleRegistry ../../../core/watchUtils ./StreamDataSupplier ./StreamDataLoader ./PreallocArray ../webgl-engine/lib/Util".split(" "),
function(w,l,f,a,d,b,q,t){function m(a){this.budget=this.begin=0;this.performance=a;this.enabled=!0}var k=t.assert,p={TERRAIN:"terrain",SCENE:"scene",SYMBOLOGY:"symbols"},x=new q(20);m.prototype.now=function(){return this.performance.now()};m.prototype.reset=function(a){this.begin=this.now();this.budget=this.enabled?a:Number.MAX_VALUE};m.prototype.done=function(){return this.enabled&&this.elapsed()>=this.budget};m.prototype.remaining=function(){return Math.max(this.budget-this.elapsed(),0)};m.prototype.elapsed=
function(){return this.now()-this.begin};w=w(null,{constructor:function(d,k,q){q=q||t.performance;this._clients=[];this._frameWorker=null;this._budget=new m(q);this._idleFrameWorkers=[];this._idleFrameWorkerRobin=0;this._idleUpdatesStartFired=!1;this._targetReached=!0;this._lastTargetChangeTime=q.now();this.navigationTimeout=300;this.animatingFrameTimeBudget=10;this.idleFrameWorkerBudget=30;this.idleFrameTimeBudget=50;q={};for(var r in p)q[p[r]]=0;q[p.TERRAIN]=15;q[p.SCENE]=20;q[p.SYMBOLOGY]=5;this._maxGpuMemory=
500;this.streamDataLoader=new b(q);this._cameraListeners=new f;this._cameraListeners.add([a.on(d,"navigation","currentViewReachedTarget",this._currentViewReachedTargetHandler.bind(this)),a.on(d,"navigation","targetViewChanged",this._targetViewChangedHandler.bind(this))]);k||(k=l);this._frameTask=k.addFrameTask({update:this._frameUpdate.bind(this)});this._view=d;this.stats={frameUpdateTime:new z,idleUpdateTime:new z};this.frameUpdateNavigation=null},destroy:function(){this._frameTask.remove();this._frameTask=
null;this._cameraListeners.remove();this.streamDataLoader.destroy();this.streamDataLoader=null},setEnableBudget:function(a){this._budget.enabled=!!a},registerClient:function(a,b,f){this._clients.push({client:a,type:b});"function"===typeof a.setMaxGpuMemory&&a.setMaxGpuMemory(this._maxGpuMemory);return new d(b,this.streamDataLoader,f)},deregisterClient:function(a){for(var b=0;b<this._clients.length;b++)if(this._clients[b].client===a){this._clients[b]=this._clients[this._clients.length-1];this._clients.pop();
return}console.warn("deregistering an unregistered client.")},setMaxGpuMemory:function(a){this._maxGpuMemory=a;for(var b=0;b<this._clients.length;b++){var d=this._clients[b].client;"function"===typeof d.setMaxGpuMemory&&d.setMaxGpuMemory(a)}},registerIdleFrameWorker:function(a,b){var d=this._idleFrameWorkers.some(function(b){return b.client===a});k(!d,"Can only register idle frame workers once per client/layer");k(!b.idleFrame||b.needsUpdate,"needsUpdate has to be specified if idleFrame is specified");
this._idleFrameWorkers.push({client:a,callbacks:b});this._isIdle()&&this._idleUpdatesStartFired&&b.idleBegin&&b.idleBegin.call(a)},deregisterIdleFrameWorker:function(a){for(var b=this._idleFrameWorkers,d=0;d<b.length;d++){var f=b[d];if(f.client===a){this._idleUpdatesStartFired&&f.callbacks.idleEnd&&f.callbacks.idleEnd.call(a);b[d]=b[b.length-1];b.pop();break}}},registerFrameWorker:function(a){k(!this._frameWorker,"Only one (non-idle) per-frame worker supported at the moment");this._frameWorker=a},
deregisterFrameWorker:function(){this._frameWorker=null},_targetViewChangedHandler:function(a){this._lastTargetChangeTime=this._budget.now();this._targetReached=!1;this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._callWorkersNoScheduling("idleEnd"))},_currentViewReachedTargetHandler:function(a){this._targetReached=!0},_frameUpdate:function(a){var b=this._isIdle()?this.idleFrameWorkerBudget:this.animatingFrameTimeBudget;this._budget.reset(b-a.spendInFrame);this._view.navigation&&this._view.navigation.step(a.deltaTime);
this._view.inputManager&&this._view.inputManager._pinchNavigation&&this._view.inputManager._pinchNavigation.momentum.doFrameUpdate(a.deltaTime);this._frameWorker&&(this._frameWorker(this._budget),this.stats.frameUpdateTime.addSample(this._budget.elapsed()));this._isIdle()&&(this._idleUpdatesStartFired||(this._callWorkersNoScheduling("idleBegin"),this._idleUpdatesStartFired=!0),this._budget.reset(this.idleFrameTimeBudget-this._budget.elapsed()),3<this._budget.remaining()&&(this._callWorkersStrictScheduling("idleFrame",
this._budget),this.stats.idleUpdateTime.addSample(this._budget.elapsed())))},_isIdle:function(){return this._budget.now()-this._lastTargetChangeTime>this.navigationTimeout&&this._targetReached},_callWorkersNoScheduling:function(a){for(var b=this._idleFrameWorkers,d=0;d<b.length;d++){var f=b[d];f.callbacks[a]&&f.callbacks[a].call(f.client)}},_callWorkersStrictScheduling:function(a,b){var d=this._idleFrameWorkers,f=d.length,k,c,m;x.clear();c=0;for(m=this._idleFrameWorkerRobin;c<f;c++)k=d[m++%f],k.callbacks.needsUpdate&&
k.callbacks.needsUpdate.call(k.client)&&(0===x.length&&(this._idleFrameWorkerRobin=m),x.push(k));k=b.now();for(d=k+b.remaining();0<x.length&&k<d;)b.reset((d-k)/x.length),k=x.pop(),k.callbacks[a].call(k.client,b),k=b.now()}});w.ClientType=p;var z=function(){this.addSample=function(a){this.min=Math.min(this.min,a);this.max=Math.max(this.max,a);this.total+=a;this.numSamples++};this.getAverage=function(){return this.total/this.numSamples};this.reset=function(){this.numSamples=this.total=0;this.min=Number.MAX_VALUE;
this.max=-Number.MAX_VALUE};this.reset()};return w})},"esri/views/3d/support/StreamDataSupplier":function(){define(["require","exports"],function(w,l){return function(){function f(a,d,b){this._clientType=a;this._loader=d;this._activeRequests=null;this._addUrlToken=b&&b.addUrlToken;b&&b.trackRequests&&(this._activeRequests=new Map)}f.prototype.request=function(a,d,b){var f=this;d=this._loader.request(a,d,this._clientType,b,this._addUrlToken);this._activeRequests&&(this._activeRequests.set(a,d),b=function(){f._activeRequests.delete(a)},
d.then(b,b));return d};f.prototype.isRequested=function(a){return this._loader.isRequested(a)};f.prototype.cancelRequest=function(a){this._loader.cancel(a)};f.prototype.cancelAll=function(){var a=this;this._activeRequests&&(this._activeRequests.forEach(function(d){a._loader.cancel(d)}),this._activeRequests.clear())};f.prototype.hasPendingDownloads=function(){return this._loader.hasPendingDownloads()};return f}()})},"esri/views/3d/support/StreamDataLoader":function(){define("../../../core/declare ../../../request ../../../core/urlUtils ./PromiseLightweight ./AsyncQuotaRoundRobinQueue ../webgl-engine/lib/Util".split(" "),
function(w,l,f,a,d,b){var q=b.assert,t={QUEUED:1,DOWNLOADING:2,CANCELLED:4};w=w(null,{constructor:function(a){this.alreadyLoading={};this.loadQueue=new d(k,this._doneLoadingCallback,this,a);this._urlInfo={hasSameOrigin:{},canUseXhr:{}}},destroy:function(){for(var a in this.alreadyLoading){for(var b=this.alreadyLoading[a],d=0;d<b.clientPromises.length;d++){var f=b.clientPromises[d];f.isRejected()||f.reject(b.url.url,null,b.docType,b.clientMetadata[d])}this._cancelTask(b)}this.loadQueue.clear();this.alreadyLoading=
this.loadQueue=null},request:function(b,d,f,k,m){k=k||{};var p=new a.Promise(function(){this.cancel(p)}.bind(this));p.requestURL=b;var q=this.alreadyLoading[b];q?(q.clientPromises.push(p),q.clientMetadata.push(k.metadata)):(q={url:{url:null,normalized:null,normalizedWithToken:null,hasSameOrigin:!1,canUseXhr:!1},docType:d,clientType:f,status:t.QUEUED,clientMetadata:[k.metadata],clientPromises:[p],downloadObj:null,_cancelledInQueue:!1},this._prepareUrl(q,b,m),this.alreadyLoading[b]=q,this.loadQueue.push(q));
return p},isRequested:function(a){return void 0!==this.alreadyLoading[a]},cancel:function(a){var b=this.alreadyLoading[a.requestURL];b&&this._removeRequestPromiseFromTask(b,a)},hasPendingDownloads:function(){return!b.objectEmpty(this.alreadyLoading)},_prepareUrl:function(a,b,d){a.url.url=b;a.url.isData=f.isDataProtocol(b);if(a.url.isData||"image"!==a.docType)a.url.normalized=b,!a.url.isData&&d&&(a.url.normalizedWithToken=d(b));else{b=f.normalize(b);a.url.normalized=b;var k=f.getOrigin(b);d&&(a.url.normalizedWithToken=
d(b));b=this._urlInfo.hasSameOrigin[k];void 0!==b?a.url.hasSameOrigin=b:(a.url.hasSameOrigin=f.hasSameOrigin(k,window.location.href),this._urlInfo.hasSameOrigin[k]=a.url.hasSameOrigin);a.url.hasSameOrigin||(b=this._urlInfo.canUseXhr[k],void 0!==b?a.url.canUseXhr=b:(a.url.canUseXhr=f.canUseXhr(k),this._urlInfo.canUseXhr[k]=a.url.canUseXhr))}},_removeRequestPromiseFromTask:function(a,b){var d=a.clientPromises.length;1<d?(b=a.clientPromises.indexOf(b),q(-1<b,"request to be cancelled is already cancelled or invalid"),
a.clientPromises[b]=a.clientPromises[d-1],a.clientPromises.pop(),a.clientMetadata[b]=a.clientMetadata[d-1],a.clientMetadata.pop()):(q(a.clientPromises[0]===b,"request to be cancelled is already cancelled or invalid"),this._cancelTask(a))},_cancelTask:function(a){if(a.status===t.DOWNLOADING){this.loadQueue.workerCancelled(a);if("image"===a.docType&&a.url.isData){var b=a.downloadObj;b.removeAttribute("onload");b.removeAttribute("onerror");b.removeAttribute("src")}else a.status=t.CANCELLED,a.downloadObj.cancel();
a.downloadObj=null}a.status=t.CANCELLED;a.clientPromises=void 0;a.clientMetadata=void 0;delete this.alreadyLoading[a.url.url]},_doneLoadingCallback:function(a,b){var d;q(a.status===t.DOWNLOADING);delete this.alreadyLoading[a.url.url];if(b)for(d=0;d<a.clientPromises.length;d++)a.clientPromises[d].isRejected()||a.clientPromises[d].reject(a.url.url,b,a.docType,a.clientMetadata[d]);else for(d=0;d<a.clientPromises.length;d++)a.clientPromises[d].done(a.url.url,a.result,a.docType,a.clientMetadata[d])}});
var m=function(a,b,d){a.onload=function(){b.status!==t.CANCELLED&&(b.result=a,a.removeAttribute("onload"),a.removeAttribute("onerror"),d(b))};a.onerror=function(){b.status!==t.CANCELLED&&(a.removeAttribute("onload"),a.removeAttribute("onerror"),d(b,{status:404}))}},k=function(a,d){if(a.status===t.CANCELLED)return!1;a.status=t.DOWNLOADING;if("image"===a.docType&&a.url.isData){var f=new Image;m(f,a,d);f.src=a.url.normalized;a.downloadObj=f;return!0}var k;switch(a.docType){case "binary":k="array-buffer";
f=0;break;case "image":k="image";break;default:k="json"}a.downloadObj=l(a.url.normalizedWithToken||a.url.normalized,{responseType:k,timeout:f,failOk:!0,crossOrigin:!a.url.hasSameOrigin||a.url.canUseXhr,allowImageDataAccess:"image"===a.docType});a.downloadObj.then(function(f){a.duration=b.performance.now()-a.startTime;a.size=0;a.result=f.data;d(a)},function(b){a.downloadObj.isCanceled()||d(a,b)});return!0};w.TaskStatus=t;return w})},"esri/views/3d/support/PromiseLightweight":function(){(function(w){function l(a){this._callbacks=
[];this._errbacks=[];this._cancelCallback=a;this._iserr=this._isdone=this._iscancelled=!1}function f(a,b){var d=new l;0===a.length?d.done.apply(d,b):a[0].apply(null,b).then(function(){a.splice(0,1);f(a,arguments).then(function(){d.done.apply(d,arguments)})});return d}l.prototype.cancel=function(a){this._callbacks=[];this._errbacks=[];this._iscancelled=!0;this._cancelCallback&&this._cancelCallback(a)};l.prototype.then=function(a,b,f){var d;if(!this._iscancelled)return this._isdone?d=a.apply(f,this.result):
this._iserr&&b?d=b.apply(f,this.result):(this._callbacks.push(function(){return a.apply(f,arguments)}),b&&this._errbacks.push(function(){return b.apply(f,arguments)})),d};l.prototype.done=function(){this.result=arguments;this._isdone=!0;for(var a=0;a<this._callbacks.length;a++)this._callbacks[a].apply(null,arguments);this._callbacks=[];this._errbacks=[]};l.prototype.resolve=l.prototype.done;l.prototype.reject=function(){if(!this._iscancelled){this.result=arguments;this._iserr=!0;for(var a=0;a<this._errbacks.length;a++)this._errbacks[a].apply(null,
arguments);this._callbacks=[];this._errbacks=[]}};l.prototype.isRejected=function(){return this._iserr};l.prototype.isFulfilled=function(){return this._isdone||this._iserr};l.prototype.isResolved=function(){return this._isdone};l.prototype.isCancelled=function(){return this._iscancelled};var a={Promise:l,join:function(a){function b(a,b){return function(){b&&(p=!0);m+=1;k[a]=Array.prototype.slice.call(arguments);m===f&&(p?d.reject():d.done(k))}}for(var d=new l,f=a.length,m=0,k=[],p=!1,x=0;x<f;x++)a[x].then(b(x,
!1),b(x,!0));0===a.length&&d.done();return d},chain:f};"function"===typeof define&&define.amd?define(function(){return a}):w.promise=a})(this)},"esri/views/3d/support/AsyncQuotaRoundRobinQueue":function(){define(["../../../core/arrayUtils","../webgl-engine/lib/Util"],function(w,l){return function(f,a,d,b,q){function t(){return"workers: "+x+", queues: "+p.map(function(a){return a.length})}var m=0,k={},p=[],x=[],z=[],v=[],r=0,u=0,C;for(C in b)p[m]=[],x[m]=0,v[m]={requests:0,size:0,duration:0,speed:0},
z[m]=b[C],k[C]=m++,u+=b[C];var E=p.length,m=0;this.setWorkerQuota=function(a){l.assert(w.equals(Object.keys(this.typeWorkerAllication),Object.keys(a)));this.typeWorkerAllication=a;u=0;for(var b in a)z[k[b]]=a[b],u+=a[b]};this.setWorkerFunc=function(a){f=a};this.push=function(a){var b=k[a.clientType];r<u?(x[b]++,r++,q&&console.log("queue start type "+b+", "+t()),f(a,B)):(p[b].push(a),q&&console.log("queue push type "+b+", "+t()))};this._getStatsForType=function(a){a=k[a];return{quota:z[a],workers:x[a],
queueSize:p[a].length,requestStats:v[a]}};this.removeTasks=function(a,b){for(var c=[],d=p[k[b]],f=0;f<d.length;f++){var m=d[f];-1<a.indexOf(m)||c.push(m)}p[k[b]]=c};this.workerCancelled=function(a){c(a);a._cancelledInQueue=!0};this.clear=function(){for(var a=0;a<p.length;a++)p[a]=[]};var c=function(a){var b=k[a.clientType];x[b]--;r--;v[b].requests++;v[b].size+=a.size||0;v[b].duration+=a.duration||0;v[b].speed=0<v[b].duration?v[b].size/v[b].duration:0;l.assert(0<=x[b]);a=m;b=!1;do x[a]<z[a]&&D(a)&&
(b=!0),a=(a+1)%E;while(!b&&a!=m);if(!b){do D(a)&&(b=!0),a=(a+1)%E;while(!b&&a!=m)}!b&&q&&console.log("queue sink, "+t());m=a},D=function(a){for(;0<p[a].length;){if(f(p[a].shift(),B))return q&&console.log("queue startqueued clientType "+a+", "+t()),x[a]++,r++,!0;q&&console.log("queue task cancelled, "+t())}return!1},B=function(b){b._cancelledInQueue||(a.apply(d,arguments),c(b))}}})},"esri/views/3d/support/PreallocArray":function(){define(["../../../core/declare","./HeapSort"],function(w,l){return w([],
{constructor:function(f,a){this.data=Array(f);this.length=0;if(a){for(var d=0;d<f;d++)this.data[d]=a(d);this._allocator=a;this._hasAllocator=!0}else this._allocator=this._nullAllocator,this._hasAllocator=!1},_nullAllocator:function(){return null},grow:function(f){for(;this.data.length<f;)this.data.push(this._allocator(this.data.length))},next:function(){if(!this._hasAllocator)return null;this.data.length===this.length&&this.grow(2*this.length);return this.data[this.length++]},swap:function(f,a){var d=
this.data[f];this.data[f]=this.data[a];this.data[a]=d},push:function(f){this.data.length===this.length&&this.grow(2*this.length);this.data[this.length++]=f},pushArray:function(f){var a=this.length+f.length;a>=this.data.length&&this.grow(Math.max(2*this.length,a));for(a=0;a<f.length;a++)this.data[this.length++]=f[a]},pushEither:function(f){Array.isArray(f)?this.pushArray(f):this.push(f)},pop:function(){if(0===this.length)return null;var f=this.data[--this.length];this._hasAllocator||(this.data[this.length]=
null);return f},slice:function(f,a){void 0===a&&(a=this.length);return this.data.slice(f,a)},clear:function(){if(!this._hasAllocator)for(var f=0;f<this.length;f++)this.data[f]=null;this.length=0},peek:function(){return 0===this.length?null:this.data[this.length-1]},sort:function(f){l.sort(this.data,0,this.length,f);return this}})})},"esri/views/3d/support/HeapSort":function(){define([],function(){function w(f,a,d,b){for(var q=a,l=d>>>1,m=f[q-1];a<=l;){a=q<<1;a<d&&0>b(f[a-1],f[a])&&++a;var k=f[a-1];
if(0>=b(k,m))break;f[q-1]=k;q=a}f[q-1]=m}function l(f,a){return f<a?-1:f>a?1:0}return{sort:function(f,a,d,b){void 0===a&&(a=0);void 0===d&&(d=f.length);void 0===b&&(b=l);for(var q=d>>>1;q>a;q--)w(f,q,d,b);for(var t=a+1,q=d-1;q>a;q--)d=f[a],f[a]=f[q],f[q]=d,w(f,t,q,b);return f}}})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["require","exports","../../../core/sniff"],function(w,l,f){var a={low:{sceneService:{"3dObject":{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},
pointCloud:{lodFactor:.5}},tiledSurface:{lodBias:-1,angledSplitBias:.5},antialiasingEnabled:!1,gpuMemoryLimit:200},high:{sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1}},tiledSurface:{lodBias:0,angledSplitBias:1},antialiasingEnabled:!0,gpuMemoryLimit:500}};return function(){function d(){}d.isValidProfile=function(b){return b in a};d.getDefaultProfile=function(){return f("trident")||f("safari")||f("esri-mobile")?"low":"high"};d.apply=
function(b,d){b=a[b];d.qualitySettings.sceneService["3dObject"].lodFactor=b.sceneService["3dObject"].lodFactor;d.qualitySettings.sceneService.point.lodFactor=b.sceneService.point.lodFactor;d.qualitySettings.sceneService.integratedMesh.lodFactor=b.sceneService.integratedMesh.lodFactor;d.qualitySettings.sceneService.pointCloud.lodFactor=b.sceneService.pointCloud.lodFactor;d.qualitySettings.tiledSurface.lodBias=b.tiledSurface.lodBias;d.qualitySettings.tiledSurface.angledSplitBias=b.tiledSurface.angledSplitBias;
d.qualitySettings.antialiasingEnabled=b.antialiasingEnabled;d.qualitySettings.gpuMemoryLimit=b.gpuMemoryLimit};return d}()})},"esri/views/3d/support/QualitySettings":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/typescript ../../../core/Accessor".split(" "),function(w,l,f,a,d,b){var q=function(b){function k(){return null!==b&&b.apply(this,arguments)||this}f(k,b);a([d.property({value:1})],k.prototype,"lodFactor",
void 0);return k=a([d.subclass()],k)}(b),t=function(b){function k(){return null!==b&&b.apply(this,arguments)||this}f(k,b);k.prototype.getDefaults=function(){return{"3dObject":new q,point:new q,integratedMesh:new q,pointCloud:new q}};a([d.property()],k.prototype,"3dObject",void 0);a([d.property()],k.prototype,"point",void 0);a([d.property()],k.prototype,"integratedMesh",void 0);a([d.property()],k.prototype,"pointCloud",void 0);return k=a([d.subclass()],k)}(b),m=function(b){function k(){return null!==
b&&b.apply(this,arguments)||this}f(k,b);a([d.property({value:0})],k.prototype,"lodBias",void 0);a([d.property({value:1})],k.prototype,"angledSplitBias",void 0);return k=a([d.subclass()],k)}(b);return function(b){function k(){return null!==b&&b.apply(this,arguments)||this}f(k,b);k.prototype.getDefaults=function(){return{sceneService:new t,tiledSurface:new m,antialiasingEnabled:!0}};a([d.property()],k.prototype,"sceneService",void 0);a([d.property()],k.prototype,"tiledSurface",void 0);a([d.property()],
k.prototype,"antialiasingEnabled",void 0);a([d.property()],k.prototype,"gpuMemoryLimit",void 0);return k=a([d.subclass()],k)}(b)})},"esri/core/accessorSupport/typescript":function(){define(["../declare","../typescript","../JSONSupport","dojo/_base/lang"],function(w,l,f,a){function d(a,f){if(!a)return f;if(!f)return a;for(var b in f){var m=a[b],k=f[b];Array.isArray(k)&&Array.isArray(m)?a[b]=m.concat(k):a[b]="object"===typeof k&&"object"===typeof m?d(m,k):k}return a}return{subclass:function(b,q){return function(q){q=
l.declareDefinition(q,b);m&&(q.instanceMembers.properties=d(m,q.instanceMembers.properties));var m=q.instanceMembers.properties;if(m)for(var k in m){var p=m[k];p&&!p.reader&&p.type&&(p.type===Date?p.reader=function(a){return null!=a?new Date(a):null}:-1!==p.type._meta.bases.indexOf(f)&&(p.reader=function(a){return function(b){return a.fromJSON(b)}}(p.type)))}return a.mixin(w(q.bases,q.instanceMembers),q.classMembers)}},shared:l.shared,property:function(a){return function(b,d){var f=Object.getPrototypeOf(b),
f=f&&f.properties;b.properties&&b.properties!==f||(b.properties={});b.properties=b.properties||{};b.properties[d]=a||{}}}}})},"esri/core/typescript":function(){define(["./declare","dojo/_base/lang"],function(w,l){var f={declareDefinition:function(a,d){var b=[],f=Object.getPrototypeOf(a.prototype),l;if(f!==Object.prototype){var m=f.constructor;l=m.prototype;b.push(m)}d&&(b=b.concat(d));d={};for(var m=Object.getOwnPropertyNames(a.prototype),k=0;k<m.length;k++){var p=m[k];if("constructor"!==p){var x=
p;"dojoConstructor"===p&&(x="constructor");l&&a.prototype[p]===l[p]||(d[x]=a.prototype[p])}}m=Object.getOwnPropertyNames(a);f=Object.getOwnPropertyNames(f.constructor);l={};for(k=0;k<m.length;k++)p=m[k],-1===f.indexOf(p)&&(l[p]=a[p]);return{bases:b,instanceMembers:d,classMembers:l}},subclass:function(a){return function(d){d=f.declareDefinition(d,a);return l.mixin(w(d.bases,d.instanceMembers),d.classMembers)}},shared:function(a){return function(d,b){d[b]=a}}};return f})},"esri/views/3d/support/SharedSymbolResources":function(){define("require exports dojo/io-query ./TextureCollection ./ResourceController ../../../kernel ../../../core/watchUtils ../../../core/HandleRegistry ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),
function(w,l,f,a,d,b,q,t,m){Object.defineProperty(l,"__esModule",{value:!0});w=function(){function p(b){var f=this;this.streamDataSupplier=this.textures=null;this.tokens={};this.graphicsOwners=[];this.screenSizePerspectiveHandles=null;var k=d.ClientType.SYMBOLOGY;this.stage=b.stage;this.pointsOfInterest=b.pointsOfInterest;this.resourceController=b.resourceController;this.streamDataSupplier=this.resourceController.registerClient(this,k,{addUrlToken:function(a){return f.addUrlToken(a)}});this.textures=
new a(this.streamDataSupplier,b.stage,{preMultiplyAlpha:!0,wrapClamp:!0});this.screenSizePerspectiveSettings=m.getSettings(b.viewingMode);this.screenSizePerspectiveSettingsLabels=m.getLabelSettings(b.viewingMode)}p.prototype.destroy=function(){this.resourceController.deregisterClient(this);this.streamDataSupplier=this.textures=null};p.prototype.addGraphicsOwner=function(a){var b=this;this.graphicsOwners.push(a);var d=null;a.layerView&&(d=q.init(a.layerView,"layer.screenSizePerspectiveEnabled",function(){return b.updateScreenSizePerspectiveEnabled()}));
return{remove:function(){d&&(d.remove(),d=null,b.updateScreenSizePerspectiveEnabled())}}};p.prototype.updateScreenSizePerspectiveEnabled=function(){var a=this,b=this.graphicsOwners.some(function(a){return a.layerView&&!0===a.layerView.get("layer.screenSizePerspectiveEnabled")});b&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new t,b=function(){return a.updateScreenSizePerspectiveSettings()},this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",
b,!0),this.pointsOfInterest.events.on("camera-parameters-changed",b)]),this.updateScreenSizePerspectiveSettings()):!b&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};p.prototype.updateScreenSizePerspectiveSettings=function(){var a=this.pointsOfInterest;k.distance=a.centerOnSurfaceInfrequent.distance;k.fovY=a.camera.fovY;this.screenSizePerspectiveSettings.update(k);this.screenSizePerspectiveSettingsLabels.update(k);this.stage.setNeedsRender()};
p.prototype.addUrlToken=function(a){if(0===a.indexOf("data:"))return a;var d=a.match(/^(((?:https?:)?\/\/[^\/]+).*?)(?:\?(.*))?$/);if(!d)return a;var k=d[1],m=d[2],d=f.queryToObject(d[3]||"");"token"in d||(null==this.tokens[m]&&(a=b.id&&b.id.findCredential(a),this.tokens[m]=a&&a.token||""),this.tokens[m]&&(d.token=this.tokens[m]));return(m=f.objectToQuery(d))?k+"?"+m:k};return p}();l.SharedSymbolResources=w;var k={distance:0,fovY:0};l.default=w})},"esri/views/3d/support/TextureCollection":function(){define("../../../core/declare ../../../core/urlUtils dojo/Deferred dojo/_base/lang ../webgl-engine/Stage ../webgl-engine/lib/Texture ../webgl-engine/lib/Util".split(" "),
function(w,l,f,a,d,b,q){var t=q.assert;return w(null,{constructor:function(a,b,d){this._streamDataSupplier=a;this._stage=b;this._textureRecords={};this._loadedHandler=this._loadedHandler.bind(this);this._errorHandler=this._errorHandler.bind(this);this._textureOptions=d||{}},acquire:function(a,b,p){var k;if(k=this._textureRecords[a])return k.referenceCount++,k.texture||k.clientDfd;if(b)return p=b(a),this._stage.add(d.ModelContentType.TEXTURE,p),k={texture:p,referenceCount:1},this._textureRecords[a]=
k,p;k=new f;b=this._streamDataSupplier.request(a,"image");this._textureRecords[a]={clientDfd:k,loaderDfd:b,texture:null,size:Math.ceil(p||0),referenceCount:1};b.then(this._loadedHandler,this._errorHandler);return k.promise},release:function(a){var b=this._textureRecords[a];b?(1>b.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),b.referenceCount--,1>b.referenceCount&&(b.texture?(this._stage.remove(d.ModelContentType.TEXTURE,b.texture.getId()),b.texture=null):this._streamDataSupplier.cancelRequest(b.loaderDfd),
delete this._textureRecords[a])):console.warn("TextureCollection: texture doesn't exist: "+a)},isInUse:function(a){a=this._textureRecords[a];t(!a||0<a.referenceCount,"texture record with zero reference count");return!!a},_loadedHandler:function(f,k,p){p=this._textureRecords[f];t(p&&!p.texture);if(l.isSVG(f)&&(p.size||0===k.width&&0===k.height)){f=k.width?k.height/k.width:1;var m=p.size||64;1<f?(k.width=Math.round(m/f),k.height=m):(k.width=m,k.height=Math.round(m*f))}f=a.mixin({width:k.width,height:k.height},
this._textureOptions);k=new b(k,"symbol",f);this._stage.add(d.ModelContentType.TEXTURE,k);p.texture=k;p.clientDfd.resolve(k)},_errorHandler:function(a){a=this._textureRecords[a];t(a&&!a.texture);a.clientDfd.reject()}})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../core/HandleRegistry ../../../../core/Accessor ../../../../geometry/Point ../../lib/glMatrix ../Evented ./CenterOnSurface ./ViewState ./PropertiesPool ./disposeMembers ./SurfaceGeometryUpdates ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Selector".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C){Object.defineProperty(l,"__esModule",{value:!0});w=function(q){function l(a){a=q.call(this,a)||this;a.handles=new b;a.lastSeenCameraParameters=new u;a.surfaceAltitudeAtCenter=0;a.surfaceAltitudeAtCenterDirty=!0;a.surfaceAltitudeAtCenterWithContent=0;a.surfaceAltitudeAtCenterWithContentDirty=!0;a.propertiesPool=new z.default({pointOfView:t,renderPointOfView:Array},a);a.updateSurfaceAltitudeFrequentInterval=D;a.updateSurfaceAltitudeInfrequentInterval=B;a.events=
new k.Evented;a.renderPointOfView=[0,0,0];return a}f(l,q);l.prototype.normalizeCtorArgs=function(a){var b={viewState:new x.default({view:a.view}),surface:a.view.basemapTerrain,renderCoordsHelper:a.view.renderCoordsHelper,pickRay:a.view._stage.pickRay.bind(a.view._stage)};null!=a.updateSurfaceAltitudeFrequentInterval&&(b.updateSurfaceAltitudeFrequentInterval=a.updateSurfaceAltitudeFrequentInterval);null!=a.updateSurfaceAltitudeInfrequentInterval&&(b.updateSurfaceAltitudeInfrequentInterval=a.updateSurfaceAltitudeInfrequentInterval);
return b};l.prototype.initialize=function(){var a=this;this.surfaceSelector=new C(this.viewState.mode);this.surfaceSelector.enableBackfacesTerrain="global"===this.viewState.mode?!1:!0;this.surfaceSelector.enableInvisibleTerrain=!1;this.contentSelector=new C(this.viewState.mode);this.contentSelector.enableTerrain=!1;var b=this.viewState,c=this.surface,d=this.renderCoordsHelper,f=this.estimateSurfaceAltitudeAtCenter.bind(this);this._set("centerOnSurfaceInfrequent",new p.default({viewState:b,surface:c,
renderCoordsHelper:d,estimateSurfaceAltitudeAtCenter:f,altitudeEstimationInterval:this.updateSurfaceAltitudeInfrequentInterval}));this._set("centerOnSurfaceFrequent",new p.default({viewState:b,surface:c,renderCoordsHelper:d,estimateSurfaceAltitudeAtCenter:f,altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));this._set("centerOnContent",new p.default({viewState:b,surface:c,renderCoordsHelper:d,estimateSurfaceAltitudeAtCenter:this.estimateSurfaceAltitudeAtCenterWithContent.bind(this),
altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));this._set("surfaceGeometryUpdates",new r.default({viewState:b,surface:c,renderCoordsHelper:d,centerOnSurfaceInstances:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this.handles.add(this.viewState.watch("camera",function(b){return a.cameraChanged(b)},!0));this.handles.add(this.surfaceGeometryUpdates.events.on("request-update",function(){return a.updateCenterPointsOfInterest()}));this.handles.add(this.surface.watch("extent",
function(){return a.updateCenterPointsOfInterest()}));this.cameraChanged(this.viewState.camera);this.forceUpdate()};l.prototype.destroy=function(){v.default(this,"handles","viewState","centerOnSurfaceInfrequent","centerOnSurfaceFrequent","centerOnContent","propertiesPool")};Object.defineProperty(l.prototype,"pointOfView",{get:function(){var a=this.propertiesPool.get("pointOfView");this.renderCoordsHelper.fromRenderCoords(this.renderPointOfView,a,this.viewState.spatialReference);return a},enumerable:!0,
configurable:!0});l.prototype.forceUpdate=function(){this.surfaceGeometryUpdates.forceUpdate();this.centerOnSurfaceInfrequent.forceUpdate();this.centerOnSurfaceFrequent.forceUpdate();this.centerOnContent.forceUpdate()};l.prototype.hasPendingUpdates=function(){return this.surfaceGeometryUpdates.hasPendingUpdates()||this.centerOnContent.hasPendingUpdates()||this.centerOnSurfaceInfrequent.hasPendingUpdates()||this.centerOnSurfaceFrequent.hasPendingUpdates()};l.prototype.estimateSurfaceAltitudeAtCenterWithContent=
function(){if(!this.surfaceAltitudeAtCenterWithContentDirty)return this.surfaceAltitudeAtCenterWithContent;this.surfaceAltitudeAtCenterWithContentDirty=!1;var a=this.viewState.camera;this.pickRay(a.eye,a.center,null,null,null,!1,this.contentSelector);this.contentSelector.minResult.getIntersectionPoint(c)?this.surfaceAltitudeAtCenterWithContent=this.renderCoordsHelper.getAltitude(c):this.surfaceAltitudeAtCenterWithContent=this.estimateSurfaceAltitudeAtCenter();return this.surfaceAltitudeAtCenterWithContent};
l.prototype.estimateSurfaceAltitudeAtCenter=function(){if(!this.surface)return 0;if(!this.surfaceAltitudeAtCenterDirty)return this.surfaceAltitudeAtCenter;this.surfaceAltitudeAtCenterDirty=!1;var a=this.viewState.camera;this.surfaceSelector.init(null,a.eye,a.center,null,a,null,!1);this.surface.intersect(this.surfaceSelector,a.eye,a.center);this.surfaceSelector.minResult.getIntersectionPoint(c)&&(this.surfaceAltitudeAtCenter=this.renderCoordsHelper.getAltitude(c));return this.surfaceAltitudeAtCenter};
l.prototype.cameraChanged=function(a){this.updateCenterPointsOfInterest(a);this.cameraParametersChanged(this.lastSeenCameraParameters,a)&&(this.lastSeenCameraParameters.copyFrom(a),E.camera=a,this.events.emit("camera-parameters-changed",E));a=a.eye;this.renderPointOfView[0]===a[0]&&this.renderPointOfView[1]===a[1]&&this.renderPointOfView[2]===a[2]||this._set("renderPointOfView",m.vec3d.set(a,this.propertiesPool.get("renderPointOfView")))};l.prototype.updateCenterPointsOfInterest=function(a){void 0===
a&&(a=this.viewState.camera);this.surfaceAltitudeAtCenterWithContentDirty=this.surfaceAltitudeAtCenterDirty=!0;this.centerOnSurfaceFrequent.update(a);this.centerOnSurfaceInfrequent.update(a);this.centerOnContent.update(a)};l.prototype.cameraParametersChanged=function(a,b){return a.fov!==b.fov||a.fullViewport[0]!==b.fullViewport[0]||a.fullViewport[1]!==b.fullViewport[1]||a.fullViewport[2]!==b.fullViewport[2]||a.fullViewport[3]!==b.fullViewport[3]||a.padding[0]!==b.padding[0]||a.padding[1]!==b.padding[1]||
a.padding[2]!==b.padding[2]||a.padding[3]!==b.padding[3]?!0:!1};a([d.property({constructOnly:!0})],l.prototype,"updateSurfaceAltitudeFrequentInterval",void 0);a([d.property({constructOnly:!0})],l.prototype,"updateSurfaceAltitudeInfrequentInterval",void 0);a([d.property({readOnly:!0,aliasOf:"viewState.camera"})],l.prototype,"camera",void 0);a([d.property({readOnly:!0})],l.prototype,"centerOnContent",void 0);a([d.property({readOnly:!0})],l.prototype,"centerOnSurfaceFrequent",void 0);a([d.property({readOnly:!0})],
l.prototype,"centerOnSurfaceInfrequent",void 0);a([d.property({readOnly:!0})],l.prototype,"events",void 0);a([d.property({readOnly:!0,dependsOn:["renderPointOfView"]})],l.prototype,"pointOfView",null);a([d.property({constructOnly:!0})],l.prototype,"renderCoordsHelper",void 0);a([d.property({readOnly:!0})],l.prototype,"renderPointOfView",void 0);a([d.property({constructOnly:!0})],l.prototype,"surface",void 0);a([d.property({readOnly:!0})],l.prototype,"surfaceGeometryUpdates",void 0);a([d.property({constructOnly:!0})],
l.prototype,"viewState",void 0);a([d.property({constructOnly:!0})],l.prototype,"pickRay",void 0);return l=a([d.subclass("esri.views.3d.support.PointsOfInterest")],l)}(d.declared(q));l.PointsOfInterest=w;var E={camera:null},c=m.vec3d.create(),D=200,B=3E3;l.default=w})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../core/throttle ../../../../geometry/Point ../../lib/glMatrix ../earthUtils ../mathUtils ./PointOfInterest ./PropertiesPool".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x){Object.defineProperty(l,"__esModule",{value:!0});w=function(p){function r(a){a=p.call(this,a)||this;a.propertiesPool=new x.default({location:q,renderLocation:Array},a);a.currentSurfaceAltitude=0;a.latestSurfaceAltitude=0;a.distance=0;a.renderLocation=[0,0,0];return a}f(r,p);l=r;r.prototype.initialize=function(){this.measureSurfaceAltitudeThrottle=b.throttle(this.measureSurfaceAltitude,this.altitudeEstimationInterval,this);this.handles.add(this.measureSurfaceAltitudeThrottle);
this.measureSurfaceAltitude()};Object.defineProperty(r.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.viewState.spatialReference);return a},enumerable:!0,configurable:!0});r.prototype.update=function(a){this.measureSurfaceAltitudeThrottle();this.updateCenterOnSurface()};r.prototype.forceUpdate=function(){this.measureSurfaceAltitudeThrottle.forceUpdate();this.updateCenterOnSurface()};r.prototype.hasPendingUpdates=
function(){return this.measureSurfaceAltitudeThrottle.hasPendingUpdates()};Object.defineProperty(r.prototype,"estimatedSurfaceAltitude",{get:function(){return this.latestSurfaceAltitude},enumerable:!0,configurable:!0});r.prototype.measureSurfaceAltitude=function(){this.latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this.updateCenterOnSurface()};r.prototype.updateCenterOnSurface=function(){var a=z,b=this.calculateSurfaceIntersection(this.currentSurfaceAltitude,a),d=this.currentSurfaceAltitude!==
this.latestSurfaceAltitude;!b&&d&&(b=this.calculateSurfaceIntersection(this.latestSurfaceAltitude,a))&&(this.currentSurfaceAltitude=this.latestSurfaceAltitude);d=v;b&&this.latestSurfaceAltitudeChangesDistanceSignificantly(a,d)&&(t.vec3d.set(d,a),this.currentSurfaceAltitude=this.latestSurfaceAltitude);b?(b=t.vec3d.dist(this.viewState.camera.eye,a),b!==this._get("distance")&&this._set("distance",b)):(b=this.viewState.camera,t.vec3d.add(t.vec3d.scale(b.viewForward,this._get("distance"),a),b.eye));b=
this._get("renderLocation");b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]||this._set("renderLocation",t.vec3d.set(a,this.propertiesPool.get("renderLocation")))};r.prototype.calculateSurfaceIntersection=function(a,b){var c=this.viewState.camera;if(!this.renderCoordsHelper.intersectManifold(c.eye,c.viewForward,a,b))return!1;if(this.viewState.isGlobal){a=m.earthRadius+a;var d=t.vec3d.length2(c.eye),f=d<a*a,p=t.vec3d.dist(c.eye,b);f&&p>m.earthRadius/4&&t.vec3d.add(t.vec3d.scale(c.viewForward,a-Math.sqrt(d),b),
c.eye)}else if(c=this.surface.ready&&this.surface.extent)b[0]=k.clamp(b[0],c[0],c[2]),b[1]=k.clamp(b[1],c[1],c[3]);return!0};r.prototype.latestSurfaceAltitudeChangesDistanceSignificantly=function(a,b){if(this.latestSurfaceAltitude===this.currentSurfaceAltitude||null==a)return!1;if(this.calculateSurfaceIntersection(this.latestSurfaceAltitude,b)){var c=this.viewState.camera.eye;a=t.vec3d.dist(c,a);b=t.vec3d.dist(c,b);if(Math.abs(b-a)/a>l.RELATIVE_ALTITUDE_CHANGE_THRESHOLD)return!0}return!1};r.RELATIVE_ALTITUDE_CHANGE_THRESHOLD=
.05;a([d.property({constructOnly:!0})],r.prototype,"altitudeEstimationInterval",void 0);a([d.property({readOnly:!0})],r.prototype,"distance",void 0);a([d.property({constructOnly:!0})],r.prototype,"estimateSurfaceAltitudeAtCenter",void 0);a([d.property({readOnly:!0,dependsOn:["renderLocation"]})],r.prototype,"location",null);a([d.property({readOnly:!0})],r.prototype,"renderLocation",void 0);return r=l=a([d.subclass("esri.views.3d.support.CenterOnSurface")],r);var l}(d.declared(p.PointOfInterest));
l.CenterOnSurface=w;var z=t.vec3d.create(),v=t.vec3d.create();l.default=w})},"esri/core/throttle":function(){define(["require","exports"],function(w,l){function f(a,d,b,f){var q=null,m=1E3;"number"===typeof d?(m=d,f=b):(q=d,m=b);var k=0,p,l=function(){k=0;a.apply(f,p)};d=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];q&&q.apply(f,a);p=a;m?k||(k=setTimeout(l,m)):l()};d.remove=function(){k&&(clearTimeout(k),k=0)};d.forceUpdate=function(){k&&(clearTimeout(k),l())};d.hasPendingUpdates=
function(){return!!k};return d}Object.defineProperty(l,"__esModule",{value:!0});l.throttle=f;l.default=f})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../core/HandleRegistry ../../../../core/Accessor ./disposeMembers".split(" "),function(w,l,f,a,d,b,q,t){Object.defineProperty(l,"__esModule",{value:!0});w=function(m){function k(a){a=
m.call(this)||this;a.handles=new b;return a}f(k,m);k.prototype.destroy=function(){t.default(this,"handles")};a([d.property({constructOnly:!0})],k.prototype,"renderCoordsHelper",void 0);a([d.property({constructOnly:!0})],k.prototype,"surface",void 0);a([d.property({constructOnly:!0})],k.prototype,"viewState",void 0);return k=a([d.subclass("esri.views.3d.support.PointOfInterest")],k)}(d.declared(q));l.PointOfInterest=w;l.default=w})},"esri/views/3d/support/pointsOfInterest/disposeMembers":function(){define(["require",
"exports","../../../../core/Accessor"],function(w,l,f){function a(a){for(var b=[],d=1;d<arguments.length;d++)b[d-1]=arguments[d];if(a instanceof f&&a.destroyed)try{throw Error("instance is already destroyed");}catch(k){console.warn(k.stack)}else for(d=0;d<b.length;d++){var l=b[d];if(!(l in a))throw Error("Property '"+l+"' does not exist and cannot be disposed");var m=a[l];m&&("function"===typeof m.destroy?m.destroy():"function"===typeof m.dispose?m.dispose():"function"===typeof m.remove&&m.remove());
a instanceof f&&l in a.__accessor__.metadatas?a._set(l,null):a[l]=null}}Object.defineProperty(l,"__esModule",{value:!0});l.disposeMembers=a;l.default=a})},"esri/views/3d/support/pointsOfInterest/PropertiesPool":function(){define(["require","exports","../../../../core/ObjectPool","../../../../core/Scheduler","./disposeMembers"],function(w,l,f,a,d){Object.defineProperty(l,"__esModule",{value:!0});w=function(){function b(a,b){this.owner=b;this.properties={};this.scheduleHandle=null;for(var d in a)b=
new f(a[d],null,null,2,2),this.properties[d]={pool:b,acquired:[]}}b.prototype.destroy=function(){d.default(this,"scheduleHandle");this.owner=null};b.prototype.get=function(b){var d=this,f=this.owner._get(b);b=this.properties[b];var k=b.pool.acquire();for(b.acquired.push(k);k===f;)b.acquired.push(k),k=b.pool.acquire();this.scheduleHandle||(this.scheduleHandle=a.schedule(function(){return d.release()}));return k};b.prototype.release=function(){this.scheduleHandle=null;for(var a in this.properties){for(var b=
this.properties[a],d=0,f=b.acquired;d<f.length;d++)b.pool.release(f[d]);b.acquired.length=0}};return b}();l.PropertiesPool=w;l.default=w})},"esri/views/3d/support/pointsOfInterest/ViewState":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../core/Accessor ./PropertiesPool ./disposeMembers ../../webgl-engine/lib/Camera".split(" "),function(w,l,f,a,d,b,q,t,m){Object.defineProperty(l,
"__esModule",{value:!0});w=function(b){function k(a){a=b.call(this,a)||this;a.propertiesPool=new q.default({camera:m},a);return a}f(k,b);k.prototype.normalizeCtorArgs=function(a){var b=this;this.cameraChangeHandle=a.view.navigation.on("currentViewChanged",function(a){return b.currentViewChangedHandler(a.camera)});this.camera=a.view.navigation.currentCamera.copy();return{mode:a.view.viewingMode,spatialReference:a.view.spatialReference}};k.prototype.initialize=function(){};k.prototype.destroy=function(){t.default(this,
"cameraChangeHandle","propertiesPool")};Object.defineProperty(k.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"isLocal",{get:function(){return"local"===this.mode},enumerable:!0,configurable:!0});k.prototype.currentViewChangedHandler=function(a){this.camera.equals(a)||(this.camera=this.propertiesPool.get("camera").copyFrom(a))};a([d.property()],k.prototype,"camera",void 0);a([d.property({dependsOn:["isLocal"]})],k.prototype,
"isGlobal",null);a([d.property({dependsOn:["mode"]})],k.prototype,"isLocal",null);a([d.property({constructOnly:!0})],k.prototype,"mode",void 0);a([d.property({constructOnly:!0})],k.prototype,"spatialReference",void 0);return k=a([d.subclass()],k)}(d.declared(b));l.ViewState=w;l.default=w})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("require exports ../../../../core/HandleRegistry ../../../../core/Scheduler ../../lib/glMatrix ../Evented ../aaBoundingRect".split(" "),
function(w,l,f,a,d,b,q){Object.defineProperty(l,"__esModule",{value:!0});w=function(){function d(a){var d=this;this.handles=new f;this.tileGeometryUpdateExtent=q.create(q.NEGATIVE_INFINITY);this.tileGeometryUpdateSpatialReference=null;this.hasPendingTileGeometryChanges=!0;this.events=new b.Evented;this.centerOnSurfaceInstances=a.centerOnSurfaceInstances;this.renderCoordsHelper=a.renderCoordsHelper;this.viewState=a.viewState;this.handles.add(a.surface.on("tile-geometry-change",function(a){return d.tileGeometryChangeHandler(a)}))}
d.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};d.prototype.forceUpdate=function(){this.handles.has("tile-geometry-update")&&this.updateCenterOnGeometryUpdate();this.hasPendingTileGeometryChanges&&(this.events.emit("request-update",t),this.hasPendingTileGeometryChanges=!1)};d.prototype.hasPendingUpdates=function(){return this.handles.has("tile-geometry-update")};d.prototype.tileGeometryChangeHandler=function(b){var d=this;this.tileGeometryUpdateSpatialReference=
b.spatialReference;q.expand(this.tileGeometryUpdateExtent,b.tile.extent);this.handles.has("tile-geometry-update")||this.handles.add(a.schedule(function(){return d.updateCenterOnGeometryUpdate()}),"tile-geometry-update")};d.prototype.updateCenterOnGeometryUpdate=function(){this.handles.remove("tile-geometry-update");this.centerIntersectsExtent(this.tileGeometryUpdateExtent,this.tileGeometryUpdateSpatialReference)&&(d.UPDATE_ON_SURFACE_GEOMETRY_CHANGES?this.events.emit("request-update",t):this.hasPendingTileGeometryChanges=
!0);q.set(this.tileGeometryUpdateExtent,q.NEGATIVE_INFINITY)};d.prototype.furthestCenterOnSurface=function(){for(var a=this.centerOnSurfaceInstances[0],b=1;b<this.centerOnSurfaceInstances.length;b++){var d=this.centerOnSurfaceInstances[b];d.distance>a.distance&&(a=d)}return a};d.prototype.centerIntersectsExtent=function(a,b){var d=this.viewState.camera.eye,f=p,l=this.furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(d,m,b);this.renderCoordsHelper.fromRenderCoords(l.renderLocation,
k,b);m[0]<k[0]?(f[0]=m[0],f[2]=k[0]):(f[0]=k[0],f[2]=m[0]);m[1]<k[1]?(f[1]=m[1],f[3]=k[1]):(f[1]=k[1],f[3]=m[1]);return q.intersects(f,a)};d.UPDATE_ON_SURFACE_GEOMETRY_CHANGES=!0;return d}();l.SurfaceGeometryUpdates=w;var t={},m=d.vec3d.create(),k=d.vec3d.create(),p=q.create(q.NEGATIVE_INFINITY);l.default=w})},"esri/views/3d/terrain/TerrainSurface":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/ObjectPool ../../../core/Logger ../../../core/watchUtils ../../../geometry/Point ../lib/glMatrix ../support/aaBoundingRect ../support/Evented ../support/mathUtils ../support/PreallocArray ../support/projectionUtils ../support/PromiseLightweight ../support/ResourceController ./OverlayManager ./PlanarTile ./SphericalTile ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainConst ./TerrainRenderer ./terrainUtils ./TileGeometryFactory ./TilemapOnlyTile ./tileUtils ./tileUtils".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c,D,B,I,G,H,K,J,P,O,L,M,R,Q){function T(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function A(a){return a&&("cancel"===a||"cancel"===a.dojoType)}function V(a){a.remove()}var S=z.vec3d,h=z.vec4d,e=z.mat4d,g=O.weakAssert,n=k.getLogger("esri.views.3d.terrain.TerrainSurface");w=function(b){function k(){var a=b.call(this)||this;a.defaultTileBackground=J.DEFAULT_TILE_BACKGROUND;a.hideSkirtsDistanceFromExtentMargin=y;a.hideSkirtsMinimumCameraTilt=F;a._clippingExtent=
null;a._dataExtent=null;a._elevationBounds=[0,0];a._rootExtent=[0,0,0,0];a._iteratorPool=new m(Q.IteratorPreorder);a._postorderIterator=new Q.IteratorPostorder;a.visible=!1;a.suspended=!1;a._pendingUpdates=!1;a._lvPendingUpdates=!1;a._updateNextFrame=0;a._vectorTileLayerRequests=0;a._curOverlayOpacity=1;a._curEyePos=S.create();a._curSplitLimits=[0,0,0,0,0,0];a._curFrustumPlanes=Array(6);a._viewProjectionMatrix=e.identity();a.tilemapStats={tilemapRequestsSent:0,tilemapRequestsPending:0,tilemapRequestErrors:0,
fullTilemaps:0,emptyTilemaps:0,tilesRequested:0,tileRequestsSent:0,tileRequestErrors:0,tilesNotPresent:0};a._layerViews=[[],[]];a._layerIndexByLayerViewId=[{},{}];a._basemapLayerViewHandles={};a._layerViewChangesHandle=null;a._viewChangeListenerHandles=[];a._frameUpdateLowerPrio=new C(500);a._topLevelTilemapOnlyTiles=Array(J.TILEMAP_SIZE_EXP+1);a.loaded=!1;a.maxTextureScale=1.2;a.rootTiles=null;for(var c=0;c<a._topLevelTilemapOnlyTiles.length;c++)a._topLevelTilemapOnlyTiles[c]=new M([c-J.TILEMAP_SIZE_EXP,
0,0]);for(c=0;6>c;c++)a._curFrustumPlanes[c]=h.create();return a}f(k,b);k.prototype.normalizeCtorArgs=function(a,b){this._view=a;this._stage=a._stage;this._set("manifold",b);return{}};k.prototype.initialize=function(){var a=this;this.tilePool="planar"===this.manifold?I.Pool:G.Pool;this._renderer=new P(this.manifold,null,this._view.pointsOfInterest);this._renderer.loaded=this._setLoaded.bind(this);this._renderer.updateTileBackground(this.tileBackground);this._renderer.install(this._view._stage);this._set("overlayManager",
new B({terrainSurface:this,view:this._view}));this.watch("overlayManager.hasHighlights",this._handleHasHighlights.bind(this));var b={layers:this._view.map.allLayers,layerViews:this._view.allLayerViews,spatialReference:this._view.spatialReference};this.extentHelper="spherical"===this.manifold?new H.SurfaceExtentHelperGlobal(b):new H.SurfaceExtentHelperLocal(b);p.init(this.extentHelper,"stencilEnabledExtents",function(b){a._renderer.setStencilEnabledLayerExtents(b)});b=this._view.defaultsFromMap?new t({root:this._view.map,
rootCollectionNames:this._view.defaultsFromMap.mapCollectionPaths,getChildrenFunction:function(a){return a.layers}}):this._view.map.allLayers;b=new K({layers:b,extentHelper:this.extentHelper,manifold:this.manifold,viewSpatialReference:this._view.spatialReference});this._set("tilingSchemeLogic",b);this.tilingSchemeLogic.watch("tilingScheme",this._updateTilingSchemeAndExtent.bind(this),!0);this.tilingSchemeLogic.watch("extent",this._updateTilingSchemeAndExtent.bind(this),!0);this._updateTilingSchemeAndExtent();
this._streamDataSupplier=this._view.resourceController.registerClient(this,D.ClientType.TERRAIN);b={needsUpdate:this._needsIdleUpdate,idleFrame:this._idleUpdate};this._view.resourceController.registerFrameWorker(this._frameUpdate.bind(this));this._view.resourceController.registerIdleFrameWorker(this,b);this._viewChangeUpdate=this._viewChangeUpdate.bind(this);this._viewChangeListenerHandles.push(this._view.on("resize",this._viewChangeUpdate));this._viewChangeListenerHandles.push(p.on(this._view,"navigation",
"currentViewChanged",this._viewChangeUpdate));this._viewChangeListenerHandles.push(this._view.watch("qualitySettings.tiledSurface.lodBias",this._viewChangeUpdate));this._layerViewChangesHandle=this._view.allLayerViews.on("change",this._handleLayerViewChanges.bind(this));this._handleLayerViewChanges({added:this._view.allLayerViews.toArray(),removed:[],moved:[]});this._clippingChangedHandle=this._view.watch("clippingArea",this._clippingChanged.bind(this));this._updateClippingExtent();this.notifyChange("extent")};
k.prototype.destroy=function(){this._removeAllTiles();this.tilingSchemeLogic.destroy();this._set("tilingSchemeLogic",null);this.extentHelper.destroy();this.extentHelper=null;for(var a in this._basemapLayerViewHandles)this._unregisterTiledLayerView(a);this._view.resourceController.deregisterFrameWorker();this._view.resourceController.deregisterIdleFrameWorker(this);this._view.resourceController.deregisterClient(this);this._viewChangeListenerHandles.forEach(V);this._layerViewChangesHandle.remove();
this._clippingChangedHandle.remove();this.overlayManager&&(this.overlayManager.destroy(),this._set("overlayManager",null));this._renderer.uninstall(this._stage);this._streamDataSupplier=this._stage=this._view=this._renderer=null};Object.defineProperty(k.prototype,"cullBackFaces",{set:function(a){this._renderer.setCullBackFaces(a);this._set("cullBackFaces",a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"extent",{get:function(){return this._clippingExtent||this._rootExtent},enumerable:!0,
configurable:!0});Object.defineProperty(k.prototype,"frontMostTransparent",{set:function(a){this._renderer.setFrontMostTransparent(a);this._set("frontMostTransparent",a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"opacity",{set:function(a){this._renderer.setOpacity(a);this._set("opacity",a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"ready",{get:function(){return!!this.rootTiles},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"renderOrder",
{set:function(a){this._renderer.setRenderOrder(a);this._set("renderOrder",a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"skirts",{set:function(a){this._renderer.setDrawSkirts(a);this._set("skirts",a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"tileBackground",{set:function(a){a!==this.tileBackground&&this._renderer.updateTileBackground(a);this._set("tileBackground",a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"velvetOverground",
{set:function(a){a!==this.velvetOverground&&this._renderer.setVelvetOverground(a);this._set("velvetOverground",a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"wireframe",{set:function(a){this._renderer.setWireframe(a);this._set("wireframe",a);this._view._stage.setRenderParams({earlyOcclusionPixelDraw:a})},enumerable:!0,configurable:!0});k.prototype.setVisibility=function(a){a!==this.visible&&(this.visible=a,this._renderer.setVisibility(a),this.setUpdatesDisabled(!a),a&&this._viewChangeUpdate())};
k.prototype.isVisible=function(){return this.visible&&this.ready};k.prototype.isSeeThrough=function(){return this._renderer.isTransparent()};k.prototype.setUpdatesDisabled=function(a){(this.suspended=a)||this._viewChangeUpdate()};k.prototype.intersect=function(a,b,c){this._renderer.intersect(a,b,c)};k.prototype.getElevation=function(a){if(!this.ready)return null;var b=J.LayerClass.ELEVATION,c=this.rootTiles,e=c[0].layerInfo[b].length;if(0===e)return null;da.length<e&&(da.length=e);if(a instanceof
x){if(!E.pointToVector(a,ca,this.tilingScheme.spatialReference))return n.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;a=ca}for(var d=0;d<c.length;d++){var f=c[d];if(R.isPosWithinTile(f,a)){do{d=f.layerInfo[b];for(c=0;c<e;c++)null!=d[c].data&&(aa[c]=d[c].data);c=0;a[0]>.5*(f.extent[0]+f.extent[2])&&(c+=1);a[1]<.5*(f.extent[1]+f.extent[3])&&(c+=2);f=f.children[c]}while(null!=f);break}}for(c=0;c<e;c++)da[c]=aa[c]?aa[c].samplerData:null;
b=L.elevationSampler(a[0],a[1],da);for(c=0;c<e;c++)da[c]=void 0;return b};k.prototype.getElevationBounds=function(){return this._elevationBounds};k.prototype.getScale=function(a){if(this.tilingScheme){if(!E.pointToVector(a,ca,this.spatialReference))return n.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;if(this.rootTiles)for(var b=0;b<this.rootTiles.length;b++)if(a=this.rootTiles[b],R.isPosWithinTile(a,ca)){for(;a.children[0];)b=0,ca[0]>
a.children[0].extent[2]&&(b+=1),ca[1]<a.children[0].extent[1]&&(b+=2),a=a.children[b];return this._getLodBiasCorrectedScale(a.lij[0])}}return 1E100};k.prototype.queryVisibleScaleRange=function(a,b,c,e){b=b?this.tilingScheme.levelAtScale(b):0;c=c?this.tilingScheme.levelAtScale(c):Infinity;var d=this._getLodBias();this._renderer.queryVisibleLevelRange(a,b+d,c+d,e)};k.prototype._setLoaded=function(){this.loaded||this._set("loaded",!0)};k.prototype._updateTilingSchemeAndExtent=function(){var a=this.tilingSchemeLogic.extent,
b=this.tilingSchemeLogic.tilingScheme,c=!1;a&&!v.equals(a,this._dataExtent)&&(c=!0,this._dataExtent?v.set(this._dataExtent,a):this._dataExtent=v.create(a));b!==this.tilingScheme&&(g(!!b,"tiling scheme cannot be reset to undefined"),c=!0,this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",b),this._updateClippingExtent(),b&&(this._updateTiledLayers(),this._renderer.setTileSize(b.pixelSize[0]),this.overlayManager.setSpatialReference(b.spatialReference,"spherical"===this.manifold)));c&&
this._updateRootTiles()};k.prototype._acquireTile=function(a,b,c,e){var d=this.tilePool.acquire();X[0]=a;X[1]=b;X[2]=c;d.init(X,e,this,this.tilingScheme);return d};k.prototype._releaseTile=function(a){a.dispose();a.parent=null;a.parentSurface=null;this.tilePool.release(a)};k.prototype._updateRootTiles=function(){var a=this,b=this._clippingExtent||this._dataExtent,c=this.tilingScheme;if(b&&c){var e=ca,d=c.rootTilesInExtent(b,e,Infinity);if(this.rootTiles){if(d.length>U){n.warn(J.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);
return}var b=this.rootTiles.map(function(a){return a.lij}),f=q.difference(b,d,T);if(0<f.removed.length||0<f.added.length){var g=this.rootTiles.filter(function(b){return-1<q.findIndex(f.removed,T.bind(null,b.lij))?(a._purgeChildTiles(b),a._purgeTile(b),!1):!0});f.added.forEach(function(b){b=a._acquireTile(0,b[1],b[2],null);g.push(b);a._loadTile(b)});this._set("rootTiles",g);this._renderer.setRootTiles(this.rootTiles)}}else d.length>U&&(n.warn(J.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),d=c.rootTilesInExtent(b,
e,U)),this._set("rootTiles",d.map(function(b){b=a._acquireTile(0,b[1],b[2],null);a._loadTile(b);return b})),this._renderer.setRootTiles(this.rootTiles);q.equals(e,this._rootExtent)||(this._rootExtent=h.create(e),this._hasFixedExtent()||this.notifyChange("extent"));this.setVisibility(!0);this._viewChangeUpdate();this.notifyChange("ready")}};k.prototype._viewChangeUpdate=function(){this._stage&&!this.suspended&&this.tilingScheme&&this.visible&&(this._updateViewDependentParameters(),this._updateOverlayOpacity(this._curEyePos),
this._updateTiles(this.rootTiles))};k.prototype._updateTiles=function(a){var b=this._iteratorPool.acquire();b.reset(a);var c=this._curSplitLimits,e=this._curFrustumPlanes,d=this._curEyePos,f;R.hasVisibleSiblings(a)?(a=this._elevationBounds[0],f=this._elevationBounds[1]):(a=Infinity,f=-Infinity);for(;!b.done;){var g=b.next();g.updateClippingStatus(this._clippingExtent);var h=!0;if(g.updateVisibility(e,d)){g.updateScreenDepth(this._viewProjectionMatrix);g.renderData&&(a=Math.min(g.elevationBounds[0],
a),f=Math.max(g.elevationBounds[1],f));var k=g.shouldSplit(c,d);k===W.SPLIT?(g.pendingUpdates&=~W.MERGE,g.renderData?(h=!1,g.pendingUpdates|=W.SPLIT,b.skip()):h=!1):(g.pendingUpdates&=~W.SPLIT,k===W.VSPLITMERGE&&g.updateAgents(J.LayerClass.ELEVATION),b.skip())}else b.skip();if(h&&!g.renderData){g.pendingUpdates|=W.MERGE;g.pendingUpdates&=~W.SPLIT;h=this._iteratorPool.acquire();for(h.reset(g);!h.done;)k=h.next(),k.updateVisibility(e,d),k.visible&&k.updateScreenDepth(this._viewProjectionMatrix);this._iteratorPool.release(h)}0!==
g.pendingUpdates&&(this._pendingUpdates=!0)}this._iteratorPool.release(b);isFinite(a)&&isFinite(f)&&(this._elevationBounds[0]!==a||this._elevationBounds[1]!==f)&&(this._elevationBounds[0]=a,this._elevationBounds[1]=f,this.emit("elevation-bounds-change",null))};k.prototype._updateViewDependentParameters=function(){var a=this._view.navigation.currentCamera,b=Math.tan(.5*a.fovX),c=Math.tan(.5*a.fovY),d=this.tilingScheme.pixelSize,f=Math.pow(2,-this._getLodBias());this._curSplitLimits[0]=b;this._curSplitLimits[1]=
d[0]/a.width*this.maxTextureScale*f;this._curSplitLimits[2]=c;this._curSplitLimits[3]=d[1]/a.height*this.maxTextureScale*f;this._curSplitLimits[4]=this.tilingScheme.getMaxLod();this._curSplitLimits[5]=this._view.qualitySettings.tiledSurface.angledSplitBias;a.copyFrustumPlanes(this._curFrustumPlanes);e.multiply(a.projectionMatrix,a.viewMatrix,this._viewProjectionMatrix);S.set(a.eye,this._curEyePos);O.autoUpdateSkirtsVisibility(this,this._curEyePos)};k.prototype._setLayerViewsUpdating=function(){for(var a=
0;a<J.LayerClass.LAYER_CLASS_COUNT;a++)for(var b=this._layerViews[a],c=0;c<b.length;c++)b[c]._evaluateUpdatingState(this._pendingUpdates)};k.prototype._frameUpdateTraversal=function(a){if(!this.suspended){this._frameUpdateLowerPrio.clear();var b=this._renderer.resourceCounter.numTileTexturesComposited,c=this._iteratorPool.acquire();c.reset(this.rootTiles);for(var e=!1,d=!1;!c.done&&(1<a.remaining()||!e)&&this._renderer.resourceCounter.numTileTexturesComposited-b<Y;){var f=c.next();f.pendingUpdates&
W.MERGE?(this._mergeTile(f),f.pendingUpdates&=~W.MERGE,e=!0,c.skip()):f.pendingUpdates&W.SPLIT?(this._splitTile(f),f.pendingUpdates&=~W.SPLIT,e=!0,c.skip()):0<f.pendingUpdates&&this._frameUpdateLowerPrio.push(f);0!==f.pendingUpdates&&(d=!0)}this._pendingUpdates=d||!c.done;this._iteratorPool.release(c);return e}};k.prototype._updateTileGeometry=function(a){this._renderer._updateTileGeometry(a);ea.spatialReference=this.spatialReference;ea.tile=a;this.emit("tile-geometry-change",ea)};k.prototype._updateTileTexture=
function(a){this._renderer.updateTileTexture(a)};k.prototype._frameUpdate=function(a){if(this.rootTiles){for(var b=this._frameUpdateTraversal(a);(1<a.remaining()||!b)&&0<this._frameUpdateLowerPrio.length;){var c=this._frameUpdateLowerPrio.pop();c.pendingUpdates&W.DECODE_ELEVATION?(this._decodeElevation(c),c.pendingUpdates&=~W.DECODE_ELEVATION,b=!0):c.pendingUpdates&W.UPDATE_GEOMETRY?(this._renderer.updateTileGeometryNeedsUpdate(c),this._updateTileGeometry(c),b=!0,c.pendingUpdates&=~W.UPDATE_GEOMETRY):
c.pendingUpdates&W.UPDATE_TEXTURE&&(this._updateTileTexture(c),c.pendingUpdates&=~W.UPDATE_TEXTURE,b=!0);0!==c.pendingUpdates&&(this._pendingUpdates=!0)}0<this._frameUpdateLowerPrio.length&&(this._pendingUpdates=!0);if(this._streamDataSupplier.hasPendingDownloads()||0!==this._vectorTileLayerRequests)this._pendingUpdates=!0;this._pendingUpdates===this._lvPendingUpdates||!this._pendingUpdates&&20!==++this._updateNextFrame||(this._setLayerViewsUpdating(),this._lvPendingUpdates=this._pendingUpdates,this._updateNextFrame=
0)}};k.prototype._needsIdleUpdate=function(){return this.isVisible()&&this.overlayManager&&this.overlayManager.overlaysNeedUpdate()};k.prototype._idleUpdate=function(){this.overlayManager.updateOverlay();this._updateOverlayOpacity(this._curEyePos)};k.prototype._updateClippingExtent=function(){if(!this.spatialReference)return!1;var a=[0,0,0,0],b=null;E.extentToBoundingRect(this._view.clippingArea,a,this.spatialReference)&&(b=a);if(q.equals(b,this._clippingExtent))return!1;this._clippingExtent=b;this._renderer.clippingExtent=
b;this.notifyChange("extent");return!0};k.prototype._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()};k.prototype._getLodBias=function(){return Math.round(this._view.qualitySettings.tiledSurface.lodBias)};k.prototype._getLodBiasCorrectedScale=function(a){var b=this.tilingScheme.levels;a=u.clamp(a-this._getLodBias(),0,b.length-1);return b[a].scale};k.prototype._cancelTilemapRequests=function(a){for(var b=0;b<J.LayerClass.LAYER_CLASS_COUNT;b++){var c=a.layerInfo[b];
if(c)for(var e=0;e<c.length;e++){var d=c[e];d.tilemapRequest&&(d.tilemapRequest.cancel(),d.tilemapRequest=null)}}};k.prototype._removeAllTiles=function(){var a=this;this.rootTiles&&(this.rootTiles.forEach(function(b){a._purgeChildTiles(b);a._purgeTile(b)}),this._set("rootTiles",null),this.notifyChange("ready"));for(var b=0;b<this._topLevelTilemapOnlyTiles.length;b++)this._cancelTilemapRequests(this._topLevelTilemapOnlyTiles[b]);this.setVisibility(!1)};k.prototype._purgeChildTiles=function(a){var b=
this._postorderIterator;for(b.reset(a);!b.done;){for(var c=b.next(),e=0;4>e;e++)c.children[e]=null;c!==a&&this._purgeTile(c)}};k.prototype._purgeTile=function(a){a.unload(this._renderer);this._cancelTilemapRequests(a);a.parent=null;this._releaseTile(a)};k.prototype._splitTile=function(a){var b=a.lij[0]+1,c=2*a.lij[1],e=2*a.lij[2];a.children[0]=this._createTile(b,c,e,a);a.children[1]=this._createTile(b,c,e+1,a);a.children[2]=this._createTile(b,c+1,e,a);a.children[3]=this._createTile(b,c+1,e+1,a);a.unload(this._renderer);
ba.spatialReference=this.spatialReference;ba.extent=a.extent;ba.scale=this._getLodBiasCorrectedScale(b);this.emit("scale-change",ba)};k.prototype._createTile=function(a,b,c,e){g(!!e,"_createTile sanity check");a=this._acquireTile(a,b,c,e);a.updateClippingStatus(this._clippingExtent);a.updateVisibility(this._curFrustumPlanes,this._curEyePos);a.visible&&(a.updateScreenDepth(this._viewProjectionMatrix),a.shouldSplit(this._curSplitLimits,this._curEyePos)===W.SPLIT&&(a.pendingUpdates|=W.SPLIT,this._pendingUpdates=
!0));this._loadTile(a);return a};k.prototype._mergeTile=function(a){g(!a.renderData,"_mergeTile sanity check");this._loadTile(a);this._purgeChildTiles(a);ba.spatialReference=this.spatialReference;ba.extent=a.extent;ba.scale=this._getLodBiasCorrectedScale(a.lij[0]);this.emit("scale-change",ba)};k.prototype._loadTile=function(a){a.load(this._renderer);this.overlayManager&&this.overlayManager.hasOverlays()&&this.overlayManager.setOverlayParamsOfTile(a,a.renderData,this._curOverlayOpacity);ea.tile=a;
ea.spatialReference=this.tilingScheme.spatialReference;this.emit("tile-geometry-change",ea)};k.prototype._handleHasHighlights=function(a){this._renderer.setNeedsHighlight(a)};k.prototype._decodeElevation=function(a){var b=J.LayerClass.ELEVATION,c=a.layerInfo[b];if(c)for(var e=0;e<c.length;e++){var d=c[e];d.pendingUpdates&=~W.DECODE_ELEVATION;if(d.rawData){var f=a.decodeElevationData(d.rawData);d.rawData=null;if(f){d.data=f;var d=a.lij[0],g=this._iteratorPool.acquire();for(g.reset(a);!g.done;){var h=
g.next();h.findElevationBoundsForLayer(e,d);h.computeElevationBounds()}this._iteratorPool.release(g);a.dataArrived(e,b,f);this._updateTiles(a);ia.spatialReference=this.spatialReference;ia.extent=a.extent;this._emitElevationChange(ia)}}}};k.prototype._handleLayerViewChanges=function(a){var b=this,c=!1;a.added.forEach(function(a){var e=a.layer;O.isTiledLayerView(a)?(b._registerTiledLayer(a),e.loaded&&(c=!0)):a.supportsDraping&&b.overlayManager&&b.overlayManager.registerLayerView(a)});a.removed.forEach(function(a){O.isTiledLayerView(a)?
(c=!0,b._unregisterTiledLayerView(a.uid)):a.supportsDraping&&b.overlayManager&&b.overlayManager.unregisterLayerView(a)});(c=c||0<a.moved.filter(O.isTiledLayerView).length)&&this._updateTiledLayers()};k.prototype._registerTiledLayer=function(a){var b=this,c=[];c.push(a.watch("suspended",function(){b._updateTiledLayers()}));c.push(a.watch("fullOpacity",function(){return b._updateTileTextures()}));a.on("data-changed",function(){var c=O.isElevationLayerView(a)?J.LayerClass.ELEVATION:J.LayerClass.MAP,
e=b._layerIndexByLayerViewId[c][a.uid];null!=e&&b._invalidateLayerData(e,c)});this._basemapLayerViewHandles[a.uid]=c};k.prototype._unregisterTiledLayerView=function(a){var b=this._basemapLayerViewHandles[a];if(b){for(var c=0;c<b.length;c++)b[c].remove();delete this._basemapLayerViewHandles[a]}};k.prototype._updateTiledLayers=function(){var a=this;if(this.tilingScheme){var b=this._view.allLayerViews,c=[[],[]],e=J.LayerClass,d=null,f=v.create(v.NEGATIVE_INFINITY);b.forEach(function(b){var g=b.layer;
if(b.layer&&b&&!b.suspended&&O.isTiledLayerView(b)){var h=b.fullExtent;h?a.tilingScheme.compatibleWith(b.tileInfo)?(v.expand(f,h),O.isElevationLayerView(b)?c[e.ELEVATION].push(b):(Infinity!==b.maxDataLevel&&(null===d||b.maxDataLevel>d)&&(d=b.maxDataLevel),c[e.MAP].push(b))):n.warn("Terrain: tiling scheme of layer "+g.id+" is incompatible with other tiled layers, will not be drawn"):n.warn("Terrain: Map or elevation layer does not have fullExtent: "+g.id)}},this);for(var b=function(a){var b=g._layerViews[a],
d=c[a];d.reverse();var f=b.length!==d.length,h=d.length,k=Array(h),m=Array(b.length);g._layerIndexByLayerViewId[a]={};for(var p=0;p<h;p++){g._layerIndexByLayerViewId[a][d[p].uid]=p;var n=b.indexOf(d[p]);k[p]=n;p!==n&&(f=!0);-1<n&&(m[n]=p)}if(f){g._topLevelTilemapOnlyTiles.forEach(function(b){return b.modifyLayers(m,k,a)});b=g._postorderIterator;if(g.rootTiles)for(b.reset(g.rootTiles);!b.done;)b.next().modifyLayers(m,k,a);g._layerViews[a]=d;if(g.rootTiles){for(b.reset(g.rootTiles);!b.done;)d=b.next(),
d.restartAgents(a),a===e.ELEVATION&&d.computeElevationBounds();g._updateTiles(g.rootTiles)}a===e.ELEVATION&&g.tilingScheme&&(ia.spatialReference=g.tilingScheme.spatialReference,ia.extent=N,g._emitElevationChange(ia))}},g=this,h=0;h<e.LAYER_CLASS_COUNT;h++)b(h);this.tilingScheme.levels.length-1<d&&(this.tilingScheme.ensureMaxLod(d),this._viewChangeUpdate())}};k.prototype._emitElevationChange=function(a){this.emit("elevation-change",a)};k.prototype._hasFixedExtent=function(){return!!this._clippingExtent};
k.prototype.layerViewByIndex=function(a,b){return this._layerViews[b][a]};k.prototype.numLayers=function(a){return this._layerViews[a].length};k.prototype.numTotalLayers=function(){return this._layerViews.reduce(function(a,b){return b.length+a},0)};k.prototype._updateTileTextures=function(){var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;)a.next().updateTexture();this._iteratorPool.release(a)};k.prototype._invalidateLayerData=function(a,b){var c=this._iteratorPool.acquire();
for(c.reset(this.rootTiles);!c.done;)c.next().removeLayerAgent(a,b);for(c.reset(this.rootTiles);!c.done;)c.next().invalidateLayerData(a,b);this._iteratorPool.release(c)};k.prototype.requestTileData=function(a,b,e){var d=this;this.tilemapStats.tilesRequested++;var f=this.layerViewByIndex(b,e),g=f.layer;if(g.tilemapCache){var h=this.getTilemapTile(a),k=h.layerInfo[e][b];if(k.tilemap){if(!h.tileDataAvailable(a,b,e))return this.tilemapStats.tilesNotPresent++,this._dispatchDataEvent(a,"dataMissing",e,
f,{notInTilemap:!0}),b=new c.Promise,b.reject(),b}else{k.tilemapRequest||(k.tilemapRequest=this.requestTilemap(h,b,e,f,g));var m,p=new c.Promise(function(){m&&m.cancel()});k.tilemapRequest.always(function(){k.tilemapRequest=null;if(!p.isCancelled()){var b=d._layerIndexByLayerViewId[e][f.uid];null!=b&&(h.tileDataAvailable(a,b,e)?(m=d._requestTileData(a,b,e,f),m.then(function(){return p.resolve()})):(d.tilemapStats.tilesNotPresent++,d._dispatchDataEvent(a,"dataMissing",e,f,{notInTilemap:!0}),p.reject()))}});
return p}}return this._requestTileData(a,b,e,f)};k.prototype._requestTileData=function(a,b,c,e){this.tilemapStats.tileRequestsSent++;return c===J.LayerClass.ELEVATION?this._requestElevationTileData(a,b,c,e):this._requestMapTileData(a,b,c,e)};k.prototype._requestElevationTileData=function(a,b,c,e){function d(b){var d=h._layerIndexByLayerViewId[c][e.uid];null!=d?(d=a.layerInfo[c][d],d.rawData=b,a.pendingUpdates|=W.DECODE_ELEVATION,d.pendingUpdates|=W.DECODE_ELEVATION,h._pendingUpdates=!0):n.warn("TerrainSurface: received data from unknown layer %d %s",
c,a.lij.toString())}function f(b){A(b)||(h.tilemapStats.tileRequestErrors++,h._dispatchDataEvent(a,"dataMissing",c,e,b))}var h=this,k;O.isElevationLayerView(e)?(b=e.layer,O.useFetchTileForLayer(b)?(k=b.fetchTile(a.lij[0],a.lij[1],a.lij[2],J.ELEVATION_NODATA_VALUE),k.then(function(a){return d(a)},f)):(b=e.getTileUrl(a.lij[0],a.lij[1],a.lij[2]),k=this._streamDataSupplier.request(b,"binary"),k.then(function(a,b){b.url=a;d(b)},f))):g(!1,"_requestElevationTileData can only be called for elevation layer views");
return k};k.prototype._requestMapTileData=function(a,b,c,e){function d(b){g._dispatchDataEvent(a,"dataArrived",c,e,b)}function f(b){A(b)||(g._dispatchDataEvent(a,"dataMissing",c,e,b),g.tilemapStats.tileRequestErrors++)}var g=this;if(O.isVectorTileLayerView(e)){var h=e.tileHandler;b=e.schemeHelper.getCompatibleLevelRowCol(a.lij);b=h.getVectorTileWithLRC(b[0],b[1],b[2],0);b.then(d).otherwise(f).always(function(){g._vectorTileLayerRequests=h.ongoingRequestCount});this._vectorTileLayerRequests=h.ongoingRequestCount}else O.useFetchTileForLayer(e.layer)&&
O.isTileLayerView(e)?(b=e.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2]),b.then(d).otherwise(f)):(b=e.getTileUrl(a.lij[0],a.lij[1],a.lij[2]),b=this._streamDataSupplier.request(b,"image"),b.then(function(a,b){return d(b)},f));return b};k.prototype.requestTilemap=function(a,b,c,e,d){var f=this,g=a.lij[0]+J.TILEMAP_SIZE_EXP,h=a.lij[1]<<J.TILEMAP_SIZE_EXP,k=a.lij[2]<<J.TILEMAP_SIZE_EXP;this.tilemapStats.tilemapRequestsSent++;this.tilemapStats.tilemapRequestsPending++;return d.tilemapCache.fetchTilemap(g,
h,k,{timeout:6E3}).then(function(d){f.tilemapStats.tilemapRequestsPending--;b=f._layerIndexByLayerViewId[c][e.uid];null!=b&&(a.layerInfo[c][b].tilemap=d)}).otherwise(function(a){f.tilemapStats.tilemapRequestsPending--;f.tilemapStats.tilemapRequestErrors++})};k.prototype.getTilemapTile=function(a){var b=a.lij[0];return b>J.TILEMAP_SIZE_EXP?R.getTileNLevelsUp(a,J.TILEMAP_SIZE_EXP):this._topLevelTilemapOnlyTiles[b]};k.prototype._dispatchDataEvent=function(a,b,c,e,d){e=this._layerIndexByLayerViewId[c][e.uid];
if(null!=e)a[b](e,c,d);else n.warn("TerrainSurface: received data from unknown layer")};k.prototype._updateTileOverlayParams=function(){if(this.rootTiles){var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;){var b=a.next();b.renderData&&this.overlayManager&&this.overlayManager.setOverlayParamsOfTile(b,b.renderData,this._curOverlayOpacity)}this._iteratorPool.release(a);this._renderer.setNeedsRender()}};k.prototype._updateOverlayOpacity=function(a){if(this.overlayManager&&(a=this.overlayManager.updateOpacity(a),
!isNaN(a))){if(a!==this._curOverlayOpacity&&this.rootTiles){var b=this._iteratorPool.acquire();for(b.reset(this.rootTiles);!b.done;){var c=b.next();c.renderData&&c.renderData.overlayTexId&&(c.renderData.overlayOpacity=a)}this._iteratorPool.release(b)}this._curOverlayOpacity=a;this._renderer.setNeedsRender()}};k.prototype.getStats=function(){var a=0,b=0,c=0,e=[],d=this._iteratorPool.acquire();for(d.reset(this.rootTiles);!d.done;){var f=d.next();a++;f.renderData&&(b++,f.visible&&(c++,f=f.lij[0],e[f]=
null!=e[f]?e[f]+1:1))}this._iteratorPool.release(d);return{numNodes:a,numLeaves:b,numVisible:c,numVisiblePerLevel:e}};k.prototype.getTile=function(a){var b=a.split("/").map(function(a){return+a});if(0===b[0])return this.rootTiles.forEach(function(a){if(a.lij[1]===b[1]&&a.lij[2]===b[2])return a}),null;var c=Math.pow(2,b[0]),e=Math.floor(b[1]/c),d=Math.floor(b[2]/c),f;this.rootTiles.some(function(a){return a.lij[1]===e&&a.lij[2]===d?(f=a,!0):!1});if(f){for(c=1<<b[0]-1;f.lij[0]<b[0];){var h=b[1]&c?2:
0;0<(b[2]&c)&&h++;if(!f.children[h])return console.log("Tile "+a+" doesn't exist, smallest ancestor is "+R.tile2str(f)),null;f=f.children[h];c>>=1}g(f.lij[0]===b[0]&&f.lij[1]===b[1]&&f.lij[2]===b[2],"not the right tile?");return f}return null};k.prototype.hasPendingUpdates=function(){if(this._streamDataSupplier.hasPendingDownloads()||0!==this._vectorTileLayerRequests)return!0;var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;)if(0<a.next().pendingUpdates)return this._iteratorPool.release(a),
!0;this._iteratorPool.release(a);return!1};k.prototype.setBorders=function(a){this._renderer.setBorders(a)};k.prototype.setDisableRendering=function(a){this._renderer.setDisableRendering(a)};a([d.property({value:!1})],k.prototype,"cullBackFaces",null);a([d.property({readOnly:!0})],k.prototype,"extent",null);a([d.property({value:!1})],k.prototype,"frontMostTransparent",null);a([d.property({readOnly:!0})],k.prototype,"loaded",void 0);a([d.property({value:1})],k.prototype,"opacity",null);a([d.property({readOnly:!0})],
k.prototype,"overlayManager",void 0);a([d.property({readOnly:!0})],k.prototype,"manifold",void 0);a([d.property()],k.prototype,"maxTextureScale",void 0);a([d.property({readOnly:!0})],k.prototype,"ready",null);a([d.property({value:1})],k.prototype,"renderOrder",null);a([d.property({readOnly:!0})],k.prototype,"rootTiles",void 0);a([d.property({value:!0})],k.prototype,"skirts",null);a([d.property({readOnly:!0,aliasOf:"tilingScheme.spatialReference"})],k.prototype,"spatialReference",void 0);a([d.property({value:J.DEFAULT_TILE_BACKGROUND})],
k.prototype,"tileBackground",null);a([d.property({readOnly:!0})],k.prototype,"tilingScheme",void 0);a([d.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],k.prototype,"tilingSchemeLocked",void 0);a([d.property({readOnly:!0})],k.prototype,"tilingSchemeLogic",void 0);a([d.property({value:!0})],k.prototype,"velvetOverground",null);a([d.property({value:!1})],k.prototype,"wireframe",null);return k=a([d.subclass("esri.views.3d.terrain.TerrainSurface")],k)}(d.declared(b,r.Evented));
var y=1.2,F=80/180*Math.PI,N=[-Infinity,-Infinity,Infinity,Infinity],U=J.MAX_ROOT_TILES,Y=12,W=J.TileUpdateTypes,ca=h.create(),X=[0,0,0],aa=Array(10),da=Array(10),ea={spatialReference:null,tile:null},ia={spatialReference:null,extent:null},ba={spatialReference:null,extent:null,scale:0};return w})},"esri/views/3d/terrain/OverlayManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/on ../../../core/Logger ../../../core/Accessor ../../../core/HandleRegistry ../../../core/accessorSupport/decorators ../../../geometry/Point ../lib/glMatrix ../support/mathUtils ../support/earthUtils ../support/projectionUtils ../support/aaBoundingRect ../webgl-engine/Stage ../webgl-engine/lib/Texture ../webgl-engine/lib/Selector ../support/debugFlags ../../../symbols/SimpleMarkerSymbol ../../../Graphic".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c,D,B){var I=p.vec2d,G=p.vec3d,H=p.vec4d,K={width:0,height:0,pixelRatio:0,views:null},J=[{viewport:H.create(),extent:H.create()}],P=[J[0],{viewport:H.create(),extent:H.create()}],O=H.create(),L=G.create(),M=[H.create(),H.create()],R=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],Q=b.getLogger("esri.views.3d.OverlayManager"),T,A=function(b){function l(){var a=null!==b&&
b.apply(this,arguments)||this;a._handles=new t;a._overlaySR=null;a._renderSR=null;a._overlaySREqualsRenderSR=!0;a._connectedLayers={};a._scale=0;a._dirty=!1;a._isSpherical=!1;a._latestOriginId=0;a.opacity=0;return a}f(l,b);Object.defineProperty(l.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});l.prototype.initialize=function(){var a=this;this._stage=this.view._stage;this._renderer=this._stage.getTextureGraphicsRenderer();this._renderer.onHasHighlightsChanged=
function(){return a.onHasHighlightsChanged()};this._initialEmptyTexture=new C(new Uint8Array([0,0,0,0]),"overlayEmpty",{width:1,height:1,wrapClamp:!0});this.groundSelector=new E(this.view.viewingMode);this.groundSelector.enableBackfacesTerrain=!0;this.groundSelector.enableInvisibleTerrain=!0;this.groundSelector.enableHUDSelection=!1;this._stage.add(u.ModelContentType.TEXTURE,this._initialEmptyTexture);this._handles.add(this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location"],
function(){return a.setOverlayDirty()}))};l.prototype.destroy=function(){for(var a in this._connectedLayers)this.unregisterLayerView(this._connectedLayers[a].layerView);this._disposeOverlays();this._stage.remove(u.ModelContentType.TEXTURE,this._initialEmptyTexture.getId());this._handles&&(this._handles.destroy(),this._handles=null)};l.prototype.onHasHighlightsChanged=function(){this.setOverlayDirty();this.notifyChange("hasHighlights")};l.prototype.hasOverlays=function(){return!!this._overlays};l.prototype.setSpatialReference=
function(a,b){(this._overlaySR=a)?(this._renderSR=this.view.renderSpatialReference,this._overlaySREqualsRenderSR=this._overlaySR.equals(this._renderSR),this._longitudeCyclical=(this._isSpherical=b)?a.isWebMercator?new x.Cyclical(-2.0037508342788905E7,2.0037508342788905E7):new x.Cyclical(-180,180):null):(this._disposeOverlays(),this._longitudeCyclical=null)};l.prototype.registerLayerView=function(a){var b=this,c=a.layer.uid;if(this._connectedLayers[c])Q.warn("[OverlayManager#registerLayerView]: Layer "+
c+" is already connected");else{var f=d(a,"draped-data-change",function(){return b.setOverlayDirty()});this._connectedLayers[c]={eventHandles:[f],layerView:a};if(a.setDrapingExtent&&this._overlays)for(c=0;c<this._overlays.length;c++)f=this._overlays[c],a.setDrapingExtent(c,f.extent,this._overlaySR,2048,f.renderLocalOrigin);this.setOverlayDirty()}};l.prototype.unregisterLayerView=function(a){for(var b in this._connectedLayers){var c=this._connectedLayers[b];if(c.layerView===a){if(c.eventHandles)for(var d=
0;d<c.eventHandles.length;d++)c.eventHandles[d].remove();delete this._connectedLayers[b];this.setOverlayDirty();a.destroyed||(a._overlayUpdating=!1,a._evaluateUpdatingState())}}};l.prototype.setOverlayDirty=function(){this._dirty||(this._setOverlayUpdating(!0),this._dirty=!0)};l.prototype._setOverlayUpdating=function(a){for(var b in this._connectedLayers){var c=this._connectedLayers[b].layerView;if(!a||!c.suspended&&c.hasDraped)c._overlayUpdating=a,c._evaluateUpdatingState()}if(b=this.view._graphicsView)b._overlayUpdating=
a,b._evaluateUpdatingState()};l.prototype.updateOverlay=function(){if(this._overlaySR){var a=this._computeOverlayExtents();if(a){this._overlays||this._initOverlays();for(var b=0;b<this._overlays.length;b++){var c=this._overlays[b],d;a:{d=a[b];for(var f=c.extent,k=A.EXTENTS_DIFFER_THRESHOLD*Math.max(d[2]-d[0],d[3]-d[1],f[2]-f[0],f[3]-f[1]),m=0;4>m;m++)if(Math.abs(f[m]-d[m])>k){d=!0;break a}d=!1}if(d){H.set(a[b],c.extent);c.renderLocalOrigin={id:"OV_"+this._latestOriginId++,vec3:r.center(c.extent,G.create())};
for(var p in this._connectedLayers)d=this._connectedLayers[p].layerView,d.setDrapingExtent&&d.setDrapingExtent(b,a[b],this._overlaySR,2048,c.renderLocalOrigin)}}this._setOverlayUpdating(!1);this._drawOverlays();this.terrainSurface._updateTileOverlayParams();this._dirty=!1}}};l.prototype.overlaysNeedUpdate=function(){return this._dirty&&!!this._overlaySR};l.prototype.updateOpacity=function(a){var b=1;if(this._overlays){var c=this._scale;a=this.view.renderCoordsHelper.getAltitude(a);3.5*a<c&&(b=Math.sqrt(x.clamp((a-
c/10)/(c/3.5-c/10),0,1)))}return b};l.prototype.setOverlayParamsOfTile=function(a,b,c){a=a.extent;var e=-1;this._rectInsideRect(a,this._overlays[0].extent)?e=0:this._rectanglesOverlap(a,this._overlays[1].extent)&&(e=1);if(0<=e){var d=this._overlays[e].extent;b.overlayTexScale[0]=(a[2]-a[0])/(d[2]-d[0]);b.overlayTexScale[1]=(a[3]-a[1])/(d[3]-d[1]);var f=a[0];if(this._longitudeCyclical){var f=this._longitudeCyclical.minimalMonotonic(d[0],f),g=this._longitudeCyclical.minimalMonotonic(d[0],a[2]);f>g&&
(f=g-(a[2]-a[0]))}I.set2((f-d[0])/(d[2]-d[0]),(a[1]-d[1])/(d[3]-d[1]),b.overlayTexOffset);b.overlayTexId=this._overlays[e].valid?this._overlays[e].texture.getId():this._initialEmptyTexture.getId();b.highlightOverlayTexId=this._overlays[e].highlightValid?this._overlays[e].highlightTexture.getId():this._initialEmptyTexture.getId();b.overlayOpacity=void 0!==c?c:1}else b.overlayTexId=null,b.highlightOverlayTexId=null};l.prototype.overlayPixelSizeInMapUnits=function(a){var b;this._overlays&&(this._overlays[0]&&
this._pointIsInExtent(a,this._overlays[0].extent)?b=this._overlays[0].extent:this._overlays[1]&&(b=this._overlays[1].extent));return b?(b[2]-b[0])/2048:0};l.prototype._createEmptyOverlay=function(){var a=new C(null,"overlay",{wrapClamp:!0,mipmap:!0});this._stage.add(u.ModelContentType.TEXTURE,a);var b=new C(null,"highlightOverlay",{wrapClamp:!0,mipmap:!0});this._stage.add(u.ModelContentType.TEXTURE,b);return{extent:H.create(),texture:a,valid:!1,highlightTexture:b,highlightValid:!1,renderLocalOrigin:{id:"O",
vec3:[0,0,0]}}};l.prototype._initOverlays=function(){this._overlays=[this._createEmptyOverlay(),this._createEmptyOverlay()]};l.prototype._disposeOverlays=function(){if(this._overlays){var a=this._stage;this._overlays.forEach(function(b){a.remove(u.ModelContentType.TEXTURE,b.texture.getId());a.remove(u.ModelContentType.TEXTURE,b.highlightTexture.getId())});this._overlays=null}};l.prototype._intersectGroundFromView=function(a,b,c,d){var e=G.createFrom(b*this.view.width,c*this.view.height,1);G.unproject(e,
a.viewMatrix,a.projectionMatrix,a.fullViewport,e);b=G.createFrom(b*this.view.width,c*this.view.height,0);G.unproject(b,a.viewMatrix,a.projectionMatrix,a.fullViewport,b);this.groundSelector.init([],b,e,null,a,null,!1);this.view.basemapTerrain.intersect(this.groundSelector,b,e);return this.groundSelector.minResult.getIntersectionPoint(d)};l.prototype._findHorizonBasedPointOfInterest=function(a,b,c){var e=.5;if("global"===this.view.viewingMode){e=G.create(a.eye);G.normalize(e);G.negate(e);b=G.length(b);
b=Math.asin(b/G.length(a.eye));var d=Math.acos(G.dot(a.viewForward,e)),e=x.clamp((b-(d-.5*a.fovY))/a.fovY,0,1);b=x.clamp((-b-(d-.5*a.fovY))/a.fovY,0,1);e=1===e&&0===b?.5:b+.55*(e-b)}else e=p.mat4d.multiplyVec4(a.projectionMatrix,H.createFrom(0,Math.tan(.5*Math.PI-Math.acos(-a.viewForward[2])),1,0))[1],e=x.clamp(.5+.5*e,0,1),e=1===e||0===e?.5:0<a.eye[2]?.55*e:1-.55*(1-e);return this._intersectGroundFromView(a,.5,e,c)?!0:!1};l.prototype._computeOverlayExtents=function(){var a=this.view.navigation.currentCamera,
b=this.terrainSurface.extent,d=G.create(),f=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;this._findHorizonBasedPointOfInterest(a,this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,d)||G.set(f,d);this._scale=this.view.renderCoordsHelper.getAltitude(a.eye);var m=G.dist(a.eye,d),f=this.view.renderCoordsHelper.viewAngle(f,a.eye),f=Math.PI/2-Math.abs(f-Math.PI/2);if(c.OVERLAY_SHOW_CENTER){var p=new D({color:[255,0,0],outline:{color:[255,255,255],width:2}}),l=new k;v.vectorToPoint(d,
this._renderSR,l,this._overlaySR);p=new B({geometry:l,symbol:p});void 0!==T&&this.view.graphics.remove(T);this.view.graphics.add(p);T=p}this._overlaySREqualsRenderSR||v.vectorToVector(d,this._renderSR,d,this._overlaySR);var m=1024*a.perPixelRatio*m*2,r=!1,p=Infinity;this._isSpherical&&(this._overlaySR.isWebMercator?(m/=Math.cos(v.webMercator.y2lat(d[1])),p=this.terrainSurface.extent[3],p*=.999):(r=!0,m/=z.metersPerDegree,p=90),m>=p&&(m=p,d[1]=0,this._overlaySR.isWebMercator&&(d[0]=0)));l=1;r&&(l=
1/Math.max(.2,Math.cos(Math.abs(x.deg2rad(d[1])))),180<m*l&&(l=180/m));var q=m*l,u=M[0];u[0]=d[0]-q;u[1]=d[1]-m;u[2]=d[0]+q;u[3]=d[1]+m;this._isSpherical&&this._shiftExtentToFitBounds(u,Infinity,p);r=M[1];H.set(u,r);6*q>b[2]-b[0]?H.set(b,r):f<=.25*Math.PI?(r[0]-=q,r[1]-=m,r[2]+=q,r[3]+=m):(v.vectorToVector(a.eye,this._renderSR,L,this._overlaySR),I.subtract(d,L,O),a=-Math.atan2(O[1],O[0])+.125*Math.PI,0>a&&(a+=2*Math.PI),H.scale(R[Math.floor(a/(.25*Math.PI))],2*m,O),O[0]*=l,O[2]*=l,H.add(r,O,r));this._isSpherical&&
(r[0]=this._longitudeCyclical.clamp(r[0]),r[2]=this._longitudeCyclical.clamp(r[2]),r[1]=Math.max(r[1],-p),r[3]=Math.min(r[3],p));this.opacity=1;return M};l.prototype._drawOverlays=function(){for(var a=this._overlays[0].extent[2]-this._overlays[0].extent[0],b=this._renderer,c=0;c<this._overlays.length;c++){var d=this._overlays[c].extent,f=this._longitudeCyclical?d[2]>this._longitudeCyclical.max:!1,k=this._longitudeCyclical?d[0]<this._longitudeCyclical.min:!1;if(f||k){K.views=P;var k=void 0,k=f?this._longitudeCyclical.max-
d[0]:this._longitudeCyclical.min-d[0],k=Math.round(k/(d[2]-d[0])*2048),m=K.views[0];H.set4(0,0,k,2048,m.viewport);H.set4(d[0],d[1],this._longitudeCyclical.max,d[3],m.extent);f||(m.extent[0]+=this._longitudeCyclical.range);m=K.views[1];H.set4(k,0,2048-k,2048,m.viewport);H.set4(this._longitudeCyclical.min,d[1],d[2],d[3],m.extent);f&&(m.extent[2]-=this._longitudeCyclical.range)}else K.views=J,H.set(d,K.views[0].extent),H.set4(0,0,2048,2048,K.views[0].viewport);K.width=2048;K.height=2048;K.pixelRatio=
a/(d[2]-d[0]);this._overlays[c].valid=b.draw(this._overlays[c].texture,K);this._overlays[c].highlightValid=b.drawHighlights(this._overlays[c].highlightTexture,K)}};l.prototype._rectanglesOverlap=function(a,b){return this._longitudeCyclical?(this._longitudeCyclical.contains(b[0],b[2],a[0])||this._longitudeCyclical.contains(b[0],b[2],a[2])||this._longitudeCyclical.contains(a[0],a[2],b[0]))&&!(a[1]>b[3]||a[3]<b[1]):!(a[0]>b[2]||a[2]<b[0]||a[1]>b[3]||a[3]<b[1])};l.prototype._rectInsideRect=function(a,
b){return this._longitudeCyclical?this._longitudeCyclical.contains(b[0],b[2],a[0])&&this._longitudeCyclical.contains(b[0],b[2],a[2])&&a[1]>b[1]&&a[3]<b[3]:a[0]>b[0]&&a[2]<b[2]&&a[1]>b[1]&&a[3]<b[3]};l.prototype._pointIsInExtent=function(a,b){if(this._longitudeCyclical)return this._longitudeCyclical.contains(b[0],b[2],a.x)&&a.y>=b[1]&&a.y<=b[3];var c=a.x;a=a.y;return c>b[0]&&c<b[2]&&a>b[1]&&a<b[3]};l.prototype._shiftExtentToFitBounds=function(a,b,c){var e=0,d=0;a[0]<-b?e=a[0]+b:a[2]>b&&(e=b-a[2]);
a[1]<-c?d=a[1]+c:a[3]>c&&(d=c-a[3]);r.offset(a,e,d)};l.EXTENTS_DIFFER_THRESHOLD=1E-5;a([m.property()],l.prototype,"view",void 0);a([m.property()],l.prototype,"terrainSurface",void 0);a([m.property({type:Boolean})],l.prototype,"hasHighlights",null);return l=a([m.subclass("esri.views.3d.terrain.OverlayManager")],l)}(m.declared(q));return A})},"esri/views/3d/terrain/PlanarTile":function(){define(["./TileBase","./TileGeometryFactory","../../../core/ObjectPool","../support/mathUtils","../lib/glMatrix"],
function(w,l,f,a,d){var b=d.vec3d.createFrom(0,0,1);d=function(a,d,f,k){w.call(this);this.tileUp=b;void 0!==a&&this.init(a,d,f,k)};d.prototype=new w;d.prototype.constructor=d;d.prototype.init=function(b,d,f,k){w.prototype.init.call(this,b,d,f,k);this.edgeLen=this.extent[2]-this.extent[0];this.curvatureHeight=0;this.centerAtSeaLevel[0]=a.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=a.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=0;this.updateRadiusAndCenter()};
d.prototype.updateRadiusAndCenter=function(){w.prototype.updateRadiusAndCenter.call(this);var a=(this.extent[2]-this.extent[0])*Math.SQRT1_2,b=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this.radius=Math.sqrt(a*a+b*b)};d.prototype.isVisible=function(a){if(!this.intersectsClippingArea)return!1;var b=this.extent[0],d=this.extent[1],f=this.elevationBounds[0],p=this.extent[2],l=this.extent[3],q=this.elevationBounds[1];return 0<a[0][0]*(0<a[0][0]?b:p)+a[0][1]*(0<a[0][1]?d:l)+a[0][2]*(0<a[0][2]?
f:q)+a[0][3]||0<a[1][0]*(0<a[1][0]?b:p)+a[1][1]*(0<a[1][1]?d:l)+a[1][2]*(0<a[1][2]?f:q)+a[1][3]||0<a[2][0]*(0<a[2][0]?b:p)+a[2][1]*(0<a[2][1]?d:l)+a[2][2]*(0<a[2][2]?f:q)+a[2][3]||0<a[3][0]*(0<a[3][0]?b:p)+a[3][1]*(0<a[3][1]?d:l)+a[3][2]*(0<a[3][2]?f:q)+a[3][3]||0<a[4][0]*(0<a[4][0]?b:p)+a[4][1]*(0<a[4][1]?d:l)+a[4][2]*(0<a[4][2]?f:q)+a[4][3]||0<a[5][0]*(0<a[5][0]?b:p)+a[5][1]*(0<a[5][1]?d:l)+a[5][2]*(0<a[5][2]?f:q)+a[5][3]?!1:!0};d.prototype._numSubdivisionsAtLevel=[2,2,2,2,2,2,2,2];d.prototype.createGeometry=
function(a,b,d){a.needsUpdate=!1;return l.createPlanarGlobeTile(a.numVertsPerRow,this.extent,a.samplerData,b,d,a.clippingArea)};d.Pool=new f(d);return d})},"esri/views/3d/terrain/TileBase":function(){define("./terrainUtils ./tileUtils ./TerrainConst ./ElevationData ./TilePerLayerInfo ./ElevationTileAgent ./MapTileAgent ../support/mathUtils ../lib/glMatrix ../../../core/arrayUtils".split(" "),function(w,l,f,a,d,b,q,t,m,k){var p=m.vec3d,x=m.vec2d,z=m.vec4d,v=m.mat4d,r=w.weakAssert,u=p.create(),C=z.create(),
E=z.create(),c=p.create(),D=q.AGENT_DONE,B=f.LayerClass.LAYER_CLASS_COUNT,I=f.LayerClass.MAP,G=f.LayerClass.ELEVATION,H=f.TileUpdateTypes;m=function(a,b,d){this.lij=[0,0,0];this.extent=z.create();this.extentWGS84Rad=z.create();this.centerAtSeaLevel=p.create();this.center=p.create();this.tileUp=c;this.elevationBounds=x.create();this.children=[null,null,null,null];this.layerInfo=Array(B);this.intersectsClippingArea=this.isWithinClippingArea=!0;this.clippingArea=null;this._maxTesselation=0};m.prototype.init=
function(a,b,c,k){this.lij[0]=a[0];this.lij[1]=a[1];this.lij[2]=a[2];k.getExtent(a[0],a[1],a[2],this.extent,this.extentWGS84Rad);this.intersectsClippingArea=this.isWithinClippingArea=!0;this.clippingArea=null;this.radius=this.edgeLen=0;this.vlevel=a?a[0]:0;b&&b.elevationBounds?x.set(b.elevationBounds,this.elevationBounds):x.set2(0,0,this.elevationBounds);this.parent=b;for(a=0;4>a;a++)this.children[a]=null;this.pendingUpdates=0;this.renderData=null;this.renderOrder=this.screenDepth=0;this.visible=
!1;this.parentSurface=c;for(a=0;a<B;a++)if(c){b=c.numLayers(a);var m;this.layerInfo[a]?(m=this.layerInfo[a],m.length=b):(m=Array(b),this.layerInfo[a]=m);for(var p=0;p<b;p++)m[p]=d.makeEmptyLayerInfo(a,m[p]),a==G&&this.findElevationBoundsForLayer(p,-1)}else this.layerInfo[a]=null;this.computeElevationBounds();this._maxTesselation=Math.min(k.pixelSize[0],f.MAX_TILE_TESSELATION)};m.prototype.dispose=function(){for(var a=0;a<B;a++)for(var b=this.layerInfo[a],c=0;c<b.length;c++)b[c].dispose()};m.prototype.updateScreenDepth=
function(a){p.set(this.center,E);E[3]=1;v.multiplyVec4(a,E,E);this.screenDepth=E[2]/E[3]};m.prototype.shouldSplit=function(a,b){var c=this.lij[0];if(1>c)return H.SPLIT;p.subtract(this.center,b,u);var d=p.length(u),f=this.edgeLen/(a[0]*d*2),d=this.edgeLen/(a[2]*d*2),k=a[1],m=a[3],l=a[4];a=a[5];return f<k?this.vlevel!==this.lij[0]?(this.vlevel=this.lij[0],H.VSPLITMERGE):H.NONE:c>=l?(b=c+Math.ceil(-t.log2(k/f)),b!==this.vlevel?(this.vlevel=b,H.VSPLITMERGE):H.NONE):6<c&&(p.scale(this.tileUp,p.dot(this.tileUp,
u),C),p.subtract(C,u),p.length2(C)>this.radius*this.radius&&(p.scale(C,this.radius/p.length(C)),p.add(C,this.center),p.subtract(b,C,C),b=this.elevationBounds[1]-this.elevationBounds[0],Math.min(1,(Math.abs(p.dot(C,this.tileUp))+.5*b+this.curvatureHeight)/p.length(C))*d<.1/a*m))?H.NONE:H.SPLIT};m.prototype.decodeElevationData=function(b){var c;if(b instanceof ArrayBuffer)try{c=a.createFromLERC(this.lij,this.extent,b,f.noDataValueOpt)}catch(P){console.warn("Error decoding %s: %s",b.url,P.message)}else c=
a.createFromFetchTileResult(this.lij,this.extent,b);return c};m.prototype.getWGS84Extent=function(){return this.extentWGS84Rad.map(t.rad2deg)};m.prototype.load=function(a){for(var b=0;b<B;b++)this.layerInfo[b]&&this._createOrUpdateAgents(0,b);a.loadTile(this)};m.prototype.unload=function(a){this.renderData&&a.unloadTile(this);for(a=0;a<B;a++)for(var c=this.layerInfo[a],d=0;d<c.length;d++){var k=c[d];k.loadingAgent&&k.loadingAgent!==D&&(k.loadingAgent.dispose(),(a===f.LayerClass.ELEVATION?b:q).Pool.release(k.loadingAgent),
k.loadingAgent=null);k.pendingUpdates=0}this.pendingUpdates&=~f.TileUpdateTypes.UPDATE_GEOMETRY;this.pendingUpdates&=~f.TileUpdateTypes.UPDATE_TEXTURE};m.prototype.updateClippingStatus=function(a){k.equals(a,this.clippingArea)||(a?(this.intersectsClippingArea=this.intersectsExtent(a),this.isWithinClippingArea=this.isWithinExtent(a)):this.isWithinClippingArea=this.intersectsClippingArea=!0,this.clippingArea=a,this.renderData&&this.updateGeometry())};m.prototype.updateVisibility=function(a,b,c){a=c||
this.isVisible(a,b)&&this.intersectsClippingArea;if(a!==this.visible)for(this.visible=a,b=this.layerInfo[0],c=0;c<b.length;c++){var d=b[c];d.loadingAgent&&d.loadingAgent!==D&&d.loadingAgent.setSuspension(!a)}return a};m.prototype.getLayerInfo=function(a,b){return this.layerInfo[b][a]};m.prototype.hasLayerData=function(a,b){return(a=this.layerInfo[b][a])&&a.data&&!a.dataInvalidated};m.prototype.tileDataAvailable=function(a,b,c){return(b=this.layerInfo[c][b].tilemap)?"unavailable"!==b.getAvailability(a.lij[1],
a.lij[2]):!0};m.prototype.requestLayerData=function(a,b,c){f.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d requested by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a];if(-1<d.waitingAgents.indexOf(c))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),!0;if(d.data&&!d.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",
this.lij.toString(),c.tile.lij.toString(),b,a),d.waitingAgents.push(c),setTimeout(c.dataArrived.bind(c,this),0),!0;if(d.pendingUpdates&H.DECODE_ELEVATION)return d.waitingAgents.push(c),!0;d.waitingAgents.push(c);if(!d.requestPromise){var k=this.parentSurface.requestTileData(this,a,b);if(k.isFulfilled())return!1;a=function(){d.requestPromise===k&&(d.requestPromise=null)};d.requestPromise=k;k.then(a,a);return!!k}return!0};m.prototype.descendants=function(a){a||(a=[]);for(var b=0;4>b;b++){var c=this.children[b];
c&&(c.descendants(a),a.unshift(this.children[b]))}return a};m.prototype.isLij=function(a){return this.lij[0]===a[0]&&this.lij[1]===a[1]&&this.lij[2]==a[2]};m.prototype.findByLij=function(a){if(this.isLij(a))return this;for(var b=0;4>b;b++){var c=this.children[b];if(c&&(c=c.findByLij(a)))return c}return null};m.prototype.unrequestLayerData=function(a,b,c){f.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d canceled by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a],
k=d.waitingAgents;c=k.indexOf(c);r(-1<c,"agent has not requested this piece of map data");k[c]=k[k.length-1];k.length--;1>k.length&&(k=d.requestPromise,c=!1,b===I&&(c=this.parentSurface.layerViewByIndex(a,I),c=w.isVectorTileLayerView(c)),c||r(k||d.rawData,"no pending operations on layerInfo that agents were waiting for"),k&&!k.isFulfilled()&&(k.cancel(),d.requestPromise=null),f.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d request/loading canceled",this.lij.toString(),b,a))};m.prototype.dataArrived=
function(a,b,c){a=this.layerInfo[b][a];a.data=c;a.dataInvalidated=!1;for(c=0;c<a.waitingAgents.length;c++)a.waitingAgents[c].dataArrived(this);a.waitingAgents.length=0};m.prototype.dataMissing=function(a,b,c){c.notInTilemap||console.error("Tile %s layer %d/%d error",this.lij.toString(),b,a);a=this.layerInfo[b][a];a.dataMissing=!0;for(b=0;b<a.waitingAgents.length;b++)a.waitingAgents[b].dataMissing(this);a.waitingAgents.length=0};m.prototype.updateTexture=function(a){this.renderData&&(a?this.parentSurface._renderer.updateTileTexture(this):
(this.pendingUpdates|=f.TileUpdateTypes.UPDATE_TEXTURE,this.parentSurface._pendingUpdates=!0))};m.prototype.invalidateLayerData=function(a,b){this.layerInfo[b][a].invalidateSourceData();this.restartAgents(b)};m.prototype.computeElevationBounds=function(){x.set2(Number.MAX_VALUE,-Number.MAX_VALUE,this.elevationBounds);for(var a=this.layerInfo[G],b=!1,c=0;c<a.length;c++){var d=a[c];d.elevationBounds&&(this.elevationBounds[0]=Math.min(this.elevationBounds[0],d.elevationBounds[0]),this.elevationBounds[1]=
Math.max(this.elevationBounds[1],d.elevationBounds[1]),b=!0)}b||x.set2(0,0,this.elevationBounds);this.updateRadiusAndCenter()};m.prototype.updateRadiusAndCenter=function(){p.scale(this.tileUp,.5*(this.elevationBounds[0]+this.elevationBounds[1]),C);p.add(this.centerAtSeaLevel,C,this.center)};m.prototype.findElevationBoundsForLayer=function(a,b){var c=this.layerInfo[G][a];if(!c.elevationBounds||c.elevationBounds[2]<b)if(b=this.parentSurface.layerViewByIndex(a,G),l.fallsWithinLayer(this,b.layer,!1)){b=
!1;if(c.data)x.set(c.data.bounds,C),C[2]=this.lij[0],b=!0;else{for(var d=this.parent,k=0,m=null,r=c.data;d&&(!r||k<f.ELEVATION_DESIRED_RESOLUTION_LEVEL);){k=this.vlevel-d.lij[0];m=r||m;r=d.layerInfo[G][a].data;if(!r&&m&&k>=f.ELEVATION_DESIRED_RESOLUTION_LEVEL)break;d=d.parent}if(r=r||m)r.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],C),Infinity!==C[0]&&(C[2]=r.level,b=!0)}b&&(c.elevationBounds?p.set(C,c.elevationBounds):c.elevationBounds=[C[0],C[1],C[2]])}};m.prototype.updateGeometry=function(){this.pendingUpdates|=
f.TileUpdateTypes.UPDATE_GEOMETRY;this.parentSurface._pendingUpdates=!0};m.prototype.modifyLayers=function(a,c,k){for(var m=c.length,p=this.layerInfo[k],l=Array(m),r=0;r<p.length;r++){var v=p[r];v.loadingAgent&&v.loadingAgent!==D&&(v.loadingAgent.dispose(),(k===f.LayerClass.ELEVATION?b:q).Pool.release(v.loadingAgent),v.loadingAgent=null);v.waitingAgents.length=0}if(k===I)for(r=0;r<p.length;r++)void 0===a[r]&&p[r].dispose();for(r=0;r<m;r++)a=c[r],l[r]=-1<a?p[a]:d.makeEmptyLayerInfo(k);this.layerInfo[k]=
l};m.prototype.restartAgents=function(a){if(this.renderData)if(this._createOrUpdateAgents(0,a),a===G){this.updateGeometry();a=this.layerInfo[a];for(var b=0;b<a.length;b++)a[b].pendingUpdates|=f.TileUpdateTypes.UPDATE_GEOMETRY;this.parentSurface._pendingUpdates=!0}else this.updateTexture(!0)};m.prototype.updateAgents=function(a){if(this.renderData){for(var b=this.layerInfo[a],c=0;c<b.length;c++){var d=b[c];d.loadingAgent===D&&(d.loadingAgent=null)}this._createOrUpdateAgents(0,a)}};m.prototype.removeLayerAgent=
function(a,b){a=this.layerInfo[b][a];a.loadingAgent&&a.loadingAgent!==D&&a.loadingAgent.dispose();a.loadingAgent=null};m.prototype.agentDone=function(a,b){var c=this.layerInfo[b],d=c[a];d.loadingAgent=D;d.data||d.upsampleFromTile||a<c.length-1&&this._createOrUpdateAgents(a+1,b)};m.prototype._createOrUpdateAgents=function(a,c){var d;d=c===G?!1:!this.visible;for(var k=this.layerInfo[c];a<k.length;){var m=k[a],p=!1,r=this.parentSurface.layerViewByIndex(a,c);if(null!==m.loadingAgent&&m.loadingAgent!==
D)p=m.loadingAgent.update();else if(m.loadingAgent!==D&&l.fallsWithinLayer(this,r.layer,!1)){var v=c===f.LayerClass.ELEVATION?b:q,u=v.Pool.acquire();(p=u.init(this,a,c,d))?m.loadingAgent=u:(u.dispose(),v.Pool.release(u),m.loadingAgent=D)}if(p&&!r.isTransparent)break;a++}};m.prototype.geometryState=function(a){var b,c=this._getElevationInfo(a?a.samplerData:null),d=this.lij[0],m=!1;c.samplerData?(b=this.vlevel-d,b=Math.max(d-c.maxTileLevel,f.ELEVATION_DESIRED_RESOLUTION_LEVEL-b),d=this._maxTesselation,
b=t.clamp((d>>b)+1,2,d+1)):b=8>d?this._numSubdivisionsAtLevel[d]+1:2;d=this.clippingArea;if(!this.intersectsClippingArea||this.isWithinClippingArea)d=null;a?(a.numVertsPerRow!==b&&(a.numVertsPerRow=b,m=!0),c.changed&&(a.samplerData=c.samplerData,m=!0),k.equals(a.clippingArea,d)||(a.clippingArea=d,m=!0),a.needsUpdate=m):a={numVertsPerRow:b,samplerData:c.samplerData,needsUpdate:!0,clippingArea:d};return a};m.prototype._getElevationInfo=function(a){for(var b=this.layerInfo[G],c=b.length,d=Array(c),f=
0,k=0,m=!1,p=0;p<c;p++){var r=b[p];if(r.upsampleFromTile){var r=r.upsampleFromTile.tile,q=r.layerInfo[G][p].data;a&&a[f]===q.samplerData||(m=!0);d[f++]=q.samplerData;k=Math.max(k,r.lij[0])}else r.data&&(q=this.parentSurface.layerViewByIndex(p,G),l.fallsWithinLayer(this,q.layer,!1)&&(a&&a[f]===r.data.samplerData||(m=!0),d[f++]=r.data.samplerData,k=this.lij[0]))}a&&a.length!==f&&(m=!0);0<f?d.length=f:d=null;return{changed:m,samplerData:d,maxTileLevel:k}};m.prototype.isWithinExtent=function(a){var b=
this.extent;return b[0]>=a[0]&&a[2]>=b[2]&&b[1]>=a[1]&&a[3]>=b[3]};m.prototype.intersectsExtent=function(a){var b=this.extent;return b[2]>=a[0]&&a[2]>=b[0]&&b[3]>=a[1]&&a[3]>=b[1]};return m})},"esri/views/3d/terrain/terrainUtils":function(){define("require exports ./terrainUtilsPlanar ./terrainUtilsSpherical ../../../layers/TiledLayer ../../../layers/TileLayer ../../../layers/BaseTileLayer ../../../layers/BaseElevationLayer ../../../layers/ElevationLayer ../../../layers/VectorTileLayer ../../../layers/WMTSLayer ../../../support/basemapDefinitions".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x){function z(a){return a&&"esri.views.3d.layers.TileLayerView3D"===a.declaredClass}function v(a){return a&&"esri.views.3d.layers.VectorTileLayerView3D"===a.declaredClass}function r(a){return a&&"esri.views.3d.layers.WMTSLayerView3D"===a.declaredClass}function u(a){return a&&"esri.views.3d.layers.ElevationLayerView3D"===a.declaredClass}function C(){D={};for(var a in x)x[a].baseMapLayers.forEach(function(a){D[a.url]=19});D["//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"]=
20}function E(a,b,d,f){return c["local"===f||"planar"===f?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(a,b,d)}Object.defineProperty(l,"__esModule",{value:!0});var c={planar:f,spherical:a};l.weakAssert=function(a,b){a||console.warn("Terrain: "+b)};l.autoUpdateSkirtsVisibility=function(a,b){c[a.manifold].autoUpdateSkirtsVisibility(a,b)};l.isTiledLayer=function(a){return a&&(a.isInstanceOf(d)||a.isInstanceOf(q)||a.isInstanceOf(t)||a.isInstanceOf(p))};l.isVectorTileLayer=function(a){return a&&
a.isInstanceOf(k)};l.isTileLayerView=z;l.isVectorTileLayerView=v;l.isWMTSLayerView=r;l.isElevationLayerView=u;l.isTiledLayerView=function(a){return a&&(z(a)||u(a)||v(a)||r(a))};l.useFetchTileForLayer=function(a){return a.fetchTile&&!(a.fetchTile===b.prototype.fetchTile||a.fetchTile===m.prototype.fetchTile)};var D=null;l.getKnownTiledServiceLevelCap=function(a){D||C();a=a&&a.replace(/https?:/,"");return a in D?D[a]:Infinity};l.prepareKnownTiledServiceLevelCaps=C;l.checkIfTileInfoSupportedForView=E;
l.getTiledLayerInfo=function(a,b,c){var d,f;if(a.isInstanceOf(p)){if(a=a.activeLayer){var m=a.tileMatrixSet;if(m)d=m.tileInfo,f=m.fullExtent;else if(a=a.tileMatrixSets)if(a=a.find(function(a){return null==E(a.tileInfo,a.fullExtent,b,c)}))return{tileInfo:a.tileInfo,fullExtent:a.fullExtent}}}else d=a.isInstanceOf(k)?a.compatibleTileInfo256:a.tileInfo,f=a.fullExtent;return d&&f&&null==E(d,f,b,c)?{tileInfo:d,fullExtent:f}:{tileInfo:null,fullExtent:null}}})},"esri/views/3d/terrain/terrainUtilsPlanar":function(){define("require exports ./TilingScheme ./TerrainConst ../../../core/Error ../support/aaBoundingRect ../lib/glMatrix".split(" "),
function(w,l,f,a,d,b,q){function t(a,b,d,f){k.set(d,p);p[f]=b[f];f=k.subtract(p,b);var c=k.subtract(a,b,x),c=k.dot(c,f),m=k.dot(f,f);b=0>=c?b:m<=c?d:k.add(b,k.scale(f,c/m),p);a=k.subtract(a,b,p);return Math.PI/2-Math.atan(a[2]/Math.sqrt(a[0]*a[0]+a[1]*a[1]))}function m(a,b){var d=a.getElevationBounds();a=a.extent;d=.5*(d[0]+d[1]);z[0]=a[0];z[1]=a[1];z[2]=d;v[0]=a[2];v[1]=a[3];v[2]=d;a=d=Infinity;b[0]<z[0]?d=t(b,z,v,0):b[0]>v[0]&&(d=t(b,v,z,0));b[1]<z[1]?a=t(b,z,v,1):b[1]>v[1]&&(a=t(b,v,z,1));return Math.min(d,
a)}Object.defineProperty(l,"__esModule",{value:!0});var k=q.vec3d,p=k.create(),x=k.create(),z=k.create(),v=k.create();l.autoUpdateSkirtsVisibility=function(a,d){var f,k=!0,c=a.extent,p=b.containsPoint(c,d);p?f=a.getElevation(d):(f=a.getElevationBounds(),f=.5*(f[0]+f[1]));f>d[2]?k=!1:p||(b.containsPointWithMargin(c,d,a.hideSkirtsDistanceFromExtentMargin*Math.min(c[2]-c[0],c[3]-c[1]))?m(a,d)>a.hideSkirtsMinimumCameraTilt&&(k=!1):k=!1);k!==a.skirts&&(a.skirts=k)};l.tiltOnEdge=t;l.tiltToExtentEdge=m;
l.checkIfTileInfoSupportedForViewSR=function(k,m,p){if(k.spatialReference.isGeographic)return new d("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var l=f.checkUnsupported(k);if(l)return l;var c=k.lods,l=c[0].resolution*Math.pow(2,c[0].level),r=[l*k.size[0],l*k.size[1]],q=[k.origin.x,k.origin.y];m=b.fromExtent(m);var v=b.create();f.computeRowColExtent(m,r,q,v);r=(v[2]-v[0])*(v[3]-v[1]);r>a.MAX_ROOT_TILES?(c=c[0].scale*Math.pow(2,c[0].level),
l=Math.max((m[3]-m[1])/k.size[1],(m[2]-m[0])/k.size[0])*c/l,m=Math.floor(Math.log(l)/Math.log(10)),l=Math.ceil(l/Math.pow(10,m))*Math.pow(10,m),l=new d("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(c).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+l.toLocaleString()+".",{level0Scale:c,suggestedLevel0Scale:l,requiredNumRootTiles:r,allowedNumRootTiles:a.MAX_ROOT_TILES})):l=null;return l?l:p&&!k.spatialReference.equals(p)?new d("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the local scene"):null}})},"esri/views/3d/terrain/TilingScheme":function(){define(["../../../core/Error","../../../geometry/SpatialReference","../../../geometry/support/scaleUtils","../support/projectionUtils","../support/mathUtils"],function(w,l,f,a,d){var b=a.webMercator.x2lon,q=a.webMercator.y2lat,t=[0,0,0,0],m=function(a){var b=m._checkUnsupported(a);if(b)throw b;this.spatialReference=a.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;
this._isWGS84=this.spatialReference.isWGS84;this.origin=[a.origin.x,a.origin.y];this.pixelSize=[a.size[0],a.size[1]];var d=a.lods.reduce(function(a,b,d){b.level<a.min&&(a.min=b.level,a.minIndex=d);a.max=Math.max(a.max,b.level);return a},{min:Infinity,minIndex:0,max:-Infinity}),f=a.lods[d.minIndex],k=Math.pow(2,f.level),b=f.resolution*k,f=f.scale*k;this.levels=Array(d.max+1);for(d=0;d<this.levels.length;d++)this.levels[d]={resolution:b,scale:f,tileSize:[b*a.size[0],b*a.size[1]]},b/=2,f/=2};m.prototype=
{getExtent:function(a,f,m,l,v){l=l||Array(4);var k=this.levels[a];a=k.tileSize[0];k=k.tileSize[1];l[0]=this.origin[0]+m*a;l[2]=l[0]+a;l[3]=this.origin[1]-f*k;l[1]=l[3]-k;v&&(this._isWebMercator?(v[0]=b(l[0]),v[1]=q(l[1]),v[2]=b(l[2]),v[3]=q(l[3])):this._isWGS84&&(v[0]=d.deg2rad(l[0]),v[1]=d.deg2rad(l[1]),v[2]=d.deg2rad(l[2]),v[3]=d.deg2rad(l[3])))},ensureMaxLod:function(a){for(;this.levels.length<=a;){var b=this.levels[this.levels.length-1],d=b.resolution/2;this.levels.push({resolution:d,scale:b.scale/
2,tileSize:[d*this.pixelSize[0],d*this.pixelSize[1]]})}},capMaxLod:function(a){this.levels.length>a+1&&(this.levels.length=a+1)},getMaxLod:function(){return this.levels.length-1},scaleAtLevel:function(a){return this.levels[0].scale/Math.pow(2,a)},levelAtScale:function(a){var b=this.levels[0].scale;return a>=b?0:Math.log(b/a)*Math.LOG2E},compatibleWith:function(a){if(!(a instanceof m)){if(m._checkUnsupported(a))return!1;a=new m(a)}if(!a.spatialReference.equals(this.spatialReference)||a.pixelSize[0]!==
this.pixelSize[0]||a.pixelSize[1]!==this.pixelSize[1])return!1;var b=Math.min(this.levels.length,a.levels.length)-1,f=this.levels[b].resolution,k=d.floatEqualAbsolute,l=.5*f;if(!k(a.origin[0],this.origin[0],l)||!k(a.origin[1],this.origin[1],l))return!1;l=.5*f/Math.pow(2,b)/Math.max(this.pixelSize[0],this.pixelSize[1])*12;return k(f,a.levels[b].resolution,l)},rootTilesInExtent:function(a,b,d){var f=this.levels[0].tileSize;m.computeRowColExtent(a,f,this.origin,t);a=t[1];var k=t[3],p=t[0],l=t[2],q=l-
p,x=k-a;q*x>d&&(d=Math.floor(Math.sqrt(d)),x>d&&(a=a+Math.floor(.5*x)-Math.floor(.5*d),k=a+d),q>d&&(p=p+Math.floor(.5*q)-Math.floor(.5*d),l=p+d));d=Array((l-p)*(k-a));q=0;for(x=a;x<k;x++)for(var c=p;c<l;c++)d[q++]=[0,x,c];b&&(b[0]=this.origin[0]+p*f[0],b[1]=this.origin[1]-k*f[1],b[2]=this.origin[0]+l*f[0],b[3]=this.origin[1]-a*f[1]);return d}};m.computeRowColExtent=function(a,b,d,f){var k=.001*(a[2]-a[0]+(a[3]-a[1]));f[0]=Math.floor((a[0]+k-d[0])/b[0]);f[2]=Math.ceil((a[2]-k-d[0])/b[0]);f[1]=Math.floor((d[1]-
a[3]+k)/b[1]);f[3]=Math.ceil((d[1]-a[1]-k)/b[1])};m.isPowerOfTwo=function(a){a=a.lods;var b=a[0].resolution*Math.pow(2,a[0].level);return!a.some(function(a){return!d.floatEqualRelative(a.resolution,b/Math.pow(2,a.level))})};m.hasGapInLevels=function(a){a=a.lods.map(function(a){return a.level});a.sort(function(a,b){return a-b});for(var b=1;b<a.length;b++)if(a[b]!==a[0]+b)return!0;return!1};m.tileSizeSupported=function(a){var b=a.size[1];return b===a.size[0]&&0===(b&b-1)&&128<=b&&512>=b};m._checkUnsupported=
function(a){return a?1>a.lods.length?new w("tilingscheme:generic","Tiling scheme must have at least one level"):m.isPowerOfTwo(a)?null:new w("tilingscheme:power-of-two","Tiling scheme must be power of two"):new w("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};m.checkUnsupported=function(a){var b=m._checkUnsupported(a);return b?b:m.hasGapInLevels(a)?new w("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):m.tileSizeSupported(a)?
null:new w("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]")};m.fromExtent=function(a,b){var d=a[2]-a[0],k=a[3]-a[1],p=f.getMetersPerUnitForSR(b),l=1.2*Math.max(d,k);a=new m({size:[256,256],origin:{x:a[0]-.5*(l-d),y:a[3]+.5*(l-k)},lods:[{level:0,resolution:l/256,scale:1/(256/96*.0254/(l*p))}],spatialReference:b});a.ensureMaxLod(20);return a};m.WebMercatorAuxiliarySphereTileInfo={size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:l.WebMercator,
lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]};m.makeWebMercatorAuxiliarySphere=function(a){a=a||19;var b=new m(m.WebMercatorAuxiliarySphereTileInfo);b.ensureMaxLod(a);return b};m.WebMercatorAuxiliarySphere=m.makeWebMercatorAuxiliarySphere(19);m.makeWGS84WithTileSize=function(a,b){b=b||16;var d=256/a;a=new m({size:[a,a],origin:{x:-180,y:90},spatialReference:l.WGS84,lods:[{level:0,resolution:.703125*d,scale:2.95497598570834E8*d}]});a.ensureMaxLod(b);return a};return m})},
"esri/views/3d/terrain/TerrainConst":function(){define(["require","exports","./TilingScheme","../support/aaBoundingRect"],function(w,l,f,a){Object.defineProperty(l,"__esModule",{value:!0});(function(a){a[a.MAP=0]="MAP";a[a.ELEVATION=1]="ELEVATION";a[a.LAYER_CLASS_COUNT=2]="LAYER_CLASS_COUNT"})(l.LayerClass||(l.LayerClass={}));(function(a){a[a.NONE=0]="NONE";a[a.SPLIT=1]="SPLIT";a[a.VSPLITMERGE=2]="VSPLITMERGE";a[a.MERGE=4]="MERGE";a[a.DECODE_ELEVATION=8]="DECODE_ELEVATION";a[a.UPDATE_GEOMETRY=16]=
"UPDATE_GEOMETRY";a[a.UPDATE_TEXTURE=32]="UPDATE_TEXTURE"})(l.TileUpdateTypes||(l.TileUpdateTypes={}));l.TILE_LOADING_DEBUGLOG=!1;l.MAX_ROOT_TILES=64;l.MAX_TILE_TESSELATION=512;l.ELEVATION_NODATA_VALUE=3.40282347E38/10;l.noDataValueOpt={noDataValue:l.ELEVATION_NODATA_VALUE};l.ELEVATION_DESIRED_RESOLUTION_LEVEL=4;l.TILEMAP_SIZE_EXP=5;l.TILEMAP_SIZE=1<<l.TILEMAP_SIZE_EXP;l.WEBMERCATOR_WORLD_EXTENT=a.create([0,0,0,0]);f.WebMercatorAuxiliarySphere.getExtent(0,0,0,l.WEBMERCATOR_WORLD_EXTENT);l.GEOGRAPHIC_WORLD_EXTENT=
a.create([-180,-90,180,90]);l.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";l.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";l.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC"})},
"esri/views/3d/terrain/terrainUtilsSpherical":function(){define(["require","exports","./TilingScheme","../../../core/Error"],function(w,l,f,a){Object.defineProperty(l,"__esModule",{value:!0});l.autoUpdateSkirtsVisibility=function(a,b){};l.checkIfTileInfoSupportedForViewSR=function(d,b,l){b=d.lods.length-1;if(d.spatialReference.isWebMercator){if(!f.makeWebMercatorAuxiliarySphere(b).compatibleWith(d))return new a("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(d.spatialReference.isWGS84){if(!f.makeWGS84WithTileSize(d.size[1],
b).compatibleWith(d))return new a("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme")}else return new a("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(l&&!d.spatialReference.equals(l))return new a("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}})},"esri/layers/BaseTileLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../request ../core/Error ../geometry/Extent ../geometry/SpatialReference ./Layer ./mixins/ScaleRangeLayer ./support/TileInfo ../core/accessorSupport/decorators".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x){var z={id:"0/0/0",level:0,row:0,col:0,extent:null};return function(k){function m(){var a=null!==k&&k.apply(this,arguments)||this;a.tileInfo=p.create({spatialReference:t.WebMercator,size:256});a.type="base-tile";a.fullExtent=new q(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,t.WebMercator);a.spatialReference=t.WebMercator;return a}f(m,k);m.prototype.getTileBounds=function(a,b,d,c){c=c||[0,0,0,0];z.level=a;z.row=b;z.col=d;z.extent=c;this.tileInfo.updateTileInfo(z);
z.extent=null;return c};m.prototype.getTileUrl=function(a,d,f){throw new b("basetilelayer:gettileurl-not-implemented","getTileUrl() is not implemented");};m.prototype.fetchTile=function(a,b,f,c){a=this.getTileUrl(a,b,f);return"string"===typeof a?d(a,{responseType:"image",allowImageDataAccess:c&&c.allowImageDataAccess||!1}).then(function(a){return a.data}):a.then(function(a){return d(a,{responseType:"image"})}).then(function(a){return a.data})};a([x.shared({"2d":"../views/2d/layers/TiledLayerView2D",
"3d":"../views/3d/layers/TileLayerView3D"})],m.prototype,"viewModulePaths",void 0);a([x.property({type:p})],m.prototype,"tileInfo",void 0);a([x.property({readOnly:!0,value:"base-tile"})],m.prototype,"type",void 0);a([x.property()],m.prototype,"fullExtent",void 0);a([x.property()],m.prototype,"spatialReference",void 0);return m=a([x.subclass("esri.layers.BaseTileLayer")],m)}(x.declared(m,k))})},"esri/layers/BaseElevationLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Error ../geometry/Extent ../geometry/SpatialReference ./Layer ./support/TileInfo ../core/accessorSupport/decorators".split(" "),
function(w,l,f,a,d,b,q,t,m,k){var p={id:"0/0/0",level:0,row:0,col:0,extent:null};return function(l){function t(){var a=null!==l&&l.apply(this,arguments)||this;a.tileInfo=m.create({spatialReference:q.WebMercator,size:256});a.fullExtent=new b(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,q.WebMercator);a.spatialReference=q.WebMercator;a.type="base-elevation";return a}f(t,l);t.prototype.getTileBounds=function(a,b,d,f){f=f||[0,0,0,0];p.level=a;p.row=b;p.col=d;p.extent=f;this.tileInfo.updateTileInfo(p);
p.extent=null;return f};t.prototype.fetchTile=function(a,b,f,k){throw new d("BaseElevationLayer:fetchtile-not-implemented","fetchTile() is not implemented");};a([k.shared({"3d":"../views/3d/layers/ElevationLayerView3D"})],t.prototype,"viewModulePaths",void 0);a([k.property({type:m})],t.prototype,"tileInfo",void 0);a([k.property()],t.prototype,"fullExtent",void 0);a([k.property()],t.prototype,"spatialReference",void 0);a([k.property({readOnly:!0,value:"base-elevation"})],t.prototype,"type",void 0);
return t=a([k.subclass("esri.layers.BaseElevationLayer")],t)}(k.declared(t))})},"esri/layers/VectorTileLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/_base/lang ../core/accessorSupport/decorators ../core/Error ../core/MultiOriginJSONSupport ../core/urlUtils ../core/promiseUtils ../core/lang ../request ../geometry/Extent ../geometry/SpatialReference ../portal/support/jsonContext ./TiledLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/ArcGISCachedService ./support/TileInfo ./support/vectorTileLayerLoader ../views/vectorTiles/style/StyleRepository ../views/vectorTiles/SchemaHelper".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c,D,B,I,G,H){return function(c){function l(a,b){a=c.call(this)||this;a.currentStyleInfo=null;a.fullExtent=null;a.operationalLayerType="VectorTileLayer";a.tileInfo=null;a.type="vector-tile";a.url=null;return a}f(l,c);l.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?d.mixin({},{url:a},b):a};l.prototype.load=function(){var a=this,b=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1}).then(function(){if(a.portalItem&&
a.portalItem.id){var b=a.portalItem.itemUrl+"/resources/styles/root.json";return x(b,{query:{f:"json"}}).then(function(c){c.data&&a.read({url:b},r.createForItem(a.portalItem))})}}).always(function(){return a.loadStyle()});this.addResolvingPromise(b);return this};Object.defineProperty(l.prototype,"attributionDataUrl",{get:function(){var a=this.currentStyleInfo;return(a=a&&a.serviceUrl&&m.urlToObject(a.serviceUrl))?this._getDefaultAttribution(a.path):null},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,
"serviceUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.serviceUrl||null},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"spatialReference",{get:function(){return this.tileInfo&&this.tileInfo.spatialReference||null},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"styleUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.styleUrl||null},enumerable:!0,configurable:!0});l.prototype.writeStyleUrl=function(a,b){a&&m.isProtocolRelative(a)&&
(a="https:"+a);a&&!p.endsWith(a,"root.json")&&(a=m.join(a,"root.json"));b.styleUrl=a};l.prototype.readTileIndexType=function(a,b){return b.type};l.prototype.readTileIndexUrl=function(a,b){return m.join(this.serviceUrl,b.tileMap)};l.prototype.readTileServers=function(a,b){var c=this;a=b.tiles;this.serviceUrl&&a.forEach(function(a,b,d){d[b]=m.join(c.serviceUrl,a)});return a};l.prototype.readVersion=function(a,b){return b.version?parseFloat(b.version):parseFloat(b.currentVersion)};l.prototype.readCompatibleTileInfo256=
function(a,b){return B.fromJSON(H.create256x256CompatibleTileInfo(b.tileInfo))};l.prototype.readCompatibleTileInfo512=function(a,b){return B.fromJSON(H.create512x512CompatibleTileInfo(b.tileInfo))};l.prototype.loadStyle=function(a){a=a||this.url;if(this._loadingPromise&&"string"===typeof a&&this.url===a)return this._loadingPromise;var b=this._loadingPromise;this._loadingPromise=this._getSourceAndStyle(a);b&&!b.isFulfilled()&&b.cancel();return this._loadingPromise};l.prototype.getTileUrl=function(a,
b,c){var d=this.tileServers[b%this.tileServers.length];return d=d.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,b.toString()).replace(/\{x\}/gi,c.toString())};l.prototype.write=function(a,b){return b&&b.origin&&!this.styleUrl?(b.messages&&b.messages.push(new q("vectortilelayer:unsupported","VectorTileLayer ("+this.title+", "+this.id+") with style defined by JSON only are not supported",{layer:this})),null):this.inherited(arguments,[a,b])};l.prototype._getSourceAndStyle=function(a){var b=this;
return a?I.loadMetadata(a).then(function(a){b._set("currentStyleInfo",{serviceUrl:a.serviceUrl,styleUrl:a.styleUrl,spriteUrl:a.spriteUrl,glyphsUrl:a.glyphsUrl,style:a.style,layerDefinition:a.layerDefinition});b._set("styleRepository",new G(a.style,a));b.read(a.layerDefinition)}):k.reject(Error("invalid style!"))};l.prototype._getDefaultAttribution=function(a){var b=a.match(/^https?:\/\/(basemaps|basemapsbeta)\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);
if(b&&(a=b[3]&&b[3].toLowerCase()))for(var b=b[2]||"",c=0,d=["World_Basemap","World_Basemap_WGS84"];c<d.length;c++){var f=d[c];if(-1<f.toLowerCase().indexOf(a))return m.normalize("//static.arcgis.com/attribution/Vector"+b+"/"+f)}};a([b.shared({"2d":"../views/2d/layers/VectorTileLayerView2D","3d":"../views/3d/layers/VectorTileLayerView3D"})],l.prototype,"viewModulePaths",void 0);a([b.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],l.prototype,"attributionDataUrl",null);a([b.property({readOnly:!0})],
l.prototype,"currentStyleInfo",void 0);a([b.property({type:z,readOnly:!0})],l.prototype,"fullExtent",void 0);a([b.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],l.prototype,"serviceUrl",null);a([b.property({type:v,dependsOn:["tileInfo"],readOnly:!0})],l.prototype,"spatialReference",null);a([b.property({readOnly:!0})],l.prototype,"styleRepository",void 0);a([b.property({readOnly:!0,dependsOn:["currentStyleInfo"],json:{write:{ignoreOrigin:!0}}})],l.prototype,"styleUrl",null);a([b.writer("styleUrl")],
l.prototype,"writeStyleUrl",null);a([b.property({readOnly:!0})],l.prototype,"tileIndexType",void 0);a([b.reader("tileIndexType",["tileIndexType","type"])],l.prototype,"readTileIndexType",null);a([b.property({readOnly:!0})],l.prototype,"tileIndexUrl",void 0);a([b.reader("tileIndexUrl",["tileIndexUrl","tileMap"])],l.prototype,"readTileIndexUrl",null);a([b.property({readOnly:!0,type:B})],l.prototype,"tileInfo",void 0);a([b.property({readOnly:!0})],l.prototype,"tileServers",void 0);a([b.reader("tileServers",
["tiles"])],l.prototype,"readTileServers",null);a([b.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],l.prototype,"type",void 0);a([b.property({json:{origins:{webDocument:{read:{source:"styleUrl"}},portalItem:{read:{source:"url"}}},write:!1,read:!1}})],l.prototype,"url",void 0);a([b.property({readOnly:!0})],l.prototype,"version",void 0);a([b.reader("version",["version","currentVersion"])],l.prototype,"readVersion",null);a([b.property({readOnly:!0})],l.prototype,"compatibleTileInfo256",
void 0);a([b.reader("compatibleTileInfo256",["tileInfo"])],l.prototype,"readCompatibleTileInfo256",null);a([b.property({readOnly:!0})],l.prototype,"compatibleTileInfo512",void 0);a([b.reader("compatibleTileInfo512",["tileInfo"])],l.prototype,"readCompatibleTileInfo512",null);return l=a([b.subclass("esri.layers.VectorTileLayer")],l)}(b.declared(u,C,E,c,t,D))})},"esri/portal/support/jsonContext":function(){define(["require","exports","../Portal","../../core/urlUtils"],function(w,l,f,a){Object.defineProperty(l,
"__esModule",{value:!0});l.createForItem=function(d){return{origin:"portal-item",url:a.urlToObject(d.itemUrl),portal:d.portal||f.getDefault()}}})},"esri/layers/support/vectorTileLayerLoader":function(){define("require exports dojo/has dojo/_base/lang ../../core/promiseUtils ../../core/urlUtils ../../config ../../request".split(" "),function(w,l,f,a,d,b,q,t){function m(a){if(a){var d=b.getOrigin(a);b.canUseXhr(d)||-1!==r.indexOf(d)||r.push(d);return a}}function k(a,d,f){if(null!=d.sources){f&&-1!==
f.path.indexOf("root.json")&&(f.path=f.path.substr(0,f.path.indexOf("root.json")),a.styleUrl=f.path);var c=z(d,f),k=d.sprite||null,m=d.glyphs||null;c&&c.url&&(c=f&&f.path?f.path:c.url,d.sprite&&!b.isAbsolute(d.sprite)&&(k=b.normalize(b.join(c,d.sprite))),d.glyphs&&!b.isAbsolute(d.glyphs)&&(m=b.normalize(b.join(c,d.glyphs))));a.style=d;a.spriteUrl=k;a.glyphsUrl=m;return x(a,d,f)}if(d.hasOwnProperty("tileInfo"))return a.layerDefinition=d,a.serviceUrl=f.path,p(a,d,f)}function p(a,d,f){d=d.defaultStyles;
b.isAbsolute(d)?a.styleUrl=b.normalize(d):a.styleUrl=b.normalize(b.join(f.path,d));m(a.styleUrl);return t(b.join(a.styleUrl,"root.json"),{responseType:"json"}).then(function(c){var d=c.data.sprite||null,f=c.data.glyphs||null;d&&!b.isAbsolute(d)&&(d=b.normalize(b.join(a.styleUrl,d)));f&&!b.isAbsolute(f)&&(f=b.normalize(b.join(a.styleUrl,f)));a.spriteUrl=d;a.glyphsUrl=f;return a.style=c.data})}function x(a,f,k){(f=z(f,k))||d.reject("Source isn't available in the syle object!");if(f.url)return a.serviceUrl=
f.url,b.isAbsolute(a.serviceUrl)||(a.serviceUrl=b.join(k.path,a.serviceUrl)),m(a.serviceUrl),t(a.serviceUrl,{query:{f:"json"},responseType:"json"}).then(function(b){a.layerDefinition=v(b.data);return a});a.layerDefinition=v(f);return d.resolve(a)}function z(a,d){if(!a.sources)return null;var f=a.sources;a=null;if(f.esri)a=f.esri,d&&a.url&&!b.isAbsolute(a.url)&&(f=d.path.substring(0,d.path.lastIndexOf("/")),a.url=b.join(f,a.url));else{for(var c=0,k=Object.keys(f);c<k.length;c++)if(d=k[c],-1!==d.toLocaleLowerCase().indexOf("street")&&
"vector"===a.type){a=f[d];break}if(!a)for(c=0,k=Object.keys(f);c<k.length&&(d=k[c],a=f[d],"vector"!==a.type);c++);}return a}function v(a){if(a.hasOwnProperty("tileInfo"))return a;for(var b={xmin:-2.0037507067161843E7,ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,spatialReference:{wkid:102100}},d=(b.xmax-b.xmin)/512,c=[],f=a.hasOwnProperty("minzoom")?parseFloat(a.minzoom):0,k=a.hasOwnProperty("maxzoom")?parseFloat(a.maxzoom):16;f<k;f++){var p=d/Math.pow(2,f);c.push({level:f,
scale:Math.floor(3779.527559055118*p),resolution:p})}a.tiles.forEach(m);return{capabilities:"TilesOnly",initialExtent:b,fullExtent:b,minScale:c[0].scale,maxScale:c[c.length-1].scale,tiles:a.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:c,spatialReference:{wkid:102100}}}}Object.defineProperty(l,"__esModule",{value:!0});var r=q.defaults&&q.defaults.io.corsEnabledServers||q.request.corsEnabledServers;l.loadMetadata=function(f){if(!f)return d.reject("invalid input URL!");
var p={layerDefinition:null,parsedUrl:null,serviceUrl:null,style:null,styleUrl:null,url:null,spriteUrl:null,glyphsUrl:null};if("string"!==typeof f)return k(p,f,null).then(function(){return p});f=p.url=b.normalize(f);var l=p.parsedUrl=b.urlToObject(f);m(f);return t(l.path,{responseType:"json",query:a.mixin({f:"json"},l.query)}).then(function(a){return k(p,a.data,l)}).then(function(){return p})}})},"esri/views/vectorTiles/style/StyleRepository":function(){define(["require","exports","./StyleLayer",
"dojo/has"],function(w,l,f,a){return function(){function d(b,f){this.styleJSON=b;this.version=parseFloat(b.version);this.sprite=f?f.spriteUrl:b.sprite;this.glyphs=f?f.glyphsUrl:b.glyphs;if(a("stable-symbol-rendering")){var l=(b.layers||[]).filter(function(a){return a.layout&&a.layout["text-font"]})[0];l&&(b.layers||[]).forEach(function(a){a.layout&&a.layout["text-font"]&&(a.layout["text-font"]=l.layout["text-font"])})}this.layers=(b.layers||[]).map(d._create);this._identifyRefLayers()}d.prototype._identifyRefLayers=
function(){for(var a=[],d=[],f=0,m=this.layers;f<m.length;f++){var k=m[f];if(1===k.type){var p=k.sourceLayer,p=p+("|"+JSON.stringify(k.minzoom)),p=p+("|"+JSON.stringify(k.maxzoom)),p=p+("|"+JSON.stringify(k.filter));a.push({key:p,layer:k})}2===k.type&&(p=k.sourceLayer,p+="|"+JSON.stringify(k.minzoom),p+="|"+JSON.stringify(k.maxzoom),p+="|"+JSON.stringify(k.filter),p+="|"+JSON.stringify(k.layout&&k.layout["line-cap"]),p+="|"+JSON.stringify(k.layout&&k.layout["line-join"]),d.push({key:p,layer:k}))}this._assignRefLayers(a);
this._assignRefLayers(d)};d.prototype._assignRefLayers=function(a){a.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});for(var b,d,f=a.length,k=0;k<f;k++){var p=a[k];if(p.key===b)p.layer.refLayerId=d;else if(b=p.key,d=p.layer.id,1===p.layer.type&&!p.layer.hasPaintProperty("fill-outline-color"))for(var l=k+1;l<f;l++){var z=a[l];if(z.key===b){if(z.layer.hasPaintProperty("fill-outline-color")){a[k]=z;a[l]=p;d=z.layer.id;break}}else break}}};d._create=function(a,d,l){d=1-1/(l.length+1)*(1+d);
switch(a.type){case "background":return new f.StyleLayer(0,a,d);case "fill":return new f.StyleLayer(1,a,d);case "line":return new f.StyleLayer(2,a,d);case "symbol":return new f.StyleLayer(3,a,d);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":throw Error("Unsupported vector tile circle layer");}throw Error("Unknown vector tile layer");};return d}()})},"esri/views/vectorTiles/style/StyleLayer":function(){define(["require","exports","./StyleDefinition","./StyleProperty",
"./Filter"],function(w,l,f,a,d){Object.defineProperty(l,"__esModule",{value:!0});w=function(){function b(a,b,d){this.type=a;this.id=b.id;this.source=b.source;this.sourceLayer=b["source-layer"];this.minzoom=b.minzoom;this.maxzoom=b.maxzoom;this.filter=b.filter;this.layout=b.layout;this.paint=b.paint;this.z=d;switch(a){case 0:this._layoutDefinition=f.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=f.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=f.StyleDefinition.fillLayoutDefinition;
this._paintDefinition=f.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=f.StyleDefinition.lineLayoutDefinition;this._paintDefinition=f.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=f.StyleDefinition.symbolLayoutDefinition,this._paintDefinition=f.StyleDefinition.symbolPaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}b.prototype.getFeatureFilter=function(){return void 0!==this._featureFilter?
this._featureFilter:this._featureFilter=d.createFilter(this.filter)};b.prototype.hasLayoutProperty=function(a){var b=this._layoutProperties;return b&&b[a]?!0:!1};b.prototype.hasPaintProperty=function(a){var b=this._paintProperties;return b?void 0!==b[a]:!1};b.prototype.getLayoutValue=function(a,b){var d,f=this._layoutProperties;f&&(f=f[a])&&(d=f.getValue(b));a=this._layoutDefinition[a];void 0===d&&(d=a["default"]);"enum"===a.type&&(d=a.values.indexOf(d));return d};b.prototype.getPaintValue=function(a,
b){var d,f=this._paintProperties;f&&(f=f[a])&&(d=f.getValue(b));a=this._paintDefinition[a];void 0===d&&(d=a["default"]);"enum"===a.type&&(d=a.values.indexOf(d));return d};b.prototype._parseLayout=function(b){var d={},f;for(f in b)d[f]=new a(this._layoutDefinition[f],b[f]);return d};b.prototype._parsePaint=function(b){var d={},f;for(f in b)d[f]=new a(this._paintDefinition[f],b[f]);return d};return b}();l.StyleLayer=w;w=function(){return function(a,d){this.cap=a.getLayoutValue("line-cap",d);this.join=
a.getLayoutValue("line-join",d);this.miterLimit=a.getLayoutValue("line-miter-limit",d);this.roundLimit=a.getLayoutValue("line-round-limit",d)}}();l.LineLayout=w;w=function(){return function(a,d,f){this.allowOverlap=a.getLayoutValue("icon-allow-overlap",d);this.ignorePlacement=a.getLayoutValue("icon-ignore-placement",d);this.optional=a.getLayoutValue("icon-optional",d);this.rotationAlignment=a.getLayoutValue("icon-rotation-alignment",d);this.size=a.getLayoutValue("icon-size",d);this.rotate=a.getLayoutValue("icon-rotate",
d);this.padding=a.getLayoutValue("icon-padding",d);this.keepUpright=a.getLayoutValue("icon-keep-upright",d);this.offset=a.getLayoutValue("icon-offset",d);2===this.rotationAlignment&&(this.rotationAlignment=f?0:1)}}();l.IconLayout=w;w=function(){return function(a,d,f){this.allowOverlap=a.getLayoutValue("text-allow-overlap",d);this.ignorePlacement=a.getLayoutValue("text-ignore-placement",d);this.optional=a.getLayoutValue("text-optional",d);this.rotationAlignment=a.getLayoutValue("text-rotation-alignment",
d);this.font=a.getLayoutValue("text-font",d);this.maxWidth=a.getLayoutValue("text-max-width",d);this.lineHeight=a.getLayoutValue("text-line-height",d);this.letterSpacing=a.getLayoutValue("text-letter-spacing",d);this.justify=a.getLayoutValue("text-justify",d);this.anchor=a.getLayoutValue("text-anchor",d);this.maxAngle=a.getLayoutValue("text-max-angle",d);this.size=a.getLayoutValue("text-size",d);this.rotate=a.getLayoutValue("text-rotate",d);this.padding=a.getLayoutValue("text-padding",d);this.keepUpright=
a.getLayoutValue("text-keep-upright",d);this.transform=a.getLayoutValue("text-transform",d);this.offset=a.getLayoutValue("text-offset",d);2===this.rotationAlignment&&(this.rotationAlignment=f?0:1)}}();l.TextLayout=w})},"esri/views/vectorTiles/style/StyleDefinition":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});w=function(){function f(){}f.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],"default":"visible"}};f.fillLayoutDefinition=
{visibility:{type:"enum",values:["visible","none"],"default":"visible"}};f.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],"default":"visible"},"line-cap":{type:"enum",values:["butt","round","square"],"default":"butt"},"line-join":{type:"enum",values:["bevel","round","miter"],"default":"miter"},"line-miter-limit":{type:"number","default":2},"line-round-limit":{type:"number","default":1.05}};f.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],"default":"visible"},
"symbol-placement":{type:"enum",values:["point","line"],"default":"point"},"symbol-spacing":{type:"number",minimum:1,"default":250},"symbol-avoid-edges":{type:"boolean","default":!1},"icon-image":{type:"string"},"icon-allow-overlap":{type:"boolean","default":!1},"icon-ignore-placement":{type:"boolean","default":!1},"icon-optional":{type:"boolean","default":!1},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],"default":"auto"},"icon-size":{type:"number",minimum:0,"default":1},
"icon-rotate":{type:"number","default":0},"icon-padding":{type:"number",minimum:0,"default":2},"icon-keep-upright":{type:"boolean","default":!1},"icon-offset":{type:"array",value:"number",length:2,"default":[0,0]},"text-field":{type:"string"},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],"default":"auto"},"text-font":{type:"array",value:"string","default":["Open Sans Regular","Arial Unicode MS Regular"]},"text-size":{type:"number",minimum:0,"default":16},"text-max-width":{type:"number",
minimum:0,"default":10},"text-line-height":{type:"number","default":1.2},"text-letter-spacing":{type:"number","default":0},"text-justify":{type:"enum",values:["left","center","right"],"default":"center"},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),"default":"center"},"text-max-angle":{type:"number",minimum:0,"default":45},"text-rotate":{type:"number","default":0},"text-padding":{type:"number",minimum:0,"default":2},"text-keep-upright":{type:"boolean",
"default":!0},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],"default":"none"},"text-offset":{type:"array",value:"number",length:2,"default":[0,0]},"text-allow-overlap":{type:"boolean","default":!1},"text-ignore-placement":{type:"boolean","default":!1},"text-optional":{type:"boolean","default":!1}};f.backgroundPaintDefinition={"background-opacity":{type:"number",minimum:0,maximum:1,"default":1},"background-color":{type:"color","default":[0,0,0,1]},"background-pattern":{type:"string"}};
f.fillPaintDefinition={"fill-opacity":{type:"number",minimum:0,maximum:1,"default":1},"fill-antialias":{type:"boolean","default":!0},"fill-color":{type:"color","default":[0,0,0,1]},"fill-outline-color":{type:"color","default":[0,0,0,0]},"fill-translate":{type:"array",value:"number",length:2,"default":[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],"default":"map"},"fill-pattern":{type:"string"}};f.linePaintDefinition={"line-opacity":{type:"number",minimum:0,maximum:1,"default":1},
"line-color":{type:"color","default":[0,0,0,1]},"line-translate":{type:"array",value:"number",length:2,"default":[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],"default":"map"},"line-width":{type:"number",minimum:0,"default":1},"line-gap-width":{type:"number",minimum:0,"default":0},"line-offset":{type:"number","default":0},"line-blur":{type:"number",minimum:0,"default":0},"line-dasharray":{type:"array",value:"number","default":[]},"line-pattern":{type:"string"}};f.symbolPaintDefinition=
{"icon-opacity":{type:"number",minimum:0,maximum:1,"default":1},"icon-color":{type:"color","default":[0,0,0,1]},"icon-halo-color":{type:"color","default":[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,"default":0},"icon-halo-blur":{type:"number",minimum:0,"default":0},"icon-translate":{type:"array",value:"number",length:2,"default":[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],"default":"map"},"text-opacity":{type:"number",minimum:0,maximum:1,"default":1},"text-color":{type:"color",
"default":[0,0,0,1]},"text-halo-color":{type:"color","default":[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,"default":0},"text-halo-blur":{type:"number",minimum:0,"default":0},"text-translate":{type:"array",value:"number",length:2,"default":[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],"default":"map"}};f.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,"default":1},"raster-hue-rotate":{type:"number","default":0},"raster-brightness-min":{type:"number",
minimum:0,maximum:1,"default":0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,"default":1},"raster-saturation":{type:"number",minimum:-1,maximum:1,"default":0},"raster-contrast":{type:"number",minimum:-1,maximum:1,"default":0},"raster-fade-duration":{type:"number",minimum:0,"default":300}};f.circlePaintDefinition={"circle-opacity":{type:"number",minimum:0,maximum:1,"default":1},"circle-radius":{type:"number",minimum:0,"default":5},"circle-color":{type:"color","default":[0,0,0,1]},"circle-blur":{type:"number",
minimum:0,"default":0},"circle-translate":{type:"array",value:"number",length:2,"default":[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],"default":"map"}};return f}();l.StyleDefinition=w})},"esri/views/vectorTiles/style/StyleProperty":function(){define(["require","exports","../../../Color","../GeometryUtils"],function(w,l,f,a){return function(){function d(a,f){switch(a.type){case "number":a=!0;break;case "color":a=!0;f=d._parseColor(f);break;case "array":a="number"===a.value;
break;default:a=!1}this.getValue=a?this._interpolate(f):this._piecewise(f)}d.prototype._piecewise=function(a){var b=a.stops;return b?function(a){var d=b.length;if(0!==d){for(var f=0,p=0;p<d;p++)if(b[p][0]<=a)f=p;else break;return b[f][1]}}:function(){return a}};d.prototype._interpolate=function(b){var d=b.stops;if(d){var f=b.base||1;return function(b){for(var k,m,l=d.length,q=0;q<l;q++){var v=d[q];if(v[0]<=b)k=v;else{m=v;break}}if(k&&m){q=m[0]-k[0];b-=k[0];b=1===f?b/q:(Math.pow(f,b)-1)/(Math.pow(f,
q)-1);if(Array.isArray(k[1])){k=k[1];m=m[1];l=[];for(q=0;q<k.length;q++)l.push(a.interpolate(k[q],m[q],b));return l}return a.interpolate(k[1],m[1],b)}if(k)return k[1];if(m)return m[1]}}return function(){return b}};d._parseColor=function(a){if(Array.isArray(a))return a;if("string"===typeof a)return a=new f(a),f.toUnitRGBA(a);if(a&&a.stops)return a.stops=a.stops.map(function(a){return[a[0],d._parseColor(a[1])]}),a;throw Error("Incorrect color definition "+a);};return d}()})},"esri/views/vectorTiles/GeometryUtils":function(){define(["require",
"exports"],function(w,l){function f(a,b){a%=b;return 0<=a?a:a+b}Object.defineProperty(l,"__esModule",{value:!0});l.C_INFINITY=Number.POSITIVE_INFINITY;l.C_PI=Math.PI;l.C_2PI=2*l.C_PI;l.C_PI_BY_2=l.C_PI/2;l.C_RAD_TO_256=128/l.C_PI;l.C_256_TO_RAD=l.C_PI/128;l.C_DEG_TO_256=256/360;l.C_DEG_TO_RAD=l.C_PI/180;l.C_SQRT2=1.414213562;l.C_SQRT2_INV=1/l.C_SQRT2;var a=1/Math.LN2;l.positiveMod=f;l.radToByte=function(a){return f(a*l.C_RAD_TO_256,256)};l.degToByte=function(a){return f(a*l.C_DEG_TO_256,256)};l.log2=
function(d){return Math.log(d)*a};l.sqr=function(a){return a*a};l.clamp=function(a,b,f){return Math.min(Math.max(a,b),f)};l.interpolate=function(a,b,f){return a*(1-f)+b*f};l.between=function(a,b,f){return a>=b&&a<=f||a>=f&&a<=b}})},"esri/views/vectorTiles/style/Filter":function(){define(["require","exports"],function(w,l){return function(){function f(a,d,b){this._op=a;"$type"===d?(this._val=b instanceof Array?b.map(function(a){return f._types.indexOf(a)}):f._types.indexOf(b),this._op+=11):(this._key=
d,this._val=b)}f.prototype.filter=function(a){switch(this._op){case 0:return this._val;case 1:return a.values[this._key]===this._val;case 2:return a.values[this._key]!==this._val;case 3:return a.values[this._key]<this._val;case 4:return a.values[this._key]>this._val;case 5:return a.values[this._key]<=this._val;case 6:return a.values[this._key]>=this._val;case 7:return-1!==this._val.indexOf(a.values[this._key]);case 8:return-1===this._val.indexOf(a.values[this._key]);case 9:for(var d=0,b=this._val;d<
b.length;d++){var f=b[d];if(f.filter(a))return!0}return!1;case 10:d=0;for(b=this._val;d<b.length;d++)if(f=b[d],!f.filter(a))return!1;return!0;case 11:d=0;for(b=this._val;d<b.length;d++)if(f=b[d],f.filter(a))return!1;return!0;case 12:return a.type===this._val;case 13:return a.type!==this._val;case 14:return a.type<this._val;case 15:return a.type>this._val;case 16:return a.type>=this._val;case 17:return a.type<=this._val;case 18:return-1!==this._val.indexOf(a.type);case 19:return-1===this._val.indexOf(a.type)}};
f.createFilter=function(a){if(!a)return new f(0,void 0,!0);var d=a[0];if(1>=a.length)return new f(0,void 0,"any"!==d);switch(d){case "\x3d\x3d":return new f(1,a[1],a[2]);case "!\x3d":return new f(2,a[1],a[2]);case "\x3e":return new f(4,a[1],a[2]);case "\x3c":return new f(3,a[1],a[2]);case "\x3e\x3d":return new f(6,a[1],a[2]);case "\x3c\x3d":return new f(5,a[1],a[2]);case "in":return new f(7,a[1],a.slice(2));case "!in":return new f(8,a[1],a.slice(2));case "any":return new f(9,void 0,a.slice(1).map(f.createFilter.bind(this)));
case "all":return new f(10,void 0,a.slice(1).map(f.createFilter.bind(this)));case "none":return new f(11,void 0,a.slice(1).map(f.createFilter.bind(this)));default:throw Error("invalid operator: "+d);}};f._types=["Unknown","Point","LineString","Polygon"];return f}()})},"esri/views/vectorTiles/SchemaHelper":function(){define(["require","exports"],function(w,l){return function(){function f(a,d){this.lockedSchemaPixelSize=a;this.isWGS84=d}f.prototype.getCompatibleLevelRowCol=function(a){var d=a[0],b=
a[1];a=a[2];this.isWGS84?(b>>=1,a>>=1):256===this.lockedSchemaPixelSize&&0<d&&(d--,b>>=1,a>>=1);return[d,b,a]};f.prototype.getSchemaShift=function(a,d){var b=0,f=0;if(256===this.lockedSchemaPixelSize||this.isWGS84)a[2]%2&&(b=2*d),a[1]%2&&(f=2*d);return[b,f]};f.prototype.adjustLevel=function(a){return this.isWGS84?a:256===this.lockedSchemaPixelSize?0<a?a-1:0:a};f.create256x256CompatibleTileInfo=function(a){if(!a)return null;if(256===a.rows&&256===a.cols)return a;for(var d=a.format,b=a.compressionQuality,
f=a.dpi,l=a.origin,m=a.spatialReference,k=4326===m.wkid,p=[],x,z,v=a.lods.length,r=0;r<v;r++){var u=a.lods[r];x=u.scale;z=k?u.resolution:2*u.resolution;p.push({level:u.level,scale:x,resolution:z})}return{rows:256,cols:256,dpi:f,format:d,compressionQuality:b,origin:l,spatialReference:m,lods:p}};f.create512x512CompatibleTileInfo=function(a){if(!a||256===a.rows||256===a.cols)return null;for(var d=a.format,b=a.compressionQuality,f=a.dpi,l=a.origin,m=a.spatialReference,k=[],p,x,z=a.lods.length,v=0;v<z;v++){var r=
a.lods[v];p=r.scale;x=.5*r.resolution;k.push({level:r.level,scale:p,resolution:x})}return{rows:512,cols:512,dpi:f,format:d,compressionQuality:b,origin:l,spatialReference:m,lods:k}};return f}()})},"esri/layers/WMTSLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/accessorSupport/decorators dojo/_base/lang ../request ../core/Error ../core/HandleRegistry ../core/Collection ../core/promiseUtils ./Layer ./WebTileLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./support/WMTSSublayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./support/wmtsUtils".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c){function D(a,b){return a.map(function(a){var c=new u;c.read(a,b);return c})}var B={"image/png":".png","image/png8":".png","image/png24":".png","image/png32":".png","image/jpg":".jpg","image/jpeg":".jpeg","image/gif":".gif","image/bmp":".bmp","image/tiff":".tif","image/jpgpng":"","image/jpegpng":"","image/unknown":""};return function(l){function r(a,b){var c=l.call(this)||this;c._sublayersHandles=new m;c.copyright=null;c.customParameters=null;c.customLayerParameters=
null;c.operationalLayerType="WebTiledLayer";c.resourceInfo=null;c.serviceMode="RESTful";c.sublayers=null;c.type="wmts";c.version="1.0.0";c.watch("activeLayer",function(a,b){b&&(b.layer=null);a&&(a.layer=c)},!0);c.watch("sublayers",function(a,b){b&&(b.forEach(function(a){a.layer=null}),c._sublayersHandles.removeAll(),c._sublayersHandles=null);a&&(a.forEach(function(a){a.layer=c}),c._sublayersHandles||(c._sublayersHandles=new m),c._sublayersHandles.add([a.on("after-add",function(a){a.item.layer=c}),
a.on("after-remove",function(a){a.item.layer=null})]))},!0);return c}f(r,l);r.prototype.normalizeCtorArgs=function(a,c){return"string"===typeof a?b.mixin({},{url:a},c):a};r.prototype.load=function(){var a=this;if("KVP"!==this.serviceMode&&"RESTful"!==this.serviceMode)console.error("WMTS mode could only be 'KVP' or 'RESTful'");else return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["WMTS"]}).then(function(){return a._fetchService()}).otherwise(function(){return p.reject(new t("wmtslayer:unsupported-service-data",
"Invalid response from the WMTS service."))})),this};Object.defineProperty(r.prototype,"activeLayer",{get:function(){return this._get("activeLayer")},set:function(a){this._set("activeLayer",a)},enumerable:!0,configurable:!0});r.prototype.readActiveLayerFromService=function(a,b,c){var d=this,f;this.activeLayer?b.layers.some(function(a){return a.id===d.activeLayer.id?(f=a,!0):!1}):(this.activeLayer=new u,f=b.layers[0]);this.activeLayer.read(f,c);return this.activeLayer};r.prototype.readActiveLayerFromItemOrWebDoc=
function(a,b,c){return new u({id:b.wmtsInfo.layerIdentifier,tileMatrixSetId:b.wmtsInfo.tileMatrixSet})};r.prototype.writeActiveLayer=function(a,c){a=this.activeLayer;c.templateUrl=this.getUrlTemplate(a.id,a.tileMatrixSetId,a.imageFormat,a.styleId);c.wmtsInfo=b.mixin(c.wmtsInfo||{},{layerIdentifier:a.id,tileMatrixSet:a.tileMatrixSetId})};Object.defineProperty(r.prototype,"fullExtents",{get:function(){var a=[];this.activeLayer.tileMatrixSets.forEach(function(b){b.fullExtent&&a.push(b.fullExtent)});
return a},enumerable:!0,configurable:!0});r.prototype.readServiceMode=function(a,b,c){return-1<b.templateUrl.indexOf("?")?"KVP":"RESTful"};r.prototype.readSublayersFromService=function(a,b,c){return D(b.layers,c)};Object.defineProperty(r.prototype,"supportedSpatialReferences",{get:function(){return this.activeLayer.tileMatrixSets.map(function(a){return a.tileInfo.spatialReference}).toArray()},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"title",{get:function(){return"Layer"===
this._get("title")?this.activeLayer&&this.activeLayer.title:this._get("title")},set:function(a){this._set("title",a)},enumerable:!0,configurable:!0});Object.defineProperty(r.prototype,"url",{get:function(){return this._get("url")},set:function(a){a&&"/"===a.substr(-1)?this._set("url",a.slice(0,-1)):this._set("url",a)},enumerable:!0,configurable:!0});r.prototype.createWebTileLayer=function(a){var b=this.getUrlTemplate(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.imageFormat,
this.activeLayer.styleId),c=this._getTileMatrixSetById(a.tileMatrixSetId).tileInfo,d=a.fullExtent;a={layerIdentifier:a.id,tileMatrixSet:a.tileMatrixSetId,url:this.url};this.customLayerParameters&&(a.customLayerParameters=this.customLayerParameters);this.customParameters&&(a.customParameters=this.customParameters);return new z({fullExtent:d,urlTemplate:b,tileInfo:c,wmtsInfo:a})};r.prototype.fetchTile=function(a,b,c){a=this.getTileUrl(a,b,c);return q(a,{responseType:"image"}).then(function(a){return a.data})};
r.prototype.findSublayerById=function(a){return this.sublayers.find(function(b){return b.id===a})};r.prototype.getTileUrl=function(a,b,d){var f=this._getTileMatrixSetById(this.activeLayer.tileMatrixSetId).tileInfo.lods[a],f=f.levelValue?f.levelValue:String(f.level);(a=this.resourceInfo?"":c.getTileUrlFromResourceUrls(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.styleId,a,b,d))||(a=this.getUrlTemplate(this.activeLayer.id,this.activeLayer.tileMatrixSetId,this.activeLayer.imageFormat,
this.activeLayer.styleId).replace(/\{level\}/gi,f).replace(/\{row\}/gi,b).replace(/\{col\}/gi,d));return a=this._appendCustomLayerParameters(a)};r.prototype.getUrlTemplate=function(a,b,d,f){var k="";if(!this.resourceInfo&&(k=c.getTileUrlTemplateFromResourceUrls(a,b,d,f)))return k;"KVP"===this.serviceMode?k=this.url+"?SERVICE\x3dWMTS\x26VERSION\x3d"+this.version+"\x26REQUEST\x3dGetTile\x26LAYER\x3d"+a+"\x26STYLE\x3d"+f+"\x26FORMAT\x3d"+d+"\x26TILEMATRIXSET\x3d"+b+"\x26TILEMATRIX\x3d{level}\x26TILEROW\x3d{row}\x26TILECOL\x3d{col}":
"RESTful"===this.serviceMode&&(k="",B[d.toLowerCase()]&&(k=B[d.toLowerCase()]),k=this.url+a+"/"+f+"/"+b+"/{level}/{row}/{col}"+k);return k};r.prototype._fetchService=function(){var a=this;return p.resolve().then(function(){if(a.resourceInfo)return"KVP"===a.resourceInfo.serviceMode&&(a.url+=-1<a.url.indexOf("?")?"":"?"),{ssl:!1,data:a.resourceInfo};var b=a._getCapabilitiesUrl(a.serviceMode);return q(b,{responseType:"text",callbackParamName:"callback"}).otherwise(function(c){b=a._getCapabilitiesUrl("KVP"===
a.serviceMode?"RESTful":"KVP");return q(b,{responseType:"text",callbackParamName:"callback"})})}).then(function(b){b.data=a.resourceInfo?c.parseResourceInfo(b.data):c.parseCapabilities(b.data,{serviceMode:a.serviceMode});b.data&&a.read(b.data,{origin:"service"})})};r.prototype._getTileMatrixSetById=function(a){return this.findSublayerById(this.activeLayer.id).tileMatrixSets.find(function(b){return b.id===a})};r.prototype._appendCustomParameters=function(a){if(this.customParameters)for(var b in this.customParameters)a+=
(-1===a.indexOf("?")?"?":"\x26")+b+"\x3d"+encodeURIComponent(this.customParameters[b]);return a};r.prototype._appendCustomLayerParameters=function(a){if(this.customLayerParameters||this.customParameters){var c=b.clone(this.customParameters||{});b.mixin(c,this.customLayerParameters||{});for(var d in c)a+=(-1===a.indexOf("?")?"?":"\x26")+d+"\x3d"+encodeURIComponent(c[d])}return a};r.prototype._getCapabilitiesUrl=function(a){var b;this.url=this.url.split("?")[0];"KVP"===a?b=this.url+"?request\x3dGetCapabilities\x26service\x3dWMTS\x26version\x3d"+
this.version:"RESTful"===a&&(b=this.url+"/"+this.version+"/WMTSCapabilities.xml");return b=this._appendCustomParameters(b)};a([d.shared({"2d":"../views/2d/layers/WMTSLayerView2D","3d":"../views/3d/layers/WMTSLayerView3D"})],r.prototype,"viewModulePaths",void 0);a([d.property({type:u,dependsOn:["sublayers"],json:{origins:{"web-document":{write:{ignoreOrigin:!0}}}}})],r.prototype,"activeLayer",null);a([d.reader("service","activeLayer",["layers"])],r.prototype,"readActiveLayerFromService",null);a([d.reader(["web-document",
"portal-item"],"activeLayer",["wmtsInfo"])],r.prototype,"readActiveLayerFromItemOrWebDoc",null);a([d.writer(["web-document","portal-item"],"activeLayer")],r.prototype,"writeActiveLayer",null);a([d.property()],r.prototype,"copyright",void 0);a([d.property({json:{origins:{webDocument:{read:{source:"wmtsInfo.customParameters"},write:{target:"wmtsInfo.customParameters"}},portalItem:{read:{source:"wmtsInfo.customParameters"},write:{target:"wmtsInfo.customParameters"}}}}})],r.prototype,"customParameters",
void 0);a([d.property({json:{origins:{webDocument:{read:{source:"wmtsInfo.customLayerParameters"},write:{target:"wmtsInfo.customLayerParameters"}},portalItem:{read:{source:"wmtsInfo.customLayerParameters"},write:{target:"wmtsInfo.customLayerParameters"}}}}})],r.prototype,"customLayerParameters",void 0);a([d.property({readOnly:!0,dependsOn:["activeLayer"]})],r.prototype,"fullExtents",null);a([d.property()],r.prototype,"operationalLayerType",void 0);a([d.property()],r.prototype,"resourceInfo",void 0);
a([d.property()],r.prototype,"serviceMode",void 0);a([d.reader(["portal-item","web-document"],"serviceMode",["templateUrl"])],r.prototype,"readServiceMode",null);a([d.property({type:k.ofType(u)})],r.prototype,"sublayers",void 0);a([d.reader("service","sublayers",["layers"])],r.prototype,"readSublayersFromService",null);a([d.property({readOnly:!0,dependsOn:["activeLayer"]})],r.prototype,"supportedSpatialReferences",null);a([d.property({dependsOn:["activeLayer"],json:{read:{source:"title"}}})],r.prototype,
"title",null);a([d.property({json:{read:!1},readOnly:!0,value:"wmts"})],r.prototype,"type",void 0);a([d.property({json:{origins:{service:{read:{source:"tileUrl"}},webDocument:{read:{source:"wmtsInfo.url"},write:{target:"wmtsInfo.url"}},portalItem:{read:{source:"wmtsInfo.url"},write:{target:"wmtsInfo.url"}}}}})],r.prototype,"url",null);a([d.property()],r.prototype,"version",void 0);return r=a([d.subclass("esri.layers.WMTSLayer")],r)}(d.declared(x,v,r,C,E))})},"esri/layers/WebTileLayer":function(){define("dojo/_base/lang dojo/_base/url dojo/string ../core/Error ../core/MultiOriginJSONSupport ../core/urlUtils ../geometry/SpatialReference ../geometry/Extent ../geometry/Point ./TiledLayer ./mixins/OperationalLayer ./mixins/ScaleRangeLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./support/TileInfo ./support/LOD".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u){return k.createSubclass([p,d,x,z,v],{declaredClass:"esri.layers.WebTileLayer",normalizeCtorArgs:function(a,b){return"string"===typeof a?w.mixin({urlTemplate:a},b||{}):a},getDefaults:function(a){var b=new t(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,q.WebMercator);return w.mixin(this.inherited(arguments),{fullExtent:b,tileInfo:new r({size:256,dpi:96,format:"PNG8",compressionQuality:0,origin:new m({x:-2.0037508342787E7,y:2.0037508342787E7,
spatialReference:q.WebMercator}),spatialReference:q.WebMercator,lods:[new u({level:0,scale:5.91657527591555E8,resolution:156543.033928}),new u({level:1,scale:2.95828763795777E8,resolution:78271.5169639999}),new u({level:2,scale:1.47914381897889E8,resolution:39135.7584820001}),new u({level:3,scale:7.3957190948944E7,resolution:19567.8792409999}),new u({level:4,scale:3.6978595474472E7,resolution:9783.93962049996}),new u({level:5,scale:1.8489297737236E7,resolution:4891.96981024998}),new u({level:6,scale:9244648.868618,
resolution:2445.98490512499}),new u({level:7,scale:4622324.434309,resolution:1222.99245256249}),new u({level:8,scale:2311162.217155,resolution:611.49622628138}),new u({level:9,scale:1155581.108577,resolution:305.748113140558}),new u({level:10,scale:577790.554289,resolution:152.874056570411}),new u({level:11,scale:288895.277144,resolution:76.4370282850732}),new u({level:12,scale:144447.638572,resolution:38.2185141425366}),new u({level:13,scale:72223.819286,resolution:19.1092570712683}),new u({level:14,
scale:36111.909643,resolution:9.55462853563415}),new u({level:15,scale:18055.954822,resolution:4.77731426794937}),new u({level:16,scale:9027.977411,resolution:2.38865713397468}),new u({level:17,scale:4513.988705,resolution:1.19432856685505}),new u({level:18,scale:2256.994353,resolution:.597164283559817}),new u({level:19,scale:1128.497176,resolution:.298582141647617})]})})},properties:{copyright:{value:"",json:{write:!0}},fullExtent:{json:{write:!0}},legendEnabled:{json:{read:{source:["showLegend"],
reader:function(a,b){return null!=b.showLegend?b.showLegend:!0}},write:{target:"showLegend"}}},levelValues:{dependsOn:["tileInfo"],get:function(){var a=[];if(!this.tileInfo)return null;this.tileInfo.lods.forEach(function(b){a[b.level]=b.levelValue||b.level},this);return a}},operationalLayerType:"WebTiledLayer",popupEnabled:{json:{read:{source:["disablePopup"],reader:function(a,b){return null!=b.disablePopup?!b.disablePopup:!0}}}},refreshInterval:{json:{write:!0}},spatialReference:{type:q,value:q.WebMercator,
json:{read:{source:["spatialReference","fullExtent.spatialReference"],reader:function(a,b){return a||b.fullExtent&&b.fullExtent.spatialReference&&q.fromJSON(b.fullExtent.spatialReference)}}}},subDomains:{value:null,json:{write:!0}},tileInfo:{type:r,json:{write:!0}},tileServers:{value:null,dependsOn:["urlTemplate","subDomains"],get:function(){if(!this.urlTemplate)return null;var a=new l(this.urlTemplate),b=a.scheme?a.scheme+"://":"//",c=b+a.authority+"/",d=this.subDomains,f,k=[];-1===a.authority.indexOf("{subDomain}")&&
k.push(c);d&&0<d.length&&1<a.authority.split(".").length&&d.forEach(function(c){-1<a.authority.indexOf("{subDomain}")&&(f=b+a.authority.replace(/\{subDomain\}/gi,c)+"/");k.push(f)},this);return k=k.map(function(a){"/"!==a.charAt(a.length-1)&&(a+="/");return a})}},type:{value:"web-tile",json:{read:!1}},urlPath:{dependsOn:["urlTemplate"],get:function(){if(!this.urlTemplate)return null;var a=this.urlTemplate,b=new l(a);return a.substring(((b.scheme?b.scheme+"://":"//")+b.authority+"/").length)}},urlTemplate:{json:{origins:{portalItem:{read:{source:"url"}}},
read:{source:["urlTemplate","templateUrl"],reader:function(a,b){return a||b.templateUrl}},write:function(a,d){a&&b.isProtocolRelative(a)&&(a="https:"+a);d.templateUrl=a?b.normalize(a):a}}},url:{json:{write:!1}},wmtsInfo:{json:{write:!0}}},getTileUrl:function(a,b,c){a=this.levelValues[a];var d=this.tileServers[b%this.tileServers.length]+f.substitute(this.urlPath,{level:a,col:c,row:b});return d=d.replace(/\{level\}/gi,a).replace(/\{row\}/gi,b).replace(/\{col\}/gi,c)},load:function(){var b=this.loadFromPortal({supportedTypes:["WMTS"]}).then(function(){if(!this.urlTemplate)throw new a("layer:load",
"WebTileLayer (title: '"+this.title+"', id: '"+this.id+"') is missing the required 'urlTemplate' property value");}.bind(this));this.addResolvingPromise(b);return this}})})},"esri/layers/support/WMTSSublayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/accessorSupport/decorators ../../core/Collection ../../core/JSONSupport ./TileMatrixSet ./WMTSStyle ../../geometry/Extent".split(" "),function(w,
l,f,a,d,b,q,t,m,k,p){return function(d){function l(a){a=d.call(this)||this;a.fullExtent=null;a.imageFormats=null;a.id=null;a.layer=null;a.styles=null;a.tileMatrixSetId=null;a.tileMatrixSets=null;return a}f(l,d);v=l;Object.defineProperty(l.prototype,"description",{get:function(){return this._get("description")},set:function(a){this._set("description",a)},enumerable:!0,configurable:!0});l.prototype.readFullExtent=function(a,b,d){return(a=b.fullExtent)?p.fromJSON(a):null};Object.defineProperty(l.prototype,
"imageFormat",{get:function(){var a=this._get("imageFormat");a||(a=this.imageFormats&&this.imageFormats.length?this.imageFormats[0]:"");return a},set:function(a){if(-1<a.indexOf("image/")||-1===this.imageFormats.indexOf(a))if(-1===a.indexOf("image/")&&(a="image/"+a),this.imageFormats&&-1===this.imageFormats.indexOf(a)){console.error("The layer doesn't support the format of "+a);return}this._set("imageFormat",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"styleId",{get:function(){var a=
this._get("styleId");a||(a=this.styles&&this.styles.length?this.styles.getItemAt(0).id:"");return a},set:function(a){this._set("styleId",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"title",{get:function(){return this._get("title")},set:function(a){this._set("title",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"tileMatrixSet",{get:function(){var a=this;return this.tileMatrixSets.find(function(b){return b.id===a.tileMatrixSetId})},enumerable:!0,configurable:!0});
l.prototype.clone=function(){var a=new v;this.hasOwnProperty("description")&&(a.description=this.description);this.hasOwnProperty("imageFormats")&&(a.imageFormats=this.imageFormats&&this.imageFormats.slice());this.hasOwnProperty("imageFormat")&&(a.imageFormat=this.imageFormat);this.hasOwnProperty("fullExtent")&&(a.fullExtent=this.fullExtent&&this.fullExtent.clone());this.hasOwnProperty("id")&&(a.id=this.id);this.hasOwnProperty("layer")&&(a.layer=this.layer);this.hasOwnProperty("styleId")&&(a.styleId=
this.styleId);this.hasOwnProperty("styles")&&(a.styles=this.styles&&this.styles.clone());this.hasOwnProperty("tileMatrixSetId")&&(a.tileMatrixSetId=this.tileMatrixSetId);this.hasOwnProperty("tileMatrixSets")&&(a.tileMatrixSets=this.tileMatrixSets.clone());this.hasOwnProperty("title")&&(a.title=this.title);return a};a([b.property()],l.prototype,"description",null);a([b.property()],l.prototype,"fullExtent",void 0);a([b.reader("fullExtent",["fullExtent"])],l.prototype,"readFullExtent",null);a([b.property({dependsOn:["imageFormats"]})],
l.prototype,"imageFormat",null);a([b.property({json:{read:{source:"formats"}}})],l.prototype,"imageFormats",void 0);a([b.property()],l.prototype,"id",void 0);a([b.property()],l.prototype,"layer",void 0);a([b.property()],l.prototype,"styleId",null);a([b.property({type:q.ofType(k),json:{read:{source:"styles"}}})],l.prototype,"styles",void 0);a([b.property({value:null,json:{write:{ignoreOrigin:!0}}})],l.prototype,"title",null);a([b.property()],l.prototype,"tileMatrixSetId",void 0);a([b.property({readOnly:!0,
dependsOn:["tileMatrixSetId"]})],l.prototype,"tileMatrixSet",null);a([b.property({type:q.ofType(m),json:{read:{source:"tileMatrixSets"}}})],l.prototype,"tileMatrixSets",void 0);return l=v=a([b.subclass("esri.layers.support.WMTSSublayer")],l);var v}(b.declared(t))})},"esri/layers/support/TileMatrixSet":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/accessorSupport/decorators ../../core/JSONSupport".split(" "),
function(w,l,f,a,d,b,q){return function(d){function m(a){a=d.call(this)||this;a.fullExtent=null;a.id=null;a.tileInfo=null;return a}f(m,d);k=m;m.prototype.clone=function(){var a=new k;this.hasOwnProperty("fullExtent")&&(a.fullExtent=this.fullExtent&&this.fullExtent.clone());this.hasOwnProperty("id")&&(a.id=this.id);this.hasOwnProperty("tileInfo")&&(a.tileInfo=this.tileInfo&&this.tileInfo.clone());return a};a([b.property({json:{read:{source:"fullExtent"}}})],m.prototype,"fullExtent",void 0);a([b.property({json:{read:{source:"id"}}})],
m.prototype,"id",void 0);a([b.property({json:{read:{source:"tileInfo"}}})],m.prototype,"tileInfo",void 0);return m=k=a([b.subclass("esri.layer.support.TileMatrixSet")],m);var k}(b.declared(q))})},"esri/layers/support/WMTSStyle":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/paramHelper ../../core/accessorSupport/decorators ../../core/JSONSupport".split(" "),function(w,l,f,a,d,b,q){return function(d){function m(a){a=
d.call(this)||this;a.id=null;a.title=null;a.description=null;a.legendUrl=null;return a}f(m,d);k=m;m.prototype.clone=function(){var a=new k;this.hasOwnProperty("description")&&(a.description=this.description);this.hasOwnProperty("id")&&(a.id=this.id);this.hasOwnProperty("isDefault")&&(a.isDefault=this.isDefault);this.hasOwnProperty("keywords")&&(a.keywords=this.keywords&&this.keywords.slice());this.hasOwnProperty("legendUrl")&&(a.legendUrl=this.legendUrl);this.hasOwnProperty("title")&&(a.title=this.title);
return a};a([b.property({json:{read:{source:"id"}}})],m.prototype,"id",void 0);a([b.property({json:{read:{source:"title"}}})],m.prototype,"title",void 0);a([b.property({json:{read:{source:"abstract"}}})],m.prototype,"description",void 0);a([b.property({json:{read:{source:"legendUrl"}}})],m.prototype,"legendUrl",void 0);a([b.property({json:{read:{source:"isDefault"}}})],m.prototype,"isDefault",void 0);a([b.property({json:{read:{source:"keywords"}}})],m.prototype,"keywords",void 0);return m=k=a([b.subclass("esri.layer.support.WMTSStyle")],
m);var k}(b.declared(q))})},"esri/layers/support/wmtsUtils":function(){define("require exports ../../geometry/Extent ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/WKIDUnitConversion ./TileInfo ../../core/Error".split(" "),function(w,l,f,a,d,b,q,t){function m(a,b){return(a=b.getElementsByTagName(a))&&0<a.length?a[0]:null}function k(a,b){return Array.prototype.slice.call(b.getElementsByTagName(a)).map(function(a){return a.textContent})}function p(a,b){a.split("\x3e").forEach(function(a){b=
m(a,b)});return b&&b.textContent}function x(a,b,c,d){var f;Array.prototype.slice.call(d.childNodes).some(function(d){if(-1<d.nodeName.indexOf(a)){var k=m(b,d),k=k&&k.textContent;return k===c||c.split(":")&&c.split(":")[1]===k?(f=d,!0):!1}});return f}function z(a){var b=[],c=G[a],d=Array.prototype.slice.call(c.getElementsByTagName("ResourceURL")),c=c.getElementsByTagName("Dimension"),f,m,l,r;c.length&&(f=p("Identifier",c[0]),m=k("Default",c[0])||k("Value",c[0]));1<c.length&&(l=p("Identifier",c[1]),
r=k("Default",c[1])||k("Value",c[1]));I[a]={dimensions:m,dimensions2:r};d.forEach(function(a){var c=a.getAttribute("template");if(f&&m.length)if(-1<c.indexOf("{"+f+"}"))c=c.replace("{"+f+"}","{dimensionValue}");else{var d=c.toLowerCase().indexOf("{"+f.toLowerCase()+"}");-1<d&&(c=c.substring(0,d)+"{dimensionValue}"+c.substring(d+f.length+2))}l&&r.length&&(-1<c.indexOf("{"+l+"}")?c=c.replace("{"+l+"}","{dimensionValue2}"):(d=c.toLowerCase().indexOf("{"+l.toLowerCase()+"}"),-1<d&&(c=c.substring(0,d)+
"{dimensionValue2}"+c.substring(d+l.length+2))));b.push({template:c,format:a.getAttribute("fomrat"),resourceType:a.getAttribute("resourceType")})});return b}function v(a){return Array.prototype.slice.call(a.getElementsByTagName("Style")).map(function(a){var b=m("LegendURL",a),c=m("Keywords",a),c=c&&k("Keyword",c);return{abstract:p("Abstract",a),id:p("Identifier",a),isDefault:"true"===a.getAttribute("isDefault"),keywords:c,legendUrl:b&&b.getAttribute("xlink:href"),title:p("Title",a)}})}function r(a,
b){return k("TileMatrixSet",a).map(function(c){return u(c,a,b)})}function u(a,b,d){b=x("TileMatrixSetLink","TileMatrixSet",a,b);b=k("TileMatrix",b);var f=x("TileMatrixSet","Identifier",a,d);d=C(f);var l=d.spatialReference,r=l.wkid,v=m("TileMatrix",f),v=[parseInt(p("TileWidth",v),10),parseInt(p("TileHeight",v),10)],u=[];b.length?b.forEach(function(b,d){b=x("TileMatrix","Identifier",b,f);u.push(c(b,r,d,a))}):Array.prototype.slice.call(f.getElementsByTagName("TileMatrix")).forEach(function(b,d){u.push(c(b,
r,d,a))});b=E(f,d,v,u[0]);return{id:a,fullExtent:b,tileInfo:new q({dpi:96,spatialReference:l,size:v,origin:d,lods:u})}}function C(b){var c=p("SupportedCRS",b);c&&(c=c.toLowerCase());var f=parseInt(c.split(":").pop(),10);if(900913===f||3857===f)f=102100;var k=!1;if(-1<c.indexOf("crs84")||-1<c.indexOf("crs:84"))f=4326,k=!0;else if(-1<c.indexOf("crs83")||-1<c.indexOf("crs:83"))f=4269,k=!0;else if(-1<c.indexOf("crs27")||-1<c.indexOf("crs:27"))f=4267,k=!0;var l=new d({wkid:f});b=m("TileMatrix",b);var r=
p("TopLeftCorner",b).split(" ");b=r[0].split("E").map(function(a){return Number(a)});var r=r[1].split("E").map(function(a){return Number(a)}),q=b[0],v=r[0],u;1<b.length&&(q=b[0]*Math.pow(10,b[1]));1<r.length&&(v=r[0]*Math.pow(10,r[1]));var t=k&&4326===f&&90===q&&-180===v;B.some(function(b,d){var m=Number(c.split(":").pop());if(m>=b[0]&&m<=b[1]||4326===f&&(!k||t))return u=new a(v,q,l),!0;d===B.length-1&&(u=new a(q,v,l));return!1});return u}function E(a,b,c,d){var k=m("BoundingBox",a),l,r;k&&(l=p("LowerCorner",
k).split(" "),r=p("UpperCorner",k).split(" "));l&&1<l.length&&r&&1<r.length?(a=parseFloat(l[0]),c=parseFloat(l[1]),l=parseFloat(r[0]),r=parseFloat(r[1])):(a=m("TileMatrix",a),l=parseFloat(p("MatrixWidth",a)),k=parseFloat(p("MatrixHeight",a)),a=b.x,r=b.y,l=a+l*c[0]*d.resolution,c=r-k*c[1]*d.resolution);return new f(a,c,l,r,b.spatialReference)}function c(a,b,c,d){var f=p("Identifier",a);a=p("ScaleDenominator",a).split("E").map(function(a){return Number(a)});a=1<a.length?a[0]*Math.pow(10,a[1]):a[0];
b=D(b,a,d);return{level:c,levelValue:f,scale:1.058267716535433*a,resolution:b}}function D(a,c,d){a=b.hasOwnProperty(String(a))?b.values[b[a]]:"default028mm"===d?6370997*Math.PI/180:6378137*Math.PI/180;return 7*c/25E3/a}Object.defineProperty(l,"__esModule",{value:!0});var B=[[3819,3819],[3821,3824],[3889,3889],[3906,3906],[4001,4025],[4027,4036],[4039,4047],[4052,4055],[4074,4075],[4080,4081],[4120,4176],[4178,4185],[4188,4216],[4218,4289],[4291,4304],[4306,4319],[4322,4326],[4463,4463],[4470,4470],
[4475,4475],[4483,4483],[4490,4490],[4555,4558],[4600,4646],[4657,4765],[4801,4811],[4813,4821],[4823,4824],[4901,4904],[5013,5013],[5132,5132],[5228,5229],[5233,5233],[5246,5246],[5252,5252],[5264,5264],[5324,5340],[5354,5354],[5360,5360],[5365,5365],[5370,5373],[5381,5381],[5393,5393],[5451,5451],[5464,5464],[5467,5467],[5489,5489],[5524,5524],[5527,5527],[5546,5546],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],
[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3038,3051],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3150,3151],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3389,3390],[3416,3417],[3833,3841],[3844,3850],[3854,3854],[3873,3885],[3907,3910],[4026,4026],[4037,4038],[4417,4417],[4434,4434],[4491,4554],[4839,4839],[5048,5048],[5105,5130],[5253,5259],[5269,5275],[5343,5349],[5479,5482],[5518,5519],[5520,5520],[20004,20032],
[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],I=new Map,G=new Map;l.parseCapabilities=function(a,b){a=a.replace(/ows:/gi,"");a=(new DOMParser).parseFromString(a,"text/xml").documentElement;var c=m("Contents",a);if(!c)throw new t("wmtslayer:wmts-capabilities-xml-is-not-valid");var d=
m("OperationsMetadata",a).querySelector("[name\x3d'GetTile']").getElementsByTagName("Get"),d=Array.prototype.slice.call(d),f=b.serviceMode,l,q,u;d.some(function(a){var b=m("Constraint",a);if(!b||x("AllowedValues","Value",f,b))return q=a.attributes[0].nodeValue,!0;if(!b||x("AllowedValues","Value","RESTful",b)||x("AllowedValues","Value","REST",b))u=a.attributes[0].nodeValue;else if(!b||x("AllowedValues","Value","KVP",b))l=a.attributes[0].nodeValue;return!1});q||(u?(q=u,f="RESTful"):l&&(q=l,f="KVP"));
-1===q.indexOf("/1.0.0/")&&"RESTful"===f&&(q+="/");"KVP"===f&&(q+=-1<q.indexOf("?")?"":"?");b=p("ServiceIdentification\x3eAccessConstraints",a);a=Array.prototype.slice.call(c.getElementsByTagName("Layer")).map(function(a){var b=p("Identifier",a);G[b]=a;var d=p("Abstract",a),f=k("Format",a),l,h=m("WGS84BoundingBox",a);l=h?p("LowerCorner",h).split(" "):["-180","-90"];h=h?p("UpperCorner",h).split(" "):["180","90"];l={xmin:parseFloat(l[0]),ymin:parseFloat(l[1]),xmax:parseFloat(h[0]),ymax:parseFloat(h[1]),
spatialReference:{wkid:4326}};var h=v(a),e=p("Title",a);a=r(a,c);return{id:b,fullExtent:l,description:d,formats:f,styles:h,title:e,tileMatrixSets:a}});return{copyright:b,layers:a,tileUrl:q,serviceMode:f}};l.parseResourceInfo=function(a){a.layers.forEach(function(a){a.tileMatrixSets.forEach(function(a){var b=a.tileInfo;96!==b.dpi&&(b.lods.forEach(function(c){c.scale=96*c.scale/b.dpi;c.resolution=D(b.spatialReference.wkid,90.71428571428571*c.scale/96,a.id)}),b.dpi=96)})});return a};l.getTileUrlFromResourceUrls=
function(a,b,c,d,f,k){var m=z(a),p=I[a].dimensions&&I[a].dimensions[0];a=I[a].dimensions2&&I[a].dimensions2[0];var l="";m&&0<m.length&&(l=m[f%m.length].template.replace(/\{Style\}/gi,c).replace(/\{TileMatrixSet\}/gi,b).replace(/\{TileMatrix\}/gi,d).replace(/\{TileRow\}/gi,f).replace(/\{TileCol\}/gi,k).replace(/\{dimensionValue\}/gi,p).replace(/\{dimensionValue2\}/gi,a));return l};l.getTileUrlTemplateFromResourceUrls=function(a,b,c,d){c=z(a);var f="";if(c&&0<c.length){var k=I[a].dimensions&&I[a].dimensions[0];
a=I[a].dimensions2&&I[a].dimensions2[0];f=c[0].template;f.indexOf(".xxx")===f.length-4&&(f=f.slice(0,f.length-4));f=f.replace(/\{Style\}/gi,d);f=f.replace(/\{TileMatrixSet\}/gi,b);f=f.replace(/\{TileMatrix\}/gi,"{level}");f=f.replace(/\{TileRow\}/gi,"{row}");f=f.replace(/\{TileCol\}/gi,"{col}");f=f.replace(/\{dimensionValue\}/gi,k);f=f.replace(/\{dimensionValue2\}/gi,a)}return f}})},"esri/views/3d/terrain/tileUtils":function(){define(["require","exports","./UpsampleInfo","../support/PreallocArray"],
function(w,l,f,a){function d(a,b,f,l){l=b.call(f,a,l);for(var k=0;4>k;k++){var m=a.children[k];m&&d(m,b,f,l)}}function b(a,b,d){if(Array.isArray(a))for(var f=0;f<a.length;f++)q(a[f],b,d);else q(a,b,d)}function q(a,d,f){for(var k=0;4>k;k++){var m=a.children[k];m&&b(m,d,f)}d.call(f,a)}Object.defineProperty(l,"__esModule",{value:!0});w=function(){function b(b){void 0===b&&(b=100);this.q=new a(b);this._last=null;this.done=!0}b.prototype.reset=function(a){this.q.clear();a&&this.q.pushEither(a);this._last=
null;this.done=0===this.q.length};b.prototype.skip=function(){this._last=null;0===this.q.length&&(this.done=!0)};b.prototype.next=function(){if(this.done)return null;if(null!==this._last){var a=this._last.children;if(a[0])for(var b=4;0<=b;b--){var d=a[b];d&&this.q.push(d)}this._last=null}this._last=this.q.pop();0!==this.q.length||this._last.children[0]||(this.done=!0);return this._last};return b}();l.IteratorPreorder=w;w=function(){function b(b){void 0===b&&(b=100);this.q=new a(b);this.done=!0}b.prototype.reset=
function(a){this.q.clear();this.q.pushEither(a);for(a=0;a<this.q.length;)for(var b=this.q.data[a++],d=0;4>d;d++){var f=b.children[d];f&&this.q.push(f)}this.done=0===this.q.length};b.prototype.next=function(){var a=this.q.pop();this.done=0===this.q.length;return a};return b}();l.IteratorPostorder=w;l.lij2str=function(a,b,d){return a+"/"+b+"/"+d};l.tile2str=function(a){return a.lij[0]+"/"+a.lij[1]+"/"+a.lij[2]};l.traverseTilesPreorder=function(a,b,f,l){if(Array.isArray(a))for(var k=0;k<a.length;k++)d(a[k],
b,f,l);else d(a,b,f,l)};l.traverseTilesPostorder=b;l.fallsWithinLayer=function(a,b,d){var f=b.fullExtent,k=a.extent;if(d){if(k[0]<f.xmin||k[1]<f.ymin||k[2]>f.xmax||k[3]>f.ymax)return!1}else if(f.xmin>k[2]||f.ymin>k[3]||f.xmax<k[0]||f.ymax<k[1])return!1;a=a.parentSurface.tilingScheme.levels[a.lij[0]].scale;return 0<b.minScale&&a>1.00000001*b.minScale||0<b.maxScale&&a<.99999999*b.maxScale?!1:!0};l.isPosWithinTile=function(a,b){a=a.extent;return b[0]>=a[0]&&b[1]>=a[1]&&b[0]<=a[2]&&b[1]<=a[3]};l.getTileNLevelsUp=
function(a,b){for(;0<b;)a=a.parent,b--;return a};l.nextTileInAncestry=function(a,b){var d=a.lij[0]-b.lij[0]-1,f=a.lij[2]>>d,k=0;a.lij[1]>>d&1&&(k+=2);f&1&&(k+=1);return b.children[k]};l.computeUpsampleInfoForAncestor=function(a,b){for(var d=1,k=0,m=0;a!==b;)if(d*=.5,k*=.5,m*=.5,a.lij[2]&1&&(k+=.5),0===(a.lij[1]&1)&&(m+=.5),a=a.parent,null==a)throw Error("tile was not a descendant of ancestorTile");a=f.Pool.acquire();a.init(b,k,m,d);return a};var t=[null];l.hasVisibleSiblings=function(a){Array.isArray(a)||
(t[0]=a,a=t);for(var b=0;b<a.length;b++){var d=a[b],f=d.parent;if(f)for(var m=0;4>m;m++){var l=f.children[m];if(l&&l!==d&&l.visible)return!0}}return!1}})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["require","exports","../lib/glMatrix","../../../core/ObjectPool"],function(w,l,f,a){var d=f.vec2d;return function(){function b(a,b,f,k){this.scale=0;this.tile=null;this.offset=d.create();void 0!==a&&this.init(a,b,f,k)}b.prototype.init=function(a,b,d,f){this.tile=a;this.offset[0]=b;this.offset[1]=
d;this.scale=f};b.prototype.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};b.Pool=new a(b);return b}()})},"esri/views/3d/terrain/ElevationData":function(){define(["require","exports","../../../layers/support/rasterFormats/LercCodec","./TerrainConst","../support/mathUtils"],function(w,l,f,a,d){return function(){function b(a,b,d,f){this.samplerData=null;this.level=a;this.i=b;this.j=d;this.extent=f}b.prototype.computeMinMaxValue=function(b,f,m,k){var p=Infinity,l=-Infinity;
b-=this.level;var q=Math.pow(2,b);if(Math.floor(f/q)===this.i&&Math.floor(m/q)===this.j&&0<b){var v=this.samplerData.width,r=this.samplerData.pixelData,u=.5*a.ELEVATION_NODATA_VALUE;b=(v-1)/q;m=(m-this.j*q)*b;f=(f-this.i*q)*b;if(1>b){var q=Math.floor(m),t=Math.floor(f),w=q+t*v,c=r[w],D=r[w+1],B=r[w+v],w=r[w+v+1];if(c+D+B+w<u)return p=d.bilerp(c,D,B,w,m-q,f-t),l=d.bilerp(c,D,B,w,m-q+b,f-t),v=d.bilerp(c,D,B,w,m-q,f-t+b),b=d.bilerp(c,D,B,w,m-q+b,f-t+b),k[0]=Math.min(p,l,v,b),k[1]=Math.max(p,l,v,b),k;
m=q;f=t;b=1}else m=Math.floor(m),f=Math.floor(f),b=Math.ceil(b);for(q=m;q<=m+b;q++)for(t=f;t<=f+b;t++)w=q+t*v,c=r[w],c<u?(p=Math.min(p,c),l=Math.max(l,c)):(p=0<p?0:p,l=0>l?0:l)}k[0]=p;k[1]=l;return k};b.createFromLERC=function(a,d,m,k){m=f.decode(m,k);a=new b(a[0],a[1],a[2],d);a.samplerData={pixelData:m.pixelData,width:m.width,height:m.height,minValue:m.minValue,maxValue:m.maxValue,noDataValue:m.noDataValue,safeWidth:.99999999*(m.width-1),dx:(m.width-1)/(a.extent[2]-a.extent[0]),dy:(m.width-1)/(a.extent[3]-
a.extent[1]),x0:a.extent[0],y1:a.extent[3]};a.bounds=[a.samplerData.minValue,-3E38<a.samplerData.maxValue?a.samplerData.maxValue:0];return a};b.createFromFetchTileResult=function(a,d,f){a=new b(a[0],a[1],a[2],d);d=f.values;for(var k=f.noDataValue,m=Infinity,l=-Infinity,q=!0,v=0;v<d.length;v++){var r=d[v];r!==k&&(m=r<m?r:m,l=r>l?r:l,q=!1)}q&&(l=m=0);a.samplerData={pixelData:f.values,width:f.width,height:f.height,minValue:m,maxValue:l,noDataValue:k,safeWidth:.99999999*(f.width-1),dx:(f.width-1)/(a.extent[2]-
a.extent[0]),dy:(f.width-1)/(a.extent[3]-a.extent[1]),x0:a.extent[0],y1:a.extent[3]};a.bounds=[m,l];return a};return b}()})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("require exports ./TileAgentBase ./TerrainConst ./UpsampleInfo ../../webgl/Texture ../../vectorTiles/VectorTileDisplayObject".split(" "),function(w,l,f,a,d,b,q){return function(){function l(a){this.waitingAgents=[];this.rawData=this.requestPromise=this.loadingAgent=this.upsampleFromTile=this.tilemapRequest=this.tilemap=
this.data=null;this.pendingUpdates=0;this.elevationBounds=void 0;this.init(a)}l.prototype.init=function(b){this.waitingAgents.length=0;this.data=null;this.dataInvalidated=this.dataMissing=!1;this.rawData=this.requestPromise=this.loadingAgent=this.upsampleFromTile=this.tilemapRequest=this.tilemap=null;this.pendingUpdates=0;b===a.LayerClass.ELEVATION&&(this.elevationBounds=null)};l.prototype.invalidateSourceData=function(){this.tilemap=null;this.dataInvalidated=!0;this.dataMissing=!1;this.upsampleFromTile&&
(d.Pool.release(this.upsampleFromTile),this.upsampleFromTile=null)};l.prototype.dispose=function(){this.loadingAgent&&this.loadingAgent!==f.AGENT_DONE&&(this.loadingAgent.dispose(),this.loadingAgent=null);this.requestPromise&&(this.requestPromise.cancel(),this.requestPromise=null);this.tilemap=null;this.tilemapRequest&&(this.tilemapRequest.cancel(),this.tilemapRequest=null);this.upsampleFromTile&&(d.Pool.release(this.upsampleFromTile),this.upsampleFromTile=null);this.rawData=null;this.pendingUpdates=
0;this.disposeData()};l.prototype.disposeData=function(){var a=this.data;a&&(a instanceof b?a.dispose():a instanceof q&&a.dispose(),this.data=null)};l.makeEmptyLayerInfo=function(a,b){return b?(b.init(a),b):new l(a)};return l}()})},"esri/views/3d/terrain/TileAgentBase":function(){define(["require","exports","./UpsampleInfo","./tileUtils"],function(w,l,f,a){function d(a,b,m,k,p,l,z){if(!a.parent||6<z)return null;k*=.5;p*=.5;l*=.5;a.lij[2]&1&&(p+=.5);0===(a.lij[1]&1)&&(l+=.5);return a.parent.hasLayerData(b,
m)?(b=f.Pool.acquire(),b.init(a.parent,p,l,k),b):d(a.parent,b,m,k,p,l,z+1)}var b=Error("Abstract method called on TileAgentBase");return function(){function l(){}l.prototype.init=function(a,b,d,p){this.tile=a;this.layerIdx=b;this.layerClass=d;this.suspended=p;this._tileLayerInfo=a.getLayerInfo(b,d);this._dataRequested=null;(a=this._findAncestorWithData())?(this._setUpsamplingTile(a.tile),f.Pool.release(a)):(this._tileLayerInfo.upsampleFromTile&&f.Pool.release(this._tileLayerInfo.upsampleFromTile),
this._tileLayerInfo.upsampleFromTile=null);return this._requestNext(!0)};l.prototype.dispose=function(){this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this),this._dataRequested=null);this._tileLayerInfo=this.tile=null};l.prototype.setSuspension=function(a){a!==this.suspended&&((this.suspended=a)?this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this),this._dataRequested=null):this._tileLayerInfo.data||this.update())};
l.prototype.update=function(){var a=this._findAncestorWithData();a&&this._tileLayerInfo.upsampleFromTile&&a.tile!==this._tileLayerInfo.upsampleFromTile.tile?this._setUpsamplingTile(a.tile):a&&f.Pool.release(a);return this._requestNext()};l.prototype.dataArrived=function(a){throw b;};l.prototype.dataMissing=function(a){this._dataRequested=null;this._tileLayerInfo.disposeData();this._requestNext()};l.prototype._agentDone=function(){this.tile.agentDone(this.layerIdx,this.layerClass);this.dispose()};
l.prototype._requestNext=function(a){void 0===a&&(a=!1);if(this.suspended)return!0;var b=this._findNextDownload();if(this._dataRequested){if(b===this._dataRequested)return!0;this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this);this._dataRequested=null}b?b.requestLayerData(this.layerIdx,this.layerClass,this)&&(this._dataRequested=b):a||this._agentDone();return!!this._dataRequested};l.prototype._findNextDownload=function(){for(var b=this.layerIdx,d=this.layerClass,f=this.tile.parentSurface.layerViewByIndex(b,
d),p=f.minDataLevel,q=f.maxDataLevel,z=this._desiredMinLevelDelta(),v=l.START_LOADING_LEVEL_DELTA+z,r=this._scaleRangeEnabled,u,C=this.tile,w=0,c=C.lij[0],D=this._tileLayerInfo.upsampleFromTile?this._tileLayerInfo.upsampleFromTile.tile.lij[0]:-1,B=this.tile.parentSurface,I=B.tilemapStats,G=B.getTilemapTile(C),H=!1;C&&(!r||a.fallsWithinLayer(C,f.layer,!1))&&C.lij[0]>=p;){var K=C.layerInfo[d][b];if(K.data&&w>=z){C.lij[0]>D&&this._setUpsamplingTile(C);K.dataInvalidated&&(u=C);break}if(G&&!G.tileDataAvailable(C,
b,d))H=!0;else if(C.lij[0]<=q&&!K.data&&!K.dataMissing&&(u=C,w>=v))break;(C=C.parent)&&G&&(G=G.parent||B.getTilemapTile(C));w++}u&&c-u.lij[0]<z&&this._tileLayerInfo.upsampleFromTile&&(u=null);!u&&H&&I.tilesNotPresent++;return u};l.prototype._findAncestorWithData=function(){return d(this.tile,this.layerIdx,this.layerClass,1,0,0,0)};l.prototype._desiredMinLevelDelta=function(){throw b;};l.prototype._setUpsamplingTile=function(a){throw b;};l.prototype._unsetUpsamplingTile=function(){this._tileLayerInfo.upsampleFromTile&&
f.Pool.release(this._tileLayerInfo.upsampleFromTile);this._tileLayerInfo.upsampleFromTile=null};l.START_LOADING_LEVEL_DELTA=4;l.AGENT_DONE=new l;return l}()})},"esri/views/vectorTiles/VectorTileDisplayObject":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix/vec2 ../../core/libs/gl-matrix/mat4 ../../core/ObjectPool ../../geometry/support/spatialReferenceUtils ../webgl/BufferObject ../2d/engine/DisplayObject ../2d/tiling/TileKey ./RenderBucket".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p){return function(m){function l(){for(var b=[],f=0;f<arguments.length;f++)b[f]=arguments[f];f=m.call(this)||this;f._renderBuckets=[];f._vectorTileData=null;f._symbolUpdateData=null;f.status=5;f.coords=[0,0];f.tileTransform={transform:Float32Array[16],displayCoord:Float32Array[2]};f.stencilData={mask:0,reference:0};f.status=0;f.tileTransform.transform=d.create();f.tileTransform.displayCoord=a.create();0<b.length&&(k=f.acquire).call.apply(k,[f].concat(b));return f;var k}
f(l,m);l.prototype.reset=function(){k.pool.release(this.key);this.refKey=this.key=null;this.coords[0]=0;this.height=this.width=this.coords[1]=0;this.resolution=null;this.rotation=0;this.id=this._connection=this.workerID=this._glyphsMosaic=this.styleLayers=this._vectorTileData=null;this.tileTransform.transform.fill(0);this.tileTransform.displayCoord.fill(0);this.stencilData.mask=0;this.stencilData.reference=0;this._renderBuckets.length=0;this._symbolUpdateData=null;this.status=0};l.prototype.acquire=
function(a,b,d,f,k,c){this.key=a;this.refKey=b;b=d.lodAt(a.level).resolution;var m=d.size[0]*b,p=d.origin,l=a.col*m,m=a.row*m,r=d.spatialReference,v=0;r&&(r._isWrappable?r._isWrappable():r.isWrappable)&&(v=q.getInfo(r),v=v.valid[1]-v.valid[0]);m=p.y-m;this.coords[0]=p.x+l+a.world*v;this.coords[1]=m;this.widthInPixels=d.size[1];this.coordRange=4096;this.resolution=b;this.rotation=c;this.styleLayers=f;this._glyphsMosaic=k;this.id=a.id;this.status=1};l.prototype.setData=function(a,b,d){this._vectorTileData=
a;this.workerID=b;this._connection=d;this.status=3};l.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};l.prototype.dispose=function(){this.polygonTrianglesVertexArrayObject&&(this.polygonTrianglesVertexArrayObject.dispose(),this.polygonTrianglesVertexArrayObject=null);this.polygonOutlineVertexArrayObject&&(this.polygonOutlineVertexArrayObject.dispose(),this.polygonOutlineVertexArrayObject=null);this.lineTrianglesVertexArrayObject&&(this.lineTrianglesVertexArrayObject.dispose(),
this.lineTrianglesVertexArrayObject=null);this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this.polygonTrianglesVertexBuffer&&(this.polygonTrianglesVertexBuffer.dispose(),this.polygonTrianglesVertexBuffer=null);this.polygonTrianglesIndexBuffer&&(this.polygonTrianglesIndexBuffer.dispose(),this.polygonTrianglesIndexBuffer=null);this.polygonOutlinesVertexBuffer&&
(this.polygonOutlinesVertexBuffer.dispose(),this.polygonOutlinesVertexBuffer=null);this.polygonOutlinesIndexBuffer&&(this.polygonOutlinesIndexBuffer.dispose(),this.polygonOutlinesIndexBuffer=null);this.lineVertexBuffer&&(this.lineVertexBuffer.dispose(),this.lineVertexBuffer=null);this.lineTrianglesIndexBuffer&&(this.lineTrianglesIndexBuffer.dispose(),this.lineTrianglesIndexBuffer=null);this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),
this.iconIndexBuffer=null);this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null);this.texture&&(this.texture.dispose(),this.texture=null);this._renderBuckets.length=0;this.status=7};l.prototype.attach=function(a){if(4===this.status)return!0;this.status=3;if(!this._vectorTileData)return!1;if(!this._vectorTileData.bufferDataInfo)return this.status=4,!0;if(0===this._renderBuckets.length)for(var b=
new Uint32Array(this._vectorTileData.bucketDataInfo),d=b.length,f=0;f<d;){var k=b[f],c=b[f+1];if(0===c)c=new p.BackgroundRenderBucket,c.layerID=k,this._renderBuckets.push(c),f+=2;else if(1===c)c=new p.FillRenderBucket,c.layerID=k,c.triangleElementStart=b[f+2],c.triangleElementCount=b[f+3],c.outlineElementStart=b[f+4],c.outlineElementCount=b[f+5],this._renderBuckets.push(c),f+=6;else if(2===c)c=new p.LineRenderBucket,c.layerID=k,c.triangleElementStart=b[f+2],c.triangleElementCount=b[f+3],this._renderBuckets.push(c),
f+=6;else if(3===c){c=new p.SymbolRenderBucket;c.layerID=k;c.isSDF=0!==b[f+2];var k=b[f+3],m=f+4;if(0<k)for(var m=f+4,l=void 0,q=void 0,v=void 0,x=0;x<k;x++)l=b[m],q=b[m+1],v=b[m+2],c.markerPerPageElementsMap.set(l,[q,v]),m+=3;var z=b[m];if(0<z)for(m++,v=q=l=void 0,x=0;x<z;x++)l=b[m],q=b[m+1],v=b[m+2],c.glyphPerPageElementsMap.set(l,[q,v]),m+=3;this._renderBuckets.push(c);f+=5+3*k+3*z}else console.error("Bad bucket type!")}a=a.context;b=new Uint32Array(this._vectorTileData.bufferDataInfo);d=b.length;
for(c=f=0;c<d;c+=2,f++)if(!(0>=b[c+1]||0===this._vectorTileData.bufferData[f].byteLength))switch(b[c]){case 2:this.polygonTrianglesVertexBuffer?this.polygonTrianglesVertexBuffer.setData(this._vectorTileData.bufferData[f]):this.polygonTrianglesVertexBuffer=t.createVertex(a,35044,this._vectorTileData.bufferData[f]);break;case 6:this.polygonTrianglesIndexBuffer?this.polygonTrianglesIndexBuffer.setData(this._vectorTileData.bufferData[f]):this.polygonTrianglesIndexBuffer=t.createIndex(a,35044,this._vectorTileData.bufferData[f]);
break;case 3:this.polygonOutlinesVertexBuffer?this.polygonOutlinesVertexBuffer.setData(this._vectorTileData.bufferData[f]):this.polygonOutlinesVertexBuffer=t.createVertex(a,35044,this._vectorTileData.bufferData[f]);break;case 7:this.polygonOutlinesIndexBuffer?this.polygonOutlinesIndexBuffer.setData(this._vectorTileData.bufferData[f]):this.polygonOutlinesIndexBuffer=t.createIndex(a,35044,this._vectorTileData.bufferData[f]);break;case 0:this.lineVertexBuffer?this.lineVertexBuffer.setData(this._vectorTileData.bufferData[f]):
this.lineVertexBuffer=t.createVertex(a,35044,this._vectorTileData.bufferData[f]);break;case 8:this.lineTrianglesIndexBuffer?this.lineTrianglesIndexBuffer.setData(this._vectorTileData.bufferData[f]):this.lineTrianglesIndexBuffer=t.createIndex(a,35044,this._vectorTileData.bufferData[f]);break;case 4:this.iconVertexBuffer?this.iconVertexBuffer.setData(this._vectorTileData.bufferData[f]):this.iconVertexBuffer=t.createVertex(a,35044,this._vectorTileData.bufferData[f]);break;case 9:this.iconIndexBuffer?
this.iconIndexBuffer.setData(this._vectorTileData.bufferData[f]):this.iconIndexBuffer=t.createIndex(a,35044,this._vectorTileData.bufferData[f]);break;case 5:this.textVertexBuffer?this.textVertexBuffer.setData(this._vectorTileData.bufferData[f]):this.textVertexBuffer=t.createVertex(a,35044,this._vectorTileData.bufferData[f]);break;case 10:this.textIndexBuffer?this.textIndexBuffer.setData(this._vectorTileData.bufferData[f]):this.textIndexBuffer=t.createIndex(a,35044,this._vectorTileData.bufferData[f])}this.status=
4;return!0};l.prototype.detach=function(a){-1!==this.workerID&&this._connection&&6!==this.status&&7!==this.status&&this._connection.broadcast("destructTileData",{key:this.id,worker:this.workerID},[]);this.dispose();m.prototype.detach.call(this,a)};l.prototype.doRender=function(a){if(this.visible&&4===this.status){var b=a.context,d=a.renderer;if(b&&d){var f=a.drawphase;this._symbolUpdateData&&this._updateSymbolData(a);b.setStencilFunction(514,this.stencilData.reference,this.stencilData.mask);var k=
this.styleLayers,c=void 0!==a.layerOpacity?a.layerOpacity:1;if(0!==c){var m,p=this._renderBuckets.length,l=0;if(0===f)for(l=p-1;0<=l;l--)m=this._renderBuckets[l],3!==m.type&&m.hasData()&&d.renderBucket(b,m,a.displayLevel,a.requiredLevel,f,this,k.layers[m.layerID],c);else for(l=0;l<p;l++)m=this._renderBuckets[l],m.hasData()&&d.renderBucket(b,m,a.displayLevel,a.requiredLevel,f,this,k.layers[m.layerID],c)}}}};l.prototype._updateSymbolData=function(a){var b=new Uint32Array(this._symbolUpdateData.bucketDataInfo),
d=b.length;if(0===d)return this._symbolUpdateData=null,!0;if(1>a.budget.remaining||4!==this.status)return this.requestRender(),!1;a=a.context;for(var f=new Uint32Array(this._symbolUpdateData.bufferDataInfo),k=f.length,c=0,m=0;m<k;m+=2,c++)switch(f[m]){case 4:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=t.createVertex(a,35044,this._symbolUpdateData.bufferData[c]);break;case 9:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=
null);this.iconIndexBuffer=t.createIndex(a,35044,this._symbolUpdateData.bufferData[c]);break;case 5:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=t.createVertex(a,35044,this._symbolUpdateData.bufferData[c]);break;case 10:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=t.createIndex(a,35044,this._symbolUpdateData.bufferData[c])}a=this._renderBuckets.length;for(f=0;f<a;f++)this._renderBuckets[f]instanceof
p.SymbolRenderBucket&&(k=this._renderBuckets[f],k.markerPerPageElementsMap.clear(),k.glyphPerPageElementsMap.clear());for(a=0;a<d;){k=b[a];c=-1;m=this._renderBuckets.length;for(f=0;f<m;f++)if(this._renderBuckets[f].layerID===k){c=f;break}f=this._renderBuckets[c];f||(f=new p.SymbolRenderBucket,f.layerID=k,f.isSDF=0!==b[a+2],this._renderBuckets.push(f));var k=b[a+3],l=a+4;if(0<k)for(var l=a+4,q=m=c=void 0,v=0;v<k;v++)c=b[l],m=b[l+1],q=b[l+2],f.markerPerPageElementsMap.set(c,[m,q]),l+=3;var x=b[l];if(0<
x)for(l++,q=m=c=void 0,v=0;v<x;v++)c=b[l],m=b[l+1],q=b[l+2],f.glyphPerPageElementsMap.set(c,[m,q]),l+=3;a+=5+3*k+3*x}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this._symbolUpdateData=null;return!0};l.pool=new b(l);return l}(m)})},"esri/core/libs/gl-matrix/vec2":function(){define(["./common"],function(w){var l={create:function(){var f=new w.ARRAY_TYPE(2);
f[0]=0;f[1]=0;return f},clone:function(f){var a=new w.ARRAY_TYPE(2);a[0]=f[0];a[1]=f[1];return a},fromValues:function(f,a){var d=new w.ARRAY_TYPE(2);d[0]=f;d[1]=a;return d},copy:function(f,a){f[0]=a[0];f[1]=a[1];return f},set:function(f,a,d){f[0]=a;f[1]=d;return f},add:function(f,a,d){f[0]=a[0]+d[0];f[1]=a[1]+d[1];return f},subtract:function(f,a,d){f[0]=a[0]-d[0];f[1]=a[1]-d[1];return f}};l.sub=l.subtract;l.multiply=function(f,a,d){f[0]=a[0]*d[0];f[1]=a[1]*d[1];return f};l.mul=l.multiply;l.divide=
function(f,a,d){f[0]=a[0]/d[0];f[1]=a[1]/d[1];return f};l.div=l.divide;l.ceil=function(f,a){f[0]=Math.ceil(a[0]);f[1]=Math.ceil(a[1]);return f};l.floor=function(f,a){f[0]=Math.floor(a[0]);f[1]=Math.floor(a[1]);return f};l.min=function(f,a,d){f[0]=Math.min(a[0],d[0]);f[1]=Math.min(a[1],d[1]);return f};l.max=function(f,a,d){f[0]=Math.max(a[0],d[0]);f[1]=Math.max(a[1],d[1]);return f};l.round=function(f,a){f[0]=Math.round(a[0]);f[1]=Math.round(a[1]);return f};l.scale=function(f,a,d){f[0]=a[0]*d;f[1]=
a[1]*d;return f};l.scaleAndAdd=function(f,a,d,b){f[0]=a[0]+d[0]*b;f[1]=a[1]+d[1]*b;return f};l.distance=function(f,a){var d=a[0]-f[0];f=a[1]-f[1];return Math.sqrt(d*d+f*f)};l.dist=l.distance;l.squaredDistance=function(f,a){var d=a[0]-f[0];f=a[1]-f[1];return d*d+f*f};l.sqrDist=l.squaredDistance;l.length=function(f){var a=f[0];f=f[1];return Math.sqrt(a*a+f*f)};l.len=l.length;l.squaredLength=function(f){var a=f[0];f=f[1];return a*a+f*f};l.sqrLen=l.squaredLength;l.negate=function(f,a){f[0]=-a[0];f[1]=
-a[1];return f};l.inverse=function(f,a){f[0]=1/a[0];f[1]=1/a[1];return f};l.normalize=function(f,a){var d=a[0],b=a[1],d=d*d+b*b;0<d&&(d=1/Math.sqrt(d),f[0]=a[0]*d,f[1]=a[1]*d);return f};l.dot=function(f,a){return f[0]*a[0]+f[1]*a[1]};l.cross=function(f,a,d){a=a[0]*d[1]-a[1]*d[0];f[0]=f[1]=0;f[2]=a;return f};l.lerp=function(f,a,d,b){var l=a[0];a=a[1];f[0]=l+b*(d[0]-l);f[1]=a+b*(d[1]-a);return f};l.random=function(f,a){a=a||1;var d=2*w.RANDOM()*Math.PI;f[0]=Math.cos(d)*a;f[1]=Math.sin(d)*a;return f};
l.transformMat2=function(f,a,d){var b=a[0];a=a[1];f[0]=d[0]*b+d[2]*a;f[1]=d[1]*b+d[3]*a;return f};l.transformMat2d=function(f,a,d){var b=a[0];a=a[1];f[0]=d[0]*b+d[2]*a+d[4];f[1]=d[1]*b+d[3]*a+d[5];return f};l.transformMat3=function(f,a,d){var b=a[0];a=a[1];f[0]=d[0]*b+d[3]*a+d[6];f[1]=d[1]*b+d[4]*a+d[7];return f};l.transformMat4=function(f,a,d){var b=a[0];a=a[1];f[0]=d[0]*b+d[4]*a+d[12];f[1]=d[1]*b+d[5]*a+d[13];return f};l.forEach=function(){var f=l.create();return function(a,d,b,l,t,m){d||(d=2);
b||(b=0);for(l=l?Math.min(l*d+b,a.length):a.length;b<l;b+=d)f[0]=a[b],f[1]=a[b+1],t(f,f,m),a[b]=f[0],a[b+1]=f[1];return a}}();l.str=function(f){return"vec2("+f[0]+", "+f[1]+")"};l.exactEquals=function(f,a){return f[0]===a[0]&&f[1]===a[1]};l.equals=function(f,a){var d=f[0];f=f[1];var b=a[0];a=a[1];return Math.abs(d-b)<=w.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))&&Math.abs(f-a)<=w.EPSILON*Math.max(1,Math.abs(f),Math.abs(a))};return l})},"esri/core/libs/gl-matrix/common":function(){define([],function(){var w=
{EPSILON:1E-6};w.ARRAY_TYPE="undefined"!==typeof Float32Array?Float32Array:Array;w.RANDOM=Math.random;w.ENABLE_SIMD=!1;w.SIMD_AVAILABLE=w.ARRAY_TYPE===Float32Array&&"SIMD"in this;w.USE_SIMD=w.ENABLE_SIMD&&w.SIMD_AVAILABLE;w.setMatrixArrayType=function(f){w.ARRAY_TYPE=f};var l=Math.PI/180;w.toRadian=function(f){return f*l};w.equals=function(f,a){return Math.abs(f-a)<=w.EPSILON*Math.max(1,Math.abs(f),Math.abs(a))};return w})},"esri/core/libs/gl-matrix/mat4":function(){define(["./common"],function(w){var l=
{scalar:{},SIMD:{},create:function(){var f=new w.ARRAY_TYPE(16);f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=1;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f},clone:function(f){var a=new w.ARRAY_TYPE(16);a[0]=f[0];a[1]=f[1];a[2]=f[2];a[3]=f[3];a[4]=f[4];a[5]=f[5];a[6]=f[6];a[7]=f[7];a[8]=f[8];a[9]=f[9];a[10]=f[10];a[11]=f[11];a[12]=f[12];a[13]=f[13];a[14]=f[14];a[15]=f[15];return a},copy:function(f,a){f[0]=a[0];f[1]=a[1];f[2]=a[2];f[3]=a[3];f[4]=a[4];f[5]=a[5];f[6]=
a[6];f[7]=a[7];f[8]=a[8];f[9]=a[9];f[10]=a[10];f[11]=a[11];f[12]=a[12];f[13]=a[13];f[14]=a[14];f[15]=a[15];return f},fromValues:function(f,a,d,b,l,t,m,k,p,x,z,v,r,u,C,E){var c=new w.ARRAY_TYPE(16);c[0]=f;c[1]=a;c[2]=d;c[3]=b;c[4]=l;c[5]=t;c[6]=m;c[7]=k;c[8]=p;c[9]=x;c[10]=z;c[11]=v;c[12]=r;c[13]=u;c[14]=C;c[15]=E;return c},set:function(f,a,d,b,l,t,m,k,p,x,z,v,r,u,w,E,c){f[0]=a;f[1]=d;f[2]=b;f[3]=l;f[4]=t;f[5]=m;f[6]=k;f[7]=p;f[8]=x;f[9]=z;f[10]=v;f[11]=r;f[12]=u;f[13]=w;f[14]=E;f[15]=c;return f},
identity:function(f){f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=1;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f}};l.scalar.transpose=function(f,a){if(f===a){var d=a[1],b=a[2],l=a[3],t=a[6],m=a[7],k=a[11];f[1]=a[4];f[2]=a[8];f[3]=a[12];f[4]=d;f[6]=a[9];f[7]=a[13];f[8]=b;f[9]=t;f[11]=a[14];f[12]=l;f[13]=m;f[14]=k}else f[0]=a[0],f[1]=a[4],f[2]=a[8],f[3]=a[12],f[4]=a[1],f[5]=a[5],f[6]=a[9],f[7]=a[13],f[8]=a[2],f[9]=a[6],f[10]=a[10],f[11]=a[14],f[12]=a[3],f[13]=a[7],
f[14]=a[11],f[15]=a[15];return f};l.SIMD.transpose=function(f,a){var d,b,l,t,m,k;d=SIMD.Float32x4.load(a,0);b=SIMD.Float32x4.load(a,4);l=SIMD.Float32x4.load(a,8);a=SIMD.Float32x4.load(a,12);t=SIMD.Float32x4.shuffle(d,b,0,1,4,5);m=SIMD.Float32x4.shuffle(l,a,0,1,4,5);k=SIMD.Float32x4.shuffle(t,m,0,2,4,6);t=SIMD.Float32x4.shuffle(t,m,1,3,5,7);SIMD.Float32x4.store(f,0,k);SIMD.Float32x4.store(f,4,t);t=SIMD.Float32x4.shuffle(d,b,2,3,6,7);m=SIMD.Float32x4.shuffle(l,a,2,3,6,7);d=SIMD.Float32x4.shuffle(t,
m,0,2,4,6);b=SIMD.Float32x4.shuffle(t,m,1,3,5,7);SIMD.Float32x4.store(f,8,d);SIMD.Float32x4.store(f,12,b);return f};l.transpose=w.USE_SIMD?l.SIMD.transpose:l.scalar.transpose;l.scalar.invert=function(f,a){var d=a[0],b=a[1],l=a[2],t=a[3],m=a[4],k=a[5],p=a[6],x=a[7],z=a[8],v=a[9],r=a[10],u=a[11],w=a[12],E=a[13],c=a[14];a=a[15];var D=d*k-b*m,B=d*p-l*m,I=d*x-t*m,G=b*p-l*k,H=b*x-t*k,K=l*x-t*p,J=z*E-v*w,P=z*c-r*w,O=z*a-u*w,L=v*c-r*E,M=v*a-u*E,R=r*a-u*c,Q=D*R-B*M+I*L+G*O-H*P+K*J;if(!Q)return null;Q=1/Q;
f[0]=(k*R-p*M+x*L)*Q;f[1]=(l*M-b*R-t*L)*Q;f[2]=(E*K-c*H+a*G)*Q;f[3]=(r*H-v*K-u*G)*Q;f[4]=(p*O-m*R-x*P)*Q;f[5]=(d*R-l*O+t*P)*Q;f[6]=(c*I-w*K-a*B)*Q;f[7]=(z*K-r*I+u*B)*Q;f[8]=(m*M-k*O+x*J)*Q;f[9]=(b*O-d*M-t*J)*Q;f[10]=(w*H-E*I+a*D)*Q;f[11]=(v*I-z*H-u*D)*Q;f[12]=(k*P-m*L-p*J)*Q;f[13]=(d*L-b*P+l*J)*Q;f[14]=(E*B-w*G-c*D)*Q;f[15]=(z*G-v*B+r*D)*Q;return f};l.SIMD.invert=function(f,a){var d,b,l,t,m,k,p,x;m=SIMD.Float32x4.load(a,0);k=SIMD.Float32x4.load(a,4);p=SIMD.Float32x4.load(a,8);x=SIMD.Float32x4.load(a,
12);a=SIMD.Float32x4.shuffle(m,k,0,1,4,5);b=SIMD.Float32x4.shuffle(p,x,0,1,4,5);d=SIMD.Float32x4.shuffle(a,b,0,2,4,6);b=SIMD.Float32x4.shuffle(b,a,1,3,5,7);a=SIMD.Float32x4.shuffle(m,k,2,3,6,7);t=SIMD.Float32x4.shuffle(p,x,2,3,6,7);l=SIMD.Float32x4.shuffle(a,t,0,2,4,6);t=SIMD.Float32x4.shuffle(t,a,1,3,5,7);a=SIMD.Float32x4.mul(l,t);a=SIMD.Float32x4.swizzle(a,1,0,3,2);m=SIMD.Float32x4.mul(b,a);k=SIMD.Float32x4.mul(d,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1);m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,a),
m);k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,a),k);k=SIMD.Float32x4.swizzle(k,2,3,0,1);a=SIMD.Float32x4.mul(b,l);a=SIMD.Float32x4.swizzle(a,1,0,3,2);m=SIMD.Float32x4.add(SIMD.Float32x4.mul(t,a),m);x=SIMD.Float32x4.mul(d,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1);m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(t,a));x=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,a),x);x=SIMD.Float32x4.swizzle(x,2,3,0,1);a=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,2,3,0,1),t);a=SIMD.Float32x4.swizzle(a,1,0,3,2);l=SIMD.Float32x4.swizzle(l,
2,3,0,1);m=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,a),m);p=SIMD.Float32x4.mul(d,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1);m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(l,a));p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,a),p);p=SIMD.Float32x4.swizzle(p,2,3,0,1);a=SIMD.Float32x4.mul(d,b);a=SIMD.Float32x4.swizzle(a,1,0,3,2);p=SIMD.Float32x4.add(SIMD.Float32x4.mul(t,a),p);x=SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,a),x);a=SIMD.Float32x4.swizzle(a,2,3,0,1);p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(t,a),p);x=SIMD.Float32x4.sub(x,
SIMD.Float32x4.mul(l,a));a=SIMD.Float32x4.mul(d,t);a=SIMD.Float32x4.swizzle(a,1,0,3,2);k=SIMD.Float32x4.sub(k,SIMD.Float32x4.mul(l,a));p=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,a),p);a=SIMD.Float32x4.swizzle(a,2,3,0,1);k=SIMD.Float32x4.add(SIMD.Float32x4.mul(l,a),k);p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(b,a));a=SIMD.Float32x4.mul(d,l);a=SIMD.Float32x4.swizzle(a,1,0,3,2);k=SIMD.Float32x4.add(SIMD.Float32x4.mul(t,a),k);x=SIMD.Float32x4.sub(x,SIMD.Float32x4.mul(b,a));a=SIMD.Float32x4.swizzle(a,2,
3,0,1);k=SIMD.Float32x4.sub(k,SIMD.Float32x4.mul(t,a));x=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,a),x);d=SIMD.Float32x4.mul(d,m);d=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(d,2,3,0,1),d);d=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(d,1,0,3,2),d);a=SIMD.Float32x4.reciprocalApproximation(d);d=SIMD.Float32x4.sub(SIMD.Float32x4.add(a,a),SIMD.Float32x4.mul(d,SIMD.Float32x4.mul(a,a)));d=SIMD.Float32x4.swizzle(d,0,0,0,0);if(!d)return null;SIMD.Float32x4.store(f,0,SIMD.Float32x4.mul(d,m));SIMD.Float32x4.store(f,
4,SIMD.Float32x4.mul(d,k));SIMD.Float32x4.store(f,8,SIMD.Float32x4.mul(d,p));SIMD.Float32x4.store(f,12,SIMD.Float32x4.mul(d,x));return f};l.invert=w.USE_SIMD?l.SIMD.invert:l.scalar.invert;l.scalar.adjoint=function(f,a){var d=a[0],b=a[1],l=a[2],t=a[3],m=a[4],k=a[5],p=a[6],x=a[7],z=a[8],v=a[9],r=a[10],u=a[11],w=a[12],E=a[13],c=a[14];a=a[15];f[0]=k*(r*a-u*c)-v*(p*a-x*c)+E*(p*u-x*r);f[1]=-(b*(r*a-u*c)-v*(l*a-t*c)+E*(l*u-t*r));f[2]=b*(p*a-x*c)-k*(l*a-t*c)+E*(l*x-t*p);f[3]=-(b*(p*u-x*r)-k*(l*u-t*r)+v*(l*
x-t*p));f[4]=-(m*(r*a-u*c)-z*(p*a-x*c)+w*(p*u-x*r));f[5]=d*(r*a-u*c)-z*(l*a-t*c)+w*(l*u-t*r);f[6]=-(d*(p*a-x*c)-m*(l*a-t*c)+w*(l*x-t*p));f[7]=d*(p*u-x*r)-m*(l*u-t*r)+z*(l*x-t*p);f[8]=m*(v*a-u*E)-z*(k*a-x*E)+w*(k*u-x*v);f[9]=-(d*(v*a-u*E)-z*(b*a-t*E)+w*(b*u-t*v));f[10]=d*(k*a-x*E)-m*(b*a-t*E)+w*(b*x-t*k);f[11]=-(d*(k*u-x*v)-m*(b*u-t*v)+z*(b*x-t*k));f[12]=-(m*(v*c-r*E)-z*(k*c-p*E)+w*(k*r-p*v));f[13]=d*(v*c-r*E)-z*(b*c-l*E)+w*(b*r-l*v);f[14]=-(d*(k*c-p*E)-m*(b*c-l*E)+w*(b*p-l*k));f[15]=d*(k*r-p*v)-m*
(b*r-l*v)+z*(b*p-l*k);return f};l.SIMD.adjoint=function(f,a){var d,b,l,t,m,k,p,x;d=SIMD.Float32x4.load(a,0);b=SIMD.Float32x4.load(a,4);l=SIMD.Float32x4.load(a,8);t=SIMD.Float32x4.load(a,12);k=SIMD.Float32x4.shuffle(d,b,0,1,4,5);m=SIMD.Float32x4.shuffle(l,t,0,1,4,5);a=SIMD.Float32x4.shuffle(k,m,0,2,4,6);m=SIMD.Float32x4.shuffle(m,k,1,3,5,7);k=SIMD.Float32x4.shuffle(d,b,2,3,6,7);b=SIMD.Float32x4.shuffle(l,t,2,3,6,7);d=SIMD.Float32x4.shuffle(k,b,0,2,4,6);b=SIMD.Float32x4.shuffle(b,k,1,3,5,7);k=SIMD.Float32x4.mul(d,
b);k=SIMD.Float32x4.swizzle(k,1,0,3,2);l=SIMD.Float32x4.mul(m,k);t=SIMD.Float32x4.mul(a,k);k=SIMD.Float32x4.swizzle(k,2,3,0,1);l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(m,k),l);t=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,k),t);t=SIMD.Float32x4.swizzle(t,2,3,0,1);k=SIMD.Float32x4.mul(m,d);k=SIMD.Float32x4.swizzle(k,1,0,3,2);l=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,k),l);x=SIMD.Float32x4.mul(a,k);k=SIMD.Float32x4.swizzle(k,2,3,0,1);l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(b,k));x=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,
k),x);x=SIMD.Float32x4.swizzle(x,2,3,0,1);k=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,2,3,0,1),b);k=SIMD.Float32x4.swizzle(k,1,0,3,2);d=SIMD.Float32x4.swizzle(d,2,3,0,1);l=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,k),l);p=SIMD.Float32x4.mul(a,k);k=SIMD.Float32x4.swizzle(k,2,3,0,1);l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(d,k));p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,k),p);p=SIMD.Float32x4.swizzle(p,2,3,0,1);k=SIMD.Float32x4.mul(a,m);k=SIMD.Float32x4.swizzle(k,1,0,3,2);p=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,
k),p);x=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,k),x);k=SIMD.Float32x4.swizzle(k,2,3,0,1);p=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,k),p);x=SIMD.Float32x4.sub(x,SIMD.Float32x4.mul(d,k));k=SIMD.Float32x4.mul(a,b);k=SIMD.Float32x4.swizzle(k,1,0,3,2);t=SIMD.Float32x4.sub(t,SIMD.Float32x4.mul(d,k));p=SIMD.Float32x4.add(SIMD.Float32x4.mul(m,k),p);k=SIMD.Float32x4.swizzle(k,2,3,0,1);t=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,k),t);p=SIMD.Float32x4.sub(p,SIMD.Float32x4.mul(m,k));k=SIMD.Float32x4.mul(a,d);
k=SIMD.Float32x4.swizzle(k,1,0,3,2);t=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,k),t);x=SIMD.Float32x4.sub(x,SIMD.Float32x4.mul(m,k));k=SIMD.Float32x4.swizzle(k,2,3,0,1);t=SIMD.Float32x4.sub(t,SIMD.Float32x4.mul(b,k));x=SIMD.Float32x4.add(SIMD.Float32x4.mul(m,k),x);SIMD.Float32x4.store(f,0,l);SIMD.Float32x4.store(f,4,t);SIMD.Float32x4.store(f,8,p);SIMD.Float32x4.store(f,12,x);return f};l.adjoint=w.USE_SIMD?l.SIMD.adjoint:l.scalar.adjoint;l.determinant=function(f){var a=f[0],d=f[1],b=f[2],l=f[3],t=f[4],
m=f[5],k=f[6],p=f[7],x=f[8],z=f[9],v=f[10],r=f[11],u=f[12],w=f[13],E=f[14];f=f[15];return(a*m-d*t)*(v*f-r*E)-(a*k-b*t)*(z*f-r*w)+(a*p-l*t)*(z*E-v*w)+(d*k-b*m)*(x*f-r*u)-(d*p-l*m)*(x*E-v*u)+(b*p-l*k)*(x*w-z*u)};l.SIMD.multiply=function(f,a,d){var b=SIMD.Float32x4.load(a,0),l=SIMD.Float32x4.load(a,4),t=SIMD.Float32x4.load(a,8);a=SIMD.Float32x4.load(a,12);var m=SIMD.Float32x4.load(d,0),m=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,
1,1,1,1),l),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,2,2,2,2),t),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,3,3,3,3),a))));SIMD.Float32x4.store(f,0,m);m=SIMD.Float32x4.load(d,4);m=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,1,1,1,1),l),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,2,2,2,2),t),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,3,3,3,3),a))));SIMD.Float32x4.store(f,
4,m);m=SIMD.Float32x4.load(d,8);m=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,1,1,1,1),l),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,2,2,2,2),t),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(m,3,3,3,3),a))));SIMD.Float32x4.store(f,8,m);d=SIMD.Float32x4.load(d,12);b=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,
1,1,1,1),l),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,2,2,2,2),t),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,3,3,3,3),a))));SIMD.Float32x4.store(f,12,b);return f};l.scalar.multiply=function(f,a,d){var b=a[0],l=a[1],t=a[2],m=a[3],k=a[4],p=a[5],x=a[6],z=a[7],v=a[8],r=a[9],u=a[10],w=a[11],E=a[12],c=a[13],D=a[14];a=a[15];var B=d[0],I=d[1],G=d[2],H=d[3];f[0]=B*b+I*k+G*v+H*E;f[1]=B*l+I*p+G*r+H*c;f[2]=B*t+I*x+G*u+H*D;f[3]=B*m+I*z+G*w+H*a;B=d[4];I=d[5];G=d[6];H=d[7];f[4]=B*b+I*k+G*v+
H*E;f[5]=B*l+I*p+G*r+H*c;f[6]=B*t+I*x+G*u+H*D;f[7]=B*m+I*z+G*w+H*a;B=d[8];I=d[9];G=d[10];H=d[11];f[8]=B*b+I*k+G*v+H*E;f[9]=B*l+I*p+G*r+H*c;f[10]=B*t+I*x+G*u+H*D;f[11]=B*m+I*z+G*w+H*a;B=d[12];I=d[13];G=d[14];H=d[15];f[12]=B*b+I*k+G*v+H*E;f[13]=B*l+I*p+G*r+H*c;f[14]=B*t+I*x+G*u+H*D;f[15]=B*m+I*z+G*w+H*a;return f};l.multiply=w.USE_SIMD?l.SIMD.multiply:l.scalar.multiply;l.mul=l.multiply;l.scalar.translate=function(f,a,d){var b=d[0],l=d[1];d=d[2];var t,m,k,p,x,z,v,r,u,w,E,c;a===f?(f[12]=a[0]*b+a[4]*l+
a[8]*d+a[12],f[13]=a[1]*b+a[5]*l+a[9]*d+a[13],f[14]=a[2]*b+a[6]*l+a[10]*d+a[14],f[15]=a[3]*b+a[7]*l+a[11]*d+a[15]):(t=a[0],m=a[1],k=a[2],p=a[3],x=a[4],z=a[5],v=a[6],r=a[7],u=a[8],w=a[9],E=a[10],c=a[11],f[0]=t,f[1]=m,f[2]=k,f[3]=p,f[4]=x,f[5]=z,f[6]=v,f[7]=r,f[8]=u,f[9]=w,f[10]=E,f[11]=c,f[12]=t*b+x*l+u*d+a[12],f[13]=m*b+z*l+w*d+a[13],f[14]=k*b+v*l+E*d+a[14],f[15]=p*b+r*l+c*d+a[15]);return f};l.SIMD.translate=function(f,a,d){var b=SIMD.Float32x4.load(a,0),l=SIMD.Float32x4.load(a,4),t=SIMD.Float32x4.load(a,
8),m=SIMD.Float32x4.load(a,12);d=SIMD.Float32x4(d[0],d[1],d[2],0);a!==f&&(f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],f[4]=a[4],f[5]=a[5],f[6]=a[6],f[7]=a[7],f[8]=a[8],f[9]=a[9],f[10]=a[10],f[11]=a[11]);b=SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(d,0,0,0,0));l=SIMD.Float32x4.mul(l,SIMD.Float32x4.swizzle(d,1,1,1,1));t=SIMD.Float32x4.mul(t,SIMD.Float32x4.swizzle(d,2,2,2,2));a=SIMD.Float32x4.add(b,SIMD.Float32x4.add(l,SIMD.Float32x4.add(t,m)));SIMD.Float32x4.store(f,12,a);return f};l.translate=w.USE_SIMD?
l.SIMD.translate:l.scalar.translate;l.scalar.scale=function(f,a,d){var b=d[0],l=d[1];d=d[2];f[0]=a[0]*b;f[1]=a[1]*b;f[2]=a[2]*b;f[3]=a[3]*b;f[4]=a[4]*l;f[5]=a[5]*l;f[6]=a[6]*l;f[7]=a[7]*l;f[8]=a[8]*d;f[9]=a[9]*d;f[10]=a[10]*d;f[11]=a[11]*d;f[12]=a[12];f[13]=a[13];f[14]=a[14];f[15]=a[15];return f};l.SIMD.scale=function(f,a,d){var b;d=SIMD.Float32x4(d[0],d[1],d[2],0);b=SIMD.Float32x4.load(a,0);SIMD.Float32x4.store(f,0,SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(d,0,0,0,0)));b=SIMD.Float32x4.load(a,
4);SIMD.Float32x4.store(f,4,SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(d,1,1,1,1)));b=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(f,8,SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(d,2,2,2,2)));f[12]=a[12];f[13]=a[13];f[14]=a[14];f[15]=a[15];return f};l.scale=w.USE_SIMD?l.SIMD.scale:l.scalar.scale;l.rotate=function(f,a,d,b){var l=b[0],t=b[1];b=b[2];var m=Math.sqrt(l*l+t*t+b*b),k,p,x,z,v,r,u,C,E,c,D,B,I,G,H,K,J,P,O,L;if(Math.abs(m)<w.EPSILON)return null;m=1/m;l*=m;t*=m;b*=m;k=Math.sin(d);p=Math.cos(d);
x=1-p;d=a[0];m=a[1];z=a[2];v=a[3];r=a[4];u=a[5];C=a[6];E=a[7];c=a[8];D=a[9];B=a[10];I=a[11];G=l*l*x+p;H=t*l*x+b*k;K=b*l*x-t*k;J=l*t*x-b*k;P=t*t*x+p;O=b*t*x+l*k;L=l*b*x+t*k;l=t*b*x-l*k;t=b*b*x+p;f[0]=d*G+r*H+c*K;f[1]=m*G+u*H+D*K;f[2]=z*G+C*H+B*K;f[3]=v*G+E*H+I*K;f[4]=d*J+r*P+c*O;f[5]=m*J+u*P+D*O;f[6]=z*J+C*P+B*O;f[7]=v*J+E*P+I*O;f[8]=d*L+r*l+c*t;f[9]=m*L+u*l+D*t;f[10]=z*L+C*l+B*t;f[11]=v*L+E*l+I*t;a!==f&&(f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);return f};l.scalar.rotateX=function(f,a,d){var b=
Math.sin(d);d=Math.cos(d);var l=a[4],t=a[5],m=a[6],k=a[7],p=a[8],x=a[9],z=a[10],v=a[11];a!==f&&(f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);f[4]=l*d+p*b;f[5]=t*d+x*b;f[6]=m*d+z*b;f[7]=k*d+v*b;f[8]=p*d-l*b;f[9]=x*d-t*b;f[10]=z*d-m*b;f[11]=v*d-k*b;return f};l.SIMD.rotateX=function(f,a,d){var b=SIMD.Float32x4.splat(Math.sin(d));d=SIMD.Float32x4.splat(Math.cos(d));a!==f&&(f[0]=a[0],f[1]=a[1],f[2]=a[2],f[3]=a[3],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);
var l=SIMD.Float32x4.load(a,4);a=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(f,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(l,d),SIMD.Float32x4.mul(a,b)));SIMD.Float32x4.store(f,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,d),SIMD.Float32x4.mul(l,b)));return f};l.rotateX=w.USE_SIMD?l.SIMD.rotateX:l.scalar.rotateX;l.scalar.rotateY=function(f,a,d){var b=Math.sin(d);d=Math.cos(d);var l=a[0],t=a[1],m=a[2],k=a[3],p=a[8],x=a[9],z=a[10],v=a[11];a!==f&&(f[4]=a[4],f[5]=a[5],f[6]=a[6],f[7]=a[7],f[12]=a[12],f[13]=
a[13],f[14]=a[14],f[15]=a[15]);f[0]=l*d-p*b;f[1]=t*d-x*b;f[2]=m*d-z*b;f[3]=k*d-v*b;f[8]=l*b+p*d;f[9]=t*b+x*d;f[10]=m*b+z*d;f[11]=k*b+v*d;return f};l.SIMD.rotateY=function(f,a,d){var b=SIMD.Float32x4.splat(Math.sin(d));d=SIMD.Float32x4.splat(Math.cos(d));a!==f&&(f[4]=a[4],f[5]=a[5],f[6]=a[6],f[7]=a[7],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);var l=SIMD.Float32x4.load(a,0);a=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(f,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(l,d),SIMD.Float32x4.mul(a,b)));
SIMD.Float32x4.store(f,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(l,b),SIMD.Float32x4.mul(a,d)));return f};l.rotateY=w.USE_SIMD?l.SIMD.rotateY:l.scalar.rotateY;l.scalar.rotateZ=function(f,a,d){var b=Math.sin(d);d=Math.cos(d);var l=a[0],t=a[1],m=a[2],k=a[3],p=a[4],x=a[5],z=a[6],v=a[7];a!==f&&(f[8]=a[8],f[9]=a[9],f[10]=a[10],f[11]=a[11],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);f[0]=l*d+p*b;f[1]=t*d+x*b;f[2]=m*d+z*b;f[3]=k*d+v*b;f[4]=p*d-l*b;f[5]=x*d-t*b;f[6]=z*d-m*b;f[7]=v*d-k*b;return f};l.SIMD.rotateZ=
function(f,a,d){var b=SIMD.Float32x4.splat(Math.sin(d));d=SIMD.Float32x4.splat(Math.cos(d));a!==f&&(f[8]=a[8],f[9]=a[9],f[10]=a[10],f[11]=a[11],f[12]=a[12],f[13]=a[13],f[14]=a[14],f[15]=a[15]);var l=SIMD.Float32x4.load(a,0);a=SIMD.Float32x4.load(a,4);SIMD.Float32x4.store(f,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(l,d),SIMD.Float32x4.mul(a,b)));SIMD.Float32x4.store(f,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,d),SIMD.Float32x4.mul(l,b)));return f};l.rotateZ=w.USE_SIMD?l.SIMD.rotateZ:l.scalar.rotateZ;
l.fromTranslation=function(f,a){f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=1;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=a[0];f[13]=a[1];f[14]=a[2];f[15]=1;return f};l.fromScaling=function(f,a){f[0]=a[0];f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=a[1];f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=a[2];f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};l.fromRotation=function(f,a,d){var b=d[0],l=d[1];d=d[2];var t=Math.sqrt(b*b+l*l+d*d),m;if(Math.abs(t)<w.EPSILON)return null;t=1/t;b*=t;l*=t;d*=t;t=Math.sin(a);a=Math.cos(a);
m=1-a;f[0]=b*b*m+a;f[1]=l*b*m+d*t;f[2]=d*b*m-l*t;f[3]=0;f[4]=b*l*m-d*t;f[5]=l*l*m+a;f[6]=d*l*m+b*t;f[7]=0;f[8]=b*d*m+l*t;f[9]=l*d*m-b*t;f[10]=d*d*m+a;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};l.fromXRotation=function(f,a){var d=Math.sin(a);a=Math.cos(a);f[0]=1;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=a;f[6]=d;f[7]=0;f[8]=0;f[9]=-d;f[10]=a;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};l.fromYRotation=function(f,a){var d=Math.sin(a);a=Math.cos(a);f[0]=a;f[1]=0;f[2]=-d;f[3]=0;f[4]=0;f[5]=1;f[6]=
0;f[7]=0;f[8]=d;f[9]=0;f[10]=a;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};l.fromZRotation=function(f,a){var d=Math.sin(a);a=Math.cos(a);f[0]=a;f[1]=d;f[2]=0;f[3]=0;f[4]=-d;f[5]=a;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=1;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};l.fromRotationTranslation=function(f,a,d){var b=a[0],l=a[1],t=a[2],m=a[3],k=b+b,p=l+l,x=t+t;a=b*k;var z=b*p,b=b*x,v=l*p,l=l*x,t=t*x,k=m*k,p=m*p,m=m*x;f[0]=1-(v+t);f[1]=z+m;f[2]=b-p;f[3]=0;f[4]=z-m;f[5]=1-(a+t);f[6]=l+k;f[7]=0;f[8]=
b+p;f[9]=l-k;f[10]=1-(a+v);f[11]=0;f[12]=d[0];f[13]=d[1];f[14]=d[2];f[15]=1;return f};l.getTranslation=function(f,a){f[0]=a[12];f[1]=a[13];f[2]=a[14];return f};l.getRotation=function(f,a){var d=a[0]+a[5]+a[10],b=0;0<d?(b=2*Math.sqrt(d+1),f[3]=.25*b,f[0]=(a[6]-a[9])/b,f[1]=(a[8]-a[2])/b,f[2]=(a[1]-a[4])/b):a[0]>a[5]&a[0]>a[10]?(b=2*Math.sqrt(1+a[0]-a[5]-a[10]),f[3]=(a[6]-a[9])/b,f[0]=.25*b,f[1]=(a[1]+a[4])/b,f[2]=(a[8]+a[2])/b):a[5]>a[10]?(b=2*Math.sqrt(1+a[5]-a[0]-a[10]),f[3]=(a[8]-a[2])/b,f[0]=(a[1]+
a[4])/b,f[1]=.25*b,f[2]=(a[6]+a[9])/b):(b=2*Math.sqrt(1+a[10]-a[0]-a[5]),f[3]=(a[1]-a[4])/b,f[0]=(a[8]+a[2])/b,f[1]=(a[6]+a[9])/b,f[2]=.25*b);return f};l.fromRotationTranslationScale=function(f,a,d,b){var l=a[0],t=a[1],m=a[2],k=a[3],p=l+l,x=t+t,z=m+m;a=l*p;var v=l*x,l=l*z,r=t*x,t=t*z,m=m*z,p=k*p,x=k*x,k=k*z,z=b[0],u=b[1];b=b[2];f[0]=(1-(r+m))*z;f[1]=(v+k)*z;f[2]=(l-x)*z;f[3]=0;f[4]=(v-k)*u;f[5]=(1-(a+m))*u;f[6]=(t+p)*u;f[7]=0;f[8]=(l+x)*b;f[9]=(t-p)*b;f[10]=(1-(a+r))*b;f[11]=0;f[12]=d[0];f[13]=d[1];
f[14]=d[2];f[15]=1;return f};l.fromRotationTranslationScaleOrigin=function(f,a,d,b,l){var q=a[0],m=a[1],k=a[2],p=a[3],x=q+q,z=m+m,v=k+k;a=q*x;var r=q*z,q=q*v,u=m*z,m=m*v,k=k*v,x=p*x,z=p*z,p=p*v,v=b[0],w=b[1];b=b[2];var E=l[0],c=l[1];l=l[2];f[0]=(1-(u+k))*v;f[1]=(r+p)*v;f[2]=(q-z)*v;f[3]=0;f[4]=(r-p)*w;f[5]=(1-(a+k))*w;f[6]=(m+x)*w;f[7]=0;f[8]=(q+z)*b;f[9]=(m-x)*b;f[10]=(1-(a+u))*b;f[11]=0;f[12]=d[0]+E-(f[0]*E+f[4]*c+f[8]*l);f[13]=d[1]+c-(f[1]*E+f[5]*c+f[9]*l);f[14]=d[2]+l-(f[2]*E+f[6]*c+f[10]*l);
f[15]=1;return f};l.fromQuat=function(f,a){var d=a[0],b=a[1],l=a[2];a=a[3];var t=d+d,m=b+b,k=l+l,d=d*t,p=b*t,b=b*m,x=l*t,z=l*m,l=l*k,t=a*t,m=a*m;a*=k;f[0]=1-b-l;f[1]=p+a;f[2]=x-m;f[3]=0;f[4]=p-a;f[5]=1-d-l;f[6]=z+t;f[7]=0;f[8]=x+m;f[9]=z-t;f[10]=1-d-b;f[11]=0;f[12]=0;f[13]=0;f[14]=0;f[15]=1;return f};l.frustum=function(f,a,d,b,l,t,m){var k=1/(d-a),p=1/(l-b),q=1/(t-m);f[0]=2*t*k;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=2*t*p;f[6]=0;f[7]=0;f[8]=(d+a)*k;f[9]=(l+b)*p;f[10]=(m+t)*q;f[11]=-1;f[12]=0;f[13]=0;f[14]=
m*t*2*q;f[15]=0;return f};l.perspective=function(f,a,d,b,l){a=1/Math.tan(a/2);var q=1/(b-l);f[0]=a/d;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=a;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=(l+b)*q;f[11]=-1;f[12]=0;f[13]=0;f[14]=2*l*b*q;f[15]=0;return f};l.perspectiveFromFieldOfView=function(f,a,d,b){var l=Math.tan(a.upDegrees*Math.PI/180),t=Math.tan(a.downDegrees*Math.PI/180),m=Math.tan(a.leftDegrees*Math.PI/180);a=Math.tan(a.rightDegrees*Math.PI/180);var k=2/(m+a),p=2/(l+t);f[0]=k;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=
p;f[6]=0;f[7]=0;f[8]=-((m-a)*k*.5);f[9]=(l-t)*p*.5;f[10]=b/(d-b);f[11]=-1;f[12]=0;f[13]=0;f[14]=b*d/(d-b);f[15]=0;return f};l.ortho=function(f,a,d,b,l,t,m){var k=1/(a-d),p=1/(b-l),q=1/(t-m);f[0]=-2*k;f[1]=0;f[2]=0;f[3]=0;f[4]=0;f[5]=-2*p;f[6]=0;f[7]=0;f[8]=0;f[9]=0;f[10]=2*q;f[11]=0;f[12]=(a+d)*k;f[13]=(l+b)*p;f[14]=(m+t)*q;f[15]=1;return f};l.lookAt=function(f,a,d,b){var q,t,m,k,p,x,z,v,r=a[0],u=a[1];a=a[2];m=b[0];k=b[1];t=b[2];z=d[0];b=d[1];q=d[2];if(Math.abs(r-z)<w.EPSILON&&Math.abs(u-b)<w.EPSILON&&
Math.abs(a-q)<w.EPSILON)return l.identity(f);d=r-z;b=u-b;z=a-q;v=1/Math.sqrt(d*d+b*b+z*z);d*=v;b*=v;z*=v;q=k*z-t*b;t=t*d-m*z;m=m*b-k*d;(v=Math.sqrt(q*q+t*t+m*m))?(v=1/v,q*=v,t*=v,m*=v):m=t=q=0;k=b*m-z*t;p=z*q-d*m;x=d*t-b*q;(v=Math.sqrt(k*k+p*p+x*x))?(v=1/v,k*=v,p*=v,x*=v):x=p=k=0;f[0]=q;f[1]=k;f[2]=d;f[3]=0;f[4]=t;f[5]=p;f[6]=b;f[7]=0;f[8]=m;f[9]=x;f[10]=z;f[11]=0;f[12]=-(q*r+t*u+m*a);f[13]=-(k*r+p*u+x*a);f[14]=-(d*r+b*u+z*a);f[15]=1;return f};l.str=function(f){return"mat4("+f[0]+", "+f[1]+", "+f[2]+
", "+f[3]+", "+f[4]+", "+f[5]+", "+f[6]+", "+f[7]+", "+f[8]+", "+f[9]+", "+f[10]+", "+f[11]+", "+f[12]+", "+f[13]+", "+f[14]+", "+f[15]+")"};l.frob=function(f){return Math.sqrt(Math.pow(f[0],2)+Math.pow(f[1],2)+Math.pow(f[2],2)+Math.pow(f[3],2)+Math.pow(f[4],2)+Math.pow(f[5],2)+Math.pow(f[6],2)+Math.pow(f[7],2)+Math.pow(f[8],2)+Math.pow(f[9],2)+Math.pow(f[10],2)+Math.pow(f[11],2)+Math.pow(f[12],2)+Math.pow(f[13],2)+Math.pow(f[14],2)+Math.pow(f[15],2))};l.add=function(f,a,d){f[0]=a[0]+d[0];f[1]=a[1]+
d[1];f[2]=a[2]+d[2];f[3]=a[3]+d[3];f[4]=a[4]+d[4];f[5]=a[5]+d[5];f[6]=a[6]+d[6];f[7]=a[7]+d[7];f[8]=a[8]+d[8];f[9]=a[9]+d[9];f[10]=a[10]+d[10];f[11]=a[11]+d[11];f[12]=a[12]+d[12];f[13]=a[13]+d[13];f[14]=a[14]+d[14];f[15]=a[15]+d[15];return f};l.subtract=function(f,a,d){f[0]=a[0]-d[0];f[1]=a[1]-d[1];f[2]=a[2]-d[2];f[3]=a[3]-d[3];f[4]=a[4]-d[4];f[5]=a[5]-d[5];f[6]=a[6]-d[6];f[7]=a[7]-d[7];f[8]=a[8]-d[8];f[9]=a[9]-d[9];f[10]=a[10]-d[10];f[11]=a[11]-d[11];f[12]=a[12]-d[12];f[13]=a[13]-d[13];f[14]=a[14]-
d[14];f[15]=a[15]-d[15];return f};l.sub=l.subtract;l.multiplyScalar=function(f,a,d){f[0]=a[0]*d;f[1]=a[1]*d;f[2]=a[2]*d;f[3]=a[3]*d;f[4]=a[4]*d;f[5]=a[5]*d;f[6]=a[6]*d;f[7]=a[7]*d;f[8]=a[8]*d;f[9]=a[9]*d;f[10]=a[10]*d;f[11]=a[11]*d;f[12]=a[12]*d;f[13]=a[13]*d;f[14]=a[14]*d;f[15]=a[15]*d;return f};l.multiplyScalarAndAdd=function(f,a,d,b){f[0]=a[0]+d[0]*b;f[1]=a[1]+d[1]*b;f[2]=a[2]+d[2]*b;f[3]=a[3]+d[3]*b;f[4]=a[4]+d[4]*b;f[5]=a[5]+d[5]*b;f[6]=a[6]+d[6]*b;f[7]=a[7]+d[7]*b;f[8]=a[8]+d[8]*b;f[9]=a[9]+
d[9]*b;f[10]=a[10]+d[10]*b;f[11]=a[11]+d[11]*b;f[12]=a[12]+d[12]*b;f[13]=a[13]+d[13]*b;f[14]=a[14]+d[14]*b;f[15]=a[15]+d[15]*b;return f};l.exactEquals=function(f,a){return f[0]===a[0]&&f[1]===a[1]&&f[2]===a[2]&&f[3]===a[3]&&f[4]===a[4]&&f[5]===a[5]&&f[6]===a[6]&&f[7]===a[7]&&f[8]===a[8]&&f[9]===a[9]&&f[10]===a[10]&&f[11]===a[11]&&f[12]===a[12]&&f[13]===a[13]&&f[14]===a[14]&&f[15]===a[15]};l.equals=function(f,a){var d=f[0],b=f[1],l=f[2],t=f[3],m=f[4],k=f[5],p=f[6],x=f[7],z=f[8],v=f[9],r=f[10],u=f[11],
C=f[12],E=f[13],c=f[14];f=f[15];var D=a[0],B=a[1],I=a[2],G=a[3],H=a[4],K=a[5],J=a[6],P=a[7],O=a[8],L=a[9],M=a[10],R=a[11],Q=a[12],T=a[13],A=a[14];a=a[15];return Math.abs(d-D)<=w.EPSILON*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(b-B)<=w.EPSILON*Math.max(1,Math.abs(b),Math.abs(B))&&Math.abs(l-I)<=w.EPSILON*Math.max(1,Math.abs(l),Math.abs(I))&&Math.abs(t-G)<=w.EPSILON*Math.max(1,Math.abs(t),Math.abs(G))&&Math.abs(m-H)<=w.EPSILON*Math.max(1,Math.abs(m),Math.abs(H))&&Math.abs(k-K)<=w.EPSILON*Math.max(1,
Math.abs(k),Math.abs(K))&&Math.abs(p-J)<=w.EPSILON*Math.max(1,Math.abs(p),Math.abs(J))&&Math.abs(x-P)<=w.EPSILON*Math.max(1,Math.abs(x),Math.abs(P))&&Math.abs(z-O)<=w.EPSILON*Math.max(1,Math.abs(z),Math.abs(O))&&Math.abs(v-L)<=w.EPSILON*Math.max(1,Math.abs(v),Math.abs(L))&&Math.abs(r-M)<=w.EPSILON*Math.max(1,Math.abs(r),Math.abs(M))&&Math.abs(u-R)<=w.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(C-Q)<=w.EPSILON*Math.max(1,Math.abs(C),Math.abs(Q))&&Math.abs(E-T)<=w.EPSILON*Math.max(1,Math.abs(E),
Math.abs(T))&&Math.abs(c-A)<=w.EPSILON*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(f-a)<=w.EPSILON*Math.max(1,Math.abs(f),Math.abs(a))};return l})},"esri/views/2d/engine/DisplayObject":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","./Evented"],function(w,l,f,a){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._renderRequestedCalled=!1;b._attached=!1;b._opacity=1;b.renderRequested=!1;b._visible=!0;return b}f(b,a);Object.defineProperty(b.prototype,
"attached",{get:function(){return this._attached},set:function(a){this._attached!==a&&((this._attached=a)?this.hasEventListener("attach")&&this.emit("attach"):this.hasEventListener("detach")&&this.emit("detach"))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"opacity",{get:function(){return this._opacity},set:function(a){this._opacity!==a&&(this._opacity=a,this.requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},
set:function(a){this._visible!==a&&(this._visible=a,this.requestRender())},enumerable:!0,configurable:!0});b.prototype.attach=function(a){return!0};b.prototype.detach=function(a){};b.prototype.processRender=function(a){this._renderRequestedCalled=!1;this.doRender(a);this._renderRequestedCalled||(this.renderRequested=!1);this.hasEventListener("post-render")&&this.emit("post-render")};b.prototype.requestRender=function(){var a=this.renderRequested;this.renderRequested=this._renderRequestedCalled=!0;
this.parent&&this.parent.requestChildRender(this);a!==this.renderRequested&&this.hasEventListener("will-render")&&this.emit("will-render")};b.prototype.dispose=function(){};return b}(a.Evented)})},"esri/views/2d/engine/Evented":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","dojo/aspect","dojo/on"],function(w,l,f,a,d){Object.defineProperty(l,"__esModule",{value:!0});w=function(){function b(){}b.prototype.on=function(b,d){return a.after(this,"on"+b,d,!0)};b.prototype.once=
function(a,b){return d.once(this,a,b)};b.prototype.emit=function(a){d.emit(this,a,this)};b.prototype.hasEventListener=function(a){a="on"+a;return!(!this[a]||!this[a].after)};return b}();l.Evented=w;l.EventedMixin=function(b){return function(b){function l(){return null!==b&&b.apply(this,arguments)||this}f(l,b);l.prototype.on=function(b,d){return a.after(this,"on"+b,d,!0)};l.prototype.once=function(a,b){return d.once(this,a,b)};l.prototype.emit=function(a,b){d.emit(this,a,b)};l.prototype.hasEventListener=
function(a){a="on"+a;return!(!this[a]||!this[a].after)};return l}(b)}})},"esri/views/vectorTiles/RenderBucket":function(){define(["require","exports","../../core/tsSupport/extendsHelper","../../core/tsSupport/decorateHelper"],function(w,l,f,a){Object.defineProperty(l,"__esModule",{value:!0});w=function(){return function(a){this.type=a}}();l.RenderBucket=w;a=function(a){function b(){var b=a.call(this,2)||this;b.triangleElementStart=0;b.triangleElementCount=0;b.joinStart=0;b.joinCount=0;return b}f(b,
a);b.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.joinCount};return b}(w);l.LineRenderBucket=a;a=function(a){function b(){var b=a.call(this,1)||this;b.triangleElementStart=0;b.triangleElementCount=0;b.outlineElementStart=0;b.outlineElementCount=0;return b}f(b,a);b.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.outlineElementCount};return b}(w);l.FillRenderBucket=a;a=function(a){function b(){var b=a.call(this,3)||this;b.markerPerPageElementsMap=new Map;
b.glyphPerPageElementsMap=new Map;b.isSDF=!1;return b}f(b,a);b.prototype.hasData=function(){return 0<this.markerPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};return b}(w);l.SymbolRenderBucket=a;w=function(a){function b(){return a.call(this,0)||this}f(b,a);b.prototype.hasData=function(){return!0};return b}(w);l.BackgroundRenderBucket=w})},"esri/views/3d/terrain/ElevationTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TerrainConst ./TileAgentBase ./UpsampleInfo".split(" "),
function(w,l,f,a,d,b,q){return function(b){function m(){var a=null!==b&&b.apply(this,arguments)||this;a._scaleRangeEnabled=!1;return a}f(m,b);m.prototype.dataArrived=function(a){a!==this.tile?this._setUpsamplingTile(a):(this._unsetUpsamplingTile(),this.updateGeometry());this._dataRequested=null;this._requestNext()};m.prototype.updateGeometry=function(){this._tileLayerInfo.pendingUpdates|=d.TileUpdateTypes.UPDATE_GEOMETRY;this.tile.updateGeometry()};m.prototype._findAncestorWithData=function(){for(var a=
this.layerClass,b=this.layerIdx,f=this.tile,m=f.vlevel,l;f&&!(f.layerInfo[a][b].data&&(l=f,m-f.lij[0]>=d.ELEVATION_DESIRED_RESOLUTION_LEVEL));)f=f.parent;return l?(a=q.Pool.acquire(),a.init(l,0,0,1),a):null};m.prototype._desiredMinLevelDelta=function(){return d.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-this.tile.lij[0])};m.prototype._setUpsamplingTile=function(a){this._unsetUpsamplingTile();var b=q.Pool.acquire();b.init(a,0,0,1);this._tileLayerInfo.upsampleFromTile=b;this.updateGeometry()};
m.Pool=new a(m);return m}(b)})},"esri/views/3d/terrain/MapTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TileAgentBase ./tileUtils".split(" "),function(w,l,f,a,d,b){return function(d){function l(){var a=d.call(this)||this;a._scaleRangeEnabled=!0;return a}f(l,d);l.prototype.dataArrived=function(a){a!==this.tile?this._setUpsamplingTile(a):(this._unsetUpsamplingTile(),this.tile.updateTexture());this._dataRequested=null;a!==this.tile&&this._requestNext()};
l.prototype._desiredMinLevelDelta=function(){return 0};l.prototype._setUpsamplingTile=function(a){this._tileLayerInfo.upsampleFromTile&&this._tileLayerInfo.upsampleFromTile.tile===a||(this._unsetUpsamplingTile(),this._tileLayerInfo.upsampleFromTile=b.computeUpsampleInfoForAncestor(this.tile,a),this.tile.updateTexture())};l.Pool=new a(l);return l}(d)})},"esri/views/3d/terrain/TileGeometryFactory":function(){define("../webgl-engine/lib/Geometry ../webgl-engine/lib/GeometryData ../lib/glMatrix ../support/earthUtils ../support/mathUtils ./TerrainConst".split(" "),
function(w,l,f,a,d,b){function q(a,b,c,d,f){a<d[0]&&(d[0]=a);a>f[0]&&(f[0]=a);b<d[1]&&(d[1]=b);b>f[1]&&(f[1]=b);c<d[2]&&(d[2]=c);c>f[2]&&(f[2]=c)}function t(a,c,f){for(var k=0;k<f.length;k++){var m=f[k];if(m){var p=m.safeWidth,l=m.width,r=m.pixelData,q=d.clamp(m.dy*(m.y1-c),0,p),m=d.clamp(m.dx*(a-m.x0),0,p),p=Math.floor(q),v=Math.floor(m),u=p*l+v,t=u+l,x=r[u],l=r[t],u=r[u+1],r=r[t+1];if(x+l+u+r<.5*b.ELEVATION_NODATA_VALUE)return q-=p,m-=v,a=x+(u-x)*m,a+(l+(r-l)*m-a)*q}}return null}var m=a.earthRadius,
k=f.vec3d,p=d.lerp,x=function(){var a=k.create(),b=k.create(),c=k.create(),d,f,m;this.init=function(p,l){f=p;m=l;k.subtract(c,b,a);d=.5*k.length(a);k.lerp(b,c,.5,a)};this.getCenter=function(){return a};this.getBSRadius=function(){return d};this.getBBMin=function(){return b};this.getBBMax=function(){return c};this.getPosition=function(){return f};this.getIndices=function(){return m};this.getPrimitiveIndices=function(){};this.getChildren=function(){}},z=function(a,b,c,d){a*=m;for(var f=0;f<=b;f++)c[5*
d]=0,c[5*d+1]=0,c[5*d+2]=a,d++},v=new function(){var a=Array(50),b=0,c={};this.get=function(f){var k=c[f];k||(k={ptr:0,data:Array(50)},c[f]=k);0<k.ptr?(d.vertexArrayHits++,f=k.data[--k.ptr],k.data[k.ptr]=null):(d.vertexArrayMisses++,f=new Float32Array(f));if(0<b)return d.geometryHits++,k=a[--b],a[b]=null,k.getData().getVertexAttr().terrain.data=f,k;d.geometryMisses++;k={};k.terrain={size:5,data:f};f=new x;return new w(new l([{type:"triangle",indices:{terrain:null},positionKey:"terrain"}],k),"tile",
[f])};this.put=function(d){var f=d.getData(),k=f.getVertexAttr(),m=k.terrain.data,p=c[m.length];50>p.ptr&&(p.data[p.ptr++]=m);k.terrain.data=null;f.getFaces()[0].indices.terrain=null;50>b&&(a[b++]=d)};var d={geometryHits:0,geometryMisses:0,vertexArrayHits:0,vertexArrayMisses:0};this.stats=d;this._pools={geometry:a,vertexArray:c}},r=[],u=Array(b.MAX_TILE_TESSELATION+1),C=Array(b.MAX_TILE_TESSELATION+1),E=Array(b.MAX_TILE_TESSELATION+1),c=Array(b.MAX_TILE_TESSELATION+1),D={values:null,numSurfaceIndices:0,
numSkirtIndices:0},B=function(a,b,c){c||(a.values=b.values);a.numSurfaceIndices=b.numSurfaceIndices;a.numSkirtIndices=b.numSkirtIndices;return a},I=function(a,b,c,d,f){var k;k=D;var m=c&2,p=b+(d?1024:0)+(m?2048:0),l=r[p];k||(k={});if(l)B(k,l);else{var l=b-1,q=b-1,v=b*b,u=2*l+2*q,t=l*q*6,x=6*u,h=6*(2*l+q-1);d&&(t*=2,x*=2,h*=2);for(var u=65536<v+u?new Uint32Array(t+x):new Uint16Array(t+x),e=0,g=0,n=t,z,w,C,E,G=0,H=0;H<=q;H++){m&&(G=0===H?h:H===q?-h:0);for(var n=n+G,I=0;I<=l;I++)E=w=-1,0===H&&(w=v+I,
I!==l&&(E=e+1)),I===l&&(w=v+l+H,H<q&&(E=e+l+1)),H===q&&(w=v+l+q+(l-I),0<I&&(E=e-1)),0===I&&0<H&&(w=v+2*l+q+(q-H),E=e-(l+1)),-1<w&&(C=0===I&&1===H?v:w+1,-1<E&&(z=e,d?(u[n+0]=z,u[n+1]=w,u[n+2]=w,u[n+3]=C,u[n+4]=C,u[n+5]=z,u[n+6]=C,u[n+7]=E,u[n+8]=E,u[n+9]=z,u[n+10]=z,u[n+11]=C,n+=12):(u[n+0]=z,u[n+1]=w,u[n+2]=C,u[n+3]=C,u[n+4]=E,u[n+5]=z,n+=6))),++e,I<l&&H<q&&(z=H*(l+1)+I,w=z+1,C=w+(l+1),E=C-1,d?(u[g+0]=z,u[g+1]=w,u[g+2]=w,u[g+3]=C,u[g+4]=C,u[g+5]=z,u[g+6]=C,u[g+7]=E,u[g+8]=E,u[g+9]=z,u[g+10]=z,u[g+
11]=C,g+=12):(u[g+0]=z,u[g+1]=w,u[g+2]=C,u[g+3]=C,u[g+4]=E,u[g+5]=z,g+=6));n-=G}k.values=u;k.numSurfaceIndices=t;k.numSkirtIndices=x;r[p]=B({},k)}m=a.getData();p=m.getVertexAttr();m.getFaces()[0].indices.terrain=k.values;a.getBoundingInfo(0).init(p.terrain,k.values);f||(f={});f.geometry=a;f.numWithoutSkirtIndices=k.numSurfaceIndices+(c?6*(b-1)*(d?2:1):0);f.numVertsPerRow=b;return B(f,k,!0)};return{createPlanarGlobeTile:function(a,b,c,d,f,m,p){var l=b[0],r=b[1],u=b[2]-l;b=b[3]-r;var x=.1*u,z=a-1,w=
a-1,B=a*a,h=v.get(5*(B+(2*z+2*w))),e=h.getData().getVertexAttr().terrain.data,g,n,C=0;g=h.getBoundingInfo(0);var E=g.getBBMin(),D=g.getBBMax();k.set3(1E7,1E7,1E7,E);k.set3(-1E7,-1E7,-1E7,D);for(n=0;n<=w;n++){var G=n/w,H=r+G*b;m&&(H<m[1]?(H=m[1],G=(H-r)/b):H>m[3]&&(H=m[3],G=(H-r)/b));for(g=0;g<=z;g++){var K=g/z,J=l+K*u;m&&(J<m[0]?(J=m[0],K=(J-l)/u):J>m[2]&&(J=m[2],K=(J-l)/u));var P=c?t(J,H,c)||0:0,J=J-d[0],L=H-d[1],P=P-d[2];q(J,L,P,E,D);e[5*C]=J;e[5*C+1]=L;e[5*C+2]=P;e[5*C+3]=K;e[5*C+4]=G;var O=-1;
0===n&&(O=B+g);g===z&&(O=B+z+n);n===w&&(O=B+z+w+(z-g));0===g&&0<n&&(O=B+2*z+w+(w-n));-1<O&&(e[5*O]=J,e[5*O+1]=L,e[5*O+2]=P-x,e[5*O+3]=K,e[5*O+4]=G,q(J,L,P-x,E,D));++C}}return I(h,a,0,f,p)},createSphericalGlobeTile:function(a,b,d,f,l,r,x,w,B){var D=d[0],G=d[1],A=d[2],H=d[3],K=Math.max(.9,1-.5*(A-D));d=a-1;var h=a-1,e=a*a,g=v.get(5*(e+(2*d+2*h))),n=g.getData().getVertexAttr().terrain.data,y=b[2]-b[0],F=b[3]-b[1],J=A-D,A=r[0],P=r[1];r=r[2];var L=g.getBoundingInfo(0),O=L.getBBMin(),L=L.getBBMax();k.set3(1E7,
1E7,1E7,O);k.set3(-1E7,-1E7,-1E7,L);var M;for(M=0;M<=d;M++){var R=M/d,aa=D+R*J;u[M]=Math.sin(aa);C[M]=Math.cos(aa);E[M]=R;c[M]=b[0]+R*y}for(D=y=0;D<=h;D++){J=D/h;M=p(G,H,J);var aa=Math.cos(M),da=Math.sin(M),ea;f?(ea=m/2*Math.log((1+da)/(1-da)),J=(ea-b[1])/F):ea=180*M/Math.PI;for(M=0;M<=d;M++){var R=E[M],ia=u[M],ba=C[M],la=m;l&&(la+=t(c[M],ea,l)||0);var ba=ba*aa*la,ia=ia*aa*la,la=da*la,qa=ba-A,ja=ia-P,ra=la-r;q(qa,ja,ra,O,L);var ga=5*y;n[ga+0]=qa;n[ga+1]=ja;n[ga+2]=ra;n[ga+3]=R;n[ga+4]=J;ga=-1;0===
D&&(ga=e+M);M===d&&(ga=e+d+D);D===h&&(ga=e+d+h+(d-M));0===M&&0<D&&(ga=e+2*d+h+(h-D));-1<ga&&(ba=ba*K-A,ia=ia*K-P,la=la*K-r,q(ba,ia,la,O,L),ga*=5,n[ga+0]=ba,n[ga+1]=ia,n[ga+2]=la,n[ga+3]=R,n[ga+4]=J);++y}}f&&(b=!!(x&2),x&1&&z(-1,d,n,e),b&&z(1,d,n,e+d+h));return I(g,a,f?x:0,w,B)},releaseGeometry:v.put,elevationSampler:t,_geometryObjectPool:v}})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("require exports ./IdGen ./Util ./BoundingInfo ./ComponentUtils".split(" "),function(w,l,f,a,d,
b){return function(){function l(b,d,f){this.singleUse=!1;this.componentAABB=null;this.id=l.__idGen.gen(d);this.data=b;this.boundingInfos=f||[];a.assert(1<=b.faces.length)}l.prototype.getId=function(){return this.id};l.prototype.getData=function(){return this.data};Object.defineProperty(l.prototype,"numGroups",{get:function(){return this.data.faces.length},enumerable:!0,configurable:!0});l.prototype.getNumGroups=function(){return this.numGroups};l.prototype.getComponentCount=function(){return b.componentCount(this.data.componentOffsets)};
l.prototype.getComponentAABB=function(a,b){null==this.componentAABB&&(this.componentAABB=this._computeComponentAABB());for(var d=0;6>d;d++)b[d]=this.componentAABB[6*a+d];return b};l.prototype._computeComponentAABB=function(){for(var a=this.getComponentCount(),b=new Float32Array(6*a),d=0;d<a;d++)this._calculateAABB(0,d,b,6*d);return b};l.prototype._calculateAABB=function(a,b,d,f){void 0===f&&(f=0);var k=this.data.faces[a];a=k.indices[k.positionKey];var k=this.data.vertexAttributes[k.positionKey].data,
m=this.data.componentOffsets,p=m.length?m[b+1]:a.length,l=Infinity,q=Infinity,t=Infinity,w=-Infinity,c=-Infinity,D=-Infinity;for(b=m.length?m[b]:0;b<p;b++)var B=3*a[b],m=k[B],I=k[B+1],B=k[B+2],l=Math.min(l,m),q=Math.min(q,I),t=Math.min(t,B),w=Math.max(w,m),c=Math.max(c,I),D=Math.max(D,B);d?(d[f]=l,d[f+1]=q,d[f+2]=t,d[f+3]=w,d[f+4]=c,d[f+5]=D):d=[l,q,t,w,c,D];return d};l.prototype.calculateBoundingInfo=function(b,f){b=this.data.faces[b];var k="triangle"===b.type?3:1,m=b.indices[b.positionKey];if(0===
m.length)for(var m=new Uint32Array(k),l=0;l<k;++l)m[l]=l;l=m.length;a.assert(0===l%k);for(var q=l/k,v=new Uint32Array(q),l=0;l<q;++l)v[l]=l;return new d(v,k,m,this.data.vertexAttributes[b.positionKey],f)};l.prototype.getBoundingInfo=function(a){var b=this.boundingInfos[a];null==b&&(b=this.calculateBoundingInfo(a),this.boundingInfos[a]=b);return b};l.prototype.invalidateBoundingInfo=function(){this.boundingInfos=[]};l.__idGen=new f;return l}()})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["require",
"exports","./Util","./gl-matrix"],function(w,l,f,a){var d=a.vec3d;return function(){function a(a,b,m,k,p){f.assert(1<=a.length);f.assert(0===m.length%b);f.assert(m.length>=a.length*b);f.assert(3===k.size||4===k.size);this.primitiveIndices=a;this.indices=m;this.position=k;this._numIndexPerPrimitive=b;this._faceRange=p;var l=k.data;k=k.size;var q=0,v=a.length;null!=p&&(q=p[0],v=p[1]+1);var r=k*m[b*a[q]];this.bbMin=d.createFrom(l[r],l[r+1],l[r+2]);this.bbMax=d.create(this.bbMin);for(p=q;p<v;++p)for(var u=
b*a[p],t=0;t<b;++t)for(var r=k*m[u+t],w=0;3>w;++w){var c=l[r+w];c<this.bbMin[w]?this.bbMin[w]=c:c>this.bbMax[w]&&(this.bbMax[w]=c)}this.center=d.create();d.lerp(this.bbMin,this.bbMax,.5,this.center);this.bsRadius=0;for(p=q;p<v;++p)for(u=b*a[p],t=0;t<b;++t)r=k*m[u+t],q=l[r]-this.center[0],w=l[r+1]-this.center[1],r=l[r+2]-this.center[2],r=q*q+w*w+r*r,r>this.bsRadius&&(this.bsRadius=r);this.bsRadius=Math.sqrt(this.bsRadius)}a.prototype.getCenter=function(){return this.center};a.prototype.getBSRadius=
function(){return this.bsRadius};a.prototype.getBBMin=function(){return this.bbMin};a.prototype.getBBMax=function(){return this.bbMax};a.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};a.prototype.getIndices=function(){return this.indices};a.prototype.getPosition=function(){return this.position};a.prototype.getChildren=function(){if(this.children)return this.children;if(1<d.dist2(this.bbMin,this.bbMax)){for(var b=d.lerp(this.bbMin,this.bbMax,.5,d.create()),f=this.primitiveIndices.length,
m=new Uint8Array(f),k=Array(8),p=0;8>p;++p)k[p]=0;for(var l=this.position.size,p=0;p<f;++p){for(var z=0,v=this._numIndexPerPrimitive*this.primitiveIndices[p],r=this.position.data,u=l*this.indices[v],w=r[u],E=r[u+1],c=r[u+2],D=1;D<this._numIndexPerPrimitive;++D){var u=l*this.indices[v+D],B=r[u],I=r[u+1],u=r[u+2];B<w&&(w=B);I<E&&(E=I);u<c&&(c=u)}w<b[0]&&(z|=1);E<b[1]&&(z|=2);c<b[2]&&(z|=4);m[p]=z;++k[z]}for(p=z=0;8>p;++p)0<k[p]&&++z;if(2>z)return;b=Array(8);for(p=0;8>p;++p)b[p]=0<k[p]?new Uint32Array(k[p]):
void 0;for(p=0;8>p;++p)k[p]=0;for(p=0;p<f;++p)z=m[p],b[z][k[z]++]=this.primitiveIndices[p];this.children=Array(8);for(p=0;8>p;++p)void 0!==b[p]&&(this.children[p]=new a(b[p],this._numIndexPerPrimitive,this.indices,this.position))}return this.children};return a}()})},"esri/views/3d/terrain/SphericalTile":function(){define("./TileBase ./TileGeometryFactory ../../../core/ObjectPool ../support/mathUtils ../support/earthUtils ../lib/glMatrix".split(" "),function(w,l,f,a,d,b){var q=b.vec3d,t=d.earthRadius,
m=function(a,b,d,f){d=t+d;var k=Math.cos(a);f[0]=Math.cos(b)*k*d;f[1]=Math.sin(b)*k*d;f[2]=Math.sin(a)*d};d=function(a,b,d,f){w.call(this);this.tileUp=q.create();this.obb=Array(8);this._isWebMercator=!1;for(var k=0;8>k;k++)this.obb[k]=q.create();void 0!==a&&this.init(a,b,d,f)};d.prototype=new w;d.prototype.constructor=d;d.prototype.init=function(b,d,f,l){w.prototype.init.call(this,b,d,f,l);this._isWebMercator=l.spatialReference.isWebMercator;d=this.extentWGS84Rad[0];f=this.extentWGS84Rad[1];l=this.extentWGS84Rad[2];
var k=this.extentWGS84Rad[3];b=b[0];var p=a.lerp(f,k,.5),u=a.lerp(d,l,.5);this.edgeLen=(l-d)*Math.cos(0===b?0:Math.min(Math.abs(f),Math.abs(k)))*t;this.curvatureHeight=t-Math.sqrt(t*t-this.edgeLen*this.edgeLen/4);m(p,u,0,this.centerAtSeaLevel);q.set(this.centerAtSeaLevel,this.tileUp);q.normalize(this.tileUp);this._updateOBB();this.updateRadiusAndCenter()};d.prototype.isVisible=function(a,b){if(!this.intersectsClippingArea)return!1;if(9<this.lij[0]){b=this.obb;for(var d=0;6>d;d++){for(var f=0;8>f&&
!(0>a[d][0]*b[f][0]+a[d][1]*b[f][1]+a[d][2]*b[f][2]+a[d][3]);f++);if(8===f)return!1}}else if(b=this.radius,d=this.center,a[0][0]*d[0]+a[0][1]*d[1]+a[0][2]*d[2]+a[0][3]>b||a[1][0]*d[0]+a[1][1]*d[1]+a[1][2]*d[2]+a[1][3]>b||a[2][0]*d[0]+a[2][1]*d[1]+a[2][2]*d[2]+a[2][3]>b||a[3][0]*d[0]+a[3][1]*d[1]+a[3][2]*d[2]+a[3][3]>b||a[4][0]*d[0]+a[4][1]*d[1]+a[4][2]*d[2]+a[4][3]>b||a[5][0]*d[0]+a[5][1]*d[1]+a[5][2]*d[2]+a[5][3]>b)return!1;return!0};d.prototype.computeElevationBounds=function(){w.prototype.computeElevationBounds.call(this);
this._updateOBB()};d.prototype.updateRadiusAndCenter=function(){if(0===this.lij[0])q.set3(0,0,0,this.center),this.radius=t+this.elevationBounds[1];else{w.prototype.updateRadiusAndCenter.call(this);var a=Math.max(q.dist2(this.center,this.obb[0]),q.dist2(this.center,this.obb[1]));this.radius=Math.sqrt(a)}};d.prototype._numSubdivisionsAtLevel=[128,64,32,16,16,8,8,4];d.prototype.createGeometry=function(a,b,d){var f=this._isPole(this.lij[1],this.lij[0]);a.needsUpdate=!1;return l.createSphericalGlobeTile(a.numVertsPerRow,
this.extent,this.extentWGS84Rad,this._isWebMercator,a.samplerData,b,f,d)};d.prototype._updateOBB=function(){var a=this.extentWGS84Rad,b=this.obb,d;for(d=0;2>d;d++){var f=this.elevationBounds[d],l=4*d;m(a[1],a[0],f,b[l++]);m(a[3],a[0],f,b[l++]);m(a[3],a[2],f,b[l++]);m(a[1],a[2],f,b[l++])}this._isWebMercator&&(a=this._isPole(this.lij[1],this.lij[0]),2===a?(q.set3(0,0,t,b[1]),q.set3(0,0,t,b[2]),q.set3(0,0,t,b[5]),q.set3(0,0,t,b[6])):1===a&&(q.set3(0,0,-t,b[0]),q.set3(0,0,-t,b[3]),q.set3(0,0,-t,b[4]),
q.set3(0,0,-t,b[7])))};d.prototype._isPole=function(a,b){var d=0;a===(1<<b)-1&&(d+=1);0===a&&(d+=2);return d};d.Pool=new f(d);return d})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../core/arrayUtils ../../../core/HandleRegistry ../../../geometry/support/webMercatorUtils ../../../views/3d/support/aaBoundingRect ./terrainUtils ./TerrainConst".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x){function z(a,b){a&&!a.spatialReference.equals(b)&&(a=m.canProject(a.spatialReference,b)?m.project(a,b):null);return a}Object.defineProperty(l,"__esModule",{value:!0});w=function(b){function k(a){a=b.call(this,a)||this;a._changeListeners=new t;return a}f(k,b);k.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layerViews.on("change",function(){return a.notifyChange("stencilEnabledExtents")})])};k.prototype.destroy=function(){this._changeListeners.destroy();
this._changeListeners=null};Object.defineProperty(k.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,
"spatialReference",{set:function(a){this.tilingScheme||this._set("spatialReference",a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"tilingScheme",{set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)},enumerable:!0,configurable:!0});k.prototype._computeStencilEnabledExtents=function(a,b){var d=[],c=0;for(a=a.items;c<a.length;c++){var f=a[c].layer;"IntegratedMeshLayer"===f.operationalLayerType&&null!=b&&(f=z(f.fullExtent,b),null!=f&&d.push([f.xmin,
f.ymin,f.xmax,f.ymax]))}return d};a([d.property({readOnly:!0})],k.prototype,"layerViewsExtent",null);a([d.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],k.prototype,"tiledLayersExtent",null);a([d.property({readOnly:!0,dependsOn:["spatialReference"]})],k.prototype,"stencilEnabledExtents",null);a([d.property()],k.prototype,"spatialReference",null);a([d.property()],k.prototype,"tilingScheme",null);a([d.property()],k.prototype,"defaultTiledLayersExtent",void 0);a([d.property({constructOnly:!0})],
k.prototype,"layers",void 0);a([d.property({constructOnly:!0})],k.prototype,"layerViews",void 0);return k=a([d.subclass()],k)}(d.declared(b));b=function(b){function k(){return null!==b&&b.apply(this,arguments)||this}f(k,b);k.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()};k.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()};k.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?x.WEBMERCATOR_WORLD_EXTENT:x.GEOGRAPHIC_WORLD_EXTENT};
a([d.property({dependsOn:["spatialReference"]})],k.prototype,"layerViewsExtent",void 0);return k=a([d.subclass()],k)}(d.declared(w));l.SurfaceExtentHelperGlobal=b;w=function(b){function m(){return null!==b&&b.apply(this,arguments)||this}f(m,b);m.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layers.on("change",function(){return a.notifyChange("tiledLayersExtent")}),this.layerViews.on("change",function(){return a.notifyChange("layerViewsExtent")})])};m.prototype._computeLayerViewsExtent=
function(){var a=k.create(k.NEGATIVE_INFINITY),b=this.spatialReference;this.layerViews.forEach(function(c){c.isResolved()&&(c=c.fullExtentInViewSpatialReference||c.layer.fullExtent,(c=z(c,b))&&k.expand(a,c))});var d=k.allFinite(a)?a:null,c=this._get("layerViewsExtent");return q.equals(d,c)?c:d};m.prototype._computeTiledLayersExtent=function(){var a=this.tilingScheme;if(!a)return null;var b=this.spatialReference,d=k.create(k.NEGATIVE_INFINITY);this.layers.forEach(function(c){if(c.loaded&&p.isTiledLayer(c)){var f=
p.getTiledLayerInfo(c,b,"local");c=f.tileInfo;f=f.fullExtent;c&&a.compatibleWith(c)&&f&&f.spatialReference.equals(b)&&k.expand(d,f)}});this.defaultTiledLayersExtent&&k.expand(d,this.defaultTiledLayersExtent);var c=k.allFinite(d)?d:null,f=this._get("tiledLayersExtent");return q.equals(c,f)?f:c};return m=a([d.subclass()],m)}(d.declared(w));l.SurfaceExtentHelperLocal=w})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../../core/Accessor ../../../core/HandleRegistry ./terrainUtils ./TilingScheme".split(" "),
function(w,l,f,a,d,b,q,t,m){return function(b){function k(a){a=b.call(this,a)||this;a._changeHandles=new q;return a}f(k,b);k.prototype.initialize=function(){var a=this;this._changeHandles.add(this.layers.on("change",function(){return a._update()}));this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",function(){return a._setAdHocTilingScheme()}));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};k.prototype.destroy=function(){this._changeHandles.destroy();this._changeHandles=
null};k.prototype._update=function(){var a=this;this._waitTask=null;if(!this.tilingSchemeLocked){var b=this.layers.find(function(b){return t.isTiledLayer(b)?b.isFulfilled()?b.isRejected()?!1:!!t.getTiledLayerInfo(b,a.viewSpatialReference,a.manifold).tileInfo:!0:!1});if(b)if(b.isResolved()){var d=t.getTiledLayerInfo(b,this.viewSpatialReference,this.manifold).tileInfo,d=new m(d),b=t.getKnownTiledServiceLevelCap(b.url);Infinity>b&&d.capMaxLod(b);this._lockTilingScheme(d)}else this._updateWhen(b)}};k.prototype._updateWhen=
function(a){var b=this,d=a.always(function(){d===b._waitTask&&b._update()});this._waitTask=d};k.prototype._lockTilingScheme=function(a){var b=this;if("spherical"===this.manifold){var d=a.levels.length-1;a=a.spatialReference.isWebMercator?m.makeWebMercatorAuxiliarySphere(d):m.makeWGS84WithTileSize(a.pixelSize[0],d)}this.tilingSchemeLocked=!0;this.tilingScheme=a;this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this._changeHandles.removeAll();this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",
function(){return b._updateTiledLayerExtent()}))};k.prototype._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent};k.prototype._setAdHocTilingScheme=function(){if("spherical"===this.manifold)this.tilingScheme=this.extentHelper.spatialReference.isWebMercator?m.WebMercatorAuxiliarySphere:m.makeWGS84WithTileSize(256),this.extent=this.extentHelper.layerViewsExtent;else{var a=this.extentHelper.layerViewsExtent;a&&(this.tilingScheme=m.fromExtent(a,this.extentHelper.spatialReference),
this.extent=a)}};a([d.property()],k.prototype,"tilingScheme",void 0);a([d.property()],k.prototype,"extent",void 0);a([d.property({value:!1})],k.prototype,"tilingSchemeLocked",void 0);a([d.property({constructOnly:!0})],k.prototype,"viewSpatialReference",void 0);a([d.property({constructOnly:!0})],k.prototype,"layers",void 0);a([d.property({constructOnly:!0})],k.prototype,"extentHelper",void 0);a([d.property({constructOnly:!0})],k.prototype,"manifold",void 0);return k=a([d.subclass()],k)}(d.declared(b))})},
"esri/views/3d/terrain/TerrainRenderer":function(){define("dojo/when ./tileUtils ./TerrainConst ./TileGeometryFactory ./TileRenderData ./ResourceCounter ./TileRenderer ../support/PreallocArray ../../../core/ObjectPool ../../../core/promiseUtils ../support/imageUtils ../webgl-engine/lib/ShaderVariations dojo/text!./TerrainMaterial.xml ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/lib/Util ../lib/glMatrix ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/tracer ../../webgl/Texture ../../webgl/VertexArrayObject ../../webgl/BufferObject ../../webgl/Program ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl/Util".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c,D,B,I,G,H,K,J,P){var O=r.assert;r=u.vec2d;var L=u.vec3d,M=u.vec4d,R=u.mat4d.identity(),Q=[2,2],T=E.OPAQUE_TERRAIN,A=E.TRANSPARENT_TERRAIN,V=L.create(),S=r.create();u=function(h,e,g){function n(a,b){a=a.screenDepth;b=b.screenDepth;return a<b?-sa:a>b?sa:0}function r(a,b){return 0===a.tiles.length?-sa:0===b.tiles.length?sa:n(a.tiles.data[0],b.tiles.data[0])}e=e||256;var u,E=!1,U=null,Y=null,W=null,ca={},X,aa,da=new m(d),ea=new t(10,function(){return{root:null,
tiles:new t(300)}}),ia=!0,ba=new l.IteratorPreorder,la=null,qa=!0,ja=1,ra=!0,ga=!1,ha={mode:"none",width:1.5,falloff:1.5,wireOpacity:1,surfaceOpacity:0,color:[1,1,1,0],resolution:64},na=!1,oa=!1,ka=!1,sa=1,ma=!0,Z=!0,va=null,pa=null,ta=null,wa=!1,Ea=[];this.updateTileBackground=function(a){ta&&ta.cancel();ta=a?p.requestImage(a).otherwise(function(){return null}):k.resolve(null);this.renderTileBackground();return ta};var Fa=0,Ba=0,Ga=0,Ha=0;this.resourceCounter=new b;this.castShadows=!0;this.clippingExtent=
null;this.loaded=function(){};var Ia=!1;this.needsRender=!0;this.receiveShadows=this.needsHighlight=this.didRender=!1;var ua=new t(10),Ca=0,Da=new t(30),Ja=new m(function(){this.extent=M.create();this.maxLevel=this.minLevel=0;this.callback=null},!1);this.renderTileBackground=function(){if(X&&ta&&pa)return ta.then(function(a){wa=!0;pa.setGridImage(a);U&&l.traverseTilesPreorder(U,function(a){pa.updateTileTexture(a)}.bind(this))}.bind(this))};this.initializeRenderContext=function(a){X=a.rctx;aa=a.rctx.gl;
var b=function(a){w(a).then(function(){E=!0;this.setNeedsRender()}.bind(this)).otherwise(b)}.bind(this);b(this.renderTileBackground());u=a.textureRep;var c=a.shaderSnippets,d=a.shaderRep;a=a.programRep;c.vsTerrain||c._parse(z);X.extensions.standardDerivatives;var f=new x("terrain",["vsTerrain","fsTerrain"],null,a,d,c,X);f.addDefine("Spherical","SPHERICAL");f.addDefine("Overlay","OVERLAY");f.addDefine("Atmosphere","ATMOSPHERE");f.addDefine("Wireframe","WIREFRAME");f.addDefine("TileBorders","TILE_BORDERS");
f.addBinaryShaderSnippetSuffix("Wireframe","Wireframe",[!1,!0]);f.addDefine("ReceiveShadows","RECEIVE_SHADOWS");f.addDefine("ScreenSizePerspective","SCREEN_SIZE_PERSPECTIVE");d=new x("terrainNormal",["vsTerrainNormal","fsNormal"],null,a,d,c,X);d.addDefine("Spherical","SPHERICAL");d.addDefine("AlphaZero","ALPHA_ZERO");W={depth:a.get("depth"),depthShadowMap:a.get("depthShadowMap"),depthOnly:new G(X,c.vsTerrainDepthOnly,c.fsTerrainDepthOnly,H.Default3D),highlight:new G(X,c.vsTerrainHighlight,c.fsTerrainHighlight,
H.Default3D)};Y={color:f,normal:d};this._updatePrograms();pa=new q(X,e,a,this.resourceCounter,this.setNeedsRender.bind(this));this.renderTileBackground();va=new D(X,{target:aa.TEXTURE_2D,pixelFormat:aa.RGBA,dataType:aa.UNSIGNED_BYTE,samplingMode:aa.NEAREST,width:4,height:4})};this.uninitializeRenderContext=function(a){null!=va&&(va.dispose(),va=null);pa&&(pa.dispose(),pa=null)};this._updatePrograms=function(){var a="spherical"===h,b="shader"===ha.mode;W.color=Y.color.getProgram([a,!0,a&&Z,b,na,b||
na,this.receiveShadows,ga]);W.normal=Y.normal.getProgram([a,!0]);this.setNeedsRender()};this.install=function(a){a.addExternalRenderer([T,A],this)};this.uninstall=function(a){a.removeExternalRenderer(this)};this.setRootTiles=function(a){U=a;this.setNeedsRender()};this.setNeedsHighlight=function(a){this.needsHighlight=a;this.setNeedsRender()};this.setStencilEnabledLayerExtents=function(a){Ea=a;this.setNeedsRender()};this.setTileSize=function(a){e=a;pa&&(pa.tileSize=a);this.setNeedsRender()};this.loadTile=
function(a){O(null===a.renderData);a.renderData=da.acquire();a.renderData.init();var b=this.getLocalOriginOfTile(a),c=a.createGeometry(a.renderData.updateGeometryState(a),b,"debug"===ha.mode,a.renderData.geometryInfo);a.renderData.localOrigin=b;this._setTileGeometry(a,c);wa&&pa.updateTileTexture(a)};this.queryVisibleLevelRange=function(a,b,c,e){var d=Ja.acquire();M.set(a,d.extent);d.minLevel=b?b:-Number.MAX_VALUE;d.maxLevel=null!=c?c:Number.MAX_VALUE;d.callback=e;Da.push(d);this.setNeedsRender()};
this.updateTileTexture=function(a){pa&&wa&&pa.updateTileTexture(a)};this.updateTileGeometryNeedsUpdate=function(a){return a.renderData.updateGeometryState(a).needsUpdate};this._updateTileGeometry=function(a){for(var b=a.renderData.geometryState,c=a.layerInfo[f.LayerClass.ELEVATION],e=0;e<c.length;e++)c[e].pendingUpdates&=~f.TileUpdateTypes.UPDATE_GEOMETRY;return b.needsUpdate?(a.renderData.vao&&this._releaseTileGeometry(a),b=a.createGeometry(b,a.renderData.localOrigin,"debug"===ha.mode,a.renderData.geometryInfo),
this._setTileGeometry(a,b),!0):!1};this.updateTileGeometry=function(a){a.renderData.updateGeometryState(a);return this._updateTileGeometry(a)};this.unloadTile=function(a){this._releaseTileGeometry(a);a.renderData.texture&&a.renderData.texture.dispose();da.release(a.renderData);a.renderData=null};this.getLocalOriginOfTile=function(a){if(10<=a.lij[0]){for(;7<a.lij[0];)a=a.parent;return a.centerAtSeaLevel}if("spherical"===h)return V;for(;a.parent;)a=a.parent;return a.centerAtSeaLevel};this.setVisibility=
function(a){qa=a;this.setNeedsRender()};this.getStats=function(){return{numTilesRendered:Ba,numTilesCulled:Ga,numTrianglesRendered:Fa,numOriginsRendered:Ha}};this.setDisableRendering=function(a){oa=!!a;this.setNeedsRender()};this.getOpacity=function(){return ja};this.getWireframeEnabled=function(){return"shader"===ha.mode};this.setDebugScreenSizePerspective=function(a){a!==ga&&(ga=a,this._updatePrograms())};this.setWireframe=function(a){a&&!0!==a||(a={mode:a?"shader":"none"});if(void 0!==a.mode&&
ha.mode!==a.mode){var b="debug"===ha.mode,c="debug"===a.mode;ha.mode=a.mode;this._updatePrograms();b!==c&&U&&l.traverseTilesPreorder(U,function(a){if(a.renderData){a.renderData.vao&&this._releaseTileGeometry(a);var b=a.createGeometry(a.renderData.updateGeometryState(a),a.renderData.localOrigin,c,a.renderData.geometryInfo);this._setTileGeometry(a,b)}}.bind(this))}for(var d in a)ha.hasOwnProperty(d)&&(ha[d]=a[d]),this.setNeedsRender();ha.resolution&&(ha.resolution=Math.min(ha.resolution,e),ha.resolution=
1<<Math.round(Math.log(ha.resolution)/Math.LN2))};this.setOpacity=function(a){ja=a;this.setNeedsRender()};this.setDrawSkirts=function(a){ra=a;this.setNeedsRender()};this.setCullBackFaces=function(a){ka=a;this.setNeedsRender()};this.setRenderOrder=function(a){sa=a;this.setNeedsRender()};this.setBorders=function(a){na!==a&&(na=a,this._updatePrograms())};this.setFrontMostTransparent=function(a){ma!==a&&(ma=a,this.setNeedsRender())};this.setVelvetOverground=function(a){Z!==a&&(Z=a,this._updatePrograms())};
this.setNeedsRender=function(){this.needsRender=!0;this.didRender=!1;ia=!0};this.resetNeedsRender=function(){this.didRender&&(this.needsRender=0!==Da.length,this.didRender=!1)};var fa=L.create();this.isTransparent=function(){return 1>ja||"shader"===ha.mode&&(1>ha.wireOpacity||1>ha.surfaceOpacity)};this._renderMaterialPass=function(a,b){var c=this.isTransparent(),e=a.shadowMap&&a.shadowMap.getEnableState();this.receiveShadows!=e&&(this.receiveShadows=e,this._updatePrograms());e=a.camera;X.setDepthTestEnabled(!0);
X.setBlendingEnabled(c);c&&X.setBlendFunctionSeparate(aa.SRC_ALPHA,aa.ONE_MINUS_SRC_ALPHA,aa.ONE,aa.ONE_MINUS_SRC_ALPHA);c&&ma?(c=W.depthOnly,X.bindProgram(c),X.setColorMask(!1,!1,!1,!1),X.setDepthWriteEnabled(!0),this._renderTilesAuxilliary(a,c,b),X.setColorMask(!0,!0,!0,!0),X.setDepthFunction(aa.EQUAL),X.setDepthWriteEnabled(!1)):X.setDepthFunction(aa.LESS);c=W.color;X.bindProgram(c);c.setUniform1f("opacity",ja);if("shader"===ha.mode||na)c.setUniform1f("wireframe.width",ha.width),c.setUniform1f("wireframe.falloff",
Math.min(ha.width,ha.falloff)),c.setUniform1f("wireframe.wireOpacity",ha.wireOpacity*ja),c.setUniform1f("wireframe.surfaceOpacity",ha.surfaceOpacity*ja),c.setUniform4fv("wireframe.color",ha.color);e=a.camera;a.shadowMap&&a.shadowMap.bind(c);a.ssaoHelper&&a.ssaoHelper.setUniforms(c);c.setUniform1i("tex",4);c.setUniform1i("overlayTex",5);c.setUniformMatrix4fv("viewNormal",e.viewInverseTransposeMatrix);c.setUniformMatrix4fv("proj",e.projectionMatrix);a.lightingData.helper.setUniforms(c,!0);e=e.viewMatrix;
L.set3(e[12],e[13],e[14],fa);L.normalize(fa);c.setUniform3fv("viewDirection",fa);for(Ha=Fa=Ga=Ba=0;ua.length<ua.data.length&&0<Da.length;)e=Da.pop(),ua.push(e);Ca=ua.length;this._renderTiles(a,c,b);X.setBlendingEnabled(!1);X.setDepthFunction(aa.LESS);X.setDepthWriteEnabled(!0);for(a=0;a<ua.length;a++)b=ua.data[a],Ja.release(b),b.callback(a>=Ca),b.callback=null;ua.clear();0<Ba&&!Ia&&(Ia=!0,this.loaded&&this.loaded())};this._renderDepthPass=function(a,b,c){var e=a.camera;X.bindProgram(b);X.setBlendingEnabled(!1);
X.setDepthTestEnabled(!0);X.setDepthFunction(aa.LESS);b.setUniformMatrix4fv("model",R);b.setUniformMatrix4fv("viewNormal",e.viewInverseTransposeMatrix);S[0]=e.near;S[1]=e.far;b.setUniform2fv("nearFar",S);this._renderTilesAuxilliary(a,b,c)};this._renderNormalPass=function(a,b){var c=a.camera,e=W.normal;X.bindProgram(e);X.setBlendingEnabled(!1);X.setDepthTestEnabled(!0);X.setDepthFunction(aa.LESS);e.setUniformMatrix4fv("viewNormal",c.viewInverseTransposeMatrix);this._renderTilesAuxilliary(a,e,b)};this._renderHighlightPass=
function(a,b){var c=W.highlight;X.bindProgram(c);X.setBlendingEnabled(!1);X.setDepthTestEnabled(!0);X.setDepthFunction(aa.LESS);var e=a.offscreenRenderingHelper;X.bindTexture(e.getDepthTexture(),6);c.setUniform1i("depthTex",6);c.setUniform4f("highlightViewportPixelSz",0,0,1/e.width,1/e.height);this._renderTilesAuxilliary(a,c,b,!0)};this.render=function(a){if(E&&!oa&&qa&&U&&wa){var b=this.isTransparent()?A:T;if(a.slot===b){c.trace("# BEGIN RENDER TERRAIN");b=a.pass;X.setFaceCullingEnabled(ka);var e=
1===a.lightingData.helper.globalFactor;b===C.MATERIAL?this._renderMaterialPass(a,this._updatePerOriginTileData()):b===C.MATERIAL_DEPTH_SHADOWMAP&&this.castShadows&&e?this._renderDepthPass(a,W.depthShadowMap,this._updatePerOriginTileData()):b===C.MATERIAL_DEPTH?this._renderDepthPass(a,W.depth,this._updatePerOriginTileData()):b===C.MATERIAL_NORMAL?this._renderNormalPass(a,this._updatePerOriginTileData()):b===C.MATERIAL_HIGHLIGHT&&this.needsHighlight&&(this._renderHighlightPass(a,this._updatePerOriginTileData()),
X.clear(X.gl.DEPTH_BUFFER_BIT));ka&&X.setFaceCullingEnabled(!1);c.trace("# END RENDER TERRAIN");return!0}}};this._updatePerOriginTileData=function(){if(!ia)return ea;la=null;this._renderCollectOrigins();if(0!==sa){for(var a=0;a<ea.length;a++)this._sortFrontToBack(ea.data[a].tiles,n);this._sortFrontToBack(ea,r)}ia=!1;return ea};this._renderCollectOrigins=function(){ea.clear();for(var a=0;a<U.length;a++){var b=U[a],c=ea.next();c.root=b;c.origin="spherical"===h?V:b.centerAtSeaLevel;c.tiles.clear();this._renderCollectOriginsForRoot(c)}return!0};
this._renderCollectOriginsForRoot=function(a){for(ba.reset(a.root);!ba.done;){var b=ba.next(),c=b.renderData;if(c&&!b.visible)Ga++,ba.skip();else{var e=ea.peek();if(7===b.lij[0]){if(e===a||0!==e.tiles.length)e=ea.next(),e.tiles.clear();e.root=b;e.origin=b.centerAtSeaLevel}if(c){10<=b.lij[0]?ea.peek().tiles.push(b):a.tiles.push(b);if(!la||b.vlevel>la.vlevel)la=b;ba.skip()}}}};this._sortFrontToBack=function(a,b){a.sort(b)};this._updateStencilReadStateForTile=function(a,b){if(a.stencilRenderingHelper&&
a.stencilRenderingHelper.getEnableState()){for(var c=!1,e=0;e<Ea.length;e++)if(b.intersectsExtent(Ea[e])){c=!0;break}c?a.stencilRenderingHelper.enableStencilRead():a.stencilRenderingHelper.disableStencilRead()}};this._renderTilesAuxilliary=function(a,b,c,e){var d=a.camera,f=d.viewMatrix,g=a.rctx;b.setUniformMatrix4fv("proj",d.projectionMatrix);e&&b.setUniform1i("overlayTex",5);for(d=0;d<c.length;d++){var h=c.data[d];b.setUniform3fv("origin",h.origin);v.bindView(h.origin,f,b);for(var k=0;k<h.tiles.length;k++){var m=
h.tiles.data[k],l=m.renderData;e&&(l.highlightOverlayTexId?xa(b,l,l.highlightOverlayTexId):g.bindTexture(va,5));this._updateStencilReadStateForTile(a,m);g.bindVAO(l.vao);P.assertCompatibleVertexAttributeLocations(l.vao,b);m=l.vao.indexBuffer.size;ra||(m=l.geometryInfo.numWithoutSkirtIndices);g.drawElements(aa.TRIANGLES,m,l.vao.indexBuffer.indexType,0)}}g.bindVAO(null);g.stencilRenderingHelper&&g.stencilRenderingHelper.disableStencilRead()};this._renderTiles=function(a,b,d){var f=a.camera.viewMatrix;
if(ga){var k=J.getSettings(h);k.update({distance:g.distanceToSurface,fovY:g.fovY});v.bindScreenSizePerspective(k,b,"screenSizePerspective")}for(k=0;k<d.length;k++){var m=d.data[k];b.setUniform3fv("origin",m.origin);v.bindView(m.origin,f,b);a.shadowMap&&a.shadowMap.bindView(b,m.origin);Ha++;var l=m.tiles;if(0!==l.length){var p=aa.TRIANGLES;"debug"===ha.mode&&(p=aa.LINES);var n=la,r;n?(n=n.vlevel,r=e/ha.resolution):(n=16,r=e/64);for(var q=0;q<l.length;q++){var u=l.data[q],m=u.renderData;this._updateStencilReadStateForTile(a,
u);c.trace("# RENDER TILE "+u.lij[0]+"/"+u.lij[1]+"/"+u.lij[2]+", screenDepth:"+u.screenDepth);b.setUniform2fv("texOffset",m.texOffset);b.setUniform1f("texScale",m.texScale);X.bindTexture(m.textureReference||m.texture,4);m.overlayTexId?xa(b,m,m.overlayTexId):(b.setUniform2fv("overlayTexOffset",Q),X.bindTexture(va,5));("shader"===ha.mode||na)&&b.setUniform1f("wireframe.subdivision",r*(1<<n-u.vlevel));var t=m.vao.indexBuffer.size;ra||(t=m.geometryInfo.numWithoutSkirtIndices);X.bindVAO(m.vao);P.assertCompatibleVertexAttributeLocations(m.vao,
b);X.drawElements(p,t,m.vao.indexBuffer.indexType,0);u.renderOrder=Ba;Ba++;Fa+=t/3;m=u.extent;u=u.lij[0];for(t=0;t<Ca;){var x=ua.data[t],z=x.extent;u>=x.minLevel&&u<=x.maxLevel&&z[0]<=m[2]&&z[2]>=m[0]&&z[1]<=m[3]&&z[3]>=m[1]?(ua.swap(t,Ca-1),Ca--):t++}}}}X.bindVAO(null);a.stencilRenderingHelper&&a.stencilRenderingHelper.disableStencilRead()};var xa=function(a,b,c){var e=ca[c];e||(e=u.aquire(c).getGLTexture(),O(e),ca[c]=e);a.setUniform2fv("overlayTexOffset",b.overlayTexOffset);a.setUniform2fv("overlayTexScale",
b.overlayTexScale);a.setUniform1f("overlayOpacity",b.overlayOpacity);X.bindTexture(e,5)},ya=L.create(),za=L.create(),Aa=L.create(),Ka=this.clippingExtent;this.intersect=function(a,b,c){if(U&&(!a.isSelection||!this.isTransparent())&&a.enableTerrain){L.subtract(c,b,ya);var e=a.getMinResult(),d=a.getMaxResult();ba.reset(U);for(var f={};!ba.done;){var g=ba.next();if(null!==g.renderData){if(a.enableInvisibleTerrain){if(!g.visible&&Ka&&!g.intersectsExtent(Ka))continue}else if(!g.visible)continue;var h=
g.renderData.geometryInfo.geometry,k=g.renderData.localOrigin;L.subtract(b,k,za);L.subtract(c,k,Aa);v.intersectTriangleGeometry(h,f,void 0,a,za,Aa,function(b,c,f){if((ra||!(3*f>=g.renderData.geometryInfo.numWithoutSkirtIndices))&&0<=b&&(a.enableBackfacesTerrain||0>L.dot(c,ya))){if(void 0===e.dist||b<e.dist)f=l.lij2str(g.lij[0],g.lij[1],g.lij[2]),e.set(void 0,f,b,c,void 0),e.setIntersector("terrain");if(void 0===d.dist||b>d.dist)f=l.lij2str(g.lij[0],g.lij[1],g.lij[2]),d.set(void 0,f,b,c,void 0),d.setIntersector("terrain")}})}}}};
this._setTileGeometry=function(b,c){b=b.renderData;var e=c.geometry.getData(),d=e.getVertexAttr().terrain.data,e=e.getFaces()[0].indices.terrain;b.vao=new B(X,H.Default3D,{geometry:K.Pos3Tex},{geometry:I.createVertex(X,aa.STATIC_DRAW,d)},I.createIndex(X,aa.STATIC_DRAW,e));b.geometryInfo.geometry&&a.releaseGeometry(b.geometryInfo.geometry);b.geometryInfo=c;this.setNeedsRender()};this._releaseTileGeometry=function(b){b=b.renderData;b.vao.dispose(!0);b.vao=null;b.geometryInfo.geometry&&a.releaseGeometry(b.geometryInfo.geometry);
b.geometryInfo.geometry=null;this.setNeedsRender()}};u.TileRenderData=d;return u})},"esri/views/3d/terrain/TileRenderData":function(){define(["require","exports","../lib/glMatrix"],function(w,l,f){var a=f.vec2d;return function(){function d(){this.overlayTexOffset=a.create();this.texOffset=a.create();this.geometryInfo={geometry:null,numSurfaceIndices:0,numSkirtIndices:0,numWithoutSkirtIndices:0,numVertsPerRow:0};this.init()}d.prototype.init=function(){this.geometryInfo.geometry=null;this.geometryInfo.numSurfaceIndices=
0;this.geometryInfo.numSkirtIndices=0;this.geometryInfo.numWithoutSkirtIndices=0;this.geometryInfo.numVertsPerRow=0;this.textureReference=this.texture=this.vao=this.geometryState=null;a.set2(0,0,this.texOffset);this.texScale=1;this.highlightOverlayTexId=this.overlayTexId=null;this.overlayTexScale=[1,1];this.overlayOpacity=1;this.localOrigin=null};d.prototype.updateGeometryState=function(a){return this.geometryState=a.geometryState(this.geometryState)};return d}()})},"esri/views/3d/terrain/ResourceCounter":function(){define(["require",
"exports"],function(w,l){return function(){function f(){this._numTileTexturesComposited=0}Object.defineProperty(f.prototype,"numTileTexturesComposited",{get:function(){return this._numTileTexturesComposited},enumerable:!0,configurable:!0});f.prototype.incrementNumTileTexturesComposited=function(){this._numTileTexturesComposited++};f.prototype.resetNumTileTexturesComposited=function(){this._numTileTexturesComposited=0};return f}()})},"esri/views/3d/terrain/TileRenderer":function(){define("require exports ../lib/glMatrix ../../webgl/FramebufferObject ../../webgl/VertexArrayObject ../../webgl/Texture ../../webgl/BufferObject ../../webgl/Util ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../../vectorTiles/VectorTileDisplayObject ../../vectorTiles/tileRendererHelper3D ./TerrainConst".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z){var v=f.vec2d,r=Array(20),u=[0,0];return function(){function f(a,b,f,l,p){this._gridTex=null;this.tileSize=256;this._context=a;this.tileSize=b;this._resourceCounter=l;this._setNeedsRender=p;a.extensions.textureFilterAnisotropic&&(this._maxAnisotropy=Math.min(8,a.parameters.maxMaxAnisotropy));b=new Float32Array(20);b[0]=-1;b[1]=-1;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=-1;b[7]=0;b[8]=1;b[9]=0;b[10]=-1;b[11]=1;b[12]=0;b[13]=0;b[14]=1;b[15]=1;b[16]=1;b[17]=0;b[18]=1;b[19]=
1;this._vaoQuad=new d(a,m.Default3D,{geometry:k.Pos3Tex},{geometry:q.createVertex(a,35044,b)});this._blendLayersProgram=f.get("blendLayers")}f.prototype.dispose=function(){this._fbo&&(this._fbo.dispose(),this._fbo=null);this._vaoQuad&&(this._vaoQuad.dispose(),this._vaoQuad=null);this._gridTex&&(this._gridTex.dispose(),this._gridTex=null);this._blendLayersProgram&&(this._blendLayersProgram.dispose(),this._blendLayersProgram=null);this._context&&(this._context=null)};f.prototype.updateTileTexture=function(a){for(var b=
z.LayerClass.MAP,d=a.layerInfo[b],f=0;f<d.length;f++)d[f].pendingUpdates&=~z.TileUpdateTypes.UPDATE_TEXTURE;if(a.renderData){var k,f=a.renderData,m,l=0,p=!0;for(m=0;m<d.length;m++){k=d[m];var q=a.parentSurface.layerViewByIndex(m,b);r[m]=q.fullOpacity;if(k.data||k.upsampleFromTile)if(l++,!q.isTransparent){p=!1;break}}m===d.length&&m--;0===l&&this._gridTex?(f.textureReference=this._gridTex,v.set2(0,0,f.texOffset),f.texScale=1):1!==l||p?(this._composeMapLayers(a,d,m,p,r),f.textureReference=null,v.set2(0,
0,f.texOffset),f.texScale=1):(k=d[m],k.data?(b=k,v.set2(0,0,f.texOffset),f.texScale=1):(a=k.upsampleFromTile,b=a.tile.layerInfo[b][m],v.set(a.offset,f.texOffset),f.texScale=a.scale),b&&(b.data instanceof HTMLImageElement&&(b.data=this._buildTexture(b.data)),f.textureReference=b.data));this._setNeedsRender()}};f.prototype.setGridImage=function(a){this._gridTex=this._buildTexture(a)};f.prototype._buildTexture=function(a){var c={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,
maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},d=this._context,f;if(a)try{f=new b(d,c,a)}catch(I){c.width=c.height=this.tileSize,f=new b(d,c),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}else c.width=c.height=this.tileSize,f=new b(d,c);d.bindTexture(f);f.generateMipmap();return f};f.prototype._drawVectorData=function(a,b,d,f,k,m,l,p){void 0===p&&(p=1);x(this._context,d,a,b.renderer,b.schemeHelper,d[0],f,k,0,m,l,p)};f.prototype._drawRasterData=
function(a,b,d,f){void 0===f&&(f=1);var c=this._context,k=this._blendLayersProgram,m=this._vaoQuad;c.bindProgram(k);c.bindVAO(m);t.assertCompatibleVertexAttributeLocations(m,k);c.bindTexture(a,0);k.setUniform1i("tex",0);k.setUniform1f("scale",b);k.setUniform2f("offset",d[0],d[1]);k.setUniform1f("opacity",f);c.drawArrays(5,0,t.vertexCount(m,"geometry"))};f.prototype._composeMapLayers=function(b,c,d,f,k){var m=z.LayerClass.MAP,l=this._context;b.renderData.texture||(b.renderData.texture=this._buildTexture());
var r=b.renderData.texture,q=this._fbo;q&&q.width===r.descriptor.width&&q.height===r.descriptor.height||(this._fbo=q=a.create(l,{colorTarget:0,depthStencilTarget:1,width:r.descriptor.width,height:r.descriptor.height}));var v=l.gl;l.bindFramebuffer(q);l.setViewport(0,0,this.tileSize,this.tileSize);l.setClearColor(0,0,0,0);l.setClearDepth(1);l.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT);l.setDepthTestEnabled(!1);l.setBlendFunctionSeparate(1,771,1,771);l.setBlendEquation(32774);l.setBlendingEnabled(!0);
var t,x;for(f&&this._gridTex&&this._drawRasterData(this._gridTex,1,u);0<=d;d--)if(f=null,q=c[d],q.data?(f=q,t=u,x=1):q.upsampleFromTile&&(x=q.upsampleFromTile,f=x.tile.layerInfo[m][d],t=x.offset,x=x.scale),f){if(f.data instanceof HTMLImageElement||f.data instanceof HTMLCanvasElement)f.data=this._buildTexture(f.data);f.data instanceof p?(q=b.parentSurface.layerViewByIndex(d,m),this._drawVectorData(f.data,q,b.lij,r.descriptor.width,r.descriptor.height,x,t,k[d])):this._drawRasterData(f.data,x,t,k[d])}l.bindTexture(r);
v.copyTexImage2D(l.gl.TEXTURE_2D,0,r.descriptor.pixelFormat,0,0,r.descriptor.width,r.descriptor.height,0);r.generateMipmap();l.bindFramebuffer(null);l.setBlendFunctionSeparate(770,771,1,771);l.setBlendingEnabled(!1);this._resourceCounter.incrementNumTileTexturesComposited()};return f}()})},"esri/views/vectorTiles/tileRendererHelper3D":function(){define(["require","exports","dojo/has","../../core/libs/gl-matrix/vec3","../../core/libs/gl-matrix/mat4"],function(w,l,f,a,d){var b={extent:{xmin:0,ymin:0,
xmax:0,ymax:0,spatialReference:{wkid:102100,isWrappable:!0},intersects:function(a){return!1}},center:[0,0],scale:1,resolution:1,rotation:0,width:1,height:1,pixelRatio:1,size:[256,256],spatialReference:{wkid:102100,isWrappable:!0},worldScreenWidth:1,viewpoint:{},toMap:function(a,b){return[0,0]},toScreen:function(a,b){return[0,0]},clone:function(){return null},copy:function(a){return this}},q=a.create();return function(a,m,k,l,x,z,v,r,u,w,E,c){u=[m[0],m[1],m[2]];for(var p=w;1>p;p*=2)u[0]--,u[1]>>=1,
u[2]>>=1;m={context:a,budget:null,state:b,stationary:!0,devicePixelRatio:1,displayLevel:x.adjustLevel(z),requiredLevel:x.adjustLevel(m[0]),drawphase:0,renderer:l,layerOpacity:c};if(v!==r)throw Error("It is expected that tiles are square!");z=1/w;c=x.getSchemaShift(u,z);p=c[1];k.tileTransform.displayCoord[0]=-1-2*z*E[0]-c[0];k.tileTransform.displayCoord[1]=1+2*z*(1-E[1]-w)+p;w=k.tileTransform.transform;d.identity(w);x.isWGS84&&512===x.lockedSchemaPixelSize&&(z*=2);x=.25*z/v;q.set([x,-x,1]);d.scale(w,
w,q);a.setBlendFunctionSeparate(1,771,1,771);a.setClearDepth(1);a.clear(a.gl.DEPTH_BUFFER_BIT);m.state.size=[v,r];m.state.width=v;m.state.height=r;l.setStateParams(m.state,m.devicePixelRatio,u[0]);k.attach(m);a.setFaceCullingEnabled(!1);a.setDepthFunction(515);a.setBlendingEnabled(!1);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(!0);k.processRender(m);a.setDepthWriteEnabled(!1);a.setBlendingEnabled(!0);m.drawphase=1;k.processRender(m);m.drawphase=2;k.processRender(m);f("esri-vector-tiles-debug")&&
l.renderTileInfo(a,k);a.setDepthWriteEnabled(!0);a.setDepthTestEnabled(!1);a.setFaceCullingEnabled(!0)}})},"esri/core/libs/gl-matrix/vec3":function(){define(["./common"],function(w){var l={create:function(){var f=new w.ARRAY_TYPE(3);f[0]=0;f[1]=0;f[2]=0;return f},clone:function(f){var a=new w.ARRAY_TYPE(3);a[0]=f[0];a[1]=f[1];a[2]=f[2];return a},fromValues:function(f,a,d){var b=new w.ARRAY_TYPE(3);b[0]=f;b[1]=a;b[2]=d;return b},copy:function(f,a){f[0]=a[0];f[1]=a[1];f[2]=a[2];return f},set:function(f,
a,d,b){f[0]=a;f[1]=d;f[2]=b;return f},add:function(f,a,d){f[0]=a[0]+d[0];f[1]=a[1]+d[1];f[2]=a[2]+d[2];return f},subtract:function(f,a,d){f[0]=a[0]-d[0];f[1]=a[1]-d[1];f[2]=a[2]-d[2];return f}};l.sub=l.subtract;l.multiply=function(f,a,d){f[0]=a[0]*d[0];f[1]=a[1]*d[1];f[2]=a[2]*d[2];return f};l.mul=l.multiply;l.divide=function(f,a,d){f[0]=a[0]/d[0];f[1]=a[1]/d[1];f[2]=a[2]/d[2];return f};l.div=l.divide;l.ceil=function(f,a){f[0]=Math.ceil(a[0]);f[1]=Math.ceil(a[1]);f[2]=Math.ceil(a[2]);return f};l.floor=
function(f,a){f[0]=Math.floor(a[0]);f[1]=Math.floor(a[1]);f[2]=Math.floor(a[2]);return f};l.min=function(f,a,d){f[0]=Math.min(a[0],d[0]);f[1]=Math.min(a[1],d[1]);f[2]=Math.min(a[2],d[2]);return f};l.max=function(f,a,d){f[0]=Math.max(a[0],d[0]);f[1]=Math.max(a[1],d[1]);f[2]=Math.max(a[2],d[2]);return f};l.round=function(f,a){f[0]=Math.round(a[0]);f[1]=Math.round(a[1]);f[2]=Math.round(a[2]);return f};l.scale=function(f,a,d){f[0]=a[0]*d;f[1]=a[1]*d;f[2]=a[2]*d;return f};l.scaleAndAdd=function(f,a,d,
b){f[0]=a[0]+d[0]*b;f[1]=a[1]+d[1]*b;f[2]=a[2]+d[2]*b;return f};l.distance=function(f,a){var d=a[0]-f[0],b=a[1]-f[1];f=a[2]-f[2];return Math.sqrt(d*d+b*b+f*f)};l.dist=l.distance;l.squaredDistance=function(f,a){var d=a[0]-f[0],b=a[1]-f[1];f=a[2]-f[2];return d*d+b*b+f*f};l.sqrDist=l.squaredDistance;l.length=function(f){var a=f[0],d=f[1];f=f[2];return Math.sqrt(a*a+d*d+f*f)};l.len=l.length;l.squaredLength=function(f){var a=f[0],d=f[1];f=f[2];return a*a+d*d+f*f};l.sqrLen=l.squaredLength;l.negate=function(f,
a){f[0]=-a[0];f[1]=-a[1];f[2]=-a[2];return f};l.inverse=function(f,a){f[0]=1/a[0];f[1]=1/a[1];f[2]=1/a[2];return f};l.normalize=function(f,a){var d=a[0],b=a[1],l=a[2],d=d*d+b*b+l*l;0<d&&(d=1/Math.sqrt(d),f[0]=a[0]*d,f[1]=a[1]*d,f[2]=a[2]*d);return f};l.dot=function(f,a){return f[0]*a[0]+f[1]*a[1]+f[2]*a[2]};l.cross=function(f,a,d){var b=a[0],l=a[1];a=a[2];var t=d[0],m=d[1];d=d[2];f[0]=l*d-a*m;f[1]=a*t-b*d;f[2]=b*m-l*t;return f};l.lerp=function(f,a,d,b){var l=a[0],t=a[1];a=a[2];f[0]=l+b*(d[0]-l);f[1]=
t+b*(d[1]-t);f[2]=a+b*(d[2]-a);return f};l.hermite=function(f,a,d,b,l,t){var m=t*t,k=m*(2*t-3)+1,p=m*(t-2)+t,q=m*(t-1);t=m*(3-2*t);f[0]=a[0]*k+d[0]*p+b[0]*q+l[0]*t;f[1]=a[1]*k+d[1]*p+b[1]*q+l[1]*t;f[2]=a[2]*k+d[2]*p+b[2]*q+l[2]*t;return f};l.bezier=function(f,a,d,b,l,t){var m=1-t,k=m*m,p=t*t,q=k*m,k=3*t*k,m=3*p*m;t*=p;f[0]=a[0]*q+d[0]*k+b[0]*m+l[0]*t;f[1]=a[1]*q+d[1]*k+b[1]*m+l[1]*t;f[2]=a[2]*q+d[2]*k+b[2]*m+l[2]*t;return f};l.random=function(f,a){a=a||1;var d=2*w.RANDOM()*Math.PI,b=2*w.RANDOM()-
1,l=Math.sqrt(1-b*b)*a;f[0]=Math.cos(d)*l;f[1]=Math.sin(d)*l;f[2]=b*a;return f};l.transformMat4=function(f,a,d){var b=a[0],l=a[1];a=a[2];var t=d[3]*b+d[7]*l+d[11]*a+d[15],t=t||1;f[0]=(d[0]*b+d[4]*l+d[8]*a+d[12])/t;f[1]=(d[1]*b+d[5]*l+d[9]*a+d[13])/t;f[2]=(d[2]*b+d[6]*l+d[10]*a+d[14])/t;return f};l.transformMat3=function(f,a,d){var b=a[0],l=a[1];a=a[2];f[0]=b*d[0]+l*d[3]+a*d[6];f[1]=b*d[1]+l*d[4]+a*d[7];f[2]=b*d[2]+l*d[5]+a*d[8];return f};l.transformQuat=function(f,a,d){var b=a[0],l=a[1],t=a[2];a=
d[0];var m=d[1],k=d[2];d=d[3];var p=d*b+m*t-k*l,x=d*l+k*b-a*t,z=d*t+a*l-m*b,b=-a*b-m*l-k*t;f[0]=p*d+b*-a+x*-k-z*-m;f[1]=x*d+b*-m+z*-a-p*-k;f[2]=z*d+b*-k+p*-m-x*-a;return f};l.rotateX=function(f,a,d,b){var l=[],t=[];l[0]=a[0]-d[0];l[1]=a[1]-d[1];l[2]=a[2]-d[2];t[0]=l[0];t[1]=l[1]*Math.cos(b)-l[2]*Math.sin(b);t[2]=l[1]*Math.sin(b)+l[2]*Math.cos(b);f[0]=t[0]+d[0];f[1]=t[1]+d[1];f[2]=t[2]+d[2];return f};l.rotateY=function(f,a,d,b){var l=[],t=[];l[0]=a[0]-d[0];l[1]=a[1]-d[1];l[2]=a[2]-d[2];t[0]=l[2]*Math.sin(b)+
l[0]*Math.cos(b);t[1]=l[1];t[2]=l[2]*Math.cos(b)-l[0]*Math.sin(b);f[0]=t[0]+d[0];f[1]=t[1]+d[1];f[2]=t[2]+d[2];return f};l.rotateZ=function(f,a,d,b){var l=[],t=[];l[0]=a[0]-d[0];l[1]=a[1]-d[1];l[2]=a[2]-d[2];t[0]=l[0]*Math.cos(b)-l[1]*Math.sin(b);t[1]=l[0]*Math.sin(b)+l[1]*Math.cos(b);t[2]=l[2];f[0]=t[0]+d[0];f[1]=t[1]+d[1];f[2]=t[2]+d[2];return f};l.forEach=function(){var f=l.create();return function(a,d,b,l,t,m){d||(d=3);b||(b=0);for(l=l?Math.min(l*d+b,a.length):a.length;b<l;b+=d)f[0]=a[b],f[1]=
a[b+1],f[2]=a[b+2],t(f,f,m),a[b]=f[0],a[b+1]=f[1],a[b+2]=f[2];return a}}();l.angle=function(f,a){f=l.fromValues(f[0],f[1],f[2]);a=l.fromValues(a[0],a[1],a[2]);l.normalize(f,f);l.normalize(a,a);a=l.dot(f,a);return 1<a?0:Math.acos(a)};l.str=function(f){return"vec3("+f[0]+", "+f[1]+", "+f[2]+")"};l.exactEquals=function(f,a){return f[0]===a[0]&&f[1]===a[1]&&f[2]===a[2]};l.equals=function(f,a){var d=f[0],b=f[1];f=f[2];var l=a[0],t=a[1];a=a[2];return Math.abs(d-l)<=w.EPSILON*Math.max(1,Math.abs(d),Math.abs(l))&&
Math.abs(b-t)<=w.EPSILON*Math.max(1,Math.abs(b),Math.abs(t))&&Math.abs(f-a)<=w.EPSILON*Math.max(1,Math.abs(f),Math.abs(a))};return l})},"esri/views/3d/terrain/TilemapOnlyTile":function(){define(["require","exports","./TerrainConst","./TilePerLayerInfo"],function(w,l,f,a){return function(){function d(a){this.parent=null;this.lij=a;this.layerInfo=Array(f.LayerClass.LAYER_CLASS_COUNT)}d.prototype.tileDataAvailable=function(a,d,f){return(d=this.layerInfo[f][d].tilemap)?"unavailable"!==d.getAvailability(a.lij[1],
a.lij[2]):!0};d.prototype.modifyLayers=function(b,d,f){b=d.length;for(var m=this.layerInfo[f],k=Array(b),l=0;l<b;l++){var q=d[l];k[l]=-1<q?m[q]:new a(f)}this.layerInfo[f]=k};return d}()})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/watchUtils ../../../../core/HandleRegistry ../../../../core/Logger ../../support/aaBoundingRect ../../support/PreallocArray ./deconflictorDebug ../../lib/glMatrix ../../webgl-engine/lib/Util ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/materials/internal/MaterialUtil ../../webgl-engine/materials/HUDMaterial".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v){function r(a){return!!a&&"selection"===a.type}var u=k.vec2d;w=k.vec4d;var C=p.VertexAttrConstants,E=b.getLogger("esri.views.3d.graphics.Deconflictor"),c=w.create(),D=w.create(),B=w.create(),I=w.create(),G=u.create(),H=q.create(),K=q.create(),J=new Set,P=p.lerp,O=new t(100),L=new t(100),M=function(){function a(a,b){this.creator=a;this.disposer=b;this.list=[];this.currentIndex=0}a.prototype.alloc=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];
this.currentIndex>=this.list.length&&this.list.push(new this.creator(a));return this.list[this.currentIndex++]};a.prototype.freeAll=function(){for(var a=this.currentIndex,b=this.disposer,c=this.list;0<=--a;)b(c[a]);this.currentIndex=0};return a}(),R=function(){function a(){this.graphics3DGraphic=null;this.positions=[u.create(),u.create(),u.create(),u.create()];this.posView=this.yMax=this.yMin=this.xMax=this.xMin=0;this.graphicsOwner=null;this.graphicId=this.id=0}a.release=function(a){a.graphics3DGraphic=
null;a.graphicsOwner=null};return a}();b=function(){function b(b){var c=this;this.graphicsOwners=[];this.deconflictTimeoutId=0;this.handles=new d;this.graphicInfoPool=new M(R,R.release);this.nextGraphicInfoId=0;this.accBinsNumX=15;this.accBinsNumY=20;this.accBinsSizeY=this.accBinsSizeX=0;this.accBins=null;this.accNumTests=0;this.iconMarginFactor=-.1;this.view=b;this.stage=b._stage;this.handles.add([a.on(b,"navigation","targetViewChanged",function(){return c.scheduleRun()}),a.whenNot(b,"ready",function(){return c.clearDeconflictTimeout()})])}
b.prototype.destroy=function(){this.handles.destroy();this.handles=null;this.clearDeconflictTimeout();this.graphicInfoPool.freeAll();this.stage=this.view=this.graphicInfoPool=null};b.prototype.clearDeconflictTimeout=function(){this.deconflictTimeoutId&&(clearTimeout(this.deconflictTimeoutId),this.deconflictTimeoutId=0)};b.prototype.addGraphicsOwner=function(a){var b=this;this.graphicsOwners.push(a);this.setDirty();a.layer&&"function"===typeof a.layer.watch&&a.layer.watch("featureReduction",function(c,
e){r(c)?b.setDirty():r(e)&&(b._removeIconVisibilityFlags(a),b.setDirty())})};b.prototype.removeGraphicsOwner=function(a){a=this.graphicsOwners.indexOf(a);0<=a&&this.graphicsOwners.splice(a,1);this.setDirty()};b.prototype.setDirty=function(){this.scheduleRun(10)};b.prototype.initializeLabelVisibility=function(a){a.setVisibilityFlag(2,!1,1)};b.prototype.doesIntersectExistingPoly=function(a){var b=a.graphicId,c=a.positions;J.clear();for(var e=Math.floor(a.xMin/this.accBinsSizeX);e<=Math.floor(a.xMax/
this.accBinsSizeX);e++)if(!(0>e||e>=this.accBinsNumX))for(var d=Math.floor(a.yMin/this.accBinsSizeY);d<=Math.floor(a.yMax/this.accBinsSizeY);d++)if(!(0>d||d>=this.accBinsNumY)){var f=this.accBins[e][d],k=0;a:for(;k<f.length;k++){var m=f.data[k];if(m.graphicId!==b&&!J.has(m.id)){J.add(m.id);m=m.positions;this.accNumTests++;for(var l=0;2>l;l++){var p=0===l?c:m,r=0===l?m:c,q=0;b:for(;4>q;q++){var v=p[q],t=p[(q+1)%4],x=p[(q+2)%4];G[0]=t[0]-v[0];G[1]=t[1]-v[1];t=u.normalize(G);w=[-t[1],t[0]];t[0]=w[0];
t[1]=w[1];v=t[0]*v[0]+t[1]*v[1];x=t[0]*x[0]+t[1]*x[1]<v;for(w=0;4>w;w++){var z=r[w],z=t[0]*z[0]+t[1]*z[1];if(x&&z<v||!x&&z>v)continue b}continue a}}return!0}}}return!1;var w};b.prototype.initBins=function(a,b){if(null==this.accBins){this.accBins=[];for(var c=0;c<this.accBinsNumX;c++){this.accBins.push([]);for(var e=this.accBins[this.accBins.length-1],d=0;d<this.accBinsNumY;d++)e.push(new t(10))}}for(c=0;c<this.accBinsNumX;c++)for(d=0;d<this.accBinsNumY;d++)this.accBins[c][d].clear();this.accBinsSizeX=
a/this.accBinsNumX;this.accBinsSizeY=b/this.accBinsNumY;this.accNumTests=0};b.prototype.addToBins=function(a){for(var b=Math.floor(a.xMin/this.accBinsSizeX);b<=Math.floor(a.xMax/this.accBinsSizeX);b++)if(!(0>b||b>=this.accBinsNumX))for(var c=Math.floor(a.yMin/this.accBinsSizeY);c<=Math.floor(a.yMax/this.accBinsSizeY);c++)0>c||c>=this.accBinsNumY||this.accBins[b][c].push(a)};b.prototype.scheduleRun=function(a){var b=this;void 0===a&&(a=200);0===this.deconflictTimeoutId&&(this.deconflictTimeoutId=setTimeout(function(){return b.run()},
a))};b.prototype.run=function(){var a=this.view;this.clearDeconflictTimeout();if(a.ready){var b=a.navigation.targetCamera;this.graphicInfoPool.freeAll();this.nextGraphicInfoId=0;var c=b.fullWidth,e=b.fullHeight;m.prepare(a);O.clear();L.clear();for(var a=!1,d=0;d<this.graphicsOwners.length;d++){var f=this.graphicsOwners[d];if(null!=f.getGraphics3DGraphics&&null!=f.getGraphics3DGraphicsKeys){var k=null!=f.labelsEnabled&&f.labelsEnabled(),l=r(f.layer?f.layer.featureReduction:null);if(k||l){a||(this.initBins(c,
e),a=!0);for(var p=f.getGraphics3DGraphics(),q=f.getGraphics3DGraphicsKeys(),v=0;v<q.length;v++){var u=p[q[v]];u.areVisibilityFlagsSet(void 0,2)&&(l&&this._collectGraphics(u,!1,f,b,O,this.iconMarginFactor),k&&this._collectGraphics(u,!0,f,b,L))}}}}O.sort(function(a,b){return b.posView-a.posView});L.sort(function(a,b){return b.posView-a.posView});this._deconflictVisibleObjects(O,!1);L.length&&this._deconflictVisibleObjects(L,!0);m.drawAccelerationStruct(this,O);m.drawAccelerationStruct(this,L)}else this.setDirty()};
b.prototype._collectGraphics=function(a,b,d,e,f,k){void 0===k&&(k=0);var g=b?a._labelGraphics:a._graphics,h=b?1:0;if(g.length){b=q.set(H,q.NEGATIVE_INFINITY);for(var m,l,p,n=0;n<g.length;n++){var r=g[n];if(!r.isDraped()){var u=r.stageObject,t=u?u.getNumGeometryRecords():0;if(!(1>t)){var w=u.getGeometryRecord(0),A=w.materials[0];if(A instanceof v)if(1<t)E.warn("Graphic objects with more than 1 geometry record are not supported");else{t=w.geometry.getData().getVertexAttr();if(!l){l=u.getCenter();p=
w.origin.vec3;l=z.transformToWorld(l,p,c);l=z.transformToView(l,p,e.viewMatrix,D);A.applyVerticalOffsetTransformation(l,t[C.NORMAL].data,u.objectTransformation,e,Q);u=t[C.AUXPOS1].data;t="screen"!==A.getParams().centerOffsetUnits;p=z.transformToProjection(l,e.projectionMatrix,t?u:[0,0,0],B);p=z.transformToNDC(p,I);t||(p[0]+=u[0]/e.fullWidth*2,p[1]+=u[1]/e.fullHeight*2);if(-1>p[0]||-1>p[1]||-1>p[2]||1<=p[0]||1<=p[1])break;m=l[2];a.areVisibilityFlagsSet(2,void 0,h)&&(m*=.7)}r=r.getScreenSize(T);x.applyPrecomputedScaleFactorVec2(r,
Q.factor,r);A=q.offset(A.calculateRelativeScreenBounds(r,Q.scaleAlignment,K),P(0,e.fullWidth,.5+.5*p[0]),P(0,e.fullHeight,.5+.5*p[1]));0!==k&&(r=k*Math.min(q.width(A),q.height(A)),A[0]-=r,A[1]-=r,A[2]+=r,A[3]+=r);q.expand(b,A)}}}}null!=m&&(e=this.graphicInfoPool.alloc(),e.id=this.nextGraphicInfoId++,e.graphicId=a.graphic.uid,e.xMin=b[0],e.yMin=b[1],e.xMax=b[2],e.yMax=b[3],e.positions[0][0]=b[0],e.positions[0][1]=b[1],e.positions[1][0]=b[0],e.positions[1][1]=b[3],e.positions[2][0]=b[2],e.positions[2][1]=
b[3],e.positions[3][0]=b[2],e.positions[3][1]=b[1],e.graphics3DGraphic=a,e.posView=m,e.graphicsOwner=d,f.push(e))}};b.prototype._deconflictVisibleObjects=function(a,b){for(var c=b?1:0,e=0;e<a.length;e++){var d=a.data[e],f=d.graphics3DGraphic,k=!(b&&!1===f.areVisibilityFlagsSet(2,void 0))&&!this.doesIntersectExistingPoly(d);k&&this.addToBins(d);f.setVisibilityFlag(2,k,c);m.drawPoly(d.positions,k?"green":"red")}};b.prototype._removeIconVisibilityFlags=function(a){if(null!=a.getGraphics3DGraphics&&null!=
a.getGraphics3DGraphicsKeys){var b=a.getGraphics3DGraphics(),c=0;for(a=a.getGraphics3DGraphicsKeys();c<a.length;c++)b[a[c]].setVisibilityFlag(2,void 0)}};return b}();var Q={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},T=u.create();return b})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../lib/glMatrix","../../support/debugFlags"],function(w,l,f,a,d){function b(a,
b){if(t){var d=k.height,f=p;f.beginPath();f.lineWidth=1;f.strokeStyle=b;f.moveTo(a[0][0],d-a[0][1]);for(b=1;4>b;b++)f.lineTo(a[b][0],d-a[b][1]),f.stroke();f.lineTo(a[0][0],d-a[0][1]);f.stroke();f.closePath()}}Object.defineProperty(l,"__esModule",{value:!0});var q=a.vec2d,t=!1,m=!1,k,p;l.drawAccelerationStruct=function(a,d){if(m&&p){for(var f=p,k=[q.create(),q.create(),q.create(),q.create()],l=0,t=0;t<a.accBinsNumX;t++)for(var x=0;x<a.accBinsNumY;x++){var c=a.accBins[t][x],l=l+c.length,z=t*a.accBinsSizeX,
w=(t+1)*a.accBinsSizeX,I=x*a.accBinsSizeY,G=(x+1)*a.accBinsSizeY;k[0][0]=z;k[0][1]=I;k[1][0]=w;k[1][1]=I;k[2][0]=w;k[2][1]=G;k[3][0]=z;k[3][1]=G;f.fillText(c.length.toFixed(),z+5,I+15);b(k,"blue")}f.fillText("total totalShownLabels: "+l,70,40);f.fillText("total visible labels: "+d.length,70,50);f.fillText("total numTests: "+a.accNumTests,70,30)}};l.prepare=function(a){t=d.DECONFLICTOR_SHOW_OUTLINES;m=d.DECONFLICTOR_SHOW_GRID;if(t||m)null==k&&(k=document.createElement("canvas"),k.setAttribute("id",
"canvas2d"),a.surface.parentElement.style.position="relative",a.surface.parentElement.appendChild(k)),k.setAttribute("width",a.width+"px"),k.setAttribute("height",a.height+"px"),k.setAttribute("style","position:absolute;left:0px;top:0px;display:block;pointer-events:none;"),p=k.getContext("2d"),p.clearRect(0,0,a.width,a.height),p.font="8px Arial"};l.drawPoly=b})},"esri/views/3d/layers/GraphicsView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../../layers/GraphicsView ./graphics/Graphics3DCore ./graphics/Graphics3DSpatialIndex ./graphics/Graphics3DElevationAlignment ../support/PromiseLightweight ../../../core/promiseUtils".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p){return function(b){function l(){var a=null!==b&&b.apply(this,arguments)||this;a.graphicsCore=null;a.spatialIndex=null;a.elevation=null;a.supportsDraping=!0;a._overlayUpdating=!1;a._eventHandles=[];return a}f(l,b);Object.defineProperty(l.prototype,"graphics",{set:function(a){a!==this.loadedGraphics&&(this.loadedGraphics=a);this._set("graphics",a)},enumerable:!0,configurable:!0});l.prototype.initialize=function(){var a=this;this.mockLayerId="__sceneView.graphics-"+Date.now().toString(16);
this.spatialIndex=new t;this.spatialIndex.whenLoaded().then(function(){return a.deferredInitialize()})};l.prototype.deferredInitialize=function(){var a=this;if(!this.destroyed){this.loadedGraphics=this.graphics;this.graphicsCore=new q;this.elevation=new m;var b={id:this.mockLayerId,uid:this.mockLayerId};this.spatialIndex.initialize(this,b,this.view.spatialReference,this.graphicsCore);this.elevation.initialize(this,function(b,d,f){a.spatialIndex.intersects(b,d,f)},this.graphicsCore,this.view.elevationProvider);
this.graphicsCore.initialize(this,b,this.elevation,null,this.spatialIndex,null,null,null,null,this.view.basemapTerrain);this._eventHandles.push(this.view.watch("clippingArea",function(){return a.updateClippingExtent()}));this.updateClippingExtent();this.view.resourceController.registerIdleFrameWorker(this,{needsUpdate:this._needsIdleUpdate,idleFrame:this._idleUpdate})}};l.prototype.destroy=function(){this._eventHandles.forEach(function(a){return a.remove()});this._eventHandles=null;this.view.resourceController.deregisterIdleFrameWorker(this);
this.spatialIndex&&(this.spatialIndex.destroy(),this.spatialIndex=null);this.elevation&&(this.elevation.destroy(),this.elevation=null);this.graphicsCore&&(this.graphicsCore.destroy(),this.graphicsCore=null);this.loadedGraphics=null};l.prototype.getGraphicsFromStageObject=function(a,b){var d=a.getMetadata().graphicId,f=null;this.loadedGraphics&&this.loadedGraphics.some(function(a){return a.uid===d?(f=a,!0):!1});a=new k.Promise;null!==f?a.done(f):a.reject();return a};l.prototype.whenGraphicBounds=function(a){var b=
this;return this.spatialIndex?this.spatialIndex.whenLoaded().then(function(){return b.graphicsCore?b.graphicsCore.whenGraphicBounds(a):p.reject()}):p.reject()};l.prototype._needsIdleUpdate=function(){return this.elevation.needsIdleUpdate()};l.prototype._idleUpdate=function(a){this.elevation.idleUpdate(a)};l.prototype._notifySuspendedChange=function(){};l.prototype._notifyDrapedDataChange=function(){this.view.basemapTerrain&&this.view.basemapTerrain.overlayManager.setOverlayDirty()};l.prototype._evaluateUpdatingState=
function(){if(this.elevation){var a;a=0+this.elevation.numNodesUpdating();a+=this.graphicsCore.numNodesUpdating();this.updating=a=(a=(a=0<a||this._overlayUpdating)||this.spatialIndex.isUpdating())||this.graphicsCore.needsIdleUpdate()}else this.updating=!1};l.prototype.updateClippingExtent=function(){this.graphicsCore.setClippingExtent(this.view.clippingArea,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()};a([d.property()],l.prototype,"graphics",null);a([d.property()],l.prototype,
"loadedGraphics",void 0);a([d.property({value:!0})],l.prototype,"updating",void 0);a([d.property({value:!1})],l.prototype,"suspended",void 0);return l=a([d.subclass("esri.views.3d.layers.GraphicsView3D")],l)}(d.declared(b))})},"esri/views/layers/GraphicsView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../../core/Accessor ../../core/Collection ../../Graphic".split(" "),function(w,l,f,a,d,b,q,
t){return function(b){function k(){var a=null!==b&&b.apply(this,arguments)||this;a.graphics=null;a.renderer=null;a.view=null;return a}f(k,b);a([d.property({type:q.ofType(t)})],k.prototype,"graphics",void 0);a([d.property()],k.prototype,"renderer",void 0);a([d.property()],k.prototype,"view",void 0);return k=a([d.subclass("esri.views.layers.GraphicsView")],k)}(d.declared(b))})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/watchUtils ../../../../core/arrayUtils ../../../../core/Error ../../../../core/Logger ../../../../core/promiseUtils ../../support/projectionUtils ../../../../renderers/UniqueValueRenderer ../../../../renderers/support/rendererConversion ../../../../renderers/support/diffUtils ../../../../geometry/Point ../../../../geometry/Extent ../../webgl-engine/Stage ../../webgl-engine/lib/Util ../../webgl-engine/lib/Layer ../../webgl-engine/lib/FloatingBoxLocalOriginFactory ../../../../symbols/WebStyleSymbol ../../../../symbols/LabelSymbol3D ../../../../symbols/TextSymbol ../../../../symbols/support/symbolConversion ../../../../symbols/support/unitConversionUtils ../../lib/glMatrix ./featureExpressionInfoUtils ./Graphics3DGraphic ./Graphics3DWebStyleSymbol ./graphicUtils ./Graphics3DSymbolFactory ./Graphics3DOwner ./ElevationQuery ../../support/aaBoundingBox ../../support/mathUtils dojo/Deferred".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c,D,B,I,G,H,K,J,P,O,L,M,R,Q,T,A,V){function S(a){(a=a.elevationInfo&&a.elevationInfo.unit)&&!H.supportsUnit(a)&&g.warn("elevationInfo.unit","'"+a+"' is not a valid unit")}w=K.vec3d;var h=new v,e=w.create(),g=t.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");return function(){function l(a){void 0===a&&(a=!0);this.elevationFeatureExpressionEnabled=a;this.graphics={};this.graphicsDrapedIds={};this.graphicsBySymbol={};this.graphicsKeys=[];this.symbols=
{};this.graphicsWithoutSymbol={};this.computedExtent=null;this.symbolCreationContext=new R.Graphics3DSymbolCreationContext;this.hasDraped=!1;this.updatingGraphicIds=new Set;this.graphicTransformFunc=this.onComputedExtentChange=this.stage=this.labelStageLayer=this.stageLayer=this.tilingSchemeHandle=this.lastFastUpdate=null;this.eventHandles=[];this.sharedSymbolResourcesOwnerHandle=this.highlights=this.elevationQueryService=this.labeling=this.spatialIndex=this.scaleVisibility=this.elevation=this.layer=
this.layerView=this.viewSR=null;this.whenGraphics3DGraphicRequests={}}l.prototype.initialize=function(a,b,c,e,f,h,k,m,p,n){var r=this;this.layerView=a;this.layer=b;this.viewSR=a.view.spatialReference;this.elevation=c;this.scaleVisibility=e;this.spatialIndex=f;this.labeling=h;this.highlights=k;this.onComputedExtentChange=m;this.graphicTransformFunc=p;var q=this.layerView.view;this.elevationQueryService=new Q.ElevationQuery(this.viewSR,function(){return q.map.ground},{maximumAutoTileRequests:4});this.initializeStage(q,
this.layer.uid);this.symbolCreationContext.sharedResources=q.sharedSymbolResources;this.sharedSymbolResourcesOwnerHandle=q.sharedSymbolResources.addGraphicsOwner(this);this.symbolCreationContext.renderer=this.layer.renderer;this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataSupplier=q.sharedSymbolResources.streamDataSupplier;this.symbolCreationContext.renderSpatialReference=q.renderSpatialReference;this.symbolCreationContext.renderCoordsHelper=q.renderCoordsHelper;this.symbolCreationContext.layer=
this.layer;this.symbolCreationContext.layerView=this.layerView;this.symbolCreationContext.layerOrder=0;this.symbolCreationContext.localOriginFactory=l.createLocalOriginFactory();this.symbolCreationContext.elevationProvider=q.elevationProvider;S(this.layer);b=J.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=J.createContext(b,this.viewSR,g);q.deconflictor.addGraphicsOwner(this);this.symbolCreationContext.screenSizePerspectiveEnabled=
q.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.tilingSchemeHandle=d.when(n,"tilingScheme",function(a){a.spatialReference.equals(r.symbolCreationContext.overlaySR)||(r.symbolCreationContext.overlaySR=n.spatialReference,r.recreateAllGraphics())});this.eventHandles.push(this.layerView.watch("suspended",function(){return r.suspendedChange()}));this.eventHandles.push(this.layerView.watch("layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled",function(){r.symbolCreationContext.screenSizePerspectiveEnabled=
q.screenSizePerspectiveEnabled&&r.layer.screenSizePerspectiveEnabled;r.recreateAllGraphics()}));this.eventHandles.push(d.on(a,"loadedGraphics","change",function(a){return r.graphicsCollectionChanged(a)},function(){r.clearSymbolsAndGraphics();r.graphicsCollectionChanged({added:r.layerView.loadedGraphics.toArray(),removed:[]})}));this.validateRenderer(this.layer.renderer)};l.prototype.destroy=function(){var a=this;this.layerView.view.deconflictor.removeGraphicsOwner(this);this.clear();if(this.stage){var b=
[this.stageLayer.getId()];this.labelStageLayer&&b.push(this.labelStageLayer.getId());this.stage.removeFromViewContent(b);b.forEach(function(b){return a.stage.remove(u.ModelContentType.LAYER,b)});this.stage=this.labelStageLayer=this.stageLayer=null}this.tilingSchemeHandle&&(this.tilingSchemeHandle.remove(),this.tilingSchemeHandle=null);this.eventHandles.forEach(function(a){return a.remove()});this.layerView=this.labeling=this.scaleVisibility=this.viewSR=this.onComputedExtentChange=this.eventHandles=
null;for(var c in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[c].reject(new q("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null;this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null)};l.prototype.clear=function(){var a=!1,b;for(b in this.graphics){var c=this.graphics[b],a=a||c.isDraped();c.destroy()}this.graphics={};this.graphicsKeys=null;for(var e in this.symbols)(b=
this.symbols[e])&&b.destroy();this.symbols={};this.graphicsBySymbol={};this.graphicsWithoutSymbol={};this.hasDraped=!1;a&&this.layerView._notifyDrapedDataChange()};l.prototype.initializeStage=function(a,b){this.stage=a._stage;this.stageLayer=new E(b,{state:this.layerView.suspended?"HIDDEN":"VISIBLE"},b);this.stage.add(u.ModelContentType.LAYER,this.stageLayer);a=[this.stageLayer.getId()];this.labeling&&(this.labelStageLayer=new E(b,{state:this.layerView.suspended?"HIDDEN":"IGNORED"},b+"_labels"),this.stage.add(u.ModelContentType.LAYER,
this.labelStageLayer),a.push(this.labelStageLayer.getId()));this.stage.addToViewContent(a)};l.prototype.setDrawingOrder=function(a){this.symbolCreationContext.layerOrder=a;var b={},c={},e;for(e in this.graphics)this.graphics[e].setDrawOrder(a,b,c);for(var d in c)(c=this.symbols[d])&&c.setDrawOrder(a,b);C.objectEmpty(b)||(this.stage.getTextureGraphicsRenderer().updateRenderOrder(b),this.layerView._notifyDrapedDataChange())};l.prototype.suspendedChange=function(){!0===this.layerView.suspended?(this.stageLayer.setState("HIDDEN"),
this.labelStageLayer&&this.labelStageLayer.setState("HIDDEN"),this.hideAllGraphics()):!1===this.layerView.suspended&&(this.stageLayer.setState("VISIBLE"),this.labelStageLayer&&this.labelStageLayer.setState("IGNORED"),this.updateAllGraphicsVisibility())};l.prototype.getGraphics3DGraphics=function(){return this.graphics};l.prototype.getGraphics3DGraphicById=function(a){return this.graphics[a]};l.prototype.getGraphics3DGraphicsKeys=function(){null===this.graphicsKeys&&(this.graphicsKeys=Object.keys(this.graphics));
return this.graphicsKeys};l.prototype.labelsEnabled=function(){return!(!this.labeling||!this.labeling.layerLabelsEnabled())};l.prototype.getSymbolUpdateType=function(){var a=0,b=0,c=0,e;for(e in this.symbols){var d=this.symbols[e];d&&(d=d.getFastUpdateStatus(),a+=d.loading,c+=d.fast,b+=d.slow)}return 0<a?"unknown":0<=c&&0===b?"fast":0<=b&&0===c?"slow":"mixed"};l.prototype.numNodesUpdating=function(){return this.updatingGraphicIds.size};l.prototype.needsIdleUpdate=function(){return!!this.lastFastUpdate&&
500<performance.now()-this.lastFastUpdate};l.prototype.idleUpdate=function(a){a.done()||(this.lastFastUpdate&&(this.labeling&&this.labeling.updateLabelingInfo(),this.lastFastUpdate=null),this.layerView._evaluateUpdatingState())};l.prototype.whenGraphics3DGraphic=function(a){var b=this.graphics[a.uid];if(b)return m.resolve(b);b=this.whenGraphics3DGraphicRequests[a.uid];b||(b=new V,this.whenGraphics3DGraphicRequests[a.uid]=b);return b.promise};l.prototype.boundsForGraphics3DGraphic=function(b){return a(this,
void 0,void 0,function(){var a,c,d,g,m,l,p,n,r;return f(this,function(f){switch(f.label){case 0:return a=this.layerView.view.spatialReference,c=this.layerView.view.renderSpatialReference,d=this.layerView.view.basemapTerrain.spatialReference,g=function(b,e,d){return k.bufferToBuffer(b,c,e,b,a,e,d)},m=function(b,c,e){return k.bufferToBuffer(b,d,c,b,a,c,e)},[4,b.getProjectedBoundingBox(g,m,this.elevationQueryService)];case 1:l=f.sent();if(!l)return[2,null];p=l.boundingBox;l.requiresDrapedElevation&&
(n=this.symbolCreationContext.elevationProvider)&&(T.center(p,e),h.x=e[0],h.y=e[1],h.z=void 0,h.spatialReference=a,r=n.getElevation(h)||0,p[2]=Math.min(p[2],r),p[5]=Math.max(p[5],r));return[2,{boundingBox:p,screenSpaceObjects:l.screenSpaceObjects}]}})})};l.prototype.whenGraphicBounds=function(a){var b=this;return d.whenOnce(this.layerView,"loadedGraphics").then(function(){var c=b.layerView.layer&&b.layerView.layer.objectIdField,e=b.layerView.loadedGraphics.find(function(b){return b===a||c&&b.attributes&&
a.attributes&&b.attributes[c]===a.attributes[c]?!0:!1});if(e)return b.whenGraphics3DGraphic(e);throw new q("internal:graphic-not-part-of-view","Graphic is not part of this view");}).then(function(a){return b.boundsForGraphics3DGraphic(a)})};l.prototype.graphicsCollectionChanged=function(a){var b=this.graphicTransformFunc?this.graphicTransformFunc(a.added):a.added;this.add(b);this.remove(a.removed)};l.prototype.graphicUpdateHandler=function(a){var b=this.graphics[a.graphic.uid];if(b)switch(a.property){case "visible":b.setVisibilityFlag(0,
a.newValue)&&(b.isDraped()&&this.layerView._notifyDrapedDataChange(),this.labeling&&this.layerView.view.deconflictor.setDirty())}};l.prototype.beginGraphicUpdate=function(a){this.updatingGraphicIds.add(a.uid);"symbolsUpdating"in this.layerView&&!this.layerView.get("symbolsUpdating")&&this.layerView.set("symbolsUpdating",!0);this.layerView._evaluateUpdatingState()};l.prototype.endGraphicUpdate=function(a){a&&this.updatingGraphicIds.delete(a.uid);"symbolsUpdating"in this.layerView&&this.layerView.get("symbolsUpdating")&&
0===this.updatingGraphicIds.size&&(this.layerView.view.flushDisplayModifications(),this.layerView.set("symbolsUpdating",!1));this.layerView._evaluateUpdatingState()};l.prototype.expandComputedExtent=function(a){var b,c,e,d,f,g;if("point"===a.type)b=c=a.x,e=d=a.y,a.z&&(f=g=a.z);else if("polygon"===a.type||"polyline"===a.type||"multipoint"===a.type){g=a.extent;if(!g)return;b=g.xmin;c=g.xmax;e=g.ymin;d=g.ymax;f=g.zmin;g=g.zmax}var h=this.viewSR,m=l.tmpVec;!a.spatialReference.equals(h)&&k.xyzToVector(b,
e,0,a.spatialReference,m,h)&&(b=m[0],e=m[1],k.xyzToVector(c,d,0,a.spatialReference,m,h),c=m[0],d=m[1]);if(A.isFinite(b)&&A.isFinite(c)&&A.isFinite(e)&&A.isFinite(d)){(h=this.computedExtent)?(b<h.xmin&&(h.xmin=b),c>h.xmax&&(h.xmax=c),e<h.ymin&&(h.ymin=e),d>h.ymax&&(h.ymax=d)):this.computedExtent=h=new r(b,e,c,d,a.spatialReference);if(A.isFinite(f)&&!A.isFinite(g)){if(null==h.zmin||f<h.zmin)h.zmin=f;if(null==h.zmax||g>h.zmax)h.zmax=g}this.onComputedExtentChange&&this.onComputedExtentChange()}};l.prototype.updateHasDraped=
function(){this.hasDraped=!1;for(var a in this.graphicsDrapedIds)if(this.graphicsDrapedIds.hasOwnProperty(a)){this.hasDraped=!0;break}};l.prototype.elevationInfoChange=function(){S(this.layer);var a=J.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=J.createContext(a,this.viewSR,g);this.labeling&&this.labeling.elevationInfoChange();this.layer.renderer!==this.symbolCreationContext.renderer&&this.rendererChange(this.layer.renderer);
for(var b in this.graphicsBySymbol){var c=this.symbols[b],a=this.graphicsBySymbol[b];if(c&&c.layerPropertyChanged("elevationInfo",a)){for(var e in a){var d=a[e],c=d.graphic,d=d._labelGraphics;this.elevation&&this.elevation.markGraphicElevationDirty(c.uid);for(var f=0;f<d.length;f++){var h=d[f];h.graphics3DSymbolLayer.updateGraphicElevationInfo(c,h)}}this.layerView._evaluateUpdatingState()}else this._recreateSymbol(b)}};l.prototype.clearSymbolsAndGraphics=function(){this.clear();this.elevation&&this.elevation.clear();
this.labeling&&this.labeling.clear()};l.prototype.recreateAllGraphics=function(){this.clearSymbolsAndGraphics();this.computedExtent=null;this.onComputedExtentChange&&this.onComputedExtentChange();this.layerView.loadedGraphics&&this.layerView.view.basemapTerrain.tilingScheme&&this.add(this.layerView.loadedGraphics.toArray())};l.prototype._recreateSymbol=function(a){var b=this.graphicsBySymbol[a],c=[],e=!1,d;for(d in b){var f=b[d];f.isDraped()&&(delete this.graphicsDrapedIds[d],e=!0);c.push(f.graphic);
f.destroy();delete this.graphics[d]}this.graphicsBySymbol[a]={};(b=this.symbols[a])&&b.destroy();delete this.symbols[a];this.updateHasDraped();e&&this.layerView._notifyDrapedDataChange();this.add(c)};l.prototype.add=function(a){if(this.layerView.view.basemapTerrain&&this.layerView.view.basemapTerrain.tilingScheme){for(var b=a.length,c=Array(b),e=Array(b),d=Array(b),f=!1,h=0;h<b;h++){var k=a[h],m=k.geometry;if(m)if(this.expandComputedExtent(m),m=this.layerView.getRenderingInfo?this.layerView.getRenderingInfo(k):
{symbol:k.symbol},this.graphicsWithoutSymbol[k.uid]=k,m&&m.symbol){if(e[h]=m.symbol,d[h]=m,m=this.getOrCreateGraphics3DSymbol(e[h],m.renderer))c[h]=m,this.beginGraphicUpdate(k)}else f||(f=!0,g.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render"))}for(h=0;h<b;h++)this.waitForSymbol(c[h],e[h],a[h],d[h])}};l.prototype.waitForSymbol=function(a,b,c,e){var d=this;a&&a.then(function(){d.createGraphics3DGraphic(a,c,e);d.endGraphicUpdate(c);d.labeling&&d.layerView.view.deconflictor.setDirty()},
function(){d.endGraphicUpdate(c)})};l.prototype.remove=function(a){for(var b=!1,c=a.length,e=0;e<c;e++){var d=a[e].uid,f=this.graphics[d];if(f){f.isDraped()&&(delete this.graphicsDrapedIds[d],b=!0);var g=f.graphics3DSymbol.symbol.id;f.destroy();delete this.graphics[d];delete this.graphicsBySymbol[g][d];delete this.graphicsWithoutSymbol[d];this.graphicsKeys=null}}this.updateHasDraped();b&&this.layerView._notifyDrapedDataChange();this.layerView.view.deconflictor.setDirty()};l.prototype.hasLabelingContext=
function(a){if(a instanceof B||a instanceof I){var b=this.symbolCreationContext.layer;return b.labelingInfo?b.labelingInfo.some(function(b){return b.symbol===a}):!1}return!1};l.prototype.hasValidSymbolCreationContext=function(a){return a instanceof B&&!this.hasLabelingContext(a)?(g.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};l.prototype.createGraphics3DSymbol=function(a,b){if(!this.hasValidSymbolCreationContext(a))return null;
a=G.to3D(a,!0,!1,this.hasLabelingContext(a));if(a.symbol){var c=void 0;b&&b.backgroundFillSymbol&&(b=G.to3D(b.backgroundFillSymbol,!1,!0),b.symbol&&(c=b.symbol.symbolLayers));return M.make(a.symbol,this.symbolCreationContext,c)}a.error&&g.error(a.error.message);return null};l.prototype.getOrCreateGraphics3DSymbol=function(a,b){var c=this,e=this.symbols[a.id];void 0===e&&(e=a instanceof D?new O(a,function(a){return c.createGraphics3DSymbol(a,b)}):this.createGraphics3DSymbol(a,b),this.symbols[a.id]=
e);return e};l.prototype.createGraphics3DGraphic=function(a,b,c){delete this.graphicsWithoutSymbol[b.uid];if(!this.symbols[a.symbol.id])this.add([b]);else if(!this.graphics[b.uid]){c=a.createGraphics3DGraphic(b,c);this.graphics[b.uid]=c;this.graphicsKeys=null;this.graphicsBySymbol[a.symbol.id]||(this.graphicsBySymbol[a.symbol.id]={});this.graphicsBySymbol[a.symbol.id][b.uid]=c;c.initialize(this.stageLayer,this.stage);c.isDraped()&&(this.hasDraped=this.graphicsDrapedIds[b.uid]=!0,this.layerView._notifyDrapedDataChange());
c.centroid=null;"point"!==b.geometry.type&&c instanceof P&&(c.centroid=L.computeCentroid(b.geometry,this.viewSR));a=this.scaleVisibility&&this.scaleVisibility.scaleRangeActive();this.spatialIndex&&this.spatialIndex.shouldAddToSpatialIndex(b,c,a)&&this.spatialIndex.addGraphicToSpatialIndex(b,c);this.labeling&&this.labeling.layerLabelsEnabled()&&this.labeling.createLabelsForGraphic(b,c);a&&this.scaleVisibility.updateGraphicScaleVisibility(b,c);c.setVisibilityFlag(0,b.visible&&!this.layerView.suspended);
if(a=this.whenGraphics3DGraphicRequests[b.uid])delete this.whenGraphics3DGraphicRequests[b.uid],a.resolve(c);this.highlights&&this.highlights.graphicCreated(c)}};l.prototype.rendererChange=function(a){var b=this.symbolCreationContext.renderer;if(a!==b){this.validateRenderer(a);var c=z.diff(b,a);this.updateUnchangedSymbolMappings(c,a,b);this.symbolCreationContext.renderer=a;c&&("complete"===c.type?this.recreateAllGraphics():"partial"===c.type&&(this.applyRendererDiff(c,a,b)?this.volatileGraphicsUpdated():
this.recreateAllGraphics()))}};l.prototype.diffHasSymbolChange=function(a){for(var b in a.diff)switch(b){case "visualVariables":break;case "defaultSymbol":break;case "uniqueValueInfos":break;case "authoringInfo":case "fieldDelimiter":delete a.diff[b];break;default:return!0}return!1};l.prototype.applySymbolSetDiff=function(a,b,c,e){e=!1;a=a||[];b=b||[];for(var d=[],f=0;f<b.length;f++){var g=b[f],h=this.graphicsBySymbol[g.id],k;for(k in h){var m=h[k],l=m.graphic;if(g!==c.defaultSymbol||c.getSymbol(l)!==
c.defaultSymbol)m.isDraped()&&(delete this.graphicsDrapedIds[k],e=!0),a.length||c.defaultSymbol?d.push(l):this.graphicsWithoutSymbol[k]=l,m.destroy(),this.highlights&&this.highlights.graphicDeleted(this.graphics[k]),delete h[k],delete this.graphics[k],this.graphicsKeys=null}if(void 0===h||0===Object.keys(h).length)delete this.graphicsBySymbol[g.id],(h=this.symbols[g.id])&&h.destroy(),delete this.symbols[g.id]}if(a.length||d.length){for(k in this.graphicsWithoutSymbol)d.push(this.graphicsWithoutSymbol[k]);
this.graphicsWithoutSymbol={};this.add(d)}this.updateHasDraped();e&&this.layerView._notifyDrapedDataChange();this.layerView.view.deconflictor.setDirty()};l.prototype.applyUniqueValueRendererDiff=function(a,b,c){var e=a.diff.defaultSymbol,d=a.diff.uniqueValueInfos;if(e||d){var f=d?d.added.map(function(a){return a.symbol}):[],g=d?d.removed.map(function(a){return a.symbol}):[];if(d)for(var h=0;h<d.changed.length;h++)f.push(d.changed[h].newValue.symbol),g.push(d.changed[h].oldValue.symbol);e?(c.defaultSymbol&&
g.push(c.defaultSymbol),b.defaultSymbol&&f.push(b.defaultSymbol)):c.defaultSymbol&&f.length&&g.push(b.defaultSymbol);this.applySymbolSetDiff(f,g,b,c);delete a.diff.defaultSymbol;delete a.diff.uniqueValueInfos;return!0}return!1};l.prototype.calculateUnchangedSymbolMapping=function(a,b,c){if(b instanceof p&&c instanceof p)if(!a){if(c&&c.defaultSymbol)return[{oldId:c.defaultSymbol.id,newId:b.defaultSymbol.id}]}else if("partial"===a.type){var e=a.diff;a=e.defaultSymbol;var e=e.uniqueValueInfos,d=void 0,
d=e?e.unchanged.map(function(a){return{oldId:a.oldValue.symbol.id,newId:a.newValue.symbol.id}}):c.uniqueValueInfos.map(function(a,c){return{oldId:a.symbol.id,newId:b.uniqueValueInfos[c].symbol.id}});!a&&c.defaultSymbol&&d.push({oldId:c.defaultSymbol.id,newId:b.defaultSymbol.id});return d}return[]};l.prototype.updateUnchangedSymbolMappings=function(a,b,c){var e=0;for(a=this.calculateUnchangedSymbolMapping(a,b,c);e<a.length;e++)if(c=a[e],b=c.oldId,c=c.newId,b&&b!==c){var d=this.graphicsBySymbol[b];
delete this.graphicsBySymbol[b];void 0!==d&&(this.graphicsBySymbol[c]=d);d=this.symbols[b];delete this.symbols[b];void 0!==d&&(this.symbols[c]=d,d.symbol.id=c)}};l.prototype.applyRendererDiff=function(a,b,c){var e=!1;if(this.diffHasSymbolChange(a))return!1;if(b instanceof p&&c instanceof p&&this.applyUniqueValueRendererDiff(a,b,c)&&0===Object.keys(a.diff).length)return!0;for(var d in this.graphicsBySymbol)if(c=this.symbols[d]){var f=this.graphicsBySymbol[d];if(!c.applyRendererDiff(a,b,f))return!1;
if(!e)for(var g in f)if(f[g].isDraped()){this.layerView._notifyDrapedDataChange();e=!0;break}}return!0};l.prototype.opacityChange=function(){var a=!1,b;for(b in this.graphicsBySymbol){var c=this.symbols[b];if(c){var e=this.graphicsBySymbol[b];c.layerPropertyChanged("opacity");if(!a)for(var d in e)if(e[d].isDraped()){this.layerView._notifyDrapedDataChange();a=!0;break}}}};l.prototype.setClippingExtent=function(a,c){var e=this.symbolCreationContext.clippingExtent,d=[];k.extentToBoundingRect(a,d,c)?
this.symbolCreationContext.clippingExtent=[d[0],d[1],-Infinity,d[2],d[3],Infinity]:this.symbolCreationContext.clippingExtent=null;return!b.equals(this.symbolCreationContext.clippingExtent,e)};l.prototype.forEachGraphics3DGraphic=function(a){var b=this;if(this.layerView.loadedGraphics){var c=!1,e=!1;this.layerView.loadedGraphics.forEach(function(d){var f=b.getGraphics3DGraphicById(d.uid);f&&a(f,d)&&(c=!0,e=e||f.isDraped())});c&&this.layerView.view.deconflictor.setDirty();e&&this.layerView._notifyDrapedDataChange()}};
l.prototype.updateAllGraphicsVisibility=function(){var a=this;this.forEachGraphics3DGraphic(function(b,c){var e=b.setVisibilityFlag(0,c.visible),d=!1;a.scaleVisibility&&(d=a.scaleVisibility.updateGraphicScaleVisibility(c,b));return e||d})};l.prototype.hideAllGraphics=function(){this.forEachGraphics3DGraphic(function(a){return a.setVisibilityFlag(0,!1)})};l.prototype.validateRenderer=function(a){(a=x.validateTo3D(a))&&g.warn("Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+
this.layer.id+"' is not supported in a SceneView",a.message)};l.prototype.volatileGraphicsUpdated=function(){this.labeling&&(this.lastFastUpdate=performance.now());this.stageLayer.invalidateSpatialQueryAccelerator();this.stageLayer.shaderTransformationChanged();this.layerView._evaluateUpdatingState()};l.createLocalOriginFactory=function(){return new c(5E6,16)};l.prototype.snapshotInternals=function(){var a=this;return{graphics:Object.keys(this.graphics).sort(),symbols:Object.keys(this.symbols).sort(),
graphicsBySymbol:Object.keys(this.graphicsBySymbol).sort().map(function(b){return{symbolId:b,graphics:Object.keys(a.graphicsBySymbol[b]).sort()}}),graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),graphicsDrapedIds:Object.keys(this.graphicsDrapedIds).sort()}};l.tmpVec=K.vec3d.create();return l}()})},"esri/core/tsSupport/generatorHelper":function(){define([],function(){return function(w,l){function f(b){return function(d){return a([b,d])}}function a(a){if(b)throw new TypeError("Generator is already executing.");
for(;d;)try{if(b=1,q&&(t=q[a[0]&2?"return":a[0]?"throw":"next"])&&!(t=t.call(q,a[1])).done)return t;if(q=0,t)a=[0,t.value];switch(a[0]){case 0:case 1:t=a;break;case 4:return d.label++,{value:a[1],done:!1};case 5:d.label++;q=a[1];a=[0];continue;case 7:a=d.ops.pop();d.trys.pop();continue;default:if(!(t=d.trys,t=0<t.length&&t[t.length-1])&&(6===a[0]||2===a[0])){d=0;continue}if(3===a[0]&&(!t||a[1]>t[0]&&a[1]<t[3]))d.label=a[1];else if(6===a[0]&&d.label<t[1])d.label=t[1],t=a;else if(t&&d.label<t[2])d.label=
t[2],d.ops.push(a);else{t[2]&&d.ops.pop();d.trys.pop();continue}}a=l.call(w,d)}catch(p){a=[6,p],q=0}finally{b=t=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var d={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},b,q,t,m;return m={next:f(0),"throw":f(1),"return":f(2)},"function"===typeof Symbol&&(m[Symbol.iterator]=function(){return this}),m}})},"esri/core/tsSupport/awaiterHelper":function(){define(["dojo/Deferred","dojo/when"],function(w,l){return function(f,
a,d,b){function q(a){try{m(b.next(a))}catch(x){k.reject(x)}}function t(a){try{m(b["throw"](a))}catch(x){k.reject(x)}}function m(a){a.done?l(a.value).then(k.resolve,k.reject):l(a.value).then(q,t)}var k=new w;m((b=b.apply(f,a||[])).next());return k.promise}})},"esri/renderers/support/rendererConversion":function(){define(["require","exports","../../core/Error","../../symbols/support/symbolConversion"],function(w,l,f,a){function d(a,b){if(!b)return null;b=Array.isArray(b)?b:[b];if(0<b.length){var d=
b.map(function(a){return a.details.symbol.type||a.details.symbol.declaredClass}).filter(function(a){return!!a});d.sort();var m=[];d.forEach(function(a,b){0!==b&&a===d[b-1]||m.push(a)});return new f("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+m.join(", ")+") which are not supported in 3D",{renderer:a,symbolErrors:b})}return null}function b(b){var f=b.uniqueValueInfos.map(function(b){return a.to3D(b.symbol).error}).filter(function(a){return!!a}),k=a.to3D(b.defaultSymbol);
k.error&&f.unshift(k.error);return d(b,f)}function q(b){var f=b.classBreakInfos.map(function(b){return a.to3D(b.symbol).error}).filter(function(a){return!!a}),k=a.to3D(b.defaultSymbol);k.error&&f.unshift(k.error);return d(b,f)}Object.defineProperty(l,"__esModule",{value:!0});l.validateTo3D=function(l){return l?"simple"===l.type?d(l,a.to3D(l.symbol).error):"unique-value"===l.type?b(l):"class-breaks"===l.type?q(l):new f("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+
(l.type||l.declaredClass)+"'",{renderer:l}):null}})},"esri/views/3d/webgl-engine/lib/Layer":function(){define("require exports dojo/has ./IdGen ./Octree ./PerformanceTimer ./Util ./gl-matrix ./ModelContentType".split(" "),function(w,l,f,a,d,b,q,t,m){var k=t.vec3d;return function(){function b(a,d,f){this._parentStages=[];this._children=[];this.id=b._idGen.gen(f);this.name=a;d=d||{};this.group=d.group||"";this.state=d.state||"VISIBLE";this.interaction=d.interaction||"PICKABLE";this.translation=k.create(d.translation);
this._extent=[k.createFrom(0,0,0),k.createFrom(1E3,1E3,1E3)];this._extentDirty=!0}b.prototype.getId=function(){return this.id};b.prototype.getParentStages=function(){return this._parentStages};b.prototype.addParentStage=function(a){-1===this._parentStages.indexOf(a)&&this._parentStages.push(a)};b.prototype.removeParentStage=function(a){a=this._parentStages.indexOf(a);-1<a&&this._parentStages.splice(a,1)};b.prototype.getName=function(){return this.name};b.prototype.getGroup=function(){return this.group};
b.prototype.getState=function(){return this.state};b.prototype.getInteraction=function(){return this.interaction};b.prototype.getTranslation=function(){return this.translation};b.prototype.getObjectIds=function(){return this._children.map(function(a){return a.getId()})};b.prototype.getObjects=function(){return this._children};b.prototype.setState=function(a){this.state=a};b.prototype.getExtent=function(){this._updateExtent();return this._extent};b.prototype.addObject=function(a){this._children.push(a);
a.addParentLayer(this);this.notifyDirty("layObjectAdded",a);this._invalidateExtent();this._spatialAccelerator&&this._spatialAccelerator.add(a)};b.prototype.hasObject=function(a){return-1<this._children.indexOf(a)};b.prototype.removeObject=function(a){return null!=q.arrayRemove(this._children,a)?(a.removeParentLayer(this),this.notifyDirty("layObjectRemoved",a),this._invalidateExtent(),this._spatialAccelerator&&this._spatialAccelerator.remove(a),!0):!1};b.prototype.replaceObject=function(a,b){var d=
this._children.indexOf(a);q.assert(-1<d,"Layer.replaceObject: layer doesn't contain specified object");this._children[d]=b;a.removeParentLayer(this);b.addParentLayer(this);this.notifyDirty("layObjectReplaced",[a,b]);this._invalidateExtent();this._spatialAccelerator&&(this._spatialAccelerator.remove(a),this._spatialAccelerator.add(b))};b.prototype.notifyObjectBBChanged=function(a,b){this._spatialAccelerator&&this._spatialAccelerator.update(a,b)};b.prototype.getCenter=function(){this._updateExtent();
var a=k.create();return k.lerp(this._extent[0],this._extent[1],.5,a)};b.prototype.getBSRadius=function(){this._updateExtent();return.5*k.dist(this._extent[0],this._extent[1])};b.prototype.getSpatialQueryAccelerator=function(){if(this._spatialAccelerator)return this._spatialAccelerator;if(50<this._children.length)return this._createOctree(),this._spatialAccelerator};b.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",null)};b.prototype.invalidateSpatialQueryAccelerator=
function(){this._spatialAccelerator=null};b.prototype.notifyDirty=function(a,b,d,f){d=d||m.LAYER;f=f||this;for(var k=0;k<this._parentStages.length;k++)this._parentStages[k].notifyDirty(d,f,a,b)};b.prototype._createOctree=function(){for(var a=this.getExtent(),b=0,f=0;3>f;f++)b=Math.max(b,a[1][f]-a[0][f]);f=k.create();k.lerp(a[0],a[1],.5,f);this._spatialAccelerator=new d(f,1.2*b);this._spatialAccelerator.add(this._children)};b.prototype._invalidateExtent=function(){this._extentDirty=!0};b.prototype._updateExtent=
function(){if(this._extentDirty)if(0===this._children.length)this._extent=[[0,0,0],[0,0,0]];else{var a=this._children[0];this._extent=[k.create(a.getBBMin()),k.create(a.getBBMax())];for(a=0;a<this._children.length;++a)for(var b=this._children[a],d=b.getBBMin(),b=b.getBBMax(),f=0;3>f;++f)this._extent[0][f]=Math.min(this._extent[0][f],d[f]),this._extent[1][f]=Math.max(this._extent[1][f],b[f]);this._extentDirty=!1}};b._idGen=new a;return b}()})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("require exports ./gl-matrix ./Util dojo/has ./PerformanceTimer".split(" "),
function(w,l,f,a,d,b){function q(a,b,c){c=c||a;c[0]=a[0]+b;c[1]=a[1]+b;c[2]=a[2]+b;return c}var t=f.vec3d;w=function(){function b(a,b,c){this._maximumObjectsPerNode=10;this._maximumDepth=20;this._autoResize=!0;this._outsiders=[];c&&(void 0!==c.maximumObjectsPerNode&&(this._maximumObjectsPerNode=c.maximumObjectsPerNode),void 0!==c.maximumDepth&&(this._maximumDepth=c.maximumDepth),void 0!==c.autoResize&&(this._autoResize=c.autoResize));isNaN(a[0])||isNaN(a[1])||isNaN(a[2])||isNaN(b)?this._root=new m(null,
t.createFrom(0,0,0),.5):this._root=new m(null,a,b/2)}Object.defineProperty(b.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"outsiders",{get:function(){return this._outsiders.slice()},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"autoResize",{get:function(){return this._autoResize},enumerable:!0,configurable:!0});b.prototype.add=function(a){a=this._objectOrObjectsArray(a);this._grow(a);for(var b=m.acquire(),c=
0;c<a.length;c++){var d=a[c];b.init(this._root);0===d.getBSRadius()||isNaN(d.getBSRadius())||!this._autoResize&&!this._fitsInsideTree(this._boundingSphereFromObject(d,u))?this._outsiders.push(d):this._add(d,b)}m.release(b)};b.prototype.remove=function(b,c){b=this._objectOrObjectsArray(b);for(var d=m.acquire(),f=!0,k=0;k<b.length;k++){var f=b[k],l=this._boundingSphereFromObject(c||f,u);0===l.radius||isNaN(l.radius)||!this._autoResize&&!this._fitsInsideTree(l)?f=null!=a.arrayRemove(this._outsiders,
f):(d.init(this._root),f=this._remove(f,l,d))}m.release(d);this._shrink();return f};b.prototype.update=function(a,b){this.remove(a,b);this.add(a)};b.prototype.forEachAlongRay=function(b,c,d){this._forEachTest(function(d){q(d.center,2*-d.halfSize,z);q(d.center,2*d.halfSize,v);return a.rayBoxTest(b,c,z,v)},d)};b.prototype.forEachInBoundingBox=function(a,b,c){this._forEachTest(function(c){for(var d=2*c.halfSize,f=0;3>f;f++)if(c.center[f]+d<a[f]||c.center[f]-d>b[f])return!1;return!0},c)};b.prototype.forEachNode=
function(a){this._forEachNode(this._root,function(b){return a(b.node,b.center,2*b.halfSize)})};b.prototype._forEachTest=function(a,b){this._outsiders.forEach(b);this._forEachNode(this._root,function(c){return a(c)?(c=c.node,c.terminals.forEach(b),null!==c.residents&&c.residents.forEach(b),!0):!1})};b.prototype._forEachNode=function(a,b){a=m.acquire().init(a);for(var c=[a];0!==c.length;){a=c.pop();if(b(a)&&!a.isLeaf())for(var d=0;d<a.node.children.length;d++)a.node.children[d]&&c.push(m.acquire().init(a).advance(d));
m.release(a)}};b.prototype._objectOrObjectsArray=function(a){Array.isArray(a)||(p[0]=a,a=p);return a};b.prototype._remove=function(b,c,d){r.length=0;d.advanceTo(c,function(a,b){r.push(a.node,b)})?(b=null!=a.arrayRemove(d.node.terminals,b),d=0===d.node.terminals.length):(b=null!=a.arrayRemove(d.node.residents,b),d=0===d.node.residents.length);if(d)for(d=r.length-2;0<=d&&this._purge(r[d],r[d+1]);d-=2);return b};b.prototype._nodeIsEmpty=function(a){if(0!==a.terminals.length)return!1;if(null!==a.residents)return 0===
a.residents.length;for(var b=0;b<a.children.length;b++)if(a.children[b])return!1;return!0};b.prototype._purge=function(a,b){0<=b&&(a.children[b]=null);return this._nodeIsEmpty(a)?(null===a.residents&&(a.residents=[]),!0):!1};b.prototype._add=function(a,b){b.advanceTo(this._boundingSphereFromObject(a,u))?b.node.terminals.push(a):(b.node.residents.push(a),b.node.residents.length>this._maximumObjectsPerNode&&b.depth<this._maximumDepth&&this._split(b))};b.prototype._split=function(a){var b=a.node.residents;
a.node.residents=null;for(var c=0;c<b.length;c++){var d=m.acquire().init(a);this._add(b[c],d);m.release(d)}};b.prototype._grow=function(a){if(0!==a.length&&this._autoResize&&(a=this._boundingSphereFromObjects(a,this._boundingSphereFromObject,C),!isNaN(a.radius)&&0!==a.radius&&!this._fitsInsideTree(a)))if(this._nodeIsEmpty(this._root.node))t.set(a.center,this._root.center),this._root.halfSize=1.25*a.radius;else{var b=m.acquire();this._rootBoundsForRootAsSubNode(a,b);this._placingRootViolatesMaxDepth(b)?
this._rebuildTree(a,b):this._growRootAsSubNode(b);m.release(b)}};b.prototype._rebuildTree=function(a,b){var d=this;t.set(b.center,E.center);E.radius=b.halfSize;a=this._boundingSphereFromObjects([a,E],function(a){return a},c);b=m.acquire().init(this._root);this._root.initFrom(null,a.center,1.25*a.radius);this._forEachNode(b,function(a){d.add(a.node.terminals);null!==a.node.residents&&d.add(a.node.residents);return!0});m.release(b)};b.prototype._placingRootViolatesMaxDepth=function(a){var b=0;this._forEachNode(this._root,
function(a){b=Math.max(b,a.depth);return!0});return b+Math.log(a.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth};b.prototype._rootBoundsForRootAsSubNode=function(a,b){var c=a.radius,d=a.center;a=-Infinity;for(var f=this._root.center,k=this._root.halfSize,m=0;3>m;m++){var l=Math.max(0,Math.ceil((f[m]-k-(d[m]-c))/(2*k))),p=Math.max(0,Math.ceil((d[m]+c-(f[m]+k))/(2*k)))+1;a=Math.max(a,Math.pow(2,Math.ceil(Math.log(l+p)*Math.LOG2E)));D[m].min=l;D[m].max=p}for(m=0;3>m;m++)l=D[m].min,p=D[m].max,
c=(a-(l+p))/2,l+=Math.ceil(c),p+=Math.floor(c),x[m]=f[m]-k-l*k*2+(p+l)*k;return b.initFrom(null,x,a*k,0)};b.prototype._growRootAsSubNode=function(a){var b=this._root.node;t.set(this._root.center,C.center);C.radius=this._root.halfSize;this._root.init(a);a.advanceTo(C,null,!0);a.node.children=b.children;a.node.residents=b.residents;a.node.terminals=b.terminals};b.prototype._shrink=function(){if(this._autoResize)for(;;){var a=this._findShrinkIndex();if(-1===a)break;this._root.advance(a);this._root.depth=
0}};b.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var a=null,b=this._root.node.children,c=0,d=0;d<b.length&&null==a;)c=d++,a=b[c];for(;d<b.length;)if(b[d++])return-1;return c};b.prototype._fitsInsideTree=function(a){var b=this._root.center,c=this._root.halfSize,d=a.center;return a.radius<=c&&d[0]>=b[0]-c&&d[0]<=b[0]+c&&d[1]>=b[1]-c&&d[1]<=b[1]+c&&d[2]>=b[2]-c&&d[2]<=b[2]+c};b.prototype._boundingSphereFromObject=function(a,b){t.set(a.getCenter(),
b.center);b.radius=a.getBSRadius();return b};b.prototype._boundingSphereFromObjects=function(a,b,c){if(1===a.length){var d=b(a[0],C);t.set(d.center,c.center);c.radius=d.radius}else{z[0]=Infinity;z[1]=Infinity;z[2]=Infinity;v[0]=-Infinity;v[1]=-Infinity;v[2]=-Infinity;for(var f=0;f<a.length;f++){var d=b(a[f],C),k=z,m=d.center,l=d.radius;k[0]=Math.min(k[0],m[0]-l);k[1]=Math.min(k[1],m[1]-l);k[2]=Math.min(k[2],m[2]-l);k=v;m=d.center;d=d.radius;k[0]=Math.max(k[0],m[0]+d);k[1]=Math.max(k[1],m[1]+d);k[2]=
Math.max(k[2],m[2]+d)}t.scale(t.add(z,v,c.center),.5);c.radius=Math.max(v[0]-z[0],v[1]-z[1],v[2]-z[2])/2}return c};return b}();var m=function(){function a(a,b,c,d){void 0===c&&(c=0);void 0===d&&(d=0);this.center=t.create();this.initFrom(a,b,c,0)}a.prototype.init=function(a){return this.initFrom(a.node,a.center,a.halfSize,a.depth)};a.prototype.initFrom=function(b,c,d,f){void 0===b&&(b=null);void 0===d&&(d=this.halfSize);void 0===f&&(f=this.depth);this.node=b||a.createEmptyNode();c&&t.set(c,this.center);
this.halfSize=d;this.depth=f;return this};a.prototype.advance=function(b){var c=this.node.children[b];c||(c=a.createEmptyNode(),this.node.children[b]=c);this.node=c;this.halfSize/=2;this.depth++;b=k[b];this.center[0]+=b[0]*this.halfSize;this.center[1]+=b[1]*this.halfSize;this.center[2]+=b[2]*this.halfSize;return this};a.prototype.advanceTo=function(a,b,c){for(void 0===c&&(c=!1);;){if(this.isTerminalFor(a))return b&&b(this,-1),!0;if(this.isLeaf()&&!c)return b&&b(this,-1),!1;this.isLeaf()&&(this.node.residents=
null);var d=this._childIndex(a);b&&b(this,d);this.advance(d)}};a.prototype.isLeaf=function(){return null!=this.node.residents};a.prototype.isTerminalFor=function(a){return a.radius>this.halfSize/2};a.prototype._childIndex=function(a){a=a.center;for(var b=this.center,c=0,d=0;3>d;d++)b[d]<a[d]&&(c|=1<<d);return c};a.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:[],residents:[]}};a.acquire=function(){if(0===this._pool.length)return new a;var b=this._pool[this._pool.length-
1];this._pool.length--;return b};a.release=function(a){this._pool.push(a)};a._pool=[];return a}(),k=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],p=[null],x=t.create(),z=t.create(),v=t.create(),r=[],u={center:t.create(),radius:0},C={center:t.create(),radius:0},E={center:t.create(),radius:0},c={center:t.create(),radius:0},D=[{min:0,max:0},{min:0,max:0},{min:0,max:0}];return w})},"esri/views/3d/webgl-engine/lib/FloatingBoxLocalOriginFactory":function(){define(["require",
"exports","./gl-matrix"],function(w,l,f){var a=f.vec3d;w=function(){function b(a,b){this._origins=[];this._boxSize=a;this._maxNumOrigins=b}b.prototype.getOrigin=function(f){for(var l=this._origins.length,m,k=!1,p=Number.MAX_VALUE,q=0;q<l;q++){var z=this._origins[q];a.subtract(f,z.vec3,d);d[0]=Math.abs(d[0]);d[1]=Math.abs(d[1]);d[2]=Math.abs(d[2]);var v=d[0]+d[1]+d[2];v<p&&(m=z,p=v,k=d[0]<this._boxSize&&d[1]<this._boxSize&&d[2]<this._boxSize)}k||m&&null!=this._maxNumOrigins&&!(this._origins.length<
this._maxNumOrigins)||(l=b.OFFSET,m={vec3:[f[0]+l,f[1]+l,f[2]+l],id:b.ORIGIN_PREFIX+this._origins.length},this._origins.push(m));return m};b.OFFSET=1.11;b.ORIGIN_PREFIX="fb_";return b}();var d=a.create();return w})},"esri/symbols/support/unitConversionUtils":function(){define(["require","exports","../../renderers/support/utils"],function(w,l,f){Object.defineProperty(l,"__esModule",{value:!0});l.supportsUnit=function(a){return null!=f.meterIn[a]};l.getMetersPerUnit=function(a){return 1/(f.meterIn[a]||
1)}})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["require","exports","../../../../support/arcadeUtils"],function(w,l,f){Object.defineProperty(l,"__esModule",{value:!0});l.createContext=function(a,d,b){var l=null;a=a&&a.expression;"string"===typeof a&&(l="0"===a?0:null,null!=l?l={cachedResult:l}:(l=f.createSyntaxTree(a),f.dependsOnView(l)?(null!=b&&b.error("Expressions containing '$view' are not supported on ElevationInfo"),l={cachedResult:0}):l={arcade:{func:f.createFunction(l),
context:f.createExecContext(null,{sr:d})}}));return l};l.createFeature=function(a){return f.createFeature(a)};l.setContextFeature=function(a,d){null!=a&&null==a.cachedResult&&f.updateExecContext(a.arcade.context,d)};l.execute=function(a){if(null!=a){if(null!=a.cachedResult)return a.cachedResult;var d=a.arcade,d=f.executeFunction(d.func,d.context);"number"!==typeof d&&(d=a.cachedResult=0);return d}return 0};l.extractExpressionInfo=function(a,d){void 0===d&&(d=!1);var b=(a=a&&a.featureExpressionInfo)&&
a.expression;d||"0"===b||(a=null);return a};l.zeroContext={cachedResult:0}})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/ObjectPool ../../support/aaBoundingBox ../../support/aaBoundingRect ./featureExpressionInfoUtils".split(" "),function(w,l,f,a,d,b,q,t,m){var k=new b(Array,function(a){return q.set(a,q.ZERO)},null,10,5),p=t.create();
return function(){function b(a,b,d){this.addedToSpatialIndex=!1;this._labelGraphics=[];this._auxiliaryGraphics=[];for(var f=Array(2),k=0;k<f.length;k++)f[k]=Array(3);this._visibilityFlags=f;this._featureExpressionFeature=null;this.graphics3DSymbol=b;this.graphic=a;this._graphics=d;this._featureExpressionFeature=m.createFeature(a)}b.prototype.initialize=function(a,b){var d=this;this._layer=a;this._stage=b;this.forEachSymbolLayerGraphic(function(f){f.initialize(a,b);f.setVisibility(d.isVisible())})};
b.prototype.destroy=function(){this.forEachRenderedGraphic(function(a){return a.destroy()});this._graphics.length=0;this._labelGraphics.length=0;this._auxiliaryGraphics.length=0};b.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(a){return a.destroy()});this._labelGraphics.length=0};b.prototype.addLabelGraphic=function(a,b,d){this._labelGraphics.push(a);a.initialize(b,d);a.setVisibility(this.isVisible(1))};b.prototype.addAuxiliaryGraphic=function(a){this._auxiliaryGraphics.push(a);
this._layer&&(a.initialize(this._layer,this._stage),a.setVisibility(this.isVisible()))};b.prototype.isDraped=function(){var a=!1;this.forEachSymbolLayerGraphic(function(b){b.isDraped()&&(a=!0)});return a};b.prototype.setDrawOrder=function(a,b,d){var f=this;d[this.graphics3DSymbol.symbol.id]=!0;this.forEachSymbolLayerGraphic(function(k,m){k.setDrawOrder(a+(1-(1+m)/f._graphics.length),b,d)})};b.prototype.areVisibilityFlagsSet=function(a,b,d){void 0===d&&(d=0);d=this._visibilityFlags[d];if(null!=a)return d[a];
a=!0;for(var f=0;f<d.length;f++)if(f!==b){var k=d[f];a=a&&(null==k||!0===k)}return a};b.prototype.isVisible=function(a){void 0===a&&(a=0);for(var b=!0,d=0;d<=a;d++)for(var f=this._visibilityFlags[d],k=0;k<f.length;k++)var m=f[k],b=b&&(null==m||!0===m);return b};b.prototype.setVisibilityFlag=function(a,b,d){void 0===d&&(d=0);var f=this.isVisible(d);this._visibilityFlags[d][a]=b;var k=this.isVisible(d);if(f!==k){if(1===d)this.forEachLabelGraphic(function(a){return a.setVisibility(k)});else{this.forEachSymbolLayerGraphic(function(a){return a.setVisibility(k)});
var m=this.isVisible(1);this.forEachLabelGraphic(function(a){return a.setVisibility(m)})}return!0}return!1};b.prototype.getBSRadius=function(){var a=0;this.forEachSymbolLayerGraphic(function(b){a=Math.max(a,b.getBSRadius())});return a};b.prototype.getCenterObjectSpace=function(){return this._graphics[0].getCenterObjectSpace()};b.prototype.getProjectedBoundingBox=function(b,m,l,u){return a(this,void 0,void 0,function(){var r=this;return f(this,function(v){switch(v.label){case 0:return u||(u={boundingBox:null,
requiresDrapedElevation:!1,screenSpaceObjects:[]}),u.boundingBox?q.set(u.boundingBox,q.NEGATIVE_INFINITY):u.boundingBox=q.create(q.NEGATIVE_INFINITY),u.requiresDrapedElevation=!1,[4,d.forEach(this._graphics,function(c){return a(r,void 0,void 0,function(){var a,d,p;return f(this,function(f){switch(f.label){case 0:if(!c)return[2];a=c.isDraped()?m:b;d=k.acquire();return[4,c.getProjectedBoundingBox(a,l,d,u.screenSpaceObjects)];case 1:return p=f.sent(),isFinite(p[2])&&isFinite(p[5])||(u.requiresDrapedElevation=
!0),p&&q.expand(u.boundingBox,d),k.release(d),[2]}})})})];case 1:return v.sent(),q.allFinite(u.boundingBox)||t.allFinite(q.toRect(u.boundingBox,p))?[2,u]:[2,null]}})})};b.prototype.needsElevationUpdates=function(){for(var a=0,b=this._graphics;a<b.length;a++){var d=b[a];if(d&&d.needsElevationUpdates)return!0}a=0;for(b=this._labelGraphics;a<b.length;a++)if((d=b[a])&&d.needsElevationUpdates)return!0;return!1};b.prototype.alignWithElevation=function(a,b){var d=this;this.forEachRenderedGraphic(function(f){f.alignWithElevation(a,
b,d._featureExpressionFeature)})};b.prototype.addHighlight=function(a,b){this.forEachSymbolLayerGraphic(function(d){return d.addHighlight(a,b)})};b.prototype.removeHighlight=function(a){this.forEachSymbolLayerGraphic(function(b){return b.removeHighlight(a)})};b.prototype.forEachGraphicList=function(a,b){a.forEach(function(a,d){return a&&b(a,d)})};b.prototype.forEachSymbolLayerGraphic=function(a){this.forEachGraphicList(this._graphics,a);this.forEachGraphicList(this._auxiliaryGraphics,a)};b.prototype.forEachLabelGraphic=
function(a){this.forEachGraphicList(this._labelGraphics,a)};b.prototype.forEachRenderedGraphic=function(a){this.forEachSymbolLayerGraphic(a);this.forEachLabelGraphic(a)};return b}()})},"esri/core/asyncUtils":function(){define(["require","exports","./tsSupport/generatorHelper","./tsSupport/awaiterHelper","./promiseUtils"],function(w,l,f,a,d){Object.defineProperty(l,"__esModule",{value:!0});l.forEach=function(b,l,t){return a(this,void 0,void 0,function(){return f(this,function(a){switch(a.label){case 0:return[4,
d.eachAlways(b.map(function(a,b){return l.apply(t,[a,b])}))];case 1:return a.sent(),[2]}})})};l.map=function(b,l,t){return a(this,void 0,void 0,function(){var a;return f(this,function(f){switch(f.label){case 0:return[4,d.eachAlways(b.map(function(a,b){return l.apply(t,[a,b])}))];case 1:return a=f.sent(),[2,a.map(function(a){return a.value})]}})})}})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../support/PromiseLightweight"],
function(w,l,f,a){return function(a){function b(b,d){var f=a.call(this)||this;f.symbol=null;f.graphics3DSymbol=null;f.symbol=b;b.fetchSymbol().then(function(a){if(f.isRejected())throw Error();f.graphics3DSymbol=d(a)}).then(function(){if(f.isRejected())throw Error();f.graphics3DSymbol.then(function(){f.isRejected()||f.resolve()},function(a){f.isRejected()||f.reject(a)})}).otherwise(function(a){f.isRejected()||f.reject(a)});return f}f(b,a);b.prototype.createGraphics3DGraphic=function(a,b){return this.graphics3DSymbol.createGraphics3DGraphic(a,
b,this)};b.prototype.layerPropertyChanged=function(a,b){return this.graphics3DSymbol.layerPropertyChanged(a,b)};b.prototype.applyRendererDiff=function(a,b,d){return this.graphics3DSymbol.applyRendererDiff(a,b,d)};b.prototype.getFastUpdateStatus=function(){return this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};b.prototype.setDrawOrder=function(a,b){return this.graphics3DSymbol.setDrawOrder(a,b)};b.prototype.destroy=function(){this.isFulfilled()||this.reject();
this.graphics3DSymbol&&this.graphics3DSymbol.destroy()};return b}(a.Promise)})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["require","exports","./Graphics3DSymbol","./Graphics3DPointSymbol"],function(w,l,f,a){Object.defineProperty(l,"__esModule",{value:!0});l.make=function(d,b,l){var q;switch(d.type){case "point-3d":q=a;break;default:q=f}return new q(d,b,l)}})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../support/PromiseLightweight ./Graphics3DGraphic ./Graphics3DSymbolLayerFactory".split(" "),
function(w,l,f,a,d,b){return function(a){function l(d,f,l){var k=a.call(this)||this;k.symbol=d;d=d.symbolLayers;l&&(d=l.concat(d));l=d.length;k.childGraphics3DSymbols=Array(d.length);k.childGraphics3DSymbolPromises=Array(d.length);for(var m=f.layerOrder,p=0,r=0,q=!1,t=function(a,b){b&&(this.childGraphics3DSymbols[a]=b,r++);p--;!this.isRejected()&&q&&1>p&&(0<r?this.resolve():this.reject())},w=0;w<l;w++){var c=d.getItemAt(w);!1!==c.enabled&&(f.layerOrder=m+(1-(1+w)/l),f.layerOrderDelta=1/l,c=b.make(k.symbol,
c,f,c._ignoreDrivers))&&(p++,k.childGraphics3DSymbolPromises[w]=c,c.then(t.bind(k,w,c),t.bind(k,w,null)))}f.layerOrder=m;q=!0;!k.isRejected()&&1>p&&(0<r?k.resolve():k.reject());return k}f(l,a);l.prototype.createGraphics3DGraphic=function(a,b,f){for(var k=Array(this.childGraphics3DSymbols.length),m=0;m<this.childGraphics3DSymbols.length;m++){var l=this.childGraphics3DSymbols[m];l&&(k[m]=l.createGraphics3DGraphic(a,b))}return new d(a,f||this,k)};l.prototype.layerPropertyChanged=function(a,b){for(var d=
this.childGraphics3DSymbols.length,f=function(d){var f=k.childGraphics3DSymbols[d],m=function(a){return a._graphics[d]};if(f&&!f.layerPropertyChanged(a,b,m))return{value:!1}},k=this,m=0;m<d;m++){var l=f(m);if("object"===typeof l)return l.value}return!0};l.prototype.applyRendererDiff=function(a,b,d){return this.isResolved()?this.childGraphics3DSymbols.reduce(function(f,k,m){return f&&(!k||k.applyRendererDiff(a,b,d,m))},!0):!1};l.prototype.getFastUpdateStatus=function(){var a=0,b=0,d=0;this.childGraphics3DSymbolPromises.forEach(function(f){f&&
!f.isFulfilled()?a++:f&&f.isFastUpdatesEnabled()?d++:f&&b++});return{loading:a,slow:b,fast:d}};l.prototype.setDrawOrder=function(a,b){for(var d=this.childGraphics3DSymbols.length,f=1/d,k=0;k<d;k++){var m=this.childGraphics3DSymbols[k];m&&m.setDrawOrder(a+(1-(1+k)/d),f,b)}};l.prototype.destroy=function(){this.isFulfilled()||this.reject();for(var a=0;a<this.childGraphics3DSymbolPromises.length;a++)this.childGraphics3DSymbolPromises[a]&&this.childGraphics3DSymbolPromises[a].destroy()};return l}(a.Promise)})},
"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("require exports ../../../../core/Logger ./Graphics3DIconSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DFillSymbolLayer ./Graphics3DExtrudeSymbolLayer ./Graphics3DTextSymbolLayer".split(" "),function(w,l,f,a,d,b,q,t,m,k){Object.defineProperty(l,"__esModule",{value:!0});var p=f.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");l.make=function(a,
b,d,f){var k=x[b.type];return k?new k(a,b,d,f):(p.error("GraphicsLayerFactory#make","unknown symbol type "+b.type),null)};var x={icon:a,object:d,line:b,path:q,fill:t,extrude:m,text:k}})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/_base/lang dojo/when dojo/errors/CancelError ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./Graphics3DDrapedGraphicLayer ./ElevationAligners ./Graphics3DSymbolCommonCode ./SignedDistanceFunctions ../support/FastSymbolUpdates ./graphicUtils ../../../../core/screenUtils ../../../../core/sniff ../../../../core/Error ../../../../symbols/support/symbolUtils ../../../../Color ../../../../geometry/Polygon ../../support/projectionUtils ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial ../../../../core/urlUtils".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c,D,B,I,G,H,K,J,P,O,L){function M(a){return"cross"===a||"x"===a}function R(a){var b;"primitive:"===a.substring(0,10)&&(a=a.substring(10));switch(a){case n.PRIM_CIRCLE:b=x.computeSignedDistancefieldCicle(128,64);break;case n.PRIM_SQUARE:b=x.computeSignedDistancefieldSquare(128,64,!1);break;case n.PRIM_KITE:b=x.computeSignedDistancefieldSquare(128,64,!0);break;case n.PRIM_CROSS:b=x.computeSignedDistancefieldCrossAndX(128,64,!1);break;case n.PRIM_X:b=x.computeSignedDistancefieldCrossAndX(128,
64,!0)}return new P(b,"sdf_"+a,{mipmap:!1,wrapClamp:!0,width:128,height:128,components:4})}var Q=I.vec3d;w=I.vec4d;var T=I.mat4d.identity(),A=[0,0,1],V=[0,0,0,0],S=[0,0,0],h=[1,1,1],e="center bottom top left right bottom-left bottom-right top-left top-right".split(" "),g=[.25,.25,.75,.75],n={PRIM_CIRCLE:"circle",PRIM_SQUARE:"square",PRIM_CROSS:"cross",PRIM_X:"x",PRIM_KITE:"kite"},y=[64,64];q=function(l){function n(){var a=null!==l&&l.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!0,
supportsOnTheGround:!0};return a}f(n,l);n.prototype._prepareResources=function(){var a=this.symbol,b=Math.round(null!=a.size?r.pt2px(a.size):16);this._size=null;this._symbolTextureRatio=1;this._primitive=null;var c=this._getStageIdHint();if(!this._isPropertyDriven("size")){var e=v.validateSymbolLayerSize(b);if(e){this._logWarning(e);this.reject();return}}this._isPropertyDriven("size")&&64>b&&(b=64);var d=a.resource||{primitive:"circle",href:void 0},e={anchorPos:this._getAnchorPos(a)},f=this.symbolContainer;
if(this._hasVisibleVerticalOffset(f)){var f=f.verticalOffset,h=f.minWorldLength,k=f.maxWorldLength;e.verticalOffset={screenLength:r.pt2px(f.screenLength),minWorldLength:h||0,maxWorldLength:null!=k?k:Infinity}}this._context.screenSizePerspectiveEnabled&&(e.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);d.href?(this._outlineSize=this._getOutlineSize(a,null),e.color=this._getFillColor(a,null),e.outlineColor=this._getOutlineColor(a),e.outlineSize=this._outlineSize,
e.textureIsSignedDistanceField=!1,this._prepareImageResources(b,e,c)):(d=d.primitive||"circle",f="primitive:"+d,this._primitive=d,this._outlineSize=this._getOutlineSize(a,d),e.color=this._getFillColor(a,d),e.outlineColor=this._getOutlineColor(a),e.outlineSize=this._outlineSize,M(d)&&0===e.outlineSize?this.reject():(this.texture=this._context.sharedResources.textures.acquire(f,R),this._textureURI=f,e.textureIsSignedDistanceField=!0,e.distanceFieldBoundingBox=g,e.textureId=this.texture.getId(),this._size=
[b,b],this._symbolTextureRatio=2,this._createMaterialsAndAddToStage(e,this._context.stage,c),this.resolve()))};n.prototype._getOutlineSize=function(a,b){var c=0,c=a.outline&&null!=a.outline.size?r.pt2px(a.outline.size):M(b)?1.5:0;return Math.max(c,0)};n.prototype._getOutlineColor=function(a){var b=this._getLayerOpacity();if(a.outline&&null!=a.outline.color){var e=c.toUnitRGB(a.outline.color);return[e[0],e[1],e[2],a.outline.color.a*b]}return[0,0,0,b]};n.prototype._getFillColor=function(a,b){return M(b)?
V:this._getMaterialOpacityAndColor()};n.prototype._getAnchorPos=function(a){return-1<e.indexOf(a.anchor)?a.anchor:"center"};n.prototype._prepareImageResources=function(a,c,e){var f=this,g=E.getIconHref(this.symbolContainer,this.symbol);!u("esri-canvas-svg-support")&&L.isSVG(g)?(this._logWarning("IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)"),this.reject(new C("SVG Not Supported","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)"))):(d(this._context.sharedResources.textures.acquire(g,
null,a),function(b){if(!f.isRejected()){var d=b.params,g=d.width/d.height;f._size=a?1<g?[a,Math.round(a/g)]:[Math.round(a*g),a]:[d.width,d.height];c.textureId=b.getId();f._createMaterialsAndAddToStage(c,f._context.stage,e);f.resolve()}},function(a){a instanceof b?f.reject():(a="IconSymbol3DLayer failed to load (Request for icon resource failed: "+g+")",f._logWarning(a),f.reject(new C("Request Failed",a)))}),this._textureURI=g)};n.prototype._createMaterialsAndAddToStage=function(b,c,e){this._fastUpdates=
z.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&a.mixin(b,this._fastUpdates.materialParameters);var d=a.mixin({},b);d.verticalOffset=null;d.screenSizePerspective=null;d.occlusionTest=!1;d.shaderPolygonOffset=0;this._drapedMaterial=new O(d,e+"_iconDraped");c.add(G.ModelContentType.MATERIAL,this._drapedMaterial);b.occlusionTest=!0;this._material=new O(b,e+"_icon");c.add(G.ModelContentType.MATERIAL,
this._material)};n.prototype.destroy=function(){l.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(G.ModelContentType.MATERIAL,this._material.getId()),this._material=null);this._drapedMaterial&&(this._context.stage.remove(G.ModelContentType.MATERIAL,this._drapedMaterial.getId()),this._drapedMaterial=null);this._textureURI&&(this._context.sharedResources.textures.release(this._textureURI),this._textureURI=null)};n.prototype._getGeometry=function(a){a=
this._validateGeometry(a.geometry);if("extent"===a.type)return p.placePointOnPolygon(D.fromExtent(a));if("polyline"===a.type)return p.placePointOnPolyline(a);if("polygon"===a.type)return p.placePointOnPolygon(a);if("point"===a.type)return a;this._logWarning("unsupported geometry type for icon symbol: "+a.type);return null};n.prototype._getScaleFactor=function(a){if(this._isPropertyDriven("size")&&a.size){for(var b=0;3>b;b++){var c=a.size[b];c&&"symbolValue"!==c&&"proportional"!==c&&(a.size[b]=r.pt2px(c))}b=
this._size[0]>this._size[1]?this._size[0]:this._size[1];if("symbolValue"!==a.size[0]){if(isFinite(+a.size[0]))return+a.size[0]/b;if(isFinite(+a.size[2]))return+a.size[2]/b}}return 1};n.prototype.createGraphics3DGraphic=function(a,b){var c=this._getGeometry(a);if(null===c)return null;var e="graphic"+a.uid,d=this._getVertexOpacityAndColor(b),f=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(f=this._getScaleFactor(b));f*=this._symbolTextureRatio;b=[this._size[0]*f,this._size[1]*
f];f=this.getGraphicElevationInfo(a);return"on-the-ground"===f.mode?this._createAsOverlay(a,c,d,b,f,e,a.uid):this._createAs3DShape(a,c,d,b,f,e,a.uid)};n.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)return b=this._getFillColor(this.symbol,this._primitive),this._drapedMaterial.setParameterValues({color:b}),this._material.setParameterValues({color:b}),b=this._getOutlineColor(this.symbol),this._drapedMaterial.setParameterValues({outlineColor:b}),this._material.setParameterValues({outlineColor:b}),
!0;if("elevationInfo"===a){a=this._elevationInfo.mode;this._updateElevationInfo();var e=this._elevationInfo.mode;if("on-the-ground"===a&&"on-the-ground"===e)return!0;if(a!==e&&("on-the-ground"===a||"on-the-ground"===e))return!1;a=p.needsElevationUpdates2D(e)||"absolute-height"===e;for(var d in b){var f=b[d];(e=c(f))&&!e.isDraped()&&(f=this.getGraphicElevationInfo(f.graphic),e.needsElevationUpdates=a,e.elevationInfo.set(f))}return!0}return!1};n.prototype.applyRendererDiff=function(a,b,c,e){for(var d in a.diff)switch(d){case "visualVariables":if(z.updateFastSymbolUpdatesState(this._fastUpdates,
b,this._fastVisualVariableConvertOptions()))this._material.setParameterValues(this._fastUpdates.materialParameters),this._drapedMaterial.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};n.prototype.setDrawOrder=function(a,b,c){this._drapedMaterial&&(this._drapedMaterial.setRenderPriority(a),c[this._drapedMaterial.getId()]=!0)};n.prototype._defaultElevationInfoNoZ=function(){return F};n.prototype._createAs3DShape=function(a,b,c,e,d,f,g){var h=
this,m=this._getFastUpdateAttrValues(a);a=m?function(a){return z.evaluateModelTransform(h._fastUpdates.materialParameters,m,a)}:null;c=K.createPointGeometry(A,null,c,e,N,null,m);c=[new H(c,f)];f=p.createStageObjectForPoint.call(this,b,c,[[this._material]],null,null,d,f,this._context.layer.uid,g,!0,a);if(null===f)return null;var l=new t(this,f.object,c,null,null,k.perObjectElevationAligner,d);l.alignedTerrainElevation=f.terrainElevation;l.needsElevationUpdates=p.needsElevationUpdates2D(d.mode)||"absolute-height"===
d.mode;l.getScreenSize=this._createScreenSizeGetter(e,a);l.calculateRelativeScreenBounds=function(a){return h._material.calculateRelativeScreenBounds(l.getScreenSize(),1,a)};p.extendPointGraphicElevationInfo(l,b,this._context.elevationProvider);return l};n.prototype._createAsOverlay=function(a,b,c,e,d,f,g){var h=this;this._drapedMaterial.setRenderPriority(this._symbolLayerOrder);g=Q.create();B.pointToVector(b,g,this._context.overlaySR);g[2]=this._getDrapedZ();if((b=this._context.clippingExtent)&&
!p.pointInBox2D(g,b))return null;var k=this._getFastUpdateAttrValues(a);a=k?function(a){return z.evaluateModelTransform(h._fastUpdates.materialParameters,k,a)}:null;c=K.createPointGeometry(A,g,c,e,null,null,k);b=new J(c);b.material=this._drapedMaterial;b.center=g;b.bsRadius=0;b.transformation=T;b.name=f;b.uniqueName=f+"#"+c.id;var l=new m(this,[b],null,null,null,d);l.getScreenSize=this._createScreenSizeGetter(e,a);l.calculateRelativeScreenBounds=function(a){return h._drapedMaterial.calculateRelativeScreenBounds(l.getScreenSize(),
1,a)};return l};n.prototype._createScreenSizeGetter=function(a,b){var c=this._outlineSize+2;if(this._fastUpdates.enabled){var e=a[0]/this._symbolTextureRatio,d=a[1]/this._symbolTextureRatio;return function(a){void 0===a&&(a=Array(2));var f=b(T);a[0]=f[0]*e+c;a[1]=f[5]*d+c;return a}}var f=a[0]/this._symbolTextureRatio+c,g=a[1]/this._symbolTextureRatio+c;return function(a){void 0===a&&(a=Array(2));a[0]=f;a[1]=g;return a}};n.prototype._supportsShaderVisualVariables=function(){return!0};n.prototype._fastVisualVariableConvertOptions=
function(){var a=this._size[0]>this._size[1]?this._size[0]:this._size[1],b=[a,a,a],c=r.px2pt(1),a=a*c;return{modelSize:b,symbolSize:[a,a,a],unitInMeters:c,transformation:{anchor:S,scale:h,rotation:S}}};n.prototype._hasVisibleVerticalOffset=function(a){return this.symbolContainer&&"point-3d"===this.symbolContainer.type&&this.symbolContainer.hasVisibleVerticalOffset()};n.PRIMITIVE_SIZE=y;n.VALID_ANCHOR_STRINGS=e;return n}(q);var F={mode:"relative-to-ground",offset:0},N=w.createFrom(0,0,0,1);return q})},
"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../support/PromiseLightweight ./featureExpressionInfoUtils ./ElevationInfo ./graphicUtils ./Graphics3DSymbolCommonCode ./constants ../../../../core/Logger ../../../../Color ../../../../core/Scheduler".split(" "),function(w,l,f,a,d,b,q,t,m,k,p,x){function z(a,b){a=null!=a?b.attributes[a]:0;null!=a&&isFinite(a)||(a=0);return a}var v=new b,r=k.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer"),
u={mode:"on-the-ground",offset:0,unit:"meters"},C={mode:"absolute-height",offset:0,unit:"meters"};return function(a){function c(c,d,f,k){var m=a.call(this)||this;m._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};m.symbolContainer=c;m.symbol=d;m._context=f;m._symbolLayerOrder=f.layerOrder;m._symbolLayerOrderDelta=f.layerOrderDelta;m._elevationInfo=new b;m._material=null;m._geometryCreationWarningHandle=null;m._updateDrivenProperties(k);m._updateElevationInfo();m._prepareResources();
return m}f(c,a);c.prototype._logWarning=function(a){r.warn(a)};c.prototype._logGeometryCreationWarnings=function(a,b,c,d){var f=this;if(null==this._geometryCreationWarningHandle){var k=a.geometryData&&a.geometryData.polygons;d+=" geometry failed to be created";var m=null;a.projectionSuccess?!b.length||1===b.length&&!b[0].length?m=d+" (no "+c+" were defined)":Array.isArray(b)&&Array.isArray(b[0])?k&&0===k.length&&"rings"===c&&(m=d+" (filled "+c+" should use clockwise winding - try reversing the order of vertices)"):
m=d+" ("+c+" should be defined as a 2D array)":m=d+" (failed to project geometry to view spatial reference)";m&&(this._geometryCreationWarningHandle=x.schedule(function(){return f._onNextTick()}),this._logWarning(m))}};c.prototype._onNextTick=function(){this._geometryCreationWarningHandle=null};c.prototype._validateGeometry=function(a){switch(a.type){case "point":if(null==a.x||null==a.y){this._logWarning("point coordinate is null - setting to default value");var b=a.clone();b.x=a.x||0;b.y=a.y||0;
return b}}return a};c.prototype._prepareResources=function(a){throw Error("This is an abstract base class");};c.prototype._defaultElevationInfoNoZ=function(){return u};c.prototype._defaultElevationInfoZ=function(){return C};c.prototype._updateElevationInfo=function(){this._elevationInfo.setDefaults();var a=this._context.layer.elevationInfo;a&&this._elevationInfo.mixinApi(a);(a=this.symbol&&this.symbol.elevationInfo)&&this._elevationInfo.mixinApi(a);this._elevationInfo.featureExpressionInfoContext=
this._context.featureExpressionInfoContext};c.prototype.getGraphicElevationInfo=function(a){var b=a.geometry.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ();v.setUnit(null!=this._elevationInfo.unit?this._elevationInfo.unit:b.unit);v.mode=this._elevationInfo.mode||b.mode;v.setOffsetMeters(null!=this._elevationInfo.meterUnitOffset?this._elevationInfo.meterUnitOffset:b.offset);v.featureExpressionInfoContext=this._elevationInfo.featureExpressionInfoContext;v.hasOffsetAdjustment=!1;
this._elevationOptions.supportsOnTheGround||"on-the-ground"!==v.mode||(v.mode="relative-to-ground",v.setOffsetMeters(0),v.featureExpressionInfoContext=d.zeroContext);b=d.createFeature(a);d.setContextFeature(v.featureExpressionInfoContext,b);t.needsOffsetAdjustment(v,this._elevationOptions,a.geometry,this.symbolContainer)&&(v.setOffsetRenderUnits(m.defaultIconElevationOffset),v.hasOffsetAdjustment=!0);return v};c.prototype._getDrapedZ=function(){return-2};c.prototype._updateDrivenProperties=function(a){var b=
{color:!1,opacity:!1,size:!1};!a&&(a=this._context.renderer)&&(b.color=!!a.colorInfo,b.size=!!a.sizeInfo,a.visualVariables&&a.visualVariables.forEach(function(a){switch(a.type){case "color":b.color=!0;if(a.colors)for(var c=0;c<a.colors.length;c++){var d=a.colors[c];d&&(Array.isArray(d)&&3<d.length&&255!==d[3]||void 0!==d.a&&255!==d.a)&&(b.opacity=!0)}if(a.stops)for(c=0;c<a.stops.length;c++)(d=a.stops[c].color)&&(Array.isArray(d)&&3<d.length&&255!==d[3]||void 0!==d.a&&255!==d.a)&&(b.opacity=!0);break;
case "opacity":b.opacity=!0;break;case "size":b.size=!0}}));this._drivenProperties=b};c.prototype._isPropertyDriven=function(a){return this._drivenProperties[a]};c.prototype._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var a=this._context.layer.opacity;return null==a?1:a};c.prototype._getMaterialOpacity=function(){var a;a=1*this._getLayerOpacity();var b=this.symbol&&this.symbol.material;b&&!this._isPropertyDriven("opacity")&&
b.color&&(a*=b.color.a);return a};c.prototype._getMaterialOpacityAndColor=function(){var a=this.symbol&&this.symbol.material,b=this._getMaterialOpacity(),a=!this._isPropertyDriven("color")&&a&&a.color?p.toUnitRGB(a.color):null;return q.mixinColorAndOpacity(a,b)};c.prototype._getVertexOpacityAndColor=function(a,b,c){var d=this._isPropertyDriven("color")?a.color:null;a=this._isPropertyDriven("opacity")?a.opacity:null;d=q.mixinColorAndOpacity(d,a);c&&(d[0]*=c,d[1]*=c,d[2]*=c,d[3]*=c);return b?new b(d):
d};c.prototype._getStageIdHint=function(){return this._context.layer.id+"_symbol"};c.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};c.prototype.setDrawOrder=function(a,b,c){this._material&&(this._material.setRenderPriority(a),c[this._material.getId()]=!0)};c.prototype.createGraphics3DGraphic=function(a,b){for(var c=2;c<arguments.length;c++);throw Error("This is an abstract base class");};c.prototype.destroy=function(){this._geometryCreationWarningHandle&&
(this._geometryCreationWarningHandle.remove(),this._geometryCreationWarningHandle=null)};c.prototype.layerPropertyChanged=function(a,b,c){return!1};c.prototype.applyRendererDiff=function(a,b,c,d){return!1};c.prototype._getFastUpdateAttrValues=function(a){if(!this._fastUpdates.enabled)return null;var b=this._fastUpdates.visualVariables,c=b.size?z(b.size.field,a):0;a=b.color?z(b.color.field,a):0;return[c,a,0,0]};return c}(a.Promise)})},"esri/views/3d/layers/graphics/ElevationInfo":function(){define(["require",
"exports","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(w,l,f,a){return function(){function d(a){a?this.set(a):this.setDefaults()}Object.defineProperty(d.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"unit",{get:function(){return this._unit},enumerable:!0,configurable:!0});d.prototype.setUnit=function(a){this._unit=a;this._metersPerElevationInfoUnit=f.getMetersPerUnit(a)};
d.prototype.setDefaults=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this.featureExpressionInfoContext=null;this.hasOffsetAdjustment=!1;this.setUnit("meters")};d.prototype.set=function(a){this.mode=a.mode;this._meterUnitOffset=a._meterUnitOffset||0;this._renderUnitOffset=a._renderUnitOffset||0;this.featureExpressionInfoContext=a.featureExpressionInfoContext;this.hasOffsetAdjustment=a.hasOffsetAdjustment;this.setUnit(a.unit)};d.prototype.setOffsetMeters=function(a){this._meterUnitOffset=
a;this._renderUnitOffset=0};d.prototype.setOffsetElevationInfoUnits=function(a){this._meterUnitOffset=a*this._metersPerElevationInfoUnit;this._renderUnitOffset=0};d.prototype.setOffsetRenderUnits=function(a){this._meterUnitOffset=0;this._renderUnitOffset=a};d.prototype.addOffsetRenderUnits=function(a){this._renderUnitOffset+=a};d.prototype.mixinApi=function(a){null!=a.mode&&(this.mode=a.mode);null!=a.unit&&this.setUnit(a.unit);null!=a.offset&&this.setOffsetElevationInfoUnits(a.offset)};d.prototype.calculateOffsetRenderUnits=
function(b){var d=this._meterUnitOffset,f=this.featureExpressionInfoContext;null!=f&&(d+=a.execute(f)*this._metersPerElevationInfoUnit);return d/b.unitInMeters+this._renderUnitOffset};return d}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolCommonCode":function(){define("require exports ../../../../geometry/Point ../../../../symbols/callouts/calloutUtils ../../../../geometry/support/mathUtils ./graphicUtils ../../support/projectionUtils ../../lib/glMatrix ../../webgl-engine/lib/Object3D".split(" "),
function(w,l,f,a,d,b,q,t,m){function k(a,b,c,d,f){var k=0,m=b.z||0,l=0,l=c.mode;d=c.calculateOffsetRenderUnits(d);c=c.featureExpressionInfoContext;"on-the-ground"===l?(k=l=a.getElevation(b,"ground")||0,f&&(f.verticalDistanceToGround=0,f.terrainElevation=l)):"relative-to-ground"===l?(l=a.getElevation(b,"ground")||0,k=d,null==c&&(k+=m),f&&(f.verticalDistanceToGround=k,f.terrainElevation=l),k+=l):"relative-to-scene"===l?(l=a.getElevation(b,"scene")||0,k=d,f&&(f.verticalDistanceToGround=k,f.terrainElevation=
l),k+=l):"absolute-height"===l&&(k=d,null==c&&(k+=m),f&&(l=a.getElevation(b,"ground")||0,f.verticalDistanceToGround=k-l,f.terrainElevation=l));return k}function p(a){for(var b=0,c=a.length-1,d=0;d<c;d++)b+=a[d][0]*a[d+1][1]-a[d+1][0]*a[d][1];return 0<=b}function x(a,b,c,d,f,k){d*=3;for(var m=0;m<f;++m){var l=a[b++];c[d++]=l[0];c[d++]=l[1];c[d++]=k?l[2]:0}return d/3}function z(a,b){for(var c=a.length,d=Array(c),f=Array(c),k=Array(c),m=0,l=0,r=0,q=0,u=0;u<c;++u)q+=a[u].length;for(var q=new Float64Array(3*
q),v=0,t=c-1;0<=t;t--){var z=a[t];if(p(z))d[m++]=z;else{for(var h=z.length,u=0;u<m;++u)h+=d[u].length;u={index:v,pathLengths:Array(m+1),count:h,holeIndices:Array(m)};u.pathLengths[0]=z.length;0<z.length&&(k[r++]={index:v,count:z.length});v=x(z,0,q,v,z.length,b);for(z=0;z<m;++z)h=d[z],u.holeIndices[z]=v,u.pathLengths[z+1]=h.length,0<h.length&&(k[r++]={index:v,count:h.length}),v=x(h,0,q,v,h.length,b);m=0;0<u.count&&(f[l++]=u)}}for(z=0;z<m;++z)h=d[z],0<h.length&&(k[r++]={index:v,count:h.length}),v=x(h,
0,q,v,h.length,b);l<c&&(f.length=l);r<c&&(k.length=r);return{vertexData:q,polygons:f,outlines:k}}function v(a,b,c,d,f){b*=3;d*=3;for(var k=0;k<f;++k)c[d++]=a[b++],c[d++]=a[b++],c[d++]=a[b++]}function r(a,b,c,d,f,k,m){return q.bufferToBuffer(a,c,b,d,k,f,m)}function u(a,b,c){q.pointToVector(a,b,c)}function C(a,b){return!(a[0]>b[3]||a[0]<b[0]||a[1]>b[4]||a[1]<b[1])}function E(a,b){return!(b[0]>a[3]||b[3]<a[0]||b[1]>a[4]||b[4]<a[1])}Object.defineProperty(l,"__esModule",{value:!0});w=t.mat4d;var c=t.vec3d.create(),
D=w.identity(),B=new f({x:0,y:0,z:0,spatialReference:null});l.createStageObjectForPoint=function(a,d,f,l,p,r,v,t,x,z,w){var B=d?d.length:0,E=this._context.clippingExtent;u(a,c,this._context.elevationProvider.spatialReference);if(E&&!C(c,E))return null;u(a,c,this._context.renderSpatialReference);E=this._context.localOriginFactory.getOrigin(c);v=new m({castShadow:!1,metadata:{layerUid:t,graphicId:x,usesVerticalDistanceToGround:!!z},idHint:v});for(t=0;t<B;t++)v.addGeometry(d[t],f[t],l?l[t]:D,p,E,w);
d=this._context.renderSpatialReference;l=this._context.elevationProvider;p=this._context.renderCoordsHelper;f=0;var G;v.metadata.usesVerticalDistanceToGround?(f=k(l,a,r,p,I),b.updateVertexAttributeAuxpos1w(v,I.verticalDistanceToGround),G=I.terrainElevation):(w="absolute-height"!==r.mode,f=k(l,a,r,p,w?I:null),w&&(G=I.terrainElevation));r=v.getObjectTransformation();c[0]=a.x;c[1]=a.y;c[2]=f;q.computeLinearTransformation(a.spatialReference,c,r,d)?v.setObjectTransformation(r):console.warn("Could not locate symbol object properly, it might be misplaced");
return{object:v,terrainElevation:G}};l.extendPointGraphicElevationInfo=function(a,b,d){a=a.elevationInfo;d=d.spatialReference;u(b,c,d);a.centerPointInElevationSR=new f({x:c[0],y:c[1],z:b.hasZ?c[2]:0,spatialReference:d})};l.placePointOnPolyline=function(a){var b=a.paths[0],b=d.getPointOnPath(b,d.getPathLength(b)/2);return new f({x:b[0],y:b[1],z:b[2],spatialReference:a.spatialReference})};l.placePointOnPolygon=function(a){return b.computeCentroid(a)};l.computeElevation=k;l.getSingleSizeDriver=function(a,
b){void 0===b&&(b=0);return isFinite(a[b])?a[b]:null};l.isCounterClockwise=p;l.copyPointData=x;l.copyPathData=z;l.copyVertices=v;l.chooseOrigin=function(a,b,c,d){b=Math.floor(b+(c-1)/2);d[0]=a[3*b+0];d[1]=a[3*b+1];d[2]=a[3*b+2]};l.subtractCoordinates=function(a,b,c,d){b*=3;for(var f=0;f<c;++f)a[b++]-=d[0],a[b++]-=d[1],a[b++]-=d[2]};l.setZ=function(a,b,c,d){b*=3;for(var f=0;f<c;++f)a[b+2]=d,b+=3};l.offsetZ=function(a,b,c,d){b*=3;for(var f=0;f<c;++f)a[b+2]+=d,b+=3};l.scaleZ=function(a,b,c,d){b*=3;for(var f=
0;f<c;++f)a[b+2]*=d,b+=3};l.flatArrayToArrayOfArrays=function(a,b,c){var d=[];b*=3;for(var f=0;f<c;++f)d.push([a[b++],a[b++],a[b++]]);return d};l.reproject=r;l.reprojectPoint=u;l.getGeometryVertexData3D=function(a,b,c,d,f,k,m){var l=f.spatialReference;a=z(a,b);b=a.vertexData;var p=b.length/3,q=new Float64Array(b.length),u=!0;c.equals(l)?v(b,0,q,0,b.length):u=r(b,0,c,q,0,l,p);var t=c=0,x=m.mode,w=0,h=0,e=0;k=m.calculateOffsetRenderUnits(k);m=m.featureExpressionInfoContext;B.spatialReference=f.spatialReference;
c*=3;for(var t=3*t,g=0;g<p;++g)B.x=q[c+0],B.y=q[c+1],B.z=q[c+2],"on-the-ground"===x?(h=w=f.getElevation(B)||0,e+=w):"relative-to-ground"===x?(w=f.getElevation(B)||0,h=w+k,null==m&&(h+=B.z),e+=w):"relative-to-scene"===x?(w=f.getElevation(B,"scene")||0,h=w+k,e+=w):"absolute-height"===x&&(h=k,null==m&&(h+=B.z)),b[t+0]=q[c+0],b[t+1]=q[c+1],b[t+2]=h,c+=3,t+=3;f=e/p;l.equals(d)||r(b,0,l,b,0,d,p);return{geometryData:a,vertexData:b,eleVertexData:q,terrainElevation:f,projectionSuccess:u}};l.getGeometryVertexDataDraped=
function(a,b,c){a=z(a,!1);var d=a.vertexData,f=d.length/3,k=!0;b.equals(c)||(k=q.bufferToBuffer(d,b,0,d,c,0,f));return{geometryData:a,vertexData:d,projectionSuccess:k}};l.computeBoundingBox=function(a,b,c,d){d[0]=Number.MAX_VALUE;d[1]=Number.MAX_VALUE;d[2]=Number.MAX_VALUE;d[3]=-Number.MAX_VALUE;d[4]=-Number.MAX_VALUE;d[5]=-Number.MAX_VALUE;b*=3;for(var f=0;f<c;++f){var k=a[b++],m=a[b++],l=a[b++];k<d[0]&&(d[0]=k);m<d[1]&&(d[1]=m);l<d[2]&&(d[2]=l);k>d[3]&&(d[3]=k);m>d[4]&&(d[4]=m);l>d[5]&&(d[5]=l)}return d};
l.pointInBox2D=C;l.boxesIntersect2D=E;l.boundingBoxClipped=function(a,b){return b?!E(a,b):!1};l.needsElevationUpdates2D=function(a){return"relative-to-ground"===a||"relative-to-scene"===a};l.needsElevationUpdates3D=function(a){return"absolute-height"!==a};l.needsOffsetAdjustment=function(b,c,d,f){if(!1===c.needsOffsetAdjustment||!1===c.supportsOffsetAdjustment||"on-the-ground"===b.mode)return!1;if(0===b.meterUnitOffset){if(!0===c.needsOffsetAdjustment)return!0;if(a.isCalloutSupport(f)&&f.hasVisibleVerticalOffset())return!1;
if("relative-to-ground"===b.mode&&(!d.hasZ||b.featureExpressionInfoContext)||"relative-to-scene"===b.mode)return!0}return!1};var I={verticalDistanceToGround:0,terrainElevation:0}})},"esri/views/3d/layers/graphics/constants":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});l.defaultIconElevationOffset=1})},"esri/views/3d/layers/graphics/Graphics3DGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ./Graphics3DGraphicElevationInfo ./featureExpressionInfoUtils ../../webgl-engine/Stage ../../lib/glMatrix ../../support/aaBoundingBox".split(" "),
function(w,l,f,a,d,b,q,t,m,k){w=m.vec3d;var p=m.mat4d,x=[0,0,0];m=function(){function f(a,d,c,k,m,l,p,r){this._addedToStage=!1;this.alignedTerrainElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.uniqueMaterials=k;this.uniqueGeometries=c;this.uniqueTextures=m;this.stageObject=d;this.elevationAligner=l;this.elevationInfo=new b(p);this.stageLayer=this.stage=null;this._visible=!1;this.visibilityMode=null!=r?r:f.VisibilityModes.HIDE_FACERANGE}f.prototype.initialize=function(a,
b){this.stageLayer=a;this.stage=b;if(this.uniqueMaterials)for(a=0;a<this.uniqueMaterials.length;a++)b.add(t.ModelContentType.MATERIAL,this.uniqueMaterials[a]);if(this.uniqueGeometries)for(a=0;a<this.uniqueGeometries.length;a++)b.add(t.ModelContentType.GEOMETRY,this.uniqueGeometries[a]);if(this.uniqueTextures)for(a=0;a<this.uniqueTextures.length;a++)b.add(t.ModelContentType.TEXTURE,this.uniqueTextures[a]);b.add(t.ModelContentType.OBJECT,this.stageObject)};f.prototype.isDraped=function(){return!1};
f.prototype.setVisibility=function(a){if(null!=this.stage)return this._visible!==a?((this._visible=a)?this._addedToStage?this.stageObject.unhideAllComponents():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===f.VisibilityModes.HIDE_FACERANGE?this.stageObject.hideAllComponents():(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1),!0):!1};f.prototype.destroy=function(){var a=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var b=
0;b<this.uniqueMaterials.length;b++)a.remove(t.ModelContentType.MATERIAL,this.uniqueMaterials[b].getId());if(this.uniqueGeometries)for(b=0;b<this.uniqueGeometries.length;b++)a.remove(t.ModelContentType.GEOMETRY,this.uniqueGeometries[b].getId());if(this.uniqueTextures)for(b=0;b<this.uniqueTextures.length;b++)a.remove(t.ModelContentType.TEXTURE,this.uniqueTextures[b].getId())}a.remove(t.ModelContentType.OBJECT,this.stageObject.getId());this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),
this._addedToStage=!1);this._visible=!1;this.stage=this.stageLayer=null};f.prototype.alignWithElevation=function(a,b,c){this.elevationAligner&&(q.setContextFeature(this.elevationInfo.featureExpressionInfoContext,c),a=this.elevationAligner(this.stageObject,this.elevationInfo,a,b),null!=a&&(this.alignedTerrainElevation=a))};f.prototype.setDrawOrder=function(a,b,c){};f.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()};f.prototype.getCenterObjectSpace=function(){return this.stageObject.getCenter(!0)};
f.prototype.getBoundingBoxObjectSpace=function(a){var b=this.stageObject;a||(a=k.create());k.setMin(a,b.getBBMin(!0));k.setMax(a,b.getBBMax(!0));return a};f.prototype.getProjectedBoundingBox=function(b,f,c,m){return d(this,void 0,void 0,function(){var d,l,q,u,t,w,C,E;return a(this,function(a){switch(a.label){case 0:d=this.getBoundingBoxObjectSpace(c);l=r;q=k.isPoint(d)?1:l.length;for(u=0;u<q;u++)t=l[u],v[0]=d[t[0]],v[1]=d[t[1]],v[2]=d[t[2]],p.multiplyVec3(this.stageObject.objectTransformation,v),
z[3*u+0]=v[0],z[3*u+1]=v[1],z[3*u+2]=v[2];if(!b(z,0,q))return[3,6];k.set(d,k.NEGATIVE_INFINITY);w=null;this.calculateRelativeScreenBounds&&(w=this.calculateRelativeScreenBounds());for(u=0;u<3*q;u+=3){for(C=0;3>C;C++)d[C]=Math.min(d[C],z[u+C]),d[C+3]=Math.max(d[C+3],z[u+C]);w&&m.push({location:z.slice(u,u+3),screenSpaceBoundingRect:w})}if(!f)return[3,5];k.center(d,x);if("absolute-height"===this.elevationInfo.mode)return[3,5];E=void 0;a.label=1;case 1:return a.trys.push([1,3,,4]),[4,f.queryElevation(x[0],
x[1])];case 2:return E=a.sent(),[3,4];case 3:return a.sent(),E=null,[3,4];case 4:null!=E&&k.offset(d,0,0,-this.alignedTerrainElevation+E),a.label=5;case 5:return[2,d];case 6:return[2,null]}})})};f.prototype.addHighlight=function(a,b){b=this.stageObject.highlightAllComponents(b);a.addObject(this.stageObject,b)};f.prototype.removeHighlight=function(a){a.removeObject(this.stageObject)};f.VisibilityModes={REMOVE_OBJECT:0,HIDE_FACERANGE:1};return f}();var z=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0],v=w.create(),r=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return m})},"esri/views/3d/layers/graphics/Graphics3DGraphicElevationInfo":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./ElevationInfo"],function(w,l,f,a){return function(a){function b(b){b=a.call(this,b)||this;b.centerPointInElevationSR=null;return b}f(b,a);return b}(a)})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ./ElevationInfo ../../support/aaBoundingBox ../../support/aaBoundingRect ../../webgl-engine/Stage".split(" "),
function(w,l,f,a,d,b,q,t,m){w=function(){function f(a,d,f,k,m,c){this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.renderGeometries=d;this.uniqueMaterials=f;this.uniqueTextures=k;this.boundingBox=m;this.elevationInfo=new b(c);this.stage=null;this._visible=!1}f.prototype.initialize=function(a,b){this.stage=b;if(this.uniqueMaterials)for(a=0;a<this.uniqueMaterials.length;a++)b.add(m.ModelContentType.MATERIAL,this.uniqueMaterials[a]);if(this.uniqueTextures)for(a=0;a<this.uniqueTextures.length;a++)b.add(m.ModelContentType.TEXTURE,
this.uniqueTextures[a])};f.prototype.isDraped=function(){return!0};f.prototype.setVisibility=function(a){if(null!=this.stage)return this._visible!==a?((this._visible=a)?this.stage.getTextureGraphicsRenderer().addRenderGeometries(this.renderGeometries):this.stage.getTextureGraphicsRenderer().removeRenderGeometries(this.renderGeometries),!0):!1};f.prototype.destroy=function(){if(this.stage){var a=this.stage;this._visible&&a.getTextureGraphicsRenderer().removeRenderGeometries(this.renderGeometries);
this._visible=!1;if(this.uniqueMaterials)for(var b=0;b<this.uniqueMaterials.length;b++)a.remove(m.ModelContentType.MATERIAL,this.uniqueMaterials[b].getId());if(this.uniqueTextures)for(b=0;b<this.uniqueTextures.length;b++)a.remove(m.ModelContentType.TEXTURE,this.uniqueTextures[b].getId());this.stage=null}};f.prototype.alignWithElevation=function(a,b,d){};f.prototype.setDrawOrder=function(a,b,d){var f=this;this.uniqueMaterials&&this.uniqueMaterials.forEach(function(d){d.setRenderPriority(a);f._visible&&
(b[d.getId()]=!0)})};f.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(a,b){return Math.max(a,b.bsRadius)},0)};f.prototype.getCenterObjectSpace=function(){return[0,0,0]};f.prototype.addHighlight=function(a,b){var d=this.stage.getTextureGraphicsRenderer();this.renderGeometries.forEach(function(f){var k=d.addRenderGeometryHighlight(f,b);a.addRenderGeometry(f,d,k)})};f.prototype.removeHighlight=function(a){this.renderGeometries.forEach(function(b){a.removeRenderGeometry(b)})};
f.prototype.getProjectedBoundingBox=function(b,f,m,l){return d(this,void 0,void 0,function(){var d,c,p;return a(this,function(a){switch(a.label){case 0:q.set(m,q.NEGATIVE_INFINITY);for(d=0;d<this.renderGeometries.length;d++)c=this.renderGeometries[d],this._getRenderGeometryProjectedBoundingRect(c,k,b,l),q.expand(m,k);if(!f)return[3,5];q.center(m,x);p=void 0;a.label=1;case 1:return a.trys.push([1,3,,4]),[4,f.queryElevation(x[0],x[1])];case 2:return p=a.sent(),[3,4];case 3:return a.sent(),p=null,[3,
4];case 4:null!=p&&(m[2]=Math.min(m[2],p),m[5]=Math.max(m[5],p)),a.label=5;case 5:return[2,m]}})})};f.prototype._getRenderGeometryProjectedBoundingRect=function(a,b,d,f){if(this.boundingBox)q.set(p,this.boundingBox);else{var k=a.center;a=a.bsRadius;p[0]=k[0]-a;p[1]=k[1]-a;p[2]=k[2]-a;p[3]=k[0]+a;p[4]=k[1]+a;p[5]=k[2]+a}d(p,0,2);this.calculateRelativeScreenBounds&&f.push({location:q.center(p),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return q.toRect(p,b)};return f}();var k=t.create(),
p=[0,0,0,0,0,0],x=[0,0,0];return w})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("require exports ../../../../geometry/Point ../../lib/glMatrix ../../support/projectionUtils ../../webgl-engine/lib/Util ./Graphics3DSymbolCommonCode ./graphicUtils".split(" "),function(w,l,f,a,d,b,q,t){Object.defineProperty(l,"__esModule",{value:!0});var m=b.VertexAttrConstants;w=a.vec3d;var k=new f,p=w.create(),x=w.create(),z=w.create(),v={verticalDistanceToGround:0,terrainElevation:0};l.perVertexElevationAligner=
function(a,b,d,f){k.spatialReference=d.spatialReference;for(var c=a.getGeometryRecords(),r=c.length,u="absolute-height"!==b.mode,t=0,w=0;w<r;w++){var C=c[w].geometry,E=c[w].getShaderTransformation();x[0]=E[12];x[1]=E[13];x[2]=E[14];C.invalidateBoundingInfo();for(var E=C.getData().getVertexAttr(),J=E[m.POSITION],C=J.data,E=E.mapPos.data,J=J.size,P=C.length/J,O=0,L=0,M=!1,R=0,Q=0;Q<P;Q++){k.x=E[L++];k.y=E[L++];k.z=E[L++];z[0]=C[O];z[1]=C[O+1];z[2]=C[O+2];var T=q.computeElevation(d,k,b,f,u?v:null);u&&
(R+=v.terrainElevation);p[0]=C[O]+x[0];p[1]=C[O+1]+x[1];p[2]=C[O+2]+x[2];f.setAltitude(T,p,0);C[O]=p[0]-x[0];C[O+1]=p[1]-x[1];C[O+2]=p[2]-x[2];T=l.updateThresholdInMeters/f.unitInMeters;if(Math.abs(z[0]-C[O])>=T||Math.abs(z[1]-C[O+1])>=T||Math.abs(z[2]-C[O+2])>=T)M=!0;O+=J}t+=R/P;M&&a.geometryVertexAttrsUpdated(w)}return t/r};l.perObjectElevationAligner=function(a,b,f,k,c){var m=b.centerPointInElevationSR,r=0;c=0;if(a.metadata.usesVerticalDistanceToGround)r=q.computeElevation(f,m,b,k,v),t.updateVertexAttributeAuxpos1w(a,
v.verticalDistanceToGround),c=v.terrainElevation;else{var u="absolute-height"!==b.mode,r=q.computeElevation(f,m,b,k,u?v:null);u&&(c=v.terrainElevation)}b=a.getObjectTransformation();f=[b[12],b[13],b[14]];l.iterativeUpdatesEnabled?k.setAltitudeOfTransformation(r,b):(p[0]=m.x,p[1]=m.y,p[2]=r,d.computeLinearTransformation(m.spatialReference,p,b,k.spatialReference)&&a.setObjectTransformation(b));k=l.updateThresholdInMeters/k.unitInMeters;(Math.abs(b[12]-f[0])>=k||Math.abs(b[13]-f[1])>=k||Math.abs(b[14]-
f[2])>=k)&&a.setObjectTransformation(b);return c};l.updateThresholdInMeters=.01;l.iterativeUpdatesEnabled=!0})},"esri/views/3d/layers/graphics/SignedDistanceFunctions":function(){define(["require","exports","../../support/mathUtils"],function(w,l,f){function a(a){return a-Math.floor(a)}function d(d,k,l){d=f.clamp(d,0,.9999991);var m=a(d*b[0]),p=a(d*b[1]),v=a(d*b[2]);d=a(d*b[3]);k[l+0]=256*(m-m*q[0]);k[l+1]=256*(p-m*q[1]);k[l+2]=256*(v-p*q[2]);k[l+3]=256*(d-v*q[3])}Object.defineProperty(l,"__esModule",
{value:!0});var b=[16777216,65536,256,1],q=[0,1/256,1/256,1/256],t=[1/16777216,1/65536,1/256,1];l.packFloat=d;l.unpackFloat=function(a,b){var d=a[b+1]/256,f=a[b+2]/256,k=a[b+3]/256;a=0+a[b+0]/256*t[0];a+=d*t[1];a+=f*t[2];return a+=k*t[3]};l.computeSignedDistancefieldCicle=function(a,b){var f=new Uint8Array(4*a*a),k=a/2-.5;b/=2;for(var m=0;m<a;m++)for(var l=0;l<a;l++){var r=l+a*m,q=l-k,t=m-k,q=Math.sqrt(q*q+t*t)-b,q=q/a+.5;d(q,f,4*r)}return f};l.computeSignedDistancefieldSquare=function(a,b,f){f&&
(b/=Math.SQRT2);for(var k=new Uint8Array(4*a*a),m=0;m<a;m++)for(var l=0;l<a;l++){var p=l-.5*(a-.5),q=m-.5*(a-.5),t=m*a+l;if(f)var w=(p+q)/Math.SQRT2,q=(q-p)/Math.SQRT2,p=w;p=Math.max(Math.abs(p),Math.abs(q))-.5*b;p=p/a+.5;d(p,k,4*t)}return k};l.computeSignedDistancefieldCrossAndX=function(a,b,f){f&&(b*=Math.SQRT2);b*=.5;for(var k=new Uint8Array(4*a*a),m=0;m<a;m++)for(var l=0;l<a;l++){var p=l-.5*a+0,q=m-.5*a+0,t=m*a+l;if(f)var w=(p+q)/Math.SQRT2,q=(q-p)/Math.SQRT2,p=w;p=Math.abs(p);q=Math.abs(q);w=
void 0;w=p>q?p>b?Math.sqrt((p-b)*(p-b)+q*q):q:q>b?Math.sqrt(p*p+(q-b)*(q-b)):p;w=w/a+.5;d(w,k,4*t)}return k}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define(["require","exports","../../../../renderers/support/utils","../../lib/glMatrix","../graphics/graphicUtils"],function(w,l,f,a,d){function b(a){return null!==a&&void 0!==a}function q(a){return"number"===typeof a}function t(a,b){a&&a.push(b)}function m(a,c,d,m,l){var p=a.minSize,r=a.maxSize;if(a.expression)return t(l,"Could not convert size info: expression not supported"),
!1;if(a.useSymbolValue)return a=m.symbolSize[d],c.minSize[d]=a,c.maxSize[d]=a,c.offset[d]=c.minSize[d],c.factor[d]=0,c.type[d]=1,!0;if(b(a.field)){if(b(a.stops)){if(2===a.stops.length&&q(a.stops[0].size)&&q(a.stops[1].size))return k(a.stops[0].size,a.stops[1].size,a.stops[0].value,a.stops[1].value,c,d),c.type[d]=1,!0;t(l,"Could not convert size info: stops only supported with 2 elements");return!1}if(q(p)&&q(r)&&b(a.minDataValue)&&b(a.maxDataValue))return k(p,r,a.minDataValue,a.maxDataValue,c,d),
c.type[d]=1,!0;if(null!=f.meterIn[a.valueUnit])return c.minSize[d]=-Infinity,c.maxSize[d]=Infinity,c.offset[d]=0,c.factor[d]=1/f.meterIn[a.valueUnit],c.type[d]=1,!0;"unknown"===a.valueUnit?t(l,"Could not convert size info: proportional size not supported"):t(l,"Could not convert size info: scale-dependent size not supported");return!1}if(!b(a.field)){if(a.stops&&a.stops[0]&&q(a.stops[0].size))return c.minSize[d]=a.stops[0].size,c.maxSize[d]=a.stops[0].size,c.offset[d]=c.minSize[d],c.factor[d]=0,c.type[d]=
1,!0;if(q(p))return c.minSize[d]=p,c.maxSize[d]=p,c.offset[d]=p,c.factor[d]=0,c.type[d]=1,!0}t(l,"Could not convert size info: unsupported variant of sizeInfo");return!1}function k(a,b,c,d,f,k){d=0<Math.abs(d-c)?(b-a)/(d-c):0;f.minSize[k]=0<d?a:b;f.maxSize[k]=0<d?b:a;f.offset[k]=a-c*d;f.factor[k]=d}function p(a,b,c,d){if(a.normalizationField||a.valueRepresentation)return t(d,"Could not convert size info: unsupported property"),null;var f=a.field;if(null!=f&&"string"!==typeof f)return t(d,"Could not convert size info: field is not a string"),
null;if(!b.size)b.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!b.size.field)b.size.field=a.field;else if(a.field!==b.size.field)return t(d,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(f=m(a,b.size,0,c,d))?b:null;case "height":return(f=m(a,b.size,2,c,d))?b:null;case "depth":return(f=m(a,b.size,1,c,d))?b:null;case "width-and-depth":return(f=m(a,b.size,0,c,d))&&m(a,b.size,1,c,d),f?
b:null;case null:case void 0:case "all":return(f=(f=(f=m(a,b.size,0,c,d))&&m(a,b.size,1,c,d))&&m(a,b.size,2,c,d))?b:null;default:return t(d,'Could not convert size info: unknown axis "'+a.axis+'""'),null}}function x(a,b,c){for(var d=0;3>d;++d){var f=b.unitInMeters;1===a.type[d]&&(f*=b.modelSize[d],a.type[d]=2);a.minSize[d]/=f;a.maxSize[d]/=f;a.offset[d]/=f;a.factor[d]/=f}if(0!==a.type[0])b=0;else if(0!==a.type[1])b=1;else if(0!==a.type[2])b=2;else return t(c,"No size axis contains a valid size or scale"),
!1;for(d=0;3>d;++d)0===a.type[d]&&(a.minSize[d]=a.minSize[b],a.maxSize[d]=a.maxSize[b],a.offset[d]=a.offset[b],a.factor[d]=a.factor[b],a.type[d]=a.type[b]);return!0}function z(a,b,c){a[4*b+0]=c.r/255;a[4*b+1]=c.g/255;a[4*b+2]=c.b/255;a[4*b+3]=c.a}function v(a,c,d){if(a.normalizationField)return t(d,"Could not convert color info: unsupported property"),null;if("string"===typeof a.field)if(a.stops){if(8<a.stops.length)return t(d,"Could not convert color info: too many color stops"),null;c.color={field:a.field,
values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};a=a.stops;for(d=0;8>d;++d){var f=a[Math.min(d,a.length-1)];c.color.values[d]=f.value;z(c.color.colors,d,f.color)}}else if(a.colors){if(!b(a.minDataValue)||!b(a.maxDataValue))return t(d,"Could not convert color info: missing data values"),null;if(2!==a.colors.length)return t(d,"Could not convert color info: invalid colors array"),null;c.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};c.color.values[0]=a.minDataValue;z(c.color.colors,0,a.colors[0]);c.color.values[1]=a.maxDataValue;z(c.color.colors,1,a.colors[1]);for(d=2;8>d;++d)c.color.values[d]=a.maxDataValue,z(c.color.colors,d,a.colors[1])}else return t(d,"Could not convert color info: missing stops or colors"),null;else if(a.stops&&0<=a.stops.length||a.colors&&0<=a.colors.length)for(a=a.stops&&0<=a.stops.length?a.stops[0].color:a.colors[0],c.color={field:null,values:[0,
0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},d=0;8>d;d++)c.color.values[d]=Infinity,z(c.color.colors,d,a);else return t(d,"Could not convert color info: no field and no colors/stops"),null;return c}function r(a,b,c,d){a=2===c&&"arithmetic"===a.rotationType;b.offset[c]=a?90:0;b.factor[c]=a?-1:1;b.type[c]=1}function u(a,b,c){if("string"!==typeof a.field)return t(c,"Could not convert rotation info: field is not a string"),null;if(!b.rotation)b.rotation={field:a.field,
offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(a.field)if(!b.rotation.field)b.rotation.field=a.field;else if(a.field!==b.rotation.field)return t(c,"Could not convert rotation info: multiple fields in use"),null;switch(a.axis){case "tilt":return r(a,b.rotation,0,c),b;case "roll":return r(a,b.rotation,1,c),b;case null:case void 0:case "heading":return r(a,b.rotation,2,c),b;default:return t(c,'Could not convert rotation info: unknown axis "'+a.axis+'""'),null}}function C(a,b,c){if(!a)return null;
var d=!b.supportedTypes||!!b.supportedTypes.size,f=!b.supportedTypes||!!b.supportedTypes.color,k=!b.supportedTypes||!!b.supportedTypes.rotation;return(a=a.reduce(function(a,m){if(!a)return a;if(m.valueExpression)return t(c,"Could not convert visual variables: arcade expressions not supported"),null;switch(m.type){case "size":return d?p(m,a,b,c):a;case "color":return f?v(m,a,c):a;case "rotation":return k?u(m,a,c):a;default:return t(c,"Could not convert visual variables: unsupported type "+m.type),
null}},{size:null,color:null,rotation:null}))&&a.size&&!x(a.size,b,c)?null:a}function E(a,b,c){if(!!a!==!!b||a&&a.field!==b.field)return!1;if(a&&"rotation"===c)for(c=0;3>c;c++)if(a.type[c]!==b.type[c]||a.offset[c]!==b.offset[c]||a.factor[c]!==b.factor[c])return!1;return!0}function c(a,b){var c={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvSymbolAnchor:null,vvSymbolRotation:null},
d=a&&null!=a.size;a&&a.size?(c.vvSizeEnabled=!0,c.vvSizeMinSize=a.size.minSize,c.vvSizeMaxSize=a.size.maxSize,c.vvSizeOffset=a.size.offset,c.vvSizeFactor=a.size.factor):a&&d&&(c.vvSizeValue=b.transformation.scale);a&&d&&(c.vvSymbolAnchor=b.transformation.anchor,c.vvSymbolRotation=b.transformation.rotation);a&&a.color&&(c.vvColorEnabled=!0,c.vvColorValues=a.color.values,c.vvColorColors=a.color.colors);return c}Object.defineProperty(l,"__esModule",{value:!0});l.convertVisualVariables=C;l.initFastSymbolUpdatesState=
function(a,b,d){return b&&a&&!a.disableFastUpdates?(a=C(a.visualVariables,d))?{enabled:!0,visualVariables:a,materialParameters:c(a,d),customTransformation:a&&null!=a.size}:{enabled:!1}:{enabled:!1}};l.updateFastSymbolUpdatesState=function(a,b,d){if(!b||!a.enabled)return!1;var f=a.visualVariables;b=C(b.visualVariables,d);if(!(b&&E(f.size,b.size,"size")&&E(f.color,b.color,"color")&&E(f.rotation,b.rotation,"rotation")))return!1;a.visualVariables=b;a.materialParameters=c(b,d);a.customTransformation=b&&
null!=b.size;return!0};l.getMaterialParams=c;var D;(function(b){var c=a.mat4d,f=a.vec3,k=c.create(),m=f.create();b.evaluateModelTransform=function(a,b,f){if(!a.vvSizeEnabled)return f;c.identity(k);c.multiply(f,k,k);d.computeObjectRotation(a.vvSymbolRotation[2],a.vvSymbolRotation[0],a.vvSymbolRotation[1],k);if(a.vvSizeEnabled){for(f=0;3>f;++f){var l=a.vvSizeOffset[f]+b[0]*a.vvSizeFactor[f],p=f;var r=a.vvSizeMinSize[f],q=a.vvSizeMaxSize[f],l=l<r?r:l>q?q:l;m[p]=l}c.scale(k,m,k)}else c.scale(k,a.vvSizeValue,
k);c.translate(k,a.vvSymbolAnchor,k);return k}})(D||(D={}));l.evaluateModelTransform=D.evaluateModelTransform})},"esri/symbols/support/symbolUtils":function(){define(["require","exports","../../core/sniff"],function(w,l,f){Object.defineProperty(l,"__esModule",{value:!0});l.isVolumetricSymbol=function(a){return(a=a&&a.symbolLayers)?a.some(function(a){a=a.type;return"object"===a||"path"===a||"extrude"===a}):!1};l.getIconHref=function(d,b){b=b.resource.href;return!f("esri-canvas-svg-support")&&d.styleOrigin&&
a.test(b)?b.replace(a,"/resource/png/$1.png"):b};var a=/\/resource\/(.*?)\.svg$/})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/_base/lang dojo/errors/CancelError ../../../../Color ../../../../core/screenUtils ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./ElevationAligners ./Graphics3DSymbolCommonCode ./graphicUtils ../support/FastSymbolUpdates ./objectResourceUtils ../../lib/glMatrix ../../../../symbols/ObjectSymbol3DLayer ../../support/aaBoundingBox ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/materials/Material".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c,D,B){var I=r.mat4d,G=r.vec3d,H=[1,1,1],K=[1,1,1,1],J=[0,0,0];w=[-.5,-.5,-.5,.5,.5,.5];l=[-.5,-.5,0,.5,.5,1];var P={sphere:w,cube:w,cylinder:l,cone:l,"inverted-cone":l,tetrahedron:[-.5,-.5,0,.5,.5,.5],diamond:w},O=[E.ModelContentType.MATERIAL,E.ModelContentType.TEXTURE,E.ModelContentType.GEOMETRY];return function(l){function r(){return null!==l&&l.apply(this,arguments)||this}f(r,l);r.prototype._prepareResources=function(){var a=this.symbol,b=this._getStageIdHint();
if(!this._isPropertyDriven("size")){var c=x.validateSymbolLayerSize(this.symbol);if(c){this._logWarning(c);this.reject();return}}a.resource&&a.resource.href?this._prepareModelResources(a.resource.href,b):this._preparePrimitiveResources(a.resource?a.resource.primitive:"sphere",b)};r.prototype._preparePrimitiveResources=function(d,f){var k=this.symbol;if("sphere"===d)this._geometryData=D.createPolySphereGeometry(.5,2,!0);else if("cube"===d)this._geometryData=D.createBoxGeometry(1);else if("cylinder"===
d)this._geometryData=D.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);else if("cone"===d)this._geometryData=D.createConeGeometry(1,.5,15,!1),D.cgToGIS(this._geometryData);else if("inverted-cone"===d)this._geometryData=D.createConeGeometry(1,.5,15,!0),D.cgToGIS(this._geometryData);else if("tetrahedron"===d)this._geometryData=D.createTetrahedronGeometry(1),D.cgToGIS(this._geometryData);else if("diamond"===d)this._geometryData=D.createDiamondGeometry(1),D.cgToGIS(this._geometryData);else{this._logWarning("Unknown object symbol primitive: "+
d);this.reject();return}this._geometry=new c(this._geometryData,f);this._context.stage.add(E.ModelContentType.GEOMETRY,this._geometry);this._resourceBoundingBox=P[d];this._resourceSize=C.size(this._resourceBoundingBox);this._symbolSize=x.computeSizeWithResourceSize(this._resourceSize,k);d=this._getMaterialOpacity();d={specular:[0,0,0],shininess:3,opacity:d,transparent:1>d||this._isPropertyDriven("opacity"),instanced:["transformation"],ambient:H,diffuse:H};var m=this.symbolContainer;if("point-3d"===
m.type&&m.verticalOffset){var m=m.verticalOffset,l=m.minWorldLength,p=m.maxWorldLength;d.verticalOffset={screenLength:q.pt2px(m.screenLength),minWorldLength:l||0,maxWorldLength:null!=p?p:Infinity};d.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(d.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._isPropertyDriven("color")?d.externalColor=K:(m=k.material?b.toUnitRGBA(k.material.color):K,d.externalColor=m);k.material&&k.material.colorMixMode&&(d.colorMixMode=
k.material.colorMixMode);this._fastUpdates=z.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(a.mixin(d,this._fastUpdates.materialParameters),d.instanced.push("featureAttribute")):this._hasPerInstanceColor()&&d.instanced.push("color");this._material=new B(d,f+"_objectmat");this._context.stage.add(E.ModelContentType.MATERIAL,this._material);this.resolve()};r.prototype._prepareModelResources=
function(b,c){var f=this,k=["transformation"];c={materialParamsMixin:{instanced:k},idHint:c,streamDataSupplier:this._context.streamDataSupplier};this._fastUpdates=z.initFastSymbolUpdatesState(this._context.renderer,this._supportsShaderVisualVariables(),this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(a.mixin(c.materialParamsMixin,this._fastUpdates.materialParameters),k.push("featureAttribute")):this._hasPerInstanceColor()&&k.push("color");k=this.symbolContainer;if("point-3d"===
k.type&&k.verticalOffset){var k=k.verticalOffset,m=k.minWorldLength,l=k.maxWorldLength;c.materialParamsMixin.verticalOffset={screenLength:q.pt2px(k.screenLength),minWorldLength:m||0,maxWorldLength:null!=l?l:Infinity};c.materialParamsMixin.castShadows=!1}this._symbolLoaderPromise=v.fetch(b,c);this._symbolLoaderPromise.then(function(a){f._symbolLoaderPromise=null;if(!f.isRejected()){var b=f._context,c=a.stageResources,d=b.stage,h=f._getExternalColorParameters(f.symbol.material),k=f._getMaterialOpacity(),
m=f._isPropertyDriven("opacity"),l=c[E.ModelContentType.MATERIAL];a.originalMaterialOpacities=Array(l.length);l.forEach(function(c,d){var e=c.getParameterValues();c.setParameterValues(h);a.originalMaterialOpacities[d]=e.opacity;e.opacity*=k;e.transparent=1>e.opacity;c.setParameterValues({opacity:e.opacity,transparent:e.transparent||m});b.screenSizePerspectiveEnabled&&(e.screenSizePerspective=b.sharedResources.screenSizePerspectiveSettings,c.setParameterValues({screenSizePerspective:e.screenSizePerspective}))});
O.forEach(function(a){for(var b=c[a],e=0;b&&e<b.length;e++)d.add(a,b[e])});f._resourceBoundingBox=v.computeBoundingBox(a);f._resourceSize=C.size(f._resourceBoundingBox);f._pivotOffset=a.pivotOffset;f._symbolSize=x.computeSizeWithResourceSize(f._resourceSize,f.symbol);f._i3sModel=a;z.updateFastSymbolUpdatesState(f._fastUpdates,f._context.renderer,f._fastVisualVariableConvertOptions())&&l.forEach(function(a){return a.setParameterValues(f._fastUpdates.materialParameters)});f.resolve()}},function(a){f._symbolLoaderPromise=
null;if(!f.isFulfilled()){if(!(a instanceof d)){var b="ObjectSymbol3DLayer failed to load";a&&a.message&&(b+=" ("+a.message+")");f._logWarning(b)}f.reject()}})};r.prototype._forEachMaterial=function(a){this._i3sModel?this._i3sModel.stageResources[E.ModelContentType.MATERIAL].forEach(a):a(this._material)};r.prototype._getExternalColorParameters=function(a){var c={};a&&a.colorMixMode&&(c.colorMixMode=a.colorMixMode);this._isPropertyDriven("color")?c.externalColor=K:a&&a.color?c.externalColor=b.toUnitRGBA(a.color):
(c.externalColor=K,c.colorMixMode="ignore");return c};r.prototype.destroy=function(){l.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._symbolLoaderPromise&&this._symbolLoaderPromise.cancel();var a=this._context.stage;if(this._i3sModel){var b=this._i3sModel.stageResources;O.forEach(function(c){for(var d=b[c],f=0;d&&f<d.length;f++)a.remove(c,d[f].getId())})}else this._material&&a.remove(E.ModelContentType.MATERIAL,this._material.getId()),this._geometry&&a.remove(E.ModelContentType.GEOMETRY,
this._geometry.getId())};r.prototype._getGeometry=function(a){a=this._validateGeometry(a.geometry);return"polyline"===a.type?p.placePointOnPolyline(a):"polygon"===a.type?p.placePointOnPolygon(a):"extent"===a.type?a.center:"point"!==a.type?(this._logWarning("unsupported geometry type for object symbol: "+a.type),null):a};r.prototype.createGraphics3DGraphic=function(a,b){var c=this._getGeometry(a);if(null===c)return null;var d="graphic"+a.uid,f=this.getGraphicElevationInfo(a);return this._createAs3DShape(a,
c,b,f,d,a.uid)};r.prototype.layerPropertyChanged=function(a,b,c){var d=this;if("opacity"===a){var f=this._isPropertyDriven("opacity");if(this._i3sModel){var k=this._getMaterialOpacity();this._i3sModel.stageResources[E.ModelContentType.MATERIAL].forEach(function(a,b){b=d._i3sModel.originalMaterialOpacities[b]*k;a.setParameterValues({opacity:b,transparent:1>b||f})})}else b=this._getMaterialOpacity(),this._material.setParameterValues({opacity:b,transparent:1>b||f});return!0}if("elevationInfo"===a){this._updateElevationInfo();
for(var h in b){var e=b[h];if(a=c(e))e=this.getGraphicElevationInfo(e.graphic),a.needsElevationUpdates=p.needsElevationUpdates3D(e.mode),a.elevationInfo.set(e)}return!0}return!1};r.prototype.applyRendererDiff=function(a,b,c,d){var f=this,k;for(k in a.diff)switch(k){case "visualVariables":if(z.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._forEachMaterial(function(a){return a.setParameterValues(f._fastUpdates.materialParameters)});else return!1;break;
default:return!1}return!0};r.prototype._createAs3DShape=function(a,b,c,d,f,l){var h=this,e=null,g=null;if(a=this._getFastUpdateAttrValues(a))e=e||{},e.featureAttribute=a,g=function(a){return z.evaluateModelTransform(h._fastUpdates.materialParameters,e.featureAttribute,a)};!this._fastUpdates.enabled&&this._hasPerInstanceColor()&&(e=e||{},e.color=x.mixinColorAndOpacity(c.color,c.opacity));a=this._context.layer.uid;var n=I.identity();this._applyObjectRotation(c,n);this._applyObjectRotation(this.symbol,
n);this._applyObjectScale(c,n);this._applyAnchor(n);if(this._i3sModel){c=this._i3sModel.stageResources[E.ModelContentType.GEOMETRY];for(var r=this._i3sModel.materialsByComponent,q=Array(c.length),u=0;u<n.length;u++)q[u]=n;f=p.createStageObjectForPoint.call(this,b,c,r,q,e,d,f,a,l,null,g)}else f=p.createStageObjectForPoint.call(this,b,[this._geometry],[[this._material]],[n],e,d,f,a,l,null,g);if(null===f)return null;if(this._fastUpdates.enabled){var v=z.getMaterialParams(this._fastUpdates.visualVariables,
this._fastVisualVariableConvertOptions());this._forEachMaterial(function(a){return a.setParameterValues(v)})}f.object.setCastShadow(!0);l=new m(this,f.object,null,null,null,k.perObjectElevationAligner,d,m.VisibilityModes.REMOVE_OBJECT);l.alignedTerrainElevation=f.terrainElevation;l.needsElevationUpdates=p.needsElevationUpdates3D(d.mode);p.extendPointGraphicElevationInfo(l,b,this._context.elevationProvider);return l};r.prototype._applyObjectScale=function(a,b){this._fastUpdates.enabled&&this._fastUpdates.customTransformation||
(a=this._isPropertyDriven("size")&&a.size?a.size:this._symbolSize,a=x.computeObjectScale(a,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters),1===a[0]&&1===a[1]&&1===a[2]||I.scale(b,a))};r.prototype._applyObjectRotation=function(a,b){if(!(this._fastUpdates.enabled&&this._fastUpdates.customTransformation&&a instanceof u))return x.computeObjectRotation(a.heading,a.tilt,a.roll,b)};r.prototype._computeAnchor=function(){switch(this.symbol.anchor){case "center":return G.scale(C.center(this._resourceBoundingBox),
-1);case "top":var a=C.center(this._resourceBoundingBox);return[-a[0],-a[1],-this._resourceBoundingBox[5]];case "bottom":return a=C.center(this._resourceBoundingBox),[-a[0],-a[1],-this._resourceBoundingBox[2]];default:return this._pivotOffset?G.scale(this._pivotOffset,-1,Array(3)):J}};r.prototype._applyAnchor=function(a){if(!this._fastUpdates.enabled||!this._fastUpdates.customTransformation){var b=this._computeAnchor();b&&I.translate(a,b)}};r.prototype._hasPerInstanceColor=function(){return this._isPropertyDriven("color")||
this._isPropertyDriven("opacity")};r.prototype._supportsShaderVisualVariables=function(){return this._context.stage.has("angleInstancedArrays")?!0:!1};r.prototype._fastVisualVariableConvertOptions=function(){var a=this._resourceBoundingBox?C.size(this._resourceBoundingBox):H,b=this._resourceBoundingBox?this._computeAnchor():J,c=this._context.renderCoordsHelper.unitInMeters,d=x.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,c);return{modelSize:a,symbolSize:this._symbolSize||
H,unitInMeters:c,transformation:{anchor:b,scale:d,rotation:[this.symbol.tilt||0,this.symbol.roll||0,this.symbol.heading||0]}}};r.PRIMITIVE_BOUNDING_BOX=P;return r}(t)})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/_base/lang dojo/Deferred dojo/errors/CancelError ../../../../request ../../../../core/Error ../../../../core/Version ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Util ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/materials/Material ../../webgl-engine/lib/Texture ../../support/aaBoundingBox".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C){function E(a){return new t("","Request for object resource failed: "+a)}function c(b,c){var d=[],f=[],k=[],l=[],q=[],t=m.Version.parse(b.version||"1.0","wosr");I.validate(t);var t="meshsymbol_"+b.model.name,x=b.textureDefinitions,w={},C;for(C in x){var A=x[C],E=A.images[0].data;B(E,"symbol resources must have embedded texture data (at the moment)");var D="/textureDefinitions/"+C,E=new u(A.encoding+";base64,"+E,t,{noUnpackFlip:!0});q.push(E);w[D]={engineTexObj:E,
transparent:"rgba"===A.channels}}C=b.model.geometries;x=b.materialDefinitions;for(A=0;A<C.length;A++){var h=C[A];h.params.components||(D=h,E=D.params,B(E.material),E.components=[{id:1,material:D.params.material,texture:D.params.texture,region:D.params.texture}],E.faces&&(E.faces.componentIndices=[E.faces.position.count]));var D=h.params.components,e=D.length,E=h.params.faces,g=h.params.vertexAttributes,n=h.params.topology||"Indexed",h={},y;for(y in g){var G=g[y],H=G.values;B(G.values,"symbol resources with external geometry bin not yet supported");
h[y]={data:H,size:G.valuesPerElement}}g=void 0;G=Array(e);if("Indexed"===n){var g=E.componentIndices,U;for(U in E);}else"PerAttributeArray"!==n?console.warn("I3S symbol loader: unsupported topology type "+n):1!==e&&console.warn("I3S symbol loader: if topology is not Indexed, only single component geometries are supported");k.push([]);for(e=0;e<D.length;e++){n=D[e];H={type:"triangle",positionKey:"position",indices:{}};if(g)for(var Y in E){if("componentIndices"!==Y){var W=E[Y];B(W.values,"symbol resources with external geometry bin not yet supported");
H.indices[Y]=new Uint32Array(W.values)}}else{for(var W=h.position.data.length/h.position.size,ca=new Uint32Array(W),X=0;X<W;X++)ca[X]=X;var W=ca,aa;for(aa in h)H.indices[aa]=W}G[e]=H;H=void 0;n.texture&&(H=w[n.texture].engineTexObj.getId());W=l[n.material]?l[n.material][n.texture]:null;W||(W=n.material.substring(n.material.lastIndexOf("/")+1),W=x[W].params,1===W.transparency&&(W.transparency=0),H={ambient:W.diffuse,diffuse:W.diffuse,specular:[0,0,0],shininess:0,opacity:1-W.transparency,transparent:0<
W.transparency,textureId:H,doubleSided:!0,cullFace:"none",flipV:!1,colorMixMode:W.externalColorMixMode||"tint"},c.materialParamsMixin&&a.mixin(H,c.materialParamsMixin),W=new r(H,t),l[n.material]||(l[n.material]={}),l[n.material][n.texture]=W,f.push(W));k[A].push(W)}D=new z(new v(G,h),t);d.push(D)}return{stageResources:(da={},da[p.ModelContentType.TEXTURE]=q,da[p.ModelContentType.MATERIAL]=f,da[p.ModelContentType.GEOMETRY]=d,da),materialsByComponent:k,pivotOffset:b.model.pivotOffset};var da}Object.defineProperty(l,
"__esModule",{value:!0});var D=k.vec3d,B=x.assert,I=new m.Version(1,1,"wosr");l.fetch=function(a,f){f=f||{};var k=f.streamDataSupplier;if(k){var m=k.request(a,"json"),l=new d(function(){return k.cancelRequest(m)});m.then(function(a,b){try{var d=c(b,f);return l.resolve(d)}catch(T){return l.reject(T)}},function(a){l.reject(a instanceof b?a:E(a))});return l.promise}var p=q(a),r=new d(function(){return p.cancel()});p.then(function(a){try{var b=c(a.data,f);return r.resolve(b)}catch(Q){return r.reject(Q)}},
function(c){r.reject(c instanceof b?c:E(a))});return r.promise};l.computeBoundingBox=function(a){a=a.stageResources[p.ModelContentType.GEOMETRY];for(var b=C.create(C.NEGATIVE_INFINITY),c=[0,0,0],d=[0,0,0],f=0;f<a.length;f++)for(var k=a[f],m=k.getNumGroups(),l=0;l<m;++l){var r=k.getBoundingInfo(l);D.set(r.getBBMin(),c);D.set(r.getBBMax(),d);for(r=0;3>r;++r)b[r]=Math.min(b[r],c[r]),b[r+3]=Math.max(b[r+3],d[r])}return b};l.createStageResources=c})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./Graphics3DDrapedGraphicLayer ./ElevationAligners ./Graphics3DSymbolCommonCode ./lineUtils ../../../../core/screenUtils ../../../../geometry/Polygon ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/RenderGeometry ./graphicUtils".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C){var E=x.vec3d,c=x.mat4d;return function(a){function l(){return null!==a&&a.apply(this,arguments)||this}f(l,a);l.prototype._prepareResources=function(){var a=this.symbol,b=this._isPropertyDriven("size")||this._isPropertyDriven("color")||this._isPropertyDriven("opacity"),a={idHint:this._getStageIdHint(),width:this._getWidth(a),color:this._getMaterialOpacityAndColor()};if(!this._isPropertyDriven("size")){var c=C.validateSymbolLayerSize(a.width);if(c){this._logWarning(c);
this.reject();return}}if(b||1.5<=a.width)this._isPropertyDriven("size")&&(a.width=0),this._isNativeLineMaterial=!1,this._material=m.createRibbonMaterial(a);else if(0<a.width)this._isNativeLineMaterial=!0,this._material=m.createNativeMaterial(a);else{this.reject();return}this._context.stage.add(z.ModelContentType.MATERIAL,this._material);this.resolve()};l.prototype._getWidth=function(a){return null!=a.size?k.pt2px(a.size):1};l.prototype.destroy=function(){a.prototype.destroy.call(this);this.isFulfilled()||
this.reject();this._material&&(this._context.stage.remove(z.ModelContentType.MATERIAL,this._material.getId()),this._material=null)};l.prototype.createGraphics3DGraphic=function(a,b){var c=this._validateGeometry(a.geometry);if("polyline"!==c.type&&"polygon"!==c.type&&"extent"!==c.type)return this._logWarning("unsupported geometry type for line symbol: "+c.type),null;var c="polygon"===c.type||"extent"===c.type?"rings":"paths",d="graphic"+a.uid,f=this._getVertexOpacityAndColor(b,Float32Array,255),m=
0;b.size&&this._isPropertyDriven("size")&&(m=t.getSingleSizeDriver(b.size),m=k.pt2px(m));b=this.getGraphicElevationInfo(a);return"on-the-ground"===b.mode?this._createAsOverlay(a,c,f,m,b,d):this._createAs3DShape(a,c,f,m,b,d,a.uid)};l.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)return this._isNativeLineMaterial?(b=this._material.getColor(),b[3]=this._getMaterialOpacity(),this._material.setColor(b)):(b=this._material.getParameterValues(),b.color[3]=this._getMaterialOpacity(),this._material.setParameterValues({color:b.color})),
!0;if("elevationInfo"===a){a=this._elevationInfo.mode;this._updateElevationInfo();var d=this._elevationInfo.mode;if(null==a||null==d)return!1;if("on-the-ground"===a&&"on-the-ground"===d)return!0;if(a!==d&&("on-the-ground"===a||"on-the-ground"===d))return!1;a=t.needsElevationUpdates2D(d);for(var f in b){var k=b[f];(d=c(k))&&!d.isDraped()&&(k=k.graphic,d.needsElevationUpdates=a,d.elevationInfo.set(this.getGraphicElevationInfo(k)))}return!0}return!1};l.prototype._getOutlineGeometry=function(a,b){return b};
l.prototype._getGeometry=function(a){a=this._validateGeometry(a.geometry);"extent"===a.type&&(a=p.fromExtent(a));return a};l.prototype._createAs3DShape=function(a,b,f,k,l,p,u){var x=this._getGeometry(a),w=x.hasZ,z=x[b],C=this._getOutlineGeometry(x,z);a=[];var B=[],A=[],D=E.create(),H=Array(6),x=t.getGeometryVertexData3D(C,w,x.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,l);this._logGeometryCreationWarnings(x,z,b,"LineSymbol3DLayer");
if(0<C.length){for(var z=x.geometryData.outlines,C=x.eleVertexData,w=x.vertexData,h=0;h<z.length;++h){var e=z[h],g=e.index,n=e.count;if(this._context.clippingExtent&&(t.computeBoundingBox(C,g,n,H),t.boundingBoxClipped(H,this._context.clippingExtent)))continue;t.chooseOrigin(w,g,n,D);t.subtractCoordinates(w,g,n,D);e=new Float64Array(C.buffer,3*g*C.BYTES_PER_ELEMENT,3*n);g=new Float64Array(w.buffer,3*g*w.BYTES_PER_ELEMENT,3*n);g=m.createPolylineGeometry(g,e,"rings"===b,f,k);g=new r(g,p+"path"+h);g.singleUse=
!0;a.push(g);B.push([this._material]);g=c.identity();c.translate(g,D,g);A.push(g)}if(0<a.length)return b=new v({geometries:a,materials:B,transformations:A,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicId:u},idHint:p}),b=new d(this,b,a,null,null,q.perVertexElevationAligner,l),b.alignedTerrainElevation=x.terrainElevation,b.needsElevationUpdates=t.needsElevationUpdates2D(l.mode),b}return null};l.prototype._createAsOverlay=function(a,d,f,k,l,p){var r=this._getGeometry(a);this._material.setRenderPriority(this._symbolLayerOrder);
var q=r[d],v=this._getOutlineGeometry(r,q);a=[];var x=Array(6),w=E.create(),r=t.getGeometryVertexDataDraped(v,r.spatialReference,this._context.overlaySR);this._logGeometryCreationWarnings(r,q,d,"LineSymbol3DLayer");if(0<v.length){q=r.vertexData;v=r.geometryData.outlines;for(r=0;r<v.length;++r){var z=v[r],C=z.index,z=z.count;t.computeBoundingBox(q,C,z,x);if(!t.boundingBoxClipped(x,this._context.clippingExtent)){t.chooseOrigin(q,C,z,w);t.subtractCoordinates(q,C,z,w);t.setZ(q,C,z,this._getDrapedZ());
z=new Float64Array(q.buffer,3*C*q.BYTES_PER_ELEMENT,3*z);C=c.identity();c.translate(C,w,C);var z=m.createPolylineGeometry(z,null,"rings"===d,f,k),B=new u(z);B.material=this._material;B.center=[.5*(x[0]+x[3]),.5*(x[1]+x[4]),0];B.bsRadius=.5*Math.sqrt((x[3]-x[0])*(x[3]-x[0])+(x[4]-x[1])*(x[4]-x[1]));B.transformation=C;B.name=p;B.uniqueName=p+"#"+z.id;a.push(B)}}return new b(this,a,null,null,x,l)}return null};return l}(a)})},"esri/views/3d/layers/graphics/lineUtils":function(){define("require exports ../../webgl-engine/materials/RibbonLineMaterial ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util".split(" "),
function(w,l,f,a,d,b){function q(a){var b=a.length;return a[0]===a[b-3]&&a[1]===a[b-2]&&a[2]===a[b-1]}Object.defineProperty(l,"__esModule",{value:!0});var t=b.VertexAttrConstants;l.createRibbonMaterial=function(a){var b={width:a.width,color:a.color,miterLimit:a.miterLimit,polygonOffset:!0};"miter"===a.join||"bevel"===a.join?b.join=a.join:(b.join="miter",a.join&&console.warn("unsupported join type for line symbol: "+a.join));return new f(b,a.idHint+"_ribbonlinemat")};l.createNativeMaterial=function(b){return new a(b.width,
b.color,b.idHint+"_nativelinemat")};l.isClosed=q;l.createPolylineGeometry=function(a,b,f,l,w){var k,m,p;if(f=f&&!q(a)){f=new Float32Array(a.length+3);for(m=0;m<a.length;m++)f[m]=a[m];m=f.length;f[m-3]=a[0];f[m-2]=a[1];f[m-1]=a[2];k=a.length/3+1;m=new Uint32Array(2*(k-1));p=new Uint32Array(2*(k-1))}else k=a.length/3,m=new Uint32Array(2*(k-1)),p=new Uint32Array(2*(k-1)),f=a;a=new Float32Array(1);a[0]=w;for(var x=w=0,z=0;z<k-1;z++)m[w++]=z,m[w++]=z+1,p[x++]=0,p[x++]=0;w={};k={};w[t.POSITION]=m;w[t.COLOR]=
p;w[t.SIZE]=p;k[t.POSITION]={size:3,data:f};k[t.COLOR]={size:4,data:l};k[t.SIZE]={size:1,data:a};b&&(w.mapPos=m,k.mapPos={size:3,data:b});return new d(k,w,d.DefaultOffsets,"line")}})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("./internal/MaterialUtil ../lib/Util ../lib/gl-matrix ../lib/RenderSlot ../lib/DefaultVertexBufferLayouts ../lib/ComponentUtils ../../../webgl/Util".split(" "),function(w,l,f,a,d,b,q){var t=f.vec3d,m=f.vec2d,k=f.mat4d,p=l.VertexAttrConstants,
x=t.create(),z=t.create(),v=t.create(),r=t.create(),u=m.create(),C=m.create(),E=t.create(),c=t.create(),D=function(a,f,m,J){"string"===typeof m&&(J=m,m=void 0);w.basicMaterialConstructor(this,J);this.lineType=m||D.LINES;var H=d.Pos3,G=q.getStride(H)/4;this.canBeMerged=this.lineType===D.LINES;this.setColor=function(a){f=a;this.notifyDirty("matChanged")};this.getColor=function(){return f};this.dispose=function(){};this.getOutputAmount=function(a){a=a/2+1;if(this.lineType===D.STRIP)return a*G;if(this.lineType===
D.LINES)return(2*a-2)*G};this.getVertexBufferLayout=function(){return H};this.fillInterleaved=function(a,b,c,d,f,k){a=a.vertexAttr[p.POSITION].data;if(b||this.lineType===D.LINES)for(d=a.length/3,c=0;c<d;c++){var m=3*c,l=a[m],h=a[m+1],e=a[m+2];if(b)var m=l,g=h,l=b[0]*m+b[4]*g+b[8]*e+b[12],h=b[1]*m+b[5]*g+b[9]*e+b[13],e=b[2]*m+b[6]*g+b[10]*e+b[14];f[k++]=l;f[k++]=h;f[k++]=e;this.lineType===D.LINES&&0!==c&&c!==d-1&&(f[k++]=l,f[k++]=h,f[k++]=e)}else for(c=0;c<a.length;c++)f[k++]=a[c]};this.intersect=
function(a,d,f,m,p,q,w){if(m.isSelection&&!b.isAllHidden(d.componentVisibilities,a.data.componentOffsets)){d=a.getData().getVertexAttr("position").position.data;a=Number.MAX_VALUE;var B,h;p=m.camera;q=m.point;for(var e=0;e<d.length-5;e+=3){x[0]=d[e];x[1]=d[e+1];x[2]=d[e+2];k.multiplyVec3(f,x);z[0]=d[e+3];z[1]=d[e+4];z[2]=d[e+5];k.multiplyVec3(f,z);p.projectPoint(x,u);p.projectPoint(z,C);if(0>u[2]&&0<C[2])t.subtract(x,z,v),B=p.frustumPlanes,h=-(t.dot(B[4],x)+B[4][3]),B=h/t.dot(v,B[4]),t.scale(v,B,
v),t.add(x,v,x),p.projectPoint(x,u);else if(0<u[2]&&0>C[2])t.subtract(z,x,v),B=p.frustumPlanes,h=-(t.dot(B[4],z)+B[4][3]),B=h/t.dot(v,B[4]),t.scale(v,B,v),t.add(z,v,z),p.projectPoint(z,C);else if(0>u[2]&&0>C[2])continue;B=l.pointLineSegmentDistance2D(u,C,q);B<a&&(a=B,t.set(x,E),t.set(z,c))}f=m.p0;m=m.p1;2>a&&(a=l.lineSegmentLineSegmentDistance3D(E,c,f,m),d=Number.MAX_VALUE,a[0]&&(t.subtract(a[2],f,r),a=t.length(r),t.scale(r,1/a),d=a/t.dist(f,m)),w(d,r))}};this.getGLMaterials=function(){return{color:B,
depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:I}};this.getAllTextureIds=function(){return[]}};D.STRIP=1;D.LINES=2;var B=function(b,c){w.basicGLMaterialConstructor(this,b);var d=c.get("simple"),f=b.getColor();this.beginSlot=function(b){return b===a.OPAQUE_MATERIAL};this.getProgram=function(){return d};this.bind=function(a,b){a.bindProgram(d);d.setUniform4fv("color",f);a.setBlendingEnabled(1>f[3]);a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA);
a.setDepthTestEnabled(!0)};this.release=function(a){1>f[3]&&a.setBlendingEnabled(!1)};this.bindView=function(a,b){w.bindView(b.origin,b.view,d)};this.bindInstance=function(a,b){d.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){a=a.gl;return b.lineType===D.STRIP?a.LINE_STRIP:a.LINES}},I=function(b,c){w.basicGLMaterialConstructor(this,b);var d=c.get("highlight");this.beginSlot=function(b){return b===a.OPAQUE_MATERIAL};this.getProgram=function(){return d};this.bind=function(a,
b){a.bindProgram(d);a.setDepthTestEnabled(!0)};this.release=function(a){};this.bindView=function(a,b){w.bindView(b.origin,b.view,d)};this.bindInstance=function(a,b){d.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(a){a=a.gl;return b.lineType===D.STRIP?a.LINE_STRIP:a.LINES}};return D})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./Graphics3DSymbolCommonCode ../../../../geometry/Point ../../support/projectionUtils ../../../../views/3d/lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/materials/Material ../../webgl-engine/lib/Util ./graphicUtils".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u){function C(a,c,d,f){for(var k=a.getGeometryRecords(),m=k.length,l="absolute-height"!==c.mode,p=0,r=0;r<m;r++){var q=k[r].geometry,u=[k[r].transformation[12],k[r].transformation[13],k[r].transformation[14]],h=q.getData().getVertexAttr(),e=h[B.POSITION].data,g=h.zOffset.data,h=h.mapPos.data,n=h.length/3;D(e.length/3===n*K+2,"unexpected tube geometry");var v=0,t=0;G.spatialReference=d.spatialReference;for(var x=0,w=0;w<n;w++){G.x=h[3*w];G.y=h[3*w+1];G.z=h[3*
w+2];var z=b.computeElevation(d,G,c,f,l?H:null);l&&(x+=H.terrainElevation);var C=K;0!==w&&w!==n-1||C++;for(var E=0;E<C;E++)I[0]=e[v]+u[0],I[1]=e[v+1]+u[1],I[2]=e[v+2]+u[2],f.setAltitude(z+g[t],I,0),e[v]=I[0]-u[0],e[v+1]=I[1]-u[1],e[v+2]=I[2]-u[2],v+=3,t+=1;q.invalidateBoundingInfo()}a.geometryVertexAttrsUpdated(r);p+=x/n}return p/m}var E=m.vec3d,c=m.mat4d,D=r.assert;w=function(a){function m(){return null!==a&&a.apply(this,arguments)||this}f(m,a);m.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=
u.validateSymbolLayerSize(this._getSymbolSize());if(a){this._logWarning(a);this.reject();return}}var a=this._getStageIdHint(),b=this._getMaterialOpacityAndColor(),c=E.create(b),b=b[3],c={diffuse:c,ambient:c,opacity:b,transparent:1>b||this._isPropertyDriven("opacity"),vertexColors:this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};this._material=new v(c,a+"_3dlinemat");this._context.stage.add(k.ModelContentType.MATERIAL,this._material);this.resolve()};m.prototype.destroy=function(){a.prototype.destroy.call(this);
this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(k.ModelContentType.MATERIAL,this._material.getId()),this._material=null)};m.prototype.createGraphics3DGraphic=function(a,b){var c=this._validateGeometry(a.geometry);if("polyline"!==c.type)return this._logWarning("unsupported geometry type for path symbol: "+c.type),null;var c="graphic"+a.uid,d=this.getGraphicElevationInfo(a);return this._createAs3DShape(a,b,d,c,a.uid)};m.prototype.layerPropertyChanged=function(a,c,d){if("opacity"===
a)return c=this._getMaterialOpacity(),d=1>c||this._isPropertyDriven("opacity"),this._material.setParameterValues({opacity:c,transparent:d}),!0;if("elevationInfo"===a){this._updateElevationInfo();for(var f in c){var k=c[f];if(a=d(k))k=this.getGraphicElevationInfo(k.graphic),a.needsElevationUpdates=b.needsElevationUpdates3D(k.mode),a.elevationInfo.set(k)}return!0}return!1};m.prototype._getPathSize=function(a){a=a.size&&this._isPropertyDriven("size")?b.getSingleSizeDriver(a.size):this._getSymbolSize();
return a/=this._context.renderCoordsHelper.unitInMeters};m.prototype._getSymbolSize=function(){return this.symbol.size||1};m.prototype._createAs3DShape=function(a,f,k,m,l){var r=a.geometry,q=r.hasZ,u=r.paths;a=[];var v=[],h=[],e=E.create(),g=this._context.renderSpatialReference===t.SphericalRenderSpatialReference,n=Array(6),w=this._getPathSize(f),r=b.getGeometryVertexData3D(u,q,r.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,
k);this._logGeometryCreationWarnings(r,u,"paths","PathSymbol3DLayer");if(0<u.length){for(var u=r.geometryData.outlines,q=r.eleVertexData,B=r.vertexData,D=0;D<u.length;++D){var H=u[D],G=H.index,I=H.count;if(this._context.clippingExtent&&(b.computeBoundingBox(q,G,I,n),b.boundingBoxClipped(n,this._context.clippingExtent)))continue;b.chooseOrigin(B,G,I,e);b.subtractCoordinates(B,G,I,e);H=new Float64Array(q.buffer,3*G*q.BYTES_PER_ELEMENT,3*I);G=b.flatArrayToArrayOfArrays(B,G,I);G=z.createTubeGeometry(G,
.5*w,K,g,e);G.getVertexAttr().mapPos={size:3,data:H};this._material.getParams().vertexColors&&(H=this._getVertexOpacityAndColor(f),G=z.addVertexColors(G,H,!0));H=new x(G,m+"path"+D);H.singleUse=!0;a.push(H);v.push([this._material]);H=c.identity();c.translate(H,e,H);h.push(H)}if(0<a.length)return f=new p({geometries:a,materials:v,transformations:h,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicId:l},idHint:m}),f=new d(this,f,a,null,null,C,k),f.alignedTerrainElevation=r.terrainElevation,
f.needsElevationUpdates=b.needsElevationUpdates3D(k.mode),f}return null};return m}(a);var B=r.VertexAttrConstants,I=E.create(),G=new q,H={verticalDistanceToGround:0,terrainElevation:0},K=10;return w})},"esri/views/3d/layers/graphics/Graphics3DFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./Graphics3DDrapedGraphicLayer ./ElevationAligners ./Graphics3DSymbolCommonCode ./lineUtils ./graphicUtils ../../../../geometry/Polygon ../../../../Color ../../lib/glMatrix ../../support/aaBoundingBox ../../webgl-engine/Stage ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/lib/Util ./earcut/earcut".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c,D,B,I,G){var H=I.VertexAttrConstants;w=v.vec3d;var K=v.mat4d;d=function(d){function l(){var a=null!==d&&d.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};return a}f(l,d);l.prototype._prepareResources=function(){this._prepareFillResources();this._prepareOutlineResources();this.resolve()};l.prototype._prepareFillResources=function(){var a=this._getStageIdHint(),b=this._getMaterialOpacityAndColor(),b=
{color:b,transparent:1>b[3]||this._isPropertyDriven("opacity"),polygonOffset:!1,vertexColors:!0};this._material=new B(b,a+"_colormat");this._context.stage.add(u.ModelContentType.MATERIAL,this._material)};l.prototype._prepareOutlineResources=function(){var b=this.symbol.outline;if(this._hasOutline=!!(b&&b.size&&0<b.size&&b.color))b={idHint:this._getStageIdHint()+"_outline",color:this._getOutlineColor(),width:a.pt2px(b.size)},2<b.width?(this._outlineMaterial=k.createRibbonMaterial(b),this._isOutlineNativeLineMaterial=
!1):(this._outlineMaterial=k.createNativeMaterial(b),this._isOutlineNativeLineMaterial=!0),this._context.stage.add(u.ModelContentType.MATERIAL,this._outlineMaterial)};l.prototype.destroy=function(){d.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(u.ModelContentType.MATERIAL,this._material.getId()),this._material=null);this._outlineMaterial&&(this._context.stage.remove(u.ModelContentType.MATERIAL,this._outlineMaterial.getId()),this._outlineMaterial=
null)};l.prototype.createGraphics3DGraphic=function(a,b){var c=this._validateGeometry(a.geometry);if("polyline"!==c.type&&"polygon"!==c.type&&"extent"!==c.type)return this._logWarning("unsupported geometry type for fill symbol: "+c.type),null;c="graphic"+a.uid;b=this._getVertexOpacityAndColor(b,Uint8Array,255);var d=this.getGraphicElevationInfo(a);return"on-the-ground"===d.mode?this._createAsOverlay(a,b,d,c):this._createAs3DShape(a,b,d,c,a.uid)};l.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===
a)return b=this._material.getColor(),b[3]=this._getMaterialOpacity(),this._material.setColor(b),this._material.setTransparent(1>b[3]),this._outlineMaterial&&(this._isOutlineNativeLineMaterial?(b=this._outlineMaterial.getColor(),b[3]=this._getOutlineOpacity(),this._outlineMaterial.setColor(b)):(b=this._outlineMaterial.getParameterValues(),b.color[3]=this._getOutlineOpacity(),this._outlineMaterial.setParameterValues({color:b.color}))),!0;if("elevationInfo"===a){a=this._elevationInfo.mode;this._updateElevationInfo();
var d=this._elevationInfo.mode;if(null==a||null==d)return!1;if("on-the-ground"===a&&"on-the-ground"===d)return!0;if(a!==d&&("on-the-ground"===a||"on-the-ground"===d))return!1;a=m.needsElevationUpdates2D(d);for(var f in b){var h=b[f];(d=c(h))&&!d.isDraped()&&(h=h.graphic,d.needsElevationUpdates=a,d.elevationInfo.set(this.getGraphicElevationInfo(h)))}return!0}return!1};l.prototype.setDrawOrder=function(a,b,c){this._material&&(this._material.setRenderPriority(a+b/2),c[this._material.getId()]=!0);this._outlineMaterial&&
(this._outlineMaterial.setRenderPriority(a),c[this._outlineMaterial.getId()]=!0)};l.prototype._createAs3DShape=function(a,c,d,f,k){var h=this._getPolyGeometry(a),e=h.hasZ;a=h.rings;var g=this._getOutlineGeometry(h,a),h=m.getGeometryVertexData3D(g,e,h.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,d);L.idHint=f;L.color=c;L.data=h;var l;this._hasOutline&&(l=new h.vertexData.constructor(h.vertexData));L.outNum=0;L.outGeometries=
[];L.outTransforms=[];L.outMaterials=[];this._createAs3DShapeFill(L);L.data.vertexData=l;this._createAs3DShapeOutline(L);this._logGeometryCreationWarnings(L.data,a,"rings","FillSymbol3DLayer");if(0===L.outNum)return null;c=new C({geometries:L.outGeometries,materials:L.outMaterials,transformations:L.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicId:k},idHint:f});c=new b(this,c,L.outGeometries,null,null,t.perVertexElevationAligner,d);c.alignedTerrainElevation=h.terrainElevation;
c.needsElevationUpdates=m.needsElevationUpdates2D(d.mode);return c};l.prototype._createAs3DShapeFill=function(a){for(var b=a.data.geometryData.polygons,c=a.data.eleVertexData,d=a.data.vertexData,f=function(e){var f=b[e];e=f.count;var g=f.index;if(h._context.clippingExtent&&(m.computeBoundingBox(c,g,e,J),m.boundingBoxClipped(J,h._context.clippingExtent)))return"continue";var k=new Float64Array(c.buffer,3*g*c.BYTES_PER_ELEMENT,3*e),l=new Float64Array(d.buffer,3*g*d.BYTES_PER_ELEMENT,3*e),f=f.holeIndices.map(function(a){return a-
g}),f=G(k,f,3);if(0===f.length)return"continue";m.chooseOrigin(d,g,e,P);m.subtractCoordinates(d,g,e,P);e=h._createFillGeometry(f,0,l,k,a.color);e=new E(e,a.idHint);e.singleUse=!0;k=K.identity();K.translate(k,P,k);a.outGeometries.push(e);a.outMaterials.push([h._material]);a.outTransforms.push(k);a.outNum++},h=this,e=0;e<b.length;++e)f(e)};l.prototype._createAs3DShapeOutline=function(a){if(this._hasOutline)for(var b=a.data.geometryData.outlines,c=a.data.eleVertexData,d=a.data.vertexData,f=0;f<b.length;++f){var h=
b[f],e=h.index,g=h.count;if(this._context.clippingExtent&&(m.computeBoundingBox(c,e,g,J),m.boundingBoxClipped(J,this._context.clippingExtent)))continue;m.chooseOrigin(d,e,g,P);m.subtractCoordinates(d,e,g,P);h=new Float64Array(c.buffer,3*e*c.BYTES_PER_ELEMENT,3*g);e=new Float64Array(d.buffer,3*e*d.BYTES_PER_ELEMENT,3*g);e=k.createPolylineGeometry(e,h,a.isRings,O,0);e=new E(e,a.idHint+"outline"+f);e.singleUse=!0;h=K.identity();K.translate(h,P,h);a.outGeometries.push(e);a.outMaterials.push([this._outlineMaterial]);
a.outTransforms.push(h);a.outNum++}};l.prototype._createAsOverlay=function(a,b,c,d){var f=this._getPolyGeometry(a);a=f.rings;var h=this._getOutlineGeometry(f,a);this._material.setRenderPriority(this._symbolLayerOrder+this._symbolLayerOrderDelta/2);this._hasOutline&&this._outlineMaterial.setRenderPriority(this._symbolLayerOrder);f=m.getGeometryVertexDataDraped(h,f.spatialReference,this._context.overlaySR);L.idHint=d;L.color=b;L.data=f;var e;this._hasOutline&&(e=new f.vertexData.constructor(f.vertexData));
L.outNum=0;L.outGeometries=[];L.outBoundingBox=r.create(r.NEGATIVE_INFINITY);this._createAsOverlayFill(L);L.data.vertexData=e;this._createAsOverlayOutline(L);this._logGeometryCreationWarnings(L.data,a,"rings","FillSymbol3DLayer");return 0<L.outNum?new q(this,L.outGeometries,null,null,L.outBoundingBox,c):null};l.prototype._createAsOverlayFill=function(a){for(var b=a.data.vertexData,c=a.data.geometryData.polygons,d=function(d){var e=c[d];d=e.count;var h=e.index,k=new Float64Array(b.buffer,3*h*b.BYTES_PER_ELEMENT,
3*d),e=e.holeIndices.map(function(a){return a-h}),k=G(k,e,3);if(0===k.length)return"continue";m.computeBoundingBox(b,h,d,J);if(m.boundingBoxClipped(J,f._context.clippingExtent))return"continue";r.expand(a.outBoundingBox,J);m.chooseOrigin(b,h,d,P);m.subtractCoordinates(b,h,d,P);m.setZ(b,h,d,f._getDrapedZ());d=K.identity();K.translate(d,P,d);k=f._createFillGeometry(k,h,b,null,a.color);e=new D(k);e.material=f._material;var l=J;e.center=[.5*(l[0]+l[3]),.5*(l[1]+l[4]),0];e.bsRadius=.5*Math.sqrt((l[3]-
l[0])*(l[3]-l[0])+(l[4]-l[1])*(l[4]-l[1]));e.transformation=d;e.name=a.idHint;e.uniqueName=a.idHint+"#"+k.id;a.outGeometries.push(e);a.outNum++},f=this,h=0;h<c.length;++h)d(h)};l.prototype._createAsOverlayOutline=function(a){if(this._hasOutline)for(var b=a.data.vertexData,c=a.data.geometryData.outlines,d=0;d<c.length;++d){var f=c[d],h=f.index,f=f.count;m.computeBoundingBox(b,h,f,J);if(!m.boundingBoxClipped(J,this._context.clippingExtent)){r.expand(a.outBoundingBox,J);m.chooseOrigin(b,h,f,P);m.subtractCoordinates(b,
h,f,P);m.setZ(b,h,f,this._getDrapedZ());f=new Float64Array(b.buffer,3*h*b.BYTES_PER_ELEMENT,3*f);h=K.identity();K.translate(h,P,h);var f=k.createPolylineGeometry(f,null,!0,O,0),e=new D(f);e.material=this._outlineMaterial;var g=J;e.center=[.5*(g[0]+g[3]),.5*(g[1]+g[4]),0];e.bsRadius=.5*Math.sqrt((g[3]-g[0])*(g[3]-g[0])+(g[4]-g[1])*(g[4]-g[1]));e.transformation=h;e.name=a.idHint+"outline";e.uniqueName=a.idHint+"outline#"+f.id;a.outGeometries.push(e);a.outNum++}}};l.prototype._getOutlineGeometry=function(a,
b){return b};l.prototype._getOutlineOpacity=function(){return this._getLayerOpacity()*this.symbol.outline.color.a};l.prototype._getOutlineColor=function(){var a=this.symbol.outline.color,b=this._getOutlineOpacity();return p.mixinColorAndOpacity(z.toUnitRGB(a),b)};l.prototype._getPolyGeometry=function(a){a=a.geometry;return"extent"===a.type?x.fromExtent(a):a};l.prototype._createFillGeometry=function(a,b,d,f,k){for(var h=a.length,e=new Uint32Array(h),g=new Uint32Array(h),m=0;m<h;m++)e[m]=a[m]+b,g[m]=
0;a={};b={};a[H.POSITION]=e;a[H.COLOR]=g;b[H.POSITION]={size:3,data:d};b[H.COLOR]={size:4,data:k};f&&(b.mapPos={size:3,data:f},a.mapPos=e);return new c(b,a)};return l}(d);var J=r.create(),P=w.create(),O=new Float32Array([255,255,255,255]),L={idHint:null,color:null,data:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};return d})},"esri/views/3d/layers/graphics/earcut/earcut":function(){define([],function(){function w(c,k,m){m=m||2;var p=k&&k.length,r=p?k[0]*
m:c.length,q=l(c,0,r,m,!0),u=[];if(!q)return u;var x,w,z,C;if(p){var B=m,p=[],E,D,T;C=0;for(E=k.length;C<E;C++)D=k[C]*B,T=C<E-1?k[C+1]*B:c.length,D=l(c,D,T,B,!1),D===D.next&&(D.steiner=!0),p.push(t(D));p.sort(d);for(C=0;C<p.length;C++){k=p[C];B=q;if(B=b(k,B))k=v(B,k),f(k,k.next);q=f(q,q.next)}}if(c.length>80*m){x=z=c[0];w=p=c[1];for(B=m;B<r;B+=m)C=c[B],k=c[B+1],C<x&&(x=C),k<w&&(w=k),C>z&&(z=C),k>p&&(p=k);z=Math.max(z-x,p-w)}a(q,u,m,x,w,z);return u}function l(a,b,d,f,k){var c;if(k===0<E(a,b,d,f))for(k=
b;k<d;k+=f)c=r(k,a[k],a[k+1],c);else for(k=d-f;k>=b;k-=f)c=r(k,a[k],a[k+1],c);c&&p(c,c.next)&&(u(c),c=c.next);return c}function f(a,b){if(!a)return a;b||(b=a);var c;do if(c=!1,a.steiner||!p(a,a.next)&&0!==k(a.prev,a,a.next))a=a.next;else{u(a);a=b=a.prev;if(a===a.next)return null;c=!0}while(c||a!==b);return b}function a(b,d,l,r,t,w,C){if(b){if(!C&&w){var c=b,B=c;do null===B.z&&(B.z=q(B.x,B.y,r,t,w)),B.prevZ=B.prev,B=B.nextZ=B.next;while(B!==c);B.prevZ.nextZ=null;B.prevZ=null;var c=B,E,D,H,G,I,K,A=
1;do{B=c;H=c=null;for(G=0;B;){G++;D=B;for(E=I=0;E<A&&(I++,D=D.nextZ,D);E++);for(K=A;0<I||0<K&&D;)0===I?(E=D,D=D.nextZ,K--):0!==K&&D?B.z<=D.z?(E=B,B=B.nextZ,I--):(E=D,D=D.nextZ,K--):(E=B,B=B.nextZ,I--),H?H.nextZ=E:c=E,E.prevZ=H,H=E;B=D}H.nextZ=null;A*=2}while(1<G)}for(c=b;b.prev!==b.next;){B=b.prev;D=b.next;if(w)a:{H=b;K=r;var V=t,S=w;G=H.prev;I=H;A=H.next;if(0<=k(G,I,A))H=!1;else{var h=G.x>I.x?G.x>A.x?G.x:A.x:I.x>A.x?I.x:A.x,e=G.y>I.y?G.y>A.y?G.y:A.y:I.y>A.y?I.y:A.y;E=q(G.x<I.x?G.x<A.x?G.x:A.x:I.x<
A.x?I.x:A.x,G.y<I.y?G.y<A.y?G.y:A.y:I.y<A.y?I.y:A.y,K,V,S);K=q(h,e,K,V,S);for(V=H.nextZ;V&&V.z<=K;){if(V!==H.prev&&V!==H.next&&m(G.x,G.y,I.x,I.y,A.x,A.y,V.x,V.y)&&0<=k(V.prev,V,V.next)){H=!1;break a}V=V.nextZ}for(V=H.prevZ;V&&V.z>=E;){if(V!==H.prev&&V!==H.next&&m(G.x,G.y,I.x,I.y,A.x,A.y,V.x,V.y)&&0<=k(V.prev,V,V.next)){H=!1;break a}V=V.prevZ}H=!0}}else a:if(H=b,G=H.prev,I=H,A=H.next,0<=k(G,I,A))H=!1;else{for(E=H.next.next;E!==H.prev;){if(m(G.x,G.y,I.x,I.y,A.x,A.y,E.x,E.y)&&0<=k(E.prev,E,E.next)){H=
!1;break a}E=E.next}H=!0}if(H)d.push(B.i/l),d.push(b.i/l),d.push(D.i/l),u(b),c=b=D.next;else if(b=D,b===c){if(!C)a(f(b),d,l,r,t,w,1);else if(1===C){C=d;c=l;B=b;do D=B.prev,H=B.next.next,!p(D,H)&&x(D,B,B.next,H)&&z(D,H)&&z(H,D)&&(C.push(D.i/c),C.push(B.i/c),C.push(H.i/c),u(B),u(B.next),B=b=H),B=B.next;while(B!==b);b=B;a(b,d,l,r,t,w,2)}else if(2===C)a:{C=b;do{for(c=C.next.next;c!==C.prev;){if(B=C.i!==c.i){B=C;D=c;H=void 0;if(H=B.next.i!==D.i&&B.prev.i!==D.i){H=void 0;b:{H=B;do{if(H.i!==B.i&&H.next.i!==
B.i&&H.i!==D.i&&H.next.i!==D.i&&x(H,H.next,B,D)){H=!0;break b}H=H.next}while(H!==B);H=!1}H=!H}G=void 0;if(G=H&&z(B,D)&&z(D,B)){H=B;G=!1;I=(B.x+D.x)/2;D=(B.y+D.y)/2;do H.y>D!==H.next.y>D&&I<(H.next.x-H.x)*(D-H.y)/(H.next.y-H.y)+H.x&&(G=!G),H=H.next;while(H!==B)}B=G}if(B){b=v(C,c);C=f(C,C.next);b=f(b,b.next);a(C,d,l,r,t,w);a(b,d,l,r,t,w);break a}c=c.next}C=C.next}while(C!==b)}break}}}}function d(a,b){return a.x-b.x}function b(a,b){var c=b,d=a.x,f=a.y,k=-Infinity,l;do{if(f<=c.y&&f>=c.next.y){var p=c.x+
(f-c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(p<=d&&p>k){k=p;if(p===d){if(f===c.y)return c;if(f===c.next.y)return c.next}l=c.x<c.next.x?c:c.next}}c=c.next}while(c!==b);if(!l)return null;if(d===k)return l.prev;b=l;for(var p=l.x,r=l.y,q=Infinity,u,c=l.next;c!==b;)d>=c.x&&c.x>=p&&m(f<r?d:k,f,p,r,f<r?k:d,f,c.x,c.y)&&(u=Math.abs(f-c.y)/(d-c.x),(u<q||u===q&&c.x>l.x)&&z(c,a)&&(l=c,q=u)),c=c.next;return l}function q(a,b,d,f,k){a=32767*(a-d)/k;b=32767*(b-f)/k;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&
858993459;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&1431655765)<<1}function t(a){var b=a,c=a;do b.x<c.x&&(c=b),b=b.next;while(b!==a);return c}function m(a,b,d,f,k,m,l,p){return 0<=(k-l)*(b-p)-(a-l)*(m-p)&&0<=(a-l)*(f-p)-(d-l)*(b-p)&&0<=(d-l)*(m-p)-(k-l)*(f-p)}function k(a,b,d){return(b.y-a.y)*(d.x-b.x)-(b.x-a.x)*(d.y-b.y)}function p(a,b){return a.x===b.x&&a.y===b.y}function x(a,b,d,f){return p(a,b)&&p(d,f)||p(a,f)&&p(d,b)?!0:0<k(a,b,d)!==0<k(a,
b,f)&&0<k(d,f,a)!==0<k(d,f,b)}function z(a,b){return 0>k(a.prev,a,a.next)?0<=k(a,b,a.next)&&0<=k(a,a.prev,b):0>k(a,b,a.prev)||0>k(a,a.next,b)}function v(a,b){var c=new C(a.i,a.x,a.y),d=new C(b.i,b.x,b.y),f=a.next,k=b.prev;a.next=b;b.prev=a;c.next=f;f.prev=c;d.next=c;c.prev=d;k.next=d;d.prev=k;return d}function r(a,b,d,f){a=new C(a,b,d);f?(a.next=f.next,a.prev=f,f.next.prev=a,f.next=a):(a.prev=a,a.next=a);return a}function u(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);
a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function C(a,b,d){this.i=a;this.x=b;this.y=d;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function E(a,b,d,f){for(var c=0,k=d-f;b<d;b+=f)c+=(a[k]-a[b])*(a[b+1]+a[k+1]),k=b;return c}w.deviation=function(a,b,d,f){var c=b&&b.length,k=Math.abs(E(a,0,c?b[0]*d:a.length,d));if(c)for(var c=0,m=b.length;c<m;c++)k-=Math.abs(E(a,b[c]*d,c<m-1?b[c+1]*d:a.length,d));for(c=b=0;c<f.length;c+=3){var m=f[c]*d,l=f[c+1]*d,p=f[c+2]*d;b+=Math.abs((a[m]-a[p])*(a[l+
1]-a[m+1])-(a[m]-a[l])*(a[p+1]-a[m+1]))}return 0===k&&0===b?0:Math.abs((b-k)/k)};w.flatten=function(a){for(var b=a[0][0].length,c={vertices:[],holes:[],dimensions:b},d=0,f=0;f<a.length;f++){for(var k=0;k<a[f].length;k++)for(var m=0;m<b;m++)c.vertices.push(a[f][k][m]);0<f&&(d+=a[f-1].length,c.holes.push(d))}return c};return w})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./Graphics3DSymbolCommonCode ../../../../geometry/Polygon ../../../../geometry/Point ../../support/projectionUtils ../../lib/glMatrix ../../webgl-engine/Stage ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/materials/Material ../../webgl-engine/lib/Util ./earcut/earcut ./graphicUtils".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E){function c(a,b,c,d,e,f,g,h,k,m,l,p,r,q){var n=c.length/3,u=0;l+=2*d.count;var v=d.index,t=d.count,x=k,w=l;H.set(r,P);var z=0<p?1:-1,v=3*v,C=x;r=3*C;for(var y=x+t,x=3*y,E=0;E<t;++E)q&&(P[0]=a[v+0],P[1]=a[v+1],P[2]=a[v+2],H.normalize(P)),e[r+0]=a[v+0],e[r+1]=a[v+1],e[r+2]=a[v+2],f[r+0]=b[v+0],f[r+1]=b[v+1],f[r+2]=b[v+2],g[r+0]=-z*P[0],g[r+1]=-z*P[1],g[r+2]=-z*P[2],h[C]=0,e[x+0]=a[v+0]+p*P[0],e[x+1]=a[v+1]+p*P[1],e[x+2]=a[v+2]+p*P[2],f[x+0]=b[v+0],f[x+1]=
b[v+1],f[x+2]=b[v+2],g[x+0]=z*P[0],g[x+1]=z*P[1],g[x+2]=z*P[2],h[y]=p,r+=3,x+=3,v+=3,C+=1,y+=1;v=0;r=3*w;x=3*(w+n);r=3*(w+n);x=3*w;a=O;b=L;0>p&&(a=L,b=O);for(E=0;E<n;++E)m[r+0]=c[v+a[0]],m[r+1]=c[v+a[1]],m[r+2]=c[v+a[2]],m[x+0]=c[v+b[0]]+t,m[x+1]=c[v+b[1]]+t,m[x+2]=c[v+b[2]]+t,r+=3,x+=3,v+=3;k+=2*d.count;l=l+2*n-(2*d.count+2*n);B(e,f,h,g,u,d.pathLengths[0],d.count,k,m,l,p);k+=4*d.pathLengths[0];l+=2*d.pathLengths[0];u+=d.pathLengths[0];for(c=1;c<d.pathLengths.length;++c)B(e,f,h,g,u,d.pathLengths[c],
d.count,k,m,l,p),k+=4*d.pathLengths[c],l+=2*d.pathLengths[c],u+=d.pathLengths[c]}function D(a,b,c,d,e,f,g){d[f]=d[g];g*=3;f*=3;a[f+0]=a[g+0];a[f+1]=a[g+1];a[f+2]=a[g+2];b[f+0]=b[g+0];b[f+1]=b[g+1];b[f+2]=b[g+2];c[f+0]=e[0];c[f+1]=e[1];c[f+2]=e[2]}function B(a,b,c,d,e,f,g,k,m,l,p){var n=e,r=e+1,q=e+g,u=e+g+1,v=k,t=k+1,x=k+2*f;k=k+2*f+1;0>p&&(n=e+g+1,u=e);l*=3;for(var w=0;w<f;++w){w===f-1&&(0<p?(r=e,u=e+g):(r=e,n=e+g));var z=a,C=n,B=r,y=q,E=Q,C=3*C,B=3*B,y=3*y;H.set3(z[C++],z[C++],z[C++],T);H.set3(z[B++],
z[B++],z[B++],A);H.set3(z[y++],z[y++],z[y++],V);H.subtract(A,T,S);H.subtract(V,T,h);H.cross(h,S,E);H.normalize(E,E);D(a,b,d,c,Q,v,n);D(a,b,d,c,Q,t,r);D(a,b,d,c,Q,x,q);D(a,b,d,c,Q,k,u);m[l++]=v;m[l++]=x;m[l++]=k;m[l++]=v;m[l++]=k;m[l++]=t;n++;r++;q++;u++;v+=2;t+=2;x+=2;k+=2}}function I(a,c,d,f){var h=f.setAltitude;M.spatialReference=d.spatialReference;for(var k=a.getGeometryRecords(),m=k.length,l="absolute-height"!==c.mode,p=0,n=0;n<m;n++){var r=k[n].geometry,q=k[n].transformation;g[0]=q[12];g[1]=
q[13];g[2]=q[14];r.invalidateBoundingInfo();for(var u=r.getData().getVertexAttr(),r=u[G.POSITION].data,q=u[G.SIZE].data,u=u.mapPos.data,v=r.length/3,t=0,x=0,w=!1,z=0,C=0;C<v;C++){M.x=u[x];M.y=u[x+1];M.z=u[x+2];e[0]=r[t];e[1]=r[t+1];e[2]=r[t+2];var B=b.computeElevation(d,M,c,f,l?R:null);l&&(z+=R.terrainElevation);J[0]=r[t]+g[0];J[1]=r[t+1]+g[1];J[2]=r[t+2]+g[2];h(B+q[t/3],J,0);r[t]=J[0]-g[0];r[t+1]=J[1]-g[1];r[t+2]=J[2]-g[2];B=.01/f.unitInMeters;if(Math.abs(e[0]-r[t])>B||Math.abs(e[1]-r[t+1])>B||Math.abs(e[2]-
r[t+2])>B)w=!0;x+=3;t+=3}w&&a.geometryVertexAttrsUpdated(n);p+=z/v}return p/m}var G=u.VertexAttrConstants,H=k.vec3d,K=k.mat4d,J=H.create(),P=H.create(),O=[0,2,1],L=[0,1,2],M=new t,R={verticalDistanceToGround:0,terrainElevation:0};w=function(a){function e(){return null!==a&&a.apply(this,arguments)||this}f(e,a);e.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=E.validateSymbolLayerSize(this._getSymbolSize());if(a){this._logWarning(a);this.reject();return}}var a=this._getStageIdHint(),
b=this._getMaterialOpacityAndColor(),c=H.create(b),b=b[3],c={diffuse:c,ambient:c,opacity:b,transparent:1>b||this._isPropertyDriven("opacity"),vertexColors:!0};this._material=new r(c,a+"_3dlinemat");this._context.stage.add(p.ModelContentType.MATERIAL,this._material);this.resolve()};e.prototype.destroy=function(){a.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&this._context.stage.remove(p.ModelContentType.MATERIAL,this._material.getId())};e.prototype.createGraphics3DGraphic=
function(a,b){var c=this._validateGeometry(a.geometry);if("polygon"!==c.type&&"extent"!==c.type)return this._logWarning("unsupported geometry type for extrude symbol: "+c.type),null;var c="polygon"===c.type||"extent"===c.type?"rings":"paths",d="graphic"+a.uid,e=this._getVertexOpacityAndColor(b,Float32Array,255),f=this.getGraphicElevationInfo(a);return this._createAs3DShape(a,c,b,e,f,d,a.uid)};e.prototype.layerPropertyChanged=function(a,c,d){if("opacity"===a)return c=this._getMaterialOpacity(),d=1>
c||this._isPropertyDriven("opacity"),this._material.setParameterValues({opacity:c,transparent:d}),!0;if("elevationInfo"===a){this._updateElevationInfo();for(var e in c){var f=c[e];if(a=d(f))f=this.getGraphicElevationInfo(f.graphic),a.needsElevationUpdates=b.needsElevationUpdates3D(f.mode),a.elevationInfo.set(f)}return!0}return!1};e.prototype._getExtrusionSize=function(a){a=a.size&&this._isPropertyDriven("size")?b.getSingleSizeDriver(a.size,2):this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};
e.prototype._getSymbolSize=function(){return this.symbol.size||1};e.prototype._createAs3DShape=function(a,e,f,g,h,k,l){var p=a.geometry;"extent"===p.type&&(p=q.fromExtent(p));a=p[e];var n=p.hasZ,r=[],u=[],v=[],t=H.create(),w=Array(6),B=this._context.renderSpatialReference===m.SphericalRenderSpatialReference,y=this._getExtrusionSize(f),E=H.create();B||this._context.renderCoordsHelper.worldUpAtPosition(null,E);f=b.getGeometryVertexData3D(a,n,p.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,
this._context.renderCoordsHelper,h);this._logGeometryCreationWarnings(f,a,e,"ExtrudeSymbol3DLayer");if(0<a.length){var A=f.geometryData.polygons,D=f.eleVertexData,G=f.vertexData;e=G.length/3;var F=new Float64Array(18*e),J=new Float64Array(18*e),P=new Float64Array(18*e),O=new Float64Array(6*e),L=0;e=function(a){var d=A[a],e=d.count,f=d.index;if(M._context.clippingExtent&&(b.computeBoundingBox(D,f,e,w),b.boundingBoxClipped(w,M._context.clippingExtent)))return"continue";var h=new Float64Array(D.buffer,
3*f*F.BYTES_PER_ELEMENT,3*e),m=d.holeIndices.map(function(a){return a-f}),h=C(h,m,3);if(0<h.length){b.chooseOrigin(G,f,e,t);var m=new Uint32Array(6*e+2*h.length),l=6*e,p=new Float64Array(F.buffer,3*L*F.BYTES_PER_ELEMENT,3*l),n=new Float64Array(J.buffer,3*L*J.BYTES_PER_ELEMENT,3*l),q=new Float64Array(P.buffer,3*L*P.BYTES_PER_ELEMENT,3*l),x=new Float64Array(O.buffer,1*L*O.BYTES_PER_ELEMENT,1*l);c(G,D,h,d,p,q,n,x,0,m,0,y,E,B);b.subtractCoordinates(p,0,l,t);L+=6*e;d=M._createExtrudeGeometry(m,{positions:p,
elevation:q,normals:n,heights:x},g);a=new z(d,k+"path"+a);a.singleUse=!0;r.push(a);u.push([M._material]);a=K.identity();K.translate(a,t,a);v.push(a)}};var M=this;for(a=0;a<A.length;++a)e(a);if(0<r.length)return l=new x({geometries:r,materials:u,transformations:v,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicId:l},idHint:k}),l=new d(this,l,r,null,null,I,h),l.alignedTerrainElevation=f.terrainElevation,l.needsElevationUpdates=b.needsElevationUpdates3D(h.mode),l}return null};e.prototype._createExtrudeGeometry=
function(a,b,c){for(var d=a.length,e=new Uint32Array(d),f=0;f<d;f++)e[f]=0;d={};f={};d[G.POSITION]=a;d[G.NORMAL]=a;d[G.COLOR]=e;f[G.POSITION]={size:3,data:b.positions};f[G.NORMAL]={size:3,data:b.normals};f[G.COLOR]={size:4,data:c};f[G.SIZE]={size:1,data:b.heights};b.elevation&&(f.mapPos={size:3,data:b.elevation},d.mapPos=a);return new v(f,d)};return e}(a);var Q=H.create(),T=H.create(),A=H.create(),V=H.create(),S=H.create(),h=H.create(),e=H.create(),g=H.create();return w})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ../../../../symbols/callouts/calloutUtils ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./ElevationAligners ./Graphics3DSymbolCommonCode ./graphicUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r){var u=[1,1,1,1],C=[0,0,1],E={mode:"relative-to-ground",offset:0},c=[0,0,0,1];return function(l){function q(){var a=null!==l&&l.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return a}f(q,l);q.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=p.validateSymbolLayerSize(this._getTextSize());if(a){this._logWarning(a);this.reject();return}}this._anchor="center";this.resolve()};q.prototype.destroy=
function(){l.prototype.destroy.call(this);this.isFulfilled()||this.reject()};q.prototype.createGraphics3DGraphic=function(a,b,c,d){var f="polyline"===a.geometry.type,k=this._getGeometry(a);if(!k)return this._logWarning("unsupported geometry type for text symbol: "+a.geometry.type),null;var m=this._context.layer.id+"_label_"+a.uid,l=b.text||this.symbol.text;if(!l||1>l.length)return null;b&&null!=b.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=b.needsOffsetAdjustment);var p=this.getGraphicElevationInfo(a,
b.elevationOffset||0);return this._createAs3DShape(this.symbol,k,l,p,m,a.uid,b,c,d,f)};q.prototype.getGraphicElevationInfo=function(a,b){void 0===b&&(b=0);a=l.prototype.getGraphicElevationInfo.call(this,a);a.addOffsetRenderUnits(b);return a};q.prototype._getGeometry=function(a){a=this._validateGeometry(a.geometry);return"polyline"===a.type?k.placePointOnPolyline(a):"polygon"===a.type?k.placePointOnPolygon(a):"extent"===a.type?a.center:"point"!==a.type?null:a};q.prototype.layerPropertyChanged=function(a,
b,c){if("opacity"===a)this._logWarning("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");else if("elevationInfo"===a){this._updateElevationInfo();if(b)for(var d in b){a=b[d];var f=c(a);f&&this.updateGraphicElevationInfo(a.graphic,f)}return!0}return!1};q.prototype.updateGraphicElevationInfo=function(a,b){a=this.getGraphicElevationInfo(a,b.metadata.elevationOffset);b.elevationInfo.set(a);b.needsElevationUpdates=k.needsElevationUpdates2D(a.mode)||"absolute-height"===a.mode};q.prototype._defaultElevationInfoNoZ=
function(){return E};q.prototype._createAs3DShape=function(f,l,p,q,w,B,E,D,M,R){var H=E.centerOffset||c,G=E.screenOffset||[0,0],A=E.debugDrawBorder||!1,I=E.translation||[0,0,0],K=E.anchor||this._anchor||"center";this._anchor=K;var h=f.material?a.toUnitRGBA(f.material.color):u,e=f.halo&&f.halo.color&&0<f.halo.size,g=e?a.toUnitRGBA(f.halo.color):u,e=e?d.pt2px(f.halo.size):0,n=this._getTextSize(f);f=new v(p,{size:n,color:h,font:{family:f.font&&f.font.family?f.font.family:"Arial",weight:f.font&&f.font.weight?
f.font.weight:"normal",style:f.font&&f.font.style?f.font.style:"normal"},halo:{size:e,color:g}},w);M=(h=M&&M.canHoldTextTexture(f))?M.addTextTexture(f):null;var y;D?y=E:b.isCalloutSupport(this.symbolContainer)&&this.symbolContainer.hasVisibleVerticalOffset()&&(y=this.symbolContainer);G={textureId:h?M.texture.getId():f.getId(),texCoordScale:h?[1,1]:f.getTexcoordScale(),occlusionTest:!0,screenOffset:G,anchorPos:K,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:E.centerOffsetUnits,debugDrawBorder:A,
drawInSecondSlot:!0};y&&y.verticalOffset&&(y=y.verticalOffset,A=y.minWorldLength,K=y.maxWorldLength,G.verticalOffset={screenLength:d.pt2px(y.screenLength),minWorldLength:A||0,maxWorldLength:null!=K?K:Infinity});this._context.screenSizePerspectiveEnabled&&(y=this._context.sharedResources,A=y.screenSizePerspectiveSettings,G.screenSizePerspective=y.screenSizePerspectiveSettingsLabels.overridePadding(e),G.screenSizePerspectiveAlignment=A);R&&(G.shaderPolygonOffset=1E-4);R=null;e=JSON.stringify(G);null!=
D?(R=D.getMaterial(e),null==R?(R=new r(G,w),D.addMaterial(e,R)):h&&R.setTextureDirty()):R=new r(G,w);R=[R];e=[f.getTextWidth(),f.getTextHeight()];H=z.createPointGeometry(C,I,void 0,e,H,M?M.uvMinMax:null);H=[new x(H,w)];w=k.createStageObjectForPoint.call(this,l,H,[R],null,null,q,w,this._context.layer.uid,B,!0);D=new t(this,w.object,H,null==D?R:null,h?null:[f],m.perObjectElevationAligner,q);D.alignedTerrainElevation=w.terrainElevation;D.needsElevationUpdates=k.needsElevationUpdates2D(q.mode)||"absolute-height"===
q.mode;var F=h?f.getTextWidth():f.getWidth(),J=h?f.getTextHeight():f.getHeight();D.getScreenSize=function(a){void 0===a&&(a=Array(2));a[0]=F;a[1]=J;return a};D.metadata={labelText:p,elevationOffset:E.elevationOffset||0};k.extendPointGraphicElevationInfo(D,l,this._context.elevationProvider);return D};q.prototype._getTextSize=function(a){return d.pt2px((a||this.symbol).size)||12};return q}(q)})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define("require exports ./Texture ./Util ../../../webgl/Texture ../../../webgl/enums".split(" "),
function(w,l,f,a,d,b){function q(){var a=document.createElement("canvas");a.width=512;a.height=512;return a}function t(a){return"rgb("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+")"}function m(a){return"rgba("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+","+a[3]+")"}w=function(){function b(b,d,f,k){void 0===k&&(k=!0);this._idHint=f;this._text=b;this._textLines=b.split(/\r?\n/);this._params=d;this._haloSize=Math.round(this._params.halo.size);this._fillStyle=
m(this._params.color);this._haloStyle=t(this._params.halo.color);this._textWidth=this._computeTextWidth();this._lineHeight=this._computeLineHeight();this._textHeight=this._computeTextHeight();this._scaleFactor=k?Math.min(1,Math.min(2048/this._textWidth,2048/this._textHeight)):1;this._renderedWidth=Math.round(this._textWidth*this._scaleFactor);this._renderedHeight=Math.round(this._textHeight*this._scaleFactor);k&&a.assert(2048>=this._renderedWidth&&2048>=this._renderedHeight);this._width=a.nextHighestPowerOfTwo(this._renderedWidth);
this._height=a.nextHighestPowerOfTwo(this._renderedHeight)}b.prototype.getId=function(){null==this._id&&(this._id=f.idGen.gen(this._idHint));return this._id};b.prototype.getParams=function(){return this._params};b.prototype.getText=function(){return this._text};b.prototype.deferredLoading=function(){return!1};b.prototype.getWidth=function(){return this._width};b.prototype.getHeight=function(){return this._height};b.prototype.getTextWidth=function(){return this._textWidth};b.prototype.getTextHeight=
function(){return this._textHeight};b.prototype.getRenderedWidth=function(){return this._renderedWidth};b.prototype.getRenderedHeight=function(){return this._renderedHeight};b.prototype.initializeThroughRender=function(a,b){var f=this._getTextCanvas();f.width=this._width;f.height=this._height;var k=f.getContext("2d");k.save();b.samplingMode=9987;b.wrapMode=33071;b.flipped=!0;b.preMultiplyAlpha=!0;b.hasMipmap=!0;this.renderText(this._renderedWidth,this._renderedHeight,k,0,this._height-this._renderedHeight);
a=new d(a,b,f);k.restore();return a};b.prototype.getTexcoordScale=function(){return[this._renderedWidth/this._width,this._renderedHeight/this._height]};b.prototype.setUnloadFunc=function(a){this._unloadFunc=a};b.prototype.unload=function(){this._unloadFunc&&(this._unloadFunc(this._id),this._unloadFunc=null)};b.prototype.renderText=function(a,b,d,f,m){void 0===f&&(f=0);void 0===m&&(m=0);b=this._lineHeight*this._scaleFactor;var l=this._haloSize,p=d.textAlign;a=("center"===p?.5*a:"right"===p?a:0)+l;
d.save();var c=3>l;if(0<l){var p=l,r=this._getHaloCanvas();r.width=Math.max(512,this._renderedWidth);r.height=Math.max(512,this._renderedHeight);var q=r.getContext("2d");q.clearRect(0,0,r.width,r.height);this._setFontProperties(q,this._params.size*this._scaleFactor);q.fillStyle=this._haloStyle;q.strokeStyle=this._haloStyle;q.lineJoin=c?"miter":"round";if(c)for(var u=0,v=this._textLines;u<v.length;u++){for(var c=v[u],t=0,x=k;t<x.length;t++){var w=x[t];q.fillText(c,a+l*w[0],l+l*w[1])}p+=b}else for(u=
0,v=this._textLines;u<v.length;u++){c=v[u];t=2*l;for(x=0;5>x;x++)q.lineWidth=(.6+.1*x)*t,q.strokeText(c,a,p);p+=b}d.globalAlpha=this._params.halo.color[3];d.drawImage(r,f,m);r.width=512;r.height=512;d.globalAlpha=1}this._setFontProperties(d,this._params.size*this._scaleFactor);p=m+l;m=0;for(l=this._textLines;m<l.length;m++)c=l[m],d.globalCompositeOperation="destination-out",d.fillStyle="rgb(0, 0, 0)",d.fillText(c,f+a,p),d.globalCompositeOperation="source-over",d.fillStyle=this._fillStyle,d.fillText(c,
f+a,p),p+=b;d.restore()};b.preferredAtlasSize=function(){return 512};b.prototype._getTextCanvas=function(){null==b._textCanvas2D&&(b._textCanvas2D=q());return b._textCanvas2D};b.prototype._getHaloCanvas=function(){null==b._haloCanvas2D&&(b._haloCanvas2D=q());return b._haloCanvas2D};b.prototype._setFontProperties=function(a,b){var d=this._params.font;a.font=d.style+" "+d.weight+" "+b+"px "+d.family;a.textAlign="left";a.textBaseline="top"};b.prototype._computeTextWidth=function(){var a=this._getTextCanvas().getContext("2d");
this._setFontProperties(a,this._params.size);for(var b=0,d=0,f=this._textLines;d<f.length;d++){var k=a.measureText(f[d]).width;k>b&&(b=k)}d=this._params.font;if("italic"===d.style||"oblique"===d.style||"string"===typeof d.weight&&("bold"===d.weight||"bolder"===d.weight)||"number"===typeof d.weight&&600<d.weight)b+=.3*a.measureText("A").width;b+=2*this._haloSize;return b=Math.round(b)};b.prototype._computeLineHeight=function(){return Math.floor(1.275*this._params.size+2*this._haloSize)};b.prototype._computeTextHeight=
function(){return this._computeLineHeight()*this._textLines.length};return b}();var k=[];for(l=0;360>l;l+=22.5)k.push([Math.cos(Math.PI*l/180),Math.sin(Math.PI*l/180)]);return w})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./Graphics3DSymbol","./Graphics3DCalloutSymbolLayerFactory"],function(w,l,f,a,d){return function(a){function b(b,f,k){b=a.call(this,b,f,k)||this;b.calloutSymbolLayer=null;b.symbol.hasVisibleCallout()&&
(b.calloutSymbolLayer=d.make(b.symbol,f));return b}f(b,a);b.prototype.destroy=function(){a.prototype.destroy.call(this)};b.prototype.createGraphics3DGraphic=function(b,d,f){f=a.prototype.createGraphics3DGraphic.call(this,b,d,f);this.calloutSymbolLayer&&(b=this.createCalloutGraphic(b,d))&&f.addAuxiliaryGraphic(b);return f};b.prototype.layerPropertyChanged=function(b,d){var f=this;return a.prototype.layerPropertyChanged.call(this,b,d)?this.calloutSymbolLayer?this.calloutSymbolLayer.layerPropertyChanged(b,
d,function(a){var b=0;for(a=a._auxiliaryGraphics;b<a.length;b++){var d=a[b];if(d.graphics3DSymbolLayer===f.calloutSymbolLayer)return d}}):!0:!1};b.prototype.createCalloutGraphic=function(a,b){return this.calloutSymbolLayer.createGraphics3DGraphic(a,{renderer:b.renderer,symbol:b.symbol,needsOffsetAdjustment:b.needsOffsetAdjustment,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null})};return b}(a)})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["require",
"exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(w,l,f,a,d){Object.defineProperty(l,"__esModule",{value:!0});var b=f.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");l.make=function(d,f){if(!a.isCalloutSupport(d))return b.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+d.type+"' does not support callouts"),null;if(!d.callout)return null;var k=q[d.callout.type];return k?new k(d,
f):(b.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+d.callout.type),null)};var q={line:d}})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DSymbolLayer ./Graphics3DGraphicLayer ./Graphics3DSymbolCommonCode ./ElevationAligners ../../../../core/screenUtils ../../../../Color ../../../../geometry/Polygon ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Util ../../webgl-engine/lib/GeometryData ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r){var u=z.VertexAttrConstants;w=function(a){function l(b,c){b=a.call(this,b,null,c,!0)||this;b._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return b}f(l,a);l.prototype.destroy=function(){a.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(p.ModelContentType.MATERIAL,this._material.getId()),this._material=null)};l.prototype._prepareResources=function(){var a=this._getStageIdHint();
this._createMaterialsAndAddToStage(this._context.stage,a);this.resolve()};l.prototype.perInstanceMaterialParameters=function(a){var b=this.materialParameters;b.screenOffset=a.screenOffset||[0,0];b.centerOffsetUnits=a.centerOffsetUnits||"world";return b};Object.defineProperty(l.prototype,"materialParameters",{get:function(){var a=this.symbolContainer,b=a.callout,c=m.toUnitRGBA(b.color);c[3]*=this._getLayerOpacity();var d=t.pt2px(b.size||0),f=null;if(a.verticalOffset)var f=a.verticalOffset,k=f.minWorldLength,
l=f.maxWorldLength,f={screenLength:t.pt2px(f.screenLength),minWorldLength:k||0,maxWorldLength:null!=l?l:Infinity};b=b.border&&b.border.color?m.toUnitRGBA(b.border.color):null;k="object"===a.symbolLayers.getItemAt(0).type;return{color:c,size:d,verticalOffset:f,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:b,occlusionTest:!k,shaderPolygonOffset:k?0:void 0,depthHUDAlignStart:"label-3d"===
a.type}},enumerable:!0,configurable:!0});l.prototype._createMaterialsAndAddToStage=function(a,b){this._material=new r(this.materialParameters,b+"_lineCallout_common");a.add(p.ModelContentType.MATERIAL,this._material)};l.prototype._defaultElevationInfoNoZ=function(){return D};l.prototype._getGeometry=function(a){a=this._validateGeometry(a.geometry);if("extent"===a.type)return b.placePointOnPolygon(k.fromExtent(a));if("polyline"===a.type)return b.placePointOnPolyline(a);if("polygon"===a.type)return b.placePointOnPolygon(a);
if("point"===a.type)return a;this._logWarning("unsupported geometry type for point symbol: "+a.type);return null};l.prototype.createGraphics3DGraphic=function(a,b){null!=b.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=b.needsOffsetAdjustment);var c=this.getGraphicElevationInfo(a,b.elevationOffset||0),d=b.symbol,f="on-the-ground"===this._elevationInfo.mode&&!d.symbolLayers.some(function(a){return"object"===a.type||"text"===a.type});if("label-3d"!==d.type&&f)return null;d=this._getGeometry(a);
return null===d?null:this._createAs3DShape(a,d,c,b,"graphic"+a.uid,a.uid)};l.prototype.layerPropertyChanged=function(a,b,c){switch(a){case "opacity":return this.layerOpacityChanged(b,c);case "elevationInfo":return this.layerElevationInfoChanged(b,c)}return!1};l.prototype.layerOpacityChanged=function(a,b){this._material.setParameterValues(this.materialParameters);return!0};l.prototype.layerElevationInfoChanged=function(a,b){var c=this._elevationInfo.mode;this._updateElevationInfo();var d=this._elevationInfo.mode;
if(c!==d&&("on-the-ground"===c||"on-the-ground"===d))return!1;for(var f in a)c=a[f],(d=b(c))&&this.updateGraphicElevationInfo(c.graphic,d);return!0};l.prototype.getGraphicElevationInfo=function(b,c){void 0===c&&(c=0);b=a.prototype.getGraphicElevationInfo.call(this,b);b.addOffsetRenderUnits(c);return b};l.prototype.updateGraphicElevationInfo=function(a,c){a=this.getGraphicElevationInfo(a,c.metadata.elevationOffset);c.elevationInfo.set(a);c.needsElevationUpdates=b.needsElevationUpdates2D(a.mode)};l.prototype.createVertexData=
function(a){var b=a.translation;a=a.centerOffset;if(!b&&!a)return C;b=b?{size:3,data:[b[0],b[1],b[2]]}:C[u.POSITION];a=a?{size:4,data:[a[0],a[1],a[2],a[3]]}:C[u.AUXPOS1];return c={},c[u.POSITION]=b,c[u.NORMAL]=C[u.NORMAL],c[u.AUXPOS1]=a,c;var c};l.prototype.getOrCreateMaterial=function(a,b){var c=this.perInstanceMaterialParameters(a),d=r.uniqueMaterialIdentifier(c);if(d===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(a.materialCollection){var f=a.materialCollection.getMaterial(d);
f||(f=new r(c,b+"_lineCallout_shared"),a.materialCollection.addMaterial(d,f));return{material:f,isUnique:!1}}f=new r(c,b+"_lineCallout_unique");return{material:f,isUnique:!0}};l.prototype._createAs3DShape=function(a,f,k,m,l,p){a=new v(this.createVertexData(m),c,v.DefaultOffsets,"point");a=[new x(a,l)];var r=this.getOrCreateMaterial(m,l);l=b.createStageObjectForPoint.call(this,f,a,[[r.material]],null,null,k,l,this._context.layer.uid,p,!0);if(null===l)return null;p=new d(this,l.object,a,r.isUnique?
[r.material]:null,null,q.perObjectElevationAligner,k);p.metadata={elevationOffset:m.elevationOffset||0};p.alignedTerrainElevation=l.terrainElevation;p.needsElevationUpdates=b.needsElevationUpdates2D(k.mode);b.extendPointGraphicElevationInfo(p,f,this._context.elevationProvider);return p};return l}(a);var C=(E={},E[u.POSITION]={size:3,data:[0,0,0]},E[u.NORMAL]={size:3,data:[0,0,1]},E[u.AUXPOS1]={size:4,data:[0,0,0,1]},E),E=new Uint32Array([0]),c=(B={},B[u.POSITION]=E,B[u.NORMAL]=E,B[u.AUXPOS1]=E,B),
D={mode:"relative-to-ground",offset:0},E,B;return w})},"esri/views/3d/layers/graphics/Graphics3DOwner":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});w=function(){return function(){this.featureExpressionInfoContext=this.localOriginFactory=this.layerView=this.layer=this.overlaySR=this.renderCoordsHelper=this.renderSpatialReference=this.clippingExtent=this.layerOrderDelta=this.layerOrder=this.stage=this.renderer=this.elevationProvider=this.streamDataSupplier=
this.sharedResources=null;this.screenSizePerspectiveEnabled=!0}}();l.Graphics3DSymbolCreationContext=w})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper dojo/Deferred dojo/_base/lang ../../../../core/Scheduler ../../../../geometry/Multipoint".split(" "),function(w,l,f,a,d,b,q,t){Object.defineProperty(l,"__esModule",{value:!0});w=function(){function m(a,d,f){this.spatialReference=
a;this._getElevationQueryProvider=d;this._queries=[];this._isScheduled=!1;this._queryOptions=b.mixin({},f,{ignoreInvisibleLayers:!0})}m.prototype.queryElevation=function(b,m){return a(this,void 0,void 0,function(){var a;return f(this,function(f){a=new d;this._queries.push({x:b,y:m,result:a});this._scheduleDoQuery();return[2,a.promise]})})};m.prototype._scheduleDoQuery=function(){var a=this;this._isScheduled||(q.schedule(function(){return a._doQuery()}),this._isScheduled=!0)};m.prototype._doQuery=
function(){return a(this,void 0,void 0,function(){var a,b,d,m,l,r,q;return f(this,function(f){switch(f.label){case 0:this._isScheduled=!1;a=this._queries;this._queries=[];b=a.map(function(a){return[a.x,a.y]});d=new t({points:b,spatialReference:this.spatialReference});m=this._getElevationQueryProvider();if(!m)return a.forEach(function(a,b){return a.result.reject()}),[2];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,m.queryElevation(d,this._queryOptions)];case 2:return l=f.sent(),[3,4];case 3:return r=
f.sent(),a.forEach(function(a){return a.result.reject(r)}),[2];case 4:return q=l.geometry.points,a.forEach(function(a,b){return a.result.resolve(q[b][2])}),[2]}})})};return m}();l.ElevationQuery=w})},"esri/views/3d/layers/graphics/Graphics3DSpatialIndex":function(){define("require exports dojo/Deferred ../../../../processors/SpatialIndex ../../../../geometry/SpatialReference ../../../../geometry/support/webMercatorUtils".split(" "),function(w,l,f,a,d,b){return function(){function l(){var b=this;this.spatialIndex=
new a;this.spatialIndexNumPendingQueries=this.spatialIndexNumGraphics=0;this.graphicsCore=this.viewSR=this.layer=this.layerView=null;this._readyDfd=new f;var d=function(a){return a.workerClient&&a.workerClient.worker};if(d(this.spatialIndex))this._readyDfd.resolve();else this.spatialIndex.on("start",function(){d(b.spatialIndex)&&b._readyDfd.resolve()})}l.prototype.initialize=function(a,b,d,f){this.layerView=a;this.layer=b;this.viewSR=d;this.graphicsCore=f};l.prototype.destroy=function(){this.spatialIndex&&
(this.spatialIndex.destroy(),this.spatialIndex=null);this.graphicsCore=this.layerView=this.viewSR=null};l.prototype.numNodesUpdating=function(){return 0};l.prototype.isUpdating=function(){return 0<this.spatialIndexNumPendingQueries};l.prototype.hasGraphics=function(){return 0<this.spatialIndexNumGraphics};l.prototype.intersects=function(a,b,d){var f=this;this.hasGraphics()&&(this.spatialIndexNumPendingQueries++,this.spatialIndex.intersects(a,void 0,void 0,!0).then(function(a){f.spatialIndexNumPendingQueries--;
d(a.results,a.results.length);f.layerView._evaluateUpdatingState()}))};l.prototype.shouldAddToSpatialIndex=function(a,b,d){return d||b.needsElevationUpdates()};l.prototype.addGraphicsToSpatialIndex=function(a){if(this.layerView.loadedGraphics)for(var b=this.layerView.loadedGraphics.toArray(),d=b.length,f=0;f<d;f++){var l=b[f],q=this.graphicsCore.getGraphics3DGraphicById(l.uid);q&&!q.addedToSpatialIndex&&this.shouldAddToSpatialIndex(l,q,a)&&this.addGraphicToSpatialIndex(l,q)}};l.prototype.addGraphicToSpatialIndex=
function(a,f){var k=a.geometry.spatialReference,m=this.viewSR,l={id:a.uid,geometry:null};if(k.equals(m))l.geometry=a.geometry.toJSON();else{var q=void 0;if(k.wkid===d.WGS84.wkid&&m.isWebMercator)q=b.geographicToWebMercator(a.geometry);else if(k.isWebMercator&&m.wkid===d.WGS84.wkid)q=b.webMercatorToGeographic(a.geometry);else return console.warn("Cannot convert graphic geometry to map spatial reference, elevation and scale updates are disabled"),!1;l.geometry=q.toJSON()}this.spatialIndexNumGraphics++;
this.spatialIndex.runProcess([l],this.layer.id);return f.addedToSpatialIndex=!0};l.prototype.whenLoaded=function(){return this._readyDfd.promise};return l}()})},"esri/processors/SpatialIndex":function(){define("../core/declare dojo/Deferred dojo/_base/lang ./Processor ../workers/WorkerClient ../layers/FeatureLayer".split(" "),function(w,l,f,a,d,b){return w([a],{declaredClass:"esri.processors.SpatialIndex",index:null,indexType:"rtree",autostart:!1,constructor:function(a){a=a||{};var b=!1!==a.autostart;
f.mixin(this,a);this.workerCallback=["./scripts/helpers","./scripts/indexInterface","./indexWorker"];if(!this.fetchWithWorker){var m=this;this.workerClient=new d("./mutableWorker",function(a){this.workerClient=a;this.workerCallback.push("./libs/"+this.indexType);this.workerClient.importScripts(this.workerCallback).then(function(){m._attachedSystem=!0;b&&m.start()})}.bind(this))}this._featCache={}},destroy:function(){this.workerClient&&this.workerClient.terminate()},addLayer:function(a,d){if(a.graphics&&
a.graphics.length||d||a.isInstanceOf(b)){var f=this.workerClient;if(!this._attachedSystem&&f.worker){var k=this;this.inherited(arguments,[a,!0]);f.importScripts("./libs/"+this.indexType).then(function(){k.runProcess(a.graphics,a.id);k._attachedSystem=!0})}else this.inherited(arguments,[a])}},unsetMap:function(){this.stop();this.workerClient.terminate();this.fetchWithWorker||(this.workerClient=new d(this.workerCallback,function(){}));this.inherited(arguments);this.start()},removeLayer:function(a){this.inherited(arguments)},
runProcess:function(a,b){if(a&&a.length){var d=this,f=this.workerClient,l=a[0]._graphicsLayer;b||0===b||(b=l?l.id:"rawFeatures_"+Object.keys(this._featCache).length);this._featCache[b]||(this._featCache[b]={});for(var q,t,v=[],r=a.length,u=l&&l.objectIdField;r--;)t=a[r],q=t.attributes&&u?t.attributes[u]:t.id,null!=q&&this._featCache[b][q]||(this._featCache[b][q]=1,t.declaredClass?v.push({id:q,geometry:t.geometry.toJSON(!0),attributes:t.attributes}):v.push(t));0!==v.length&&(f.postMessage({insert:v,
system:this.indexType,options:this.indexOptions,idField:l&&l.objectIdField,layerId:b}).then(function(a){l&&l.emit("process-end",{processor:d,results:{insert:a.insert}})}),l&&l.emit("process-start",{processor:this}))}},_sendFeaturesFromLayer:function(a,b){b=b.graphic;var d=this.workerClient,f=this,l=b.attributes[a.objectIdField];this._featCache[a.id]||(this._featCache[a.id]={});this._featCache[a.id][l]||(this._featCache[a.id][l]=1,d.postMessage({insert:[{attributes:b.attributes,geometry:b.geometry.toJSON(!0)}],
system:this.indexType,options:this.indexOptions,idField:a.objectIdField,layerId:a.id}).then(function(b){a.emit("process-end",{processor:f,results:{insert:b.insert}})}),a.emit("process-start",{processor:f}))},_notifyProcessStart:function(a,b){},_sendFeaturesFromTask:function(a,b){b=b.featureSet.features;var d=[],f=this.workerClient,l=this,q=b.length,t,v;for(this._featCache[a.id]||(this._featCache[a.id]={});q--;)v=b[q],t=v.attributes[a.objectIdField],this._featCache[a.id][t]||(this._featCache[a.id][t]=
1,d.push(v));f.postMessage({insert:d,system:this.indexType,options:this.indexOptions,idField:a.objectIdField,layerId:a.id}).then(function(b){a.emit("process-end",{processor:l,results:{insert:b.insert}})});a.emit("process-start",{processor:l})},get:function(){},intersects:function(a,b,d,f){return"rtree"!=this.indexType?(console.error("Index.intersects only works with rtree indexes"),a=new l,a.reject({message:"Index.intersects only works with rtree indexes"}),a.promise):this.workerClient.postMessage({search:a,
layerId:b,returnNode:d,onlyIds:f})},within:function(a,b,d){if("rtree"!=this.indexType)return console.error("Index.within only works with rtree indexes"),a=new l,a.reject({message:"Index.within only works with rtree indexes"}),a.promise},nearest:function(a){return"kdtree"!=this.indexType?(console.error("Index.nearest only works with kdtree indexes"),a=new l,a.reject({message:"Index.nearest only works with kdtree indexes"}),a.promise):this.workerClient.postMessage({search:a})}})})},"esri/processors/Processor":function(){define("../core/sniff ../core/declare dojo/_base/lang dojo/_base/array dojo/Evented ../workers/RequestClient ../layers/GraphicsLayer".split(" "),
function(w,l,f,a,d,b,q){return l([d],{declaredClass:"esri.processors.Processor",layers:null,results:null,passFeatures:!0,drawFeatures:!0,requireWorkerSupport:!0,fetchWithWorker:!1,workerCallback:null,workerClient:null,_started:null,_handlers:null,constructor:function(a){a=a||{};f.mixin(this,a);w("esri-workers")||!1===this.requireWorkerSupport&&!1===a.requireWorkerSupport?(this._handlers={},this._notifyProcessStart=f.hitch(this,this._notifyProcessStart),this._sendFeaturesFromTask=f.hitch(this,this._sendFeaturesFromTask),
this._sendFeaturesFromLayer=f.hitch(this,this._sendFeaturesFromLayer),!1!==a.autostart&&this.start()):(console.log("Browser doesn't support workers \x26 worker support is required for this processor"),this.addLayer=this.setMap=this.start=this.runProcess=function(){},this._disabled=!0)},addLayer:function(a,d){var k=a._task,m=this._handlers[a.id]=[],l="complete";!1===this.drawFeatures&&(a._params.drawMode=!1);this.fetchWithWorker?(this.workerClient||(this.workerClient=b.getClient(this.workerCallback)),
k.requestOptions={workerOptions:{worker:this.workerClient}},this.passFeatures&&m.push(k.on(l,f.partial(this._notifyProcessStart,a)))):this.passFeatures?(l=this.drawFeatures?"graphic-draw":"graphic-add",m.push(a.on(l,f.partial(this._sendFeaturesFromLayer,a)))):m.push(k.on(l,f.partial(this._sendFeaturesFromTask,a)));!0!==d&&a.graphics&&this.runProcess(a.graphics,a.id)},removeLayer:function(b){a.forEach(this._handlers[b.id],function(a){a.remove()});delete this._handlers[b.id]},setMap:function(b){if(this.map)if(b!=
this.map)this.unsetMap();else return;var d=this;a.forEach(this.layers,d.removeLayer);a.forEach(b.graphicsLayerIds,function(a){d.addLayer(b.findLayerById(a))});this._handlers.map=[b.on("layer-add",function(a){a=a.layer;a.isInstanceOf(q)&&d.addLayer(a)}),b.on("layer-remove",function(a){a=a.layer;a.isInstanceOf(q)&&d.removeLayer(a)})];this.map=b},unsetMap:function(){this.map&&(a.forEach(this._handlers.map,function(a){a.remove()}),delete this._handlers.map,a.forEach(this.layers,this.removeLayer),this.map=
null)},start:function(){this.map?this.setMap(this.map):this.layers&&(f.isArray(this.layers)||(this.layers=[this.layers]),a.forEach(this.layers,this.addLayer));this._started=!0;this.emit("start",{processor:this});console.log("processor started")},stop:function(){this._started=!1;for(var a in this._handlers)this._handlers.hasOwnProperty(a)&&(this._handlers[a].remove(),delete this._handlers[a]);this.emit("stop",{processor:this});console.log("processor stopped")},runProcess:function(a,b){},_sendFeaturesFromTask:function(){},
_sendFeaturesFromLayer:function(){},_notifyProcessStart:function(){}})})},"esri/workers/RequestClient":function(){define(["../core/declare","dojo/_base/xhr","../config","./WorkerClient"],function(w,l,f,a){function d(a,d){var f=new b;f.addWorkerCallback(a,d);q.unshift({id:d?a+"::"+d:a,client:f});q.length>t&&q.pop().client.terminate();return f}var b=w([a],{declaredClass:"esri.workers.RequestClient",constructor:function(){this.setWorker(["./mutableWorker","./requestWorker"],function(){})},get:function(a){return this._send("GET",
a)},post:function(a){return this._send("POST",a)},_send:function(a,b){b=l._ioSetArgs(b);b.xhr=null;var d=b.ioArgs,f=d.url;delete d.url;delete d.args;this.postMessage({method:a,url:f,options:d}).then(this._getSuccessHandler(b),this._getErrorHandler(b),this._getProgressHandler(b));return b},_addHeaderFunctions:function(a){a.getResponseHeader=function(b){var d,f=a.headers;Object.keys(f).forEach(function(a){if(a.toLowerCase()==b.toLowerCase())return d=f[a],!1});return d};a.getAllResponseHeaders=function(){var b=
[],d=a.headers;Object.keys(d).forEach(function(a){b.push(a+": "+d[a])});return b=b.join("\n")};return a},_getSuccessHandler:function(a){var b=this,d=a.ioArgs;return function(f){a.xhr=b._addHeaderFunctions(f);f=a.xhr.getResponseHeader("content-type");("xml"==d.handleAs||-1<f.indexOf("xml"))&&"string"==typeof a.xhr.response&&(a.xhr.response=(new DOMParser).parseFromString(a.xhr.response,"text/xml"));a.resolve(a.xhr.response,a.xhr)}},_getErrorHandler:function(a){return function(b){a.reject(b)}},_getProgressHandler:function(a){return function(b){a.progress(b)}}}),
q=[],t=f.request.maxWorkers,m=new b;b.getClient=function(a,b){if(a){var f;q.some(function(d){d.id==(b?a+"::"+b:a)&&(f=d.client);return!0});return f||d(a,b)}return m};b.setLimit=function(a){t=f.request.maxWorkers=a};return b})},"esri/workers/WorkerClient":function(){define("dojo/Evented ../core/declare dojo/Deferred dojo/_base/lang dojo/request ../core/sniff ../core/urlUtils require".split(" "),function(w,l,f,a,d,b,q,t){var m=window.Blob||window.webkitBlob||window.mozBlob,k=window.URL||window.webkitURL||
window.mozURL;return l([w],{declaredClass:"esri.workers.WorkerClient",worker:null,_queue:null,constructor:function(d,f){this._isIE=b("ie");this._queue={};this._acceptMessage=a.hitch(this,this._acceptMessage);this._errorMessage=a.hitch(this,this._errorMessage);d&&this.setWorker(d,function(a){this.worker=a;f(this)}.bind(this))},setWorker:function(a,b){if(a instanceof Array){var d=a;a=d.shift()}var f=this._getUrl(a),f=q.normalize(f);a=!q.hasSameOrigin(f,location.href);var l;if(!1===f)return console.log("Can not resolve worker path"),
!1;this.worker&&(l=this.worker,l.removeEventListener("message",this._acceptMessage,!1),l.removeEventListener("error",this._errorMessage,!1),l.terminate(),l=null);if(a){a=this._getUrl("./mutableWorker",!0);try{this._getRemoteText(a,function(a){a=k.createObjectURL(new m([a],{type:"text/javascript"}));b(this._createWorker(a,f))}.bind(this))}catch(u){try{a=q.getProxyUrl(a).path+"?"+encodeURI(a),this._useProxy=!0,b(this._createWorker(a,d))}catch(C){return console.log("Can not create worker"),!1}}}else b(this._createWorker(f,
d))},_createWorker:function(a,b){a=new Worker(a);a.addEventListener("message",this._acceptMessage,!1);a.addEventListener("error",this._errorMessage,!1);this.worker=a;b&&this.importScripts(b);return a},postMessage:function(a,b){if(a instanceof Array||"object"!=typeof a)a={data:a};var d=Math.floor(64E9*Math.random()).toString(36);a.msgId=d;d=this._queue[d]=new f;this.worker?(b?this.worker.postMessage(a,b):this.worker.postMessage(a),this.emit("start-message",{target:this,message:a})):d.reject({message:"No worker was set."});
return d.promise},terminate:function(){var a=Object.keys(this._queue);this.worker&&this.worker.terminate();for(var b=a.length-1;0<=b;b--)this._queue[a[b]].cancel("terminated"),delete this._queue[a[b]]},addWorkerCallback:function(b,d){var k=this._getUrl(b,!0);return!1===k?(d=new f,d.reject({message:"Could not load text from "+b}),d.promise):this.postMessage({action:"add-callback",url:k,cbName:d||"main"}).then(a.hitch(this,function(a){a.target=this;this.emit("callback-added",a)}))},importScripts:function(b){Array.isArray(b)||
(b=[b]);b=b.map(function(a){a=this._getUrl(a,!0);this._useProxy&&!q.hasSameOrigin(a,location.href)&&(a=q.getProxyUrl(a).path+"?"+encodeURI(a));return a},this);return this.postMessage({action:"import-script",url:b}).then(a.hitch(this,function(a){a.target=this;this.emit("scripts-imported",a)}))},_acceptMessage:function(a){var b=a.data,d=b.msgId;if(b.status&&"debug"==b.status)console[b.showAs||"debug"](b);else if(d&&d in this._queue){var f=this._queue[d];"progress"==b.status?f.progress(a.data):("error"==
b.status?f.reject(a.data):f.resolve(a.data),delete this._queue[d])}this.emit("message",{message:a.data,event:a,target:this})},_errorMessage:function(a){this.onerror||this.onError?this.onerror?this.onerror(a):this.onError(a):console.log("Worker Error: "+a.message+"\nIn "+a.filename+" on "+a.lineno)},_getUrl:function(a,b){if(!a)return console.error("can not resolve empty path"),!1;a.match(/\.js$/)||(a+=".js");a=t.toUrl(a);return b?q.makeAbsolute(a):a},_getRemoteText:function(a,b){(a=this._getUrl(a))&&
d.get(a,{sync:!1,handleAs:"text",headers:{"X-Requested-With":"","Content-Type":"text/plain"}}).then(function(a){b(a)})},_startBlobWorker:function(){var a=this._xdSource;a||(a=this._getUrl("./mutableWorker"),a=new m(["if(!self._mutable){importScripts('"+a+"');}"],{type:"text/javascript"}),a=this._xdSource=k.createObjectURL(a));try{return new Worker(a)}catch(x){return console.log(x.message),!1}}})})},"esri/layers/GraphicsLayer":function(){define("../core/Accessor ../core/Collection ../core/promiseUtils ./Layer ./mixins/ScaleRangeLayer ../Graphic dojo/_base/lang".split(" "),
function(w,l,f,a,d,b,q){var t=w.createSubclass({properties:{layer:null,layerView:null,graphics:null}});return a.createSubclass([d],{declaredClass:"esri.layers.GraphicsLayer",viewModulePaths:{"2d":"../views/2d/layers/GraphicsLayerView2D","3d":"../views/3d/layers/FeatureLayerView3D"},getDefaults:function(a){return q.mixin(this.inherited(arguments),{graphics:[]})},destroy:function(){this.removeAll()},_gfxHdl:null,properties:{elevationInfo:null,graphics:{type:l.ofType(b),set:function(a){var b=this._get("graphics");
b||(a.forEach(function(a){a.layer=this},this),this._gfxHdl=a.on("change",function(a){var b,d,f;f=a.added;for(b=0;d=f[b];b++)d.layer=this;f=a.removed;for(b=0;d=f[b];b++)d.layer=null}.bind(this)),this._set("graphics",a),b=a);b.removeAll();b.addMany(a)}},screenSizePerspectiveEnabled:!0,type:{readOnly:!0,value:"graphics"}},add:function(a){this.graphics.add(a);return this},addMany:function(a){this.graphics.addMany(a);return this},removeAll:function(){this.graphics.removeAll();return this},createGraphicsController:function(a){return f.resolve(new t({layer:this,
layerView:a.layerView,graphics:this.graphics}))},remove:function(a){this.graphics.remove(a)},removeMany:function(a){this.graphics.removeMany(a)},graphicChanged:function(a){this.emit("graphic-update",a)}})})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define(["require","exports"],function(w,l){return function(){function f(){this.elevationDirtyGraphicsQueue=[];this.elevationDirtyGraphicsSet={};this.elevationUpdateEventHandle=null;this.eventHandles=[];this.updateElevation=
!1;this.graphicsCore=this.layerView=null}f.prototype.initialize=function(a,d,b,f){var l=this;this.layerView=a;this.graphicsCore=b;this.elevationProvider=f;this.getGraphicsInExtent=d;this.elevationUpdateEventHandle=f.on("elevation-change",function(a){return l.elevationUpdateHandler(a)});this.eventHandles.push(this.layerView.watch("suspended",function(){return l.suspendedChange()}))};f.prototype.destroy=function(){this.elevationDirtyGraphicsSet=this.elevationDirtyGraphicsQueue=null;this.elevationUpdateEventHandle&&
(this.elevationUpdateEventHandle.remove(),this.elevationUpdateEventHandle=null);this.eventHandles.forEach(function(a){return a.remove()});this.getGraphicsInExtent=this.graphicsCore=this.layerView=this.eventHandles=null};f.prototype.clear=function(){this.elevationDirtyGraphicsSet={};this.elevationDirtyGraphicsQueue=[]};f.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&this.markAllGraphicsElevationDirty()};
f.prototype.isUpdating=function(){return 0<this.elevationDirtyGraphicsQueue.length};f.prototype.numNodesUpdating=function(){return this.elevationDirtyGraphicsQueue.length};f.prototype.needsIdleUpdate=function(){return this.elevationProvider&&0<this.elevationDirtyGraphicsQueue.length};f.prototype.idleUpdate=function(a){if(!a.done()){var d=this.layerView.view,b=this.elevationDirtyGraphicsQueue.length;if(0<b){for(var f=this.graphicsCore.stageLayer.getId(),l=this.graphicsCore.labelStageLayer?this.graphicsCore.labelStageLayer.getId():
null,m=0,k=0,k=0;k<b;k++){var p=this.elevationDirtyGraphicsQueue[k],x=this.graphicsCore.graphics[p];x&&x.alignWithElevation(this.elevationProvider,d.renderCoordsHelper);delete this.elevationDirtyGraphicsSet[p];m++;if(20<=m){d._stage.processDirtyLayer(f);null!=l&&d._stage.processDirtyLayer(l);if(a.done())break;m=0}}d._stage.processDirtyLayer(f);null!=l&&d._stage.processDirtyLayer(l);this.elevationDirtyGraphicsQueue.splice(0,k+1);d.deconflictor.setDirty();this.layerView._evaluateUpdatingState()}}};
f.prototype.markAllGraphicsElevationDirty=function(){for(var a in this.graphicsCore.graphics)this.markGraphicElevationDirty(this.graphicsCore.graphics[a].graphic.uid);this.layerView._evaluateUpdatingState()};f.prototype.markGraphicElevationDirty=function(a){this.elevationDirtyGraphicsSet[a]||(this.elevationDirtyGraphicsSet[a]=!0,this.elevationDirtyGraphicsQueue.push(a))};f.prototype.elevationUpdateHandler=function(a){var d=this,b=a.extent;this.layerView.suspended?this.updateElevation||(a=this.graphicsCore.computedExtent)&&
b[2]>a.xmin&&b[0]<a.xmax&&b[3]>a.ymin&&b[1]<a.ymax&&(this.updateElevation=!0):-Infinity===b[0]?this.markAllGraphicsElevationDirty():this.getGraphicsInExtent(b,a.spatialReference,function(a,b){for(var f=!1,k=0;k<b;k++){var l=a[k],q=d.graphicsCore.graphics[l];q&&q.needsElevationUpdates()&&(d.markGraphicElevationDirty(l),f=!0)}f&&d.layerView._evaluateUpdatingState()})};return f}()})},"esri/views/3d/navigation/spherical/NavigationSpherical":function(){define("../Navigation ./ConstraintsSpherical ./AnimationSpherical ./actions/PanSpherical ./actions/ZoomSpherical ./actions/RotateSpherical ../../webgl-engine/lib/Camera ../../support/earthUtils ../../lib/glMatrix".split(" "),
function(w,l,f,a,d,b,q,t,m){var k=m.vec3d,p=m.mat4d,x=k.create(),z=k.create(),v=p.create();return w.createSubclass([l,f],{declaredClass:"esri.views.3d.navigation.spherical.NavigationSpherical",initialize:function(){this.pan=new a({navigation:this});this.zoom=new d({navigation:this});this.rotate=new b({navigation:this});this._intersectTerrainSelector.enableBackfacesTerrain=!1},getInitialCamera:function(){return new q(k.createFrom(4*t.earthRadius,0,0),k.createFrom(t.earthRadius,0,0),k.createFrom(0,
0,1))},fixTargetUpVector:function(){this.cameras.target.computeUpOnSphere()},setPoiAuto:function(a,b){a=this.picker.pickAlongRay(this.cameras.target.eye,this.cameras.target.center,null,a);this.picker.pickedIntersectionPoint(a,x)&&(this.setCameraFromEyeAndCenter(this.cameras.target.eye,x,{animate:!1}),k.set(this.cameras.target.center,this.cameras.current.center),b&&this.setCurrentToTarget())},rotateCameraWithPointsOnSphere:function(a,b,d,f,c){var m;null==c&&(c=k.length(a));m=Math.abs(k.length(b)-c);
1E-4<=m&&(console.error("[NavigationSpherical.rotateCameraWithPointsOnSphere: invalid radius for target point (got "+c+", but expected "+k.length(b)+")"),c=k.length(b));m=Math.abs(k.length(a)-c);1E-4<=m&&(console.error("[NavigationSpherical.rotateCameraWithPointsOnSphere]: invalid radius for source point (got "+c+", but expected "+k.length(a)+", "+a+")"),c=k.length(a));a=this.rotationFromPointsOnSphere(a,b,c,z);p.identity(v);p.rotate(v,a,z);p.multiplyVec3(v,d.eye,f.eye);p.multiplyVec3(v,d.center,
f.center);p.multiplyVec3(v,d.up,f.up)},rotationFromPointsOnSphere:function(a,b,d,f){k.cross(a,b,f);return-Math.acos(1-k.dist2(a,b)/(2*d*d))}})})},"esri/views/3d/navigation/Navigation":function(){define(["../../../core/Accessor","../../../core/Evented","../../../core/watchUtils","./Picker","./mixins/CamerasMixin"],function(w,l,f,a,d){return w.createSubclass([d,l],{properties:{interacting:{get:function(){return this._interacting},readOnly:!0},renderCoordsHelper:{},renderUnitInMeters:{dependsOn:["renderCoordsHelper"],
get:function(){return this.renderCoordsHelper?this.renderCoordsHelper.unitInMeters:1}},picker:{},constraints:{},pan:{},zoom:{},rotate:{},view:{}},initialize:function(){this._mapCoordsHelperHandle=f.init(this.view,"mapCoordsHelper",function(a){this.mapCoordsHelper=a}.bind(this));this._renderCoordsHelperHandle=f.init(this.view,"renderCoordsHelper",this.updateRenderCoordsHelper.bind(this));this.picker=new a(this,this.view);this._interacting=!1},destroy:function(){this._mapCoordsHelperHandle.remove();
this._renderCoordsHelperHandle.remove()},updateRenderCoordsHelper:function(a){this.renderCoordsHelper=a;this.inherited(arguments)},begin:function(a){this.pan&&this.pan.continuous&&this.pan.continuous.stop();this.pan&&this.pan.momentum&&(this.pan.momentum=null);this._interacting=!0;this.notifyChange("interacting")},end:function(a){this._interacting=!1;this.notifyChange("interacting")}})})},"esri/views/3d/navigation/Picker":function(){define(["../../../core/declare","../lib/glMatrix","../webgl-engine/lib/Selector"],
function(w,l,f){var a=l.vec3d,d=a.create(),b=a.create();return w([],{constructor:function(a,b){this.navigation=a;this.pickAlongRay=b._pickRay.bind(b);this.createPickRay=b._pickRayWithBeginPoint.bind(b);this.renderCoordsHelper=b.renderCoordsHelper;this.selector=new f(b.viewingMode)},pickPointInScreen:function(a,b){return this.pickedIntersectionPoint(this.pickInScreen(a,!1),b)},pickFreePointInScreen:function(f,l){this.createPickRay(f,void 0,this.navigation.currentCamera.viewMatrix,d,b);l||(l=a.create());
a.subtract(b,d);a.normalize(b);var m=this.navigation.view.dataExtent;f=Math.max(m.xmax-m.xmin,m.ymax-m.ymin,8*Math.max(m.xmax-m.xmin,m.ymax-m.ymin));var k=this.navigation.currentCamera,p=Math.max(0,m.xmin-k.eye[0],k.eye[0]-m.xmax),m=Math.max(0,m.ymin-k.eye[1],k.eye[1]-m.ymax),p=Math.sqrt(p*p+m*m),m=this.renderCoordsHelper.getAltitude(k.eye),k=this.navigation._getTerrainElevationBelowCamera(k),k=f/Math.max(1,Math.pow(Math.max(0,Math.log(f/(Math.abs(m-k)+Number.MIN_VALUE))),2)),k=Math.max(k,Math.min(p,
f));a.scale(b,k);a.add(d,b,l)},pickInScreen:function(f,l){this.createPickRay(f,void 0,this.navigation.currentCamera.viewMatrix,d,b);l&&a.set(this.navigation.currentCamera.eye,d);return this.pickAlongRay(d,b,f,f,null,null,this.selector)},pickedIntersectionPoint:function(b,d){if(!b)return!1;d||(d=a.create());return b.getMinResult().getIntersectionPoint(d)}})})},"esri/views/3d/navigation/mixins/CamerasMixin":function(){define("../../../../core/Accessor ../../../../core/Evented ../../webgl-engine/lib/Camera ../../support/mathUtils ../../lib/glMatrix dojo/on".split(" "),
function(w,l,f,a,d,b){var q=d.vec4d.create();return w.createSubclass([l],{declaredClass:"esri.views.3d.navigation.mixins.CamerasMixin",properties:{targetCamera:{get:function(){return this.cameras.target}},currentCamera:{get:function(){return this.cameras.current}},windowSize:{set:function(a){var b=a[0],d=a[1],f=!1,l=this.cameras.target.x-this.cameras.target.padding[3],q=this.cameras.target.y-this.cameras.target.padding[2];if(this.cameras.target.width+l!==b||this.cameras.target.height+q!==d)this.cameras.target.width=
b-l,this.cameras.target.height=d-q,this.targetChanged(),f=!0;l=this.cameras.current.x-this.cameras.current.padding[3];q=this.cameras.current.y-this.cameras.current.padding[2];if(this.cameras.current.width+l!==b||this.cameras.current.height+q!==d)this.cameras.current.width=b-l,this.cameras.current.height=d-q,this.currentChanged(),f=!0;f&&this.currentHasReachedTarget()&&this.currentReachedTarget();this._set("windowSize",a)}},padding:{set:function(b){var d=!1,f=!1;q[0]=b.top;q[1]=b.right;q[2]=b.bottom;
q[3]=b.left;a.vectorEquals(this.cameras.current.padding,q)||(this.cameras.current.padding=q,f=!0);a.vectorEquals(this.cameras.target.padding,q)||(this.cameras.target.padding=q,d=!0);d&&this.targetChanged();f&&this.currentChanged();this.currentHasReachedTarget()&&(d||f)&&this.currentReachedTarget()}}},initialize:function(){var a=this.getInitialCamera();this.cameras={current:a,target:a.copy()}},currentHasReachedTarget:function(){return this.cameras.current.equals(this.cameras.target)},currentHasAlmostReachedTarget:function(){return this.cameras.current.almostEquals(this.cameras.target,
5E-4/this.renderUnitInMeters)},setCamera:function(a,b){this.pan&&this.pan.continuous&&this.pan.continuous.stop();this.pan&&this.pan.momentum&&(this.pan.momentum=null);this.cameras.target.copyFrom(a);var d=!(b&&b.internalUpdate)||!this._targetCameraChangedByElevationUpdate;d&&this._targetCameraBeforeElevationUpdate.copyFrom(a);this._targetCameraAnimated.copyFrom(this.cameras.target);this.applyConstraints(this._targetCameraAnimated,!0);a=!1;this.constrainTargetEyeByElevation()&&(a=!0);this.applyConstraints(this.cameras.target,
!0)&&(a=!0);this.fixTargetUpVector();this.currentHasReachedTarget()?(this.targetChanged(),a&&d&&(this._targetCameraChangedByElevationUpdate=!0),this.currentReachedTarget()):(void 0===b||void 0===b.animate||b.animate?this.targetAnimatedChanged(!1,b,!0):(this.targetAndCurrentChanged(!0),a=!0),a&&d&&(this._targetCameraChangedByElevationUpdate=!0),this._autoUpdateTiltConstraint())},getTargetCamera:function(){console.warn("[Navigation.getTargetCamera()] deprecated; use .targetCamera instead");return this.targetCamera},
getCurrentCamera:function(){console.warn("[Navigation.getCurrentCamera()] deprecated; use .currentCamera instead");return this.currentCamera},_cameraFromEyeCenterUp:function(a,b,d){var f=this.cameras.target.copy();f.eye=a;f.center=b;f.up=d;return f},setCameraFromEyeAndCenter:function(a,b,d){this.setCamera(this._cameraFromEyeCenterUp(a,b,this.cameras.target.up),d)},setCameraFromEyeCenterAndUp:function(a,b,d,f){this.setCamera(this._cameraFromEyeCenterUp(a,b,d),f)},_cameraEvents:{},_prepareCameraEvent:function(a,
b){var d=this._cameraEvents[a];d||(d={camera:new f},this._cameraEvents[a]=d);d.camera.copyFrom(b);return d},emitWithCamera:function(a,d){b.emit(this,a,this._prepareCameraEvent(a,d))},targetChanged:function(a){this.inherited(arguments);this.cameras.target.markViewDirty();var d=this._prepareCameraEvent("targetViewChanged",this.cameras.target);d.interruptedAnimation=!!a;d.finishedAnimation=!1;b.emit(this,"targetViewChanged",d)},targetAnimatedChanged:function(a,b,d){this.targetChanged(a);this.startAnimation(b,
d)},targetAndCurrentChanged:function(a){this.targetChanged(a);this.setCurrentToTarget(!1,a)},currentChanged:function(){this.inherited(arguments);this.cameras.current.markViewDirty();this.emitWithCamera("currentViewChanged",this.cameras.current)},currentReachedTarget:function(a,d){this.inherited(arguments);this.currentChanged();if(!(this.pan&&this.pan.continuous&&this.pan.continuous.active)){var f=this._prepareCameraEvent("currentViewReachedTarget",this.cameras.current);f.finishedAnimation=!!a;f.interruptedAnimation=
!!d;b.emit(this,"currentViewReachedTarget",f)}},setCurrentToTarget:function(a,b){this.cameras.current.copyFrom(this.cameras.target);this.currentReachedTarget(a,b)}})})},"esri/views/3d/navigation/spherical/ConstraintsSpherical":function(){define("../mixins/ConstraintsMixin ../../support/mathUtils ../../support/earthUtils ../../lib/glMatrix ../../webgl-engine/lib/Util ../../constraints/SceneViewAltitudeConstraint ../../constraints/SceneViewTiltConstraint".split(" "),function(w,l,f,a,d,b,q){var t=a.vec3d,
m=t.create(),k=t.create(),p=t.create();return w.createSubclass({declaredClass:"esri.views.3d.navigation.spherical.ConstraintsSpherical",defaultConstraints:{tilt:new w.Tilt({min:function(){return l.deg2rad(q.MAX_DEFAULT)},max:l.makePiecewiseLinearFunction([[4E3,l.deg2rad(q.MIN_DEFAULT)],[5E4,l.deg2rad(88)],[6E6,l.deg2rad(88)],[2E7,l.deg2rad(q.MAX_DEFAULT)]])}),altitude:new w.Altitude({min:function(){return b.MIN_DEFAULT},max:function(){return b.MAX_DEFAULT}}),collision:new w.Collision},initialize:function(){this.captainNemoAltitudeThreshold=
2E4;this.captainNemoElevationThreshold=-500},limitAltitude:function(a,b,l){t.scale(l,a/t.length(l),m);var r=t.subtract(b,m,m),q=this.renderCoordsHelper.getAltitude(r),v=this.constraints.altitude.apply(this,q);return 1E-6<Math.abs(q-v)&&(r=q<v?b:r,l=q<v?t.scale(l,-1,p):l,d.raySphere(r,l,null,v+f.earthRadius,k))?t.dist(b,k):a},tiltConstraintsFromAltitudeConstraints:function(a,b){var d=this.constraints.altitude.min(),k=this.constraints.altitude.max();a=t.length2(a);var m=Math.sqrt(a),d=d+f.earthRadius,
k=k+f.earthRadius,k=(k*k-b*b-a)/(2*m*b);b=Math.acos(l.clamp((d*d-b*b-a)/(2*m*b),-1,1));return{min:Math.acos(l.clamp(k,-1,1)),max:b}},distanceToSilhouette:function(a,b,d,k,m){m||(m={maxFarNearRatio:0,distance:0});a=t.dot(a.eye,a.eye);b=f.earthRadius*f.earthRadius;m.maxFarNearRatio=this.maxFarNearRatio;this.isNemoMode(a,k)?(k=f.earthRadius+k,m.distance=Math.sqrt(a-k*k)):a>b?(m.maxFarNearRatio=l.clamp(2E4-(Math.log(Math.sqrt(a)-f.earthRadius)-7.983)/9.011*19E3,1E3,2E4),m.distance=Math.sqrt(a-b)):m.distance=
this.maxFarNearRatio*this.minNearDistance;m.distance*=1.2;return m},isNemoMode:function(a,b){var d=f.earthRadius+this.captainNemoAltitudeThreshold;return a<d*d&&b<this.captainNemoElevationThreshold},getFallbackCenterAlongViewDirection:function(a,b,d){var k=t.dot(a,a),m=f.earthRadius*f.earthRadius,k=k>m?Math.sqrt(k-m)/3:1;t.subtract(b,a,d);t.scale(d,k/t.length(d),d);t.add(d,a)}})})},"esri/views/3d/navigation/mixins/ConstraintsMixin":function(){define("../../../../core/Accessor ../../../../core/watchUtils ../../../../geometry/Point ../../support/mathUtils ../../lib/glMatrix ../../constraints/SceneViewAltitudeConstraint ../../webgl-engine/lib/Camera ../../webgl-engine/lib/IntervalUtilities ../../webgl-engine/lib/Selector".split(" "),
function(w,l,f,a,d,b,q,t,m){function k(b){return new G.Tilt({min:function(){return.01},max:function(){return a.deg2rad(b.tilt.max)}})}function p(a){return new G.Altitude({min:function(){return a.altitude.min},max:function(){return a.altitude.max}})}var x=d.vec3d,z=d.mat4d,v=new f,r=x.create(),u=z.create(),C=x.create(),E=x.create(),c=new q,D=x.create(),B={tilt:0,distance:0},I={distance:0,maxFarNearRatio:0},G=w.createSubclass([],{declaredClass:"esri.views.3d.navigation.mixins.ConstraintsMixin",properties:{userConstraints:{set:function(a){this._disconnectUserConstraints();
this._connectUserConstraints(a);this._set("userConstraints",a)}},elevationProvider:{value:null,set:function(a){null!==this._elevationChangeHandle&&(this._elevationChangeHandle.remove(),this._elevationChangeHandle=null);null!==this._elevationChangeTileHandle&&(this._elevationChangeTileHandle.remove(),this._elevationChangeTileHandle=null);null!==a&&(this._elevationChangeHandle=a.on("elevation-change",this._elevationChangeHandler.bind(this)),this._elevationChangeTileHandle=a.on("tile-geometry-change",
this._elevationChangeTileHandler.bind(this)));this._set("elevationProvider",a)}},minPoiDist:{get:function(){return this._minPoiDistInMeters/this.renderUnitInMeters},dependsOn:["renderUnitInMeters"]},cameraElevationMargin:{get:function(){return this._cameraElevationMarginInMeters/this.renderUnitInMeters},dependsOn:["renderUnitInMeters"]},minNearDistance:{get:function(){return this._minNearDistanceInMeters/this.renderUnitInMeters},dependsOn:["renderUnitInMeters"]},renderUnitInMeters:{},constraintsEnabled:{value:!0}},
constructor:function(a){this._userConstraints=null;this._userConstraintsHandles=[];this._clipDistanceHandles=[];this._tiltHandles=[];this._altitudeHandles=[];this.constraints={tilt:this.defaultConstraints.tilt,altitude:this.defaultConstraints.altitude,collision:this.defaultConstraints.collision};this._tiltModeHandler=this._tiltModeHandler.bind(this);this._tiltMaxHandler=this._tiltMaxHandler.bind(this);this._altitudeModeHandler=this._altitudeModeHandler.bind(this);this._altitudeMinMaxHandler=this._altitudeMinMaxHandler.bind(this);
this._clipDistanceModeHandler=this._clipDistanceModeHandler.bind(this);this._clipDistanceNearFarHandler=this._clipDistanceNearFarHandler.bind(this);this._collisionEnabledHandler=this._collisionEnabledHandler.bind(this);this.enableElevationUpdates=!0;this.updateTargetByElevationUpdates=G.UPDATE_TARGET_BY_ELEVATION_UPDATES_DEFAULT;this._recomputeTargetEyeForElevationChange=this._recomputeTargetCenterForElevationChange=!1;this._elevationChangeTileHandle=this._elevationChangeHandle=null;this._autoAltitudeConstraints=
{min:b.MIN_DEFAULT,max:b.MAX_DEFAULT};this.maxFarNearRatio=2E4;this._minNearDistanceInMeters=2;this._minPoiDistInMeters=4;this._cameraElevationMarginInMeters=5;this._intersectTerrainSelector=new m(a.view.viewingMode);this._intersectTerrainSelector.enableInvisibleTerrain=!0},initialize:function(){this._targetCameraBeforeElevationUpdate=this.cameras.current.copy();this._targetCameraChangedByElevationUpdate=!1;this._sceneExtentChangeHandle=this.view.watch("dataExtent",function(a){this._dataExtentChanged()}.bind(this))},
_dataExtentChanged:function(){this.view.ready&&0<this.view.dataExtent.xmax-this.view.dataExtent.xmin&&(this._updateSurfaceDistanceConstraint(this.view.dataExtent),this._reapplyConstraints(),this._camerasChanged())},_updateSurfaceDistanceConstraint:function(a){},updateRenderCoordsHelper:function(a,b){this.inherited(arguments);this._userConstraints&&"auto"!==this._userConstraints.altitude.mode||(this.constraints.altitude=G.Altitude.scale(this.defaultConstraints.altitude,a.unitInMeters));this._userConstraints&&
"auto"!==this._userConstraints.tilt.mode||(this.constraints.tilt=G.Tilt.scale(this.defaultConstraints.tilt,a.unitInMeters));this._updateSurfaceDistanceConstraint(this.view.dataExtent);this._reapplyConstraints();this._camerasChanged()},destroy:function(){this._disconnectUserConstraints();this._sceneExtentChangeHandle.remove()},_updateTargetCenterForElevation:function(a){this._recomputeTargetCenterForElevationChange=!1;if(a||this.enableElevationUpdates&&this.updateTargetByElevationUpdates)if(this._targetCameraChangedByElevationUpdate?
a=this._targetCameraBeforeElevationUpdate:(a=this.cameras.target,this._targetCameraBeforeElevationUpdate.copyFrom(a)),(a=this.getCameraIntersectTerrain(a.eye,a.center,a.up,.02))&&!a.equals(this.cameras.target))return this.setCamera(a,{internalUpdate:!0}),this._targetCameraChangedByElevationUpdate=!0;return!1},_updateTargetCenterForElevationWhenIdle:function(){var a=this.isAnimating,b=!1;if(!(this.pan&&this.pan.continuous&&this.pan.continuous.active||this.pan.active||this.zoom.active||this.rotate.active||
a)&&this._recomputeTargetCenterForElevationChange){var c=this._targetCameraChangedByElevationUpdate;this._updateTargetCenterForElevation()&&(b=!0);this._targetCameraChangedByElevationUpdate=c}!a&&this._recomputeTargetEyeForElevationChange&&this._updateTargetEyeForElevationChange()&&(b=!0);return b},step:function(){this._updateTargetCenterForElevationWhenIdle();this.inherited(arguments)},applyTiltConstraint:function(a){if(!this.constraintsEnabled)return!1;var b=!1,c=this._cameraElevationAngle(a,B),
d=this.constraints.tilt.min(c.distance),f=this.constraints.tilt.max(c.distance),k=0;c.tilt>f?k=c.tilt-f:c.tilt<d&&(k=c.tilt-d);.01<Math.abs(k)&&(z.identity(u),z.rotate(u,-k,a.viewRight),x.subtract(a.center,a.eye,r),z.multiplyVec3(u,r),x.subtract(a.center,r,a.eye),z.multiplyVec3(u,a.up),b=!0);this._autoUpdateTiltConstraint(f);return b},adjustTiltAfterZoom:function(a){return this.applyTiltConstraint(a)},applyConstraints:function(a,b,c){if(!this.constraintsEnabled)return!1;b=!1;c&&(b=this.applyTiltConstraint(a));
x.subtract(a.center,a.eye,C);c=a.distance;var d=this.limitAltitude(c,a.center,C);c!==d&&(x.scale(C,-d/c),x.add(a.center,C,a.eye),b=!0);return b},limitTumbleByConstraints:function(a,b,c,d){if(!this.constraintsEnabled)return b;var f=this.tiltConstraintsFromAltitudeConstraints(c,d);c=Math.max(this.constraints.tilt.min(d),f.min);d=Math.min(this.constraints.tilt.max(d),f.max);this._autoUpdateTiltConstraint(d);b=a+b;b>=d?b=Math.max(d,Math.min(b,a)):b<=c&&(b=Math.min(c,Math.max(b,a)));return b-a},_autoUpdateAltitudeConstraint:function(){var a=
this._userConstraints&&this._userConstraints.altitude;a&&"auto"===a.mode&&a.autoUpdate(this.constraints.altitude.min(this),this.constraints.altitude.max(this))},_autoUpdateTiltConstraint:function(b){var c=this._userConstraints&&this._userConstraints.tilt;void 0===b&&(b=this.constraints.tilt.max(this.cameras.target.distance));c&&"auto"===c.mode&&c.autoUpdate(a.rad2deg(b))},_disconnectUserConstraints:function(){if(this._userConstraints){this._userConstraintsHandles.forEach(function(a){a.remove()});
this._userConstraints=null;this._userConstraintsHandles.length=0;var a=this.renderUnitInMeters;this.constraints.tilt=G.Tilt.scale(this.defaultConstraints.tilt,a);this.constraints.altitude=G.Altitude.scale(this.defaultConstraints.altitude,a)}},_connectUserConstraints:function(a){a&&(this._userConstraints=a,this._userConstraintsHandles.push(l.init(a,"tilt.mode",this._tiltModeHandler),l.init(a,"clipDistance.mode",this._clipDistanceModeHandler),l.init(a,"altitude.mode",this._altitudeModeHandler),l.init(a,
"collision.enabled",this._collisionEnabledHandler)))},_camerasChanged:function(){var a=this._targetCameraChangedByElevationUpdate;this.targetChanged();this._targetCameraChangedByElevationUpdate=a;this.currentChanged();this.currentHasReachedTarget()&&this.currentReachedTarget()},_reapplyConstraints:function(a){var b=!1;this.applyConstraints(this.cameras.current,void 0,a)&&(b=!0);this.applyConstraints(this.cameras.target,void 0,a)&&(b=!0);b&&this._camerasChanged()},_userConstraintsChanged:function(){this._reapplyConstraints(!0)},
_altitudeMinMaxHandler:function(a,b,c){this._userConstraintsChanged()},_tiltMaxHandler:function(a,b,c){this._userConstraintsChanged()},_tiltModeHandler:function(a){this._tiltHandles.forEach(function(a){a.remove()});this._tiltHandles.length=0;"auto"===a?this.constraints.tilt=G.Tilt.scale(this.defaultConstraints.tilt,this.renderUnitInMeters):(this._tiltHandles.push(this._userConstraints.watch("tilt.max",this._tiltMaxHandler)),this.constraints.tilt=k(this._userConstraints));this._tiltMaxHandler()},_altitudeModeHandler:function(a){this._altitudeHandles.forEach(function(a){a.remove()});
this._altitudeHandles.length=0;"auto"===a?(this.constraints.altitude=G.Altitude.scale(this.defaultConstraints.altitude,this.renderUnitInMeters),this._autoUpdateAltitudeConstraint()):(this._altitudeHandles.push(this._userConstraints.watch("altitude.min",this._altitudeMinMaxHandler),this._userConstraints.watch("altitude.max",this._altitudeMinMaxHandler)),this.constraints.altitude=p(this._userConstraints));this._altitudeMinMaxHandler()},_collisionEnabledHandler:function(a,b,c){this.constraints.collision=
new G.Collision(this._userConstraints.collision.enabled);this._userConstraintsChanged()},_clipDistanceNearFarHandler:function(a,b,c){"auto"!==this._userConstraints.clipDistance.mode&&(this.cameras.target.near=this._userConstraints.clipDistance.near,this.cameras.target.far=this._userConstraints.clipDistance.far,this.cameras.current.near=this._userConstraints.clipDistance.near,this.cameras.current.far=this._userConstraints.clipDistance.far);this._camerasChanged()},_clipDistanceModeHandler:function(a){this._clipDistanceHandles.forEach(function(a){a.remove()});
this._clipDistanceHandles.length=0;"auto"!==a&&this._clipDistanceHandles.push(this._userConstraints.watch(["clipDistance.near","clipDistance.far"],this._clipDistanceNearFarHandler));this._clipDistanceNearFarHandler()},_updateAutoNearFar:function(a){var b=this._userConstraints&&this._userConstraints.clipDistance;if(!b||"auto"===b.mode){var c=this.renderUnitInMeters,d=this.distanceToSilhouette(a,this.view.dataExtent,c,this._getTerrainElevationBelowCamera(a),I);a.far=d.distance/c;a.far/d.maxFarNearRatio>
this.minNearDistance?a.near=a.far/d.maxFarNearRatio:(a.near=this.minNearDistance,a.far=a.near*d.maxFarNearRatio);b&&a===this.cameras.current&&b.autoUpdate(a.near,a.far)}},constrainTargetEyeByElevation:function(){var a=!1,b=this.elevationProvider;b&&b.spatialReference&&(a=this.cameras.target,b=this._getTerrainElevationBelowCamera(a),a=this._applyElevationConstraint(a.eye,b,this.cameraElevationMargin));return a},constrainTargetEyeByElevationAndMoveLookAt:function(){x.set(this.cameras.target.eye,E);
this.constrainTargetEyeByElevation()&&(x.subtract(E,this.cameras.target.eye),x.subtract(this.cameras.target.center,E))},targetChanged:function(a){this.inherited(arguments);this._targetCameraChangedByElevationUpdate=!1;this._updateAutoNearFar(this.cameras.target);this.currentHasReachedTarget()&&this.currentReachedTarget()},currentChanged:function(){this._updateAutoNearFar(this.cameras.current);this.inherited(arguments)},_applyElevationConstraint:function(a,b,c){if(!this.constraintsEnabled)return!1;
var d=this.renderCoordsHelper,f=d.getAltitude(a);return this.constraints.collision.enabled&&f-b<c?(d.setAltitude(b+c,a,0),!0):!1},_cameraElevationAngle:function(a,b){b=b||{tilt:0,distance:0};b.tilt=this.renderCoordsHelper.viewAngle(a.center,a.eye);b.distance=a.distance;return b},_elevationChangeTileHandler:function(a){if(this.enableElevationUpdates&&this._targetCameraChangedByElevationUpdate&&this.constraintsEnabled){var b=!1,d=a.tile.extent;a=this.renderCoordsHelper.fromRenderCoords(this._targetCameraBeforeElevationUpdate.eye,
v,a.spatialReference);d[0]<=a.x&&d[1]<=a.y&&d[2]>a.x&&d[3]>a.y&&(c.copyFrom(this.cameras.target),this.cameras.target.copyFrom(this._targetCameraBeforeElevationUpdate),this.constrainTargetEyeByElevation(),this.applyConstraints(this.cameras.target),b=!c.equals(this.cameras.target));b&&(this.isAnimating?this.targetChanged():this.targetAnimatedChanged(!1,{internalUpdate:!0}),this._targetCameraChangedByElevationUpdate=!0)}},_elevationChangeHandler:function(a){var b=a.extent;a=a.spatialReference;var c=
this.renderCoordsHelper.fromRenderCoords(this.cameras.target.eye,a);this._deferredUpdateTargetEyeForElevationChange(b,c,a);this._deferredUpdateTargetCenterForElevationChange(b,c,a)},_isPositionWithinExtent:function(a,b){return b[0]<=a.x&&b[1]<=a.y&&b[2]>a.x&&b[3]>a.y},_deferredUpdateTargetEyeForElevationChange:function(a,b){this.enableElevationUpdates&&this.constraintsEnabled&&this._isPositionWithinExtent(b,a)&&(this.isAnimating?this._recomputeTargetEyeForElevationChange=!0:this._updateTargetEyeForElevationChange())},
_updateTargetEyeForElevationChange:function(){this._recomputeTargetEyeForElevationChange=!1;var a=this.cameras.target;this._targetCameraChangedByElevationUpdate||this._targetCameraBeforeElevationUpdate.copyFrom(a);var b=this._getTerrainElevationBelowCamera(a);if(a=this._applyElevationConstraint(a.eye,b,this.cameraElevationMargin))this.isAnimating?this.targetChanged():this.targetAnimatedChanged(!1,{internalUpdate:!0}),this._targetCameraChangedByElevationUpdate=!0;return a},_deferredUpdateTargetCenterForElevationChange:function(a,
b,c){if(this.enableElevationUpdates&&!this._recomputeTargetCenterForElevationChange){var d=this.renderCoordsHelper.fromRenderCoords(this.cameras.target.center,c);c=Math.max(d.y,b.y);var f=Math.min(d.y,b.y);b=t.intersectIntervals([[Math.min(d.x,b.x),Math.max(d.x,b.x)]],[[a[0],a[2]]]);a=t.intersectIntervals([[f,c]],[[a[1],a[3]]]);0<b.length&&0<a.length&&(this._recomputeTargetCenterForElevationChange=!0)}},_getTerrainElevationBelowCamera:function(a){var b=this.elevationProvider;return b&&b.spatialReference?
(a=this.renderCoordsHelper.fromRenderCoords(a.eye,this.elevationProvider.spatialReference),this.elevationProvider.getElevation(a)||0):0},getCenterIntersectTerrain:function(a,b,c){c||(c=x.create());x.set(b,c);var d=this.picker.pickAlongRay(a,c,null,null,null,!1,this._intersectTerrainSelector);this.picker.pickedIntersectionPoint(d,c)||this.getCenterIntersectManifold(a,b,c)||this.getFallbackCenterAlongViewDirection(a,b,c);return c},getCenterIntersectManifold:function(a,b,c){x.subtract(b,a,r);return this.intersectManifold(a,
r,0,c)},intersectManifold:function(a,b,c,d){return this.renderCoordsHelper.intersectManifold(a,b,c,d)},getCameraIntersectTerrain:function(a,b,c,d){var f=this.cameras.current.copy();a&&(f.eye=a);b&&(f.center=b);c&&(f.up=c);this.getCenterIntersectTerrain(f.eye,f.center,D);x.dist2(f.eye,D)<this.minPoiDist&&this.constraintsEnabled&&(a=this.constraints.collision.enabled,x.set(f.viewForward,r),x.scale(r,this.minPoiDist),a?x.subtract(D,r,f.eye):x.add(f.eye,r,D),b=this.renderCoordsHelper,c=b.getAltitude(f.eye),
a&&c<this.cameraElevationMargin&&(x.subtract(D,f.eye,r),b.setAltitude(this.cameraElevationMargin,f.eye),x.add(f.eye,r,D)),f.markViewDirty());0<d?(a=x.dist(f.eye,f.center),x.dist(D,f.center)>a*d&&(f.center=D)):f.center=D;return f}});G.UPDATE_TARGET_BY_ELEVATION_UPDATES_DEFAULT=!0;G.Tilt=function(a){this.min=a.min;this.max=a.max};G.Tilt.scale=function(a,b){return 1===b?a:new G.Tilt({min:function(c){return a.min(c*b)},max:function(c){return a.max(c*b)}})};G.Tilt.prototype.apply=function(b,c){return a.clamp(b,
this.min(c),this.max(c))};G.Altitude=function(a){this.min=a.min;this.max=a.max};G.Altitude.scale=function(a,b){return 1===b?a:new G.Altitude({min:function(c){return a.min(c)/b},max:function(c){return a.max(c)/b}})};G.Altitude.prototype.apply=function(b,c){return a.clamp(c,this.min(b),this.max(b))};G.Collision=function(a){this.enabled=null!=a?a:!0};return G})},"esri/views/3d/navigation/spherical/AnimationSpherical":function(){define(["../mixins/AnimationMixin","../../lib/glMatrix","../../support/mathUtils"],
function(w,l,f){function a(a,b){var d=b[0]-a[0],f=b[1]-a[1],k=b[2]-a[2];a=b[3]-a[3];return d*d+f*f+k*k+a*a}function d(b,d){return Math.sqrt(a(b,d))}function b(a){this.interpolate=function(a,b,d){d=Math.min(9*d,.3);f.slerpOrLerp(a.center,b.center,d,a.center,1E-4);f.slerpOrLerp(a.eye,b.eye,d,a.eye,1E-4);f.slerp(a.up,b.up,d);a.fov=f.lerp(a.fov,b.fov,d);a.padding=m.lerp(a.padding,b.padding,d,k);a.computeUpOnSphere()}}function q(a,b,l){b=b||250;l=l||b;var p=0,r=0,q=0,x=0,w=function(c,d,f,k,m){return a.easeInOutInterpLinear(l,
b,c,d,f,k,m)},c=function(a,c,d,k){var m=t.dist(a,c);if(.1>m)return t.set(c,a),0;k=Math.min(k+l*d,Math.min(Math.sqrt(m*l),b));f.slerpOrLerp(a,c,Math.min(k/m*d,1),a,1E-4);return k};this.interpolate=function(a,b,l){p=c(a.eye,b.eye,l,p);r=c(a.center,b.center,l,r);x=c(a.padding,b.padding,l,x,{dist:d,lerp:function(a,b,c){return m.lerp(a,b,c,k)},set:function(b){a.padding=b}});q=w(a.fov,b.fov,l,q,{dist:function(a,b){return Math.abs(b-a)},lerp:f.lerp,set:function(b){a.fov=b}});a.computeUpOnSphere()}}var t=
l.vec3d,m=l.vec4d,k=m.create();return w.createSubclass({declaredClass:"esri.views.3d.navigation.spherical.AnimationSpherical",constructor:function(){this.interpolationTypes={linear:b,easeInOut:q}}})})},"esri/views/3d/navigation/mixins/AnimationMixin":function(){define(["../../../../core/Accessor","dojo/on","dojo/_base/lang","../../animation/pointToPoint/Animation","../../../animation/easing"],function(w,l,f,a,d){a=a.default;return w.createSubclass([],{declaredClass:"esri.views.3d.navigation.mixins.AnimationMixin",
properties:{interpolation:{set:function(a){if("string"===typeof a){var b=this.interpolationTypes[a];b?this._set("interpolation",new b(this)):console.error("[AnimationMixin] Invalid interpolation type "+a)}else this._set("interpolation",a)}},isAnimating:!1},initialize:function(){this._pointToPointAnimation=new a(this.view.viewingMode);this._targetCameraAnimated=this.cameras.current.copy();this.animationId=0},getDefaults:function(){return{interpolation:"linear"}},easeInOutInterpLinear:function(a,d,
f,m,k,l,x){var b=x.dist(f,m);if(b<.1/this.renderUnitInMeters)return x.set(m,f),0;l=Math.min(l+a*k,Math.min(Math.sqrt(b*a),d));x.set(x.lerp(f,m,Math.min(l/b*k,1)),f);return l},step:function(a){this.inherited(arguments);var b=this.currentHasReachedTarget();this._stepTimeAnimation(a/1E3,b);b&&this.pan.updateContinuous(a)},startAnimation:function(a,d){this.animationId++;this._startTimeAnimation(a,d);this.animationStarted()},_stepTimeAnimation:function(a,d){this.isAnimating&&(d?this.setCurrentToTarget(!0):
(d=this._pointToPointAnimation,d.step(a,this.cameras.current),d.finished?(this.isAnimating=!1,this._updateTargetCenterForElevationWhenIdle()||(this.isAnimating=!0,this.setCurrentToTarget(!0))):this.currentChanged()))},_startTimeAnimation:function(a,l){this.isAnimating=!0;var b={};a&&a.internalUpdate?(b.apex=null,b.duration=.3,b.easing=d.outExpo):b.apex={maximumDistance:this.view.constraints.altitude.max/6};a=f.mixin(b,"object"===typeof a?a:null);this._pointToPointAnimation.update(this.cameras.current,
l?this._targetCameraAnimated:this.cameras.target,a)},animationStarted:function(){l.emit(this,"animationStarted")},stop:function(){this.pan&&this.pan.continuous&&this.pan.continuous.stop();this.pan&&this.pan.momentum&&(this.pan.momentum=null);this.currentHasAlmostReachedTarget()?this.currentReachedTarget(!1,!0):(this.cameras.target.copyFrom(this.cameras.current),this.targetAndCurrentChanged(!0))},currentReachedTarget:function(){this.inherited(arguments);this.isAnimating=!1}})})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../animation/pointToPoint/Animation ./Camera ../../lib/glMatrix ../../webgl-engine/lib/Camera".split(" "),
function(w,l,f,a,d,b,q){Object.defineProperty(l,"__esModule",{value:!0});var t=b.vec3d,m=t.create();w=function(){function b(b){this.animation=new a.Animation(function(){return new d.default(b)});this._current=new d.default(b)}Object.defineProperty(b.prototype,"finished",{get:function(){return this.currentTime>=this.animation.time},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"time",{get:function(){return this.animation.time},enumerable:!0,configurable:!0});b.prototype.update=
function(a,b,d){var f=this.animation.definition.source,k=this.animation.definition.target,l=t.subtract(b.center,a.center,m),p=t.length(l);1E-5<=p?(l[0]/=p,l[1]/=p,l[2]/=p):(l[0]=0,l[1]=1,l[0]=0);t.set(l,f.lookAtDirection);t.set(l,k.lookAtDirection);f.copyFromRenderCamera(a);k.copyFromRenderCamera(b);this._current.copyFrom(f);this.animation.update(f,k,d);this.currentTime=0};b.prototype.cameraAt=function(a,b){a=this.animation.cameraAt(a,this._current);b||(b=new q);a.copyToRenderCamera(b);return b};
b.prototype.step=function(a,b){this.finished||(this.currentTime+=a,this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,b)};return b}();l.Animation=w;l.default=w})},"esri/views/animation/pointToPoint/Animation":function(){define("require exports ../easing ./Definition ./Settings ./apex/Path".split(" "),function(w,l,f,a,d,b){Object.defineProperty(l,"__esModule",{value:!0});var q={zoom:0,pan:0,rotate:0};w=function(){function l(d){this.createCamera=
d;this.time=0;this.definition=new a.Definition(d);this.path=new b.Path}l.prototype.update=function(a,b,d){this.definition.update(a,b,d);this.path.update(this.definition,d);this.time=this._applyTimeSettings(this.path.time,d);this.settings=d};l.prototype.cameraAt=function(a,b){b||(b=this.createCamera());a=Math.min(Math.max(0,a),1);a=this.settings.easing?this.settings.easing(a,1E3*this.time):1<=this.time?f.inOutCoastQuad(a):f.outExpo(a);a=this.path.interpolateComponentsAt(a,q);b.interpolate(this.definition.source,
this.definition.target,a);return b};l.prototype._applyTimeSettings=function(a,b){var f=null!=b.speedFactor?b.speedFactor:1;null!=b.duration?a=b.duration:null!=b.speedFactor&&(a/=f);return a=Math.min(Math.max(null!=b.minDuration?b.minDuration:d.defaultSettings.minDuration/f,a),null!=b.maxDuration?b.maxDuration:d.defaultSettings.maxDuration/f)};return l}();l.Animation=w;l.default=w})},"esri/views/animation/pointToPoint/Definition":function(){define(["require","exports","./Settings"],function(w,l,f){Object.defineProperty(l,
"__esModule",{value:!0});w=function(){function a(a){this.createCamera=a;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:f.defaultSettings.desiredScreenFlow};this.source=a();this.target=a()}a.prototype.clone=function(){var d=new a(this.createCamera);d.copyFrom(this);return d};a.prototype.copyFrom=function(a){this.update(a.source,a.target,a.settings)};a.prototype.update=function(a,b,l){this.source!==a&&this.source.copyFrom(a);this.target!==b&&this.target.copyFrom(b);
this.settings.desiredScreenFlow=null!=l.desiredScreenFlow?l.desiredScreenFlow:f.defaultSettings.desiredScreenFlow;this.compared=this.source.compareTo(this.target,this.compared);this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2};a.prototype.halfWindowPanAtZoom=function(a){a=this.target.pixelsPerPanAtZoom(a);return this.halfWindowSize/a};Object.defineProperty(a.prototype,"hasZoom",{get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-
this.compared.targetZoom)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasPan",{get:function(){return 1E-9<this.compared.pan},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasRotate",{get:function(){return 1E-9<this.compared.rotate},enumerable:!0,configurable:!0});return a}();l.Definition=w;l.default=w})},"esri/views/animation/pointToPoint/Settings":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});l.defaultSettings=
{desiredScreenFlow:2,minDuration:.5,maxDuration:8}})},"esri/views/animation/pointToPoint/apex/Path":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../easing ../Path ../Segment ./planning".split(" "),function(w,l,f,a,d,b,q){Object.defineProperty(l,"__esModule",{value:!0});w=function(d){function m(a,f){var k=d.call(this)||this;k._preallocSegments=[new b.default,new b.default,new b.default];k.update(a,f);return k}f(m,d);m.prototype.update=function(a,b){if(a){this.definition?
this.definition.copyFrom(a):this.definition=a.clone();var d=null;b&&b.apex&&(d=q.optimalDistance(a,b.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==d?this._updateWithoutApex():this._updateWithApex(d,b.apex)}};m.prototype.segmentInterpolateComponentsAt=function(b,d,f){f=b.interpolateComponentsAt(d,f);b===this._ascensionSegment?f.zoom=a.outQuad(f.zoom):b===this._descensionSegment&&(f.zoom=a.inQuad(f.zoom));return f};m.prototype._updateWithApex=function(a,b){var d=
this._preallocSegments,f=d[0],k=d[1],d=d[2],m=null!=b.ascensionFactor?b.ascensionFactor:.5;b=Math.min(1-m,null!=b.ascensionFactor?b.descensionFactor:.5);var l=1-m-b;f.definition?f.definition.copyFrom(this.definition):f.definition=this.definition.clone();f.definition.compared.targetZoom=a;f.definition.compared.pan=this.definition.compared.pan*m;f.definition.compared.rotate=this.definition.compared.rotate*m;f.update();this._ascensionSegment=f;this.segments.push(f);0<l&&(k.definition?k.definition.copyFrom(this.definition):
k.definition=this.definition.clone(),k.definition.copyFrom(this.definition),k.definition.compared.sourceZoom=a,k.definition.compared.targetZoom=a,k.definition.compared.pan=this.definition.compared.pan*l,k.definition.compared.rotate=this.definition.compared.rotate*l,k.update(),this.segments.push(k));d.definition?d.definition.copyFrom(this.definition):d.definition=this.definition.clone();d.definition.compared.sourceZoom=a;d.definition.compared.pan=this.definition.compared.pan*b;d.definition.compared.rotate=
this.definition.compared.rotate*b;d.update();this._descensionSegment=d;this.segments.push(d)};m.prototype._updateWithoutApex=function(){var a=this._preallocSegments[0];a.update(this.definition);this.segments.push(a)};return m}(d.default);l.Path=w;l.default=w})},"esri/views/animation/pointToPoint/Path":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});w=function(){function f(){this.segments=[]}Object.defineProperty(f.prototype,"time",{get:function(){return this.segments.reduce(function(a,
d){return a+d.time},0)},enumerable:!0,configurable:!0});f.prototype.interpolateComponentsAt=function(a,d){a=Math.min(Math.max(a,0),1);a*=this.time;for(var b=0,f=0,l=this.definition,m=0;m<this.segments.length;m++){var k=this.segments[m],p=k.definition;if(a<=k.time||m===this.segments.length-1)return d=this.segmentInterpolateComponentsAt(k,a/k.time,d),d.pan=l.hasPan?(b+p.compared.pan*d.pan)/l.compared.pan:1,d.rotate=l.hasRotate?(f+p.compared.rotate*d.rotate)/l.compared.rotate:1,a=d.zoom*(p.compared.targetZoom-
p.compared.sourceZoom)+p.compared.sourceZoom,b=this.segments[0].definition.compared.sourceZoom,f=this.segments[this.segments.length-1].definition.compared.targetZoom,d.zoom=l.hasZoom?(a-b)/(f-b):1,d;a-=k.time;b+=p.compared.pan;f+=p.compared.rotate}};f.prototype.segmentInterpolateComponentsAt=function(a,d,b){return a.interpolateComponentsAt(d,b)};return f}();l.Path=w;l.default=w})},"esri/views/animation/pointToPoint/Segment":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,
"__esModule",{value:!0});w=function(){function f(a){a&&this.update(a)}f.prototype.update=function(a){a&&(this.definition?this.definition.copyFrom(a):this.definition=a.clone());this._updatePrecomputedVariables();this._updatePixelFlow()};f.prototype._updatePrecomputedVariables=function(){var a=this.definition,d=a.compared,b=d.sourceZoom,f=d.targetZoom;this._sl=b>f?1:-1;this._panPixelsAtSource=d.pan*a.source.pixelsPerPanAtZoom(b);a=(a.source.pixelsPerRotateAtZoom(b)+a.target.pixelsPerRotateAtZoom(f))/
2;this._rotatePixels=d.rotate*a};f.prototype._updatePixelFlow=function(){var a=this.definition.compared.sourceZoom,d=this.definition.compared.targetZoom,b=this.definition.hasZoom,f=this.definition.hasPan,l=this.definition.hasRotate,m,k;m=f&&b?(d/a-1)/(-1/(this._sl*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource):0;k=b&&l?Math.log(a/d)/Math.LN2*this._sl*this.definition.halfWindowSize/this._rotatePixels:0;this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;a=this.definition.desiredPixelFlow;
b&&f&&l?(d=m+k+m*k,this._zoomPixelFlow=m*k/d*a,this._panPixelFlow=k/d*a,this._rotatePixelFlow=m/d*a):b&&f?(d=1+m,this._zoomPixelFlow=m/d*a,this._panPixelFlow=1/d*a):b&&l?(d=1+k,this._zoomPixelFlow=k/d*a,this._rotatePixelFlow=1/d*a):f&&l?(m=this._panPixelsAtSource/this._rotatePixels,d=1+m,this._panPixelFlow=m/d*a,this._rotatePixelFlow=1/d*a):f?this._panPixelFlow=a:b?this._zoomPixelFlow=a:l&&(this._rotatePixelFlow=a);this.time=l?this.rotateTime:b?this.zoomTime:f?this.panTime:0};Object.defineProperty(f.prototype,
"zoomTime",{get:function(){return this.definition.hasZoom?Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._sl*this.definition.halfWindowSize/this._zoomPixelFlow:0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"panTime",{get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){var a=-1/(this._sl*this.definition.halfWindowSize)*Math.LN2;return Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*a+1)/
(a*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"rotateTime",{get:function(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0},enumerable:!0,configurable:!0});f.prototype._interpolateComponentsZoom=function(a){if(this.definition.hasZoom){var d=this.definition.compared.sourceZoom,b=this.definition.compared.targetZoom;return(d*Math.pow(d/b,-a)-d)/(b-d)}return a};f.prototype._interpolateComponentsPan=
function(a){if(this.definition.hasPan&&this.definition.hasZoom){var d=-1/(this._sl*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(Math.pow(2,d*a*this.time)-1)/(d*Math.LN2)}return a};f.prototype._interpolateComponentsRotate=function(a){return a};f.prototype.interpolateComponentsAt=function(a,d){a=Math.min(Math.max(a,0),1);var b=this._interpolateComponentsZoom(a),f=this._interpolateComponentsPan(a);a=this._interpolateComponentsRotate(a);d?(d.zoom=
b,d.pan=f,d.rotate=a):d={zoom:b,pan:f,rotate:a};return d};return f}();l.Segment=w;l.default=w})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["require","exports","./functions"],function(w,l,f){function a(a,b){var d=Math.max(a.compared.sourceZoom,a.compared.targetZoom);a=a.source.zoomAtPixelsPerPan(a.desiredPixelFlow/a.compared.pan)/2;return a<d?null!=b.maximumDistance?d+(b.maximumDistance-d)/2:1.5*d:b.maximumDistance?Math.min(b.maximumDistance,a):a}Object.defineProperty(l,
"__esModule",{value:!0});l.optimalDistance=function(d,b){var l=a(d,b),t={ascensionFactor:null!=b.ascensionFactor?b.ascensionFactor:.5,descensionFactor:null!=b.descensionFactor?b.descensionFactor:.5},m=0===t.ascensionFactor,k=0===t.descensionFactor,p=m?f.tAscensionZoomOnly:f.tAscensionZoomPan,x=m?f.dtAscensionZoomOnly:f.dtAscensionZoomPan,w=m?f.ddtAscensionZoomOnly:f.ddtAscensionZoomPan,v=k?f.tDescensionZoomOnly:f.tDescensionZoomPan,r=k?f.dtDescensionZoomOnly:f.dtDescensionZoomPan,u=k?f.ddtDescensionZoomOnly:
f.ddtDescensionZoomPan,m=function(a){return p(d,t,a)+f.tPanion(d,t,a)+v(d,t,a)},k=function(a){return x(d,t,a)+f.dtPanion(d,t,a)+r(d,t,a)},C=function(a){return w(d,t,a)+f.ddtPanion(d,t,a)+u(d,t,a)},E=m(l),c=f.tBaseLine(d),D=b.maximumIterations||20,B=null!=b.maximumDistance?b.maximumDistance:Infinity;for(b=0;b<D;b++){var I=(k(l)+1E-6)/C(l);if(isNaN(I)||l>=B&&0>I){if(!isFinite(B))return null;l=B;E=m(l);break}l-=I;if(l<d.compared.sourceZoom||l<d.compared.targetZoom)return null;I=m(l);if(.005>=Math.abs(I-
E)/E)break;E=I}return E>.7*c?null:l<d.compared.sourceZoom||l<d.compared.targetZoom?null:l}})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["require","exports"],function(w,l){Object.defineProperty(l,"__esModule",{value:!0});l.tAscensionZoomPan=function(f,a,d){var b=f.halfWindowPanAtZoom(d-f.compared.sourceZoom);return-f.halfWindowSize*(a.ascensionFactor*Math.LN2*f.compared.pan+b)*Math.log(f.compared.sourceZoom/d)/(f.desiredPixelFlow*Math.LN2*b)};l.dtAscensionZoomPan=function(f,
a,d){var b=1/d,l=Math.log(f.compared.sourceZoom*b),t=1/f.desiredPixelFlow,m=1/Math.LN2;d-=f.compared.sourceZoom;var k=1/d;a=(a.ascensionFactor*Math.LN2*f.compared.pan+f.halfWindowPanAtZoom(d))/f.halfWindowPanAtZoom(1);return f.halfWindowSize*b*t*m*k*a-f.halfWindowSize*l*t*m*k+f.halfWindowSize*l*t*m*a/(d*d)};l.ddtAscensionZoomPan=function(f,a,d){var b=d-f.compared.sourceZoom,l=1/b,t=1/d,m=Math.log(f.compared.sourceZoom*t);a=(a.ascensionFactor*Math.LN2*f.compared.pan+f.halfWindowPanAtZoom(b))/f.halfWindowPanAtZoom(1);
return f.halfWindowSize*l*(-2*l*t*a+2*l*m+2*t-2*m*a/(b*b)-a/(d*d))/(f.desiredPixelFlow*Math.LN2)};l.tAscensionZoomOnly=function(f,a,d){return-f.halfWindowSize*Math.log(f.compared.sourceZoom/d)/(f.desiredPixelFlow*Math.LN2)};l.dtAscensionZoomOnly=function(f,a,d){return f.halfWindowSize/(d*f.desiredPixelFlow*Math.LN2)};l.ddtAscensionZoomOnly=function(f,a,d){return-f.halfWindowSize/(d*d*f.desiredPixelFlow*Math.LN2)};l.tPanion=function(f,a,d){return-f.compared.pan*f.halfWindowSize*(a.ascensionFactor+
a.descensionFactor-1)/(f.desiredPixelFlow*f.halfWindowPanAtZoom(d))};l.dtPanion=function(f,a,d){return f.compared.pan*f.halfWindowSize*(a.ascensionFactor+a.descensionFactor-1)/(f.desiredPixelFlow*f.halfWindowPanAtZoom(d*d))};l.ddtPanion=function(f,a,d){return-2*f.compared.pan*f.halfWindowSize*(a.ascensionFactor+a.descensionFactor-1)/(f.desiredPixelFlow*f.halfWindowPanAtZoom(d*d*d))};l.tDescensionZoomPan=function(f,a,d){return f.halfWindowSize*(-f.halfWindowPanAtZoom(d)-a.descensionFactor*Math.LN2*
f.compared.pan+f.halfWindowPanAtZoom(f.compared.targetZoom))*Math.log(d/f.compared.targetZoom)/(f.desiredPixelFlow*Math.LN2*f.halfWindowPanAtZoom(-d+f.compared.targetZoom))};l.dtDescensionZoomPan=function(f,a,d){var b=Math.log(d/f.compared.targetZoom),l=1/f.desiredPixelFlow,t=1/Math.LN2,m=-d+f.compared.targetZoom,k=1/m;a=(-f.halfWindowPanAtZoom(d)-a.descensionFactor*Math.LN2*f.compared.pan+f.halfWindowPanAtZoom(f.compared.targetZoom))/f.halfWindowPanAtZoom(1);return-f.halfWindowSize*b*l*t*k+f.halfWindowSize*
b*l*t*a/(m*m)+f.halfWindowSize*l*t*k*a/d};l.ddtDescensionZoomPan=function(f,a,d){var b=d-f.compared.targetZoom,l=1/b,t=1/d,m=Math.log(d/f.compared.targetZoom);a=(f.halfWindowPanAtZoom(d)+a.descensionFactor*Math.LN2*f.compared.pan-f.halfWindowPanAtZoom(f.compared.targetZoom))/f.halfWindowPanAtZoom(1);return f.halfWindowSize*l*(-2*l*t*a-2*l*m+2*t+2*m*a/(b*b)-a/(d*d))/(f.desiredPixelFlow*Math.LN2)};l.tDescensionZoomOnly=function(f,a,d){return f.halfWindowSize*Math.log(d/f.compared.targetZoom)/(f.desiredPixelFlow*
Math.LN2)};l.dtDescensionZoomOnly=function(f,a,d){return f.halfWindowSize/(d*f.desiredPixelFlow*Math.LN2)};l.ddtDescensionZoomOnly=function(f,a,d){return-f.halfWindowSize/(d*d*f.desiredPixelFlow*Math.LN2)};l.tBaseLine=function(f){var a=Math.LN2*f.compared.pan,d=f.halfWindowPanAtZoom(f.compared.sourceZoom-f.compared.targetZoom),b=f.halfWindowSize*Math.log(f.compared.sourceZoom/f.compared.targetZoom)/(f.desiredPixelFlow*Math.LN2*d);return f.compared.sourceZoom<=f.compared.targetZoom?b*(a-d):b*(a+d)}})},
"esri/views/3d/animation/pointToPoint/Camera":function(){define(["require","exports","../../lib/glMatrix","../../support/mathUtils"],function(w,l,f,a){Object.defineProperty(l,"__esModule",{value:!0});var d=a.angle,b=a.lerp,q=a.slerpOrLerp,t=f.vec3d,m=f.mat3d,k=t.create(),p=t.create(),x=t.create(),z=t.create(),v=t.create(),r=t.create(),u=t.createFrom(0,0,1),C=t.createFrom(0,1,0),E=t.createFrom(1,0,0),c=m.create();w=function(){function a(a){void 0===a&&(a="global");this.viewingMode=a;this.center=t.create();
this.distance=this.yaw=this.pitch=0;this.lookAtDirection=t.create(C)}a.prototype.pixelsPerPanAtZoom=function(a){return this.size/2/(this._zoomToPanScale*a)};a.prototype.zoomAtPixelsPerPan=function(a){return this.size/2/(this._zoomToPanScale*a)};a.prototype.pixelsPerRotateAtZoom=function(a){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};a.prototype.compareTo=function(a,b){b||(b={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if("global"===this.viewingMode){var c=t.length(this.center),
f=t.length(a.center),c=(c+f)/2;b.pan=d(this.center,a.center)*c}else b.pan=t.dist(this.center,a.center);c=Math.abs(a.yaw-this.yaw);c>=Math.PI&&(c=2*Math.PI-c);b.rotate=Math.max(c,Math.abs(a.pitch-this.pitch));b.sourceZoom=this.distance;b.targetZoom=a.distance;return b};a.prototype.interpolate=function(a,c,d){"global"===this.viewingMode?q(a.center,c.center,d.pan,this.center,D):t.lerp(a.center,c.center,d.pan,this.center);this.distance=b(a.distance,c.distance,d.zoom);this.pitch=b(a.pitch,c.pitch,d.rotate);
a=a.yaw;c=c.yaw;Math.abs(c-a)>=Math.PI&&(a+=2*(a<c?1:-1)*Math.PI);this.yaw=b(a,c,d.rotate)};a.prototype.copyFrom=function(a){t.set(a.center,this.center);this.pitch=a.pitch;this.yaw=a.yaw;this.distance=a.distance;t.set(a.lookAtDirection,this.lookAtDirection);this.size=a.size;this.copyFromCommon(a);this.viewingMode=a.viewingMode};a.prototype.copyFromRenderCamera=function(a){var b=this._lookAtOrientation(a.center,c);t.set(a.center,this.center);m.multiplyVec3(b,t.subtract(a.center,a.eye,z));m.multiplyVec3(b,
a.up,v);this.distance=t.length(z);z[0]/=this.distance;z[1]/=this.distance;z[2]/=this.distance;this.pitch=this._eyeUpToPitch(z,v);this.yaw=this._eyeUpToYaw(z,v);this.size=Math.sqrt(a.width*a.width+a.height*a.height);this.copyFromCommon(a)};a.prototype.copyFromCommon=function(a){this.fov=a.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};a.prototype.copyToRenderCamera=function(a){var b=this._lookAtOrientation(this.center,c);m.transpose(b);this._axisAngleVec3(E,this.pitch-Math.PI/2,C,z);this._axisAngleVec3(u,
this.yaw,z);this._axisAngleVec3(E,this.pitch-Math.PI/2,u,v);this._axisAngleVec3(u,this.yaw,v);t.scale(z,this.distance);m.multiplyVec3(b,z);m.multiplyVec3(b,v);a.center=this.center;a.eye=t.subtract(this.center,z,z);a.up=v};a.prototype._axisAngleVec3=function(a,b,c,d){void 0===d&&(d=c);var f=Math.cos(b);b=Math.sin(b);t.scale(c,f,k);t.scale(t.cross(a,c,p),b);t.scale(a,(1-f)*t.dot(a,c),x);return t.add(t.add(k,p,d),x,d)};a.prototype._lookAtOrientation=function(a,b){this._upAtLookAt(a,x);t.normalize(t.cross(this.lookAtDirection,
x,k));0===k[0]&&0===k[1]&&0===k[2]&&t.set(E,k);t.normalize(t.cross(x,k,p));b||(b=m.create());b[0]=k[0];b[1]=p[0];b[2]=x[0];b[3]=k[1];b[4]=p[1];b[5]=x[1];b[6]=k[2];b[7]=p[2];b[8]=x[2];return b};a.prototype._upAtLookAt=function(a,b){return"local"===this.viewingMode?t.set(u,b):t.normalize(a,b)};a.prototype._eyeUpToPitch=function(a,b){return Math.PI-d(u,a)};a.prototype._eyeUpToYaw=function(a,b){.5>Math.abs(b[2])?(t.set(b,r),0<a[2]&&t.scale(r,-1)):t.set(a,r);return d(E,t.normalize(t.cross(r,u,p)),u)};
return a}();var D=1E-4;l.default=w})},"esri/views/3d/navigation/spherical/actions/PanSpherical":function(){define("./ActionSpherical ../../mixins/PanMixin ../../../lib/glMatrix ../../../support/earthUtils ../../../support/mathUtils ../../../webgl-engine/lib/Util ../../ContinuousAction ../../NavigationConstants ../../../webgl-engine/lib/Camera ./Momentum".split(" "),function(w,l,f,a,d,b,q,t,m,k){var p=f.vec2d,x=f.vec3d,z=f.vec4d,v=f.mat4d,r=x.create(),u=x.create(),C=x.create(),E=x.create(),c=x.create(),
D=x.create(),B=v.create(),I=t.Pan.Mode,G=t.Pan.Direction,H=t.Pan.Vertical;return w.createSubclass([l],{declaredClass:"esri.views.3d.navigation.spherical.actions.PanSpherical",constructor:function(){this._panMode=0;this._plane=z.create();this.momentum=null;this._momentumEstimator=new k.ScreenspaceMomentumEstimator(.05,500,12,.82);this._momentumDirection=x.create();this.momentumEnabled=!0;this._momentumInitialCamera=new m;this.continuous=new q},begin:function(c,d){this.inherited(arguments);this._momentumEstimator.reset();
this.pickPointInScreen(c,this._navPickPoint)?this._navSphereRadius=x.length(this._navPickPoint):(this._navSphereRadius=x.length(this.targetCamera.center),this._navSphereRadius<.9*a.earthRadius&&(this._navSphereRadius=a.earthRadius),this.createPickRay(c,c,this.currentCamera.viewMatrix,r,u),x.subtract(u,this.currentCamera.eye),this.intersectManifold(this.currentCamera.eye,u,this._navSphereRadius-a.earthRadius,this._navPickPoint)||this.closestPointOnSphereSilhouette(this.currentCamera.eye,r,this._navSphereRadius,
this._navPickPoint));var f=!1;this.renderCoordsHelper.getAltitude(this.currentCamera.eye)<H.ELEVATION_THRESHOLD&&(this._navSphereRadius>x.length(this.currentCamera.eye)?f=!0:(x.normalize(x.subtract(this.targetCamera.eye,this._navPickPoint,C)),f=Math.abs(.5*Math.PI-Math.acos(x.dot(this._navPickPoint,C)/x.length(this._navPickPoint)))<H.ANGLE_THRESHOLD));f?(this._panMode=I.VERTICAL,x.normalize(x.subtract(this.targetCamera.eye,this.targetCamera.center,C)),this.updatePlane(this._navPickPoint,C)):(this._panMode=
I.HORIZONTAL,f=void 0===d?b.performance.now():d,this._momentumEstimator.add(c[0],c[1],this._navPickPoint,.001*f));p.set(c,this._dragLastPoint);p.set(c,this._dragBeginPoint);this._mouseDownCamera.copyFrom(this.targetCamera)},update:function(d,f){if(this._panMode===I.HORIZONTAL){if(0>=this._navSphereRadius)return;this.createPickRay(d,this._dragBeginPoint,this._mouseDownCamera.viewMatrix,r,u);x.subtract(u,this._mouseDownCamera.eye);this.intersectManifold(this._mouseDownCamera.eye,u,this._navSphereRadius-
a.earthRadius,this._targetOnSphere)||this.closestPointOnSphereSilhouette(this._mouseDownCamera.eye,r,this._navSphereRadius,this._targetOnSphere);this.rotateCameraWithPointsOnSphere(this._navPickPoint,this._targetOnSphere,this._mouseDownCamera,this.targetCamera,this._navSphereRadius);var k=void 0===f?b.performance.now():f;this._momentumEstimator.add(d[0],d[1],this._targetOnSphere,.001*k)}else{this.createPickRay(this._dragLastPoint,this._dragBeginPoint,this.currentCamera.viewMatrix,r,u);x.subtract(u,
r);if(!b.rayPlane(r,u,this._plane,E))return;this.createPickRay(d,this._dragBeginPoint,this.currentCamera.viewMatrix,r,u);x.subtract(u,r);if(!b.rayPlane(r,u,this._plane,c))return;x.subtract(c,E);x.subtract(this.targetCamera.eye,c);x.subtract(this.targetCamera.center,c);p.set(d,this._dragLastPoint)}this.constrainTargetEyeByElevationAndMoveLookAt();p.set(d,this._dragLastPoint);this.fixTargetUpVector();this.targetAndCurrentChanged();this.inherited(arguments)},end:function(a,b){this.update(a,b);this._panMode===
I.HORIZONTAL&&this._initiateMomentumPanning(a,b);this._navSphereRadius=0;this.inherited(arguments)},_initiateMomentumPanning:function(a,b){if(0>=this._navSphereRadius)return this.setPoiAuto(a,!0),!1;this.update(a,b);this.momentumEnabled&&(this.momentum=this._momentumEstimator.evaluateMomentum());if(this.momentum)return this._momentumInitialVelocity=this.rotationFromPointsOnSphere(this.momentum.dataOldest,this.momentum.dataNewest,this._navSphereRadius,this._momentumDirection)/this.momentum.dataTimeDelta,
this._momentumElapsed=0,this._momentumInitialCamera.copyFrom(this.currentCamera),this.animationStarted(),!0;this.currentReachedTarget();return!1},beginContinuous:function(a){var b=0===this.continuous.status;this.momentum=null;b&&(this.navigation.begin(this),this.active=!0,this.emit("begin"));this.inherited(arguments);this.setCurrentToTarget();b&&x.set3(0,0,0,this.continuous.direction);this.continuous.status&a||(this.continuous.status|=a,a&(G.LEFT|G.RIGHT|G.FORWARD|G.BACKWARD)?(this._computePanAxis(a,
D),x.add(this.continuous.direction,D)):(b=this.continuous.status&(G.UP|G.DOWN),this.continuous.radiusChange=b===G.UP?1:b===G.DOWN?-1:0),this.continuous.velocity=this._computePanVelocity());this.continuous.timer=0},updateContinuous:function(a){if(this.continuous){var b=0,c=null,d=!1;if(this.momentum)this._momentumElapsed+=.001*a,b=this.momentum.valueFromInitialVelocity(this._momentumInitialVelocity,this._momentumElapsed),c=this._momentumDirection,v.identity(B),v.rotate(B,b,c),v.multiplyVec3(B,this._momentumInitialCamera.eye,
this.targetCamera.eye),v.multiplyVec3(B,this._momentumInitialCamera.center,this.targetCamera.center),v.multiplyVec3(B,this._momentumInitialCamera.up,this.targetCamera.up),this.applyConstraints(this.targetCamera),this.constrainTargetEyeByElevationAndMoveLookAt(),this.fixTargetUpVector(),this.momentum.isFinished(this._momentumElapsed)?(this.momentum=null,this.setCurrentToTarget(!0,!1)):this.targetAndCurrentChanged();else{var b=this.continuous.step(a),c=this.continuous.direction,d=.01<x.dot(this.continuous.direction,
this.continuous.direction),f=this.targetCamera;if(0<Math.abs(this.continuous.radiusChange)){a=1+b*this.continuous.radiusChange;var k=f.viewForward,f=x.normalize(f.center,u);(-.999<x.dot(k,f)||0>this.continuous.radiusChange)&&x.scale(this.targetCamera.center,a);x.scale(this.targetCamera.eye,a);this.continuous.velocity=this._computePanVelocity();d||(this.applyConstraints(this.targetCamera),this.constrainTargetEyeByElevationAndMoveLookAt(),this.fixTargetUpVector(),this.targetAndCurrentChanged())}}d&&
(v.identity(B),v.rotate(B,b,c),v.multiplyVec3(B,this.targetCamera.eye),v.multiplyVec3(B,this.targetCamera.center),v.multiplyVec3(B,this.targetCamera.up),this.applyConstraints(this.targetCamera),this.constrainTargetEyeByElevationAndMoveLookAt(),this.fixTargetUpVector(),this.targetAndCurrentChanged());this.emit("update")}},endContinuous:function(a){this.continuous.status&=~a;this.momentum=null;if(0===this.continuous.status)this.continuous.stop(),this.continuous.radiusChange=0,this.active=!1,this.emit("end"),
this.navigation.end(this);else if(a&(G.LEFT|G.RIGHT|G.FORWARD|G.BACKWARD))this._computePanAxis(a,D),x.subtract(this.continuous.direction,D),.01>x.length(this.continuous.direction)&&x.set3(0,0,0,this.continuous.direction);else{var b=this.continuous.status&(G.UP|G.DOWN);this.continuous.radiusChange=b==G.UP?1:b==G.DOWN?-1:0}this.inherited(arguments)},_computePanAxis:function(a,b){x.subtract(this.targetCamera.center,this.targetCamera.eye,b);x.cross(b,this.targetCamera.up);if(a===G.LEFT||a===G.RIGHT)x.normalize(b),
x.cross(b,this.targetCamera.center);a!==G.RIGHT&&a!==G.FORWARD||x.negate(b);x.normalize(b)},_computePanVelocity:function(){var b=.5*Math.abs(x.length(this.targetCamera.eye)-a.earthRadius),b=d.clamp(b,1,2*a.earthRadius);return d.acos(1-b*b/(2*a.earthRadius*a.earthRadius))},updatePlane:function(a,b){z.set4(b[0],b[1],b[2],-x.dot(b,a),this._plane)}})})},"esri/views/3d/navigation/spherical/actions/ActionSpherical":function(){define(["../../Action","../../../support/mathUtils","../../../lib/glMatrix"],
function(w,l,f){var a=f.vec3d,d=f.mat4d,b=a.create(),q=d.create();return w.createSubclass({declaredClass:"esri.views.3d.navigation.spherical.actions.ActionSpherical",constructor:function(){this._targetOnSphere=a.create();this._navSphereRadius=0},closestPointOnSphereSilhouette:function(f,m,k,p){a.cross(f,m,b);a.cross(b,f,p);a.scale(p,1/a.length(p)*k);f=-l.asin(k/a.length(f));d.identity(q);d.rotate(q,f,b);d.multiplyVec3(q,p)},rotateCameraWithPointsOnSphere:function(a,b,d,f,l){return this.navigation.rotateCameraWithPointsOnSphere(a,
b,d,f,l)},rotationFromPointsOnSphere:function(a,b,d,f){return this.navigation.rotationFromPointsOnSphere(a,b,d,f)}})})},"esri/views/3d/navigation/Action":function(){define(["../../../core/Accessor","../../../core/Evented","../webgl-engine/lib/Camera","../lib/glMatrix","dojo/on"],function(w,l,f,a,d){var b=a.vec3d,q=a.vec2d;return w.createSubclass([l],{properties:{type:{},navigation:{},picker:{readOnly:!0,aliasOf:"navigation.picker"},currentCamera:{aliasOf:"navigation.currentCamera"},targetCamera:{aliasOf:"navigation.targetCamera"},
constraints:{readOnly:!0,aliasOf:"navigation.constraints"},renderCoordsHelper:{readOnly:!0,aliasOf:"navigation.renderCoordsHelper"},minPoiDist:{readOnly:!0,aliasOf:"navigation.minPoiDist"}},constructor:function(){this._tmpEvent={type:null,phase:null,x:void 0,y:void 0};this._mouseDownCamera=new f;this._navPickPoint=b.create();this._dragLastPoint=q.create();this._dragBeginPoint=q.create();this.active=!1},initialize:function(){var a=this;["minPoiDist","renderCoordsHelper","constraints","picker"].forEach(function(b){this.navigation.watch(b,
function(){a.notifyChange(b)})}.bind(this))},emit:function(a,b,f){this._tmpEvent.type=this.type;this._tmpEvent.phase=a;this._tmpEvent.x=b;this._tmpEvent.y=f;d.emit(this,a,this._tmpEvent);d.emit(this.navigation,this.type,this._tmpEvent)},intersectManifold:function(a,b,d,f){return this.navigation.intersectManifold(a,b,d,f)},fixTargetUpVector:function(){return this.navigation.fixTargetUpVector()},setPoiAuto:function(a,b){return this.navigation.setPoiAuto(a,b)},normalizeCoordinate:function(a,b){b[0]=
a[0]/this.currentCamera.width;b[1]=a[1]/this.currentCamera.height},worldUpAtPosition:function(a,b){return this.renderCoordsHelper.worldUpAtPosition(a,b)},applyConstraints:function(a,b){return this.navigation.applyConstraints(a,b)},constrainTargetEyeByElevation:function(a){return this.navigation.constrainTargetEyeByElevation(a)},constrainTargetEyeByElevationAndMoveLookAt:function(){return this.navigation.constrainTargetEyeByElevationAndMoveLookAt()},targetAndCurrentChanged:function(a){return this.navigation.targetAndCurrentChanged(a)},
targetAnimatedChanged:function(a,b){return this.navigation.targetAnimatedChanged(a,b)},currentReachedTarget:function(a){return this.navigation.currentReachedTarget(a)},setCurrentToTarget:function(a,b){return this.navigation.setCurrentToTarget(a,b)},animationStarted:function(){return this.navigation.animationStarted()},limitAltitude:function(a,b,d){return this.navigation.limitAltitude(a,b,d)},limitTumbleByConstraints:function(a,b,d,f){return this.navigation.limitTumbleByConstraints(a,b,d,f)},createPickRay:function(a,
b,d,f,l){return this.picker.createPickRay(a,b,d,f,l)},pickAlongRay:function(a,b,d,f,l,q){return this.picker.pickAlongRay(a,b,d,f,l,q)},pickPointInScreen:function(a,b){return this.picker.pickPointInScreen(a,b)},pickFreePointInScreen:function(a,b){return this.picker.pickFreePointInScreen(a,b)},pickInScreen:function(a){return this.picker.pickInScreen(a)}})})},"esri/views/3d/navigation/mixins/PanMixin":function(){define(["../../../../core/declare"],function(w){return w([],{declaredClass:"esri.views.3d.navigation.mixins.PanMixin",
type:"pan",begin:function(l){this.navigation.begin(this);this.active=!0;this.emit("begin")},update:function(l){this.emit("update")},end:function(l){this.active=!1;this.emit("end");this.navigation.end(this)},beginContinuous:function(l){},updateContinuous:function(l){},endContinuous:function(l){}})})},"esri/views/3d/navigation/ContinuousAction":function(){define(["../../../core/Accessor","../lib/glMatrix"],function(w,l){var f=l.vec3d;return w.createSubclass({properties:{active:{get:function(){return 0!==
this.velocity},dependsOn:["velocity"],readOnly:!0},velocity:{}},constructor:function(){this.direction=f.create();this.status=this.timer=this.velocity=0},stop:function(){this.status=this.velocity=this.timer=0;f.set3(0,0,0,this.direction)},step:function(a){var d;a*=.001;0<this.timer?(a=Math.min(a,this.timer),d=this.velocity*a*(1-a/(2*this.timer)),this.velocity*=1-a/this.timer,this.timer-=a):d=this.velocity*a;return d}})})},"esri/views/3d/navigation/spherical/actions/Momentum":function(){define(["require",
"exports","../../../../navigation/Momentum"],function(w,l,f){Object.defineProperty(l,"__esModule",{value:!0});l.ScreenspaceMomentumEstimator=f.ScreenspaceMomentumEstimator;l.ScreenspaceMomentum=f.ScreenspaceMomentum})},"esri/views/3d/navigation/spherical/actions/ZoomSpherical":function(){define(["./ActionSpherical","../../mixins/ZoomMixin","../../../lib/glMatrix","../../../support/earthUtils"],function(w,l,f,a){var d=f.vec2d,b=f.vec3d,q=f.mat4d,t=b.create(),m=b.create(),k=b.create(),p=q.create(),
x=b.create(),z=b.create();return w.createSubclass([l],{declaredClass:"esri.views.3d.navigation.spherical.actions.ZoomSpherical",constructor:function(){},begin:function(d){this.inherited(arguments);this.pickPointInScreen(d,this._navPickPoint)?this._navSphereRadius=b.length(this._navPickPoint):(this._navSphereRadius=b.length(this.targetCamera.center),this._navSphereRadius<.9*a.earthRadius&&(this._navSphereRadius=a.earthRadius),this.createPickRay(d,d,this.currentCamera.viewMatrix,t,m),b.subtract(m,this.currentCamera.eye),
this.intersectManifold(this.currentCamera.eye,m,this._navSphereRadius-a.earthUtils,this._navPickPoint)||(this._navSphereRadius=0));this._mouseDownCamera.copyFrom(this.targetCamera)},update:function(f){var l=this.targetCamera;l.eye=this._mouseDownCamera.eye;l.center=this._mouseDownCamera.center;l.up=this._mouseDownCamera.up;b.subtract(l.center,l.eye,k);var u=b.length(k);this.normalizeCoordinate(f,t);var v=12*(t[1]-this.normalizedAnchorPoint[1]);f=u*Math.pow(2,v);0>v&&f<this.navigation.minPoiDist&&
(f=this.navigation.minPoiDist);f=this.limitAltitude(f,l.center,k);1E-6>Math.abs(u-f)||(0<this._navSphereRadius&&f<u&&(v=1-(1-f/u)*(1-this._navSphereRadius/b.length(l.center)),b.scale(l.center,v)),b.scale(k,-f/u),b.add(l.center,k,l.eye),u=!1,0<this._navSphereRadius&&(q.lookAt(l.eye,l.center,l.up,p),this.createPickRay(this._dragBeginPoint,this._dragBeginPoint,p,t,m),b.normalize(b.subtract(m,l.eye)),this.intersectManifold(l.eye,m,this._navSphereRadius-a.earthRadius,this._targetOnSphere)||(this.closestPointOnSphereSilhouette(l.eye,
t,this._navSphereRadius,this._targetOnSphere),u=!0),this.rotateCameraWithPointsOnSphere(this._navPickPoint,this._targetOnSphere,l,l,this._navSphereRadius),this.fixTargetUpVector()),this.applyConstraints(l),this.constrainTargetEyeByElevation(),this.targetAndCurrentChanged(),d.set(this._dragBeginPoint,this._dragLastPoint),u&&(q.lookAt(l.eye,l.center,l.up,p),this._dragLastPoint=this.currentCamera.projectPoint(this._navPickPoint,p)),l=this._toYDownCoord(this._dragLastPoint),this.emit("update",l[0],l[1]))},
stepAtPoint:function(d,f,k,l){b.set(f,z);f=b.length(z);b.subtract(this.targetCamera.center,this.targetCamera.eye,x);var r=b.length(x),c=r*d,c=1>=d&&c<this.minPoiDist?this.minPoiDist:this.limitAltitude(c,z,x);d=c/r;1E-6>Math.abs(r-c)||(l&&(r=b.length(this.targetCamera.center),b.scale(this.targetCamera.center,(f+d*(r-f))/r)),b.scale(x,-d),b.add(this.targetCamera.center,x,this.targetCamera.eye),l&&k&&(q.lookAt(this.targetCamera.eye,this.targetCamera.center,this.targetCamera.up,p),this.createPickRay(k,
k,p,t,m),b.normalize(b.subtract(m,this.targetCamera.eye)),this.intersectManifold(this.targetCamera.eye,m,f-a.earthRadius,this._targetOnSphere)?this.rotateCameraWithPointsOnSphere(z,this._targetOnSphere,this.targetCamera,this.targetCamera,f):l=!1),this.navigation.adjustTiltAfterZoom(this.targetCamera),this.applyConstraints(this.targetCamera),this.constrainTargetEyeByElevation(),l&&this.fixTargetUpVector(),this.navigation.currentHasAlmostReachedTarget()?this.targetAndCurrentChanged():this.targetAnimatedChanged(!1,
{internalUpdate:!0}))}})})},"esri/views/3d/navigation/mixins/ZoomMixin":function(){define(["../../../../core/declare","../../lib/glMatrix"],function(w,l){var f=l.vec2d,a=l.vec3d,d=a.create();return w([],{declaredClass:"esri.views.3d.navigation.mixins.ZoomMixin",type:"zoom",constructor:function(){this.normalizedAnchorPoint=f.create();this._lastStepAnimationId=-1},begin:function(a){this.navigation.begin(this);f.set(a,this._dragBeginPoint);this.normalizeCoordinate(a,this.normalizedAnchorPoint);a=this._toYDownCoord(this._dragBeginPoint);
this.active=!0;this.emit("begin",a[0],a[1])},update:function(a){},end:function(a){this.active=!1;a=this._toYDownCoord(this._dragBeginPoint);this.emit("end",a[0],a[1]);this.navigation.end(this)},stepScreen:function(b,f){this.active||(a.set(this.currentCamera.center,d),0<b&&(this.pickPointInScreen(f,d)||"local"!==this.navigation.view.viewingMode||this.pickFreePointInScreen(f,d)),this.step(Math.pow(.6,b),d,f))},step:function(b,d,f){if(!this.active){this.navigation.begin(this);this.navigation.currentHasAlmostReachedTarget()||
this.navigation.animationId===this._lastStepAnimationId?this.targetCamera.copyFrom(this.currentCamera):this.navigation.stop();var m=1E-6<a.dist(d,this.targetCamera.center);this.stepAtPoint(b,d,f,m);this._lastStepAnimationId=this.navigation.animationId;this.navigation.end(this)}},stepAtPoint:function(a,d,f,m){},_toYDownCoord:function(a){return[a[0],this.currentCamera.height-a[1]]}})})},"esri/views/3d/navigation/spherical/actions/RotateSpherical":function(){define(["./ActionSpherical","../../mixins/RotateMixin"],
function(w,l){return w.createSubclass([l],{declaredClass:"esri.views.3d.navigation.spherical.actions.RotateSpherical"})})},"esri/views/3d/navigation/mixins/RotateMixin":function(){define(["../../../../core/declare","../../lib/glMatrix","../../support/mathUtils","../NavigationConstants"],function(w,l,f,a){var d=l.vec2d,b=l.vec3d,q=l.mat4d,t=b.create(),m=b.create(),k=d.create(),p=q.create(),x=b.create(),z=[3,1.5],v=a.Rotate.PivotPoint;return w([],{declaredClass:"esri.views.3d.navigation.mixins.RotateMixin",
type:"rotate",constructor:function(){this._rotLastPoint=d.create()},begin:function(a,b){void 0===b&&(b=v.POI);this.navigation.begin(this);this.active=!0;this.emit("begin");this.setPoiAuto(a);this.normalizeCoordinate(a,this._rotLastPoint)},update:function(a,b){void 0===b&&(b=v.POI);var d,f;switch(b){case v.EYE:d=this.targetCamera.center;f=this.targetCamera.eye;break;default:d=this.targetCamera.eye,f=this.targetCamera.center,b!==v.POI&&console.error("[RotateMixin.update]: invalid pivot specified")}this._applyRotation(a,
b,d,f);this.constrainTargetEyeByElevation();this.fixTargetUpVector();this.targetAndCurrentChanged();this.emit("update")},_applyRotation:function(a,l,w,E){this.renderCoordsHelper.worldUpAtPosition(E,t);this.normalizeCoordinate(a,k);a=(k[1]-this._rotLastPoint[1])*z[l-1];var c=(k[0]-this._rotLastPoint[0])*z[l-1];b.subtract(w,E,m);var r=b.length(m),u=f.acos(b.dot(m,t)/r);l===v.POI?a=this.limitTumbleByConstraints(u,a,E,r):(u=.5*Math.PI-u,r=.495*Math.PI,a=u-Math.max(-r,Math.min(r,u+-.5*a)));q.identity(p);
b.cross(this.targetCamera.up,m,x);l==v.POI&&(c=-c);q.rotate(p,c,t);q.rotate(p,a,x);q.multiplyVec3(p,m);b.add(E,m,w);q.multiplyVec3(p,this.targetCamera.up);d.set(k,this._rotLastPoint)},end:function(a){this.active=!1;this.emit("end");this.navigation.end(this)}})})},"esri/views/3d/navigation/planar/NavigationPlanar":function(){define("../Navigation ./ConstraintsPlanar ./AnimationPlanar ./actions/PanPlanar ./actions/RotatePlanar ./actions/ZoomPlanar ../../webgl-engine/lib/Camera ../../lib/glMatrix".split(" "),
function(w,l,f,a,d,b,q,t){var m=t.vec3d,k=m.create(),p=m.create(),x=m.create(),z=m.create();return w.createSubclass([l,f],{declaredClass:"esri.views.3d.navigation.planar.NavigationPlanar",initialize:function(){this.pan=new a({navigation:this});this.zoom=new b({navigation:this});this.rotate=new d({navigation:this})},getInitialCamera:function(){return new q(m.createFrom(0,0,100),m.createFrom(0,0,0),m.createFrom(0,1,0))},fixTargetUpVector:function(){var a=this.renderCoordsHelper.worldUpAtPosition(),
b=this.cameras.target;m.direction(b.center,b.eye,z);var d=m.dot(z,a);.9999>=Math.abs(d)&&(m.scale(z,d,z),m.subtract(a,z,b.up),m.normalize(b.up))},setPoiAuto:function(a,b){a=this.picker.pickAlongRay(this.cameras.target.eye,this.cameras.target.center,null,a);if(a.getMinResult().getIntersectionPoint(k)&&a.getMaxResult().getIntersectionPoint(p)){var d=5/this.renderUnitInMeters;b=a.getMinResult().dist-d;var d=a.getMaxResult().dist+d,f=m.dist(this.cameras.target.eye,this.cameras.target.center);if(f<=b||
f>=d){if(a.getMinResult().object){a.getMaxResult().dist=void 0;a.intersectObject(a.getMinResult().object);if(void 0===a.getMaxResult().dist){console.error("[NavigationPlanar.setPoiAuto] Did not obtain maximum intersection distance");return}a.getMaxResult().getIntersectionPoint(p);m.lerp(k,p,.5,x)}else m.set(k,x);this.setCameraFromEyeAndCenter(this.cameras.target.eye,x,{animate:!1})}}}})})},"esri/views/3d/navigation/planar/ConstraintsPlanar":function(){define("../mixins/ConstraintsMixin ../../support/mathUtils ../../support/earthUtils ../../constraints/SceneViewTiltConstraint ../../lib/glMatrix ../../terrain/StableSurfaceCenter ../../webgl-engine/lib/Util ../../../../geometry/support/scaleUtils ../../../../core/watchUtils ../../../../core/Logger".split(" "),
function(w,l,f,a,d,b,q,t,m,k){var p=d.vec3d,x=k.getLogger("esri.views.3d.navigation.planar.ConstraintsPlanar"),z=p.create(),v=p.create(),r=p.create(),u={min:0,max:Math.PI};return w.createSubclass({declaredClass:"esri.views.3d.navigation.planar.ConstraintsPlanar",defaultConstraints:{tilt:new w.Tilt({min:function(){return l.deg2rad(a.MAX_DEFAULT)},max:l.makePiecewiseLinearFunction([[4E3,l.deg2rad(a.MIN_DEFAULT)],[1E4,l.deg2rad(88)],[6E6,l.deg2rad(88)]])}),altitude:new w.Altitude({min:function(){return-Infinity},
max:function(){return Infinity}}),collision:new w.Collision},_surfaceDistanceConstraint:Infinity,_surfaceCenter:null,_surfaceCenterHelper:null,_basemapTerrainWatchHandle:null,constructor:function(a){this._basemapTerrainWatchHandle=m.init(a.view,"basemapTerrain",this._initializeSurfaceCenterHelper.bind(this,a.view))},destroy:function(){this._surfaceCenterHelper&&(this._surfaceCenterHelper.destroy(),this._surfaceCenterHelper=null);this._basemapTerrainWatchHandle&&(this._basemapTerrainWatchHandle.remove(),
this._basemapTerrainWatchHandle=null)},_initializeSurfaceCenterHelper:function(a){this._surfaceCenterHelper&&(this._surfaceCenterHelper.destroy(),this._surfaceCenter=this._surfaceCenterHelper=null);a.basemapTerrain&&(this._surfaceCenterHelper=new b({view:a}),m.init(this._surfaceCenterHelper,"center",function(a){a&&this.renderCoordsHelper.toRenderCoords(a,z)?(this._surfaceCenter=p.create(z),this._dataExtentChanged()):this._surfaceCenter=null}.bind(this)))},_altitudeModeHandler:function(a){this.inherited(arguments);
"auto"!==a&&x.warn("Altitude constraint is ignored in local scenes")},_updateSurfaceDistanceConstraint:function(a){var b=Math.max(a.xmax-a.xmin,a.ymax-a.ymin);a.hasZ&&(b=Math.max(b,a.zmax-a.zmin));b=3*b/Math.atan((this._targetCameraBeforeElevationUpdate||this.targetCamera)._fov/2);a=t.getMetersPerUnitForSR(a.spatialReference);this._surfaceDistanceConstraint=b*a},limitAltitude:function(a,b,c){var d=this._surfaceDistanceConstraint;if(!this._surfaceCenter||Infinity===d)return a;p.scale(c,a/p.length(c),
z);var f=p.subtract(b,z,z);return 1E-6<p.dist(f,this._surfaceCenter)-d&&q.raySphere(f,c,this._surfaceCenter,d,v)?p.dist(b,v):a},tiltConstraintsFromAltitudeConstraints:function(a,b){return u},distanceToSilhouette:function(a,b,c,d,k){k||(k={maxFarNearRatio:0,distance:0});k.maxFarNearRatio=this.maxFarNearRatio;var m=this.renderCoordsHelper.getAltitude(a.eye),q=m*=c;d=m-d;var u=this.elevationProvider?this.elevationProvider.getElevationBounds():null;u&&(m=0<=d?q-c*u[0]:c*u[1]-q);q=Math.max(b.xmax-b.xmin,
b.ymax-b.ymin,4*Math.max(b.xmax-b.xmin,b.ymax-b.ymin));p.subtract(a.center,a.eye,r);z[0]=0<r[0]?b.xmax:b.xmin;z[1]=0<r[1]?b.ymax:b.ymin;z[2]=0<r[2]?q/2:-q/2;p.subtract(z,a.eye);p.normalize(r);a=1.1*p.dot(z,r)*c;u=m+f.earthRadius;u=Math.sqrt(u*u-f.earthRadius*f.earthRadius);b=Math.max(b.xmax-b.xmin,b.ymax-b.ymin);var v=1E-4*b*c;c=l.clamp((m-v)/(.001*b*c-v),0,1);k.distance=l.lerp(u,a,c*c*c);k.maxFarNearRatio=2E4;k.distance*=Math.max(Math.log(Math.abs(d)),1);k.distance=Math.min(k.distance,Math.max(34064E4,
q));return k},getFallbackCenterAlongViewDirection:function(a,b,c){p.set(b,c)}})})},"esri/views/3d/terrain/StableSurfaceCenter":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/HandleRegistry ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/Point ../support/aaBoundingRect".split(" "),function(w,l,f,a,d,b,q,t,m,k){return function(d){function l(a){a=d.call(this,
a)||this;a._updatePromise=null;a._set("center",null);return a}f(l,d);l.prototype.normalizeCtorArgs=function(a){this._set("view",a.view);return{}};l.prototype.initialize=function(){var a=this;this._handles=new b;this._handles.add(this.watch("surfaceView.extent",function(){return a._update()}));this._handles.add(q.on(this,"surface.layers","change",function(){return a._update()}));this._update()};l.prototype.destroy=function(){this._handles.destroy()};l.prototype._update=function(){var a=this;this._updatePromise&&
(this._updatePromise.cancel("cancel"),this._updatePromise=null);if(this.surfaceView){var b=k.center(this.surfaceView.extent),b=new m(b[0],b[1],this.surfaceView.spatialReference);this.surface&&0<this.surface.layers.length?(this._set("center",null),this._updatePromise=this.surface.queryElevation(b,{noDataValue:0}).then(function(b){a._updatePromise=null;a._set("center",b.geometry)}).otherwise(function(a){"cancel"!==a&&console.error("StableSurfaceCenter failed to update: ",a)})):(b.z=0,this._set("center",
b))}else this._set("center",null)};a([t.property({readOnly:!0})],l.prototype,"view",void 0);a([t.property({readOnly:!0,aliasOf:"view.map.ground"})],l.prototype,"surface",void 0);a([t.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],l.prototype,"surfaceView",void 0);a([t.property({readOnly:!0})],l.prototype,"center",void 0);return l=a([t.subclass("esri.views.3d.terrain.StableSurfaceCenter")],l)}(t.declared(d))})},"esri/views/3d/navigation/planar/AnimationPlanar":function(){define(["../mixins/AnimationMixin",
"../../lib/glMatrix","../../support/mathUtils"],function(w,l,f){function a(a,b){var d=b[0]-a[0],f=b[1]-a[1],k=b[2]-a[2];a=b[3]-a[3];return d*d+f*f+k*k+a*a}function d(b,d){return Math.sqrt(a(b,d))}function b(a){this.interpolate=function(a,b,d){d=Math.min(5*d,.3);t.lerp(a.eye,b.eye,d);t.lerp(a.center,b.center,d);t.lerp(a.up,b.up,d);a.fov=f.lerp(a.fov,b.fov,d);a.padding=m.lerp(a.padding,b.padding,d,k)}}function q(a,b,l){b=b||250;l=l||b;var p=0,r=0,q=0,x=0,w=0,c=function(c,d,f,k,m){return a.easeInOutInterpLinear(l,
b,c,d,f,k,m)};this.interpolate=function(a,b,l){p=c(a.eye,b.eye,l,p,t);r=c(a.center,b.center,l,r,t);q=c(a.up,b.up,l,q,t);w=c(a.padding,b.padding,l,w,{dist:d,lerp:function(a,b,c){return m.lerp(a,b,c,k)},set:function(b){a.padding=b}});x=c(a.fov,b.fov,l,x,{dist:function(a,b){return Math.abs(b-a)},lerp:f.lerp,set:function(b){a.fov=b}})}}var t=l.vec3d,m=l.vec4d,k=m.create();return w.createSubclass({declaredClass:"esri.views.3d.navigation.planar.AnimationPlanar",constructor:function(){this.interpolationTypes=
{linear:b,easeInOut:q}}})})},"esri/views/3d/navigation/planar/actions/PanPlanar":function(){define(["./ActionPlanar","../../mixins/PanMixin","../../../lib/glMatrix","../../../webgl-engine/lib/Util"],function(w,l,f,a){var d=f.vec2d,b=f.vec3d,q=b.create(),t=b.create(),m=b.create(),k=b.create(),p=b.create(),x=b.create(),z=Math.PI/9,v=b.create(),r=b.create();return w.createSubclass([l],{declaredClass:"esri.views.3d.navigation.planar.actions.PanPlanar",begin:function(a){this.inherited(arguments);this.pickPointInScreen(a,
q)||this.pickFreePointInScreen(a,q);b.normalize(b.subtract(this.targetCamera.eye,this.targetCamera.center,t));this.renderCoordsHelper.worldUpAtPosition(a,x);var f=b.dot(t,x);0>f&&(b.negate(t),f=-f);var k=Math.asin(f);k>=z?b.set(x,t):(b.subtract(t,b.scale(x,f,m)),b.normalize(t),k>z&&(b.lerp(t,x,(k-z)/(z-z)),b.normalize(t)));this.updatePlane(q,t);d.set(a,this._dragLastPoint);d.set(a,this._dragBeginPoint)},update:function(a){this._intersectPanPlane(this._dragLastPoint,this._dragBeginPoint,v)&&this._intersectPanPlane(a,
this._dragBeginPoint,r)&&(b.subtract(r,v),b.subtract(this.targetCamera.eye,r),b.subtract(this.targetCamera.center,r),d.set(a,this._dragLastPoint),this.constrainTargetEyeByElevationAndMoveLookAt(),this.targetAndCurrentChanged())},_intersectPanPlane:function(d,f,m){this.createPickRay(d,f,this.currentCamera.viewMatrix,k,p);b.subtract(p,k);return a.rayPlane(k,p,this._plane,m)},end:function(a){this.setPoiAuto(a,!0);this._navSphereRadius=0;this.inherited(arguments)}})})},"esri/views/3d/navigation/planar/actions/ActionPlanar":function(){define(["../../Action",
"../../../lib/glMatrix"],function(w,l){var f=l.vec3d,a=l.vec4d;return w.createSubclass({declaredClass:"esri.views.3d.navigation.planar.actions.ActionPlanar",constructor:function(){this._plane=a.create()},updatePlane:function(d,b){a.set4(b[0],b[1],b[2],-f.dot(b,d),this._plane)}})})},"esri/views/3d/navigation/planar/actions/RotatePlanar":function(){define(["./ActionPlanar","../../mixins/RotateMixin"],function(w,l){return w.createSubclass([l],{declaredClass:"esri.views.3d.navigation.planar.actions.RotatePlanar"})})},
"esri/views/3d/navigation/planar/actions/ZoomPlanar":function(){define(["./ActionPlanar","../../mixins/ZoomMixin","../../../lib/glMatrix","../../../webgl-engine/lib/Util"],function(w,l,f,a){var d=f.vec2d,b=f.vec3d,q=b.create(),t=b.create(),m=b.create(),k=b.create(),p=b.create(),x=b.create();return w.createSubclass([l],{declaredClass:"esri.views.3d.navigation.planar.actions.ZoomPlanar",begin:function(a){this.inherited(arguments);this.pickPointInScreen(a,p)||this.pickFreePointInScreen(a,p);b.normalize(b.subtract(this.targetCamera.eye,
this.targetCamera.center,k));0>k[1]&&b.negate(k);this.updatePlane(p,k)},update:function(f){b.set(this.targetCamera.center,x);this.createPickRay(this._dragBeginPoint,this._dragBeginPoint,this.currentCamera.viewMatrix,q,t);b.subtract(t,q);a.rayPlane(q,t,this._plane,x);this.normalizeCoordinate(f,q);f=4*(this.normalizedAnchorPoint[1]-q[1]);d.set(q,this.normalizedAnchorPoint);this._applyZoom(x,f);f=this._toYDownCoord(this._dragLastPoint);this.emit("update",f[0],f[1])},_applyZoom:function(a,d){b.subtract(a,
this.targetCamera.eye,m);var f=b.length(m),k=f*(1-d);0<=d&&k<this.minPoiDist&&(k=this.minPoiDist);k=this.limitAltitude(k,a,m);1E-6>Math.abs(f-k)||(d=-(k-f)/f,b.scale(m,d),b.add(this.targetCamera.eye,m),b.lerp(this.targetCamera.center,a,d),this.fixTargetUpVector(),this.targetAndCurrentChanged())},stepAtPoint:function(a,d,f,k){b.set(d,x);b.subtract(x,this.targetCamera.eye,m);d=b.length(m);f=d*a;1>=a&&f<this.minPoiDist&&(f=this.minPoiDist);f=this.limitAltitude(f,x,m);a=f/d;1E-6<=Math.abs(d-f)&&(b.scale(m,
f/d),b.subtract(x,m,this.targetCamera.eye),b.lerp(this.targetCamera.center,x,1-a),this.constrainTargetEyeByElevation(),this.fixTargetUpVector(),this.targetAnimatedChanged(!1,{internalUpdate:!0}))}})})},"esri/views/3d/support/Frustum":function(){define(["../../../core/declare","../lib/glMatrix","../support/earthUtils","../webgl-engine/lib/Util"],function(w,l,f,a){var d=l.vec3d,b=l.vec4d;return w([],{constructor:function(){this.planes=Array(6);this.points=Array(8);this.lines=Array(12);this.origin=d.create();
this.direction=d.create();this.dirty=!1;this._altitude=null;for(var a=0;6>a;a++)this.planes[a]=b.create();for(a=0;8>a;a++)this.points[a]=d.create();for(a=0;12>a;a++)this.lines[a]={origin:null,direction:d.create(),endpoint:null}},_makeLine:function(a,b,f){a.origin=b;a.endpoint=f;d.direction(f,b,a.direction)},update:function(b){if(this.dirty){a.matrix2frustumPlanes(b.viewMatrix,b.projectionMatrix,this.points,this.planes);for(var f=0;4>f;f++){var m=f,k=f+4;this._makeLine(this.lines[f],this.points[m],
this.points[k]);this._makeLine(this.lines[f+4],this.points[m],3===f?this.points[0]:this.points[m+1]);this._makeLine(this.lines[f+8],this.points[k],3===f?this.points[4]:this.points[k+1])}d.set(b.eye,this.origin);d.set(b.viewForward,this.direction);this._altitude=null;this.dirty=!1}},altitude:function(){return null!=this._altitude?this._altitude:this._altitude=d.length(this.origin)-f.earthRadius}})})},"esri/views/ui/3d/DefaultUI3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../DefaultUI dojo/_base/lang".split(" "),
function(w,l,f,a,d,b,q){return function(b){function m(){return b.call(this)||this}f(m,b);m.prototype.getDefaults=function(){return q.mixin(this.inherited(arguments),{components:["attribution","zoom","navigation-toggle","compass"]})};return m=a([d.subclass("esri.views.ui.3d.DefaultUI3D")],m)}(d.declared(b))})},"jimu/OnScreenWidgetIcon":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dijit/_WidgetBase ./utils".split(" "),function(w,l,f,a,d,b,q){return w(b,
{"class":"jimu-widget-onscreen-icon",postCreate:function(){this.inherited(arguments);this.iconNode=a.create("img",{src:this.widgetConfig.icon},this.domNode);a.setAttr(this.domNode,"title",this.widgetConfig.label);this.own(d(this.domNode,"click",l.hitch(this,function(){this.onClick()})));this.position=l.clone(this.widgetConfig.position);"map"===this.widgetConfig.position.relativeTo&&this.own(d(this.sceneView,"resize",l.hitch(this,function(){var a=l.clone(this.position);delete a.width;delete a.height;
this.panel&&this.panel.setPosition(a)})));this.state="closed"},startup:function(){this.inherited(arguments)},onClick:function(){"closed"===this.state?this.switchToOpen():this.switchToClose()},moveTo:function(b){var d={left:"auto",right:"auto",bottom:"auto",top:"auto",width:"auto",height:"auto"},d=l.mixin(d,q.getPositionStyle(b));delete d.width;delete d.height;a.setStyle(this.domNode,d);this.position=l.clone(b);this.widgetConfig&&this.widgetConfig.panel&&(this.widgetConfig.panel.position=l.clone(b),
this.widgetConfig.position=l.clone(b));this.panel&&this.panel.setPosition(l.clone(b));this.widget&&this.widget.setPosition(this.getOffPanelWidgetPosition(this.widget))},destroy:function(){this.panel?this.panelManager.destroyPanel(this.panel):this.widget&&this.widgetManager.destroyWidget(this.widget);this.inherited(arguments)},switchToOpen:function(){this.state="opened";this.panelManager.closeAllPanelsInGroup(this.widgetConfig.gid);f.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(a){a.closeable&&
this.widgetManager.closeWidget(a)},this);a.addClass(this.domNode,"jimu-state-selected");this._showLoading();!1===this.widgetConfig.inPanel?this.widgetManager.loadWidget(this.widgetConfig).then(l.hitch(this,function(a){this.widget=a;a.setPosition(this.getOffPanelWidgetPosition(a));this.widgetManager.openWidget(a);this.own(d(a,"close",l.hitch(this,function(){this.switchToClose()})));this._hideLoading()})):this.panelManager.showPanel(l.clone(this.widgetConfig)).then(l.hitch(this,function(a){this.panel=
a;this.own(d(a,"close",l.hitch(this,function(){this.switchToClose()})));this._hideLoading()}))},switchToClose:function(){this.state="closed";a.removeClass(this.domNode,"jimu-state-selected");!1===this.widgetConfig.inPanel?this.widgetManager.closeWidget(this.widget):this.panelManager.closePanel(this.panel)},getOffPanelWidgetPosition:function(b){var d={relativeTo:b.position.relativeTo},f=a.getMarginBox(this.domNode);b=this.widgetManager.getWidgetMarginBox(b);var l=a.getMarginBox("map"===d.relativeTo?
this.sceneView.map.id:jimuConfig.layoutId),q=f.t+f.h+1;q+b.h>l.h?d.bottom=l.h-f.t+1:d.top=q;window.isRTL?d.right=0>f.l+f.w-b.w?0:f.l+f.w-b.w:f.l+b.w>l.w?d.right=0:d.left=f.l;return d},_showLoading:function(){a.setAttr(this.iconNode,"src",require.toUrl("jimu")+"/images/loading_circle.gif")},_hideLoading:function(){a.setAttr(this.iconNode,"src",this.widgetConfig.icon)}})})},"jimu/WidgetPlaceholder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase","./utils"],
function(w,l,f,a,d){return w(a,{"class":"jimu-widget-placeholder",position:null,postCreate:function(){this.inherited(arguments);this.indexNode=f.create("div",{"class":"inner",innerHTML:this.index},this.domNode);f.setAttr(this.domNode,"title",window.jimuNls.widgetPlaceholderTooltip)},moveTo:function(a){this.position=l.clone(a);var b={left:"auto",right:"auto",bottom:"auto",top:"auto",width:"auto",height:"auto"},b=l.mixin(b,d.getPositionStyle(a));delete b.width;delete b.height;f.setStyle(this.domNode,
b)},setIndex:function(a){this.index=a;this.indexNode.innerHTML=a}})})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","./WidgetManager"],function(w,l,f,a){var d=null,b;b=w(null,{constructor:function(){f.subscribe("publishData",l.hitch(this,this.onDataPublished));f.subscribe("fetchData",l.hitch(this,this.onFetchData));f.subscribe("clearAllData",l.hitch(this,this.onClearAllData));f.subscribe("removeData",l.hitch(this,this.onRemoveData));f.subscribe("clearDataHistory",
l.hitch(this,this.onClearDataHistory));this.widgetManager=a.getInstance()},_dataStore:{},onDataPublished:function(a,b,d,f){"undefined"===typeof f&&(f=!1);this._dataStore[b]?(this._dataStore[b].current=d,f&&(this._dataStore[b].history?this._dataStore[b].history.push(d):this._dataStore[b].history=[d])):(this._dataStore[b]={current:d},f&&(this._dataStore[b].history=[d]))},onFetchData:function(a){var b;if(a)"framework"===a?this._dataStore[a]?f.publish("dataFetched","framework","framework",this._dataStore[a].current,
this._dataStore[a].history):f.publish("noData","framework","framework"):(b=this.widgetManager.getWidgetById(a))?this._dataStore[a]?f.publish("dataFetched",b.name,a,this._dataStore[a].current,this._dataStore[a].history):f.publish("noData",b.name,a):f.publish("noData",void 0,a);else for(var d in this._dataStore)(b=this.widgetManager.getWidgetById(d))&&f.publish("dataFetched",b.name,d,this._dataStore[d].current,this._dataStore[d].history)},onClearAllData:function(){this._dataStore={};f.publish("allDataCleared")},
onRemoveData:function(a){delete this._dataStore[a];f.publish("dataRemoved",a)},onClearDataHistory:function(a){this._dataStore[a]&&(this._dataStore[a].history=[]);f.publish("dataHistoryCleared",a)}});b.getInstance=function(){null===d&&(d=new b);return d};return b})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),function(w,l,f,a,d,b,q,t,m){return w([b,q],
{type:"widget",id:void 0,label:void 0,icon:void 0,uri:void 0,position:{},config:void 0,openAtStart:!1,sceneView:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(d.subscribe("publishData",l.hitch(this,this._onReceiveData)));this.own(d.subscribe("dataFetched",l.hitch(this,this._onReceiveData)));this.own(d.subscribe("noData",
l.hitch(this,this._onNoData)))},startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(a){},onSignOut:function(){},onPositionChange:function(a){this.setPosition(a)},setPosition:function(b,d){this.position=b;var f=t.getPositionStyle(this.position);f.position="absolute";d||(d="map"===b.relativeTo?this.sceneView.map.id:
window.jimuConfig.layoutId);a.place(this.domNode,d);a.setStyle(this.domNode,f);this.started&&this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return a.getMarginBox(this.domNode)},setState:function(a){this.state=a},setWindowState:function(a){this.windowState=a},resize:function(){},onConfigChanged:function(a){},onAppConfigChanged:function(a,b,d){},onAction:function(a,b){},getPanel:function(){if(!1===this.inPanel)return null;if("widgetOnScreen"===this.gid||"widgetPool"===
this.gid)return m.getInstance().getPanelById(this.id+"_panel");var a=m.getInstance().getPanelById(this.gid+"_panel");return a?a:m.getInstance().getPanelById(this.id+"_panel")},publishData:function(a,b){"undefined"===typeof b&&(b=!1);d.publish("publishData",this.name,this.id,a,b)},fetchData:function(a){a?d.publish("fetchData",a):0!==this.listenWidgetIds.length?f.forEach(this.listenWidgetIds,function(a){d.publish("fetchData",a)},this):d.publish("fetchData")},fetchDataByName:function(a){a=this.widgetManager.getWidgetsByName(a);
f.forEach(a,function(a){this.fetchData(a.id)},this)},openWidgetById:function(a){return this.widgetManager.triggerWidgetOpen(a)},_onReceiveData:function(a,b,d,f){if(b!==this.id&&!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(b)))this.onReceiveData(a,b,d,f)},onReceiveData:function(a,b,d,f){},_onNoData:function(a,b){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(b)))this.onNoData(a,b)},onNoData:function(a,b){}})})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(w,l,f,a){return w([a],{widget:null,baseClass:"jimu-widget-frame jimu-container",postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&"closed"!==this.widget.state&&l.isFunction(this.widget.resize)&&this.widget.resize()},setLoading:function(a){this.loading=
a;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(a){this.widget=a;this.loading&&this.loading.destroy();f.place(a.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&this.widget.domNode)try{this.widget.destroy()}catch(d){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+d.stack)}this.loading&&this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),
function(w,l,f,a,d,b,q,t,m){return w([d,b],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var a=this.getAllWidgetConfigs(),a=Array.isArray(this.config.widgets)?this.config.widgets:[this.config];f.forEach(a,function(a){var b,d;!1!==a.visible&&(d=new q,b=this.createFrame(a),
this.addChild(b),b.setLoading(d),this.widgetManager.loadWidget(a).then(l.hitch(this,function(a){b.setWidget(a);a.startup()})))},this)},getAllWidgetConfigs:function(){var a=[];return a=Array.isArray(this.config.widgets)?this.config.widgets:[this.config]},getWidgetById:function(a){for(var b=this.getChildren(),d=0;d<b.length;d++)if(b[d].getWidget()&&b[d].getWidget().id===a)return b[d].getWidget()},createFrame:function(a){return new t},setPosition:function(b,d){this.position=b;var f=m.getPositionStyle(this.position);
f.position="absolute";d||(d="map"===b.relativeTo?this.sceneView.map.id:window.jimuConfig.layoutId);this.started?this.resize():this.openAnimation&&(f.display="none");a.place(this.domNode,d);a.setStyle(this.domNode,f)},getPosition:function(){return this.position},setState:function(a){this.state=a},setWindowState:function(a){this.windowState=a},resize:function(){this.getChildren().forEach(function(a){a.resize()})},onPositionChange:function(a){this.setPosition(a)},onOpen:function(){f.forEach(this.getChildren(),
function(a){a.getWidget()&&this.widgetManager.openWidget(a.getWidget())},this)},onClose:function(){f.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.closeWidget(a.getWidget())},this)},onMaximize:function(){f.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.maximizeWidget(a.getWidget())},this)},onMinimize:function(){f.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.minimizeWidget(a.getWidget())},this)},onNormalize:function(){f.forEach(this.getChildren(),
function(a){a.getWidget()&&this.widgetManager.normalizeWidget(a.getWidget())},this)},onActive:function(){},onDeActive:function(){},updateConfig:function(a){this._updateConfig(a)},reloadWidget:function(a){this.isWidgetInPanel(a)&&(this._updateConfig(a),this.getChildren().forEach(function(b){b.getWidget()&&b.getWidget().id===a.id&&(b.getWidget().destroy(),b.setLoading(new q),this.widgetManager.loadWidget(a).then(l.hitch(this,function(a){b.setWidget(a);a.startup();"closed"===this.state&&this.widgetManager.closeWidget(a)})))},
this))},isWidgetInPanel:function(a){return f.some(this.getAllWidgetConfigs(),function(b){if(a.id===b.id)return!0})?!0:!1},_updateConfig:function(a){if(Array.isArray(this.config.widgets)){for(var b=-1,d=0;d<this.config.widgets.length;d++)this.config.widgets[d].id===a.id&&(b=d);0<b&&(this.config.widgets[b]=a)}else this.config=a},destroy:function(){this.getChildren().forEach(function(a){try{a.domNode&&a.destroy()}catch(p){console.error("destroy widget frame error."+p.stack)}});this.inherited(arguments)}})})},
"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-style","dojo/dom-construct"],function(w,l,f,a){return w(l,{baseClass:"jimu-loading-indicator",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);(this.hidden=!0===this.hidden)&&f.set(this.domNode,{display:"none"});f.set(this.domNode,{width:"100%",height:"100%"});var d='\x3cdiv class\x3d"loading-section"\x3e\x3cimg class\x3d"jimu-loading" src\x3d"'+
require.toUrl("jimu")+'/images/loading2.gif"\x3e\x3c/div\x3e';a.place(d,this.domNode)},show:function(){this.domNode&&f.set(this.domNode,"display","block")},hide:function(){this.domNode&&f.set(this.domNode,"display","none")}})})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(w,l,f,a,d){return w([a,d],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(f(window,"resize",l.hitch(this,
this._onWindowResize)))},getConfig:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array","jimu/PanelManager"],function(w,l,f){return w(null,{constructor:function(){this.panelManager=f.getInstance()},postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(a){},getConfigById:function(a){for(var d=
this.getAllConfigs(),b=0;b<d.length;b++)if(d[b].id===a)return d[b]},getAllConfigs:function(){var a=[],a=a.concat(this.getWidgetConfigs(),this.getGroupConfigs()),a=l.filter(a,function(a){return a.visible});return a.sort(function(a,b){return a.index-b.index})},getAllConfigsIncludeInvisible:function(){var a=[],a=a.concat(this.getWidgetConfigs(),this.getGroupConfigs());return a.sort(function(a,b){return a.index-b.index})},isControlled:function(a){return l.some(this.getAllConfigsIncludeInvisible(),function(d){return d.id===
a})},widgetIsControlled:function(a){return l.some(this.getAllConfigsIncludeInvisible(),function(d){return d.id===a?!0:l.some(d.widgets,function(b){return b.id===a})})},getGroupConfigs:function(){var a=[];if(!this.appConfig.widgetPool)return a;this.appConfig.widgetPool.groups&&l.forEach(this.appConfig.widgetPool.groups,function(d){this.controlledGroups&&(Array.isArray(this.controlledGroups)?-1<this.controlledGroups.indexOf(d.id)&&a.push(d):"all"===this.controlledGroups&&a.push(d))},this);return a},
getWidgetConfigs:function(){var a=[];if(!this.appConfig.widgetPool)return a;this.appConfig.widgetPool.widgets&&l.forEach(this.appConfig.widgetPool.widgets,function(d){this.controlledWidgets&&(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(d.id)&&a.push(d):"all"===this.controlledWidgets&&a.push(d))},this);return a}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/geometry/SpatialReference ./unitUtils".split(" "),
function(w,l,f,a,d,b,q,t){var m=null,k=null,p=!1;w=w(null,function(){});var x=require.toUrl("jimu"),z=b(x+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),v=b(x+"/SpatialReference/transform.json",{handleAs:"json"});w.loadResource=function(){var b=new a;if(m&&k)return b.resolve(),b;d([z,v]).then(function(a){m=a[0];k=a[1];p=!0;b.resolve()},function(a){console.error(a);p=!1;b.reject(a)});return b};w.getAllCSUnits=function(){if(p){var a=[];f.forEach(m.wkids,l.hitch(this,function(b){b=this.getCSUnit(b);
-1===f.indexOf(a,b)&&a.push(b)}));return a}};w.convertUnit=function(a,b,d){if(p)return t.convertUnit(a,b,d)};w.getUnitRate=function(a,b){if(p)return t.getUnitRate(a,b)};w.isProjectUnit=function(a){if(p)return t.isProjectUnit(a)};w.isGeographicUnit=function(a){if(p)return t.isGeographicUnit(a)};w.getGeographicUnits=function(){if(p)return t.getGeographicUnits()};w.getProjectUnits=function(){if(p)return t.getProjectUnits()};w.getCSUnit=function(a){if(p){a=this.getCSStr(a);var b=0,d=0,b=a.lastIndexOf("UNIT"),
d=a.indexOf(",",b);return a.slice(b+6,d-1)}};w.isSameSR=function(a,b){if(p)return a=this.indexOfWkid(a),b=this.indexOfWkid(b),m.labels[a]===m.labels[b]};w.isValidWkid=function(a){if(p)return-1<this.indexOfWkid(a)};w.getSRLabel=function(a){if(p&&this.isValidWkid(a))return a=this.indexOfWkid(a),m.labels[a]};w.indexOfWkid=function(a){if(p)return f.indexOf(m.wkids,a)};w.isWebMercator=function(a){return q.prototype._isWebMercator?q.prototype._isWebMercator.apply({wkid:parseInt(a,10)},[]):(new q(parseInt(a,
10))).isWebMercator};w.standardizeWkid=function(a){return this.isWebMercator(a)?3857:parseInt(a,10)};w.isValidTfWkid=function(a){if(p)return-1<this.indexOfTfWkid(a)};w.getTransformationLabel=function(a){if(p)return this.isValidTfWkid(a)?(a=this.indexOfTfWkid(a),k.labels[a]):""};w.indexOfTfWkid=function(a){if(p)return f.indexOf(k.tfWkids,a)};w.isGeographicCS=function(a){if(p)return this.isValidWkid(a)?m.details[this.indexOfWkid(a)].startWith("GEOGCS"):!1};w.isProjectedCS=function(a){if(p)return this.isValidWkid(a)?
m.details[this.indexOfWkid(a)].startWith("PROJCS"):!1};w.getGeoCSByProj=function(a){if(p&&this.isProjectedCS(a))return a=this.getSpheroidStr(a),a=f.indexOf(m.details,a),m.wkids[a]};w.getSpheroidStr=function(a){if(p){if(this.isGeographicCS(a))return m.details[this.indexOfWkid(a)];if(this.isProjectedCS(a)){a=m.details[this.indexOfWkid(a)];var b=a.indexOf("GEOGCS"),d=a.indexOf("PROJECTION")-1;return a.slice(b,d)}return null}};w.getCSStr=function(a){if(p)return m.details[this.indexOfWkid(a)]};w.isSameSpheroid=
function(a,b){if(p)return a=this.getSpheroidStr(a),b=this.getSpheroidStr(b),a&&b&&a===b?!0:!1};return w})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare","dojo/_base/array"],function(w,l){var f="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),
a="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),d={INCHES:.0254,FOOT:.3048,FOOT_US:.3048006096012192,YARDS:.9144,MILES:1609.344,NAUTICAL_MILES:1852,MILLIMETERS:.001,CENTIMETERS:.01,METER:1,KILOMETERS:1E3,DECIMETERS:.1,LINK_CLARKE:.2011661949,FOOT_GOLD_COAST:.3047997101815088,FOOT_CLARKE:.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:.9143984146160287,CHAIN_SEARS:20.11676512155263,FOOT_SEARS:.3047994715386762,
YARD_INDIAN_1937:.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:.0174532925199433,DECIMAL_DEGREES:.0174532925199433,MGRS:.0174532925199433,USNG:.0174532925199433,DEGREE_MINUTE_SECONDS:.0174532925199433,GRAD:.01570796326794897};w=w(null,function(){});w.convertUnit=function(a,f,l){return d[a.toUpperCase()]/d[f.toUpperCase()]*l};w.getUnitRate=function(a,f){return d[a.toUpperCase()]/d[f.toUpperCase()]};w.isProjectUnit=function(a){return-1<l.indexOf(f,a.toUpperCase())};w.isGeographicUnit=function(b){return-1<
l.indexOf(a,b.toUpperCase())};w.getGeographicUnits=function(){return a};w.getProjectUnits=function(){return f};return w})},"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle dojo/touch".split(" "),function(w,l,f,a,d,b,q,t,m){return w([q,b],{baseClass:"jimu-panel jimu-on-screen-widget-panel",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,
templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title jimu-main-background" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode"\x3e${label}\x3c/div\x3e\x3cdiv class\x3d"close-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,press:_onCloseBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"max-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"foldable-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w)},_onMaxBtnClicked:function(a){a.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?this.panelManager.normalizePanel(this):this.panelManager.maximizePanel(this),this._setMobilePosition())},_onFoldableBtnClicked:function(a){a.stopPropagation();
this._getPositionInfo().isRunInMobile&&("minimized"===this.windowState?(f.removeClass(this.foldableNode,"fold-up"),f.addClass(this.foldableNode,"fold-down"),this.panelManager.normalizePanel(this)):(f.removeClass(this.foldableNode,"fold-down"),f.addClass(this.foldableNode,"fold-up"),this.panelManager.minimizePanel(this)),this._setMobilePosition())},_onCloseBtnClicked:function(a){this.panelManager.closePanel(this);a.stopPropagation()},_normalizePositionObj:function(a){var b=this._getLayoutBox();a.left=
isFinite(a.left)?a.left:b.w-a.right;a.top=isFinite(a.top)?a.top:b.h-a.bottom;delete a.right;delete a.bottom;this.position=l.mixin(l.clone(this.position),a)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();
this.resizeHandle=(new m({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(b,m){this.disableMoveable();var k=f.getMarginBox(jimuConfig.layoutId);k.l=k.l-b+m;k.w+=2*(b-m);this.moveable=new d.boxConstrainedMoveable(this.domNode,{box:k,handle:this.titleNode,within:!0});this.own(a(this.moveable,
"Moving",l.hitch(this,this.onMoving)));this.own(a(this.moveable,"MoveStop",l.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);this.inherited(arguments)},_switchToMobileUI:function(){f.removeClass(this.titleNode,"title-normal");f.addClass(this.titleNode,"title-full");f.setStyle(this.foldableNode,"display",
"block");f.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(f.removeClass(this.foldableNode,"fold-up"),f.addClass(this.foldableNode,"fold-down")):(f.removeClass(this.foldableNode,"fold-down"),f.addClass(this.foldableNode,"fold-up"))},_switchToDesktopUI:function(){f.removeClass(this.titleNode,"title-full");f.addClass(this.titleNode,"title-normal");f.setStyle(this.foldableNode,"display","none");f.setStyle(this.maxNode,"display","none")},resize:function(a){var b=this._getPositionInfo(),
d={left:b.position.left,top:b.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};a&&(a.t=this.domNode.offsetTop,d.left=isFinite(a.l)?a.l:d.left,d.top=isFinite(a.t)?a.t:d.top,d.width=isFinite(a.w)?a.w:d.width,d.height=isFinite(a.h)?a.h:d.height,this._normalizePositionObj(l.clone(d)),this.makePositionInfoBox(),d.width=this._positionInfoBox.w,d.height=this._positionInfoBox.h);b.position=d;this._onResponsible(b);this.inherited(arguments)},_onResponsible:function(a){a.isRunInMobile?
(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(a.position),this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(a){this._normalizePositionObj(a);this.makePositionInfoBox();a=this._getPositionInfo();this._onResponsible(a)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var a=jimuConfig.layoutId,
a="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return f.getMarginBox(a)},_getPositionInfo:function(){var a={isRunInMobile:!1,position:{left:0,top:5}},b=this._getLayoutBox(),d=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return a.isRunInMobile=!0,a;a.position.left=window.isRTL?b.w-d:d;var d=this._positionInfoBox.t,f=b.h-d;d>=f?d>=this._positionInfoBox.h&&(a.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):f>=this._positionInfoBox.h&&(a.position.top=
this._positionInfoBox.t+40+3);!a.isRunInMobile&&a.position.left+this._positionInfoBox.w>b.w&&(a.position.left-=this._positionInfoBox.w);return a},_setMobilePosition:function(){f.place(this.domNode,jimuConfig.layoutId);var a=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(a.zIndex=this.position.zIndex);var b=t.getPositionStyle(a);l.mixin(b,a.borderRadiusStyle);f.setStyle(this.domNode,b)},_setDesktopPosition:function(a){f.place(this.domNode,jimuConfig.mapId);f.setStyle(this.domNode,
{left:a.left+"px",right:"auto",top:a.top+"px",width:(a.width||this.position.width||this._originalBox.w)+"px",height:(a.height||this.position.height||this._originalBox.h)+"px"})},onMoving:function(a){f.setStyle(a.node,"opacity",.9)},onMoveStop:function(a){f.setStyle(a.node,"opacity",1);a=f.getMarginBox(a.node);this._normalizePositionObj(l.clone({left:a.l,top:a.t,width:a.w,height:a.h}));this.makePositionInfoBox()}})})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C){w.experimental("dojox.layout.ResizeHandle");var E=z("dojox.layout._ResizeHelper",u,{show:function(){x.set(this.domNode,"display","")},hide:function(){x.set(this.domNode,"display","none")},resize:function(a){p.setMarginBox(this.domNode,a)}});return z("dojox.layout.ResizeHandle",[u,C],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,
minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,v.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=r.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new E({id:"dojoxGlobalResizeHelper"})).placeAt(q.body()),
k.add(this._resizeHelper.domNode,this.activeResizeClass)));this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var a=l.partial(k.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;a("dojoxResizeNW");break;case "x":this._resizeX=!0;a("dojoxResizeW");break;case "y":this._resizeY=!0,a("dojoxResizeN")}},_beginSizing:function(a){if(!this._isSizing&&
(f.publish(this.startTopic,[this]),this.targetDomNode=(this.targetWidget=r.byId(this.targetId))?this.targetWidget.domNode:m.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var b=p.position(this.targetDomNode,!0);this._resizeHelper.resize({l:b.x,t:b.y,w:b.w,h:b.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:b.x,t:b.y})}this._isSizing=!0;this.startPoint={x:a.clientX,y:a.clientY};
var b=x.getComputedStyle(this.targetDomNode),c="border-model"===p.boxModel?{w:0,h:0}:p.getPadBorderExtents(this.targetDomNode,b),k=p.getMarginExtents(this.targetDomNode,b);this.startSize={w:x.get(this.targetDomNode,"width",b),h:x.get(this.targetDomNode,"height",b),pbw:c.w,pbh:c.h,mw:k.w,mh:k.h};this.isLeftToRight()||"absolute"!=x.get(this.targetDomNode,"position")||(b=p.position(this.targetDomNode,!0),this.startPosition={l:b.x,t:b.y});this._pconnects=[f.connect(q.doc,v.move,this,"_updateSizing"),
f.connect(q.doc,v.release,this,"_endSizing")];d.stop(a)}},_updateSizing:function(a){if(this.activeResize)this._changeSizing(a);else{var b=this._getNewCoords(a,"border",this._resizeHelper.startPosition);if(!1===b)return;this._resizeHelper.resize(b)}a.preventDefault()},_getNewCoords:function(a,b,d){try{if(!a.clientX||!a.clientY)return!1}catch(H){return!1}this._activeResizeLastEvent=a;var c=(this.isLeftToRight()?1:-1)*(this.startPoint.x-a.clientX),f=this.startPoint.y-a.clientY;a=this.startSize.w-(this._resizeX?
c:0);f=this._checkConstraints(a,this.startSize.h-(this._resizeY?f:0));(d=d||this.startPosition)&&this._resizeX&&(f.l=d.l+c,f.w!=a&&(f.l+=a-f.w),f.t=d.t);switch(b){case "margin":f.w+=this.startSize.mw,f.h+=this.startSize.mh;case "border":f.w+=this.startSize.pbw,f.h+=this.startSize.pbh}return f},_checkConstraints:function(a,b){if(this.minSize){var c=this.minSize;a<c.w&&(a=c.w);b<c.h&&(b=c.h)}this.constrainMax&&this.maxSize&&(c=this.maxSize,a>c.w&&(a=c.w),b>c.h&&(b=c.h));if(this.fixedAspect){var c=this.startSize.w,
d=this.startSize.h,f=c*b-d*a;0>f?a=b*c/d:0<f&&(b=a*d/c)}return{w:a,h:b}},_changeSizing:function(a){var c=this.targetWidget&&l.isFunction(this.targetWidget.resize),d=this._getNewCoords(a,c&&"margin");if(!1!==d&&(c?this.targetWidget.resize(d):this.animateSizing?t[this.animateMethod]([b.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:d.w}},duration:this.animateDuration}),b.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:d.h}},
duration:this.animateDuration})]).play():x.set(this.targetDomNode,{width:d.w+"px",height:d.h+"px"}),this.intermediateChanges))this.onResize(a)},_endSizing:function(b){a.forEach(this._pconnects,f.disconnect);var c=l.partial(f.publish,this.endTopic,[this]);this.activeResize?c():(this._resizeHelper.hide(),this._changeSizing(b),setTimeout(c,this.animateDuration+15));this._isSizing=!1;this.onResize(b)},onResize:function(a){}})})},"dojo/fx":function(){define("./_base/lang ./Evented ./_base/kernel ./_base/array ./aspect ./_base/fx ./dom ./dom-style ./dom-geometry ./ready require".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p){f.isAsync||k(0,function(){p(["./fx/Toggler"])});f=f.fx={};k={_fire:function(a,b){this[a]&&this[a].apply(this,b||[]);return this}};var x=function(b){this._index=-1;this._animations=b||[];this._current=this._onAnimateCtx=this._onEndCtx=null;this.duration=0;a.forEach(this._animations,function(a){a&&("undefined"!=typeof a.duration&&(this.duration+=a.duration),a.delay&&(this.duration+=a.delay))},this)};x.prototype=new l;w.extend(x,{_onAnimate:function(){this._fire("onAnimate",
arguments)},_onEnd:function(){this._onAnimateCtx.remove();this._onEndCtx.remove();this._onAnimateCtx=this._onEndCtx=null;this._index+1==this._animations.length?this._fire("onEnd"):(this._current=this._animations[++this._index],this._onAnimateCtx=d.after(this._current,"onAnimate",w.hitch(this,"_onAnimate"),!0),this._onEndCtx=d.after(this._current,"onEnd",w.hitch(this,"_onEnd"),!0),this._current.play(0,!0))},play:function(a,b){this._current||(this._current=this._animations[this._index=0]);if(!b&&"playing"==
this._current.status())return this;var f=d.after(this._current,"beforeBegin",w.hitch(this,function(){this._fire("beforeBegin")}),!0),k=d.after(this._current,"onBegin",w.hitch(this,function(a){this._fire("onBegin",arguments)}),!0),m=d.after(this._current,"onPlay",w.hitch(this,function(a){this._fire("onPlay",arguments);f.remove();k.remove();m.remove()}));this._onAnimateCtx&&this._onAnimateCtx.remove();this._onAnimateCtx=d.after(this._current,"onAnimate",w.hitch(this,"_onAnimate"),!0);this._onEndCtx&&
this._onEndCtx.remove();this._onEndCtx=d.after(this._current,"onEnd",w.hitch(this,"_onEnd"),!0);this._current.play.apply(this._current,arguments);return this},pause:function(){if(this._current){var a=d.after(this._current,"onPause",w.hitch(this,function(b){this._fire("onPause",arguments);a.remove()}),!0);this._current.pause()}return this},gotoPercent:function(b,d){this.pause();var f=this.duration*b;this._current=null;a.some(this._animations,function(a,b){if(f<=a.duration)return this._current=a,this._index=
b,!0;f-=a.duration;return!1},this);this._current&&this._current.gotoPercent(f/this._current.duration);d&&this.play();return this},stop:function(a){if(this._current){if(a){for(;this._index+1<this._animations.length;++this._index)this._animations[this._index].stop(!0);this._current=this._animations[this._index]}var b=d.after(this._current,"onStop",w.hitch(this,function(a){this._fire("onStop",arguments);b.remove()}),!0);this._current.stop()}return this},status:function(){return this._current?this._current.status():
"stopped"},destroy:function(){this.stop();this._onAnimateCtx&&this._onAnimateCtx.remove();this._onEndCtx&&this._onEndCtx.remove()}});w.extend(x,k);f.chain=function(a){return new x(w.isArray(a)?a:Array.prototype.slice.call(a,0))};var z=function(f){this._animations=f||[];this._connects=[];this.duration=this._finished=0;a.forEach(f,function(a){var b=a.duration;a.delay&&(b+=a.delay);this.duration<b&&(this.duration=b);this._connects.push(d.after(a,"onEnd",w.hitch(this,"_onEnd"),!0))},this);this._pseudoAnimation=
new b.Animation({curve:[0,1],duration:this.duration});var k=this;a.forEach("beforeBegin onBegin onPlay onAnimate onPause onStop onEnd".split(" "),function(a){k._connects.push(d.after(k._pseudoAnimation,a,function(){k._fire(a,arguments)},!0))})};w.extend(z,{_doAction:function(b,d){a.forEach(this._animations,function(a){a[b].apply(a,d)});return this},_onEnd:function(){++this._finished>this._animations.length&&this._fire("onEnd")},_call:function(a,b){var d=this._pseudoAnimation;d[a].apply(d,b)},play:function(a,
b){this._finished=0;this._doAction("play",arguments);this._call("play",arguments);return this},pause:function(){this._doAction("pause",arguments);this._call("pause",arguments);return this},gotoPercent:function(b,d){var f=this.duration*b;a.forEach(this._animations,function(a){a.gotoPercent(a.duration<f?1:f/a.duration,d)});this._call("gotoPercent",arguments);return this},stop:function(a){this._doAction("stop",arguments);this._call("stop",arguments);return this},status:function(){return this._pseudoAnimation.status()},
destroy:function(){this.stop();a.forEach(this._connects,function(a){a.remove()})}});w.extend(z,k);f.combine=function(a){return new z(w.isArray(a)?a:Array.prototype.slice.call(a,0))};f.wipeIn=function(a){var f=a.node=q.byId(a.node),k=f.style,m;a=b.animateProperty(w.mixin({properties:{height:{start:function(){m=k.overflow;k.overflow="hidden";if("hidden"==k.visibility||"none"==k.display)return k.height="1px",k.display="",k.visibility="",1;var a=t.get(f,"height");return Math.max(a,1)},end:function(){return f.scrollHeight}}}},
a));var l=function(){k.height="auto";k.overflow=m};d.after(a,"onStop",l,!0);d.after(a,"onEnd",l,!0);return a};f.wipeOut=function(a){var f=(a.node=q.byId(a.node)).style,k;a=b.animateProperty(w.mixin({properties:{height:{end:1}}},a));d.after(a,"beforeBegin",function(){k=f.overflow;f.overflow="hidden";f.display=""},!0);var m=function(){f.overflow=k;f.height="auto";f.display="none"};d.after(a,"onStop",m,!0);d.after(a,"onEnd",m,!0);return a};f.slideTo=function(a){var f=null,k=null,l=function(a){return function(){var b=
t.getComputedStyle(a),d=b.position;f="absolute"==d?a.offsetTop:parseInt(b.top)||0;k="absolute"==d?a.offsetLeft:parseInt(b.left)||0;"absolute"!=d&&"relative"!=d&&(b=m.position(a,!0),f=b.y,k=b.x,a.style.position="absolute",a.style.top=f+"px",a.style.left=k+"px")}}(a.node=q.byId(a.node));l();a=b.animateProperty(w.mixin({properties:{top:a.top||0,left:a.left||0}},a));d.after(a,"beforeBegin",l,!0);return a};return f})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),
function(w,l,f,a,d,b,q,t,m){return b("dijit.layout._LayoutWidget",[l,f,a],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);q.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var a=this.getParent&&this.getParent();a&&a.isLayoutContainer||(this.resize(),this.own(d.on("resize",w.hitch(this,"resize"))))}},resize:function(a,b){var d=this.domNode;a&&t.setMarginBox(d,a);b=b||{};
w.mixin(b,a||{});"h"in b&&"w"in b||(b=w.mixin(t.getMarginBox(d),b));a=m.getComputedStyle(d);var f=t.getMarginExtents(d,a),k=t.getBorderExtents(d,a);b=this._borderBox={w:b.w-(f.w+k.w),h:b.h-(f.h+k.h)};f=t.getPadExtents(d,a);this._contentBox={l:m.toPixelValue(d,a.paddingLeft),t:m.toPixelValue(d,a.paddingTop),w:b.w-f.w,h:b.h-f.h};this.layout()},layout:function(){},_setupChild:function(a){q.add(a.domNode,this.baseClass+"-child "+(a.baseClass?this.baseClass+"-"+a.baseClass:""))},addChild:function(a,b){this.inherited(arguments);
this._started&&this._setupChild(a)},removeChild:function(a){q.remove(a.domNode,this.baseClass+"-child"+(a.baseClass?" "+this.baseClass+"-"+a.baseClass:""));this.inherited(arguments)}})})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(w,l){return w("dijit._Contained",null,{_getSibling:function(f){var a=this.getParent();return a&&a._getSiblingOfChild&&a._getSiblingOfChild(this,"previous"==f?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},
getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var f=this.getParent();return f&&f.getIndexOfChild?f.getIndexOfChild(this):-1}})})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u){p("dijit-legacy-requires")&&u(0,function(){w(["dijit/MenuItem",
"dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return f("dijit.Menu",r,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):l.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return z.get(this._iframeContentDocument(a))||this._iframeContentDocument(a).__parent__||
a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(b){b=a.byId(b,this.ownerDocument);var f;if("iframe"==b.tagName.toLowerCase()){var c=b;f=this._iframeContentWindow(c);f=x.body(f.document)}else f=b==x.body(this.ownerDocument)?this.ownerDocument.documentElement:b;var l={node:b,iframe:c};d.set(b,"_dijitMenu"+this.id,
this._bindings.push(l));var p=m.hitch(this,function(a){var b=this.selector,d=b?function(a){return k.selector(b,a)}:function(a){return a},f=this;return[k(a,d(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<f._lastKeyDown+500||f._scheduleOpen(this,c,{x:a.pageX,y:a.pageY},a.target)}),k(a,d("keydown"),function(a){if(93==a.keyCode||a.shiftKey&&a.keyCode==t.F10||f.leftClickToOpen&&a.keyCode==t.SPACE)a.stopPropagation(),a.preventDefault(),
f._scheduleOpen(this,c,null,a.target),f._lastKeyDown=(new Date).getTime()})]});l.connects=f?p(f):[];c&&(l.onloadHandler=m.hitch(this,function(){var a=this._iframeContentWindow(c),a=x.body(a.document);l.connects=p(a)}),c.addEventListener?c.addEventListener("load",l.onloadHandler,!1):c.attachEvent("onload",l.onloadHandler))},unBindDomNode:function(b){var f;try{f=a.byId(b,this.ownerDocument)}catch(I){return}b="_dijitMenu"+this.id;if(f&&d.has(f,b)){for(var c=d.get(f,b)-1,k=this._bindings[c],m;m=k.connects.pop();)m.remove();
(m=k.iframe)&&(m.removeEventListener?m.removeEventListener("load",k.onloadHandler,!1):m.detachEvent("onload",k.onloadHandler));d.remove(f,b);delete this._bindings[c]}},_scheduleOpen:function(a,b,c,d){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:d,delegatedTarget:a,iframe:b,coords:c})},1))},_openMyself:function(d){function f(){x.refocus&&w&&w.focus();v.close(x)}var c=d.target,k=d.iframe,m=d.coords,l=!m;this.currentTarget=d.delegatedTarget;
if(m){if(k){d=b.position(k,!0);var c=this._iframeContentWindow(k),c=b.docScroll(c.document),r=q.getComputedStyle(k),u=q.toPixelValue,t=(p("ie")&&p("quirks")?0:u(k,r.paddingLeft))+(p("ie")&&p("quirks")?u(k,r.borderLeftWidth):0),k=(p("ie")&&p("quirks")?0:u(k,r.paddingTop))+(p("ie")&&p("quirks")?u(k,r.borderTopWidth):0);m.x+=d.x+t-c.x;m.y+=d.y+k-c.y}}else m=b.position(c,!0),m.x+=10,m.y+=10;var x=this,k=this._focusManager.get("prevNode");d=this._focusManager.get("curNode");var w=!d||a.isDescendant(d,
this.domNode)?k:d;v.open({popup:this,x:m.x,y:m.y,onExecute:f,onCancel:f,orient:this.isLeftToRight()?"L":"R"});this.focus();l||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);v.close(this)}},destroy:function(){l.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dijit/popup":function(){define("dojo/_base/array dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on ./place ./BackgroundIframe ./Viewport ./main dojo/touch".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u){function C(){this._popupWrapper&&(b.destroy(this._popupWrapper),delete this._popupWrapper)}f=f(null,{_stack:[],_beginZIndex:1E3,_idGen:1,_repositionAll:function(){if(this._firstAroundNode){var a=this._firstAroundPosition,b=q.position(this._firstAroundNode,!0),d=b.x-a.x,a=b.y-a.y;if(d||a)for(this._firstAroundPosition=b,b=0;b<this._stack.length;b++){var f=this._stack[b].wrapper.style;f.top=parseFloat(f.top)+a+"px";"auto"==f.right?f.left=parseFloat(f.left)+d+
"px":f.right=parseFloat(f.right)-d+"px"}this._aroundMoveListener=setTimeout(p.hitch(this,"_repositionAll"),d||a?10:50)}},_createWrapper:function(a){var c=a._popupWrapper,d=a.domNode;c||(c=b.create("div",{"class":"dijitPopup",style:{display:"none"},role:"region","aria-label":a["aria-label"]||a.label||a.name||a.id},a.ownerDocumentBody),c.appendChild(d),d=d.style,d.display="",d.visibility="",d.position="",d.top="0px",a._popupWrapper=c,l.after(a,"destroy",C,!0),"ontouchend"in document&&x(c,"touchend",
function(a){/^(input|button|textarea)$/i.test(a.target.tagName)||a.preventDefault()}),c.dojoClick=!0);return c},moveOffScreen:function(a){var b=this._createWrapper(a);a=q.isBodyLtr(a.ownerDocument);var d={visibility:"hidden",top:"-9999px",display:""};d[a?"left":"right"]="-9999px";d[a?"right":"left"]="auto";t.set(b,d);return b},hide:function(a){var b=this._createWrapper(a);t.set(b,{display:"none",height:"auto",overflowY:"visible",border:""});a=a.domNode;"_originalStyle"in a&&(a.style.cssText=a._originalStyle)},
getTopPopup:function(){for(var a=this._stack,b=a.length-1;0<b&&a[b].parent===a[b-1].widget;b--);return a[b]},open:function(b){for(var c=this._stack,f=b.popup,l=f.domNode,u=b.orient||["below","below-alt","above","above-alt"],w=b.parent?b.parent.isLeftToRight():q.isBodyLtr(f.ownerDocument),C=b.around,E=b.around&&b.around.id?b.around.id+"_dropdown":"popup_"+this._idGen++;c.length&&(!b.parent||!a.isDescendant(b.parent.domNode,c[c.length-1].widget.domNode));)this.close(c[c.length-1].widget);var J=this.moveOffScreen(f);
f.startup&&!f._started&&f.startup();var P,O=q.position(l);if("maxHeight"in b&&-1!=b.maxHeight)P=b.maxHeight||Infinity;else{P=r.getEffectiveBox(this.ownerDocument);var L=C?q.position(C,!1):{y:b.y-(b.padding||0),h:2*(b.padding||0)};P=Math.floor(Math.max(L.y,P.h-(L.y+L.h)))}O.h>P&&(O=t.getComputedStyle(l),t.set(J,{overflowY:"scroll",height:P+"px",border:O.borderLeftWidth+" "+O.borderLeftStyle+" "+O.borderLeftColor}),l._originalStyle=l.style.cssText,l.style.border="none");d.set(J,{id:E,style:{zIndex:this._beginZIndex+
c.length},"class":"dijitPopup "+(f.baseClass||f["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:b.parent?b.parent.id:""});0==c.length&&C&&(this._firstAroundNode=C,this._firstAroundPosition=q.position(C,!0),this._aroundMoveListener=setTimeout(p.hitch(this,"_repositionAll"),50));m("config-bgIframe")&&!f.bgIframe&&(f.bgIframe=new v(J));E=f.orient?p.hitch(f,"orient"):null;u=C?z.around(J,C,u,w,E):z.at(J,b,"R"==u?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],b.padding,E);J.style.visibility="visible";
l.style.visibility="visible";l=[];l.push(x(J,"keydown",p.hitch(this,function(a){if(a.keyCode==k.ESCAPE&&b.onCancel)a.stopPropagation(),a.preventDefault(),b.onCancel();else if(a.keyCode==k.TAB&&(a.stopPropagation(),a.preventDefault(),(a=this.getTopPopup())&&a.onCancel))a.onCancel()})));f.onCancel&&b.onCancel&&l.push(f.on("cancel",b.onCancel));l.push(f.on(f.onExecute?"execute":"change",p.hitch(this,function(){var a=this.getTopPopup();if(a&&a.onExecute)a.onExecute()})));c.push({widget:f,wrapper:J,parent:b.parent,
onExecute:b.onExecute,onCancel:b.onCancel,onClose:b.onClose,handlers:l});if(f.onOpen)f.onOpen(u);return u},close:function(a){for(var b=this._stack;a&&w.some(b,function(b){return b.widget==a})||!a&&b.length;){var d=b.pop(),f=d.widget,k=d.onClose;f.bgIframe&&(f.bgIframe.destroy(),delete f.bgIframe);if(f.onClose)f.onClose();for(var m;m=d.handlers.pop();)m.remove();f&&f.domNode&&this.hide(f);k&&k()}0==b.length&&this._aroundMoveListener&&(clearTimeout(this._aroundMoveListener),this._firstAroundNode=this._firstAroundPosition=
this._aroundMoveListener=null)}});return u.popup=new f})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(w,l,f,a){return w("dijit.DropDownMenu",a,{templateString:f,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(a){this._moveToPopup(a);a.stopPropagation();a.preventDefault()},_onLeftArrow:function(a){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();
else this.onCancel(!1);else a.stopPropagation(),a.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r){return l("dijit._MenuBase",[x,r,v,z],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),
this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){d.toggle(this.domNode,"dijitMenuActive",a);d.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,childSelector:function(a){var b=p.byNode(a);return a.parentNode==this.containerNode&&b&&b.focus},postCreate:function(){var a=this,d="string"==typeof this.childSelector?this.childSelector:
b.hitch(this,"childSelector");this.own(t(this.containerNode,t.selector(d,q.enter),function(){a.onItemHover(p.byNode(this))}),t(this.containerNode,t.selector(d,q.leave),function(){a.onItemUnhover(p.byNode(this))}),t(this.containerNode,t.selector(d,k),function(b){a.onItemClick(p.byNode(this),b);b.stopPropagation()}),t(this.containerNode,t.selector(d,"focusin"),function(){a._onItemFocus(p.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(a,b,d,c){this.inherited(arguments);if(a&&(-1==
c||a.popup&&1==c))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},
onItemHover:function(a){this.activated?(this.set("selected",a),!a.popup||a.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,{type:"click"})},this.passivePopupDelay));this._hoveredChild=a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==
a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&
(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;a.popup?(this.set("selected",a),this.set("activated",!0),b=/^key/.test(b._origType||b.type)||0==b.clientX&&0==b.clientY,this._openItemPopup(a,b)):(this.onExecute(),a._onClick?a._onClick(b):a.onClick(b))},_openItemPopup:function(a,d){if(a!=
this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var f=a.popup;f.parentMenu=this;this.own(this._mouseoverHandle=t.once(f.domNode,"mouseover",b.hitch(this,"_onPopupHover")));var c=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){d&&c.focusChild(a);c._cleanUp()},onExecute:b.hitch(this,"_cleanUp",!0),onClose:function(){c._mouseoverHandle&&(c._mouseoverHandle.remove(),delete c._mouseoverHandle)}},
d);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(a.set(this.selected.focusNode,"tabIndex",this.tabIndex),this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=
a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),function(w,l,f,a,d,b,q,t,m,k){return l("dijit._KeyNavContainer",
[m,k,t],{connectKeyNavHandlers:function(a,f){var k=this._keyNavCodes={},m=b.hitch(this,"focusPrev"),l=b.hitch(this,"focusNext");w.forEach(a,function(a){k[a]=m});w.forEach(f,function(a){k[a]=l});k[d.HOME]=b.hitch(this,"focusFirstChild");k[d.END]=b.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){a.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);w.forEach(this.getChildren(),b.hitch(this,"_startupChild"))},addChild:function(a,
b){this.inherited(arguments);this._startupChild(a)},_startupChild:function(a){a.set("tabIndex","-1")},_getFirst:function(){var a=this.getChildren();return a.length?a[0]:null},_getLast:function(){var a=this.getChildren();return a.length?a[a.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(a){return(a=q.byNode(a))&&a.getParent()==this}})})},
"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(w,l,f,a,d,b,q,t){return l("dijit._KeyNavMixin",t,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);f.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var m=this._keyNavCodes={};m[a.HOME]=d.hitch(this,"focusFirstChild");m[a.END]=d.hitch(this,"focusLastChild");m[this.isLeftToRight()?
a.LEFT_ARROW:a.RIGHT_ARROW]=d.hitch(this,"_onLeftArrow");m[this.isLeftToRight()?a.RIGHT_ARROW:a.LEFT_ARROW]=d.hitch(this,"_onRightArrow");m[a.UP_ARROW]=d.hitch(this,"_onUpArrow");m[a.DOWN_ARROW]=d.hitch(this,"_onDownArrow")}var k=this,m="string"==typeof this.childSelector?this.childSelector:d.hitch(this,"childSelector");this.own(b(this.domNode,"keypress",d.hitch(this,"_onContainerKeypress")),b(this.domNode,"keydown",d.hitch(this,"_onContainerKeydown")),b(this.domNode,"focus",d.hitch(this,"_onContainerFocus")),
b(this.containerNode,b.selector(m,"focusin"),function(a){k._onChildFocus(q.getEnclosingWidget(this),a)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},
focusChild:function(a,b){a&&(this.focusedChild&&a!==this.focusedChild&&this._onChildBlur(this.focusedChild),a.set("tabIndex",this.tabIndex),a.focus(b?"end":"start"))},_onContainerFocus:function(a){a.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){f.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(a){f.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex","-1"),this.lastFocusedChild=this.focusedChild,
this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(a){a&&a!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),a.set("tabIndex",this.tabIndex),this.lastFocused=a,this._set("focusedChild",a))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(a,b,d,f){a&&this.focusChild(a)},_keyboardSearchCompare:function(a,b){var d=a.domNode;a=(a.label||(d.focusNode?d.focusNode.label:"")||d.innerText||d.textContent||
"").replace(/^\s+/,"").substr(0,b.length).toLowerCase();return b.length&&a==b?-1:0},_isFormElement:function(a){return"INPUT"===a.tagName||"TEXTAREA"===a.tagName||"SELECT"===a.tagName||"BUTTON"===a.tagName},_onContainerKeydown:function(b){if(!this._isFormElement(document.activeElement)){var d=this._keyNavCodes[b.keyCode];d?(d(b,this.focusedChild),b.stopPropagation(),b.preventDefault(),this._searchString=""):b.keyCode!=a.SPACE||!this._searchTimer||b.ctrlKey||b.altKey||b.metaKey||(b.stopImmediatePropagation(),
b.preventDefault(),this._keyboardSearch(b," "))}},_onContainerKeypress:function(b){this._isFormElement(document.activeElement)||b.charCode<=a.SPACE||b.ctrlKey||b.altKey||b.metaKey||(b.preventDefault(),b.stopPropagation(),this._keyboardSearch(b,String.fromCharCode(b.charCode).toLowerCase()))},_keyboardSearch:function(a,b){var f=null,k,m=0;d.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=b;var a=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;
k=this._searchString.substr(0,a);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var d=this.focusedChild||null;if(1==a||!d)if(d=this._getNextFocusableChild(d,1),!d)return;a=d;do{var l=this._keyboardSearchCompare(d,k);l&&0==m++&&(f=d);if(-1==l){m=-1;break}d=this._getNextFocusableChild(d,1)}while(d&&d!=a)})();this.onKeyboardSearch(f,a,k,m)},_onChildBlur:function(){},_getNextFocusableChild:function(a,b){var d=a;do{if(a)a=this._getNext(a,
b);else if(a=this[0<b?"_getFirst":"_getLast"](),!a)break;if(null!=a&&a!=d&&a.isFocusable())return a}while(a!=d);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(a,b){if(a)for(a=a.domNode;a;)if((a=a[0>b?"previousSibling":"nextSibling"])&&"getAttribute"in a){var d=q.byNode(a);if(d)return d}return null}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],function(w,l,f){return w([l,
f],{})})},"dgrid/Grid":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/on dojo/has ./List ./util/misc dojo/_base/sniff".split(" "),function(w,l,f,a,d,b,q,t){function m(a,b){b&&b.nodeType&&a.appendChild(b)}w=w(q,{columns:null,hasNeutralSort:!1,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(a){return"object"!==typeof a?this.columns[a]:this.cell(a).column},listType:"grid",cell:function(a,b){if(a.column&&a.element)return a;a.target&&a.target.nodeType&&
(a=a.target);var d;if(a.nodeType){do{if(this._rowIdToObject[a.id])break;var f=a.columnId;if(f){b=f;d=a;break}a=a.parentNode}while(a&&a!==this.domNode)}if(!d&&"undefined"!==typeof b){var k=this.row(a);if(f=k&&k.element)for(var f=f.getElementsByTagName("td"),m=0;m<f.length;m++)if(f[m].columnId===b){d=f[m];break}}if(null!=a)return{row:k||this.row(a),column:b&&this.column(b),element:d}},createRowCells:function(a,d,m,l,q){var k=f.create("table",{className:"dgrid-row-table",role:"presentation"}),p=9>b("ie")?
f.create("tbody",null,k):k,v,x,c,w,z,I,G,H,K,J;m=m||this.subRows;x=0;for(c=m.length;x<c;x++)for(I=m[x],v=f.create("tr",null,p),I.className&&(v.className=I.className),w=0,z=I.length;w<z;w++){G=I[w];H=G.id;K=G.field?" field-"+t.escapeCssIdentifier(G.field,"-"):"";(J="function"===typeof G.className?G.className(l):G.className)&&(K+=" "+J);K=f.create(a,{className:"dgrid-cell"+(H?" dgrid-column-"+t.escapeCssIdentifier(H,"-"):"")+K,role:"th"===a?"columnheader":"gridcell"});K.columnId=H;if(H=G.colSpan)K.colSpan=
H;if(H=G.rowSpan)K.rowSpan=H;d(K,G,l,q);v.appendChild(K)}return k},_createBodyRowCell:function(a,b,d,f){var k=d;b.get?k=b.get(d):"field"in b&&"_item"!==b.field&&(k=d[b.field]);b.renderCell?m(a,b.renderCell(d,k,a,f)):this._defaultRenderCell.call(b,d,k,a,f)},_createHeaderRowCell:function(a,b){var d=b.headerNode=a,f=b.field;f&&(a.field=f);b.renderHeaderCell?m(d,b.renderHeaderCell(d)):("label"in b||b.field)&&d.appendChild(document.createTextNode("label"in b?b.label:b.field));!1!==b.sortable&&f&&"_item"!==
f&&(a.sortable=!0,a.className+=" dgrid-sortable")},left:function(a,b){a.element||(a=this.cell(a));return this.cell(this._move(a,-(b||1),"dgrid-cell"))},right:function(a,b){a.element||(a=this.cell(a));return this.cell(this._move(a,b||1,"dgrid-cell"))},_defaultRenderCell:function(a,b,d){if(this.formatter){var f=this.formatter,k=this.grid.formatterScope;d.innerHTML="string"===typeof f&&k?k[f](b,a):this.formatter(b,a)}else null!=b&&d.appendChild(document.createTextNode(b))},renderRow:function(a,b){a=
this.createRowCells("td",l.hitch(this,"_createBodyRowCell"),b&&b.subRows,a,b);b=f.create("div",{role:"row"});b.appendChild(a);return b},renderHeader:function(){var a=this,m=this.headerNode;m.setAttribute("role","row");f.empty(m);var q=this.createRowCells("th",l.hitch(this,"_createHeaderRowCell"),this.subRows&&this.subRows.headerRows);this._rowIdToObject[q.id=this.id+"-header"]=this.columns;m.appendChild(q);this._sortListener&&this._sortListener.remove();this._sortListener=d(q,"click,keydown",function(f){if("click"===
f.type||32===f.keyCode||!b("opera")&&13===f.keyCode){var k=f.target,l,p;do if(k.sortable){l=k.field||k.columnId;p=a.sort[0];l=a.hasNeutralSort&&p&&p.property===l&&p.descending?[]:[{property:l,descending:p&&p.property===l&&!p.descending}];p={bubbles:!0,cancelable:!0,grid:a,parentType:f.type,sort:l};d.emit(f.target,"dgrid-sort",p)&&(a._sortNode=k,a.set("sort",l));break}while((k=k.parentNode)&&k!==m)}})},resize:function(){var a=this.headerNode.firstChild,b=this.contentNode,d;this.inherited(arguments);
b.style.width="";b&&a&&(d=a.offsetWidth)>b.offsetWidth&&(b.style.width=d+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(){this.inherited(arguments);this.updateSortArrow(this.sort)},_findSortArrowParent:function(a){var b=this.columns,d;for(d in b){var f=b[d];if(f.field===a)return f.headerNode}},updateSortArrow:function(b,d){this._lastSortedArrow&&(a.remove(this._lastSortedArrow.parentNode,"dgrid-sort-up dgrid-sort-down"),
f.destroy(this._lastSortedArrow),delete this._lastSortedArrow);d&&(this.sort=b);b[0]&&(d=b[0].property,b=b[0].descending,d=this._sortNode||this._findSortArrowParent(d),delete this._sortNode,d&&(d=d.contents||d,this._lastSortedArrow=f.create("div",{className:"dgrid-sort-arrow ui-icon",innerHTML:"\x26nbsp;",role:"presentation"},d,"first"),a.add(d,"dgrid-sort-"+(b?"down":"up")),this.resize()))},styleColumn:function(a,b){return this.addCssRule("#"+t.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+
t.escapeCssIdentifier(a,"-"),b)},_configColumns:function(a,b){var d=[],f=b instanceof Array;t.each(b,function(k,m){"string"===typeof k&&(b[m]=k={label:k});f||k.field||(k.field=m);m=k.id=k.id||(isNaN(m)?m:a+m);this._configColumn&&(this._configColumn(k,b,a),m=k.id);f&&(this.columns[m]=k);k.grid=this;d.push(k)},this);return f?b:d},_destroyColumns:function(){this.cleanup()},configStructure:function(){var a=this.subRows,b=this._columns=this.columns;this.columns=!b||b instanceof Array?{}:b;if(a)for(b=0;b<
a.length;b++)a[b]=this._configColumns(b+"-",a[b]);else this.subRows=[this._configColumns("",b)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(a){this._destroyColumns();this.subRows=null;this.columns=a;this._updateColumns()},_setSubRows:function(a){this._destroyColumns();this.subRows=a;this._updateColumns()},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&
(this.sort.length?(this._lastSortedArrow=null,this.updateSortArrow(this.sort)):this.resize())}});w.appendIfNode=m;return w})},"dgrid/List":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/on dojo/has ./util/misc dojo/_base/sniff".split(" "),function(w,l,f,a,d,b,q){function t(a,b){a.className="dgrid-scrollbar-measure";document.body.appendChild(a);b=a["offset"+b]-a["client"+b];a.className="";a.parentNode&&document.body.removeChild(a);return b}function m(b){a.replace(this.domNode,
b,this._class||"");this._class=b}function k(){return this._class}var p=[];b("mozilla")&&p.push("has-mozilla");b("touch")&&p.push("has-touch");a.add(document.documentElement,p);b.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});var x,z;b.add("dom-scrollbar-width",function(a,b,c){return t(c,"Width")});b.add("dom-scrollbar-height",function(a,b,c){return t(c,"Height")});b.add("dom-rtl-scrollbar-left",function(a,d,c){a=document.createElement("div");c.className=
"dgrid-scrollbar-measure";c.setAttribute("dir","rtl");c.appendChild(a);document.body.appendChild(c);d=!!b("ie")||!!b("trident")||/\bEdge\//.test(navigator.userAgent)||a.offsetLeft>=b("dom-scrollbar-width");c.className="";c.parentNode&&document.body.removeChild(c);f.destroy(a);c.removeAttribute("dir");return d});var v=0,r=function(){this._started&&this.resize()},u=w(null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,addUiClasses:!0,highlightDuration:250,resizeThrottleDelay:q.defaultDelay,
resizeThrottleMethod:"throttleDelayed",postscript:function(a,b){var c=this;(this._Row=function(a,b,c){this.id=a;this.data=b;this.element=c}).prototype.remove=function(){c.removeRow(this.element)};b&&(this.srcNodeRef=b=b.nodeType?b:document.getElementById(b));this.create(a,b)},listType:"list",create:function(a,b){b=this.domNode=b||document.createElement("div");var c;a&&(this.params=a,w.safeMixin(this,a),c=a["class"]||a.className||b.className);this.sort=this.sort||[];this._listeners=[];this._rowIdToObject=
{};this.postMixInProperties&&this.postMixInProperties();this.id=b.id=b.id||this.id||u.autoIdPrefix+v++;this.buildRendering();c&&m.call(this,c);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var k=this.domNode,m=this.addUiClasses,c=this,p,u,v;v=this.isRTL="rtl"===(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();k.className="";k.setAttribute("role","grid");a.add(k,"dgrid dgrid-"+this.listType+
(m?" ui-widget":""));p=this.headerNode=f.create("div",{className:"dgrid-header dgrid-header-row"+(m?" ui-widget-header":"")+(this.showHeader?"":" dgrid-header-hidden")},k);u=this.bodyNode=f.create("div",{className:"dgrid-scroller"},k);b("ff")&&(u.tabIndex=-1);this.headerScrollNode=f.create("div",{className:"dgrid-header dgrid-header-scroll dgrid-scrollbar-width"+(m?" ui-widget-header":"")},k);this.footerNode=f.create("div",{className:"dgrid-footer"+(this.showFooter?"":" dgrid-footer-hidden")},k);
v&&(k.className+=" dgrid-rtl"+(b("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));d(u,"scroll",function(a){c.showHeader&&(p.scrollLeft=a.scrollLeft||u.scrollLeft);a.stopPropagation();d.emit(k,"scroll",{scrollTarget:u})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=f.create("div",{className:"dgrid-content"+(m?" ui-widget-content":"")},this.bodyNode);"string"===typeof this.resizeThrottleMethod&&q[this.resizeThrottleMethod]?m=q[this.resizeThrottleMethod](r,this,this.resizeThrottleDelay):
"function"===typeof this.resizeThrottleMethod?m=this.resizeThrottleMethod(l.hitch(this,r),this.resizeThrottleDelay):(console.warn("Invalid value specified for resizeThrottleMethod:  "+this.resizeThrottleMethod),m=q.throttleDelayed(r,this,this.resizeThrottleDelay));this._resizeHandle=d(window,"resize",m);this._listeners.push(this._resizeHandle)},postCreate:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this.sort))},configStructure:function(){},
resize:function(){var a=this.bodyNode,d=this.footerNode,d=this.showFooter?d.offsetHeight:0;this.headerScrollNode.style.height=a.style.marginTop=this.headerNode.offsetHeight+"px";a.style.marginBottom=d+"px";x||(x=b("dom-scrollbar-width"),z=b("dom-scrollbar-height"),b("ie")&&(x++,z++),q.addCssRule(".dgrid-scrollbar-width","width: "+x+"px"),q.addCssRule(".dgrid-scrollbar-height","height: "+z+"px"),17!==x&&(q.addCssRule(".dgrid-header-row","right: "+x+"px"),q.addCssRule(".dgrid-rtl-swap .dgrid-header-row",
"left: "+x+"px")))},addCssRule:function(a,b){a=q.addCssRule(a,b);this.cleanAddedRules&&this._listeners.push(a);return a},on:function(a,f){a=d(this.domNode,a,f);b("dom-addeventlistener")||this._listeners.push(a);return a},cleanup:function(){for(var a in this._rowIdToObject)if(this._rowIdToObject[a]!==this.columns){var b=document.getElementById(a);b&&this.removeRow(b,!0)}},destroy:function(){if(this._listeners){for(var a=this._listeners.length;a--;)this._listeners[a].remove();this._listeners=null}this._started=
!1;this.cleanup();f.destroy(this.domNode)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoRowId=0;this.contentNode.innerHTML="";this.scrollTo({x:0,y:0})},highlightRow:function(b,d){var c="dgrid-highlight"+(this.addUiClasses?" ui-state-highlight":"");b=b.element||b;a.add(b,c);setTimeout(function(){a.remove(b,c)},d||this.highlightDuration)},adjustRowIndices:function(b){var d=b.rowIndex;if(-1<d){do-1<b.rowIndex&&(this.maintainOddEven&&a.contains(b,"dgrid-row")&&a.replace(b,1===d%
2?"dgrid-row-odd":"dgrid-row-even",0===d%2?"dgrid-row-odd":"dgrid-row-even"),b.rowIndex=d++);while((b=b.nextSibling)&&b.rowIndex!==d)}},renderArray:function(a,b,c){c=c||{};var d=c.start||0,f=document.createDocumentFragment(),k=[],m=0,l=a.length;b||(this._lastCollection=a);for(;m<l;)k[m]=this.insertRow(a[m],f,null,d++,c),m++;(a=b?b.parentNode:this.contentNode)&&a.parentNode&&(a!==this.contentNode||l)&&(a.insertBefore(f,b||null),l&&this.adjustRowIndices(k[l-1]));return k},renderHeader:function(){},
_autoRowId:0,insertRow:function(a,b,c,d,f){var k=this.id+"-row-"+(this.collection&&this.collection.getIdentity?this.collection.getIdentity(a):this._autoRowId++),m=document.getElementById(k),l=m&&m.previousSibling;m&&(m===c&&(c=(c.connected||c).nextSibling),this.removeRow(m,!1,f));m=this.renderRow(a,f);m.className=(m.className||"")+" dgrid-row "+(1===d%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?" ui-state-default":"");this._rowIdToObject[m.id=k]=a;b.insertBefore(m,c||null);m.rowIndex=d;
l&&l.rowIndex!==m.rowIndex-1&&this.adjustRowIndices(l);return m},renderRow:function(a){var b=document.createElement("div");b.appendChild(document.createTextNode(a));return b},removeRow:function(a,b){a=a.element||a;delete this._rowIdToObject[a.id];b||f.destroy(a)},row:function(a){var b;if(a instanceof this._Row)return a;a.target&&a.target.nodeType&&(a=a.target);if(a.nodeType){do{var c=a.id;if(b=this._rowIdToObject[c])return new this._Row(c.substring(this.id.length+5),b,a);a=a.parentNode}while(a&&a!==
this.domNode)}else return"object"===typeof a?b=this.collection.getIdentity(a):(b=a,a=this._rowIdToObject[this.id+"-row-"+b]),new this._Row(b,a,document.getElementById(this.id+"-row-"+b))},cell:function(a){return{row:this.row(a)}},_move:function(a,b,c,d){var f,k;k=f=a.element;b=b||1;do if(a=f[0>b?"previousSibling":"nextSibling"]){do if((f=a)&&-1<(f.className+" ").indexOf(c+" ")){k=f;b+=0>b?1:-1;break}while(a=(!d||!f.hidden)&&f[0>b?"lastChild":"firstChild"])}else if(f=f.parentNode,!f||f===this.bodyNode||
f===this.headerNode)break;while(b);return k},up:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,-(b||1),"dgrid-row",c))},down:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,b||1,"dgrid-row",c))},scrollTo:function(a){"undefined"!==typeof a.x&&(this.bodyNode.scrollLeft=a.x);"undefined"!==typeof a.y&&(this.bodyNode.scrollTop=a.y)},getScrollPosition:function(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}},get:function(a){var b="_get"+a.charAt(0).toUpperCase()+
a.slice(1);return"function"===typeof this[b]?this[b].apply(this,[].slice.call(arguments,1)):this[a]},set:function(a,b){if("object"===typeof a)for(var c in a)this.set(c,a[c]);else c="_set"+a.charAt(0).toUpperCase()+a.slice(1),"function"===typeof this[c]?this[c].apply(this,[].slice.call(arguments,1)):this[a]=b;return this},_getClass:k,_setClass:m,_getClassName:k,_setClassName:m,_setSort:function(a,b){this.sort="string"!==typeof a?a:[{property:a,descending:b}];this._applySort()},_applySort:function(){this.refresh();
if(this._lastCollection){var a=this.sort;if(a&&0<a.length){var b=a[0].property,c=!!a[0].descending;this._lastCollection.sort(function(a,d){a=a[b];d=d[b];void 0===a&&(a="");void 0===d&&(d="");return a===d?0:a>d!==c?1:-1})}this.renderArray(this._lastCollection)}},_setShowHeader:function(b){var d=this.headerNode;this.showHeader=b;a.toggle(d,"dgrid-header-hidden",!b);this.renderHeader();this.resize();b&&(d.scrollLeft=this.getScrollPosition().x)},_setShowFooter:function(b){this.showFooter=b;a.toggle(this.footerNode,
"dgrid-footer-hidden",!b);this.resize()}});u.autoIdPrefix="dgrid_";return u})},"dgrid/util/misc":function(){define(["dojo/has"],function(w){var l=[],f,a,d,b=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,q=setTimeout,t=clearTimeout;w.add("requestidlecallback",function(a){return"function"===typeof a.requestIdleCallback});var m={defaultDelay:15,throttle:function(a,b,d){var f=!1;d=d||m.defaultDelay;return function(){f||(f=!0,a.apply(b,arguments),q(function(){f=!1},d))}},throttleDelayed:function(a,b,d){var f=!1;d=
d||m.defaultDelay;return function(){if(!f){f=!0;var k=arguments;q(function(){f=!1;a.apply(b,k)},d)}}},debounce:function(a,b,d){var f;d=d||m.defaultDelay;return function(){f&&(t(f),f=null);var k=arguments;f=q(function(){f=null;a.apply(b,k)},d)}},each:function(a,b,d){var f,k;if(a)if("number"===typeof a.length)for(f=0,k=a.length;f<k;f++)b.call(d,a[f],f,a);else for(f in a)b.call(d,a[f],f,a)},addCssRule:function(b,m){f||(f=document.createElement("style"),document.getElementsByTagName("head")[0].appendChild(f),
f=f.sheet||f.styleSheet,a=f.deleteRule?"deleteRule":"removeRule",d=f.cssRules?"cssRules":"rules");var k=l.length;l[k]=(f.cssRules||f.rules).length;f.addRule?f.addRule(b,m):f.insertRule(b+"{"+m+"}",l[k]);return{get:function(a){return f[d][l[k]].style[a]},set:function(a,b){"undefined"!==typeof l[k]&&(f[d][l[k]].style[a]=b)},remove:function(){var b=l[k],d,m;if(void 0!==b)for(f[a](b),l[k]=void 0,d=k+1,m=l.length;d<m;d++)l[d]>b&&l[d]--}}},escapeCssIdentifier:function(a,d){return"string"===typeof a?a.replace(b,
d||"\\$1"):a}};return m})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/on dojo/when dojo/query ./util/misc".split(" "),function(w,l,f,a,d,b,q,t,m){function k(a){return a&&(0<=a.className.indexOf("dgrid-row")||0<=a.className.indexOf("dgrid-loading"))}function p(a){return a&&0<=a.className.indexOf("dgrid-preload")}var x=0;return f([w,l],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,farOffRemoval:2E3,
queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:m.defaultDelay,keepScrollPosition:!1,rowHeight:0,_deleteQueue:[],postCreate:function(){this.inherited(arguments);var a=this;b(this.bodyNode,"scroll",m[this.pagingMethod](function(b){a._processScroll(b)},null,this.pagingDelay))},renderQuery:function(b,f){var k=this,m=f&&f.container||this.contentNode,l,p,c,v,t=0,w=f&&f.start||0;"level"in b&&(t=v=b.level);l={query:b,count:0,level:t,top:!1};var z={node:d.create("div",{className:"dgrid-preload",style:{height:"0"}},
m),count:0,query:b,next:l,level:t,top:!0};p=z.node;p.rowIndex=0;l.previous=z;c=l.node=d.create("div",{className:"dgrid-preload",style:{height:"0"}},m);z.id=x++;p.setAttribute("data-preloadid",z.id);l.id=x++;c.setAttribute("data-preloadid",l.id);c.rowIndex=this.minRowsPerPage;k._insertPreload(z);var H=d.create("div",{className:"dgrid-loading"},c,"before");d.create("div",{className:"dgrid-below"},H).innerHTML=this.loadingMessage;f=a.mixin({start:0,count:this.minRowsPerPage},f);null!=v&&(f.queryLevel=
v);return this._trackError(function(){var a=b(f);return k.renderQueryResults(a,c,f).then(function(b){return a.totalLength.then(function(a){var m=b.length,r=c.parentNode;!k._rows||"queryLevel"in f||(k._rows.min=0,k._rows.max=m===a?Infinity:m-1);d.destroy(H);"queryLevel"in f||(k._total=a);0===a&&r&&(k.noDataNode&&d.destroy(k.noDataNode),k._insertNoDataNode(r));z.count=w;l.count=a-m-w;c.rowIndex=w+m;a?k._updatePreloadRowHeights(z):(c.style.display="none",p.style.display="none");k._previousScrollPosition&&
r.offsetHeight&&(k.scrollTo(k._previousScrollPosition),delete k._previousScrollPosition);return q(k._processScroll()).then(function(){return b})})}).otherwise(function(a){d.destroy(H);throw a;})})},_insertPreload:function(a){var b=this.preload;if(b){for(;b.node.compareDocumentPosition(a.node)&Node.DOCUMENT_POSITION_PRECEDING;)if(b=b.previous,null==b)return;for(;b.node.compareDocumentPosition(a.node)&Node.DOCUMENT_POSITION_FOLLOWING&&b.next;)b=b.next;b.previous.next=a;a.previous=b.previous;a=a.next;
a.next=b;b.previous=a}else this.preload=a},refresh:function(a){var b=this,d=a&&a.keepScrollPosition;"undefined"===typeof d&&(d=this.keepScrollPosition);d&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this._renderedCollection)return this.renderQuery(function(a){return b._renderedCollection.fetchRange({start:a.start,end:a.start+a.count})}).then(function(){b._emitRefreshComplete()})},resize:function(){this.inherited(arguments);this._processScroll()},cleanup:function(){this.inherited(arguments);
this.preload=null},renderQueryResults:function(a){var b=this.inherited(arguments),d=this._getRenderedCollection(this.preload);d&&d.releaseRange&&b.then(function(b){b[0]&&!b[0].parentNode.tagName&&a.totalLength.then(function(){d.releaseRange(b[0].rowIndex,b[b.length-1].rowIndex+1)})});return b},_getFirstRowSibling:function(a){return a.lastChild},_calcRowHeight:function(a){var b=a.nextSibling;return b&&!/\bdgrid-preload\b/.test(b.className)?b.offsetTop-a.offsetTop:a.offsetHeight},_calcAverageRowHeight:function(a){for(var b=
a.length,d=0,f=0;f<b;f++)d+=this._calcRowHeight(a[f]);return b&&d?d/b:0},_updatePreloadRowHeights:function(){var a=this.preload;if(a){for(;a.previous;)a=a.previous;for(;a;)a.rowHeight||(a.rowHeight=this.rowHeight||this._calcAverageRowHeight(a.node.parentNode.querySelectorAll(".dgrid-row")),this._adjustPreloadHeight(a)),a=a.next}},lastScrollTop:0,_processScroll:function(a){function b(a,b){b=b?"next":"previous";for(var c;c=a[b];)a=c;return a}function f(a,d){function f(){var b;a:{b=!d;for(var c=a;c=
c[d?"previous":"next"];)if(b===c.top){b=c;break a}b=void 0}if(b&&m!==b&&!p(b.top?b.node.nextSibling:b.node.previousSibling))return g(),a=b,q=a.node,l=d?a.node.offsetTop-w:x-(a.node.offsetTop+a.node.offsetHeight),z=(b=e(q))&&b.rowIndex,A=void 0,b}function e(a){var b=p(a);(a=a[u])&&!k(a)&&(a=b&&p(a)?null:(b=f())?b:e(a));return a}function g(){a.count+=v;d&&(q.rowIndex-=v);c._adjustPreloadHeight(a);v=0;c._releaseRange(a,d,z,A)}var m=a;a=b(a,d);var l=d?a.node.offsetTop-w:x-(a.node.offsetTop+a.node.offsetHeight),
r=c.farOffRemoval,q=a.node,u=d?"previousSibling":"nextSibling",v=0,t=0,z,A;if(l>2*r){var C;z=(C=e(q))&&C.rowIndex;for(A=void 0;C&&m!==a;){var B=c._calcRowHeight(C);t+B+r>l||!k(C)?C=f():(t+=B,v+=C.count||1,c._pruneRow(C,d),"rowIndex"in C&&(A=C.rowIndex),C=e(C))}g();c._deleteNodeQueue()}}function m(a,b){do a=b?a.next:a.previous;while(a&&!a.node.offsetWidth);return a}var l=this.preload,q;this._updatePreloadRowHeights();if(q=l&&l.rowHeight){var c=this,t=c.bodyNode,x=a&&a.scrollTop||this.getScrollPosition().y,
w=t.offsetHeight+x,z;a=c.lastScrollTop;var t=c.bufferRows*q,H=t-q,K,J=!0;for(c.lastScrollTop=x;l&&!l.node.offsetWidth;)l=l.previous;for(;l&&l!==z;){z=c.preload;c.preload=l;q=l.node;var P=q.offsetTop;if(w+1+H<P)l=m(l,J=!1);else if(x-1-H>P+q.offsetHeight)l=m(l,J=!0);else{var P=((q.top?x-t:w)-P)/l.rowHeight,O=(w-x+2*t)/l.rowHeight,O=O+Math.min(Math.abs(Math.max(Math.min((x-a)*l.rowHeight,c.maxRowsPerPage/2),c.maxRowsPerPage/-2)),10);q.top&&(P-=O);P=Math.max(P,0);10>P&&0<P&&O+P<c.maxRowsPerPage&&(O+=
Math.max(0,P),P=0);O=Math.min(Math.max(O,c.minRowsPerPage),c.maxRowsPerPage,l.count);if(0===O)l=m(l,J);else{var O=Math.ceil(O),P=Math.min(Math.floor(P),l.count-O),L={};l.count-=O;var M=q,R,Q=c.queryRowsOverlap,T=!l.top&&l;T?(l.previous&&(f(l),0<P&&p(q.previousSibling)?(P=Math.min(l.count,P),l.previous.count+=P,c._adjustPreloadHeight(l.previous,!0),q.rowIndex+=P,Q=0):O+=P,l.count-=P),L.start=q.rowIndex-Q,L.count=Math.min(O+Q,c.maxRowsPerPage),q.rowIndex=L.start+L.count):(l.next&&(M=q.nextSibling,f(l,
!0),p(q.nextSibling)?(l.next.count+=l.count-P,l.next.node.rowIndex=P+O,c._adjustPreloadHeight(l.next),l.count=P,Q=0,M=l.next.node):R=!0),L.start=l.count,L.count=Math.min(O+Q,c.maxRowsPerPage),L.scrollingUp=!0);R&&M&&M.offsetWidth&&(R=M.offsetTop);c._adjustPreloadHeight(l);"level"in l.query&&(L.queryLevel=l.query.level);if("queryLevel"in L||!(L.start>c._total||0>L.count)){var A=d.create("div",{className:"dgrid-loading",style:{height:O*l.rowHeight+"px"}},M,"before");d.create("div",{className:"dgrid-"+
(T?"below":"above"),innerHTML:c.loadingMessage},A);A.count=O;c._trackError(function(){(function(a,b,f){var e=l.query(L);K=c.renderQueryResults(e,a,L).then(function(g){var h=c._rows;!h||"queryLevel"in L||!g.length||(b?(h.max<=h.min&&(h.min=g[0].rowIndex),h.max=g[g.length-1].rowIndex):(h.max<=h.min&&(h.max=g[g.length-1].rowIndex),h.min=g[0].rowIndex));M=a.nextSibling;d.destroy(a);f&&M&&M.offsetWidth&&c.scrollTo({y:c.bodyNode.scrollTop+M.offsetTop-f});e.totalLength.then(function(a){"queryLevel"in L||
(c._total=a,c._rows&&c._rows.max>=c._total-1&&(c._rows.max=Infinity));b&&(b.count=a-b.node.rowIndex,c._adjustPreloadHeight(b))});c._processScroll();return g},function(b){d.destroy(a);throw b;})})(A,T,R)});l=l.previous}}}}return K}},_adjustPreloadHeight:function(a,b){a.node.style.height=this._calculatePreloadHeight(a,b)+"px"},_calculatePreloadHeight:function(a,b){return Math.min(a.count*a.rowHeight,b?Infinity:this.maxEmptySpace)},_pruneRow:function(a,b,d){this.removeRow(a,!0,d);this._queueNodeForDeletion(a)},
_queueNodeForDeletion:function(a){this._deleteQueue.push(a)},_deleteNodeQueue:function(){for(var a=document.createElement("div"),b=this._deleteQueue,f=b.length;f--;)a.appendChild(b[f]);this._deleteQueue=[];setTimeout(function(){d.destroy(a)},1)},_removePreloads:function(a){if(a&&a.length){var b=this,d=this._getHeadPreload();a.forEach(function(a){if(a=b._findPreload(a,d))a.previous&&(a.previous.next=a.next),a.next&&(a.next.previous=a.previous)})}},_getHeadPreload:function(){var a=this.preload;if(a)for(;a.previous;)a=
a.previous;return a},_findPreload:function(a,b){for(b||(b=this._getHeadPreload());b;){if(b.node===a)return b;b=b.next}},_getRenderedCollection:function(){return this._renderedCollection},_releaseRange:function(a,b,d,f){if(a){var k=a.level;a=this._getRenderedCollection(a);null!=f&&a.releaseRange&&"number"===typeof d&&"number"===typeof f&&(b?a.releaseRange(f,d+1):a.releaseRange(d,f+1),this._rows&&!k&&(this._rows[b?"max":"min"]=f,this._rows.max>=this._total-1&&(this._rows.max=Infinity)))}}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/aspect dojo/dom-construct dojo/has dojo/on dojo/when".split(" "),
function(w,l,f,a,d,b,q,t){function m(a){if("object"!==typeof a)a=Error(a);else if("cancel"===a.dojoType)return;q.emit(this.domNode,"dgrid-error",{grid:this,error:a,cancelable:!0,bubbles:!0})&&console.error(a)}return w(null,{collection:null,_renderedCollection:null,_rows:null,_observerHandle:null,shouldTrackCollection:!0,getBeforePut:!0,noDataMessage:"",loadingMessage:"",_total:0,constructor:function(){this.dirty={};this._updating={};this._columnsWithSet={};a.before(this,"configStructure",l.hitch(this,
function(){this._columnsWithSet={}}))},destroy:function(){this.inherited(arguments);this._renderedCollection&&this._cleanupCollection();this._refreshTimeout&&clearTimeout(this._refreshTimeout)},_configColumn:function(a){a.set&&(this._columnsWithSet[a.field]=a);this.inherited(arguments)},_setCollection:function(a){this._renderedCollection&&(this.cleanup(),this._cleanupCollection({shouldRevert:!a||a.storage!==this._renderedCollection.storage}));this.collection=a;if(this._started){if(a){var b=a;this.sort&&
0<this.sort.length&&(b=a.sort(this.sort));b.track&&this.shouldTrackCollection&&(b=b.track(),this._rows=[],this._observerHandle=this._observeCollection(b,this.contentNode,{rows:this._rows}));this._renderedCollection=b}this.refresh()}},_setStore:function(){this.collection||console.debug("set('store') call detected, but you probably meant set('collection')")},_getTotal:function(){return this._total},_cleanupCollection:function(a){a=a||{};this._renderedCollection.tracking&&this._renderedCollection.tracking.remove();
this._observerHandle&&(this._observerHandle.remove(),this._observerHandle=this._rows=null);!1!==a.shouldRevert&&(this.dirty={});this._renderedCollection=this.collection=null},_applySort:function(){this.collection?this.set("collection",this.collection):this.store&&console.debug("_StoreMixin found store property but not collection; this is often the sign of a mistake during migration from 0.3 to 0.4")},_emitRefreshComplete:function(){var a=this;this._refreshTimeout=setTimeout(function(){q.emit(a.domNode,
"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:a});a._refreshTimeout=null},0)},_insertNoDataNode:function(a){this._removeNoDataNode();a=a||this.contentNode;var b=this.noDataNode=d.create("div",{className:"dgrid-no-data",innerHTML:this.noDataMessage});a.insertBefore(b,this._getFirstRowSibling?this._getFirstRowSibling(a):null);return b},_removeNoDataNode:function(){return this.noDataNode?(d.destroy(this.noDataNode),delete this.noDataNode,!0):!1},row:function(){var a=this.inherited(arguments);
a&&a.data&&"undefined"!==typeof a.id&&(a.id=this.collection.getIdentity(a.data));return a},refresh:function(){var a=this.inherited(arguments);this.collection||this._insertNoDataNode();return a},refreshCell:function(a){if(!this.collection||!this._createBodyRowCell)throw Error("refreshCell requires a Grid with a collection.");this.inherited(arguments);return this.collection.get(a.row.id).then(l.hitch(this,"_refreshCellFromItem",a))},_refreshCellFromItem:function(a,b,f){var k=a.element;d.empty(k);var m=
this.dirty&&this.dirty[a.row.id];m&&(b=l.delegate(b,m));this._createBodyRowCell(k,a.column,b,f)},renderArray:function(){var a=this.inherited(arguments);this.collection||a.length&&this.noDataNode&&d.destroy(this.noDataNode);return a},insertRow:function(a,b,f,m,q){var k=this.collection,p=this.dirty,k=k&&k.getIdentity(a),v;k in p&&!(k in this._updating)&&(v=p[k]);v&&(a=l.delegate(a,v));p=this.inherited(arguments);q&&q.rows&&(q.rows[m]=p);this.noDataNode&&(d.destroy(this.noDataNode),this.noDataNode=null);
return p},updateDirty:function(a,b,d){var f=this.dirty,k=f[a];k||(k=f[a]={});k[b]=d},save:function(){function a(a,c){return function(f){var k=b._columnsWithSet,l=b._updating,p,q;if("function"===typeof f.set)f.set(c);else for(p in c)f[p]=c[p];for(p in k)q=k[p].set(f),void 0!==q&&(f[p]=q);l[a]=!0;return d.put(f).then(function(b){delete m[a];delete l[a];r[a]=b;return r})}}var b=this,d=this.collection,m=this.dirty,l=new f,r={},q=function(a){var c;return b.getBeforePut||!(c=b.row(a).data)?function(){return d.get(a)}:
function(){return c}},t=l.then(function(){return r}),w;for(w in m)var c=a(w,m[w]),t=t.then(q(w)).then(c);l.resolve();return t},revert:function(){this.dirty={};this.refresh()},_trackError:function(a){"string"===typeof a&&(a=l.hitch(this,a));var b=this,d;try{d=t(a())}catch(z){a=new f,a.reject(z),d=a.promise}d.otherwise(function(a){m.call(b,a)});return d},removeRow:function(a,b,d){var f={element:a};b||this.up(f).element!==a||this.down(f).element!==a||this._insertNoDataNode();(f=d&&d.rows||this._rows)&&
delete f[a.rowIndex];return this.inherited(arguments)},renderQueryResults:function(a,b,d){d=l.mixin({rows:this._rows},d);var f=this;return a.then(function(a){a=f.renderArray(a,b,d);delete f._lastCollection;return a})},_observeCollection:function(a,b,d){var f=this,k=d.rows,m,l=[a.on("delete, update",function(a){var l=a.previousIndex,c=a.index;void 0!==l&&k[l]&&("max"in k&&(void 0===c||c<k.min||c>k.max)&&k.max--,m=k[l],m.parentNode===b&&f.removeRow(m,!1,d),k.splice(l,1),("delete"===a.type||"update"===
a.type&&(l<c||void 0===c))&&k[l]&&k[l].rowIndex--);"delete"===a.type&&(m=null)}),a.on("add, update",function(a){var l=a.previousIndex,c=a.index;if(void 0!==c&&(!("max"in k)||c>=k.min&&c<=k.max)){"max"in k&&(void 0===l||l<k.min||l>k.max)&&k.max++;if(k.length){if(l=k[c],!l&&(l=k[c-1]))l=(l.connected||l).nextSibling}else l=f._getFirstRowSibling&&f._getFirstRowSibling(b);m&&l&&m.id===l.id&&(l=(l.connected||l).nextSibling);l&&!l.parentNode&&(l=document.getElementById(l.id));k.splice(c,0,void 0);m=f.insertRow(a.target,
b,l,c,d);f.highlightRow(m)}m=null}),a.on("add, delete, update",function(b){var d="undefined"!==typeof b.previousIndex?b.previousIndex:Infinity,c="undefined"!==typeof b.index?b.index:Infinity,m=Math.min(d,c);d!==c&&k[m]&&f.adjustRowIndices(k[m]);Infinity!==d&&f._processScroll&&(k[d]||k[d-1])&&f._processScroll();f._onNotification(k,b,a);a===f._renderedCollection&&"totalLength"in b&&(f._total=b.totalLength)})];return{remove:function(){for(;0<l.length;)l.pop().remove()}}},_onNotification:function(){}})})},
"dgrid/Selection":function(){define("dojo/_base/declare dojo/dom-class dojo/on dojo/has dojo/aspect ./List dojo/has!touch?./util/touch dojo/query dojo/_base/sniff dojo/dom".split(" "),function(w,l,f,a,d,b,q){function t(a,b){b=a.unselectable=b?"on":"";a=a.getElementsByTagName("*");for(var d=a.length;--d;)"INPUT"!==a[d].tagName&&"TEXTAREA"!==a[d].tagName&&(a[d].unselectable=b)}function m(b,k){var m=b.bodyNode,l=k?"text":21>a("ff")?"-moz-none":"none";p&&"msUserSelect"!==p?m.style[p]=l:a("dom-selectstart")?
k||b._selectstartHandle?k&&b._selectstartHandle&&(b._selectstartHandle.remove(),delete b._selectstartHandle):b._selectstartHandle=f(m,"selectstart",function(a){var b=a.target&&a.target.tagName;"INPUT"!==b&&"TEXTAREA"!==b&&a.preventDefault()}):(t(m,!k),k||b._unselectableHandle)?k&&b._unselectableHandle&&(b._unselectableHandle.remove(),delete b._unselectableHandle):b._unselectableHandle=d.after(b,"renderRow",function(a){t(a,!0);return a})}a.add("dom-comparedocumentposition",function(a,b,d){return!!d.compareDocumentPosition});
a.add("dom-selectstart","undefined"!==typeof document.onselectstart);var k=a("mac")?"metaKey":"ctrlKey",p=a("css-user-select"),x=(b=a("pointer"))&&"MS"===b.slice(0,2),z=b?b+(x?"Down":"down"):"mousedown",v=b?b+(x?"Up":"up"):"mouseup";"WebkitUserSelect"===p&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(p=!1);return w(null,{selectionDelegate:".dgrid-row",selectionEvents:z+","+v+",dgrid-cellfocusin",selectionTouchEvents:a("touch")?q.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,
selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&
this._removeDeselectSignals()},_setSelectionMode:function(a){a!==this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},_setAllowTextSelection:function(a){"undefined"!==typeof a?m(this,a):m(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(a,b){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(b))&&("dgrid-cellfocusin"!==a.type||"mousedown"!==
a.parentType)&&(a.type!==v||b===this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=a;if(!a.keyCode||!a.ctrlKey||32===a.keyCode)if(!a.shiftKey&&a.type===z&&this.isSelected(b))this._waitForMouseUp=b;else this[this._selectionHandlerName](a,b);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,b){a=a.keyCode?a.ctrlKey:a[k];this._lastSelected===b?this.select(b,null,!a||!this.isSelected(b)):(this.clearSelection(),this.select(b),this._lastSelected=b)},_multipleSelectionHandler:function(a,
b){var d=this._lastSelected,f=a.keyCode?a.ctrlKey:a[k],c;a.shiftKey||(c=f?null:!0,d=null);this.select(b,d,c);d||(this._lastSelected=b)},_extendedSelectionHandler:function(a,b){(2===a.button?this.isSelected(b):a.keyCode?a.ctrlKey:a[k])||this.clearSelection(null,!0);this._multipleSelectionHandler(a,b)},_toggleSelectionHandler:function(a,b){this.select(b,null,null)},_initSelectionEvents:function(){var b=this,m=this.contentNode,l=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};
a("touch")&&!a("pointer")&&this.selectionTouchEvents?(f(m,q.selector(l,this.selectionTouchEvents),function(a){b._handleSelect(a,this);b._ignoreMouseSelect=this}),f(m,f.selector(l,this.selectionEvents),function(a){b._ignoreMouseSelect!==this?b._handleSelect(a,this):a.type===v&&(b._ignoreMouseSelect=null)})):f(m,f.selector(l,this.selectionEvents),function(a){b._handleSelect(a,this)});this.addKeyHandler&&this.addKeyHandler(32,function(a){b._handleSelect(a,a.target)});if(this.allowSelectAll)this.on("keydown",
function(a){a[k]&&65===a.keyCode&&!/\bdgrid-input\b/.test(a.target.className)&&(a.preventDefault(),b[b.allSelected?"clearSelection":"selectAll"]())});this._setCollection&&d.before(this,"_setCollection",function(a){b._updateDeselectionAspect(a)});this._updateDeselectionAspect()},_updateDeselectionAspect:function(a){function b(a,b){if((a=f.row(a))&&f.selection[a.id])f[b](a)}var f=this,k;this._removeDeselectSignals&&this._removeDeselectSignals();k=a&&a.track&&this._observeCollection?[d.before(this,"_observeCollection",
function(a){k.push(a.on("delete",function(a){"undefined"===typeof a.index&&b(a.id,"deselect")}))}),d.after(this,"_observeCollection",function(a){k.push(a.on("update",function(c){"undefined"!==typeof c.index&&b(a.getIdentity(c.target),"select")}))},!0)]:[d.before(this,"removeRow",function(a,b){b||(a=this.row(a))&&a.id in this.selection&&this.deselect(a)})];this._removeDeselectSignals=function(){for(var a=k.length;a--;)k[a].remove();k=[]}},allowSelect:function(){return!0},_fireSelectionEvent:function(a){var b=
this._selectionEventQueues[a],d=this._selectionTriggerEvent,k;k={bubbles:!0,grid:this};d&&(k.parentType=d.type);k[this._selectionTargetType]=b;this._selectionEventQueues[a]=[];f.emit(this.contentNode,"dgrid-"+a,k)},_fireSelectionEvents:function(){var a=this._selectionEventQueues,b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},_select:function(a,b,d){var f,c,k;"undefined"===typeof d&&(d=!0);a.element||(a=this.row(a));if(!1===d||this.allowSelect(a))if(f=this.selection,c=!!f[a.id],null===d&&(d=
!c),k=a.element,d||this.allSelected?f[a.id]=d:delete this.selection[a.id],k&&(d?l.add(k,"dgrid-selected"+(this.addUiClasses?" ui-state-active":"")):l.remove(k,"dgrid-selected ui-state-active")),d!==c&&k&&this._selectionEventQueues[(d?"":"de")+"select"].push(a),b)if(b.element||(b=this.row(b)),b){if(b=b.element)for(f=this._determineSelectionDirection(k,b),f||(b=document.getElementById(b.id),f=this._determineSelectionDirection(k,b));a.element!==b&&(a=this[f](a));)this._select(a,null,d)}else this._lastSelected=
k,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},_determineSelectionDirection:a("dom-comparedocumentposition")?function(a,b){a=b.compareDocumentPosition(a);return a&1?!1:2===a?"down":"up"}:function(a,b){return 1>b.sourceIndex?!1:b.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,
b,d){this._select(a,b,d);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var d in this.selection)a!==d&&this._select(d,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||
null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var a=this.inherited(arguments),b=this.selection,d,f,c;for(d=0;d<a.length;d++)f=this.row(a[d]),(c=f.id in b?b[f.id]:this.allSelected)&&this.select(f,null,c);this._fireSelectionEvents();return a}})})},"dojo/store/Memory":function(){define(["../_base/declare",
"./util/QueryResults","./util/SimpleQueryEngine"],function(w,l,f){return w("dojo.store.Memory",null,{constructor:function(a){for(var d in a)this[d]=a[d];this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:f,get:function(a){return this.data[this.index[a]]},getIdentity:function(a){return a[this.idProperty]},put:function(a,d){var b=this.data,f=this.index,l=this.idProperty,l=a[l]=d&&"id"in d?d.id:l in a?a[l]:Math.random();if(l in f){if(d&&!1===d.overwrite)throw Error("Object already exists");
b[f[l]]=a}else f[l]=b.push(a)-1;return l},add:function(a,d){(d=d||{}).overwrite=!1;return this.put(a,d)},remove:function(a){var d=this.index,b=this.data;if(a in d)return b.splice(d[a],1),this.setData(b),!0},query:function(a,d){return l(this.queryEngine(a,d)(this.data))},setData:function(a){a.items?(this.idProperty=a.identifier||this.idProperty,a=this.data=a.items):this.data=a;this.index={};for(var d=0,b=a.length;d<b;d++)this.index[a[d][this.idProperty]]=d}})})},"dojo/store/util/QueryResults":function(){define(["../../_base/array",
"../../_base/lang","../../when"],function(w,l,f){var a=function(d){function b(b){d[b]=function(){var m=arguments,k=f(d,function(d){Array.prototype.unshift.call(m,d);return a(w[b].apply(w,m))});if("forEach"!==b||q)return k}}if(!d)return d;var q=!!d.then;q&&(d=l.delegate(d));b("forEach");b("filter");b("map");null==d.total&&(d.total=f(d,function(a){return a.length}));return d};l.setObject("dojo.store.util.QueryResults",a);return a})},"dojo/store/util/SimpleQueryEngine":function(){define(["../../_base/array"],
function(w){return function(l,f){function a(a){a=w.filter(a,l);var b=f&&f.sort;b&&a.sort("function"==typeof b?b:function(a,d){for(var f,k=0;f=b[k];k++){var m=a[f.attribute],l=d[f.attribute],m=null!=m?m.valueOf():m,l=null!=l?l.valueOf():l;if(m!=l)return!!f.descending==(null==m||m>l)?-1:1}return 0});if(f&&(f.start||f.count)){var d=a.length;a=a.slice(f.start||0,(f.start||0)+(f.count||Infinity));a.total=d}return a}switch(typeof l){default:throw Error("Can not query with a "+typeof l);case "object":case "undefined":var d=
l;l=function(a){for(var b in d){var f=d[b];if(f&&f.test){if(!f.test(a[b],a))return!1}else if(f!=a[b])return!1}return!0};break;case "string":if(!this[l])throw Error("No filter function "+l+" was found in store");l=this[l];case "function":}a.matches=l;return a}})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(w,l,f,a,d,b,q,t,m,k,p,x){f.isAsync||
t(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var z=l("dojo.dnd.Source",p,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(b,f){a.mixin(this,a.mixin({},f));b=this.accept;if(b.length)for(this.accept={},f=0;f<b.length;++f)this.accept[b[f]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState=
"";this.isSource&&d.add(this.node,"dojoDndSource");this.targetState="";this.accept&&d.add(this.node,"dojoDndTarget");this.horizontal&&d.add(this.node,"dojoDndHorizontal");this.topics=[m.subscribe("/dnd/source/over",a.hitch(this,"onDndSourceOver")),m.subscribe("/dnd/start",a.hitch(this,"onDndStart")),m.subscribe("/dnd/drop",a.hitch(this,"onDndDrop")),m.subscribe("/dnd/cancel",a.hitch(this,"onDndCancel"))]},checkAcceptance:function(a,b){if(this==a)return!this.copyOnly||this.selfAccept;for(var d=0;d<
b.length;++d){for(var f=a.getItem(b[d].id).type,k=!1,c=0;c<f.length;++c)if(f[c]in this.accept){k=!0;break}if(!k)return!1}return!0},copyState:function(a,b){if(a)return!0;2>arguments.length&&(b=this==x.manager().target);if(b){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){z.superclass.destroy.call(this);w.forEach(this.topics,function(a){a.remove()});this.targetAnchor=null},onMouseMove:function(a){if(!this.isDragging||"Disabled"!=this.targetState){z.superclass.onMouseMove.call(this,
a);var d=x.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(a.pageX-this._lastX)>this.delay||Math.abs(a.pageY-this._lastY)>this.delay)){var f=this.getSelectedNodes();f.length&&d.startDrag(this,f,this.copyState(k.getCopyKeyState(a),!0))}this.isDragging&&(f=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=b.position(this.current,!0)),f=this.horizontal?a.pageX-this.targetBox.x<this.targetBox.w/2==b.isBodyLtr(this.current.ownerDocument):a.pageY-
this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||f!=this.before)&&(this._markTargetAnchor(f),d.canDrop(!this.current||d.source!=this||!(this.current.id in this.selection)))}},onMouseDown:function(a){this.mouseDown||!this._legalMouseDown(a)||this.skipForm&&k.isFormElement(a)||(this.mouseDown=!0,this._lastX=a.pageX,this._lastY=a.pageY,z.superclass.onMouseDown.call(this,a))},onMouseUp:function(a){this.mouseDown&&(this.mouseDown=!1,z.superclass.onMouseUp.call(this,a))},onDndSourceOver:function(a){this!==
a?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(a=x.manager(),a.canDrop("Disabled"!=this.targetState&&(!this.current||a.source!=this||!(this.current.id in this.selection))))},onDndStart:function(a,b,d){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==a?d?"Copied":"Moved":"");b=this.accept&&this.checkAcceptance(a,b);this._changeState("Target",b?"":"Disabled");this==a&&x.manager().overSource(this);this.isDragging=!0},onDndDrop:function(a,
b,d,f){if(this==f)this.onDrop(a,b,d);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(a,b,d){if(this!=a)this.onDropExternal(a,b,d);else this.onDropInternal(b,d)},onDropExternal:function(a,b,d){var f=this._normalizedCreator;this._normalizedCreator=this.creator?function(b,c){return f.call(this,a.getItem(b.id).data,
c)}:d?function(b){var c=a.getItem(b.id);b=b.cloneNode(!0);b.id=k.getUniqueId();return{node:b,data:c.data,type:c.type}}:function(b){var c=a.getItem(b.id);a.delItem(b.id);return{node:b,data:c.data,type:c.type}};this.selectNone();d||this.creator||a.selectNone();this.insertNodes(!0,b,this.before,this.current);!d&&this.creator&&a.deleteSelectedNodes();this._normalizedCreator=f},onDropInternal:function(a,b){var d=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(b)this._normalizedCreator=
this.creator?function(a,b){return d.call(this,this.getItem(a.id).data,b)}:function(a){var b=this.getItem(a.id);a=a.cloneNode(!0);a.id=k.getUniqueId();return{node:a,data:b.data,type:b.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var b=this.getItem(a.id);return{node:a,data:b.data,type:b.type}}}this._removeSelection();this.insertNodes(!0,a,this.before,this.current);this._normalizedCreator=d}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){z.superclass.onOverEvent.call(this);
x.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){z.superclass.onOutEvent.call(this);x.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(a){if(this.current!=this.targetAnchor||this.before!=a)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=a,this.targetAnchor&&
this._addItemClass(this.targetAnchor,this.before?"Before":"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(a){this._changeState("Source",a?"Copied":"Moved")},_legalMouseDown:function(a){if("touchstart"!=a.type&&!q.isLeft(a))return!1;if(!this.withHandles)return!0;for(a=a.target;a&&a!==this.node;a=a.parentNode){if(d.contains(a,"dojoDndHandle"))return!0;
if(d.contains(a,"dojoDndItem")||d.contains(a,"dojoDndIgnore"))break}return!1}});return z})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(w,l,f,a,d,b,q,t,m,k,p,x){var z=l("dojo.dnd.Selector",x,{constructor:function(b,d){d||(d={});this.singular=d.singular;this.autoSync=d.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;
this.events.push(m(this.node,k.press,a.hitch(this,"onMouseDown")),m(this.node,k.release,a.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var a=new t,b=p._empty,f;for(f in this.selection)f in b||a.push(d.byId(f));return a},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(a,b){this._addItemClass(d.byId(b),"Selected");this.selection[b]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var a=p._empty,
f;for(f in this.selection)if(!(f in a)){var k=d.byId(f);this.delItem(f);b.destroy(k)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(a,b){b=b||f.global;var d=this.selection,k=p._empty,m;for(m in d)m in k||a.call(b,this.getItem(m),m,this)},sync:function(){z.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var a=[],b=p._empty,d;for(d in this.selection)d in b||this.getItem(d)||a.push(d);w.forEach(a,function(a){delete this.selection[a]},
this);return this},insertNodes:function(a,b,d,f){var k=this._normalizedCreator;this._normalizedCreator=function(b,d){b=k.call(this,b,d);a?(this.anchor?this.anchor!=b.node&&(this._removeItemClass(b.node,"Anchor"),this._addItemClass(b.node,"Selected")):(this.anchor=b.node,this._removeItemClass(b.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[b.node.id]=1):(this._removeItemClass(b.node,"Selected"),this._removeItemClass(b.node,"Anchor"));return b};z.superclass.insertNodes.call(this,
b,d,f);this._normalizedCreator=k;return this},destroy:function(){z.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(a){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!p.getCopyKeyState(a)&&!a.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,q.isLeft(a)&&(a.stopPropagation(),a.preventDefault());else{if(!this.singular&&a.shiftKey){p.getCopyKeyState(a)||this._removeSelection();var b=this.getAllNodes();if(b.length&&(this.anchor||(this.anchor=
b[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var d=0,f;d<b.length&&(f=b[d],f!=this.anchor&&f!=this.current);++d);for(++d;d<b.length;++d){f=b[d];if(f==this.anchor||f==this.current)break;this._addItemClass(f,"Selected");this.selection[f.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?p.getCopyKeyState(a)&&this.selectNone():(this.selectNone(),this.anchor=
this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):p.getCopyKeyState(a)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=
1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);a.stopPropagation();a.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=m(this.node,
k.move,a.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var a=p._empty,b;for(b in this.selection)if(!(b in a)){var f=d.byId(b);f&&this._removeItemClass(f,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return z})},"dojo/_base/NodeList":function(){define(["./kernel","../query",
"./array","./html","../NodeList-dom"],function(w,l,f){l=l.NodeList;var a=l.prototype;a.connect=l._adaptAsForEach(function(){return w.connect.apply(this,arguments)});a.coords=l._adaptAsMap(w.coords);l.events="blur focus change click error keydown keypress keyup load mousedown mouseenter mouseleave mousemove mouseout mouseover mouseup submit".split(" ");f.forEach(l.events,function(d){var b="on"+d;a[b]=function(a,d){return this.connect(b,a,d)}});return w.NodeList=l})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v){l=l("dojo.dnd.Container",m,{skipForm:!1,allowNested:!1,constructor:function(d,f){this.node=b.byId(d);f||(f={});this.creator=f.creator||null;this.skipForm=f.skipForm;this.parent=f.dropParent&&b.byId(f.dropParent);this.map={};this.current=null;this.containerState="";q.add(this.node,"dojoDndContainer");f&&f._skipStartup||this.startup();this.events=[p(this.node,z.over,a.hitch(this,"onMouseOver")),p(this.node,z.out,a.hitch(this,"onMouseOut")),p(this.node,"dragstart",
a.hitch(this,"onSelectStart")),p(this.node,"selectstart",a.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(a){return this.map[a]},setItem:function(a,b){this.map[a]=b},delItem:function(a){delete this.map[a]},forInItems:function(a,b){b=b||f.global;var d=this.map,k=v._empty,c;for(c in d)c in k||a.call(b,d[c],c,this);return b},clearItems:function(){this.map={}},getAllNodes:function(){return x((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var a={};this.getAllNodes().forEach(function(b){if(b.id){var d=
this.getItem(b.id);if(d){a[b.id]=d;return}}else b.id=v.getUniqueId();var d=b.getAttribute("dndType"),f=b.getAttribute("dndData");a[b.id]={data:f||b.innerHTML,type:d?d.split(/\s*,\s*/):["text"]}},this);this.map=a;return this},insertNodes:function(a,b,d){this.parent.firstChild?b?d||(d=this.parent.firstChild):d&&(d=d.nextSibling):d=null;var f;if(d)for(b=0;b<a.length;++b)f=this._normalizedCreator(a[b]),this.setItem(f.node.id,{data:f.data,type:f.type}),d.parentNode.insertBefore(f.node,d);else for(b=0;b<
a.length;++b)f=this._normalizedCreator(a[b]),this.setItem(f.node.id,{data:f.data,type:f.type}),this.parent.appendChild(f.node);return this},destroy:function(){w.forEach(this.events,function(a){a.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(a,b,d){a._skipStartup=!0;return new d(b,a)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var a=this.parent.getElementsByTagName("tbody");a&&a.length&&(this.parent=
a[0])}this.defaultCreator=v._defaultCreator(this.parent);this.sync()},onMouseOver:function(a){for(var b=a.relatedTarget;b&&b!=this.node;)try{b=b.parentNode}catch(C){b=null}b||(this._changeState("Container","Over"),this.onOverEvent());b=this._getChildByEvent(a);this.current!=b&&(this.current&&this._removeItemClass(this.current,"Over"),b&&this._addItemClass(b,"Over"),this.current=b)},onMouseOut:function(a){for(a=a.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(u){a=null}}this.current&&
(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(a){this.skipForm&&v.isFormElement(a)||(a.stopPropagation(),a.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(a,b){var d="dojoDnd"+a;a=a.toLowerCase()+"State";q.replace(this.node,d+b,d+this[a]);this[a]=b},_addItemClass:function(a,b){q.add(a,"dojoDndItem"+b)},_removeItemClass:function(a,b){q.remove(a,"dojoDndItem"+b)},_getChildByEvent:function(a){if(a=
a.target)for(var b=a.parentNode;b;a=b,b=a.parentNode)if((b==this.parent||this.allowNested)&&q.contains(a,"dojoDndItem"))return a;return null},_normalizedCreator:function(b,d){b=(this.creator||this.defaultCreator).call(this,b,d);a.isArray(b.type)||(b.type=["text"]);b.node.id||(b.node.id=v.getUniqueId());q.add(b.node,"dojoDndItem");return b}});v._createNode=function(a){return a?function(b){return t.create(a,{innerHTML:b})}:v._createSpan};v._createTrTd=function(a){var b=t.create("tr");t.create("td",
{innerHTML:a},b);return b};v._createSpan=function(a){return t.create("span",{innerHTML:a})};v._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};v._defaultCreator=function(b){b=b.tagName.toLowerCase();var d="tbody"==b||"thead"==b?v._createTrTd:v._createNode(v._defaultCreatorNodes[b]);return function(b,f){var c=b&&a.isObject(b),k;c&&b.tagName&&b.nodeType&&b.getAttribute?(k=b.getAttribute("dndData")||b.innerHTML,c=(c=b.getAttribute("dndType"))?c.split(/\s*,\s*/):["text"]):(k=c&&b.data?b.data:
b,c=c&&b.type?b.type:["text"],b=("avatar"==f?v._createSpan:d)(String(k)));b.id||(b.id=v.getUniqueId());return{node:b,data:k,type:c}}};return l})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(w,l,f,a,d,b,q,t,m,k,p,x,z,v){var r=l("dojo.dnd.Manager",[b],{constructor:function(){this.source=this.avatar=null;this.nodes=[];this.copy=!0;
this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:q("touch")?4:16,OFFSET_Y:q("touch")?4:16,overSource:function(a){this.avatar&&(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=!!this.target,this.avatar.update());k.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),k.publish("/dnd/source/over",null)):k.publish("/dnd/source/over",null)},startDrag:function(b,l,q){function c(a){a.preventDefault();
a.stopPropagation()}z.autoScrollStart(a.doc);this.source=b;this.nodes=l;this.copy=!!q;this.avatar=this.makeAvatar();a.body().appendChild(this.avatar.node);k.publish("/dnd/start",b,l,this.copy);this.events=[m(a.doc,p.move,f.hitch(this,"onMouseMove")),m(a.doc,p.release,f.hitch(this,"onMouseUp")),m(a.doc,"keydown",f.hitch(this,"onKeyDown")),m(a.doc,"keyup",f.hitch(this,"onKeyUp")),m(a.doc,"dragstart",c),m(a.body(),"selectstart",c)];b="dojoDnd"+(q?"Copy":"Move");d.add(a.body(),b)},canDrop:function(a){a=
!(!this.target||!a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){d.remove(a.body(),["dojoDndCopy","dojoDndMove"]);w.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new v(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(a){var b=this.avatar;b&&(z.autoScrollNodes(a),b=b.node.style,b.left=a.pageX+this.OFFSET_X+"px",b.top=
a.pageY+this.OFFSET_Y+"px",b=!!this.source.copyState(x.getCopyKeyState(a)),this.copy!=b&&this._setCopyStatus(b));q("touch")&&a.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&this.canDropFlag){var b=!!this.source.copyState(x.getCopyKeyState(a));k.publish("/dnd/drop/before",this.source,this.nodes,b,this.target,a);k.publish("/dnd/drop",this.source,this.nodes,b,this.target,a)}else k.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(a){if(this.avatar)switch(a.keyCode){case t.CTRL:a=
!!this.source.copyState(!0);this.copy!=a&&this._setCopyStatus(a);break;case t.ESCAPE:k.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(a){this.avatar&&a.keyCode==t.CTRL&&(a=!!this.source.copyState(!1),this.copy!=a&&this._setCopyStatus(a))},_setCopyStatus:function(b){this.copy=b;this.source._markDndStatus(this.copy);this.updateAvatar();d.replace(a.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});x._manager=null;r.manager=x.manager=function(){x._manager||
(x._manager=new r);return x._manager};return r})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(w,l,f,a,d,b,q,t){return w("dojo.dnd.Avatar",null,{constructor:function(a){this.manager=a;this.construct()},construct:function(){var d=b.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),f=this.manager.source,l,t=b.create("tbody",null,d),w=b.create("tr",
null,t),v=b.create("td",null,w),r=Math.min(5,this.manager.nodes.length),u=0;q("highcontrast")&&b.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},v);b.create("span",{innerHTML:f.generateText?this._generateText():""},v);for(a.set(w,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});u<r;++u)f.creator?l=f._normalizedCreator(f.getItem(this.manager.nodes[u].id).data,"avatar").node:(l=this.manager.nodes[u].cloneNode(!0),"tr"==l.tagName.toLowerCase()&&(w=b.create("table"),b.create("tbody",
null,w).appendChild(l),l=w)),l.id="",w=b.create("tr",null,t),v=b.create("td",null,w),v.appendChild(l),a.set(w,{"class":"dojoDndAvatarItem",style:{opacity:(9-u)/10}});this.node=d},destroy:function(){b.destroy(this.node);this.node=!1},update:function(){d.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(q("highcontrast")){var a=f.byId("a11yIcon"),b="+";this.manager.canDropFlag&&!this.manager.copy?b="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||(b="x"):
b="o";a.innerHTML=b}t("tr.dojoDndAvatarHeader td span"+(q("highcontrast")?" span":""),this.node).forEach(function(a){a.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(w,l,f,a){return w("dijit.CheckedMenuItem",f,{baseClass:"dijitMenuItem dijitCheckedMenuItem",
templateString:a,checked:!1,_setCheckedAttr:function(a){this.domNode.setAttribute("aria-checked",a?"true":"false");this._set("checked",a)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(a){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(a)}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x){q=w("dijit.MenuItem"+(b("dojo-bidi")?"_NoBidi":""),[t,m,k,p],{templateString:x,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",a);var b="",d;d=a.search(/{\S}/);if(0<=d){var b=a.charAt(d+1),f=a.substr(0,d);a=a.substr(d+3);d=f+b+a;a=f+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+b+"\x3c/span\x3e"+a}else d=a;this.domNode.setAttribute("aria-label",d+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){!a||"label"in this.params||this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);f.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&f.set(this.accelKeyNode,"id",this.id+"_accel");l.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==b("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(z){}},_setSelected:function(b){a.toggle(this.domNode,
"dijitMenuItemSelected",b)},setLabel:function(a){d.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){d.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){this.accelKeyNode&&(this.accelKeyNode.style.display=
a?"":"none",this.accelKeyNode.innerHTML=a,f.set(this.containerNode,"colSpan",a?"1":"2"));this._set("accelKey",a)}});b("dojo-bidi")&&(q=w("dijit.MenuItem",q,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return q})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c){function D(a){return function(b){this._isLoaded?this.inherited(a,arguments):this.loadDropDown(t.hitch(this,a,b))}}var B=l("dijit.form._SelectMenu",z,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(m(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}))},focus:function(){var a=!1,b=this.parentWidget.value;
t.isArray(b)&&(b=b[b.length-1]);b&&w.forEach(this.parentWidget._getChildren(),function(c){c.option&&b===c.option.value&&(a=!0,this.focusChild(c,!1))},this);a||this.inherited(arguments)}});d=l("dijit.form.Select"+(k("dojo-bidi")?"_NoBidi":""),[p,x,C],{baseClass:"dijitSelect dijitValidationTextBox",templateString:c,_buttonInputDisabled:k("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var b=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=b?b:0].value)}this.dropDown=new B({id:this.id+"_menu",parentWidget:this});a.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(a){if(a.value||a.label){var b=t.hitch(this,"_setValueAttr",a);a=new v({option:a,label:("text"===this.labelType?(a.label||"").toString().replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a.label)||this.emptyLabel,
onClick:b,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:a.disabled||!1});a.focusNode.setAttribute("role","option");return a}return new r({ownerDocument:this.ownerDocument})},_addOptionItem:function(a){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(a))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(I){}},focusChild:function(a){a&&this.set("value",
a.option)},_getFirst:function(){var a=this._getChildren();return a.length?a[0]:null},_getLast:function(){var a=this._getChildren();return a.length?a[a.length-1]:null},childSelector:function(a){return(a=E.byNode(a))&&a.getParent()==this.dropDown},onKeyboardSearch:function(a,b,c,d){a&&this.focusChild(a)},_loadChildren:function(a){if(!0===a)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{w.forEach(this._getChildren(),function(a){a.destroyRecursive()});
var b=new v({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(b)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(a){this.inherited(arguments);f.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",
_setDisabledAttr:function(a){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(a){this._set("required",a);this.focusNode.setAttribute("aria-required",a);this._refreshState()},_setOptionsAttr:function(a){this._isLoaded=!1;this._set("options",a)},_setDisplay:function(a){a=("text"===this.labelType?(a||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+a+"\x3c/span\x3e"},validate:function(a){a=this.disabled||this.isValid(a);this._set("state",a?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",a?"false":"true");var b=a?"":this._missingMsg;b&&this.focused&&this._hasBeenBlurred?u.show(b,this.domNode,this.tooltipPosition,!this.isLeftToRight()):u.hide(this.domNode);this._set("message",b);return a},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);u.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=b.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(m(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var a=this._keyNavCodes;delete a[q.LEFT_ARROW];delete a[q.RIGHT_ARROW]},_setStyleAttr:function(b){this.inherited(arguments);
a.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(a){this._loadChildren(!0);this._isLoaded=!0;a()},destroy:function(a){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(a),delete this.dropDown);u.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){u.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
k("dojo-bidi")&&(d=l("dijit.form.Select",d,{_setDisplay:function(a){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));d._Menu=B;d.prototype._onContainerKeydown=D("_onContainerKeydown");d.prototype._onContainerKeypress=D("_onContainerKeypress");return d})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z){return d("dijit.form._FormSelectWidget",z,{multiple:!1,options:null,store:null,_setStoreAttr:function(a){this._created&&this._deprecatedSetStore(a)},query:null,_setQueryAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:a})},queryOptions:null,_setQueryOptionsAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:a})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(a){var b=this.options||[];if(null==a)return b;if(m.isArrayLike(a))return w.map(a,"return this.getOptions(item);",this);m.isString(a)&&(a={value:a});m.isObject(a)&&(w.some(b,function(b,d){for(var f in a)if(!(f in b)||b[f]!=a[f])return!1;a=d;return!0})||(a=-1));return 0<=a&&a<b.length?b[a]:null},addOption:function(a){w.forEach(m.isArrayLike(a)?a:[a],function(a){a&&m.isObject(a)&&this.options.push(a)},this);this._loadChildren()},removeOption:function(a){a=this.getOptions(m.isArrayLike(a)?
a:[a]);w.forEach(a,function(a){a&&(this.options=w.filter(this.options,function(b){return b.value!==a.value||b.label!==a.label}),this._removeOptionItem(a))},this);this._loadChildren()},updateOption:function(a){w.forEach(m.isArrayLike(a)?a:[a],function(a){var b=this.getOptions({value:a.value}),d;if(b)for(d in a)b[d]=a[d]},this);this._loadChildren()},setStore:function(a,b,d){t.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(a,b,d)},_deprecatedSetStore:function(b,d,k){var q=this.store;k=k||{};if(q!==b){for(var r;r=this._notifyConnections.pop();)r.remove();b.get||(m.mixin(b,{_oldAPI:!0,get:function(a){var b=new l;this.fetchItemByIdentity({identity:a,onItem:function(a){b.resolve(a)},onError:function(a){b.reject(a)}});return b.promise},query:function(a,b){var c=new l(function(){d.abort&&d.abort()});c.total=new l;var d=this.fetch(m.mixin({query:a,onBegin:function(a){c.total.resolve(a)},
onComplete:function(a){c.resolve(a)},onError:function(a){c.reject(a)}},b));return new x(c)}}),b.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[f.after(b,"onNew",m.hitch(this,"_onNewItem"),!0),f.after(b,"onDelete",m.hitch(this,"_onDeleteItem"),!0),f.after(b,"onSet",m.hitch(this,"_onSetItem"),!0)]));this._set("store",b)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);k.query&&this._set("query",k.query);k.queryOptions&&this._set("queryOptions",k.queryOptions);b&&b.query&&(this._loadingStore=!0,this.onLoadDeferred=new l,this._queryRes=b.query(this.query,this.queryOptions),p(this._queryRes,m.hitch(this,function(c){if(this.sortByLabel&&!k.sort&&c.length)if(b.getValue)c.sort(a.createSortFunction([{attribute:b.getLabelAttributes(c[0])[0]}],b));else{var f=this.labelAttr;c.sort(function(a,b){return a[f]>b[f]?1:b[f]>
a[f]?-1:0})}k.onFetch&&(c=k.onFetch.call(this,c,k));w.forEach(c,function(a){this._addOptionForItem(a)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(m.hitch(this,function(a,b,c){b==c?this._onSetItem(a):(-1!=b&&this._onDeleteItem(a),-1!=c&&this._onNewItem(a))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:d);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(c):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),m.hitch(this,function(a){console.error("dijit.form.Select: "+a.toString());this.onLoadDeferred.reject(a)})));return q},_setValueAttr:function(a,b){this._onChangeActive||(b=null);if(this._loadingStore)this._pendingValue=a;else if(null!=a){a=m.isArrayLike(a)?w.map(a,function(a){return m.isObject(a)?a:{value:a}}):m.isObject(a)?[a]:[{value:a}];a=w.filter(this.getOptions(a),function(a){return a&&a.value});var d=this.getOptions()||[];this.multiple||a[0]&&a[0].value||!d.length||(a[0]=
d[0]);w.forEach(d,function(b){b.selected=w.some(a,function(a){return a.value===b.value})});d=w.map(a,function(a){return a.value});if("undefined"!=typeof d&&"undefined"!=typeof d[0]){var f=w.map(a,function(a){return a.label});this._setDisplay(this.multiple?f:f[0]);this.inherited(arguments,[this.multiple?d:d[0],b]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var a=w.map([].concat(this.get("selectedOptions")),function(a){return a&&"label"in a?a.label:a?a.value:null},this);return this.multiple?
a:a[0]},_setDisplayedValueAttr:function(a){this.set("value",this.getOptions("string"==typeof a?{label:a}:a))},_loadChildren:function(){this._loadingStore||(w.forEach(this._getChildren(),function(a){a.destroyRecursive()}),w.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var a=[].concat(this.value);if(a&&a[0]){var b=this;w.forEach(this._getChildren(),function(d){var f=w.some(a,function(a){return d.option&&
a===d.option.value});f&&!b.multiple&&(b.focusedChild=d);q.toggle(d.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),f);d.domNode.setAttribute("aria-selected",f?"true":"false")},this)}},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var b=w.filter(a,function(a){return a.selected})[0];if(b&&b.value)return b.value;a[0].selected=!0;return a[0].value}return this.multiple?w.map(w.filter(a,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(a,b){b&&b.parent||this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption({value:this.store.getIdentity(a)})},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var b=this.store,d=this.labelAttr&&this.labelAttr in a?a[this.labelAttr]:b.getLabel(a);return{value:d?b.getIdentity(a):null,label:d,item:a}},_addOptionForItem:function(a){var b=this.store;b.isItemLoaded&&!b.isItemLoaded(a)?b.loadItem({item:a,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(a=this._getOptionObjForItem(a),this.addOption(a))},constructor:function(a){this._oValue=(a||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);b.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?k("\x3e *",this.srcNodeRef).map(function(a){return"separator"===a.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:a.getAttribute("data-"+t._scopeName+"-value")||a.getAttribute("value"),
label:String(a.innerHTML),selected:a.getAttribute("selected")||!1,disabled:a.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);f.after(this,"onChange",m.hitch(this,"_updateSelection"));var a=this.store;a&&(a.getIdentity||a.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(a,this._oValue,
{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var a;a=this._notifyConnections.pop();)a.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(w){var l={};w.setObject("dojo.data.util.sorter",l);l.basicComparator=function(f,a){var d=-1;null===f&&(f=void 0);null===a&&(a=void 0);if(f==a)d=0;else if(f>a||null==f)d=1;return d};l.createSortFunction=function(f,a){function d(a,b,d,f){return function(k,m){k=f.getValue(k,a);m=f.getValue(m,a);
return b*d(k,m)}}for(var b=[],q,t=a.comparatorMap,m=l.basicComparator,k=0;k<f.length;k++){q=f[k];var p=q.attribute;if(p){q=q.descending?-1:1;var w=m;t&&("string"!==typeof p&&"toString"in p&&(p=p.toString()),w=t[p]||m);b.push(d(p,q,w,a))}}return function(a,d){for(var f=0;f<b.length;){var k=b[f++](a,d);if(0!==k)return k}return 0}};return l})},"dijit/_HasDropDown":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on dojo/touch ./registry ./focus ./popup ./_FocusMixin".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u){return w("dijit._HasDropDown",u,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(a){this.disabled||this.readOnly||("MSPointerDown"!=a.type&&a.preventDefault(),this.own(p.once(this.ownerDocument,x.release,k.hitch(this,"_onDropDownMouseUp"))),this.toggleDropDown())},_onDropDownMouseUp:function(a){var f=
this.dropDown,c=!1;if(a&&this._opened){var k=b.position(this._buttonNode,!0);if(!(a.pageX>=k.x&&a.pageX<=k.x+k.w&&a.pageY>=k.y&&a.pageY<=k.y+k.h)){for(k=a.target;k&&!c;)d.contains(k,"dijitPopup")?c=!0:k=k.parentNode;if(c){k=a.target;if(f.onItemClick){for(var m;k&&!(m=z.byNode(k));)k=k.parentNode;if(m&&m.onClick&&m.getParent)m.getParent().onItemClick(m,a)}return}}}this._opened?f.focus&&(!1!==f.autoFocus||"mouseup"==a.type&&!this.hovering)&&(this._focusDropDownTimer=this.defer(function(){f.focus();
delete this._focusDropDownTimer})):this.focus&&this.defer("focus")},_onDropDownClick:function(a){this._stopClickEvents&&(a.stopPropagation(),a.preventDefault())},buildRendering:function(){this.inherited(arguments);this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var a={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||
this.dropDownPosition[0]||"Down";d.add(this._arrowWrapperNode||this._buttonNode,"dijit"+a+"ArrowButton")},postCreate:function(){this.inherited(arguments);var a=this.focusNode||this.domNode;this.own(p(this._buttonNode,x.press,k.hitch(this,"_onDropDownMouseDown")),p(this._buttonNode,"click",k.hitch(this,"_onDropDownClick")),p(a,"keydown",k.hitch(this,"_onKey")),p(a,"keyup",k.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0);this.dropDown&&(this.dropDown._destroyed||this.dropDown.destroyRecursive(),
delete this.dropDown);this.inherited(arguments)},_onKey:function(a){if(!this.disabled&&!this.readOnly){var b=this.dropDown,c=a.target;b&&this._opened&&b.handleKey&&!1===b.handleKey(a)?(a.stopPropagation(),a.preventDefault()):b&&this._opened&&a.keyCode==m.ESCAPE?(this.closeDropDown(),a.stopPropagation(),a.preventDefault()):!this._opened&&(a.keyCode==m.DOWN_ARROW||(a.keyCode==m.ENTER||a.keyCode==m.SPACE&&(!this._searchTimer||a.ctrlKey||a.altKey||a.metaKey))&&("input"!==(c.tagName||"").toLowerCase()||
c.type&&"text"!==c.type.toLowerCase()))&&(this._toggleOnKeyUp=!0,a.stopPropagation(),a.preventDefault())}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp;this.toggleDropDown();var a=this.dropDown;a&&a.focus&&this.defer(k.hitch(a,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1);this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(a){a()},loadAndOpenDropDown:function(){var a=new l,b=k.hitch(this,function(){this.openDropDown();a.resolve(this.dropDown)});
this.isLoaded()?b():this.loadDropDown(b);return a},toggleDropDown:function(){this.disabled||this.readOnly||(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var f=this.dropDown,m=f.domNode,c=this._aroundNode||this.domNode,l=this,p=r.open({parent:this,popup:f,around:c,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){l.closeDropDown(!0)},onCancel:function(){l.closeDropDown(!0)},onClose:function(){a.set(l._popupStateNode,"popupActive",
!1);d.remove(l._popupStateNode,"dijitHasDropDownOpen");l._set("_opened",!1)}});if(this.forceWidth||this.autoWidth&&c.offsetWidth>f._popupWrapper.offsetWidth){var c=c.offsetWidth-f._popupWrapper.offsetWidth,q={w:f.domNode.offsetWidth+c};this._origStyle=m.style.cssText;k.isFunction(f.resize)?f.resize(q):b.setMarginBox(m,q);"R"==p.corner[1]&&(f._popupWrapper.style.left=f._popupWrapper.style.left.replace("px","")-c+"px")}a.set(this._popupStateNode,"popupActive","true");d.add(this._popupStateNode,"dijitHasDropDownOpen");
this._set("_opened",!0);this._popupStateNode.setAttribute("aria-expanded","true");this._popupStateNode.setAttribute("aria-owns",f.id);"presentation"===m.getAttribute("role")||m.getAttribute("aria-labelledby")||m.setAttribute("aria-labelledby",this.id);return p},closeDropDown:function(a){this._focusDropDownTimer&&(this._focusDropDownTimer.remove(),delete this._focusDropDownTimer);this._opened&&(this._popupStateNode.setAttribute("aria-expanded","false"),a&&this.focus&&this.focus(),r.close(this.dropDown),
this._opened=!1);this._origStyle&&(this.dropDown.domNode.style.cssText=this._origStyle,delete this._origStyle)}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(w,l,f,a,d,b){return w("dijit.MenuSeparator",[f,a,d],{templateString:b,buildRendering:function(){this.inherited(arguments);l.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare",
"dojo/keys","./_Spinner","./NumberTextBox"],function(w,l,f,a){return w("dijit.form.NumberSpinner",[f,a.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(a,b){var d=this.constraints,f=isNaN(a),m=!isNaN(d.max),k=!isNaN(d.min);f&&0!=b&&(a=0<b?k?d.min:m?d.max:0:m?this.constraints.max:k?d.min:0);b=a+b;if(f||isNaN(b))return a;m&&b>d.max&&(b=d.max);k&&b<d.min&&(b=d.min);return b},_onKeyDown:function(a){if(!(this.disabled||this.readOnly||a.keyCode!=l.HOME&&a.keyCode!=l.END||
a.ctrlKey||a.altKey||a.metaKey||"undefined"==typeof this.get("value"))){var b=this.constraints[a.keyCode==l.HOME?"min":"max"];"number"==typeof b&&this._setValueAttr(b,!1);a.stopPropagation();a.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),function(w,l,f,a,d,b,q,t,m,k){return w("dijit.form._Spinner",t,{defaultTimeout:500,
minimumTimeout:10,timeoutChangeRate:.9,smallDelta:1,largeDelta:10,templateString:m,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(a){return a},_arrowPressed:function(a,b,d){this.disabled||this.readOnly||(this._setValueAttr(this.adjust(this.get("value"),b*d),!1),k.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=null},_typematicCallback:function(a,b,d){var f=
this.smallDelta;b==this.textbox&&(b=d.keyCode,f=b==l.PAGE_UP||b==l.PAGE_DOWN?this.largeDelta:this.smallDelta,b=b==l.UP_ARROW||b==l.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==a?this._arrowReleased(b):this._arrowPressed(b,b==this.upArrowNode?1:-1,f)},_wheelTimer:null,_mouseWheeled:function(a){if(this.focused){a.stopPropagation();a.preventDefault();var b=a.wheelDelta/120;Math.floor(b)!=b&&(b=0<a.wheelDelta?1:-1);a=a.detail?-1*a.detail:b;if(0!==a){var d=this[0<a?"upArrowNode":"downArrowNode"];this._arrowPressed(d,
a,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(d)},50)}}},_setConstraintsAttr:function(a){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(a,
b){this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(b(this.domNode,d.wheel,f.hitch(this,"_mouseWheeled")),q.addListener(this.upArrowNode,this.textbox,{keyCode:l.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),q.addListener(this.downArrowNode,this.textbox,{keyCode:l.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,
"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),q.addListener(this.upArrowNode,this.textbox,{keyCode:l.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),q.addListener(this.downArrowNode,this.textbox,{keyCode:l.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout))}})})},"dijit/typematic":function(){define("dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/on dojo/sniff ./main".split(" "),
function(w,l,f,a,d,b){var q=b.typematic={_fireEventAndReload:function(){this._timer=null;this._callback(++this._count,this._node,this._evt);this._currentTimeout=Math.max(0>this._currentTimeout?this._initialDelay:1<this._subsequentDelay?this._subsequentDelay:Math.round(this._currentTimeout*this._subsequentDelay),this._minDelay);this._timer=setTimeout(f.hitch(this,"_fireEventAndReload"),this._currentTimeout)},trigger:function(a,b,d,l,q,w,v,r){if(q!=this._obj){this.stop();this._initialDelay=v||500;this._subsequentDelay=
w||.9;this._minDelay=r||10;this._obj=q;this._node=d;this._count=this._currentTimeout=-1;this._callback=f.hitch(b,l);this._evt={faux:!0};for(var k in a)"layerX"!=k&&"layerY"!=k&&(b=a[k],"function"!=typeof b&&"undefined"!=typeof b&&(this._evt[k]=b));this._fireEventAndReload()}},stop:function(){this._timer&&(clearTimeout(this._timer),this._timer=null);this._obj&&(this._callback(-1,this._node,this._evt),this._obj=null)},addKeyListener:function(b,d,k,p,x,z,v){var m="keyCode"in d?"keyCode":"charCode"in
d?"charCode":"charOrCode",t=[a(b,"keyCode"in d?"keydown":"charCode"in d?"keypress":l._keypress,f.hitch(this,function(a){a[m]!=d[m]||void 0!==d.ctrlKey&&d.ctrlKey!=a.ctrlKey||void 0!==d.altKey&&d.altKey!=a.altKey||void 0!==d.metaKey&&d.metaKey!=(a.metaKey||!1)||void 0!==d.shiftKey&&d.shiftKey!=a.shiftKey?q._obj==d&&q.stop():(a.stopPropagation(),a.preventDefault(),q.trigger(a,k,b,p,d,x,z,v))})),a(b,"keyup",f.hitch(this,function(){q._obj==d&&q.stop()}))];return{remove:function(){w.forEach(t,function(a){a.remove()})}}},
addMouseListener:function(b,m,k,l,x,z){var p=[a(b,"mousedown",f.hitch(this,function(a){a.preventDefault();q.trigger(a,m,b,k,b,l,x,z)})),a(b,"mouseup",f.hitch(this,function(a){this._obj&&a.preventDefault();q.stop()})),a(b,"mouseout",f.hitch(this,function(a){this._obj&&a.preventDefault();q.stop()})),a(b,"dblclick",f.hitch(this,function(a){a.preventDefault();9>d("ie")&&(q.trigger(a,m,b,k,b,l,x,z),setTimeout(f.hitch(this,q.stop),50))}))];return{remove:function(){w.forEach(p,function(a){a.remove()})}}},
addListener:function(a,b,d,f,l,q,v,r){var k=[this.addKeyListener(b,d,f,l,q,v,r),this.addMouseListener(a,f,l,q,v,r)];return{remove:function(){w.forEach(k,function(a){a.remove()})}}}};return q})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(w,l,f){return w("dijit.form.RangeBoundTextBox",f,{rangeMessage:"",rangeCheck:function(a,d){return("min"in d?0<=this.compare(a,d.min):!0)&&("max"in d?0>=this.compare(a,d.max):
!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var a=this.get("value");if(null==a)return!1;var d=!1;"min"in this.constraints&&(d=this.constraints.min,d=0>this.compare(a,"number"==typeof d&&0<=d&&0!=a?0:d));!d&&"max"in this.constraints&&(d=this.constraints.max,d=0<this.compare(a,"number"!=typeof d||0<d?d:0));return d},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(a){return this.inherited(arguments)&&
(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(a))},getErrorMessage:function(a){var d=this.get("value");return null==d||""===d||"number"==typeof d&&isNaN(d)||this.isInRange(a)?this.inherited(arguments):this.rangeMessage},postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=l.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare",
"dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(w,l,f,a){return w("dijit.form.MappedTextBox",a,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(a){return a.toString?a.toString():""},toString:function(){var a=this.filter(this.get("value"));return null!=a?"string"==typeof a?a:this.serialize(a,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},
buildRendering:function(){this.inherited(arguments);this.valueNode=f.place("\x3cinput type\x3d'hidden'"+(this.name&&!l("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),function(w,l,f,a,d,b){var q=function(a){a=a||{};var b=f.getLocalization("dojo.cldr",
"number",f.normalizeLocale(a.locale)),d=a.pattern?a.pattern:b[(a.type||"decimal")+"Format"];a="number"==typeof a.places?a.places:"string"===typeof a.places&&0<a.places.length?a.places.replace(/.*,/,""):-1!=d.indexOf(".")?d.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:b.decimal,places:a}},t=w("dijit.form.NumberTextBoxMixin",null,{pattern:function(a){return"("+(this.focused&&this.editOptions?this._regExpGenerator(l.delegate(a,this.editOptions))+"|":"")+this._regExpGenerator(a)+")"},value:NaN,
editOptions:{pattern:"#.######"},_formatter:d.format,_regExpGenerator:d.regexp,_decimalInfo:q(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(a){var b="number"==typeof a.places?a.places:0;b&&b++;"number"!=typeof a.max&&(a.max=9*Math.pow(10,15-b));"number"!=typeof a.min&&(a.min=-9*Math.pow(10,15-b));this.inherited(arguments,[a]);this.focusNode&&this.focusNode.value&&!isNaN(this.value)&&this.set("value",this.value);this._decimalInfo=
q(a)},_onFocus:function(){if(!this.disabled&&!this.readOnly){var a=this.get("value");"number"!=typeof a||isNaN(a)||(a=this.format(a,this.constraints),void 0!==a&&(this.textbox.value=a));this.inherited(arguments)}},format:function(a,b){var d=String(a);if("number"!=typeof a)return d;if(isNaN(a))return"";if(!("rangeCheck"in this&&this.rangeCheck(a,b))&&!1!==b.exponent&&/\de[-+]?\d/i.test(d))return d;this.editOptions&&this.focused&&(b=l.mixin({},b,this.editOptions));return this._formatter(a,b)},_parser:d.parse,
parse:function(a,b){var d=l.mixin({},b,this.editOptions&&this.focused?this.editOptions:{});if(this.focused&&null!=d.places){var f=d.places,f="number"===typeof f?f:Number(f.split(",").pop());d.places="0,"+f}d=this._parser(a,d);this.editOptions&&this.focused&&isNaN(d)&&(d=this._parser(a,b));return d},_getDisplayedValueAttr:function(){var a=this.inherited(arguments);return isNaN(a)?this.textbox.value:a},filter:function(a){if(null==a||"string"==typeof a&&""==a)return NaN;"number"!=typeof a||isNaN(a)||
0==a||(a=d.round(a,this._decimalInfo.places));return this.inherited(arguments,[a])},serialize:function(a,b){return"number"!=typeof a||isNaN(a)?"":this.inherited(arguments)},_setBlurValue:function(){var a=l.hitch(l.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(a,!0)},_setValueAttr:function(a,b,d){if(void 0!==a&&void 0===d)if(d=String(a),"number"==typeof a)if(isNaN(a))d="";else{if("rangeCheck"in this&&this.rangeCheck(a,this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(d))d=
void 0}else a?a=void 0:(d="",a=NaN);this.inherited(arguments,[a,b,d])},_getValueAttr:function(){var a=this.inherited(arguments);if(isNaN(a)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+d._realNumberRegexp(l.delegate(this.constraints))+"$")).test(this.textbox.value))return a=Number(this.textbox.value),isNaN(a)?void 0:a}else return a},isValid:function(a){if(!this.focused||this._isEmpty(this.textbox.value))return this.inherited(arguments);
var b=this.get("value");return!isNaN(b)&&this.rangeCheck(b,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var b="number"==typeof this.constraints.min,d="number"==typeof this.constraints.max,f=this.get("value");if(isNaN(f)||!b&&!d)return this.inherited(arguments);var l=f|0,q=0>f,t=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),r=(this.maxLength||20)-this.textbox.value.length,u=t?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,
""):"",l=t?l+"."+u:l+"",r=a.rep("9",r),t=f;q?t=Number(l+r):f=Number(l+r);return!(b&&f<this.constraints.min||d&&t>this.constraints.max)}});w=w("dijit.form.NumberTextBox",[b,t],{baseClass:"dijitTextBox dijitNumberTextBox"});w.Mixin=t;return w})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(w,l,f,a,d,b,q,t,m,k,p){var x=m("dijit.ColorPalette",[f,a,d],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:l,baseClass:"dijitColorPalette",_dyeFactory:function(a,b,d,f){return new this._dyeClass(a,
b,d,f)},buildRendering:function(){this.inherited(arguments);this._dyeClass=m(x._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],q.getLocalization("dojo","colors",this.lang))}});x._Color=m("dijit._Color",t,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":w.toUrl("./themes/a11y/colors7x10.png"),"3x4":w.toUrl("./themes/a11y/colors3x4.png")},constructor:function(a,b,d,f){this._title=f;this._row=b;this._col=d;this.setColor(t.named[a])},getValue:function(){return this.toHex()},fillCell:function(a,d){d=p.substitute(b("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:d,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});k.place(d,a)}});return x})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(w,l,f,a,d,b,q,t,m,k,p){return w("dijit._PaletteMixin",t,{defaultTimeout:500,timeoutChangeRate:.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(a){return new ("string"==
typeof this.dyeClass?b.getObject(this.dyeClass):this.dyeClass)(a)},_preparePalette:function(f,k){this._cells=[];var l=this._blankGif;this.own(q(this.gridNode,m,b.hitch(this,"_onCellClick")));for(var r=0;r<f.length;r++)for(var t=a.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),w=0;w<f[r].length;w++){var x=f[r][w];if(x){var c=this._dyeFactory(x,r,w,k[x]),x=a.create("td",{"class":this.cellClass,tabIndex:"-1",title:k[x],role:"gridcell"},t);c.fillCell(x,l);x.idx=this._cells.length;this._cells.push({node:x,
dye:c})}}this._xDim=f[0].length;this._yDim=f.length;var z={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},B;for(B in z)this.own(p.addKeyListener(this.domNode,{keyCode:d[B],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var a=z[B];return function(b){this._navigateByKey(a,b)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){k.focus(this._currentFocus)},
_onCellClick:function(a){for(var b=a.target;"TD"!=b.tagName;){if(!b.parentNode||b==this.gridNode)return;b=b.parentNode}var d=this._getDye(b).getValue();this._setCurrent(b);k.focus(b);this._setValueAttr(d,!0);a.stopPropagation();a.preventDefault()},_setCurrent:function(a){"_currentFocus"in this&&l.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=a)&&l.set(a,"tabIndex",this.tabIndex)},_setValueAttr:function(a,b){0<=this._selectedCell&&f.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(a)for(var d=0;d<this._cells.length;d++)if(a==this._cells[d].dye.getValue()){this._selectedCell=d;f.add(this._cells[d].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?a:null);if(b||void 0===b)this.onChange(a)},onChange:function(){},_navigateByKey:function(a,d){-1!=d&&(a=this._currentFocus.idx+a,a<this._cells.length&&-1<a&&(a=this._cells[a].node,this._setCurrent(a),this.defer(b.hitch(k,"focus",a))))},_getDye:function(a){return this._cells[a.idx].dye}})})},
"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c,D,B){var I=l("dijit.form._SliderMover",p,{onMouseMove:function(a){var b=
this.widget,c=b._abspos;c||(c=b._abspos=d.position(b.sliderBarContainer,!0),b._setPixelValue_=t.hitch(b,"_setPixelValue"),b._isReversed_=b._isReversed());a=a[b._mousePixelCoord]-c[b._startingPixelCoord];b._setPixelValue_(b._isReversed_?c[b._pixelCount]-a:a,c[b._pixelCount],!1)},destroy:function(a){p.prototype.destroy.apply(this,arguments);var b=this.widget;b._abspos=null;b._setValueAttr(b.value,!0)}});f=l("dijit.form.HorizontalSlider",[c,D],{templateString:B,value:0,showButtons:!0,minimum:0,maximum:100,
discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:r.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",_onKeyUp:function(a){this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey||this._setValueAttr(this.value,
!0)},_onKeyDown:function(a){if(!(this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey)){switch(a.keyCode){case q.HOME:this._setValueAttr(this.minimum,!1);break;case q.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?q.RIGHT_ARROW:q.LEFT_ARROW:case !1===this._descending?q.DOWN_ARROW:q.UP_ARROW:case !1===this._descending?q.PAGE_DOWN:q.PAGE_UP:this.increment(a);break;case this._descending||this.isLeftToRight()?q.LEFT_ARROW:q.RIGHT_ARROW:case !1===this._descending?
q.UP_ARROW:q.DOWN_ARROW:case !1===this._descending?q.PAGE_UP:q.PAGE_DOWN:this.decrement(a);break;default:return}a.stopPropagation();a.preventDefault()}},_onHandleClick:function(a){this.disabled||this.readOnly||(m("ie")||u.focus(this.sliderHandle),a.stopPropagation(),a.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(a){if(!this.disabled&&!this.readOnly&&this.clickSelect){u.focus(this.sliderHandle);a.stopPropagation();a.preventDefault();var b=d.position(this.sliderBarContainer,
!0),c=a[this._mousePixelCoord]-b[this._startingPixelCoord];this._setPixelValue(this._isReversed()?b[this._pixelCount]-c:c,b[this._pixelCount],!0);this._movable.onMouseDown(a)}},_setPixelValue:function(a,b,c){if(!this.disabled&&!this.readOnly){var d=this.discreteValues;if(1>=d||Infinity==d)d=b;d--;this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*Math.round(a/(b/d))/d+this.minimum,this.maximum),this.minimum),c)}},_setValueAttr:function(b,c){this._set("value",b);this.valueNode.value=
b;this.focusNode.setAttribute("aria-valuenow",b);this.inherited(arguments);var d=this.maximum>this.minimum?(b-this.minimum)/(this.maximum-this.minimum):0,f=!1===this._descending?this.remainingBar:this.progressBar,k=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(c&&0<this.slideDuration&&f.style[this._progressPixelSize]){var l=this,m={},p=parseFloat(f.style[this._progressPixelSize]),q=this.slideDuration*
(d-p/100);0!=q&&(0>q&&(q=0-q),m[this._progressPixelSize]={start:p,end:100*d,units:"%"},this._inProgressAnim=a.animateProperty({node:f,duration:q,onAnimate:function(a){k.style[l._progressPixelSize]=100-parseFloat(a[l._progressPixelSize])+"%"},onEnd:function(){delete l._inProgressAnim},properties:m}),this._inProgressAnim.play())}else f.style[this._progressPixelSize]=100*d+"%",k.style[this._progressPixelSize]=100*(1-d)+"%"},_bumpValue:function(a,c){if(!(this.disabled||this.readOnly||this.maximum<=this.minimum)){var f=
b.getComputedStyle(this.sliderBarContainer),k=d.getContentBox(this.sliderBarContainer,f),f=this.discreteValues;if(1>=f||Infinity==f)f=k[this._pixelCount];f--;a=Math.round((this.value-this.minimum)*f/(this.maximum-this.minimum))+a;0>a&&(a=0);a>f&&(a=f);a=a*(this.maximum-this.minimum)/f+this.minimum;this._setValueAttr(a,c)}},_onClkBumper:function(a){this.disabled||this.readOnly||!this.clickSelect||this._setValueAttr(a,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===this._descending?this.minimum:
this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(a){this._bumpValue(a.keyCode==q.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(a){this._bumpValue(a.keyCode==q.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(a){this.focused&&(a.stopPropagation(),a.preventDefault(),this._bumpValue(0>a.wheelDelta?-1:1,!0))},startup:function(){this._started||(w.forEach(this.getChildren(),function(a){this[a.container]!=this.containerNode&&
this[a.container].appendChild(a.domNode)},this),this.inherited(arguments))},_typematicCallback:function(a,b,c){if(-1==a)this._setValueAttr(this.value,!0);else this[b==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](c)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display="");var a=x('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+"_label"),this.focusNode.setAttribute("aria-labelledby",
a[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(C.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),C.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(v(this.domNode,z.wheel,t.hitch(this,"_mouseWheeled")));var a=l(I,{widget:this});this._movable=new k(this.sliderHandle,{mover:a});this._layoutHackIE7()},
destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});f._Mover=I;return f})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(w,l,f){return w("dijit.form.HorizontalRule",[l,f],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',
_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(a){return this._positionPrefix+a+this._positionSuffix+this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);var a;if(1==this.count)a=this._genHTML(50,0);else{var d,b=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){a=this._genHTML(0,0);for(d=1;d<this.count-1;d++)a+=this._genHTML(b*d,d);a+=this._genHTML(100,this.count-1)}else{a=this._genHTML(100,0);for(d=1;d<this.count-1;d++)a+=
this._genHTML(100-b*d,d);a+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=a}})})},"dojo/_base/query":function(){define(["../query","./NodeList"],function(w){return w})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(w,l,f,a,d,b,q,t,m){a("dijit-legacy-requires")&&b(0,function(){w(["dijit/form/RadioButton"])});
return l("dijit.form.CheckBox",[q,t],{templateString:m,baseClass:"dijitCheckBox",_setValueAttr:function(a,b){"string"==typeof a&&(this.inherited(arguments),a=!0);this._created&&this.set("checked",a,b)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&d("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");
this.inherited(arguments)},_onBlur:function(){this.id&&d("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");this.inherited(arguments)}})})},"dijit/form/ToggleButton":function(){define(["dojo/_base/declare","dojo/_base/kernel","./Button","./_ToggleButtonMixin"],function(w,l,f,a){return w("dijit.form.ToggleButton",[f,a],{baseClass:"dijitToggleButton",setChecked:function(a){l.deprecated("setChecked("+a+") is deprecated. Use set('checked',"+a+") instead.","","2.0");this.set("checked",a)}})})},
"dijit/form/_ToggleButtonMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(w,l){return w("dijit.form._ToggleButtonMixin",null,{checked:!1,_aria_attr:"aria-pressed",_onClick:function(f){var a=this.checked;this._set("checked",!a);var d=this.inherited(arguments);this.set("checked",d?this.checked:a);return d},_setCheckedAttr:function(f,a){this._set("checked",f);var d=this.focusNode||this.domNode;this._created&&l.get(d,"checked")!=!!f&&l.set(d,"checked",!!f);d.setAttribute(this._aria_attr,
String(f));this._handleOnChange(f,a)},postCreate:function(){this.inherited(arguments);var f=this.focusNode||this.domNode;this.checked&&f.setAttribute("checked","checked");void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.checked)},reset:function(){this._hasBeenBlurred=!1;this.set("checked",this.params.checked||!1)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(w,l){return w("dijit.form._CheckBoxMixin",null,{type:"checkbox",
value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(f){this._set("readOnly",f);l.set(this.focusNode,"readOnly",f)},_setLabelAttr:void 0,_getSubmitValue:function(f){return null==f||""===f?"on":f},_setValueAttr:function(f){f=this._getSubmitValue(f);this._set("value",f);l.set(this.focusNode,"value",f)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));l.set(this.focusNode,"value",this.value)},_onClick:function(f){return this.readOnly?
(f.stopPropagation(),f.preventDefault(),!1):this.inherited(arguments)}})})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox","./ComboBoxMixin"],function(w,l,f){return w("dijit.form.ComboBox",[l,f],{})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),function(w,l,f,
a,d,b,q,t,m){return w("dijit.form.ComboBoxMixin",[t,b],{dropDownClass:q,hasDownArrow:!0,templateString:m,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(a){this._set("hasDownArrow",a);this._buttonNode.style.display=a?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(b){b.get||a.mixin(b,{_oldAPI:!0,get:function(a){var b=new l;this.fetchItemByIdentity({identity:a,onItem:function(a){b.resolve(a)},
onError:function(a){b.reject(a)}});return b.promise},query:function(b,f){var k=new l(function(){m.abort&&m.abort()});k.total=new l;var m=this.fetch(a.mixin({query:b,onBegin:function(a){k.total.resolve(a)},onComplete:function(a){k.resolve(a)},onError:function(a){k.reject(a)}},f));return d(k)}});this._set("store",b)},postMixInProperties:function(){var b=this.params.store||this.store;b&&this._setStoreAttr(b);this.inherited(arguments);if(!this.params.store&&this.store&&!this.store._oldAPI){var d=this.declaredClass;
a.mixin(this.store,{getValue:function(a,b){f.deprecated(d+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return a[b]},getLabel:function(a){f.deprecated(d+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return a.name},fetch:function(b){f.deprecated(d+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],a.hitch(this,function(a){(new a({objectStore:this})).fetch(b)}))}})}},
buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(w,l,f,a,d,b,q,t,m,k,p){l=l("dijit.form._AutoCompleterMixin",p,{item:null,autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",
maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(a){var b=0;if("number"==typeof a.selectionStart)b=a.selectionStart;else if(t("ie")){var d=a.ownerDocument.selection.createRange().duplicate();a=a.createTextRange();d.move("character",0);a.move("character",0);try{a.setEndPoint("EndToEnd",d),b=String(a.text).replace(/\r/g,"").length}catch(r){}}return b},_setCaretPos:function(a,b){b=parseInt(b);k.selectInputText(a,b,b)},_setDisabledAttr:function(a){this.inherited(arguments);this.domNode.setAttribute("aria-disabled",
a?"true":"false")},_onKey:function(b){if(!(32<=b.charCode)){var d=b.charCode||b.keyCode;if(d!=a.ALT&&d!=a.CTRL&&d!=a.META&&d!=a.SHIFT){var f=this.dropDown,k=null;this._abortQuery();this.inherited(arguments);if(!(b.altKey||b.ctrlKey||b.metaKey))switch(this._opened&&(k=f.getHighlightedOption()),d){case a.PAGE_DOWN:case a.DOWN_ARROW:case a.PAGE_UP:case a.UP_ARROW:this._opened&&this._announceOption(k);b.stopPropagation();b.preventDefault();break;case a.ENTER:if(k){if(k==f.nextButton){this._nextSearch(1);
b.stopPropagation();b.preventDefault();break}else if(k==f.previousButton){this._nextSearch(-1);b.stopPropagation();b.preventDefault();break}b.stopPropagation();b.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case a.TAB:d=this.get("displayedValue");if(f&&(d==f._messages.previousMessage||d==f._messages.nextMessage))break;k&&this._selectOption(k);case a.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},_autoCompleteText:function(a){var b=
this.focusNode;k.selectInputText(b,b.value.length);var d=this.ignoreCase?"toLowerCase":"substr";0==a[d](0).indexOf(this.focusNode.value[d](0))?(d=this.autoComplete?this._getCaretPos(b):b.value.length,d+1>b.value.length&&(b.value=a,k.selectInputText(b,d))):(b.value=a,k.selectInputText(b))},_openResultList:function(a,b,f){var k=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();a.length||0!=f.start?(this._nextSearch=this.dropDown.onPage=d.hitch(this,function(b){a.nextPage(-1!==b);
this.focus()}),this.dropDown.createOptions(a,f,d.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in f?(f.direction?this.dropDown.highlightFirstOption():f.direction||this.dropDown.highlightLastOption(),k&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(b[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)):this.closeDropDown()},_showResultList:function(){this.closeDropDown(!0);
this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var a=this.get("displayedValue"),b=this.dropDown;!b||a!=b._messages.previousMessage&&a!=b._messages.nextMessage?"undefined"==typeof this.item?(this.item=null,this.set("displayedValue",a)):(this.value!=
this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(a,b,d){var f="";a&&(d||(d=this.store._oldAPI?this.store.getValue(a,this.searchAttr):a[this.searchAttr]),f=this._getValueField()!=this.searchAttr?this.store.getIdentity(a):d);this.set("value",f,b,d,a)},_announceOption:function(a){if(a){var b;if(a==this.dropDown.nextButton||a==this.dropDown.previousButton)b=
a.innerHTML,this.item=void 0,this.value="";else{var d=this.dropDown.items[a.getAttribute("item")];b=(this.store._oldAPI?this.store.getValue(d,this.searchAttr):d[this.searchAttr]).toString();this.set("item",d,!1,b)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",f.get(a,"id"));this._autoCompleteText(b)}},_selectOption:function(a){this.closeDropDown();a&&this._announceOption(a);this._setCaretPos(this.focusNode,this.focusNode.value.length);
this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(a){if(!this.dropDown){var b=this.id+"_popup";this.dropDown=new (d.isString(this.dropDownClass)?d.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:d.hitch(this,this._selectOption),id:b,dir:this.dir,textDir:this.textDir})}this._lastInput=a;this.inherited(arguments)},
_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new m({},this.srcNodeRef),!("value"in this.params))){var a=this.item=this.store.fetchSelectedItem();if(a){var b=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(a,b):a[b]}}},postCreate:function(){var a=b('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",
a[0].id));this.inherited(arguments);w.after(this,"onSearch",d.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(a){a=this.labelFunc(a,this.store);var b=this.labelType;"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(a=this.doHighlight(a,this._lastInput),b="html");return{html:"html"==b,label:a}},doHighlight:function(a,b){var d=(this.ignoreCase?"i":"")+("all"==this.highlightMatch?"g":""),f=this.queryExpr.indexOf("${0}");b=q.escapeString(b);return this._escapeHtml(a.replace(new RegExp((0==
f?"^":"")+"("+b+")"+(f==this.queryExpr.length-4?"$":""),d),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(a){return a=String(a).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},labelFunc:function(a,b){return(b._oldAPI?b.getValue(a,this.labelAttr||this.searchAttr):a[this.labelAttr||this.searchAttr]).toString()},
_setValueAttr:function(a,b,d,f){this._set("item",f||null);null==a&&(a="");this.inherited(arguments)}});t("dojo-bidi")&&l.extend({_setTextDirAttr:function(a){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",a)}});return l})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),function(w,l,f,a,d,b){function q(a){return{id:a.value,value:a.value,name:f.trim(a.innerText||a.textContent||"")}}return w("dijit.form.DataList",
d,{constructor:function(d,m){this.domNode=l.byId(m);f.mixin(this,d);this.id&&b.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:a("option",this.domNode).map(q)}])},destroy:function(){b.remove(this.id)},fetchSelectedItem:function(){var b=a("\x3e option[selected]",this.domNode)[0]||a("\x3e option",this.domNode)[0];return b&&q(b)}})})},"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),
function(w,l,f,a,d,b,q){return w("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(a){this._set("list",a)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(a){return new RegExp("^"+a.replace(/(\\.)|(\*)|(\?)|\W/g,function(a,b,d,f){return d?".*":f?".":b?b:"\\"+a})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&
(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(a){if(!this.disabled&&!this.readOnly){a=a.charOrCode;this._prev_key_backspace=!1;if(a==l.DELETE||a==l.BACKSPACE)this._maskValidSubsetError=this._prev_key_backspace=!0;if(this.store)this.searchTimer=
this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(a){this._abortQuery();var l=this,k=f.clone(this.query),p={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},q=d.substitute(this.queryExpr,[a.replace(/([\\\*\?])/g,"\\$1")]),t,v=function(){var a=l._fetchHandle=l.store.query(k,p);l.disabled||l.readOnly||t!==l._lastQuery||b(a,function(d){l._fetchHandle=
null;l.disabled||l.readOnly||t!==l._lastQuery||b(a.total,function(a){d.total=a;var b=l.pageSize;if(isNaN(b)||b>d.total)b=d.total;d.nextPage=function(a){p.direction=a=!1!==a;p.count=b;a?(p.start+=d.length,p.start>=d.total&&(p.count=0)):(p.start-=b,0>p.start&&(p.count=Math.max(b+p.start,0),p.start=0));0>=p.count?(d.length=0,l.onSearch(d,k,p)):v()};l.onSearch(d,k,p)})},function(a){l._fetchHandle=null;l._cancelingQuery||console.error(l.declaredClass+" "+a.toString())})};f.mixin(p,this.fetchProperties);
this.store._oldAPI?t=q:(t=this._patternToRegExp(q),t.toString=function(){return q});this._lastQuery=k[this.searchAttr]=t;this._queryDeferHandle=this.defer(v,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var a=this.list;a&&(this.store=q.byId(a))}this.inherited(arguments)}})})},"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),
function(w,l,f,a,d,b,q,t){return w("dijit.form._ComboBoxMenu",[d,b,t,q],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(l.add(this.previousButton,"dijitMenuItemRtl"),l.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var a=this.ownerDocument.createElement("div");a.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");a.setAttribute("role","option");return a},onHover:function(a){l.add(a,"dijitMenuItemHover")},onUnhover:function(a){l.remove(a,
"dijitMenuItemHover")},onSelect:function(a){l.add(a,"dijitMenuItemSelected")},onDeselect:function(a){l.remove(a,"dijitMenuItemSelected")},_page:function(a){var b=0,d=this.domNode.scrollTop,l=f.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();b<l;){var m=this.getHighlightedOption();if(a){if(!m.previousSibling||"none"==m.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!m.nextSibling||"none"==m.nextSibling.style.display)break;this.selectNextNode()}m=
this.domNode.scrollTop;b+=(m-d)*(a?-1:1);d=m}},handleKey:function(b){switch(b.keyCode){case a.DOWN_ARROW:return this.selectNextNode(),!1;case a.PAGE_DOWN:return this._page(!1),!1;case a.UP_ARROW:return this.selectPreviousNode(),!1;case a.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(w,l,f,a,d){var b=l("dijit.form._ComboBoxMenuMixin"+
(a("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=d.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(a){this._set("value",a);this.onChange(a)},onClick:function(a){if(a==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(a==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(a)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(a,b){var d=this._createMenuItem();a=b(a);a.html?d.innerHTML=a.label:d.appendChild(d.ownerDocument.createTextNode(a.label));""==d.innerHTML&&(d.innerHTML="\x26#160;");return d},createOptions:function(a,b,d){this.items=a;this.previousButton.style.display=0==b.start?"none":"";f.set(this.previousButton,"id",this.id+
"_prev");w.forEach(a,function(a,b){a=this._createOption(a,d);a.setAttribute("item",b);f.set(a,"id",this.id+b);this.nextButton.parentNode.insertBefore(a,this.nextButton)},this);var k=!1;a.total&&!a.total.then&&-1!=a.total?b.start+b.count<a.total?k=!0:b.start+b.count>a.total&&b.count==a.length&&(k=!0):b.count==a.length&&(k=!0);this.nextButton.style.display=k?"":"none";f.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var a=this.containerNode;2<a.childNodes.length;)a.removeChild(a.childNodes[a.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});a("dojo-bidi")&&(b=l("dijit.form._ComboBoxMenuMixin",
b,{_createOption:function(){var a=this.inherited(arguments);this.applyTextDir(a);return a}}));return b})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(w,l,f,a){return w("dijit.form._ListMouseMixin",a,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(a,b){this._setSelectedAttr(b,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(b)})},_onMouseDown:function(a,b){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(b,!1)},_onMouseUp:function(a,b){this._isDragging=!1;var d=this.selected,f=this._hoveredNode;d&&b==d?this.defer(function(){this._onClick(a,
d)}):f&&this.defer(function(){this._onClick(a,f)})},_onMouseOut:function(a,b){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(a,b){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=b;this.onHover(b);this._isDragging&&this._setSelectedAttr(b,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(w,l,f){return w("dijit.form._ListBase",null,{selected:null,_listConnect:function(a,d){var b=this;return b.own(l(b.containerNode,l.selector(function(a,b,d){return a.parentNode==d},a),function(a){b[d](a,this)}))},selectFirstNode:function(){for(var a=this.containerNode.firstChild;a&&"none"==a.style.display;)a=a.nextSibling;this._setSelectedAttr(a,!0)},selectLastNode:function(){for(var a=this.containerNode.lastChild;a&&"none"==a.style.display;)a=a.previousSibling;this._setSelectedAttr(a,
!0)},selectNextNode:function(){var a=this.selected;if(a){for(a=a.nextSibling;a&&"none"==a.style.display;)a=a.nextSibling;a?this._setSelectedAttr(a,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var a=this.selected;if(a){for(a=a.previousSibling;a&&"none"==a.style.display;)a=a.previousSibling;a?this._setSelectedAttr(a,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(a,d){if(this.selected!=a){var b=this.selected;if(b)this.onDeselect(b);
a&&(d&&f.scrollIntoView(a),this.onSelect(a));this._set("selected",a)}else if(a)this.onSelect(a)}})})},"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n        \x3cimg data-dojo-attach-point\x3d"loadingImg"/\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:esri/views/3d/environment/materials/SimpleAtmosphereMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsSimpleAtmosphere"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n\r\n#ifndef PANORAMIC\r\n\r\n  const float TWICEPI \x3d 2.0*3.14159265;\r\n  const float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\r\n\r\n  uniform vec3 silCircleCenter;\r\n  uniform vec3 silCircleV1;\r\n  uniform vec3 silCircleV2;\r\n  uniform vec2 texV;\r\n\r\n#endif\r\n\r\n  uniform vec3 lightDirection;\r\n\r\n  attribute vec3 $position;\r\n  varying vec2 vtc;\r\n  varying float falloff;\r\n\r\n  void main(void) {\r\n\r\n#ifdef PANORAMIC\r\n\r\n    vec3 pos \x3d $position;\r\n    float ndotl \x3d lightDirection.z;\r\n    vtc \x3d vec2(0, $position.z+0.05);\r\n\r\n#else\r\n\r\n    float phi \x3d $position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\r\n    vec3 pos \x3d (sin(phi) * silCircleV1 + cos(phi) * silCircleV2 + silCircleCenter) * $position.y;\r\n    float ndotl \x3d dot(normalize(pos), lightDirection);\r\n\r\n    vtc.x \x3d $position.x / ATMOSPHERE_RIM_SEGMENTS;\r\n    vtc.y \x3d texV.x * (1.0 - $position.z) + texV.y * $position.z;\r\n\r\n#endif\r\n\r\n    falloff \x3d max(0.0, (smoothstep(-1.0, 0.8, ndotl + ndotl)));\r\n\r\n    gl_Position \x3d proj * view * vec4(pos, 1.0);\r\n    gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsSimpleAtmosphere"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n  uniform vec4 color;\r\n  varying vec2 vtc;\r\n  varying float falloff;\r\n\r\n  void main() {\r\n    vec4 texColor \x3d texture2D(tex, vtc);\r\n    gl_FragColor \x3d texColor * color * falloff;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/environment/materials/RealisticAtmosphereMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3c!--Vertex Shader for Atmosphere--\x3e\r\n\x3csnippet name\x3d"vsRealisticAtmosphere"\x3e\x3c![CDATA[\r\n//\r\n// Based on Atmospheric scattering vertex shader by Sean O\'Neil from GPU Gems 2 Chapter 16.\r\n//\r\n// Link:                   http://http.developer.nvidia.com/GPUGems2/gpugems2_chapter16.html\r\n// Download Portal:        http://http.download.nvidia.com/developer/GPU_Gems_2/CD/Index.html\r\n// Unmodified Source Code: http://http.download.nvidia.com/developer/GPU_Gems_2/CD/Content/16.zip\r\n//\r\n// Adapted for WebGIS by Jascha Gr\u00fcbel (jgruebel@esri.com), Z\u00fcrich 2015\r\n//\r\n\r\n  $vsprecisionf\r\n\r\n  //Camera\r\n  uniform vec2 halfSizeNearPlane;\r\n  uniform vec3 v3CameraUp;\r\n  uniform vec3 v3CameraRight;\r\n  uniform vec3 v3CameraDir;\r\n  uniform vec2 v2CameraCenterOffset;\r\n\r\n  //Attributes\r\n  attribute vec3 $position;\r\n  attribute vec2 $uv0;\r\n\r\n  //Varyings\r\n  varying vec3 v3WorldRay;\r\n  varying vec2 vtc;\r\n\r\n#ifdef HAZE\r\n  varying vec3 v3EyeDir;\r\n#endif\r\n\r\n  void main(void) {\r\n    vec3 v3Pos \x3d $position;\r\n    vtc \x3d $uv0;\r\n    vec2 rayvtc \x3d $uv0 - v2CameraCenterOffset;\r\n\r\n#ifdef HAZE\r\n    v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\r\n#else\r\n    vec3 v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\r\n#endif\r\n    v3WorldRay \x3d v3EyeDir.z*v3CameraDir + v3EyeDir.y*v3CameraUp + v3EyeDir.x*v3CameraRight;\r\n    gl_Position \x3d vec4(v3Pos, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"atmosphereScaleFunction"\x3e\x3c![CDATA[\r\n  //Approximation for inner integral based on a radii ratio of 10.25:10\r\n  float scale(float fCos){\r\n    float x \x3d 1.0 - fCos;\r\n    return exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"toneMapperConstants"\x3e\x3c![CDATA[\r\n#ifdef HAZE\r\n  const float fOneOverGamma \x3d 1.0;//Gamma \x3d 1.0\r\n#else\r\n  const float fOneOverGamma \x3d 0.454545; // Gamma \x3d 2.2\r\n#endif\r\n  const vec3 v3OneOverGamma \x3d vec3(fOneOverGamma);\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"exponentialToneMapper"\x3e\x3c![CDATA[\r\n  //ToneMapping operators\r\n  vec3 expTM(vec3 inputColor,float exposure){\r\n      return pow(1.0 - exp(inputColor * -exposure), v3OneOverGamma);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"reinhardToneMapper"\x3e\x3c![CDATA[\r\n  vec3 reinhardTM(vec3 inputColor, float exposure){\r\n      vec3 intermediate \x3d inputColor *exposure;\r\n      intermediate /\x3d (1.0+intermediate);\r\n      return pow(intermediate, v3OneOverGamma);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"HSVColorSpace"\x3e\x3c![CDATA[\r\n//based on http://gamedev.stackexchange.com/a/59808\r\n// Hue in range [0,1] instead of 360\u00b0\r\nvec3 rgb2hsv(vec3 c)\r\n{\r\n    vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\r\n    vec4 p \x3d mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\r\n    vec4 q \x3d mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\r\n\r\n    float d \x3d q.x - min(q.w, q.y);\r\n    float e \x3d 1.0e-10;\r\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\r\n}\r\n\r\nvec3 hsv2rgb(vec3 c)\r\n{\r\n    vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\r\n    vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\r\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\r\n}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"atmosphereUniformsConstantsVaryings"\x3e\x3c![CDATA[\r\n\r\n  //Light\r\n  uniform vec3 v3LightDir;      // The direction vector to the light source\r\n  uniform vec3 v3InvWavelength; // 1 / pow(wavelength, 4) for the red, green, and blue channels\r\n  uniform vec3 v3InvWavelengthScaled; //v3InvWavelength * fKr4PI + fKm4PI\r\n\r\n  //Radii\r\n  uniform vec4 v4Radii; // inner, inner^2, outer, outer^2,\r\n\r\n  //Atmosphere\r\n  const float fKrESun \x3d 0.075;        // Kr * ESun \x3d 0.005 * 15.0\r\n  const float fKmESun \x3d 0.015;        // Km * ESun \x3d 0.005 * 15\r\n  //uniform float fScale;         // 1 / (fOuterRadius - fInnerRadius)\r\n  //uniform float fScaleDepth;    // The scale depth (i.e. the altitude at which the atmosphere\'s average density is found)\r\n  //uniform float fScaleOverScaleDepth; // fScale / fScaleDepth\r\n  //uniform float fOneOverScaleDepth; // 1.0 / fScaleDepth\r\n\r\n  //uniform float fScaleDepthBlue;    // The scale depth (i.e. the altitude at which the atmosphere\'s average density is found)\r\n  //uniform float fScaleOverScaleDepthBlue; // fScale / fScaleDepth\r\n  //uniform float fOneOverScaleDepthBlue; // 1.0 / fScaleDepth\r\n\r\n  uniform vec4 v4AtmosParams1; //(fScale,fScaleDepth,fScaleOverScaleDepth,fOneOverScaleDepth)\r\n  uniform vec4 v4AtmosParams2; //(g,fScaleDepthBlue,fScaleOverScaleDepthBlue,fOneOverScaleDepthBlue)\r\n#ifndef HAZE\r\n  uniform vec4 v4AtmosParams3; //(g2,fMiePhaseCoefficients,fLowerAlphaBlendBound,fOneOverOuterRadiusMinusAlphaBlendBound)\r\n#endif\r\n\r\n  //Camera\r\n  uniform vec3 v3CameraPos;     // The camera\'s current position\r\n  //uniform float fCameraHeight;  // The camera\'s current height\r\n  //uniform float fCameraHeight2; // fCameraHeight^2\r\n  //uniform float fC; //fCameraHeight2 - fOuterRadius2; // C \x3d ||o-c||^2 - r^2\r\n  //uniform float fCSur; //fCameraHeight2 - (fInnerRadius2 - 63756370000.0); // C \x3d ||o-c||^2 - r^2\r\n  uniform vec4 v4SphereComp; //The camera\'s current height, CameraHeight^2,fC,fCSur\r\n  uniform vec2 nearFar;\r\n\r\n  //Camera HDR\r\n#ifdef HAZE\r\n  const float fExposure \x3d 1.5;\r\n#else\r\n  const float fExposure \x3d 2.0;\r\n#endif\r\n\r\n#ifdef HAZE\r\n  //Depth texture\r\n  uniform sampler2D tDepth;\r\n#endif\r\n\r\n  //Testing variables\r\n  uniform float showTest;\r\n\r\n  //Varyings\r\n  varying vec3 v3EyeDir;\r\n  varying vec3 v3WorldRay;\r\n  varying vec2 vtc;\r\n\r\n  //Loop constants for integral approximation\r\n  const float fSamples \x3d 5.0;\r\n  const int maxSamples \x3d 5;\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmospherePrecomputation"\x3e\x3c![CDATA[\r\n    float fInnerRadius \x3d v4Radii[0];   // The inner (planetary) radius\r\n    float fInnerRadius2 \x3d v4Radii[1];  // fInnerRadius^2\r\n    float fOuterRadius \x3d v4Radii[2];   // The outer (atmosphere) radius\r\n    float fOuterRadius2 \x3d v4Radii[3];  // fOuterRadius^2\r\n\r\n    float fCameraHeight \x3d v4SphereComp[0];\r\n    float fCameraHeight2 \x3d v4SphereComp[1];\r\n    float fC \x3d v4SphereComp[2];\r\n    float fCSur \x3d v4SphereComp[3];\r\n\r\n#ifdef PLANAR\r\n    vec3 cameraPosition \x3d vec3(0.0,0.0,fCameraHeight);\r\n#else\r\n    vec3 cameraPosition \x3d v3CameraPos;\r\n#endif\r\n\r\n    //Debug variables\r\n    vec3 test \x3d vec3(0.0,0.0,0.0);\r\n\r\n    //Obtain ray from Camera\r\n    vec3 worldSpaceRay \x3d normalize(v3WorldRay);\r\n\r\n    //Compute Atmosphere intersection; i.e. ray/sphere intersection\r\n    float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay); // B \x3d 2(l * (o-c))\r\n    float det \x3d B*B - 4.0 * fC; // det \x3d B^2 - 4.0* C\r\n\r\n    //idealized sphere intersection to discard early some pixels\r\n    float detSur \x3d B*B - 4.0 * fCSur; // det \x3d B^2 - 4.0* C\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereDiscardPixels"\x3e\x3c![CDATA[\r\n      bool continueComputation \x3d true;\r\n#ifdef HAZE\r\n      // only use red channel from depth texture.\r\n      // see \'Issues\' at https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture\r\n      float depthSample \x3d texture2D(tDepth, vtc).r;\r\n\r\n      float zNear \x3d nearFar[0];\r\n      float zFar \x3d nearFar[1];\r\n\r\n      // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\r\n      float zNorm \x3d 2.0 * depthSample - 1.0;\r\n      float linDepth \x3d 2.0 * zNear * zFar /\r\n        (zFar + zNear - zNorm * (zFar - zNear));\r\n\r\n      float nearSurfaceT;\r\n      if (detSur\x3e0.0){\r\n        nearSurfaceT \x3d 0.5 *(-B - sqrt(detSur));\r\n      }\r\n\r\n      float rayEndT;\r\n\r\n      // find intersections with ground, but only between the near and far\r\n      // clipping planes.\r\n      if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\r\n        vec3 cameraSpaceRay \x3d normalize(v3EyeDir);\r\n        cameraSpaceRay /\x3d cameraSpaceRay.z;\r\n        cameraSpaceRay *\x3d linDepth;\r\n#ifndef PLANAR\r\n        if((fCameraHeight-fInnerRadius)\x3e8000000.0 \x26\x26 detSur\x3e0.0){\r\n          rayEndT \x3d nearSurfaceT;\r\n        } else  if ((fCameraHeight-fInnerRadius)\x3e2000000.0 \x26\x26 detSur\x3e0.0){\r\n          rayEndT \x3d mix(length(cameraSpaceRay),nearSurfaceT,((fCameraHeight-fInnerRadius)-2000000.0)/6000000.0);\r\n        } else {\r\n          rayEndT \x3d length(cameraSpaceRay);\r\n        }\r\n#else\r\n        rayEndT \x3d length(cameraSpaceRay);\r\n#endif\r\n      } else {\r\n        continueComputation \x3d false;\r\n      }\r\n#ifdef PLANAR\r\n      if (16500.0+ fInnerRadius \x3c fCameraHeight){\r\n        continueComputation \x3d false;\r\n      }\r\n#endif\r\n#else\r\n      if (detSur\x3e0.0){\r\n        float nearSurfaceT \x3d 0.5 *(-B - sqrt(detSur));\r\n        if (nearSurfaceT \x3e 0.0){\r\n          continueComputation \x3d false;\r\n        }\r\n      }\r\n#endif\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"atmosphereUnpackAddUniforms"\x3e\x3c![CDATA[\r\n        float fScale \x3d v4AtmosParams1.x;\r\n        vec2 v2ScaleDepth \x3d vec2(v4AtmosParams1.y,v4AtmosParams2.y);//fScaleDepth, fScaleDepthBlue\r\n        vec2 v2ScaleOverScaleDepth \x3d vec2(v4AtmosParams1.z,v4AtmosParams2.z);//fScaleOverScaleDepth, fScaleOverScaleDepthBlue\r\n        vec2 v2OneOverScaleDepth \x3d vec2(v4AtmosParams1.w,v4AtmosParams2.w);//fOneOverScaleDepth, fOneOverScaleDepthBlue\r\n\r\n#ifndef HAZE\r\n        float g \x3d v4AtmosParams2.x;\r\n        float g2 \x3d v4AtmosParams3.x;\r\n        float fMiePhaseCoefficients \x3d v4AtmosParams3.y;\r\n        float fLowerAlphaBlendBound \x3d v4AtmosParams3.z;\r\n        float fOneOverOuterRadiusMinusAlphaBlendBound \x3d v4AtmosParams3.w;\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereComputeRayAndLoopSetup"\x3e\x3c![CDATA[\r\n        float rayStartT \x3d 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\r\n#ifdef HAZE\r\n        float nearT \x3d abs(rayStartT);\r\n        float farT \x3d abs(rayEndT);\r\n#else\r\n        float rayEndT \x3d 0.5 *(-B + sqrt(det)); //far intersection with atmosphere\r\n\r\n#endif\r\n\r\n        float fDistance;//calculate its scattering offset\r\n        // Calculate the ray\'s starting position\r\n        if (rayStartT \x3c 0.0)\r\n        { //ray starts from camera to far\r\n          rayStartT \x3d 0.0;\r\n#ifndef HAZE\r\n          fDistance \x3d fScale*(fInnerRadius - fCameraHeight);\r\n#endif\r\n        }\r\n#ifndef HAZE\r\n        else\r\n        {//outside atmosphere\r\n          fDistance \x3d -1.0;\r\n        }\r\n#endif\r\n\r\n        // Initialize the scattering loop variables\r\n        vec3 v3Start \x3d cameraPosition + worldSpaceRay * rayStartT;\r\n\r\n#ifdef HAZE\r\n        vec3 v3End \x3d cameraPosition + worldSpaceRay * rayEndT;\r\n\r\n        float fEndLength \x3d length(v3End);\r\n        float fLocalCameraHeight \x3d length(v3Start);\r\n\r\n        //computed for the original end point to get consistent light angles after possible inversions\r\n        float fLightAngle \x3d dot(v3LightDir, v3End) / fEndLength;\r\n\r\n        if (nearT \x3e farT)\r\n        {\r\n          if (fLocalCameraHeight \x3c fEndLength)\r\n          {\r\n            //Switch positive slopes for flipped rays\r\n            v3End \x3d cameraPosition + worldSpaceRay * rayStartT;\r\n            v3Start \x3d cameraPosition + worldSpaceRay * rayEndT;\r\n            worldSpaceRay *\x3d -1.0;\r\n            fEndLength \x3d length(v3End);\r\n            fLocalCameraHeight \x3d length(v3Start);\r\n          }\r\n          else if (fLocalCameraHeight \x3d\x3d fEndLength)\r\n          {// create minuscule fake slope for integration if the slope is zero\r\n            fLocalCameraHeight +\x3d 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\r\n            //slope for the camera function\r\n          }\r\n        }\r\n\r\n        //Calculate its scattering offset\r\n        // Assumes camera constrains of WSV 3.8\r\n        float fCameraDepth;\r\n        float fCameraDepthBlue;\r\n        if (fLocalCameraHeight \x3e fOuterRadius)\r\n        {\r\n          fDistance \x3d fInnerRadius - fOuterRadius;\r\n        } else\r\n        {//outside atmosphere\r\n          fDistance \x3d fEndLength - fLocalCameraHeight;\r\n        }\r\n\r\n#endif\r\n        vec2 v2OpticalStartDepth \x3d exp(fDistance * v2OneOverScaleDepth);\r\n\r\n        float fRayLength \x3d rayEndT - rayStartT;\r\n        float fSampleLength \x3d fRayLength / fSamples;\r\n        float fScaledLength \x3d fSampleLength * fScale;\r\n        vec3 v3SampleRay \x3d worldSpaceRay * fSampleLength;\r\n        vec3 v3SamplePoint \x3d v3Start + v3SampleRay * 0.5;\r\n\r\n#ifdef HAZE\r\n        float fCameraAngle \x3d dot(-worldSpaceRay, v3End) / fEndLength;\r\n        float fScaleCameraAngle \x3d scale(fCameraAngle);\r\n        vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth;\r\n\r\n        float scaledValues \x3d scale(fLightAngle) + fScaleCameraAngle;\r\n        vec2 v2ScaledValuesDepth \x3d scaledValues * v2ScaleDepth;\r\n#else\r\n        float fCameraAngle \x3d dot(worldSpaceRay, v3Start / length(v3Start));\r\n        float angleMultiplier \x3d fCameraAngle\x3e0.0?fCameraAngle:0.0;\r\n\r\n        float fScaleCameraAngle \x3d scale(fCameraAngle);\r\n        vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth * v2ScaleDepth;\r\n#endif\r\n\r\n        //Loop variables\r\n        vec3 v3FrontColor \x3d vec3(0.0, 0.0, 0.0);\r\n        vec3 v3FrontColorBlue \x3d vec3(0.0, 0.0, 0.0);\r\n        vec3 v3Attenuate\x3d vec3(0.0, 0.0, 0.0);\r\n        vec3 v3AttenuateBlue \x3d vec3(0.0, 0.0, 0.0);\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereComputeSampleContribution"\x3e\x3c![CDATA[\r\n          float fHeight \x3d length(v3SamplePoint);\r\n          vec2 v2Depth \x3d exp(v2ScaleOverScaleDepth * (fInnerRadius - fHeight));\r\n#ifdef HAZE\r\n          vec2 v2Scatter \x3d v2Depth*v2ScaledValuesDepth-v2CameraOffset;\r\n#else\r\n          float fLightAngle \x3d dot(v3LightDir, v3SamplePoint) / fHeight;\r\n          float fCameraAngle \x3d dot(worldSpaceRay, v3SamplePoint) / fHeight;\r\n          float fTempScaledValues \x3d scale(fLightAngle) - scale(fCameraAngle);\r\n          vec2 v2Scatter \x3d v2CameraOffset + fTempScaledValues*v2Depth* v2ScaleDepth;\r\n#endif\r\n          v3Attenuate \x3d exp(-v2Scatter.x * v3InvWavelengthScaled);\r\n          v3AttenuateBlue \x3d exp(-v2Scatter.y * v3InvWavelengthScaled);\r\n\r\n          v3FrontColor +\x3d v3Attenuate * v2Depth.x;\r\n          v3FrontColorBlue +\x3d v3AttenuateBlue * v2Depth.y;\r\n\r\n          v3SamplePoint +\x3d v3SampleRay;\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereComputeHDRColors"\x3e\x3c![CDATA[\r\n        //Phase computation\r\n        //clamp to avoid numerical instability at fCos \x3d\x3d -1.0 (and close values) to display fake sun\r\n        float fCos \x3d clamp(dot(v3LightDir, -worldSpaceRay ),-0.9999999,1.0);\r\n        float fOnePlusCos2 \x3d fCos*fCos + 1.0;\r\n#ifdef HAZE\r\n        // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\r\n        vec3 colorCoefficients \x3d (fScaledLength* 0.75 * fOnePlusCos2)*(fKrESun*v3InvWavelength+fKmESun);\r\n\r\n        //Scaled Length is only applied afterwards to save multiplications\r\n        vec3 v3Color \x3d colorCoefficients *v3FrontColor;\r\n        vec3 v3ColorBlue \x3d colorCoefficients *v3FrontColorBlue;\r\n#else\r\n        vec3 v3RayleighCoefficients \x3d (fScaledLength*0.75 * fOnePlusCos2*fKrESun)*v3InvWavelength;\r\n        float fMieCoefficients \x3d fScaledLength*fKmESun * fMiePhaseCoefficients * fOnePlusCos2 / pow(1.0 + g2 - 2.0*g*fCos, 1.5);\r\n\r\n        // Calculate the attenuation factor for the ground\r\n        vec3 v3Color \x3d v3RayleighCoefficients * v3FrontColor + fMieCoefficients * v3FrontColor;\r\n        vec3 v3ColorBlue \x3d v3RayleighCoefficients * v3FrontColorBlue + fMieCoefficients * v3FrontColorBlue;\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"atmosphereComputePixelColor"\x3e\x3c![CDATA[\r\n\r\n\r\n        //HDR to LDR conversion\r\n        vec3 ldrBlue \x3d expTM(v3ColorBlue,2.0*fExposure);\r\n        vec3 ldrRed \x3d expTM(v3Color,fExposure);\r\n\r\n        //mix reddish and blueish atmosphere\r\n        vec3 LDR \x3d mix(ldrBlue,ldrRed,0.2);\r\n#ifdef HAZE\r\n        LDR *\x3d (1.0-fCameraAngle);\r\n        vec3 hsv \x3d rgb2hsv(LDR);\r\n        hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0);//boost haze saturation by 50%\r\n        LDR \x3d hsv2rgb(hsv);\r\n        vec3 finalColor \x3d LDR;\r\n        // when rendering we specify the blend functions such that\r\n        // newDestColor \x3d oldDestColor*(1.0-finalColor) + finalColor\r\n#else\r\n        //reinhard tonemapper for looking upwards\r\n        vec3 ldrReinhard \x3d reinhardTM(v3Color,fExposure);\r\n        LDR +\x3d angleMultiplier*ldrReinhard;\r\n\r\n        //height dependent parameter to smooth out reddish atmosphere\r\n        float side \x3d (rayEndT+rayStartT)*0.5;\r\n        float atmoHeight \x3d sqrt(fCameraHeight2 - side*side);\r\n        float h2 \x3d clamp(1.0-(atmoHeight-fLowerAlphaBlendBound)/(fOuterRadius-fLowerAlphaBlendBound),0.0,1.0);\r\n\r\n        vec3 finalColor \x3d LDR*h2;\r\n        vec3 hsv \x3d rgb2hsv(finalColor);\r\n        hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0);//boost sky saturation by 50%\r\n        finalColor \x3d hsv2rgb(hsv);\r\n#endif\r\n#ifdef PLANAR\r\n#ifndef HAZE\r\n        float alpha \x3d clamp(fCameraHeight-fInnerRadius,7000.0,30000.0);\r\n        alpha \x3d alpha / (30000.0-7000.0);\r\n        gl_FragColor \x3d vec4(finalColor, 1.0-alpha);\r\n#else\r\n        float alpha \x3d clamp(fCameraHeight-fInnerRadius,0.0,16500.0);\r\n        alpha \x3d alpha / (16500.0-0.0);\r\n        gl_FragColor \x3d vec4(finalColor, 1.0-alpha);\r\n#endif\r\n#else\r\n#ifndef HAZE\r\n        float alpha \x3d clamp(fCameraHeight-fInnerRadius,7000.0,30000.0);\r\n        alpha \x3d alpha / (30000.0-7000.0);\r\n        float atmosStrength \x3d clamp((length(ldrRed)-0.05)*1.05,0.0,1.0);\r\n        gl_FragColor \x3d vec4(finalColor, atmosStrength*clamp(1.0-(atmoHeight-fInnerRadius)/(fOuterRadius-fInnerRadius),0.0,1.0));\r\n#else\r\n        gl_FragColor \x3d vec4(finalColor, 1.0);\r\n#endif\r\n#endif\r\n\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c!--Fragment Shader for Atmosphere--\x3e\r\n\x3csnippet name\x3d"fsRealisticAtmosphere"\x3e\x3c![CDATA[\r\n\r\n  $fsprecisionf\r\n\r\n$atmosphereUniformsConstantsVaryings\r\n\r\n$atmosphereScaleFunction\r\n\r\n  //Conversion implementation found in util.xml\r\n$rgba2float\r\n\r\n\r\n$toneMapperConstants\r\n$exponentialToneMapper\r\n#ifndef HAZE\r\n$reinhardToneMapper\r\n#endif\r\n\r\n$HSVColorSpace\r\n\r\n  void main()\r\n  {\r\n\r\n    $atmospherePrecomputation\r\n\r\n    //Inside Atmosphere\r\n    if (det \x3e\x3d 0.0){\r\n\r\n      $atmosphereDiscardPixels\r\n\r\n      if(continueComputation){\r\n\r\n        $atmosphereUnpackAddUniforms\r\n\r\n        $atmosphereComputeRayAndLoopSetup\r\n\r\n        // Now loop through the sample rays\r\n        for(int i\x3d0; i\x3cmaxSamples; i++)\r\n        {\r\n          $atmosphereComputeSampleContribution\r\n        }\r\n\r\n        $atmosphereComputeHDRColors\r\n\r\n        $atmosphereComputePixelColor\r\n\r\n        //Debug variable overlay\r\n        if(showTest\x3e0.0){\r\n          gl_FragColor \x3d vec4(test,1.0);\r\n        }\r\n\r\n      } else {//Not on surface\r\n        gl_FragColor \x3d vec4(0.0);\r\n      }\r\n    } else {//Outside Atmosphere\r\n      gl_FragColor \x3d vec4(0.0);\r\n    }\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/offscreen.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsOffscreenRenderer"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n  attribute vec2 $uv0;\r\n  varying vec2 vtc;\r\n\r\n  void main(void) {\r\n    gl_Position \x3d vec4(position.xy, 0.0, 1.0);\r\n    vtc \x3d $uv0.xy * 0.5 + 0.5;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsOffscreenRenderer"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n  varying vec2 vtc;\r\n\r\n  void main() {\r\n    vec4 texColor \x3d texture2D(tex, vtc);\r\n    gl_FragColor \x3d texColor;\r\n  }\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/environment/materials/StarMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderStar"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tuniform vec4 viewport;\r\n\r\n\tattribute vec3 $position;\r\n\tattribute vec4 $color;\r\n  attribute float $size;\r\n\r\n\tvarying vec4 vcolor;\r\n\tvarying float vsize;\r\n\r\n\t$alignToPixelCenter\r\n\r\n\tvoid main(void) {\r\n\t\tvec4 posProj \x3d proj * view * model*vec4($position*1.0e25,1.0);//move infinitely far away\r\n\t\tgl_Position \x3d alignToPixelCenter(posProj, viewport.zw); //pixel align position\r\n    gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\r\n\t\tvcolor \x3d $color/1.2;\r\n\t\tvsize \x3d size*5.0;\r\n\t\tgl_PointSize \x3d vsize;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderStar"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tvarying vec4 vcolor;\r\n\tvarying float vsize;\r\n\r\n\tvoid main() {\r\n\t\tfloat cap \x3d 0.7;\r\n\t\tfloat scale \x3d 1.0/cap;\r\n\t\tfloat helper \x3d clamp(length(abs(gl_PointCoord-vec2(0.5))),0.0,cap);\r\n\t\tfloat alpha \x3d clamp((cap-helper)*scale,0.0,1.0);\r\n\t\tfloat intensity \x3d alpha*alpha*alpha;\r\n\t\tif (vsize \x3c 3.0)\r\n\t\t\tintensity *\x3d 0.5;\r\n\t\tgl_FragColor \x3d vec4(1.0,1.0,1.0,intensity);\r\n\t\tgl_FragColor.xyz *\x3d vcolor.xyz;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/SimpleGLMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderSimple"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tattribute vec3 $position;\r\n\r\n\tvoid main(void) {\r\n\t\tgl_Position \x3d proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderSimple"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform vec4 color;\r\n\r\n\tvoid main() {\r\n\t\tgl_FragColor \x3d color;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/HUDMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderHUD"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  $commonAttributesAndUniformsHUD\r\n\r\n  uniform float pixelRatio;\r\n  uniform vec2 screenOffset;\r\n  uniform vec2 anchorPos;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  uniform vec4 screenSizePerspective;\r\n\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n  varying vec3 debugBorderCoords;\r\n#endif\r\n\r\n  attribute vec2 $uv0;\r\n  attribute vec4 $color;\r\n  attribute vec2 $size;\r\n  attribute vec4 $auxpos2;\r\n\r\n  varying vec4 vcolor;\r\n\r\n  varying vec2 vtc;\r\n  varying vec2 vsize;\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n  varying float voccluded;\r\n#endif\r\n\r\n  $vvUniforms\r\n\r\n  $alignToPixelCenter\r\n  $alignToPixelOrigin\r\n  $projectPositionHUD\r\n  $vvFunctions\r\n\r\n  void main(void) {\r\n    ProjectHUDAux projectAux;\r\n    vec4 posProj \x3d projectPositionHUD(projectAux);\r\n\r\n    vec2 inputSize;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n    inputSize \x3d screenSizePerspectiveScaleVec2($size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\r\n\r\n    vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleFloat(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\r\n\r\n#else\r\n\r\n    inputSize \x3d $size;\r\n\r\n    vec2 screenOffsetScaled \x3d screenOffset;\r\n#endif\r\n\r\n#ifdef VV_SIZE\r\n    // only use width (.xx) for proportional scaling\r\n    // (if no width was defined in vv, width\r\n    //  will be a copy of height vv)\r\n    inputSize *\x3d vvGetScale($auxpos2).xx;\r\n#endif\r\n\r\n    vec2 combinedSize \x3d inputSize * pixelRatio;\r\n    vec4 quadOffset \x3d vec4(0);\r\n\r\n#if defined(OCCL_TEST) || defined(BINARY_HIGHLIGHT_OCCLUSION)\r\n    bool visible \x3d testVisibilityHUD(posProj);\r\n#endif\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n  voccluded \x3d visible ? 0.0 : 1.0;\r\n#endif\r\n\r\n#ifdef OCCL_TEST\r\n    if (visible) {\r\n#endif\r\n      // UV goes from 0 to 1.99999, where the integer part is used\r\n      // for the normalized vertex coordinates, and the fractional\r\n      // part is used for texture sampling\r\n      vec2 uv01 \x3d floor($uv0);\r\n      vec2 uv \x3d $uv0 - uv01;\r\n\r\n      // Displace icon based on anchor position (normalized for size) and\r\n      // absolute screen offset. anchorPos is [-0.5, 0.5]\r\n      quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\r\n\r\n#ifdef SIGNED_DISTANCE_FIELD\r\n\r\n      // SDF primitives might be scaled so that the SDF texture resolution does\r\n      // not match the resolution of the canvas, but we still want to render\r\n      // outline-only (\'cross\' and \'x\') primitives cleanly. Aligning to a screen\r\n      // pixel border at the geometry center achieves this, since SDF textures\r\n      // always have power of 2 dimensions.\r\n      posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;\r\n#else\r\n      posProj +\x3d quadOffset;\r\n\r\n      // Aligning vertex positions to the nearest (using \'floor\') screen pixel\r\n      // border renders textures with pixel-perfect results. If the texture\r\n      // resolution does not match the canvas resolution then aligning is\r\n      // redundant.\r\n      if (inputSize.x \x3d\x3d $size.x) {\r\n        posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\r\n      }\r\n#endif\r\n\r\n      gl_Position \x3d posProj;\r\n\r\n      vtc \x3d uv;\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n      debugBorderCoords \x3d vec3(uv01, 1.0 / combinedSize);\r\n#endif\r\n\r\n      vsize \x3d inputSize;\r\n#ifdef OCCL_TEST\r\n    } else {\r\n      vtc \x3d vec2(.0);\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n      debugBorderCoords \x3d vec3(0);\r\n#endif\r\n\r\n    }\r\n#endif\r\n\r\n    gl_Position \x3d posProj;\r\n\r\n#ifdef VV_COLOR\r\n    vcolor \x3d vvGetColor($auxpos2, vvColorValues, vvColorColors);\r\n#else\r\n    vcolor \x3d $color / 255.0;\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderHUDBaseVariables"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  #extension GL_OES_standard_derivatives : require\r\n\r\n  uniform sampler2D tex;\r\n  uniform vec4 overrideColor;\r\n  uniform vec4 outlineColor;\r\n  uniform float outlineSize;\r\n\r\n  varying vec4 vcolor;\r\n\r\n  varying vec2 vtc;\r\n  varying vec2 vsize;\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n  varying float voccluded;\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n  varying vec3 debugBorderCoords;\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderHUDBaseMain"\x3e\x3c![CDATA[\r\n  vec4 premultiply(vec4 v) {\r\n    return vec4(v.rgb * v.a, v.a);\r\n  }\r\n\r\n  void main() {\r\n\r\n#ifdef SIGNED_DISTANCE_FIELD\r\n    vec4 color \x3d vec4(0.0, 0.0, 0.0, 0.0);\r\n    vec4 fillPixelColor \x3d overrideColor * vcolor;\r\n\r\n    // Attempt to sample texel centers to avoid thin cross outline\r\n    // disappearing with large symbol sizes.\r\n    // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\r\n    const float txSize \x3d 128.0;\r\n    vec2 scaleFactor \x3d ((vsize - txSize) / txSize);\r\n    vec2 samplePos \x3d vtc + vec2(1.0, -1.0) * (1.0 / txSize) * scaleFactor;\r\n\r\n    // Distance in [-0.5, 0.5]\r\n    float d \x3d dot(texture2D(tex, samplePos), vec4(1.0/16777216.0, 1.0/65535.0, 1.0/256.0, 1.0)) - 0.5;\r\n\r\n    // Work around loss of precision for \'d \x3d 0.0\'.\r\n    // \'0\' gets normalised to 0.5 * 256 \x3d 128 before float packing, but can only\r\n    // be stored in the texture as 128 / 255 \x3d 0.502.\r\n    // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603110\r\n    const float diff \x3d (128.0/255.0 - 0.5);\r\n\r\n    // adjust all values, not just those close to 0, to avoid discontinuities in\r\n    // the outlines of other shapes e.g. circles\r\n    d \x3d d - diff;\r\n\r\n    // Distance in output units\r\n    float dist \x3d d * vsize.x;\r\n\r\n    fillPixelColor.a *\x3d clamp(0.5 - dist, 0.0, 1.0);\r\n\r\n    if (outlineSize \x3e 0.25) {\r\n      vec4 outlinePixelColor \x3d outlineColor;\r\n      float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\r\n      outlinePixelColor.a *\x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\r\n\r\n      // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\r\n      float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\r\n      vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\r\n        vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\r\n\r\n      gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\r\n    }\r\n    else {\r\n      gl_FragColor \x3d premultiply(fillPixelColor);\r\n    }\r\n\r\n    // visualize SDF:\r\n    // gl_FragColor \x3d vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\r\n#else\r\n\r\n    // HUDMaterial is rendered with a blending mode that assumes a pre-multiplied\r\n    // fragment color. Input textures should already be pre-multiplied and so\r\n    // don\'t require adjustment, but the override and vertex colors must be\r\n    // modulated by their alpha values.\r\n\r\n    gl_FragColor \x3d texture2D(tex, vtc, -0.5) * premultiply(overrideColor * vcolor);\r\n\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n     float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, vec2(debugBorderCoords.z))) || any(greaterThan(debugBorderCoords.xy, vec2(1.0 - debugBorderCoords.z))));\r\n     gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 1, 1), isBorder);\r\n#endif\r\n\r\n    if (gl_FragColor.a \x3c 0.1) {\r\n      discard;\r\n    }\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderHUD"\x3e\x3c![CDATA[\r\n$fragmentShaderHUDBaseVariables\r\n$fragmentShaderHUDBaseMain\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderHUDHighlight"\x3e\x3c![CDATA[\r\n$fragmentShaderHUDBaseVariables\r\n\r\n  uniform sampler2D depthTex;\r\n  uniform vec4 highlightViewportPixelSz;\r\n\r\n$fragmentShaderHUDBaseMain\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n    // Instead of deciding on a per-pixel basis if the highlight is occluded,\r\n    // do it for all highlight pixel based on the centroid occlusion. This\r\n    // is a temporary solution for:\r\n    // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/9645\r\n    if (voccluded \x3d\x3d 1.0) {\r\n      gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\r\n    } else {\r\n      gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\r\n    }\r\n#else\r\n    $highlightWrite\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"vertexShaderOcclusionTestPixel"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  $commonAttributesAndUniformsHUD\r\n\r\n  $alignToPixelCenter\r\n  $projectPositionHUD\r\n\r\n  void main(void) {\r\n    vec4 posProjCenter;\r\n\r\n    // Check for special value of position (0, 0, 0) which is used by the Renderer when graphics\r\n    // are removed before the VBO is recompacted. If this is the case, then we just project outside\r\n    // of clip space.\r\n    if (dot($position, $position) \x3e 0.0) {\r\n      // Render single point to center of the pixel to avoid subpixel filtering to affect\r\n      // the marker color\r\n      ProjectHUDAux projectAux;\r\n      vec4 posProj \x3d projectPositionHUD(projectAux);\r\n\r\n      posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\r\n    }\r\n    else {\r\n      // Project out of clip space\r\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n    }\r\n\r\n    gl_Position \x3d posProjCenter;\r\n    gl_PointSize \x3d 1.0;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderTexOnly"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tattribute vec3 $position;\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\r\n\tvoid main(void) {\r\n\t\tgl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\r\n\t\tvtc \x3d $uv0;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderTexOnly"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D tex;\r\n\tuniform vec4 color;\r\n\tvarying vec2 vtc;\r\n\r\n\tvoid main() {\r\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\r\n\t\tgl_FragColor \x3d texColor * color;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/ssao.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\t\x3csnippet name\x3d"createFsSSAOSrc"\x3e\x3c![CDATA[\r\n\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D rnm;\r\n\tuniform sampler2D normalMap;\r\n\tuniform sampler2D depthMap;\r\n\tuniform float\t\tssaoAtt;\r\n\tuniform vec2\t\trnmScale;\r\n\tuniform float\t\tradius;\r\n\tuniform vec2\t\tnearFar;\r\n\tuniform vec3\t\tpSphere[64];\r\n\r\n\tvarying vec2\t\tuv;\r\n\r\n\tconst\tfloat\t\tstrength \x3d .07;\r\n\tconst\tfloat\t\tfalloff \x3d .000002;\r\n\r\n\t$rgba2float\r\n\tvoid main(void) {\r\n\t\tvec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\r\n\t\tfloat currentPixelDepth \x3d rgba2float(texture2D(depthMap, uv));\r\n\t\tvec3 ep \x3d vec3(uv.xy, currentPixelDepth);\r\n\t\tvec3 norm \x3d vec3(-1.0) + 2.0 * texture2D(normalMap, uv).xyz;\r\n\t\tfloat bl \x3d .0;\r\n\t\tfloat f \x3d mix(nearFar.x, nearFar.y, currentPixelDepth) / nearFar.x;\r\n\t\tfloat radD \x3d radius / f;\r\n\t\tradD \x3d min(radD, .5);\r\n\t\tfloat depthDifference;\r\n\t\tvec3 ray;\r\n\r\n\t\tfor(int i \x3d 0; i \x3c NUM_TAP_SAMPLES; ++i) {\r\n\t\t\tray \x3d radD*reflect(pSphere[i], fres);\r\n\t\t\tvec2 tc \x3d ep.xy + sign(dot(ray, norm) ) * ray.xy;\r\n\t\t\tif (tc.x \x3e\x3d .0 \x26\x26 tc.y \x3e\x3d .0 \x26\x26 tc.x \x3c\x3d 1.0 \x26\x26 tc.y \x3c\x3d 1.0) {\r\n\t\t\t\tfloat occluderDepth \x3d rgba2float(texture2D(depthMap, tc));\r\n\t\t\t\tvec3 occluderNormal \x3d vec3(-1.0) + 2.0 * texture2D(normalMap, tc).xyz;\r\n\t\t\t\tdepthDifference \x3d currentPixelDepth - occluderDepth;\r\n\t\t\t\tbl +\x3d step(falloff, depthDifference) * (1.0 - dot(occluderNormal, norm)) * (1.0 - smoothstep(falloff, strength, depthDifference));\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tfloat ao \x3d 1.0 + bl * (-1.38 / float(NUM_TAP_SAMPLES)) * ssaoAtt;\r\n\t\tgl_FragColor.a \x3d ao;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\t\x3csnippet name\x3d"getDepthLinear"\x3e\x3c![CDATA[\r\n\tfloat getDepthLinear(vec2 ssC) {\r\n\t\treturn -(rgba2float(texture2D(depthMap, ssC))*(nearFar[1] - nearFar[0])+nearFar[0]);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"createFsSSAOSrcObscurance"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform mat4 projMatrixInv;\r\n\r\n\tuniform sampler2D normalMap;\r\n\tuniform sampler2D depthMap;\r\n\r\n\tuniform float     intensity;\r\n\r\n\tuniform float projScale;\r\n\tuniform float     radius;\r\n\tuniform vec2      nearFar;\r\n\r\n\tuniform vec4      projInfo;\r\n\r\n\tuniform vec2\t  screenDimensions;\r\n\r\n\t//noise texture lookup could be replaced with hash function if WebGL gets XOR functionality\r\n\tuniform vec3\t\tpSphere[NUM_TAP_SAMPLES]; //tap position\r\n\tuniform vec2\t\trnmScale;\r\n\tuniform sampler2D rnm; //noise texture\r\n\r\n\t//set z scaling, used to prevent division in ortho mode\r\n\tuniform vec2 zScale;\r\n\r\n\tvarying vec2  uv;\r\n\tvarying vec4  camPos;\r\n\r\n\t$rgba2float\r\n\t$getDepthLinear\r\n\r\n\t/** Returns a unit vector and a screen-space radius for the tap on a unit disk (the caller should scale by the actual disk radius) */\r\n\t/*uniform float numSpiralTurns;\r\n\tvec2 tapLocation(int sampleNumber, float spinAngle, out float ssR){\r\n\t\t// Radius relative to ssR\r\n\t\tfloat alpha \x3d (float(sampleNumber) + 0.5) * (1.0 / float(NUM_TAP_SAMPLES));\r\n\t\tfloat angle \x3d alpha * (numSpiralTurns * 6.28) + spinAngle;\r\n\r\n\t\tssR \x3d alpha;\r\n\t\treturn vec2(cos(angle), sin(angle));\r\n\t}*/\r\n\r\n\r\n\tfloat fallOffFunction(float vv, float vn, float bias) {\r\n\t  float radius2 \x3d radius * radius;\r\n\r\n\t\t// A: From the HPG12 paper\r\n\t\t// Note large epsilon to avoid overdarkening within cracks\r\n\t\t// return float(vv \x3c radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\r\n\r\n\t\t// B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\r\n\t\tfloat f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\r\n\r\n\t\t// C: Medium contrast (which looks better at high radii), no division.  Note that the\r\n\t\t// contribution still falls off with radius^2, but we\'ve adjusted the rate in a way that is\r\n\t\t// more computationally efficient and happens to be aesthetically pleasing.\r\n\t\t// return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\r\n\r\n\t\t// D: Low contrast, no division operation\r\n\t\t// return 2.0 * float(vv \x3c radius * radius) * max(vn - bias, 0.0);\r\n\t}\r\n\r\n\r\n\t/** Compute the occlusion due to sample point \\a Q about camera-space point \\a C with unit normal \\a n_C */\r\n\tfloat aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\r\n\t\tvec3 v \x3d Q - C;\r\n\t\tfloat vv \x3d dot(v, v);\r\n\t\tfloat vn \x3d dot(normalize(v), n_C);\r\n\t\treturn fallOffFunction(vv, vn, 0.1);\r\n\t}\r\n\r\n\r\n\t/** Reconstruct camera-space P.xyz from screen-space S \x3d (x, y) in\r\n\t\tpixels and camera-space z \x3c 0.  Assumes that the upper-left pixel center\r\n\t\tis at (0.5, 0.5) [but that need not be the location at which the sample tap\r\n\t\twas placed!]\r\n\r\n\t\tCosts 3 MADD.  Error is on the order of 10^3 at the far plane, partly due to z precision.\r\n\t  */\r\n\tvec3 reconstructCSPosition(vec2 S, float z) {\r\n\t\treturn vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\r\n\t}\r\n\r\n\tvoid main(void)\r\n\t{\r\n\r\n\t\t//Hash function used in the HPG12 AlchemyAO paper\r\n\t\t//Not supported in WebGL -\x3e using texture lookup as in old SSAO shader instead\r\n\t\t//ivec2 ssC \x3d ivec2(gl_FragCoord.xy);\r\n\t\t//float randomPatternRotationAngle \x3d float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\r\n\t\tvec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\r\n\r\n\t   float currentPixelDepth \x3d getDepthLinear(uv);\r\n\r\n\t   if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\r\n\t\tgl_FragColor \x3d vec4(0);\r\n\t\treturn;\r\n\t   }\r\n\r\n\t   vec3 currentPixelPos \x3d reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\r\n\r\n\t   // get the normal of current fragment\r\n\t   vec4 norm4 \x3d texture2D(normalMap, uv);\r\n\t   vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\r\n\t   bool isTerrain \x3d norm4.w\x3c0.5;\r\n\r\n\t   float sum \x3d .0;\r\n\r\n\t   vec4 occluderFragment;\r\n\t   vec3 ray;\r\n\r\n\t   vec3 tapPixelPos;\r\n\r\n\t   // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\r\n\t   // bug or deviation from CE somewhere else?\r\n\t   float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\r\n\r\n\t   for(int i \x3d 0; i \x3c NUM_TAP_SAMPLES; ++i)\r\n\t   {\r\n\t\t  // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\r\n\t\t  //float ssR;\r\n\t\t  //vec2 unitOffset \x3d tapLocation(i, randomPatternRotationAngle, ssR);\r\n\t\t  // get the depth of the occluder fragment\r\n\t\t  //vec2 offset \x3d vec2(-unitOffset*radius*ssR*ps);\r\n\r\n\t\t  vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\r\n\t\t  vec2 offset \x3d vec2(-unitOffset*radius*ps);\r\n\r\n\r\n\t\t  //don\'t use current or very nearby samples\r\n\t\t  if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\r\n\r\n\r\n\t\t  vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\r\n\t\t  if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\r\n\t\t  vec2 tcTap \x3d tc/screenDimensions;\r\n\t\t  float occluderFragmentDepth \x3d getDepthLinear(tcTap);\r\n\r\n\t\t  if (isTerrain) {\r\n\t\t  \tbool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\r\n\t\t  \tif (isTerrainTap)\r\n\t\t  \t\tcontinue;\r\n\t\t  }\r\n\r\n\t\t  tapPixelPos \x3d reconstructCSPosition(tc, occluderFragmentDepth);\r\n\r\n\t\t  sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\r\n\t   }\r\n\r\n\t   // output the result\r\n\r\n\t\tfloat A \x3d max(1.0-sum*intensity/float(NUM_TAP_SAMPLES),0.0);\r\n\r\n\t\t// Anti-tone map to reduce contrast and drag dark region farther\r\n\t\t// (x^0.2 + 1.2 * x^4)/2.2\r\n\t\tA \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\r\n\r\n\r\n\t   //gl_FragColor \x3d vec4(norm/2.0+0.5, 1.0);\r\n\t   //gl_FragColor \x3d vec4(-currentPixelDepth/1000.0);\r\n\t   //gl_FragColor \x3d vec4(tapPixelPos.x/100.0);\r\n\t   gl_FragColor \x3d vec4(A);\r\n\r\n\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsBlurEdgeAware"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D normalMap;\r\n\tuniform sampler2D depthMap;\r\n\tuniform sampler2D tex;\r\n\r\n\r\n\tuniform vec2 blurSize;\r\n\r\n\r\n\tuniform float g_BlurFalloff;\r\n\tuniform float projScale;\r\n\r\n\r\n\tvarying vec2 uv;\r\n\r\n\tuniform vec2\t\tnearFar;\r\n\r\n\t//set z scaling, used to prevent division in ortho mode\r\n\tuniform vec2 zScale;\r\n\r\n\t$rgba2float\r\n\t$getDepthLinear\r\n\r\n\tfloat BlurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness)\r\n\t{\r\n\t\tfloat c \x3d texture2D(tex, uv).r;\r\n\t\tfloat d \x3d getDepthLinear(uv);\r\n\r\n\t\tfloat ddiff \x3d d - center_d;\r\n\r\n\t\tfloat w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\r\n\r\n\t\tw_total +\x3d w;\r\n\r\n\t\treturn w*c;\r\n\t}\r\n\r\n\tvoid main(void)\r\n\t{\r\n\r\n\t\tfloat b \x3d 0.0;\r\n\t\tfloat w_total \x3d 0.0;\r\n\r\n\t\tfloat center_d \x3d  getDepthLinear(uv);\r\n\r\n\t\tfloat sharpness \x3d -0.05*projScale/(center_d*zScale.x+zScale.y);\r\n\t\tfor (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r)\r\n\t\t{\r\n\t\t\tfloat rf \x3d float(r);\r\n\t\t\tvec2 uvOffset \x3d uv + rf*blurSize;\r\n\t\t\tb +\x3d BlurFunction(uvOffset, rf, center_d, w_total, sharpness);\r\n\t\t}\r\n\r\n\t\tgl_FragColor \x3d vec4(b/w_total);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\t\x3csnippet name\x3d"fsBlurSrc0"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D tex;\r\n\tuniform float blurSize;\r\n\tvarying vec2 uv;\r\n\r\n\tvoid main() {\r\n\t\tint rad \x3d RADIUS - 1;\r\n\r\n\t\tvec4 sum \x3d vec4(0.0);\r\n\t\tfor (int k \x3d -RADIUS; k \x3c\x3d RADIUS; ++k) { \t\t// NOTE for-variable-init must be a const expression\r\n\t\t\tfloat fi \x3d float(k);\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\t\x3csnippet name\x3d"fsBlurSrc1"\x3e\x3c![CDATA[\r\n\t\t}\r\n\r\n\t\tgl_FragColor \x3d sum / float(RADIUS * RADIUS);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\t\x3csnippet name\x3d"fsBlurH"\x3e\x3c![CDATA[\r\n\t$fsBlurSrc0\r\n\t\t\tsum +\x3d texture2D(tex, vec2(uv.x + fi * blurSize, uv.y)) * (float(rad) - abs(fi) + 1.0);\r\n\t$fsBlurSrc1\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\t\x3csnippet name\x3d"fsBlurV"\x3e\x3c![CDATA[\r\n\t$fsBlurSrc0\r\n\t\t\tsum +\x3d texture2D(tex, vec2(uv.x, uv.y + fi * blurSize)) * (float(rad) - abs(fi) + 1.0);\r\n\t$fsBlurSrc1\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/highlight.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3c!--\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\nSmartly downsamples a texture, halfing its resolution. This allows for a square\r\nscreen region to check if none, any or all pixels were set.\r\n\r\nThe red channel is always ceiled after interpolating the 4 merged pixels.\r\nThis allows to evaluate:\r\nany(pixels.red !\x3d 0.0) as red \x3d\x3d 1.0\r\nnone(pixels.red !\x3d 0.0) as red \x3d\x3d 0.0\r\n\r\nThe green and blue channels are set to floor(max(green, blue)).\r\nThis allows to evaluate:\r\nall(pixels.green || pixels.blue) as green \x3d\x3d 1.0\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n--\x3e\r\n\r\n\x3csnippet name\x3d"vsConservativeDownsample"\x3e\x3c![CDATA[\r\n\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n\r\n  void main()\r\n  {\r\n    gl_Position \x3d vec4(vec2(1.0) - $position * 2.0, .0, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsConservativeDownsample"\x3e\x3c![CDATA[\r\n\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n  uniform vec2 invFramebufferDim;\r\n\r\n  void main()\r\n  {\r\n    vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\r\n    vec4 value \x3d texture2D(tex, coord);\r\n    float mx \x3d floor(max(value.g, value.b));\r\n    gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c!--\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\nGaussian blur with linear sampling. Supports different number of samples, but\r\nonly 5 samples have proper weights. Uses linear texture interpolation to reduce\r\nthe number of samples taken.\r\n\r\nDefines:\r\nGRID_OPTIMIZATION (set or !set)\r\nGAUSSIAN_SAMPLES (3,5,7)\r\n\r\nThis technique requires linear filtering on source texture\r\nhttp://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n--\x3e\r\n\x3csnippet name\x3d"vsHighlightBlurFastGaussian"\x3e\x3c![CDATA[\r\n\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n  attribute vec2 $uv0;\r\n\r\n  #ifdef GRID_OPTIMIZATION\r\n    uniform sampler2D coverageTex;\r\n    varying vec3 blurCoordinate;\r\n  #else\r\n    uniform vec2 blurSize;\r\n    varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\r\n  #endif\r\n\r\n  void main()\r\n  {\r\n    gl_Position \x3d vec4($position, 0.0, 1.0);\r\n\r\n    #ifdef GRID_OPTIMIZATION\r\n      // sample the coverage texture at the block center\r\n      // and if no coverage detected, create degenerate triangle\r\n      vec4 cov \x3d texture2D(coverageTex, $uv0);\r\n      if (cov.r \x3d\x3d 0.0) {\r\n        gl_Position \x3d vec4(0,0,0,0);\r\n      }\r\n\r\n      // create texture coordinate for blur center\r\n      // encode information about fully inside block in z coordinate\r\n      blurCoordinate \x3d vec3(gl_Position.xy * .5 + vec2(.5), max(cov.g, cov.b));\r\n    #else\r\n      vec2 uv \x3d $position.xy * .5 + vec2(.5);\r\n\r\n      #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n        // not proper gaussian weights\r\n        blurCoordinates[0] \x3d uv;\r\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n        blurCoordinates[0] \x3d uv;\r\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n        blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n        blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n        // not proper gaussian weights\r\n        blurCoordinates[0] \x3d uv;\r\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n        blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n        blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n        blurCoordinates[5] \x3d uv + blurSize * 5.1;\r\n        blurCoordinates[6] \x3d uv - blurSize * 5.1;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n        // not proper gaussian weights\r\n        blurCoordinates[0] \x3d uv;\r\n        blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n        blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n        blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n        blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n        blurCoordinates[5] \x3d uv + blurSize * 5.1;\r\n        blurCoordinates[6] \x3d uv - blurSize * 5.1;\r\n        blurCoordinates[7] \x3d uv + blurSize * 7.1;\r\n        blurCoordinates[8] \x3d uv - blurSize * 7.1;\r\n      #endif\r\n    #endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsHighlightBlurFastGaussian"\x3e\x3c![CDATA[\r\n\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n\r\n  #ifdef GRID_OPTIMIZATION\r\n    uniform vec2 blurSize;\r\n    varying vec3 blurCoordinate;\r\n  #else\r\n    varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\r\n  #endif\r\n\r\n  void main()\r\n  {\r\n    #ifdef GRID_OPTIMIZATION\r\n      vec2 uv \x3d blurCoordinate.xy;\r\n      vec4 center \x3d texture2D(tex, uv);\r\n\r\n      // do not blur if no pixel or all pixels in neighborhood are set\r\n      if (blurCoordinate.z \x3d\x3d 1.0) {\r\n        gl_FragColor \x3d center;\r\n      }\r\n      else {\r\n        vec4 sum \x3d vec4(0.0);\r\n\r\n        #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n          // not proper gaussian weights\r\n          sum +\x3d center * 0.204164;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n        #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n          sum +\x3d center * 0.204164;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\r\n        #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n          // not proper gaussian weights\r\n          sum +\x3d center * 0.204164;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 5.1) * 0.03;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 5.1) * 0.03;\r\n        #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n          // not proper gaussian weights\r\n          sum +\x3d center * 0.154164;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 1.5) * 0.204005;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 1.5) * 0.204005;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 3.5) * 0.123913;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 3.5) * 0.123913;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 5.5) * 0.123913;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 5.5) * 0.123913;\r\n          sum +\x3d texture2D(tex, uv + blurSize * 7.5) * 0.05;\r\n          sum +\x3d texture2D(tex, uv - blurSize * 7.5) * 0.05;\r\n        #endif\r\n\r\n        gl_FragColor \x3d sum;\r\n      }\r\n    #else\r\n      vec4 sum \x3d vec4(0.0);\r\n\r\n      #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n        // not proper gaussian weights\r\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n        // not proper gaussian weights\r\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.03;\r\n        sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.03;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n        // not proper gaussian weights\r\n        sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.154164;\r\n        sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.204005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.204005;\r\n        sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.123913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.123913;\r\n        sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.09;\r\n        sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.09;\r\n        sum +\x3d texture2D(tex, blurCoordinates[7]) * 0.05;\r\n        sum +\x3d texture2D(tex, blurCoordinates[8]) * 0.05;\r\n      #endif\r\n\r\n      gl_FragColor \x3d sum;\r\n    #endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c!--\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\nMerging blurred outlines with source image, advanced version\r\n\r\nDefines:\r\nGRID_OPTIMIZATION (set or !set)\r\nGRID_DEBUG (set or !set)\r\n\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n--\x3e\r\n\x3csnippet name\x3d"vsHighlightApply"\x3e\x3c![CDATA[\r\n\r\n  $vsprecisionf\r\n\r\n  attribute vec2 $position;\r\n  varying vec2 uv;\r\n\r\n  #ifdef GRID_OPTIMIZATION\r\n    attribute vec2 $uv0;\r\n    uniform sampler2D coverageTex;\r\n  #endif\r\n\r\n  void main()\r\n  {\r\n    #ifdef GRID_OPTIMIZATION\r\n      #ifdef GRID_DEBUG\r\n        vec4 cov \x3d texture2D(coverageTex, $uv0);\r\n        // if no highlight pixel set in this block,\r\n        // or all pixels set, hide block\r\n        if (cov.r \x3d\x3d 0.0 || cov.g \x3d\x3d 1.0 || cov.b \x3d\x3d 1.0) {\r\n          gl_Position \x3d vec4(0,0,0,0);\r\n          return;\r\n        }\r\n        gl_Position \x3d vec4($position, .0, 1.0);\r\n        uv \x3d $uv0;\r\n        return;\r\n      #else\r\n        vec4 cov \x3d texture2D(coverageTex, $uv0);\r\n        // if no highlight pixel set in this block, hide block\r\n        if (cov.r \x3d\x3d 0.0) {\r\n          gl_Position \x3d vec4(0,0,0,0);\r\n          return;\r\n        }\r\n      #endif\r\n    #endif\r\n\r\n    gl_Position \x3d vec4($position, .0, 1.0);\r\n    uv \x3d $position.xy * .5 + vec2(.5);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsHighlightApply"\x3e\x3c![CDATA[\r\n\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D tex;\r\n  uniform sampler2D origin;\r\n\r\n  uniform vec4 color;\r\n  uniform float outlineSize;\r\n  uniform float blurSize;\r\n  uniform vec4 opacities; // [outline, outlineOccluded, fill, fillOccluded]\r\n\r\n  varying vec2 uv;\r\n\r\n  void main()\r\n  {\r\n    #if defined(GRID_OPTIMIZATION) \x26\x26 defined(GRID_DEBUG)\r\n      gl_FragColor \x3d vec4(uv, 0, 1.0);\r\n    #else\r\n      // Read the highlight intensity from the blurred highlight image\r\n      vec4 blurredHighlightValue \x3d texture2D(tex, uv);\r\n      float highlightIntensity \x3d blurredHighlightValue.a;\r\n\r\n      // Discard all pixels which are not affected by highlight\r\n      if (highlightIntensity \x3d\x3d 0.0) {\r\n        discard;\r\n      }\r\n\r\n      vec4 origin_color \x3d texture2D(origin, uv);\r\n\r\n      float outlineIntensity;\r\n      float fillIntensity;\r\n\r\n      // if occluded\r\n      if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\r\n        outlineIntensity \x3d color.w * opacities[1];\r\n        fillIntensity \x3d color.w * opacities[3];\r\n      }\r\n      // if unoccluded\r\n      else {\r\n        outlineIntensity \x3d color.w * opacities[0];\r\n        fillIntensity \x3d color.w * opacities[2];\r\n      }\r\n\r\n      float inner \x3d 1.0 - outlineSize / 9.0;\r\n      float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\r\n\r\n      float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\r\n      //float fillFactor \x3d smoothstep(0.6, 0.72, highlightIntensity);\r\n      float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\r\n      float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\r\n\r\n      // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n      // I.e., color should not be premultiplied with alpha\r\n      gl_FragColor \x3d vec4(color.xyz, intensity);\r\n    #endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/util.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"alignToPixelCenter"\x3e\x3c![CDATA[\r\n  vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\r\n    // From clip space to (0 : 1), bias towards right pixel edge\r\n    vec2 xy \x3d vec2(.500123) + .5 * clipCoord.xy / clipCoord.w;\r\n\r\n    // Size of a pixel in range (0 : 1)\r\n    vec2 pixelSz \x3d vec2(1.0) / widthHeight;\r\n\r\n    // Round to nearest pixel center\r\n    vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\r\n\r\n    // Convert back to clip space\r\n    vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\r\n\r\n    return vec4(result, clipCoord.zw);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"alignToPixelOrigin"\x3e\x3c![CDATA[\r\n  vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\r\n    // From clip space to (0 : 1),\r\n    vec2 xy \x3d vec2(.5) + .5 * clipCoord.xy / clipCoord.w;\r\n\r\n    // Size of a pixel in range (0 : 1)\r\n    vec2 pixelSz \x3d vec2(1.0) / widthHeight;\r\n\r\n    // Round to nearest pixel border, (0 : 1)\r\n    vec2 ij \x3d floor((xy + .5 * pixelSz) * widthHeight) * pixelSz;\r\n\r\n    // Convert back to clip space\r\n    vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\r\n\r\n    return vec4(result, clipCoord.zw);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"float2rgba"\x3e\x3c![CDATA[\r\n\tvec4 float2rgba(const in float v) {\r\n\t\tvec4 enc \x3d vec4(1.0, 255.0, 65025.0, 16581375.0) * v;\r\n\t\tenc \x3d fract(enc);\r\n\t\tenc -\x3d enc.yzww * vec4(1.0/255.0, 1.0/255.0, 1.0/255.0, 0.0);\r\n\t\treturn enc;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"rgba2float"\x3e\x3c![CDATA[\r\n\tfloat rgba2float(vec4 rgba) {\r\n\t\treturn dot(rgba, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/16581375.0));\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"calcFragDepth"\x3e\x3c![CDATA[\r\n\t#extension GL_OES_standard_derivatives : enable\r\n\r\n\tfloat calcFragDepth(const in float depth) {\r\n\t\t//calc polygon offset\r\n\t\tconst float SLOPE_SCALE \x3d 2.0;\r\n\t\tconst float BIAS \x3d 2.0 * .000015259;\t\t// 1 / (2^16 - 1)\r\n\t\tfloat m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\r\n\t\tfloat result \x3d depth + SLOPE_SCALE * m + BIAS;\r\n\t\treturn clamp(result, .0, .999999);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"evalShadow"\x3e\x3c![CDATA[\r\n\t$rgba2float\r\n\r\n\t// "matrix" parameter used to have const qualifier as well, but IE11 couldn\'t deal with it at time of writing.\r\n\t// once IE11 is fine with it, const should probably be re-introduced\r\n\tfloat evalShadow(const in vec3 vpos, const in float depth, const in sampler2D depthTex, const int num, const in vec4 distance, in mat4 matrix[4], const in float halfPxSz) {\r\n\t\t//choose correct cascade\r\n\t\tint i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\r\n\r\n\t\tif (i \x3e\x3d num) return .0;\r\n\r\n\t\tmat4 mat \x3d i \x3d\x3d 0 ? matrix[0] : i \x3d\x3d 1 ? matrix[1] : i \x3d\x3d 2 ? matrix[2] : matrix[3];\r\n\r\n\t\tvec4 lv \x3d mat * vec4(vpos, 1.0);\r\n\t\tlv.xy /\x3d lv.w;\r\n\r\n\t\t//vertex completely outside? -\x3e no shadow\r\n\t\tvec3 lvpos \x3d .5 * lv.xyz + vec3(.5);\r\n\t\tif (lvpos.z \x3e\x3d 1.0) return .0;\r\n\t\tif (lvpos.x \x3c .0 || lvpos.x \x3e 1.0 || lvpos.y \x3c .0 || lvpos.y \x3e 1.0) return .0;\r\n\r\n\t\t//calc coord in cascade texture\r\n\t\tvec2 uv \x3d vec2(float(i - 2 * (i / 2)) *.5, float(i / 2) * .5) + .5 * lvpos.xy;\r\n\r\n\t\tfloat texSize \x3d .5 / halfPxSz;\r\n\r\n\t\t//filter, offset by half pixels\r\n\t\tvec2 st \x3d fract((vec2(halfPxSz) + uv) * texSize);\r\n\r\n\t\tfloat s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n\t\tfloat s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n\t\tfloat s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n\t\tfloat s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n\r\n\t\treturn mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3c!--\r\n\tScene Lighting Definitions:\r\n\t\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\n\tdefines:\r\n\t\t- SH_ORDER: 1|2|3\r\n\tinput:\r\n\t\t- normal: vec3\r\n\t\t- albedo: vec3\r\n\t  - shadow: float\r\n\t\t- ssao: float\r\n\treturn:\r\n\t  - color: vec3\r\n--\x3e\r\n\x3csnippet name\x3d"sceneLightingDefinitions"\x3e\x3c![CDATA[\r\n\t$viewingMode\r\n\r\n\t// main light\r\n\t/////////////////////////////////////////\r\n\tuniform vec3 lightingMainDirection;\r\n\tuniform vec3 lightingMainIntensity;\r\n\r\n\t// ambient lighting\r\n\t/////////////////////////////////////////\r\n\t#ifndef SH_ORDER\r\n\t\t#define SH_ORDER 2\r\n\t#endif\r\n\r\n\t#if SH_ORDER \x3d\x3d 0\r\n\t\tuniform vec3 lightingAmbientSH0;\r\n\t#elif SH_ORDER \x3d\x3d 1\r\n\t\tuniform vec4 lightingAmbientSH_R;\r\n\t\tuniform vec4 lightingAmbientSH_G;\r\n\t\tuniform vec4 lightingAmbientSH_B;\r\n\t#elif SH_ORDER \x3d\x3d 2\r\n\t\tuniform vec3 lightingAmbientSH0;\r\n\t\tuniform vec4 lightingAmbientSH_R1;\r\n\t\tuniform vec4 lightingAmbientSH_G1;\r\n\t\tuniform vec4 lightingAmbientSH_B1;\r\n\t\tuniform vec4 lightingAmbientSH_R2;\r\n\t\tuniform vec4 lightingAmbientSH_G2;\r\n\t\tuniform vec4 lightingAmbientSH_B2;\r\n\t#endif\r\n\r\n\t// special tweaking\r\n\t//////////////////////////////////////////\r\n\t\tuniform float lightingFixedFactor;\r\n\t\tuniform float lightingGlobalFactor;\r\n\r\n\t\tuniform float ambientBoostFactor;\r\n\r\n\t// evaluation\r\n\t//////////////////////////////////////////\r\n\r\n\tvec3 evaluateSceneLighting(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\r\n\t\t// evaluate the main light\r\n\t\tfloat dotVal \x3d mix(clamp(-dot(normal, lightingMainDirection), 0.0, 1.0), 1.0, lightingFixedFactor);\r\n\t\tvec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\r\n\r\n\t\t// evaluate the sh ambient light\r\n\t\t#if SH_ORDER \x3d\x3d 0\r\n\t\t\tvec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\r\n\t\t#elif SH_ORDER \x3d\x3d 1\r\n\t\t\tvec4 sh0 \x3d vec4(\r\n\t\t\t\t0.282095,\r\n\t\t\t\t0.488603 * normal.x,\r\n\t\t\t\t0.488603 * normal.z,\r\n\t\t\t\t0.488603 * normal.y\r\n\t\t\t);\r\n\t\t\tvec3 ambientLight \x3d vec3(\r\n\t\t\t\tdot(lightingAmbientSH_R, sh0),\r\n\t\t\t\tdot(lightingAmbientSH_G, sh0),\r\n\t\t\t\tdot(lightingAmbientSH_B, sh0)\r\n\t\t\t);\r\n\t\t#elif SH_ORDER \x3d\x3d 2\r\n\t\t\tvec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\r\n\r\n\t\t\tvec4 sh1 \x3d vec4(\r\n\t\t\t\t0.488603 * normal.x,\r\n\t\t\t\t0.488603 * normal.z,\r\n\t\t\t\t0.488603 * normal.y,\r\n\t\t\t\t1.092548 * normal.x * normal.y\r\n\t\t\t);\r\n\t\t\tvec4 sh2 \x3d vec4(\r\n\t\t\t\t1.092548 * normal.y * normal.z,\r\n\t\t\t\t0.315392 * (3.0 * normal.z * normal.z - 1.0),\r\n\t\t\t\t1.092548 * normal.x * normal.z,\r\n\t\t\t\t0.546274 * (normal.x * normal.x - normal.y * normal.y)\r\n\t\t\t);\r\n\t\t\tambientLight +\x3d vec3(\r\n\t\t\t\tdot(lightingAmbientSH_R1, sh1),\r\n\t\t\t\tdot(lightingAmbientSH_G1, sh1),\r\n\t\t\t\tdot(lightingAmbientSH_B1, sh1)\r\n\t\t\t);\r\n\t\t\tambientLight +\x3d vec3(\r\n\t\t\t\tdot(lightingAmbientSH_R2, sh2),\r\n\t\t\t\tdot(lightingAmbientSH_G2, sh2),\r\n\t\t\t\tdot(lightingAmbientSH_B2, sh2)\r\n\t\t\t);\r\n\t\t#endif\r\n\t\tambientLight *\x3d (1.0 - ssao);\r\n\r\n\t\t// inverse gamma correction on the albedo color\r\n\t\tfloat gamma \x3d 2.1;\r\n\t\tvec3 albedoGammaC \x3d pow(albedo, vec3(gamma));\r\n\r\n\t\t// physically correct BRDF normalizes by PI\r\n\t\tconst float PI \x3d 3.14159;\r\n\t\tvec3 totalLight \x3d mainLight + ambientLight + additionalLight;\r\n\t\ttotalLight \x3d min(totalLight, vec3(PI, PI, PI));\r\n\t\tvec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\r\n\r\n\t\t// apply gamma correction to the computed color\r\n\t\toutColor \x3d pow(outColor, vec3(1.0/gamma));\r\n\r\n\t\treturn outColor;\r\n\t}\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"sceneLightingAdditionalLightGlobal"\x3e\x3c![CDATA[\r\n\t// heuristic lighting model originally used in the terrain shading\r\n\t// now used to generated additional ambient light\r\n\t#ifdef VIEWING_MODE_GLOBAL\r\n\t\tfloat vndl \x3d -dot(normalize(vpos + localOrigin), lightingMainDirection);\r\n\t#else\r\n\t\tfloat vndl \x3d -dot(vec3(0,0,1), lightingMainDirection);\r\n\t#endif\r\n\tfloat additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\r\n\tvec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"normal2envTC"\x3e\x3c![CDATA[\r\n\tvec2 normal2envTC(vec3 normal) {\r\n\t\tfloat v \x3d .5 + .5 * asin(normal.y) * 0.63661977;\r\n\t\tfloat u \x3d .5 - .5 * atan(normal.z, normal.x) * 0.31830988;\r\n\t\treturn vec2(u, v);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderShowDepth"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tattribute vec2 $position;\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\r\n\tvoid main(void) {\r\n\t\tgl_Position \x3d proj * vec4($position.x, $position.y, .0, 1.0);\r\n\t\tvtc \x3d $uv0;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\t\x3csnippet name\x3d"fragmentShaderShowDepth"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D depthTex;\r\n\tvarying vec2 vtc;\r\n\t$rgba2float\r\n\tvoid main() {\r\n\t//\tgl_FragColor \x3d vec4(vec3(texture2D(depthTex, vtc).a), 1.0);\r\n\t\tgl_FragColor \x3d vec4(rgba2float(texture2D(depthTex, vtc)));\r\n\t//\tgl_FragColor \x3d texture2D(depthTex, vtc);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsUVQuad"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec2 $position;\r\n\tvarying vec2 uv;\r\n\r\n\tvoid main(void) {\r\n\t\tgl_Position \x3d vec4($position.x, $position.y, .0, 1.0);\r\n\t\tuv \x3d $position * .5 + vec2(.5);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"toScreenCoords"\x3e\x3c![CDATA[\r\n\tvec4 toScreenCoords(vec3 vertex) {\r\n\t\tvec4 vClipSpace \x3d proj * view * vec4((model * vec4(vertex, 1.0)).xyz, 1.0);\r\n\t\tvClipSpace.xy *\x3d screenSize;\r\n\t\treturn vClipSpace/abs(vClipSpace.w);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vvUniforms"\x3e\x3c![CDATA[\r\n#if defined(VV_SIZE)\r\n\t#define VV_CUSTOM_MODEL_MATRIX\r\n#endif\r\n\r\n#if defined(VV_SIZE)\r\n\tuniform vec3 vvSizeMinSize;\r\n\tuniform vec3 vvSizeMaxSize;\r\n\tuniform vec3 vvSizeOffset;\r\n\tuniform vec3 vvSizeFactor;\r\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\r\n\tuniform vec3 vvSizeValue;\r\n#endif\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\tuniform mat3 vvSymbolRotation;\r\n#endif\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\tuniform vec3 vvSymbolAnchor;\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n\t#define VV_COLOR_N 8\r\n\tuniform float vvColorValues[VV_COLOR_N];\r\n\tuniform vec4 vvColorColors[VV_COLOR_N];\r\n#endif\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vvFunctions"\x3e\x3c![CDATA[\r\n// Evaluation of size\r\n#if defined(VV_SIZE)\r\n\tvec3 vvGetScale(vec4 featureAttribute) {\r\n\t\treturn clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\r\n\t}\r\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\r\n\tvec3 vvGetScale(vec4 featureAttribute) {\r\n\t\treturn vvSizeValue;\r\n\t}\r\n#endif\r\n\r\n// Applying the model matrix\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\tvec4 vvTransformPosition(vec3 position, vec4 featureAttribute) {\r\n\t\treturn vec4(vvSymbolRotation * (vvGetScale(featureAttribute) * (position + vvSymbolAnchor)), 1.0);\r\n\t}\r\n\r\n\tvec4 vvTransformNormal(vec3 normal, vec4 featureAttribute) {\r\n\t\t// Normal transform is the inverse transpose of model transform\r\n\t\treturn vec4(vvSymbolRotation * normal / vvGetScale(featureAttribute), 1.0);\r\n\t}\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n\tvec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\r\n\t\tfloat value \x3d featureAttribute.y;\r\n\t\tif (value \x3c\x3d values[0]) {\r\n\t\t\treturn colors[0];\r\n\t\t}\r\n\r\n\t\tfor (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n\t\t\tif (values[i] \x3e\x3d value) {\r\n\t\t\t\tfloat f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\r\n\t\t\t\treturn mix(colors[i-1], colors[i], f);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn colors[VV_COLOR_N - 1];\r\n\t}\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"rgb2hsv"\x3e\x3c![CDATA[\r\nvec3 rgb2hsv(vec3 c)\r\n{\r\n\tvec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\r\n\tvec4 p \x3d mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\r\n\tvec4 q \x3d mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\r\n\r\n\tfloat d \x3d q.x - min(q.w, q.y);\r\n\tfloat e \x3d 1.0e-10;\r\n\treturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\r\n}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"hsv2rgb"\x3e\x3c![CDATA[\r\nvec3 hsv2rgb(vec3 c)\r\n{\r\n\tvec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\r\n\tvec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\r\n\treturn c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\r\n}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"colorMixMode"\x3e\x3c![CDATA[\r\n$rgb2hsv\r\n$hsv2rgb\r\n\r\n\r\n/*\r\n * The color mix modes are encoded in the symbol color as follows:\r\n *  - Fully transparent symbols are represented with alpha 0 for\r\n *    all color mix modes (except ignore).\r\n *  - color mix mode ignore is encoded as multiply with white\r\n *  - the other 3 color mix modes (tint, replace, multiply) are\r\n *    equally distributed on the remaining 255 alpha values, which\r\n *    gives us 85 possible alpha values\r\n *\r\n * alpha             0 : fully transparent\r\n * alpha in [  1 -  85]: tint\r\n * alpha in [ 86 - 170]: replace\r\n * alpha in [171 - 255]: multiply\r\n */\r\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\r\n  float symbolAlpha \x3d 0.0;\r\n\r\n  const float maxTint \x3d 85.0;\r\n  const float maxReplace \x3d 170.0;\r\n  const float scaleAlpha \x3d 3.0;\r\n\r\n  if (symbolColor.a \x3d\x3d 0.0) {\r\n    colorMixMode \x3d 1; // fully transparent -\x3e multiply\r\n    symbolAlpha \x3d 0.0;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxTint) {\r\n    colorMixMode \x3d 0; // tint\r\n    symbolAlpha \x3d scaleAlpha * symbolColor.a;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxReplace) {\r\n    colorMixMode \x3d 3; // replace\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\r\n  }\r\n  else {\r\n    colorMixMode \x3d 1;  // multiply\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\r\n  }\r\n\r\n  return vec4(symbolColor.rgb, symbolAlpha);\r\n}\r\n\r\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  vec3 internalMixed \x3d internalColor * textureColor;\r\n  vec3 allMixed \x3d internalMixed * externalColor;\r\n\r\n  if (mode \x3d\x3d 1 /* multiply */) {\r\n    return allMixed;\r\n  }\r\n  else if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalColor;\r\n  }\r\n  else {\r\n    // tint (or something invalid)\r\n    vec3 hsvIn \x3d rgb2hsv(internalMixed);\r\n    vec3 hsvTint \x3d rgb2hsv(externalColor);\r\n    vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\r\n    return hsv2rgb(hsvOut);\r\n  }\r\n}\r\n\r\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  float internalMixed \x3d internalOpacity * textureOpacity;\r\n  float allMixed \x3d internalMixed * externalOpacity;\r\n\r\n  if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalOpacity;\r\n  }\r\n  else {\r\n    // multiply or tint (or something invalid)\r\n    return allMixed;\r\n  }\r\n}\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"highlightWrite"\x3e\x3c![CDATA[\r\n  // the following uniforms are common to all highlight shaders:\r\n  // uniform sampler2D depthTex\r\n  // uniform vec4 highlightViewportPixelSz\r\n  float sceneDepth \x3d texture2D(depthTex, (gl_FragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;\r\n  if (gl_FragCoord.z \x3e sceneDepth + 5e-6) {\r\n    gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\r\n  }\r\n  else {\r\n    gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"screenSizePerspective"\x3e\x3c![CDATA[\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n// These could be functions, but I wanted to make sure that they are inlined. Additionally,\r\n// as macros, applying the scale works also for different types (float, vec2, etc).\r\n// Note that the implementation here should be kept in sync with the corresponding\r\n// CPU implementation (used for hitTest etc) in screenSizePerspectiveUtils.ts\r\n\r\n// Transform the input minimum size (factor.z) so that, when comparing to it, we are\r\n// excluding the \'padding\' size (factor.w).\r\n#define screenSizePerspectiveMinSize(/* float */ size, /* vec4 */ factor) (factor.z * (1.0 + 2.0 * factor.w  / size))\r\n\r\n#define screenSizePerspectiveFactor(/* float */ absCosAngle) (absCosAngle * absCosAngle * absCosAngle)\r\n\r\n#define screenSizePerspectiveScaleFactor(/* float */ absCosAngle, /* float */ distanceToCamera, /* vec4 */ params) vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveFactor(absCosAngle), params.z, params.w)\r\n\r\n// Factor is computed from screenSizePerspectiveScaleFactor\r\n#define applyScreenSizePerspectiveScaleFactorFloat(/* float */ size, /* vec4 */ factor) max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor))\r\n#define screenSizePerspectiveScaleFloat(/* float */ size, /* float */ absCosAngle, /* float */ distanceToCamera, /* vec4 */ params) applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params))\r\n\r\n#define applyScreenSizePerspectiveScaleFactorVec2(/* vec2 */ size, /* vec4 */ factor) mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y)\r\n#define screenSizePerspectiveScaleVec2(/* vec2 */ size, /* float */ absCosAngle, /* float */ distanceToCamera, /* vec4 */ params) applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params))\r\n\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"computeNormal"\x3e\x3c![CDATA[\r\n\t#ifdef GROUND_NORMAL_SHADING\r\n\t\t#ifdef VIEWING_MODE_GLOBAL\r\n\t\t\tvec3 normal \x3d normalize(vpos + localOrigin);\r\n\t\t#else\r\n\t\t\tvec3 normal \x3d vec3(0,0,1);\r\n\t\t#endif\r\n\t#else\r\n\t\t\t// compute normal\r\n\t\t#ifndef DOUBLESIDED\r\n\t\t\t\tvec3 normal \x3d vnormal;\r\n\t\t#else\r\n\t\t\t\tvec3 normal \x3d dot(vnormal, viewDir)\x3e0.0 ? -vnormal : vnormal;\r\n\t\t#endif\r\n\t\tnormal \x3d normalize(normal);\r\n\t#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/hud.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"commonAttributesAndUniformsHUD"\x3e\x3c![CDATA[\r\n  attribute vec3 $position;\r\n  attribute vec3 $normal;\r\n  attribute vec4 $auxpos1;\r\n\r\n  uniform mat4 proj;\r\n\r\n  uniform mat4 view;\r\n  uniform mat4 viewNormal;\r\n\r\n  uniform mat4 model;\r\n  uniform mat4 modelNormal;\r\n\r\n  uniform vec4 viewport;\r\n\r\n  uniform vec3 camPos;\r\n\r\n  uniform float polygonOffset;\r\n  uniform float cameraGroundRelative;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\r\n  // [ screenLength, distanceFactor, minWorldLength, maxWorldLength ]\r\n  uniform vec4 verticalOffset;\r\n\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  // [ divisor, offset, minPixelSize, paddingPixels ]\r\n  uniform vec4 screenSizePerspectiveAlignment;\r\n\r\n#endif\r\n\r\n  uniform sampler2D hudVisibilityTexture;\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"projectPositionHUD"\x3e\x3c![CDATA[\r\n  $screenSizePerspective\r\n\r\n  // Corresponds to cos(10 deg), used to compare against dot product of two vectors\r\n  const float SMALL_OFFSET_ANGLE \x3d 0.984807753012208;\r\n\r\n  struct ProjectHUDAux {\r\n    vec3 posModel;\r\n    vec3 posView;\r\n    vec3 vnormal;\r\n\r\n    float distanceToCamera;\r\n    float absCosAngle;\r\n  };\r\n\r\n\r\n  /**\r\n   * Apply the simulated polygon offset for HUD objects that improves\r\n   * issues with Z-fighting.\r\n   *\r\n   * @param posView {vec3} (inout) the position in view space. Will be modified in place.\r\n   * @param pointGroundDistance {float} the distance from the point geometry to the ground surface.\r\n   * @param absCosAngle {float} the absolute cosine of the angle between the world-up at the point geometry\r\n   *   and the view direction.\r\n   *\r\n   * Dependencies:\r\n   *\r\n   *   Attributes:\r\n   *     - auxpos1: contains centerOffset and pointGroundDistance\r\n   *\r\n   *   Uniforms:\r\n   *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n   *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\r\n   *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\r\n   *         reduced flickering.\r\n   *     - viewport: the viewport [x, y, width, height]\r\n   */\r\n  float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\r\n    float pointGroundSign \x3d sign(pointGroundDistance);\r\n\r\n    if (pointGroundSign \x3d\x3d 0.0) {\r\n      pointGroundSign \x3d 1.0;\r\n    }\r\n\r\n    // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\r\n    // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\r\n    float groundRelative \x3d cameraGroundRelative * pointGroundSign;\r\n\r\n    // view angle dependent part of polygon offset emulation\r\n    // we take the absolute value because the sign that is dropped is\r\n    // instead introduced using the ground-relative position of the symbol and the camera\r\n    if (polygonOffset \x3e .0) {\r\n      float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\r\n\r\n      float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\r\n      float factor \x3d (1.0 - tanAlpha / viewport[2]);\r\n\r\n      // same side of the terrain\r\n      if (groundRelative \x3e 0.0) {\r\n        posView *\x3d factor;\r\n      }\r\n      // opposite sides of the terrain\r\n      else {\r\n        posView /\x3d factor;\r\n      }\r\n    }\r\n\r\n    return groundRelative;\r\n  }\r\n\r\n  /**\r\n   * Project the 3d position of a HUD object from world space to clip space. In addition\r\n   * to standard model view projection, it also emulates a polygon offset to\r\n   * help with points above/below ground and icon flickering. The resulting location\r\n   * is the anchor of the HUD object, i.e. the position that is used also for testing\r\n   * visibility of the HUD object. Note that the returned projected position is not\r\n   * aligned to a pixel center or border, it is up to the caller to align if necessary.\r\n   *\r\n   * Dependencies:\r\n   *\r\n   *   Attributes:\r\n   *     - position: contains the point world position\r\n   *     - normal: contains the world normal pointing up at the point\r\n   *     - auxpos1: contains centerOffset and pointGroundDistance\r\n   *\r\n   *   Uniforms:\r\n   *     - model: the object -\x3e world transformation matrix\r\n   *     - modelNormal: the object -\x3e world normal transformation matrix (inv transp of model)\r\n   *     - view: the world -\x3e view transformation matrix\r\n   *     - viewNormal: the world -\x3e view normal transformation matrix (inv transp of view)\r\n   *     - proj: the view -\x3e clip projection matrix\r\n   *     - verticalOffset: a vec4 containing:\r\n   *         - the screen height of the vertical offset\r\n   *         - the screen height of the vertical offset as a fraction of camera distance.\r\n   *         - the minimum world size vertical offset.\r\n   *         - the maximum world size vertical offset.\r\n   *       This will do a screen sized offset of the point along its normal (used for line callouts)\r\n   *     - screenSizePerspectiveAlignment: a vec3 containing\r\n   *         - the view distance dependent divisor\r\n   *         - the view distance dependent offset\r\n   *         - the minimum pixel size\r\n   *         - the amount of padding in pixels around the region to be scaled (not used for alignment)\r\n   *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n   *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\r\n   *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\r\n   *         reduced flickering.\r\n   *     - camPos: the position of the camera in world space\r\n   *     - viewport: the viewport [x, y, width, height]\r\n   */\r\n  vec4 projectPositionHUD(out ProjectHUDAux aux) {\r\n    // centerOffset is in view space and is used to implement world size offsetting\r\n    // of labels with respect to objects. It also pulls the label towards the viewer\r\n    // so that the label is visible in front of the object.\r\n    vec3 centerOffset \x3d $auxpos1.xyz;\r\n\r\n    // The pointGroundDistance is the distance of the geometry to the ground and is\r\n    // negative if the point is below the ground, or positive if the point is above\r\n    // ground.\r\n    float pointGroundDistance \x3d $auxpos1.w;\r\n\r\n    aux.posModel \x3d (model * vec4($position, 1.0)).xyz;\r\n    aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\r\n    aux.vnormal \x3d (modelNormal * vec4($normal, 1.0)).xyz;\r\n\r\n    // Screen sized offset in world space, used for example for line callouts\r\n    // Note: keep this implementation in sync with the CPU implementation, see\r\n    //   - MaterialUtil.verticalOffsetAtDistance\r\n    //   - HUDMaterial.applyVerticalOffsetTransformation\r\n\r\n    aux.distanceToCamera \x3d length(aux.posView);\r\n\r\n    vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\r\n    float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\r\n\r\n    aux.absCosAngle \x3d abs(cosAngle);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n#if defined(VERTICAL_OFFSET) || defined(CENTER_OFFSET_UNITS_SCREEN)\r\n    vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);\r\n#endif\r\n\r\n#endif\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n    float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);\r\n#else\r\n    float verticalOffsetScreenHeight \x3d verticalOffset.x;\r\n#endif\r\n\r\n    float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\r\n    vec3 modelOffset \x3d aux.vnormal * worldOffset;\r\n\r\n    aux.posModel +\x3d modelOffset;\r\n\r\n    vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\r\n    aux.posView +\x3d viewOffset;\r\n\r\n    // Since we elevate the object, we need to take that into account\r\n    // in the distance to ground\r\n    pointGroundDistance +\x3d worldOffset;\r\n\r\n#endif\r\n\r\n    float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\r\n\r\n#ifndef CENTER_OFFSET_UNITS_SCREEN\r\n    // Apply x/y in view space, but z in screen space (i.e. along posView direction)\r\n    aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0);\r\n\r\n    // Same material all have same z !\x3d 0.0 condition so should not lead to\r\n    // branch fragmentation and will save a normalization if it\'s not needed\r\n    if (centerOffset.z !\x3d 0.0) {\r\n      aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\r\n    }\r\n#endif\r\n\r\n    vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\r\n\r\n#ifdef CENTER_OFFSET_UNITS_SCREEN\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n    float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);\r\n#else\r\n    float centerOffsetY \x3d centerOffset.y;\r\n#endif\r\n\r\n    posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * 2.0 / viewport.zw * posProj.w;\r\n\r\n#endif\r\n\r\n    // constant part of polygon offset emulation\r\n    posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\r\n\r\n    return posProj;\r\n  }\r\n\r\n  /**\r\n   * Test for visibility of a HUD object.\r\n   *\r\n   * Dependencies:\r\n   *\r\n   *   Uniforms:\r\n   *     - hudVisibilityTexture: the texture that contains the visibility information\r\n   *     - markerColor: the special marker color that is used to write visibility information\r\n   *     - viewport: the viewport\r\n   */\r\n  bool testVisibilityHUD(vec4 posProj) {\r\n    // For occlusion testing, use the nearest pixel center to avoid\r\n    // subpixel filtering messing up the color we use to test for\r\n    vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\r\n\r\n    return texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w).r \x3e 0.0;\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/BillboardMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderBillboard"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tuniform mat4 modelNormal;\r\n\tattribute vec3 $position;\r\n\tattribute vec3 $normal;\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\tvarying vec3 vnormal;\r\n\tconst float size \x3d 1.05;\r\n\r\n\tvoid main(void) {\r\n\t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\r\n\t\tvec2 uv01 \x3d floor($uv0);\r\n\t\tvec2 uv \x3d $uv0 - uv01;\r\n\t\tvec3 zDir \x3d normalize(-pos);\r\n\t\tvec3 xDir \x3d normalize(cross(vec3(.0, 1.0, .0), zDir));\r\n\t\tvec3 yDir \x3d cross(zDir, xDir);\r\n\t\tpos +\x3d xDir * (uv01.x - .5) * size;\r\n\t\tpos +\x3d yDir * (uv01.y - .5) * size;\r\n\t\tvec4 pos4 \x3d proj * vec4(pos, 1.0);\r\n\t\tgl_Position \x3d pos4;\r\n\t\tvtc \x3d uv;\r\n\t\tvnormal \x3d normalize((modelNormal * vec4($normal, 1.0)).xyz);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderBillboard"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform vec4 lightAmbient;\r\n\tuniform vec4 lightDiffuse;\r\n\tuniform vec3 lightDirection;\r\n\tuniform sampler2D tex;\r\n\tvarying vec2 vtc;\r\n\tvarying vec3 vnormal;\r\n\r\n\tvoid main() {\r\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\r\n\t\tif (texColor.a \x3c .15) discard;\r\n\t\tgl_FragColor \x3d texColor;\r\n\t\tgl_FragColor.rgb *\x3d lightAmbient.rgb * lightAmbient.w + lightDiffuse.rgb * lightDiffuse.w * dot(lightDirection, vnormal);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderBillboardDepth"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tuniform vec2 nearFar;\r\n\tattribute vec3 $position;\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\tvarying float depth;\r\n\tconst float size \x3d 1.05;\r\n\r\n\tvoid main(void) {\r\n\t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\r\n\t\tvec2 uv01 \x3d floor($uv0);\r\n\t\tvec2 uv \x3d $uv0 - uv01;\r\n\t\tpos.x +\x3d (uv01.x - .5) * size;\r\n\t\tpos.y +\x3d (uv01.y - .5) * size;\r\n\t\tvec4 eye \x3d vec4(pos, 1.0);\r\n\t\tgl_Position \x3d proj * eye;\r\n\t\tdepth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\r\n\t\tvtc \x3d uv;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/ColorMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderColorMaterial"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\r\n\tattribute vec3 $position;\r\n\tattribute vec4 $color;\r\n\r\n\tvarying vec4 vColor;\r\n\r\n\tvoid main(void) {\r\n\t\tvColor \x3d $color * 0.003921568627451; // \x3d 1/255;\r\n\t\tgl_Position \x3d proj * view * vec4((model * vec4($position, 1.0)).xyz, 1.0);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderColorMaterial"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform vec4 eColor;\r\n\tvarying vec4 vColor;\r\n\r\n\tvoid main() {\r\n\t\tgl_FragColor \x3d vColor * eColor;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/LineCalloutMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderLineCallout"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  $commonAttributesAndUniformsHUD\r\n\r\n  attribute vec2 $uv0;\r\n\r\n  uniform float lineSize;\r\n  uniform vec2 pixelToNDC;\r\n  uniform float borderSize;\r\n  uniform vec2 screenOffset;\r\n\r\n  varying vec4 coverageSampling;\r\n  varying vec2 lineSizes;\r\n\r\n  $alignToPixelOrigin\r\n  $alignToPixelCenter\r\n\r\n  $projectPositionHUD\r\n\r\n  void main(void) {\r\n    ProjectHUDAux projectAux;\r\n    vec4 endPoint \x3d projectPositionHUD(projectAux);\r\n\r\n#ifdef OCCL_TEST\r\n    if (!testVisibilityHUD(endPoint)) {\r\n      gl_Position \x3d vec4(1e38, 1e38, 1e38, 1);\r\n    }\r\n    else {\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n      vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\r\n      vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(screenOffset, perspectiveFactor);\r\n#else\r\n      vec2 screenOffsetScaled \x3d screenOffset;\r\n#endif\r\n\r\n      // Add view dependent polygon offset to get exact same original starting point. This is mostly\r\n      // used to get the correct depth value\r\n      vec3 posView \x3d (view * model * vec4($position, 1.0)).xyz;\r\n      applyHUDViewDependentPolygonOffset($auxpos1.w, projectAux.absCosAngle, posView);\r\n\r\n      vec4 startPoint \x3d proj * vec4(posView, 1);\r\n\r\n      // Apply screen offset to both start and end point\r\n      vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\r\n\r\n      startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\r\n      endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\r\n\r\n      // Align start and end to pixel origin\r\n      vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\r\n      vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\r\n\r\n#ifdef DEPTH_HUD\r\n\r\n#ifdef DEPTH_HUD_ALIGN_START\r\n      endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);\r\n#else\r\n      startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);\r\n#endif\r\n\r\n#endif\r\n\r\n      vec4 projectedPosition \x3d mix(startAligned, endAligned, $uv0.y);\r\n\r\n      // The direction of the line in screen space\r\n      vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\r\n      vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n      float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\r\n      float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\r\n\r\n#else\r\n\r\n      float lineSizeScaled \x3d lineSize;\r\n      float borderSizeScaled \x3d borderSize;\r\n\r\n#endif\r\n\r\n      float halfPixelSize \x3d lineSizeScaled * 0.5;\r\n\r\n      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\r\n      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\r\n      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\r\n      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\r\n      float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\r\n      float halfPixelSizeInt \x3d floor(halfWholePixelSize);\r\n\r\n      // Sub-pixel offset if we need to grow sub-pixels to the left\r\n      float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\r\n\r\n      // Pixel offset aligning to whole pixels and adding subpixel offset if needed\r\n      float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\r\n\r\n      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\r\n      float padding \x3d 1.0 + borderSizeScaled;\r\n      vec2 ndcOffset \x3d (pixelOffset - padding + $uv0 * (lineSizeScaled + padding + padding)) * pixelToNDC;\r\n\r\n      // Offset x/y from the center of the line in screen space\r\n      projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\r\n\r\n      // Compute a coverage varying which we can use in the fragment shader to determine\r\n      // how much a pixel is actually covered by the line (i.e. to anti alias the line).\r\n      // This works by computing two coordinates that can be linearly interpolated and then\r\n      // subtracted to find out how far away from the line edge we are.\r\n      float edgeDirection \x3d ($uv0.x * 2.0 - 1.0);\r\n\r\n      float halfBorderSize \x3d 0.5 * borderSizeScaled;\r\n      float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\r\n      float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\r\n\r\n      float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\r\n\r\n      coverageSampling \x3d vec4(\r\n        // Edge coordinate\r\n        outerEdgeCoverageSampler,\r\n\r\n        // Border edge coordinate\r\n        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\r\n\r\n        // Line offset\r\n        halfPixelSize - 0.5,\r\n\r\n        // Border offset\r\n        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\r\n      );\r\n\r\n      lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\r\n\r\n      gl_Position \x3d projectedPosition;\r\n\r\n#ifdef OCCL_TEST\r\n    }\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet\x3e\x3c![CDATA[\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderLineCallout"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform vec4 color;\r\n  uniform vec4 borderColor;\r\n\r\n  varying vec4 coverageSampling;\r\n  varying vec2 lineSizes;\r\n\r\n  void main() {\r\n    // Mix between line and border coverage offsets depending on whether we need\r\n    // a border (based on the sidedness).\r\n    vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\r\n\r\n    // Mix between border and line color based on the line coverage (conceptually the line\r\n    // blends on top of the border background).\r\n    //\r\n    // Anti-alias by blending final result using the full (including optional border) coverage\r\n    // and the color alpha\r\n    float borderAlpha \x3d color.a * borderColor.a * coverage.y;\r\n    float colorAlpha \x3d color.a * coverage.x;\r\n\r\n    float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\r\n\r\n#ifdef DEPTH_HUD\r\n\r\n    if (finalAlpha \x3c 0.01) {\r\n      discard;\r\n    }\r\n\r\n#else\r\n\r\n    // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\r\n    // need to divide by finalAlpha). We avoid the division here by setting the\r\n    // appropriate blending function in the material.\r\n    vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\r\n\r\n    gl_FragColor \x3d vec4(finalRgb, finalAlpha);\r\n\r\n#endif\r\n\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/LeafCardMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderLeafCard"\x3e\r\n\t\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tuniform mat4 modelNormal;\r\n\r\n\tuniform vec3 localOrigin;\r\n\r\n\tattribute vec3 $position;\r\n\tattribute vec4 $normal;\r\n\tattribute vec4 $uv0;\r\n\tvarying vec2 vtc;\r\n\tvarying vec3 vnormal;\r\n\tvarying float ambientLeaf;\r\n\r\n\tuniform float trafoScale;\r\n\tvarying vec3 vpos;\r\n\r\n\tvec2 rotate(vec2 pos, float angle) {\r\n\t\tfloat c \x3d cos(angle);\r\n\t\tfloat s \x3d sin(angle);\r\n\t\treturn vec2(c * pos.x - s * pos.y, s * pos.x + c * pos.y);\r\n\t}\r\n\r\n\tvoid main(void) {\r\n\r\n\t\tvpos \x3d (model * vec4($position, 1.0)).xyz;\r\n\r\n\t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\r\n\t\tvec2 uv01 \x3d floor($uv0.xy);\r\n\t\tvec2 uv \x3d $uv0.xy - uv01;\r\n\r\n   \t\tvec2 up \x3d rotate(vec2(1,0), $uv0.z);\r\n   \t\tvec3 xDir \x3d  vec3(up.x,up.y,0.0);\r\n   \t\tvec3 yDir \x3d  vec3(-up.y,up.x,0.0);\r\n\r\n\t\tpos +\x3d xDir * (uv01.x - .5) * $uv0.w *trafoScale;\r\n\t\tpos +\x3d yDir * (uv01.y - .5) * $uv0.w *trafoScale;;\r\n\t\tvec4 pos4 \x3d proj * vec4(pos, 1.0);\r\n\t\tgl_Position \x3d pos4;\r\n\t\tvtc \x3d uv;\r\n\t\tambientLeaf \x3d normal.w;\r\n\t\tvnormal \x3d normalize((modelNormal * vec4($normal.xyz, 1.0)).xyz);\r\n\t}\r\n]]\x3e\r\n\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderLeafCard"\x3e\r\n\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform vec3 camPos;\r\n\r\n\tuniform vec3 diffuse;\r\n\r\n\tuniform vec3 localOrigin;\r\n\r\n\tuniform sampler2D tex;\r\n\tvarying vec2 vtc;\r\n\tvarying vec3 vnormal;\r\n\tvarying float ambientLeaf;\r\n\r\n\tvarying vec3 vpos;\r\n\r\n\t$sceneLightingDefinitions\r\n\r\n\tvoid main() {\r\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\r\n\t\tif (texColor.a \x3c .33) discard;\r\n\r\n\t\tvec3 normal \x3d normalize(vnormal);\r\n\t\tvec3 albedo \x3d diffuse * ambientLeaf * texColor.rgb;\r\n\r\n\t\tfloat ssao \x3d 1.0;\r\n\r\n\t\t$sceneLightingAdditionalLightGlobal\r\n\r\n\t\tvec3 color \x3d evaluateSceneLighting(normal, albedo, 1.0, 1.0 - ssao, additionalLight);\r\n\r\n\t\tgl_FragColor \x3d vec4(color, texColor.a);\r\n\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\r\n\x3csnippet name\x3d"vertexShaderLeafCardDepth"\x3e\x3c![CDATA[\r\n    $vsprecisionf\r\n\r\n   \tuniform mat4 proj;\r\n   \tuniform mat4 view;\r\n   \tuniform mat4 model;\r\n   \tuniform vec2 nearFar;\r\n\r\n   \tattribute vec3 $position;\r\n   \tattribute vec4 $uv0;\r\n\r\n   \tuniform float trafoScale;\r\n\r\n   \tvarying vec2 vtc;\r\n   \tvarying float depth;\r\n\r\n   \tvec2 rotate(vec2 pos, float angle) {\r\n   \t\tfloat c \x3d cos(angle);\r\n   \t\tfloat s \x3d sin(angle);\r\n   \t\treturn vec2(c * pos.x - s * pos.y, s * pos.x + c * pos.y);\r\n   \t}\r\n\r\n   \tvoid main(void) {\r\n   \t\tvec3 pos \x3d (view * model * vec4($position, 1.0)).xyz;\r\n   \t\tvec2 uv01 \x3d floor($uv0.xy);\r\n   \t\tvec2 uv \x3d $uv0.xy - uv01;\r\n\r\n   \t\tvec2 up \x3d rotate(vec2(1,0), $uv0.z);\r\n   \t\tvec3 xDir \x3d  vec3(up.x,up.y,0.0);\r\n   \t\tvec3 yDir \x3d  vec3(-up.y,up.x,0.0);\r\n\r\n   \t\tpos +\x3d xDir * (uv01.x - .5) * $uv0.w*trafoScale;\r\n   \t\tpos +\x3d yDir * (uv01.y - .5) * $uv0.w*trafoScale;\r\n   \t\tvec4 pos4 \x3d proj * vec4(pos, 1.0);\r\n   \t\tgl_Position \x3d pos4;\r\n   \t\tvtc \x3d uv;\r\n\r\n   \t\tdepth \x3d (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\r\n\r\n   \t}\r\n ]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/Material.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"calculateVerticalOffset"\x3e\x3c![CDATA[\r\n  $viewingMode\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  // [ verticalOffsetPerDistance, minWorldLength, maxWorldLength ]\r\n  uniform vec4 verticalOffset;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  uniform vec4 screenSizePerspectiveAlignment;\r\n\r\n  $screenSizePerspective\r\n\r\n#endif\r\n\r\n  vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\r\n    float viewDistance \x3d length((view * vec4(worldPos, 1)).xyz);\r\n    float verticalOffsetOffsetDistance \x3d verticalOffset.x * viewDistance;\r\n\r\n#ifdef VIEWING_MODE_GLOBAL\r\n    vec3 worldNormal \x3d normalize(worldPos + localOrigin);\r\n#else\r\n    vec3 worldNormal \x3d vec3(0, 0, 1);\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n    float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\r\n\r\n    float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);\r\n#else\r\n    float verticalOffsetScreenHeight \x3d verticalOffset.x;\r\n#endif\r\n\r\n    // Screen sized offset in world space, used for example for line callouts\r\n    float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\r\n\r\n    return worldNormal * worldOffset;\r\n  }\r\n#endif\r\n]]\x3e\r\n\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsPhongSrc"\x3e\x3c![CDATA[\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n  uniform vec3 camPos;\r\n\r\n\tuniform vec3 localOrigin;\r\n\r\n#ifdef INSTANCED\r\n    attribute mat4 model;\r\n    attribute mat4 modelNormal;\r\n#else\r\n\tuniform mat4 model;\r\n\tuniform mat4 modelNormal;\r\n#endif\r\n#ifdef INSTANCEDCOLOR\r\n\tattribute vec4 instanceColor;\r\n#endif\r\n\tattribute vec3 $position;\r\n\tattribute vec3 $normal;\r\n\tvarying vec3 vpos;\r\n\tvarying vec3 vnormal;\r\n\r\n#ifdef VERTEXCOLORS\r\n\tattribute vec4 $color;\r\n#endif\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\n  attribute vec4 $symbolColor;\r\n#endif\r\n\r\n#if defined(VV_SIZE) || defined(VV_COLOR)\r\n\tattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n$vvUniforms\r\n\r\n#if defined(VERTEXCOLORS)\r\n\tvarying vec4 vcolor;\r\n#endif\r\n\r\n#if defined(INSTANCEDCOLOR) || defined(VV_COLOR) || defined(SYMBOLVERTEXCOLORS)\r\n\tuniform vec4 externalColor;\r\n\tvarying vec4 vcolorExt;\r\n#endif\r\n\r\n#if defined(SYMBOLVERTEXCOLORS)\r\n\tvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#endif\r\n\r\n\t$vvFunctions\r\n\r\n\t$colorMixMode\r\n\r\n  $calculateVerticalOffset\r\n\r\n\tvoid main(void) {\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\r\n\t\tvpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\r\n\t\tvnormal \x3d normalize((modelNormal * vvTransformNormal($normal, instanceFeatureAttribute)).xyz);\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\t\tvec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\r\n#endif\r\n\r\n#else /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n\t\tvpos \x3d (model * vec4($position, 1.0)).xyz;\r\n\t\tvnormal \x3d normalize((modelNormal * vec4($normal, 1.0)).xyz);\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\t\tvec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\r\n#endif\r\n\r\n#endif /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n\r\n\t\tgl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef VERTEXCOLORS\r\n\t\tvcolor \x3d $color * 0.003921568627451; // \x3d 1/255\r\n#endif\r\n\r\n#if defined(INSTANCEDCOLOR) || defined(VV_COLOR) || defined(SYMBOLVERTEXCOLORS)\r\n\t\tvcolorExt \x3d externalColor;\r\n#endif\r\n#ifdef INSTANCEDCOLOR\r\n\t\tvcolorExt *\x3d instanceColor;\r\n#endif\r\n#ifdef VV_COLOR\r\n\t\tvcolorExt *\x3d vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\r\n#endif\r\n#ifdef SYMBOLVERTEXCOLORS\r\n    int symbolColorMixMode;\r\n    vcolorExt *\x3d decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n    colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsPhongSrc"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n\tuniform vec3 camPos;\r\n\tuniform vec3 localOrigin;\r\n\r\n\t$sceneLightingDefinitions\r\n\r\n\t// material parameters\r\n\t//////////////////////////////////////////\r\n\tuniform vec3 ambient;\r\n\tuniform vec3 diffuse;\r\n\tuniform vec3 specular;\r\n\tuniform float shininess;\r\n\tuniform float opacity;\r\n\tuniform float layerOpacity;\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\n\tvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#else\r\n  uniform int colorMixMode;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n\tuniform sampler2D depthTex;\r\n\tuniform int shadowMapNum;\r\n\tuniform vec4 shadowMapDistance;\r\n\tuniform mat4 shadowMapMatrix[4];\r\n\tuniform float depthHalfPixelSz;\r\n#endif\r\n\r\n#ifdef RECEIVE_SSAO\r\n\tuniform sampler2D ssaoTex;\r\n\tuniform vec4 viewportPixelSz;\r\n#endif\r\n\r\n\r\n\tvarying vec3 vpos;\r\n\tvarying vec3 vnormal;\r\n#if defined(VERTEXCOLORS)\r\n\tvarying vec4 vcolor;\r\n#endif\r\n#if defined(INSTANCEDCOLOR) || defined(VV_COLOR) || defined(SYMBOLVERTEXCOLORS)\r\n\tvarying vec4 vcolorExt;\r\n#else\r\n\tuniform vec4 externalColor;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n\t$evalShadow\r\n#endif\r\n\r\n\t$colorMixMode\r\n\r\n\tvoid main() {\r\n\t\tvec3 viewDir \x3d normalize(vpos - camPos);\r\n\r\n\t\t$computeNormal\r\n\r\n\t\tvec3 reflDir \x3d normalize(reflect(viewDir, normal));\r\n\r\n\t\t// compute ssao\r\n\t\t#ifdef RECEIVE_SSAO\r\n\t\t\t\tfloat ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n\t\t\t\tssao \x3d viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\r\n\t\t#else\r\n\t\t\t\tfloat ssao \x3d 1.0;\r\n\t\t#endif\r\n\r\n\t\t// At global scale we create some additional ambient light based on the main light to simulate global illumination\r\n\t\t// This also defines "additionalAmbientScale" which might be used as a shadow fallback further down\r\n\t\t$sceneLightingAdditionalLightGlobal\r\n\r\n\t\t// compute shadowing\r\n\t\tfloat shadow \x3d 0.0;\r\n\t\t#ifdef RECEIVE_SHADOWS\r\n\t\t\tshadow \x3d evalShadow(vpos, 1.0 / gl_FragCoord.w, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n\t\t#elif defined(VIEWING_MODE_GLOBAL)\r\n\t\t\t// at global scale (and in global scenes) we fall back to this approximation\r\n\t\t\t// to shadow objects on the dark side of the earth\r\n\t\t\tshadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\r\n\t\t#endif\r\n\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"externalColorMix"\x3e\x3c![CDATA[\r\n\tvec3 matColor \x3d max(ambient, diffuse); // combine the old material parameters into a single one\r\n\t#if defined(VERTEXCOLORS) \x26\x26 (defined(INSTANCEDCOLOR) || defined(VV_COLOR) || defined(SYMBOLVERTEXCOLORS))\r\n\t\t\t// Internal colors: varying vcolor + uniform ambient/diffuse, external colors: varying vcolorExt\r\n\t\t\tvec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n\t\t\tfloat opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n\t#elif defined(VERTEXCOLORS)\r\n\t\t\t// Internal colors: varying vcolor + uniform ambient/diffuse, external colors: uniform externalColor\r\n\t\t\tvec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, externalColor.rgb, int(colorMixMode));\r\n\t\t\tfloat opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, externalColor.a, int(colorMixMode));\r\n\t#elif defined(INSTANCEDCOLOR) || defined(VV_COLOR) || defined(SYMBOLVERTEXCOLORS)\r\n\t\t\t// Internal colors: uniform ambient/diffuse, external colors: varying vcolorExt\r\n\t\t\tvec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n\t\t\tfloat opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n\t#else\r\n\t\t\t// Internal colors: uniform ambient/diffuse, external colors: uniform externalColor\r\n\t\t\tvec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, externalColor.rgb, int(colorMixMode));\r\n\t\t\tfloat opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, externalColor.a, int(colorMixMode));\r\n\t#endif\r\n\talbedo_+\x3d 0.25 * specular; // don\'t completely ignore specular for now\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsPhong"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\t$vsPhongSrc\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsPhong"\x3e\x3c![CDATA[\r\n\t\t$fsprecisionf\r\n\r\n\t\t$fsPhongSrc\r\n\r\n\t\tvec4 texColor \x3d vec4(1,1,1,1);\r\n\t\t$externalColorMix\r\n\r\n\t\tvec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n\t\tgl_FragColor \x3d vec4(shadedColor, opacity_);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsPhongTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\t$vsPhongSrc\r\n#ifndef FLIPV\r\n\t\tvtc \x3d $uv0;\r\n#else\r\n\t\tvtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsPhongTextured"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D tex;\r\n\tvarying vec2 vtc;\r\n\r\n\t$fsPhongSrc\r\n\r\n\t\t// read texture color\r\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\r\n\t\tif (texColor.a \x3c .33) discard;\r\n\r\n\t\t$externalColorMix\r\n\r\n\t\tvec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n\r\n\t\tgl_FragColor \x3d vec4(shadedColor, opacity_);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsPhongAtlasTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec4 $uv0;\r\n\tattribute vec4 $region;\r\n\tvarying vec2 vtc;\r\n\tvarying vec4 regionV;\r\n\t$vsPhongSrc\r\n#ifndef FLIPV\r\n\t\tvtc \x3d $uv0.xy;\r\n#else\r\n\t\tvtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n\t\tregionV \x3d $region/65535.0;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsPhongAtlasTextured"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D tex;\r\n\tuniform vec2 texSize;\r\n\tvarying vec2 vtc;\r\n\tvarying vec4 regionV;\r\n\r\n\tfloat calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\r\n\t\t// from:\r\n\t\t//   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\r\n\t\t//   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\r\n\t\t//   - http://www.linedef.com/virtual-texture-demo.html\r\n\t\tfloat deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\r\n\t\treturn max(0.5 * log2(deltaMaxSqr), 0.0);\r\n\t}\r\n\r\n\t$fsPhongSrc\r\n\r\n\t\tvec2 uv \x3d vtc;\r\n\t\tuv \x3d fract(uv);\r\n\t\t//[umin, vmin, umax, vmax]\r\n\r\n\t\tvec2 atlasScale \x3d regionV.zw - regionV.xy;\r\n\t\tuv \x3d uv.xy * atlasScale + regionV.xy;\r\n\r\n\t\tvec4 texColor;\r\n\t\t#ifdef GL_OES_standard_derivatives\r\n\t\t\t#extension GL_OES_standard_derivatives : enable\r\n\r\n\t\t\t// calculate derivative of continuous texture coordinate\r\n\t\t\t// to avoid mipmapping artifacts caused by manual wrapping in shader\r\n\t\t\tvec2 dUVdx \x3d dFdx(vtc) * atlasScale;\r\n\t\t\tvec2 dUVdy \x3d dFdy(vtc) * atlasScale;\r\n\r\n\t\t\t#ifdef GL_EXT_shader_texture_lod\r\n\t\t\t\t#extension GL_EXT_shader_texture_lod : enable\r\n\r\n\t\t\t\t// workaround for artifacts in Windows 10 using Intel HD Graphics 4000 series\r\n\t\t\t\t// see: https://devtopia.esri.com/Zurich-R-D-Center/arcgis-js-api-canvas3d-issues/issues/768\r\n\t\t\t\tconst float epsilon \x3d 1.0E-32;\r\n\t\t\t\tfloat zeroUVShift \x3d uv.x \x3d\x3d 0.0 \x26\x26 uv.y \x3d\x3d 0.0 ? epsilon : 0.0;\r\n\r\n\t\t\t\ttexColor \x3d texture2DGradEXT(tex, uv + zeroUVShift, dUVdx, dUVdy);\r\n\t\t\t#else\r\n\t\t\t\t// use bias to compensate for difference in automatic vs desired mipmap level\r\n\t\t\t\tvec2 dUVdxAuto \x3d dFdx(uv);\r\n\t\t\t\tvec2 dUVdyAuto \x3d dFdy(uv);\r\n\t\t\t\tfloat mipMapLevel \x3d calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\r\n\t\t\t\tfloat autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\r\n\t\t\t\ttexColor \x3d texture2D(tex, uv, mipMapLevel - autoMipMapLevel);\r\n\t\t\t#endif\r\n\t\t#else\r\n\t\t\ttexColor \x3d texture2D(tex, uv);\r\n\t\t#endif\r\n\r\n\t\tif (texColor.a \x3c .33) discard;\r\n\r\n\t\t$externalColorMix\r\n\r\n\t\tvec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n\t\tgl_FragColor \x3d vec4(shadedColor, opacity_);\r\n\t}\r\n\t]]\x3e\x3c/snippet\x3e\r\n\r\n\t\x3csnippet name\x3d"fsPhongTexturedRefl"\x3e\x3c![CDATA[\r\n\t\t$fsprecisionf\r\n\r\n\t\tuniform sampler2D tex;\r\n\t\tuniform sampler2D reflTex;\r\n\t\tuniform float reflectivity;\r\n\t\tvarying vec2 vtc;\r\n\r\n\t\t$normal2envTC\r\n\r\n\t\t$fsPhongSrc\r\n\t\tvec4 texColor \x3d texture2D(tex, vtc);\r\n\t\tif (texColor.a \x3c .33) discard;\r\n\t\tvec4 reflColor \x3d texture2D(reflTex, normal2envTC(reflDir));\r\n\r\n\t\t$externalColorMix\r\n\r\n\t\tvec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n\t\tshadedColor.rgb \x3d mix(shadedColor.rgb, reflColor.rgb, reflectivity);\r\n\r\n\t\tgl_FragColor \x3d vec4(shadedColor, opacity_);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsDepthSrc"\x3e\x3c![CDATA[\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n  uniform vec3 camPos;\r\n  uniform vec3 localOrigin;\r\n\r\n#ifdef INSTANCED\r\n\tattribute mat4 model;\r\n  attribute mat4 modelNormal;\r\n#else\r\n\tuniform mat4 model;\r\n  uniform mat4 modelNormal;\r\n#endif\r\n\tuniform vec2 nearFar;\r\n\tattribute vec3 $position;\r\n\tvarying float depth;\r\n\r\n\t$vvUniforms\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\n\tattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\t$vvFunctions\r\n\r\n  $calculateVerticalOffset\r\n\r\n\tvoid main(void) {\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\r\n    vec3 vpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\r\n#endif\r\n\r\n#else /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n\t\tvec3 vpos \x3d (model * vec4($position, 1.0)).xyz;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\t\tvec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\r\n#endif\r\n\r\n#endif /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n\r\n    vec4 eye \x3d view * vec4(vpos, 1);\r\n\r\n\t\tgl_Position \x3d proj * eye;\r\n\t\tdepth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsDepth"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\t$vsDepthSrc\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsDepthTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\t$vsDepthSrc\r\n#ifndef FLIPV\r\n        vtc \x3d $uv0;\r\n#else\r\n        vtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsNormalSrc"\x3e\x3c![CDATA[\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n  uniform vec3 camPos;\r\n  uniform vec3 localOrigin;\r\n\r\n#ifdef INSTANCED\r\n\tattribute mat4 model;\r\n\tattribute mat4 modelNormal;\r\n#else\r\n\tuniform mat4 model;\r\n\tuniform mat4 modelNormal;\r\n#endif\r\n\tuniform mat4 viewNormal;\r\n\tattribute vec3 $position;\r\n\tattribute vec3 $normal;\r\n\tvarying vec3 vnormal;\r\n\r\n\t$vvUniforms\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\n\tattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\t$vvFunctions\r\n\r\n  $calculateVerticalOffset\r\n\r\n\tvoid main(void) {\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\r\n    vec3 vpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\r\n\t\tvnormal \x3d normalize((viewNormal * modelNormal * vvTransformNormal($normal, instanceFeatureAttribute)).xyz);\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\r\n#endif\r\n\r\n#else /* VV_CUSTOM_MODEL_MATRIX */\r\n\t\tvec3 vpos \x3d (model * vec4($position, 1.0)).xyz;\r\n\t\tvnormal \x3d normalize((viewNormal * modelNormal * vec4($normal, 1.0)).xyz);\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\r\n#endif\r\n\r\n#endif /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n\r\n    gl_Position \x3d proj * view * vec4(vpos, 1);\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsNormal"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\t$vsNormalSrc\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsNormalTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\t$vsNormalSrc\r\n#ifndef FLIPV\r\n\t\tvtc \x3d $uv0;\r\n#else\r\n\t\tvtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsHighlightSrc"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n  uniform vec3 camPos;\r\n  uniform vec3 localOrigin;\r\n\r\n#ifdef INSTANCED\r\n\tattribute mat4 model;\r\n  attribute mat4 modelNormal;\r\n#else\r\n\tuniform mat4 model;\r\n  uniform mat4 modelNormal;\r\n#endif\r\n\tattribute vec3 $position;\r\n\r\n\t$vvUniforms\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\n\tattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\t$vvFunctions\r\n\r\n  $calculateVerticalOffset\r\n\r\n\tvoid main(void) {\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n\r\n    vec3 vpos \x3d (model * vvTransformPosition($position, instanceFeatureAttribute)).xyz;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute)).xyz;\r\n#endif\r\n\r\n#else /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n    vec3 vpos \x3d (model * vec4($position, 1.0)).xyz;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * vec4(vec3(0, 0, 0), 1.0)).xyz;\r\n#endif\r\n\r\n#endif /* VV_CUSTOM_MODEL_MATRIX */\r\n\r\n#ifdef VERTICAL_OFFSET\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n\r\n\t\tgl_Position \x3d proj * view * vec4(vpos, 1);\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsHighlight"\x3e\x3c![CDATA[\r\n\t$vsHighlightSrc\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsHighlightTextured"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\t$vsHighlightSrc\r\n#ifndef FLIPV\r\n\t\tvtc \x3d $uv0;\r\n#else\r\n\t\tvtc \x3d vec2($uv0.x, 1.0-$uv0.y);\r\n#endif\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsDepthSrc"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\tvarying float depth;\r\n\r\n\tvoid main() {\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsDepth"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\t$calcFragDepth\r\n\t$float2rgba\r\n\t$fsDepthSrc\r\n#ifndef BIAS_SHADOWMAP\r\n\t\tgl_FragColor \x3d float2rgba(depth);\r\n#else\r\n\t\tgl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n#endif\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsDepthTextured"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform sampler2D tex;\r\n\tvarying vec2 vtc;\r\n\t$calcFragDepth\r\n\t$float2rgba\r\n\r\n\t$fsDepthSrc\r\n\t\tif (texture2D(tex, vtc).a \x3c .33) discard;\r\n#ifndef BIAS_SHADOWMAP\r\n\t\tgl_FragColor \x3d float2rgba(depth);\r\n#else\r\n\t\tgl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n#endif\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsNormal"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tvarying vec3 vnormal;\r\n\tvoid main() {\r\n\t\tvec3 normal \x3d normalize(vnormal);\r\n\t\tif (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n\r\n#ifndef ALPHA_ZERO\r\n\t\tgl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n#else\r\n\t\tgl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n#endif\r\n\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsNormalTextured"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tvarying vec3 vnormal;\r\n\tvarying vec2 vtc;\r\n\tuniform sampler2D tex;\r\n\tvoid main() {\r\n\t\tif (texture2D(tex, vtc).a \x3c .33) discard;\r\n\t\tvec3 normal \x3d normalize(vnormal);\r\n\t\tif (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n#ifndef ALPHA_ZERO\r\n\t\tgl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n#else\r\n\t\tgl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n#endif\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsHighlight"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n  uniform sampler2D depthTex;\r\n  uniform vec4 highlightViewportPixelSz;\r\n\r\n\tvoid main() {\r\n\t\t$highlightWrite\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsHighlightTextured"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tvarying vec2 vtc;\r\n\tuniform sampler2D tex;\r\n  uniform sampler2D depthTex;\r\n  uniform vec4 highlightViewportPixelSz;\r\n\r\n\tvoid main() {\r\n\t\tif (texture2D(tex, vtc).a \x3c .33) discard;\r\n\r\n\t\t$highlightWrite\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/RibbonLineMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsRibbonLine"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\r\n\tuniform float extLineWidth;\r\n\tuniform float nearPlane;\r\n\r\n\tattribute vec3 $position;\r\n\tattribute vec2 $uv0;\r\n\tvarying vec2 vtc;\r\n\r\n\tattribute vec4 $color;\r\n\tvarying vec4 vColor;\r\n\r\n\tattribute float size;\r\n\r\n#ifndef WALL\r\n\tuniform float miterLimit;\r\n\tattribute vec3 $auxpos1;\r\n\tattribute vec3 $auxpos2;\r\n#endif\r\n\r\n#ifdef SCREENSCALE\r\n\tuniform vec2 screenSize;\r\n\t$toScreenCoords\r\n#define VECTYPE vec2\r\n#define ZEROVEC vec2(0.0, 0.0)\r\n#define PERPENDICULAR(v) vec2(v.y, -v.x);\r\n#define ISOUTSIDE (left.x * right.y - left.y * right.x)*$uv0.y \x3e 0.0\r\n\r\n#else //ifdef SCREENSCALE\r\n\r\n#define VECTYPE vec3\r\n#define ZEROVEC vec3(0.0, 0.0, 0.0)\r\n// these macros are only valid for "strip" type lines:\r\n#define PERPENDICULAR(v) cross(up/*vec3(0.0, 1.0, 0.0)*/, v)\r\n#define ISOUTSIDE dot(cross(left, right), up/*vec3(0.0, 1.0, 0.0)*/)*$uv0.y \x3c 0.0\r\n\r\n#endif //ifdef SCREENSCALE\r\n\r\n\tfloat interp(float ncp, vec4 a, vec4 b) {\r\n\t\treturn (-ncp - a.z) / (b.z - a.z);\r\n\t}\r\n\r\n#ifdef SCREENSCALE\r\n\r\n  void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next) {\r\n\t\tfloat vnp \x3d nearPlane*0.99;\r\n\r\n\t\t//We have four vertices per point on the line. Start and end vertices\r\n\t\t//are treated differently --\x3e d \x3e 0, d \x3c 0\r\n\t\tfloat d \x3d abs($uv0.y) - 1.1;\r\n\r\n\t\t//current pos behind ncp --\x3e we need to clip\r\n\t\tif(pos.z \x3e -nearPlane) {\r\n\t\t\tif (d \x3c 0.0) {\r\n\t\t\t\t//previous in front of ncp\r\n\t\t\t\tif(prev.z \x3c -nearPlane) {\r\n\t\t\t\t\tpos \x3d mix(prev, pos, interp(vnp, prev, pos));\r\n\t\t\t\t\tnext \x3d pos;\r\n\t\t\t\t} else {\r\n\t\t\t\t  pos \x3d vec4(0, 0, 0, 1);\r\n\t\t\t  }\r\n\t\t\t}\r\n\t\t\t//next in front of ncp\r\n\t\t\tif(d \x3e 0.0) {\r\n\t\t\t\tif(next.z \x3c -nearPlane) {\r\n\t\t\t\t\tpos \x3d mix(pos, next, interp(vnp, pos, next));\r\n\t\t\t\t\tprev \x3d pos;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tpos \x3d vec4(0, 0, 0, 1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\telse {\r\n\t\t\t//current position visible\r\n\t\t\t//previous behind ncp\r\n\t\t\tif (prev.z \x3e -nearPlane) {\r\n\t\t\t\tprev \x3d mix(pos, prev, interp(vnp, pos, prev));\r\n\t\t\t}\r\n\t\t\t//next behind ncp\r\n\t\t\tif (next.z \x3e -nearPlane) {\r\n\t\t\t\tnext \x3d mix(next, pos, interp(vnp, next, pos));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpos\x3d proj * pos;\r\n\t\tpos.xy *\x3d screenSize;\r\n\t\tpos /\x3d pos.w;\r\n\r\n\t\tnext \x3d proj * next;\r\n\t\tnext.xy *\x3d screenSize;\r\n\t\tnext /\x3d next.w;\r\n\r\n\t\tprev \x3d proj * prev;\r\n\t\tprev.xy *\x3d screenSize;\r\n\t\tprev /\x3d prev.w;\r\n  }\r\n\r\n#endif // SCREENSCALE\r\n\r\n\tvoid main(void) {\r\n\r\n\tfloat lineWidth \x3d extLineWidth + $size;\r\n\r\n#ifdef SCREENSCALE\r\n\r\n#if 0\r\n\t\tvec4 pos \x3d toScreenCoords($position.xyz);\r\n\t\tvec2 left \x3d (pos - toScreenCoords($auxpos1)).xy;\r\n\t\tvec2 right \x3d (toScreenCoords($auxpos2) - pos).xy;\r\n#else\r\n\t\tvec4 pos  \x3d view * vec4((model * vec4($position.xyz, 1.0)).xyz, 1.0);\r\n\t\tvec4 prev \x3d view * vec4((model * vec4($auxpos1.xyz, 1.0)).xyz, 1.0);\r\n\t\tvec4 next \x3d view * vec4((model * vec4($auxpos2.xyz, 1.0)).xyz, 1.0);\r\n\r\n\t\tclipAndTransform(pos, prev, next);\r\n\r\n\t\tvec2 left \x3d (pos - prev).xy;\r\n\t\tvec2 right \x3d (next - pos).xy;\r\n#endif\r\n\r\n#else // ifdef SCREENSCALE\r\n\t\tvec4 pos \x3d vec4($position, 1.0);\r\n#ifndef WALL\r\n\t\tvec3 left \x3d $position.xyz - $auxpos1;\r\n\t\tvec3 right \x3d $auxpos2 - $position.xyz;\r\n\t\tvec3 up \x3d normalize($position.xyz);\r\n#endif // ifndef WALL\r\n#endif // ifdef SCREENSCALE\r\n\r\n#ifdef WALL\r\n\t\tfloat displacementLen \x3d lineWidth;\r\n\t\tvec3 displacementDir \x3d normalize($position.xyz);//vec3(0.0, 1.0, 0.0);\r\n#else // ifdef WALL\r\n\r\n\t\tfloat leftLen \x3d length(left);\r\n\t\tleft \x3d (leftLen \x3e 0.001) ? left/leftLen : ZEROVEC;\r\n\r\n\t\tfloat rightLen \x3d length(right);\r\n\t\tright \x3d (rightLen \x3e 0.001) ? right/rightLen : ZEROVEC;\r\n\r\n\t\t// determine if vertex is on the "outside or "inside" of the join\r\n\t\tbool isOutside \x3d ISOUTSIDE;\r\n\r\n\t\t// compute miter join position first\r\n\t\tfloat displacementLen \x3d lineWidth;\r\n\t\tVECTYPE displacementDir \x3d normalize(left + right);\r\n\t\tdisplacementDir \x3d PERPENDICULAR(displacementDir);\r\n\t\tif (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\r\n\t\t\tfloat nDotSeg \x3d dot(displacementDir, left);\r\n\t\t\tdisplacementLen /\x3d length(nDotSeg*left - displacementDir);\r\n\r\n\t\t\t// limit displacement of inner vertices\r\n\t\t\tif (!isOutside)\r\n\t\t\t\tdisplacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\r\n\t\t}\r\n\r\n\t\tif (isOutside \x26\x26 (displacementLen \x3e miterLimit*lineWidth)) {\r\n\t\t\t// convert to bevel join if miterLimit is exceeded\r\n\t\t\tif (leftLen \x3c 0.001)\r\n\t\t\t    displacementDir \x3d right;\r\n\t\t\telse if (rightLen \x3c 0.001)\r\n\t\t\t\tdisplacementDir \x3d left;\r\n\t\t\telse\r\n\t\t\t\tdisplacementDir \x3d (abs($uv0.y) - 1.1 \x3c 0.0) ? left : right;\r\n\t\t\tdisplacementDir \x3d normalize(displacementDir);\r\n\t\t\tdisplacementDir \x3d PERPENDICULAR(displacementDir);\r\n\t\t\tdisplacementLen \x3d lineWidth;\r\n\t\t}\r\n\r\n#endif // ifdef WALL\r\n\r\n#ifdef SCREENSCALE\r\n\t\tpos.xy +\x3d displacementDir * floor($uv0.y + 0.5) * displacementLen;\r\n\t\tpos.xy /\x3d screenSize;\r\n#else\r\n\t\tpos.xyz +\x3d displacementDir * floor($uv0.y + 0.5) * displacementLen;\r\n\t\tpos \x3d proj * view * model * pos;\r\n#endif\r\n\r\n\t\tvtc \x3d $uv0;\r\n\t\tvColor \x3d $color * 0.003921568627451; // \x3d 1/255\r\n\t\tgl_Position \x3d pos;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsRibbonLine"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n\tuniform vec4 eColor;\r\n\tvarying vec4 vColor;\r\n\tvarying vec2 vtc;\r\n\r\n\tvoid main() {\r\n\t\tgl_FragColor \x3d eColor * vColor;\r\n\t\t//gl_FragColor.a \x3d 1;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsRibbonLineHighlight"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tvoid main() {\r\n\t\tgl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/WaterMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderWater"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tuniform mat4 proj;\r\n\tuniform mat4 view;\r\n\tuniform mat4 model;\r\n\tattribute vec3 $position;\r\n\tvarying vec3 vpos;\r\n\r\n\tvoid main(void) {\r\n\t\tvpos \x3d (model * vec4($position, 1.0)).xyz;\r\n\t\tgl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderWater"\x3e\x3c![CDATA[\r\n\t$fsprecisionf\r\n\r\n\tuniform vec3 color;\r\n\tuniform float scale;\r\n\tuniform float speed;\r\n\r\n\tuniform vec4 lightAmbient;\r\n\tuniform vec4 lightDiffuse;\r\n\tuniform vec4 lightSpecular;\r\n\tuniform vec3 lightDirection;\r\n\r\n\tuniform vec3 camPos;\r\n\r\n\tuniform sampler2D noiseTex;\r\n\tuniform sampler2D reflTex;\r\n\r\n\tuniform sampler2D depthTex;\r\n\tuniform int shadowMapNum;\r\n\tuniform vec4 shadowMapDistance;\r\n\tuniform mat4 shadowMapMatrix[4];\r\n\tuniform float depthHalfPixelSz;\r\n\r\n\tvarying vec3 vpos;\r\n\r\n\t$evalShadow\r\n\r\n\t$normal2envTC\r\n\r\n\tvec2 rotate(vec2 pos, float angle) {\r\n\t\tfloat c \x3d cos(angle);\r\n\t\tfloat s \x3d sin(angle);\r\n\t\treturn vec2(c * pos.x - s * pos.y, s * pos.x + c * pos.y);\r\n\t}\r\n\r\n\tfloat compDelta(vec2 pos) {\r\n\t\tconst float PI_THIRD \x3d 1.04719755;\r\n\r\n\t\tfloat result \x3d .0;\r\n\t\tfloat s \x3d 1.0;\r\n\t\tfor (int i \x3d 0; i \x3c 6; ++i) {\r\n\t\t\tvec2 tc \x3d pos / (20.0 * s);\r\n\t\t\ttc +\x3d rotate(vec2(1.0 + speed, .0), PI_THIRD * float(i));\r\n\t\t\tresult +\x3d s * texture2D(noiseTex, tc).r;\r\n\t\t\ts *\x3d 1.5;\r\n\t\t}\r\n\t\treturn result * scale * .2;\r\n\t}\r\n\r\n\tvoid main() {\r\n\t\tvec3 viewVec \x3d normalize(camPos - vpos);\r\n\r\n\t\tfloat d0 \x3d compDelta(vpos.xz);\r\n\t\tfloat dx \x3d compDelta(vpos.xz + vec2(.05, .0));\r\n\t\tfloat dz \x3d compDelta(vpos.xz + vec2(.0, .05));\r\n\r\n\t\tvec3 normal \x3d normalize(vec3(d0 - dx, .05, d0 - dz));\r\n\r\n\t\tfloat fresnel \x3d clamp(1.0 - 1.25 * dot(viewVec, normal), .0, 1.0);\r\n\r\n\t\tfloat shadow \x3d 0.0;\r\n\t\tif (halfPxSz \x3e\x3d .0) {\r\n\t\t\tshadow \x3d evalShadow(vpos, 1.0 / gl_FragCoord.w, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n\t\t}\r\n\r\n\t\tvec3 reflDir \x3d reflect(-viewVec, normal);\r\n\t\tif (reflDir.y \x3c .02) reflDir.y \x3d 0.04 - reflDir.y;\r\n\r\n\t\tvec3 reflCol \x3d texture2D(reflTex, normal2envTC(reflDir)).rgb * lightAmbient.rgb*lightSpecular.w;\r\n\t\treflCol *\x3d .5 + max(lightDirection.y, .0) * .5; // ?\t+\r\n\t\tvec3 waterColor \x3d color * (lightAmbient.rgb * lightAmbient.w + (1.0 - shadow) * max(lightDirection.y, .0) * lightDiffuse.rgb * lightDiffuse.w);\r\n\t\tvec3 finalColor \x3d mix(waterColor, reflCol, .15 + .6 * fresnel);\r\n\r\n\t\tvec3 spec \x3d pow(max(dot(reflDir, lightDirection), .001), 80.0) * lightSpecular.rgb * lightSpecular.w * 2.0;\r\n\t\tfinalColor +\x3d (1.0 - shadow) * lightDiffuse.w * spec;\r\n\r\n\t\tgl_FragColor \x3d vec4(finalColor, 1.0);\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/webgl-engine/materials/internal/BlendLayers.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vertexShaderBlendLayers"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n\tattribute vec3 $position;\r\n\tattribute vec2 $uv0;\r\n\r\n\tuniform float scale;\r\n\tuniform vec2 offset;\r\n\r\n\tvarying vec2 uv;\r\n\r\n\tvoid main(void) {\r\n\t\tgl_Position \x3d vec4($position, 1.0);\r\n\t\tuv \x3d $uv0 * scale + offset;;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fragmentShaderBlendLayers"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n\tvarying vec2 uv;\r\n\r\n\tuniform sampler2D tex;\r\n\tuniform float opacity;\r\n\r\n\tvoid main() {\r\n\t\tvec4 color \x3d texture2D(tex, uv);\r\n\r\n    // Note: output in pre-multiplied alpha for correct alpha compositing\r\n\t\tgl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\r\n\t}\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:esri/views/3d/terrain/TerrainMaterial.xml":'\x3c?xml version\x3d"1.0" encoding\x3d"UTF-8"?\x3e\r\n\r\n\x3csnippets\x3e\r\n\r\n\x3csnippet name\x3d"vsTerrain"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform vec3 origin;\r\n  uniform vec2 texOffset;\r\n  uniform float texScale;\r\n  uniform mat4 viewNormal;\r\n\r\n  attribute vec3 $position;\r\n  attribute vec2 $uv0;\r\n  varying vec2 vtc;\r\n  varying vec3 vpos;\r\n  varying vec3 vnormal;\r\n\r\n#if defined(WIREFRAME) || defined(TILE_BORDERS)\r\n  varying vec2 vuv;\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\n  uniform vec3 lightDirection;\r\n  varying vec3 wpos;\r\n  varying vec3 wview;\r\n  varying vec3 wnormal;\r\n  varying vec3 wlight;\r\n#endif\r\n\r\n#ifdef OVERLAY\r\n  uniform vec2 overlayTexOffset;\r\n  uniform vec2 overlayTexScale;\r\n  varying vec2 vtcOverlay;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n\r\n  uniform vec4 screenSizePerspective;\r\n\r\n  varying float screenSizeDistanceToCamera;\r\n  varying float screenSizeCosAngle;\r\n\r\n#endif\r\n\r\n  void main(void) {\r\n    vpos \x3d $position;\r\n\r\n#ifdef SPHERICAL\r\n    vnormal \x3d normalize(vpos + origin);\r\n#else\r\n    vnormal \x3d vec3(0, 0, 1); // WARNING: up-axis dependent code\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\n    wpos \x3d (view * vec4(vpos, 1.0)).xyz;\r\n    wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\r\n    wlight \x3d (view  * vec4(lightDirection, 1.0)).xyz;\r\n#endif\r\n\r\n#if defined(WIREFRAME) || defined(TILE_BORDERS)\r\n    vuv \x3d $uv0;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n\r\n    vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\r\n\r\n    screenSizeDistanceToCamera \x3d length(viewPos);\r\n\r\n    vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\r\n    screenSizeCosAngle \x3d abs(viewSpaceNormal.z);\r\n\r\n#endif\r\n\r\n    gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n    vtc \x3d $uv0*texScale + texOffset;\r\n\r\n#ifdef OVERLAY\r\n    vtcOverlay \x3d $uv0*overlayTexScale + overlayTexOffset;\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsTerrainCommon"\x3e\x3c![CDATA[\r\n  uniform vec3 lightDirection;\r\n  uniform vec3 viewDirection;\r\n  uniform sampler2D depthTex;\r\n  uniform int shadowMapNum;\r\n  uniform vec4 shadowMapDistance;\r\n  uniform mat4 shadowMapMatrix[4];\r\n  uniform float depthHalfPixelSz;\r\n  uniform sampler2D ssaoTex;\r\n  uniform vec4 viewportPixelSz;\r\n  uniform sampler2D tex;\r\n  uniform float opacity;\r\n\r\n  varying vec3 vpos;\r\n  varying vec3 vnormal;\r\n  varying vec2 vtc;\r\n\r\n#if defined(WIREFRAME) || defined(TILE_BORDERS)\r\n  varying vec2 vuv;\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\n  varying vec3 wpos;\r\n  varying vec3 wview;\r\n  varying vec3 wnormal;\r\n  varying vec3 wlight;\r\n#endif\r\n\r\n  $sceneLightingDefinitions\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n  $screenSizePerspective\r\n\r\n  uniform vec4 screenSizePerspective;\r\n\r\n  varying float screenSizeDistanceToCamera;\r\n  varying float screenSizeCosAngle;\r\n#endif\r\n\r\n  const vec3 ambient \x3d vec3(0.2,0.2,0.2);\r\n  const vec3 diffuse \x3d vec3(0.8,0.8,0.8);\r\n  const float diffuseHardness \x3d 2.5;\r\n\r\n#ifdef OVERLAY\r\n  uniform sampler2D overlayTex;\r\n  uniform float overlayOpacity;\r\n  varying vec2 vtcOverlay;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n\t$evalShadow\r\n#endif\r\n\r\n  float lum(vec3 c) {\r\n    float max \x3d max(max(c.r, c.g), c.b);\r\n    float min \x3d min(min(c.r, c.g), c.b);\r\n    return (min + max) * 0.5;\r\n  }\r\n\r\n#ifdef ATMOSPHERE\r\n  vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\r\n    vec3 surfaceColor   \x3d vec3(0.0);\r\n    vec3 fuzzySpecColor \x3d vec3(1.0);\r\n    vec3 subColor       \x3d vec3(0.0);\r\n    float rollOff       \x3d 1.0;\r\n\r\n    vec3 Ln \x3d normalize(lightPos);\r\n    vec3 Nn \x3d normalize(normal);\r\n    vec3 Hn \x3d normalize(view + Ln);\r\n\r\n    float ldn \x3d dot(Ln, Nn);\r\n    float diffComp \x3d max(0.0, ldn);\r\n    float vdn \x3d 1.0 - dot(view, Nn);\r\n    float ndv \x3d dot(view, Ln);\r\n\r\n    vec3 diffContrib \x3d surfaceColor * diffComp;\r\n    float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\r\n\r\n    vec3 subContrib \x3d subLamb * subColor;\r\n    vec3 vecColor \x3d vec3(vdn);\r\n\r\n    vec3 diffuseContrib \x3d (subContrib + diffContrib);\r\n    vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\r\n\r\n    return (diffContrib + specularContrib) * rollOff;\r\n  }\r\n#endif\r\n\r\n  void main() {\r\n    vec3 a \x3d ambient;\r\n\r\n    float shadow \x3d 0.0;\r\n#ifdef RECEIVE_SHADOWS\r\n    shadow \x3d evalShadow(vpos, 1.0 / gl_FragCoord.w, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n#endif\r\n    float vndl \x3d dot(normalize(vnormal), lightDirection);\r\n    float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\r\n    vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\r\n\r\n    float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n    vec4 texCol \x3d texture2D(tex, vtc);\r\n\r\n#ifdef OVERLAY\r\n    if ((vtcOverlay.x \x3e 0.0) \x26\x26 (vtcOverlay.y \x3e 0.0) \x26\x26 (vtcOverlay.x \x3c 1.0) \x26\x26 (vtcOverlay.y \x3c 1.0)) {\r\n      vec4 overlayTexCol \x3d texture2D(overlayTex, vtcOverlay);\r\n      overlayTexCol *\x3d overlayOpacity;\r\n      texCol \x3d texCol * (1.0 - overlayTexCol.a) + overlayTexCol; // texCol and overlayTexCol have pre-multiplied alpha\r\n    }\r\n#endif\r\n\r\n    vec3 atm \x3d vec3(0.0);\r\n#ifdef ATMOSPHERE\r\n    float ndotl \x3d max(0.0, min(1.0, vndl));\r\n    atm \x3d atmosphere(wlight, wnormal, -viewDirection);\r\n    atm *\x3d max(0.0, min(1.0, (1.0-lum(texCol.rgb)*1.5))); //avoid atmosphere on bright base maps\r\n    atm *\x3d max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\r\n#endif\r\n\r\n    vec3 albedo \x3d atm + texCol.rgb;\r\n    vec3 normal \x3d normalize(vnormal);\r\n\r\n    // heuristic shading function used in the old terrain, now used to add ambient lighting\r\n    float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\r\n\t\tvec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\r\n\r\n    gl_FragColor \x3d vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), texCol.a) * opacity;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n    // This is only used for debug rendering the screenSize perspective\r\n\r\n    float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\r\n\r\n    if (perspectiveScale \x3c\x3d 0.25) {\r\n      gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 0, 1), perspectiveScale * 4.0);\r\n    }\r\n    else if (perspectiveScale \x3c\x3d 0.5) {\r\n      gl_FragColor \x3d mix(gl_FragColor, vec4(0, 0, 1, 1), (perspectiveScale - 0.25) * 4.0);\r\n    }\r\n    else if (perspectiveScale \x3e\x3d 0.99) {\r\n      gl_FragColor \x3d mix(gl_FragColor, vec4(0, 1, 0, 1), 0.2);\r\n    }\r\n    else {\r\n      gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 1, 1), (perspectiveScale - 0.5) * 2.0);\r\n    }\r\n\r\n#endif\r\n\r\n  // closing } is missing here, it\'s in the shaders using this snippet below\r\n\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsTerrainWireframe"\x3e\x3c![CDATA[\r\n#ifdef GL_OES_standard_derivatives\r\n#extension GL_OES_standard_derivatives : enable\r\n#endif\r\n\r\n  $fsprecisionf\r\n\r\n  struct WireframeSettings {\r\n    float width;\r\n    float falloff;\r\n    float subdivision;\r\n    vec4 color;\r\n    float wireOpacity;\r\n    float surfaceOpacity;\r\n  };\r\n\r\n  uniform WireframeSettings wireframe;\r\n\r\n    $fsTerrainCommon\r\n\r\n    vec2 dVuv;\r\n    vec2 vuvScaled \x3d vuv * wireframe.subdivision;\r\n    vec2 vuvMod \x3d fract(vuvScaled);\r\n\r\n#ifdef GL_OES_standard_derivatives\r\n    dVuv \x3d fwidth(vuvScaled);\r\n#else\r\n    // Something that reasonably works\r\n    dVuv \x3d vec2(0.05);\r\n#endif\r\n\r\n    vec2 edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\r\n                                  wireframe.width * dVuv, min(vuvMod, 1.0 - vuvMod));\r\n\r\n    float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\r\n\r\n#ifdef WIREFRAME\r\n    gl_FragColor \x3d vec4(mix(gl_FragColor.rgb, wireframe.color.rgb, edgeFactor * wireframe.color.a),\r\n                        mix(wireframe.surfaceOpacity, wireframe.wireOpacity, edgeFactor));\r\n#endif\r\n\r\n\r\n#ifdef TILE_BORDERS\r\n    dVuv \x3d fwidth(vuv);\r\n    edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\r\n                              wireframe.width * dVuv, min(vuv, 1.0 - vuv));\r\n    edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\r\n\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);\r\n#endif\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsTerrain"\x3e\x3c![CDATA[\r\n    $fsprecisionf\r\n    $fsTerrainCommon\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsTerrainNormal"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform vec3 origin;\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform mat4 viewNormal;\r\n  attribute vec3 $position;\r\n  varying vec3 vnormal;\r\n\r\n  void main(void) {\r\n#ifdef SPHERICAL\r\n    vec4 normal \x3d vec4(normalize($position + origin), 1.0);\r\n#else\r\n    vec4 normal \x3d vec4(0.0, 1.0, 0.0, 1.0);\r\n#endif\r\n\r\n    gl_Position \x3d proj * view * vec4($position, 1.0);\r\n    vnormal \x3d normalize((viewNormal * normal).xyz);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsTerrainDepthOnly"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n\r\n  attribute vec3 $position;\r\n\r\n  void main() {\r\n    gl_Position \x3d proj * view * vec4($position, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsTerrainDepthOnly"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  void main() {\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"vsTerrainHighlight"\x3e\x3c![CDATA[\r\n  $vsprecisionf\r\n\r\n  uniform mat4 proj;\r\n  uniform mat4 view;\r\n  uniform vec2 overlayTexScale;\r\n  uniform vec2 overlayTexOffset;\r\n\r\n  attribute vec3 $position;\r\n  attribute vec2 $uv0;\r\n\r\n  varying vec2 vtcOverlay;\r\n\r\n  void main() {\r\n    vtcOverlay \x3d $uv0*overlayTexScale + overlayTexOffset;\r\n\r\n    gl_Position \x3d proj * view * vec4($position, 1.0);\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3csnippet name\x3d"fsTerrainHighlight"\x3e\x3c![CDATA[\r\n  $fsprecisionf\r\n\r\n  uniform sampler2D overlayTex;\r\n\r\n  uniform sampler2D depthTex;\r\n  uniform vec4 highlightViewportPixelSz;\r\n\r\n  varying vec2 vtcOverlay;\r\n\r\n  void main() {\r\n    vec4 texCol \x3d vec4(0,0,0,0);\r\n    if ((vtcOverlay.x \x3e 0.0) \x26\x26 (vtcOverlay.y \x3e 0.0) \x26\x26 (vtcOverlay.x \x3c 1.0) \x26\x26 (vtcOverlay.y \x3c 1.0)) {\r\n      texCol \x3d texture2D(overlayTex, vtcOverlay);\r\n    }\r\n\r\n    if (texCol.a \x3d\x3d 0.0) {\r\n      // Here we have to write black, instead of discarding the fragment in order to overwrite\r\n      // the highlights which might have been written by skirts of other tiles.\r\n      // As a consequence skirts are not visible, but terrain overwrites draped highlights.\r\n      gl_FragColor \x3d vec4(0,0,0,0);\r\n      return;\r\n    }\r\n\r\n    $highlightWrite\r\n  }\r\n]]\x3e\x3c/snippet\x3e\r\n\r\n\x3c/snippets\x3e\r\n',
"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"*now":function(w){w(['dojo/i18n!*preload*jimu/nls/main*["ar","bs","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sr","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("./ConfigManager ./LayoutManager ./DataManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query dojo/domReady! esri/config esri/request esri/core/urlUtils esri/identity/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main".split(" "),function(w,l,f,a,d,b,q,t,m,k,p,x,z,v,r,u,C,E,c,D,B,I,G){b={};D.getEsriConfigRequestObject().timeout=18E4;"function"!==typeof k.getAll&&(k.getAll=
function(a){var b=[];(a=k(a))&&b.push(a);return b});window.jimuNls=G;E.setProtocolErrorHandler(function(){return!0});E=D.getAncestorWindow();var H=!1;try{H=0===E.location.href.indexOf("https://")}catch(J){console.log(J),H="https:"===window.location.protocol}var K=/\/SceneServer\/layers\/\d+\/?$/;u.setRequestPreCallback(function(a){a&&"object"===typeof a&&!a.content&&K.test(a.url)&&(a.content={f:"json"});a.query&&a.query.printFlag&&(a.timeout=3E5);H&&(a.url=a.url.replace(/^http(s?):\/\//gi,"//"));
-1===a.url.indexOf("/queryRelatedRecords?")||D.isHostedService(a.url)||(a.url=a.url.replace("FeatureServer","MapServer"));return a});q(window,"mousedown",function(a){if(t.isMiddle(a))return a.preventDefault(),a.stopPropagation(),a.returnValue=!1});String.prototype.startWith=function(a){return this.substr(0,a.length)===a?!0:!1};String.prototype.endWith=function(a){return this.substr(this.length-a.length,a.length)===a?!0:!1};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=d.mixin({loadingId:"main-loading",
loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="2.6";window.productVersion="Portal for ArcGIS 10.6";b.initApp=function(){var b,c;console.log("jimu.js init...");b=window.location.search;if(""===b)b={};else for(c in b=z.queryToObject(b.substr(1)),b)b[c]=D.sanitizeHTML(b[c]);f.getInstance();a.setStyle(jimuConfig.loadingId,"display","none");a.setStyle(jimuConfig.mainPageId,
"display","block");c=l.getInstance({mapId:jimuConfig.mapId,urlParams:b},jimuConfig.layoutId);b=w.getInstance(b);c.startup();b.loadConfig()};return b});