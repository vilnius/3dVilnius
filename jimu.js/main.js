// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./portalUtils esri/config esri/tasks/GeometryService".split(" "),function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u){function t(a,c){var e=b.clone(a),d=m.widgetProperties;"undefined"===typeof c&&(c=!1);delete e.mode;m.visitElement(e,function(a,r){a.widgets?(delete a.isOnScreen,
delete a.gid,"jimu.js/images/group_icon.png"===a.icon&&delete a.icon,delete a.openType,r.isOnScreen&&a.panel&&m.isEqual(a.panel,e.widgetOnScreen.panel)&&delete a.panel):(a.icon&&a.icon===a.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion&&delete a.icon,delete a.panel,delete a.folderUrl,delete a.amdFolder,delete a.thumbnail,delete a.configFile,delete a.gid,delete a.isOnScreen,d.forEach(function(c){delete a[c]}),c?("undefined"===typeof a.openAtStart&&(a.openAtStart=!1),a.config||delete a.config):
(a.visible&&delete a.visible,a.manifest&&a.label===a.manifest.label&&delete a.label,a.isDefaultConfig&&(delete a.config,delete a.isDefaultConfig)),delete a.manifest)});delete e.rawAppConfig;delete e._ssl;delete e.getConfigElementById;delete e.getConfigElementsByName;delete e.getConfigElementByLabel;delete e.processNoUriWidgets;delete e.addElementId;delete e.getCleanConfig;delete e.visitElement;delete e.agolConfig;delete e._itemData;delete e.oldWabVersion;return e}var r=null,y;y=q(null,{urlParams:null,
appConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(e){this.urlParams=e||{};this.listenBuilderEvents();this.versionManager=new c;this.widgetManager=p.getInstance();this.configLoader=a.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&window.parent.setConfigViewerTopic&&b.isFunction(window.parent.setConfigViewerTopic)&&window.parent.setConfigViewerTopic(k);"preview"===this.urlParams.mode&&window.parent.setPreviewViewerTopic&&
b.isFunction(window.parent.setPreviewViewerTopic)&&window.parent.setPreviewViewerTopic(k);h(window,"resize",b.hitch(this,this._onWindowResize))},listenBuilderEvents:function(){k.subscribe("builder/widgetChanged",b.hitch(this,this._onWidgetChanged));k.subscribe("builder/groupChanged",b.hitch(this,this._onGroupChanged));k.subscribe("builder/widgetPoolChanged",b.hitch(this,this._onWidgetPoolChanged));k.subscribe("builder/openAtStartChange",b.hitch(this,this._onOpenAtStartChanged));k.subscribe("builder/onScreenOrderChanged",
b.hitch(this,this._onScreenOrderChanged));k.subscribe("builder/layoutDefinitionChanged",b.hitch(this,this._onLayoutDefinitionChanged));k.subscribe("builder/sceneViewChanged",b.hitch(this,this._onSceneViewChanged));k.subscribe("builder/mapOptionsChanged",b.hitch(this,this._onMapOptionsChanged));k.subscribe("builder/appAttributeChanged",b.hitch(this,this._onAppAttributeChanged));k.subscribe("builder/setAppConfig",b.hitch(this,this._onAppConfigSet));k.subscribe("builder/themeChanged",b.hitch(this,this._onThemeChanged));
k.subscribe("builder/layoutChanged",b.hitch(this,this._onLayoutChanged));k.subscribe("builder/styleChanged",b.hitch(this,this._onStyleChanged));k.subscribe("builder/syncExtent",b.hitch(this,this._onSyncExtent));k.subscribe("builder/loadingPageChanged",b.hitch(this,this._onLoadingPageChanged));k.subscribe("builder/templateConfigChanged",b.hitch(this,this._onTemplateConfigChanged));k.subscribe("builder/sharedThemeChanged",b.hitch(this,this._onSharedThemeChanged))},loadConfig:function(){if("preview"!==
this.urlParams.mode&&"config"!==this.urlParams.mode)return this.configLoader.loadConfig().then(b.hitch(this,function(a){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(a);window.appInfo.isRunInMobile=this._isRunInMobile();console.timeEnd("Load Config");a=this.getAppConfig();k.publish("appConfigLoaded",a);return a}),b.hitch(this,function(a){console.error(a);a&&a.message&&"string"===typeof a.message&&this._showErrorMessage(a.message)}))},_showErrorMessage:function(a){f.create("div",
{"class":"app-error",innerHTML:m.sanitizeHTML("Unable to create map: "+a)},document.body)},getAppConfig:function(){var a;window.appInfo.isRunInMobile?(a=b.clone(this._getMobileConfig(this.appConfig)),a._originConfig=b.clone(this.appConfig)):a=b.clone(this.appConfig);a.getConfigElementById=function(a){return m.getConfigElementById(this,a)};a.getConfigElementByLabel=function(a){return m.getConfigElementByLabel(this,a)};a.getConfigElementsByName=function(a){return m.getConfigElementsByName(this,a)};
a.getCleanConfig=function(a){return this._originConfig?t(this._originConfig,a):t(this,a)};a.visitElement=function(a){m.visitElement(this,a)};return a},_onWindowResize:function(){var a=this._isRunInMobile();window.appInfo.isRunInMobile!==a&&(window.appInfo.isRunInMobile=a,this.appConfig&&k.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_isRunInMobile:function(){var a=f.getMarginBox(window.jimuConfig.layoutId);if(a.w<=window.jimuConfig.breakPoints[0]||a.h<=window.jimuConfig.breakPoints[0])return f.addClass(window.jimuConfig.layoutId,
"jimu-ismobile"),!0;f.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1},_getMobileConfig:function(a){return m.mixinAppConfigPosition(a,a.mobileLayout)},_onWidgetChanged:function(a){var c=m.reCreateObject(a);a=m.getConfigElementById(this.appConfig,a.id);!1!==c.inPanel||a.uri||(c.closeable=!0);for(var e in c)a[e]=c[e];delete a.isDefaultConfig;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);k.publish("appConfigChanged",this.getAppConfig(),"widgetChange",
c)},_onGroupChanged:function(a){var c=m.reCreateObject(a);a=m.getConfigElementById(this.appConfig,a.id);for(var e in c)a[e]=c[e];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);k.publish("appConfigChanged",this.getAppConfig(),"groupChange",c)},_onWidgetPoolChanged:function(a){a=m.reCreateObject(a);if(1===this.widgetManager.getControllerWidgets().length)this.appConfig.widgetPool.widgets=a.widgets,this.appConfig.widgetPool.groups=a.groups;else{var c=m.getConfigElementById(this.appConfig,
a.controllerId);n.forEach(c.controlledWidgets,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,a)},this);n.forEach(c.controlledGroups,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,a)},this);this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?a.widgets:this.appConfig.widgetPool.widgets.concat(a.widgets);this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?a.groups:this.appConfig.widgetPool.groups.concat(a.groups);
this.configLoader.addNeedValues(this.appConfig);c.controlledWidgets=n.map(a.widgets,function(a){return a.id});c.controlledGroups=n.map(a.groups,function(a){return a.id})}this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);k.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",a)},_removeWidgetOrGroupFromPoolById:function(a,c){n.some(a.widgetPool.widgets,function(e,d){if(e.id===c)return a.widgetPool.widgets.splice(d,1),!0});n.some(a.widgetPool.groups,
function(e,d){if(e.id===c)return a.widgetPool.groups.splice(d,1),!0})},_onOpenAtStartChanged:function(a){var c=m.reCreateObject(a),e=this.appConfig;a.isOnScreen?(e=e.widgetOnScreen&&e.widgetOnScreen.widgets)&&0<e.length&&n.forEach(e,b.hitch(this,function(c){c.id===a.id?c.openAtStart=!c.openAtStart:delete c.openAtStart})):((e=e.widgetPool)&&e.groups&&0<e.groups.length&&n.forEach(e.groups,b.hitch(this,function(c){c.id===a.id?c.openAtStart=!c.openAtStart:delete c.openAtStart})),e&&e.widgets&&0<e.widgets.length&&
n.forEach(e.widgets,b.hitch(this,function(c){c.id===a.id?c.openAtStart=!c.openAtStart:delete c.openAtStart})));k.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",c)},_onScreenOrderChanged:function(a){var c=m.reCreateObject(a);n.forEach(this.appConfig.widgetOnScreen.widgets,function(a){a.isController||(!1!==a.inPanel||!0!==a.closeable)&&!0!==a.inPanel&&a.uri||n.some(c,function(c){if(a.id===c.id)return a.position=c.position,!0})},this);k.publish("appConfigChanged",this.getAppConfig(),
"onScreenOrderChange",c)},_onAppAttributeChanged:function(a){a=m.reCreateObject(a);b.mixin(this.appConfig,a);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);k.publish("appConfigChanged",this.getAppConfig(),"attributeChange",a)},_onLoadingPageChanged:function(a){a=m.reCreateObject(a);var c;"backgroundColor"in a?this.appConfig.loadingPage.backgroundColor=a.backgroundColor:"backgroundImage"in a?(c=this.appConfig.loadingPage.backgroundImage||
{},this.appConfig.loadingPage.backgroundImage=b.mixin(c,a.backgroundImage)):"loadingGif"in a&&(c=this.appConfig.loadingPage.loadingGif||{},this.appConfig.loadingPage.loadingGif=b.mixin(c,a.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);k.publish("appConfigChanged",this.getAppConfig(),"loadingPageChange",a)},_onTemplateConfigChanged:function(a){a=m.reCreateObject(a);this.appConfig.templateConfig=a;this.configLoader.addNeedValues(this.appConfig);
this._addDefaultValues(this.appConfig);k.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",a)},_onLayoutDefinitionChanged:function(a){a=m.reCreateObject(a);m.isEqual(this.appConfig.layoutDefinition,a.layoutDefinition)||(this.appConfig.layoutDefinition=a.layoutDefinition,this.appConfig.widgetOnScreen.groups=m.handleGridLayoutOnScreenGroupChange(this.appConfig.widgetOnScreen.groups,a.groupIds),this.configLoader.addNeedValues(this.appConfig),this._addDefaultValues(this.appConfig),
k.publish("appConfigChanged",this.getAppConfig(),"layoutDefinitionChange",a.layoutDefinition))},_onSceneViewChanged:function(a){a=m.reCreateObject(a);a.itemId&&a.itemId!==this.appConfig.map.itemId&&this.appConfig.map.mapOptions&&m.deleteMapOptions(this.appConfig.map.mapOptions);b.mixin(this.appConfig.map,a);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);k.publish("appConfigChanged",this.getAppConfig(),"mapChange",a)},_onMapOptionsChanged:function(a){a=m.reCreateObject(a);
this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});b.mixin(this.appConfig.map.mapOptions,a);k.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",a)},_onThemeChanged:function(a){this._getAppConfigFromTheme(a).then(b.hitch(this,function(c){this.appConfig=c;k.publish("appConfigChanged",this.getAppConfig(),"themeChange",a.getName())}))},_onLayoutChanged:function(a){this.appConfig=m.mixinAppConfigPosition(this.appConfig,a.layoutConfig);this.appConfig.layoutDefinition=a.layoutConfig.layoutDefinition;
this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);this._addDefaultPanelAndPosition(this.appConfig);k.publish("appConfigChanged",this.getAppConfig(),"layoutChange",a.name)},_onStyleChanged:function(a){this.appConfig.theme.styles=this._genStyles(this.appConfig.theme.styles,a.name);a.isCustom?this.appConfig.theme.customStyles={mainBackgroundColor:a.styleColor}:(delete this.appConfig.theme.customStyles,delete this.appConfig.titleColor,this.appConfig.theme.sharedTheme=
{isPortalSupport:this.appConfig.theme.sharedTheme.isPortalSupport,useHeader:!1,useLogo:!1});k.publish("appConfigChanged",this.getAppConfig(),"styleChange",a.name)},_onSharedThemeChanged:function(a){var c=this.appConfig.theme.sharedTheme;a=m.reCreateObject(a);a.useHeader&&!c.useHeader&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},this.appConfig.titleColor=
this.portalSelf.portalProperties.sharedTheme.header.text,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor})):console.error("Portal does not support sharedTheme."));!a.useHeader&&c.useHeader&&(delete this.appConfig.titleColor,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor}));a.useLogo&&!c.useLogo&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:
"images/app-logo.png",this.appConfig.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link,this._onAppAttributeChanged({logo:this.appConfig.logo,logoLink:this.appConfig.logoLink})):console.error("Portal does not support sharedTheme."));!a.useLogo&&c.useLogo&&this._onAppAttributeChanged({logo:this.appConfig.logo});b.mixin(c,a);k.publish("appConfigChanged",this.getAppConfig(),"sharedThemeChange",a)},_onSyncExtent:function(a){k.publish("syncExtent",a)},_genStyles:function(a,c){var e=[];e.push(c);
n.forEach(a,function(a){0>e.indexOf(a)&&e.push(a)});return e},_getAppConfigFromTheme:function(a){var c=new d,e,r=[],g=this.getAppConfig().getCleanConfig();g.mode=this.urlParams.mode;n.forEach(g.widgetPool.groups,function(a){delete a.panel},this);if(a.appConfig)e=b.clone(a.appConfig),e.map=g.map,e.map.position=a.appConfig.map.position,this._copyPoolToThemePool(g,e),e.links=g.links,e.title=g.title,e.subtitle=g.subtitle,e.logo=g.logo;else{var l=a.getCurrentLayout(),r=a.getCurrentStyle();e=b.clone(g);
l=b.clone(l.layoutConfig);e.widgetOnScreen=l.widgetOnScreen;l.widgetPool&&(n.forEach(l.widgetPool.widgets,function(a){a.isPreconfiguredInTheme=!0}),n.forEach(l.widgetPool.groups,function(a){a.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(g,l);e.widgetPool=l.widgetPool;l.map&&l.map.position&&(e.map.position=l.map.position);e.mobileLayout=l.mobileLayout;e.layoutDefinition=l.layoutDefinition;r=this._genStyles(n.map(a.getStyles(),function(a){return a.name}),r.name);e.theme={name:a.getName(),
styles:r,version:a.getVersion()};this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(e.theme.sharedTheme={useHeader:!0,useLogo:!0,isPortalSupport:!0},e.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background}):(e.theme.sharedTheme={useHeader:!1,useLogo:!1,isPortalSupport:!1},e.theme.customStyles={mainBackgroundColor:""});e.titleColor=g.titleColor;e.logoLink=g.logoLink}this.configLoader.addNeedValues(e);this.configLoader.loadWidgetsManifest(e).then(b.hitch(this,
function(){this._addDefaultValues(e);c.resolve(e)}));return c},_copyPoolToThemePool:function(a,c){var e=a.widgetPool;c.widgetPool||(c.widgetPool={});a=c.widgetPool;var d=n.filter(a.widgets,function(a){if(a.isPreconfiguredInTheme||!n.some(e.widgets,function(c){return c.name===a.name}))return!0}),g=n.filter(a.groups,function(a){return a.isPreconfiguredInTheme}),r=n.filter(e.widgets,function(a){return!a.isPreconfiguredInTheme}),l=n.filter(e.groups,function(a){return!a.isPreconfiguredInTheme}),r=this._getPoolWidgetsWithoutDuplicated(r,
c.widgetOnScreen.widgets||[]);a.widgets=r.concat(d);a.groups=l.concat(g)},_getPoolWidgetsWithoutDuplicated:function(a,c){for(var e=b.clone(a),d=this.getAppConfig(),g=a.length-1;0<=g;g--)for(var r=c.length-1;0<=r;r--)if(c[r].uri){var l=c[r].name;l||(l=m.getWidgetNameFromUri(c[r].uri));var h=d.getConfigElementById(a[g].id);a[g]&&a[g].name===l&&!1===h.supportMultiInstance&&(console.log("Widget",a[g].name,"is not copied to new theme because this widget exists in new theme."),e.splice(g,1))}return e},
_onAppConfigSet:function(a){a=m.reCreateObject(a);window.appInfo.isRunInMobile=this._isRunInMobile();this.configLoader.processProxy(a);this.configLoader.addNeedValues(a);this._addDefaultValues(a);l.setPortalUrl(a.portalUrl);this.appConfig?(a.map.itemId&&a.map.itemId!==this.appConfig.map.itemId&&m.deleteMapOptions(a.map.mapOptions),this.appConfig=a,k.publish("appConfigChanged",this.getAppConfig(),"resetConfig",a)):(this.appConfig=a,g.getPortal(a.portalUrl).loadSelfInfo().then(b.hitch(this,function(a){this.portalSelf=
a;k.publish("appConfigLoaded",this.getAppConfig())})))},_addDefaultValues:function(a){this._addDefaultPortalUrl(a);this._addDefaultGeometryService(a);this._addDefaultStyle(a);this._addDefaultMap(a);this._addDefaultVisible(a);this._addDefaultSharedTheme(a);"undefined"===typeof a.widgetOnScreen&&(a.widgetOnScreen={});"undefined"===typeof a.widgetPool&&(a.widgetPool={});this._addDefaultPanelAndPosition(a);this._addDefaultOfWidgetGroup(a);(a.widgetPool.widgets&&0<a.widgetPool.widgets.length&&void 0===
a.widgetPool.widgets[0].index||a.widgetPool.groups&&0<a.widgetPool.groups.length&&void 0===a.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(a);return a},_addDefaultPortalUrl:function(a){"undefined"===typeof a.portalUrl&&(a.portalUrl="http://www.arcgis.com/");a.portalUrl&&"/"!==a.portalUrl.substr(a.portalUrl.length-1)&&(a.portalUrl+="/")},_addDefaultGeometryService:function(a){var c=a&&a.geometryService,c=c&&"string"===typeof c&&b.trim(c)?b.trim(c):this.portalSelf.helperServices.geometry.url;
a.geometryService=c;e.geometryService=new u(a.geometryService);m.setGlobalGeometryService(a.geometryService)},_addDefaultStyle:function(a){!a.theme||a.theme.styles&&0!==a.theme.styles.length||(a.theme.styles=["default"])},_addDefaultMap:function(a){a.map.id="map";"undefined"===typeof a.map["3D"]&&"undefined"===typeof a.map["2D"]&&(a.map["2D"]=!0);"undefined"===typeof a.map.position&&(a.map.position={left:0,right:0,top:0,bottom:0});"undefined"===typeof a.map.portalUrl&&(a.map.portalUrl=a.portalUrl)},
_addDefaultVisible:function(a){m.visitElement(a,function(a){void 0===a.visible&&(a.visible=!0)})},_addDefaultSharedTheme:function(a){a.theme.sharedTheme?("undefined"===typeof a.theme.sharedTheme.useHeader&&(a.theme.sharedTheme.useHeader=!1),"undefined"===typeof a.theme.sharedTheme.useLogo&&(a.theme.sharedTheme.useLogo=!1)):a.theme.sharedTheme={useHeader:!1,useLogo:!1}},_addDefaultPanelAndPosition:function(a){this._addOnScreenDefaultPanelAndPosition(a);this._addPoolDefaultPanelAndPosition(a)},_addOnScreenDefaultPanelAndPosition:function(a){var c,
e;if(a=a.widgetOnScreen){c=a.panel&&a.panel.positionRelativeTo?a.panel.positionRelativeTo:"map";"undefined"===typeof a.panel||"undefined"===typeof a.panel.uri?a.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:c}}:"undefined"===typeof a.panel.position?a.panel.position={relativeTo:c}:"undefined"===typeof a.panel.position.relativeTo&&(a.panel.position.relativeTo=c);if(a.widgets)for(c=0;c<a.widgets.length;c++)a.widgets[c].position||(a.widgets[c].position={}),a.widgets[c].position.relativeTo||
(a.widgets[c].position.relativeTo=a.widgets[c]&&a.widgets[c].positionRelativeTo?a.widgets[c].positionRelativeTo:"map"),!0!==a.widgets[c].inPanel||a.widgets[c].panel||(a.widgets[c].panel=b.clone(a.panel),a.widgets[c].panel.position=a.widgets[c].position,a.widgets[c].panel.position.relativeTo=a.widgets[c].position.relativeTo);if(a.groups)for(c=0;c<a.groups.length;c++)for(a.groups[c].panel||(a.groups[c].panel=a.panel),a.groups[c].panel&&!a.groups[c].panel.position&&(a.groups[c].panel.position={}),a.groups[c].panel.position.relativeTo||
(a.groups[c].panel.position.relativeTo=a.groups[c].panel.positionRelativeTo?a.groups[c].panel.positionRelativeTo:"map"),a.groups[c].widgets||(a.groups[c].widgets=[]),e=0;e<a.groups[c].widgets.length;e++)a.groups[c].widgets[e].panel=a.groups[c].panel}},_addPoolDefaultPanelAndPosition:function(a){var c,e,d=a.widgetPool;if(d){c=d.panel&&d.panel.positionRelativeTo?d.panel.positionRelativeTo:"map";"undefined"===typeof d.panel||"undefined"===typeof d.panel.uri?d.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:c}}:
"undefined"===typeof d.panel.position?d.panel.position={relativeTo:c}:"undefined"===typeof d.panel.position.relativeTo&&(d.panel.position.relativeTo=c);if(d.groups)for(c=0;c<d.groups.length;c++)for(d.groups[c].panel?d.groups[c].panel.position.relativeTo||(d.groups[c].panel.position.relativeTo=d.groups[c].panel.positionRelativeTo?d.groups[c].panel.positionRelativeTo:"map"):d.groups[c].panel=d.panel,d.groups[c].widgets||(d.groups[c].widgets=[]),e=0;e<d.groups[c].widgets.length;e++)d.groups[c].widgets[e].panel=
d.groups[c].panel;if(d.widgets)for(c=0;c<d.widgets.length;c++)!1===d.widgets[c].inPanel?(e=d.widgets[c].positionRelativeTo?d.widgets[c].positionRelativeTo:"map",d.widgets[c].position)?d.widgets[c].position.relativeTo||(d.widgets[c].position.relativeTo=e):d.widgets[c].position={relativeTo:e}:d.widgets[c].panel||(d.widgets[c].panel=a.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(a){m.visitElement(a,b.hitch(this,function(a,c){a.isOnScreen=c.isOnScreen;a.widgets?(a.gid=a.id,1===a.widgets.length?
(a.label||(a.label=a.widgets[0].label?a.widgets[0].label:"Group"),a.icon||(a.icon=a.widgets[0].uri?this._getDefaultIconFromUri(a.widgets[0].uri):"jimu.js/images/group_icon.png")):(a.icon=a.icon?a.icon:"jimu.js/images/group_icon.png",a.label=a.label?a.label:"Group_"+c.index)):(a.gid=c.groupId,a.uri&&m.processWidgetSetting(a))}))},_getDefaultIconFromUri:function(a){a=a.split("/");a.pop();return a.join("/")+"/images/icon.png"},_addIndexForWidgetPool:function(a){var c=0,e,d;if(a.widgetPool.widgets)for(e=
0;e<a.widgetPool.widgets.length;e++)a.widgetPool.widgets[e].index=c,c++;if(a.widgetPool.groups)for(e=0;e<a.widgetPool.groups.length;e++)for(a.widgetPool.groups[e].index=c,c++,d=0;d<a.widgetPool.groups[e].widgets.length;d++)a.widgetPool.groups[e].widgets[d].index=d}});y.getInstance=function(a){null===r?r=new y(a):a&&(r.urlParams=a);window.getAppConfig=b.hitch(r,r.getAppConfig);return r};return y})},"dojo/_base/html":function(){define("./kernel ../dom ../dom-style ../dom-attr ../dom-prop ../dom-class ../dom-construct ../dom-geometry".split(" "),
function(q,b,n,f,k,d,h,m){q.byId=b.byId;q.isDescendant=b.isDescendant;q.setSelectable=b.setSelectable;q.getAttr=f.get;q.setAttr=f.set;q.hasAttr=f.has;q.removeAttr=f.remove;q.getNodeProp=f.getNodeProp;q.attr=function(d,c,a){return 2==arguments.length?f["string"==typeof c?"get":"set"](d,c):f.set(d,c,a)};q.hasClass=d.contains;q.addClass=d.add;q.removeClass=d.remove;q.toggleClass=d.toggle;q.replaceClass=d.replace;q._toDom=q.toDom=h.toDom;q.place=h.place;q.create=h.create;q.empty=function(d){h.empty(d)};
q._destroyElement=q.destroy=function(d){h.destroy(d)};q._getPadExtents=q.getPadExtents=m.getPadExtents;q._getBorderExtents=q.getBorderExtents=m.getBorderExtents;q._getPadBorderExtents=q.getPadBorderExtents=m.getPadBorderExtents;q._getMarginExtents=q.getMarginExtents=m.getMarginExtents;q._getMarginSize=q.getMarginSize=m.getMarginSize;q._getMarginBox=q.getMarginBox=m.getMarginBox;q.setMarginBox=m.setMarginBox;q._getContentBox=q.getContentBox=m.getContentBox;q.setContentSize=m.setContentSize;q._isBodyLtr=
q.isBodyLtr=m.isBodyLtr;q._docScroll=q.docScroll=m.docScroll;q._getIeDocumentElementOffset=q.getIeDocumentElementOffset=m.getIeDocumentElementOffset;q._fixIeBiDiScrollLeft=q.fixIeBiDiScrollLeft=m.fixIeBiDiScrollLeft;q.position=m.position;q.marginBox=function(d,c){return c?m.setMarginBox(d,c):m.getMarginBox(d)};q.contentBox=function(d,c){return c?m.setContentSize(d,c):m.getContentBox(d)};q.coords=function(d,c){q.deprecated("dojo.coords()","Use dojo.position() or dojo.marginBox().");d=b.byId(d);var a=
n.getComputedStyle(d),a=m.getMarginBox(d,a);d=m.position(d,c);a.x=d.x;a.y=d.y;return a};q.getProp=k.get;q.setProp=k.set;q.prop=function(d,c,a){return 2==arguments.length?k["string"==typeof c?"get":"set"](d,c):k.set(d,c,a)};q.getStyle=n.get;q.setStyle=n.set;q.getComputedStyle=n.getComputedStyle;q.__toPixelValue=q.toPixelValue=n.toPixelValue;q.style=function(d,c,a){switch(arguments.length){case 1:return n.get(d);case 2:return n["string"==typeof c?"get":"set"](d,c)}return n.set(d,c,a)};return q})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/promise/all dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/kernel esri/config esri/geometry/SpatialReference esri/geometry/Extent esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/support/webMercatorUtils esri/tasks/GeometryService esri/tasks/support/ProjectParameters esri/core/urlUtils esri/request esri/identity/IdentityManager esri/identity/OAuthInfo jimu/portalUrlUtils ./shared/utils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C,E,F,H,D,G,K,M,O){function N(a,c){a=a||"";var e=0,d=[{test:window.File&&window.FileReader&&window.FileList&&window.Blob||!I.file.isEnabledFlash(),failure:[a+"libs/polyfills/fileAPI/FileAPI.js"],callback:function(){e++;e===d.length&&c()}}];for(a=0;a<d.length;a++)testLoad(d[a])}function P(a,c){var e=a.match(/url\([^)]+\)/gi),d,g;if(null===e||""===c)return a;for(d=0;d<e.length;d++)if(g=e[d].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i),4<=g.length){var r=
g[2];/^data:image\/.*;/.test(r)||(c.endWith("/")||(c+="/"),a=a.replace(g[1]+r+g[3],g[1]+c+r+g[3]))}return a}function L(a,c){var e=Array.isArray(c),d=e&&[]||{};e?(a=a||[],d=d.concat(a),c.forEach(function(c,e){"undefined"===typeof a[e]?d[e]=c:"object"===typeof c?d[e]=L(a[e],c):-1===a.indexOf(c)&&d.push(c)})):(a&&"object"===typeof a&&Object.keys(a).forEach(function(c){d[c]=a[c]}),Object.keys(c).forEach(function(e){d[e]="object"===typeof c[e]&&c[e]?a[e]?L(a[e],c[e]):c[e]:c[e]}));return d}function T(a){var c,
e={};c=a.indexOf("/");a.substring(0,c);c=a.substring(0,a.lastIndexOf("/")+1);e.folderUrl=require(I.getRequireConfig()).toUrl(c);e.amdFolder=c;e.url=e.folderUrl;if(/^http(s)?:\/\//.test(a)||/^\/\//.test(a))e.isRemote=!0;return e}function R(a){a.panels.forEach(function(a){a.uri="panels/"+a.name+"/Panel.js"});a.styles.forEach(function(a){a.uri="styles/"+a.name+"/style.css"});a.layouts.forEach(function(a){a.uri="layouts/"+a.name+"/config.json";a.icon="layouts/"+a.name+"/icon.png";a.RTLIcon="layouts/"+
a.name+"/icon_rtl.png"})}function J(a,c){var e=a.map(function(a){return a.id});b.forEach(c,function(c){0>e.indexOf(c)&&a.push({id:c,widgets:[]})},this);var d=[];a=b.filter(a,function(a){return 0>c.indexOf(a.id)?(d.push(a),!1):!0},this);if(0===a.length)return[];var g=a[a.length-1];b.forEach(d,function(a){g.widgets=g.widgets.concat(a.widgets)},this);return a=a.sort(function(a,e){return c.indexOf(a.id)-c.indexOf(e.id)})}function U(a,c,e){function d(a,c){return q.isArray(a[c.key])?a[c.key][c.index]:a[c.key]}
c=function(a){var c=[];a.split("_").forEach(function(a){var e=!1,d;"--"===a.slice(a.length-2)&&(e=!0,a=a.slice(0,a.length-2));d=a.search(/\[[0-9]+\]/);-1===d&&(d=a.length);c.push({key:a.slice(0,d),index:Number(a.slice(d+1,-1)),deleteFlag:e})});return c}(c);for(var g=1;g<c.length-1;g++)if(a=d(a,c[g]),!a)return;if(c[c.length-1].deleteFlag)!0===e&&(q.isArray(a[c[c.length-1].key])?delete a[c[c.length-1].key][c[c.length-1].index]:delete a[c[c.length-1].key]);else if(q.isArray(a[c[c.length-1].key])){if(void 0===
e)return a[c[c.length-1].key][c[c.length-1].index];a[c[c.length-1].key][c[c.length-1].index]=e}else{if(void 0===e)return a[c[c.length-1].key];a[c[c.length-1].key]=e}}function Q(a,c,e){function d(e){e=I.template.getSearchRange(c,e,"]");var d=c.slice(e.firstPos,e.lastPos);return-1!==e.firstPos?(d=c.slice(e.firstPos+d.indexOf("[")+1,e.lastPos-1),e=c.slice(e.lastPos+1),(d=I.getConfigElementById(a,d))?{object:d,key:"section_"+e,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}var g=a,r=c=c.replace(/\//g,
"_"),l=d("groups\\[.+\\]");if("deleted"!==l.state&&("isSection"===l.state&&(g=l.object,r=l.key),l=d("widgets\\[.+\\]"),"delete"!==l.state))return"isSection"===l.state&&(g=l.object,r=l.key),U(g,r,e)}var I={},V={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};q.mixin(I,O);window.atob||(window.atob=function(a){a=r.decode(a);for(var c="",e=0,d=a.length;e<d;e++)c+=String.fromCharCode(a[e]);return c});window.btob||(window.btob=function(a){for(var c=[],e=0,
d=a.length;e<d;e++)c.push(String.charCodeAt(a[e]));return r.encode(c)});var X="unload",W=[];require.on("error",function(a){b.forEach(W,function(c){a.info[0]&&-1<a.info[0].indexOf(c.resKey)&&c.def.reject(a);for(var e in a.info)-1<e.indexOf(c.resKey)&&c.def.reject(a)})});I.checkError=function(a,c){W.push({resKey:a,def:c})};I.replacePlaceHolder=function(a,c){var e=l.stringify(a),d=e.match(/\$\{(\w)+\}/g);if(null===d)return a;for(a=0;a<d.length;a++){var g=d[a].match(/(\w)+/g)[0];c[g]&&(e=e.replace(d[a],
c[g]))}return l.parse(e)};I.changeUnit=function(a){var c=Math.abs(a),e;a=Math.floor(c);e=Math.floor(60*(c-a));c=(60*(60*(c-a)-e)).toFixed(2);return a+"\u00b0"+(10>e?"0"+e:e)+"'"+(10>c?"0"+c:c)+'"'};I.formatTime=function(a){var c=a/1E3;a=Math.floor(c/60);c=Number(c-60*a).toFixed(1);return(10>a?"0"+a:a)+":"+(10>c?"0"+c:c)};I.parseTime=function(a){var c=/(\d{2,})\:(\d{2})\.(\d{1})/;if(!c.test(a))return console.log("wrong time format."),-1;a=a.match(c);return 1E3*(60*parseInt(a[1],10)+parseInt(a[2],10)+
parseInt(a[3],10)/10)};I.preloadImg=function(a,c){var e=[],e="string"===typeof a?[a]:a;b.forEach(e,function(a){(new Image).src=c?c+a:a})};I.setWABLogoDefaultAlt=function(a){if(a){a=h("img",a);for(var c=0,e=a.length;c<e;c++){var d=a[c];"img_1545621838463"!==n.getAttr(d,"id")&&"img_1412759111499"!==n.getAttr(d,"id")||n.getAttr(d,"alt")||n.setAttr(d,"alt","Web AppBuilder for ArcGIS.png")}}};var ca=null;I.getImagesSize=function(c){var e=new p;if(!c||0!==c.indexOf("http"))return e.reject(),e;null===ca&&
(ca=n.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var d=a(ca,"load",function(){clearTimeout(g);g=null;d.remove();var a=n.getContentBox(ca);1===a.w&&1===a.h||0===a.w||0===a.h?e.reject():e.resolve([a.w,a.h])},{}),g=setTimeout(function(){clearTimeout(g);g=null;e.reject()},5E3);n.setAttr(ca,"src",c);return e};I.getPositionStyle=function(a){var c={};if(!a)return c;a=q.clone(a);if(window.isRTL){var e;"undefined"!==typeof a.left&&"undefined"!==
typeof a.right?(e=a.left,a.left=a.right,a.right=e):"undefined"!==typeof a.left?(a.right=a.left,delete a.left):"undefined"!==typeof a.right&&(a.left=a.right,delete a.right);"undefined"!==typeof a.paddingLeft&&"undefined"!==typeof a.paddingRight?(e=a.paddingLeft,a.paddingLeft=a.paddingRight,a.paddingRight=e):"undefined"!==typeof a.paddingLeft?(a.paddingRight=a.paddingLeft,delete a.paddingLeft):"undefined"!==typeof a.paddingRight&&(a.paddingLeft=a.paddingRight,delete a.paddingRight);"undefined"!==typeof a.marginLeft&&
"undefined"!==typeof a.marginRight?(e=a.marginLeft,a.marginLeft=a.marginRight,a.marginRight=e):"undefined"!==typeof a.marginLeft?(a.marginRight=a.marginLeft,delete a.marginLeft):"undefined"!==typeof a.marginRight&&(a.marginLeft=a.marginRight,delete a.marginRight)}e="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom margin marginLeft marginRight marginTop marginBottom".split(" ");for(var d=0;d<e.length;d++){var g=e[d];"number"===typeof a[g]?c[g]=a[g]+"px":
"undefined"!==typeof a[g]?c[g]=a[g]:"padding"===g.substr(0,7)||"margin"===g.substr(0,7)?c[g]=0:c[g]="auto"}c.zIndex="undefined"===typeof a.zIndex?"auto":a.zIndex;return c};I.isEqual=function(a,c){function e(a,c){var r;if(null===a&&null===c||"undefined"===typeof a&&"undefined"===typeof c)return!0;if(null===a&&null!==c||null===c&&null!==a||"undefined"===typeof a&&"undefined"!==typeof c||"undefined"===typeof c&&"undefined"!==typeof a)return!1;if(isNaN(a)&&isNaN(c)&&"number"===typeof a&&"number"===typeof c||
a===c)return!0;if("function"===typeof a&&"function"===typeof c||a instanceof Date&&c instanceof Date||a instanceof RegExp&&c instanceof RegExp||a instanceof String&&c instanceof String||a instanceof Number&&c instanceof Number)return a.toString()===c.toString();if(-1<d.indexOf(a)||-1<g.indexOf(c))return!1;if(null!==c){for(r in c)if(c.hasOwnProperty(r)!==a.hasOwnProperty(r)||typeof c[r]!==typeof a[r])return!1;for(r in a){if(c.hasOwnProperty(r)!==a.hasOwnProperty(r)||typeof c[r]!==typeof a[r])return!1;
switch(typeof a[r]){case "object":case "function":d.push(a);g.push(c);if(!e(a[r],c[r]))return!1;d.pop();g.pop();break;default:if(a[r]!==c[r])return!1}}}return!0}var d,g;d=[];g=[];return e(a,c)?!0:!1};I.getUriInfo=T;I.file={loadFileAPI:function(){var a=new p;if("unload"===X){var c=window.isBuilder?"stemapp/":"";window.FileAPI={debug:!1,flash:!0,staticPath:c+"libs/polyfills/fileAPI/",flashUrl:c+"libs/polyfills/fileAPI/FileAPI.flash.swf",flashImageUrl:c+"libs/polyfills/fileAPI/FileAPI.flash.image.swf"};
N(c,q.hitch(this,function(){X="loaded";a.resolve()}));X="loading"}else"loaded"===X&&a.resolve();return a},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return f("safari")&&6>f("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var a=null;if(document.all)try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(ba){a=null}else navigator.plugins&&0<navigator.plugins.length&&(a=
navigator.plugins["Shockwave Flash"]);return!!a},containSeparator:function(a){return 0<=a.indexOf("/")?!0:0<=a.indexOf("\\")?!0:!1},getNameFromPath:function(a){var c="",c=0<=a.indexOf("/")?"/":"\\";a=a.split(c);return 0<a.length?a[a.length-1]:null},getFolderFromPath:function(a){return a.substr(0,a.length-I.file.getNameFromPath(a).length)},readFile:function(a,c,e,d){if(this.supportHTML5()){var g=a.target.files[0];g&&(g.type.match(c)?g.size>=e?d({errCode:"exceed"}):(a=new FileReader,a.onload=function(a){d(null,
g.name,a.target.result)},a.readAsDataURL(g)):d({errCode:"invalidType"}))}else if(this.supportFileAPI()){var r=window.FileAPI.getFiles(a);r[0].type.match(c)?r[0].size>=e?d({errCode:"exceed"}):window.FileAPI.readAsDataURL(r[0],function(a){a&&a.result?d(null,r[0].name,a.result):d({errCode:"readError"})}):d({errCode:"invalidType"})}}};I.processWidgetSetting=function(a){if(!a.uri)return a;q.mixin(a,T(a.uri));a.icon||(a.icon=a.amdFolder+"images/icon.png");a.thumbnail||(a.thumbnail=a.amdFolder+"images/thumbnail.png");
return a};I.getRequireConfig=function(){if(jimuConfig){var a=[];jimuConfig.widgetsPackage&&(a=a.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(a=a.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(a=a.concat(jimuConfig.configsPackage));return{packages:a}}return{}};I.getTypeByGeometryType=function(a){var c="",e="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),d=["esriGeometryRing",
"esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(a)?c="point":0<=e.indexOf(a)?c="polyline":0<=d.indexOf(a)&&(c="polygon");return c};I.getSymbolTypeByGeometryType=function(a){var c=null;a=I.getTypeByGeometryType(a);"point"===a?c="marker":"polyline"===a?c="line":"polygon"===a&&(c="fill");return c};I.getServices=function(){return V};I.getArcGISDefaultGeometryService=function(){return new E(V.geometryService)};I.restoreToDefaultWebMapExtent=function(a,
c,e){var d=new p;if(!a||"esri.Map"!==a.declaredClass)return setTimeout(function(){d.reject("Invalid map.")},0),d;c=c&&c.itemInfo;if(!c)return setTimeout(function(){d.reject("Invalid itemInfo")},0),d;c=c.item&&c.item.extent;if(!c)return setTimeout(function(){d.reject("Invalid itemInfo.item.extent")}),d;var g=new x({wkid:4326}),g=new v(c[0][0],c[0][1],c[1][0],c[1][1],g);if(4326===parseInt(a.spatialReference.wkid,10))return a.setExtent(g);if(a.spatialReference.isWebMercator)return g=C.geographicToWebMercator(g),
a.setExtent(g);c=new F;c.geometries=[g];c.outSR=a.spatialReference;g=w&&w.defaults&&w.defaults.geometryService;g&&"esri.tasks.GeometryService"===g.declaredClass||(e&&"string"===typeof e&&q.trim(e)?(e=q.trim(e),g=new E(e)):g=I.getArcGISDefaultGeometryService());g.project(c).then(function(c){if(c=c&&c[0])return a.setExtent(c);d.reject("Invalid projected geometry.");return d},function(a){console.error(a);d.reject(a);return d});return d};I.getAncestorWindow=function(){for(var a=window;a&&a.parent&&a!==
a.parent;)a=a.parent;return a};I.getAncestorDom=function(a,c,e){if(a&&1===a.nodeType&&c&&"function"===typeof c){var d=100,g=document.body;e&&("number"===typeof e?(e=parseInt(e,10),0<e&&(d=e)):1===e.nodeType&&(g=e));for(e=0;a.parentNode&&e<d&&n.isDescendant(a.parentNode,g);){if(c(a.parentNode))return a.parentNode;a=a.parentNode;e++}}return null};I.bindClickAndDblclickEvents=function(c,e,d,g){var r=null;if(c&&1===c.nodeType&&e&&"function"===typeof e&&d&&"function"===typeof d){var l=200;g&&"number"===
typeof g&&(g=parseInt(g,10),0<g&&(l=g));var h=0,r=a(c,"click",function(a){h++;1===h?setTimeout(function(){1===h&&(h=0,e(a))},l):2===h&&(h=0,d(a))})}return r};I.isScrollToBottom=function(a){var c=n.getContentBox(a);return 1>a.scrollHeight-(a.scrollTop+c.h)};I.getAllItemTypes=function(){var a=[],a=a.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service",
"Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));return a=a.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer",
"Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};I.getItemQueryStringByTypes=function(a){var c="",e=I.getAllItemTypes();if(a&&0<a.length&&0<a.length){var d="";b.forEach(a,function(c,e){d+=' type:"'+c+'" ';e!==a.length-1&&(d+=" OR ")});c=" ( "+d+" ) ";e=a.concat(e);e=b.filter(e,function(c){return b.every(a,
function(a){return 0>a.toLowerCase().indexOf(c.toLowerCase())})});b.forEach(e,function(a){c+=' -type:"'+a+'" '})}return c};I.getItemQueryStringByTypeKeywords=function(a){var c="";a&&0<a.length&&(c=' typekeywords:"'+a.join(",")+'" ');return c};I.isNotEmptyString=function(a,c){var e=a&&"string"===typeof a;return e?c?e&&q.trim(a):!0:!1};I.isValidNumber=function(a){return"number"===typeof a&&!isNaN(a)};I.isObject=function(a){return a&&"object"===typeof a};I.getRandomString=function(){var a=Math.random().toString();
return a=a.slice(2,a.length)};I._getDomainsByServerName=function(a){var c=a.split("."),e=c.length;return b.map(c,q.hitch(this,function(a,d){a=c.slice(d,e);var g="",r=a.length-1;b.forEach(a,q.hitch(this,function(a,c){g+=a;c!==r&&(g+=".")}));return g}))};I.removeCookie=function(a,c){var e=this._getDomainsByServerName(window.location.hostname);b.forEach(e,q.hitch(this,function(e){g(a,null,{expires:-1,path:c});g(a,null,{expires:-1,path:c,domain:e});g(a,null,{expires:-1,path:c,domain:"."+e})}))};I.isLocaleChanged=
function(a,c){return!a.startWith(c)};I.hashToObject=function(a){a=a.replace("#","");a=d.queryToObject(a);for(var c in a)if(a.hasOwnProperty(c))try{a[c]=l.parse(a[c])}catch(aa){}return a};I.reCreateObject=function(a){function c(a){var d=[];a.forEach(function(a){Array.isArray(a)?d.push(c(a)):"object"===typeof a?d.push(e(a)):d.push(a)});return d}function e(a){var d={},g;for(g in a)a.hasOwnProperty(g)&&(null===a[g]?d[g]=null:Array.isArray(a[g])?d[g]=c(a[g]):d[g]="object"===typeof a[g]?e(a[g]):a[g]);return d}
return Array.isArray(a)?c(a):e(a)};I.setVerticalCenter=function(a){setTimeout(function(){var c=h(".jimu-vcenter-text",a),e,d;b.forEach(c,function(a){e=n.getContentBox(a).h;n.setStyle(a,{lineHeight:e+"px"})},this);c=h(".jimu-vcenter",a);b.forEach(c,function(a){e=n.getContentBox(a).h;d=n.getContentBox(h(a).parent()[0]).h;n.setStyle(a,{marginTop:(d-e)/2+"px"})},this)},10)};I.merge=L;I.loadStyleLink=function(c,e,d){var g=new p,r,l=require(I.getRequireConfig()).toUrl(e);if(require.cache["url:"+l]){r=require.cache["url:"+
l];var h=l.split("/").pop(),l=l.substr(0,l.length-h.length);r=P(r,l);c=d?n.create("style",{id:c,type:"text/css"},n.byId(d),"before"):n.create("style",{id:c,type:"text/css"},document.getElementsByTagName("head")[0]);c.styleSheet&&!c.sheet?c.styleSheet.cssText=r:c.appendChild(n.toDom(r));g.resolve("load");return g}r=d?n.create("link",{id:c,rel:"stylesheet",type:"text/css",href:l},n.byId(d),"before"):n.create("link",{id:c,rel:"stylesheet",type:"text/css",href:l},document.getElementsByTagName("head")[0]);
a(r,"load",function(){g.resolve("load")});var u=setInterval(function(){var a;if(b.some(document.styleSheets,function(c){if(c.href&&c.href.substr(c.href.indexOf(e),c.href.length)===e)return a=c,!0}))try{!g.isFulfilled()&&(a.cssRules&&a.cssRules.length||a.rules&&a.rules.length)&&g.resolve("load"),clearInterval(u)}catch(fa){}},50);return g};I.changeLocation=function(a){window.history.pushState&&window.history.pushState({path:a},"",a)};I.urlToObject=function(a){var c=null;-1===a.indexOf("#")?(c=H.urlToObject(a),
c.hash=null):(a=a.split("#"),c=H.urlToObject(a[0]),c.hash=a[1]?-1<a[1].indexOf("\x3d")?d.queryToObject(a[1]):a[1]:null);return c};I.addManifestProperies=function(a){a.icon=a.url+"images/icon.png";"theme"===a.category?R(a):("undefined"!==typeof a["2D"]&&(a.support2D=a["2D"]),"undefined"!==typeof a["3D"]&&(a.support3D=a["3D"]),"undefined"===typeof a["2D"]&&"undefined"===typeof a["3D"]&&(a.support2D=!0),delete a["2D"],delete a["3D"],"undefined"===typeof a.properties&&(a.properties={}),O.processWidgetProperties(a))};
I.getUniqueValues=function(a,c){var e=new p;a=a.replace(/\/*$/g,"")+"/generateRenderer";c=l.stringify({type:"uniqueValueDef",uniqueValueFields:[c]});D(a,{query:{classificationDef:c,f:"json"},responseType:"json",callbackParamName:"callback"}).then(q.hitch(this,function(a){var c=a.data;a=[];(c=c&&c.uniqueValueInfos)&&0<c.length&&(a=b.map(c,q.hitch(this,function(a){return a.value})));e.resolve(a)}),q.hitch(this,function(a){e.reject(a)}));return e};I.combineRadioCheckBoxWithLabel=function(a,c){var e=
!1;if(a&&1===a.nodeType&&"input"===a.tagName.toLowerCase()){var d=a.getAttribute("type")||"",d=d.toLowerCase();if("radio"===d||"checkbox"===d)e=!0}d=!1;c&&1===c.nodeType&&"label"===c.tagName.toLowerCase()&&(d=!0);e&&d&&(e=a.getAttribute("id"),e||(e="input_"+I.getRandomString(),a.setAttribute("id",e)),c.setAttribute("for",e),n.setStyle(c,"cursor","pointer"))};I.convertExtentToPolygon=function(a){var c=a.xmin,e=a.xmax,d=a.ymin,g=a.ymax;return new B({rings:[[[c,g],[e,g],[e,d],[c,d],[c,g]]],spatialReference:a.toJson()})};
I.combineGeometries=function(a){function c(a){var c={points:[],spatialReference:a[0].spatialReference.toJson()};b.forEach(a,function(a){c.points=c.points.concat(a.points)});return new z(c)}function e(a){var c={paths:[],spatialReference:a[0].spatialReference.toJson()};b.forEach(a,function(a){c.paths=c.paths.concat(a.paths)});return new A(c)}function d(a){var c={rings:[],spatialReference:a[0].spatialReference.toJson()};b.forEach(a,function(a){"polygon"===a.type?c.rings=c.rings.concat(a.rings):"extent"===
a.type&&(a=I.convertExtentToPolygon(a),c.rings=c.rings.concat(a.rings))});return new B(c)}var g=null;if(a&&0<a.length)if(1===a.length)g=a[0];else{for(var r=null,l=null,h=null,u=null,m=0;m<a.length;m++){r=a[m];switch(r.type){case "point":case "multipoint":u="point";break;case "polyline":u="polyline";break;case "polygon":case "extent":u="polygon";break;default:return null}if(0===m)h=u;else if(h!==u)return null;if(m!==a.length-1&&(l=a[m+1],!r.spatialReference.equals(l.spatialReference)))return null}"point"===
u?g=c(a):"polyline"===u?g=e(a):"polygon"===u&&(g=d(a))}return g};I.isFeaturelayerUrlSupportQuery=function(a,c){var e=!1,d=/\/featureserver\//gi.test(a);a=/\/mapserver\//gi.test(a);c=(c||"").toLowerCase();d?e=0<=c.indexOf("query"):a&&(e=0<=c.indexOf("data"));return e};I.isImageServiceSupportQuery=function(a){return 0<=(a||"").toLowerCase().indexOf("catalog")};I.isStringEndWith=function(a,c){return a.lastIndexOf(c)+c.length===a.length};I.processManifestLabel=function(a,c){a.label=a.i18nLabels&&(a.i18nLabels[c]||
a.i18nLabels.defaultLabel)||a.label||a.name;a.layouts&&b.forEach(a.layouts,function(e){var d="i18nLabels_layout_"+e.name;e.label=a[d]&&(a[d][c]||a[d].defaultLabel)||e.label||e.name});a.styles&&b.forEach(a.styles,function(e){var d="i18nLabels_style_"+e.name;e.label=a[d]&&(a[d][c]||a[d].defaultLabel)||e.label||e.name})};I.addManifest2WidgetJson=function(a,c){q.mixin(a,c.properties);a.name=c.name;a.label||(a.label=c.label);a.manifest=c};I.widgetJson=function(){var a={addManifest2WidgetJson:function(a,
c){q.mixin(a,c.properties);a.name=c.name;a.label||(a.label=c.label);a.manifest=c;a.isRemote=c.isRemote;a.isRemote&&(a.itemId=c.itemId);c.featureActions&&(a.featureActions=c.featureActions);a.icon||(a.icon=c.icon);a.thumbnail||(a.thumbnail=c.thumbnail);a.folderUrl=c.folderUrl;a.amdFolder=c.amdFolder},removeManifestFromWidgetJson:function(a){if(a.manifest){for(var c in a.manifest.properties)a[c]=void 0;a.name=void 0;a.label=void 0;a.featureActions=void 0;a.manifest=void 0}},getUriFromItem:function(c){return c.url?
a.getFolderUrlFromItem(c)+"Widget":null},getFolderUrlFromItem:function(a){if(!a.url)return null;a=/manifest\.json$/.test(a.url)?a.url.substring(0,a.url.length-13):/\/$/.test(a.url)?a.url:a.url+"/";"https:"===window.location.protocol&&(a=a.replace(/^http:\/\//,"https://"));return a}};return a}();I.addI18NLabel=function(a){var c=new p;if(a.i18nLabels)return c.resolve(a),c;a.i18nLabels={};if(a.properties&&!1===a.properties.hasLocale)return c.resolve(a),c;var e="widget"===a.category?"_widgetLabel":"_themeLabel";
require(I.getRequireConfig(),["dojo/i18n!"+a.amdFolder+"nls/strings"],function(d){a.i18nLabels[dojoConfig.locale]=d[e];"theme"===a.category&&(a.layouts&&a.layouts.forEach(function(c){a["i18nLabels_layout_"+c.name]={};a["i18nLabels_layout_"+c.name][dojoConfig.locale]=d["_layout_"+c.name]}),a.styles&&a.styles.forEach(function(c){a["i18nLabels_style_"+c.name]={};a["i18nLabels_style_"+c.name][dojoConfig.locale]=d["_style_"+c.name]}));c.resolve(a)});return c};I.localizeNumber=function(a,c){var d=(a.toString().split(".")[1]||
"").length,g="",g=c&&isFinite(c.places)&&c.places,g=0<g||0<d?"#,###,###,##0.0"+Array.prototype.join.call({length:0<g?g+1:d},"0"):"#,###,###,##0",d={locale:k.locale,pattern:g};q.mixin(d,c||{});try{return e.format(a,d)}catch(Z){return console.error(Z),a.toLocaleString()}};I.parseNumber=function(a,c){var d={locale:k.locale};q.mixin(d,c||{});try{return e.parse(a,d)}catch(S){return console.error(S),a}};I.localizeDate=function(a,c){var e={locale:k.locale,fullYear:!0};q.mixin(e,c||{});try{return u.format(a,
e)}catch(S){return console.error(S),"date"===e.selector?a.toLocaleDateString():"time"===e.selector?a.toLocaleTimeString():a.toLocaleString()}};I.localizeNumberByFieldInfo=function(a,c){var e=null,e=q.exists("format.places",c)&&c.format.places,e=I.localizeNumber(a,{places:e});return q.exists("format.digitSeparator",c)&&!c.format.digitSeparator?e.toString().replace(new RegExp("\\"+t.group,"g"),""):e};I.fieldFormatter={getFormattedUrl:function(a){if(a&&"string"===typeof a){var c=a.indexOf("http:");-1===
c&&(c=a.indexOf("https:"));if(-1<c&&-1===a.indexOf("href\x3d")){var e=a.indexOf(" ",c);-1===e&&(e=a.length);var d=a.substring(c,e);a=a.substring(0,c)+'\x3cA href\x3d"'+d+'" target\x3d"_blank"\x3e'+d+"\x3c/A\x3e"+a.substring(e,a.length)}}return a||""},getFormattedNumber:function(a,c){if("number"===typeof a){var e=(a.toString().split(".")[1]||"").length;a=I.localizeNumberByFieldInfo(a,{format:{places:c&&"number"===typeof c.places?parseInt(c.places,10):e,digitSeparator:c&&c.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+
(a||"")+"\x3c/span\x3e"}return a},getFormattedDate:function(a){a&&(a=I.localizeDate(new Date(a),{fullYear:!0}));return a||""},getCodedValue:function(a,c){if(a&&a.codedValues){for(var e=0,d=a.codedValues.length;e<d;e++){var g=a.codedValues[e];if(I.isDefined(c)&&q.exists("code",g)&&c.toString()===g.code.toString())return g.name}return c}return c||null},getTypeName:function(a,c){for(var e=c.length,d=0;d<e;d++)if(a===c[d].id)return c[d].name;return a}};I.addRelativePathInCss=P;I.url={isAbsolute:function(a){return a?
a.startWith("http")||a.startWith("/"):!1},removeQueryParamFromUrl:function(a,c){a=H.urlToObject(a);a.query&&delete a.query[c];c=a.path;for(var e in a.query)c=c===a.path?c+"?"+e+"\x3d"+a.query[e]:c+"\x26"+e+"\x3d"+a.query[e];return c},addQueryParamToUrl:function(a,c,e){a=H.urlToObject(a);a.query||(a.query={});a.query[c]=e;c=a.path;for(var d in a.query)c=c===a.path?c+"?"+d+"\x3d"+a.query[d]:c+"\x26"+d+"\x3d"+a.query[d];return c}};I.processUrlInWidgetConfig=function(a,c){if(a)return a.startWith("data:")||
a.startWith("http")||a.startWith("/")?a:a.startWith("${appPath}")?a.replace("${appPath}",window.appInfo.appPath):c+a};I.processUrlInAppConfig=function(a){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?a:window.appInfo.appPath+a};I.getLocationUrlWithoutHashAndQueryParams=function(){var a=window.location,c=a.protocol+"//"+a.host+a.pathname,a=H.urlToObject(a.href);a.query&&a.query.apiurl&&(c=I.url.addQueryParamToUrl(c,"apiurl",a.query.apiurl));return c};I.getDefaultWebMapThumbnail=
function(){return require.toUrl("jimu/images/webmap.png")};I.invertColor=function(a){a=a.substring(1);3===a.length&&(a=a.slice(0,1)+a.slice(0,1)+a.slice(1,1)+a.slice(1,1)+a.slice(2,1)+a.slice(2,1));a=parseInt(a,16);return 7829367<a?"#000000":"#ffffff"};I.mixinAppConfigPosition=function(a,c){var e=q.clone(a);if(!c)return e;c=q.clone(c);var d=e.widgetOnScreen,g=c.widgetOnScreen;g&&g.widgets&&("[object Object]"===Object.prototype.toString.call(g.widgets)?b.forEach(d.widgets,function(a,c){c=a.uri?a.uri:
"ph_"+c;g.widgets[c]&&g.widgets[c].position&&(g.widgets[c].position.relativeTo||(g.widgets[c].position.relativeTo="map"),a.position=g.widgets[c].position)},this):b.forEach(g.widgets,function(a,c){a.position&&!a.position.relativeTo&&(a.position.relativeTo="map");d.widgets[c]&&a.position&&(d.widgets[c].position=a.position)}));g&&g.groups&&("[object Object]"===Object.prototype.toString.call(g.groups)?b.forEach(d.groups,function(a,c){c=a.label?a.label:"g_"+c;g.groups[c]&&g.groups[c].panel&&g.groups[c].panel.position&&
(g.groups[c].panel.position.relativeTo||(g.groups[c].panel.position.relativeTo="map"),a.panel.position=g.groups[c].panel.position)},this):(a=a.layoutDefinition?a.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager","jimu/layoutManagers/AbsolutePositionLayoutManager"===a?b.forEach(g.groups,function(a,c){a.panel&&a.panel.position&&!a.panel.position.relativeTo&&(a.panel.position.relativeTo="map");d.groups[c]&&a.panel&&a.panel.position&&(d.groups[c].panel.position=a.panel.position)}):
"jimu/layoutManagers/GridLayoutManager"===a&&(d.groups=J(d.groups,g.groups.map(function(a){return a.id})))));c.map&&c.map.position&&(e.map?e.map.position=c.map.position:e.map={position:c.map.position});c.widgetPool&&c.widgetPool.panel&&(c.widgetPool.panel.position&&!c.widgetPool.panel.position.relativeTo&&(c.widgetPool.panel.position.relativeTo="map"),e.widgetPool.panel.position=c.widgetPool.panel.position);c.mobileLayout&&(e.mobileLayout=c.mobileLayout);return e};I.handleGridLayoutOnScreenGroupChange=
J;I.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(a,c,e){var d=-1;c=a.search(new RegExp(c));0<=c&&(a=a.slice(c,a.length),a=a.indexOf(e),d=c+a+e.length);return{firstPos:c,lastPos:d}},setConfigValue:function(a,c,e){U(a,c,e)},getConfigValue:function(a,c){return U(a,c)},setConfigValueWithId:function(a,c,e){Q(a,c,e)},getConfigValueWithId:function(a,c){return Q(a,c)},getKeyInfo:function(a){var c=this.getWidgetIdByKey(a);if(null!==c)return{type:"widget",
id:c};a=this.getGroupIdByKey(a);return null!==a?{type:"group",id:a}:{type:"unknow",id:null}},getWidgetIdByKey:function(a){var c=I.template.getSearchRange(a,I.template.widgetIdentification,"]");if(-1===c.firstPos)a=null;else{var e=a.slice(c.firstPos,c.lastPos);a=a.slice(c.firstPos+e.indexOf("[")+1,c.lastPos-1)}return a},getGroupIdByKey:function(a){var c=I.template.getSearchRange(a,I.template.groupIdentification,"]");if(-1===c.firstPos)a=null;else{var e=a.slice(c.firstPos,c.lastPos);a=a.slice(c.firstPos+
e.indexOf("[")+1,c.lastPos-1)}return a},getConfigedWidgetsByTemplateConfig:function(a){var c=[],e=I.template.widgetIdentification+"_config",d;b.forEach(a.configurationSettings,function(a){b.forEach(a.fields,function(a){a.fieldName&&(d=I.template.getSearchRange(a.fieldName,e,"]"),0<=d.firstPos&&(a=I.template.getWidgetIdByKey(a.fieldName),-1===c.indexOf(a)&&c.push(a)))},this)},this);return c},mergeTemplateAppConfigToAppConfig:function(a,c,e){function d(a){var c=[];b.forEach(a,function(a){a&&c.push(a)},
this);return c}var g=a.widgetOnScreen,r=a.portalUrl;c.values.webmap&&(a.map.itemId=c.values.webmap);e&&(a.map.mapOptions&&I.deleteMapOptions(a.map.mapOptions),a.map.portalUrl=r,c.values.app_title||(c.values.app_title=e.title),c.values.app_subtitle||(c.values.app_subtitle=e.snippet));for(var l in c.values)"webmap"!==l&&I.template.setConfigValueWithId(a,l,c.values[l]);a.widgetPool.widgets=d(a.widgetPool.widgets);g.widgets=d(g.widgets);if(a.widgetPool.groups)for(c=0;c<a.widgetPool.groups.length;c++)a.widgetPool.groups[c].widgets=
d(a.widgetPool.groups[c].widgets);if(g.groups)for(c=0;c<g.groups.length;c++)g.groups[c].widgets=d(g.groups[c].widgets);return a}};I.deleteMapOptions=function(a){a&&(delete a.extent,delete a.lods,delete a.center,delete a.scale,delete a.zoom,delete a.maxScale,delete a.maxZoom,delete a.minScale,delete a.minZoom,delete a.initialState)};I.localeIsSame=function(a,c){return a.split("-")[0]===c.split("-")[0]};I.graphicsExtent=function(){return null};I.sanitizeHTML=function(a){return html_sanitize(a,function(a){return a},
function(a){return a})};I.stripHTML=function(a){return a?-1<a.indexOf("\x3c")&&-1<a.indexOf("\x3e")?a.replace(/<(?:.|\s)*?>/g,""):a:a};I.removeSuffixSlashes=function(a){return a.replace(/\/*$/g,"")};I.getBestDisplayAttributes=function(a,c){var e={},d=null,g;for(g in a)d=I.getBestDisplayValue(g,a,c),e[g]=d;return e};I.getBestDisplayValue=function(a,c,e){var d="",g=null;q.isArrayLike(e)?g=I.getFieldInfoByFieldName(e,a):"object"===typeof e&&e.name===a&&(g=e);g&&(d=c[a],"esriFieldTypeDate"===g.type?d&&
(a=new Date(parseInt(d,10)),d=I._tryLocaleDate(a)):"number"===typeof d&&(g.domain&&"codedValue"===g.domain.type?b.some(g.domain.codedValues,function(a){if(a.code===d)return d=a.name,!0}):d=I._tryLocaleNumber(d)));if(null===d||void 0===d)d="";return d};I._tryLocaleNumber=function(a){var c=I.localizeNumber(a);if(null===c||void 0===c)c=a;return c};I._tryLocaleDate=function(a){var c=I.localizeDate(a);c||(c=a.toLocaleDateString());return c};I.getFieldInfoByFieldName=function(a,c){var e=null;a&&0<a.length&&
b.some(a,q.hitch(this,function(a){return a.name===c?(e=a,!0):!1}));return e};I.containsNonLatinCharacter=function(a){for(var c=0;c<a.length;c++)if(255<a.charCodeAt(c))return!0;return!1};I.isVersion4API=function(){return 0===y.version.indexOf("4")};I.getEsriConfig=function(){return w};I.getEsriConfigRequestObject=function(){var a=null;return a=I.isVersion4API()?w.request:w.defaults.io};I.setGlobalGeometryService=function(a){a=new E(a);I.isVersion4API()?w.geometryService=a:w.defaults.geometryService=
a;return a};I.getQueryableFeatureLayersFromMap=function(a){var c=[];a.layers&&(c=a.layers.filter(function(a){return"esri.layers.FeatureLayer"===a.declaredClass&&a.url&&a.supportedQueryFormats&&0<=a.supportedQueryFormats.toUpperCase().indexOf("JSON")}));return c};I.has=function(a){var c=f(a);if(c)return c;if("ie"===a.toLowerCase()){a=0;var e=/MSIE (\d+\.\d+);/.test(navigator.userAgent),d=!!navigator.userAgent.match(/Trident\/7.0/),g=navigator.userAgent.indexOf("rv:11.0");e&&(a=Number(RegExp.$1));-1!==
navigator.appVersion.indexOf("MSIE 10")&&(a=10);d&&-1!==g&&(a=11);return 11===a&&11||c}if("edge"===a.toLowerCase())return navigator.userAgent.split("Edge/")[1]||c};I.detectUserAgent=function(){var a={},c={},e=navigator.userAgent,d=navigator.platform,g=e.match(/Web[kK]it[\/]{0,1}([\d.]+)/),r=e.match(/(Android);?[\s\/]+([\d.]+)?/),l=!!e.match(/\(Macintosh\; Intel /),h=e.match(/(iPad).*OS\s([\d_]+)/),u=e.match(/(iPod)(.*OS\s([\d_]+))?/),m=!h&&e.match(/(iPhone\sOS)\s([\d_]+)/),t=e.match(/(webOS|hpwOS)[\s\/]([\d.]+)/),
d=/Win\d{2}|Windows/.test(d),f=e.match(/Windows Phone ([\d.]+)/),p=t&&e.match(/TouchPad/),b=e.match(/Kindle\/([\d.]+)/),k=e.match(/Silk\/([\d._]+)/),y=e.match(/(BlackBerry).*Version\/([\d.]+)/),x=e.match(/(BB10).*Version\/([\d.]+)/),z=e.match(/(RIM\sTablet\sOS)\s([\d.]+)/),w=e.match(/PlayBook/),v=e.match(/Chrome\/([\d.]+)/)||e.match(/CriOS\/([\d.]+)/),n=e.match(/Firefox\/([\d.]+)/),A=e.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),G=e.match(/MSIE\s([\d.]+)/)||e.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),
D=!v&&e.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),H=D||e.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);c.webkit=!!g;c.webkit&&(c.version=g[1]);r&&(a.android=!0,a.version=r[2]);m&&!u&&(a.ios=a.iphone=!0,a.version=m[2].replace(/_/g,"."));h&&(a.ios=a.ipad=!0,a.version=h[2].replace(/_/g,"."));u&&(a.ios=a.ipod=!0,a.version=u[3]?u[3].replace(/_/g,"."):null);f&&(a.wp=!0,a.version=f[1]);t&&(a.webos=!0,a.version=t[2]);p&&(a.touchpad=!0);y&&(a.blackberry=!0,a.version=y[2]);
x&&(a.bb10=!0,a.version=x[2]);z&&(a.rimtabletos=!0,a.version=z[2]);w&&(c.playbook=!0);b&&(a.kindle=!0,a.version=b[1]);k&&(c.silk=!0,c.version=k[1]);!k&&a.android&&e.match(/Kindle Fire/)&&(c.silk=!0);v&&(c.chrome=!0,c.version=v[1]);n&&(c.firefox=!0,c.version=n[1]);A&&(a.firefoxos=!0,a.version=A[1]);G&&(c.ie=!0,c.version=G[1]);H&&(l||a.ios||d)&&(c.safari=!0,a.ios||(c.version=H[1]));D&&(c.webview=!0);a.tablet=!!(h||w||r&&!e.match(/Mobile/)||n&&e.match(/Tablet/)||G&&!e.match(/Phone/)&&e.match(/Touch/));
a.phone=!(a.tablet||a.ipod||!(r||m||t||y||x||v&&e.match(/Android/)||v&&e.match(/CriOS\/([\d.]+)/)||n&&e.match(/Mobile/)||G&&e.match(/Touch/)));return{os:a,browser:c}};I.isMobileUa=function(){var a=I.detectUserAgent();return!0===a.os.phone||!0===a.os.tablet?!0:!1};I.isNeedHttpsButNot=function(){var a=navigator.geolocation,c=window.hasOwnProperty("isSecureContext");return(c&&window.isSecureContext||!c&&"https:"===window.location.protocol)&&a?!1:!0};I.isInConfigOrPreviewWindow=function(){var a=!1;try{a=
!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(ba){a=!1}return!!a};I.getAppHref=function(){var a="";return a=I.isInConfigOrPreviewWindow()?window.parent.location.href:window.location.href};I.getAppIdFromUrl=function(){var a=!0,c=I.getAppHref();if(-1!==c.indexOf("id\x3d")||-1!==c.indexOf("appid\x3d")||-1!==c.indexOf("apps"))a=!1;if(!0===a)return c;a=this.urlToObject(window.location.href);if(a.query&&(a.query.id||a.query.appid))return a.query.id||a.query.appid;
if(window.appInfo){if(window.appInfo.id)return window.appInfo.id;if(window.appInfo.appPath){if(a=window.appInfo.appPath.split("/"),a.length&&2<a.length)return a[a.length-2]}else console.error("CAN NOT getAppIdFromUrl")}};I.getEditorContentHeight=function(a,c,e){var d=new p;this._content=a;this._dom=c;this._domParam=e;var g=setTimeout(q.hitch(this,function(){clearTimeout(g);g=null;var a=0,c=this._domParam.contentWidth;try{var e=document.createElement("div");e.setAttribute("id","fakeContent");n.setStyle(e,
"background-size","contain");e.innerHTML=this._content;this._dom.appendChild(e);if(e){var r=h("img",e);r&&r.length&&r.style({maxWidth:c-20+"px"});n.setStyle(e,"position","absolute");n.setStyle(e,"width",c+"px");n.setStyle(e,"left","-99999px");n.setStyle(e,"top","-99999px");n.setStyle(e,"visibility","hidden");var l=n.getContentBox(e);l.h&&(a=l.h,a+=this._domParam.contentMarginTop+this._domParam.footerHeight+8)}}catch(ha){console.error("can't getEditorContentHeight"+ha),a=200}d.resolve(a)}),1500);return d};
I.getEditorTextColor=function(a,c){return{name:"dijit.editor.plugins.EditorTextColor",custom:{recordUID:I.getColorRecordName(a),forceAttr:c}}};I.getEditorBackgroundColor=function(a){return{name:"dijit.editor.plugins.EditorBackgroundColor",custom:{recordUID:I.getColorRecordName(a)}}};I.getColorRecordName=function(a){return"wab_cr_"+(a||"")};I.isEsriDomain=function(a){return/^https?:\/\/(?:[\w\-\_]+\.)+(?:esri|arcgis)\.com/.test(a)};I.b64toBlob=function(a,c,e){c=c||"";e=e||512;a=window.atob(a.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,
""));for(var d=[],g=0;g<a.length;g+=e){for(var r=a.slice(g,g+e),l=Array(r.length),h=0;h<r.length;h++)l[h]=r.charCodeAt(h);r=new Uint8Array(l);d.push(r)}return new Blob(d,{type:c})};I.subtractionArray=function(a,c){for(var e=a.length-1;0<=e;e--)for(var d=a[e],g=c.length-1;0<=g;g--)if(d===c[g]){a.splice(e,1);c.splice(g,1);break}return a};I.resourcesUrlToBlob=function(a){return D({url:a,handleAs:"blob"})};I.processItemResourceOfAppConfig=function(a,e){function d(a){var c=a.obj,e=a.key,d={obj:c,key:e};
"number"===typeof a.i?(d.i=a.i,d.value=c[e][a.i]):d.value=c[e];return d}function g(a){for(var c in a)if("object"===typeof a[c])if(Array.isArray(a[c]))for(var e=a,d=c,l=0;l<e[d].length;l++)"string"===typeof e[d][l]?r(e,d,l):"object"===typeof e[d][l]&&g(e[d][l]);else g(a[c]);else"string"===typeof a[c]&&r(a,c)}function r(a,c,g){"number"===typeof g?e.test(a[c][g])&&(u=e.func(d({obj:a,key:c,i:g})),"function"===typeof u.then?h.push(u):l.push(u)):e.test(a[c])&&(u=e.func(d({obj:a,key:c})),"function"===typeof u.then?
h.push(u):l.push(u))}var l=[],h=[],u;g(a);return 0<h.length?c(h).then(function(c){0<l.length&&(c=c.concat(l));return{appConfig:a,result:c}}):{appConfig:a,result:l}};I.isDefined=function(a){return void 0!==a&&null!==a};I.getDefaultPopupInfo=function(a,c,e){var d=null;a&&a.fields&&(d={title:c,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},b.forEach(a.fields,function(a){var c=!1;e?b.some(e,q.hitch(this,function(c){return c&&a.name.toLowerCase()===c.toLowerCase()}))&&(c=!0):c=!0;c&&
(c=this.getDefaultPortalFieldInfo(a),c.visible=!0,c.isEditable=a.editable,d.fieldInfos.push(c))},this));return d};I.getDefaultPortalFieldInfo=function(a){var c=a.name,c={fieldName:c,label:a.alias||c,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"};switch(a.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":c.format={places:0,digitSeparator:!0};break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":c.format={places:2,digitSeparator:!0};break;case "esriFieldTypeDate":c.format=
{dateFormat:"longMonthDayYear"}}return c};I.checkEssentialAppsLicense=function(a,c,e){var d=M.getStandardPortalUrl(c.portalUrl),g=M.getSharingUrl(d),d=new K({appId:"arcgisWebApps",portalUrl:d});G.registerOAuthInfos([d]);return e?G.checkAppAccess(g,"arcgisWebApps"):c.getItemById(a).then(function(a){if("public"!==a.access)return G.checkAppAccess(g,"arcgisWebApps")})};return I})},"dojo/NodeList-traverse":function(){define(["./query","./_base/lang","./_base/array"],function(q,b,n){var f=q.NodeList;b.extend(f,
{_buildArrayFromCallback:function(f){for(var d=[],h=0;h<this.length;h++){var m=f.call(this[h],this[h],d);m&&(d=d.concat(m))}return d},_getUniqueAsNodeList:function(f){for(var d=[],h=0,m;m=f[h];h++)1==m.nodeType&&-1==n.indexOf(d,m)&&d.push(m);return this._wrap(d,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(f,d){f=this._getUniqueAsNodeList(f);f=d?q._filterResult(f,d):f;return f._stash(this)},_getRelatedUniqueNodes:function(f,d){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(d),
f)},children:function(f){return this._getRelatedUniqueNodes(f,function(d,h){return b._toArray(d.childNodes)})},closest:function(f,d){return this._getRelatedUniqueNodes(null,function(h,m){do if(q._filterResult([h],f,d).length)return h;while(h!=d&&(h=h.parentNode)&&1==h.nodeType);return null})},parent:function(f){return this._getRelatedUniqueNodes(f,function(d,h){return d.parentNode})},parents:function(f){return this._getRelatedUniqueNodes(f,function(d,h){for(h=[];d.parentNode;)d=d.parentNode,h.push(d);
return h})},siblings:function(f){return this._getRelatedUniqueNodes(f,function(d,h){h=[];for(var m=d.parentNode&&d.parentNode.childNodes,f=0;f<m.length;f++)m[f]!=d&&h.push(m[f]);return h})},next:function(f){return this._getRelatedUniqueNodes(f,function(d,h){for(d=d.nextSibling;d&&1!=d.nodeType;)d=d.nextSibling;return d})},nextAll:function(f){return this._getRelatedUniqueNodes(f,function(d,h){for(h=[];d=d.nextSibling;)1==d.nodeType&&h.push(d);return h})},prev:function(f){return this._getRelatedUniqueNodes(f,
function(d,h){for(d=d.previousSibling;d&&1!=d.nodeType;)d=d.previousSibling;return d})},prevAll:function(f){return this._getRelatedUniqueNodes(f,function(d,h){for(h=[];d=d.previousSibling;)1==d.nodeType&&h.push(d);return h})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-1]]:[],this)},even:function(){return this.filter(function(f,d){return 0!=d%2})},odd:function(){return this.filter(function(f,
d){return 0==d%2})}});return f})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],function(q){q=q.getObject("dojox.encoding.base64",!0);q.encode=function(b){for(var n=[],f=b.length,k=f%3,f=f-k,d=0;d<f;){var h=b[d++]<<16|b[d++]<<8|b[d++];n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(h>>>18&63));n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(h>>>12&63));n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(h>>>
6&63));n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(h&63))}switch(k){case 2:h=b[d++]<<16|b[d++]<<8;n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(h>>>18&63));n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(h>>>12&63));n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(h>>>6&63));n.push("\x3d");break;case 1:h=b[d++]<<16,n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(h>>>
18&63)),n.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(h>>>12&63)),n.push("\x3d"),n.push("\x3d")}return n.join("")};q.decode=function(b){b=b.split("");for(var n=[],f=b.length;"\x3d"==b[--f];);for(var k=0;k<f;){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[k++])<<18;k<=f&&(d|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[k++])<<12);k<=f&&(d|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[k++])<<
6);k<=f&&(d|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[k++]));n.push(d>>>16&255);n.push(d>>>8&255);n.push(d&255)}for(;0==n[n.length-1];)n.pop();return n};return q})},"jimu/portalUrlUtils":function(){define(["dojo/_base/lang","jimu/shared/basePortalUrlUtils"],function(q,b){var n=q.clone(b);n.declaredClass="jimu.portalUrlUtils";n.getPortalUrlFromLocation=function(){return n.getPortalServerFromLocation()+n.getDeployContextFromLocation()};n.getPortalSignInUrlFromLocation=
function(){return n.getPortalUrlFromLocation()+"home/signin.html"};n.getPortalServerFromLocation=function(){return window.location.protocol+"//"+window.location.host};n.getDeployContextFromLocation=function(){var f=window.location.href.split("?")[0],b=f.indexOf("/home/");0>b&&(b=f.indexOf("/apps/"));f=f.substring(f.indexOf(window.location.host)+window.location.host.length+1,b);"/"!==f&&(f="/"+f+"/");return f};n.getRestBaseUrlFromLocation=function(){return window.location.protocol+"//"+window.location.host+
n.getDeployContextFromLocation()+"sharing/rest/"};return n})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var q={declaredClass:"jimu.shared.basePortalUrlUtils"};"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=function(b){return this.substr(0,b.length)===b});"function"!==typeof String.prototype.endWith&&(String.prototype.endWith=
function(b){return this.substr(this.length-b.length,b.length)===b});q.getServerByUrl=function(b){b=(b||"").trim();b=b.replace(/^(http(s?):?)\/\//gi,"");0===b.indexOf("//")&&(b=b.slice(2));return b.split("/")[0]};q.getServerWithProtocol=function(b){var n="";if(b=(b||"").trim()){var f=q.getServerByUrl(b);if(!f)return n;var k=q.getProtocol(b);k?n=k+"://"+f:0===b.indexOf("//")&&(n="//"+f)}return n};q.isSameServer=function(b,n){b=q.getServerByUrl(b)||"";n=q.getServerByUrl(n)||"";return b.toLowerCase()===
n.toLowerCase()};q.isOnline=function(b){return 0<=q.getServerByUrl(b).toLowerCase().indexOf(".arcgis.com")};q.isArcGIScom=function(b){b=q.getServerByUrl(b).toLowerCase();return"www.arcgis.com"===b||"arcgis.com"===b};q.getStandardPortalUrl=function(b){var n=q.getServerByUrl(b);if(""===n)return"";q.isOnline(n)?(q.isArcGIScom(n)&&(n="www.arcgis.com"),b=q.addProtocol(b),b=q.getProtocol(b)+"://"+n):(b=(b||"").trim().replace(/sharing(.*)/gi,"").replace(/\/*$/g,""),b=q.addProtocol(b),b.replace(new RegExp("http(s?)://"+
n,"g"),"")||(b+="/arcgis"));return b};q.isSamePortalUrl=function(b,n){var f=/^http(s?):\/\//gi,k=/^\/\//gi;b=q.getStandardPortalUrl(b).toLowerCase().replace(f,"").replace(k,"");n=q.getStandardPortalUrl(n).toLowerCase().replace(f,"").replace(k,"");return b===n};q.addProtocol=function(b){if(-1>=b.toLowerCase().indexOf("http://")&&-1>=b.toLowerCase().indexOf("https://")){var n="";"undefined"!==typeof window&&window.location?(n=window.location.protocol,b=b.startWith("//")?n+b:b.startWith("/")?n+"//"+
window.location.host+b:n+"//"+b):(n="http:",b.startWith("//")&&(b=n+b))}return b};q.getProtocol=function(b){var n="";b=b.toLowerCase();0===b.indexOf("https://")?n="https":0===b.indexOf("http://")&&(n="http");return n};q.updateUrlProtocolByOtherUrl=function(b,n){n=n.toLowerCase();0===n.indexOf("https://")?b=q.setHttpsProtocol(b):0===n.indexOf("http://")&&(b=q.setHttpProtocol(b));return b};q.removeProtocol=function(b){return b.replace(/^http(s?):\/\//i,"//")};q.setHttpProtocol=function(b){b=q.addProtocol(b);
return b.replace(/^https:\/\//,"http://")};q.setHttpsProtocol=function(b){b=q.addProtocol(b);return b.replace(/^http:\/\//,"https://")};q.setProtocol=function(b,n){return 0<=n.indexOf("https")?q.setHttpsProtocol(b):0<=n.indexOf("http")?q.setHttpProtocol(b):b};q.getSharingUrl=function(b){var n="";(b=q.getStandardPortalUrl(b))&&(n=b+"/sharing");return n};q.getOAuth2Url=function(b){var n="";(b=q.getStandardPortalUrl(b))&&(n=b+"/sharing/oauth2");return n};q.getAppIdUrl=function(b,n){var f="";(b=q.getStandardPortalUrl(b))&&
(f=b+"/sharing/oauth2/apps/"+n);return f};q.getSignInUrl=function(b){var n="";(b=q.getStandardPortalUrl(b))&&(n=b+"/home/signin.html");return n};q.getBaseSearchUrl=function(b){var n="";b=q.getStandardPortalUrl(b);(b=b.replace(/\/*$/g,""))&&(n=b+"/sharing/rest/search");return n};q.getBaseItemUrl=function(b){var n="";(b=q.getStandardPortalUrl(b))&&(n=b+"/sharing/rest/content/items");return n};q.getItemUrl=function(b,n){var f="";(b=q.getBaseItemUrl(b))&&n&&(f=b+"/"+n);return f};q.getItemDataUrl=function(b,
n){var f="";(b=q.getItemUrl(b,n))&&(f=b+"/data");return f};q.getGenerateTokenUrl=function(b){var n="";b&&(b=q.getStandardPortalUrl(b),n=b+"/sharing/generateToken");return n};q.getItemDetailsPageUrl=function(b,n){var f="";b&&n&&(b=q.getStandardPortalUrl(b),f=b+"/home/item.html?id\x3d"+n);return f};q.getUserProfilePageUrl=function(b,n){var f="";b&&n&&(b=q.getStandardPortalUrl(b),f=b+"/home/user.html?user\x3d"+n);return f};q.getBaseGroupUrl=function(b){var n="";(b=q.getStandardPortalUrl(b))&&(n=b+"/sharing/rest/community/groups");
return n};q.getPortalSelfInfoUrl=function(b){var n="";(b=q.getStandardPortalUrl(b||""))&&(n=b+"/sharing/portals/self");return n};q.getCommunitySelfUrl=function(b){var n="";(b=q.getStandardPortalUrl(b||""))&&(n=b+"/sharing/rest/community/self");return n};q.getBaseUserUrl=function(b){var n="";(b=q.getStandardPortalUrl(b))&&(n=b+"/sharing/rest/community/users");return n};q.getUserUrl=function(b,n){var f="",k=q.getBaseUserUrl(b);b&&n&&(f=k+"/"+n);return f};q.getUserTagsUrl=function(b,n){var f="",k=q.getUserUrl(b,
n);b&&n&&(f=k+"/tags");return f};q.getUserThumbnailUrl=function(b,n,f){var k="";(b=q.getUserUrl(b,n))&&f&&(k=b+"/info/"+f);return k};q.getContentUrl=function(b){var n="";b&&(b=q.getStandardPortalUrl(b),n=b+"/sharing/rest/content");return n};q.getUserContentUrl=function(b,n,f){var k="",k="";b&&n&&(k=q.getContentUrl(b),k=f?k+"/users/"+n+"/"+f:k+"/users/"+n);return k};q.getUserContentItemUrl=function(b,n,f){var k="",k="";b&&n&&f&&(k=q.getUserContentUrl(b,n),k=k+"/items/"+f);return k};q.getItemResourceUrl=
function(b,n,f){var k="",k="";b&&n&&(k=q.getContentUrl(b),k=f?k+"/items/"+n+"/resources/"+f:k+"/items/"+n+"/resources");return k};q.getAddItemUrl=function(b,n,f){var k="",k="";b&&n&&(k=q.getUserContentUrl(b,n,f),k+="/addItem");return k};q.getDeleteItemUrl=function(b,n,f){var k="";(b=q.getUserItemsUrl(b,n))&&(k=b+"/"+f+"/delete");return k};q.getUserItemsUrl=function(b,n,f){var k="",k="";b&&n&&(k=q.getUserContentUrl(b,n,f),k+="/items");return k};q.getUpdateItemUrl=function(b,n,f,k){var d="",d="";b&&
n&&(d=q.getUserItemsUrl(b,n,k),d=d+"/"+f+"/update");return d};q.shareItemUrl=function(b,n,f,k){var d="",d="";b&&n&&(d=q.getUserItemsUrl(b,n,k),d=d+"/"+f+"/share");return d};q.getHomeIndexUrl=function(b){var n="";(b=q.getStandardPortalUrl(b))&&(n=b+"/home/index.html");return n};q.getHomeMapViewerUrl=function(b,n){var f="";if(b=q.getStandardPortalUrl(b))f=b+"/home/webmap/viewer.html",f=n?f+("?webmap\x3d"+n):f+"?useExisting\x3d1";return f};q.getHomeGalleryUrl=function(b){var n="";(b=q.getStandardPortalUrl(b))&&
(n=b+"/home/gallery.html");return n};q.getHomeGroupsUrl=function(b){var n="";(b=q.getStandardPortalUrl(b))&&(n=b+"/home/groups.html");return n};q.getHomeMyContentUrl=function(b){var n="";(b=q.getStandardPortalUrl(b))&&(n=b+"/home/content.html");return n};q.getHomeMyOrganizationUrl=function(b){var n="";(b=q.getStandardPortalUrl(b))&&(n=b+"/home/organization.html");return n};q.getHomeUserUrl=function(b){var n="";(b=q.getStandardPortalUrl(b))&&(n=b+"/home/user.html");return n};q.getPortalHelpUrl=function(b,
n){var f="";(b=q.getStandardPortalUrl(b))&&(f=b+"/portalhelp/"+(n||"en")+"/portal/");return f};q.getPortalAdminHelpUrl=function(b,n){var f="";(b=q.getStandardPortalUrl(b))&&(f=b+"/portalhelp/"+(n||"en")+"/admin/help/");return f};q.getPortalProxyUrl=function(b){var n="";(b=q.getStandardPortalUrl(b))&&(n=b+"/sharing/proxy");return n};q.getOAuth2SignOutUrl=function(b){var n="";(b=q.getStandardPortalUrl(b))&&(n=b+"/sharing/oauth2/signout");return n};q.getNewPrintUrl=function(b){var n="";if(b=q.getStandardPortalUrl(b))b=
q.setHttpProtocol(b),n=b+"/sharing/tools/newPrint";return n};return q})},"jimu/shared/utils":function(){define(["./basePortalUrlUtils"],function(q){function b(f,d){function h(d,h){var c,a,l,g,e="widgetOnScreen"===d;if(f[d]){if(f[d].groups)for(c=0;c<f[d].groups.length;c++)if(l=f[d].groups[c],h(l,{index:c,isWidget:!1,groupId:l.id,isThemeWidget:!1,isOnScreen:e}),f[d].groups[c].widgets)for(a=0;a<f[d].groups[c].widgets.length;a++)g=f[d].groups[c].widgets[a],h(g,{index:a,isWidget:!0,groupId:l.id,isThemeWidget:g.uri&&
-1<g.uri.indexOf("themes/"+f.theme.name),isOnScreen:e});if(f[d].widgets)for(c=0;c<f[d].widgets.length;c++)g=f[d].widgets[c],h(f[d].widgets[c],{index:c,isWidget:!0,groupId:d,isThemeWidget:g.uri&&-1<g.uri.indexOf("themes/"+f.theme.name),isOnScreen:e})}}h("widgetOnScreen",d);h("widgetPool",d)}var n={},f="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwitched isController hasVersionManager isThemeWidget supportMultiInstance mirrorIconForRTL".split(" ");
n.visitElement=b;n.getConfigElementById=function(f,d){var h;if("map"===d)return f.map;b(f,function(m){if(m.id===d)return h=m,!0});return h};n.getConfigElementByLabel=function(f,d){var h;if("map"===d)return f.map;b(f,function(m){if(m.label||m.name===d)return h=m,!0});return h};n.getConfigElementsByName=function(f,d){var h=[];if("map"===d)return[f.map];b(f,function(m){m.name===d&&h.push(m)});return h};n.getWidgetNameFromUri=function(f){f=f.split("/");f.pop();return f.pop()};n.getAmdFolderFromUri=function(f){f=
f.split("/");f.pop();return f.join("/")+"/"};n.widgetProperties=f;n.processWidgetProperties=function(b){"undefined"===typeof b.properties.isController&&(b.properties.isController=!1);"undefined"===typeof b.properties.isThemeWidget&&(b.properties.isThemeWidget=!1);"undefined"===typeof b.properties.hasVersionManager&&(b.properties.hasVersionManager=!1);"undefined"===typeof b.properties.mirrorIconForRTL&&(b.properties.mirrorIconForRTL=!1);f.forEach(function(d){"undefined"===typeof b.properties[d]&&(b.properties[d]=
!0)})};n.getControllerWidgets=function(f){var d=[];f.visitElement(function(h){h.isController&&d.push(h)});return d};n.isHostedService=function(f){var d=q.getServerByUrl(f);return(new RegExp(d+"/[^/]+/[^/]+/rest/services","gi")).test(f)};return n})},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all ./utils jimu/tokenUtils ./dijit/Message".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t){var r=null,y=q(h,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;window.isBuilder?(d.subscribe("app/sceneViewLoaded",b.hitch(this,this._onSceneViewLoaded)),d.subscribe("app/sceneViewChanged",b.hitch(this,this._onSceneViewChanged))):(d.subscribe("sceneViewLoaded",b.hitch(this,this._onSceneViewLoaded)),d.subscribe("sceneViewChanged",b.hitch(this,this._onSceneViewChanged)));window.isBuilder?(d.subscribe("app/appConfigLoaded",
b.hitch(this,this._onAppConfigLoaded)),d.subscribe("app/appConfigChanged",b.hitch(this,this._onAppConfigChanged))):(d.subscribe("appConfigLoaded",b.hitch(this,this._onAppConfigLoaded)),d.subscribe("appConfigChanged",b.hitch(this,this._onAppConfigChanged)));d.subscribe("userSignIn",b.hitch(this,this._onUserSignIn));d.subscribe("userSignOut",b.hitch(this,this._onUserSignOut));d.subscribe("builder/actionTriggered",b.hitch(this,this._onActionTriggered));d.subscribe("/dnd/move/start",b.hitch(this,this._onMoveStart))},
loadWidget:function(a){var c=new k,r;a=b.clone(a);a.folderUrl||e.processWidgetSetting(a);(r=this.getWidgetById(a.id))?c.resolve(r):g([this.loadWidgetClass(a),this.loadWidgetManifest(a)]).then(b.hitch(this,function(a){var e=a[0],g=a[1];this.loadWidgetResources(g).then(b.hitch(this,function(a){try{var r=this.createWidget(g,e,a);console.log("widget ["+g.uri+"] created.")}catch(F){console.log("create ["+g.uri+"] error:"+F.stack),new t({message:window.jimuNls.createWidgetError+": "+g.uri}),c.reject(F)}setTimeout(b.hitch(this,
function(){c.resolve(r);this.emit("widget-created",r);d.publish("widgetCreated",r)}),50)}),function(a){c.reject(a)})}),function(a){c.reject(a)});return c},loadWidgetClass:function(a){var c=new k,d;d=a.isRemote?a.uri+".js":a.uri;require(e.getRequireConfig(),[d],b.hitch(this,function(a){c.resolve(a)}));e.checkError(a.uri,c);return c},loadWidgetResources:function(a){var c=new k,e,d,r,l=[];r=b.clone(a);a=this.tryLoadWidgetConfig(r);e=this._tryLoadResource(r,"i18n");d=this._tryLoadResource(r,"style");
r=this._tryLoadResource(r,"template");l.push(a);l.push(e);l.push(r);l.push(d);g(l).then(b.hitch(this,function(a){var e={};e.config=a[0];e.i18n=a[1];e.template=a[2];e.style=a[3];c.resolve(e)}),function(a){c.reject(a)});return c},loadWidgetManifest:function(a){var c=new k,d=e.getUriInfo(a.uri),d=d.isRemote?d.folderUrl+"manifest.json?f\x3djson":d.folderUrl+"manifest.json";if(a.manifest)return c.resolve(a),c;l(d,{handleAs:"json",headers:{"X-Requested-With":null}}).then(b.hitch(this,function(d){if(d.error&&
d.error.code)return c.reject(d.error);d.amdFolder=a.amdFolder;d.category="widget";a.label?(this._processManifest(d),e.addManifest2WidgetJson(a,d),c.resolve(a)):e.addI18NLabel(d).then(b.hitch(this,function(){this._processManifest(d);e.addManifest2WidgetJson(a,d);c.resolve(a)}))}),function(a){c.reject(a)});return c},getWidgetMarginBox:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return{};if(a._marginBox)return a._marginBox;a.setPosition({left:-9999,top:-9999,relativeTo:a.position.relativeTo});
this.openWidget(a);a._marginBox=a.getMarginBox();this.closeWidget(a);return a._marginBox},_processManifest:function(a){e.addManifestProperies(a);e.processManifestLabel(a,window.dojoConfig.locale)},createWidget:function(a,c,d){if(this.getWidgetById(a.id))return this.getWidgetById(a.id);d.config&&d.i18n&&(d.config=e.replacePlaceHolder(d.config,d.i18n));a.rawConfig=a.config;a.config=d.config||{};this.appConfig._appData&&this._mergeAgolConfig(a);a.nls=d.i18n||{};d.template&&(a.templateString=d.template);
a["class"]="jimu-widget";a.label||(a.label=a.name);a.sceneView=this.sceneView;a.appConfig=this.appConfig;d={};for(var g in a)a.hasOwnProperty(g)&&(d[g]=a[g]);d.widgetManager=this;a=new c(d);a.clazz=c;p.after(a,"startup",b.hitch(this,this._postWidgetStartup,a));p.before(a,"destroy",b.hitch(this,this._onDestroyWidget,a));m(a.domNode,"click",b.hitch(this,this._onClickWidget,a));this.loaded.push(a);return a},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var a=n.map(this.loaded,
function(a){return a.id});n.forEach(a,function(a){this.destroyWidget(a)},this);this.loaded=[]},loadWidgetSettingPage:function(a){var c=new k;a=b.clone(a);a.id+="_setting";g([this.loadWidgetSettingClass(a)]).then(b.hitch(this,function(e){var d=e[0];this.loadWidgetSettingPageResources(a).then(b.hitch(this,function(e){var g;e={nls:e.i18n,templateString:e.template,appConfig:this.appConfig,sceneView:this.sceneView,"class":"jimu-widget-setting"};for(var r in a)a.hasOwnProperty(r)&&(e[r]=a[r]);try{g=new d(e),
p.before(g,"destroy",b.hitch(this,this._onDestroyWidgetSetting,g)),c.resolve(g)}catch(E){new t({message:window.jimuNls.createWidgetSettingError+":"+a.uri}),c.reject(E)}}),function(a){console.log(a)})}),function(a){c.reject(a)});return c},loadWidgetSettingClass:function(a){var c=new k;require(e.getRequireConfig(),[url],b.hitch(this,function(a){c.resolve(a)}));e.checkError(a.folderUrl+"setting/Setting.js",c);return c},loadWidgetSettingPageResources:function(a){var c=new k,e,d,r=[];a=b.clone(a);e=this._tryLoadResource(a,
"settingI18n");d=this._tryLoadResource(a,"settingTemplate");a=this._tryLoadResource(a,"settingStyle");r.push(e);r.push(d);r.push(a);g(r).then(b.hitch(this,function(a){var e={};e.i18n=a[0]||{};e.template=a[1];e.style=a[2];c.resolve(e)}),function(a){console.log(a)});return c},getWidgetById:function(a){var c;n.some(this.loaded,function(e){if(e.id===a)return c=e,!0},this);return c},getWidgetByLabel:function(a){var c;n.some(this.loaded,function(e){if(e.label===a)return c=e,!0},this);return c},getWidgetsByName:function(a){var c=
[];n.some(this.loaded,function(e){e.name===a&&c.push(e)},this);return c},changeWindowStateTo:function(a,c){"normal"===c?this.normalizeWidget(a):"minimized"===c?this.minimizeWidget(a):"maximized"===c?this.maximizeWidget(a):console.log("error state: "+c)},closeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;if("closed"!==a.state){this.activeWidget&&this.activeWidget.id===a.id&&(this.activeWidget.onDeActive(),this.activeWidget=null);f.setStyle(a.domNode,"display","none");
a.setState("closed");try{a.onClose()}catch(x){console.log(console.error("fail to close widget "+a.name+". "+x.stack))}}},openWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;if(!a.started)try{a.started=!0,a.startup()}catch(x){console.error("fail to startup widget "+a.name+". "+x.stack)}if("closed"===a.state){f.setStyle(a.domNode,"display","");a.setState("opened");try{a.onOpen()}catch(x){console.error("fail to open widget "+a.name+". "+x.stack)}}},activateWidget:function(a){if("string"===
typeof a&&(a=this.getWidgetById(a),!a))return;"opened"===a.state&&this._activeWidget(a)},maximizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("maximized");try{a.onMaximize()}catch(x){console.log(console.error("fail to maximize widget "+a.name+". "+x.stack))}},minimizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("minimized");
try{a.onMinimize()}catch(x){console.log(console.error("fail to minimize widget "+a.name+". "+x.stack))}},normalizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("normal");try{a.onNormalize()}catch(x){console.log(console.error("fail to normalize widget "+a.name+". "+x.stack))}},destroyWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;this._removeWidget(a);try{a.destroy()}catch(x){console.log(console.error("fail to destroy widget "+
a.name+". "+x.stack))}},tryLoadWidgetConfig:function(a){return this._tryLoadWidgetConfig(a).then(b.hitch(this,function(c){return this._upgradeWidgetConfig(a,c).then(function(c){return a.config=c})}))},triggerWidgetOpen:function(a){function c(a){var c=p.after(a,"onOpen",function(){c.remove();e.resolve(a)})}var e=new k,g=this.getWidgetById(a);if(g){if("closed"!==g.state)return e.resolve(g),e;c(g)}else var r=d.subscribe("widgetCreated",b.hitch(this,function(c){c.id===a&&(r.remove(),e.resolve(c))}));
d.publish("openWidget",a);return e},_tryLoadWidgetConfig:function(a){var d=new k;if(a.config&&b.isObject(a.config))return d.resolve(a.config),d;if(a.config){if(require.cache["url:"+a.config])return d.resolve(c.parse(require.cache["url:"+a.config])),d;d=e.processUrlInAppConfig(a.config);d=d.split("/");d[d.length-1]=encodeURIComponent(d[d.length-1]);d=d.join("/");return l(d,{handleAs:"json"})}return this._tryLoadResource(a,"config").then(function(c){a.isDefaultConfig=!0;return c})},_upgradeWidgetConfig:function(a,
c){var d=new k,g=a.manifest.version,r=a.version,l;if(g===r)return d.resolve(c),d;if(!1===a.hasVersionManager)return a.version=g,d.resolve(c),d;require(e.getRequireConfig(),[a.amdFolder+"VersionManager"],b.hitch(this,function(e){e=new e;var h=e.getVersionIndex(r),u=e.getVersionIndex(g);if(h>u)d.reject("Bad widget version number, "+a.name+","+r);else try{l=e.upgrade(c,r,g),a.version=g,d.resolve(l)}catch(H){console.log("Read widget ["+a.name+"] old config error,"+H.stack),d.resolve(c)}}));return d},
loadWidgetStyle:function(a){var c="widget/style/"+a.uri,d=new k,c=this._replaceId(c);return f.byId(c)?(d.resolve("load"),d):e.loadStyleLink(c,a.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(a){var c="widget/style/"+a.uri+"/setting",d=new k,c=this._replaceId(c);return f.byId(c)?(d.resolve("load"),d):e.loadStyleLink(c,a.settingStyleFile)},loadWidgetConfig:function(a){a=require(e.getRequireConfig()).toUrl(a.configFile);if(require.cache["url:"+a]){var d=
new k;d.resolve(c.parse(require.cache["url:"+a]));return d}return l(a,{handleAs:"json"})},loadWidgetI18n:function(a){var c=new k;require(e.getRequireConfig(),["dojo/i18n!"+a.i18nFile],function(a){c.resolve(a)});return c},loadWidgetSettingI18n:function(a){var c=new k;require(e.getRequireConfig(),["dojo/i18n!"+a.settingI18nFile],function(a){c.resolve(a)});return c},loadWidgetTemplate:function(a){var c=new k;require(e.getRequireConfig(),["dojo/text!"+a.templateFile],function(a){c.resolve(a)});e.checkError(a.templateFile,
c);return c},loadWidgetSettingTemplate:function(a){var c=new k;require(e.getRequireConfig(),["dojo/text!"+a.settingTemplateFile],function(a){c.resolve(a)});e.checkError(a.settingTemplateFile,c);return c},removeWidgetStyle:function(a){f.destroy(this._replaceId("widget/style/"+a.uri))},removeWidgetSettingStyle:function(a){f.destroy(this._replaceId("widget/style/"+a.uri+"/setting"))},getControllerWidgets:function(){return n.filter(this.loaded,function(a){return a.isController})},getOffPanelWidgets:function(){return n.filter(this.loaded,
function(a){return!a.inPanel})},getOnScreenOffPanelWidgets:function(){return n.filter(this.loaded,function(a){return a.isOnScreen&&!a.inPanel})},closeOtherWidgetsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;for(var c=0;c<this.loaded.length;c++)this.loaded[c].gid===a.gid&&this.loaded[c].id!==a.id&&this.closeWidget(this.loaded[c])},closeAllWidgetsInGroup:function(a){for(var c=0;c<this.loaded.length;c++)this.loaded[c].gid===a&&this.closeWidget(this.loaded[c])},
_mergeAgolConfig:function(a){var c=this.appConfig._appData.values,d="widgets["+a.id+"]",g;for(g in c){var r=g.replace(/\//g,"_").indexOf(d+"_config");0<=r&&e.template.setConfigValue(a,g.replace(/\//g,"_").substr(r,g.length).replace(d,"widget"),c[g])}},_onUserSignIn:function(a){n.forEach(this.loaded,function(c){c.onSignIn(a)},this)},_onUserSignOut:function(){n.forEach(this.loaded,function(a){a.onSignOut()},this)},_activeWidget:function(a){if(this.activeWidget){if(this.activeWidget.id===a.id){!1===
this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&f.setStyle(this.activeWidget.domNode,"zIndex",101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&f.setStyle(a.domNode,"zIndex","zIndex"in a.position?a.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=a;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&f.setStyle(this.activeWidget.domNode,
"zIndex",101),this.activeWidget.onActive(),d.publish("widgetActived",a))},_onClickWidget:function(c,e){var d=a(".jimu-widget",c.domNode);if(0<d.length)for(var g=0;g<d.length;g++)if(e.target===d[g]||f.isDescendant(e.target,d[g]))return;this._activeWidget(c)},_onMoveStart:function(a){n.forEach(this.loaded,function(c){c.domNode===a.node&&this._activeWidget(c)},this)},_onAppConfigLoaded:function(a){this.appConfig=a=b.clone(a);u.setPortalUrl(a.portalUrl)},_onSceneViewLoaded:function(a){this.sceneView=
a},_onSceneViewChanged:function(a){this.sceneView=a},_onAppConfigChanged:function(a,c,e,d){var g=b.clone(a);this.appConfig=g;n.forEach(this.loaded,function(a){a&&(a.onAppConfigChanged(g,c,e,d),"widgetChange"===c&&this._onConfigChanged(e.id,e.config,d))},this)},_onConfigChanged:function(a,c){if(a=this.getWidgetById(a))a.onConfigChanged(c),b.mixin(a.config,c)},_onActionTriggered:function(a){if("map"!==a.elementId&&"app"!==a.elementId){var c=this.getWidgetById(a.elementId);if(c)c.onAction(a.action,a.data);
else this.missedActions.push({id:a.elementId,action:{name:a.action,data:a.data}});n.forEach(this.getControllerWidgets(),function(c){if(c.widgetIsControlled(a.elementId))c.onAction(a.action,{widgetId:a.elementId,data:a.data})},this)}},_postWidgetStartup:function(a){a.started=!0;e.setVerticalCenter(a.domNode);p.after(a,"resize",b.hitch(this,e.setVerticalCenter,a.domNode));this.openWidget(a);var c=u.getPortalCredential(this.appConfig.portalUrl);if(c)a.onSignIn(c);else a.onSignOut();this._triggerMissedAction(a)},
_triggerMissedAction:function(a){this.missedActions.forEach(function(c){if(c.id===a.id)a.onAction(c.action.name,c.action.data)})},_remove:function(a){return n.some(this.loaded,function(c,e){if(c.id===a)return this.loaded.splice(e,1),!0},this)},_tryLoadResource:function(a,c){var e,d=new k;if("config"===c)e=a.amdFolder+"config.json",a.configFile=e,e="hasConfig";else if("style"===c)e=a.amdFolder+"css/style.css",a.styleFile=e,e="hasStyle";else if("i18n"===c)e=a.amdFolder+"nls/strings.js",a.i18nFile=a.isRemote?
e:a.amdFolder+"nls/strings",e="hasLocale";else if("template"===c)e=a.amdFolder+"Widget.html",a.templateFile=e,e="hasUIFile";else if("settingTemplate"===c)e=a.amdFolder+"setting/Setting.html",a.settingTemplateFile=e,e="hasSettingUIFile";else if("settingI18n"===c)e=a.amdFolder+"setting/nls/strings.js",a.settingI18nFile=a.isRemote?e:a.amdFolder+"setting/nls/strings",e="hasSettingLocale";else if("settingStyle"===c)e=a.amdFolder+"setting/css/style.css",a.settingStyleFile=e,e="hasSettingStyle";else return d;
a[e]?function(){var e;if("config"===c)e=this.loadWidgetConfig(a);else if("style"===c)e=this.loadWidgetStyle(a);else if("i18n"===c)e=this.loadWidgetI18n(a);else if("template"===c)e=this.loadWidgetTemplate(a);else if("settingTemplate"===c)e=this.loadWidgetSettingTemplate(a);else if("settingStyle"===c)e=this.loadWidgetSettingStyle(a);else if("settingI18n"===c)e=this.loadWidgetSettingI18n(a);else return d;e.then(function(a){d.resolve(a)},function(e){console.error("Load widget resource error. resource:",
c);console.error(e);new t({message:window.jimuNls.loadWidgetResourceError+": "+a.uri});d.reject(e)})}.apply(this):d.resolve(null);return d},_replaceId:function(a){return a.replace(/\//g,"_").replace(/\./g,"_")},_onDestroyWidget:function(a){"closed"!==a.state&&this.closeWidget(a);this._removeWidget(a);console.log("destroy widget ["+a.uri+"].")},_onDestroyWidgetSetting:function(a){this.removeWidgetSettingStyle(a)},_removeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;
this.activeWidget&&this.activeWidget.id===a.id&&(this.activeWidget=null);this._remove(a.id);0===this.getWidgetsByName(a.name).length&&this.removeWidgetStyle(a)}});y.getInstance=function(a){null===r&&(r=new y(a),window._widgetManager=r);return r};return y})},"jimu/tokenUtils":function(){define("require dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/request esri/core/urlUtils esri/identity/IdentityManager esri/identity/OAuthInfo jimu/portalUrlUtils jimu/utils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t){"function"!==typeof d.getAll&&(d.getAll=function(a){var c=[];(a=d(a))&&c.push(a);return c});g={portalUrl:null,cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){return t.isInConfigOrPreviewWindow()},isStringStartWith:function(a,c){return a.substr(0,c.length)===c},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(a){(a=u.getStandardPortalUrl(a))&&(a+=
"/");this.portalUrl=a},getPortalUrl:function(){return this.portalUrl},isWebTierPortal:function(a){var e=new k,d=u.getStandardPortalUrl(a);a=d+"/sharing";var g=u.setHttpsProtocol(d+"/sharing/generateToken?f\x3djson"),r=u.setHttpsProtocol(a);p.get(g,{jsonp:"callback"}).then(b.hitch(this,function(a){a.token?(this.webTierPortalUrls.push(d),this.removeWabAuthCookie(),c.id.getCredential(r).then(b.hitch(this,function(c){function r(a){var c=a.creationTime||(new Date).getTime(),e=a.expires;0<c&&0<e&&e>c&&
setTimeout(function(){p.get(g,{jsonp:"callback"}).then(function(c){c.token&&(a.token=c.token,a.expires=c.expires,a.creationTime=(new Date).getTime(),a.refreshServerTokens(),r(a))},function(a){console.error(a)})},.8*(e-c))}c.token||(c.token=a.token);c.expires||(c.expires=a.expires);var h=t.getEsriConfigRequestObject(),m=l.isTrustedServer(c.server,!0);-1<m&&h.corsEnabledServers.splice(m,1);this._pushCorsEnabledServerInfo({host:u.getServerByUrl(d),withCredentials:!0});e.resolve(!0);r(c)}),b.hitch(this,
function(){e.resolve(!0)}))):e.resolve(!1)}),b.hitch(this,function(a){console.error(a);e.reject(a)}));return e},addAuthorizedCrossOriginDomains:function(a){if(a&&0<a.length)for(var c=0;c<a.length;c++)this.addWithCredentialDomain(a[c])},addWithCredentialDomain:function(a){if(a&&"string"===typeof a){var c=t.getEsriConfigRequestObject().corsEnabledServers,e=u.getServerByUrl(a);(a=u.getServerWithProtocol(a))||(a="http://"+e);a=l.isTrustedServer(a,!0);-1<a&&c.splice(a,1);this._pushCorsEnabledServerInfo({host:e,
withCredentials:!0})}},_pushCorsEnabledServerInfo:function(a){if(a){var c=t.getEsriConfigRequestObject(),e=c.corsEnabledServers,d="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");if("object"===typeof a&&"string"===typeof a.host){for(var g in a.host)a[g]="function"===typeof a.host[g]?function(){return a.host[g].apply(a.host,
arguments)}:a.host[g];a.length=a.host.length;n.forEach(d,function(c){"function"===typeof a.host[c]&&(a[c]=function(){return a.host[c].apply(a.host,arguments)})});a.withCredentials&&c.webTierAuthServers&&0>c.webTierAuthServers.indexOf(a.host)&&c.webTierAuthServers.push(a.host)}e.push(a)}},tryRegisterCredential:function(a){return this.isValidCredential(a)?n.some(c.id.credentials,b.hitch(this,function(c){return a.token===c.token}))?!1:(c.id.credentials.push(a),!0):!1},registerToken:function(a){var e=
u.getSharingUrl(this.portalUrl);c.id.findCredential(e)&&n.some(c.id.credentials,b.hitch(this,function(a,e){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,a))return c.id.credentials.splice(e,1),!0}));return this._getTokenInfo(a).then(function(a){c.id.registerToken(a)})},_getTokenInfo:function(a){var c=u.getPortalSelfInfoUrl(this.portalUrl);return p.get(c+("?f\x3djson\x26token\x3d"+a),{jsonp:"callback"}).then(b.hitch(this,function(c){if(c.user)return{server:u.getSharingUrl(this.portalUrl),
ssl:c.allSSL,token:a,userId:c.user.username};throw Error(window.jimuNls.urlParams.invalidToken);}),function(a){console.error(a);throw Error(window.jimuNls.urlParams.validateTokenError);})},_isInvalidPortalUrl:function(a){return a&&"string"===typeof a&&b.trim(a)},signInPortal:function(a){var e=new k;if(this._isInvalidPortalUrl(a)){a=u.getStandardPortalUrl(a);var d=u.getSharingUrl(a),g=this.getPortalCredential(a);g?setTimeout(b.hitch(this,function(){e.resolve(g)}),0):e=c.id.getCredential(d)}else setTimeout(b.hitch(this,
function(){e.reject("Invalid portalurl.")}),0);return e},_loadPortalSelfInfo:function(c){c=u.getPortalSelfInfoUrl(c);var e=new k;a(c,{responseType:"json",query:{f:"json"},callbackParamName:"callback"}).then(b.hitch(this,function(a){e.resolve(a.data)}),b.hitch(this,function(a){e.reject(a)}));return e},registerOAuthInfo:function(a,d){if(!a||"string"!==typeof a||!d||"string"!==typeof d)return null;var g=c.id.findOAuthInfo(a);g||(g=window.location.protocol+"//"+window.location.host+q.toUrl("jimu")+"/oauth-callback.html",
g=new e({appId:d,expiration:20160,portalUrl:a,authNamespace:"/",popup:!0,popupCallbackUrl:g}),c.id.registerOAuthInfos([g]));g.appId=d;return g},signOutAll:function(){var a=u.getStandardPortalUrl(this.portalUrl),e=!!c.id.findCredential(a+"/sharing/rest");window.appInfo.isRunInPortal?this.removeEsriAuthCookieStorage():this.removeWabAuthCookie();c.id.destroyCredentials();c.id._oAuthHash=null;e&&this._publishCurrentPortalUserSignOut(a)},userHaveSignInPortal:function(a){return!!this.getPortalCredential(b.trim(a||
""))},isValidCredential:function(a){var c=!1;if(a){var c=a.token,e=a.server,d=a.scope,c=c&&"string"===typeof c&&b.trim(c),e=e&&"string"===typeof e&&b.trim(e),d="portal"===d||"server"===d,g=!0;a.expires&&(a=parseInt(a.expires,10),g=(new Date).getTime(),g=a>g);c=c&&e&&d&&g}return c},isValidPortalCredentialOfPortalUrl:function(a,c){var e=!1;this.isValidCredential(c)&&(e="portal"===c.scope,a=u.isSameServer(a,c.server),e=e&&a);return e},getPortalCredential:function(a){var e=null;a=b.trim(a||"");if(!a)return null;
a=u.getStandardPortalUrl(a);return e=this._filterPortalCredential(a,c.id.credentials)},saveAndRegisterCookieToCredential:function(a){a=b.clone(a);a.referer=window.location.host;a.scope="portal";a.isAdmin=!!a.isAdmin;this.saveWabCookie(a);var e=a.server+"/sharing/rest";a.server=e;c.id.registerToken(a);return c.id.findCredential(e,a.userId)},registerAuth2Hash:function(a){a=b.clone(a);var c=1E3*parseInt(a.expires_in,10),c=(new Date).getTime()+c,e=u.getStandardPortalUrl(a.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,
server:e,token:a.access_token,expires:c,userId:a.username,scope:"portal",isAdmin:!!a.isAdmin})},saveWabCookie:function(a){this.removeCookie("wab_auth");d("wab_auth",h.stringify(a),{expires:new Date(a.expires),path:"/"})},removeWabAuthCookie:function(){this.removeCookie("wab_auth")},removeEsriAuthCookieStorage:function(){this.removeCookie("esri_auth");window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(a,
c){var e=null;c&&0<c.length&&(c=n.filter(c,b.hitch(this,function(c){return this.isValidPortalCredentialOfPortalUrl(a,c)})),0<c.length&&(e=c[c.length-1]));return e},_removePortalCredential:function(a){var e=b.trim(a||"");if(e){e=u.getStandardPortalUrl(e);for(a=n.filter(c.id.credentials,b.hitch(this,function(a){return this.isValidPortalCredentialOfPortalUrl(e,a)}));0<a.length;)a[0].destroy(),a.splice(0,1);c.id.credentials=n.filter(c.id.credentials,b.hitch(this,function(a){return!this.isValidPortalCredentialOfPortalUrl(e,
a)}))}},getUserIdByToken:function(e,d){var g=new k;if(e&&"string"===typeof e&&d&&"string"===typeof d){var l=u.getStandardPortalUrl(d);d=n.filter(c.id.credentials,b.hitch(this,function(a){var c=a.token===e&&a.userId;a=u.isSameServer(l,a.server);return c&&a}));if(0<d.length){var r=d[0];setTimeout(b.hitch(this,function(){g.resolve(r.userId)}),0);return g}d=u.getCommunitySelfUrl(l);a(d,{responseType:"json",query:{f:"json"},callbackParamName:"callback"}).then(b.hitch(this,function(a){a=a&&a.data;g.resolve(a&&
a.username||"")}),b.hitch(this,function(a){console.error(a);g.reject("fail to get userId by token")}))}else setTimeout(b.hitch(this,function(){g.reject("invalid parameters")}),0);return g},xtGetCredentialFromCookie:function(a){var e=d("wab_auth"),g=null;if(e)try{g=h.parse(e)}catch(x){console.error(x)}if(!g||"object"!==typeof g||!u.isSameServer(a,g.server)||window.location.host!==g.referer)return null;g.expires=parseInt(g.expires,10);e=(new Date).getTime();if(!(g.expires>e))return this.removeCookie("wab_auth"),
null;a+="/sharing/rest";g.server=a;(e=c.id.findCredential(a))||c.id.registerToken(g);return e=c.id.findCredential(a)},removeCookie:function(a){var c=this.getCookiePath();t.removeCookie(a,c)},_getDomainsByServerName:function(a){var c=a.split("."),e=c.length;return n.map(c,b.hitch(this,function(a,d){a=c.slice(d,e);var g="",l=a.length-1;n.forEach(a,b.hitch(this,function(a,c){g+=a;c!==l&&(g+=".")}));return g}))},_publishCurrentPortalUserSignIn:function(a){if(this.isValidCredential(a))try{m.publish("userSignIn",
a)}catch(y){console.error(y)}},_publishAnyUserSignIn:function(a){if(this.isValidCredential(a))try{m.publish("anyUserSignIn",a)}catch(y){console.error(y)}},_publishCurrentPortalUserSignOut:function(a){try{m.publish("userSignOut",a)}catch(y){console.error(y)}},_signInSuccess:function(a){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,a)&&this._publishCurrentPortalUserSignIn(a),this._publishAnyUserSignIn(a)}catch(y){console.error(y)}},_bindEvents:function(){f.after(c.id,"signIn",b.hitch(this,
function(a,c){console.log(c[1]);f.after(a,"callback",b.hitch(this,function(a,c){this._signInSuccess(c[0],!1)}));return a}))},isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var a=window.parent;if(a){var e=a.esri&&a.esri.id;if(e){c.id=e;q.module.deps.some(b.hitch(this,function(a){return"esri/identity/IdentityManager"===a.mid?(a.result=e,!0):!1}));var d=t.getEsriConfigRequestObject(),a=a.esriConfig.defaults.io;d.corsEnabledServers=
a.corsEnabledServers;d.webTierAuthServers=a.webTierAuthServers;d._processedCorsServers=a._processedCorsServers;d.corsStatus=a.corsStatus}}}this._bindEvents();this._started=!0}}};g.startup();return g})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup".split(" "),function(q,b,n,f,k,d){return q(d,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,
postMixInProperties:function(){this.content=this.message},_createTitleNode:function(){this.titleLabel&&(this.titleNode=n.create("div",{"class":"title"},this.domNode),this.titleLabeNode=n.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode),this.closeBtnNode=n.create("div",{"class":"close-btn jimu-float-trailing"},this.titleNode),this.own(k(this.closeBtnNode,"click",b.hitch(this,this.close))))},_preProcessing:function(){0===this.buttons.length&&
this.buttons.push({label:window.jimuNls.common.ok,key:f.ENTER,onClick:b.hitch(this,this.close)})},_increaseZIndex:function(){n.setStyle(this.domNode,"zIndex",501);n.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase jimu/utils".split(" "),function(q,b,n,f,k,d,h,m,p,c,a,l){var g=0;return q(a,{declaredClass:"jimu.dijit.Popup",
baseClass:"jimu-popup",titleLabel:"",content:null,container:null,buttons:[],enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,maxHeight:800,maxWidth:1024,constructor:function(){this.buttons=[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},postCreate:function(){this._preProcessing();this.inherited(arguments);this._initDomNode();this._positioning();f.place(this.domNode,this.container);setTimeout(b.hitch(this,
function(){this._moveToMiddle()}),50);this.own(d(window,"resize",b.hitch(this,function(){this._fixedHeight||this.autoHeight?(this._calculatePosition(),this._moveToMiddle()):this._positioning()})));this.overlayNode=f.create("div",{"class":"jimu-overlay"},this.container);this._increaseZIndex();k.animateProperty({node:this.domNode,properties:{opacity:1},duration:200}).play();this.domNode.focus()},_preProcessing:function(){"number"===typeof this.height&&(this._fixedHeight=!0,this.autoHeight=!1);this.autoHeight&&
(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=f.create("div",{"class":"title"},this.domNode);this.titleLabeNode=f.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode);this.closeBtnNode=f.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing"},this.titleNode);var a=null,a="ontouchstart"in document?m.press:"click";this.own(d(this.closeBtnNode,a,b.hitch(this,this.close)))},_initDomNode:function(){this._createTitleNode();
this.contentContainerNode=f.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?this.contentContainerNode.innerHTML=this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&f.place(this.content,this.contentContainerNode));this.buttonContainer=f.create("div",{"class":"button-container"},this.domNode);0===this.buttons.length&&f.setStyle(this.buttonContainer,"display","none");for(var a=
this.buttons.length-1;-1<a;a--)this._createButton(this.buttons[a]),this.buttons[a].disable&&this.disableButton(a)},_limitButtonsMaxWidth:function(){var a=this.enabledButtons.length;if(0!==a){var c=f.getContentBox(this.buttonContainer),d=f.getMarginExtents(this.enabledButtons[0]),g=f.getPadBorderExtents(this.enabledButtons[0]),l=0,g=8===h("ie")?g.l+g.r:0,l=(c.w-(d.l+d.r+g)*a)/a;0<l&&(n.forEach(this.enabledButtons,b.hitch(this,function(a){f.setStyle(a,"maxWidth",l+"px")})),n.forEach(this.disabledButtons,
b.hitch(this,function(a){f.setStyle(a,"maxWidth",l+"px")})))}},_moveableNode:function(a,g){this.moveable&&(this.moveable.destroy(),this.moveable=null);var e=f.getMarginBox(this.container);e.l=e.l-a+g;e.w+=2*(a-g);this.moveable=new c.boxConstrainedMoveable(this.domNode,{box:e,handle:this.titleNode||this.contentContainerNode,within:!0});this.own(d(this.moveable,"Moving",b.hitch(this,this.onMoving)));this.own(d(this.moveable,"MoveStop",b.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===
p("#header").length?{t:0,l:0,w:0,h:0}:f.getMarginBox("header")},_getFooterBox:function(){return 0===p(".footer",this.container).length?{t:0,l:0,w:0,h:0}:f.getMarginBox(p(".footer",this.container)[0])},_calculatePosition:function(){var a=f.getContentBox(this.container),c=this._getHeaderBox(),d=this._getFooterBox(),d=a.h-c.h-d.h-40,g=0;g=this._fixedHeight?this.height:this.autoHeight?d-200:this.height=d>this.maxHeight?this.maxHeight:d;d=(d-g)/2+c.h+20;d=d<c.h?c.h:d;this.width=this.width||this.maxWidth;
f.setStyle(this.domNode,{left:(a.w-this.width)/2+"px",top:d+"px",width:this.width+"px"})},_calculateHeight:function(){this.autoHeight?(f.setStyle(this.domNode,"height","auto"),f.addClass(this.contentContainerNode,"content-static"),0===this.buttons.length&&f.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(f.setStyle(this.domNode,"height",this.height+"px"),f.addClass(this.contentContainerNode,"content-absolute"),f.addClass(this.buttonContainer,"button-container-absolute"),0===this.buttons.length&&
f.setStyle(this.contentContainerNode,{bottom:"15px"}));this._moveableNode(this.width,100)},_moveToMiddle:function(){if(this.autoHeight){var a=f.getMarginBox(this.domNode),c=f.getContentBox(this.container),d=this._getHeaderBox(),g=this._getFooterBox(),g=c.h-d.h-g.h-40,l=0,l=a.h||g-200,a=(g-l)/2+d.h+20,a=a<d.h?d.h:a;f.setStyle(this.domNode,{left:(c.w-this.width)/2+"px",top:a+"px",width:this.width+"px"})}},_positioning:function(){this._calculatePosition();this._calculateHeight()},_increaseZIndex:function(){f.setStyle(this.domNode,
"zIndex",g+200+1);f.setStyle(this.overlayNode,"zIndex",g+200);g++},setTitleLabel:function(a){this.titleNode.innerHTML=l.stripHTML(a)},onMoving:function(a){f.setStyle(a.node,"opacity",.9)},onMoveStop:function(a){f.setStyle(a.node,"opacity",1)},close:function(){if(!this.onClose||!1!==this.onClose()){var a=this.domNode.parentNode,c=b.clone(this.domNode);f.setStyle(this.domNode,"display","none");f.destroy(this.overlayNode);this.destroy();this.moveable.destroy();f.place(c,a);k.animateProperty({node:c,
properties:{opacity:0},duration:200,onEnd:function(){f.destroy(c)}}).play()}},addButton:function(a){this._createButton(a)},_createButton:function(a){var c=" ";a.classNames&&0<a.classNames.length&&"function"===typeof a.classNames.join&&(c+=a.classNames.join(" "));var e=f.create("div",{"class":"jimu-btn jimu-float-trailing jimu-trailing-margin1 "+c,innerHTML:a.label,title:a.title},this.buttonContainer);this.enabledButtons.unshift(e);c=f.create("div",{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+
c,title:a.title,innerHTML:a.label,style:{display:"none"}},this.buttonContainer);this.disabledButtons.unshift(c);this.own(d(e,"click",b.hitch(this,function(c){if(a.onClick)a.onClick(c);else this.close()})))},setButtonProps:function(a,c){"number"===typeof a&&isFinite(a)||(c=a,a=0);if(c&&0!==this.enabledButtons.length)for(var e in c)"title"===e?(f.setAttr(this.enabledButtons[a],"title",c[e]),f.setAttr(this.disabledButtons[a],"title",c[e])):"label"===e&&(f.setProp(this.enabledButtons[a],"innerHTML",c[e]),
f.setProp(this.disabledButtons[a],"innerHTML",c[e]))},enableButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.enabledButtons.length?(f.setStyle(this.enabledButtons[a],"display","inline-block"),f.setStyle(this.disabledButtons[a],"display","none")):(n.forEach(this.enabledButtons[a],b.hitch(this,function(a){f.setStyle(a,"display","inline-block")})),n.forEach(this.disabledButtons[a],b.hitch(this,function(a){f.setStyle(a,"display","none")})))},disableButton:function(a){"number"===typeof a&&isFinite(a)&&
a<this.disabledButtons.length?(f.setStyle(this.disabledButtons[a],"display","inline-block"),f.setStyle(this.enabledButtons[a],"display","none")):(n.forEach(this.disabledButtons,b.hitch(this,function(a){f.setStyle(a,"display","inline-block")})),n.forEach(this.enabledButtons,b.hitch(this,function(a){f.setStyle(a,"display","none")})))},showButton:function(a){this.enableButton(a)},hideButton:function(a){"number"===typeof a&&isFinite(a)&&a<this.disabledButtons.length?(f.setStyle(this.disabledButtons[a],
"display","none"),f.setStyle(this.enabledButtons[a],"display","none")):(n.forEach(this.disabledButtons,b.hitch(this,function(a){f.setStyle(a,"display","none")})),n.forEach(this.enabledButtons,b.hitch(this,function(a){f.setStyle(a,"display","none")})))}})})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),function(q,b,n,f,k,d){f=q("dojo.dnd.move.constrainedMoveable",d,{constraints:function(){},within:!1,constructor:function(d,
m){m||(m={});this.constraints=m.constraints;this.within=m.within},onFirstMove:function(d){var h=this.constraintBox=this.constraints.call(this,d);h.r=h.l+h.w;h.b=h.t+h.h;this.within&&(d=b.getMarginSize(d.node),h.r-=d.w,h.b-=d.h)},onMove:function(d,m){var h=this.constraintBox,c=d.node.style;this.onMoving(d,m);m.l=m.l<h.l?h.l:h.r<m.l?h.r:m.l;m.t=m.t<h.t?h.t:h.b<m.t?h.b:m.t;c.left=m.l+"px";c.top=m.t+"px";this.onMoved(d,m)}});k=q("dojo.dnd.move.boxConstrainedMoveable",f,{box:{},constructor:function(d,
m){var h=m&&m.box;this.constraints=function(){return h}}});q=q("dojo.dnd.move.parentConstrainedMoveable",f,{area:"content",constructor:function(d,m){var h=m&&m.area;this.constraints=function(){var c=this.node.parentNode,a=n.getComputedStyle(c),d=b.getMarginBox(c,a);if("margin"==h)return d;var g=b.getMarginExtents(c,a);d.l+=g.l;d.t+=g.t;d.w-=g.w;d.h-=g.h;if("border"==h)return d;g=b.getBorderExtents(c,a);d.l+=g.l;d.t+=g.t;d.w-=g.w;d.h-=g.h;if("padding"==h)return d;g=b.getPadExtents(c,a);d.l+=g.l;d.t+=
g.t;d.w-=g.w;d.h-=g.h;return d}}});return{constrainedMoveable:f,boxConstrainedMoveable:k,parentConstrainedMoveable:q}})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager"],function(q){function b(){this.versions=[{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",upgrader:function(b){return b},compatible:!0},{version:"2.0",description:"The version for Online 4.1.",upgrader:function(b){return b},compatible:!0},{version:"2.0.1",description:"The version for Developer Edition 2.0.",
upgrader:function(b){var f=null,k=0,d=b.widgetOnScreen.widgets;if(d&&0<d.length)for(k=0;k<d.length;k++)f=d[k],"widgets/Viz/Widget"===f.uri&&(f.uri="widgets/3DFx/Widget",f.name="3DFx");if((d=b.widgetPool.widgets)&&0<d.length)for(k=0;k<d.length;k++)f=d[k],"widgets/Viz/Widget"===f.uri&&(f.uri="widgets/3DFx/Widget",f.name="3DFx");return b},compatible:!0},{version:"2.1",description:"The version for Online 4.2.",upgrader:function(b){return b},compatible:!0},{version:"2.2",description:"The version for Online 4.3.",
upgrader:function(b){return b},compatible:!0},{version:"2.3",description:"The version for Online 4.4.",upgrader:function(b){return b},compatible:!0},{version:"2.4",description:"The version for Online 5.1.",upgrader:function(b){return b},compatible:!0},{version:"2.5",description:"The version for Online 5.2.",upgrader:function(b){return b},compatible:!0},{version:"2.6",description:"The version for Online 5.3.",upgrader:function(b){return b},compatible:!0},{version:"2.7",description:"The version for Online 5.4.",
upgrader:function(b){(function(){function f(f){var d=0,h=0;if(b[f].widgets)for(d=0;d<b[f].widgets.length;d++)if("widgets/Environment/Widget"===b[f].widgets[d].uri){b[f].widgets[d].uri="widgets/Daylight/Widget";break}if(b[f].groups)for(d=0;d<b[f].groups.length;d++)for(var m=b[f].groups[d],h=0;h<m.widgets.length;h++)if("widgets/Environment/Widget"===m.widgets[h].uri){m.widgets[h].uri="widgets/Daylight/Widget";break}}f("widgetOnScreen");f("widgetPool")})();return b},compatible:!0},{version:"2.8",description:"The version for Online 6.1.",
upgrader:function(b){return b},compatible:!0},{version:"2.9",description:"The version for Online 6.2.",upgrader:function(b){return b},compatible:!0},{version:"2.10",description:"The version for Online 6.3.",upgrader:function(b){return b},compatible:!0},{version:"2.11",description:"The version for Online 6.4.",upgrader:function(b){return b},compatible:!0},{version:"2.12",description:"The version for Online 7.1",upgrader:function(b){return b},compatible:!0}];this.isCompatible=function(b,f){b=this.getVersionIndex(b);
f=this.getVersionIndex(f);for(b+=1;b<=f;b++)if(!1===this.versions[b].compatible)return!1;return!0}}b.prototype=new q;return b.prototype.constructor=b})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=[];this.upgrade=function(q,b,n){b=this.getVersionIndex(b);n=this.getVersionIndex(n);if(b>=n)throw Error("New version should higher than old version.");for(b+=1;b<=n;b++)this.versions[b].upgrader&&(q=this.versions[b].upgrader(q));return q};this.getVersionIndex=
function(q){q=this.fixVersion(q);var b,n;for(n=0;n<this.versions.length;n++)this.versions[n].version===q&&(b=n);null===q&&(b=-1);void 0===b&&(b=this.versions.length-1);return b};this.fixVersion=function(q){return q?q:null}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./appConfigResourceUtils ./portalUrlUtils ./AppStateManager esri/identity/IdentityManager esri/core/urlUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w){var x=null,v;v=q(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(c,e){this._removeHash(c);this.urlParams=c||{};this.widgetManager=a.getInstance();b.mixin(this,e)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(b.hitch(this,function(a){var d=this.checkConfig(a);if(d)throw d;this.rawAppConfig=b.clone(a);r.getInstance().setRawAppConfig(this.rawAppConfig);
a=this._upgradeAppConfig(a);this._processAfterTryLoad(a);this.appConfig=a;if(this.urlParams.id)return this.loadWidgetsManifest(a).then(b.hitch(this,function(){return this._upgradeAllWidgetsConfig(a)})).then(b.hitch(this,function(a){return this.insertAppIdtoResourceUrlofAppConfig(a,this.urlParams.id)})).then(b.hitch(this,function(){this._configLoaded=!0;a.title&&(document.title=window.isBuilder?c.stripHTML(a.title)+" - Web AppBuilder for ArcGIS":c.stripHTML(a.title));this._readAndSetSharedTheme(a);
return this.getAppConfig()}));g.setPortalUrl(a.portalUrl);return this._proesssWebTierAndSignin(a).then(b.hitch(this,function(){if(this.urlParams.appid){if(window.appInfo.isRunInPortal){var d=t.getStandardPortalUrl(a.portalUrl),d=e.getPortal(d);return c.checkEssentialAppsLicense(this.urlParams.appid,d,g.isInBuilderWindow()).then(b.hitch(this,function(){return this._getAppConfigFromTemplateAppId(a.portalUrl,this.urlParams.appid).then(b.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);
return this._processInPortalAppProtocol(a)}))}),b.hitch(this,function(a){console.error(a);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);}))}return this._processNotInPortalAppProtocol(a).then(b.hitch(this,function(a){return this._getAppDataAddTemplateDataFromTemplateAppId(a.portalUrl,this.urlParams.appid).then(b.hitch(this,function(c){c.appData.appConfig&&(a=c.appData.appConfig);a._appData=c.appData;a.templateConfig=c.templateData;a.isTemplateApp=!0;return a}))}))}return this._processNotInPortalAppProtocol(a)})).then(b.hitch(this,
function(a){this._processAfterTryLoad(a);this.appConfig=a;return a.map.itemId?a:e.getDefaultWebScene(a.portalUrl).then(function(c){a.map.itemId=c;return a})})).then(b.hitch(this,function(a){return this.loadWidgetsManifest(a)})).then(b.hitch(this,function(a){return a._appData?a._appData.values&&a._appData.values.webmap?e.getPortal(a.portalUrl).getItemById(a._appData.values.webmap).then(b.hitch(this,function(e){return c.template.mergeTemplateAppConfigToAppConfig(a,a._appData,e)})):c.template.mergeTemplateAppConfigToAppConfig(a,
a._appData):a})).then(b.hitch(this,function(){return this._upgradeAllWidgetsConfig(a)})).then(b.hitch(this,function(a){return a._wabAppId?this.processResourceInAppConfigForConfigLoader(a,this.urlParams):a.appItemId&&-1<window.JSON.stringify(a).indexOf("${itemId}")?this.insertAppIdtoResourceUrlofAppConfig(a,a.appItemId):a})).then(b.hitch(this,function(){this.appConfig=a;this._configLoaded=!0;a.title&&(document.title=c.stripHTML(a.title));this._readAndSetSharedTheme(a);return this.getAppConfig()}))}),
b.hitch(this,function(a){this.showError(a)}))},processResourceInAppConfigForConfigLoader:function(a,c){var d=a.portalUrl,g=a.appItemId,l=c.appid,r=new h,f=b.clone(a);this.insertAppIdtoResourceUrlofAppConfig(f,l).then(function(){if("config"===c.mode){var h=this.getResourceUrlsOfAppConfig(a).result;0!==h.length?e.getItemResources(d,l).then(function(a){if(0===a.length)return h=h.map(function(a){return{resUrl:a}}),u.AddResourcesToItemForAppSave(d,h,g,l).then(function(){r.resolve(f)},function(a){console.warn("Add resource to template based app error:"+
a.message||a);r.resolve(f)});r.resolve(f)},function(a){console.warn("Get resource of template based item error:"+a.message||a);r.resolve(f)}):r.resolve(f)}else r.resolve(f)}.bind(this),function(a){console.warn("Insert appId to resource url of appConfig error:"+a.message||a);r.resolve(f)});return r},getResourceUrlsOfAppConfig:function(a){var e={test:function(a){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items/.test(a)},func:b.hitch(this,function(a){return a.value})};return c.processItemResourceOfAppConfig(a,
e)},insertAppIdtoResourceUrlofAppConfig:function(a,d){function g(a){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items/.test(a)}function l(a,c){var e=c.obj,d=c.key,g={obj:e,key:d};"number"===typeof c.i?(g.i=c.i,g.value=e[d][c.i]):g.value=e[d];c=g;a=h.processItemIdAndTokenOfResources(c.value,a);e=c.obj;d=c.key;"number"===typeof c.i?e[d][c.i]=a:e[d]=a;return!0}var r=a.portalUrl,h=this;return e.getPortal(r).getItemById(d).then(b.hitch(this,function(e){e={test:g,func:b.hitch(this,l,{appId:d,isPublic:"public"===
e.access,portalUrl:r})};return c.processItemResourceOfAppConfig(a,e).appConfig}))},processItemIdAndTokenOfResources:function(a,c){0<a.indexOf("${itemId}")&&(a=a.replace("${itemId}",c.appId));/(\?|\&)token=.+/.test(a)&&(a=a.replace(/(\?|\&)token=.+/,""));c.isPublic||(c=g.getPortalCredential(c.portalUrl))&&(a+="?token\x3d"+c.token);return a},getAppConfig:function(){var a=b.clone(this.appConfig);a.getConfigElementById=function(a){return c.getConfigElementById(this,a)};a.getConfigElementsByName=function(a){return c.getConfigElementsByName(this,
a)};a.visitElement=function(a){c.visitElement(this,a)};this._addAuthorizedCrossOriginDomains(this.portalSelf,a);return a},_addAuthorizedCrossOriginDomains:function(a,c){a&&a.authorizedCrossOriginDomains&&g.addAuthorizedCrossOriginDomains(a.authorizedCrossOriginDomains);c&&c.authorizedCrossOriginDomains&&g.addAuthorizedCrossOriginDomains(c.authorizedCrossOriginDomains)},checkConfig:function(a){return(a=this._getRepeatedId(a))?"repeated id:"+a:null},processProxy:function(a){var e=c.getEsriConfigRequestObject();
e.alwaysUseProxy=a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.alwaysUseProxy;e.proxyUrl="";e.proxyRules=[];a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.url&&(e.proxyUrl=a.httpProxy.url);a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.rules&&n.forEach(a.httpProxy.rules,function(a){w.addProxyRule(a)})},addNeedValues:function(a){this._processNoUriWidgets(a);this._processEmptyGroups(a);this._addElementId(a);this._processWidgetJsons(a)},showError:function(a){f.create("div",{"class":"app-error",innerHTML:c.sanitizeHTML(a.message)},
document.body)},_tryLoadConfig:function(){if(this.urlParams.config)return this.configFile=this.urlParams.config,p(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(b.hitch(this,function(a){g.setPortalUrl(a.portalUrl);return this.urlParams.token?g.registerToken(this.urlParams.token).then(function(){return a}):a}));if(this.urlParams.id){window.appInfo.isRunInPortal=!0;var a=t.getPortalUrlFromLocation(),d=new h;g.setPortalUrl(a);var l;this.urlParams.token?l=g.registerToken(this.urlParams.token):
(l=new h,l.resolve());l.then(b.hitch(this,function(){var l=e.getPortal(a);l.loadSelfInfo().then(b.hitch(this,function(e){this.portalSelf=e;e.allSSL&&"http:"===window.location.protocol?(window.location.href=t.setHttpsProtocol(window.location.href),d.reject()):this._processSignIn(a).then(b.hitch(this,function(){this._getAppConfigFromAppId(a,this.urlParams.id).then(b.hitch(this,function(a){return c.checkEssentialAppsLicense(this.urlParams.id,l,g.isInBuilderWindow()).then(b.hitch(this,function(){this._tryUpdateAppConfigByLocationUrl(a);
return this._processInPortalAppProtocol(a)}),b.hitch(this,function(a){console.error(a);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);}))})).then(function(a){d.resolve(a)},function(a){d.reject(a)})}))}))}),b.hitch(this,function(a){this.showError(a)}));return d}this.configFile="config.json";return p(this.configFile,{handleAs:"json"}).then(b.hitch(this,function(a){g.setPortalUrl(a.portalUrl);return this.urlParams.token?g.registerToken(this.urlParams.token).then(function(){return a}):a}))},
_upgradeAppConfig:function(a){var c=window.wabVersion,e=a.wabVersion;if(c===e)return a;var d=this.versionManager.getVersionIndex(e),g=this.versionManager.getVersionIndex(c);if(d>g)throw Error("Bad version number, "+e);a=this.versionManager.upgrade(a,e,c);a.wabVersion=c;a.isUpgraded=!0;return a},_upgradeAllWidgetsConfig:function(a){var c=new h,e=[];if(!a.isUpgraded)return c.resolve(a),c;delete a.isUpgraded;l.visitElement(a,b.hitch(this,function(a){a.uri&&(a.config?(a=this.widgetManager.tryLoadWidgetConfig(a),
e.push(a)):a.version=a.manifest.version)}));m(e).then(b.hitch(this,function(){c.resolve(a)}),function(a){c.reject(a)});return c},_processAfterTryLoad:function(a){this._setPortalUrl(a);this._tryUpdateAppConfigByLocationUrl(a);this._processUrlParams(a);this.addNeedValues(a);this.processProxy(a);y.tokenValidity=10080;return a},_readAndSetSharedTheme:function(a){a.theme.sharedTheme||(a.theme.sharedTheme={useHeader:!1,useLogo:!1},a.theme.sharedTheme.isPortalSupport=this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?
!0:!1);a.theme.sharedTheme.useHeader&&(a.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(a.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},a.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text):console.error("Portal does not support sharedTheme."));a.theme.sharedTheme.useLogo&&(a.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(a.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?
this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",!a.logoLink&&this.portalSelf.portalProperties.sharedTheme.logo.link&&(a.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link)):(console.error("Portal does not support sharedTheme, use default logo."),a.logo="images/app-logo.png"))},_tryUpdateAppConfigByLocationUrl:function(a){if(!(this.urlParams.config&&-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var c=t.getPortalUrlFromLocation(),
c=t.getStandardPortalUrl(c);t.isOnline(c)&&(c=t.updateUrlProtocolByOtherUrl(c,a.portalUrl),a.map.portalUrl&&t.isSamePortalUrl(a.portalUrl,a.map.portalUrl)&&(a.map.portalUrl=c),a.portalUrl=c,a.httpProxy&&a.httpProxy.url&&(a.httpProxy.url=t.getPortalProxyUrl(c)))}},_processWidgetJsons:function(a){l.visitElement(a,function(a,e){e.isWidget&&a.uri&&c.processWidgetSetting(a)})},_processNoUriWidgets:function(a){var c=0;l.visitElement(a,function(a,e){e.isWidget&&!a.uri&&(c++,a.placeholderIndex=c)})},_processEmptyGroups:function(a){var c=
0;a.widgetOnScreen.groups&&n.forEach(a.widgetOnScreen.groups,function(a){if(!a.widgets||a.widgets&&0===a.widgets.length)c++,a.placeholderIndex=c})},_addElementId:function(a){var c=0,e;l.visitElement(a,function(a){if(a.id){a.id=a.id.replace(/\//g,"_");var d=a.id.lastIndexOf("_");-1<d&&(e=a.id.substr(d+1),c=Math.max(c,e))}});l.visitElement(a,function(a){a.id||(c++,a.id=a.uri?a.uri.replace(/\//g,"_")+"_"+c:"_"+c)})},_setPortalUrl:function(a){if(a.portalUrl){var c=t.getPortalUrlFromLocation(),e=t.isOnline(c);
t.isSamePortalUrl(a.portalUrl,c)||e||(window.appInfo.isRunInPortal=!1)}else window.isXT&&d("wab_portalurl")?a.portalUrl=d("wab_portalurl"):(window.appInfo.isRunInPortal=!0,a.portalUrl=t.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(a,c){a.portalUrl=t.setProtocol(a.portalUrl,c);a.map.portalUrl&&(a.map.portalUrl=t.setProtocol(a.map.portalUrl,c));a.httpProxy&&(a.httpProxy.url=t.setProtocol(a.httpProxy.url,c),a.httpProxy&&a.httpProxy.rules&&n.forEach(a.httpProxy.rules,b.hitch(this,function(a){a.proxyUrl=
t.setProtocol(a.proxyUrl,c)})))},_processInPortalAppProtocol:function(a){var c=new h,d=e.getPortal(a.portalUrl),g=b.hitch(this,function(e){if("https:"===window.location.protocol)this._changePortalUrlProtocol(a,"https");else{if(e){window.location.href=t.setHttpsProtocol(window.location.href);c.reject();return}this._changePortalUrlProtocol(a,"http")}this._checkLocale();c.resolve(a)});d.loadSelfInfo().then(b.hitch(this,function(c){this.portalSelf=c;"private"===c.access?(c=0===a.portalUrl.toLowerCase().indexOf("https://"),
g(c)):g(c.allSSL)}),b.hitch(this,function(a){c.reject(a)}));return c},_processNotInPortalAppProtocol:function(a){var c=new h;a.portalUrl?e.getPortal(a.portalUrl).loadSelfInfo().then(b.hitch(this,function(e){this.portalSelf=e;var d="https:"===window.location.protocol;(e.allSSL||d)&&this._changePortalUrlProtocol(a,"https");0!==a.portalUrl.toLowerCase().indexOf("https://")||d||g.isInConfigOrPreviewWindow()?c.resolve(a):(window.location.href=t.setHttpsProtocol(window.location.href),c.reject())}),b.hitch(this,
function(a){c.reject(a)})):c.resolve(a);return c},_proesssWebTierAndSignin:function(a){var c=new h,d=!1,g=a.portalUrl;this._processWebTier(a).then(b.hitch(this,function(a){d=a;return e.getPortal(g).loadSelfInfo()})).then(b.hitch(this,function(a){this.portalSelf=a;return this._processSignIn(g,d)})).then(b.hitch(this,function(){c.resolve()}),function(a){c.reject(a)});return c},_processWebTier:function(a){var c=new h,e=a.portalUrl;a.isWebTier?(g.addAuthorizedCrossOriginDomains([e]),g.isWebTierPortal(e).then(b.hitch(this,
function(){var d=g.getPortalCredential(e);d&&d.ssl&&"http:"===window.location.protocol&&!g.isInConfigOrPreviewWindow()?window.location.href=t.setHttpsProtocol(window.location.href):c.resolve(a.isWebTier)}),b.hitch(this,function(a){c.reject(a)}))):c.resolve(!1);return c},_processSignIn:function(a,c){var d=new h,l=e.getPortal(a),r=t.getSharingUrl(a);if(window.appInfo.isRunInPortal){if(window!==window.top){var f;try{f=window.top.isBuilder?!0:!1}catch(H){f=!1}f||(y.useSignInPage=!1,g.registerOAuthInfo(a,
"arcgisWebApps"))}c=y.checkSignInStatus(r);c.always(b.hitch(this,function(){d.resolve()}))}else g.isInBuilderWindow()||g.isInConfigOrPreviewWindow()||!this.portalSelf.supportsOAuth||!this.rawAppConfig.appId||c||g.registerOAuthInfo(a,this.rawAppConfig.appId),c=y.checkSignInStatus(r),c.always(b.hitch(this,function(){g.xtGetCredentialFromCookie(a);l.loadSelfInfo().then(b.hitch(this,function(a){this.portalSelf=a;this._checkLocale();d.resolve()}))}));return d},_checkLocale:function(){if(!g.isInConfigOrPreviewWindow()){var a=
this.portalSelf.user&&this.portalSelf.user.culture||k.locale,a=a.toLowerCase();!this.urlParams.locale&&c.isLocaleChanged(k.locale,a)&&(d("wab_app_locale",a),window.location.reload())}},_getAppConfigFromTemplateAppId:function(a,c){var d=e.getPortal(a);return this._getWabAppIdAndDataFromTemplateAppId(a,c).then(b.hitch(this,function(c){var e=c.appId,g=c.appData;return m([this._getAppConfigFromAppId(a,e),d.getItemData(g.source)]).then(b.hitch(this,function(a){var c;g.appConfig?(c=g.appConfig,delete g.appConfig):
c=a[0];c=this._upgradeAppConfig(c);a=a[1];c._appData=g;c._wabAppId=e;c.templateConfig=a;c.isTemplateApp=!0;return c}))}))},_getAppDataAddTemplateDataFromTemplateAppId:function(a,c){var d=e.getPortal(a);return d.getItemData(c).then(function(a){return d.getItemData(a.source).then(function(c){return{appData:a,templateData:c}})})},_getWabAppIdAndDataFromTemplateAppId:function(a,c){var d=new h,g=e.getPortal(a);g.getItemData(c).then(b.hitch(this,function(a){g.getItemById(a.source).then(b.hitch(this,function(c){c=
w.urlToObject(c.url);d.resolve({appId:c.query.id,appData:a})}))}),function(a){d.reject(a)});return d},_getAppConfigFromAppId:function(a,c){return e.getPortal(a).getItemData(c)},_removeHash:function(a){for(var c in a)a[c]&&(a[c]=a[c].replace("#",""))},loadWidgetsManifest:function(a){function d(d,l,h){function f(c){return d.loadWidgetManifest(c).then(function(a){return a},function(e){console.log("Widget failed to load, it is removed.",c.name);e.stack?console.error(e.stack):console.log(e);r(a,c)})}return l.itemId?
e.getPortal(h).getItemById(l.itemId).then(function(e){var d;d=c.isEsriDomain(e.url)?!0:g.getPortalCredential(a.portalUrl)?!0:!1;if(d)return l.uri=c.widgetJson.getUriFromItem(e),f(l);console.log("Widget is not useable, it is removed.",l.name);r(a,l)}):f(l)}function r(a,c){function e(e){a[e]&&a[e].widgets&&(a[e].widgets=a[e].widgets.filter(function(a){if(c)return a.id!==c.id;a.uri&&!a.manifest&&console.error("Widget is removed because it is not loaded successfully.",a.uri);return a.manifest}));a[e]&&
a[e].groups&&a[e].groups.forEach(function(a){a.widgets&&(a.widgets=a.widgets.filter(function(a){if(c)return a.id!==c.id;a.uri&&!a.manifest&&console.error("Widget is removed because it is not loaded successfully.",a.uri);return a.manifest}))})}e("widgetOnScreen");e("widgetPool")}var f=[],u=new h;a._buildInfo&&a._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(b.hitch(this,function(e){l.visitElement(a,b.hitch(this,function(g){g.widgets||!g.uri&&!g.itemId||(g.uri&&e[g.uri]?(this._addNeedValuesForManifest(e[g.uri],
g.uri),c.widgetJson.addManifest2WidgetJson(g,e[g.uri])):f.push(d(this.widgetManager,g,a.portalUrl)))}));m(f).then(function(){u.resolve(a)})})):(l.visitElement(a,b.hitch(this,function(c){c.widgets||!c.uri&&!c.itemId||f.push(d(this.widgetManager,c,a.portalUrl))})),m(f).then(function(){u.resolve(a)}));setTimeout(function(){u.isResolved()||(r(a),u.resolve(a))},6E4);return u},_addNeedValuesForManifest:function(a,e){b.mixin(a,c.getUriInfo(e));c.addManifestProperies(a);c.processManifestLabel(a,k.locale)},
_loadMergedWidgetManifests:function(){return p(window.appInfo.appPath+"widgets/widgets-manifest.json",{handleAs:"json"})},_getRepeatedId:function(a){var c=[],e;l.visitElement(a,function(a){if(0<c.indexOf(a.id))return e=a.id,!0;c.push(a.id)});return e},_processUrlParams:function(a){var e=this.urlParams.itemid||this.urlParams.webmap;e&&a.map.itemId!==e&&(a.map.mapOptions&&c.deleteMapOptions(a.map.mapOptions),a.map.itemId=e);this.urlParams.mode&&(a.mode=this.urlParams.mode);a.map.mapOptions||(a.map.mapOptions=
{});this.urlParams.scale&&(a.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||this.urlParams.zoom)a.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});v.getInstance=function(a,c){null===x?x=new v(a,c):(x.urlParams=a,x.options=c);return x};return v})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json esri/request ./utils ./portalUrlUtils ./tokenUtils".split(" "),function(q,
b,n,f,k,d,h,m,p,c,a){var l=q([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(a){this.portalUrl=c.getStandardPortalUrl(a);this.selfUrl=c.getPortalSelfInfoUrl(a)},loadSelfInfo:function(){var a=new k,c={query:{f:"json"},responseType:"json",callbackParamName:"callback",cacheBust:!0};this.isValidCredential()&&(c.query.token=this.credential.token);m(this.selfUrl,c).then(b.hitch(this,function(c){c=c.data;var e=c.user;delete c.user;
b.mixin(this,c);c.user=e;a.resolve(c)}),b.hitch(this,function(c){console.error(c);a.reject(c)}));return a},_checkCredential:function(){var c=a.isValidCredential(this.credential);c||this.clearCredentialAndUser();return c},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=a.getPortalCredential(this.portalUrl))},signIn:function(){var c=new k;this.updateCredential();this.isValidCredential()?setTimeout(b.hitch(this,
function(){c.resolve(this.credential)}),0):c=a.signInPortal(this.portalUrl);return c},haveSignIn:function(){return a.userHaveSignInPortal(this.portalUrl)},clearCredentialAndUser:function(){this.user=this.credential=null},getUser:function(){this.updateCredential();var c=new k;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(b.hitch(this,function(){this.user.updateCredential();c.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(b.hitch(this,
function(a){this.user=a;c.resolve(this.user)}),b.hitch(this,function(a){console.error(a);c.reject(a)})):a.getUserIdByToken(this.credential.token,this.portalUrl).then(b.hitch(this,function(a){this.credential.userId=a;this._getUser(this.credential.userId).then(b.hitch(this,function(a){this.user=a;c.resolve(this.user)}),b.hitch(this,function(a){console.error(a);c.reject(a)}))}),b.hitch(this,function(a){console.error(a);c.reject(a)})):setTimeout(b.hitch(this,function(){c.reject("credential is null.")}),
0);return c},queryItems:function(a){this.updateCredential();var e=new k,d=c.getBaseSearchUrl(this.portalUrl),g={f:"json"};a&&(g=b.mixin(g,a));this.isValidCredential()&&(g.token=this.credential.token);g.sortField||g.sortOrder||(g.sortField="title",g.sortOrder="asc");m(d,{responseType:"json",query:g,callbackParamName:"callback"}).then(b.hitch(this,function(a){a=a.data;a.results=n.map(a.results,b.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new u(a)}));
e.resolve(a)}),b.hitch(this,function(a){console.error(a);e.reject(a)}));return e},getItemData:function(a){this.updateCredential();a=c.getItemDataUrl(this.portalUrl,a);var e={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(e.query.token=this.credential.token);var d=new k;m(a,e).then(b.hitch(this,function(a){d.resolve(a.data)}),b.hitch(this,function(a){d.reject(a)}));return d},getItemById:function(a){var e=new k;this.updateCredential();a=c.getItemUrl(this.portalUrl,
a);var d={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(d.query.token=this.credential.token);m(a,d).then(b.hitch(this,function(a){a=a.data;a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;a=new u(a);e.resolve(a)}),b.hitch(this,function(a){console.error(a);e.reject(a)}));return e},getAppById:function(a){var e=new k;this.updateCredential();this.isValidCredential()?(a=c.getAppIdUrl(this.portalUrl,a),m(a,{responseType:"json",query:{f:"json",
token:this.credential.token}}).then(b.hitch(this,function(a){e.resolve(a.data)}),b.hitch(this,function(a){e.reject(a)}))):setTimeout(b.hitch(this,function(){e.reject("token is null.")}),0);return e},queryGroups:function(a){this.updateCredential();var d=new k,g=c.getBaseGroupUrl(this.portalUrl),l={f:"json"};a&&(l=b.mixin(l,a));this.isValidCredential()&&(l.token=this.credential.token);m(g,{responseType:"json",query:l,callbackParamName:"callback"}).then(b.hitch(this,function(a){a=a.data;a.results=n.map(a.results,
b.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new e(a)}));d.resolve(a)}),b.hitch(this,function(a){console.error(a);d.reject(a)}));return d},registerApp:function(a,e,d){var g=new k;this.updateCredential();if(this.isValidCredential()){var l=this.credential&&this.credential.token,r=c.getOAuth2Url(this.portalUrl);m(r+"/registerApp",{query:{itemId:a,appType:e,redirect_uris:h.stringify(d),token:l,f:"json"},responseType:"json",method:"post"}).then(b.hitch(this,
function(a){g.resolve(a.data)}),b.hitch(this,function(a){g.reject(a)}))}else setTimeout(b.hitch(this,function(){g.reject("token is null.")}),0);return g},createAndRegisterApp:function(a){var c=new k;this.updateCredential();this.isValidCredential()?this.getUser().then(b.hitch(this,function(e){e.addItem({title:"Web AppBuilder for ArcGIS",type:"Web Mapping Application",text:"",snippet:"",tags:"Registered App for OAuth"},"").then(b.hitch(this,function(e){e.success?this.registerApp(e.id,"browser",a).then(b.hitch(this,
function(a){c.resolve(a)}),b.hitch(this,function(a){console.error(a);c.reject(a)})):c.reject("create app failed")}),b.hitch(this,function(a){console.error(a);c.reject(a)}))}),b.hitch(this,function(a){console.error(a);c.reject(a)})):setTimeout(b.hitch(this,function(){c.reject("token is null.")}),0);return c},_getUser:function(a){this.updateCredential();var e=new k;a=c.getUserUrl(this.portalUrl,a);var d={query:{f:"json"},responseType:"json",callbackParamName:"callback"};this.isValidCredential()&&(d.query.token=
this.credential&&this.credential.token);m(a,d).then(b.hitch(this,function(a){a=a.data;a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;this.user=new g(a);e.resolve(this.user)}),b.hitch(this,function(a){console.error(a);e.reject(a)}));return e},getItemResources:function(a,e,d){d||(d=100);a=c.getStandardPortalUrl(a);a=c.getItemResourceUrl(a,e);return m({url:a,content:{f:"json",num:d}}).then(function(a){if(a&&a.resources)return a.resources})},addResource:function(a,e,d,g,l){a=c.getStandardPortalUrl(a);
var r=this.getPortal(a),h=new FormData;h.append("file",d,g);h.append("fileName",g);h.append("f","json");var f="";l?(h.append("resourcesPrefix",l),f=l+"/"+g):f=g;return r.getItemById(e,!0).then(function(d){d=c.getUserContentItemUrl(a,d.owner,e);return m({url:d+"/addResources",form:h}).then(function(e){var d="";e&&e.success&&(d=c.getItemResourceUrl(a,"${itemId}",f));return d},function(a){console.error(a.message||a);return a})})},removeResources:function(a,e,d,g){var l={resource:g?g+"/"+d:d,f:"json"};
a=c.getStandardPortalUrl(a);return this.getPortal(a).getItemById(e,!0).then(function(d){d=c.getUserContentItemUrl(a,d.owner,e);return m({url:d+"/removeResources",content:l},{usePost:!0}).then(function(a){return a},function(a){console.error(a.message||a);return a})})}}),g=q([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&b.mixin(this,a)},_checkCredential:function(){var c=a.isValidCredential(this.credential);c||(this.credential=null);return c},
isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getGroups:function(){var a=[];this.groups&&(a=n.map(this.groups,b.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this.portal;return new e(a)})));return a},getItemsByKeywords:function(a,c){return this.portal.queryItems({start:c||1,num:100,q:"owner:"+
this.username+' AND typekeywords:"'+a+'"'})},getContent:function(){this.updateCredential();var a=c.getUserContentUrl(this.portalUrl,this.username),e={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential&&(e.query.token=this.credential.token);var d=new k;m(a,e).then(b.hitch(this,function(a){d.resolve(a.data)}),b.hitch(this,function(a){d.reject(a)}));return d},getTags:function(){this.updateCredential();var a=c.getUserTagsUrl(this.portalUrl,this.username),e={responseType:"json",
query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(e.query.token=this.credential.token);var d=new k;m(a,e).then(b.hitch(this,function(a){d.resolve(a.data)}),b.hitch(this,function(a){d.reject(a)}));return d},addItem:function(a,e){this.updateCredential();var d=new k;if(this.isValidCredential()){var g={f:"json",token:this.credential.token};a&&(g=b.mixin(g,a));a=c.getAddItemUrl(this.portalUrl,this.username,e);m(a,{responseType:"json",callbackParamName:"callback",query:g,method:"post"}).then(b.hitch(this,
function(a){d.resolve(a.data)}),b.hitch(this,function(a){console.error(a);d.reject(a)}))}else setTimeout(b.hitch(this,function(){d.reject("token is null.")}),0);return d},deleteItem:function(a){this.updateCredential();var e=new k;this.isValidCredential()?(a=c.getDeleteItemUrl(this.portalUrl,this.username,a),m(a,{query:{token:this.credential.token,f:"json"},responseType:"json",method:"post"}).then(b.hitch(this,function(a){e.resolve(a.data)}),b.hitch(this,function(a){e.reject(a)}))):setTimeout(b.hitch(this,
function(){e.reject("token is null.")}),0);return e},getItemById:function(a,e){this.updateCredential();var d=new k;e=c.getUserItemsUrl(this.portalUrl,this.username,e);var g={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(g.query.token=this.credential.token);m(e+"/"+a,g).then(b.hitch(this,function(a){a=a.data;a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;a=new u(a);d.resolve(a)}),b.hitch(this,function(a){console.error(a);d.reject(a)}));
return d},shareItem:function(a,e,d){this.updateCredential();var g=new k;this.isValidCredential()?(e=c.shareItemUrl(this.portalUrl,this.username,e,d),d={responseType:"json",callbackParamName:"callback",query:{f:"json",token:this.credential.token},method:"post"},a&&(a.content&&!a.query&&(a.query=a.content),d.query=b.mixin(d.query,a)),m(e,d).then(b.hitch(this,function(a){g.resolve(a.data)}),b.hitch(this,function(a){console.error(a);g.reject(a)}))):setTimeout(b.hitch(this,function(){g.reject("token is null.")}),
0);return g},updateItem:function(a,e){this.updateCredential();var d=new k;this.isValidCredential()?this.portal.getItemById(a).then(b.hitch(this,function(g){var l={f:"json",token:this.credential.token};e&&(l=b.mixin(l,e));g=c.getUpdateItemUrl(this.portalUrl,this.username,a,g.ownerFolder);m(g,{responseType:"json",callbackParamName:"callback",timeout:1E5,query:l,method:"post"}).then(b.hitch(this,function(a){d.resolve(a.data)}),b.hitch(this,function(a){console.error(a);d.reject(a)}))}),b.hitch(this,function(a){console.error(a);
d.reject(a)})):setTimeout(b.hitch(this,function(){d.reject("token is null.")}),0);return d},isAdminRole:function(){return"org_admin"===this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===this.role}}),e=q([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&b.mixin(this,a)},_checkCredential:function(){var c=
a.isValidCredential(this.credential);c||(this.credential=null);return c},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(a){a.q="group:"+this.id+" AND "+a.q;return this.portal.queryItems(a)}}),u=q([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,
token:null,constructor:function(a){a&&b.mixin(this,a);this.itemUrl=c.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&this.thumbnail&&this.itemUrl&&(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=c.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=c.getUserProfilePageUrl(this.portalUrl,
this.owner))},_checkCredential:function(){var c=a.isValidCredential(this.credential);c||(this.credential=null);return c},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getItemData:function(){return this.portal.getItemData(this.id)}}),t={portals:[],webMapQueryStr:" "+p.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+p.getItemQueryStringByTypes(["Web Scene"])+
" ",_findPortal:function(a){for(var e=0;e<this.portals.length;e++){var d=this.portals[e];if(c.isSamePortalUrl(a,d.portalUrl))return d.updateCredential(),d}return null},getPortal:function(e){if(!e||"string"!==typeof e||!b.trim(e))return null;e=c.getStandardPortalUrl(e);var d=this._findPortal(e);d||(d=new l(e),d.credential=a.getPortalCredential(d.portalUrl),d.updateCredential(),this.portals.push(d));return d},getPortalSelfInfo:function(a){return this.getPortal(a).loadSelfInfo()},getBasemapGalleryGroup:function(a){return this._getPortalSelfGroup(a,
"basemapGalleryGroupQuery")},getTemplatesGroup:function(a){return this._getPortalSelfGroup(a,"templatesGroupQuery")},getUnits:function(a){var c="english",e="",d=new k;this.getPortal(a).getUser().then(b.hitch(this,function(a){a&&a.units?c=a.units:(e=f.locale,c=e.startWith("en")?"english":"metric");d.resolve(c)}),b.hitch(this,function(g){console.warn(g);this.getPortalSelfInfo(a).then(b.hitch(this,function(a){var c=null;a&&a.units?c=a.units:(e=a&&a.culture||f.locale,c=e.startWith("en")?"english":"metric");
d.resolve(c)}),b.hitch(this,function(a){console.warn(a);e=f.locale;c=e.startWith("en")?"english":"metric";d.resolve(c)}))}));return d.promise},_getPortalSelfGroup:function(a,c){var d=new k,g=this.getPortal(a);g||setTimeout(b.hitch(this,function(){d.reject()}),0);this.getPortalSelfInfo(a).then(b.hitch(this,function(a){g.queryGroups({f:"json",q:a[c]}).then(b.hitch(this,function(a){0<a.results.length?(a=a.results[0],a.portalUrl=g.portalUrl,a.credential=g.credential,a.portal=g,a=new e(a),d.resolve(a)):
d.reject("Can't find portal self group.")}),b.hitch(this,function(a){console.error(a);d.reject(a)}))}),b.hitch(this,function(a){console.error(a);d.reject(a)}));return d},getWebMapsFromBasemapGalleryGroup:function(a){var c=new k;this.getBasemapGalleryGroup(a).then(b.hitch(this,function(a){a?a.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(b.hitch(this,function(a){c.resolve(a)}),b.hitch(this,function(a){console.error(a);c.reject(a)})):c.reject()}),b.hitch(this,function(a){console.error(a);
c.reject(a)}));return c},getDefaultWebScene:function(a){var c=new k,e=this.getPortal(a);e.getUser().then(b.hitch(this,function(a){e.queryItems({start:1,num:1,f:"json",q:this.webSceneQueryStr+' AND owner:"'+a.username+'" ',sortField:"numViews",sortOrder:"desc"}).then(b.hitch(this,function(a){a=a.results;a=n.filter(a,b.hitch(this,function(a){return a.type&&"web scene"===a.type.toLowerCase()}));0<a.length?c.resolve(a[0].id):c.resolve(null)}),b.hitch(this,function(a){c.reject(a)}))}),b.hitch(this,function(){c.reject("not sign in")}));
return c},getDefaultWebMap:function(a){var c=new k;this.getPortalSelfInfo(a).then(b.hitch(this,function(e){var d=e.defaultBasemap&&e.defaultBasemap.id;d?c.resolve(d):this._getDefaultWebMapByBasemapGallery(a,e).then(b.hitch(this,function(e){e?c.resolve(e):this._getMostNumViewsWebMap(a).then(b.hitch(this,function(a){a?c.resolve(a):c.reject()}),b.hitch(this,function(a){console.error(a);c.reject(a)}))}),b.hitch(this,function(a){console.error(a);c.reject(a)}))}),b.hitch(this,function(a){console.error(a);
c.reject(a)}));return c},_getDefaultWebMapByBasemapGallery:function(a,c){var e=new k,d=this.getPortal(a),g=c.defaultBasemap&&c.defaultBasemap.title;d.queryGroups({f:"json",q:c.basemapGalleryGroupQuery}).then(b.hitch(this,function(a){a=a.results;0<a.length?d.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+a[0].id+" AND title:"+g}).then(b.hitch(this,function(a){a=a.results;a=n.filter(a,b.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?e.resolve(a[0].id):
(console.log("Can't find web map under basemapGalleryGroupQuery."),d.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+g}).then(b.hitch(this,function(a){a=a.results;a=n.filter(a,b.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));if(0<a.length){var c=a[0];d.getItemData(c.id).then(b.hitch(this,function(a){a&&(a.operationalLayers||a.baseMap||a.version)?e.resolve(c.id):e.resolve(null)}),b.hitch(this,function(){e.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),
e.resolve(null)}),b.hitch(this,function(a){console.error(a);e.reject(a)})))}),b.hitch(this,function(a){console.error(a);e.reject(a)})):(console.log("Can't find group by basemapGalleryGroupQuery."),e.resolve(null))}),b.hitch(this,function(a){console.error(a);e.reject(a)}));return e},_getMostNumViewsWebMap:function(a){var c=new k;this.getPortal(a).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(b.hitch(this,
function(a){a=a.results;a=n.filter(a,b.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?c.resolve(a[0].id):c.reject("Can't find most-num-views web map.")}),b.hitch(this,function(a){console.error(a);c.reject(a)}));return c}};d.subscribe("userSignOut",function(a){(a=t._findPortal(a))&&a.clearCredentialAndUser()});return t})},"jimu/appConfigResourceUtils":function(){define(["dojo/Deferred","dojo/promise/all","jimu/portalUtils","jimu/utils"],function(q,b,n,f){return{AddResourcesToItemForAppSave:function(k,
d,h,m){d=d||[];if(0===d.length){var p=new q;p.resolve(d);return p}d=d.map(function(c){var a=c.resUrl.split("resources/")[1],d=new q;c.b64?(c=f.b64toBlob(c.b64),d.resolve({blob:c,fileName:a.split("/")[1],prefixName:a.split("/")[0]})):(c=c.resUrl,0<c.indexOf("${itemId}")&&(c=c.replace("${itemId}",h)),f.resourcesUrlToBlob(c).then(function(c){d.resolve({blob:c,fileName:a.split("/")[1],prefixName:a.split("/")[0]},function(a){console.error(a.message||a);d.reject(a)})}));return d});return b(d).then(function(c){if(c instanceof
Array&&0<c.length)return c=c.map(function(a){var c=h;m&&(c=m);return n.addResource(k,c,a.blob,a.fileName,a.prefixName)}.bind(this)),b(c).then(function(a){return a})}.bind(this))}}})},"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/geometry/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),function(q,b,n,f,k,d,h,m,p){var c=null,a=q(null,{rawAppConfig:null,mapMd5:null,appStateKey:null,setRawAppConfig:function(a){this.rawAppConfig=
a},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var a=f.stringify(this.rawAppConfig.map);this.mapMd5=m(a)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var a=new n,c={};if(p.isInConfigOrPreviewWindow()||!this.rawAppConfig||!this.rawAppConfig.map)return a.resolve(c),a;var e=this._getAppStateKey(),f=h.get(e);f&&f.appStateMd5===this._getAppStateMd5()?
(e=f.map&&f.map.extent,f=f.map&&f.map.layers,e&&(c.extent=new k(e.xmin,e.ymin,e.xmax,e.ymax,new d(e.spatialReference))),f&&(c.layers=f)):h.remove(e);a.resolve(c);return a},saveWabAppState:function(a,c){if(a&&!p.isInConfigOrPreviewWindow()){var e=this._getAppStateKey(),d={extent:{xmin:a.extent.xmin,xmax:a.extent.xmax,ymin:a.extent.ymin,ymax:a.extent.ymax,spatialReference:{wkid:a.extent.spatialReference.wkid,wkt:a.extent.spatialReference.wkt}},layers:{}};c&&c.traversalLayerInfosOfWebmap&&c.traversalLayerInfosOfWebmap(b.hitch(this,
function(a){d.layers[a.id]={visible:a.isShowInMap()}}));h.set(e,{map:d,appStateMd5:this._getAppStateMd5()})}}});a.getInstance=function(d){null===c&&(c=new a);c.urlParams=d;return c};return a})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/query dojo/Deferred dojo/promise/all dojo/debounce require ./MapManager ./utils".split(" "),function(q,b,n,f,k,d,h,m,p,c,a,l,g){var e=null,u;u=q([f],{constructor:function(a,e){this.own(k.subscribe("appConfigLoaded",
b.hitch(this,this._onAppConfigLoaded)));this.own(k.subscribe("appConfigChanged",b.hitch(this,this._onAppConfigChanged)));this.own(k.subscribe("sceneViewLoaded",b.hitch(this,this._onSceneViewLoaded)));this.own(k.subscribe("sceneViewChanged",b.hitch(this,this._onSceneViewChanged)));this.own(k.subscribe("beforeSceneViewDestory",b.hitch(this,this._onBeforeSceneViewDestroy)));this.own(k.subscribe("builder/actionTriggered",b.hitch(this,this._onActionTriggered)));this.own(k.subscribe("openWidget",b.hitch(this,
this._onOpenWidgetRequest)));this.own(d(window,"resize",c(b.hitch(this,this.resize),200)));this.id=e},postCreate:function(){this.containerNode=this.domNode},sceneView:null,mapId:"map",mapDiv:null,layoutManager:null,animTime:500,resize:function(){this.layoutManager&&this.layoutManager.resize()},_onAppConfigLoaded:function(a){this.appConfig=b.clone(a);this._loadLayoutManager(this.appConfig).then(b.hitch(this,function(a){this.layoutManager=a;this.layoutManager.onEnter(this.appConfig,this.mapId).then(b.hitch(this,
function(){this.mapDiv=this.layoutManager.getMapDiv();this._loadMap(this.mapId);this.appConfig.theme&&this._loadTheme(this.appConfig.theme)}))}))},_loadLayoutManager:function(c){c=c.layoutDefinition?c.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager";var e=new m;a([c],b.hitch(this,function(a){a=a.getInstance();this.sceneView&&a.setSceneView(this.sceneView);e.resolve(a)}));return e},_loadMap:function(){this.mapManager=l.getInstance({appConfig:this.appConfig,urlParams:this.urlParams},
this.mapId);this.mapManager.showMap()},_onSceneViewLoaded:function(a){this.sceneView=a;this.layoutManager.setSceneView(a);this.layoutManager.loadAndLayout(this.appConfig)},_loadTheme:function(c){var e=new m;a(["themes/"+c.name+"/main"],b.hitch(this,function(){p([this._loadThemeCommonStyle(c),this._loadThemeCurrentStyle(c)]).then(b.hitch(this,function(){this._addCustomStyle(c);this.layoutManager.onThemeLoad();e.resolve()}))}));return e},_loadThemeCommonStyle:function(a){n.addClass(this.domNode,a.name);
return g.loadStyleLink(this._getThemeCommonStyleId(a),"themes/"+a.name+"/common.css")},_loadThemeCurrentStyle:function(a){n.addClass(this.domNode,a.styles[0]);return g.loadStyleLink(this._getThemeCurrentStyleId(a),"themes/"+a.name+"/styles/"+a.styles[0]+"/style.css")},_addCustomStyle:function(a){var c=b.getObject("customStyles",!1,a);if(c){var e=".jimu-main-background{background-color: ${mainBackgroundColor} !important;}";(a=this._getFixedThemeStyles(a))&&(e+=a);e=b.replace(e,c,/\$\{([^\}]+)\}/g);
c=n.create("style",{type:"text/css"});try{c.appendChild(document.createTextNode(e))}catch(w){c.styleSheet.cssText=e}c.setAttribute("source","custom");document.head.appendChild(c)}},_getFixedThemeStyles:function(a){var c=".esriPopup .titlePane {background-color: ${mainBackgroundColor} !important;}";"PlateauTheme"===a.name?c+=".jimu-widget-header-controller .jimu-title, .jimu-widget-header-controller .jimu-subtitle{color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller .links .jimu-link{color: ${mainBackgroundColor} !important;}.jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate.vertical .operation{background-color: ${mainBackgroundColor} !important;}.jimu-preload-widget-icon-panel \x3e .jimu-panel-title, .jimu-foldable-panel \x3e .jimu-panel-title, .jimu-title-panel \x3e .title{color: ${mainBackgroundColor} !important;}.jimu-panel{border-color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller{border-bottom-color: ${mainBackgroundColor} !important;}.jimu-tab\x3e.control\x3e.tab{color: ${mainBackgroundColor} !important; border-color: ${mainBackgroundColor} !important}":
"BillboardTheme"===a.name?c+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation, .jimu-widget-navigate, .jimu-widget-home, .jimu-widget-zoom .esri-zoom .esri-widget, .jimu-widget-placeholder{background-color: ${mainBackgroundColor} !important;}.jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important;}":
"BoxTheme"===a.name?c+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate, .jimu-widget-navigate, .jimu-widget-home, .jimu-widget-zoom .esri-zoom .esri-widget, .jimu-widget-placeholder{background-color: ${mainBackgroundColor} !important;}":"TabTheme"===a.name?c+=".tab-widget-frame .title-label{color: ${mainBackgroundColor} !important;}":
"DashboardTheme"===a.name?c+=".jimu-widget-dnd-header{background-color: ${mainBackgroundColor} !important;}":"DartTheme"===a.name&&(c+=".jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important;}");return c},_onAppConfigChanged:function(a,c,e){a=b.clone(a);switch(c){case "themeChange":this._onThemeChange(a);break;case "styleChange":this._onStyleChange(a);break;case "layoutChange":this._onLayoutChange(a);break;case "widgetChange":this._onWidgetChange(a,e);break;case "groupChange":this._onGroupChange(a,
e);break;case "widgetPoolChange":this._onWidgetPoolChange(a,e);break;case "resetConfig":this._onResetConfig(a);break;case "loadingPageChange":this._onLoadingPageChange(a,e);break;case "layoutDefinitionChange":this._onLayoutDefinitionChange(a,e);break;case "onScreenGroupsChange":this._onOnScreenGroupsChange(a,e);break;case "onScreenOrderChange":this._onOnScreenOrderChange(a,e)}this.appConfig=a},_onSceneViewChanged:function(a){this.sceneView=a;this.layoutManager.setSceneView(a);this.layoutManager.loadAndLayout(this.appConfig)},
_onBeforeSceneViewDestroy:function(){this.layoutManager.destroyOnScreenWidgetsAndGroups()},_onActionTriggered:function(a){this.layoutManager.onActionTriggered(a)},_onWidgetChange:function(a,c){this.layoutManager.onWidgetChange(a,c)},_onGroupChange:function(a,c){this.layoutManager.onGroupChange(a,c)},_onWidgetPoolChange:function(a,c){this.layoutManager.onWidgetPoolChange(a,c)},_onLayoutDefinitionChange:function(a,c){this.layoutManager.onLayoutDefinitionChange(a,c)},_onOnScreenGroupsChange:function(a,
c){this.layoutManager.onOnScreenGroupsChange(a,c)},_onOnScreenOrderChange:function(a,c){this.layoutManager.onOnScreenOrderChange(a,c)},_onThemeChange:function(a){this.layoutManager.destroyOnScreenWidgetsAndGroups();this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();p([this._loadLayoutManager(a),this._loadTheme(a.theme)]).then(b.hitch(this,function(c){var e=c[0];this.layoutManager.name!==e.name?(this.layoutManager.onLeave(),
e.onEnter(a,this.mapId).then(b.hitch(this,function(){this.layoutManager=e;this.layoutManager.loadAndLayout(a)}))):this.layoutManager.loadAndLayout(a)}))},_onResetConfig:function(a){var c=this.appConfig;k.publish("appConfigChanged",a,"mapChange",a);this.appConfig=c;this._loadLayoutManager(a).then(b.hitch(this,function(a){this.layoutManager=a;this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();this._loadTheme(this.appConfig.theme)}))},
_onLoadingPageChange:function(a,c){"backgroundColor"in c?n.setStyle(jimuConfig.loadingId,"background-color",a.loadingPage.backgroundColor):"backgroundImage"in c?(a=a.loadingPage.backgroundImage,a.visible&&a.uri?(n.setStyle(jimuConfig.loadingImageId,"background-image","url('"+a.uri+"')"),n.setStyle(jimuConfig.loadingImageId,"width",a.width+"px"),n.setStyle(jimuConfig.loadingImageId,"height",a.height+"px")):(n.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),n.setStyle(jimuConfig.loadingImageId,
"width","0px"),n.setStyle(jimuConfig.loadingImageId,"height","0px"))):"loadingGif"in c&&(a=a.loadingPage.loadingGif,a.visible&&a.uri?(n.setStyle(jimuConfig.loadingGifId,"background-image","url('"+a.uri+"')"),n.setStyle(jimuConfig.loadingGifId,"width",a.width+"px"),n.setStyle(jimuConfig.loadingGifId,"height",a.height+"px")):(n.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),n.setStyle(jimuConfig.loadingGifId,"width","0px"),n.setStyle(jimuConfig.loadingGifId,"height","0px")))},_onStyleChange:function(a){this._removeThemeCurrentStyle(this.appConfig.theme);
this._loadThemeCurrentStyle(a.theme);this._removeCustomStyle();this._addCustomStyle(a.theme)},_onLayoutChange:function(a){this.layoutManager.onLayoutChange(a)},_removeThemeCommonStyle:function(a){n.removeClass(this.domNode,a.name);n.destroy(this._getThemeCommonStyleId(a))},_removeThemeCurrentStyle:function(a){n.removeClass(this.domNode,a.styles[0]);n.destroy(this._getThemeCurrentStyleId(a))},_removeCustomStyle:function(){h('style[source\x3d"custom"]',document.head).forEach(function(a){n.destroy(a)})},
_getThemeCommonStyleId:function(a){return"theme_"+a.name+"_style_common"},_getThemeCurrentStyleId:function(a){return"theme_"+a.name+"_style_"+a.styles[0]},_doPostLoad:function(){a(["dynamic-modules/postload"])},_onOpenWidgetRequest:function(a){this.layoutManager.openWidget(a)}});u.getInstance=function(a,c){null===e&&(e=new u(a,c),window._layoutManager=e);return e};return u})},"dojo/debounce":function(){define([],function(){return function(q,b){var n;return function(){n&&clearTimeout(n);var f=this,
k=arguments;n=setTimeout(function(){q.apply(f,k)},b)}}})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/on dojo/keys esri/geometry/Extent esri/geometry/Point ./utils ./dijit/LoadingShelter ./AppStateManager ./WebSceneLoader esri/Viewpoint".split(" "),function(q,b,n,f,k,d,h,m,p,c,a,l,g,e){var u=null,t=q(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,
constructor:function(a,c){this.appConfig=a.appConfig;this.urlParams=a.urlParams;this.id=this.mapDivId=c;this.appStateManager=l.getInstance(this.urlParams);k.subscribe("appConfigChanged",b.hitch(this,this.onAppConfigChanged));k.subscribe("changeMapPosition",b.hitch(this,this.onChangeMapPosition));k.subscribe("syncViewpoint",b.hitch(this,this.onSyncViewpoint));d(window,"resize",b.hitch(this,this.onWindowResize));d(window,"beforeunload",b.hitch(this,this.onBeforeUnload))},showMap:function(){this._showMap(this.appConfig)},
_showMap:function(c){console.time("Load Map");this.loading=new a;this.loading.placeAt(this.mapDivId);this.loading.startup();c.map["3D"]?c.map.itemId?this._show3DWebScene(c):console.log("No webscene found. Please set map.itemId in config.json."):c.map.itemId?this._show2DWebMap(c):console.log("No webmap found. Please set map.itemId in config.json.")},onBeforeUnload:function(){this.appStateManager.saveWabAppState(this.map,this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),
this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(a){a&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&this._mapMobileInfoWindow.destroy(),this.isMobileInfoWindow=!1);window.appInfo.isRunInMobile&&!this.isMobileInfoWindow?this.isMobileInfoWindow=!0:!window.appInfo.isRunInMobile&&this.isMobileInfoWindow&&(this.isMobileInfoWindow=!1)},onChangeMapPosition:function(a){var c=b.clone(this.mapPosition);
b.mixin(c,a);this.setMapPosition(c)},setMapPosition:function(a){this.mapPosition=a;a=c.getPositionStyle(a);f.setStyle(this.mapDivId,a);this.map&&this.map.resize&&this.map.resize()},getMapPosition:function(){return this.mapPosition},onSyncViewpoint:function(a){this.sceneView&&(this.sceneView.viewpoint=a.clone())},_visitConfigMapLayers:function(a,c){n.forEach(a.map.basemaps,function(a,e){a.isOperationalLayer=!1;c(a,e)},this);n.forEach(a.map.operationallayers,function(a,e){a.isOperationalLayer=!0;c(a,
e)},this)},_destroySceneView:function(){if(this.sceneView)try{this.sceneView.destroy()}catch(r){console.error(r)}this.sceneView=null;window._sceneView=null},_show3DWebScene:function(a){var c=a.map.portalUrl,d=a.map.itemId;this._destroySceneView();g.createMap(this.mapDivId,c,d).then(b.hitch(this,function(c){this._publishSceneViewEvent(c);if(a.map.mapOptions)if((c=a.map.mapOptions.initialState)&&c.viewpoint)try{var d=e.fromJSON(c.viewpoint);d&&(this.sceneView.map.initialViewProperties.viewpoint=d,this.sceneView.viewpoint=
d.clone())}catch(z){console.error(z)}else this.sceneView.map.initialViewProperties.viewpoint=this.sceneView.viewpoint}),b.hitch(this,function(){this.loading&&this.loading.destroy();k.publish("mapCreatedFailed")}))},_publishSceneViewEvent:function(a){window._sceneView=a;console.timeEnd("Load Map");this.loading&&this.loading.destroy();this.sceneView?(this.sceneView=a,console.log("sceneView changed"),k.publish("sceneViewChanged",this.sceneView)):(this.sceneView=a,console.log("sceneView loaded"),k.publish("sceneViewLoaded",
this.sceneView))},_show2DWebMap:function(a){a.map.mapOptions||(a.map.mapOptions={});var e=this._processMapOptions(a.map.mapOptions)||{};e.isZoomSlider=!1;c.createWebMap(a.map.portalUrl,a.map.itemId,this.mapDivId,{mapOptions:e,bingMapsKey:a.bingMapsKey,usePopupManager:!0}).then(b.hitch(this,function(c){var e=c.map;e.hideZoomSlider();e.infoWindow.resize(270,316);e.itemId=a.map.itemId;e.itemInfo=c.itemInfo;e.webMapResponse=c;e.enableSnapping({snapKey:h.copyKey});f.setStyle(e.root,"zIndex",0);e._initialExtent=
e.extent;n.forEach("extent center marker find query scale level".split(" "),function(a){},this);this._publishMapEvent(e)}),b.hitch(this,function(){this.loading&&this.loading.destroy();k.publish("mapCreatedFailed")}))},_processMapOptions:function(a){if(a)return a.lods||delete a.lods,a.lods&&0===a.lods.length&&delete a.lods,a=b.clone(a),a.extent&&(a.extent=new m(a.extent)),a.center&&!b.isArrayLike(a.center)&&(a.center=new p(a.center)),a},onAppConfigChanged:function(a,c,d){this.appConfig=a;"mapChange"===
c?this._recreateMap(a):"mapOptionsChange"===c&&d.initialState&&(a=d.initialState.viewpoint)&&(this.sceneView.map.initialViewProperties.viewpoint=e.fromJSON(a),this.sceneView.animateTo(e.fromJSON(a)))},_recreateMap:function(a){this.sceneView&&(k.publish("beforeSceneViewDestory",this.sceneView),this._destroySceneView());this._showMap(a)},disableWebMapPopup:function(){},enableWebMapPopup:function(){}});t.getInstance=function(a,c){null===u&&(u=new t(a,c));return u};return t})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare",
"dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(q,b,n,f,k){return q([b,n],{baseClass:"jimu-loading-shelter",declaredClass:"jimu.dijit.LoadingShelter",templateString:f,loadingText:null,hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&k.setStyle(this.domNode,"display","none");k.setStyle(this.domNode,{width:"100%",height:"100%"});
this.showLoading||k.setStyle(this.imgDiv,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(d){this.domNode&&this.hidden&&("string"===typeof d&&(this.textNode.innerHTML=d),k.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(k.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/WebSceneLoader":function(){define("dojo/Deferred dojo/_base/lang dojo/_base/array dojo/_base/html dojo/promise/all esri/kernel esri/WebScene esri/views/SceneView esri/portal/Portal esri/portal/PortalItem esri/core/has ./utils ./portalUtils ./portalUrlUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e){return{createMap:function(c,e,d){var g=new q;a("esri-webgl")?g=this._createMap(c,e,d):(g.reject("The browser doesn't support webgl."),(c=b.getObject("webSceneLoader.webglSupportTip",!1,window.jimuNls))||(c="3D web apps aren't supported in your browser."),f.create("div",{"class":"app-error",innerHTML:c},document.body));return g},_createMap:function(a,d,r){l.getEsriConfig().portalUrl=e.getStandardPortalUrl(d);var f=new q,u=[];p._default=null;var t=new h({portalItem:new c({id:r})}),
v=new m({map:t,container:a,constraints:{collision:{enabled:!1},tilt:{max:179.99}}});u.push(v.when());d=g.getPortal(d);u.push(d.getItemById(r));u.push(d.getItemData(r));k(u).then(b.hitch(this,function(c){v.popup&&(v.popup.closeOnViewChangeEnabled=!0);t.id=a;t.itemId=r;t.itemInfo={item:c[1],itemData:c[2]};this._handleLocalScene(v);f.resolve(v)}),b.hitch(this,function(a){console.error(a);f.reject(a)}));return f},_handleLocalScene:function(a){try{a.viewingMode&&"local"===a.viewingMode.toLowerCase()&&
(b.setObject("constraints.collision.enabled",!1,a),b.setObject("constraints.tilt.max",179.99,a))}catch(t){console.error(t)}},_handleAttribution:function(a){try{if("4.0"!==d.version){var c=a.ui&&a.ui._components;c&&0<c.length&&n.some(c,function(a){return(a=a&&a._widget)&&"esri.widgets.Attribution"===a.declaredClass?(a.domNode.parentNode.style.width="100%",f.create("span",{innerHTML:"Powered by Esri","class":"esri-attribution-powered-by"},a.domNode),!0):!1})}}catch(r){console.error(r)}}}})},"esri/WebScene":function(){define("require exports ./core/tsSupport/declareExtendsHelper ./core/tsSupport/decorateHelper ./core/tsSupport/paramHelper ./core/tsSupport/assignHelper ./core/tsSupport/generatorHelper ./core/tsSupport/awaiterHelper ./kernel ./Map ./Viewpoint ./core/asyncUtils ./core/Collection ./core/Error ./core/Handles ./core/has ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/Extent ./geometry/HeightModelInfo ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./geometry/support/jsonUtils ./portal/Portal ./portal/PortalItem ./support/webSceneUtils ./webscene/ApplicationProperties ./webscene/Environment ./webscene/InitialViewProperties ./webscene/Presentation ./webscene/Version".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C,E,F,H,D,G,K,M,O,N,P,L,T,R,J){var U=v.getLogger("esri.WebScene"),Q=new J.default(1,15),I={width:600,height:400};return function(c){function b(a){a=c.call(this)||this;a._handles=new u;a.applicationProperties=null;a.clippingArea=null;a.clippingEnabled=!1;a.heightModelInfo=null;a.sourceVersion=null;a.supportsHeightModelInfo=!0;a.presentation=new R;a.initialViewProperties=new T;a.portalItem=null;a.resourceInfo=null;a.authoringApp=null;a.authoringAppVersion=
null;a._isAuthoringAppSetByUser=!1;a._isAuthoringAppVersionSetByUser=!1;return a}n(b,c);b.prototype.initialize=function(){var a=this;this.when().catch(function(a){U.error("#load()","Failed to load web scene",a)});if(this.resourceInfo){var c=void 0;try{c=this._validateJSON(this.resourceInfo)}catch(da){this.addResolvingPromise(z.reject(da));return}this.read(c);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",
function(){return a._scheduleLayersIdGC()}))};b.prototype.destroy=function(){this._unscheduleLayersIdGC();this._handles.destroy()};b.prototype.writeClippingArea=function(a,c){c.clippingArea||(c.clippingArea={});c.clippingArea.geometry=a.toJSON()};b.prototype.readClippingEnabled=function(a,c){return c.clippingArea?!!c.clippingArea.clip:!1};b.prototype.writeClippingEnabled=function(a,c){this.clippingArea&&(c.clippingArea||(c.clippingArea={}),c.clippingArea.clip=a)};b.prototype.writeLayers=function(a,
c,e,g){var l=this,h=d({},g,{layerContainerType:"operational-layers"});a=a.map(function(a){return l.verifyWriteLayer(a,g)?a.write(null,h):null}).filter(function(a){return!!a});c[e]=a.toArray()};b.prototype.verifyWriteLayer=function(a,c){return"write"in a?!0:(c&&c.messages&&c.messages.push(new e("layer:unsupported","Layers ("+a.title+", "+a.id+") of type '"+a.declaredClass+"' cannot be persisted in web scenes",{layer:a})),!1)};b.prototype.readSourceVersion=function(a,c){a=c.version.split(".");c=a[1];
return new J.default(parseInt(a[0],10),parseInt(c,10))};b.prototype.writeSourceVersion=function(a,c,e){c[e]=Q.major+"."+Q.minor};Object.defineProperty(b.prototype,"thumbnailUrl",{get:function(){return this.portalItem&&this.portalItem.thumbnailUrl||null},set:function(a){a?this._override("thumbnailUrl",a):this._clearOverride("thumbnailUrl")},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"authoringApp",{set:function(a){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",a)},
enumerable:!0,configurable:!0});b.prototype.writeAuthoringApp=function(a,c){c.authoringApp=a&&this._isAuthoringAppSetByUser?a:"ArcGIS API for JavaScript"};Object.defineProperty(b.prototype,"authoringAppVersion",{set:function(a){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",a)},enumerable:!0,configurable:!0});b.prototype.writeAuthoringAppVersion=function(a,c){c.authoringAppVersion=a&&this._isAuthoringAppVersionSetByUser?a:p.version};b.prototype.writeGround=function(a,c,e,
d){c[e]=a?a.write(null,d):{transparency:0,layers:[]}};b.prototype.readInitialViewProperties=function(c,e){c={};e.initialState&&e.initialState.environment&&(c.environment=L.fromJSON(e.initialState.environment));c.spatialReference=e.spatialReference?D.fromJSON(e.spatialReference):D.WebMercator;c.viewingMode=e.viewingMode||"global";e.initialState&&e.initialState.viewpoint&&(c.viewpoint=a.fromJSON(e.initialState.viewpoint));return new T(c)};b.prototype.writeInitialViewProperties=function(a,c,e,d){a&&
(e={},a.environment&&(e.environment=a.environment.write({},d)),a.viewpoint&&(e.viewpoint=a.viewpoint.write({},d)),0!==Object.keys(e).length&&(c.initialState=e),c.spatialReference=a.spatialReference?a.spatialReference.write({},d):D.WebMercator.toJSON(),c.viewingMode=null!=a.viewingMode?a.viewingMode:"global")};b.prototype.load=function(){this.addResolvingPromise(this._loadFromSource());return this.when()};b.prototype.loadAll=function(){var a=this;return l.safeCast(x.default(this,function(c){var e=
a.presentation&&a.presentation.slides;c(a.ground,a.basemap,a.layers,e&&e.map(function(a){return a.basemap}))}))};b.prototype.read=function(a,c){var e=this;c=d({},c,{origin:"web-scene"});var g=this._isAuthoringAppVersionSetByUser,l=this._isAuthoringAppSetByUser,h=arguments;E.readLoadable(this,a,function(c){return e.inherited(h,[a,c])},c);l||(this._isAuthoringAppSetByUser=!1);g||(this._isAuthoringAppVersionSetByUser=!1);if(a.baseMap&&Array.isArray(a.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){var g=
a.baseMap.elevationLayers.map(function(a){return{id:a.id}}),f=this.presentation.slides,r=function(a,c){return a.visibleLayers.some(function(a){return a.id===c})},m=g.filter(function(a){return!f.some(function(c){return r(c,a.id)})});f.forEach(function(a){a.visibleLayers.addMany(m)})}};b.prototype._writeBasemapElevationLayers=function(a){var c=a.ground&&a.ground.layers;!a.baseMap&&c&&c.length&&(a.baseMap={title:"Basemap",baseMapLayers:[]});a.baseMap&&(a.baseMap.elevationLayers=y.clone(c))};b.prototype.write=
function(a,c){if("loaded"!==this.loadStatus){var g=new e("webscene:not-loaded","Web scene must be loaded before it can be serialized");U.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus);throw g;}this._runLayersIdGC();c=d({},c,{origin:"web-scene"});g=this.inherited(arguments,[a,c]);this._writeBasemapElevationLayers(g);return g};b.prototype.save=function(a){return m(this,void 0,void 0,function(){var c,d,g;return h(this,function(l){switch(l.label){case 0:if(this.portalItem)return[3,
2];U.error("save(): requires the .portalItem property to be set");return[4,z.reject(new e("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene"))];case 1:l.sent(),l.label=2;case 2:return"Web Scene"===this.portalItem.type?[3,4]:[4,z.reject(new e("webscene:portal-item-wrong-type",'Portal item needs to have type "Web Scene"'))];case 3:l.sent(),l.label=4;case 4:return c=this._updateFromPromise,[4,this.load()];case 5:return l.sent(),[4,this._loadObjectsWithLayers()];
case 6:return l.sent(),d=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl&&A.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||M.getDefault(),writtenProperties:[],blockedRelativeUrls:[]}),g=this.write(null,d),[4,this._verifySave(g,d,a)];case 7:return l.sent(),this._updateTypeKeywords(this.portalItem),[4,this.portalItem.update({data:g})];case 8:return l.sent(),C.updateOrigins(d),c?[4,c]:[3,10];case 9:l.sent(),l.label=10;case 10:return[4,
this._saveThumbnail()];case 11:return l.sent(),[2,this.portalItem]}})})};b.prototype.saveAs=function(a,c){return m(this,void 0,void 0,function(){var d,g,l,f,m;return h(this,function(h){switch(h.label){case 0:if(a)return[3,2];U.error("saveAs(portalItem): requires a portal item parameter");return[4,z.reject(new e("webscene:portal-item-required","saveAs requires a portal item to save to"))];case 1:h.sent(),h.label=2;case 2:return a.type&&"Web Scene"!==a.type||a.id?[4,z.reject(new e("webscene:portal-item-already-exists",
"WebScene can only saveAs to a new and empty portal item"))]:[3,4];case 3:h.sent(),h.label=4;case 4:return d=a.portal||M.getDefault(),[4,this.load()];case 5:return h.sent(),[4,this._loadObjectsWithLayers()];case 6:return h.sent(),g=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:d,writtenProperties:[],blockedRelativeUrls:[]}),l=this.write(null,g),[4,this._verifySaveAs(l,g,c)];case 7:return h.sent(),[4,d._signIn()];case 8:return h.sent(),f=this.thumbnailUrl,m=!this._isOverridden("thumbnailUrl"),
a.type="Web Scene",a.portal=d,this._updateTypeKeywords(a),[4,d.user.addItem({item:a,folder:c&&c.folder,data:l})];case 9:return h.sent(),this.portalItem=a,r.prototype.read.call(this,{version:l.version,authoringApp:l.authoringApp,authoringAppVersion:l.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:a.itemUrl&&A.urlToObject(a.itemUrl)}),C.updateOrigins(g),f&&(this.thumbnailUrl=m?A.addQueryParameter(f,"w","8192"):f),[4,this._saveThumbnail()];case 10:return h.sent(),[2,a]}})})};b.prototype._saveThumbnail=
function(){return m(this,void 0,void 0,function(){return h(this,function(a){switch(a.label){case 0:return this._isOverridden("thumbnailUrl")?[4,this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl})]:[3,2];case 1:a.sent(),this._clearOverride("thumbnailUrl"),a.label=2;case 2:return[2]}})})};b.prototype._verifySave=function(a,c,d,g){void 0===g&&(g=!1);var l=c.messages.filter(function(a){return"error"===a.type}).map(function(a){return new e(a.name,a.message,a.details)});c.blockedRelativeUrls&&
(l=l.concat(c.blockedRelativeUrls.map(function(a){return new e("url:unsupported","Relative url '"+a+"' is not supported in Web Scene")})));d&&d.ignoreUnsupported&&(l=l.filter(function(a){return"layer:unsupported"!==a.name&&"symbol:unsupported"!==a.name&&"symbol-layer:unsupported"!==a.name&&"property:unsupported"!==a.name&&"url:unsupported"!==a.name}));d&&d.strictSchemaValidationEnabled||(l=l.filter(function(a){return"web-document-write:property-required"!==a.name}));var h=d&&d.strictSchemaValidationEnabled;
return(h?z.create(function(a){return q(["./webscene/validator"],a)}).then(function(c){c=c.validate(a);if(0<c.length){var d="webscene did not validate:\n"+c.join("\n");U.error((g?"saveAs":"save")+"(): "+d)}return c.map(function(a){return new e("webscene:schema-validation",a)})}).then(function(a){return h&&0<a.length?(a=N.createSchemaValidationError(a.concat(l)),z.reject(a)):l}):z.resolve(l)).then(function(a){if(0<a.length)return z.reject(new e("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",
{errors:a}))})};b.prototype._verifySaveAs=function(a,c,e){return this.canSaveAs(c)?z.reject(N.createCopyError()):this._verifySave(a,c,e,!0)};b.prototype.verifySaveAs=function(a){var c=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),e=this.write(null,c);return this._verifySaveAs(e,c,a)};b.prototype.canSaveAs=function(a){a||(a=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write(null,a));return a.verifyItemRelativeUrls&&0<a.verifyItemRelativeUrls.writtenUrls.length};
b.prototype.updateFrom=function(a,c){void 0===c&&(c={});return m(this,void 0,void 0,function(){var e,d;return h(this,function(g){switch(g.label){case 0:return this._updateFromPromise=e=this._updateFromInternal(a,c),[4,e];case 1:g.sent();if(d=this._updateFromPromise===e)this._updateFromPromise=null;return[2]}})})};b.prototype._updateFromInternal=function(a,c){void 0===c&&(c={});return m(this,void 0,void 0,function(){return h(this,function(e){switch(e.label){case 0:return[4,a.whenReady()];case 1:return e.sent(),
!c.environmentExcluded&&a.environment&&(this.initialViewProperties.environment=L.prototype.clone.apply(a.environment)),!c.viewpointExcluded&&a.viewpoint&&(this.initialViewProperties.viewpoint=a.viewpoint.clone()),this.initialViewProperties.spatialReference=a.spatialReference.clone(),this.initialViewProperties.viewingMode=a.viewingMode,a.clippingArea?a.clippingArea!==this.clippingArea&&(this.clippingArea=a.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1,a.heightModelInfo&&(this.heightModelInfo=
a.heightModelInfo.clone()),a.map===this&&a.allLayerViews.forEach(function(a){a.layer.visible=a.visible}),!1===c.thumbnailExcluded||null==c.thumbnailExcluded&&!c.viewpointExcluded?[4,this._updateFromThumbnail(a,c.thumbnailSize||void 0)]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}})})};b.prototype._updateFromThumbnail=function(a,c){void 0===c&&(c=I);return m(this,void 0,void 0,function(){var e,d,g,l;return h(this,function(h){switch(h.label){case 0:return e=c.width,d=c.height,g=e/d,1.5>g?d=e/1.5:
1.5<g&&(e=1.5*d),e>a.width&&(d*=a.width/e,e=a.width),d>a.height&&(e*=a.height/d,d=a.height),[4,a.takeScreenshot({format:"jpg",width:Math.round(e),height:Math.round(d),disableSlice:!0})];case 1:return l=h.sent(),this.thumbnailUrl=l.dataUrl,[2]}})})};b.prototype._loadFromSource=function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()};b.prototype._readAndLoadFromJSON=
function(a,c){a=this._validateJSON(a,c&&c.url&&c.url.path);this.read(a,c);return this._loadFromJSON(a,c)};b.prototype._extractOperationalLayers=function(a){var c=this,e=[];if(!this.sourceVersion.supportsGround&&a.baseMap&&Array.isArray(a.baseMap.elevationLayers))for(var d=0,g=a.baseMap.elevationLayers;d<g.length;d++)e.push(g[d]);var l=[],h=function(a){a.layers&&(a.layers=a.layers.filter(h));return"ArcGISTiledElevationServiceLayer"===a.layerType?(c.sourceVersion.supportsGround||l.push(a),!1):!0};return{operationalLayers:a.operationalLayers?
a.operationalLayers.filter(h):[],operationalElevationLayers:l,basemapElevationLayers:e}};b.prototype._loadFromJSON=function(a,c){var e=this,h=new g;return this._validateSpatialReference().then(function(){return e._validateHeightModelInfo()}).then(function(){return z.create(function(a){return q(["./portal/support/layersCreator"],a)})}).then(function(g){var f=e._extractOperationalLayers(a),r=f.operationalLayers,m=f.operationalElevationLayers,f=f.basemapElevationLayers,b=[],u={context:d({},c,{layerContainerType:"operational-layers"})};
e.portalItem&&(u.context.portal=e.portalItem.portal||M.getDefault());if(0<f.length){var p=d({},u,{context:d({},u.context,{layerContainerType:"ground"})});p.defaultLayerType="ArcGISTiledElevationServiceLayer";b.push(l.safeCast(g.populateOperationalLayers(e.ground.layers,f,p)))}0<m.length&&(p=d({},u,{context:d({},u.context,{layerContainerType:"ground"})}),p.defaultLayerType="ArcGISTiledElevationServiceLayer",b.push(l.safeCast(g.populateOperationalLayers(h,m,p))));r&&0<r.length&&b.push(l.safeCast(g.populateOperationalLayers(e.layers,
r,u)));return z.eachAlways(b).then(function(){})}).then(function(){return e._loadObjectsWithLayers()}).then(function(){e.ground.layers.addMany(h)})};b.prototype._loadObjectsWithLayers=function(){var a=[];this.ground&&a.push(this.ground.load());this.basemap&&a.push(this.basemap.load());this.presentation.slides.forEach(function(c){c.basemap&&a.push(c.basemap.load())});return z.eachAlways(a).then(function(){})};b.prototype._loadFromItem=function(a){var c=this;return a.load().catch(function(a){throw new e("webscene:load-portal-item",
"Failed to load portal item",{error:a});}).then(function(){if("Web Scene"!==a.type)throw new e("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:a.type});}).then(function(){return a.fetchData()}).then(function(e){c.resourceInfo=e;return c._readAndLoadFromJSON(e,{origin:"web-scene",url:A.urlToObject(a.itemUrl),portal:a.portal||M.getDefault()})})};b.prototype._validateSpatialReference=function(){var a=this.initialViewProperties,c=this._sceneSpatialReference,
d;if("local"!==a.viewingMode){if(!c.isWGS84&&!c.isWebMercator)return z.reject(new e("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator or WGS84 GCS are supported",{spatialReference:c,viewingMode:a.viewingMode}));d=function(a){return!a||a.isWGS84||a.isWebMercator}}else{if(c.isGeographic)return z.reject(new e("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",
{spatialReference:c,viewingMode:a.viewingMode}));d=function(a){return!a||a.equals(c)}}var g=function(a){return a&&(a.camera&&a.camera.position&&a.camera.position.spatialReference||a.targetGeometry&&a.targetGeometry.spatialReference)},l=g(a.viewpoint);return l&&!d(l)?z.reject(new e("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:l,sceneSpatialReference:c,
viewingMode:a.viewingMode})):(l=this.presentation.slides.find(function(a){return!d(g(a.viewpoint))}))?(l=g(l.viewpoint),z.reject(new e("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{slideSpatialReference:l,sceneSpatialReference:c,viewingMode:a.viewingMode}))):z.resolve()};b.prototype._validateHeightModelInfo=function(){var a=G.validateWebSceneError(this.heightModelInfo,
this._sceneSpatialReference);return a?z.reject(a):z.resolve()};b.prototype._validateJSON=function(a,c){void 0===c&&(c=null);c=J.default.parse(a.version||"","webscene");Q.validate(c);a.version=c.major+"."+c.minor;1===c.major&&2>=c.minor&&(a.spatialReference=D.WebMercator.toJSON());return a};b.prototype._updateTypeKeywords=function(a){"local"===this.initialViewProperties.viewingMode?a.typeKeywords?-1===a.typeKeywords.indexOf("ViewingMode-Local")&&a.typeKeywords.push("ViewingMode-Local"):a.typeKeywords=
["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a){return"ViewingMode-Local"!==a}));a.typeKeywords&&(a.typeKeywords=a.typeKeywords.filter(function(a,c,e){return e.indexOf(a)===c}))};Object.defineProperty(b.prototype,"_sceneSpatialReference",{get:function(){return this.initialViewProperties.spatialReference||D.WebMercator},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"_verifyItemRelativeRootPath",
{get:function(){return this.portalItem&&this.portalItem.itemUrl?A.urlToObject(this.portalItem.itemUrl).path:null},enumerable:!0,configurable:!0});b.prototype._enableVerifyItemRelativeUrls=function(a){var c=this._verifyItemRelativeRootPath;c&&(a.verifyItemRelativeUrls={rootPath:c,writtenUrls:[]});return a};b.prototype._unscheduleLayersIdGC=function(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)};b.prototype._scheduleLayersIdGC=function(){var a=this;
this._unscheduleLayersIdGC();this._layersIdGCTimeoutId=setTimeout(function(){a._layersIdGCTimeoutId=0;a._runLayersIdGC()},3E3)};b.prototype._runLayersIdGC=function(){var a=this;this._unscheduleLayersIdGC();var c=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search,e=function(c){return!!a.allLayers.find(function(a){return a.id===c})};c&&c.layers&&(c.layers=c.layers.filter(function(a){return e(a.id)}));(c=this.presentation&&this.presentation.slides)&&
c.forEach(function(a){a.visibleLayers&&(a.visibleLayers=a.visibleLayers.filter(function(a){return e(a.id)}))})};b.fromJSON=function(a){if(!a)throw new e("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:a})};b.VERSION=Q;f([B.property({type:P,json:{write:!0}})],b.prototype,"applicationProperties",void 0);f([B.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],b.prototype,"basemap",void 0);f([B.property({type:F,json:{read:{source:"clippingArea.geometry",
reader:K.fromJSON},write:{target:"clippingArea.geometry"}}})],b.prototype,"clippingArea",void 0);f([B.writer("clippingArea")],b.prototype,"writeClippingArea",null);f([B.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],b.prototype,"clippingEnabled",void 0);f([B.reader("clippingEnabled",["clippingArea"])],b.prototype,"readClippingEnabled",null);f([B.writer("clippingEnabled")],b.prototype,"writeClippingEnabled",null);f([B.property({type:H,json:{write:!0}})],b.prototype,"heightModelInfo",
void 0);f([B.property({json:{write:{target:"operationalLayers"}}})],b.prototype,"layers",void 0);f([B.writer("layers")],b.prototype,"writeLayers",null);f([B.property({readOnly:!0,type:J.default,json:{type:String,write:{allowNull:!0,target:"version",isRequired:!0}}})],b.prototype,"sourceVersion",void 0);f([B.reader("sourceVersion",["version"])],b.prototype,"readSourceVersion",null);f([B.writer("sourceVersion")],b.prototype,"writeSourceVersion",null);f([B.property({dependsOn:["portalItem.thumbnailUrl"]})],
b.prototype,"thumbnailUrl",null);f([B.property({type:String,json:{write:{allowNull:!0}}})],b.prototype,"authoringApp",null);f([B.writer("authoringApp")],b.prototype,"writeAuthoringApp",null);f([B.property({type:String,json:{write:{allowNull:!0}}})],b.prototype,"authoringAppVersion",null);f([B.writer("authoringAppVersion")],b.prototype,"writeAuthoringAppVersion",null);f([B.property({json:{write:{isRequired:!0,allowNull:!0,enabled:!0}}})],b.prototype,"ground",void 0);f([B.writer("ground")],b.prototype,
"writeGround",null);f([B.property({type:R,nonNullable:!0,json:{write:function(a,c,e,g){a.slides&&0<a.slides.length&&(e=d({},g,{isPresentation:!0}),c.presentation=a.write(null,e))}}})],b.prototype,"presentation",void 0);f([B.property({type:T,nonNullable:!0,json:{default:function(){return new T({viewingMode:"global",spatialReference:D.WebMercator})}}})],b.prototype,"initialViewProperties",void 0);f([B.reader("initialViewProperties",["initialState.environment","spatialReference","viewingMode","initialState.viewpoint"])],
b.prototype,"readInitialViewProperties",null);f([B.writer("initialViewProperties",{"initialState.environment":{type:L},spatialReference:{type:D},viewingMode:{type:String},"initialState.viewpoint":{type:a}})],b.prototype,"writeInitialViewProperties",null);f([B.property({type:O})],b.prototype,"portalItem",void 0);f([B.property()],b.prototype,"resourceInfo",void 0);f([k(0,B.cast(O))],b.prototype,"saveAs",null);f([B.property()],b.prototype,"_sceneSpatialReference",null);f([B.property()],b.prototype,"_verifyItemRelativeRootPath",
null);return b=f([B.subclass("esri.WebScene")],b)}(B.declared(c,w,r))})},"esri/core/accessorSupport/originUtils":function(){define(["require","exports","../MultiOriginJSONSupport"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.updateOrigins=function(f){f&&f.writtenProperties&&f.writtenProperties.forEach(function(f){var d=f.target;f.newOrigin&&f.oldOrigin!==f.newOrigin&&d.isInstanceOf(n)&&d.updateOrigin(f.propName,f.newOrigin)})}})},"esri/support/webSceneUtils":function(){define(["require",
"exports","../core/Error"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.createCopyError=function(){return new n("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")};b.isCopyError=function(f){return f&&"webscene:failed-to-copy-embedded-resources"===f.name};b.createSchemaValidationError=function(f){return new n("webscene:schema-validation","Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",
{errors:f})};b.isSchemaValidationError=function(f){return f&&"webscene:schema-validation"===f.name}})},"esri/webscene/ApplicationProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators ./applicationProperties/Viewing".split(" "),function(q,b,n,f,k,d,h){return function(m){function b(a){a=m.call(this,a)||this;a.viewing=null;return a}n(b,m);c=b;b.prototype.clone=function(){return new c({viewing:this.viewing?
this.viewing.clone():null})};var c;f([d.property({type:h,json:{write:!0}})],b.prototype,"viewing",void 0);return b=c=f([d.subclass("esri.webscene.ApplicationProperties")],b)}(d.declared(k))})},"esri/webscene/applicationProperties/Viewing":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ./Search".split(" "),function(q,b,n,f,k,d,h){return function(m){function b(a){a=m.call(this,
a)||this;a.search=null;return a}n(b,m);c=b;b.prototype.clone=function(){return new c({search:this.search?this.search.clone():null})};var c;f([d.property({type:h,json:{write:!0}})],b.prototype,"search",void 0);return b=c=f([d.subclass("esri.webscene.applicationProperties.Viewing")],b)}(d.declared(k))})},"esri/webscene/applicationProperties/Search":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Collection ../../core/JSONSupport ../../core/accessorSupport/decorators ./SearchLayer".split(" "),
function(q,b,n,f,k,d,h,m){var p=k.ofType(m);return function(c){function a(a){a=c.call(this,a)||this;a.enabled=!0;a.hintText=null;a.layers=new p;return a}n(a,c);d=a;a.prototype.clone=function(){return new d({enabled:this.enabled,hintText:this.hintText,layers:this.layers?this.layers.clone():null})};var d;f([h.property({type:Boolean,json:{write:!0,default:!0}})],a.prototype,"enabled",void 0);f([h.property({type:String,json:{write:!0}})],a.prototype,"hintText",void 0);f([h.property({type:p,json:{write:{enabled:!0,
isRequired:!0}}})],a.prototype,"layers",void 0);return a=d=f([h.subclass("esri.webscene.applicationProperties.Search")],a)}(h.declared(d))})},"esri/webscene/applicationProperties/SearchLayer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./SearchLayerField".split(" "),function(q,b,n,f,k,d,h,m){return function(b){function c(a){a=b.call(this,
a)||this;a.field=null;a.id=null;a.subLayer=null;return a}n(c,b);a=c;c.prototype.clone=function(){return new a({field:this.field?this.field.clone():null,id:this.id,subLayer:this.subLayer})};var a;f([d.property({type:m,json:{write:{enabled:!0,isRequired:!0}}})],c.prototype,"field",void 0);f([d.property({type:String,json:{write:{enabled:!0,isRequired:!0}}})],c.prototype,"id",void 0);f([d.property({type:h.Integer,json:{write:!0}})],c.prototype,"subLayer",void 0);return c=a=f([d.subclass("esri.webscene.applicationProperties.SearchLayer")],
c)}(d.declared(k))})},"esri/webscene/applicationProperties/SearchLayerField":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators ../../layers/support/fieldType".split(" "),function(q,b,n,f,k,d,h){return function(b){function m(a){a=b.call(this,a)||this;a.exactMatch=!1;a.name=null;a.type=null;return a}n(m,b);c=m;m.prototype.clone=function(){return new c({exactMatch:this.exactMatch,
type:this.type,name:this.name})};var c;f([d.property({type:Boolean,json:{write:!0}})],m.prototype,"exactMatch",void 0);f([d.property({type:String,json:{write:!0}})],m.prototype,"name",void 0);f([d.enumeration.serializable()(h.kebabDict)],m.prototype,"type",void 0);return m=c=f([d.subclass("esri.webscene.applicationProperties.SearchLayerField")],m)}(d.declared(k))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),
function(q,b,n,f,k,d,h,m,p){var c=function(a,c,d){return{enabled:!d||!d.isPresentation}};return function(a){function l(c){c=a.call(this,c)||this;c.lighting=new m;c.background=null;c.atmosphereEnabled=!0;c.starsEnabled=!0;return c}n(l,a);g=l;l.prototype.clone=function(){return new g(this.cloneConstructProperties())};l.prototype.cloneConstructProperties=function(){return{lighting:m.prototype.clone.call(this.lighting),background:d.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};
var g;f([h.property({type:m,json:{write:!0}})],l.prototype,"lighting",void 0);f([h.property(p.backgroundProperty)],l.prototype,"background",void 0);f([h.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:c}}})],l.prototype,"atmosphereEnabled",void 0);f([h.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:c}}})],l.prototype,"starsEnabled",void 0);return l=g=f([h.subclass("esri.webscene.Environment")],l)}(h.declared(k))})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),
function(q,b,n,f,k,d){return function(h){function b(c){c=h.call(this,c)||this;c.date=null;c.directShadowsEnabled=!1;c.displayUTCOffset=null;return c}n(b,h);p=b;b.prototype.readDate=function(c,a){return null!=a.datetime&&new Date(a.datetime)||null};b.prototype.writeDate=function(c,a,d){a[d]=c.getTime()};b.prototype.readDirectShadowsEnabled=function(c,a){return!!a.directShadows};b.prototype.writedirectShadowsEnabled=function(c,a,d){c&&(a[d]=c)};b.prototype.writeDisplayUTCOffset=function(c,a){null!=
c&&(a.displayUTCOffset=c)};b.prototype.clone=function(){return new p(this.cloneConstructProperties())};b.prototype.cloneConstructProperties=function(){var c={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(c.date=new Date(this.date.getTime()));return c};var p;f([d.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],b.prototype,"date",void 0);f([d.reader("date",["datetime"])],b.prototype,"readDate",
null);f([d.writer("date")],b.prototype,"writeDate",null);f([d.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],b.prototype,"directShadowsEnabled",void 0);f([d.reader("directShadowsEnabled",["directShadows"])],b.prototype,"readDirectShadowsEnabled",null);f([d.writer("directShadowsEnabled")],b.prototype,"writedirectShadowsEnabled",null);f([d.property({type:Number,json:{write:!0}})],b.prototype,"displayUTCOffset",void 0);f([d.writer("displayUTCOffset")],b.prototype,"writeDisplayUTCOffset",
null);return b=p=f([d.subclass("esri.webscene.Lighting")],b)}(d.declared(k))})},"esri/webscene/background/utils":function(){define(["require","exports","./Background","./ColorBackground"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});q={base:n,key:"type",typeMap:{color:f}};b.backgroundProperty={types:q,json:{read:function(f){return function(d,h,b){if(!d)return d;for(var m in f.typeMap)if(d.type===m)return h=new f.typeMap[m],h.read(d,b),h}}(q),write:{overridePolicy:function(f,
d,h){return{enabled:!h||!h.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/JSONSupport ../../core/kebabDictionary ../../core/accessorSupport/decorators".split(" "),function(q,b,n,f,k,d,h,m){var p=h.strict()({color:"color"});return function(c){function a(a){return c.call(this)||this}n(a,c);a.prototype.normalizeCtorArgs=function(a){a&&
a.type&&(a=k({},a),delete a.type);return a};a.prototype.clone=function(){};f([m.property({type:p.apiValues,readOnly:!0,json:{type:p.jsonValues,read:!1,write:p.write}})],a.prototype,"type",void 0);return a=f([m.subclass("esri.webscene.background.Background")],a)}(m.declared(d))})},"esri/webscene/background/ColorBackground":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(q,b,n,f,k,d,h,m,p){var c=k({},m.colorAndTransparencyProperty,{nonNullable:!0});return function(a){function l(c){c=a.call(this)||this;c.type="color";c.color=new d([0,0,0,1]);return c}n(l,a);g=l;l.prototype.clone=function(){return new g(this.cloneProperties())};l.prototype.cloneProperties=function(){return{color:this.color.clone()}};var g;f([h.enumeration.serializable()({color:"color"})],l.prototype,"type",void 0);f([h.property(c)],l.prototype,"color",void 0);return l=g=f([h.subclass("esri.webscene.background.ColorBackground")],
l)}(h.declared(p))})},"esri/webscene/InitialViewProperties":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Viewpoint ../core/Accessor ../core/accessorSupport/decorators ../geometry/SpatialReference ./Environment".split(" "),function(q,b,n,f,k,d,h,m,p){return function(c){function a(a){a=c.call(this,a)||this;a.environment=new p;a.spatialReference=null;a.viewpoint=null;return a}n(a,c);d=a;Object.defineProperty(a.prototype,"viewingMode",{set:function(a){this._set("viewingMode",
a)},enumerable:!0,configurable:!0});a.prototype.clone=function(){return new d({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})};var d;f([h.property({type:p,json:{write:{isRequired:!0}}})],a.prototype,"environment",void 0);f([h.property({type:m})],a.prototype,"spatialReference",void 0);f([h.property({type:["local","global"]})],a.prototype,"viewingMode",
null);f([h.property({type:k,json:{write:{isRequired:!0}}})],a.prototype,"viewpoint",void 0);return a=d=f([h.subclass("esri.webscene.InitialViewProperties")],a)}(h.declared(d))})},"esri/webscene/Presentation":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/accessorSupport/decorators ./Slide".split(" "),function(q,b,n,f,k,d,h,m,p){var c=k.ofType(p);return function(a){function l(d){d=
a.call(this,d)||this;d.slides=new c;return d}n(l,a);Object.defineProperty(l.prototype,"slides",{set:function(a){a&&(a=a.filter(function(a){return!!a.viewpoint}));this._set("slides",d.referenceSetter(a,this._get("slides"),c))},enumerable:!0,configurable:!0});l.prototype.clone=function(){return new this.constructor({slides:this.slides.clone()})};f([m.property({type:c,nonNullable:!0,json:{write:!0}}),m.cast(d.castForReferenceSetter)],l.prototype,"slides",null);return l=f([m.subclass("esri.webscene.Presentation")],
l)}(m.declared(h))})},"esri/webscene/Slide":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../Basemap ../Viewpoint ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/lang ../core/Logger ../core/promiseUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3 ../core/libs/gl-matrix-2/vec3f64 ../layers/Layer ../support/basemapUtils ../views/3d/support/mathUtils ../webdoc/support/Thumbnail ./Environment ./Lighting ./support/Description ./support/SlideGround ./support/Title".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C,E){function F(a){if("building-scene"===a.type||"map-image"===a.type)return a.allSublayers}function H(a){if(a=F(a))return a.filter(function(a){return a.visible}).map(function(a){return a.id}).toArray()}function D(a,c){a=c-a;a>P&&(a-=N);a<-P&&(a+=N);return a}var G=0,K=function(c){function d(a){a=c.call(this)||this;a.id="";a.sublayerIds=null;return a}f(d,c);g=d;d.prototype.clone=function(){return new g({id:this.id,sublayerIds:a.clone(this.sublayerIds)})};
var g;k([e.property({type:String,json:{write:!0}})],d.prototype,"id",void 0);k([e.property({type:[Number],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],d.prototype,"sublayerIds",void 0);return d=g=k([e.subclass("esri.webscene.VisibleLayer")],d)}(e.declared(c)),M=m.ofType(K),O=l.getLogger("esri.webscene.Slide"),N=86400,P=43200;return function(a){function c(c){c=a.call(this,c)||this;c._currentAnimation=null;c.id=Date.now().toString(16)+"-slide-"+G++;c.title=new E.default;c.description=
new B.default;c.thumbnail=new v.default;c.viewpoint=null;c.basemap=null;c.ground=null;c.environment=new z;c.visibleLayers=new M;return c}f(c,a);c.prototype.castTitle=function(a){return"string"===typeof a?new E.default({text:a}):u.ensureType(E.default,a)};c.prototype.castDescription=function(a){return"string"===typeof a?new B.default({text:a}):u.ensureType(B.default,a)};c.prototype.castThumbnail=function(a){return"string"===typeof a?new v.default({url:a}):u.ensureType(v.default,a)};c.prototype.castBasemap=
function(a){return w.ensureType(a)};Object.defineProperty(c.prototype,"visibleLayers",{set:function(a){this._set("visibleLayers",p.referenceSetter(a,this._get("visibleLayers"),M))},enumerable:!0,configurable:!0});c.prototype.castVisibleLayers=function(a){return a&&"function"===typeof a.map?a.map(function(a){if("string"===typeof a)return{id:a};if(a instanceof y){var c=H(a);return{id:a.id,sublayerIds:c}}if(a.id)return{id:a.id,sublayerIds:a.sublayerIds};O.warn('Invalid visible layer, expected { id }, Layer or "id"');
return a}):null};c.prototype.clone=function(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null})};c.prototype._updateVisibleLayersFrom=function(a){var c=
this,e=[];return g.eachAlways(this._allLayers(a.map).map(function(c){return a.whenLayerView(c).then(function(a){if(a.visible){var d=H(c);e.push(new K({id:a.layer.id,sublayerIds:d}))}})}).toArray()).then(function(){c.visibleLayers.removeAll();c.visibleLayers.addMany(e)})};c.prototype.updateFrom=function(a,c){var e=this;c={screenshot:n({format:"jpeg",quality:80,width:120,height:75,disableSlice:!0},c&&c.screenshot)};return a.when(function(){e.viewpoint=a.viewpoint.clone();e.environment.lighting=A.prototype.clone.apply(a.environment.lighting);
e.basemap=a.map.basemap&&a.map.basemap.clone()||null;e.ground=a.map.ground?C.default.fromGround(a.map.ground):null;return e._updateVisibleLayersFrom(a)}).then(function(){return a.takeScreenshot(c.screenshot)}).then(function(a){e.thumbnail=new v.default({url:a.dataUrl});return e})};c.prototype.applyTo=function(a,c){var e=this,d=n({animate:!0},c);return this._applyBasemap(a).then(function(){return g.all([e._applyViewpoint(a,d),e._applyLayerVisibility(a),e._applyGround(a)])}).then(function(){return e})};
c.prototype._applyBasemap=function(a){var c=this;return this.basemap?this.basemap.load().catch(function(a){return a}).then(function(){a.map.basemap=w.clonePreservingTiledLayers(c.basemap,a.map.basemap)}):g.resolve()};c.prototype._applyGround=function(a){this.ground&&(a.map.ground=this.ground.cloneAndApplyTo(a.map.ground));return g.resolve()};c.prototype._allLayers=function(a){var c=new m;this._collectLayers(a,c);this._collectLayers(a.ground,c);return c};c.prototype._collectLayers=function(a,c){var e=
this;a.layers.forEach(function(a){c.add(a);a.layers&&e._collectLayers(a,c)})};c.prototype._applyLayerVisibility=function(a){var c=this;this.visibleLayers&&this._allLayers(a.map).forEach(function(a){var e=c.visibleLayers.find(function(c){return c.id===a.id});a.visible=null!=e;var d=e&&e.sublayerIds,e=F(a);d&&e&&e.forEach(function(a){return a.visible=0<=d.indexOf(a.id)})})};c.prototype._applyViewpoint=function(a,c){if(this.viewpoint&&!c.ignoreViewpoint){this.viewpoint.camera.fov=a.camera.fov;if(c.animate){if(this.get("environment.lighting.date"))return this._animateToLighting(a,
c);a.environment.lighting=this.environment.lighting.clone();return a.goTo(this.viewpoint,c)}a.viewpoint=this.viewpoint}a.environment.lighting=this.environment.lighting.clone();return g.resolve()};c.prototype._animateToLighting=function(a,c){var e=this,d;"global"===a.viewingMode&&(d=this._animateLightingWithCamera(a));this._currentAnimation&&(this._currentAnimation.cancel(),this._currentAnimation=null);a.environment.lighting.cameraTrackingEnabled=!1;a.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled;
null!=this.environment.lighting.displayUTCOffset&&(a.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);var g=a.goTo(this.viewpoint,c);this._currentAnimation=g;this._currentAnimation.catch(function(a){return a}).then(function(){d&&d.remove();e._currentAnimation===g&&(a.environment.lighting.cameraTrackingEnabled=!0)});this._currentAnimation.then(function(){a.environment.lighting=e.environment.lighting.clone()});return this._currentAnimation};c.prototype._getTime=function(a){var c=
a.getTime();a=3600*a.getUTCHours()+60*a.getUTCMinutes()+a.getUTCSeconds();return[c,a]};c.prototype._setTime=function(a,c,e){a.setTime(c);a.setUTCHours(e/3600);a.setUTCMinutes(e%3600/60);a.setUTCSeconds(e%3600%60);return a};c.prototype._animateLightingWithCamera=function(a){var c=this,e=this._getTime(new Date(a.environment.lighting.date.toString())),d=e[0],g=e[1],e=this._getTime(this.environment.lighting.date),l=e[0],h=D(g,e[1]),f=a.renderCoordsHelper,b=r.vec3f64.create();f.toRenderCoords(a.camera.position,
b);var m=r.vec3f64.create();f.toRenderCoords(this.viewpoint.camera.position,m);var u=r.vec3f64.create(),p=new Date;return a.watch("camera",function(e){f.toRenderCoords(e.position,u);var r=t.vec3.squaredDistance(b,u),k=t.vec3.squaredDistance(m,u);e=0;0!==r+k&&(e=r/(r+k));r=d+(l-d)*e;e=x.moduloPositive(g+h*e,N);a.environment.lighting.date=c._setTime(p,r,e)})};c.createFrom=function(a,c){return(new this).updateFrom(a,c)};k([e.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"id",void 0);
k([e.property({type:E.default,json:{default:function(){return new E.default({text:""})},write:{isRequired:!0}}})],c.prototype,"title",void 0);k([e.cast("title")],c.prototype,"castTitle",null);k([e.property({type:B.default,json:{write:{overridePolicy:function(a){return{enabled:!(!a||!a.text)}}}}})],c.prototype,"description",void 0);k([e.cast("description")],c.prototype,"castDescription",null);k([e.property({type:v.default,json:{default:function(){return new v.default({url:""})},write:{isRequired:!0}}})],
c.prototype,"thumbnail",void 0);k([e.cast("thumbnail")],c.prototype,"castThumbnail",null);k([e.property({type:h,nonNullable:!0,json:{write:{isRequired:!0}}})],c.prototype,"viewpoint",void 0);k([e.property({type:d,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],c.prototype,"basemap",void 0);k([e.cast("basemap")],c.prototype,"castBasemap",null);k([e.property({type:C.default,json:{write:!0}})],c.prototype,"ground",void 0);k([e.property({type:M,json:{write:{isRequired:!0}}})],c.prototype,"visibleLayers",
null);k([e.cast("visibleLayers")],c.prototype,"castVisibleLayers",null);k([e.property({type:z,json:{write:!0}})],c.prototype,"environment",void 0);return c=k([e.subclass("esri.webscene.Slide")],c)}(e.declared(c))})},"esri/webdoc/support/Thumbnail":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,b,n,f,k,d){Object.defineProperty(b,"__esModule",{value:!0});
q=function(h){function b(){var c=null!==h&&h.apply(this,arguments)||this;c.url="";return c}n(b,h);p=b;b.prototype.clone=function(){return new p({url:this.url})};var p;f([d.property({type:String,json:{write:{isRequired:!0}}})],b.prototype,"url",void 0);return b=p=f([d.subclass("esri.webdoc.support.Thumbnail")],b)}(d.declared(k));b.default=q})},"esri/webscene/support/Description":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(q,b,n,f,k,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(h){function b(){var c=null!==h&&h.apply(this,arguments)||this;c.text="";return c}n(b,h);p=b;b.prototype.clone=function(){return new p({text:this.text})};var p;f([d.property({type:String,json:{write:!0}})],b.prototype,"text",void 0);return b=p=f([d.subclass("esri.webscene.support.Description")],b)}(d.declared(k));b.default=q})},"esri/webscene/support/SlideGround":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Ground ../../core/JSONSupport ../../core/accessorSupport/decorators ../../webdoc/support/opacityUtils".split(" "),
function(q,b,n,f,k,d,h,m){Object.defineProperty(b,"__esModule",{value:!0});q=function(d){function c(){var a=null!==d&&d.apply(this,arguments)||this;a.opacity=null;return a}n(c,d);a=c;c.prototype.clone=function(){return new a({opacity:this.opacity})};c.prototype.cloneAndApplyTo=function(a){if(null==this.opacity)return a;a=null!=a?a.clone():new k;a.opacity=this.opacity;return a};c.fromGround=function(c){return new a({opacity:c.opacity})};var a;f([h.property({type:Number,json:{read:{reader:m.transparencyToOpacity,
source:"transparency"},write:{writer:function(a,c){c.transparency=m.opacityToTransparency(a)},target:"transparency"}}})],c.prototype,"opacity",void 0);return c=a=f([h.subclass("esri.webscene.support.SlideGround")],c)}(h.declared(d));b.default=q})},"esri/webscene/support/Title":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(q,b,n,f,k,d){Object.defineProperty(b,
"__esModule",{value:!0});q=function(h){function b(){var c=null!==h&&h.apply(this,arguments)||this;c.text="";return c}n(b,h);p=b;b.prototype.clone=function(){return new p({text:this.text})};var p;f([d.property({type:String,json:{write:{isRequired:!0}}})],b.prototype,"text",void 0);return b=p=f([d.subclass("esri.webscene.support.Title")],b)}(d.declared(k));b.default=q})},"esri/webscene/Version":function(){define(["require","exports","../core/tsSupport/extendsHelper","../core/Version"],function(q,b,
n,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(f){function d(d,b){return f.call(this,d,b,"webscene")||this}n(d,f);Object.defineProperty(d.prototype,"supportsGround",{get:function(){return this.since(1,8)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"supportsVisibleElevationLayersInSlides",{get:function(){return this.lessThan(1,8)},enumerable:!0,configurable:!0});return d}(f.Version);b.Version=q;b.default=q})},"esri/core/Version":function(){define(["require",
"exports","./Error"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function f(f,d,h){void 0===h&&(h="");this.major=f;this.minor=d;this._context=h}f.prototype.lessThan=function(f,d){return this.major<f||f===this.major&&this.minor<d};f.prototype.since=function(f,d){return!this.lessThan(f,d)};f.prototype.validate=function(f){if(this.major!==f.major)throw new n((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+
"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:f});};f.prototype.clone=function(){return new f(this.major,this.minor,this._context)};f.parse=function(b,d){void 0===d&&(d="");var h=b.split("."),m=h[0],h=h[1],p=/^\s*\d+\s*$/;if(!m||!m.match||!m.match(p))throw new n((d&&d+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:b});if(!h||!h.match||!h.match(p))throw new n((d&&d+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",
{version:b});b=parseInt(m,10);m=parseInt(h,10);return new f(b,m,d)};return f}();b.Version=q})},"esri/views/SceneView":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper ../core/tsSupport/assignHelper dojo/dom ../Camera ../geometry ../Graphic ../Ground ../Viewpoint ../core/asyncUtils ../core/Collection ../core/Error ../core/Handles ../core/has ../core/Logger ../core/maybe ../core/promiseUtils ../core/scheduling ../core/watchUtils ./../core/screenUtils ../core/accessorSupport/decorators ../core/accessorSupport/ensureType ../core/libs/gl-matrix-2/vec3f64 ../geometry/HeightModelInfo ../geometry/support/aaBoundingRect ../geometry/support/scaleUtils ../geometry/support/webMercatorUtils ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/Deconflictor ./3d/layers/graphics/Labeler ./3d/layers/support/FeatureTileTree3D ./3d/layers/support/FeatureTileTree3DDebugger ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/geometryUtils ./3d/support/HighlightOptions ./3d/support/index ./3d/support/MapCoordsHelper ./3d/support/projectionUtils ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/SharedSymbolResources ./3d/support/geometryUtils/boundedPlane ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/intersectorUtils ./support/screenshotUtils ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C,E,F,H,D,G,K,M,O,N,P,L,T,R,J,U,Q,I,V,X,W,ca,da,ba,aa,S,Z,Y,ea,ga,ja,fa,ha,ka,ia,ma,na,pa,sa,ta,wa,ua,qa,xa,ya,va,za){function ra(a,c){a.layerUids||(a.layerUids=new Set);a.layerUids.add(c)}function Aa(a,c){a.graphicUids||(a.graphicUids=new Set);a.graphicUids.add(c)}var la=w.getLogger("esri.views.SceneView");b=function(h){function b(a){var c=h.call(this)||this;c._clippingArea=null;c._internallyReady=!1;c._userClippingArea=null;c._initialDefaultSpatialReference=
null;c._defaults={};c._externallySet={environment:!1};c._handles=new r;c._createGraphicsViewPromise=null;c._updateDrawingOrderHandle=null;c._stageFrameTask=null;c.onViewExtentUpdateHandle=null;c._resolveWhenReady=[];c.propertiesPool=new ha.default({slicePlane:na.BoundedPlaneClass},c);c._resourceController=ga.newResourceController(c);c._defaultToMapOptions={include:new Set};c._defaultHitTestOptions={exclude:new Set};c.deconflictor=new I.Deconflictor(c);c.labeler=new V.Labeler({view:c});c.renderSpatialReference=
null;c.sharedSymbolResources=null;c.basemapTerrain=null;c.elevationProvider=null;c.camera=null;c.canvas=null;c.center=null;c.constraints=new R.default;c.extent=null;c.fullOpacity=1;c.graphicsView=null;c.groundView=null;c.map=null;c.screenSizePerspectiveEnabled=!0;c.state=null;c.scale=null;c.spatialReference=null;c.isHeightModelInfoRequired=!0;c.alphaCompositingEnabled=!1;c.type="3d";c.ui=new va;c.updating=!1;c.updatingPercentage=0;c.viewpoint=null;c.zoom=null;c.highlightOptions=new ea;a&&a.environment||
(c._defaults.environment=new J,c.environment=c._defaults.environment);a=function(){return c.notifyChange("dataExtent")};c._handles.add([A.when(c,"ready",function(a,e){return c._viewReadyHandler(e)}),A.on(c,"allLayers","change",a,a,a,!0),c.allLayerViews.on("change",function(a){return c._updateUpdatingMonitors(a)}),c.watch("map",function(a){a&&a.load&&a.load()})]);c.inputManager=new Q({view:c});c.stateManager=new da.ViewStateManager({view:c,updateDevicePixelRatio:function(){return c.notifyChange("pixelRatio")}});
return c}n(b,h);b.prototype.initialize=function(){var a=this;this.groundView=new N({view:this});this.environmentManager=new U.default({view:this});this._updateUpdatingMonitors({added:this.allLayerViews.toArray(),removed:[]});this._handles.add([this.resourceController.memoryController.events.on("updating-changed",function(){return a._evaluateUpdating()}),A.whenNot(this,"ready",function(c,e){return a._viewUnreadyHandler(e)}),A.init(this.qualitySettings,"memoryLimit",function(c){a.resourceController&&
(a.resourceController.memoryController.maxMemory=c)}),A.init(this.qualitySettings,"additionalCacheMemory",function(c){a.resourceController&&(a.resourceController.memoryController.additionalCacheMemory=c)}),A.init(this.qualitySettings,"frameRate",function(a){return z.setFrameDuration(0<a?1E3/Math.ceil(a):0)}),A.init(S,"SCENEVIEW_LOCKING_LOG",function(c){return a.defaultsFromMap.logDebugInformation=c}),A.on(this,"map.allLayers","after-changes",function(){return a._updateDefaultToMapOptions()},function(){return a._updateDefaultToMapOptions()},
function(){return a._updateDefaultToMapOptions()}),A.init(this,"map.ground",function(){return a._updateDefaultToMapOptions()},!0),A.init(this,"map.ground.opacity",function(){return a._updateDefaultHitTestOptions()},!0)])};b.prototype.destroy=function(){this.activeTool=null;this.layerViewManager.clear();this.stateManager.deinit();this.groundView.destroy();this.groundView=null;this.destroyViewData();this._disposeSurface();this._disposeGraphicsView();this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),
this.sharedSymbolResources=null);this._stage&&(this._stage.dispose(),this._stage=null,this._handles.remove("stage"));this._set("canvas",null);this.labeler.destroy();this.labeler=null;this.deconflictor.destroy();this.deconflictor=null;this._resourceController.destroy();this._resourceController=null;this.environmentManager.destroy();this._set("environmentManager",null);this.stateManager.destroy();this._set("stateManager",null);this.inputManager.destroy();this._set("inputManager",null);this._handles.destroy();
this.propertiesPool.destroy();this.propertiesPool=null};Object.defineProperty(b.prototype,"clippingArea",{get:function(){if("global"===this.viewingMode)return null;if(this._userClippingArea)return this._userClippingArea;var a=this.get("map.clippingEnabled"),e=this.get("map.clippingArea");if(!a||!e)return this._clippingArea=null;if(!(e instanceof c.Extent))return la.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(!K.canProject(e.spatialReference,
this.spatialReference))return la.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;e=K.project(e,this.spatialReference);return this._clippingArea&&e&&this._clippingArea.equals(e)?this._clippingArea:this._clippingArea=e},set:function(a){this.ready&&"global"===this.viewingMode&&a?la.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=a,this.notifyChange("clippingArea"))},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"dataExtent",{get:function(){var a=[],e=this.spatialReference||c.SpatialReference.WGS84,d=this.clippingArea;d&&(d=K.project(d,e));var g=function(c){c&&(c=K.project(c,e))&&(d&&(c=c.intersection(d)),c&&a.push(c))},l=this._get("basemapTerrain");l&&l.spatialReference&&g(new c.Extent({xmin:l.extent[0],ymin:l.extent[1],zmin:0,xmax:l.extent[2],ymax:l.extent[3],zmax:0,spatialReference:l.spatialReference}));this.map&&this.map.allLayers.forEach(function(a){g(a.fullExtent)});
return 0<a.length?(l=a.reduce(function(a,c){return a.union(c)}),l.hasZ?(l.zmin=Math.min(0,l.zmin),l.zmax=Math.max(0,l.zmax)):(l.zmin=0,l.zmax=0),l):new c.Extent({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:e})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"environment",{set:function(a){a!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",a)},enumerable:!0,configurable:!0});b.prototype.castEnvironment=function(a){return a?
a instanceof J?a:a instanceof za?J.fromWebsceneEnvironment(a):E.ensureType(J,a):new J};Object.defineProperty(b.prototype,"pixelRatio",{get:function(){return Math.min(window.devicePixelRatio,this.maximumPixelRatio)},set:function(a){x.isSome(a)?this._override("pixelRatio",a):this._clearOverride("pixelRatio")},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maximumPixelRatio",{get:function(){var a=Infinity,c=this.qualitySettings,e=c.maximumPixelRatio,c=c.maximumRenderResolution;null!=
e&&(a=Math.min(a,e));null!=c&&(a=Math.min(a,c/Math.max(this.width,this.height)));return a},set:function(a){x.isSome(a)?this._override("maximumPixelRatio",a):this._clearOverride("maximumPixelRatio")},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"groundExtent",{get:function(){var a=this._get("basemapTerrain");if(a&&a.spatialReference){var e=a.extent;return new c.Extent({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:a.spatialReference})}return new c.Extent({spatialReference:this.spatialReference||
c.SpatialReference.WGS84})},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"initialExtentRequired",{get:function(){return this.stateManager&&!this.stateManager.hasInitialView},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"interacting",{get:function(){return!!this.state&&this.state.interacting},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"qualityProfile",{get:function(){return this._get("qualityProfile")||Z.getDefaultProfile()},set:function(a){Z.isValidProfile(a)&&
(Z.apply(a,this.qualitySettings),this._set("qualityProfile",a))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"slicePlane",{set:function(a){this._stage.setRenderParams({slicePlane:a});if(a){var c=this.propertiesPool.get("slicePlane");Y.boundedPlane.copy(a,c);this._set("slicePlane",c)}else this._set("slicePlane",null)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"resolution",{get:function(){return null!=this.spatialReference?G.getResolutionForScale(this.scale,
this.spatialReference):0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"heightModelInfo",{get:function(){var a=this.getDefaultHeightModelInfo();return null!=a?H.deriveUnitFromSR(a,this.spatialReference):null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"supersampleScreenhotsEnabled",{get:function(){return this._get("supersampleScreenhotsEnabled")},set:function(a){this._set("supersampleScreenhotsEnabled",a);this._stage&&this._stage.setViewParams({supersampleScreenshots:a})},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewingMode",{get:function(){var a=this.get("map.initialViewProperties.viewingMode"),c=this.spatialReference;a||(a=!c||c.isWebMercator||c.isWGS84?"global":"local");return a},set:function(a){this._internallyReady?la.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(a)?this._override("viewingMode",a):void 0===a&&this._clearOverride("viewingMode")},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"resourceController",{get:function(){return this._resourceController},enumerable:!0,configurable:!0});b.prototype.on=function(a,c,e){var d=this.inputManager.viewEvents.register(a,c,e);return d?d:this.inherited(arguments)};b.prototype.hasEventListener=function(a){return this.inherited(arguments)||this.inputManager&&this.inputManager.viewEvents.hasHandler(a)};b.prototype.toMap=function(a,c){if(!this.ready)return la.error("#toMap()","Scene view cannot be used before it is ready"),null;c=c?this._externalToInternalIntersectOptions(c):
this._defaultToMapOptions;var e=x.isSome(c.graphics)&&(x.isSome(c.graphics.include)||x.isSome(c.graphics.exclude));c.allEnabled=e;a=B.isSupportedScreenPointEvent(a)?B.createScreenPointFromSupportedEvent(this,a):a;a=B.screenPointObjectToArray(a);var d=c.include&&!c.include.has(qa.TERRAIN_ID)||c.exclude&&c.exclude.has(qa.TERRAIN_ID);a=this.sceneIntersectionHelper.intersectIntersectorScreen(a,null,c,!0,d).results;if(e){e=0;for(a=a.all;e<a.length;e++){var d=a[e],g=d.toGraphic(this);if(x.isNone(g)||this._testGraphicUidFilter(c.graphics,
g))return this._intersectResultToMapPoint(d)}return null}return this._intersectResultToMapPoint(a.min)};b.prototype.toScreen=function(a){if(!this.ready)return la.error("#toScreen()","Scene view cannot be used before it is ready"),null;var c=null==a.z&&this.basemapTerrain.getElevation(a)||0;fa.pointToVector(a,oa,this.renderSpatialReference,c);return this.engineToScreen(oa)};b.prototype.pixelSizeAt=function(a,e){if(!this.ready)return la.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),
null;if("number"===typeof a){if(a=this.sceneIntersectionHelper.intersectIntersectorScreen(B.createScreenPointArray(a,e)).results.min,!a.getIntersectionPoint(oa))return 0}else if(a instanceof c.Point)fa.pointToVector(a,oa,this.renderSpatialReference);else if(a=this.sceneIntersectionHelper.intersectIntersectorScreen(B.createScreenPointArray(a.x,a.y)).results.min,!a.getIntersectionPoint(oa))return 0;return this.state.camera.computeScreenPixelSizeAt(oa)};b.prototype.hitTest=function(a,c){if(!this.ready)return la.error("#hitTest()",
"Scene view cannot be used before it is ready"),null;a=B.isSupportedScreenPointEvent(a)?B.createScreenPointFromSupportedEvent(this,a):a;var e=B.createScreenPointArray(a.x,a.y),d=c?this._externalToInternalIntersectOptions(c):this._defaultHitTestOptions;d.allEnabled=!0;d.terrainLocationFeedbackEnabled=!0;c=this.sceneIntersectionHelper.intersectIntersectorScreen(e,null,d,!0,!0);e=this._intersectResultsToHits(c.results.all,d.graphics);d=c.results.terrain;a={screenPoint:a,results:e,ground:{mapPoint:this._intersectResultToMapPoint(d),
distance:d.hasIntersectionPoint?d.distanceInRenderSpace:0}};S.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(a.intersector=c);return v.resolve(a)};b.prototype.popupHitTest=function(a){return this.hitTest(a).then(function(c){for(var e=[],d=c.results.length?c.results[0].distance:0,g=0,l=c.results;g<l.length;g++){var h=l[g];if(h.distance!==d)break;e.push(h)}g=null;if(0===e.length||1E-5>Math.abs(d-c.ground.distance))g=c.ground.mapPoint;return{results:e,screenPoint:a,mapPoint:g}})};b.prototype.goTo=function(a,
c){return this.stateManager.goTo(a,c)};b.prototype.takeScreenshot=function(a){var c=this;return this.whenReady().then(function(){var e=xa.toRenderSettings(a,c);e.pixelRatio/=c.pixelRatio;return c._stage.takeScreenshot(e)})};b.prototype.forceDOMReadyCycle=function(){this.forceReadyCycle()};b.prototype.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||this.get("defaultsFromMap.isSpatialReferenceDone")&&
this._initialDefaultSpatialReference||null};b.prototype.validate=function(){var a=ya.check();y("safari")&&9>y("safari")&&(a=new t("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:y("safari")}));return a?(la.warn("#validate()",a.message),v.reject(a)):v.resolve()};b.prototype.isSpatialReferenceSupported=function(a,c,e){var d=a.isGeographic,g=a.isWebMercator,l=a.isWGS84,h="local"===this.viewingMode,b=!(!this._isOverridden("viewingMode")&&
!this.get("map.initialViewProperties.viewingMode"));if(b){if(h&&d)return e&&e("Layer "+c.id+" is ignored because it is GCS and viewing mode is local"),!1;if(!h&&!g&&!l)return e&&e("Layer "+c.id+" is ignored because its spatial reference is not supported in global viewing mode"),!1}else if(d&&!l)return e&&e("Layer "+c.id+" is ignored because its spatial reference is geographic but not WGS84"),!1;if(c)if(ta.isTiledLayer(c)){if(d=void 0,b?b=ta.getTiledLayerInfo(c,a,this.viewingMode):(b=ta.getTiledLayerInfo(c,
a,"global"),null==b.tileInfo&&(b=ta.getTiledLayerInfo(c,a,"local"))),d=null!=b.tileInfo,!d)return e&&e("Layer "+c.id+" is ignored because it is tiled but\n            its tiling scheme is not supported or compatible with the viewing mode"),!1}else if((l||g)&&!h)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=a),b||this._internallyReady||(this.viewingMode="global",e&&e("Viewing mode locked to global due to reprojectable layer "+c.id)),e&&e("Layer "+c.id+" is ignored because it supports server-side reprojection"),
!1;return!0};b.prototype.whenReady=function(){var a=this;return v.create(function(c){a._internallyReady?c(a):a._resolveWhenReady.push(c)})};b.prototype.computeMapPointFromVec3d=function(a,e){var d=this.spatialReference||c.SpatialReference.WGS84;fa.vectorToVector(a,this.renderSpatialReference,a,d)||(d=c.SpatialReference.WGS84,fa.vectorToVector(a,this.renderSpatialReference,a,d));e?(e.x=a[0],e.y=a[1],e.z=a[2],e.spatialReference=d):e=new c.Point(a,d);return e};b.prototype.engineToScreen=function(a,c){var e=
B.createRenderScreenPointArray3();this.state.camera.projectPoint(a,e);a=B.screenPointArrayToObject(e);return B.renderToScreen(this,a,c)};b.prototype.flushDisplayModifications=function(){this._stage.processDirty()};b.prototype.getDrawingOrder=function(a){return this.allLayerViews.findIndex(function(c){return c.layer&&c.layer.uid===a})};b.prototype.getViewForGraphic=function(a){return a.layer===this.graphics?this.graphicsView:a.layer?this.allLayerViews.find(function(c){return c.layer===a.layer}):null};
b.prototype.graphicChanged=function(a){x.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(a)};b.prototype.whenViewForGraphic=function(a){var c=this;return a.layer===this?A.whenOnce(this,"graphicsView").then(function(){return c.graphicsView}):a.layer?this.whenLayerView(a.layer):v.reject()};b.prototype._intersectResultToMapPoint=function(a,c){if(a.getIntersectionPoint(oa)){c=this.computeMapPointFromVec3d(oa,c);var e=this.basemapTerrain;"TerrainRenderer"===a.intersector&&e&&(c.z=e.getElevation(c)||
0);return c}return null};b.prototype._intersectResultsToHits=function(a,c){for(var e=[],d=null,g=0;g<a.length;g++){var l=a[g],h=l.toOwner(this);if(x.isSome(h)&&(h===this.map.ground||"type"in h&&"integrated-mesh"===h.type))break;h=l.toGraphic(this);if(x.isSome(h)){x.isNone(d)&&g!==a.length-1&&(d=new Set);if(x.isSome(d)){var b=this._getGraphicFilterUid(h);if(d.has(b))continue;d.add(b)}this._testGraphicUidFilter(c,h)&&(b=this._intersectResultToMapPoint(l),e.push({graphic:h,mapPoint:b,distance:l.distanceInRenderSpace}))}}return e};
b.prototype._getGraphicFilterUid=function(a){if(a.layer&&"objectIdField"in a.layer){var c=a.attributes[a.layer.objectIdField];if(c)return"o-"+a.layer.id+"-"+c}return"u-"+a.uid};b.prototype._testGraphicUidFilter=function(a,c){c=this._getGraphicFilterUid(c);return x.isNone(a)||(x.isNone(a.include)||a.include.has(c))&&(x.isNone(a.exclude)||!a.exclude.has(c))};b.prototype._externalToInternalRenderItems=function(c,e,d){var g=this;void 0===d&&(d={layerUids:null,graphicUids:null});if(!c)return d;c instanceof
a?(Aa(d,this._getGraphicFilterUid(c)),0===e&&(x.isSome(this.graphicsView)&&c.layer===this.graphicsView?ra(d,this.graphicsView.mockLayerId):c.layer&&ra(d,c.layer.uid))):"forEach"in c?c.forEach(function(a){Array.isArray(a)?g._externalToInternalRenderItems(a,e,d):u.isCollection(a)?a===g.graphics&&x.isSome(g.graphicsView)?ra(d,g.graphicsView.mockLayerId):g._externalToInternalRenderItems(a,e,d):a instanceof l?a===g.map.ground&&ra(d,qa.TERRAIN_ID):g._externalToInternalRenderItems(a,e,d)}):ra(d,c.uid);return d};
b.prototype._externalToInternalIntersectOptions=function(a){var c=this._externalToInternalRenderItems(a.include,0);a=this._externalToInternalRenderItems(a.exclude,1);return{include:c.layerUids,exclude:a.layerUids,graphics:{include:c.graphicUids,exclude:a.graphicUids}}};b.prototype._viewingModeToManifold=function(a){switch(a){case "global":return"spherical";case "local":return"planar"}};b.prototype._initBasemapTerrain=function(a){var c=this;this._disposeBasemapTerrain();this._set("basemapTerrain",
new sa(this,this._viewingModeToManifold(a)));this._set("elevationProvider",new aa({view:this}));this.elevationProvider.register("ground",this.basemapTerrain);this._handles.add([A.init(this,"map.ground.opacity",function(a){return c.basemapTerrain.baseOpacity=null==a?1:a},!0),A.init(this,"map.ground.surfaceColor",function(a){c.basemapTerrain.backgroundColor=a})],"basemapTerrain")};b.prototype._initGlobe=function(a){var c=this;this._initCoordinateSystem();this._initState();this._stage.setViewParams({backgroundColor:[0,
0,0,0]});this._initBasemapTerrain(a);this._set("pointsOfInterest",new pa.default({view:this}));this._set("featureTiles",new X.default({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler}));this._handles.add(this.featureTiles.watch("updating",function(){return c._evaluateUpdating()}));this._handles.add(A.init(S,"FEATURE_TILE_TREE_SHOW_TILES",
function(a){a&&c.featureTiles&&!c.featureTilesDebugger?c.featureTilesDebugger=new W.FeatureTileTree3DDebugger(c):!a&&c.featureTilesDebugger&&(c.featureTilesDebugger.destroy(),c.featureTilesDebugger=null)}),"feature-tiles");this._handles.add(A.init(this,["clippingArea","basemapTerrain.extent"],function(){var a=c.basemapTerrain&&c.basemapTerrain.extent;c.clippingArea||a?a&&c.basemapTerrain.spatialReference?(a=D.toExtent(c.basemapTerrain.extent,c.basemapTerrain.spatialReference),c.featureTiles.filterExtent=
c.clippingArea?a.intersection(c.clippingArea):a):c.featureTiles.filterExtent=c.clippingArea:c.featureTiles.filterExtent=null},!0),"feature-tiles");this.stateManager.init()};b.prototype._initCoordinateSystem=function(){var a=this;if(this.spatialReference){var c=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(c)||this._set("mapCoordsHelper",new ja.default(this.map,c));var e="global"===this.viewingMode,c=e?fa.SphericalECEFSpatialReference:c;c!==this.renderSpatialReference&&
(this.renderSpatialReference=c,this._set("renderCoordsHelper",ia.RenderCoordsHelper.createMode(this.viewingMode,c)),e||this._handles.add(this.watch("basemapTerrain.extent",function(c){if(0!==c[0]||0!==c[1]||0!==c[2]||0!==c[3])a.renderCoordsHelper.extent=c},!0),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(ua.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null),this.renderSpatialReference=
null};b.prototype._evaluateUpdating=function(){var a=0,c=0,e=!1;this.allLayerViews.forEach(function(d){d.updating&&(e=!0,d="updatingPercentage"in d?d.updatingPercentage:null,null!=d&&(++c,a+=d))});e=!!(e||this._createGraphicsViewPromise||x.isSome(this.graphicsView)&&this.graphicsView.updating||this._resourceController&&this._resourceController.updating||this.featureTiles&&this.featureTiles.updating||this.labeler&&this.labeler.updating);e!==this.updating&&this._set("updating",e);a=0!==c?a/c:e?100:
0;this.updatingPercentage!==a&&this._set("updatingPercentage",a)};b.prototype._updateUpdatingMonitors=function(a){for(var c=this,e=0,d=a.removed;e<d.length;e++){var g=d[e];this._handles.remove(g.uid)}e=0;for(a=a.added;e<a.length;e++)g=a[e],g.destroyed||this._handles.add([g.watch(["updating","updatingPercentage"],function(){return c._evaluateUpdating()})],g.uid);this._evaluateUpdating()};b.prototype._disposeSurface=function(){var a=function(a){a&&a.remove();return null};this._stageFrameTask=a(this._stageFrameTask);
this._updateDrawingOrderHandle=a(this._updateDrawingOrderHandle);this.onViewExtentUpdateHandle=a(this.onViewExtentUpdateHandle);this.pointsOfInterest&&(this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null));this.featureTiles&&(this.featureTiles.destroy(),this._set("featureTiles",null));this._handles.remove("feature-tiles");this._handles.remove("render-coords-helper");this._disposeBasemapTerrain();this.environmentManager&&this.environmentManager.disposeRendering()};b.prototype._disposeBasemapTerrain=
function(){var a=this._get("basemapTerrain");a&&(this._handles.remove("basemapTerrain"),a.destroy(),this._set("basemapTerrain",null))};b.prototype._renderScreenshotOverlay=function(a,c){if(this.overlay&&this.overlay.hasVisibleItems){var e=a.getContext("2d");e.putImageData(c,0,0);this.overlay.renderCanvas(a);a=e.getImageData(0,0,c.width,c.height);for(e=0;e<a.data.length;e++)c.data[e]=a.data[e]}};b.prototype._initStage=function(){var a=this,c={};c.renderContext=this.renderContext;c.deactivatedWebGLExtensions=
this.deactivatedWebGLExtensions;c.viewingMode=this.viewingMode;c.alpha=this.alphaCompositingEnabled;c.supersampleScreenshots=this.supersampleScreenhotsEnabled;c.renderScreenshotOverlay=function(c,e){return a._renderScreenshotOverlay(c,e)};this.renderCanvas&&(c.canvas=this.renderCanvas);var e=new ba.SceneIntersectionHelper(this.viewingMode,{forEachLayer:function(c){var e=a._stage.getLayers();Object.keys(e).forEach(function(a){c(e[a])})}},this);this._set("sceneIntersectionHelper",e);this._stage=new wa(this.viewingMode,
m.byId(this.surface),c,e);this._handles.add(A.init(this.qualitySettings,"antialiasingEnabled",function(){a._stage.setRenderParams({antialiasingEnabled:a.qualitySettings.antialiasingEnabled})}),"stage");c=function(){a._stage.setRenderParams({defaultHighlightOptions:ea.toEngineOptions(a.highlightOptions)})};this._handles.add(this.watch(["highlightOptions","highlightOptions.color","highlightOptions.haloOpacity","highlightOptions.fillOpacity"],c),"stage");c();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(ua.DEFAULT_TOLERANCE/
this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.getCanvas());this._stageFrameTask=z.addFrameTask(this._stage.getFrameTask())};b.prototype._initSurface=function(){this._initStage();this._initGlobe(this.viewingMode);this.sharedSymbolResources=new ma.default({stage:this._stage,viewingMode:this.viewingMode,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})};b.prototype._createGraphicsViewIfNeeded=function(){this.graphicsView||
this._createGraphicsViewPromise||0===this.graphics.length||(this._handles.remove("graphics-view"),this._createGraphicsViewPromise=e.safeCast(this._createGraphicsViewAsync()),this._createGraphicsViewPromise.isFulfilled()&&(this._createGraphicsViewPromise=null),this._evaluateUpdating())};b.prototype._createGraphicsViewAsync=function(){return d(this,void 0,void 0,function(){var a,c,e=this;return k(this,function(d){switch(d.label){case 0:return[4,v.create(function(a){return q(["./3d/layers/GraphicsView3D"],
a)})];case 1:return a=d.sent(),[4,A.whenTrueOnce(this.basemapTerrain,"ready")];case 2:return d.sent(),c=new a({view:this}),this._set("graphicsView",c),this._handles.add([A.init(c,"updating",function(){return e._evaluateUpdating()})],c.mockLayerId),this._createGraphicsViewPromise=null,this._evaluateUpdating(),[2]}})})};b.prototype._disposeGraphicsView=function(){this._createGraphicsViewPromise&&(this._createGraphicsViewPromise.cancel(),this._createGraphicsViewPromise=null);this._handles.remove("graphics-view");
x.isSome(this.graphicsView)&&(this._handles.remove(this.graphicsView.mockLayerId),this.graphicsView.destroy(),this._set("graphicsView",null))};b.prototype._initState=function(){this._set("state",new ca.default({viewingMode:this.viewingMode,spatialReference:this.spatialReference}))};b.prototype._viewReadyHandler=function(a){var c=this;a||("global"===this.viewingMode&&(this._clippingArea=null),this._internallyReady=!0,this._initSurface(),this._handles.add(A.on(this,"graphics","change",function(){return c._createGraphicsViewIfNeeded()},
function(){return c._createGraphicsViewIfNeeded()}),"graphics-view"),this._createGraphicsViewPromise&&this._handles.remove("graphics-view"),this._evaluateUpdating(),!this._externallySet.environment&&(a=this.get("map.initialViewProperties.environment"))&&(this.environment=a),this._updateDrawingOrderHandle=this.allLayerViews.on("change",function(){return c._updateDrawingOrder()}),this._updateDrawingOrder(),this.labeler.setup(),this.environmentManager.updateReadyChange(!0),this.inputManager.connect(),
a=this._resolveWhenReady,this._resolveWhenReady=[],a.forEach(function(a){return a(c)}))};b.prototype._viewUnreadyHandler=function(a){a&&(x.isSome(this.activeTool)&&(this.activeTool.deactivate&&this.activeTool.deactivate(),this._set("activeTool",null)),this._initialDefaultSpatialReference=null,this.inputManager.disconnect(),this.environmentManager.updateReadyChange(!1),this._disposeGraphicsView(),this._internallyReady=!1,this.stateManager.deinit(),this._disposeSurface(),this.state.destroy(),this._set("state",
null),this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null),this.labeler&&this.labeler.dispose(),this._stage&&(this._stage.dispose(),this._stage=null),this._handles.remove("stage"),this._set("canvas",null))};b.prototype._updateDrawingOrder=function(){var a=this.allLayerViews.length-1;this.allLayerViews.forEach(function(c,e){"drawingOrder"in c&&(c.drawingOrder=a-e)})};b.prototype._updateDefaultToMapOptions=function(){this._defaultToMapOptions.include.clear();
if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(qa.TERRAIN_ID);for(var a=0,c=this.map.allLayers.items;a<c.length;a++){var e=c[a];"integrated-mesh"===e.type&&this._defaultToMapOptions.include.add(e.uid)}}};b.prototype._updateDefaultHitTestOptions=function(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(qa.TERRAIN_ID);for(var a=0,c=this.map.allLayers.items;a<c.length;a++){var e=c[a];"integrated-mesh"===
e.type&&1>e.opacity&&this._defaultToMapOptions.exclude.add(e.uid)}}};f([C.property({type:T,readOnly:!0,aliasOf:"state.animation"})],b.prototype,"animation",void 0);f([C.property({readOnly:!0})],b.prototype,"basemapTerrain",void 0);f([C.property({readOnly:!0})],b.prototype,"elevationProvider",void 0);f([C.property({type:p,aliasOf:"stateManager.camera"})],b.prototype,"camera",void 0);f([C.property({readOnly:!0})],b.prototype,"canvas",void 0);f([C.property({type:c.Point,aliasOf:"stateManager.center"})],
b.prototype,"center",void 0);f([C.property({type:c.Extent,dependsOn:["map.clippingArea?","map.clippingEnabled?","viewingMode"]})],b.prototype,"clippingArea",null);f([C.property({type:R.default})],b.prototype,"constraints",void 0);f([C.property({type:c.Extent,dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0})],b.prototype,"dataExtent",null);f([C.property({value:null,type:J})],b.prototype,"environment",null);f([C.cast("environment")],b.prototype,"castEnvironment",null);f([C.property()],
b.prototype,"environmentManager",void 0);f([C.property({type:c.Extent,aliasOf:"stateManager.extent"})],b.prototype,"extent",void 0);f([C.property({readOnly:!0,aliasOf:"stateManager.screenCenter"})],b.prototype,"screenCenter",void 0);f([C.property({type:Number,dependsOn:["maximumPixelRatio"]})],b.prototype,"pixelRatio",null);f([C.property({type:Number,dependsOn:["qualitySettings.maximumPixelRatio","qualitySettings.maximumRenderResolution","size"]})],b.prototype,"maximumPixelRatio",null);f([C.property({aliasOf:"stateManager.frustum"})],
b.prototype,"frustum",void 0);f([C.property({type:Number,readOnly:!0})],b.prototype,"fullOpacity",void 0);f([C.property({readOnly:!0})],b.prototype,"graphicsView",void 0);f([C.property({type:c.Extent,dependsOn:["basemapTerrain.extent"],readOnly:!0})],b.prototype,"groundExtent",null);f([C.property()],b.prototype,"groundView",void 0);f([C.property({type:Boolean,dependsOn:["stateManager.hasInitialView"]})],b.prototype,"initialExtentRequired",null);f([C.property({type:Boolean,dependsOn:["state.interacting"],
readOnly:!0})],b.prototype,"interacting",null);f([C.property()],b.prototype,"map",void 0);f([C.property({readOnly:!0})],b.prototype,"mapCoordsHelper",void 0);f([C.property({aliasOf:"stateManager.padding"})],b.prototype,"padding",void 0);f([C.property({type:pa.default,readOnly:!0})],b.prototype,"pointsOfInterest",void 0);f([C.property({type:X.default,readOnly:!0})],b.prototype,"featureTiles",void 0);f([C.property({type:W.FeatureTileTree3DDebugger})],b.prototype,"featureTilesDebugger",void 0);f([C.property({type:Boolean})],
b.prototype,"screenSizePerspectiveEnabled",void 0);f([C.property({constructOnly:!0})],b.prototype,"deactivatedWebGLExtensions",void 0);f([C.property({constructOnly:!0})],b.prototype,"renderCanvas",void 0);f([C.property({readOnly:!0})],b.prototype,"state",void 0);f([C.property({readOnly:!0})],b.prototype,"inputManager",void 0);f([C.property({readOnly:!0})],b.prototype,"stateManager",void 0);f([C.property({type:["low","medium","high"]})],b.prototype,"qualityProfile",null);f([C.property({type:ka,get:function(){var a=
this._get("qualitySettings");a||(a=new ka,Z.apply(this.qualityProfile,a));return a}})],b.prototype,"qualitySettings",void 0);f([C.property()],b.prototype,"slicePlane",null);f([C.property({dependsOn:["viewingMode"]})],b.prototype,"ready",void 0);f([C.property({readOnly:!0})],b.prototype,"renderCoordsHelper",void 0);f([C.property({readOnly:!0})],b.prototype,"sceneIntersectionHelper",void 0);f([C.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],b.prototype,"resolution",null);
f([C.property({type:Number,aliasOf:"stateManager.scale"})],b.prototype,"scale",void 0);f([C.property()],b.prototype,"heightModelInfo",null);f([C.property({dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],b.prototype,"spatialReference",void 0);f([C.property({type:Boolean,constructOnly:!0})],b.prototype,"alphaCompositingEnabled",void 0);f([C.property({type:Boolean,value:!0})],b.prototype,"supersampleScreenhotsEnabled",null);f([C.property({readOnly:!0})],
b.prototype,"type",void 0);f([C.property({type:va})],b.prototype,"ui",void 0);f([C.property({type:Boolean,readOnly:!0})],b.prototype,"updating",void 0);f([C.property({type:Number,readOnly:!0})],b.prototype,"updatingPercentage",void 0);f([C.property({type:["global","local"],dependsOn:["map.initialViewProperties?.viewingMode","spatialReference"]})],b.prototype,"viewingMode",null);f([C.property({type:g,aliasOf:"stateManager.viewpoint"})],b.prototype,"viewpoint",void 0);f([C.property({type:Number,aliasOf:"stateManager.zoom"})],
b.prototype,"zoom",void 0);f([C.property({type:ea})],b.prototype,"highlightOptions",void 0);return b=f([C.subclass("esri.views.SceneView")],b)}(C.declared(O,L,M,P));var oa=F.vec3f64.create();return b})},"esri/views/BreakpointsOwner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/dom-class ../core/Accessor ../core/ArrayPool ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./DOMContainer".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l){var g={widthBreakpoint:{getValue:function(a){var c=a.viewSize[0];a=a.breakpoints;var e=this.values;return c<=a.xsmall?e.xsmall:c<=a.small?e.small:c<=a.medium?e.medium:c<=a.large?e.large:e.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},
heightBreakpoint:{getValue:function(a){var c=a.viewSize[1];a=a.breakpoints;var e=this.values;return c<=a.xsmall?e.xsmall:c<=a.small?e.small:c<=a.medium?e.medium:c<=a.large?e.large:e.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},
orientation:{getValue:function(a){a=a.viewSize;var c=this.values;return a[1]>=a[0]?c.portrait:c.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},e={xsmall:544,small:768,medium:992,large:1200};return function(l){function h(){var a=null!==l&&l.apply(this,arguments)||this;a._breakpointsHandles=new p;a.breakpoints=e;a.orientation=null;a.widthBreakpoint=null;a.heightBreakpoint=null;return a}
n(h,l);h.prototype.initialize=function(){this._breakpointsHandles.add([c.init(this,["breakpoints","size"],this._updateClassNames)])};h.prototype.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)};h.prototype._updateClassNames=function(){if(this.container){var a=m.acquire(),c=m.acquire(),e=!1,d,l,h;for(d in g)l=this[d],h=g[d].getValue({viewSize:this.size,breakpoints:this.breakpoints}),l!==h&&(e=!0,this[d]=h,c.push(g[d].valueToClassName[l]),
a.push(g[d].valueToClassName[h]));e&&(this._applyClassNameChanges(a,c),m.release(a),m.release(c))}};h.prototype._applyClassNameChanges=function(a,c){var e=this.container;e&&(d.remove(e,c),d.add(e,a))};h.prototype._removeActiveClassNames=function(){var a=this.container;if(a)for(var c in g)d.remove(a,g[c].valueToClassName[this[c]])};f([a.property({set:function(a){var c=this._get("breakpoints");if(a!==c){c=(c=a)&&c.xsmall<c.small&&c.small<c.medium&&c.medium<c.large;if(!c){var d=JSON.stringify(e,null,
2);console.warn("provided breakpoints are not valid, using defaults:"+d)}a=c?a:e;this._set("breakpoints",k({},a))}}})],h.prototype,"breakpoints",void 0);f([a.property()],h.prototype,"orientation",void 0);f([a.property()],h.prototype,"widthBreakpoint",void 0);f([a.property()],h.prototype,"heightBreakpoint",void 0);return h=f([a.subclass("esri.views.BreakpointsOwner")],h)}(a.declared(h,l))})},"esri/views/DOMContainer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/dom dojo/dom-construct ../core/Accessor ../core/domUtils ../core/Evented ../core/Handles ../core/scheduling ../core/watchUtils ../core/accessorSupport/decorators ./overlay/ViewOverlay ../widgets/Popup".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u){function t(a){a&&(m.empty(a),a.parentNode&&a.parentNode.removeChild(a))}var r=[0,0];return function(h){function b(){var a=h.call(this)||this;a._domHandles=new c;a._freqInfo={freq:16,time:750};a._overlayRenderTaskHandle=null;a.height=0;a.position=null;a.resizing=!1;a.root=null;a.surface=null;a.suspended=!0;a.ui=null;a.userContent=null;a.width=0;a.watch("cursor",function(c){var e=a.surface;e&&e.setAttribute("data-cursor",c)});a.watch("interacting",function(c){var e=
a.surface;e&&e.setAttribute("data-interacting",c.toString())});return a}n(b,h);b.prototype.initialize=function(){var a=this;this.watch("ui",this._handleUIChange);this._wireUI(this.ui);this._focusHandle=this.on("focus",function(){return a.notifyChange("focused")});this._blurHandle=this.on("blur",function(){return a.notifyChange("focused")})};b.prototype.destroy=function(){this.destroyed||(this.ui.destroy(),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null,this._domHandles.destroy(),
this._focusHandle&&(this._focusHandle.remove(),this._focusHandle=null),this._blurHandle&&(this._blurHandle.remove(),this._blurHandle=null))};Object.defineProperty(b.prototype,"container",{set:function(c){var d=this,g=this._get("container");if(g!==c)if(this._domHandles.remove("dom-size"),this._stopMeasuring(),g&&(g.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),this._set("overlay",null),
t(this.root),this._set("root",null),m.reparent(this.userContent,g),t(this.userContent),this._set("userContent",null)),c){c.classList.add("esri-view");g=document.createElement("div");g.className="esri-view-user-storage";m.reparent(c,g);c.appendChild(g);this._set("userContent",g);g=document.createElement("div");g.className="esri-view-root";c.insertBefore(g,c.firstChild);this._set("root",g);var h=document.createElement("div");h.className="esri-view-surface";h.setAttribute("role","application");h.tabIndex=
0;k.setSelectable(h,!1);g.appendChild(h);this._set("surface",h);var b=new e;g.appendChild(b.surface);this._set("overlay",b);b.watch("needsRender",function(c){c&&!d._overlayRenderTaskHandle?d._overlayRenderTaskHandle=a.addFrameTask({render:function(){d.overlay.render()}}):d._overlayRenderTaskHandle&&(d._overlayRenderTaskHandle.remove(),d._overlayRenderTaskHandle=null)});this.forceDOMReadyCycle();this._domHandles.add(l.init(this,"size",function(a){var c=a[1];h.classList.toggle("esri-view-surface--inset-outline",
a[0]>=document.body.clientWidth||c>=document.body.clientHeight)}),"dom-size");this._set("container",c);this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"focused",{get:function(){var a=document.activeElement===this.surface;return document.hasFocus()&&a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"popup",{get:function(){return this._get("popup")||new u({view:this})},set:function(a){var c=this._get("popup");c&&c!==a&&c.destroy();this._set("popup",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return[this.width,this.height]},enumerable:!0,configurable:!0});b.prototype.blur=function(){this.surface&&this.surface.blur()};b.prototype.focus=function(){this.surface&&this.surface.focus()};b.prototype.pageToContainer=function(a,c,e){var d=this.position;
a-=d[0];c-=d[1];e?(e[0]=a,e[1]=c):e=[a,c];return e};b.prototype.containerToPage=function(a,c,e){var d=this.position;a+=d[0];c+=d[1];e?(e[0]=a,e[1]=c):e=[a,c];return e};b.prototype._handleUIChange=function(a,c){c&&(this._domHandles.remove("ui"),c.destroy());a&&this._wireUI(a);this._set("ui",a)};b.prototype._wireUI=function(a){this._domHandles.remove("ui");a&&(a.view=this,this._domHandles.add([l.init(this,"root",function(c){a.container=c?d.create("div",null,c):null}),l.init(this,"popup",function(c,
e){e&&a.remove(e,"popup");c&&(c.view=a.view,a.add(c,{key:"popup",position:"manual"}))})],"ui"))};b.prototype._stopMeasuring=function(){this._domHandles.remove("measuring");this._get("resizing")&&this._set("resizing",!1)};b.prototype._startMeasuring=function(){var c=this,e=this._freqInfo;e.freq=16;e.time=750;this._domHandles.add([function(){var a=function(){e.freq=16;e.time=750};window.addEventListener("resize",a);return{remove:function(){window.removeEventListener("resize",a)}}}(),a.addFrameTask({prepare:function(a){var e=
c._measure(),d=c._freqInfo;d.time+=a.deltaTime;e&&(d.freq=16,c._get("resizing")||c._set("resizing",!0));d.time<d.freq||(d.time=0,c._position()||e?d.freq=16:d.freq=Math.min(750,2*d.freq),!e&&512<=d.freq&&c._get("resizing")&&c._set("resizing",!1))}})],"measuring");this._measure();this._position()};b.prototype._measure=function(){var a=this.container,c=a?a.clientWidth:0,e=a?a.clientHeight:0;if(0===c||0===e||"hidden"===window.getComputedStyle(a).visibility)return this.suspended||this._set("suspended",
!0),!1;var a=this.width,d=this.height;if(c===a&&e===d)return this.suspended&&this._set("suspended",!1),!1;this._set("width",c);this._set("height",e);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:a,oldHeight:d,width:c,height:e});return!0};b.prototype._position=function(){var a=this.container,c=this.position,e=(a.ownerDocument||window.document).defaultView,a=a.getBoundingClientRect();r[0]=a.left+e.pageXOffset;r[1]=a.top+e.pageYOffset;return c&&r[0]===c[0]&&r[1]===c[1]?!1:(this._set("position",
[r[0],r[1]]),!0)};b.prototype.forceDOMReadyCycle=function(){};f([g.property({value:null,cast:function(a){return k.byId(a)}})],b.prototype,"container",null);f([g.property({readOnly:!0,dependsOn:["surface"]})],b.prototype,"focused",null);f([g.property({readOnly:!0})],b.prototype,"height",void 0);f([g.property({type:u})],b.prototype,"popup",null);f([g.property({type:e})],b.prototype,"overlay",void 0);f([g.property({readOnly:!0})],b.prototype,"position",void 0);f([g.property({readOnly:!0})],b.prototype,
"resizing",void 0);f([g.property({readOnly:!0})],b.prototype,"root",void 0);f([g.property({value:null,dependsOn:["width","height"],readOnly:!0})],b.prototype,"size",null);f([g.property({readOnly:!0})],b.prototype,"surface",void 0);f([g.property({readOnly:!0})],b.prototype,"suspended",void 0);f([g.property()],b.prototype,"ui",void 0);f([g.property({readOnly:!0})],b.prototype,"userContent",void 0);f([g.property({readOnly:!0})],b.prototype,"width",void 0);return b=f([g.subclass("esri.views.DOMContainer")],
b)}(g.declared(h,p))})},"esri/views/overlay/ViewOverlay":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators maquette".split(" "),function(q,b,n,f,k,d,h,m,p){return function(c){function a(){var a=null!==c&&c.apply(this,arguments)||this;a.items=new h;a._callbacks=new Map;a._projector=p.createProjector();a._hiddenProjector=p.createProjector();return a}
n(a,c);Object.defineProperty(a.prototype,"needsRender",{get:function(){return 0<this.items.length},enumerable:!0,configurable:!0});a.prototype.initialize=function(){var a=this,c=document.createElement("div");c.className="esri-overlay-surface";k.setSelectable(c,!1);this._set("surface",c);this._hiddenSurface=document.createElement("div");this._hiddenSurface.setAttribute("style","visibility: hidden;");c.appendChild(this._hiddenSurface);this._itemsChangeHandle=this.items.on("change",function(c){c.added.map(function(c){var e=
function(){return c.render()};a._callbacks.set(c,e);a._projector.append(a.surface,e)});c.removed.map(function(c){var e=a._projector.detach(a._callbacks.get(c));a.surface.removeChild(e.domNode);a._callbacks.delete(c)})})};a.prototype.addItem=function(a){this.items.add(a)};a.prototype.removeItem=function(a){this.items.remove(a)};a.prototype.destroy=function(){this.items.removeAll();this._itemsChangeHandle.remove();this._projector=this._callbacks=null};a.prototype.render=function(){this._projector.renderNow()};
a.prototype.computeBoundingRect=function(a){var c=this._hiddenSurface,e=this._hiddenProjector,d=null,l=function(){return d=a.render()};e.append(c,l);e.renderNow();var h={left:0,top:0,right:0,bottom:0};if(d&&d.domNode){var b=d.domNode.getBoundingClientRect();h.left=b.left;h.top=b.top;h.right=b.right;h.bottom=b.bottom}for(e.detach(l);c.firstChild;)c.removeChild(c.firstChild);return h};a.prototype.overlaps=function(a,c){a=this.computeBoundingRect(a);c=this.computeBoundingRect(c);return Math.max(a.left,
c.left)<=Math.min(a.right,c.right)&&Math.max(a.top,c.top)<=Math.min(a.bottom,c.bottom)};Object.defineProperty(a.prototype,"hasVisibleItems",{get:function(){return this.items.some(function(a){return a.visible})},enumerable:!0,configurable:!0});a.prototype.renderCanvas=function(a){if(this.items.some(function(a){return a.visible})){var c=a.getContext("2d");c.save();c.font="10px "+getComputedStyle(this.surface).fontFamily;this.items.forEach(function(a){c.save();a.renderCanvas(c);c.restore()});c.restore()}};
f([m.property({readOnly:!0})],a.prototype,"surface",void 0);f([m.property({readOnly:!0})],a.prototype,"items",void 0);f([m.property({readOnly:!0,dependsOn:["items.length"]})],a.prototype,"needsRender",null);return a=f([m.subclass("esri.views.overlay.ViewOverlay")],a)}(m.declared(d))})},"maquette/dist/maquette.umd":function(){(function(q,b){"object"===typeof exports&&"undefined"!==typeof module?b(exports):"function"===typeof define&&define.amd?define(["exports"],b):b(q.maquette={})})(this,function(q){var b=
[],n=function(a,c){var e={};Object.keys(a).forEach(function(c){e[c]=a[c]});c&&Object.keys(c).forEach(function(a){e[a]=c[a]});return e},f=function(a,c){return a.vnodeSelector!==c.vnodeSelector?!1:a.properties&&c.properties?a.properties.key!==c.properties.key?!1:a.properties.bind===c.properties.bind:!a.properties&&!c.properties},k=function(a){if("string"!==typeof a)throw Error("Style values must be strings");},d=function(a,c,e,d){var g=a[c];if(""!==g.vnodeSelector){var l=g.properties;if(!(l&&(void 0===
l.key?l.bind:l.key)))for(l=0;l<a.length;l++)if(l!==c&&f(a[l],g))throw Error(e.vnodeSelector+" had a "+g.vnodeSelector+" child "+("added"===d?d:"removed")+", but there is now more than one. You must add unique key properties to make them distinguishable.");}},h=[],m=!1,p=function(a){(a.children||[]).forEach(p);a.properties&&a.properties.afterRemoved&&a.properties.afterRemoved.apply(a.properties.bind||a.properties,[a.domNode])},c=function(){m=!1;h.forEach(p);h.length=0},a=function(a){h.push(a);m||(m=
!0,"undefined"!==typeof window&&"requestIdleCallback"in window?window.requestIdleCallback(c,{timeout:16}):setTimeout(c,16))},l=function(c){var e=c.domNode;if(c.properties){var d=c.properties.exitAnimation;if(d){e.style.pointerEvents="none";d(e,function(){e.parentNode&&(e.parentNode.removeChild(e),a(c))},c.properties);return}}e.parentNode&&(e.parentNode.removeChild(e),a(c))},g=function(a,c,e){if(c)for(var d=e.eventHandlerInterceptor,g=Object.keys(c),l=g.length,h=function(l){l=g[l];var h=c[l];if("className"===
l)throw Error('Property "className" is not supported, use "class".');if("class"===l)r(a,h,!0);else if("classes"===l){var b=Object.keys(h),f=b.length;for(l=0;l<f;l++){var m=b[l];h[m]&&a.classList.add(m)}}else if("styles"===l)for(b=Object.keys(h),f=b.length,l=0;l<f;l++){var m=b[l],u=h[m];u&&(k(u),e.styleApplyer(a,m,u))}else"key"!==l&&null!==h&&void 0!==h&&(b=typeof h,"function"===b?0===l.lastIndexOf("on",0)&&(d&&(h=d(l,h,a,c)),"oninput"===l&&function(){var a=h;h=function(c){a.apply(this,[c]);c.target["oninput-value"]=
c.target.value}}(),a[l]=h):"http://www.w3.org/2000/svg"===e.namespace?"href"===l?a.setAttributeNS("http://www.w3.org/1999/xlink",l,h):a.setAttribute(l,h):"string"===b&&"value"!==l&&"innerHTML"!==l?a.setAttribute(l,h):a[l]=h)},b=0;b<l;b++)h(b)},e=function(a,c,e){var d=c.children;if(d)for(var l=0;l<d.length;l++)u(d[l],a,void 0,e);c.text&&(a.textContent=c.text);g(a,c.properties,e);c.properties&&c.properties.afterCreate&&c.properties.afterCreate.apply(c.properties.bind||c.properties,[a,e,c.vnodeSelector,
c.properties,c.children])},u=function(a,c,d,g){var l,h=0,b=a.vnodeSelector,f=c.ownerDocument;if(""===b)l=a.domNode=f.createTextNode(a.text),void 0!==d?c.insertBefore(l,d):c.appendChild(l);else{for(var r=0;r<=b.length;++r){var m=b.charAt(r);if(r===b.length||"."===m||"#"===m)m=b.charAt(h-1),h=b.slice(h,r),"."===m?l.classList.add(h):"#"===m?l.id=h:("svg"===h&&(g=n(g,{namespace:"http://www.w3.org/2000/svg"})),void 0!==g.namespace?l=a.domNode=f.createElementNS(g.namespace,h):(l=a.domNode=a.domNode||f.createElement(h),
"input"===h&&a.properties&&void 0!==a.properties.type&&l.setAttribute("type",a.properties.type)),void 0!==d?c.insertBefore(l,d):l.parentNode!==c&&c.appendChild(l)),h=r+1}e(l,a,g)}},t,r=function(a,c,e){c&&c.split(" ").forEach(function(c){return a.classList.toggle(c,e)})};t=function(a,c,e){var g=a.domNode;if(a===c)return!1;var h=!1;if(""===c.vnodeSelector){if(c.text!==a.text)return a=g.ownerDocument.createTextNode(c.text),g.parentNode.replaceChild(a,g),c.domNode=a,!0;c.domNode=g}else{0===c.vnodeSelector.lastIndexOf("svg",
0)&&(e=n(e,{namespace:"http://www.w3.org/2000/svg"}));a.text!==c.text&&(h=!0,void 0===c.text?g.removeChild(g.firstChild):g.textContent=c.text);c.domNode=g;var m;m=a.children;var p=c.children,y=e;if(m===p)m=!1;else{m=m||b;for(var p=p||b,x=m.length,z=p.length,v=0,w=0,A=!1;w<z;){var B=v<x?m[v]:void 0,C=p[w];if(void 0!==B&&f(B,C))A=t(B,C,y)||A,v++;else{b:{var B=m,F=C;if(""!==F.vnodeSelector)for(var E=v+1;E<B.length;E++)if(f(B[E],F)){B=E;break b}B=-1}if(0<=B){for(;v<B;v++)l(m[v]),d(m,v,c,"removed");A=
t(m[B],C,y)||A;v=B+1}else u(C,g,v<x?m[v].domNode:void 0,y),C.properties&&(B=C.properties.enterAnimation)&&B(C.domNode,C.properties),d(p,w,c,"added")}w++}if(x>v)for(;v<x;v++)l(m[v]),d(m,v,c,"removed");m=A}h=m||h;m=a.properties;p=c.properties;y=e;if(p){x=!1;z=Object.keys(p);w=z.length;for(A=0;A<w;A++)if(B=z[A],C=p[B],v=m[B],"class"===B)v!==C&&(r(g,v,!1),r(g,C,!0));else if("classes"===B)for(var F=g.classList,E=Object.keys(C),q=E.length,B=0;B<q;B++){var V=E[B],X=!!C[V];X!==!!v[V]&&(x=!0,X?F.add(V):F.remove(V))}else if("styles"===
B)for(F=Object.keys(C),E=F.length,B=0;B<E;B++)q=F[B],V=C[q],V!==v[q]&&(x=!0,V?(k(V),y.styleApplyer(g,q,V)):y.styleApplyer(g,q,""));else C||"string"!==typeof v||(C=""),"value"===B?(F=g[B],F!==C&&(g["oninput-value"]?F===g["oninput-value"]:C!==v)&&(g[B]=C,g["oninput-value"]=void 0),C!==v&&(x=!0)):C!==v&&(v=typeof C,"function"===v&&y.eventHandlerInterceptor||("http://www.w3.org/2000/svg"===y.namespace?"href"===B?g.setAttributeNS("http://www.w3.org/1999/xlink",B,C):g.setAttribute(B,C):"string"===v&&"innerHTML"!==
B?"role"===B&&""===C?g.removeAttribute(B):g.setAttribute(B,C):g[B]!==C&&(g[B]=C),x=!0));m=x}else m=void 0;h=m||h;c.properties&&c.properties.afterUpdate&&c.properties.afterUpdate.apply(c.properties.bind||c.properties,[g,e,c.vnodeSelector,c.properties,c.children])}h&&c.properties&&c.properties.updateAnimation&&c.properties.updateAnimation(g,c.properties,a.properties);return!1};var y=function(a,c){return{getLastRender:function(){return a},update:function(e){if(a.vnodeSelector!==e.vnodeSelector)throw Error("The selector for the root VNode may not be changed. (consider using dom.merge and add one extra level to the virtual DOM)");
var d=a;a=e;t(d,e,c)},domNode:a.domNode}},w={namespace:void 0,performanceLogger:function(){},eventHandlerInterceptor:void 0,styleApplyer:function(a,c,e){a.style[c]=e}},x={create:function(a,c){c=n(w,c);u(a,document.createElement("div"),void 0,c);return y(a,c)},append:function(a,c,e){e=n(w,e);u(c,a,void 0,e);return y(c,e)},insertBefore:function(a,c,e){e=n(w,e);u(c,a.parentNode,a,e);return y(c,e)},merge:function(a,c,d){d=n(w,d);c.domNode=a;e(a,c,d);return y(c,d)},replace:function(a,c,e){e=n(w,e);u(c,
a.parentNode,a,e);a.parentNode.removeChild(a);return y(c,e)}},v=function(a,c,e){for(var d=0,g=c.length;d<g;d++){var l=c[d];Array.isArray(l)?v(a,l,e):null!==l&&void 0!==l&&!1!==l&&("string"===typeof l&&(l={vnodeSelector:"",properties:void 0,children:void 0,text:l.toString(),domNode:null}),e.push(l))}},z;z=Array.prototype.find?function(a,c){return a.find(c)}:function(a,c){return a.filter(c)[0]};var A=function(a,c){var e=a;c.forEach(function(a){e=e&&e.children?z(e.children,function(c){return c.domNode===
a}):void 0});return e},B=function(a,c,e){var d=function(d){e("domEvent",d);var g=c(),l;l=d.currentTarget;for(var h=g.domNode,b=[];l!==h;)b.push(l),l=l.parentNode;l=b;l.reverse();g=A(g.getLastRender(),l);a.scheduleRender();var f;g&&(f=g.properties["on"+d.type].apply(g.properties.bind||this,arguments));e("domEventProcessed",d);return f};return function(a,c,e,g){return d}};q.dom=x;q.h=function(a,c,e){if(Array.isArray(c))e=c,c=void 0;else if(c&&("string"===typeof c||c.hasOwnProperty("vnodeSelector"))||
e&&("string"===typeof e||e.hasOwnProperty("vnodeSelector")))throw Error("h called with invalid arguments");var d,g;e&&1===e.length&&"string"===typeof e[0]?d=e[0]:e&&(g=[],v(a,e,g),0===g.length&&(g=void 0));return{vnodeSelector:a,properties:c,children:g,text:""===d?void 0:d,domNode:null}};q.createProjector=function(a){var c,e=n(w,a),d=e.performanceLogger,g=!0,l,h=!1,b=[],f=[],r=function(a,g,l){var h;e.eventHandlerInterceptor=B(c,function(){return h},d);h=a(g,l(),e);b.push(h);f.push(l)},m=function(){l=
void 0;if(g){g=!1;d("renderStart",void 0);for(var a=0;a<b.length;a++){var c=f[a]();d("rendered",void 0);b[a].update(c);d("patched",void 0)}d("renderDone",void 0);g=!0}};return c={renderNow:m,scheduleRender:function(){l||h||(l=requestAnimationFrame(m))},stop:function(){l&&(cancelAnimationFrame(l),l=void 0);h=!0},resume:function(){h=!1;g=!0;c.scheduleRender()},append:function(a,c){r(x.append,a,c)},insertBefore:function(a,c){r(x.insertBefore,a,c)},merge:function(a,c){r(x.merge,a,c)},replace:function(a,
c){r(x.replace,a,c)},detach:function(a){for(var c=0;c<f.length;c++)if(f[c]===a)return f.splice(c,1),b.splice(c,1)[0];throw Error("renderFunction was not found");}}};q.createCache=function(){var a,c;return{invalidate:function(){a=c=void 0},result:function(e,d){if(a)for(var g=0;g<e.length;g++)a[g]!==e[g]&&(c=void 0);c||(c=d(),a=e);return c}}};q.createMapping=function(a,c,e){var d=[],g=[];return{results:g,map:function(l){for(var h=l.map(a),b=g.slice(),f=0,r=0;r<l.length;r++){var m=l[r],u=h[r];if(u===
d[f])g[r]=b[f],e(m,b[f],r),f++;else{for(var p=!1,t=1;t<d.length+1;t++){var k=(f+t)%d.length;if(d[k]===u){g[r]=b[k];e(l[r],b[k],r);f=k+1;p=!0;break}}p||(g[r]=c(m,r))}}g.length=l.length;d=h}}};Object.defineProperty(q,"__esModule",{value:!0})})},"esri/widgets/Popup":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper dojo/dom-geometry dojo/i18n!../nls/common dojo/i18n!./Popup/nls/Popup dojo/keys ../core/Handles ../core/lang ../core/Logger ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators ./Spinner ./Widget ./Popup/PopupViewModel ./support/widget ./support/widgetUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z){function A(a,c){return void 0===c?"esri-popup__"+a:"esri-popup__"+a+"-"+c}function B(){return h(this,void 0,void 0,function(){return d(this,function(a){return[2,u.create(function(a){q(["./Feature"],function(c){a(c)})})]})})}var C={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},E=e.getLogger("esri.widgets.Popup");return function(e){function b(a){var c=e.call(this)||this;c._blurContainer=!1;c._containerNode=null;c._mainContainerNode=null;
c._featureMenuNode=null;c._actionsMenuNode=null;c._focusContainer=!1;c._focusDockButton=!1;c._focusFeatureMenuButton=!1;c._focusActionsMenuButton=!1;c._focusFirstFeature=!1;c._focusFirstAction=!1;c._handles=new l;c._pointerOffsetInPx=16;c._spinner=null;c.actions=null;c.actionsMenuEnabled=!0;c.alignment="auto";c.autoCloseEnabled=null;c.autoOpenEnabled=null;c.defaultPopupTemplateEnabled=null;c.content=null;c.collapsed=!1;c.collapseEnabled=!0;c.dockEnabled=!1;c.featureCount=null;c.features=null;c.featureNavigationEnabled=
!0;c.goToOverride=null;c.highlightEnabled=null;c.location=null;c.featureWidgets=[];c.promises=null;c.selectedFeature=null;c.selectedFeatureIndex=null;c.selectedFeatureWidget=null;c.spinnerEnabled=!0;c.title=null;c.updateLocationEnabled=null;c.view=null;c.viewModel=new x;c.visible=null;c._addSelectedFeatureIndexHandle();c.own([t.watch(c,"viewModel.screenLocation",function(){return c._positionContainer()}),t.watch(c,["viewModel.visible","dockEnabled"],function(){return c._toggleScreenLocationEnabled()}),
t.watch(c,"viewModel.screenLocation",function(a,e){!!a!==!!e&&c.reposition()}),t.watch(c,"viewModel.features",function(){return c._updateFeatureWidgets()}),t.watch(c,"viewModel.view.padding viewModel.view.size viewModel.visible viewModel.waitingForResult viewModel.location alignment".split(" "),function(){return c.reposition()}),t.watch(c,"spinnerEnabled",function(a){return c._spinnerEnabledChange(a)}),t.watch(c,"viewModel.view.size",function(a,e){return c._updateDockEnabledForViewSize(a,e)}),t.watch(c,
"viewModel.view",function(a,e){return c._viewChange(a,e)}),t.watch(c,"viewModel.view.ready",function(a,e){return c._viewReadyChange(a,e)}),t.watch(c,["viewModel.waitingForResult","viewModel.location"],function(){return c._displaySpinner()}),t.watch(c,["featureWidgets","viewModel.selectedFeatureIndex"],function(){return c._updateFeatureWidget()}),t.watch(c,"selectedFeatureWidget.viewModel.title",function(a){return c._setTitleFromFeatureWidget(a)}),t.watch(c,["selectedFeatureWidget.viewModel.content",
"selectedFeatureWidget.viewModel.waitingForContent"],function(){return c._setContentFromFeatureWidget()}),t.whenFalse(c,"collapsed",function(){"xsmall"===c.get("viewModel.view.widthBreakpoint")&&c.visible&&c.collapseEnabled&&c.viewModel.centerAtLocation()})]);return c}n(b,e);b.prototype.destroy=function(){this._destroyFeatureWidgets();this._destroySpinner();this._handles&&this._handles.destroy();this.viewModel=this._handles=null};Object.defineProperty(b.prototype,"actionsMenuOpen",{get:function(){return this.viewModel.visible&&
this.actionsMenuEnabled?this._get("actionsMenuOpen"):!1},set:function(a){this._set("actionsMenuOpen",!!a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"currentAlignment",{get:function(){return this._getCurrentAlignment()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"currentDockPosition",{get:function(){return this._getCurrentDockPosition()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"dockOptions",{get:function(){return this._get("dockOptions")||
C},set:function(a){var c=k({},C),e=this.get("viewModel.view.breakpoints"),d={};e&&(d.width=e.xsmall,d.height=e.xsmall);a=k({},c,a);c=k({},c.breakpoint,d);d=a.breakpoint;!0===d?a.breakpoint=c:"object"===typeof d&&(a.breakpoint=k({},c,d));this._set("dockOptions",a);this._setCurrentDockPosition();this.reposition()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"featureMenuOpen",{get:function(){return this.viewModel.visible?this._get("featureMenuOpen"):!1},set:function(a){this._set("featureMenuOpen",
!!a)},enumerable:!0,configurable:!0});b.prototype.blur=function(){this.visible||E.warn("Popup cannot be blurred while visible is false");this._blurContainer=!0;this.scheduleRender()};b.prototype.clear=function(){};b.prototype.close=function(){this.visible=!1};b.prototype.focus=function(){this.visible||E.warn("Popup cannot be focused while visible is false");this._focusContainer=!0;this.scheduleRender()};b.prototype.next=function(){return null};b.prototype.open=function(a){this._handles.remove("selected-index");
var c={collapsed:a?!!a.collapsed:!1,actionsMenuOpen:a?!!a.actionsMenuOpen:!1,featureMenuOpen:a?!!a.featureMenuOpen:!1};"xsmall"===this.get("viewModel.view.widthBreakpoint")&&(c.collapsed=!0,a.updateLocationEnabled=!0);this.set(c);this.viewModel.open(a);this._addSelectedFeatureIndexHandle()};b.prototype.previous=function(){return null};b.prototype.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};b.prototype.triggerAction=function(a){return null};b.prototype.render=
function(){var a=this,e,d,l,b,h,f,r=this.actionsMenuOpen,m=this.collapsed,u=this.collapseEnabled,t=this.dockEnabled,k=this.featureMenuOpen,y=this.featureNavigationEnabled,x=this.featureWidgets,n=this.visible,w=this.actionsMenuEnabled,B=this.viewModel,C=B.allActions,H=B.content,F=B.featureCount,E=B.pendingPromisesCount,q=B.selectedFeatureIndex,Z=B.title,Y=C&&C.length,ea=1<F&&y,y=1<F&&k,C=1<Y&&r,ga=ea&&this._getPageText(F,q),ja=this._renderContent(),fa=z.isRTL(),ha=!!(this.get("selectedFeatureWidget")?
this.get("selectedFeatureWidget.viewModel.waitingForContent")||this.get("selectedFeatureWidget.viewModel.content"):ja),B=(u=!!(u&&Z&&ha))&&!y&&m,ka=this.get("viewModel.view.widthBreakpoint"),ia=t?c.undock:c.dock,m=this.currentAlignment,F=this.currentDockPosition,E=E?v.tsx("div",{key:A("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":p.loading,title:p.loading},v.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-loading-indicator",
"esri-rotating")})):null,ma=(e={},e["esri-icon-right-triangle-arrow"]=fa,e["esri-popup__pagination-previous-icon--rtl"]=fa,e["esri-icon-left-triangle-arrow"]=!fa,e["esri-popup__pagination-previous-icon"]=!fa,e);e=v.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",ma)});ma=v.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes("esri-popup__button","esri-popup__pagination-previous"),"aria-label":c.previous,title:c.previous},
e);e=(d={},d["esri-icon-left-triangle-arrow"]=fa,d["esri-popup__pagination-next-icon--rtl"]=fa,d["esri-icon-right-triangle-arrow"]=!fa,d["esri-popup__pagination-next-icon"]=!fa,d);d=v.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",e)});fa=v.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes("esri-popup__button","esri-popup__pagination-next"),"aria-label":c.next,title:c.next},d);e=z.cssTransition("enter","esri-popup--feature-updated");
d=this.id+"-feature-menu";k=v.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes("esri-popup__button","esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":d,"aria-expanded":k,"aria-label":p.menu,title:p.menu},ga);ga=ea?[ma,E||k,fa]:null;k=this._wouldDockTo();k=(l={},l["esri-icon-minimize"]=t,l["esri-popup__icon--dock-icon"]=
!t,l["esri-icon-dock-right"]=!t&&("top-right"===k||"bottom-right"===k),l["esri-icon-dock-left"]=!t&&("top-left"===k||"bottom-left"===k),l["esri-icon-maximize"]=!t&&"top-center"===k,l["esri-icon-dock-bottom"]=!t&&"bottom-center"===k,l);l=v.tsx("span",{"aria-hidden":"true",class:this.classes(k,"esri-popup__icon")});l="xsmall"!==ka&&this.get("dockOptions.buttonEnabled")?v.tsx("div",{role:"button","aria-label":ia,title:ia,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,
afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes("esri-popup__button","esri-popup__button--dock")},l):null;k=(b={},b["esri-popup__header-container--button"]=u,b);ka=u?"button":"heading";ia=u?B?p.expand:p.collapse:"";b=this.id+"-popup-title";Z=Z?v.tsx("div",{class:this.classes("esri-popup__header-container",k),key:Z,enterAnimation:e,id:b,role:ka,"aria-label":ia,title:ia,tabIndex:u?0:-1,bind:this,onclick:this._toggleCollapsed,onkeydown:this._toggleCollapsed},
v.tsx("h2",{class:"esri-popup__header-title",innerHTML:Z})):null;k=v.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-close")});k=v.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:"esri-popup__button","aria-label":p.close,title:p.close},k);l=v.tsx("header",{class:"esri-popup__header"},Z,v.tsx("div",{class:"esri-popup__header-buttons"},l,k));var k=this.id+"-popup-content",H=!ha||u&&B?null:v.tsx("article",{key:H,enterAnimation:e,
id:k,class:"esri-popup__content"},ja),ha="bottom-left"===m||"bottom-center"===m||"bottom-right"===m||"top-left"===F||"top-center"===F||"top-right"===F,ja="top-left"===m||"top-center"===m||"top-right"===m||"bottom-left"===F||"bottom-center"===F||"bottom-right"===F,ka=r?p.close:p.open,na=this._getInlineActions();e=(e=na&&na.toArray().map(function(c,e){return a._renderAction({action:c,index:e,key:"actions",type:"inline",showText:2>na.length})}))?v.tsx("div",{key:"inline-actions-container",class:"esri-popup__inline-actions-container"},
e):null;w=w&&Y&&!e?v.tsx("div",{key:A("actions-menu-button"),class:this.classes("esri-popup__button","esri-popup__actions-menu-button"),role:"button",id:this.id+"-actions-menu-button","aria-haspopup":"true","aria-controls":r?this.id+"-actions-menu":null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":ka,title:ka},v.tsx("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):
null;ga=ea?v.tsx("section",{key:A("navigation"),class:this.classes("esri-popup__navigation")},ga):null;w=ea||Y?v.tsx("div",{key:A("feature-buttons"),class:"esri-popup__footer"},ga,w,e):null;r=Y&&r?v.tsx("ul",{id:this.id+"-actions-menu",role:"menu","aria-labelledby":this.id+"-actions-menu-button",key:A("actions"),class:"esri-popup__actions",bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},this._renderActions()):null;q=
this._renderFeatureMenuNode(x,q,d);x=g.substitute({total:x.length},c.selectedFeatures);ea=v.tsx("section",{key:A("menu"),class:"esri-popup__feature-menu"},v.tsx("h2",{class:"esri-popup__feature-menu-header"},x),v.tsx("nav",{class:"esri-popup__feature-menu-viewport",afterCreate:this._featureMenuViewportNodeUpdated,afterUpdate:this._featureMenuViewportNodeUpdated},q));x=t?null:v.tsx("div",{key:A("pointer"),class:"esri-popup__pointer",role:"presentation"},v.tsx("div",{class:this.classes("esri-popup__pointer-direction",
"esri-popup--shadow")}));q=this.get("selectedFeature.layer.title");Y=this.get("selectedFeature.layer.id");u=(h={},h["esri-popup--shadow"]=t,h["esri-popup--is-collapsible"]=u,h["esri-popup--is-collapsed"]=B,h);h=(f={},f["esri-popup--aligned-top-center"]=n&&"top-center"===m,f["esri-popup--aligned-bottom-center"]=n&&"bottom-center"===m,f["esri-popup--aligned-top-left"]=n&&"top-left"===m,f["esri-popup--aligned-bottom-left"]=n&&"bottom-left"===m,f["esri-popup--aligned-top-right"]=n&&"top-right"===m,f["esri-popup--aligned-bottom-right"]=
"bottom-right"===m,f["esri-popup--is-docked"]=n&&t,f["esri-popup--shadow"]=n&&!t,f["esri-popup--is-docked-top-left"]=n&&"top-left"===F,f["esri-popup--is-docked-top-center"]=n&&"top-center"===F,f["esri-popup--is-docked-top-right"]=n&&"top-right"===F,f["esri-popup--is-docked-bottom-left"]=n&&"bottom-left"===F,f["esri-popup--is-docked-bottom-center"]=n&&"bottom-center"===F,f["esri-popup--is-docked-bottom-right"]=n&&"bottom-right"===F,f["esri-popup--feature-menu-open"]=n&&y,f["esri-popup--actions-menu-open"]=
n&&C,f);f=ha?[ea,r]:null;t=ja?[ea,r]:null;y=ha?w:null;C=ja?w:null;f=v.tsx("div",{class:this.classes("esri-popup__main-container","esri-widget",u),tabIndex:-1,role:"dialog","aria-labelledby":Z?b:"","aria-describedby":H?k:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,afterUpdate:this._mainContainerNodeUpdated},y,f,l,H,C,t);return v.tsx("div",{key:A("base"),class:this.classes("esri-popup",h),role:"presentation","data-layer-title":q,"data-layer-id":Y,bind:this,
afterCreate:this._positionContainer,afterUpdate:this._positionContainer},n?[f,x]:null)};b.prototype._getInlineActions=function(){var a=this.viewModel.allActions;if(!(this.actionsMenuEnabled&&2<=a.length))return a};b.prototype._featureMenuOpenChanged=function(a){a?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0};b.prototype._actionsMenuOpenChanged=function(a){a?this._focusFirstAction=!0:this._focusActionsMenuButton=!0};b.prototype._setTitleFromFeatureWidget=function(a){this.selectedFeatureWidget&&
(this.viewModel.title=a||"")};b.prototype._setContentFromFeatureWidget=function(){var a=this.selectedFeatureWidget;a&&(this.viewModel.content=a)};b.prototype._handleFeatureMenuKeyup=function(c){c.keyCode===a.ESCAPE&&(c.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())};b.prototype._handleActionMenuKeyup=function(c){c.keyCode===a.ESCAPE&&(c.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())};b.prototype._handleFeatureMenuItemKeyup=
function(c){var e=c.keyCode,d=this._featureMenuNode,g=c.currentTarget["data-feature-index"];if(d){var d=d.querySelectorAll("li"),l=d.length;e===a.UP_ARROW?(c.stopPropagation(),d[(g-1+l)%l].focus()):e===a.DOWN_ARROW?(c.stopPropagation(),d[(g+1+l)%l].focus()):e===a.HOME?(c.stopPropagation(),d[0].focus()):e===a.END&&(c.stopPropagation(),d[d.length-1].focus())}};b.prototype._handleActionMenuItemKeyup=function(c){var e=c.keyCode,d=this._actionsMenuNode,g=c.currentTarget["data-action-index"];if(d){var d=
d.querySelectorAll("li"),l=d.length;e===a.UP_ARROW?(c.stopPropagation(),d[(g-1+l)%l].focus()):e===a.DOWN_ARROW?(c.stopPropagation(),d[(g+1+l)%l].focus()):e===a.HOME?(c.stopPropagation(),d[0].focus()):e===a.END&&(c.stopPropagation(),d[d.length-1].focus())}};b.prototype._handleMainKeyup=function(c){var e=c.keyCode;e===a.LEFT_ARROW&&(c.stopPropagation(),this.previous());e===a.RIGHT_ARROW&&(c.stopPropagation(),this.next())};b.prototype._spinnerEnabledChange=function(a){this._destroySpinner();a&&(a=this.get("viewModel.view"),
this._createSpinner(a))};b.prototype._displaySpinner=function(){var a=this._spinner;if(a){var c=this.viewModel,e=c.location;c.waitingForResult?a.show({location:e}):a.hide()}};b.prototype._getIconStyles=function(a){return{"background-image":a?"url("+a+")":""}};b.prototype._renderAction=function(a){var c=this,e,d,l=a.action,b=a.index,h=a.key,f=a.type;a=a.showText;var r=t.watch(l,"active className disabled id title image visible".split(" "),function(){return c.scheduleRender()});this._handles.add(r,
h);var r=this.get("selectedFeature.attributes"),h=l.title,m=l.className,u=l.image,m=u||m?m:"esri-icon-default-action",h=h&&r?g.substitute(r,h):h,p=m&&r?g.substitute(r,m):m,r=u&&r?g.substitute(r,u):u,u=(e={},e["esri-icon-loading-indicator"]=l.active,e["esri-rotating"]=l.active,e["esri-popup__icon"]=!!m,e["esri-popup__action-image"]=!l.active&&!!r,e);p&&(u[p]=!l.active);e=(d={},d["esri-popup__action"]="toggle"!==l.type,d["esri-popup__action-toggle"]="toggle"===l.type,d["esri-popup__action-toggle--on"]=
"toggle"===l.type&&l.value,d["esri-popup__button--disabled"]=l.disabled,d);d=a?v.tsx("span",{key:"text",class:"esri-popup__action-text"},h):null;d=[v.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes("esri-popup__icon",u),styles:this._getIconStyles(r)}),d];b="menu-item"===f?v.tsx("li",{key:l,role:"menuitem",tabIndex:0,title:h,"aria-label":h,class:this.classes("esri-popup__button",e),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":b,onclick:this._triggerAction,onkeydown:this._triggerAction},
d):v.tsx("div",{key:l,role:"button",tabIndex:0,title:h,"aria-label":h,class:this.classes("esri-popup__button",e),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-index":b,onclick:this._triggerAction,onkeydown:this._triggerAction},d);return l.visible?b:null};b.prototype._renderActions=function(){var a=this;this._handles.remove("actions");var c=this.viewModel.allActions;if(c)return c.map(function(c,e){return a._renderAction({action:c,index:e,key:"actions",type:"menu-item",showText:!0})}).toArray()};
b.prototype._addSelectedFeatureIndexHandle=function(){var a=this,c=t.watch(this,"viewModel.selectedFeatureIndex",function(c,e){return a._selectedFeatureIndexUpdated(c,e)});this._handles.add(c,"selected-index")};b.prototype._selectedFeatureIndexUpdated=function(a,c){this.featureCount&&a!==c&&-1!==a&&(this.featureMenuOpen=this.actionsMenuOpen=!1)};b.prototype._updateFeatureWidget=function(){this._set("selectedFeatureWidget",this.featureWidgets[this.viewModel.selectedFeatureIndex]||null)};b.prototype._destroyFeatureWidgets=
function(){this.featureWidgets.forEach(function(a){return a.destroy()});this._set("featureWidgets",[])};b.prototype._updateFeatureWidgets=function(){return h(this,void 0,void 0,function(){var a,c,e,g,l,b,h=this;return d(this,function(d){switch(d.label){case 0:return a=this,c=a.features,e=a.featureWidgets,c&&c.length?[4,B()]:(e.forEach(function(a){return a.destroy()}),this._set("featureWidgets",[]),[2]);case 1:return g=d.sent(),l=e.slice(0),b=[],c.forEach(function(a,c){if(a){var e=null;l.some(function(c,
d){c&&c.graphic===a&&(e=c,l.splice(d,1));return!!e});if(e)b[c]=e;else{var d=new g({defaultPopupTemplateEnabled:h.defaultPopupTemplateEnabled,graphic:a,spatialReference:h.get("view.spatialReference"),map:h.get("view.map")});d.visibleElements=k({},d.visibleElements,{title:!1});b[c]=d}}}),l.forEach(function(a){return a&&a.destroy()}),this._set("featureWidgets",b),[2]}})})};b.prototype._isScreenLocationWithinView=function(a,c){return-1<a.x&&-1<a.y&&a.x<=c.width&&a.y<=c.height};b.prototype._isOutsideView=
function(a){var c=a.popupHeight,e=a.popupWidth,d=a.screenLocation,g=a.side;a=a.view;if(isNaN(e)||isNaN(c)||!a||!d)return!1;var l=a.padding;return"right"===g&&d.x+e/2>a.width-l.right||"left"===g&&d.x-e/2<l.left||"top"===g&&d.y-c<l.top||"bottom"===g&&d.y+c>a.height-l.bottom?!0:!1};b.prototype._determineCurrentAlignment=function(){var a=this._pointerOffsetInPx,c=this._containerNode,e=this._mainContainerNode,d=this.viewModel,g=d.screenLocation,d=d.view;if(!g||!d||!c)return"top-center";if(!this._isScreenLocationWithinView(g,
d))return this._get("currentAlignment")||"top-center";var l=e?window.getComputedStyle(e,null):null,e=l?parseInt(l.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,l=l?parseInt(l.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0,b=m.getContentBox(c),c=b.w+a,b=Math.max(b.h,e,l)+a,a=this._isOutsideView({popupHeight:b,popupWidth:c,screenLocation:g,side:"right",view:d}),e=this._isOutsideView({popupHeight:b,popupWidth:c,screenLocation:g,side:"left",view:d}),l=this._isOutsideView({popupHeight:b,
popupWidth:c,screenLocation:g,side:"top",view:d}),g=this._isOutsideView({popupHeight:b,popupWidth:c,screenLocation:g,side:"bottom",view:d});return e?l?"bottom-right":"top-right":a?l?"bottom-left":"top-left":l?g?"top-center":"bottom-center":"top-center"};b.prototype._getCurrentAlignment=function(){var a=this.alignment;return this.dockEnabled?null:"auto"===a?this._determineCurrentAlignment():"function"===typeof a?a.call(this):a};b.prototype._setCurrentAlignment=function(){this._set("currentAlignment",
this._getCurrentAlignment())};b.prototype._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())};b.prototype._getDockPosition=function(){var a=this.get("dockOptions.position");return"auto"===a?this._determineCurrentDockPosition():"function"===typeof a?a.call(this):a};b.prototype._getCurrentDockPosition=function(){return this.dockEnabled?this._getDockPosition():null};b.prototype._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};
b.prototype._renderFeatureMenuItemNode=function(a,e,d){var g,l=e===d,b=(g={},g["esri-popup__feature-menu-item--selected"]=l,g);g=l?v.tsx("span",{key:A("feature-menu-selected-feature-"+d),title:c.selectedFeature,"aria-label":c.selectedFeature,class:"esri-icon-check-mark"}):null;a=v.tsx("span",{innerHTML:a.title||p.untitled});return v.tsx("li",{role:"menuitem",tabIndex:-1,key:A("feature-menu-feature-"+d),class:this.classes(b,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":e,onkeyup:this._handleFeatureMenuItemKeyup,
onclick:this._selectFeature,onkeydown:this._selectFeature},v.tsx("span",{class:"esri-popup__feature-menu-title"},a,g))};b.prototype._renderFeatureMenuNode=function(a,c,e){var d=this;return 1<a.length?v.tsx("ol",{class:"esri-popup__feature-menu-list",id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},a.map(function(a,e){return d._renderFeatureMenuItemNode(a,e,c)})):null};b.prototype._determineCurrentDockPosition=
function(){var a=this.get("viewModel.view"),c=z.isRTL()?"top-left":"top-right";if(!a)return c;var e=a.padding||{left:0,right:0,top:0,bottom:0},e=a.width-e.left-e.right;return(a=a.get("breakpoints"))&&e<=a.xsmall?"bottom-center":c};b.prototype._renderContent=function(){var a=this.get("viewModel.content");if(!a)return null;if("string"===typeof a)return v.tsx("div",{key:a,innerHTML:a});if(v.isWidget(a))return v.tsx("div",{key:a},a.render());if(a instanceof HTMLElement)return v.tsx("div",{key:a,bind:a,
afterCreate:this._attachToNode});if(v.isWidgetBase(a))return v.tsx("div",{key:a,bind:a.domNode,afterCreate:this._attachToNode})};b.prototype._attachToNode=function(a){a.appendChild(this)};b.prototype._positionContainer=function(a){void 0===a&&(a=this._containerNode);a&&(this._containerNode=a);if(a){var c=this.viewModel.screenLocation,e=m.getContentBox(a);if(c=this._calculatePositionStyle(c,e))a.style.top=c.top,a.style.left=c.left,a.style.bottom=c.bottom,a.style.right=c.right}};b.prototype._calculateFullWidth=
function(a){var c=this.currentAlignment,e=this._pointerOffsetInPx;return"top-left"===c||"bottom-left"===c||"top-right"===c||"bottom-right"===c?a+e:a};b.prototype._calculateAlignmentPosition=function(a,c,e,d){var g=this.currentAlignment,l=this._pointerOffsetInPx;d/=2;var b=e.height-c;e=e.width-a;var h=this.view.padding;if("bottom-center"===g)return{top:c+l-h.top,left:a-d-h.left};if("top-left"===g)return{bottom:b+l-h.bottom,right:e+l-h.right};if("bottom-left"===g)return{top:c+l-h.top,right:e+l-h.right};
if("top-right"===g)return{bottom:b+l-h.bottom,left:a+l-h.left};if("bottom-right"===g)return{top:c+l-h.top,left:a+l-h.left};if("top-center"===g)return{bottom:b+l-h.bottom,left:a-d-h.left}};b.prototype._calculatePositionStyle=function(a,c){var e=this.view;if(e){if(this.dockEnabled)return{left:"",top:"",right:"",bottom:""};if(a&&c&&(c=this._calculateFullWidth(c.w),a=this._calculateAlignmentPosition(a.x,a.y,e,c)))return{top:void 0!==a.top?a.top+"px":"auto",left:void 0!==a.left?a.left+"px":"auto",bottom:void 0!==
a.bottom?a.bottom+"px":"auto",right:void 0!==a.right?a.right+"px":"auto"}}};b.prototype._viewChange=function(a,c){a&&c&&(this.close(),this.clear())};b.prototype._viewReadyChange=function(a,c){a?(a=this.get("viewModel.view"),this._wireUpView(a)):c&&(this.close(),this.clear())};b.prototype._wireUpView=function(a){this._destroySpinner();a&&(this.spinnerEnabled&&this._createSpinner(a),this._setDockEnabledForViewSize(this.dockOptions))};b.prototype._dockingThresholdCrossed=function(a,c,e){var d=a[0];a=
a[1];var g=c[0];c=c[1];var l=e.width;e=e.height;return d<=l&&g>l||d>l&&g<=l||a<=e&&c>e||a>e&&c<=e};b.prototype._updateDockEnabledForViewSize=function(a,c){if(a&&c){var e=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},d=e.left+e.right,g=e.top+e.bottom,e=[],l=[];e[0]=a[0]-d;e[1]=a[1]-g;l[0]=c[0]-d;l[1]=c[1]-g;a=this.dockOptions;this._dockingThresholdCrossed(e,l,a.breakpoint)&&this._setDockEnabledForViewSize(a);this._setCurrentDockPosition()}};b.prototype._focusDockButtonNode=function(a){this._focusDockButton&&
(this._focusDockButton=!1,a.focus())};b.prototype._mainContainerNodeUpdated=function(a){this._mainContainerNode=a;this._focusContainer?(this._focusContainer=!1,a.focus()):this._blurContainer&&(this._blurContainer=!1,a.blur())};b.prototype._featureMenuNodeUpdated=function(a){(this._featureMenuNode=a)&&this._focusFirstFeature&&(this._focusFirstFeature=!1,a=a.querySelectorAll("li"),a.length&&a[0].focus())};b.prototype._actionsMenuNodeUpdated=function(a){(this._actionsMenuNode=a)&&this._focusFirstAction&&
(this._focusFirstAction=!1,a=a.querySelectorAll("li"),a.length&&a[0].focus())};b.prototype._focusFeatureMenuButtonNode=function(a){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,a.focus())};b.prototype._focusActionsMenuButtonNode=function(a){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,a.focus())};b.prototype._featureMenuViewportNodeUpdated=function(a){a&&(a.scrollTop=0)};b.prototype._toggleScreenLocationEnabled=function(){var a=this.dockEnabled,c=this.viewModel;
c&&(c.screenLocationEnabled=this.visible&&!a)};b.prototype._shouldDockAtCurrentViewSize=function(a){a=a.breakpoint;var c=this.get("viewModel.view.ui"),e=c.width,c=c.height;if(isNaN(e)||isNaN(c))return!1;e=a.hasOwnProperty("width")&&e<=a.width;a=a.hasOwnProperty("height")&&c<=a.height;return e||a};b.prototype._setDockEnabledForViewSize=function(a){a.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(a))};b.prototype._getPageText=function(a,e){return g.substitute({index:e+1,total:a},c.pageText)};
b.prototype._destroySpinner=function(){var a=this._spinner,c=this.view;a&&(c&&c.ui.remove(this._spinner,"popup-spinner"),a.destroy(),this._spinner=null)};b.prototype._createSpinner=function(a){a&&(this._spinner=new y({view:a}),a.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))};b.prototype._toggleCollapsed=function(){this.collapsed=!this.collapsed};b.prototype._close=function(){this.close();this.view&&this.view.focus()};b.prototype._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled;
this._focusDockButton=!0;this.scheduleRender()};b.prototype._toggleFeatureMenu=function(){var a=!this.featureMenuOpen;this._featureMenuOpenChanged(a);this.actionsMenuOpen=!1;this.featureMenuOpen=a};b.prototype._toggleActionsMenu=function(){var a=!this.actionsMenuOpen;this._actionsMenuOpenChanged(a);this.featureMenuOpen=!1;this.actionsMenuOpen=a};b.prototype._triggerAction=function(a){a=a.currentTarget["data-action-index"];var c=this.viewModel.allActions.getItemAt(a);c&&"toggle"===c.type&&(c.value=
!c.value);this.actionsMenuOpen=!1;this.viewModel.triggerAction(a)};b.prototype._selectFeature=function(a){a=a.currentTarget["data-feature-index"];isNaN(a)||(this.viewModel.selectedFeatureIndex=a);this._focusFeatureMenuButton=!0;this.scheduleRender()};b.prototype._next=function(){this.next()};b.prototype._previous=function(){this.previous()};f([r.aliasOf("viewModel.actions"),v.renderable()],b.prototype,"actions",void 0);f([r.property({dependsOn:["viewModel.visible","actionsMenuEnabled"]}),v.renderable()],
b.prototype,"actionsMenuOpen",null);f([r.property(),v.renderable()],b.prototype,"actionsMenuEnabled",void 0);f([r.property()],b.prototype,"alignment",void 0);f([r.aliasOf("viewModel.autoCloseEnabled")],b.prototype,"autoCloseEnabled",void 0);f([r.aliasOf("viewModel.autoOpenEnabled")],b.prototype,"autoOpenEnabled",void 0);f([r.aliasOf("viewModel.defaultPopupTemplateEnabled")],b.prototype,"defaultPopupTemplateEnabled",void 0);f([r.aliasOf("viewModel.content"),v.renderable()],b.prototype,"content",void 0);
f([r.property(),v.renderable()],b.prototype,"collapsed",void 0);f([r.property(),v.renderable()],b.prototype,"collapseEnabled",void 0);f([r.property({readOnly:!0,dependsOn:["dockEnabled","alignment"]}),v.renderable()],b.prototype,"currentAlignment",null);f([r.property({readOnly:!0,dependsOn:["viewModel.view.ready","dockEnabled","dockOptions"]}),v.renderable()],b.prototype,"currentDockPosition",null);f([r.property(),v.renderable()],b.prototype,"dockOptions",null);f([r.property(),v.renderable()],b.prototype,
"dockEnabled",void 0);f([r.aliasOf("viewModel.featureCount"),v.renderable()],b.prototype,"featureCount",void 0);f([r.property({dependsOn:["viewModel.visible"]}),v.renderable()],b.prototype,"featureMenuOpen",null);f([r.aliasOf("viewModel.features"),v.renderable()],b.prototype,"features",void 0);f([r.property(),v.renderable()],b.prototype,"featureNavigationEnabled",void 0);f([r.aliasOf("viewModel.goToOverride")],b.prototype,"goToOverride",void 0);f([r.aliasOf("viewModel.highlightEnabled")],b.prototype,
"highlightEnabled",void 0);f([r.aliasOf("viewModel.location"),v.renderable()],b.prototype,"location",void 0);f([r.property({readOnly:!0}),v.renderable()],b.prototype,"featureWidgets",void 0);f([r.aliasOf("viewModel.promises")],b.prototype,"promises",void 0);f([r.aliasOf("viewModel.selectedFeature"),v.renderable()],b.prototype,"selectedFeature",void 0);f([r.aliasOf("viewModel.selectedFeatureIndex"),v.renderable()],b.prototype,"selectedFeatureIndex",void 0);f([r.property({readOnly:!0}),v.renderable()],
b.prototype,"selectedFeatureWidget",void 0);f([r.property()],b.prototype,"spinnerEnabled",void 0);f([r.aliasOf("viewModel.title"),v.renderable()],b.prototype,"title",void 0);f([r.aliasOf("viewModel.updateLocationEnabled")],b.prototype,"updateLocationEnabled",void 0);f([r.aliasOf("viewModel.view")],b.prototype,"view",void 0);f([r.property({type:x}),v.renderable("viewModel.view.widthBreakpoint viewModel.allActions viewModel.screenLocation viewModel.screenLocationEnabled viewModel.state viewModel.pendingPromisesCount viewModel.promiseCount viewModel.waitingForResult".split(" ")),
v.vmEvent(["triggerAction","trigger-action"])],b.prototype,"viewModel",void 0);f([r.aliasOf("viewModel.visible"),v.renderable()],b.prototype,"visible",void 0);f([r.aliasOf("viewModel.clear")],b.prototype,"clear",null);f([r.aliasOf("viewModel.next")],b.prototype,"next",null);f([r.aliasOf("viewModel.previous")],b.prototype,"previous",null);f([r.aliasOf("viewModel.triggerAction")],b.prototype,"triggerAction",null);f([v.accessibleHandler()],b.prototype,"_toggleCollapsed",null);f([v.accessibleHandler()],
b.prototype,"_close",null);f([v.accessibleHandler()],b.prototype,"_toggleDockEnabled",null);f([v.accessibleHandler()],b.prototype,"_toggleFeatureMenu",null);f([v.accessibleHandler()],b.prototype,"_toggleActionsMenu",null);f([v.accessibleHandler()],b.prototype,"_triggerAction",null);f([v.accessibleHandler()],b.prototype,"_selectFeature",null);f([v.accessibleHandler()],b.prototype,"_next",null);f([v.accessibleHandler()],b.prototype,"_previous",null);return b=f([r.subclass("esri.widgets.Popup")],b)}(r.declared(w))})},
"esri/widgets/Spinner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./support/AnchorElementViewModel ./support/widget".split(" "),function(q,b,n,f,k,d,h,m,p,c){return function(a){function l(c){c=a.call(this)||this;c._animationDelay=500;c._animationPromise=null;c.location=null;c.view=null;c.visible=!1;c.viewModel=new p;return c}n(l,a);l.prototype.postInitialize=
function(){var a=this;this.own([d.watch(this,"visible",function(c){return a._visibleChange(c)})])};l.prototype.destroy=function(){this._cancelAnimationPromise()};l.prototype.show=function(a){var c=this,d=a.location;a=a.promise;d&&(this.viewModel.location=d);this.visible=!0;d=function(){return c.hide()};a&&a.catch(function(){}).then(d)};l.prototype.hide=function(){this.visible=!1};l.prototype.render=function(){var a,e=this.visible,d=!!this.viewModel.screenLocation,e=(a={},a["esri-spinner--start"]=
e&&d,a["esri-spinner--finish"]=!e&&d,a);a=this._getPositionStyles();return c.tsx("div",{class:this.classes("esri-spinner",e),styles:a})};l.prototype._cancelAnimationPromise=function(){var a=this._animationPromise;a&&a.cancel();this._animationPromise=null};l.prototype._visibleChange=function(a){var c=this;a?this.viewModel.screenLocationEnabled=!0:(this._cancelAnimationPromise(),this._animationPromise=k.after(this._animationDelay).then(function(){c.viewModel.screenLocationEnabled=!1;c._animationPromise=
null}))};l.prototype._getPositionStyles=function(){var a=this.viewModel,c=a.screenLocation,a=a.view;if(!a||!c)return{};a=a.padding;return{left:c.x-a.left+"px",top:c.y-a.top+"px"}};f([h.aliasOf("viewModel.location")],l.prototype,"location",void 0);f([h.aliasOf("viewModel.view")],l.prototype,"view",void 0);f([h.property(),c.renderable()],l.prototype,"visible",void 0);f([h.property({type:p}),c.renderable(["viewModel.screenLocation","viewModel.screenLocationEnabled"])],l.prototype,"viewModel",void 0);
return l=f([h.subclass("esri.widgets.Spinner")],l)}(h.declared(m))})},"esri/widgets/Widget":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/dom ../core/Accessor ../core/Collection ../core/Evented ../core/Handles ../core/Logger ../core/watchUtils ../core/accessorSupport/decorators ./support/widget maquette".split(" "),function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u){var t=a.getLogger("esri.widgets.Widget"),r=0;return function(a){function b(e,
d){e=a.call(this)||this;e._attached=!1;e.destroyed=!1;e.domNode=null;e.iconClass="esri-icon-checkbox-unchecked";e.label=e.declaredClass.split(".").pop();e.visible=!0;e._internalHandles=new c;e.render=e.render.bind(e);return e}f(b,a);b.prototype.normalizeCtorArgs=function(a,c){a=n({},a);c&&(a.container=c);return a};b.prototype.initialize=function(){var a=this;this._internalHandles.add(this._renderableProps.map(function(c){return l.init(a,c,function(a,e){var d=this;m.isCollection(e)&&this._internalHandles.remove(this.declaredClass+
":"+c+"-collection-change-event-listener");m.isCollection(a)&&(a=a.on("change",function(){return d.scheduleRender()}),this._internalHandles.add(a,this.declaredClass+":"+c+"-collection-change-event-listener"));this.scheduleRender()})}));this._delegatedEventNames.length&&this._internalHandles.add(l.init(this,"viewModel",function(){a._get("viewModel")&&a._internalHandles.remove("delegated-events");a._delegatedEventNames.map(function(c){return a.viewModel.on(c,function(e){a.emit(c,e)})})}),"delegated-events");
this.postInitialize();this._internalHandles.add(l.whenOnce(this,"container",function(c){return a._attach(c)}))};b.prototype.postInitialize=function(){};b.prototype.destroy=function(){this.destroyed||(this.viewModel&&this.viewModel.destroy(),this._detach(this.container),this._internalHandles.destroy(),this._set("destroyed",!0))};b.prototype.startup=function(){t.warn("Widget.startup() is deprecated and no longer needed")};Object.defineProperty(b.prototype,"container",{set:function(a){this._get("container")||
this._set("container",a)},enumerable:!0,configurable:!0});b.prototype.castContainer=function(a){return d.byId(a)};Object.defineProperty(b.prototype,"id",{get:function(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+r++},set:function(a){a&&this._set("id",a)},enumerable:!0,configurable:!0});b.prototype.scheduleRender=function(){this._projector.scheduleRender()};b.prototype.on=function(a,c){var e=this.inherited(arguments);this._internalHandles.add(e);return e};
b.prototype.classes=function(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];return e.classes.apply(this,a)};b.prototype.own=function(a){1<arguments.length&&(a=Array.prototype.slice.call(arguments));this._internalHandles.add(a)};b.prototype.renderNow=function(){this._projector.renderNow()};b.prototype._attach=function(a){a&&(this._projector.merge(a,this.render),this._attached=!0)};b.prototype._detach=function(a){a&&this._attached&&(this._projector.detach(this.render),a.parentNode&&a.parentNode.removeChild(a),
this._attached=!1)};k([g.shared(u.createProjector())],b.prototype,"_projector",void 0);k([g.shared([])],b.prototype,"_renderableProps",void 0);k([g.shared([])],b.prototype,"_delegatedEventNames",void 0);k([g.property({value:null})],b.prototype,"container",null);k([g.cast("container")],b.prototype,"castContainer",null);k([g.property({readOnly:!0})],b.prototype,"destroyed",void 0);k([g.property({aliasOf:"container"})],b.prototype,"domNode",void 0);k([g.property()],b.prototype,"iconClass",void 0);k([g.property({dependsOn:["container"]})],
b.prototype,"id",null);k([g.property()],b.prototype,"label",void 0);k([g.property()],b.prototype,"viewModel",void 0);k([g.property()],b.prototype,"visible",void 0);return b=k([g.subclass("esri.widgets.Widget")],b)}(g.declared(h,p))})},"esri/widgets/support/AnchorElementViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),
function(q,b,n,f,k,d,h,m,p,c){return function(a){function d(c){var e=a.call(this)||this;e._anchorHandles=new h;e.location=null;e.screenLocation=null;e.screenLocationEnabled=!1;e.view=null;e._anchorHandles.add([p.watch(e,["screenLocationEnabled","location","view.size","view.stationary"],function(){return e._updateScreenPointAndHandle()}),p.watch(e,["view","view.ready"],function(){return e._wireUpView()})]);return e}n(d,a);d.prototype.destroy=function(){this.view=null;this._anchorHandles&&this._anchorHandles.destroy();
this._viewpointHandle=this._anchorHandles=null};d.prototype._wireUpView=function(){var a=this;this._anchorHandles.remove("view");this._viewpointHandle=null;if(this.get("view.ready")){this._setScreenLocation();var c=this.view,c=m.pausable(c,"3d"===c.type?"camera":"viewpoint",function(){return a._viewpointChange()});this._anchorHandles.add(c,"view");this._viewpointHandle=c;this._toggleWatchingViewpoint()}};d.prototype._viewpointChange=function(){this._setScreenLocation();this.emit("view-change")};d.prototype._updateScreenPointAndHandle=
function(){this._setScreenLocation();this._toggleWatchingViewpoint()};d.prototype._toggleWatchingViewpoint=function(){var a=this._viewpointHandle,c=this.screenLocationEnabled;a&&(this.location&&c?a.resume():a.pause())};d.prototype._setScreenLocation=function(){var a=this.location,c=this.view,d=this.screenLocationEnabled,l=this.get("view.ready"),a=d&&a&&l?c.toScreen(a):null;this._set("screenLocation",a)};f([c.property()],d.prototype,"location",void 0);f([c.property({readOnly:!0})],d.prototype,"screenLocation",
void 0);f([c.property()],d.prototype,"screenLocationEnabled",void 0);f([c.property()],d.prototype,"view",void 0);return d=f([c.subclass("esri.widgets.support.AnchorElementViewModel")],d)}(c.declared(k,d))})},"esri/widgets/Popup/PopupViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../geometry ../../core/Collection ../../core/compilerUtils ../../core/Error ../../core/Handles ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/support/webMercatorUtils ../../support/actions/ActionBase ../../support/actions/ActionButton ../../support/actions/ActionToggle ../../views/support/layerViewUtils ./actions ../support/AnchorElementViewModel ../support/GoTo".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z){var A=h.ofType({key:"type",defaultKeyValue:"button",base:t,typeMap:{button:r,toggle:y}}),B=new A([x.zoomToFeature.clone()]),C=a.getLogger("esri.widgets.Popup.PopupViewModel");return function(a){function b(e){e=a.call(this)||this;e._handles=new c;e._pendingPromises=new Set;e._zoomToLocation=null;e._fetchingFeatures=null;e.actions=B;e.defaultPopupTemplateEnabled=!1;e.autoCloseEnabled=!1;e.autoOpenEnabled=!0;e.content=null;e.highlightEnabled=!0;e.title=
null;e.updateLocationEnabled=!1;e.view=null;e.visible=!1;e.zoomFactor=4;return e}n(b,a);b.prototype.initialize=function(){var a=this;this._handles.add([g.init(this,"autoOpenEnabled",this._autoOpenEnabledChange),this.on("view-change",this._autoClose),g.watch(this,["highlightEnabled","selectedFeature","visible","view"],this._highlightFeature),g.watch(this,"view.animation.state",function(c){a._zoomToLocation||(x.zoomToFeature.disabled="waiting-for-target"===c)}),this.on("trigger-action",function(c){return x.triggerAction({event:c,
view:a.view})})])};b.prototype.destroy=function(){this._cancelFetchingFeatures();this._handles.destroy();this._handles=null;this._pendingPromises.clear();this.view=null};Object.defineProperty(b.prototype,"allActions",{get:function(){var a=this._get("allActions")||new A;a.removeAll();var c=this.selectedFeature&&("function"===typeof this.selectedFeature.getEffectivePopupTemplate&&this.selectedFeature.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled)||this.selectedFeature.popupTemplate),e=
c&&c.actions;(c=c&&c.overwriteActions?e:this.actions.concat(e))&&c.filter(Boolean).forEach(function(c){return a.add(c)});return a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"featureCount",{get:function(){return this.features.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"features",{get:function(){return this._get("features")||[]},set:function(a){a=a||[];this._set("features",a);var c=this.pendingPromisesCount,e=this.selectedFeatureIndex,d=this.promiseCount&&
a.length;d&&c&&-1===e?this.selectedFeatureIndex=0:d&&-1!==e||(this.selectedFeatureIndex=a.length?0:-1)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"location",{get:function(){return this._get("location")||null},set:function(a){var c=this.get("location"),e=this.get("view.spatialReference.isWebMercator");a&&a.get("spatialReference.isWGS84")&&e&&(a=u.geographicToWebMercator(a));this._set("location",a);a!==c&&this._centerAtLocation()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"pendingPromisesCount",{get:function(){return this._pendingPromises.size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"waitingForResult",{get:function(){return 0<this.pendingPromisesCount&&0===this.featureCount},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"promiseCount",{get:function(){return this.promises.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"promises",{get:function(){return this._get("promises")||[]},set:function(a){var c=
this,e=this._get("promises");e&&e.forEach(function(a){a&&"function"===typeof a.cancel&&a.cancel()});this._pendingPromises.clear();this.features=[];Array.isArray(a)&&a.length?(this._set("promises",a),a=a.slice(0),a.forEach(function(a){c._pendingPromises.add(a);a.then(function(e){c._updatePendingPromises(a);c._updateFeatures(e)},function(){return c._updatePendingPromises(a)})})):this._set("promises",[]);this.notifyChange("pendingPromisesCount")},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"selectedFeature",{get:function(){var a=this.location,c=this.selectedFeatureIndex;if(-1===c)return null;c=this.features[c];if(!c)return null;!this.updateLocationEnabled&&a||!c.geometry||(this.location=this._getPointFromGeometry(c.geometry));return c},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"selectedFeatureIndex",{get:function(){var a=this._get("selectedFeatureIndex");return"number"===typeof a?a:-1},set:function(a){var c=this.featureCount;a=isNaN(a)||-1>a||!c?-1:(a+c)%c;this._set("selectedFeatureIndex",
a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});b.prototype.centerAtLocation=function(){var a=this.view,c=this._getSelectedTarget();return c?this.callGoTo({target:{target:c,scale:a.scale}}):(a=new p("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:c,view:a}),C.error(a),l.reject(a))};b.prototype.clear=function(){this.set({promises:[],
features:[],content:null,title:null,location:null})};b.prototype.open=function(a){this.set(k({visible:!1},{updateLocationEnabled:!1,promises:[]},a));this._setVisibleWhenContentExists()};b.prototype.triggerAction=function(a){(a=this.allActions.getItemAt(a))&&this.emit("trigger-action",{action:a})};b.prototype.next=function(){this.selectedFeatureIndex+=1;return this};b.prototype.previous=function(){--this.selectedFeatureIndex;return this};b.prototype.zoomToLocation=function(){var a=this,c=this.location,
e=this.selectedFeature,d=this.view,g=this.zoomFactor,b=this._getSelectedTarget();if(!b)return c=new p("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:b,view:d}),C.error(c),l.reject(c);var d=d.scale/g,h=this.get("selectedFeature.geometry")||c,f=h&&"point"===h.type&&this._isScreenSize(e);x.zoomToFeature.active=!0;x.zoomToFeature.disabled=!0;return this._zoomToLocation=c=this.callGoTo({target:{target:b,scale:f?d:void 0}}).then(function(){f&&(a.location=h);
x.zoomToFeature.active=!1;x.zoomToFeature.disabled=!1;a._zoomToLocation=null}).catch(function(){x.zoomToFeature.active=!1;x.zoomToFeature.disabled=!1;a._zoomToLocation=null})};b.prototype._getSelectedTarget=function(){var a=this.selectedFeature,c=this.location,e=this.view;if(!e)return null;var e="3d"===e.type,d=this.get("selectedFeature.geometry");return e?a||c:d||c};b.prototype._fetchFeatures=function(a){var c=this.view;return c&&a?c.fetchPopupFeatures(a,{defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled}):
(a=new p("fetch-features:invalid-screenPoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:a,view:c}),C.error(a),l.reject(a))};b.prototype._autoOpenEnabledChange=function(){var a=this,c=this._handles,e=this.autoOpenEnabled;c.remove("auto-fetch-features");e&&(e=g.on(this,"view","click",function(c){a.view.toolViewManager.handlesClickEvent(c)||"mouse"===c.pointerType&&0!==c.button||a._fetchFeaturesAndOpen(c)}),c.add(e,"auto-fetch-features"))};b.prototype._cancelFetchingFeatures=
function(){var a=this._fetchingFeatures;a&&a.cancel();this._fetchingFeatures=null};b.prototype._fetchFeaturesAndOpen=function(a){var c=this,e=a.screenPoint,d=a.mapPoint,g=this.view;this._cancelFetchingFeatures();this._fetchingFeatures=this._fetchFeatures(e).then(function(a){var e=a.promises,l=a.location;c._fetchingFeatures=null;g.popup.open({location:l||d,promises:e});return a})};b.prototype._updatePendingPromises=function(a){a&&this._pendingPromises.has(a)&&(this._pendingPromises.delete(a),this.notifyChange("pendingPromisesCount"))};
b.prototype._setVisibleWhenContentExists=function(){var a=this,c=this._handles,e=this.promiseCount;c.remove("pendingVisible");e?(e=g.init(this,"pendingPromisesCount",function(e){a.featureCount&&(a.set("visible",!0),c.remove("pendingVisible"));e||c.remove("pendingVisible")}),c.add(e,"pendingVisible")):this.set("visible",!0)};b.prototype._autoClose=function(){this.autoCloseEnabled&&(this.visible=!1)};b.prototype._isScreenSize=function(a){var c=this.view;if("3d"!==c.type||!a||"esri.Graphic"!==a.declaredClass)return!0;
if((c=c.getViewForGraphic(a))&&"whenGraphicBounds"in c){var e=!1;c.whenGraphicBounds(a,{useViewElevation:!0}).then(function(a){e=!a||!a.boundingBox||a.boundingBox[0]===a.boundingBox[3]&&a.boundingBox[1]===a.boundingBox[4]&&a.boundingBox[2]===a.boundingBox[5]});return e}return!0};b.prototype._getPointFromGeometry=function(a){return a?"point"===a.type?a:"extent"===a.type?a.center:"polygon"===a.type?a.centroid:"multipoint"===a.type||"polyline"===a.type?a.extent.center:null:null};b.prototype._isLocationOffScreen=
function(a){return a?(a=this.view.toScreen(a))?!(0<=a.x&&a.x<=this.view.width&&0<=a.y&&a.y<=this.view.height):!1:!1};b.prototype._centerAtLocation=function(){var a=this.location;this.updateLocationEnabled&&a&&this._isLocationOffScreen(a)&&this.centerAtLocation()};b.prototype._highlightFeature=function(){var a=this;this._handles.remove("highlight");var c=this.selectedFeature,e=this.highlightEnabled,d=this.view,g=this.visible;if(c&&d&&e&&g){var l=c.layer;l&&d.when().then(function(){m.typeCast(d)().whenLayerView(l).then(function(e){if(e&&
w.hasHighlight(e)){var d=l.objectIdField,g=c.attributes;e=e.highlight(g&&g[d]||c);a._handles.add(e,"highlight")}})})}};b.prototype._updateFeatures=function(a){var c=this.features;a&&a.length&&(c.length?(a=a.filter(function(a){return-1===c.indexOf(a)}),this.features=c.concat(a)):this.features=a)};f([e.property({type:A})],b.prototype,"actions",void 0);f([e.property({dependsOn:["actions.length","selectedFeature.sourceLayer.popupTemplate.actions.length","selectedFeature.sourceLayer.popupTemplate.overwriteActions",
"selectedFeature.popupTemplate.actions.length","selectedFeature.popupTemplate.overwriteActions"],readOnly:!0})],b.prototype,"allActions",null);f([e.property({type:Boolean})],b.prototype,"defaultPopupTemplateEnabled",void 0);f([e.property()],b.prototype,"autoCloseEnabled",void 0);f([e.property()],b.prototype,"autoOpenEnabled",void 0);f([e.property()],b.prototype,"content",void 0);f([e.property({readOnly:!0,dependsOn:["features"]})],b.prototype,"featureCount",null);f([e.property()],b.prototype,"features",
null);f([e.property()],b.prototype,"highlightEnabled",void 0);f([e.property({type:d.Point})],b.prototype,"location",null);f([e.property({readOnly:!0,dependsOn:["promises"]})],b.prototype,"pendingPromisesCount",null);f([e.property({readOnly:!0,dependsOn:["featureCount","pendingPromisesCount"]})],b.prototype,"waitingForResult",null);f([e.property({readOnly:!0,dependsOn:["promises"]})],b.prototype,"promiseCount",null);f([e.property()],b.prototype,"promises",null);f([e.property({value:null,readOnly:!0,
dependsOn:["features","selectedFeatureIndex","updateLocationEnabled"]})],b.prototype,"selectedFeature",null);f([e.property({value:-1})],b.prototype,"selectedFeatureIndex",null);f([e.property({readOnly:!0,dependsOn:["view.ready"]})],b.prototype,"state",null);f([e.property()],b.prototype,"title",void 0);f([e.property()],b.prototype,"updateLocationEnabled",void 0);f([e.property()],b.prototype,"view",void 0);f([e.property()],b.prototype,"visible",void 0);f([e.property()],b.prototype,"zoomFactor",void 0);
f([e.property()],b.prototype,"centerAtLocation",null);f([e.property()],b.prototype,"clear",null);f([e.property()],b.prototype,"triggerAction",null);f([e.property()],b.prototype,"next",null);f([e.property()],b.prototype,"previous",null);f([e.property()],b.prototype,"zoomToLocation",null);return b=f([e.subclass("esri.widgets.Popup.PopupViewModel")],b)}(e.declared(v,z))})},"esri/views/support/layerViewUtils":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});
b.hasHighlight=function(b){return b&&"function"===typeof b.highlight}})},"esri/widgets/Popup/actions":function(){define("require exports dojo/i18n!../../nls/common dojo/i18n!./nls/Popup ../../core/Error ../../core/promiseUtils ../../support/actions/ActionButton".split(" "),function(q,b,n,f,k,d,h){Object.defineProperty(b,"__esModule",{value:!0});b.zoomToFeature=new h({id:"zoom-to-feature",title:f.zoom,className:"esri-icon-zoom-in-magnifying-glass"});b.removeSelectedFeature=new h({id:"remove-selected-feature",
title:n.remove,className:"esri-icon-trash"});b.all=[b.zoomToFeature,b.removeSelectedFeature];b.triggerAction=function(h){var f=h.view;h=h.event.action;var c=f&&f.popup;if(!h)return d.reject(new k("trigger-action:missing-arguments","Event has no action"));if(!c)return d.reject(new k("trigger-action:missing-arguments","view.popup is missing"));var a=h.disabled,l=h.id;if(!l)return d.reject(new k("trigger-action:invalid-action","action.id is missing"));if(a)return d.reject(new k("trigger-action:invalid-action",
"Action is disabled"));if(l===b.zoomToFeature.id)return c.viewModel.zoomToLocation();if(l===b.removeSelectedFeature.id){c.close();h=c.selectedFeature;if(!h)return d.reject(new k("trigger-action:"+b.removeSelectedFeature.id,"selectedFeature is required",{selectedFeature:h}));(c=h.sourceLayer)?c.remove(h):f.graphics.remove(h);return d.resolve()}return d.reject(new k("trigger-action:unknown-action","Unable to identify action to perform",{action:h,popup:c}))}})},"esri/widgets/support/GoTo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(q,b,n,f,k,d){return function(b){function h(){var d=null!==b&&b.apply(this,arguments)||this;d.goToOverride=null;d.view=null;return d}n(h,b);h.prototype.callGoTo=function(d){var c=this.view;return this.goToOverride?this.goToOverride(c,d):c.goTo(d.target,d.options)};f([d.property()],h.prototype,"goToOverride",void 0);f([d.property()],h.prototype,"view",void 0);return h=f([d.subclass("esri.widgets.support.GoTo")],h)}(d.declared(k))})},"esri/views/GroundView":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Accessor ../core/Collection ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./support/GroundViewElevationSampler".split(" "),
function(q,b,n,f,k,d,h,m,p,c){return function(a){function l(c){c=a.call(this)||this;c.handles=new h;c.view=null;c.layerViews=new d;return c}n(l,a);l.prototype.initialize=function(){var a=this;this.handles.add(m.when(this,"view.map.ground",function(a){return a.load()}));this.handles.add(this.layerViews.on("after-changes",function(){return a.layerViewsAfterChangesHandler()}))};l.prototype.destroy=function(){this._set("view",null);this.handles&&(this.handles.destroy(),this.handles=null)};Object.defineProperty(l.prototype,
"elevationSampler",{get:function(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new c({view:this.view}):null},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"updating",{get:function(){return this.suspended?!1:this.layerViews.some(function(a){return a.updating})},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"suspended",{get:function(){return!this.view||this.view.suspended},enumerable:!0,configurable:!0});
l.prototype.layerViewsAfterChangesHandler=function(){var a=this;this.handles.remove("updating");this.handles.add(this.layerViews.map(function(c){return c.watch("updating",function(){return a.updateUpdating()},!0)}).toArray(),"updating");this.updateUpdating()};l.prototype.updateUpdating=function(){this.notifyChange("updating")};f([p.property({readOnly:!0,dependsOn:["view.ready","view.basemapTerrain?.ready"]})],l.prototype,"elevationSampler",null);f([p.property({type:Boolean,dependsOn:["suspended"],
readOnly:!0})],l.prototype,"updating",null);f([p.property({constructOnly:!0})],l.prototype,"view",void 0);f([p.property({type:d,readOnly:!0})],l.prototype,"layerViews",void 0);f([p.property({readOnly:!0,dependsOn:["view.suspended"]})],l.prototype,"suspended",null);return l=f([p.subclass("esri.views.GroundView")],l)}(p.declared(k))})},"esri/views/support/GroundViewElevationSampler":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Evented ../../core/Logger ../../core/accessorSupport/decorators ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../layers/support/ElevationSampler ../3d/terrain/TerrainConst".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g){var e=h.getLogger("esri.views.support.GroundViewElevationSampler");return function(d){function b(a){a=d.call(this,a)||this;a.demResolution={min:-1,max:-1};a.noDataValue=g.noDataValueOpt.noDataValue;return a}n(b,d);b.prototype.initialize=function(){var a=this;this.view.basemapTerrain.on("elevation-change",function(){return a.emit("changed",{})})};Object.defineProperty(b.prototype,"extent",{get:function(){var a=this.view.basemapTerrain;return a.extent&&a.spatialReference?
p.toExtent(a.extent,a.spatialReference):null},enumerable:!0,configurable:!0});b.prototype.elevationAt=function(d){var g=d.spatialReference,l=this.spatialReference;if(!a.canProject(g,l))return e.error("Cannot sample elevation at a location with spatial reference ("+(g?g.wkid:"unknown")+") different from the view ("+l.wkid+")"),null;c.extentContainsPoint(this.extent,d)||(g=this.extent,e.warn("#elevationAt()","Point used to sample elevation ("+d.x+", "+d.y+") is outside of the sampler extent ("+(g.xmin+
", "+g.ymin+", "+g.xmax+", "+g.ymax)+")"));return this.view.basemapTerrain.getElevation(d)};b.prototype.queryElevation=function(a){return l.updateGeometryElevation(a.clone(),this)};f([m.property({readOnly:!0})],b.prototype,"demResolution",void 0);f([m.property({readOnly:!0,dependsOn:["view.basemapTerrain.extent","view.basemapTerrain.spatialReference"]})],b.prototype,"extent",null);f([m.property({readOnly:!0})],b.prototype,"noDataValue",void 0);f([m.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],
b.prototype,"spatialReference",void 0);f([m.property({constructOnly:!0})],b.prototype,"view",void 0);return b=f([m.subclass("esri.views.support.GroundViewElevationSampler")],b)}(m.declared(k,d))})},"esri/layers/support/ElevationSampler":function(){define("require exports ../../geometry ../../core/compilerUtils ../../core/Logger ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),function(q,b,n,f,k,d,h,m,p){function c(c,
d){var g=a(c,d.spatialReference);if(!g)return null;switch(c.type){case "point":c.z=d.elevationAt(g)||0;break;case "polyline":e.spatialReference=g.spatialReference;for(var l=c.hasM&&!c.hasZ,b=0;b<c.paths.length;b++)for(var h=c.paths[b],r=g.paths[b],m=0;m<h.length;m++){var u=h[m],p=r[m];e.x=p[0];e.y=p[1];p=d.elevationAt(e)||0;l&&(u[3]=u[2]);u[2]=p}c.hasZ=!0;break;case "multipoint":e.spatialReference=g.spatialReference;l=c.hasM&&!c.hasZ;for(b=0;b<c.points.length;b++)h=c.points[b],r=g.points[b],e.x=r[0],
e.y=r[1],r=d.elevationAt(e)||0,l&&(h[3]=h[2]),h[2]=r;c.hasZ=!0;break;default:f.neverReached(c)}return c}function a(a,c){var e=a.spatialReference;return e.equals(c)?a:p.canProject(e,c)?p.project(a,c):(l.error("Cannot project geometry spatial reference (wkid:"+e.wkid+") to elevation sampler spatial reference (wkid:"+c.wkid+")"),null)}Object.defineProperty(b,"__esModule",{value:!0});var l=k.getLogger("esri.layers.support.ElevationSampler"),g=function(){function e(a,c,e){this.tile=a;this.noDataValue=
e;this.extent=h.toExtent(a.tile.extent,c.spatialReference);e=d.getMetersPerUnitForSR(c.spatialReference);a=c.lodAt(a.tile.level).resolution*e;this.demResolution={min:a,max:a}}Object.defineProperty(e.prototype,"spatialReference",{get:function(){return this.extent.spatialReference},enumerable:!0,configurable:!0});e.prototype.contains=function(c){c=a(c,this.spatialReference);return m.extentContainsPoint(this.extent,c)};e.prototype.elevationAt=function(c){var e=a(c,this.spatialReference);if(!e)return null;
if(!this.contains(c)){var d=this.extent;l.warn("#elevationAt()","Point used to sample elevation ("+c.x+", "+c.y+") is outside of the sampler extent ("+(d.xmin+", "+d.ymin+", "+d.xmax+", "+d.ymax)+")")}return this.tile.sample(e.x,e.y)};e.prototype.queryElevation=function(a){return c(a.clone(),this)};e.prototype.on=function(a,c){return u};return e}();b.TileElevationSampler=g;q=function(){function e(a,c,e){var d=this,l;"number"===typeof c?(this.noDataValue=c,l=null):(l=c,this.noDataValue=e);this.samplers=
l?a.map(function(a){return new g(a,l,d.noDataValue)}):a;if(a=this.samplers[0])for(this.extent=a.extent.clone(),a=a.demResolution,this.demResolution={min:a.min,max:a.max},a=1;a<this.samplers.length;a++)c=this.samplers[a],this.extent.union(c.extent),this.demResolution.min=Math.min(this.demResolution.min,c.demResolution.min),this.demResolution.max=Math.max(this.demResolution.max,c.demResolution.max);else this.extent=h.toExtent(h.create(),l.spatialReference),this.demResolution={min:0,max:0}}Object.defineProperty(e.prototype,
"spatialReference",{get:function(){return this.extent.spatialReference},enumerable:!0,configurable:!0});e.prototype.elevationAt=function(c){var e=a(c,this.spatialReference);if(!e)return null;for(var d=0,g=this.samplers;d<g.length;d++){var b=g[d];if(b.contains(e))return b.elevationAt(e)}l.warn("#elevationAt()","Point used to sample elevation ("+c.x+", "+c.y+") is outside of the sampler");return null};e.prototype.queryElevation=function(a){return c(a.clone(),this)};e.prototype.on=function(a,c){return u};
return e}();b.MultiTileElevationSampler=q;b.updateGeometryElevation=c;var e=new n.Point,u={remove:function(){}}})},"esri/views/3d/terrain/TerrainConst":function(){define(["require","exports","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});(function(b){b[b.ELEVATION=0]="ELEVATION";b[b.MAP=1]="MAP";b[b.COUNT=2]="COUNT"})(b.LayerClass||(b.LayerClass={}));(function(b){b[b.NONE=0]="NONE";b[b.SPLIT=1]="SPLIT";b[b.VSPLITMERGE=
2]="VSPLITMERGE";b[b.MERGE=4]="MERGE";b[b.GEOMETRY=8]="GEOMETRY";b[b.TEXTURE=16]="TEXTURE"})(b.TileUpdate||(b.TileUpdate={}));(function(b){b[b.BACK_TO_FRONT=-1]="BACK_TO_FRONT";b[b.NONE=0]="NONE";b[b.FRONT_TO_BACK=1]="FRONT_TO_BACK"})(b.RenderOrder||(b.RenderOrder={}));b.TILE_LOADING_DEBUGLOG=!1;b.MAX_ROOT_TILES=64;b.MAX_TILE_TESSELATION=512;b.MAX_MEMORY_LOD_BIAS=2.5;b.ELEVATION_NODATA_VALUE=3.40282347E38/10;b.noDataValueOpt={noDataValue:b.ELEVATION_NODATA_VALUE};b.START_LOADING_LEVEL_DELTA=8;b.LOADING_LEVEL_MODULO=
2;b.ELEVATION_DESIRED_RESOLUTION_LEVEL=4;b.TILEMAP_SIZE_EXP=5;b.TILEMAP_SIZE=1<<b.TILEMAP_SIZE_EXP;b.WEBMERCATOR_WORLD_EXTENT=n.create();f.WebMercatorAuxiliarySphere.getExtent(0,0,0,b.WEBMERCATOR_WORLD_EXTENT);b.GEOGRAPHIC_WORLD_EXTENT=n.create([-180,-90,180,90]);b.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";b.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";
b.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC";
b.GEOMETRY_VERTEX_STRIDE=5})},"esri/views/3d/terrain/TilingScheme":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/support/TileInfo ../support/mathUtils ../support/projectionUtils".split(" "),function(q,b,n,f,k,d,h,m,p,c){var a=c.webMercator.x2lon,l=c.webMercator.y2lat;q=function(){function c(a){var e=c._checkUnsupported(a);if(e)throw e;this.spatialReference=
a.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isWGS84=this.spatialReference.isWGS84;this.origin=[a.origin.x,a.origin.y];this.pixelSize=[a.size[0],a.size[1]];this.dpi=a.dpi;var d=a.lods.reduce(function(a,c,e){c.level<a.min&&(a.min=c.level,a.minIndex=e);a.max=Math.max(a.max,c.level);return a},{min:Infinity,minIndex:0,max:-Infinity}),g=a.lods[d.minIndex],l=Math.pow(2,g.level),e=g.resolution*l,g=g.scale*l;this.levels=Array(d.max+1);for(d=0;d<this.levels.length;d++)this.levels[d]=
{resolution:e,scale:g,tileSize:[e*a.size[0],e*a.size[1]]},e/=2,g/=2}c.prototype.clone=function(){return new c(this.toTileInfo())};c.prototype.toTileInfo=function(){return new m({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:this.pixelSize,spatialReference:this.spatialReference,lods:this.levels.map(function(a,c){return{level:c,scale:a.scale,resolution:a.resolution}})})};c.prototype.getExtent=function(c,e,d,g,b){void 0===g&&(g=h.create());var f=
this.levels[c];c=f.tileSize[0];f=f.tileSize[1];g[0]=this.origin[0]+d*c;g[2]=g[0]+c;g[3]=this.origin[1]-e*f;g[1]=g[3]-f;b&&(this._isWebMercator?(b[0]=a(g[0]),b[1]=l(g[1]),b[2]=a(g[2]),b[3]=l(g[3])):this._isWGS84&&(b[0]=p.deg2rad(g[0]),b[1]=p.deg2rad(g[1]),b[2]=p.deg2rad(g[2]),b[3]=p.deg2rad(g[3])));return g};c.prototype.getExtentGeometry=function(a,c,e,d){void 0===d&&(d=new n.Extent);this.getExtent(a,c,e,g);d.spatialReference=this.spatialReference;d.xmin=g[0];d.ymin=g[1];d.xmax=g[2];d.ymax=g[3];d.zmin=
void 0;d.zmax=void 0;return d};c.prototype.ensureMaxLod=function(a){for(;this.levels.length<=a;){var c=this.levels[this.levels.length-1],e=c.resolution/2;this.levels.push({resolution:e,scale:c.scale/2,tileSize:[e*this.pixelSize[0],e*this.pixelSize[1]]})}};c.prototype.capMaxLod=function(a){this.levels.length>a+1&&(this.levels.length=a+1)};c.prototype.getMaxLod=function(){return this.levels.length-1};c.prototype.scaleAtLevel=function(a){return this.levels[0].scale/Math.pow(2,a)};c.prototype.levelAtScale=
function(a){var c=this.levels[0].scale;return a>=c?0:Math.log(c/a)*Math.LOG2E};c.prototype.resolutionAtLevel=function(a){return this.levels[0].resolution/Math.pow(2,a)};c.prototype.compatibleWith=function(a){if(!(a instanceof c)){if(c._checkUnsupported(a))return!1;a=new c(a)}if(!a.spatialReference.equals(this.spatialReference)||a.pixelSize[0]!==this.pixelSize[0]||a.pixelSize[1]!==this.pixelSize[1])return!1;var e=Math.min(this.levels.length,a.levels.length)-1,d=this.levels[e].resolution,g=.5*d;if(!p.floatEqualAbsolute(a.origin[0],
this.origin[0],g)||!p.floatEqualAbsolute(a.origin[1],this.origin[1],g))return!1;g=.5*d/Math.pow(2,e)/Math.max(this.pixelSize[0],this.pixelSize[1])*12;return p.floatEqualAbsolute(d,a.levels[e].resolution,g)};c.prototype.rootTilesInExtent=function(a,e,d){var l=this.levels[0].tileSize;if(0===l[0]||0===l[1])return[];c.computeRowColExtent(a,l,this.origin,g);a=g[1];var b=g[3],h=g[0],f=g[2],m=f-h,r=b-a;m*r>d&&(d=Math.floor(Math.sqrt(d)),r>d&&(a=a+Math.floor(.5*r)-Math.floor(.5*d),b=a+d),m>d&&(h=h+Math.floor(.5*
m)-Math.floor(.5*d),f=h+d));d=Array((f-h)*(b-a));m=0;for(r=a;r<b;r++)for(var u=h;u<f;u++)d[m++]=[0,r,u];e&&(e[0]=this.origin[0]+h*l[0],e[1]=this.origin[1]-b*l[1],e[2]=this.origin[0]+f*l[0],e[3]=this.origin[1]-a*l[1]);return d};c.computeRowColExtent=function(a,c,e,d){var g=.001*(a[2]-a[0]+(a[3]-a[1]));d[0]=Math.floor((a[0]+g-e[0])/c[0]);d[2]=Math.ceil((a[2]-g-e[0])/c[0]);d[1]=Math.floor((e[1]-a[3]+g)/c[1]);d[3]=Math.ceil((e[1]-a[1]-g)/c[1])};c.isPowerOfTwo=function(a){a=a.lods;var c=a[0].resolution*
Math.pow(2,a[0].level);return!a.some(function(a){return!p.floatEqualRelative(a.resolution,c/Math.pow(2,a.level))})};c.hasGapInLevels=function(a){a=a.lods.map(function(a){return a.level});a.sort(function(a,c){return a-c});for(var c=1;c<a.length;c++)if(a[c]!==a[0]+c)return!0;return!1};c.tileSizeSupported=function(a){var c=a.size[1];return c===a.size[0]&&0===(c&c-1)&&128<=c&&512>=c};c._checkUnsupported=function(a){return a?1>a.lods.length?new f("tilingscheme:generic","Tiling scheme must have at least one level"):
c.isPowerOfTwo(a)?null:new f("tilingscheme:power-of-two","Tiling scheme must be power of two"):new f("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};c.checkUnsupported=function(a){var e=c._checkUnsupported(a);return e?e:c.hasGapInLevels(a)?new f("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):c.tileSizeSupported(a)?null:new f("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]")};c.fromExtent=
function(a,e){var d=a[2]-a[0],g=a[3]-a[1],l=k.getMetersPerUnitForSR(e),b=1.2*Math.max(d,g);a=new c(new m({size:[256,256],origin:{x:a[0]-.5*(b-d),y:a[3]+.5*(b-g)},lods:[{level:0,resolution:b/256,scale:1/(256/96*.0254/(b*l))}],spatialReference:e}));a.ensureMaxLod(20);return a};c.makeWebMercatorAuxiliarySphere=function(a){void 0===a&&(a=19);var e=new c(c.WebMercatorAuxiliarySphereTileInfo);e.ensureMaxLod(a);return e};c.makeWGS84WithTileSize=function(a,e){void 0===e&&(e=16);var g=256/a;a=new c(new m({size:[a,
a],origin:{x:-180,y:90,spatialReference:d.WGS84},spatialReference:d.WGS84,lods:[{level:0,resolution:.703125*g,scale:2.95497598570834E8*g}]}));a.ensureMaxLod(e);return a};c.WebMercatorAuxiliarySphereTileInfo=new m({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:d.WebMercator},spatialReference:d.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]});c.WebMercatorAuxiliarySphere=c.makeWebMercatorAuxiliarySphere(19);return c}();var g=h.create();
return q})},"esri/views/3d/support/projectionUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../layers/graphics/dehydratedFeatures ./earthUtils ./mathUtils ../webgl-engine/lib/BufferVectorMath".split(" "),function(q,b,n,f,k,d,h,m,p,c,a,l){function g(a,c,d,g){2===a.length?(D[0]=a[0],D[1]=a[1],
D[2]=0,a=D):a===d&&(f.vec3.copy(D,a),a=D);return e(a,c,0,d,g,0,1)}function e(a,c,e,d,g,l,b){void 0===b&&(b=1);w!==c&&(x=u(c),w=c);v!==g&&(z=u(g),v=g);b=e+3*b;if(x!==z||0===x&&!c.equals(g))if(0<x&&0<z)if(2!==z)if(c=A[z],2!==x)for(g=B[x];e<b;e+=3,l+=3)g(a,e,G,0),c(G,0,d,l);else for(;e<b;e+=3,l+=3)c(a,e,d,l);else for(g=B[x];e<b;e+=3,l+=3)g(a,e,d,l);else return!1;else if(d!==a||e!==l)for(;e<b;e++,l++)d[l]=a[e];return!0}function u(a){return a.wkt===b.SphericalECEFSpatialReference.wkt?1:a.isWGS84?2:a.isWebMercator?
3:a.wkt===b.WGS84ECEFSpatialReference.wkt?4:0}function t(a,c,e,d){e[d++]=a[c++];e[d++]=a[c++];e[d]=a[c]}function r(c,e,d,g){var l=.4999999*Math.PI,l=a.clamp(C*c[e+1],-l,l),l=Math.sin(l);d[g++]=C*c[e]*F;d[g++]=F/2*Math.log((1+l)/(1-l));d[g]=c[e+2]}function y(a,c,e,d){var g=F+a[c+2],l=C*a[c+1];a=C*a[c];c=Math.cos(l);e[d++]=Math.cos(a)*c*g;e[d++]=Math.sin(a)*c*g;e[d]=Math.sin(l)*g}Object.defineProperty(b,"__esModule",{value:!0});b.SphericalECEFSpatialReference=new h({wkt:'GEOCCS["Spherical geocentric",\n  DATUM["Not specified",\n    SPHEROID["Sphere",\' + earthUtils.earthRadius + \',0]],\n  PRIMEM["Greenwich",0.0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",EAST],\n  AXIS["Geocentric Z",NORTH]\n]'});
b.WGS84ECEFSpatialReference=new h({wkt:'GEOCCS["WGS 84",\n  DATUM["WGS_1984",\n    SPHEROID["WGS 84",6378137,298.257223563,\n      AUTHORITY["EPSG","7030"]],\n    AUTHORITY["EPSG","6326"]],\n  PRIMEM["Greenwich",0,\n    AUTHORITY["EPSG","8901"]],\n  UNIT["m",1.0,\n    AUTHORITY["EPSG","9001"]],\n  AXIS["Geocentric X",OTHER],\n  AXIS["Geocentric Y",OTHER],\n  AXIS["Geocentric Z",NORTH],\n  AUTHORITY["EPSG","4978"]\n]'});var w,x,v,z;b.vectorToVector=g;b.pointToVector=function(a,c,d,g){void 0===g&&(g=
0);D[0]=a.x;D[1]=a.y;var l=a.z;D[2]=void 0!==l?l:g;return e(D,a.spatialReference,0,c,d,0,1)};b.vectorToPoint=function(a,c,g,l){g instanceof d?l=l||g.spatialReference:p.isPoint(g)?(g.hasZ=!0,l=l||g.spatialReference):(l=g,g=new d({spatialReference:l}));return e(a,c,0,D,l,0,1)?(g.x=D[0],g.y=D[1],g.z=D[2],g.spatialReference=l,g):null};b.xyzToVector=function(a,c,d,g,l,b){D[0]=a;D[1]=c;D[2]=d;return e(D,g,0,l,b,0,1)};b.bufferToBuffer=e;b.computeLinearTransformation=function(a,c,e,d){var g=u(a),l=u(d);if(g===
l&&1!==l&&(0!==g||a.equals(d)))return n.mat4.identity(e),n.mat4.translate(e,e,c),!0;if(1===l){if(a=B[g])return a(c,0,G,0),y(G,0,K,0),d=C*G[0],a=C*G[1],c=Math.sin(d),d=Math.cos(d),g=Math.sin(a),a=Math.cos(a),e[0]=-c,e[4]=-g*d,e[8]=a*d,e[12]=K[0],e[1]=d,e[5]=-g*c,e[9]=a*c,e[13]=K[1],e[2]=0,e[6]=a,e[10]=g,e[14]=K[2],e[3]=0,e[7]=0,e[11]=0,e[15]=1,!0}else if(3===l&&(2===g||1===g))return B[g](c,0,G,0),c=C*G[1],r(G,0,K,0),n.mat4.identity(e),n.mat4.translate(e,e,K),c=1/Math.cos(c),n.mat4.scale(e,e,[c,c,1]),
!0;return!1};b.transformDirection=function(a,c,e,d,l){f.vec3.copy(M,a);f.vec3.add(O,a,c);g(M,e,M,l);g(O,e,O,l);f.vec3.subtract(d,O,M);f.vec3.normalize(d,d)};b.mbsToMbs=function(a,c,e,d){var g=u(c),l=u(d);if(g===l&&(0!==g||c.equals(d)))return e[0]=a[0],e[1]=a[1],e[2]=a[2],e[3]=a[3],!0;if(1===l){if(c=B[g])return c(a,0,G,0),y(G,0,e,0),e[3]=a[3],!0}else if(3===l&&(2===g||1===g))return B[g](a,0,G,0),c=Math.abs(C*G[1])+Math.asin(a[3]/(F+a[2])),r(G,0,e,0),e[3]=c>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(c)*
a[3],!0;return!1};b.extentToBoundingBox=function(a,c,d){if(null==a)return!1;var g;D[0]=null!=a.xmin?a.xmin:0;D[1]=null!=a.ymin?a.ymin:0;D[2]=null!=a.zmin?a.zmin:0;g=e(D,a.spatialReference,0,c,d,0,1);D[0]=null!=a.xmax?a.xmax:0;D[1]=null!=a.ymax?a.ymax:0;D[2]=null!=a.zmax?a.zmax:0;g=g&&e(D,a.spatialReference,0,c,d,3,1);null==a.xmin&&(c[0]=-Infinity);null==a.ymin&&(c[1]=-Infinity);null==a.zmin&&(c[2]=-Infinity);null==a.xmax&&(c[3]=Infinity);null==a.ymax&&(c[4]=Infinity);null==a.zmax&&(c[5]=Infinity);
return g};b.extentToBoundingRect=function(a,c,d){if(null==a)return!1;var g;D[0]=null!=a.xmin?a.xmin:0;D[1]=null!=a.ymin?a.ymin:0;D[2]=null!=a.zmin?a.zmin:0;g=e(D,a.spatialReference,0,D,d,0,1);c[0]=D[0];c[1]=D[1];D[0]=null!=a.xmax?a.xmax:0;D[1]=null!=a.ymax?a.ymax:0;D[2]=null!=a.zmax?a.zmax:0;g=g&&e(D,a.spatialReference,0,D,d,0,1);c[2]=D[0];c[3]=D[1];null==a.xmin&&(c[0]=-Infinity);null==a.ymin&&(c[1]=-Infinity);null==a.xmax&&(c[2]=Infinity);null==a.ymax&&(c[3]=Infinity);return g};b.boundingRectToBoundingRect=
function(a,c,d,g){if(null==a)return!1;if(c.equals(g))return m.set(d,a),!0;var l;D[0]=a[0];D[1]=a[1];D[2]=0;l=e(D,c,0,D,g,0,1);d[0]=D[0];d[1]=D[1];D[0]=a[2];D[1]=a[3];D[2]=0;l=l&&e(D,c,0,D,g,0,1);d[2]=D[0];d[3]=D[1];return l};(function(a){a.x2lon=function(a){return a/F};a.y2lat=function(a){return Math.PI/2-2*Math.atan(Math.exp(-1*a/F))};a.lon2x=function(a){return a*F};a.lat2y=function(a){a=Math.sin(a);return F/2*Math.log((1+a)/(1-a))}})(b.webMercator||(b.webMercator={}));var A=[void 0,y,t,r,function(a,
c,e,d){var g=H,l=C*a[c],b=C*a[c+1];a=a[c+2];c=Math.sin(b);var b=Math.cos(b),h=g.a/Math.sqrt(1-g.e2*c*c);e[d++]=(h+a)*b*Math.cos(l);e[d++]=(h+a)*b*Math.sin(l);e[d++]=(h*(1-g.e2)+a)*c}],B=[void 0,function(c,e,d,g){var b=l.Vec3Compact.length(c,e),h=a.asin(c[e+2]/(0===b?1:b)),f=Math.cos(h)*b;c=(0<c[e+1]?1:-1)*a.acos(c[e]/(0===f?1:f));d[g++]=E*c;d[g++]=E*h;d[g]=b-F},t,function(a,c,e,d){e[d++]=E*(a[c++]/F);e[d++]=E*(Math.PI/2-2*Math.atan(Math.exp(-1*a[c++]/F)));e[d]=a[c]},function(a,c,e,d){var g=H,l=a[c],
b=a[c+1];a=a[c+2];var h,f,m,r,u,p;c=Math.abs(a);h=l*l+b*b;f=Math.sqrt(h);m=h+a*a;r=Math.sqrt(m);l=Math.atan2(b,l);u=a*a/m;m=h/m;b=g.a2/r;h=g.a3-g.a4/r;.3<m?(u=c/r*(1+m*(g.a1+b+u*h)/r),r=Math.asin(u),b=u*u,m=Math.sqrt(1-b)):(m=f/r*(1-u*(g.a5-b-m*h)/r),r=Math.acos(m),b=1-m*m,u=Math.sqrt(b));p=1-g.e2*b;b=g.a/Math.sqrt(p);g=g.a6*b;b=f-b*m;h=c-g*u;c=m*b+u*h;f=m*h-u*b;g=f/(g/p+c);r+=g;0>a&&(r=-r);e[d++]=E*l;e[d++]=E*r;e[d]=c+f*g/2}],C=a.deg2rad(1),E=a.rad2deg(1),F=c.earthRadius,H={a:6378137,e2:.006694379990137799,
a1:42697.67270715754,a2:1.8230912546075456E9,a3:142.91722289812412,a4:4.557728136518864E9,a5:42840.589930055656,a6:.9933056200098622},D=k.vec3f64.create(),G=k.vec3f64.create(),K=k.vec3f64.create(),M=k.vec3f64.create(),O=k.vec3f64.create()})},"esri/core/libs/gl-matrix-2/mat4":function(){define(["require","exports","./math/mat4"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.mat4=n})},"esri/core/libs/gl-matrix-2/math/mat4":function(){define(["require","exports","../factories/vec3f64",
"./common"],function(q,b,n,f){function k(c){c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c}function d(c,a,d){var g=a[0],e=a[1],l=a[2],b=a[3],h=a[4],f=a[5],m=a[6],p=a[7],k=a[8],z=a[9],n=a[10],B=a[11],C=a[12],E=a[13],F=a[14];a=a[15];var H=d[0],D=d[1],G=d[2],K=d[3];c[0]=H*g+D*h+G*k+K*C;c[1]=H*e+D*f+G*z+K*E;c[2]=H*l+D*m+G*n+K*F;c[3]=H*b+D*p+G*B+K*a;H=d[4];D=d[5];G=d[6];K=d[7];c[4]=H*g+D*h+G*k+K*C;c[5]=H*e+D*f+G*z+K*E;c[6]=
H*l+D*m+G*n+K*F;c[7]=H*b+D*p+G*B+K*a;H=d[8];D=d[9];G=d[10];K=d[11];c[8]=H*g+D*h+G*k+K*C;c[9]=H*e+D*f+G*z+K*E;c[10]=H*l+D*m+G*n+K*F;c[11]=H*b+D*p+G*B+K*a;H=d[12];D=d[13];G=d[14];K=d[15];c[12]=H*g+D*h+G*k+K*C;c[13]=H*e+D*f+G*z+K*E;c[14]=H*l+D*m+G*n+K*F;c[15]=H*b+D*p+G*B+K*a;return c}function h(c,a,d){var g=a[0],e=a[1],l=a[2],b=a[3],h=g+g,f=e+e,m=l+l;a=g*h;var p=g*f,g=g*m,k=e*f,e=e*m,l=l*m,h=b*h,f=b*f,b=b*m;c[0]=1-(k+l);c[1]=p+b;c[2]=g-f;c[3]=0;c[4]=p-b;c[5]=1-(a+l);c[6]=e+h;c[7]=0;c[8]=g+f;c[9]=e-h;
c[10]=1-(a+k);c[11]=0;c[12]=d[0];c[13]=d[1];c[14]=d[2];c[15]=1;return c}function m(c,a,d){c[0]=a[0]-d[0];c[1]=a[1]-d[1];c[2]=a[2]-d[2];c[3]=a[3]-d[3];c[4]=a[4]-d[4];c[5]=a[5]-d[5];c[6]=a[6]-d[6];c[7]=a[7]-d[7];c[8]=a[8]-d[8];c[9]=a[9]-d[9];c[10]=a[10]-d[10];c[11]=a[11]-d[11];c[12]=a[12]-d[12];c[13]=a[13]-d[13];c[14]=a[14]-d[14];c[15]=a[15]-d[15];return c}Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(c,a){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=
a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};b.set=function(c,a,d,g,e,b,h,f,m,p,k,v,z,n,B,C,E){c[0]=a;c[1]=d;c[2]=g;c[3]=e;c[4]=b;c[5]=h;c[6]=f;c[7]=m;c[8]=p;c[9]=k;c[10]=v;c[11]=z;c[12]=n;c[13]=B;c[14]=C;c[15]=E;return c};b.identity=k;b.transpose=function(c,a){if(c===a){var d=a[1],g=a[2],e=a[3],b=a[6],h=a[7],f=a[11];c[1]=a[4];c[2]=a[8];c[3]=a[12];c[4]=d;c[6]=a[9];c[7]=a[13];c[8]=g;c[9]=b;c[11]=a[14];c[12]=e;c[13]=h;c[14]=f}else c[0]=a[0],
c[1]=a[4],c[2]=a[8],c[3]=a[12],c[4]=a[1],c[5]=a[5],c[6]=a[9],c[7]=a[13],c[8]=a[2],c[9]=a[6],c[10]=a[10],c[11]=a[14],c[12]=a[3],c[13]=a[7],c[14]=a[11],c[15]=a[15];return c};b.invert=function(c,a){var d=a[0],g=a[1],e=a[2],b=a[3],h=a[4],f=a[5],m=a[6],p=a[7],k=a[8],v=a[9],z=a[10],n=a[11],B=a[12],C=a[13],E=a[14];a=a[15];var F=d*f-g*h,H=d*m-e*h,D=d*p-b*h,G=g*m-e*f,K=g*p-b*f,M=e*p-b*m,q=k*C-v*B,N=k*E-z*B,P=k*a-n*B,L=v*E-z*C,T=v*a-n*C,R=z*a-n*E,J=F*R-H*T+D*L+G*P-K*N+M*q;if(!J)return null;J=1/J;c[0]=(f*R-
m*T+p*L)*J;c[1]=(e*T-g*R-b*L)*J;c[2]=(C*M-E*K+a*G)*J;c[3]=(z*K-v*M-n*G)*J;c[4]=(m*P-h*R-p*N)*J;c[5]=(d*R-e*P+b*N)*J;c[6]=(E*D-B*M-a*H)*J;c[7]=(k*M-z*D+n*H)*J;c[8]=(h*T-f*P+p*q)*J;c[9]=(g*P-d*T-b*q)*J;c[10]=(B*K-C*D+a*F)*J;c[11]=(v*D-k*K-n*F)*J;c[12]=(f*N-h*L-m*q)*J;c[13]=(d*L-g*N+e*q)*J;c[14]=(C*H-B*G-E*F)*J;c[15]=(k*G-v*H+z*F)*J;return c};b.adjoint=function(c,a){var d=a[0],g=a[1],e=a[2],b=a[3],h=a[4],f=a[5],m=a[6],p=a[7],k=a[8],v=a[9],z=a[10],n=a[11],B=a[12],C=a[13],E=a[14];a=a[15];c[0]=f*(z*a-n*
E)-v*(m*a-p*E)+C*(m*n-p*z);c[1]=-(g*(z*a-n*E)-v*(e*a-b*E)+C*(e*n-b*z));c[2]=g*(m*a-p*E)-f*(e*a-b*E)+C*(e*p-b*m);c[3]=-(g*(m*n-p*z)-f*(e*n-b*z)+v*(e*p-b*m));c[4]=-(h*(z*a-n*E)-k*(m*a-p*E)+B*(m*n-p*z));c[5]=d*(z*a-n*E)-k*(e*a-b*E)+B*(e*n-b*z);c[6]=-(d*(m*a-p*E)-h*(e*a-b*E)+B*(e*p-b*m));c[7]=d*(m*n-p*z)-h*(e*n-b*z)+k*(e*p-b*m);c[8]=h*(v*a-n*C)-k*(f*a-p*C)+B*(f*n-p*v);c[9]=-(d*(v*a-n*C)-k*(g*a-b*C)+B*(g*n-b*v));c[10]=d*(f*a-p*C)-h*(g*a-b*C)+B*(g*p-b*f);c[11]=-(d*(f*n-p*v)-h*(g*n-b*v)+k*(g*p-b*f));c[12]=
-(h*(v*E-z*C)-k*(f*E-m*C)+B*(f*z-m*v));c[13]=d*(v*E-z*C)-k*(g*E-e*C)+B*(g*z-e*v);c[14]=-(d*(f*E-m*C)-h*(g*E-e*C)+B*(g*m-e*f));c[15]=d*(f*z-m*v)-h*(g*z-e*v)+k*(g*m-e*f);return c};b.determinant=function(c){var a=c[0],d=c[1],g=c[2],e=c[3],b=c[4],h=c[5],f=c[6],m=c[7],p=c[8],k=c[9],v=c[10],z=c[11],n=c[12],B=c[13],C=c[14];c=c[15];return(a*h-d*b)*(v*c-z*C)-(a*f-g*b)*(k*c-z*B)+(a*m-e*b)*(k*C-v*B)+(d*f-g*h)*(p*c-z*n)-(d*m-e*h)*(p*C-v*n)+(g*m-e*f)*(p*B-k*n)};b.multiply=d;b.translate=function(c,a,d){var g=d[0],
e=d[1];d=d[2];var b=void 0,l=void 0,h=void 0,f=void 0,m=void 0,p=void 0,k=void 0,z=void 0,n=void 0,B=void 0,C=void 0,E=void 0;a===c?(c[12]=a[0]*g+a[4]*e+a[8]*d+a[12],c[13]=a[1]*g+a[5]*e+a[9]*d+a[13],c[14]=a[2]*g+a[6]*e+a[10]*d+a[14],c[15]=a[3]*g+a[7]*e+a[11]*d+a[15]):(b=a[0],l=a[1],h=a[2],f=a[3],m=a[4],p=a[5],k=a[6],z=a[7],n=a[8],B=a[9],C=a[10],E=a[11],c[0]=b,c[1]=l,c[2]=h,c[3]=f,c[4]=m,c[5]=p,c[6]=k,c[7]=z,c[8]=n,c[9]=B,c[10]=C,c[11]=E,c[12]=b*g+m*e+n*d+a[12],c[13]=l*g+p*e+B*d+a[13],c[14]=h*g+k*
e+C*d+a[14],c[15]=f*g+z*e+E*d+a[15]);return c};b.scale=function(c,a,d){var g=d[0],e=d[1];d=d[2];c[0]=a[0]*g;c[1]=a[1]*g;c[2]=a[2]*g;c[3]=a[3]*g;c[4]=a[4]*e;c[5]=a[5]*e;c[6]=a[6]*e;c[7]=a[7]*e;c[8]=a[8]*d;c[9]=a[9]*d;c[10]=a[10]*d;c[11]=a[11]*d;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};b.rotate=function(c,a,d,g){var e=g[0],b=g[1];g=g[2];var l=Math.sqrt(e*e+b*b+g*g),h=void 0,m=void 0,p=void 0,k=void 0,n=void 0,z=void 0,A=void 0,B=void 0,C=void 0,E=void 0,F=void 0,H=void 0,D=void 0,G=
void 0,K=void 0,M=void 0,q=void 0,N=void 0,P=void 0,L=void 0,T=void 0,R=void 0,m=h=void 0;if(l<f.EPSILON)return null;l=1/l;e*=l;b*=l;g*=l;h=Math.sin(d);m=Math.cos(d);p=1-m;k=a[0];n=a[1];z=a[2];A=a[3];B=a[4];C=a[5];E=a[6];F=a[7];H=a[8];D=a[9];G=a[10];K=a[11];M=e*e*p+m;q=b*e*p+g*h;N=g*e*p-b*h;P=e*b*p-g*h;L=b*b*p+m;T=g*b*p+e*h;R=e*g*p+b*h;h=b*g*p-e*h;m=g*g*p+m;c[0]=k*M+B*q+H*N;c[1]=n*M+C*q+D*N;c[2]=z*M+E*q+G*N;c[3]=A*M+F*q+K*N;c[4]=k*P+B*L+H*T;c[5]=n*P+C*L+D*T;c[6]=z*P+E*L+G*T;c[7]=A*P+F*L+K*T;c[8]=
k*R+B*h+H*m;c[9]=n*R+C*h+D*m;c[10]=z*R+E*h+G*m;c[11]=A*R+F*h+K*m;a!==c&&(c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);return c};b.rotateX=function(c,a,d){var g=Math.sin(d);d=Math.cos(d);var e=a[4],b=a[5],l=a[6],h=a[7],f=a[8],m=a[9],p=a[10],k=a[11];a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[4]=e*d+f*g;c[5]=b*d+m*g;c[6]=l*d+p*g;c[7]=h*d+k*g;c[8]=f*d-e*g;c[9]=m*d-b*g;c[10]=p*d-l*g;c[11]=k*d-h*g;return c};b.rotateY=function(c,a,d){var g=Math.sin(d);
d=Math.cos(d);var e=a[0],b=a[1],l=a[2],h=a[3],f=a[8],m=a[9],p=a[10],k=a[11];a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[0]=e*d-f*g;c[1]=b*d-m*g;c[2]=l*d-p*g;c[3]=h*d-k*g;c[8]=e*g+f*d;c[9]=b*g+m*d;c[10]=l*g+p*d;c[11]=h*g+k*d;return c};b.rotateZ=function(c,a,d){var g=Math.sin(d);d=Math.cos(d);var e=a[0],b=a[1],l=a[2],h=a[3],f=a[4],m=a[5],p=a[6],k=a[7];a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=
a[15]);c[0]=e*d+f*g;c[1]=b*d+m*g;c[2]=l*d+p*g;c[3]=h*d+k*g;c[4]=f*d-e*g;c[5]=m*d-b*g;c[6]=p*d-l*g;c[7]=k*d-h*g;return c};b.fromTranslation=function(c,a){c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=a[0];c[13]=a[1];c[14]=a[2];c[15]=1;return c};b.fromScaling=function(c,a){c[0]=a[0];c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=a[1];c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=a[2];c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};b.fromRotation=function(c,a,d){var g=d[0],e=d[1];
d=d[2];var b=Math.sqrt(g*g+e*e+d*d),l=void 0,h=void 0,m=void 0;if(b<f.EPSILON)return null;b=1/b;g*=b;e*=b;d*=b;l=Math.sin(a);h=Math.cos(a);m=1-h;c[0]=g*g*m+h;c[1]=e*g*m+d*l;c[2]=d*g*m-e*l;c[3]=0;c[4]=g*e*m-d*l;c[5]=e*e*m+h;c[6]=d*e*m+g*l;c[7]=0;c[8]=g*d*m+e*l;c[9]=e*d*m-g*l;c[10]=d*d*m+h;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};b.fromXRotation=function(c,a){var d=Math.sin(a);a=Math.cos(a);c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=a;c[6]=d;c[7]=0;c[8]=0;c[9]=-d;c[10]=a;c[11]=0;c[12]=0;c[13]=
0;c[14]=0;c[15]=1;return c};b.fromYRotation=function(c,a){var d=Math.sin(a);a=Math.cos(a);c[0]=a;c[1]=0;c[2]=-d;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=d;c[9]=0;c[10]=a;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};b.fromZRotation=function(c,a){var d=Math.sin(a);a=Math.cos(a);c[0]=a;c[1]=d;c[2]=0;c[3]=0;c[4]=-d;c[5]=a;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};b.fromRotationTranslation=h;b.fromQuat2=function(c,a){var d=p,g=-a[0],e=-a[1],b=-a[2],f=a[3],
m=a[4],k=a[5],n=a[6],x=a[7],v=g*g+e*e+b*b+f*f;0<v?(d[0]=2*(m*f+x*g+k*b-n*e)/v,d[1]=2*(k*f+x*e+n*g-m*b)/v,d[2]=2*(n*f+x*b+m*e-k*g)/v):(d[0]=2*(m*f+x*g+k*b-n*e),d[1]=2*(k*f+x*e+n*g-m*b),d[2]=2*(n*f+x*b+m*e-k*g));h(c,a,d);return c};var p=n.create();b.getTranslation=function(c,a){c[0]=a[12];c[1]=a[13];c[2]=a[14];return c};b.getScaling=function(c,a){var d=a[0],g=a[1],e=a[2],b=a[4],h=a[5],f=a[6],m=a[8],p=a[9];a=a[10];c[0]=Math.sqrt(d*d+g*g+e*e);c[1]=Math.sqrt(b*b+h*h+f*f);c[2]=Math.sqrt(m*m+p*p+a*a);return c};
b.getRotation=function(c,a){var d=a[0]+a[5]+a[10],g=0;0<d?(g=2*Math.sqrt(d+1),c[3]=.25*g,c[0]=(a[6]-a[9])/g,c[1]=(a[8]-a[2])/g,c[2]=(a[1]-a[4])/g):a[0]>a[5]&&a[0]>a[10]?(g=2*Math.sqrt(1+a[0]-a[5]-a[10]),c[3]=(a[6]-a[9])/g,c[0]=.25*g,c[1]=(a[1]+a[4])/g,c[2]=(a[8]+a[2])/g):a[5]>a[10]?(g=2*Math.sqrt(1+a[5]-a[0]-a[10]),c[3]=(a[8]-a[2])/g,c[0]=(a[1]+a[4])/g,c[1]=.25*g,c[2]=(a[6]+a[9])/g):(g=2*Math.sqrt(1+a[10]-a[0]-a[5]),c[3]=(a[1]-a[4])/g,c[0]=(a[8]+a[2])/g,c[1]=(a[6]+a[9])/g,c[2]=.25*g);return c};b.fromRotationTranslationScale=
function(c,a,d,g){var e=a[0],b=a[1],l=a[2],h=a[3],f=e+e,m=b+b,p=l+l;a=e*f;var k=e*m,e=e*p,z=b*m,b=b*p,l=l*p,f=h*f,m=h*m,h=h*p,p=g[0],n=g[1];g=g[2];c[0]=(1-(z+l))*p;c[1]=(k+h)*p;c[2]=(e-m)*p;c[3]=0;c[4]=(k-h)*n;c[5]=(1-(a+l))*n;c[6]=(b+f)*n;c[7]=0;c[8]=(e+m)*g;c[9]=(b-f)*g;c[10]=(1-(a+z))*g;c[11]=0;c[12]=d[0];c[13]=d[1];c[14]=d[2];c[15]=1;return c};b.fromRotationTranslationScaleOrigin=function(c,a,d,g,e){var b=a[0],l=a[1],h=a[2],f=a[3],m=b+b,p=l+l,k=h+h;a=b*m;var z=b*p,n=b*k,b=l*p,l=l*k,B=h*k,h=f*
m,p=f*p,C=f*k,E=g[0],F=g[1],k=g[2];g=e[0];f=e[1];e=e[2];var m=(1-(b+B))*E,H=(z+C)*E,E=(n-p)*E,z=(z-C)*F,B=(1-(a+B))*F,F=(l+h)*F,n=(n+p)*k,l=(l-h)*k;a=(1-(a+b))*k;c[0]=m;c[1]=H;c[2]=E;c[3]=0;c[4]=z;c[5]=B;c[6]=F;c[7]=0;c[8]=n;c[9]=l;c[10]=a;c[11]=0;c[12]=d[0]+g-(m*g+z*f+n*e);c[13]=d[1]+f-(H*g+B*f+l*e);c[14]=d[2]+e-(E*g+F*f+a*e);c[15]=1;return c};b.fromQuat=function(c,a){var d=a[0],g=a[1],e=a[2];a=a[3];var b=d+d,h=g+g,f=e+e,d=d*b,m=g*b,g=g*h,p=e*b,k=e*h,e=e*f,b=a*b,h=a*h;a*=f;c[0]=1-g-e;c[1]=m+a;c[2]=
p-h;c[3]=0;c[4]=m-a;c[5]=1-d-e;c[6]=k+b;c[7]=0;c[8]=p+h;c[9]=k-b;c[10]=1-d-g;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};b.frustum=function(c,a,d,g,e,b,h){var l=1/(d-a),f=1/(e-g),m=1/(b-h);c[0]=2*b*l;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=2*b*f;c[6]=0;c[7]=0;c[8]=(d+a)*l;c[9]=(e+g)*f;c[10]=(h+b)*m;c[11]=-1;c[12]=0;c[13]=0;c[14]=h*b*2*m;c[15]=0;return c};b.perspective=function(c,a,d,g,e){a=1/Math.tan(a/2);var b=void 0;c[0]=a/d;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=a;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[11]=-1;
c[12]=0;c[13]=0;c[15]=0;null!=e&&Infinity!==e?(b=1/(g-e),c[10]=(e+g)*b,c[14]=2*e*g*b):(c[10]=-1,c[14]=-2*g);return c};b.perspectiveFromFieldOfView=function(c,a,d,g){var e=Math.tan(a.upDegrees*Math.PI/180),b=Math.tan(a.downDegrees*Math.PI/180),l=Math.tan(a.leftDegrees*Math.PI/180);a=Math.tan(a.rightDegrees*Math.PI/180);var h=2/(l+a),f=2/(e+b);c[0]=h;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=f;c[6]=0;c[7]=0;c[8]=-((l-a)*h*.5);c[9]=(e-b)*f*.5;c[10]=g/(d-g);c[11]=-1;c[12]=0;c[13]=0;c[14]=g*d/(d-g);c[15]=0;return c};
b.ortho=function(c,a,d,g,e,b,h){var l=1/(a-d),f=1/(g-e),m=1/(b-h);c[0]=-2*l;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=-2*f;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=2*m;c[11]=0;c[12]=(a+d)*l;c[13]=(e+g)*f;c[14]=(h+b)*m;c[15]=1;return c};b.lookAt=function(c,a,d,g){var e=void 0,b=void 0,l=void 0,h=void 0,m=void 0,p=void 0,n=void 0,v=void 0,z=void 0,A=void 0,B=a[0],C=a[1];a=a[2];l=g[0];h=g[1];g=g[2];n=d[0];v=d[1];d=d[2];if(Math.abs(B-n)<f.EPSILON&&Math.abs(C-v)<f.EPSILON&&Math.abs(a-d)<f.EPSILON)return k(c);n=B-n;v=
C-v;z=a-d;A=1/Math.sqrt(n*n+v*v+z*z);n*=A;v*=A;z*=A;e=h*z-g*v;b=g*n-l*z;l=l*v-h*n;(A=Math.sqrt(e*e+b*b+l*l))?(A=1/A,e*=A,b*=A,l*=A):l=b=e=0;h=v*l-z*b;m=z*e-n*l;p=n*b-v*e;(A=Math.sqrt(h*h+m*m+p*p))?(A=1/A,h*=A,m*=A,p*=A):p=m=h=0;c[0]=e;c[1]=h;c[2]=n;c[3]=0;c[4]=b;c[5]=m;c[6]=v;c[7]=0;c[8]=l;c[9]=p;c[10]=z;c[11]=0;c[12]=-(e*B+b*C+l*a);c[13]=-(h*B+m*C+p*a);c[14]=-(n*B+v*C+z*a);c[15]=1;return c};b.targetTo=function(c,a,d,g){var e=a[0],b=a[1];a=a[2];var l=g[0],h=g[1],f=g[2];g=e-d[0];var m=b-d[1];d=a-d[2];
var p=g*g+m*m+d*d;0<p&&(p=1/Math.sqrt(p),g*=p,m*=p,d*=p);var k=h*d-f*m,f=f*g-l*d,l=l*m-h*g,p=k*k+f*f+l*l;0<p&&(p=1/Math.sqrt(p),k*=p,f*=p,l*=p);c[0]=k;c[1]=f;c[2]=l;c[3]=0;c[4]=m*l-d*f;c[5]=d*k-g*l;c[6]=g*f-m*k;c[7]=0;c[8]=g;c[9]=m;c[10]=d;c[11]=0;c[12]=e;c[13]=b;c[14]=a;c[15]=1;return c};b.str=function(c){return"mat4("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+", "+c[4]+", "+c[5]+", "+c[6]+", "+c[7]+", "+c[8]+", "+c[9]+", "+c[10]+", "+c[11]+", "+c[12]+", "+c[13]+", "+c[14]+", "+c[15]+")"};b.frob=function(c){return Math.sqrt(Math.pow(c[0],
2)+Math.pow(c[1],2)+Math.pow(c[2],2)+Math.pow(c[3],2)+Math.pow(c[4],2)+Math.pow(c[5],2)+Math.pow(c[6],2)+Math.pow(c[7],2)+Math.pow(c[8],2)+Math.pow(c[9],2)+Math.pow(c[10],2)+Math.pow(c[11],2)+Math.pow(c[12],2)+Math.pow(c[13],2)+Math.pow(c[14],2)+Math.pow(c[15],2))};b.add=function(c,a,d){c[0]=a[0]+d[0];c[1]=a[1]+d[1];c[2]=a[2]+d[2];c[3]=a[3]+d[3];c[4]=a[4]+d[4];c[5]=a[5]+d[5];c[6]=a[6]+d[6];c[7]=a[7]+d[7];c[8]=a[8]+d[8];c[9]=a[9]+d[9];c[10]=a[10]+d[10];c[11]=a[11]+d[11];c[12]=a[12]+d[12];c[13]=a[13]+
d[13];c[14]=a[14]+d[14];c[15]=a[15]+d[15];return c};b.subtract=m;b.multiplyScalar=function(c,a,d){c[0]=a[0]*d;c[1]=a[1]*d;c[2]=a[2]*d;c[3]=a[3]*d;c[4]=a[4]*d;c[5]=a[5]*d;c[6]=a[6]*d;c[7]=a[7]*d;c[8]=a[8]*d;c[9]=a[9]*d;c[10]=a[10]*d;c[11]=a[11]*d;c[12]=a[12]*d;c[13]=a[13]*d;c[14]=a[14]*d;c[15]=a[15]*d;return c};b.multiplyScalarAndAdd=function(c,a,d,g){c[0]=a[0]+d[0]*g;c[1]=a[1]+d[1]*g;c[2]=a[2]+d[2]*g;c[3]=a[3]+d[3]*g;c[4]=a[4]+d[4]*g;c[5]=a[5]+d[5]*g;c[6]=a[6]+d[6]*g;c[7]=a[7]+d[7]*g;c[8]=a[8]+d[8]*
g;c[9]=a[9]+d[9]*g;c[10]=a[10]+d[10]*g;c[11]=a[11]+d[11]*g;c[12]=a[12]+d[12]*g;c[13]=a[13]+d[13]*g;c[14]=a[14]+d[14]*g;c[15]=a[15]+d[15]*g;return c};b.exactEquals=function(c,a){return c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]&&c[3]===a[3]&&c[4]===a[4]&&c[5]===a[5]&&c[6]===a[6]&&c[7]===a[7]&&c[8]===a[8]&&c[9]===a[9]&&c[10]===a[10]&&c[11]===a[11]&&c[12]===a[12]&&c[13]===a[13]&&c[14]===a[14]&&c[15]===a[15]};b.equals=function(c,a){var d=c[0],g=c[1],e=c[2],b=c[3],h=c[4],m=c[5],p=c[6],k=c[7],n=c[8],v=c[9],
z=c[10],A=c[11],B=c[12],C=c[13],E=c[14];c=c[15];var F=a[0],H=a[1],D=a[2],G=a[3],K=a[4],M=a[5],q=a[6],N=a[7],P=a[8],L=a[9],T=a[10],R=a[11],J=a[12],U=a[13],Q=a[14];a=a[15];return Math.abs(d-F)<=f.EPSILON*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(g-H)<=f.EPSILON*Math.max(1,Math.abs(g),Math.abs(H))&&Math.abs(e-D)<=f.EPSILON*Math.max(1,Math.abs(e),Math.abs(D))&&Math.abs(b-G)<=f.EPSILON*Math.max(1,Math.abs(b),Math.abs(G))&&Math.abs(h-K)<=f.EPSILON*Math.max(1,Math.abs(h),Math.abs(K))&&Math.abs(m-M)<=
f.EPSILON*Math.max(1,Math.abs(m),Math.abs(M))&&Math.abs(p-q)<=f.EPSILON*Math.max(1,Math.abs(p),Math.abs(q))&&Math.abs(k-N)<=f.EPSILON*Math.max(1,Math.abs(k),Math.abs(N))&&Math.abs(n-P)<=f.EPSILON*Math.max(1,Math.abs(n),Math.abs(P))&&Math.abs(v-L)<=f.EPSILON*Math.max(1,Math.abs(v),Math.abs(L))&&Math.abs(z-T)<=f.EPSILON*Math.max(1,Math.abs(z),Math.abs(T))&&Math.abs(A-R)<=f.EPSILON*Math.max(1,Math.abs(A),Math.abs(R))&&Math.abs(B-J)<=f.EPSILON*Math.max(1,Math.abs(B),Math.abs(J))&&Math.abs(C-U)<=f.EPSILON*
Math.max(1,Math.abs(C),Math.abs(U))&&Math.abs(E-Q)<=f.EPSILON*Math.max(1,Math.abs(E),Math.abs(Q))&&Math.abs(c-a)<=f.EPSILON*Math.max(1,Math.abs(c),Math.abs(a))};b.mul=d;b.sub=m})},"esri/layers/graphics/dehydratedFeatures":function(){define("require exports ../../geometry ../../Graphic ../../core/compilerUtils ../../core/lang ../../core/typedArrayUtil ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../support/Field ./dehydratedFeatureComparison".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g){function e(a,c,e){if(!a)return null;switch(c){case "point":return a={x:a.x,y:a.y,z:a.z,m:a.m,hasZ:null!=a.z,hasM:null!=a.m,type:"point",spatialReference:e};case "polyline":return a={paths:a.paths,hasZ:!!a.hasZ,hasM:!!a.hasM,type:"polyline",spatialReference:e};case "polygon":return a={rings:a.rings,hasZ:!!a.hasZ,hasM:!!a.hasM,type:"polygon",spatialReference:e};case "multipoint":return a={points:a.points,hasZ:!!a.hasZ,hasM:!!a.hasM,type:"multipoint",spatialReference:e}}}
function u(a,c,e,d){return{x:a,y:c,z:e,hasZ:null!=e,hasM:!1,spatialReference:d,type:"point"}}function t(a){return"declaredClass"in a}function r(a){return"declaredClass"in a}function y(a){if(!a)return 0;switch(a.type){case "point":return 1;case "polyline":var c=0,e=0;for(a=a.paths;e<a.length;e++)c+=a[e].length;return c;case "polygon":e=c=0;for(a=a.rings;e<a.length;e++)c+=a[e].length;return c;case "multipoint":return a.points.length;case "extent":return 2;case "mesh":return(c=a.vertexAttributes&&a.vertexAttributes.position)?
c.length/3:0;default:k.neverReached(a)}}function w(a){var c=a.spatialReference.toJSON();switch(a.type){case "point":return{x:a.x,y:a.y,z:a.z,m:a.m,spatialReference:c};case "polygon":var e=a.hasZ,d=a.hasM;return{rings:x(a.rings),hasZ:e,hasM:d,spatialReference:c};case "polyline":var g=a.paths,e=a.hasZ,d=a.hasM;return{paths:x(g),hasZ:e,hasM:d,spatialReference:c};case "extent":var g=a.xmin,b=a.xmax,h=a.ymin,l=a.ymax,f=a.zmin,m=a.zmax,p=a.mmin,r=a.mmax,e=a.hasZ,d=a.hasM;return{xmin:g,xmax:b,ymin:h,ymax:l,
zmin:f,zmax:m,mmin:p,mmax:r,hasZ:e,hasM:d,spatialReference:c};case "multipoint":return g=a.points,e=a.hasZ,d=a.hasM,{points:A(g)?v(g):g,hasZ:e,hasM:d,spatialReference:c};default:k.neverReached(a)}}function x(a){return z(a)?a.map(function(a){return v(a)}):a}function v(a){return a.map(function(a){return h.toArray(a)})}function z(a){for(var c=0;c<a.length;c++){var e=a[c];if(0!==e.length)return A(e)}return!1}function A(a){return a.length&&(h.isFloat32Array(a[0])||h.isFloat64Array(a[0]))}function B(a,
c){p.empty(c);"mesh"===a.type&&(a=a.extent);switch(a.type){case "point":c[0]=c[3]=a.x;c[1]=c[4]=a.y;a.hasZ&&(c[2]=c[5]=a.z);break;case "polyline":for(var e=0;e<a.paths.length;e++)p.expandWithNestedArray(c,a.paths[e],a.hasZ);break;case "polygon":for(e=0;e<a.rings.length;e++)p.expandWithNestedArray(c,a.rings[e],a.hasZ);break;case "multipoint":p.expandWithNestedArray(c,a.points,a.hasZ);break;case "extent":c[0]=a.xmin;c[1]=a.ymin;c[3]=a.xmax;c[4]=a.ymax;null!=a.zmin&&(c[2]=a.zmin);null!=a.zmax&&(c[5]=
a.zmax);break;default:k.neverReached(a)}}function C(a,e){c.empty(e);"mesh"===a.type&&(a=a.extent);switch(a.type){case "point":e[0]=e[2]=a.x;e[1]=e[3]=a.y;break;case "polyline":for(var d=0;d<a.paths.length;d++)c.expandWithNestedArray(e,a.paths[d]);break;case "polygon":for(d=0;d<a.rings.length;d++)c.expandWithNestedArray(e,a.rings[d]);break;case "multipoint":c.expandWithNestedArray(e,a.points);break;case "extent":e[0]=a.xmin;e[1]=a.ymin;e[2]=a.xmax;e[3]=a.ymax;break;default:k.neverReached(a)}}Object.defineProperty(b,
"__esModule",{value:!0});b.equals=g.equals;b.isFeatureGeometry=function(a){return n.isFeatureGeometryType(a.type)};b.isPoint=function(a){return"point"===a.type};b.fromFeatureSetJSON=function(c){var d=n.featureGeometryTypeKebabDictionary.fromJSON(c.geometryType),g=m.fromJSON(c.spatialReference),b=c.transform,h=c.features.map(function(h){var l=c.objectIdFieldName;h={uid:f.generateUID(),objectId:l&&h.attributes?h.attributes[l]:null,attributes:h.attributes,geometry:e(h.geometry,d,g),visible:!0};if((l=
h.geometry)&&b)switch(l.type){case "point":h.geometry=a.hydratePoint(b,l,l,l.hasZ,l.hasM);break;case "multipoint":h.geometry=a.hydrateMultipoint(b,l,l,l.hasZ,l.hasM);break;case "polygon":h.geometry=a.hydratePolygon(b,l,l,l.hasZ,l.hasM);break;case "polyline":h.geometry=a.hydratePolyline(b,l,l,l.hasZ,l.hasM);break;default:k.neverReached(l)}return h});return{geometryType:d,features:h,spatialReference:g,fields:c.fields?c.fields.map(function(a){return l.fromJSON(a)}):null,objectIdFieldName:c.objectIdFieldName,
globalIdFieldName:c.globalIdFieldName,geohashFieldName:c.geohashFieldName,geometryProperties:c.geometryProperties,hasZ:c.hasZ,hasM:c.hasM,exceededTransferLimit:c.exceededTransferLimit,transform:null}};b.fromJSONGeometry=e;b.makeDehydratedPoint=u;b.isHydratedGeometry=function(a){return"declaredClass"in a};b.isHydratedPoint=t;b.isHydratedGraphic=r;b.hydrateGraphic=function(a,c){if(!a||r(a))return a;c=new f({layer:c,sourceLayer:c});c.visible=a.visible;c.symbol=d.clone(a.symbol);c.attributes=d.clone(a.attributes);
a.geometry&&("mesh"===a.geometry.type?c.geometry=a.geometry:c.read({geometry:w(a.geometry)}));return c};b.clonePoint=function(a,c){if(!a)return null;if(t(a)){if(null==c)return a.clone();if(t(c))return c.copy(a)}null!=c?(c.x=a.x,c.y=a.y,c.spatialReference=a.spatialReference,a.hasZ?(c.z=a.z,c.hasZ=a.hasZ):(c.z=null,c.hasZ=!1),a.hasM?(c.m=a.m,c.hasM=!0):(c.m=null,c.hasM=!1)):(c=u(a.x,a.y,a.z,a.spatialReference),a.hasM&&(c.m=a.m,c.hasM=!0));return c};b.estimateSize=function(a){for(var c=32,e=0,d=Object.keys(a.attributes);e<
d.length;e++){var g=d[e],c=c+g.length,g=a.attributes[g];switch(typeof g){case "string":c+=g.length;break;default:case "number":c+=8}}a=a.geometry?"mesh"===a.geometry.type?0:y(a.geometry):0;return c+12*a};b.numVertices=y;b.hasVertices=function(a){if(!a)return!1;switch(a.type){case "extent":case "point":return!0;case "polyline":var c=0;for(a=a.paths;c<a.length;c++)if(0<a[c].length)return!0;return!1;case "polygon":c=0;for(a=a.rings;c<a.length;c++)if(0<a[c].length)return!0;return!1;case "multipoint":return 0<
a.points.length;case "mesh":return a.vertexAttributes&&a.vertexAttributes.position&&0<a.vertexAttributes.position.length;default:k.neverReached(a)}};b.computeAABB=B;b.expandAABB=function(a,c){B(a,E);p.expand(c,E)};b.computeAABR=C;b.expandAABR=function(a,e){C(a,F);c.expand(e,F)};var E=p.create(),F=c.create()})},"esri/geometry/support/aaBoundingBox":function(){define(["require","exports","../Extent","./aaBoundingRect"],function(q,b,n,f){function k(a){void 0===a&&(a=b.ZERO);return[a[0],a[1],a[2],a[3],
a[4],a[5]]}function d(a,c,d,b,l,h,f){void 0===f&&(f=k());f[0]=a;f[1]=c;f[2]=d;f[3]=b;f[4]=l;f[5]=h;return f}function h(a){return a[0]>=a[3]?0:a[3]-a[0]}function m(a){return a[1]>=a[4]?0:a[4]-a[1]}function p(a){return a[2]>=a[5]?0:a[5]-a[2]}function c(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];return a}function a(a){return 6===a.length}Object.defineProperty(b,"__esModule",{value:!0});b.create=k;b.fromValues=d;b.fromExtent=function(a,c){void 0===c&&(c=k());c[0]=a.xmin;c[1]=a.ymin;
c[2]=a.zmin;c[3]=a.xmax;c[4]=a.ymax;c[5]=a.zmax;return c};b.toExtent=function(a,c){return isFinite(a[2])||isFinite(a[5])?new n({xmin:a[0],xmax:a[3],ymin:a[1],ymax:a[4],zmin:a[2],zmax:a[5],spatialReference:c}):new n({xmin:a[0],xmax:a[3],ymin:a[1],ymax:a[4],spatialReference:c})};b.fromMinMax=function(a,c,d){void 0===d&&(d=k());d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=c[0];d[4]=c[1];d[5]=c[2];return d};b.expandPointInPlace=function(a,c){c[0]<a[0]&&(a[0]=c[0]);c[0]>a[3]&&(a[3]=c[0]);c[1]<a[1]&&(a[1]=c[1]);
c[1]>a[4]&&(a[4]=c[1]);c[2]<a[2]&&(a[2]=c[2]);c[2]>a[5]&&(a[5]=c[2])};b.expand=function(c,e,d){void 0===d&&(d=c);a(e)?(d[0]=Math.min(c[0],e[0]),d[1]=Math.min(c[1],e[1]),d[2]=Math.min(c[2],e[2]),d[3]=Math.max(c[3],e[3]),d[4]=Math.max(c[4],e[4]),d[5]=Math.max(c[5],e[5])):f.is(e)?(d[0]=Math.min(c[0],e[0]),d[1]=Math.min(c[1],e[1]),d[3]=Math.max(c[3],e[2]),d[4]=Math.max(c[4],e[3])):2===e.length?(d[0]=Math.min(c[0],e[0]),d[1]=Math.min(c[1],e[1]),d[3]=Math.max(c[3],e[0]),d[4]=Math.max(c[4],e[1])):3===e.length&&
(d[0]=Math.min(c[0],e[0]),d[1]=Math.min(c[1],e[1]),d[2]=Math.min(c[2],e[2]),d[3]=Math.max(c[3],e[0]),d[4]=Math.max(c[4],e[1]),d[5]=Math.max(c[5],e[2]));return d};b.expandWithBuffer=function(a,c,d,b,l){void 0===l&&(l=a);var e=a[0],g=a[1],h=a[2],f=a[3],m=a[4];a=a[5];for(var p=0;p<b;p++)e=Math.min(e,c[d+3*p]),g=Math.min(g,c[d+3*p+1]),h=Math.min(h,c[d+3*p+2]),f=Math.max(f,c[d+3*p]),m=Math.max(m,c[d+3*p+1]),a=Math.max(a,c[d+3*p+2]);l[0]=e;l[1]=g;l[2]=h;l[3]=f;l[4]=m;l[5]=a;return l};b.expandWithNestedArray=
function(a,c,d,b){void 0===b&&(b=a);var e=c.length,g=a[0],l=a[1],h=a[2],f=a[3],m=a[4];a=a[5];if(d)for(d=0;d<e;d++){var p=c[d],g=Math.min(g,p[0]),l=Math.min(l,p[1]),h=Math.min(h,p[2]),f=Math.max(f,p[0]),m=Math.max(m,p[1]);a=Math.max(a,p[2])}else for(d=0;d<e;d++)p=c[d],g=Math.min(g,p[0]),l=Math.min(l,p[1]),f=Math.max(f,p[0]),m=Math.max(m,p[1]);b[0]=g;b[1]=l;b[2]=h;b[3]=f;b[4]=m;b[5]=a;return b};b.allFinite=function(a){for(var c=0;6>c;c++)if(!isFinite(a[c]))return!1;return!0};b.width=h;b.depth=m;b.height=
p;b.diameter=function(a){var c=h(a),d=p(a);a=m(a);return Math.sqrt(c*c+d*d+a*a)};b.center=function(a,c){void 0===c&&(c=[0,0,0]);c[0]=a[0]+h(a)/2;c[1]=a[1]+m(a)/2;c[2]=a[2]+p(a)/2;return c};b.size=function(a,c){void 0===c&&(c=[0,0,0]);c[0]=h(a);c[1]=m(a);c[2]=p(a);return c};b.maximumDimension=function(a){return Math.max(h(a),p(a),m(a))};b.containsPoint=function(a,c){return c[0]>=a[0]&&c[1]>=a[1]&&c[2]>=a[2]&&c[0]<=a[3]&&c[1]<=a[4]&&c[2]<=a[5]};b.containsPointWithMargin=function(a,c,d){return c[0]>=
a[0]-d&&c[1]>=a[1]-d&&c[2]>=a[2]-d&&c[0]<=a[3]+d&&c[1]<=a[4]+d&&c[2]<=a[5]+d};b.contains=function(a,c){return c[0]>=a[0]&&c[1]>=a[1]&&c[2]>=a[2]&&c[3]<=a[3]&&c[4]<=a[4]&&c[5]<=a[5]};b.intersects=function(a,c){return Math.max(c[0],a[0])<=Math.min(c[3],a[3])&&Math.max(c[1],a[1])<=Math.min(c[4],a[4])&&Math.max(c[2],a[2])<=Math.min(c[5],a[5])};b.offset=function(a,c,d,b,l){void 0===l&&(l=a);l[0]=a[0]+c;l[1]=a[1]+d;l[2]=a[2]+b;l[3]=a[3]+c;l[4]=a[4]+d;l[5]=a[5]+b;return l};b.setMin=function(a,c,d){void 0===
d&&(d=a);d[0]=c[0];d[1]=c[1];d[2]=c[2];d!==a&&(d[3]=a[3],d[4]=a[4],d[5]=a[5]);return d};b.setMax=function(a,c,d){void 0===d&&(d=a);d[3]=c[0];d[4]=c[1];d[5]=c[2];d!==a&&(d[0]=a[0],d[1]=a[1],d[2]=a[2]);return a};b.set=c;b.empty=function(a){return a?c(a,b.NEGATIVE_INFINITY):k(b.NEGATIVE_INFINITY)};b.toRect=function(a,c){c||(c=f.create());c[0]=a[0];c[1]=a[1];c[2]=a[3];c[3]=a[4];return c};b.fromRect=function(a,c){a[0]=c[0];a[1]=c[1];a[3]=c[2];a[4]=c[3];return a};b.is=a;b.isPoint=function(a){return 0===
h(a)&&0===m(a)&&0===p(a)};b.equals=function(c,d,b){if(null==c||null==d)return c===d;if(!a(c)||!a(d))return!1;if(b)for(var e=0;e<c.length;e++){if(!b(c[e],d[e]))return!1}else for(e=0;e<c.length;e++)if(c[e]!==d[e])return!1;return!0};b.wrap=function(a,c,b,h,f,m){return d(a,c,b,h,f,m,l)};b.POSITIVE_INFINITY=[-Infinity,-Infinity,-Infinity,Infinity,Infinity,Infinity];b.NEGATIVE_INFINITY=[Infinity,Infinity,Infinity,-Infinity,-Infinity,-Infinity];b.ZERO=[0,0,0,0,0,0];var l=k()})},"esri/geometry/support/quantizationUtils":function(){define(["require",
"exports","./jsonUtils"],function(q,b,n){function f(a,c){return Math.round((c-a.translate[0])/a.scale[0])}function k(a,c){return Math.round((a.translate[1]-c)/a.scale[1])}function d(a,c,d){for(var e=[],b,g,l,h,m=0;m<d.length;m++){var p=d[m];if(0<m){if(l=f(a,p[0]),h=k(a,p[1]),l!==b||h!==g)e.push(c(p,l-b,h-g)),b=l,g=h}else b=f(a,p[0]),g=k(a,p[1]),e.push(c(p,b,g))}return 0<e.length?e:null}function h(a,c,e,b){return d(a,e?b?E:C:b?C:B,c)}function m(a,c,e,b){var g=[];e=e?b?E:C:b?C:B;for(b=0;b<c.length;b++){var l=
d(a,e,c[b]);l&&3<=l.length&&g.push(l)}return g.length?g:null}function p(a,c,e,b){var g=[];e=e?b?E:C:b?C:B;for(b=0;b<c.length;b++){var l=d(a,e,c[b]);l&&2<=l.length&&g.push(l)}return g.length?g:null}function c(a,c){return c*a.scale[0]+a.translate[0]}function a(a,c){return a.translate[1]-c*a.scale[1]}function l(d,e,b){var g=Array(b.length);if(!b.length)return g;var l=d.scale,h=l[0],l=l[1],f=c(d,b[0][0]);d=a(d,b[0][1]);g[0]=e(b[0],f,d);for(var m=1;m<b.length;m++){var p=b[m],f=f+p[0]*h;d-=p[1]*l;g[m]=
e(p,f,d)}return g}function g(a,c,d){for(var e=Array(d.length),b=0;b<d.length;b++)e[b]=l(a,c,d[b]);return e}function e(a,c,d,e){return l(a,d?e?E:C:e?C:B,c)}function u(a,c,d,e){return g(a,d?e?E:C:e?C:B,c)}function t(a,c,d,e){return g(a,d?e?E:C:e?C:B,c)}function r(a,c,d){var e=d[0],b=e[0],e=e[1],g=Math.min(b,c[0]),l=Math.min(e,c[1]),h=Math.max(b,c[2]);c=Math.max(e,c[3]);for(var f=1;f<d.length;f++){var m=d[f],p=m[0],m=m[1],b=b+p,e=e+m;0>p&&(g=Math.min(g,b));0<p&&(h=Math.max(h,b));0>m?l=Math.min(l,e):
0<m&&(c=Math.max(c,e))}a[0]=g;a[1]=l;a[2]=h;a[3]=c;return a}function y(a,c){if(!c.length)return null;a[0]=a[1]=Number.POSITIVE_INFINITY;a[2]=a[3]=Number.NEGATIVE_INFINITY;for(var d=0;d<c.length;d++)r(a,a,c[d]);return a}function w(a,c,d,e,b){c.xmin=f(a,d.xmin);c.ymin=k(a,d.ymin);c.xmax=f(a,d.xmax);c.ymax=k(a,d.ymax);c!==d&&(e&&(c.zmin=d.zmin,c.zmax=d.zmax),b&&(c.mmin=d.mmin,c.mmax=d.mmax));return c}function x(a,c,d,e,b){c.points=h(a,d.points,e,b);return c}function v(a,c,d,e,b){c.x=f(a,d.x);c.y=k(a,
d.y);c!==d&&(e&&(c.z=d.z),b&&(c.m=d.m));return c}function z(a,c,d,e,b){a=m(a,d.rings,e,b);if(!a)return null;c.rings=a;return c}function A(a,c,d,e,b){a=p(a,d.paths,e,b);if(!a)return null;c.paths=a;return c}Object.defineProperty(b,"__esModule",{value:!0});var B=function(a,c,d){return[c,d]},C=function(a,c,d){return[c,d,a[2]]},E=function(a,c,d){return[c,d,a[2],a[3]]};b.toQuantizationTransform=function(a){return a?{originPosition:"upperLeft",scale:[a.tolerance,a.tolerance],translate:[a.extent.xmin,a.extent.ymax]}:
null};b.equals=function(a,c){if(a===c||null==a&&null==c)return!0;if(null==a||null==c)return!1;var d,e,b,g;a&&"upperLeft"===a.originPosition?(d=a.translate[0],e=a.translate[1],a=a.scale[0]):(d=a.extent.xmin,e=a.extent.ymax,a=a.tolerance);c&&"upperLeft"===c.originPosition?(b=c.translate[0],g=c.translate[1],c=c.scale[0]):(b=c.extent.xmin,g=c.extent.ymax,c=c.tolerance);return d===b&&e===g&&a===c};b.quantizeX=f;b.quantizeY=k;b.quantizeBounds=function(a,c,d){c[0]=f(a,d[0]);c[3]=k(a,d[1]);c[2]=f(a,d[2]);
c[1]=k(a,d[3]);return c};b.quantizePoints=h;b.quantizeRings=m;b.quantizePaths=p;b.hydrateX=c;b.hydrateY=a;b.hydrateCoordsArray=l;b.hydrateCoordsArrayArray=g;b.hydrateBounds=function(d,e,b){return b?(e[0]=c(d,b[0]),e[1]=a(d,b[3]),e[2]=c(d,b[2]),e[3]=a(d,b[1]),e):[c(d,e[0]),a(d,e[3]),c(d,e[2]),a(d,e[1])]};b.hydratePoints=e;b.hydratePaths=u;b.hydrateRings=t;b.getQuantizedBoundsCoordsArray=r;b.getQuantizedBoundsCoordsArrayArray=y;b.getQuantizedBoundsPoints=function(a){var c=[Number.POSITIVE_INFINITY,
Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return r(c,c,a)};b.getQuantizedBoundsPaths=function(a){return y([0,0,0,0],a)};b.getQuantizedBoundsRings=function(a){return y([0,0,0,0],a)};b.quantizeExtent=w;b.quantizeMultipoint=x;b.quantizePoint=v;b.quantizePolygon=z;b.quantizePolyline=A;b.quantizeGeometry=function(a,c){return a&&c?n.isPoint(c)?v(a,{},c,!1,!1):n.isPolyline(c)?A(a,{},c,!1,!1):n.isPolygon(c)?z(a,{},c,!1,!1):n.isMultipoint(c)?x(a,{},c,!1,!1):n.isExtent(c)?
w(a,{},c,!1,!1):null:null};b.hydrateExtent=function(d,e,b,g,l){e.xmin=c(d,b.xmin);e.ymin=a(d,b.ymin);e.xmax=c(d,b.xmax);e.ymax=a(d,b.ymax);e!==b&&(g&&(e.zmin=b.zmin,e.zmax=b.zmax),l&&(e.mmin=b.mmin,e.mmax=b.mmax));return e};b.hydrateMultipoint=function(a,c,d,b,g){c.points=e(a,d.points,b,g);return c};b.hydratePoint=function(d,e,b,g,l){e.x=c(d,b.x);e.y=a(d,b.y);e!==b&&(g&&(e.z=b.z),l&&(e.m=b.m));return e};b.hydratePolygon=function(a,c,d,e,b){c.rings=t(a,d.rings,e,b);return c};b.hydratePolyline=function(a,
c,d,e,b){c.paths=u(a,d.paths,e,b);return c}})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["require","exports","../../core/compilerUtils"],function(q,b,n){function f(d,c){if(d===c)return!0;if(null==d||null==c||d.length!==c.length)return!1;for(var a=0;a<d.length;a++){var b=d[a],g=c[a];if(b.length!==g.length)return!1;for(var e=0;e<b.length;e++)if(b[e]!==g[e])return!1}return!0}function k(d,c){if(d===c)return!0;if(null==d||null==c||d.length!==c.length)return!1;for(var a=0;a<
d.length;a++)if(!f(d[a],c[a]))return!1;return!0}function d(d,c){return d===c||d&&c&&d.equals(c)}function h(b,c){if(b===c)return!0;if(!b||!c||b.type!==c.type)return!1;switch(b.type){case "point":return b=d(b.spatialReference,c.spatialReference)?b.x===c.x&&b.y===c.y&&b.z===c.z&&b.m===c.m:!1,b;case "extent":return b=b.hasZ!==c.hasZ||b.hasM!==c.hasM?!1:d(b.spatialReference,c.spatialReference)?b.xmin===c.xmin&&b.ymin===c.ymin&&b.zmin===c.zmin&&b.xmax===c.xmax&&b.ymax===c.ymax&&b.zmax===c.zmax:!1,b;case "polyline":return b=
b.hasZ!==c.hasZ||b.hasM!==c.hasM?!1:d(b.spatialReference,c.spatialReference)?k(b.paths,c.paths):!1,b;case "polygon":return b=b.hasZ!==c.hasZ||b.hasM!==c.hasM?!1:d(b.spatialReference,c.spatialReference)?k(b.rings,c.rings):!1,b;case "multipoint":return b=b.hasZ!==c.hasZ||b.hasM!==c.hasM?!1:d(b.spatialReference,c.spatialReference)?f(b.points,c.points):!1,b;case "mesh":return!1;default:n.neverReached(b)}}function m(d,c){if(d===c)return!0;if(!d||!c)return!1;var a=Object.keys(d),b=Object.keys(c);if(a.length!==
b.length)return!1;for(b=0;b<a.length;b++){var g=a[b];if(d[g]!==c[g])return!1}return!0}Object.defineProperty(b,"__esModule",{value:!0});b.equals=function(d,c){return d===c?!0:null!=d&&null!=c&&d.objectId===c.objectId&&h(d.geometry,c.geometry)&&m(d.attributes,c.attributes)?!0:!1}})},"esri/views/3d/support/earthUtils":function(){define("require exports ../../../core/wgs84Constants ../../../core/libs/gl-matrix-2/vec3 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./mathUtils".split(" "),
function(q,b,n,f,k,d,h,m){function p(a,c,d,g){var e,l;a instanceof k&&c instanceof k&&(d=c.longitude,g=c.latitude,l=a.latitude,e=a.longitude);a=m.deg2rad(l);g=m.deg2rad(g);e=m.deg2rad(e);c=m.deg2rad(d);d=Math.sin((a-g)/2);e=Math.sin((e-c)/2);d=2*m.asin(Math.sqrt(d*d+Math.cos(a)*Math.cos(g)*e*e))*b.earthRadius;return Math.round(1E4*d)/1E4}function c(a,c,d){a=d/b.earthRadius;c=m.deg2rad(c);a=Math.sin(a/2);c=Math.cos(c);c=2*m.asin(Math.sqrt(a*a/(c*c)));return m.rad2deg(c)}function a(a,c,d){return m.rad2deg(d/
b.earthRadius)}function l(a,c){a/=15;c||(a=Math.round(a));return a}Object.defineProperty(b,"__esModule",{value:!0});b.earthRadius=n.wgs84Radius;b.halfEarthCircumference=Math.PI*b.earthRadius;b.earthCircumference=2*b.halfEarthCircumference;b.metersPerDegree=b.halfEarthCircumference/180;var g=new k(0,0,d.WGS84);b.getGreatCircleDistance=p;b.getGreatCircleSpanAt=function(a,c,d){var e=c.spatialReference,b=new k(c.x,a.y,e),g=new k(d.x,a.y,e);c=new k(a.x,c.y,e);a=new k(a.x,d.y,e);return{lon:p(b,g),lat:p(c,
a)}};b.getLonDeltaForDistance=c;b.getLatDeltaForDistance=a;b.getLatLonDeltaForDistance=function(d,b,g){return{lat:a(d,b,g),lon:c(d,b,g)}};b.getMaxCameraAltitude=function(a){a=m.deg2rad(a/2);return(1-Math.sin(a))*b.earthRadius/Math.sin(a)};b.getViewExtentDistance=function(a,c){c=m.deg2rad(c/2);return 2*m.acos((Math.pow(a+b.earthRadius,2)+Math.pow(b.earthRadius,2)-Math.pow((a+b.earthRadius)*Math.cos(c)-Math.sqrt(Math.pow(Math.cos(c)*(a+b.earthRadius),2)-a*a-2*a*b.earthRadius),2))/(2*(a+b.earthRadius)*
b.earthRadius))*b.earthRadius};b.computeCarthesianDistance=function(a,c){function d(a){var c=m.deg2rad(a.latitude),d=m.deg2rad(a.longitude),e=Math.cos(c);a=b.earthRadius+(a.z||0);return[Math.cos(d)*e*a,Math.sin(c)*a,-Math.sin(d)*e*a]}a=d(a);c=d(c);c=[c[0]-a[0],c[1]-a[1],c[2]-a[2]];return Math.sqrt(c[0]*c[0]+c[1]*c[1]+c[2]*c[2])};b.longitudeToTimezone=l;b.positionToTimezone=function(a,c){a.spatialReference.wkid!==d.WGS84.wkid?h.webMercatorToGeographic(a,!1,g):(g.x=a.x,g.y=a.y);g.z=a.z;c||(c={hours:0,
minutes:0,seconds:0});c.hours=l(g.x,!0);a=c.hours%1;c.hours-=a;c.minutes=60*a;a=c.minutes%1;c.minutes-=a;c.seconds=Math.round(60*a);return c};b.distanceToIdealHorizon=function(a,c){c=c||b.earthRadius;a=f.vec3.dot(a,a);return Math.sqrt(Math.abs(a-c*c))}})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});(function(b){b.length=function(b,k){var d=b[k],h=b[k+1];b=b[k+2];return Math.sqrt(d*d+h*h+b*
b)};b.normalize=function(b,k){var d=b[k],h=b[k+1],f=b[k+2],d=1/Math.sqrt(d*d+h*h+f*f);b[k]*=d;b[k+1]*=d;b[k+2]*=d};b.scale=function(b,k,d){b[k]*=d;b[k+1]*=d;b[k+2]*=d};b.add=function(b,k,d,h,m,p){void 0===p&&(p=k);m=m||b;m[p]=b[k]+d[h];m[p+1]=b[k+1]+d[h+1];m[p+2]=b[k+2]+d[h+2]};b.subtract=function(b,k,d,h,m,p){void 0===p&&(p=k);m=m||b;m[p]=b[k]-d[h];m[p+1]=b[k+1]-d[h+1];m[p+2]=b[k+2]-d[h+2]}})(b.Vec3Compact||(b.Vec3Compact={}))})},"esri/views/PopupView":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/awaiterHelper ../core/tsSupport/generatorHelper ../core/Accessor ../core/arrayUtils ../core/asyncUtils ../core/maybe ../core/Promise ../core/promiseUtils ../core/accessorSupport/decorators".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e){return function(b){function l(){return null!==b&&b.apply(this,arguments)||this}f(l,b);l.prototype.when=function(a,c){return this.inherited(arguments)};l.prototype.fetchPopupFeatures=function(a,d){return c.safeCast(this._fetchPopupFeaturesAsync(a,d))};l.prototype._fetchPopupFeaturesAsync=function(a,c){return d(this,void 0,void 0,function(){var d,e,b,l,f,m;return h(this,function(h){switch(h.label){case 0:return[4,this.when()];case 1:return h.sent(),[4,this._prepareFetchPopupFeatures(a,
c)];case 2:return d=h.sent(),e=d.location,b=this._queryLayerPopupFeatures(d,c),l=g.resolve(d.clientOnlyGraphics),f=[l].concat(b),m=g.eachAlwaysValues(f).then(p.flatten),[2,{promise:m,location:e,promises:f}]}})})};l.prototype._queryLayerPopupFeatures=function(c,d){var e=c.queryArea;return c.layerViewsAndGraphics.map(function(c){var b=c.layerView;c={clientGraphics:c.graphics,defaultPopupTemplateEnabled:a.isSome(d)?!!d.defaultPopupTemplateEnabled:!1};return b.fetchPopupFeatures(e,c)})};l.prototype._isValidPopupGraphic=
function(c,d){return c&&!!c.getEffectivePopupTemplate(a.isSome(d)&&d.defaultPopupTemplateEnabled)};l.prototype._prepareFetchPopupFeatures=function(a,c){return d(this,void 0,void 0,function(){var d,e,b,g,l,f,m,p;return h(this,function(h){switch(h.label){case 0:return[4,this._popupHitTestGraphics(a,c)];case 1:return d=h.sent(),e=d.clientGraphics,b=d.queryArea,g=d.location,l=this._getFetchPopupLayerViews(),f=this._graphicsPerFetchPopupLayerView(e,l),m=f.layerViewsAndGraphics,p=f.clientOnlyGraphics,[2,
{clientOnlyGraphics:p,layerViewsAndGraphics:m,queryArea:b,location:g}]}})})};l.prototype._popupHitTestGraphics=function(a,c){return d(this,void 0,void 0,function(){var d,e,b,g,l,f,m=this;return h(this,function(h){switch(h.label){case 0:return[4,this.popupHitTest(a)];case 1:return d=h.sent(),e=d.results,b=d.mapPoint,g=e.filter(function(a){return m._isValidPopupGraphic(a.graphic,c)}),l=g.length?g[0].mapPoint:null,f=g.map(function(a){return a.graphic}),[2,{clientGraphics:f,queryArea:b,location:b||l}]}})})};
l.prototype._getFetchPopupLayerViews=function(){var a=this,c=[];this.allLayerViews.forEach(function(d){a._isValidPopupLayerView(d)&&c.push(d)});this._isValidPopupLayerView(this.graphicsView)&&c.push(this.graphicsView);return c.reverse()};l.prototype._isValidPopupLayerView=function(c){return a.isSome(c)&&(!("layer"in c)||!c.suspended)&&"function"===typeof c.fetchPopupFeatures};l.prototype._graphicsPerFetchPopupLayerView=function(a,c){var d=[],e=new Map;c=c.map(function(a){var c=[];"layer"in a?e.set(a.layer,
c):e.set(a.graphics,c);return{layerView:a,graphics:c}});for(var b=0;b<a.length;b++){var g=a[b],l=e.get(g.layer)||null;l?l.push(g):d.push(g)}return{layerViewsAndGraphics:c,clientOnlyGraphics:d}};return l=k([e.subclass("esri.views.PopupView")],l)}(e.declared(m,l))})},"esri/views/3d/constraints/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ./AltitudeConstraint ./ClipDistanceConstraint ./CollisionConstraint ./TiltConstraint".split(" "),
function(q,b,n,f,k,d,h,m,p,c){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function b(){var d=null!==a&&a.apply(this,arguments)||this;d.tilt=new c.default;d.altitude=new h.default;d.clipDistance=new m.default;d.collision=new p.default;return d}n(b,a);f([d.property({type:c.default})],b.prototype,"tilt",void 0);f([d.property({type:h.default})],b.prototype,"altitude",void 0);f([d.property({type:m.default})],b.prototype,"clipDistance",void 0);f([d.property({type:p.default})],b.prototype,
"collision",void 0);return b=f([d.subclass("esri.views.3d.constraints.Constraints")],b)}(d.declared(k));b.Constraints=q;b.default=q})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/kernel ../../../core/Accessor ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),function(q,b,n,f,k,d,h,m){Object.defineProperty(b,"__esModule",{value:!0});q=function(d){function c(){var a=
null!==d&&d.apply(this,arguments)||this;a.min=m.AltitudeDefault.min;a.max=m.AltitudeDefault.max;return a}n(c,d);Object.defineProperty(c.prototype,"mode",{get:function(){k.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.","","4.6");return"manual"},set:function(a){k.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",
"","4.6")},enumerable:!0,configurable:!0});f([h.property({type:Number})],c.prototype,"min",void 0);f([h.property({type:Number})],c.prototype,"max",void 0);return c=f([h.subclass("esri.views.3d.constraints.AltitudeConstraint")],c)}(h.declared(d));b.AltitudeConstraint=q;b.default=q})},"esri/views/3d/state/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Logger ../../../core/accessorSupport/decorators ../support/earthUtils ../support/mathUtils".split(" "),
function(q,b,n,f,k,d,h,m,p){Object.defineProperty(b,"__esModule",{value:!0});var c=d.getLogger("esri.views.3d.state.Constraints");q=function(d){function e(a){a=d.call(this)||this;a.collision=new l;a.distance=Infinity;a.minimumPoiDistance=4;return a}n(e,d);Object.defineProperty(e.prototype,"altitude",{get:function(){return"local"===this.mode?null:this._get("altitude")||null},set:function(a){"local"===this.mode?c.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",a)},enumerable:!0,
configurable:!0});e.prototype.clampAltitude=function(a){return this.altitude?p.clamp(a,this.altitude.min,this.altitude.max):a};e.prototype.clampTilt=function(a,c){if(!this.tilt)return c;a=this.tilt(a);return p.clamp(c,a.min,a.max)};e.prototype.clampDistance=function(a){return Math.min(a,this.distance)};e.prototype.createDefaultTilt=function(){return"local"===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()};e.prototype.createConstantMaxTilt=function(c){return function(d,e){void 0===
e&&(e=a);e.min=b.TiltDefault.min;e.max=c;return e}};e.prototype.createDefaultTiltLocal=function(){var c=this.collision.enabled?p.makePiecewiseLinearFunction([[4E3,b.TiltDefault.max],[1E4,p.deg2rad(88)],[6E6,p.deg2rad(88)]]):function(){return b.TiltDefault.max};return function(d,e){void 0===e&&(e=a);e.min=b.TiltDefault.min;e.max=c(d);return e}};e.prototype.createDefaultTiltGlobal=function(){var c=this.collision.enabled?p.makePiecewiseLinearFunction([[4E3,b.TiltDefault.max],[5E4,p.deg2rad(88)],[6E6,
p.deg2rad(88)],[2E7,b.TiltDefault.min]]):p.makePiecewiseLinearFunction([[3E5,b.TiltDefault.max],[3E6,p.deg2rad(88)],[6E6,p.deg2rad(88)],[2E7,b.TiltDefault.min]]);return function(d,e){void 0===e&&(e=a);e.min=b.TiltDefault.min;e.max=c(d);return e}};f([h.property()],e.prototype,"altitude",null);f([h.property({readOnly:!0})],e.prototype,"collision",void 0);f([h.property()],e.prototype,"distance",void 0);f([h.property({readOnly:!0})],e.prototype,"minimumPoiDistance",void 0);f([h.property()],e.prototype,
"tilt",void 0);f([h.property({constructOnly:!0})],e.prototype,"mode",void 0);return e=f([h.subclass("esri.views.3d.state.Constraints")],e)}(h.declared(k));b.Constraints=q;b.AltitudeDefault={min:-2E5,max:4*m.earthRadius};b.TiltDefault={min:p.deg2rad(.5),max:p.deg2rad(179.5)};var a={min:0,max:0},l=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.enabled=!0;c.elevationMargin=5;return c}n(c,a);f([h.property({type:Boolean})],c.prototype,"enabled",void 0);f([h.property({type:Number})],
c.prototype,"elevationMargin",void 0);return c=f([h.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],c)}(h.declared(k));b.default=q})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(q,b,n,f,k,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function h(){var d=
null!==b&&b.apply(this,arguments)||this;d.mode="auto";return d}n(h,b);Object.defineProperty(h.prototype,"near",{get:function(){return this._get("near")},set:function(d){this._set("near",d);d>=this._get("far")&&(this.far=d+1E-9);this.mode="manual"},enumerable:!0,configurable:!0});h.prototype.castNear=function(d){return Math.max(1E-8,d)};Object.defineProperty(h.prototype,"far",{get:function(){return this._get("far")},set:function(d){this._set("far",d);d<=this._get("near")&&(this.near=d-1E-9);this.mode=
"manual"},enumerable:!0,configurable:!0});h.prototype.castFar=function(d){return Math.max(1E-8,d)};h.prototype.autoUpdate=function(d,c){"auto"===this.mode&&(this._get("near")!==d&&this._set("near",d),this._get("far")!==c&&this._set("far",c))};f([d.property({type:Number,value:1E-8})],h.prototype,"near",null);f([d.cast("near")],h.prototype,"castNear",null);f([d.property({type:Number,value:1E-8})],h.prototype,"far",null);f([d.cast("far")],h.prototype,"castFar",null);f([d.property({type:["auto","manual"]})],
h.prototype,"mode",void 0);return h=f([d.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],h)}(d.declared(k));b.ClipDistanceConstraint=q;b.default=q})},"esri/views/3d/constraints/CollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/kernel ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(q,b,n,f,k,d,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(d){function b(){return null!==
d&&d.apply(this,arguments)||this}n(b,d);Object.defineProperty(b.prototype,"enabled",{set:function(c){k.deprecated("SceneView.constraint.collision.enabled","Use Map.ground.navigationConstraint instead","4.8");this._set("enabled",c)},enumerable:!0,configurable:!0});f([h.property({value:!0})],b.prototype,"enabled",null);return b=f([h.subclass("esri.views.3d.constraints.CollisionConstraint")],b)}(h.declared(d));b.CollisionConstraint=q;b.default=q})},"esri/views/3d/constraints/TiltConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../state/Constraints ../support/mathUtils".split(" "),
function(q,b,n,f,k,d,h,m){Object.defineProperty(b,"__esModule",{value:!0});var p=m.rad2deg(h.TiltDefault.min),c=m.rad2deg(h.TiltDefault.max);q=function(a){function b(){var c=null!==a&&a.apply(this,arguments)||this;c.mode="auto";return c}n(b,a);Object.defineProperty(b.prototype,"max",{get:function(){return this._get("max")},set:function(a){this._set("max",a);this.mode="manual"},enumerable:!0,configurable:!0});b.prototype.castMax=function(a){return m.clamp(a,p,c)};b.prototype.autoUpdate=function(a){"auto"===
this.mode&&this._get("max")!==a&&this._set("max",a)};f([d.property({type:["auto","manual"]})],b.prototype,"mode",void 0);f([d.property({type:Number,value:c})],b.prototype,"max",null);f([d.cast("max")],b.prototype,"castMax",null);return b=f([d.subclass("esri.views.3d.constraints.TiltConstraint")],b)}(d.declared(k));b.TiltConstraint=q;b.default=q})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType ./SceneViewAtmosphere ./SceneViewLighting ../../../webscene/Environment ../../../webscene/Lighting".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l){return function(a){function e(c){c=a.call(this,c)||this;c.atmosphere=new p.default;return c}n(e,a);b=e;e.fromWebsceneEnvironment=function(a){a=a.cloneConstructProperties();return new b(k({},a,{lighting:c.SceneViewLighting.fromWebsceneLighting(a.lighting)}))};e.prototype.castLighting=function(a){return a?a instanceof c.SceneViewLighting?a:a instanceof l?this.lighting?this.lighting.cloneWithWebsceneLighting(a):c.SceneViewLighting.fromWebsceneLighting(a):m.ensureType(c.SceneViewLighting,
a):new c.SceneViewLighting};e.prototype.clone=function(){return new b({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:d.clone(this.background)})};var b;f([h.property({type:p.default,json:{read:!1}})],e.prototype,"atmosphere",void 0);f([h.property()],e.prototype,"lighting",void 0);f([h.cast("lighting")],e.prototype,"castLighting",null);return e=b=f([h.subclass("esri.views.3d.environment.SceneViewEnvironment")],
e)}(h.declared(a))})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(q,b,n,f,k,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function h(){return null!==b&&b.apply(this,arguments)||this}n(h,b);p=h;Object.defineProperty(h.prototype,"quality",{set:function(c){-1!==["low","high"].indexOf(c)&&
this._set("quality",c)},enumerable:!0,configurable:!0});h.prototype.clone=function(){return new p({quality:this.quality})};var p;f([d.property({type:["low","high"],value:"low"})],h.prototype,"quality",null);return h=p=f([d.subclass("esri.views.3d.environment.SceneViewAtmosphere")],h)}(d.declared(k));b.SceneViewAtmosphere=q;b.default=q})},"esri/views/3d/environment/SceneViewLighting":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Evented ../../../core/accessorSupport/decorators ../../../webscene/Lighting".split(" "),
function(q,b,n,f,k,d,h,m){Object.defineProperty(b,"__esModule",{value:!0});q=function(c){function a(a){a=c.call(this,a)||this;a.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};a.cameraTrackingEnabled=!0;a.ambientOcclusionEnabled=!1;var d=(new Date).getFullYear(),d=new Date("March 15, "+d+" 12:00:00 UTC");a._set("defaultDate",d);a._set("date",d);return a}n(a,c);d=a;a.fromWebsceneLighting=function(a){return new d(k({},a.cloneConstructProperties()))};Object.defineProperty(a.prototype,
"defaultDate",{get:function(){return new Date(this._get("defaultDate").getTime())},set:function(a){var c=this._get("date")===this._get("defaultDate");a=new Date(a.getTime());this._set("defaultDate",a);c&&this._set("date",a)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"date",{set:function(a){null!=a&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(a.getTime())))},enumerable:!0,configurable:!0});a.prototype.autoUpdate=function(a,c){var d=this._calculateTimezoneOffset(this.positionTimezoneInfo);
this.positionTimezoneInfo.hours=c.hours;this.positionTimezoneInfo.minutes=c.minutes;this.positionTimezoneInfo.seconds=c.seconds;c=null;null!=a&&(this.positionTimezoneInfo.autoUpdated=!0,c=this.date&&this.date.getTime(),this._set("date",new Date(a.getTime())));var e=this._calculateTimezoneOffset(this.positionTimezoneInfo);d!==e&&(p.target=this,p.timezoneOffset=e,this.emit("timezone-will-change",p));if(null!=a)return c!==a.getTime()};a.prototype.clone=function(){var a=this._get("date")===this._get("defaultDate"),
c=new d(k({},this.cloneConstructProperties(),{defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled}));a&&c._set("date",c._get("defaultDate"));c.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;c.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;c.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;c.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return c};a.prototype.cloneWithWebsceneLighting=
function(a){var c=this.clone();null!=a.date&&(c.date=a.date);c.directShadowsEnabled=a.directShadowsEnabled;c.displayUTCOffset=a.displayUTCOffset;return c};a.prototype._calculateTimezoneOffset=function(a){return Math.round(a.hours+a.minutes/60+a.seconds/3600)};var d;f([h.property({type:Boolean})],a.prototype,"cameraTrackingEnabled",void 0);f([h.property({type:Boolean})],a.prototype,"ambientOcclusionEnabled",void 0);f([h.property({type:Date})],a.prototype,"defaultDate",null);f([h.property({type:Date})],
a.prototype,"date",null);return a=d=f([h.subclass("esri.views.3d.environment.SceneViewLighting")],a)}(h.declared(m,d));b.SceneViewLighting=q;var p={target:null,timezoneOffset:0};b.default=q})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/Evented ../../../core/Handles ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z){Object.defineProperty(b,"__esModule",{value:!0});var A=g.vec3f64.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);q=function(d){function b(a){var c=d.call(this)||this;c.referencePointUpdateDelay=200;c.referencePointUpdateInterval=3E3;c.referencePointUpdateDistThreshold=1E6;c._referencePosUpdateQuery=null;c._referencePosMapCoordsRequested=null;c._viewHandles=new m;c._preserveAbsoluteDateTime=!1;c._trackingEnabled=!1;c._viewConnected=
!1;c._referencePosResetPreserveAbsoluteTime=!1;c.referencePosUpdateTimer=null;c._referencePosWGS84=null;c._referencePosMapCoords=null;c._mainLight=new v.MainLight;c._ambientLight=new v.AmbientLight;c._moonLight=new v.FillLight;c._environmentRenderer=null;c.debug=function(){return{set referencePointUpdateInterval(a){c.referencePointUpdateInterval=a},set referencePointUpdateDistThreshold(a){c.referencePointUpdateDistThreshold=a},set referencePosUpdateTimer(a){c.referencePosUpdateTimer=a},set referencePointUpdateDelay(a){c.referencePointUpdateDelay=
a}}}();c._resetReferencePosition();return c}n(b,d);b.prototype.destroy=function(){this._viewHandles.destroy();this.disposeRendering()};Object.defineProperty(b.prototype,"updating",{get:function(){return!this.noReferencePositionQueries&&(!!this._referencePosUpdateQuery||!!this._referencePosMapCoordsRequested)||this._environmentRenderer.updating},enumerable:!0,configurable:!0});b.prototype.updateReadyChange=function(a){a&&!this._viewConnected?(this._viewConnected=!0,this.connectView(this.view)):!a&&
this._viewConnected&&(this._viewConnected=!1,this.disconnectView(this.view))};b.prototype.disposeRendering=function(){this._environmentRenderer&&(this._environmentRenderer.destroy(),this._environmentRenderer=null);this._resetReferencePosition(!0)};b.prototype.connectView=function(a){var d=this;this._environmentRenderer=new y({view:a});this._viewHandles.add([this.view.watch("environment.lighting.date",function(a){return d._lightingDateHandler(a)},!0),this.view.watch("interacting,stationary",this._interactingStationaryHandler.bind(this)),
this.view.watch(["environment.lighting.directShadowsEnabled","environment.lighting.ambientOcclusionEnabled","environment.background.color"],this._updateRenderParamsHandler.bind(this)),this.view.watch("spatialReference",this._spatialReferenceHandler.bind(this)),c.init(this.view,"viewingMode",this._viewingModeHandler.bind(this)),c.init(this.view,"environment.lighting.cameraTrackingEnabled",this._updateCameraTracking.bind(this),!0),c.init(this,"view.state.camera",this._cameraHandler.bind(this,null),
!0),this.watch("noReferencePositionQueries",this._cameraHandler.bind(this,null))]);this._updateRenderParamsHandler();this._updateLightParams();this._cameraHandler()};b.prototype._updateCameraTracking=function(a){if(this._trackingEnabled=a)this._cameraHandler();else if(a=this.get("view.environment.lighting"))a.positionTimezoneInfo.autoUpdated=!1};b.prototype.disconnectView=function(a){this.disposeRendering();this._viewHandles.removeAll()};b.prototype._lightingDateHandler=function(a){if(a){var c=this.view.environment.lighting;
if(!c.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;var d=this.view.spatialReference;if(!(d.isWGS84||d.isWebMercator||(d=this.view.camera.position,this._referencePosMapCoords&&this._referencePosMapCoords.equals(d)))){this._requestReferencePositionUpdate(d);return}this._preupdateTracking(a);this._referencePosWGS84&&(d=w.positionToTimezone(this._referencePosWGS84,C),c.autoUpdate(null,d),this._trackingEnabled&&(c.positionTimezoneInfo.autoUpdated=!0))}this._updateLightParams(a)}};
b.prototype._preupdateTracking=function(a){!this._trackingEnabled&&this.get("view.environment.lighting.cameraTrackingEnabled")&&this._cameraHandler(a)};b.prototype._cameraHandler=function(a){void 0===a&&(a=null);if(this.view.ready){var c=this.view.camera;if(c){var d=this.view.spatialReference;d.isWGS84||d.isWebMercator?this._cameraHandlerGlobal(c,a):this._cameraHandlerLocal(c,a)}}};b.prototype._cameraHandlerGlobal=function(a,c){a=a.position;this._referencePosWGS84||(this._referencePosWGS84=new u({spatialReference:t.WGS84}));
a.spatialReference.isWebMercator?r.webMercatorToGeographic(a,!1,this._referencePosWGS84):(this._referencePosWGS84.x=a.x,this._referencePosWGS84.y=a.y);this._referencePosWGS84.z=a.z;this._autoUpdateTimezone(a,c)||this._updateLightParams(c)};b.prototype._cameraHandlerLocal=function(a,c){a=a.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(a))&&this._requestReferencePositionUpdate(a,!0);this.view.mapCoordsHelper&&this._referencePosWGS84&&
(this._referencePosWGS84.z=a.z*this.view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};b.prototype._interactingStationaryHandler=function(){!this.view.interacting&&this.view.stationary&&this._executePendingReferencePositionUpdate()};b.prototype._updateLightParams=function(a){void 0===a&&(a=null);var c=this.view.environment.lighting;a=a||c.date;var c=this.view._stage,d;this._referencePosWGS84?(d=x.computeColorAndIntensity(a,this._referencePosWGS84),x.computeDirection(a,this._referencePosWGS84,
this.view.viewingMode,d.diffuse.direction)):d={diffuse:{color:[1,1,1],intensity:.55,direction:A},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0};l.vec3.scale(this._mainLight.intensity,d.diffuse.color,d.diffuse.intensity*Math.PI);l.vec3.negate(this._mainLight.direction,d.diffuse.direction);l.vec3.scale(this._ambientLight.intensity,d.ambient.color,d.ambient.intensity);l.vec3.lerp(this._moonLight.intensity,E,F,d.globalFactor);l.vec3.scale(this._moonLight.intensity,this._moonLight.intensity,
(1-.5*d.globalFactor)*(1-.4*d.noonFactor*(1-d.globalFactor)));l.vec3.copy(this._moonLight.direction,d.diffuse.direction);c.setLighting({lights:[this._mainLight,this._ambientLight,this._moonLight],globalFactor:d.globalFactor,groundLightingFactor:1-d.noonFactor});this._updateRenderParamsHandler()};b.prototype._autoUpdateTimezone=function(a,c){void 0===c&&(c=null);if(!this.view.get("environment.lighting.cameraTrackingEnabled"))return!1;var d=B;d.setTime((c||this.view.environment.lighting.date).getTime());
a=w.positionToTimezone(a,C);var e=this.view.environment.lighting.positionTimezoneInfo;if(!e.autoUpdated)e=a;else if(e.hours===a.hours&&e.minutes===a.minutes&&e.seconds===a.seconds)return!1;var b=d.getUTCHours()-(a.hours-e.hours),g=d.getUTCMinutes()-(a.minutes-e.minutes),e=d.getUTCSeconds()-(a.seconds-e.seconds);d.setUTCHours(b);d.setUTCMinutes(g);d.setUTCSeconds(e);return c?!1:this.view.environment.lighting.autoUpdate(d,a)};b.prototype._updateRenderParamsHandler=function(){var a=this.view._stage,
c=!0;this._referencePosWGS84&&(c=x.computeShadowsEnabled(this._referencePosWGS84,this.view.viewingMode));var d=this.view.environment.background,d=d instanceof z?{type:"color",color:e.vec4f64.fromArray(k.toUnitRGBA(d.color))}:{type:"color",color:e.vec4f64.fromValues(0,0,0,1)};a&&a.setRenderParams({shadowMap:this.view.environment.lighting.directShadowsEnabled&&c,ssao:this.view.environment.lighting.ambientOcclusionEnabled,background:d})};b.prototype._spatialReferenceHandler=function(){this._resetReferencePosition()};
b.prototype._viewingModeHandler=function(){this._resetReferencePosition()};b.prototype._resetReferencePosition=function(a){void 0===a&&(a=!1);this._cancelReferencePosUpdates();this._referencePosWGS84=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;a||this.notifyChange("updating")};b.prototype._requestReferencePositionUpdate=function(a,c){var d=this;void 0===c&&(c=!1);if(this.view.mapCoordsHelper.canProject()&&!this.noReferencePositionQueries&&
(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(a):this._referencePosMapCoordsRequested=a.clone(),this._referencePosResetPreserveAbsoluteTime=!!c,!this._referencePosUpdateQuery&&!this.referencePosUpdateTimer&&!this.view.interacting&&this.view.stationary)){var e=this._referencePosUpdateQuery=p.after(this.referencePointUpdateDelay).then(function(){if(d._referencePosUpdateQuery===e)return d._doReferencePositionUpdateQuery(function(){return d._referencePosUpdateQuery!==
e})}).catch(function(){}).then(function(){d._referencePosUpdateQuery===e&&(d._referencePosUpdateQuery=null,d.referencePosUpdateTimer||d._executePendingReferencePositionUpdate(),d.notifyChange("updating"))}),b=this.referencePosUpdateTimer=p.after(this.referencePointUpdateInterval).then(function(){d.referencePosUpdateTimer===b&&(d.referencePosUpdateTimer=null,d._referencePosUpdateQuery||d._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};b.prototype._doReferencePositionUpdateQuery=
function(a){var c=this;this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;return this.view.mapCoordsHelper.toGeographic(this._referencePosMapCoords).then(function(d){if(!a()&&!isNaN(d[0])&&!isNaN(d[1])){var e=c._referencePosMapCoords.z*
c.view.mapCoordsHelper.unitInMeters;c._referencePosWGS84?(c._referencePosWGS84.x=d[0],c._referencePosWGS84.y=d[1],c._referencePosWGS84.z=e):c._referencePosWGS84=new u({x:d[0],y:d[1],z:e,spatialReference:t.WGS84});c._referencePosChanged()}})};b.prototype._executePendingReferencePositionUpdate=function(){var a=this._referencePosMapCoordsRequested;a&&this._requestReferencePositionUpdate(a,this._referencePosResetPreserveAbsoluteTime)};b.prototype._referencePosChanged=function(){this._preserveAbsoluteDateTime?
this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84)||this._updateLightParams()};b.prototype._exceedsReferencePosDistThreshold=function(a){return this._referencePosMapCoords?(a=this._referencePosMapCoords.distance(a),this.view.mapCoordsHelper&&(a*=this.view.mapCoordsHelper.unitInMeters),a>this.referencePointUpdateDistThreshold):!0};b.prototype._cancelReferencePosUpdates=function(){this.referencePosUpdateTimer=this._referencePosUpdateQuery=null};b.FIXED_LIGHT_DIRECTION=A;f([a.property({type:Boolean,
dependsOn:["noReferencePositionQueries","_environmentRenderer.updating"],readOnly:!0})],b.prototype,"updating",null);f([a.property()],b.prototype,"noReferencePositionQueries",void 0);f([a.property({constructOnly:!0})],b.prototype,"view",void 0);f([a.property()],b.prototype,"_environmentRenderer",void 0);return b=f([a.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],b)}(a.declared(d,h));b.SceneViewEnvironmentManager=q;var B=new Date,C={hours:0,minutes:0,seconds:0},E=g.vec3f64.fromValues(.22,
.22,.33),F=g.vec3f64.fromValues(.22,.22,.22);b.default=q})},"esri/core/libs/gl-matrix-2/vec4f64":function(){define(["require","exports","./factories/vec4f64"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.vec4f64=n})},"esri/core/libs/gl-matrix-2/factories/vec4f64":function(){define(["require","exports"],function(q,b){function n(){return[0,0,0,0]}Object.defineProperty(b,"__esModule",{value:!0});b.create=n;b.clone=function(b){return[b[0],b[1],b[2],b[3]]};b.fromValues=function(b,
k,d,h){return[b,k,d,h]};b.fromArray=function(b){for(var f=n(),d=Math.min(4,b.length),h=0;h<d;++h)f[h]=b[h];return f};b.createView=function(b,k){return new Float64Array(b,k,4)}})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/compilerUtils ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g){var e=[12,13];return function(b){function k(){var a=null!==b&&b.apply(this,arguments)||this;a.needsRender=!1;a.didRender=!0;a._handles=new h;a._initContext=null;a._atmosphereReadyPromise=null;a._atmosphere=null;a._stars=null;return a}n(k,b);Object.defineProperty(k.prototype,"updating",{get:function(){return!(!this._atmosphereReadyPromise||this._atmosphereReadyPromise.isFulfilled())},enumerable:!0,configurable:!0});k.prototype.initialize=function(){this.view._stage.addRenderPlugin(e,
this)};k.prototype.destroy=function(){this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null);this._stars&&(this._stars.destroy(),this._stars=null);this._handles&&this._handles.removeAll();this.view&&(this.view._stage.removeRenderPlugin(this),this.view=null)};k.prototype.initializeRenderContext=function(a){this._initContext=a;this.setup()};k.prototype.setup=function(){var a=this;this._handles.add(m.when(this.view,"basemapTerrain",function(){return a._updateBasemapTerrain()}));this._handles.add([m.init(this.view,
["viewingMode","environment.atmosphereEnabled","environment.atmosphere.quality"],function(){return a._updateAtmosphere()}),m.init(this.view,"environment.starsEnabled",function(){return a._updateStars()})])};k.prototype.uninitializeRenderContext=function(a){this._stars&&(this._stars.uninitializeRenderContext(a),this._stars.destroy(),this._stars=null);this._atmosphere&&(this._atmosphere.uninitializeRenderContext(a),this._atmosphere.destroy(),this._atmosphere=null)};k.prototype.render=function(a){var c=
this.view.basemapTerrain;if(!(c&&c.loaded||"global"!==this.view.viewingMode))return!1;c=!0;this._stars&&(c=this._stars.render(a)&&c);this._atmosphere&&(c=this._atmosphere.render(a)&&c);return c};k.prototype._updateStars=function(){var a=this.view.get("environment.starsEnabled")||!1;a&&!this._stars?(this._stars=new g(this.view),this._stars.initializeRenderContext(this._initContext),this.needsRender=!0):!a&&this._stars&&(this._stars.destroy(),this._stars=null,this.needsRender=!0)};k.prototype._updateAtmosphere=
function(){var a=this,c=this._getAtmosphereType(this._initContext);if(this.atmosphereType!==c)if(this.atmosphereType=c,this._atmosphereReadyPromise&&(this._atmosphereReadyPromise.cancel(),this._atmosphereReadyPromise=null),c=this._getAtmosphereClass(c)){var d=new c(this.view);d.initializeRenderContext(this._initContext);null==this._atmosphere&&(this._atmosphere=d,this.needsRender=!0);this._atmosphereReadyPromise=d.when(function(){a._atmosphere!==d&&(a._atmosphere&&(a._atmosphere.destroy(),a._atmosphere=
null),a._atmosphere=d);a._atmosphereReadyPromise=null;a.needsRender=!0;a._updateBasemapTerrain();a.notifyChange("updating")});this.notifyChange("updating")}else this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null,this.needsRender=!0),this._updateBasemapTerrain()};k.prototype._getAtmosphereClass=function(e){switch(e){case "none":return null;case "realistic":return a;case "panoramic":return c;case "simple":return l;default:d.neverReached(e)}};k.prototype._getAtmosphereType=function(c){var d=
this.view.get("environment.atmosphereEnabled"),e=this.view.get("environment.atmosphere.quality");return d&&null!=e?"local"===this.view.viewingMode?"panoramic":"high"===e&&a.isSupported(c)?"realistic":"simple":"none"};k.prototype._updateBasemapTerrain=function(){var a=this.view.basemapTerrain;a&&(a.velvetOverground=null!=this._atmosphere&&"simple"===this.atmosphereType)};f([p.property()],k.prototype,"view",void 0);f([p.property()],k.prototype,"updating",null);return k=f([p.subclass("esri.views.3d.environment.EnvironmentRenderer")],
k)}(p.declared(k))})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("require exports ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ./resources/SimpleAtmosphereTexture ../support/imageUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/Util ../webgl-engine/shaders/SimpleAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/renderState ../../webgl/Texture ../../webgl/Util ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y){q=function(){function b(a){this.needsRender=!1;this.didRender=!0;this.slot=12;this.view=a}b.prototype.destroy=function(){this._program&&(this._program.dispose(),this._program=null);this._texture&&(this._texture.dispose(),this._texture=null);this._readyPromise&&(this._readyPromise.cancel(),this._readyPromise=null)};b.prototype.when=function(a){return this._readyPromise.then(a)};b.prototype.initializeRenderContext=function(c){var b=this,l=c.rctx;this._program=
g.createProgram(l,a.colorPass,{panoramic:!0});this._pipelineState=e.makePipelineState({blending:e.separateBlendingParams(770,1,771,771),culling:e.backFaceCullingParams,depthTest:{func:515},colorWrite:e.defaultColorWriteParams});this._vao=this._createVertexArrayObject(l);this._vaoCount=r.vertexCount(this._vao,"geometry");this._readyPromise=d.requestImage(k).then(function(a){b._texture=new u(c.rctx,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},a);b.needsRender=!0})};b.prototype.uninitializeRenderContext=
function(a){this.destroy()};b.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass||null==this._texture)return!1;var c=a.rctx,d=this._program;c.bindProgram(d);c.setPipelineState(this._pipelineState);c.bindTexture(this._texture);d.setUniform1i("tex",0);d.setUniformMatrix4fv("proj",a.camera.projectionMatrix);var e=w;n.mat4.copy(e,a.camera.viewMatrix);e[12]=0;e[13]=0;e[14]=0;e[15]=1;d.setUniformMatrix4fv("view",w);d.setUniform4f("color",1,1,1,1);d.setUniform3fv("lightDirection",a.lightingData.direction);
c.bindVAO(this._vao);t.assertCompatibleVertexAttributeLocations(this._vao,d);c.drawArrays(4,0,this._vaoCount);return!0};b.prototype._createVertexArrayObject=function(d){for(var e=p.createPolySphereGeometry(1,2,!1),b=e.indices[c.VertexAttrConstants.POSITION],g=0;g<b.length;g+=3){var f=b[g];b[g]=b[g+2];b[g+2]=f}for(var e=e.vertexAttributes[c.VertexAttrConstants.POSITION].data,f=x.createBuffer(b.length),m=f.position,g=0;g<b.length;++g){var k=3*b[g];m.set(g,0,e[k]);m.set(g,1,e[k+1]);m.set(g,2,e[k+2])}return new y(d,
a.colorPass.attributes,{geometry:h.glLayout(x)},{geometry:l.createVertex(d,35044,f.buffer)})};return b}();var w=f.mat4f64.create(),x=m.newLayout().vec3f("position");return q})},"esri/core/libs/gl-matrix-2/mat4f64":function(){define(["require","exports","./factories/mat4f64"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.mat4f64=n})},"esri/core/libs/gl-matrix-2/factories/mat4f64":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});
b.create=function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]};b.clone=function(b){return[b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8],b[9],b[10],b[11],b[12],b[13],b[14],b[15]]};b.fromValues=function(b,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y){return[b,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y]};b.createView=function(b,f){return new Float64Array(b,f,16)}})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["require","exports"],function(q,b){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/support/imageUtils":function(){define(["require","exports","../../../request"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.dataURItoBlob=function(b){var f=atob(b.split(",")[1]);b=b.split(",")[0].split(":")[1].split(";")[0];for(var d=new ArrayBuffer(f.length),h=new Uint8Array(d),m=0;m<f.length;m++)h[m]=f.charCodeAt(m);return new Blob([d],{type:b})};b.requestImage=function(b){return n(b,{responseType:"image"}).then(function(b){return b.data})}})},"esri/views/3d/support/buffer/glUtil":function(){define(["require",
"exports","../../../../core/tsSupport/assignHelper"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});var f={divisor:0,prefixA:!1};b.glLayout=function(d,b){void 0===b&&(b={});b=n({},f,b);var h=d.stride;return d.fieldNames.filter(function(b){b=d.fields.get(b).optional;return!(b&&b.glPadding)}).map(function(f){var c=d.fields.get(f),a=c.constructor.ElementCount,l;l=k[c.constructor.ElementType];if(!l)throw Error("BufferType not supported in WebGL");var g=c.offset,c=!(!c.optional||!c.optional.glNormalized);
return{name:b.prefixA?"a"+f[0].toUpperCase()+f.substr(1):f,stride:h,count:a,type:l,offset:g,normalized:c,divisor:b.divisor}})};var k={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["require","exports","./BufferView","./types"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});var k=function(){function d(d,b){this.layout=d;this.buffer="number"===typeof b?new ArrayBuffer(b*d.stride):b;b=0;for(var c=
d.fieldNames;b<c.length;b++){var a=c[b],l=d.fields.get(a);this[a]=new l.constructor(this.buffer,l.offset,this.stride)}}Object.defineProperty(d.prototype,"stride",{get:function(){return this.layout.stride},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"count",{get:function(){return this.buffer.byteLength/this.stride},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"byteLength",{get:function(){return this.buffer.byteLength},enumerable:!0,configurable:!0});d.prototype.getField=
function(d,b){return(d=this[d])&&d.elementCount===b.ElementCount&&d.elementType===b.ElementType?d:null};d.prototype.slice=function(b,h){return new d(this.layout,this.buffer.slice(b*this.stride,h*this.stride))};d.prototype.copyFrom=function(d,b,c,a){var l=this.stride;0===l%4?(d=new Uint32Array(d.buffer,b*l,a*l/4),c=new Uint32Array(this.buffer,c*l,a*l/4)):(d=new Uint8Array(d.buffer,b*l,a*l),c=new Uint8Array(this.buffer,c*l,a*l));c.set(d)};return d}();b.InterleavedBuffer=k;var d=function(){function d(){this.stride=
0;this.fields=new Map;this.fieldNames=[]}d.prototype.vec2f=function(d,b){this.appendField(d,n.BufferViewVec2f,b);return this};d.prototype.vec2f64=function(d,b){this.appendField(d,n.BufferViewVec2f64,b);return this};d.prototype.vec3f=function(d,b){this.appendField(d,n.BufferViewVec3f,b);return this};d.prototype.vec3f64=function(d,b){this.appendField(d,n.BufferViewVec3f64,b);return this};d.prototype.vec4f=function(d,b){this.appendField(d,n.BufferViewVec4f,b);return this};d.prototype.vec4f64=function(d,
b){this.appendField(d,n.BufferViewVec4f64,b);return this};d.prototype.mat3f=function(d,b){this.appendField(d,n.BufferViewMat3f,b);return this};d.prototype.mat3f64=function(d,b){this.appendField(d,n.BufferViewMat3f64,b);return this};d.prototype.mat4f=function(d,b){this.appendField(d,n.BufferViewMat4f,b);return this};d.prototype.mat4f64=function(d,b){this.appendField(d,n.BufferViewMat4f64,b);return this};d.prototype.vec4u8=function(d,b){this.appendField(d,n.BufferViewVec4u8,b);return this};d.prototype.f32=
function(d,b){this.appendField(d,n.BufferViewFloat,b);return this};d.prototype.f64=function(d,b){this.appendField(d,n.BufferViewFloat64,b);return this};d.prototype.u8=function(d,b){this.appendField(d,n.BufferViewUint8,b);return this};d.prototype.u16=function(d,b){this.appendField(d,n.BufferViewUint16,b);return this};d.prototype.i8=function(d,b){this.appendField(d,n.BufferViewInt8,b);return this};d.prototype.vec2i8=function(d,b){this.appendField(d,n.BufferViewVec2i8,b);return this};d.prototype.vec2i16=
function(d,b){this.appendField(d,n.BufferViewVec2i16,b);return this};d.prototype.vec2u8=function(d,b){this.appendField(d,n.BufferViewVec2u8,b);return this};d.prototype.vec4u16=function(d,b){this.appendField(d,n.BufferViewVec4u16,b);return this};d.prototype.u32=function(d,b){this.appendField(d,n.BufferViewUint32,b);return this};d.prototype.appendField=function(d,b,c){var a=b.ElementCount*f.elementTypeSize(b.ElementType);this.fields.set(d,{size:a,constructor:b,offset:this.stride,optional:c});this.stride+=
a;this.fieldNames.push(d)};d.prototype.alignTo=function(d){this.stride=Math.floor((this.stride+d-1)/d)*d;return this};d.prototype.hasField=function(d){return 0<=this.fieldNames.indexOf(d)};d.prototype.createBuffer=function(d){return new k(this,d)};d.prototype.createView=function(d){return new k(this,d)};d.prototype.clone=function(){var b=new d;b.stride=this.stride;b.fields=new Map;this.fields.forEach(function(d,c){return b.fields.set(c,d)});b.fieldNames=this.fieldNames.slice();b.BufferType=this.BufferType;
return b};return d}();b.InterleavedLayout=d;b.newLayout=function(){return new d}})},"esri/views/3d/support/buffer/BufferView":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(q,b,n,f,k,d,h,m,p){Object.defineProperty(b,"__esModule",{value:!0});q=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Float32Array,a,d,e,b)||this;a.elementType=
"f32";return a}n(a,c);a.ElementType="f32";return a}(d.BufferViewScalarImpl);b.BufferViewFloat=q;q=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Float32Array,a,d,e,b)||this;a.elementType="f32";return a}n(a,c);a.ElementType="f32";return a}(h.BufferViewVec2Impl);b.BufferViewVec2f=q;q=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Float32Array,a,d,e,b)||this;a.elementType="f32";return a}n(a,c);a.ElementType="f32";return a}(m.BufferViewVec3Impl);b.BufferViewVec3f=q;q=
function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Float32Array,a,d,e,b)||this;a.elementType="f32";return a}n(a,c);a.ElementType="f32";return a}(p.BufferViewVec4Impl);b.BufferViewVec4f=q;q=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Float32Array,a,d,e,b)||this;a.elementType="f32";return a}n(a,c);a.ElementType="f32";return a}(f.BufferViewMat3Impl);b.BufferViewMat3f=q;f=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Float64Array,a,d,e,b)||this;a.elementType=
"f64";return a}n(a,c);a.ElementType="f64";return a}(f.BufferViewMat3Impl);b.BufferViewMat3f64=f;f=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Float32Array,a,d,e,b)||this;a.elementType="f32";return a}n(a,c);a.ElementType="f32";return a}(k.BufferViewMat4Impl);b.BufferViewMat4f=f;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Float64Array,a,d,e,b)||this;a.elementType="f64";return a}n(a,c);a.ElementType="f64";return a}(k.BufferViewMat4Impl);b.BufferViewMat4f64=k;
k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Float64Array,a,d,e,b)||this;a.elementType="f64";return a}n(a,c);a.ElementType="f64";return a}(d.BufferViewScalarImpl);b.BufferViewFloat64=k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Float64Array,a,d,e,b)||this;a.elementType="f64";return a}n(a,c);a.ElementType="f64";return a}(h.BufferViewVec2Impl);b.BufferViewVec2f64=k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Float64Array,a,d,e,b)||this;
a.elementType="f64";return a}n(a,c);a.ElementType="f64";return a}(m.BufferViewVec3Impl);b.BufferViewVec3f64=k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Float64Array,a,d,e,b)||this;a.elementType="f64";return a}n(a,c);a.ElementType="f64";return a}(p.BufferViewVec4Impl);b.BufferViewVec4f64=k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Uint8Array,a,d,e,b)||this;a.elementType="u8";return a}n(a,c);a.ElementType="u8";return a}(d.BufferViewScalarImpl);b.BufferViewUint8=
k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Uint8Array,a,d,e,b)||this;a.elementType="u8";return a}n(a,c);a.ElementType="u8";return a}(h.BufferViewVec2Impl);b.BufferViewVec2u8=k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Uint8Array,a,d,e,b)||this;a.elementType="u8";return a}n(a,c);a.ElementType="u8";return a}(m.BufferViewVec3Impl);b.BufferViewVec3u8=k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Uint8Array,a,d,e,b)||this;a.elementType=
"u8";return a}n(a,c);a.ElementType="u8";return a}(p.BufferViewVec4Impl);b.BufferViewVec4u8=k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Uint16Array,a,d,e,b)||this;a.elementType="u16";return a}n(a,c);a.ElementType="u16";return a}(d.BufferViewScalarImpl);b.BufferViewUint16=k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Uint16Array,a,d,e,b)||this;a.elementType="u16";return a}n(a,c);a.ElementType="u16";return a}(h.BufferViewVec2Impl);b.BufferViewVec2u16=k;k=
function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Uint16Array,a,d,e,b)||this;a.elementType="u16";return a}n(a,c);a.ElementType="u16";return a}(m.BufferViewVec3Impl);b.BufferViewVec3u16=k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Uint16Array,a,d,e,b)||this;a.elementType="u16";return a}n(a,c);a.ElementType="u16";return a}(p.BufferViewVec4Impl);b.BufferViewVec4u16=k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Uint32Array,a,d,e,b)||this;a.elementType=
"u32";return a}n(a,c);a.ElementType="u32";return a}(d.BufferViewScalarImpl);b.BufferViewUint32=k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Uint32Array,a,d,e,b)||this;a.elementType="u32";return a}n(a,c);a.ElementType="u32";return a}(h.BufferViewVec2Impl);b.BufferViewVec2u32=k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Uint32Array,a,d,e,b)||this;a.elementType="u32";return a}n(a,c);a.ElementType="u32";return a}(m.BufferViewVec3Impl);b.BufferViewVec3u32=
k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Uint32Array,a,d,e,b)||this;a.elementType="u32";return a}n(a,c);a.ElementType="u32";return a}(p.BufferViewVec4Impl);b.BufferViewVec4u32=k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Int8Array,a,d,e,b)||this;a.elementType="i8";return a}n(a,c);a.ElementType="i8";return a}(d.BufferViewScalarImpl);b.BufferViewInt8=k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Int8Array,a,d,e,b)||this;a.elementType=
"i8";return a}n(a,c);a.ElementType="i8";return a}(h.BufferViewVec2Impl);b.BufferViewVec2i8=k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Int8Array,a,d,e,b)||this;a.elementType="i8";return a}n(a,c);a.ElementType="i8";return a}(m.BufferViewVec3Impl);b.BufferViewVec3i8=k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Int8Array,a,d,e,b)||this;a.elementType="i8";return a}n(a,c);a.ElementType="i8";return a}(p.BufferViewVec4Impl);b.BufferViewVec4i8=k;k=function(c){function a(a,
d,e,b){void 0===d&&(d=0);a=c.call(this,Int16Array,a,d,e,b)||this;a.elementType="i16";return a}n(a,c);a.ElementType="i16";return a}(d.BufferViewScalarImpl);b.BufferViewInt16=k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Int16Array,a,d,e,b)||this;a.elementType="i16";return a}n(a,c);a.ElementType="i16";return a}(h.BufferViewVec2Impl);b.BufferViewVec2i16=k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Int16Array,a,d,e,b)||this;a.elementType="i16";return a}n(a,
c);a.ElementType="i16";return a}(m.BufferViewVec3Impl);b.BufferViewVec3i16=k;k=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Int16Array,a,d,e,b)||this;a.elementType="i16";return a}n(a,c);a.ElementType="i16";return a}(p.BufferViewVec4Impl);b.BufferViewVec4i16=k;d=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Int32Array,a,d,e,b)||this;a.elementType="i32";return a}n(a,c);a.ElementType="i32";return a}(d.BufferViewScalarImpl);b.BufferViewInt32=d;h=function(c){function a(a,
d,e,b){void 0===d&&(d=0);a=c.call(this,Int32Array,a,d,e,b)||this;a.elementType="i32";return a}n(a,c);a.ElementType="i32";return a}(h.BufferViewVec2Impl);b.BufferViewVec2i32=h;m=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Int32Array,a,d,e,b)||this;a.elementType="i32";return a}n(a,c);a.ElementType="i32";return a}(m.BufferViewVec3Impl);b.BufferViewVec3i32=m;p=function(c){function a(a,d,e,b){void 0===d&&(d=0);a=c.call(this,Int32Array,a,d,e,b)||this;a.elementType="i32";return a}n(a,
c);a.ElementType="i32";return a}(p.BufferViewVec4Impl);b.BufferViewVec4i32=p})},"esri/views/3d/support/buffer/internals/Mat3":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,k,d,h,m){void 0===d&&(d=0);this.TypedArrayConstructor=b;this.elementCount=9;b=this.TypedArrayConstructor;void 0===h&&(h=9*b.BYTES_PER_ELEMENT);var f=0===k.byteLength?0:d;this.typedBuffer=null==m?new b(k,f):new b(k,f,(m-d)/b.BYTES_PER_ELEMENT);this.typedBufferStride=
h/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.getMat=function(b,k){b*=this.typedBufferStride;for(var d=0;9>d;d++)k[d]=this.typedBuffer[b+d];return k};b.prototype.setMat=function(b,k){b*=this.typedBufferStride;for(var d=0;9>d;d++)this.typedBuffer[b+d]=k[d]};b.prototype.get=function(b,k){return this.typedBuffer[b*this.typedBufferStride+k]};b.prototype.set=function(b,
k,d){this.typedBuffer[b*this.typedBufferStride+k]=d};b.prototype.copyFrom=function(b,k,d){var h=this.typedBuffer,f=k.typedBuffer;b*=this.typedBufferStride;k=d*k.typedBufferStride;for(d=0;9>d;++d)h[b+d]=f[k+d]};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=9;return b}();b.BufferViewMat3Impl=q})},"esri/views/3d/support/buffer/internals/Mat4":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,
"__esModule",{value:!0});q=function(){function b(b,k,d,h,m){void 0===d&&(d=0);this.TypedArrayConstructor=b;this.elementCount=16;b=this.TypedArrayConstructor;void 0===h&&(h=16*b.BYTES_PER_ELEMENT);var f=0===k.byteLength?0:d;this.typedBuffer=null==m?new b(k,f):new b(k,f,(m-d)/b.BYTES_PER_ELEMENT);this.typedBufferStride=h/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.getMat=
function(b,k){b*=this.typedBufferStride;for(var d=0;16>d;d++)k[d]=this.typedBuffer[b+d];return k};b.prototype.setMat=function(b,k){b*=this.typedBufferStride;for(var d=0;16>d;d++)this.typedBuffer[b+d]=k[d]};b.prototype.get=function(b,k){return this.typedBuffer[b*this.typedBufferStride+k]};b.prototype.set=function(b,k,d){this.typedBuffer[b*this.typedBufferStride+k]=d};b.prototype.copyFrom=function(b,k,d){var h=this.typedBuffer,f=k.typedBuffer;b*=this.typedBufferStride;k=d*k.typedBufferStride;for(d=
0;16>d;++d)h[b+d]=f[k+d]};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=16;return b}();b.BufferViewMat4Impl=q})},"esri/views/3d/support/buffer/internals/Scalar":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,k,d,h,m){void 0===d&&(d=0);this.TypedArrayConstructor=b;this.elementCount=1;b=this.TypedArrayConstructor;void 0===h&&(h=
b.BYTES_PER_ELEMENT);var f=0===k.byteLength?0:d;this.typedBuffer=null==m?new b(k,f):new b(k,f,(m-d)/b.BYTES_PER_ELEMENT);this.typedBufferStride=h/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.get=function(b){return this.typedBuffer[b*this.typedBufferStride]};b.prototype.set=function(b,k){this.typedBuffer[b*this.typedBufferStride]=k};Object.defineProperty(b.prototype,
"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=1;return b}();b.BufferViewScalarImpl=q})},"esri/views/3d/support/buffer/internals/Vec2":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec2"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,d,h,f,p){void 0===h&&(h=0);this.TypedArrayConstructor=b;this.elementCount=2;b=this.TypedArrayConstructor;void 0===f&&(f=2*b.BYTES_PER_ELEMENT);
var c=0===d.byteLength?0:h;this.typedBuffer=null==p?new b(d,c):new b(d,c,(p-h)/b.BYTES_PER_ELEMENT);this.typedBufferStride=f/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.getVec=function(b,d){return n.vec2.set(d,this.typedBuffer[b*this.typedBufferStride],this.typedBuffer[b*this.typedBufferStride+1])};b.prototype.setVec=function(b,d){this.typedBuffer[b*this.typedBufferStride]=
d[0];this.typedBuffer[b*this.typedBufferStride+1]=d[1]};b.prototype.get=function(b,d){return this.typedBuffer[b*this.typedBufferStride+d]};b.prototype.set=function(b,d,h){this.typedBuffer[b*this.typedBufferStride+d]=h};b.prototype.copyFrom=function(b,d,h){var f=this.typedBuffer,p=d.typedBuffer;b*=this.typedBufferStride;d=h*d.typedBufferStride;f[b]=p[d];f[b+1]=p[d+1]};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=
2;return b}();b.BufferViewVec2Impl=q})},"esri/views/3d/support/buffer/internals/Vec3":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec3"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,d,h,f,p){void 0===h&&(h=0);this.TypedArrayConstructor=b;this.elementCount=3;b=this.TypedArrayConstructor;void 0===f&&(f=3*b.BYTES_PER_ELEMENT);var c=0===d.byteLength?0:h;this.typedBuffer=null==p?new b(d,c):new b(d,c,(p-h)/b.BYTES_PER_ELEMENT);
this.typedBufferStride=f/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.getVec=function(b,d){return n.vec3.set(d,this.typedBuffer[b*this.typedBufferStride],this.typedBuffer[b*this.typedBufferStride+1],this.typedBuffer[b*this.typedBufferStride+2])};b.prototype.setVec=function(b,d){this.typedBuffer[b*this.typedBufferStride]=d[0];this.typedBuffer[b*this.typedBufferStride+
1]=d[1];this.typedBuffer[b*this.typedBufferStride+2]=d[2]};b.prototype.get=function(b,d){return this.typedBuffer[b*this.typedBufferStride+d]};b.prototype.set=function(b,d,h){this.typedBuffer[b*this.typedBufferStride+d]=h};b.prototype.copyFrom=function(b,d,h){var f=this.typedBuffer,p=d.typedBuffer;b*=this.typedBufferStride;d=h*d.typedBufferStride;f[b]=p[d];f[b+1]=p[d+1];f[b+2]=p[d+2]};Object.defineProperty(b.prototype,"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});
b.ElementCount=3;return b}();b.BufferViewVec3Impl=q})},"esri/views/3d/support/buffer/internals/Vec4":function(){define(["require","exports","../../../../../core/libs/gl-matrix-2/vec4"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,d,h,f,p){void 0===h&&(h=0);this.TypedArrayConstructor=b;this.elementCount=4;b=this.TypedArrayConstructor;void 0===f&&(f=4*b.BYTES_PER_ELEMENT);var c=0===d.byteLength?0:h;this.typedBuffer=null==p?new b(d,c):new b(d,c,(p-h)/b.BYTES_PER_ELEMENT);
this.typedBufferStride=f/b.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}b.prototype.getVec=function(b,d){return n.vec4.set(d,this.typedBuffer[b*this.typedBufferStride],this.typedBuffer[b*this.typedBufferStride+1],this.typedBuffer[b*this.typedBufferStride+2],this.typedBuffer[b*this.typedBufferStride+3])};b.prototype.setVec=function(b,d){this.typedBuffer[b*this.typedBufferStride]=
d[0];this.typedBuffer[b*this.typedBufferStride+1]=d[1];this.typedBuffer[b*this.typedBufferStride+2]=d[2];this.typedBuffer[b*this.typedBufferStride+3]=d[3]};b.prototype.get=function(b,d){return this.typedBuffer[b*this.typedBufferStride+d]};b.prototype.set=function(b,d,h){this.typedBuffer[b*this.typedBufferStride+d]=h};b.prototype.copyFrom=function(b,d,h){var f=this.typedBuffer,p=d.typedBuffer;b*=this.typedBufferStride;d=h*d.typedBufferStride;f[b]=p[d];f[b+1]=p[d+1];f[b+2]=p[d+2];f[b+3]=p[d+3]};Object.defineProperty(b.prototype,
"buffer",{get:function(){return this.typedBuffer.buffer},enumerable:!0,configurable:!0});b.ElementCount=4;return b}();b.BufferViewVec4Impl=q})},"esri/core/libs/gl-matrix-2/vec4":function(){define(["require","exports","./math/vec4"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.vec4=n})},"esri/core/libs/gl-matrix-2/math/vec4":function(){define(["require","exports","./common"],function(q,b,n){function f(a,c,d){a[0]=c[0]-d[0];a[1]=c[1]-d[1];a[2]=c[2]-d[2];a[3]=c[3]-d[3];return a}
function k(a,c,d){a[0]=c[0]*d[0];a[1]=c[1]*d[1];a[2]=c[2]*d[2];a[3]=c[3]*d[3];return a}function d(a,c,d){a[0]=c[0]/d[0];a[1]=c[1]/d[1];a[2]=c[2]/d[2];a[3]=c[3]/d[3];return a}function h(a,c){var d=c[0]-a[0],e=c[1]-a[1],b=c[2]-a[2];a=c[3]-a[3];return Math.sqrt(d*d+e*e+b*b+a*a)}function m(a,c){var d=c[0]-a[0],e=c[1]-a[1],b=c[2]-a[2];a=c[3]-a[3];return d*d+e*e+b*b+a*a}function p(a){var c=a[0],d=a[1],e=a[2];a=a[3];return Math.sqrt(c*c+d*d+e*e+a*a)}function c(a){var c=a[0],d=a[1],e=a[2];a=a[3];return c*
c+d*d+e*e+a*a}Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];return a};b.set=function(a,c,d,e,b){a[0]=c;a[1]=d;a[2]=e;a[3]=b;return a};b.add=function(a,c,d){a[0]=c[0]+d[0];a[1]=c[1]+d[1];a[2]=c[2]+d[2];a[3]=c[3]+d[3];return a};b.subtract=f;b.multiply=k;b.divide=d;b.ceil=function(a,c){a[0]=Math.ceil(c[0]);a[1]=Math.ceil(c[1]);a[2]=Math.ceil(c[2]);a[3]=Math.ceil(c[3]);return a};b.floor=function(a,c){a[0]=Math.floor(c[0]);a[1]=Math.floor(c[1]);
a[2]=Math.floor(c[2]);a[3]=Math.floor(c[3]);return a};b.min=function(a,c,d){a[0]=Math.min(c[0],d[0]);a[1]=Math.min(c[1],d[1]);a[2]=Math.min(c[2],d[2]);a[3]=Math.min(c[3],d[3]);return a};b.max=function(a,c,d){a[0]=Math.max(c[0],d[0]);a[1]=Math.max(c[1],d[1]);a[2]=Math.max(c[2],d[2]);a[3]=Math.max(c[3],d[3]);return a};b.round=function(a,c){a[0]=Math.round(c[0]);a[1]=Math.round(c[1]);a[2]=Math.round(c[2]);a[3]=Math.round(c[3]);return a};b.scale=function(a,c,d){a[0]=c[0]*d;a[1]=c[1]*d;a[2]=c[2]*d;a[3]=
c[3]*d;return a};b.scaleAndAdd=function(a,c,d,e){a[0]=c[0]+d[0]*e;a[1]=c[1]+d[1]*e;a[2]=c[2]+d[2]*e;a[3]=c[3]+d[3]*e;return a};b.distance=h;b.squaredDistance=m;b.length=p;b.squaredLength=c;b.negate=function(a,c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=-c[3];return a};b.inverse=function(a,c){a[0]=1/c[0];a[1]=1/c[1];a[2]=1/c[2];a[3]=1/c[3];return a};b.normalize=function(a,c){var d=c[0],e=c[1],b=c[2];c=c[3];var h=d*d+e*e+b*b+c*c;0<h&&(h=1/Math.sqrt(h),a[0]=d*h,a[1]=e*h,a[2]=b*h,a[3]=c*h);return a};b.dot=
function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]+a[3]*c[3]};b.lerp=function(a,c,d,e){var b=c[0],g=c[1],h=c[2];c=c[3];a[0]=b+e*(d[0]-b);a[1]=g+e*(d[1]-g);a[2]=h+e*(d[2]-h);a[3]=c+e*(d[3]-c);return a};b.random=function(a,c){c=c||1;var d,e,b,h,l,f;do d=2*n.RANDOM()-1,e=2*n.RANDOM()-1,l=d*d+e*e;while(1<=l);do b=2*n.RANDOM()-1,h=2*n.RANDOM()-1,f=b*b+h*h;while(1<=f);l=Math.sqrt((1-l)/f);a[0]=c*d;a[1]=c*e;a[2]=c*b*l;a[3]=c*h*l;return a};b.transformMat4=function(a,c,d){var e=c[0],b=c[1],g=c[2];c=c[3];a[0]=
d[0]*e+d[4]*b+d[8]*g+d[12]*c;a[1]=d[1]*e+d[5]*b+d[9]*g+d[13]*c;a[2]=d[2]*e+d[6]*b+d[10]*g+d[14]*c;a[3]=d[3]*e+d[7]*b+d[11]*g+d[15]*c;return a};b.transformQuat=function(a,c,d){var e=c[0],b=c[1],g=c[2],h=d[0],l=d[1],f=d[2];d=d[3];var m=d*e+l*g-f*b,p=d*b+f*e-h*g,k=d*g+h*b-l*e,e=-h*e-l*b-f*g;a[0]=m*d+e*-h+p*-f-k*-l;a[1]=p*d+e*-l+k*-h-m*-f;a[2]=k*d+e*-f+m*-l-p*-h;a[3]=c[3];return a};b.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};b.exactEquals=function(a,c){return a[0]===c[0]&&
a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]};b.equals=function(a,c){var d=a[0],e=a[1],b=a[2];a=a[3];var h=c[0],l=c[1],f=c[2];c=c[3];return Math.abs(d-h)<=n.EPSILON*Math.max(1,Math.abs(d),Math.abs(h))&&Math.abs(e-l)<=n.EPSILON*Math.max(1,Math.abs(e),Math.abs(l))&&Math.abs(b-f)<=n.EPSILON*Math.max(1,Math.abs(b),Math.abs(f))&&Math.abs(a-c)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(c))};b.sub=f;b.mul=k;b.div=d;b.dist=h;b.sqrDist=m;b.len=p;b.sqrLen=c})},"esri/views/3d/support/buffer/types":function(){define(["require",
"exports","../../../../core/compilerUtils"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.elementTypeSize=function(b){switch(b){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8;default:n.neverReached(b)}};b.isSigned=function(b){switch(b){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0;default:n.neverReached(b)}};b.isInteger=
function(b){switch(b){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1;default:n.neverReached(b)}};b.maximumValue=function(b){switch(b){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308;default:n.neverReached(b)}}})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./BufferVectorMath ./GeometryData ./Util".split(" "),
function(q,b,n,f,k,d,h,m,p){var c=h.Vec3Compact,a;(function(a){for(var c=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],d=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],e=[0,0,1,0,1,1,0,1],b=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],g=Array(36),h=0;6>h;h++)for(var l=0;6>l;l++)g[6*h+l]=h;for(var f=Array(36),h=0;6>h;h++)f[6*h+0]=0,f[6*h+1]=1,f[6*h+2]=2,f[6*h+3]=2,f[6*h+4]=3,f[6*h+5]=0;a.createGeometry=function(a){Array.isArray(a)||
(a=[a,a,a]);for(var h=new Float32Array(24),l=0;8>l;l++)h[3*l]=c[l][0]*a[0],h[3*l+1]=c[l][1]*a[1],h[3*l+2]=c[l][2]*a[2];a={};a[p.VertexAttrConstants.POSITION]=new Uint32Array(b);a[p.VertexAttrConstants.NORMAL]=new Uint32Array(g);a[p.VertexAttrConstants.UV0]=new Uint32Array(f);l={};l[p.VertexAttrConstants.POSITION]={size:3,data:h};l[p.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(d)};l[p.VertexAttrConstants.UV0]={size:2,data:new Float32Array(e)};return new m(l,a)}})(a||(a={}));var l;(function(a){var c=
[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],d=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],e=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],b=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var g=new Float32Array(18),h=0;6>h;h++)g[3*h]=c[h][0]*a[0],g[3*h+1]=c[h][1]*a[1],g[3*h+2]=c[h][2]*a[2];a={};a[p.VertexAttrConstants.POSITION]=new Uint32Array(e);a[p.VertexAttrConstants.NORMAL]=new Uint32Array(b);
h={};h[p.VertexAttrConstants.POSITION]={size:3,data:g};h[p.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(d)};return new m(h,a)}})(l||(l={}));var g;(function(a){var c=f.vec3f32.fromValues(-.5,0,-.5),d=f.vec3f32.fromValues(.5,0,-.5),e=f.vec3f32.fromValues(0,0,.5),b=f.vec3f32.fromValues(0,.5,0),g=f.vec3f32.create(),h=f.vec3f32.create(),l=f.vec3f32.create(),r=f.vec3f32.create(),k=f.vec3f32.create();n.vec3.subtract(g,c,b);n.vec3.subtract(h,c,d);n.vec3.cross(l,g,h);n.vec3.normalize(l,l);n.vec3.subtract(g,
d,b);n.vec3.subtract(h,d,e);n.vec3.cross(r,g,h);n.vec3.normalize(r,r);n.vec3.subtract(g,e,b);n.vec3.subtract(h,e,c);n.vec3.cross(k,g,h);n.vec3.normalize(k,k);var t=[c,d,e,b],u=[0,-1,0,l[0],l[1],l[2],r[0],r[1],r[2],k[0],k[1],k[2]],y=[0,1,2,3,1,0,3,2,1,3,0,2],q=[0,0,0,1,1,1,2,2,2,3,3,3];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var c=new Float32Array(12),d=0;4>d;d++)c[3*d]=t[d][0]*a[0],c[3*d+1]=t[d][1]*a[1],c[3*d+2]=t[d][2]*a[2];a={};a[p.VertexAttrConstants.POSITION]=new Uint32Array(y);
a[p.VertexAttrConstants.NORMAL]=new Uint32Array(q);d={};d[p.VertexAttrConstants.POSITION]={size:3,data:c};d[p.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(u)};return new m(d,a)}})(g||(g={}));var e;(function(e){function b(a,c,d,e,b){if(Math.abs(n.vec3.dot(c,a))>b)return!1;n.vec3.cross(d,a,c);n.vec3.normalize(d,d);n.vec3.cross(e,d,a);n.vec3.normalize(e,e);return!0}function y(a,c,d,e,g,h,l){return b(a,c,g,h,l)||b(a,d,g,h,l)||b(a,e,g,h,l)}e.createBoxGeometry=a.createGeometry;e.createDiamondGeometry=
l.createGeometry;e.createTetrahedronGeometry=g.createGeometry;e.createSphereGeometry=function(a,c,d,e,b,g,h){a=a||50;e=void 0!==e?e:-Math.PI;b=void 0!==b?b:2*Math.PI;g=void 0!==g?g:.5*-Math.PI;h=void 0!==h?h:Math.PI;var l=Math.max(3,Math.floor(c)||8),f=Math.max(2,Math.floor(d)||6),r=(l+1)*(f+1);d=new Float32Array(3*r);c=new Float32Array(3*r);for(var r=new Float32Array(2*r),k=[],t=0,u=0;u<=f;u++){for(var z=[],n=u/f,y=g+n*h,x=Math.cos(y),v=0;v<=l;v++){var w=v/l,A=e+w*b,B=Math.cos(A)*x,C=Math.sin(y),
A=-Math.sin(A)*x;d[3*t]=B*a;d[3*t+1]=C*a;d[3*t+2]=A*a;c[3*t]=B;c[3*t+1]=C;c[3*t+2]=A;r[2*t]=w;r[2*t+1]=n;z.push(t);++t}k.push(z)}a=new Uint32Array(2*l*(f-1)*3);for(u=t=0;u<f;u++)for(v=0;v<l;v++)e=k[u][v],b=k[u][v+1],g=k[u+1][v+1],h=k[u+1][v],0===u?(a[t++]=e,a[t++]=g,a[t++]=h):u===f-1?(a[t++]=e,a[t++]=b,a[t++]=g):(a[t++]=e,a[t++]=b,a[t++]=g,a[t++]=g,a[t++]=h,a[t++]=e);p.assert(t===a.length);l={};l[p.VertexAttrConstants.POSITION]=a;l[p.VertexAttrConstants.NORMAL]=a;l[p.VertexAttrConstants.UV0]=a;f=
{};f[p.VertexAttrConstants.POSITION]={size:3,data:d};f[p.VertexAttrConstants.NORMAL]={size:3,data:c};f[p.VertexAttrConstants.UV0]={size:2,data:r};return new m(f,l)};e.createPolySphereGeometry=function(a,d,e){function b(d,e){d>e&&(e=[e,d],d=e[0],e=e[1]);var b=d.toString()+"."+e.toString();if(l[b])return l[b];var h=g.length;g.length+=3;c.add(g,3*d,g,3*e,g,h);c.scale(g,h,a/c.length(g,h));h/=3;return l[b]=h}var g;e?(g=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],e=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,
1,5,2,2,5,3,3,5,4,4,5,1])):(e=a*(1+Math.sqrt(5))/2,g=[-a,e,0,a,e,0,-a,-e,0,a,-e,0,0,-a,e,0,a,e,0,-a,-e,0,a,-e,e,0,-a,e,0,a,-e,0,-a,-e,0,a],e=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var h=0;h<g.length;h+=3)c.scale(g,h,a/c.length(g,h));for(var l={},h=0;h<d;h++){for(var f=e.length,r=new Uint32Array(4*f),k=0;k<f;k+=3){var t=e[k],u=e[k+1],z=e[k+2],n=b(t,u),y=b(u,z),x=b(z,t),v=4*k;r[v]=t;r[v+
1]=n;r[v+2]=x;r[v+3]=u;r[v+4]=y;r[v+5]=n;r[v+6]=z;r[v+7]=x;r[v+8]=y;r[v+9]=n;r[v+10]=y;r[v+11]=x}e=r;l={}}d=new Float32Array(g);for(h=0;h<d.length;h+=3)c.normalize(d,h);h={};h[p.VertexAttrConstants.POSITION]=e;h[p.VertexAttrConstants.NORMAL]=e;e={};e[p.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(g)};e[p.VertexAttrConstants.NORMAL]={size:3,data:d};return new m(e,h)};e.createPointGeometry=function(a,c,d,e,b,g,h){c=c?new Float64Array([c[0],c[1],c[2]]):new Float32Array([0,0,0]);a=a?new Float32Array([a[0],
a[1],a[2]]):new Float32Array([0,0,1]);g=g?new Float32Array(g):new Float32Array([0,0]);var l=d?new Uint8Array([255*d[0],255*d[1],255*d[2],3<d.length?255*d[3]:255]):new Uint8Array([255,255,255,255]),f=null!=e&&2===e.length?new Float32Array(e):new Float32Array([1,1]);e=new Uint32Array([0]);d={};d[p.VertexAttrConstants.POSITION]=e;d[p.VertexAttrConstants.NORMAL]=e;d[p.VertexAttrConstants.UV0]=e;d[p.VertexAttrConstants.COLOR]=e;d[p.VertexAttrConstants.SIZE]=e;var r={};r[p.VertexAttrConstants.POSITION]=
{size:3,data:c};r[p.VertexAttrConstants.NORMAL]={size:3,data:a};r[p.VertexAttrConstants.UV0]={size:g.length,data:g};r[p.VertexAttrConstants.COLOR]={size:4,data:l};r[p.VertexAttrConstants.SIZE]={size:2,data:f};null!=b&&(b=new Float32Array([b[0],b[1],b[2],b[3]]),d[p.VertexAttrConstants.AUXPOS1]=e,r[p.VertexAttrConstants.AUXPOS1]={size:4,data:b});null!=h&&(h=new Float32Array([h[0],h[1],h[2],h[3]]),d[p.VertexAttrConstants.AUXPOS2]=e,r[p.VertexAttrConstants.AUXPOS2]={size:4,data:h});return new m(r,d,m.DefaultOffsets,
"point")};e.createPointArrayGeometry=function(a,c){for(var d=new Float32Array(3*a.length),e=new Float32Array(c?3*a.length:3),b=new Uint32Array(a.length),g=new Uint32Array(a.length),h=0;h<a.length;h++)d[3*h]=a[h][0],d[3*h+1]=a[h][1],d[3*h+2]=a[h][2],c&&(e[3*h]=c[h][0],e[3*h+1]=c[h][1],e[3*h+2]=c[h][2]),b[h]=h,g[h]=0;c||(e[0]=0,e[1]=1,e[2]=0);a=new Float32Array(2);a[0]=0;a[1]=0;h={};h[p.VertexAttrConstants.POSITION]=b;h[p.VertexAttrConstants.NORMAL]=c?b:g;h[p.VertexAttrConstants.UV0]=g;c={};c[p.VertexAttrConstants.POSITION]=
{size:3,data:d};c[p.VertexAttrConstants.NORMAL]={size:3,data:e};c[p.VertexAttrConstants.UV0]={size:2,data:a};return new m(c,h,m.DefaultOffsets,"point")};e.createTriangleGeometry=function(){var a=new Float32Array([0,0,0,0,0,100,100,0,0]),c=new Uint32Array([0,1,2]),d=new Float32Array([0,1,0]),e=new Uint32Array([0,0,0]),b=new Float32Array([0,0]),h=new Uint32Array([0,0,0]),g={};g[p.VertexAttrConstants.POSITION]=c;g[p.VertexAttrConstants.NORMAL]=e;g[p.VertexAttrConstants.UV0]=h;c={};c[p.VertexAttrConstants.POSITION]=
{size:3,data:a};c[p.VertexAttrConstants.NORMAL]={size:3,data:d};c[p.VertexAttrConstants.UV0]={size:2,data:b};return new m(c,g)};e.createSquareGeometry=function(a){var c=new Float32Array(12);if(a)for(var d=0;4>d;d++)for(var e=0;3>e;e++)c[3*d+e]=a[d][e];else c[0]=-1,c[1]=-1,c[2]=0,c[3]=1,c[4]=-1,c[5]=0,c[6]=1,c[7]=1,c[8]=0,c[9]=-1,c[10]=1,c[11]=0;var b=new Uint32Array([0,1,2,2,3,0]);a=new Float32Array([0,0,1]);var h=new Uint32Array([0,0,0,0,0,0]),d=new Float32Array([0,0,1,0,1,1,0,1]),e=new Uint8Array([255,
255,255,255]),g={};g[p.VertexAttrConstants.POSITION]=b;g[p.VertexAttrConstants.NORMAL]=h;g[p.VertexAttrConstants.UV0]=b;g[p.VertexAttrConstants.COLOR]=h;b={};b[p.VertexAttrConstants.POSITION]={size:3,data:c};b[p.VertexAttrConstants.NORMAL]={size:3,data:a};b[p.VertexAttrConstants.UV0]={size:2,data:d};b[p.VertexAttrConstants.COLOR]={size:4,data:e};return new m(b,g)};e.createConeGeometry=function(a,c,d,e,b,h){void 0===b&&(b=!0);void 0===h&&(h=!0);var g=0,l=f.vec3f32.fromValues(0,g,0),r=f.vec3f32.fromValues(0,
g+a,0),k=f.vec3f32.fromValues(0,-1,0),t=f.vec3f32.fromValues(0,1,0);e&&(g=a,r=f.vec3f32.fromValues(0,0,0),l=f.vec3f32.fromValues(0,g,0),k=f.vec3f32.fromValues(0,1,0),t=f.vec3f32.fromValues(0,-1,0));l=[r,l];k=[k,t];t=d+2;r=Math.sqrt(a*a+c*c);if(e)for(e=d-1;0<=e;e--)u=2*Math.PI/d*e,n=f.vec3f32.fromValues(Math.cos(u)*c,g,Math.sin(u)*c),l.push(n),u=f.vec3f32.fromValues(a*Math.cos(u)/r,-c/r,a*Math.sin(u)/r),k.push(u);else for(e=0;e<d;e++){var u=2*Math.PI/d*e,n=f.vec3f32.fromValues(Math.cos(u)*c,g,Math.sin(u)*
c);l.push(n);u=f.vec3f32.fromValues(a*Math.cos(u)/r,c/r,a*Math.sin(u)/r);k.push(u)}a=new Uint32Array(6*(d+2));d=new Uint32Array(6*(d+2));g=c=0;if(b){for(e=3;e<l.length;e++)a[c++]=1,a[c++]=e-1,a[c++]=e,d[g++]=0,d[g++]=0,d[g++]=0;a[c++]=l.length-1;a[c++]=2;a[c++]=1;d[g++]=0;d[g++]=0;d[g++]=0}if(h){for(e=3;e<l.length;e++)a[c++]=e,a[c++]=e-1,a[c++]=0,d[g++]=e,d[g++]=e-1,d[g++]=1;a[c++]=0;a[c++]=2;a[c++]=l.length-1;d[g++]=1;d[g++]=2;d[g++]=k.length-1}b=new Float32Array(3*t);for(e=0;e<t;e++)b[3*e]=l[e][0],
b[3*e+1]=l[e][1],b[3*e+2]=l[e][2];h=new Float32Array(3*t);for(e=0;e<t;e++)h[3*e]=k[e][0],h[3*e+1]=k[e][1],h[3*e+2]=k[e][2];l={};l[p.VertexAttrConstants.POSITION]=a;l[p.VertexAttrConstants.NORMAL]=d;k={};k[p.VertexAttrConstants.POSITION]={size:3,data:b};k[p.VertexAttrConstants.NORMAL]={size:3,data:h};return new m(k,l)};e.createCylinderGeometry=function(a,c,d,e,b,g){e=e?f.vec3f32.clone(e):f.vec3f32.fromValues(1,0,0);b=b?f.vec3f32.clone(b):f.vec3f32.fromValues(0,0,0);g=void 0===g?!0:g;var h=f.vec3f32.create();
n.vec3.normalize(h,e);e=f.vec3f32.create();n.vec3.scale(e,h,Math.abs(a));var l=f.vec3f32.create();n.vec3.scale(l,e,-.5);n.vec3.add(l,l,b);var r=f.vec3f32.fromValues(0,1,0);.2>Math.abs(1-n.vec3.dot(h,r))&&n.vec3.set(r,0,0,1);var k=f.vec3f32.create();n.vec3.cross(k,h,r);n.vec3.normalize(k,k);n.vec3.cross(r,k,h);var t=2*d+(g?2:0),u=d+(g?2:0);a=new Float32Array(3*t);b=new Float32Array(3*u);var y=new Float32Array(2*t),z=new Uint32Array(3*d*(g?4:2)),x=new Uint32Array(3*d*(g?4:2));g&&(a[3*(t-2)+0]=l[0],
a[3*(t-2)+1]=l[1],a[3*(t-2)+2]=l[2],y[2*(t-2)]=0,y[2*(t-2)+1]=0,a[3*(t-1)+0]=a[3*(t-2)+0]+e[0],a[3*(t-1)+1]=a[3*(t-2)+1]+e[1],a[3*(t-1)+2]=a[3*(t-2)+2]+e[2],y[2*(t-1)]=1,y[2*(t-1)+1]=1,b[3*(u-2)+0]=-h[0],b[3*(u-2)+1]=-h[1],b[3*(u-2)+2]=-h[2],b[3*(u-1)+0]=h[0],b[3*(u-1)+1]=h[1],b[3*(u-1)+2]=h[2]);for(var h=function(a,c,d){z[a]=c;x[a]=d},v=0,w=f.vec3f32.create(),A=f.vec3f32.create(),B=0;B<d;B++){var C=2*Math.PI/d*B;n.vec3.scale(w,r,Math.sin(C));n.vec3.scale(A,k,Math.cos(C));n.vec3.add(w,w,A);b[3*B+
0]=w[0];b[3*B+1]=w[1];b[3*B+2]=w[2];n.vec3.scale(w,w,c);n.vec3.add(w,w,l);a[3*B+0]=w[0];a[3*B+1]=w[1];a[3*B+2]=w[2];y[2*B+0]=B/d;y[2*B+1]=0;a[3*(B+d)+0]=a[3*B+0]+e[0];a[3*(B+d)+1]=a[3*B+1]+e[1];a[3*(B+d)+2]=a[3*B+2]+e[2];y[2*(B+d)+0]=B/d;y[2*B+1]=1;C=(B+1)%d;h(v++,B,B);h(v++,B+d,B);h(v++,C,C);h(v++,C,C);h(v++,B+d,B);h(v++,C+d,C)}if(g){for(B=0;B<d;B++)C=(B+1)%d,h(v++,t-2,u-2),h(v++,B,u-2),h(v++,C,u-2);for(B=0;B<d;B++)C=(B+1)%d,h(v++,B+d,u-1),h(v++,t-1,u-1),h(v++,C+d,u-1)}c={};c[p.VertexAttrConstants.POSITION]=
z;c[p.VertexAttrConstants.NORMAL]=x;c[p.VertexAttrConstants.UV0]=z;d={};d[p.VertexAttrConstants.POSITION]={size:3,data:a};d[p.VertexAttrConstants.NORMAL]={size:3,data:b};d[p.VertexAttrConstants.UV0]={size:2,data:y};return new m(d,c)};e.createTubeGeometry=function(a,c,d,b,h){d=d||10;b=null!=b?b:!0;p.assert(1<a.length);for(var g=[],l=[],f=0;f<d;f++){g.push([0,-f-1,-((f+1)%d)-1]);var m=f/d*2*Math.PI;l.push([Math.cos(m)*c,Math.sin(m)*c])}return e.createPathExtrusionGeometry(l,a,[[0,0,0]],g,b,h)};e.createPathExtrusionGeometry=
function(a,c,e,b,h,g){void 0===g&&(g=f.vec3f32.fromValues(0,0,0));var l=a.length,r=new Float32Array(c.length*l*3+(6*e.length||0)),t=new Float32Array(c.length*l+(2*e.length||0)),x=new Float32Array(c.length*l*3+(e?6:0)),z=(c.length-1)*l*6+6*b.length,v=new Uint32Array(z),z=new Uint32Array(z),w=0,A=0,B=0,C=0,q=0,E=f.vec3f32.create(),J=f.vec3f32.create(),U=f.vec3f32.create(),Q=f.vec3f32.create(),I=f.vec3f32.create(),V=f.vec3f32.create(),X=f.vec3f32.create(),W=k.vec3f64.create(),ca=f.vec3f32.create(),da=
f.vec3f32.create(),ba=f.vec3f32.create(),aa=f.vec3f32.create(),S=f.vec3f32.create(),Z=d.plane.create();n.vec3.set(ca,0,1,0);n.vec3.subtract(J,c[1],c[0]);n.vec3.normalize(J,J);h?(n.vec3.add(W,c[0],g),n.vec3.normalize(U,W)):n.vec3.set(U,0,0,1);y(J,U,ca,ca,I,U,u);n.vec3.copy(Q,U);n.vec3.copy(aa,I);for(var Y=0;Y<e.length;Y++)n.vec3.scale(V,I,e[Y][0]),n.vec3.scale(W,U,e[Y][2]),n.vec3.add(V,V,W),n.vec3.add(V,V,c[0]),r[w++]=V[0],r[w++]=V[1],r[w++]=V[2],t[B++]=0;x[A++]=-J[0];x[A++]=-J[1];x[A++]=-J[2];for(Y=
0;Y<b.length;Y++)v[C++]=0<b[Y][0]?b[Y][0]:-b[Y][0]-1+e.length,v[C++]=0<b[Y][1]?b[Y][1]:-b[Y][1]-1+e.length,v[C++]=0<b[Y][2]?b[Y][2]:-b[Y][2]-1+e.length,z[q++]=0,z[q++]=0,z[q++]=0;for(var ea=e.length,Y=e.length-1,ga=0;ga<c.length;ga++){var ja=!1;0<ga&&(n.vec3.copy(E,J),ga<c.length-1?(n.vec3.subtract(J,c[ga+1],c[ga]),n.vec3.normalize(J,J)):ja=!0,n.vec3.add(da,E,J),n.vec3.normalize(da,da),n.vec3.add(ba,c[ga-1],Q),d.plane.fromPositionAndNormal(c[ga],da,Z),d.plane.intersectRay(Z,d.ray.wrap(ba,E),W)?(n.vec3.subtract(W,
W,c[ga]),n.vec3.normalize(U,W),n.vec3.cross(I,da,U),n.vec3.normalize(I,I)):y(da,Q,aa,ca,I,U,u),n.vec3.copy(Q,U),n.vec3.copy(aa,I));h&&(n.vec3.add(W,c[ga],g),n.vec3.normalize(S,W));for(var fa=0;fa<l;fa++)if(n.vec3.scale(V,I,a[fa][0]),n.vec3.scale(W,U,a[fa][1]),n.vec3.add(V,V,W),n.vec3.normalize(X,V),x[A++]=X[0],x[A++]=X[1],x[A++]=X[2],h?t[B++]=n.vec3.dot(V,S):t[B++]=V[2],n.vec3.add(V,V,c[ga]),r[w++]=V[0],r[w++]=V[1],r[w++]=V[2],!ja){var ha=(fa+1)%l;v[C++]=ea+fa;v[C++]=ea+l+fa;v[C++]=ea+ha;v[C++]=ea+
ha;v[C++]=ea+l+fa;v[C++]=ea+l+ha;for(ha=0;6>ha;ha++)z[q++]=v[C-6+ha]-Y}ea+=l}a=c[c.length-1];for(Y=0;Y<e.length;Y++)n.vec3.scale(V,I,e[Y][0]),n.vec3.scale(W,U,e[Y][1]),n.vec3.add(V,V,W),n.vec3.add(V,V,a),r[w++]=V[0],r[w++]=V[1],r[w++]=V[2],t[B++]=0;e=A/3;x[A++]=J[0];x[A++]=J[1];x[A++]=J[2];l=ea-l;for(Y=0;Y<b.length;Y++)v[C++]=0<=b[Y][0]?ea+b[Y][0]:-b[Y][0]-1+l,v[C++]=0<=b[Y][2]?ea+b[Y][2]:-b[Y][2]-1+l,v[C++]=0<=b[Y][1]?ea+b[Y][1]:-b[Y][1]-1+l,z[q++]=e,z[q++]=e,z[q++]=e;b={};b[p.VertexAttrConstants.POSITION]=
v;b[p.VertexAttrConstants.NORMAL]=z;v={};v[p.VertexAttrConstants.POSITION]={size:3,data:r};v.zOffset={size:1,data:t};v[p.VertexAttrConstants.NORMAL]={size:3,data:x};return new m(v,b)};e.createPolylineGeometry=function(a,c){p.assert(1<a.length,"createPolylineGeometry(): polyline needs at least 2 points");p.assert(3===a[0].length,"createPolylineGeometry(): malformed vertex");p.assert(void 0===c||c.length===a.length,"createPolylineGeometry: need same number of points and normals");p.assert(void 0===
c||3===c[0].length,"createPolylineGeometry(): malformed normal");for(var d=new Float32Array(3*a.length),e=new Uint32Array(2*(a.length-1)),b=0,h=0,g=0;g<a.length;g++){for(var l=0;3>l;l++)d[b++]=a[g][l];0<g&&(e[h++]=g-1,e[h++]=g)}b={};h={};b[p.VertexAttrConstants.POSITION]=e;h[p.VertexAttrConstants.POSITION]={size:3,data:d};if(c){for(var d=new Float32Array(3*c.length),f=0,g=0;g<a.length;g++)for(l=0;3>l;l++)d[f++]=c[g][l];b[p.VertexAttrConstants.NORMAL]=e;h[p.VertexAttrConstants.NORMAL]={size:3,data:d}}return new m(h,
b,m.DefaultOffsets,"line")};e.createExtrudedTriangle=function(a,c,d,e){var b,h,g=new Float32Array(18);a=[[-c,0,e/2],[d,0,e/2],[0,a,e/2],[-c,0,-e/2],[d,0,-e/2],[0,a,-e/2]];for(c=0;6>c;c++)g[3*c]=a[c][0],g[3*c+1]=a[c][1],g[3*c+2]=a[c][2];a=(b={},b[p.VertexAttrConstants.POSITION]=new Uint32Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]),b);b=(h={},h[p.VertexAttrConstants.POSITION]={size:3,data:g},h);return new m(b,a)};e.transformInPlace=function(a,c){a=a.vertexAttributes[p.VertexAttrConstants.POSITION].data;
for(var d=0;d<a.length;d+=3)n.vec3.set(t,a[d],a[d+1],a[d+2]),n.vec3.transformMat4(t,t,c),a[d]=t[0],a[d+1]=t[1],a[d+2]=t[2]};e.addVertexColors=function(a,c){var d=c||[1,1,1,1];c=new Uint8Array(4);c[0]=255*d[0];c[1]=255*d[1];c[2]=255*d[2];c[3]=255*(3<d.length?d[3]:1);var d={},e=a.getVertexAttr(),b;for(b in e)d[b]=e[b];d[p.VertexAttrConstants.COLOR]={size:4,data:c};c={};for(b in a.indices)c[b]=a.indices[b];c[p.VertexAttrConstants.COLOR]=new Uint32Array(c[p.VertexAttrConstants.POSITION].length);return a=
new m(d,c,a.componentOffsets,a.primitiveType)};e.addNormals=function(a){var c=a.getVertexAttr();a=a.indices;for(var d=h.Vec3Compact.subtract,e=new Float32Array(a.position.length/3*3),b=c.position.data,g=0,l=a.position,f=new Uint32Array(l.length),m=0;m<l.length;m+=3){d(b,3*l[m],b,3*l[m+2],r,0);d(b,3*l[m],b,3*l[m+1],t,0);n.vec3.cross(t,t,r);n.vec3.normalize(t,t);var k=g/3;e[g++]=t[0];e[g++]=t[1];e[g++]=t[2];f[m]=k;f[m+1]=k;f[m+2]=k}c[p.VertexAttrConstants.NORMAL]={size:3,data:e,offsetIdx:0,strideIdx:3};
a[p.VertexAttrConstants.NORMAL]=f};e.cgToGIS=function(a,c){void 0===c&&(c=a);var d=a.getVertexAttr();a=d.position.data;var d=d.normal.data,e=c.getVertexAttr(),b=e.position.data,e=e.normal.data;if(d)for(var g=0;g<d.length;g+=3){var h=d[g+1];e[g+1]=-d[g+2];e[g+2]=h}if(a)for(g=0;g<a.length;g+=3)h=a[g+1],b[g+1]=-a[g+2],b[g+2]=h;return c};e.makeOrthoBasisDirUp=b;e.makeOrthoBasisDirUpFallback=y})(e||(e={}));var u=.99619469809,t=f.vec3f32.create(),r=f.vec3f32.create();return e})},"esri/core/libs/gl-matrix-2/vec3f32":function(){define(["require",
"exports","./factories/vec3f32"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.vec3f32=n})},"esri/core/libs/gl-matrix-2/factories/vec3f32":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return new Float32Array(3)};b.clone=function(b){var f=new Float32Array(3);f[0]=b[0];f[1]=b[1];f[2]=b[2];return f};b.fromValues=function(b,f,k){var d=new Float32Array(3);d[0]=b;d[1]=f;d[2]=k;return d};b.createView=function(b,
f){return new Float32Array(b,f,3)}})},"esri/views/3d/support/geometryUtils":function(){define("require exports ./geometryUtils/axisAngle ./geometryUtils/boundedPlane ./geometryUtils/frustum ./geometryUtils/lineSegment ./geometryUtils/plane ./geometryUtils/ray ./geometryUtils/sphere ./geometryUtils/triangle ./geometryUtils/vector".split(" "),function(q,b,n,f,k,d,h,m,p,c,a){Object.defineProperty(b,"__esModule",{value:!0});b.plane=h;b.boundedPlane=f;b.triangle=c;b.lineSegment=d;b.ray=m;b.sphere=p;b.frustum=
k;b.vector=a;b.axisAngle=n})},"esri/views/3d/support/geometryUtils/axisAngle":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../stack","./vector"],function(q,b,n,f,k){function d(d){void 0===d&&(d=b.UP);return[d[0],d[1],d[2],d[3]]}function h(b,h,c,a,l){void 0===l&&(l=d());l[0]=b;l[1]=h;l[2]=c;l[3]=a;return l}Object.defineProperty(b,"__esModule",{value:!0});b.create=d;b.wrap=function(d,b,c,a){return h(d,b,c,a,f.sv4d.get())};b.wrapAxisAngle=function(d,b){return h(d[0],
d[1],d[2],b,f.sv4d.get())};b.copy=function(b,f){void 0===f&&(f=d());return h(b[0],b[1],b[2],b[3],f)};b.fromValues=h;b.fromAxisAndAngle=function(b,h,c){void 0===c&&(c=d());n.vec3.copy(c,b);c[3]=h;return c};b.fromPoints=function(b,h,c){void 0===c&&(c=d());n.vec3.cross(c,b,h);n.vec3.normalize(c,c);c[3]=k.angle(b,h);return c};b.UP=[0,0,1,0]})},"esri/views/3d/support/stack":function(){define(["require","exports","../../../core/VectorStack"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});
b.sv2d=n.VectorStack.createVec2f64();b.sv3d=n.VectorStack.createVec3f64();b.sv4d=n.VectorStack.createVec4f64();b.sm3d=n.VectorStack.createMat3f64();b.sm4d=n.VectorStack.createMat4f64();b.sq4d=n.VectorStack.createQuatf64()})},"esri/core/VectorStack":function(){define("require exports ./nextTick ./libs/gl-matrix-2/mat3f64 ./libs/gl-matrix-2/mat4f64 ./libs/gl-matrix-2/quatf64 ./libs/gl-matrix-2/vec2f64 ./libs/gl-matrix-2/vec3f64 ./libs/gl-matrix-2/vec4f64".split(" "),function(q,b,n,f,k,d,h,m,p){Object.defineProperty(b,
"__esModule",{value:!0});q=function(){function a(a,c,d){var e=this;this.itemByteSize=a;this.itemCreate=c;this.buffers=[];this.items=[];this.itemsPtr=this.itemsPerBuffer=0;this.itemsPerBuffer=Math.ceil(d/this.itemByteSize);this.tickHandle=n.before(function(){return e.reset()})}a.prototype.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null);this.itemsPtr=0;this.buffers=this.items=null};a.prototype.get=function(){0===this.itemsPtr&&n(function(){});for(var a=Math.floor(this.itemsPtr/
this.itemsPerBuffer);this.buffers.length<=a;){for(var c=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize),d=0;d<this.itemsPerBuffer;++d)this.items.push(this.itemCreate(c,d*this.itemByteSize));this.buffers.push(c)}return this.items[this.itemsPtr++]};a.prototype.reset=function(){for(var a=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);this.buffers.length>a;)this.buffers.pop(),this.items.length=this.buffers.length*this.itemsPerBuffer;this.itemsPtr=0};a.createVec2f64=function(d){void 0===d&&
(d=c);return new a(16,h.vec2f64.createView,d)};a.createVec3f64=function(d){void 0===d&&(d=c);return new a(24,m.vec3f64.createView,d)};a.createVec4f64=function(d){void 0===d&&(d=c);return new a(32,p.vec4f64.createView,d)};a.createMat3f64=function(d){void 0===d&&(d=c);return new a(72,f.mat3f64.createView,d)};a.createMat4f64=function(d){void 0===d&&(d=c);return new a(128,k.mat4f64.createView,d)};a.createQuatf64=function(b){void 0===b&&(b=c);return new a(32,d.quatf64.createView,b)};Object.defineProperty(a.prototype,
"test",{get:function(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}},enumerable:!0,configurable:!0});return a}();b.VectorStack=q;var c=4096})},"esri/core/libs/gl-matrix-2/mat3f64":function(){define(["require","exports","./factories/mat3f64"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.mat3f64=n})},"esri/core/libs/gl-matrix-2/factories/mat3f64":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=
function(){return[1,0,0,0,1,0,0,0,1]};b.clone=function(b){return[b[0],b[1],b[2],b[3],b[4],b[5],b[6],b[7],b[8]]};b.fromValues=function(b,f,k,d,h,m,p,c,a){return[b,f,k,d,h,m,p,c,a]};b.createView=function(b,f){return new Float64Array(b,f,9)}})},"esri/core/libs/gl-matrix-2/quatf64":function(){define(["require","exports","./factories/quatf64"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.quatf64=n})},"esri/core/libs/gl-matrix-2/factories/quatf64":function(){define(["require","exports"],
function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return[0,0,0,1]};b.clone=function(b){return[b[0],b[1],b[2],b[3]]};b.fromValues=function(b,f,k,d){return[b,f,k,d]};b.createView=function(b,f){return new Float64Array(b,f,4)}})},"esri/views/3d/support/geometryUtils/vector":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../mathUtils"],function(q,b,n,f){function k(d,b){return n.vec3.dot(d,b)/n.vec3.length(d)}Object.defineProperty(b,"__esModule",
{value:!0});b.projectPoint=function(d,b,f){b=k(d,b);return n.vec3.scale(f,d,b)};b.projectPointSignedLength=k;b.angle=function(d,b){d=n.vec3.dot(d,b)/(n.vec3.length(d)*n.vec3.length(b));return-f.acos(d)}})},"esri/views/3d/support/geometryUtils/boundedPlane":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../mathUtils ../stack ./lineSegment ./plane ./ray ./vector".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u){function t(a){void 0===a&&(a=b.UP);return{plane:g.create(a.plane),origin:p.vec3f64.clone(a.origin),basis1:p.vec3f64.clone(a.basis1),basis2:p.vec3f64.clone(a.basis2)}}function r(a,c){void 0===c&&(c=t());return y(a.origin,a.basis1,a.basis2,c)}function y(a,c,d,e){void 0===e&&(e=t());m.vec3.copy(e.origin,a);m.vec3.copy(e.basis1,c);m.vec3.copy(e.basis2,d);g.fromVectorsAndPoint(d,c,a,e.plane);a=e;1E-6<Math.abs(m.vec3.dot(a.basis1,a.basis2)/(m.vec3.length(a.basis1)*
m.vec3.length(a.basis2)))&&K.warn("fromValues()","Provided basis vectors are not perpendicular");1E-6<Math.abs(m.vec3.dot(a.basis1,a.plane))&&K.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-m.vec3.dot(a.plane,a.origin)-a.plane[3])&&K.warn("fromValues()","Plane offset is not consistent with plane origin");return e}function w(c,d,e){c!==e&&r(c,e);c=m.vec3.scale(a.sv3d.get(),c.plane,d);m.vec3.add(e.origin,e.origin,c);e.plane[3]-=d;return e}function x(a,c){void 0===
c&&(c=t());var d=(a[2]-a[0])/2,e=(a[3]-a[1])/2;m.vec3.set(c.origin,a[0]+d,a[1]+e,0);m.vec3.set(c.basis1,d,0,0);m.vec3.set(c.basis2,0,e,0);g.fromValues(0,0,1,0,c.plane);return c}function v(a,c,d){return g.intersectRay(a.plane,c,d)?F(a,d):!1}function z(d,e,b){var h=M.get(),l=M.get();G(d,e,h,l);for(var l=Number.POSITIVE_INFINITY,f=0,p=L;f<p.length;f++){var r=D(d,p[f],O.get()),k=a.sv3d.get();g.intersectLineSegment(h,r,k)&&(r=c.directionFromTo(a.sv3d.get(),e.origin,k),r=Math.abs(c.acos(m.vec3.dot(e.direction,
r))),r<l&&(l=r,m.vec3.copy(b,k)))}return l===Number.POSITIVE_INFINITY?A(d,e,b):b}function A(c,d,b){if(v(c,d,b))return b;var h=M.get(),l=M.get();G(c,d,h,l);for(var f=Number.POSITIVE_INFINITY,p=0,r=L;p<r.length;p++){var k=D(c,r[p],O.get()),t=a.sv3d.get();g.intersectLineSegmentClamp(h,k,t)&&(k=e.distance2(d,t),g.isPointInside(l,t)&&k<f&&(f=k,m.vec3.copy(b,t)))}C(c,d.origin)<f&&m.vec3.copy(b,d.origin);return b}function B(c,d,e){var b=c.origin,g=c.basis1,h=c.basis2;d=m.vec3.subtract(a.sv3d.get(),d,b);
g=u.projectPointSignedLength(g,d)/m.vec3.length(g);h=u.projectPointSignedLength(h,d)/m.vec3.length(h);c=u.projectPointSignedLength(c.plane,d);return m.vec3.set(e,g,h,c)}function C(c,d){d=B(c,d,a.sv3d.get());var e=c.basis2;c=m.vec3.length(c.basis1);e=m.vec3.length(e);c=Math.max(Math.abs(d[0])-c,0);e=Math.max(Math.abs(d[1])-e,0);d=d[2];return c*c+e*e+d*d}function E(a,c){var d=-a.plane[3];return u.projectPointSignedLength(a.plane,c)-d}function F(c,d){var e=m.vec3.subtract(a.sv3d.get(),d,c.origin);d=
m.vec3.squaredLength(c.basis1);var b=m.vec3.squaredLength(c.basis2),g=m.vec3.dot(c.basis1,e);c=m.vec3.dot(c.basis2,e);return 0>-g-d&&0>g-d&&0>-c-b&&0>c-b}function H(a,c){var d=O.get();m.vec3.copy(d.origin,a.origin);m.vec3.copy(d.vector,c);return d}function D(c,d,e){var b=c.basis1,g=c.basis2;c=c.origin;var h=m.vec3.scale(a.sv3d.get(),b,d.origin[0]),l=m.vec3.scale(a.sv3d.get(),g,d.origin[1]);m.vec3.add(e.origin,h,l);m.vec3.add(e.origin,e.origin,c);b=m.vec3.scale(a.sv3d.get(),b,d.direction[0]);d=m.vec3.scale(a.sv3d.get(),
g,d.direction[1]);m.vec3.scale(e.vector,m.vec3.add(b,b,d),2);return e}function G(a,c,d,e){a=a.plane;g.fromVectorsAndPoint(a,c.direction,c.origin,d);g.fromVectorsAndPoint(d,a,c.origin,e)}Object.defineProperty(b,"__esModule",{value:!0});var K=f.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");q=function(){return function(){this.plane=g.create();this.origin=p.vec3f64.create();this.basis1=p.vec3f64.create();this.basis2=p.vec3f64.create()}}();b.BoundedPlaneClass=q;b.create=t;b.wrap=function(a,
c,d){var e=P.get();e.origin=a;e.basis1=c;e.basis2=d;e.plane=g.fromVectorsAndPoint(d,c,a,g.wrap(0,0,0,0));return e};b.copy=r;b.fromValues=y;b.elevate=w;b.setExtent=function(a,c,d){x(c,d);w(d,E(a,a.origin),d);return d};b.fromAABoundingRect=x;b.intersectRay=v;b.intersectRayClosestSilhouette=function(c,d,e){if(v(c,d,e))return e;c=z(c,d,a.sv3d.get());m.vec3.add(e,d.origin,m.vec3.scale(a.sv3d.get(),d.direction,m.vec3.distance(d.origin,c)/m.vec3.length(d.direction)));return e};b.closestPointOnSilhouette=
z;b.closestPoint=A;b.projectPoint=function(c,d,e){var b=g.projectPoint(c.plane,d,a.sv3d.get());d=l.projectPointClamp(H(c,c.basis1),b,-1,1,a.sv3d.get());b=l.projectPointClamp(H(c,c.basis2),b,-1,1,a.sv3d.get());m.vec3.subtract(e,m.vec3.add(a.sv3d.get(),d,b),c.origin);return e};b.projectPointLocal=B;b.distance2=C;b.distance=function(a,c){return Math.sqrt(C(a,c))};b.distanceToSilhouette=function(a,c){for(var d=Number.NEGATIVE_INFINITY,e=0,b=L;e<b.length;e++){var g=D(a,b[e],O.get()),g=l.distance2(g,c);
g>d&&(d=g)}return Math.sqrt(d)};b.extrusionContainsPoint=function(a,c){return g.isPointInside(a.plane,c)&&F(a,c)};b.axisAt=function(a,c,d,e){switch(d){case 0:m.vec3.copy(e,a.basis1);m.vec3.normalize(e,e);break;case 1:m.vec3.copy(e,a.basis2);m.vec3.normalize(e,e);break;case 2:m.vec3.copy(e,a.plane);break;default:n.neverReached(d)}return e};b.altitudeAt=E;b.setAltitudeAt=function(a,c,d,e){var b=E(a,c);a=m.vec3.scale(N,a.plane,d-b);m.vec3.add(e,c,a);return e};b.transform=function(a,c,e){a!==e&&r(a,e);
d.mat4.invert(T,c);d.mat4.transpose(T,T);m.vec3.transformMat4(e.basis1,a.basis1,T);m.vec3.transformMat4(e.basis2,a.basis2,T);m.vec3.transformMat4(e.plane,a.plane,T);m.vec3.transformMat4(e.origin,a.origin,c);g.setOffsetFromPoint(e.plane,e.origin,e.plane);return e};b.UP={plane:g.create(),origin:p.vec3f64.fromValues(0,0,0),basis1:p.vec3f64.fromValues(1,0,0),basis2:p.vec3f64.fromValues(0,1,0)};var M=new k.ObjectStack(g.create),O=new k.ObjectStack(l.create),N=p.vec3f64.create(),P=new k.ObjectStack(function(){return{origin:null,
basis1:null,basis2:null,plane:null}}),L=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],T=h.mat4f64.create()})},"esri/core/ObjectStack":function(){define(["require","exports","./nextTick"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(d){var b=this;this.allocator=d;this.items=[];this.itemsPtr=0;this.tickHandle=n.before(function(){return b.reset()});this.grow()}b.prototype.destroy=
function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=null);this.items=null};b.prototype.get=function(){0===this.itemsPtr&&n(function(){});this.itemsPtr===this.items.length&&this.grow();return this.items[this.itemsPtr++]};b.prototype.reset=function(){this.items.length=Math.min(Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3*f),this.items.length);this.itemsPtr=0};b.prototype.grow=function(){for(var d=0;d<Math.max(8,Math.min(this.items.length,f));d++)this.items.push(this.allocator())};
return b}();b.ObjectStack=q;var f=1024;b.default=q})},"esri/views/3d/support/geometryUtils/lineSegment":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../mathUtils ../stack".split(" "),function(q,b,n,f,k,d,h){function m(a){return a?{origin:k.vec3f64.clone(a.origin),vector:k.vec3f64.clone(a.vector)}:{origin:k.vec3f64.create(),vector:k.vec3f64.create()}}function p(a,c){var d=u.get();d.origin=a;d.vector=
c;return d}function c(a,c,d){void 0===d&&(d=m());f.vec3.copy(d.origin,a);f.vec3.copy(d.vector,c);return d}function a(a,c){c=f.vec3.subtract(h.sv3d.get(),c,a.origin);var e=f.vec3.dot(a.vector,c),b=f.vec3.dot(a.vector,a.vector),e=d.clamp(e/b,0,1);a=f.vec3.subtract(h.sv3d.get(),f.vec3.scale(h.sv3d.get(),a.vector,e),c);return f.vec3.dot(a,a)}function l(a,c,e,b,g){var l=a.vector,m=a.origin;c=f.vec3.subtract(h.sv3d.get(),c,m);m=f.vec3.length(l);c=f.vec3.dot(l,c)/m;f.vec3.scale(g,l,d.clamp(c,e,b));return f.vec3.add(g,
g,a.origin)}function g(a,c,e,b){var g=a.origin,l=f.vec3.add(h.sv3d.get(),g,a.vector);a=c.origin;var m=f.vec3.add(h.sv3d.get(),a,c.vector),p=h.sv3d.get();c=h.sv3d.get();p[0]=g[0]-a[0];p[1]=g[1]-a[1];p[2]=g[2]-a[2];c[0]=m[0]-a[0];c[1]=m[1]-a[1];c[2]=m[2]-a[2];if(1E-6>Math.abs(c[0])&&1E-6>Math.abs(c[1])&&1E-6>Math.abs(c[2]))return!1;m=h.sv3d.get();m[0]=l[0]-g[0];m[1]=l[1]-g[1];m[2]=l[2]-g[2];if(1E-6>Math.abs(m[0])&&1E-6>Math.abs(m[1])&&1E-6>Math.abs(m[2]))return!1;var l=p[0]*c[0]+p[1]*c[1]+p[2]*c[2],
k=c[0]*m[0]+c[1]*m[1]+c[2]*m[2],r=c[0]*c[0]+c[1]*c[1]+c[2]*c[2],t=(m[0]*m[0]+m[1]*m[1]+m[2]*m[2])*r-k*k;if(1E-6>Math.abs(t))return!1;p=(l*k-(p[0]*m[0]+p[1]*m[1]+p[2]*m[2])*r)/t;l=(l+k*p)/r;e&&(p=d.clamp(p,0,1),l=d.clamp(l,0,1));e=h.sv3d.get();k=h.sv3d.get();e[0]=g[0]+p*m[0];e[1]=g[1]+p*m[1];e[2]=g[2]+p*m[2];k[0]=a[0]+l*c[0];k[1]=a[1]+l*c[1];k[2]=a[2]+l*c[2];b.tA=p;b.tB=l;b.pA=e;b.pB=k;b.distance2=f.vec3.squaredDistance(e,k);return!0}Object.defineProperty(b,"__esModule",{value:!0});b.create=m;b.wrap=
p;b.copy=function(a,d){void 0===d&&(d=m());return c(a.origin,a.vector,d)};b.fromValues=c;b.fromPoints=function(a,c,d){void 0===d&&(d=m());f.vec3.copy(d.origin,a);f.vec3.subtract(d.vector,c,a);return d};b.distance2=a;b.distance=function(c,d){return Math.sqrt(a(c,d))};b.projectPoint=function(a,c,d){return l(a,c,0,1,d)};b.projectPointClamp=l;b.closestRayDistance2=function(a,c){if(g(a,p(c.origin,c.direction),!1,e)){c=e.tA;var d=e.pB,b=e.distance2;if(0<=c&&1>=c)return b;if(0>c)return f.vec3.squaredDistance(a.origin,
d);if(1<c)return f.vec3.squaredDistance(f.vec3.add(h.sv3d.get(),a.origin,a.vector),d)}return null};b.closestLineSegmentPoint=function(a,c,d){return g(a,c,!0,e)?(f.vec3.copy(d,e.pA),!0):!1};b.closestLineSegmentDistance2=function(a,c){return g(a,c,!0,e)?e.distance2:null};var e={tA:0,tB:0,pA:k.vec3f64.create(),pB:k.vec3f64.create(),distance2:0},u=new n.ObjectStack(function(){return{origin:null,vector:null}})})},"esri/views/3d/support/geometryUtils/plane":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3",
"../mathUtils","../stack"],function(q,b,n,f,k){function d(a){void 0===a&&(a=b.UP);return[a[0],a[1],a[2],a[3]]}function h(a,c){void 0===c&&(c=d());return m(a[0],a[1],a[2],a[3],c)}function m(a,c,e,b,g){void 0===g&&(g=d());g[0]=a;g[1]=c;g[2]=e;g[3]=b;return g}function p(a,e,b){void 0===b&&(b=d());n.vec3.copy(b,e);e=n.vec3.dot(e,e);1E-5<Math.abs(e-1)&&1E-12<e&&n.vec3.scale(b,b,1/Math.sqrt(e));c(b,a,b);return b}function c(a,c,d){a!==d&&h(a,d);d[3]=-n.vec3.dot(d,c);return d}function a(a,c,e,b){void 0===
b&&(b=d());a=n.vec3.cross(k.sv3d.get(),c,a);return p(e,a,b)}function l(a,c,d){a=n.vec3.scale(k.sv3d.get(),a,n.vec3.dot(a,c));n.vec3.subtract(d,c,a);return d}function g(a,c){return n.vec3.dot(a,c)+a[3]}function e(a,c,d,e,b,g){var h=n.vec3.dot(a,d);if(0===h)return!1;a=-(n.vec3.dot(a,c)+a[3])/h;b&&(a=e?Math.max(0,a):f.clamp(a,0,1));if(0>a||!e&&1<a)return!1;n.vec3.add(g,c,n.vec3.scale(g,d,a));return!0}Object.defineProperty(b,"__esModule",{value:!0});b.create=d;b.wrap=function(a,c,d,e){return m(a,c,d,
e,k.sv4d.get())};b.copy=h;b.fromValues=m;b.fromNormalAndOffset=function(a,c,e){void 0===e&&(e=d());n.vec3.copy(e,a);e[3]=c;return e};b.fromPositionAndNormal=p;b.fromPoints=function(c,e,b,g){void 0===g&&(g=d());return a(n.vec3.subtract(k.sv3d.get(),c,e),n.vec3.subtract(k.sv3d.get(),b,e),c,g)};b.setOffsetFromPoint=c;b.negate=function(a,c){c[0]=-a[0];c[1]=-a[1];c[2]=-a[2];c[3]=-a[3];return c};b.fromVectorsAndPoint=a;b.intersectRay=function(a,c,d){return e(a,c.origin,c.direction,!0,!1,d)};b.intersectLineSegment=
function(a,c,d){return e(a,c.origin,c.vector,!1,!1,d)};b.intersectLineSegmentClamp=function(a,c,d){return e(a,c.origin,c.vector,!1,!0,d)};b.isSphereFullyInside=function(a,c){var d=c.radius;return 0<=g(a,c.center)-d};b.isSphereFullyOutside=function(a,c){var d=c.radius;return 0>g(a,c.center)+d};b.isPointInside=function(a,c){return 0<=g(a,c)};b.isPointOutside=function(a,c){return 0>g(a,c)};b.isAABBFullyInside=function(a,c){var d=c[0],e=c[1],b=c[2],g=c[3],h=c[4];c=c[5];return 0<=a[0]*(0<a[0]?d:g)+a[1]*
(0<a[1]?e:h)+a[2]*(0<a[2]?b:c)+a[3]};b.clip=function(a,c){var d=n.vec3.dot(a,c.ray.direction);a=-g(a,c.ray.origin);if(0>a&&0<=d)return!1;if(-1E-6<d&&1E-6>d)return 0<a;if((0>a||0>d)&&!(0>a&&0>d))return!0;a/=d;0<d?a<c.c1&&(c.c1=a):a>c.c0&&(c.c0=a);return c.c0<=c.c1};b.projectPoint=function(a,c,d){var e=n.vec3.scale(k.sv3d.get(),a,-a[3]);c=n.vec3.subtract(k.sv3d.get(),c,e);a=l(a,c,k.sv3d.get());n.vec3.add(d,a,e);return d};b.projectVector=l;b.distance=function(a,c){return Math.abs(g(a,c))};b.signedDistance=
g;b.UP=[0,0,1,0]})},"esri/views/3d/support/geometryUtils/ray":function(){define("require exports ../../../../core/ObjectStack ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack".split(" "),function(q,b,n,f,k,d,h,m){function p(a){return a?{origin:h.vec3f64.clone(a.origin),direction:h.vec3f64.clone(a.direction)}:{origin:h.vec3f64.create(),direction:h.vec3f64.create()}}function c(a,c,e){void 0===
e&&(e=p());d.vec3.copy(e.origin,a);d.vec3.copy(e.direction,c);return e}function a(a,c,e){void 0===e&&(e=p());var b=f.castRenderScreenPointArray3(k.vec2.copy(m.sv3d.get(),c));b[2]=0;a.unprojectPoint(b,e.origin);c=f.castRenderScreenPointArray3(k.vec2.copy(m.sv3d.get(),c));c[2]=1;a=a.unprojectPoint(c,m.sv3d.get());d.vec3.subtract(e.direction,a,e.origin);return e}function l(a,c,e){void 0===e&&(e=p());d.vec3.copy(e.origin,a.eye);c=d.vec3.set(m.sv3d.get(),c[0],c[1],1);a=a.unprojectPoint(c,m.sv3d.get());
d.vec3.subtract(e.direction,a,e.origin);return e}function g(a,c){a=d.vec3.cross(m.sv3d.get(),d.vec3.normalize(m.sv3d.get(),a.direction),d.vec3.subtract(m.sv3d.get(),c,a.origin));return d.vec3.dot(a,a)}function e(){return{origin:null,direction:null}}Object.defineProperty(b,"__esModule",{value:!0});b.create=p;b.wrap=function(a,c){var d=u.get();d.origin=a;d.direction=c;return d};b.copy=function(a,d){void 0===d&&(d=p());return c(a.origin,a.direction,d)};b.fromPoints=function(a,c,e){void 0===e&&(e=p());
d.vec3.copy(e.origin,a);d.vec3.subtract(e.direction,c,a);return e};b.fromValues=c;b.fromScreen=function(c,d,e){void 0===e&&(e=p());return a(c,c.screenToRender(d,f.castRenderScreenPointArray3(m.sv3d.get())),e)};b.fromRender=a;b.fromScreenAtEye=function(a,c,d){void 0===d&&(d=p());return l(a,a.screenToRender(c,f.castRenderScreenPointArray3(m.sv3d.get())),d)};b.fromRenderAtEye=l;b.distance2=g;b.distance=function(a,c){return Math.sqrt(g(a,c))};b.closestPoint=function(a,c,e){c=d.vec3.dot(a.direction,d.vec3.subtract(e,
c,a.origin));d.vec3.add(e,a.origin,d.vec3.scale(e,a.direction,c));return e};b.createWrapper=e;var u=new n.ObjectStack(e)})},"esri/views/3d/support/geometryUtils/frustum":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../stack ./clipRay ./plane".split(" "),function(q,b,n,f,k,d,h,m,p,
c,a){function l(c){if(c){var e=c.planes;c=c.points;return{planes:[a.create(e[0]),a.create(e[1]),a.create(e[2]),a.create(e[3]),a.create(e[4]),a.create(e[5])],points:[d.vec3f64.clone(c[0]),d.vec3f64.clone(c[1]),d.vec3f64.clone(c[2]),d.vec3f64.clone(c[3]),d.vec3f64.clone(c[4]),d.vec3f64.clone(c[5]),d.vec3f64.clone(c[6]),d.vec3f64.clone(c[7])]}}return{planes:[a.create(),a.create(),a.create(),a.create(),a.create(),a.create()],points:[d.vec3f64.create(),d.vec3f64.create(),d.vec3f64.create(),d.vec3f64.create(),
d.vec3f64.create(),d.vec3f64.create(),d.vec3f64.create(),d.vec3f64.create()]}}function g(c,d,e){void 0===e&&(e=l());for(var b=0;6>b;b++)a.copy(c[b],e.planes[b]);for(b=0;8>b;b++)k.vec3.copy(e.points[b],d[b]);return e}function e(c){var d=c.planes;c=c.points;a.fromPoints(c[4],c[0],c[3],d[0]);a.fromPoints(c[1],c[5],c[6],d[1]);a.fromPoints(c[4],c[5],c[1],d[2]);a.fromPoints(c[3],c[2],c[6],d[3]);a.fromPoints(c[0],c[1],c[2],d[4]);a.fromPoints(c[5],c[4],c[7],d[5])}function u(c,d){for(var e=0;6>e;e++)if(!a.clip(c[e],
d))return!1;return!0}Object.defineProperty(b,"__esModule",{value:!0});b.create=l;b.copy=function(a,c){void 0===c&&(c=l());return g(a.planes,a.points,c)};b.fromValues=g;b.fromMatrix=function(a,c,d){void 0===d&&(d=l());var b=d.points;a=f.mat4.multiply(p.sm4d.get(),c,a);f.mat4.invert(a,a);for(c=0;8>c;++c){var g=h.vec4.transformMat4(p.sv4d.get(),t[c],a);k.vec3.set(b[c],g[0]/g[3],g[1]/g[3],g[2]/g[3])}e(d);return d};b.recomputePlanes=e;b.intersectsSphere=function(c,d){for(var e=0;6>e;e++)if(a.isSphereFullyInside(c[e],
d))return!1;return!0};b.intersectsRay=function(a,d){return u(a,c.fromRay(d,r.get()))};b.intersectsLineSegment=function(a,d,e){return u(a,c.fromLineSegmentAndDirection(d,e,r.get()))};b.intersectsPoint=function(c,d){for(var e=0;6>e;e++)if(0<a.signedDistance(c[e],d))return!1;return!0};b.intersectsAABB=function(c,d){for(var e=0;6>e;e++)if(a.isAABBFullyInside(c[e],d))return!1;return!0};b.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]};var t=
[m.vec4f64.fromValues(-1,-1,-1,1),m.vec4f64.fromValues(1,-1,-1,1),m.vec4f64.fromValues(1,1,-1,1),m.vec4f64.fromValues(-1,1,-1,1),m.vec4f64.fromValues(-1,-1,1,1),m.vec4f64.fromValues(1,-1,1,1),m.vec4f64.fromValues(1,1,1,1),m.vec4f64.fromValues(-1,1,1,1)],r=new n.ObjectStack(c.create)})},"esri/views/3d/support/geometryUtils/clipRay":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec3 ../stack ./ray".split(" "),function(q,b,n,f,k,d){function h(a){return a?
{ray:d.create(a.ray),c0:a.c0,c1:a.c1}:{ray:d.create(),c0:0,c1:Number.MAX_VALUE}}function m(a,c,b,e){void 0===e&&(e=h());d.copy(a,e.ray);e.c0=c;e.c1=b;return e}function p(a,c,b){void 0===b&&(b=h());var e=f.vec3.length(a.vector);d.fromValues(a.origin,c,b.ray);b.c0=0;b.c1=e;return b}Object.defineProperty(b,"__esModule",{value:!0});b.create=h;b.wrap=function(a,d,b){var e=c.get();e.ray=a;e.c0=d;e.c1=b;return e};b.copy=function(a,c){void 0===c&&(c=h());return m(a.ray,a.c0,a.c1,c)};b.fromValues=m;b.fromRay=
function(a,c){void 0===c&&(c=h());d.copy(a,c.ray);c.c0=0;c.c1=Number.MAX_VALUE;return c};b.fromLineSegment=function(a,c){void 0===c&&(c=h());var d=f.vec3.normalize(k.sv3d.get(),a.vector);return p(a,d,c)};b.fromLineSegmentAndDirection=p;var c=new n.ObjectStack(function(){return{c0:0,c1:0,ray:null}})})},"esri/views/3d/support/geometryUtils/sphere":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../geometryUtils ../mathUtils ../stack ./ray".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l){function g(a){return a?{radius:a.radius,center:m.vec3f64.clone(a.center)}:{radius:1,center:m.vec3f64.create()}}function e(a,c){void 0===c&&(c=g());return u(a.radius,a.center,c)}function u(a,c,d){void 0===d&&(d=g());h.vec3.copy(d.center,c);d.radius=a;return d}function t(c,d,e){var b=h.vec3.subtract(a.sv3d.get(),d.origin,c.center),g=h.vec3.dot(d.direction,d.direction),l=2*h.vec3.dot(d.direction,b);c=h.vec3.dot(b,b)-c.radius*c.radius;c=l*l-4*g*c;if(0>c)return!1;b=Math.sqrt(c);
c=(-l-b)/(2*g);g=(-l+b)/(2*g);if(0>c||g<c&&0<g)c=g;if(0>c)return!1;e&&h.vec3.add(e,d.origin,h.vec3.scale(a.sv3d.get(),d.direction,c));return!0}function r(c,e,b){var g=a.sv3d.get(),l=a.sm4d.get();h.vec3.cross(g,e.origin,e.direction);h.vec3.cross(b,g,e.origin);h.vec3.scale(b,b,1/h.vec3.length(b)*c.radius);c=w(c,e.origin);e=p.vector.angle(e.origin,b);d.mat4.identity(l);d.mat4.rotate(l,l,e+c,g);h.vec3.transformMat4(b,b,l);return b}function y(c,d,e){d=h.vec3.subtract(a.sv3d.get(),d,c.center);d=h.vec3.scale(a.sv3d.get(),
d,c.radius/h.vec3.length(d));return h.vec3.add(e,d,c.center)}function w(d,e){e=h.vec3.subtract(a.sv3d.get(),e,d.center);e=h.vec3.length(e);return c.acos(d.radius/(d.radius+Math.abs(d.radius-e)))}function x(a,d,e,b){a=h.vec3.subtract(A,d,a.center);switch(e){case 0:return a=c.cartesianToSpherical(a,A),a=a[2],h.vec3.set(b,-Math.sin(a),Math.cos(a),0);case 1:return a=c.cartesianToSpherical(a,A),e=a[1],a=a[2],d=Math.sin(e),h.vec3.set(b,-d*Math.cos(a),-d*Math.sin(a),Math.cos(e));case 2:return h.vec3.normalize(b,
a);default:n.neverReached(e)}}function v(a,c){c=h.vec3.subtract(F,c,a.center);return h.vec3.length(c)-a.radius}Object.defineProperty(b,"__esModule",{value:!0});var z=f.getLogger("esri.views.3d.support.geometryUtils.sphere");b.create=g;b.wrap=function(a,c){var d=B.get();d.radius=a;d.center=c||E;return d};b.copy=e;b.fromValues=u;b.elevate=function(a,c,d){a!==d&&h.vec3.copy(d.center,a.center);d.radius=a.radius+c;return d};b.setExtent=function(a,c,d){z.error("sphere.setExtent is not yet supported");return a===
d?d:e(a,d)};b.intersectRay=t;b.intersectScreen=function(a,c,d,e){c=l.fromScreenAtEye(c,d,C);return t(a,c,e)};b.intersectsRay=function(a,c){return t(a,c,null)};b.intersectRayClosestSilhouette=function(c,d,e){if(t(c,d,e))return e;c=r(c,d,a.sv3d.get());h.vec3.add(e,d.origin,h.vec3.scale(a.sv3d.get(),d.direction,h.vec3.distance(d.origin,c)/h.vec3.length(d.direction)));return e};b.closestPointOnSilhouette=r;b.closestPoint=function(a,c,d){if(t(a,c,d))return d;l.closestPoint(c,a.center,d);return y(a,d,d)};
b.projectPoint=y;b.distanceToSilhouette=function(c,d){d=h.vec3.subtract(a.sv3d.get(),d,c.center);d=h.vec3.squaredLength(d);return Math.sqrt(Math.abs(d-c.radius*c.radius))};b.angleToSilhouette=w;var A=m.vec3f64.create();b.axisAt=x;b.altitudeAt=v;b.setAltitudeAt=function(a,c,d,e){var b=v(a,c);a=x(a,c,2,F);d=h.vec3.scale(F,a,d-b);h.vec3.add(e,c,d);return e};var B=new k.ObjectStack(function(){return{center:null,radius:0}}),C=l.create(),E=m.vec3f64.create(),F=m.vec3f64.create();Object.freeze(E)})},"esri/views/3d/support/geometryUtils/triangle":function(){define("require exports ../../../../core/ObjectStack ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../stack ./lineSegment".split(" "),
function(q,b,n,f,k,d,h,m){function p(a){return a?{p0:d.vec3f64.clone(a.p0),p1:d.vec3f64.clone(a.p1),p2:d.vec3f64.clone(a.p2)}:{p0:d.vec3f64.create(),p1:d.vec3f64.create(),p2:d.vec3f64.create()}}function c(a,c,d,b){void 0===b&&(b=p());k.vec3.copy(b.p0,a);k.vec3.copy(b.p1,c);k.vec3.copy(b.p2,d);return b}function a(a,c,d){var e=f.vec2.distance(a,c);c=f.vec2.distance(c,d);a=f.vec2.distance(d,a);d=(e+c+a)/2;e=d*(d-e)*(d-c)*(d-a);return 0>=e?0:Math.sqrt(e)}Object.defineProperty(b,"__esModule",{value:!0});
b.create=p;b.wrap=function(a,c,d){var e=g.get();e.p0=a;e.p1=c;e.p2=d;return e};b.copy=function(a,d){void 0===d&&(d=p());return c(a.p0,a.p1,a.p2,d)};b.fromValues=c;b.distance2=function(a,c){var d=a.p0,e=a.p1;a=a.p2;var b=k.vec3.subtract(h.sv3d.get(),e,d),g=k.vec3.subtract(h.sv3d.get(),a,e),f=k.vec3.subtract(h.sv3d.get(),d,a),p=k.vec3.subtract(h.sv3d.get(),c,d),u=k.vec3.subtract(h.sv3d.get(),c,e),n=k.vec3.subtract(h.sv3d.get(),c,a),B=k.vec3.cross(b,b,f),C=k.vec3.dot(k.vec3.cross(h.sv3d.get(),b,B),p),
u=k.vec3.dot(k.vec3.cross(h.sv3d.get(),g,B),u),n=k.vec3.dot(k.vec3.cross(h.sv3d.get(),f,B),n);if(0<C&&0<u&&0<n)return c=k.vec3.dot(B,p),c*c/k.vec3.dot(B,B);d=m.distance2(m.fromValues(d,b,l.get()),c);e=m.distance2(m.fromValues(e,g,l.get()),c);c=m.distance2(m.fromValues(a,f,l.get()),c);return Math.min(d,e,c)};b.areaPoints2d=a;b.area2d=function(c){return a(c.p0,c.p1,c.p2)};var l=new n.ObjectStack(m.create),g=new n.ObjectStack(function(){return{p0:null,p1:null,p2:null}})})},"esri/views/3d/webgl-engine/lib/GeometryData":function(){define(["require",
"exports","./ComponentUtils","./geometryDataUtils","./Util"],function(q,b,n,f,k){return function(){function d(b,m,p,c){void 0===m&&(m=d.DefaultIndices);void 0===p&&(p=d.DefaultOffsets);void 0===c&&(c="triangle");this.preinterleaved=!1;var a={},h;for(h in b){var g=b[h],e=g.size;a[h]={data:g.data,size:e,offsetIdx:0,strideIdx:e}}if(m===d.DefaultIndices){m=k.getFirstObjectValue(a);b=f.generateDefaultIndexArray(m.data.length/m.size);m={};for(var u in a)m[u]=b}this._id=f.getNewId();this._vertexAttributes=
a;this._indices=m;this._componentOffsets=n.createOffsets(p);this._primitiveType=c}Object.defineProperty(d.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"componentOffsets",{get:function(){return this._componentOffsets},
enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"indexCount",{get:function(){return k.getFirstObjectValue(this._indices).length},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0});d.prototype.getVertexAttr=function(){return this.vertexAttributes};d.prototype.toRenderData=function(){return{id:this._id.toString(),preinterleaved:!1,indices:this._indices,vertexAttr:this._vertexAttributes}};
d.prototype.getIndices=function(d){return this._indices[d]};d.prototype.getAttribute=function(d){return this._vertexAttributes[d]};d.prototype.estimateGpuMemoryUsage=function(){var d=0;this._indices.position&&(d+=12*this._indices.position.length);this._indices.normal&&(d+=12*this._indices.normal.length);this._indices.uv0&&(d+=8*this._indices.uv0.length);this._indices.color&&(d+=4*this._indices.color.length);return d};d.DefaultIndices={};d.DefaultOffsets=new Uint32Array(0);return d}()})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["require",
"exports","../../../../core/arrayUtils","../../../../core/maybe"],function(q,b,n,f){function k(a,c){if(null!=a){var d=a.isVisibleBit,b=a.data,g=8*b.BYTES_PER_ELEMENT;return c<b.length*g?e(d,b,c,g):!a.isVisibleBit}return!0}function d(a){return f.isSome(a.component)?a.component:-1}function h(a,c,d,e,b){k(c,e)&&m(a,c,d,d[e],d[e+1]-1,b)}function m(a,c,d,e,b,g){d=(c=0<a.length?a[a.length-1]:null)?c.range[1]:-1;var h=c?c.options:null;d>=e||(d+1===e&&h===g?c.range[1]=b:a.push({range:[e,b],options:g}))}function p(a){void 0===
a&&(a=!0);return{isVisibleBit:!a,data:new Uint32Array(0)}}function c(a,c){return l(a,c,!0)}function a(a,c){return l(a,c,!1)}function l(a,c,d){var e=!1;a=a||t;e=a.isVisibleBit;a=a.data;c=u(c);var b=8*a.BYTES_PER_ELEMENT,g=a.length*b;d=d===e;if(0===a.length||0===c)e=!d;else if(g<c&&!d)e=!0;else{for(var h=r[b],g=r[0],l=0;l<a.length-1;l++)if(e=!d&&a[l]!==h||d&&a[l]!==g)return e;e=a.length-1;c=r[(c-1)%b+1];e=!d&&(a[e]&c)!==c||d&&(a[e]&c)!==g}return e}function g(a){return 0<a.length}function e(a,c,d,e){var b=
d/e|0;return 0!==(c[b]&1<<d-b*e)===a}function u(a){return Math.max(0,a.length-1)}Object.defineProperty(b,"__esModule",{value:!0});b.updateVisibility=function(a,c,d,e){if(d<u(c)){null==a&&(a=p());var b=a.isVisibleBit,g=a.data,h=8*g.BYTES_PER_ELEMENT,l=d/h|0,f=d-h*l;c=(u(c)-1)/h|0;var m=g;e=e===b;d<m.length*h||!e||(d=Math.max(l+1,Math.ceil(1.5*m.length)),d=Math.min(d,c+1),g=new Uint32Array(d),g.set(m));l<g.length&&(g[l]=g[l]&~(1<<f)|(e?1:0)<<f);a.data=g}return a};b.getVisibility=k;b.hideAllComponents=
function(a){if(null==a)a=p(!1);else{a.isVisibleBit=!0;for(var c=0;c<a.data.length;c++)a.data[c]=0}return a};b.unhideAllComponents=function(a){var c;if(null!=a)for(c=a,c.isVisibleBit=!1,a=0;a<c.data.length;a++)c.data[a]=0;return c};b.generateVisibleIndexRanges=function(a,c){var d;if(a)if(g(c))if(0===a.data.length)d=[],c=[[c[0],c[c.length-1]-1]],d=a.isVisibleBit?d:c;else{d=[];for(var b=a.isVisibleBit,h=a.data,l=8*h.BYTES_PER_ELEMENT,f=h.length*l,m=u(c),p=!1,k=0;k<f&&k<m;k++){var r=e(b,h,k,l);if(r!==
p){var t=c[k];r?d.push([t,0]):(p=d[d.length-1],p[1]=t-1);p=r}}a=!a.isVisibleBit;m>f&&a&&!p?d.push([c[f],c[m]-1]):p&&(p=d[d.length-1],p[1]=c[a?m:Math.min(m,f)]-1)}else d=[],d=a.isVisibleBit?d:null;else d=null;return d};b.addHighlight=function(a,c,e,b){a=a||[];c={component:c,options:e,id:b};a.push(c);e=d(c);for(b=a.length-1;0<b&&e<d(a[b-1]);)c=[a[b],a[b-1]],a[b-1]=c[0],a[b]=c[1],--b;return a};b.removeHighlight=function(a,c){if(!a)return a;a=a.filter(function(a){return a.id!==c});return 0===a.length?
null:a};b.generateHighlightedIndexRanges=function(c,d,e){if(!d)return null;if(!g(e))return c&&c.isVisibleBit?null:d.map(function(a){return{range:null,options:a.options}});for(var b=e[0],l=e[e.length-1]-1,p=[],k=!a(c,e),r=0;r<d.length;++r){var t=d[r].options,n=d[r].component;if(f.isSome(n))h(p,c,e,n,t);else if(k)m(p,c,e,b,l,t);else for(n=0;n<u(e);++n)h(p,c,e,n,t)}return 0<p.length?p:null};b.hasHighlights=function(c,d,e){if(!d)return!1;if(!g(e))return c&&c.isVisibleBit?!1:0<d.length;c=!a(c,e);for(var b=
0;b<d.length;b++)if(f.isSome(d[b].component)||c||0<u(e))return!0;return!1};b.defaultVisibilities=p;b.isAllVisible=function(c,d){return!a(c,d)};b.isAllHidden=function(a,d){return!c(a,d)};b.hasVisible=c;b.hasHidden=a;var t=p();b.createOffsets=function(a){return Array.isArray(a)?new Uint32Array(a):a};b.hasComponent=function(a,c){return c<u(a)};b.hasComponents=g;var r=[];for(q=0;65>q;q++)r.push(Math.pow(2,q)-1);b.componentCount=u;b.componentFind=function(a,c){a=n.binaryIndexOf(a,c,!0);return 0<=a?a:null}})},
"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});var n=1,f=null;b.generateDefaultIndexArray=function(d){if(d>n||null==f){for(;d>n;)n*=2;f=new Uint32Array(n);for(var b=0;b<n;b++)f[b]=b}return new Uint32Array(f.buffer,0,d)};var k=0;b.getNewId=function(){return k++}})},"esri/views/3d/webgl-engine/lib/Util":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/mathUtils".split(" "),
function(q,b,n,f,k,d,h,m,p){function c(a,c){if(!a)throw a=Error(c||"assert"),a.stack&&console.log(a.stack),new t(c);}function a(a){for(var c in a)return c}function l(a,c){a[12]=c[0];a[13]=c[1];a[14]=c[2]}function g(a,c){void 0===c&&(c=0);for(var d=0,e=0;4>e;e++)d+=a[c+e]*y[e];return d}function e(a){return a-Math.floor(a)}Object.defineProperty(b,"__esModule",{value:!0});var u=m.vec4f64.create(),t=function(){function a(a){this.message=a}a.prototype.toString=function(){return"AssertException: "+this.message};
return a}();b.AssertException=t;b.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex",TANGENT:"aTangent"};b.assert=c;b.verify=function(a,c){a||console.warn("Verify failed: "+(c||"")+"\n"+Error("verify").stack)};b.encodeInt16=function(a){return p.clamp(Math.round(32767*a),-32767,32767)};b.encodeNormal=function(a,c){var d=
Math.abs(a[0]),e=Math.abs(a[1]),b=1/(d+e+Math.abs(a[2])),g=Math.min(a[2]*b,0);c[0]=(0>a[0]?-1:1)*(d*b-g);c[1]=(0>a[1]?-1:1)*(e*b-g)};b.fallbackIfUndefined=function(a,c){return void 0===a?c:a};b.hex2rgb=function(a){a=Math.floor(a);return[(a>>16&255)/255,(a>>8&255)/255,(a&255)/255]};b.rgb2hex=function(a){var c=p.clamp(Math.round(255*a[0]),0,255),d=p.clamp(Math.round(255*a[1]),0,255);a=p.clamp(Math.round(255*a[2]),0,255);return"0x"+((c<<16)+(d<<8)+a).toString(16)};b.dec2hex=function(a){a=a.toString(16);
return"00000000".substr(0,8-a.length)+a};b.rayTriangle3D=function(a,c,e,b,g,h,l,f,m){void 0===m&&(m=d.vec3f64.create());var p=b[l]-e[h],k=b[l+1]-e[h+1],r=b[l+2]-e[h+2];b=g[f]-e[h];l=g[f+1]-e[h+1];g=g[f+2]-e[h+2];var u=c[1]*g-l*c[2],t=c[2]*b-g*c[0],n=c[0]*l-b*c[1];f=p*u+k*t+r*n;if(-1E-5<f&&1E-5>f)return!1;f=1/f;var z=a[0]-e[h],x=a[1]-e[h+1];a=a[2]-e[h+2];m[1]=f*(z*u+x*t+a*n);if(0>m[1]||1<m[1])return!1;e=x*r-k*a;a=a*p-r*z;p=z*k-p*x;m[2]=f*(c[0]*e+c[1]*a+c[2]*p);if(0>m[2]||1<m[1]+m[2])return!1;m[0]=
f*(b*e+l*a+g*p);return!0};b.rayBoxTest=function(a,c,d,e){var b,g=(d[0]-a[0])/c[0],h=(e[0]-a[0])/c[0];g>h&&(b=g,g=h,h=b);var l=(d[1]-a[1])/c[1],f=(e[1]-a[1])/c[1];l>f&&(b=l,l=f,f=b);if(g>f||l>h)return!1;l>g&&(g=l);f<h&&(h=f);d=(d[2]-a[2])/c[2];a=(e[2]-a[2])/c[2];d>a&&(b=d,d=a,a=b);if(g>a||d>h)return!1;a<h&&(h=a);return 0>h?!1:!0};b.rayRay2D=function(a,c,d,e,b,g){void 0===g&&(g=k.vec2f64.create());var h=(e[b]-d[b])*(c[0]-a[0])-(e[0]-d[0])*(c[b]-a[b]);if(0===h)return!1;d=((e[0]-d[0])*(a[b]-d[b])-(e[b]-
d[b])*(a[0]-d[0]))/h;g[0]=a[0]+d*(c[0]-a[0]);g[1]=a[b]+d*(c[b]-a[b]);return!0};b.project=function(a,d,e,b,g){g||(g=a);u[0]=a[0];u[1]=a[1];u[2]=a[2];u[3]=1;h.vec4.transformMat4(u,u,d);2<g.length&&(g[2]=-u[2]);h.vec4.transformMat4(u,u,e);c(0!==u[3]);g[0]=u[0]/u[3];g[1]=u[1]/u[3];g[2]=u[2]/u[3];g[0]=(.5*g[0]+.5)*b[2]+b[0];g[1]=(.5*g[1]+.5)*b[3]+b[1]};b.getFirstObjectKey=a;b.getFirstObjectValue=function(c){return c[a(c)]};b.objectEmpty=function(a){for(var c in a)return!1;return!0};b.logWithBase=function(a,
c){return Math.log(a)/Math.log(c)};b.setMatrixTranslation=l;b.setMatrixTranslation3=function(a,c,d,e){a[12]=c;a[13]=d;a[14]=e};b.getMatrixTranslation=function(a,c){void 0===c&&(c=d.vec3f64.create());c[0]=a[12];c[1]=a[13];c[2]=a[14];return c};b.createTranslationMatrix=function(a,c){a=n.mat4.identity(a);l(a,c);return a};b.isTranslationMatrix=function(a){return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&1===a[15]};b.fovx2fovy=
function(a,c,d){return 2*Math.atan(d*Math.tan(.5*a)/c)};b.fovy2fovx=function(a,c,d){return 2*Math.atan(c*Math.tan(.5*a)/d)};b.fovx2fovd=function(a,c,d){return 2*Math.atan(Math.sqrt(c*c+d*d)*Math.tan(.5*a)/c)};b.fovy2fovd=function(a,c,d){return 2*Math.atan(Math.sqrt(c*c+d*d)*Math.tan(.5*a)/d)};b.fovd2fovx=function(a,c,d){return 2*Math.atan(c*Math.tan(.5*a)/Math.sqrt(c*c+d*d))};b.fovd2fovy=function(a,c,d){return 2*Math.atan(d*Math.tan(.5*a)/Math.sqrt(c*c+d*d))};b.packFloatRGBA=function(a,c,d){void 0===
d&&(d=0);a=p.clamp(a,0,w);for(var b=0;4>b;b++)c[d+b]=Math.floor(256*e(a*r[b]))};b.unpackFloatRGBA=g;var r=[1,256,65536,16777216],y=[1/256,1/65536,1/16777216,1/4294967296],w=g(new Uint8ClampedArray([255,255,255,255]));b.inverseProjectionInfo=function(a,c,d,e,b){0===a[11]?(e[0]=2/(c*a[0]),e[1]=2/(d*a[5]),e[2]=(1+a[12])/a[0],e[3]=(1+a[13])/a[5],f.vec2.set(b,0,1)):(e[0]=-2/(c*a[0]),e[1]=-2/(d*a[5]),e[2]=(1-a[8])/a[0],e[3]=(1-a[9])/a[5],f.vec2.set(b,1,0))}})},"esri/views/3d/webgl-engine/shaders/SimpleAtmospherePrograms":function(){define(["require",
"exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});b.colorPass={name:"simple-atmosphere-color",shaders:function(d){return{vertexShader:k.glslifyDefineMap({PANORAMIC:d.panoramic})+f.resolveIncludes("environment/simpleAtmosphere.vert"),fragmentShader:k.glslifyDefineMap({PANORAMIC:d.panoramic})+f.resolveIncludes("environment/simpleAtmosphere.frag")}},attributes:n.Default3D};b.fadePass=
{name:"simple-atmosphere-fade",shaders:{vertexShader:f.resolveIncludes("environment/simpleAtmosphereFade.vert"),fragmentShader:f.resolveIncludes("environment/simpleAtmosphereFade.frag")},attributes:n.Default3D}})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,instanceColor:3,size:4,aTangent:4,auxpos1:5,symbolColor:5,
componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}})},"esri/views/3d/webgl-engine/shaders/sources/resolver":function(){define(["require","exports","./shaderRepository","../../../../webgl/ShaderCompiler"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});var k=new f(function(d){var b=n;d.split("/").forEach(function(d){b&&(b=b[d])});return b});b.resolveIncludes=function(d){return k.resolveIncludes(d)}})},
"esri/views/3d/webgl-engine/shaders/sources/shaderRepository":function(){define(["require","exports"],function(q,b){return{edgeRenderer:{"adjustProjectedPosition.glsl":"uniform vec2 uDepthBias;\r\nuniform vec2 uViewportDimInv;\r\n\r\n// Utility function to check for NaN values\r\nbool isNaN(float val) {\r\n  return ( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 ) ? false : true;\r\n  // important: some nVidias failed to cope with version below.\r\n  // Probably wrong optimization.\r\n  /*return ( val \x3c\x3d 0.0 || 0.0 \x3c\x3d val ) ? false : true;*/\r\n}\r\n\r\n// An offset in xy screen space, along the projected normal of the edge\r\n// This reduces depth fighting when looking at a face from a flat angle\r\nvec2 calculateProjectedBiasXY(vec4 projPos, vec3 worldNormal) {\r\n  float offsetXY \x3d uDepthBias.x;\r\n  float offsetZ  \x3d uDepthBias.y;\r\n\r\n  // screen space pixel offset\r\n  // we multiply by two to account for the fact that NDC go from -1 to 1\r\n  // we multiply by projPos.w to compensate for the perspective divison that happens later\r\n  // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\r\n  // towards the camera\r\n  vec4 projNormal \x3d uProj * uView * vec4(worldNormal, 0.0);\r\n\r\n  return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\r\n}\r\n\r\n// A z-offset, using a depth based heuristic.\r\nfloat calculateProjectedBiasZ(vec4 projPos) {\r\n  float offsetZ \x3d uDepthBias.y;\r\n  return sqrt(projPos.z) * offsetZ;\r\n}\r\n\r\nvec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\r\n  vec2 offsetXY \x3d calculateProjectedBiasXY(projPos, worldNormal);\r\n\r\n  // we currently have to do this check because some geometries come with 0 length edge normals.\r\n  // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\r\n  if (!isNaN(offsetXY.x) \x26\x26 !isNaN(offsetXY.y)) {\r\n    projPos.xy +\x3d offsetXY;\r\n  }\r\n\r\n  projPos.z +\x3d calculateProjectedBiasZ(projPos);\r\n\r\n  return projPos;\r\n}\r\n",
"edgeRenderer.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying vec4 vColor;\r\nvarying float vRadius;\r\nvarying vec3 vPosition;\r\nvarying vec3 vWorldPosition;\r\nvarying float vLineLengthPixels;\r\nvarying float vSizeFalloffFactor;\r\nvarying float vLineIndex;\r\n\r\n// At which coverage threshold we discard a fragment completely\r\n#define COVERAGE_TEST_THRESHOLD 0.01\r\n\r\n#include \x3cedgeRenderer/lineOffset.glsl\x3e\r\n\r\nvec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\r\n  float lineOffset \x3d calculateLineOffset();\r\n  float positionX \x3d position.x - lineOffset;\r\n\r\n  if (radius \x3c 1.0) {\r\n    // Handle this specifically for subpixel sizes:\r\n    // 1. Compute correct coverage (note coverage is computed by\r\n    //    0.5 - dist, so we make sure that that will lead to correct\r\n    //    subpixel coverage\r\n    // 2. Ignore rounded caps\r\n    float coverageX \x3d clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\r\n    float coverageY \x3d clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\r\n\r\n    float coverage \x3d min(coverageX, coverageY);\r\n\r\n    return vec2(0.5 - coverage, 0.0);\r\n  }\r\n  else {\r\n    // Between -radius -\x3e 0 for start cap, 0 for line, 0 -\x3e radius\r\n    float positionOnCap \x3d position.y - clamp(position.y, 0.0, lineLength);\r\n\r\n    vec2 lineToPosition \x3d vec2(positionX, positionOnCap);\r\n    return vec2(length(lineToPosition) - radius, positionOnCap / radius);\r\n  }\r\n}\r\n\r\nvoid main() {\r\n\r\n  float radius \x3d vRadius * calculateLinePressure();\r\n\r\n  vec2 distance \x3d lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\r\n  float coverage \x3d clamp(0.5 - distance.x, 0.0, 1.0);\r\n\r\n#ifdef ANTIALIASING\r\n\r\n  const float coverageLimit \x3d COVERAGE_TEST_THRESHOLD;\r\n\r\n#else /* ANTIALIASING */\r\n\r\n  // Use subpixel coverage computation when lines get subpixel widths\r\n  // so we still render them appropriately. Otherwise discard anything\r\n  // that is not fully within the line\r\n  float coverageLimit \x3d radius \x3c\x3d 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75;\r\n\r\n#endif /* ANTIALIASING */\r\n\r\n  if (coverage \x3c coverageLimit) {\r\n    discard;\r\n  }\r\n\r\n  discardBySlice(vWorldPosition);\r\n\r\n  float alpha \x3d vColor.a * coverage;\r\n\r\n  gl_FragColor \x3d vec4(vColor.rgb, alpha);\r\n}\r\n",
"edgeRenderer.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n// Transformations\r\nuniform mat4 uProj;\r\nuniform mat4 uView;\r\nuniform mat4 uModel;\r\nuniform vec3 uCameraPosition;\r\n\r\n// Line configuration\r\n\r\n// Conversion constants\r\nuniform vec2 uPixelToNDC;\r\nuniform vec2 uNDCToPixel;\r\nuniform float uPixelRatio;\r\n\r\n// Inputs\r\nattribute vec3 aPosition0;\r\nattribute vec3 aPosition1;\r\nattribute float aVariantOffset;\r\nattribute float aVariantStroke;\r\nattribute float aVariantExtension;\r\n\r\n#ifdef SILHOUETTE\r\n\r\nattribute vec3 aNormalA;\r\nattribute vec3 aNormalB;\r\n\r\n#else /* SILHOUETTE */\r\n\r\nattribute vec3 aNormal;\r\n\r\n#endif /* SILHOUETTE */\r\n\r\nattribute vec2 aSideness;\r\nattribute vec2 aPackedAttributes;\r\n\r\nstruct UnpackedAttributes {\r\nvec2 sideness;\r\nvec2 sidenessNorm;\r\nfloat lineWidthPixels;\r\nfloat extensionLengthPixels;\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\nfloat type;\r\n\r\n#endif\r\n};\r\n\r\n// Output required to compute color\r\nvarying vec4 vColor;\r\n\r\n// Output required to compute distance to line/caps\r\nvarying vec3 vPosition;\r\nvarying vec3 vWorldPosition;\r\nvarying float vRadius;\r\nvarying float vLineLengthPixels;\r\nvarying float vSizeFalloffFactor;\r\n\r\n#include \x3cedgeRenderer/adjustProjectedPosition.glsl\x3e\r\n#include \x3cedgeRenderer/styleOutputs.glsl\x3e\r\n#include \x3cedgeRenderer/lineAmplitude.glsl\x3e\r\n#include \x3cedgeRenderer/util.glsl\x3e\r\n\r\nvec4 calculateGeometricOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n  vec2 sideness \x3d unpackedAttributes.sideness;\r\n  vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\r\n\r\n  vWorldPosition \x3d mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\r\n\r\n  vec4 viewPos \x3d mix(viewPosV0, viewPosV1, sidenessNorm.y);\r\n  vec4 projPosV0 \x3d uProj * viewPosV0;\r\n  vec4 projPosV1 \x3d uProj * viewPosV1;\r\n  vec4 projPos \x3d uProj * viewPos;\r\n\r\n  vec3 screenSpaceLineNDC \x3d (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\r\n  vec2 screenSpaceLinePixels \x3d screenSpaceLineNDC.xy * uNDCToPixel;\r\n  float lineLengthPixels \x3d length(screenSpaceLinePixels);\r\n\r\n  float dzPerPixel \x3d screenSpaceLineNDC.z / lineLengthPixels;\r\n  vec2 screenSpaceDirection \x3d screenSpaceLinePixels / lineLengthPixels;\r\n  vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\r\n\r\n  float falloffFactor \x3d distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\r\n  float lineWidthPixels \x3d unpackedAttributes.lineWidthPixels * falloffFactor;\r\n\r\n  float extensionLengthPixels \x3d calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\r\n  float lineAmplitudePixels \x3d calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\r\n\r\n  vSizeFalloffFactor \x3d falloffFactor;\r\n\r\n  float lineWidthAndAmplitudePixels \x3d lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\r\n  float extendedLineLengthPixels \x3d lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\r\n\r\n#ifdef ANTIALIASING\r\n\r\n  const float aaPaddingPixels \x3d 1.0;\r\n\r\n  // Line size with padding\r\n  float halfAAPaddedLineWidthAndAmplitudePixels \x3d lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\r\n  float aaPaddedRoundedCapSizePixels \x3d lineWidthPixels * 0.5 + aaPaddingPixels;\r\n\r\n  // Line length with padding\r\n  float aaPaddedLineLengthPixels \x3d extendedLineLengthPixels + aaPaddingPixels + aaPaddingPixels;\r\n  float halfAAPaddedLineLengthPixels \x3d aaPaddedLineLengthPixels * 0.5;\r\n\r\n#else /* ANTIALIASING */\r\n\r\n  // Even if there is no AA, we still want to do proper \x3c1px rendering,\r\n  // so we effectively clamp the pixel sizes to minimum of 1px and compute\r\n  // coverage in the fragment shader\r\n  float halfAAPaddedLineWidthAndAmplitudePixels \x3d max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\r\n  float aaPaddedRoundedCapSizePixels \x3d max(lineWidthPixels, 1.0) * 0.5;\r\n\r\n  float halfAAPaddedLineLengthPixels \x3d max(extendedLineLengthPixels, 1.0) * 0.5;\r\n\r\n#endif /* ANTIALIASING */\r\n\r\n  // Half line width in NDC including padding for anti aliasing\r\n  vec2 halfAAPaddedLineWidthAndAmplitudeNDC \x3d halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\r\n  vec2 aaPaddedRoundedCapSizeNDC \x3d aaPaddedRoundedCapSizePixels * uPixelToNDC;\r\n  vec2 extensionLengthNDC \x3d extensionLengthPixels * uPixelToNDC;\r\n\r\n  // Compute screen space position of vertex, offsetting for line size and end caps\r\n  vec2 ndcOffset \x3d (\r\n      screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\r\n    + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\r\n  );\r\n\r\n  projPos.xy +\x3d ndcOffset * projPos.w;\r\n  projPos.z +\x3d (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\r\n\r\n  projPos \x3d adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\r\n\r\n  // Line length with end caps\r\n  float aaPaddedLineWithCapsLengthPixels \x3d extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\r\n\r\n  float pixelPositionAlongLine \x3d aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\r\n\r\n  // Position in pixels with origin at first vertex of line segment\r\n  vPosition \x3d vec3(\r\n    halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\r\n    pixelPositionAlongLine,\r\n    pixelPositionAlongLine / extendedLineLengthPixels\r\n  );\r\n\r\n  // The line width radius in pixels\r\n  vRadius \x3d lineWidthPixels * 0.5;\r\n  vLineLengthPixels \x3d extendedLineLengthPixels;\r\n\r\n#ifdef SILHOUETTE\r\n\r\n  gl_Position \x3d isSilhouetteEdge(viewPosV0, aNormalA, aNormalB) ? projPos : vec4(10.0, 10.0, 10.0, 1.0);\r\n\r\n#else /* SILHOUETTE */\r\n\r\n  gl_Position \x3d projPos;\r\n\r\n#endif /* SILHOUETTE */\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\n  if (unpackedAttributes.type \x3c\x3d 0.0 \x26\x26 lineLengthPixels \x3c\x3d 3.0) {\r\n    gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\r\n  }\r\n\r\n#elif (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  if (lineLengthPixels \x3c\x3d 3.0) {\r\n    gl_Position \x3d vec4(10.0, 10.0, 10.0, 1.0);\r\n  }\r\n\r\n#endif\r\n\r\n  return projPos;\r\n}\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\nUnpackedAttributes unpackAttributes(ComponentData component) {\r\n\r\n  vec2 sidenessNorm \x3d aSideness;\r\n  vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\r\n\r\n  float fType \x3d component.type;\r\n  float extensionLengthPixels \x3d component.extensionLength;\r\n  float lineWidth \x3d component.lineWidth;\r\n\r\n  if (fType \x3c\x3d 0.0) {\r\n    extensionLengthPixels *\x3d aVariantExtension * 2.0 - 1.0;\r\n  }\r\n\r\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\r\n}\r\n\r\n#else /* (MODE \x3d\x3d MODE_UBER) */\r\n\r\nUnpackedAttributes unpackAttributes(ComponentData component) {\r\n  vec2 sidenessNorm \x3d aSideness;\r\n  vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\r\n  float extensionLengthPixels \x3d component.extensionLength;\r\n\r\n#if (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  extensionLengthPixels *\x3d aVariantExtension * 2.0 - 1.0;\r\n\r\n#endif\r\n\r\n  float lineWidth \x3d component.lineWidth;\r\n\r\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\r\n}\r\n\r\n#endif /* (MODE \x3d\x3d MODE_UBER) */\r\n\r\nvoid main() {\r\n  ComponentData component \x3d readComponentData();\r\n  UnpackedAttributes unpackedAttributes \x3d unpackAttributes(component);\r\n\r\n  vec4 worldPosV0 \x3d uModel * vec4(aPosition0, 1.0);\r\n  vec4 worldPosV1 \x3d uModel * vec4(aPosition1, 1.0);\r\n\r\n  vec4 viewPosV0 \x3d uView * worldPosV0;\r\n  vec4 viewPosV1 \x3d uView * worldPosV1;\r\n\r\n#ifdef SILHOUETTE\r\n\r\n  vec3 worldNormal \x3d silhouetteWorldNormal(aNormalA, aNormalB);\r\n\r\n#else /* SILHOUETTE */\r\n\r\n  vec3 worldNormal \x3d modelToWorldNormal(aNormal);\r\n\r\n#endif /* SILHOUETTE */\r\n\r\n  // General geometric computation for all types of edges\r\n  vec4 projPos \x3d calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal, unpackedAttributes);\r\n\r\n  // Component color\r\n  vColor \x3d component.color;\r\n\r\n  // Specific computation for different edge styles\r\n  calculateStyleOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, projPos, worldNormal, unpackedAttributes);\r\n}\r\n",
"lineAmplitude.glsl":"// Solid\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineAmplitudeSolid() {\r\n    return 0.0;\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    return calculateLineAmplitudeSolid();\r\n  }\r\n\r\n#endif\r\n\r\n// Sketch\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  uniform float uStrokesAmplitude;\r\n\r\n  float calculateLineAmplitudeSketch() {\r\n    return uStrokesAmplitude;\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    return calculateLineAmplitudeSketch();\r\n  }\r\n\r\n#endif\r\n\r\n// Uber\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    float type \x3d unpackedAttributes.type;\r\n\r\n    if (type \x3c\x3d 0.0) {\r\n      return calculateLineAmplitudeSketch();\r\n    }\r\n    else {\r\n      return calculateLineAmplitudeSolid();\r\n    }\r\n  }\r\n\r\n#endif\r\n",
"lineOffset.glsl":"#include \x3cutil/encoding.glsl\x3e\r\n\r\n// Sketch\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  uniform sampler2D uStrokesTexture;\r\n  uniform float uStrokesNormalizationScale;\r\n\r\n  varying vec2 vStrokeUV;\r\n\r\n  float calculateLineOffsetSketch() {\r\n    float offsetNorm \x3d rgba2float(texture2D(uStrokesTexture, vStrokeUV));\r\n    return (offsetNorm - 0.5) * uStrokesNormalizationScale;\r\n  }\r\n\r\n  float calculateLinePressureSketch() {\r\n    return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  float calculateLineOffset() {\r\n    return calculateLineOffsetSketch();\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    return calculateLinePressureSketch();\r\n  }\r\n\r\n#endif\r\n\r\n// Solid\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineOffsetSolid() {\r\n    return 0.0;\r\n  }\r\n\r\n  float calculateLinePressureSolid() {\r\n    return 1.0;\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineOffset() {\r\n    return calculateLineOffsetSolid();\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    return calculateLinePressureSolid();\r\n  }\r\n\r\n#endif\r\n\r\n// Uber\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n  varying float vType;\r\n\r\n  float calculateLineOffset() {\r\n    if (vType \x3c\x3d 0.0) {\r\n      return calculateLineOffsetSketch();\r\n    }\r\n    else {\r\n      return calculateLineOffsetSolid();\r\n    }\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    if (vType \x3c\x3d 0.0) {\r\n      return calculateLinePressureSketch();\r\n    }\r\n    else {\r\n      return calculateLinePressureSolid();\r\n    }\r\n  }\r\n#endif\r\n",
"styleOutputs.glsl":"#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  uniform vec2 uStrokesTextureScale;\r\n  uniform float uStrokesLog2Resolution;\r\n  uniform float uStrokeVariants;\r\n\r\n  varying vec2 vStrokeUV;\r\n  varying float vLineIndex;\r\n\r\n  void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\r\n    vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\r\n\r\n    float lineIndex \x3d clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\r\n\r\n    vStrokeUV \x3d vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + aVariantStroke + 0.5) * uStrokesTextureScale;\r\n    vStrokeUV.x +\x3d aVariantOffset;\r\n\r\n    vLineIndex \x3d lineIndex;\r\n  }\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SOLID)\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n  }\r\n#elif (MODE \x3d\x3d MODE_SKETCH)\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n    calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\r\n  }\r\n#elif (MODE \x3d\x3d MODE_UBER)\r\n  varying float vType;\r\n\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n    vType \x3d unpackedAttributes.type;\r\n\r\n    if (unpackedAttributes.type \x3c\x3d 0.0) {\r\n      calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\r\n    }\r\n  }\r\n#endif\r\n",
"util.glsl":"uniform float uDistanceFalloffFactor;\r\n\r\nfloat distanceBasedPerspectiveFactor(float distance) {\r\n  return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\r\n}\r\n\r\nuniform sampler2D uComponentDataTex;\r\nuniform vec2 uComponentDataTexInvDim;\r\n\r\nattribute float aComponentIndex;\r\n\r\n#define COMPONENT_COLOR_FIELD_OFFSET 0.0\r\n#define COMPONENT_OTHER_FIELDS_OFFSET 1.0\r\n#define COMPONENT_FIELD_COUNT 2.0\r\n\r\n#define LINE_WIDTH_FRACTION_FACTOR 8.0\r\n#define EXTENSION_LENGTH_OFFSET 128.0\r\n\r\n#define COMPONENT_TEX_WIDTH 4096.0\r\n\r\nvec2 componentTextureCoords(float componentIndex, float fieldOffset) {\r\n  float fieldIndex \x3d COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\r\n\r\n  float rowIndex \x3d floor(fieldIndex / COMPONENT_TEX_WIDTH);\r\n  float colIndex \x3d mod(fieldIndex, COMPONENT_TEX_WIDTH);\r\n\r\n  vec2 linearIndex \x3d vec2(\r\n    (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\r\n    (rowIndex + 0.5) * uComponentDataTexInvDim.y\r\n  );\r\n\r\n  return linearIndex;\r\n}\r\n\r\nstruct ComponentData {\r\n  vec4 color;\r\n  float lineWidth;\r\n  float extensionLength;\r\n  float type;\r\n};\r\n\r\nComponentData readComponentData() {\r\n  vec2 colorIndex \x3d componentTextureCoords(aComponentIndex, COMPONENT_COLOR_FIELD_OFFSET);\r\n  vec2 otherIndex \x3d componentTextureCoords(aComponentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\r\n\r\n  vec4 colorValue \x3d texture2D(uComponentDataTex, colorIndex);\r\n  vec4 otherValue \x3d texture2D(uComponentDataTex, otherIndex);\r\n\r\n  return ComponentData(\r\n    vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\r\n    otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\r\n    otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\r\n    -(otherValue.z * 255.0) + 0.5 // SOLID (\x3d0/255) needs to be \x3e 0.0, SKETCHY (\x3d1/255) needs to be \x3c\x3d 0;\r\n  );\r\n}\r\n\r\nvec3 modelToWorldNormal(vec3 normal) {\r\n  return (uModel * vec4(normal, 0.0)).xyz;\r\n}\r\n\r\nvec3 silhouetteWorldNormal(vec3 normalA, vec3 normalB) {\r\n  return modelToWorldNormal(normalize(normalA + normalB));\r\n}\r\n\r\n// Fall-off extension length for shorter strokes, starting from strokes that are 256 size,\r\n// fall-off exponentially\r\nfloat calculateExtensionLength(float extensionLength, float lineLength) {\r\n  return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\r\n}\r\n\r\n#ifdef SILHOUETTE\r\n\r\n// #uniforms: uView, uModel\r\nbool isSilhouetteEdge(vec4 viewPos, vec3 normalA, vec3 normalB) {\r\n  // transform the two face normals\r\n  vec3 viewNormalA \x3d (uView * uModel * vec4(normalA, 0.0)).xyz;\r\n  vec3 viewNormalB \x3d (uView * uModel * vec4(normalB, 0.0)).xyz;\r\n\r\n  // compute the direction from the edge to the camera\r\n  vec3 viewDir \x3d -viewPos.xyz;\r\n\r\n  // check which of the two faces are visible\r\n  // display the edge if exactly one of the two is visible\r\n  float faceAVisible \x3d dot(viewDir, viewNormalA); // positive if visible\r\n  float faceBVisible \x3d dot(viewDir, viewNormalB); // positive if visible\r\n\r\n  // 1 if exactly one face visible, 0 otherwise\r\n  return faceAVisible * faceBVisible \x3c 0.0;\r\n}\r\n\r\n#endif /* SILHOUETTE */\r\n"},
environment:{"realisticAtmosphere.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/color.glsl\x3e\r\n\r\n// Light\r\nuniform vec3 v3LightDir;      // The direction vector to the light source\r\nuniform vec3 v3InvWavelength; // 1 / pow(wavelength, 4) for the red, green, and blue channels\r\nuniform vec3 v3InvWavelengthScaled; //v3InvWavelength * fKr4PI + fKm4PI\r\n\r\n// Atmosphere\r\nconst float fKrESun \x3d 0.075;        // Kr * ESun \x3d 0.005 * 15.0\r\nconst float fKmESun \x3d 0.015;        // Km * ESun \x3d 0.005 * 15\r\n\r\n// Radii\r\nuniform vec4 v4Radii; // (fInnerRadius, fInnerRadius^2, fOuterRadius, fOuterRadius^2)\r\n\r\n// The inner (planetary) radius\r\n#define fInnerRadius v4Radii[0]\r\n// fInnerRadius^2\r\n#define fInnerRadius2 v4Radii[1]\r\n// The outer (atmosphere) radius\r\n#define fOuterRadius v4Radii[2]\r\n// fOuterRadius^2\r\n#define fOuterRadius2 v4Radii[3]\r\n\r\n// Atmosphere parameters:\r\n// fScale:                    1.0 / (fOuterRadius - fInnerRadius)\r\n// fScaleDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)\r\n// fScaleOverScaleDepth:      fScale / fScaleDepth\r\n// fOneOverScaleDepth:        1.0 / fScaleDepth\r\n\r\n// fScaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)\r\n// fScaleOverScaleDepthBlue:  fScale / fScaleDepthBlue\r\n// fOneOverScaleDepthBlue;    1.0 / fScaleDepthBlue\r\n\r\nuniform vec4 v4AtmosParams1; // (fScale, fScaleDepth, fScaleOverScaleDepth, fOneOverScaleDepth)\r\nuniform vec4 v4AtmosParams2; // (g, fScaleDepthBlue, fScaleOverScaleDepthBlue, fOneOverScaleDepthBlue)\r\n\r\n#define fScale v4AtmosParams1.x\r\n// fScaleDepth, fScaleDepthBlue\r\n#define v2ScaleDepth vec2(v4AtmosParams1.y,v4AtmosParams2.y)\r\n// fScaleOverScaleDepth, fScaleOverScaleDepthBlue\r\n#define v2ScaleOverScaleDepth vec2(v4AtmosParams1.z,v4AtmosParams2.z)\r\n// fOneOverScaleDepth, fOneOverScaleDepthBlue\r\n#define v2OneOverScaleDepth vec2(v4AtmosParams1.w,v4AtmosParams2.w)\r\n\r\n#ifndef HAZE\r\nuniform vec4 v4AtmosParams3; // (g2, fMiePhaseCoefficients, fLowerAlphaBlendBound, fOneOverOuterRadiusMinusAlphaBlendBound)\r\nuniform float fInnerFadeDistance;\r\nuniform float fAltitudeFade;\r\n\r\n#define fg v4AtmosParams2.x\r\n#define fg2 v4AtmosParams3.x\r\n#define fMiePhaseCoefficients v4AtmosParams3.y\r\n#define fLowerAlphaBlendBound v4AtmosParams3.z\r\n#define fOneOverOuterRadiusMinusAlphaBlendBound v4AtmosParams3.w\r\n#endif\r\n\r\n// Camera\r\nuniform vec3 v3CameraPos;     // The camera's current position\r\nuniform vec2 nearFar;\r\n\r\nuniform vec4 v4SphereComp;              // (fCameraHeight, fCameraHeight2, fC, fCSur)\r\n// The camera's current height\r\n#define fCameraHeight v4SphereComp[0]\r\n// fCameraHeight^2\r\n#define fCameraHeight2 v4SphereComp[1]\r\n// fCameraHeight2 - fOuterRadius2; // C \x3d ||o-c||^2 - r^2\r\n#define fC v4SphereComp[2]\r\n// fCameraHeight2 - (fInnerRadius2 - 63756370000.0); // C \x3d ||o-c||^2 - r^2\r\n#define fCSur v4SphereComp[3]\r\n\r\n// Camera HDR\r\n#ifdef HAZE\r\nconst float fExposure \x3d 1.5;\r\n#else\r\nconst float fExposure \x3d 2.0;\r\n#endif\r\n\r\n#ifdef HAZE\r\n// Depth texture\r\nuniform sampler2D tDepth;\r\n#endif\r\n\r\n// Testing variables\r\nuniform float showTest;\r\n\r\n// Varyings\r\nvarying vec3 v3EyeDir;\r\nvarying vec3 v3WorldRay;\r\nvarying vec2 vtc;\r\n\r\n// Loop constants for integral approximation\r\nconst float fSamples \x3d 5.0;\r\nconst int maxSamples \x3d 5;\r\n\r\n#ifdef HAZE\r\n  const float fOneOverGamma \x3d 1.0;//Gamma \x3d 1.0\r\n#else\r\n  const float fOneOverGamma \x3d 0.454545; // Gamma \x3d 2.2\r\n#endif\r\n\r\nconst vec3 v3OneOverGamma \x3d vec3(fOneOverGamma);\r\n\r\n// ToneMapping operators\r\nvec3 expTM(vec3 inputColor,float exposure){\r\n    return pow(1.0 - exp(inputColor * -exposure), v3OneOverGamma);\r\n}\r\n\r\n#ifndef HAZE\r\nvec3 reinhardTM(vec3 inputColor, float exposure){\r\n  vec3 intermediate \x3d inputColor *exposure;\r\n  intermediate /\x3d (1.0+intermediate);\r\n  return pow(intermediate, v3OneOverGamma);\r\n}\r\n#endif\r\n\r\n// Approximation for inner integral based on a radii ratio of 10.25:10\r\nfloat scale(float fCos){\r\n  float x \x3d 1.0 - fCos;\r\n  return exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\r\n}\r\n\r\nvoid main() {\r\n  vec3 cameraPosition \x3d v3CameraPos;\r\n\r\n  // Debug variables\r\n  vec3 test \x3d vec3(0.0,0.0,0.0);\r\n\r\n  // Obtain ray from Camera\r\n  vec3 worldSpaceRay \x3d normalize(v3WorldRay);\r\n\r\n  // Compute Atmosphere intersection; i.e. ray/sphere intersection\r\n  float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay); // B \x3d 2(l * (o-c))\r\n  float det \x3d B*B - 4.0 * fC; // det \x3d B^2 - 4.0* C\r\n\r\n  // idealized sphere intersection to discard early some pixels\r\n  float detSur \x3d B*B - 4.0 * fCSur; // det \x3d B^2 - 4.0* C\r\n\r\n  // the minimal sample start position:\r\n  // at the camera by default, on the earth radius surface if the camera is underground.\r\n  float fMinRayStart \x3d 0.0;\r\n#ifndef HAZE\r\n  // When the ray intersects the earth surface, fade the sky to a simple light direction\r\n  // based color. This is used to make sure we have a white background in underground\r\n  // mode (at noon).\r\n  float fSurfaceBlend \x3d 0.0;\r\n  vec4 surfaceColor \x3d vec4(0.0);\r\n  if (detSur \x3e\x3d 0.0) {\r\n    float nearSurfaceT \x3d max(0.0, 0.5 *(-B - sqrt(detSur)));\r\n    float farSurfaceT \x3d max(0.0, 0.5 *(-B + sqrt(detSur)));\r\n\r\n    if (nearSurfaceT \x3d\x3d 0.0) {\r\n      fMinRayStart \x3d farSurfaceT;\r\n    }\r\n\r\n    // Compute lighting at the point where the ray enters the earth surface\r\n    // Lighting computation is copied from the terrain shader.\r\n    vec3 vPos \x3d cameraPosition + worldSpaceRay * nearSurfaceT;\r\n    float fLightAngle \x3d dot(v3LightDir, normalize(vPos));\r\n    float fBrightness \x3d max(0.0, (smoothstep(-1.0, 0.8, 2.0 * fLightAngle)));\r\n\r\n    // Make the surface transparent based on altitude\r\n    surfaceColor \x3d vec4(fBrightness, fBrightness, fBrightness, 1.0 - fAltitudeFade);\r\n\r\n    // Fade based on the distance the ray travels below the earth surface\r\n    float fRelDist \x3d (farSurfaceT - nearSurfaceT) / fInnerFadeDistance;\r\n\r\n    // early exit\r\n    if (fRelDist \x3e 1.0) {\r\n      gl_FragColor \x3d surfaceColor;\r\n      return;\r\n    }\r\n\r\n    fSurfaceBlend \x3d smoothstep(0.0, 1.0, fRelDist * fRelDist);\r\n  }\r\n#endif\r\n\r\n  // Inside Atmosphere\r\n  if (det \x3e\x3d 0.0) {\r\n#ifdef HAZE\r\n    // only use red channel from depth texture.\r\n    // see 'Issues' at https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture\r\n    float depthSample \x3d texture2D(tDepth, vtc).r;\r\n\r\n    float zNear \x3d nearFar[0];\r\n    float zFar \x3d nearFar[1];\r\n\r\n    // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\r\n    float zNorm \x3d 2.0 * depthSample - 1.0;\r\n    float linDepth \x3d 2.0 * zNear * zFar /\r\n      (zFar + zNear - zNorm * (zFar - zNear));\r\n\r\n    float rayEndT;\r\n    float altitudeAlpha \x3d 1.0;\r\n\r\n    // find intersections with ground, but only between the near and far\r\n    // clipping planes.\r\n    if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\r\n      vec3 cameraSpaceRay \x3d normalize(v3EyeDir);\r\n      cameraSpaceRay /\x3d cameraSpaceRay.z;\r\n      cameraSpaceRay *\x3d linDepth;\r\n\r\n      float cameraSpaceRayLength \x3d length(cameraSpaceRay);\r\n\r\n      vec3 v3World \x3d cameraPosition + worldSpaceRay * cameraSpaceRayLength;\r\n      float v3WorldRadius2 \x3d dot(v3World, v3World);\r\n\r\n      // Handle tall structures:\r\n      // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\r\n      float transitionStart \x3d fInnerRadius + 20000.0;\r\n      float transitionHeight \x3d 25000.0;\r\n      float transitionEnd \x3d transitionStart + transitionHeight;\r\n\r\n      float edge0 \x3d transitionStart * transitionStart;\r\n      float edge1 \x3d transitionEnd * transitionEnd;\r\n\r\n      altitudeAlpha \x3d 1.0 - clamp((v3WorldRadius2 - edge0) / (edge1 - edge0), 0.0, 1.0);\r\n      rayEndT \x3d cameraSpaceRayLength;\r\n\r\n      if (altitudeAlpha \x3e 0.0 \x26\x26 detSur \x3e 0.0) {\r\n        float nearSurfaceT \x3d 0.5 *(-B - sqrt(detSur));\r\n        float interp \x3d clamp(((fCameraHeight - fInnerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\r\n        rayEndT \x3d mix(cameraSpaceRayLength, nearSurfaceT, interp);\r\n      }\r\n    }\r\n#endif\r\n\r\n    float rayStartT \x3d 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\r\n#ifdef HAZE\r\n    float nearT \x3d abs(rayStartT);\r\n    float farT \x3d abs(rayEndT);\r\n#else\r\n    float rayEndT \x3d 0.5 *(-B + sqrt(det)); //far intersection with atmosphere\r\n\r\n#endif\r\n\r\n    float fDistance; // calculate its scattering offset\r\n    // Calculate the ray's starting position\r\n    if (rayStartT \x3c fMinRayStart)\r\n    { // ray starts from camera or inner radius sphere to far\r\n      rayStartT \x3d fMinRayStart;\r\n#ifndef HAZE\r\n      // clamp to value at inner radius altitude\r\n      fDistance \x3d fScale * min(0.0, fInnerRadius - fCameraHeight);\r\n#endif\r\n    }\r\n#ifndef HAZE\r\n    else\r\n    { // outside atmosphere\r\n      fDistance \x3d -1.0;\r\n    }\r\n#endif\r\n\r\n    // Initialize the scattering loop variables\r\n    vec3 v3Start \x3d cameraPosition + worldSpaceRay * rayStartT;\r\n\r\n#ifdef HAZE\r\n    vec3 v3End \x3d cameraPosition + worldSpaceRay * rayEndT;\r\n\r\n    float fEndLength \x3d length(v3End);\r\n    float fAltitudeEnd \x3d fEndLength - fInnerRadius;\r\n    float fAltitudeStart \x3d length(v3Start) - fInnerRadius;\r\n\r\n    // for camera positions below altitude 0, invert the altitudes, to achieve\r\n    // a similar haze as above ground. Note that there is a small but visible change\r\n    // when the camera passes altitude 0.\r\n    if (fAltitudeStart \x3c 0.0) {\r\n      fAltitudeStart \x3d -fAltitudeStart;\r\n      fAltitudeEnd \x3d -fAltitudeEnd;\r\n    }\r\n\r\n    // computed for the original end point to get consistent light angles after possible inversions\r\n    float fLightAngle \x3d dot(v3LightDir, v3End) / fEndLength;\r\n\r\n    if (nearT \x3e farT)\r\n    {\r\n      if (fAltitudeStart \x3c fAltitudeEnd)\r\n      {\r\n        // Switch positive slopes for flipped rays\r\n        v3End \x3d cameraPosition + worldSpaceRay * rayStartT;\r\n        v3Start \x3d cameraPosition + worldSpaceRay * rayEndT;\r\n        worldSpaceRay *\x3d -1.0;\r\n        float fTmp \x3d fAltitudeStart;\r\n        fAltitudeStart \x3d fAltitudeEnd;\r\n        fAltitudeEnd \x3d fTmp;\r\n      }\r\n      else if (fAltitudeStart \x3d\x3d fAltitudeEnd)\r\n      { // create minuscule fake slope for integration if the slope is zero\r\n        fAltitudeStart +\x3d 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\r\n        // slope for the camera function\r\n      }\r\n    }\r\n\r\n    // Calculate its scattering offset\r\n    // Assumes camera constrains of WSV 3.8\r\n    float fCameraDepth;\r\n    float fCameraDepthBlue;\r\n    if (fAltitudeStart \x3e fOuterRadius - fInnerRadius)\r\n    { // outside atmosphere\r\n      fDistance \x3d fInnerRadius - fOuterRadius;\r\n    } else\r\n    {\r\n      fDistance \x3d fAltitudeEnd - fAltitudeStart;\r\n    }\r\n\r\n#endif\r\n    vec2 v2OpticalStartDepth \x3d exp(fDistance * v2OneOverScaleDepth);\r\n\r\n    float fRayLength \x3d rayEndT - rayStartT;\r\n    float fSampleLength \x3d fRayLength / fSamples;\r\n    float fScaledLength \x3d fSampleLength * fScale;\r\n    vec3 v3SampleRay \x3d worldSpaceRay * fSampleLength;\r\n    vec3 v3SamplePoint \x3d v3Start + v3SampleRay * 0.5;\r\n\r\n#ifdef HAZE\r\n    float fCameraAngle \x3d dot(-worldSpaceRay, v3End) / length(v3End);\r\n    float fScaleCameraAngle \x3d scale(fCameraAngle);\r\n    vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth;\r\n\r\n    float scaledValues \x3d scale(fLightAngle) + fScaleCameraAngle;\r\n    vec2 v2ScaledValuesDepth \x3d scaledValues * v2ScaleDepth;\r\n#else\r\n    float fCameraAngle \x3d dot(worldSpaceRay, v3Start / length(v3Start));\r\n    float angleMultiplier \x3d fCameraAngle\x3e0.0?fCameraAngle:0.0;\r\n\r\n    float fScaleCameraAngle \x3d scale(fCameraAngle);\r\n    vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth * v2ScaleDepth;\r\n#endif\r\n\r\n    // Loop variables\r\n    vec3 v3FrontColor \x3d vec3(0.0, 0.0, 0.0);\r\n    vec3 v3FrontColorBlue \x3d vec3(0.0, 0.0, 0.0);\r\n    vec3 v3Attenuate\x3d vec3(0.0, 0.0, 0.0);\r\n    vec3 v3AttenuateBlue \x3d vec3(0.0, 0.0, 0.0);\r\n\r\n    // Now loop through the sample rays\r\n    for(int i\x3d0; i\x3cmaxSamples; i++) {\r\n      float fHeight \x3d length(v3SamplePoint);\r\n      float fAltitude \x3d abs(fHeight - fInnerRadius);\r\n\r\n      vec2 v2Depth \x3d exp(-fAltitude * v2ScaleOverScaleDepth);\r\n#ifdef HAZE\r\n      vec2 v2Scatter \x3d v2Depth*v2ScaledValuesDepth-v2CameraOffset;\r\n#else\r\n      float fLightAngle \x3d dot(v3LightDir, v3SamplePoint) / fHeight;\r\n      float fCameraAngle \x3d dot(worldSpaceRay, v3SamplePoint) / fHeight;\r\n      float fTempScaledValues \x3d scale(fLightAngle) - scale(fCameraAngle);\r\n      vec2 v2Scatter \x3d v2CameraOffset + fTempScaledValues*v2Depth* v2ScaleDepth;\r\n#endif\r\n      v3Attenuate \x3d exp(-v2Scatter.x * v3InvWavelengthScaled);\r\n      v3AttenuateBlue \x3d exp(-v2Scatter.y * v3InvWavelengthScaled);\r\n\r\n      v3FrontColor +\x3d v3Attenuate * v2Depth.x;\r\n      v3FrontColorBlue +\x3d v3AttenuateBlue * v2Depth.y;\r\n\r\n      v3SamplePoint +\x3d v3SampleRay;\r\n    }\r\n\r\n    // Phase computation\r\n    // clamp to avoid numerical instability at fCos \x3d\x3d -1.0 (and close values) to display fake sun\r\n    float fCos \x3d clamp(dot(v3LightDir, -worldSpaceRay ),-0.9999999,1.0);\r\n    float fOnePlusCos2 \x3d fCos*fCos + 1.0;\r\n#ifdef HAZE\r\n    // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\r\n    vec3 colorCoefficients \x3d (fScaledLength* 0.75 * fOnePlusCos2)*(fKrESun*v3InvWavelength+fKmESun);\r\n\r\n    // Scaled Length is only applied afterwards to save multiplications\r\n    vec3 v3Color \x3d colorCoefficients *v3FrontColor;\r\n    vec3 v3ColorBlue \x3d colorCoefficients *v3FrontColorBlue;\r\n#else\r\n    vec3 v3RayleighCoefficients \x3d (fScaledLength*0.75 * fOnePlusCos2*fKrESun)*v3InvWavelength;\r\n    float fMieCoefficients \x3d fScaledLength*fKmESun * fMiePhaseCoefficients * fOnePlusCos2 / pow(1.0 + fg2 - 2.0*fg*fCos, 1.5);\r\n\r\n    // Calculate the attenuation factor for the ground\r\n    vec3 v3Color \x3d v3RayleighCoefficients * v3FrontColor + fMieCoefficients * v3FrontColor;\r\n    vec3 v3ColorBlue \x3d v3RayleighCoefficients * v3FrontColorBlue + fMieCoefficients * v3FrontColorBlue;\r\n#endif\r\n\r\n    // HDR to LDR conversion\r\n    vec3 ldrBlue \x3d expTM(v3ColorBlue,2.0*fExposure);\r\n    vec3 ldrRed \x3d expTM(v3Color,fExposure);\r\n\r\n    // mix reddish and blueish atmosphere\r\n    vec3 LDR \x3d mix(ldrBlue,ldrRed,0.2);\r\n#ifdef HAZE\r\n    LDR *\x3d (1.0-fCameraAngle);\r\n    vec3 hsv \x3d rgb2hsv(LDR);\r\n    hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0); // boost haze saturation by 50%\r\n    LDR \x3d hsv2rgb(hsv);\r\n    vec3 finalColor \x3d LDR;\r\n    // when rendering we specify the blend functions such that\r\n    // newDestColor \x3d oldDestColor*(1.0-finalColor) + finalColor\r\n#else\r\n    // reinhard tonemapper for looking upwards\r\n    vec3 ldrReinhard \x3d reinhardTM(v3Color,fExposure);\r\n    LDR +\x3d angleMultiplier*ldrReinhard;\r\n\r\n    // height dependent parameter to smooth out reddish atmosphere\r\n    float side \x3d (rayEndT+rayStartT)*0.5;\r\n    float atmoHeight \x3d sqrt(fCameraHeight2 - side*side);\r\n    float h2 \x3d clamp(1.0-(atmoHeight-fLowerAlphaBlendBound)/(fOuterRadius-fLowerAlphaBlendBound),0.0,1.0);\r\n\r\n    vec3 finalColor \x3d LDR*h2;\r\n    vec3 hsv \x3d rgb2hsv(finalColor);\r\n    hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0); // boost sky saturation by 50%\r\n    finalColor \x3d hsv2rgb(hsv);\r\n#endif\r\n\r\n#ifndef HAZE\r\n    float atmosStrength \x3d clamp((length(ldrRed)-0.05)*1.05,0.0,1.0);\r\n    gl_FragColor \x3d vec4(finalColor, atmosStrength*clamp(1.0-(atmoHeight-fInnerRadius)/(fOuterRadius-fInnerRadius),0.0,1.0));\r\n    if (fSurfaceBlend \x3e 0.0) {\r\n      gl_FragColor \x3d mix(gl_FragColor, surfaceColor, fSurfaceBlend);\r\n    }\r\n#else\r\n    gl_FragColor \x3d vec4(finalColor, 1.0) * altitudeAlpha;\r\n#endif\r\n\r\n    // Debug variable overlay\r\n    if(showTest\x3e0.0){\r\n      gl_FragColor \x3d vec4(test,1.0);\r\n    }\r\n  } else { // Outside Atmosphere\r\n    gl_FragColor \x3d vec4(0.0);\r\n  }\r\n}\r\n",
"realisticAtmosphere.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n// Camera\r\nuniform vec2 halfSizeNearPlane;\r\nuniform vec3 v3CameraUp;\r\nuniform vec3 v3CameraRight;\r\nuniform vec3 v3CameraDir;\r\nuniform vec2 v2CameraCenterOffset;\r\n\r\n// Attributes\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\n// Varyings\r\nvarying vec3 v3WorldRay;\r\nvarying vec2 vtc;\r\n\r\n#ifdef HAZE\r\nvarying vec3 v3EyeDir;\r\n#endif\r\n\r\nvoid main(void) {\r\n  vec3 v3Pos \x3d position;\r\n  vtc \x3d uv0;\r\n  vec2 rayvtc \x3d uv0 - v2CameraCenterOffset;\r\n\r\n#ifdef HAZE\r\n  v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\r\n#else\r\n  vec3 v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\r\n#endif\r\n  v3WorldRay \x3d v3EyeDir.z*v3CameraDir + v3EyeDir.y*v3CameraUp + v3EyeDir.x*v3CameraRight;\r\n  gl_Position \x3d vec4(v3Pos, 1.0);\r\n}\r\n",
"simpleAtmosphere.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\n\r\nvarying vec2 vtc;\r\nvarying float falloff;\r\n\r\n#ifndef PANORAMIC\r\nuniform float altitudeFade;\r\nvarying float innerFactor;\r\n#endif\r\n\r\nvoid main() {\r\n  vec4 texColor \x3d texture2D(tex, vtc);\r\n\r\n#ifdef PANORAMIC\r\n  gl_FragColor \x3d texColor * falloff;\r\n#else\r\n  vec4 atmosphereColor \x3d texColor * falloff;\r\n  vec4 innerColor \x3d vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\r\n  gl_FragColor \x3d mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\r\n#endif\r\n}\r\n",
"simpleAtmosphere.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\n\r\n#ifndef PANORAMIC\r\nconst float TWICEPI \x3d 2.0*3.14159265;\r\nconst float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\r\n\r\nuniform vec3 silCircleCenter;\r\nuniform vec3 silCircleV1;\r\nuniform vec3 silCircleV2;\r\nuniform vec2 texV;\r\n\r\nuniform float innerScale;  // scale for inner rim\r\nvarying float innerFactor; // 0: outer atmosphere, 1: inner atmosphere\r\n#endif\r\n\r\nuniform vec3 lightDirection;\r\n\r\nattribute vec3 position;\r\nvarying vec2 vtc;\r\nvarying float falloff;\r\n\r\nvoid main(void) {\r\n\r\n#ifdef PANORAMIC\r\n\r\n  vec3 pos \x3d position;\r\n  float ndotl \x3d lightDirection.z;\r\n  vtc \x3d vec2(0.0, position.z+0.05);\r\n\r\n#else\r\n\r\n  innerFactor \x3d clamp(-position.z, 0.0, 1.0);\r\n  float scale \x3d position.y * (1.0 + innerFactor * innerScale);\r\n  float phi \x3d position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\r\n  vec3 pos \x3d  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\r\n  float ndotl \x3d dot(normalize(position.y \x3e 0.0 ? pos: silCircleCenter), lightDirection);\r\n\r\n  vtc.x \x3d position.x / ATMOSPHERE_RIM_SEGMENTS;\r\n  vtc.y \x3d texV.x * (1.0 - position.z) + texV.y * position.z;\r\n\r\n#endif\r\n\r\n  falloff \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\r\n\r\n  gl_Position \x3d proj * view * vec4(pos, 1.0);\r\n  gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\r\n}\r\n",
"simpleAtmosphereFade.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec4 color;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d color;\r\n}\r\n","simpleAtmosphereFade.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\n\r\nuniform vec3 lightDirection;\r\nuniform vec3 cameraPosition;\r\n\r\nuniform float undergroundFadeAlpha;\r\n\r\nvarying vec4 color;\r\n\r\nvoid main(void) {\r\n  float ndotl \x3d dot(normalize(cameraPosition), lightDirection);\r\n  float lighting \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\r\n\r\n  color \x3d vec4(vec3(lighting), undergroundFadeAlpha);\r\n\r\n  gl_Position \x3d vec4(position.xy, 1.0, 1.0); // on the far plane\r\n}\r\n",
"stars.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec4 vcolor;\r\nvarying float vsize;\r\n\r\nvoid main() {\r\n  float cap \x3d 0.7;\r\n  float scale \x3d 1.0/cap;\r\n  float helper \x3d clamp(length(abs(gl_PointCoord-vec2(0.5))),0.0,cap);\r\n  float alpha \x3d clamp((cap-helper)*scale,0.0,1.0);\r\n  float intensity \x3d alpha*alpha*alpha;\r\n  if (vsize \x3c 3.0)\r\n    intensity *\x3d 0.5;\r\n  gl_FragColor \x3d vec4(1.0,1.0,1.0,intensity);\r\n  gl_FragColor.xyz *\x3d vcolor.xyz;\r\n}\r\n",
"stars.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\nuniform vec4 viewport;\r\nuniform float pixelRatio;\r\n\r\nattribute vec3 position;\r\nattribute vec4 color;\r\nattribute float size;\r\n\r\nvarying vec4 vcolor;\r\nvarying float vsize;\r\n\r\nvoid main(void) {\r\n  vec4 posProj \x3d proj * view * model*vec4(position*1.0e25,1.0);//move infinitely far away\r\n  gl_Position \x3d alignToPixelCenter(posProj, viewport.zw); //pixel align position\r\n  gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\r\n  vcolor \x3d color / 1.2;\r\n  vsize \x3d size * 5.0 * pixelRatio;\r\n  gl_PointSize \x3d vsize;\r\n}\r\n"},
materials:{checkerBoard:{"checkerBoard.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec2 size;\r\nuniform vec4 color1;\r\nuniform vec4 color2;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main() {\r\n  vec2 uvScaled \x3d vUV / (2.0 * size);\r\n\r\n  vec2 uv \x3d fract(uvScaled - 0.25);\r\n  vec2 ab \x3d clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\r\n  float fade \x3d smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\r\n  float t \x3d mix(abs(ab.x + ab.y), 0.5, fade);\r\n\r\n  gl_FragColor \x3d mix(color2, color1, t);\r\n}\r\n",
"checkerBoard.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main(void) {\r\n  vUV \x3d uv0;\r\n  gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\r\n}\r\n"},color:{"color.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nuniform vec4 eColor;\r\n#ifdef VERTEX_COLORS\r\nvarying vec4 vColor;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef VERTEX_COLORS\r\n  gl_FragColor \x3d vColor * eColor;\r\n#else\r\n  gl_FragColor \x3d eColor;\r\n#endif\r\n\r\n  gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\r\n}\r\n",
"color.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\n#ifdef VERTEX_COLORS\r\nattribute vec4 color;\r\n\r\nvarying vec4 vColor;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\n\r\nvoid main(void) {\r\n#ifdef VERTEX_COLORS\r\n  vColor \x3d color * 0.003921568627451; // \x3d 1/255;\r\n#endif\r\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n}\r\n"},
defaultMaterial:{"colorMixMode.glsl":"#include \x3cutil/color.glsl\x3e\r\n\r\n/*\r\n * The color mix modes are encoded in the symbol color as follows:\r\n *  - Fully transparent symbols are represented with alpha 0 for\r\n *    all color mix modes (except ignore).\r\n *  - color mix mode ignore is encoded as multiply with white\r\n *  - the other 3 color mix modes (tint, replace, multiply) are\r\n *    equally distributed on the remaining 255 alpha values, which\r\n *    gives us 85 possible alpha values\r\n *\r\n * alpha             0 : fully transparent\r\n * alpha in [  1 -  85]: tint\r\n * alpha in [ 86 - 170]: replace\r\n * alpha in [171 - 255]: multiply\r\n * \r\n */\r\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\r\n  float symbolAlpha \x3d 0.0;\r\n\r\n  const float maxTint \x3d 85.0;\r\n  const float maxReplace \x3d 170.0;\r\n  const float scaleAlpha \x3d 3.0;\r\n\r\n  if (symbolColor.a \x3e maxReplace) {\r\n    colorMixMode \x3d 1;  // multiply\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\r\n  } else if (symbolColor.a \x3e maxTint) {\r\n    colorMixMode \x3d 3; // replace\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\r\n  } else if (symbolColor.a \x3e 0.0) {\r\n    colorMixMode \x3d 0; // tint\r\n    symbolAlpha \x3d scaleAlpha * symbolColor.a;\r\n  } else {\r\n    colorMixMode \x3d 1; // fully transparent -\x3e multiply\r\n    symbolAlpha \x3d 0.0;\r\n  }\r\n\r\n  return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);\r\n}\r\n\r\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  vec3 internalMixed \x3d internalColor * textureColor;\r\n  vec3 allMixed \x3d internalMixed * externalColor;\r\n\r\n  if (mode \x3d\x3d 1 /* multiply */) {\r\n    return allMixed;\r\n  }\r\n  else if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalColor;\r\n  }\r\n  else {\r\n    // tint (or something invalid)\r\n    vec3 hsvIn \x3d rgb2hsv(internalMixed);\r\n    vec3 hsvTint \x3d rgb2hsv(externalColor);\r\n    vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\r\n    return hsv2rgb(hsvOut);\r\n  }\r\n}\r\n\r\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  float internalMixed \x3d internalOpacity * textureOpacity;\r\n  float allMixed \x3d internalMixed * externalOpacity;\r\n\r\n  if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalOpacity;\r\n  }\r\n  else {\r\n    // multiply or tint (or something invalid)\r\n    return allMixed;\r\n  }\r\n}\r\n",
"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/sceneLighting.glsl\x3e\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\r\n#endif\r\n\r\n#define FRAGMENT_SHADER\r\n#include \x3cmaterials/defaultMaterial/vertexTangents.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/textureNormals.glsl\x3e\r\n\r\nuniform vec3 camPos;\r\nuniform vec3 localOrigin;\r\n\r\n// material parameters\r\n//////////////////////////////////////////\r\nuniform vec3 ambient;\r\nuniform vec3 diffuse;\r\nuniform vec3 specular;\r\nuniform float opacity;\r\nuniform float layerOpacity;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#else\r\nuniform int colorMixMode;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nuniform sampler2D depthTex;\r\nuniform int shadowMapNum;\r\nuniform vec4 shadowMapDistance;\r\nuniform mat4 shadowMapMatrix[4];\r\nuniform float depthHalfPixelSz;\r\n#endif\r\n\r\n#ifdef RECEIVE_SSAO\r\nuniform sampler2D ssaoTex;\r\nuniform vec4 viewportPixelSz;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\n\r\n#if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n  varying vec3 vnormal;\r\n#endif\r\n\r\n#if defined(VERTEXCOLORS)\r\nvarying vec4 vcolor;\r\n#endif\r\nvarying vec4 vcolorExt;\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#include \x3cutil/shadow.glsl\x3e\r\n#endif\r\n\r\n#ifdef TREE_RENDERING\r\n  uniform mat4 view;\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/colorMixMode.glsl\x3e\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  vec4 texColor \x3d textureLookup(tex, vtc);\r\n\r\n  #if defined(TEXTURE_ALPHA_PREMULTIPLIED)\r\n    texColor.rgb /\x3d texColor.a;\r\n  #endif\r\n\r\n  discardOrAdjustTextureAlpha(texColor);\r\n#else /* TEXTURING */\r\n  vec4 texColor \x3d vec4(1.0);\r\n#endif /* TEXTURING */\r\n\r\n  vec3 viewDir \x3d vpos - camPos;\r\n\r\n  // compute normal\r\n  // TODO: this is not in sync with the normal pass\r\n#ifdef GROUND_NORMAL_SHADING\r\n  #if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n    vec3 normal \x3d normalize(vpos + localOrigin);\r\n  #else\r\n    vec3 normal \x3d vec3(0.0, 0.0, 1.0);\r\n  #endif\r\n#else\r\n  #if (NORMALS \x3d\x3d NORMALS_SCREEN_DERIVATIVE)\r\n    vec3 normal \x3d normalize(cross(dFdx(vpos),dFdy(vpos)));\r\n  #else\r\n    #ifdef DOUBLESIDED\r\n      vec3 normal \x3d dot(vnormal, viewDir)\x3e0.0 ? -vnormal : vnormal;\r\n    #elif defined(WINDINGORDERDOUBLESIDED)\r\n      vec3 normal \x3d gl_FrontFacing ? vnormal : -vnormal;\r\n    #else\r\n      vec3 normal \x3d vnormal;\r\n    #endif\r\n    normal \x3d normalize(normal);\r\n  #endif\r\n#endif\r\n\r\n  // compute ssao\r\n#ifdef RECEIVE_SSAO\r\n  float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n  ssao \x3d viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\r\n#else\r\n  float ssao \x3d 1.0;\r\n#endif\r\n\r\n  // At global scale we create some additional ambient light based on the main light to simulate global illumination\r\n  float additionalAmbientScale;\r\n  vec3 additionalLight \x3d sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\r\n\r\n  // compute shadowing\r\n  float shadow \x3d 0.0;\r\n#ifdef RECEIVE_SHADOWS\r\n  shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n#elif VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n  // at global scale (and in global scenes) we fall back to this approximation\r\n  // to shadow objects on the dark side of the earth\r\n  shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\r\n#endif\r\n\r\n  vec3 matColor \x3d max(ambient, diffuse); // combine the old material parameters into a single one\r\n#if defined(VERTEXCOLORS)\r\n  // Internal colors: varying vcolor + uniform ambient/diffuse, external colors: varying vcolorExt\r\n  vec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n#else\r\n  // Internal colors: uniform ambient/diffuse, external colors: varying vcolorExt\r\n  vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n#endif\r\n  albedo_+\x3d 0.25 * specular; // don't completely ignore specular for now\r\n\r\n\r\n  #if defined(TEXTURE_NORMALS)\r\n    mat3 tangentSpace \x3d computeTangentSpace(normal);\r\n    vec3 shadingNormal \x3d computeTextureNormal(tangentSpace);\r\n  #else\r\n    vec3 shadingNormal \x3d normal;\r\n  #endif\r\n\r\n  #ifdef TREE_RENDERING\r\n    // make sure we use unflipped normal\r\n    shadingNormal \x3d normalize(vnormal);\r\n\r\n    // make tree 20% brighter\r\n    albedo_ *\x3d 1.2;\r\n\r\n    // view forward vector in global coordinates\r\n    vec3 viewForward \x3d - vec3(view[0][2], view[1][2], view[2][2]);\r\n\r\n    // factor indicating how aligned the lighting direction and view axis are\r\n    float alignmentLightView \x3d clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);\r\n\r\n    // we approximate the tree crown transmittance based on view direction and tree crown normal\r\n    float transmittance \x3d 1.0 - clamp(dot(-viewForward, shadingNormal), 0.0, 1.0);\r\n\r\n    float treeRadialFalloff \x3d vcolor.r;\r\n    float backLightFactor \x3d 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);\r\n    additionalLight +\x3d backLightFactor * lightingMainIntensity;\r\n  #endif\r\n\r\n  vec3 shadedColor \x3d evaluateSceneLighting(shadingNormal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n  gl_FragColor \x3d highlightSlice(vec4(shadedColor, opacity_), vpos);\r\n}\r\n",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\n#define VERTEX_SHADER\r\n#include \x3cmaterials/defaultMaterial/vertexTangents.glsl\x3e\r\n\r\n#ifdef INSTANCEDCOLOR\r\nattribute vec4 instanceColor;\r\n#endif\r\nattribute vec3 position;\r\n\r\n#if (NORMALS \x3d\x3d NORMALS_COMPRESSED)\r\n  attribute vec2 normalCompressed;\r\n  varying vec3 vnormal;\r\n#elif (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n  attribute vec3 normal;\r\n  varying vec3 vnormal;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\n    attribute vec2 uv0;\r\n    varying vec2 vtc;\r\n  #ifdef TEXTURE_ATLAS\r\n    attribute vec4 region;\r\n    varying vec4 regionV;\r\n  #endif\r\n#endif\r\n\r\n#ifdef COMPONENTCOLORS\r\n#include \x3cmaterials/defaultMaterial/componentColors.glsl\x3e\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#endif\r\n\r\n#ifdef VERTEXCOLORS\r\nattribute vec4 color;\r\n#endif\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\nattribute vec4 symbolColor;\r\n#endif\r\n\r\n#if defined(VERTEXCOLORS)\r\nvarying vec4 vcolor;\r\n#endif\r\n\r\n// Workaround for https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13452\r\n// We pass the externalColor uniform from VS to FS through the vcolorExt varying because\r\n// there is a driver bug for Intel Integrated Graphics which led to rendering artifacts\r\n// since the introduction of https://devtopia.esri.com/WebGIS/arcgis-js-api/pull/12673\r\n// This should be further cleaned up later with through the following issue:\r\n// https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12763\r\nuniform vec4 externalColor;\r\nvarying vec4 vcolorExt;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#endif\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_SIZE) || defined(VV_COLOR)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/colorMixMode.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/constants.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localNormal.glsl\x3e\r\n\r\nvoid main() {\r\n\r\n#ifdef VERTEXCOLORS\r\n  vcolor \x3d color * 0.003921568627451; // \x3d 1/255\r\n#endif\r\n\r\n  vcolorExt \x3d externalColor;\r\n\r\n#ifdef INSTANCEDCOLOR\r\n  vcolorExt *\x3d instanceColor;\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  vcolorExt *\x3d vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\r\n#endif\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\n  int symbolColorMixMode;\r\n  vcolorExt *\x3d decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n\r\n#ifdef COMPONENTCOLORS\r\n  int symbolColorMixMode;\r\n  vcolorExt *\x3d decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n\r\n  if (vcolorExt.a \x3c SYMBOL_ALPHA_CUTOFF) {\r\n    // Discard this vertex\r\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\r\n  }\r\n  else {\r\n    vpos \x3d calculateVPos();\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  #if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n    vnormal \x3d normalize(modelNormal * localNormal().xyz);\r\n  #endif\r\n\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n  #ifdef IOS_SAFARI_FIX\r\n    originDelta \x3d originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\r\n  #endif\r\n  vpos -\x3d originDelta;\r\n\r\n  #ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d model * localCenter().xyz + originDelta;\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n  #endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n  #if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n    vnormal \x3d normalize((modelNormal * localNormal()).xyz);\r\n  #endif\r\n\r\n  #ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * localCenter()).xyz;\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n  #endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n    #if defined(VERTEX_TANGENTS)\r\n      transformVertexTangent(mat3(modelNormal));\r\n    #endif\r\n\r\n    gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n  }\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\r\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\r\n  // issues on iPad/iPhone with the 'w' component require the depth to be\r\n  // passed as varying to properly drive the cascading shadow map index.\r\n  linearDepth \x3d gl_Position.w;\r\n#endif\r\n\r\n\r\n#ifdef TEXTURING\r\n  #ifndef FLIPV\r\n    vtc \x3d uv0;\r\n  #else\r\n    vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n  #endif\r\n  #ifdef TEXTURE_ATLAS\r\n    regionV \x3d region;\r\n  #endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"commonFunctions.glsl":"#include \x3cmaterials/defaultMaterial/localPosition.glsl\x3e\r\n#include \x3cutil/doublePrecision.glsl\x3e\r\n\r\nvec3 calculateVPos() {\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  return model * localPosition().xyz;\r\n#else\r\n  return (model * localPosition()).xyz;\r\n#endif\r\n}\r\n\r\n#ifdef VERTICAL_OFFSET\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n#include \x3cutil/screenSizePerspective.glsl\x3e\r\n#endif\r\n\r\nvec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\r\n  float viewDistance \x3d length((view * vec4(worldPos, 1.0)).xyz);\r\n  float verticalOffsetOffsetDistance \x3d verticalOffset.x * viewDistance;\r\n\r\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n  vec3 worldNormal \x3d normalize(worldPos + localOrigin);\r\n#else\r\n  vec3 worldNormal \x3d vec3(0.0, 0.0, 1.0);\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\r\n\r\n  float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);\r\n#else\r\n  float verticalOffsetScreenHeight \x3d verticalOffset.x;\r\n#endif\r\n\r\n  // Screen sized offset in world space, used for example for line callouts\r\n  float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\r\n\r\n  return worldNormal * worldOffset;\r\n}\r\n#endif\r\n",
"commonInputs.glsl":"uniform mat4 proj;\r\nuniform mat4 view;\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\nuniform vec3 viewOriginHi;\r\nuniform vec3 viewOriginLo;\r\n#endif\r\nuniform vec3 camPos;\r\nuniform vec3 localOrigin;\r\n\r\n#ifdef INSTANCED\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\nattribute vec3 modelOriginHi;\r\nattribute vec3 modelOriginLo;\r\nattribute mat3 model;\r\nattribute mat3 modelNormal;\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\nattribute mat4 model;\r\nattribute mat4 modelNormal;\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n#else /* INSTANCED */\r\nuniform mat4 model;\r\nuniform mat4 modelNormal;\r\n#endif /* INSTANCED */\r\n\r\n#ifdef VERTICAL_OFFSET\r\n// [ verticalOffsetPerDistance, minWorldLength, maxWorldLength ]\r\nuniform vec4 verticalOffset;\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\nuniform vec4 screenSizePerspectiveAlignment;\r\n#endif\r\n#endif\r\n",
"componentColors.glsl":"\r\nuniform sampler2D uComponentColorTex;\r\nuniform vec2 uComponentColorTexInvDim;\r\n\r\nattribute float componentIndex;\r\n\r\nvec4 readComponentColor() {\r\n  float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\r\n  vec2 indexCoord \x3d vec2(\r\n    mod(normalizedIndex, 1.0),\r\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\r\n  );\r\n  vec4 componentColor \x3d texture2D(uComponentColorTex, indexCoord);\r\n  // NB: we clear the least significant bit of the blue channel as this contains\r\n  // the castShadows flag\r\n  return vec4( componentColor.r, componentColor.g, componentColor.b - mod(componentColor.b*255.0, 2.0)/255.0, componentColor.a);\r\n}\r\n\r\n// returns 1.0 if shadowCasting is enabled and 0.0 otherwise\r\n// this is found by reading the least significant bit of the\r\n// componentColors blue color channel which contains the castShadows flag\r\nbool readComponentCastShadowsFlag(){\r\n  float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\r\n  vec2 indexCoord \x3d vec2(\r\n    mod(normalizedIndex, 1.0),\r\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\r\n  );\r\n  if( mod(texture2D(uComponentColorTex, indexCoord).b*255.0, 2.0) \x3c 1.0 )\r\n      return false;\r\n  return true;\r\n}\r\n",
"constants.glsl":"#define SYMBOL_ALPHA_CUTOFF 0.001\r\n","depthPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/depth.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\n#if defined(TEXTURING)\r\n  #include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\r\n  #include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n  #if defined(TEXTURING)\r\n    vec4 texColor \x3d textureLookup(tex, vtc);\r\n    discardOrAdjustTextureAlpha(texColor);\r\n  #endif\r\n\r\n  #ifndef BIAS_SHADOWMAP\r\n    gl_FragColor \x3d float2rgba(depth);\r\n  #else\r\n    gl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n  #endif\r\n}\r\n",
"depthPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\nuniform vec2 nearFar;\r\nattribute vec3 position;\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n\r\n#if defined(COMPONENTCOLORS)\r\n#include \x3cmaterials/defaultMaterial/componentColors.glsl\x3e\r\n#endif\r\n\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n\r\n\r\n#if defined(COMPONENTCOLORS)\r\n  if( !readComponentCastShadowsFlag() ){\r\n    // discard vertex so that it doesnt show up in depth buffer\r\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\r\n  }else\r\n  {\r\n#endif\r\n\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n#ifdef IOS_SAFARI_FIX\r\n  originDelta \x3d originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\r\n#endif\r\n  vpos -\x3d originDelta;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d model * localCenter().xyz + originDelta;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d (model * localCenter()).xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n  vec4 eye \x3d view * vec4(vpos, 1.0);\r\n\r\n  gl_Position \x3d proj * eye;\r\n  depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\r\n\r\n#if defined(COMPONENTCOLORS)\r\n  } // if readComponentCastShadowsFlag\x3d\x3dtrue\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"highlightPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n\r\nvarying vec3 vpos;\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\n#if defined(TEXTURING)\r\n  #include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\r\n  #include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n  #if defined(TEXTURING)\r\n    vec4 texColor \x3d textureLookup(tex, vtc);\r\n    discardOrAdjustTextureAlpha(texColor);\r\n  #endif\r\n\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n}\r\n",
"highlightPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\nattribute vec3 position;\r\n\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n#ifdef IOS_SAFARI_FIX\r\n  originDelta \x3d originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\r\n#endif\r\n  vpos -\x3d originDelta;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d model * localCenter().xyz + originDelta;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d (model * localCenter()).xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"localCenter.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\r\n# ifdef VERTICAL_OFFSET\r\nvec4 localCenter() { return vvTransformPosition(vec3(0.0), instanceFeatureAttribute); }\r\n# endif\r\n#else\r\n# ifdef VERTICAL_OFFSET\r\nvec4 localCenter() { return vec4(vec3(0.0), 1.0); }\r\n# endif\r\n#endif\r\n","localNormal.glsl":"#include \x3cutil/normalEncoding.glsl\x3e\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  # if (NORMALS \x3d\x3d NORMALS_COMPRESSED)\r\n    vec4 localNormal() { return vvTransformNormal(decodeNormal(normalCompressed), instanceFeatureAttribute); }\r\n  # elif (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n    vec4 localNormal() { return vvTransformNormal(normal, instanceFeatureAttribute); }\r\n  # endif\r\n#else\r\n  # if (NORMALS \x3d\x3d NORMALS_COMPRESSED)\r\n    vec4 localNormal() { return vec4(decodeNormal(normalCompressed), 1.0); }\r\n  # elif (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n    vec4 localNormal() { return vec4(normal, 1.0); }\r\n  # endif\r\n#endif\r\n",
"localPosition.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\r\nvec4 localPosition() { return vvTransformPosition(position, instanceFeatureAttribute); }\r\n#else\r\nvec4 localPosition() { return vec4(position, 1.0); }\r\n#endif\r\n","normalPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\n#if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n  varying vec3 vnormal;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\n\r\n#if defined(TEXTURING)\r\n  #include \x3cmaterials/defaultMaterial/texturingInputs.glsl\x3e\r\n  #include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n  #if defined(TEXTURING)\r\n    vec4 texColor \x3d textureLookup(tex, vtc);\r\n    discardOrAdjustTextureAlpha(texColor);\r\n  #endif\r\n\r\n#if (NORMALS \x3d\x3d NORMALS_SCREEN_DERIVATIVE)\r\n  vec3 normal \x3d normalize(cross(dFdx(vpos),dFdy(vpos)));\r\n#else\r\n  vec3 normal \x3d normalize(vnormal);\r\n  if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n#endif\r\n\r\n  #ifndef ALPHA_ZERO\r\n    gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n  #else\r\n    gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n  #endif\r\n}\r\n",
"normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\nuniform mat4 viewNormal;\r\nattribute vec3 position;\r\n\r\n#if (NORMALS \x3d\x3d NORMALS_COMPRESSED)\r\n  attribute vec2 normalCompressed;\r\n  varying vec3 vnormal;\r\n#elif (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n  attribute vec3 normal;\r\n  varying vec3 vnormal;\r\n#endif\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n\r\nvarying vec3 vpos;\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localNormal.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  #if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n    vnormal \x3d normalize((viewNormal * vec4(modelNormal * localNormal().xyz, 1.0)).xyz);\r\n  #endif\r\n\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n\r\n  #ifdef IOS_SAFARI_FIX\r\n    originDelta \x3d originDelta - fract(originDelta * 1000000.0) * (1.0 / 1000000.0);\r\n  #endif\r\n  vpos -\x3d originDelta;\r\n\r\n  #ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d model * localCenter().xyz + originDelta;\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n  #endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n  #if (NORMALS \x3d\x3d NORMALS_COMPRESSED) || (NORMALS \x3d\x3d NORMALS_DEFAULT)\r\n    vnormal \x3d normalize((viewNormal * modelNormal * localNormal()).xyz);\r\n  #endif\r\n\r\n  #ifdef VERTICAL_OFFSET\r\n    vec3 centerPos \x3d (model * localCenter()).xyz;\r\n    vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n  #endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"textureNormals.glsl":"#if defined(TEXTURE_NORMALS)\r\n  uniform sampler2D texNormal;\r\n\r\n  vec3 computeTextureNormal(mat3 tangentSpace) {\r\n    vec3 rawNormal \x3d texture2D(texNormal, vtc).rgb * 2.0 - 1.0;\r\n    return tangentSpace * rawNormal;\r\n  }\r\n#endif","texturing.glsl":'float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\r\n  // from:\r\n  //   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\r\n  //   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\r\n  //   - http://www.linedef.com/virtual-texture-demo.html\r\n  float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\r\n  return max(0.0, 0.5 * log2(deltaMaxSqr));\r\n}\r\n\r\nvec4 textureAtlasLookup(sampler2D tex, vec2 uv, vec4 region, vec2 texSize) {\r\n  //[umin, vmin, umax, vmax]\r\n  vec2 atlasScale \x3d region.zw - region.xy;\r\n  vec2 uvAtlas \x3d fract(uv) * atlasScale + region.xy;\r\n\r\n  vec4 texColor;\r\n\r\n  // calculate derivative of continuous texture coordinate\r\n  // to avoid mipmapping artifacts caused by manual wrapping in shader\r\n  vec2 dUVdx \x3d dFdx(uv) * atlasScale;\r\n  vec2 dUVdy \x3d dFdy(uv) * atlasScale;\r\n\r\n#ifdef GL_EXT_shader_texture_lod\r\n  return texture2DGradEXT(tex, uvAtlas, dUVdx, dUVdy);\r\n#else\r\n  // use bias to compensate for difference in automatic vs desired mipmap level\r\n  vec2 dUVdxAuto \x3d dFdx(uvAtlas);\r\n  vec2 dUVdyAuto \x3d dFdy(uvAtlas);\r\n  float mipMapLevel \x3d calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\r\n  float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\r\n\r\n  return texture2D(tex, uvAtlas, mipMapLevel - autoMipMapLevel);\r\n#endif\r\n}\r\n\r\nvec4 textureLookup(sampler2D tex, vec2 uv) {\r\n#ifdef TEXTURE_ATLAS\r\n  return textureAtlasLookup(tex, uv, regionV, texSize);\r\n#else\r\n  return texture2D(tex, uv);\r\n#endif\r\n}\r\n\r\n/**\r\n * Based on the texture alpha mode:\r\n * - discards fragments if necessary\r\n * - adjusts read texture alpha if necessary\r\n */\r\nvoid discardOrAdjustTextureAlpha(inout vec4 texColor) {\r\n  // if the texture alpha mode is set to "mask"\r\n  // the resulting alpha is either 0.0 (discard) or 1.0\r\n  #if defined(TEXTURE_ALPHA_MODE_MASK)\r\n    if (texColor.a \x3c textureAlphaCutoff) {\r\n      discard;\r\n    } else {\r\n      texColor.a \x3d 1.0;\r\n    }\r\n  // if the texture alpha mode is set to "maskBlend"\r\n  // the resulting alpha is either 0.0 (discard) or untouched for further use in blending\r\n  #elif defined(TEXTURE_ALPHA_MODE_MASK_BLEND)\r\n    if (texColor.a \x3c textureAlphaCutoff) {\r\n      discard;\r\n    }\r\n  // if the texture alpha mode is set to "opaque"\r\n  // the resulting alpha is always 1.0\r\n  #elif defined(TEXTURE_ALPHA_MODE_OPAQUE)\r\n    texColor.a \x3d 1.0;\r\n  // for "blend" we don\'t need to do anyting\r\n  #else // defined(TEXTURE_ALPHA_MODE_BLEND)\r\n\r\n  #endif\r\n}\r\n\r\n\r\n\r\n',
"texturingInputs.glsl":"#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\n\r\n#if defined(TEXTURE_ALPHA_MODE_MASK) || defined(TEXTURE_ALPHA_MODE_MASK_BLEND)\r\nuniform float textureAlphaCutoff;\r\n#endif\r\n\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n\r\n#endif\r\n\r\n#if defined(TEXTURING) || defined(TEXTURE_COORDINATES)\r\nvarying vec2 vtc;\r\n#endif\r\n","vertexTangents.glsl":"#if defined(VERTEX_SHADER)\r\n\r\n  #if defined(VERTEX_TANGENTS)\r\n    attribute vec4 aTangent;\r\n    varying vec4 vTangent;\r\n\r\n    void transformVertexTangent(mat3 modelTransformForNormals) {\r\n      vTangent.xyz \x3d modelTransformForNormals * aTangent.xyz;\r\n      vTangent.w \x3d aTangent.w;\r\n    }\r\n  #endif // VERTEX_TANGENTS\r\n\r\n#elif defined(FRAGMENT_SHADER)\r\n\r\n  #if defined(VERTEX_TANGENTS)\r\n    varying vec4 vTangent;\r\n\r\n    #if defined(WINDINGORDERDOUBLESIDED)\r\n      mat3 computeTangentSpace(vec3 normal) {\r\n        float tangentHeadedness \x3d gl_FrontFacing ? vTangent.w : -vTangent.w;\r\n        vec3 tangent \x3d normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);\r\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\r\n        return mat3(tangent, bitangent, normal);\r\n      }\r\n    #else // WINDINGORDERDOUBLESIDED\r\n      mat3 computeTangentSpace(vec3 normal) {\r\n        float tangentHeadedness \x3d vTangent.w;\r\n        vec3 tangent \x3d normalize(vTangent.xyz);\r\n        vec3 bitangent \x3d cross(normal, tangent) * tangentHeadedness;\r\n        return mat3(tangent, bitangent, normal);\r\n      }\r\n    #endif // WINDINGORDERDOUBLESIDED\r\n  #endif // VERTEX_TANGENTS\r\n\r\n#endif // VERTEX_SHADER\r\n"},
hud:{"colorPass.frag":"#include \x3cmaterials/hud/hudHeader.glsl\x3e\r\n\r\nvoid main() {\r\n#include \x3cmaterials/hud/hudMain.glsl\x3e\r\n}\r\n","highlightPass.frag":"#include \x3cmaterials/hud/hudHeader.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\nvoid main() {\r\n#include \x3cmaterials/hud/hudMain.glsl\x3e\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n  // Instead of deciding on a per-pixel basis if the highlight is occluded,\r\n  // do it for all highlight pixel based on the centroid occlusion. This\r\n  // is a temporary solution for:\r\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/9645\r\n  if (voccluded \x3d\x3d 1.0) {\r\n    gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\r\n  } else {\r\n    gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\r\n  }\r\n#else\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n#endif\r\n}\r\n",
"hud.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n#include \x3cutil/hud.glsl\x3e\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nuniform vec2 screenOffset;\r\nuniform vec2 anchorPos;\r\n\r\n// textureCoordinateScaleFactor can be used when there is a uniform texture scaling per material.\r\n// This is used in the case where we enforce a POT texture (for mipmaps) and the effective\r\n// texture is only in a subregion of the full POT texture.\r\nuniform vec2 textureCoordinateScaleFactor;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\nuniform vec4 screenSizePerspective;\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\nvarying vec3 debugBorderCoords;\r\n#endif\r\n\r\nattribute vec2 uv0;\r\nattribute vec4 color;\r\nattribute vec2 size;\r\nattribute vec4 auxpos2;\r\n\r\nvarying vec4 vcolor;\r\n\r\nvarying vec2 vtc;\r\nvarying vec2 vsize;\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\nvarying float voccluded;\r\n#endif\r\n\r\nvoid main(void) {\r\n  ProjectHUDAux projectAux;\r\n  vec4 posProj \x3d projectPositionHUD(projectAux);\r\n\r\n  if (rejectBySlice(projectAux.posModel)) {\r\n    // Project outside of clip plane\r\n    gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n    return;\r\n  }\r\n\r\n  vec2 inputSize;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  inputSize \x3d screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\r\n\r\n  vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\r\n\r\n#else\r\n\r\n  inputSize \x3d size;\r\n\r\n  vec2 screenOffsetScaled \x3d screenOffset;\r\n#endif\r\n\r\n#ifdef VV_SIZE\r\n  // only use width (.xx) for proportional scaling\r\n  // (if no width was defined in vv, width\r\n  //  will be a copy of height vv)\r\n  inputSize *\x3d vvGetScale(auxpos2).xx;\r\n#endif\r\n\r\n  vec2 combinedSize \x3d inputSize * pixelRatio;\r\n  vec4 quadOffset \x3d vec4(0.0);\r\n\r\n#if defined(OCCL_TEST) || defined(BINARY_HIGHLIGHT_OCCLUSION)\r\n  bool visible \x3d testVisibilityHUD(posProj);\r\n#endif\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\nvoccluded \x3d visible ? 0.0 : 1.0;\r\n#endif\r\n\r\n#ifdef OCCL_TEST\r\n  if (visible) {\r\n#endif\r\n    // UV goes from 0 to 1.99999, where the integer part is used\r\n    // for the normalized vertex coordinates, and the fractional\r\n    // part is used for texture sampling\r\n    vec2 uv01 \x3d floor(uv0);\r\n    vec2 uv \x3d uv0 - uv01;\r\n\r\n    // Displace icon based on anchor position (normalized for size) and\r\n    // absolute screen offset. anchorPos is [-0.5, 0.5]\r\n    quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\r\n\r\n#ifdef SIGNED_DISTANCE_FIELD\r\n\r\n    // SDF primitives might be scaled so that the SDF texture resolution does\r\n    // not match the resolution of the canvas, but we still want to render\r\n    // outline-only ('cross' and 'x') primitives cleanly. Aligning to a screen\r\n    // pixel border at the geometry center achieves this, since SDF textures\r\n    // always have power of 2 dimensions.\r\n    posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;\r\n#else\r\n    posProj +\x3d quadOffset;\r\n\r\n    // Aligning vertex positions to the nearest (using 'floor') screen pixel\r\n    // border renders textures with pixel-perfect results. If the texture\r\n    // resolution does not match the canvas resolution then aligning is\r\n    // redundant.\r\n    if (inputSize.x \x3d\x3d size.x) {\r\n      posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\r\n    }\r\n#endif\r\n\r\n    gl_Position \x3d posProj;\r\n\r\n    vtc \x3d uv * textureCoordinateScaleFactor;\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n    debugBorderCoords \x3d vec3(uv01, 1.0 / combinedSize);\r\n#endif\r\n\r\n    vsize \x3d inputSize;\r\n#ifdef OCCL_TEST\r\n  } else {\r\n    vtc \x3d vec2(.0);\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n    debugBorderCoords \x3d vec3(0.0);\r\n#endif\r\n\r\n  }\r\n#endif\r\n\r\n  gl_Position \x3d posProj;\r\n\r\n#ifdef VV_COLOR\r\n  vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors);\r\n#else\r\n  vcolor \x3d color / 255.0;\r\n#endif\r\n}\r\n",
"hudHeader.glsl":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/color.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\nuniform vec4 overrideColor;\r\nuniform vec4 outlineColor;\r\nuniform float outlineSize;\r\n\r\nvarying vec4 vcolor;\r\n\r\nvarying vec2 vtc;\r\nvarying vec2 vsize;\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\nvarying float voccluded;\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\nvarying vec3 debugBorderCoords;\r\n#endif\r\n",
"hudMain.glsl":"#ifdef SIGNED_DISTANCE_FIELD\r\n  vec4 color \x3d vec4(0.0, 0.0, 0.0, 0.0);\r\n  vec4 fillPixelColor \x3d overrideColor * vcolor;\r\n\r\n  // Attempt to sample texel centers to avoid that thin cross outlines\r\n  // disappear with large symbol sizes.\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\r\n  const float txSize \x3d 128.0;\r\n  const float texelSize \x3d 1.0 / txSize;\r\n  // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\r\n  vec2 scaleFactor \x3d (vsize - txSize) * texelSize;\r\n  vec2 samplePos \x3d vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\r\n\r\n  // Get distance and map it into [-0.5, 0.5]\r\n  float d \x3d rgba2float(texture2D(tex, samplePos)) - 0.5;\r\n\r\n  // Distance in output units (i.e. pixels)\r\n  float dist \x3d d * vsize.x;\r\n\r\n  // Create smooth transition from the icon into its outline\r\n  fillPixelColor.a *\x3d clamp(0.5 - dist, 0.0, 1.0);\r\n\r\n  if (outlineSize \x3e 0.25) {\r\n    vec4 outlinePixelColor \x3d outlineColor;\r\n    float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\r\n\r\n    // Create smooth transition around outline\r\n    outlinePixelColor.a *\x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\r\n\r\n    // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\r\n    float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\r\n    vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\r\n      vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\r\n\r\n    gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\r\n  }\r\n  else {\r\n    gl_FragColor \x3d premultiplyAlpha(fillPixelColor);\r\n  }\r\n\r\n  // visualize SDF:\r\n  // gl_FragColor \x3d vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\r\n#else\r\n\r\n  // HUDMaterial is rendered with a blending mode that assumes a pre-multiplied\r\n  // fragment color. Input textures should already be pre-multiplied and so\r\n  // don't require adjustment, but the override and vertex colors must be\r\n  // modulated by their alpha values.\r\n\r\n  gl_FragColor \x3d texture2D(tex, vtc, -0.5) * premultiplyAlpha(overrideColor * vcolor);\r\n\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n   float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, vec2(debugBorderCoords.z))) || any(greaterThan(debugBorderCoords.xy, vec2(1.0 - debugBorderCoords.z))));\r\n   gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);\r\n#endif\r\n\r\n  if (gl_FragColor.a \x3c 0.1) {\r\n    discard;\r\n  }\r\n",
"occlusionTest.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec4 color;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d color;\r\n}\r\n","occlusionTest.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n#include \x3cutil/hud.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vec4 posProjCenter;\r\n\r\n  // Check for special value of position (0, 0, 0) which is used by the Renderer when graphics\r\n  // are removed before the VBO is recompacted. If this is the case, then we just project outside\r\n  // of clip space.\r\n  if (dot(position, position) \x3e 0.0) {\r\n    // Render single point to center of the pixel to avoid subpixel filtering to affect\r\n    // the marker color\r\n    ProjectHUDAux projectAux;\r\n    vec4 posProj \x3d projectPositionHUD(projectAux);\r\n    posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\r\n\r\n    vec3 vpos \x3d projectAux.posModel;\r\n    if (rejectBySlice(vpos)) {\r\n      // Project out of clip space\r\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n    }\r\n  }\r\n  else {\r\n    // Project out of clip space\r\n    posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n  }\r\n\r\n  gl_Position \x3d posProjCenter;\r\n  gl_PointSize \x3d 1.0;\r\n}\r\n"},
lineCallout:{"lineCallout.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec4 color;\r\nuniform vec4 borderColor;\r\n\r\nvarying vec4 coverageSampling;\r\nvarying vec2 lineSizes;\r\n\r\nvoid main() {\r\n  // Mix between line and border coverage offsets depending on whether we need\r\n  // a border (based on the sidedness).\r\n  vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\r\n\r\n  // Mix between border and line color based on the line coverage (conceptually the line\r\n  // blends on top of the border background).\r\n  //\r\n  // Anti-alias by blending final result using the full (including optional border) coverage\r\n  // and the color alpha\r\n  float borderAlpha \x3d color.a * borderColor.a * coverage.y;\r\n  float colorAlpha \x3d color.a * coverage.x;\r\n\r\n  float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\r\n\r\n#ifdef DEPTH_HUD\r\n\r\n  if (finalAlpha \x3c 0.01) {\r\n    discard;\r\n  }\r\n\r\n#else\r\n\r\n  // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\r\n  // need to divide by finalAlpha). We avoid the division here by setting the\r\n  // appropriate blending function in the material.\r\n  vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\r\n\r\n  gl_FragColor \x3d vec4(finalRgb, finalAlpha);\r\n\r\n#endif\r\n\r\n}\r\n",
"lineCallout.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n#include \x3cutil/hud.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nattribute vec2 uv0;\r\n\r\nuniform float lineSize;\r\nuniform vec2 pixelToNDC;\r\nuniform float borderSize;\r\nuniform vec2 screenOffset;\r\n\r\nvarying vec4 coverageSampling;\r\nvarying vec2 lineSizes;\r\n\r\nvoid main(void) {\r\n\r\n  ProjectHUDAux projectAux;\r\n  vec4 endPoint \x3d projectPositionHUD(projectAux);\r\n\r\n  vec3 vpos \x3d projectAux.posModel;\r\n  if (rejectBySlice(vpos)) {\r\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\r\n    return;\r\n  }\r\n\r\n#ifdef OCCL_TEST\r\n  if (!testVisibilityHUD(endPoint)) {\r\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1.0);\r\n    return;\r\n  }\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\r\n  vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\r\n#else\r\n  vec2 screenOffsetScaled \x3d screenOffset;\r\n#endif\r\n\r\n  // Add view dependent polygon offset to get exact same original starting point. This is mostly\r\n  // used to get the correct depth value\r\n  vec3 posView \x3d (view * (model * vec4(position, 1.0))).xyz;\r\n  applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\r\n\r\n  vec4 startPoint \x3d proj * vec4(posView, 1.0);\r\n\r\n  // Apply screen offset to both start and end point\r\n  vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\r\n\r\n  startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\r\n  endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\r\n\r\n  // Align start and end to pixel origin\r\n  vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\r\n  vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\r\n\r\n#ifdef DEPTH_HUD\r\n\r\n#ifdef DEPTH_HUD_ALIGN_START\r\n  endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);\r\n#else\r\n  startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);\r\n#endif\r\n\r\n#endif\r\n\r\n  vec4 projectedPosition \x3d mix(startAligned, endAligned, uv0.y);\r\n\r\n  // The direction of the line in screen space\r\n  vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\r\n  vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\r\n  float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\r\n\r\n#else\r\n\r\n  float lineSizeScaled \x3d lineSize;\r\n  float borderSizeScaled \x3d borderSize;\r\n\r\n#endif\r\n\r\n  float halfPixelSize \x3d lineSizeScaled * 0.5;\r\n  // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\r\n  // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\r\n  // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\r\n  // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\r\n  float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\r\n  float halfPixelSizeInt \x3d floor(halfWholePixelSize);\r\n\r\n  // Sub-pixel offset if we need to grow sub-pixels to the left\r\n  float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\r\n\r\n  // Pixel offset aligning to whole pixels and adding subpixel offset if needed\r\n  float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\r\n\r\n  // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\r\n  float padding \x3d 1.0 + borderSizeScaled;\r\n  vec2 ndcOffset \x3d (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\r\n\r\n  // Offset x/y from the center of the line in screen space\r\n  projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\r\n\r\n  // Compute a coverage varying which we can use in the fragment shader to determine\r\n  // how much a pixel is actually covered by the line (i.e. to anti alias the line).\r\n  // This works by computing two coordinates that can be linearly interpolated and then\r\n  // subtracted to find out how far away from the line edge we are.\r\n  float edgeDirection \x3d (uv0.x * 2.0 - 1.0);\r\n\r\n  float halfBorderSize \x3d 0.5 * borderSizeScaled;\r\n  float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\r\n  float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\r\n\r\n  float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\r\n\r\n  coverageSampling \x3d vec4(\r\n    // Edge coordinate\r\n    outerEdgeCoverageSampler,\r\n\r\n    // Border edge coordinate\r\n    outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\r\n\r\n    // Line offset\r\n    halfPixelSize - 0.5,\r\n\r\n    // Border offset\r\n    halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\r\n  );\r\n\r\n  lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\r\n\r\n  gl_Position \x3d projectedPosition;\r\n}\r\n"},
measurementArrow:{"measurementArrow.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform float outlineSize;\r\nuniform vec4 outlineColor;\r\nuniform float stripeLength;\r\nuniform vec4 stripeEvenColor;\r\nuniform vec4 stripeOddColor;\r\n\r\nvarying vec2 vtc;\r\nvarying float vlength;\r\nvarying float vradius;\r\n\r\n#define INV_SQRT2 (1.0 / sqrt(2.0))\r\n\r\nvec4 arrowColor(vec2 tc, float len) {\r\n  float d \x3d INV_SQRT2 * (tc.x - abs(tc.y));\r\n  d \x3d min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\r\n  d \x3d min(d, 1.0 - abs(tc.y));\r\n\r\n  if (d \x3c 0.0) {\r\n    return vec4(0.0);\r\n  } else if (d \x3c outlineSize) {\r\n    return outlineColor;\r\n  } else {\r\n    return fract(0.5 / stripeLength * tc.x * vradius) \x3e\x3d 0.5 ? stripeOddColor : stripeEvenColor;\r\n  }\r\n}\r\n\r\nvoid main(void) {\r\n  vec2 ntc \x3d vec2(vtc.x / vradius, vtc.y);\r\n  vec4 color \x3d arrowColor(ntc, vlength / vradius);\r\n  if (color.a \x3d\x3d 0.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d color;\r\n}\r\n",
"measurementArrow.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nuniform float width;\r\n\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec2 uv0;\r\nattribute float auxpos1;\r\n\r\nvarying vec2 vtc;\r\nvarying float vlength;\r\nvarying float vradius;\r\n\r\nvoid main(void) {\r\n  vec3 bitangent \x3d normal;\r\n\r\n  vtc \x3d uv0;\r\n  vlength \x3d auxpos1;\r\n  vradius \x3d 0.5 * width;\r\n\r\n  vec4 pos \x3d view * vec4((model * vec4(position + vradius * bitangent * uv0.y, 1.0)).xyz, 1.0);\r\n  gl_Position \x3d proj * pos;\r\n}\r\n"},
nativeLine:{"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nuniform vec4 constantColor;\r\n\r\nvarying vec3 vpos;\r\n\r\n#ifdef VERTEXCOLORS\r\nvarying vec4 vcolor;\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n#ifdef VERTEXCOLORS\r\n  gl_FragColor \x3d highlightSlice(vcolor, vpos);\r\n#else\r\n  gl_FragColor \x3d highlightSlice(constantColor, vpos);\r\n#endif\r\n}\r\n","highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n\r\nvarying vec3 vpos;\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n}\r\n",
"nativeLine.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\n\r\n#ifdef VERTEXCOLORS\r\nattribute vec4 color;\r\n#endif\r\n\r\n\r\nvarying vec3 vpos;\r\n\r\n#ifdef VERTEXCOLORS\r\nvarying vec4 vcolor;\r\n#endif\r\n\r\n\r\nvoid main(void) {\r\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\r\n  #ifdef VERTEXCOLORS\r\n    vcolor \x3d color * 0.003921568627451; // \x3d 1/255\r\n  #endif\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n}\r\n"},
pathMaterial:{"colorMixMode.glsl":"#include \x3cutil/color.glsl\x3e\r\n\r\n/*\r\n * The color mix modes are encoded in the symbol color as follows:\r\n *  - Fully transparent symbols are represented with alpha 0 for\r\n *    all color mix modes (except ignore).\r\n *  - color mix mode ignore is encoded as multiply with white\r\n *  - the other 3 color mix modes (tint, replace, multiply) are\r\n *    equally distributed on the remaining 255 alpha values, which\r\n *    gives us 85 possible alpha values\r\n *\r\n * alpha             0 : fully transparent\r\n * alpha in [  1 -  85]: tint\r\n * alpha in [ 86 - 170]: replace\r\n * alpha in [171 - 255]: multiply\r\n */\r\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\r\n  float symbolAlpha \x3d 0.0;\r\n\r\n  const float maxTint \x3d 85.0;\r\n  const float maxReplace \x3d 170.0;\r\n  const float scaleAlpha \x3d 3.0;\r\n\r\n  if (symbolColor.a \x3d\x3d 0.0) {\r\n    colorMixMode \x3d 1; // fully transparent -\x3e multiply\r\n    symbolAlpha \x3d 0.0;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxTint) {\r\n    colorMixMode \x3d 0; // tint\r\n    symbolAlpha \x3d scaleAlpha * symbolColor.a;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxReplace) {\r\n    colorMixMode \x3d 3; // replace\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\r\n  }\r\n  else {\r\n    colorMixMode \x3d 1;  // multiply\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\r\n  }\r\n\r\n  return vec4(symbolColor.rgb, symbolAlpha);\r\n}\r\n\r\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  vec3 internalMixed \x3d internalColor * textureColor;\r\n  vec3 allMixed \x3d internalMixed * externalColor;\r\n\r\n  if (mode \x3d\x3d 1 /* multiply */) {\r\n    return allMixed;\r\n  }\r\n  else if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalColor;\r\n  }\r\n  else {\r\n    // tint (or something invalid)\r\n    vec3 hsvIn \x3d rgb2hsv(internalMixed);\r\n    vec3 hsvTint \x3d rgb2hsv(externalColor);\r\n    vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\r\n    return hsv2rgb(hsvOut);\r\n  }\r\n}\r\n\r\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  float internalMixed \x3d internalOpacity * textureOpacity;\r\n  float allMixed \x3d internalMixed * externalOpacity;\r\n\r\n  if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalOpacity;\r\n  }\r\n  else {\r\n    // multiply or tint (or something invalid)\r\n    return allMixed;\r\n  }\r\n}\r\n",
"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/sceneLighting.glsl\x3e\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\nuniform vec3 camPos;\r\nuniform vec3 localOrigin;\r\n\r\n// material parameters\r\n//////////////////////////////////////////\r\nuniform vec3 ambient;\r\nuniform vec3 diffuse;\r\nuniform vec3 specular;\r\nuniform float opacity;\r\nuniform float layerOpacity;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#else\r\nuniform int colorMixMode;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nuniform sampler2D depthTex;\r\nuniform int shadowMapNum;\r\nuniform vec4 shadowMapDistance;\r\nuniform mat4 shadowMapMatrix[4];\r\nuniform float depthHalfPixelSz;\r\n#endif\r\n\r\n#ifdef RECEIVE_SSAO\r\nuniform sampler2D ssaoTex;\r\nuniform vec4 viewportPixelSz;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\nvarying vec3 vnormal;\r\n// the vertex color variable will contain vvColor and/or vvOpacity or 1,1,1,1\r\nvarying vec4 vcolor; \r\nvarying vec4 vcolorExt;\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#include \x3cutil/shadow.glsl\x3e\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/pathMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/colorMixMode.glsl\x3e\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  vec4 texColor \x3d textureLookup(tex, vtc);\r\n  if (texColor.a \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#else /* TEXTURING */\r\n  vec4 texColor \x3d vec4(1.0);\r\n#endif /* TEXTURING */\r\n\r\n  vec3 viewDir \x3d vpos - camPos;\r\n\r\n  // compute normal\r\n  // TODO: this is not in sync with the normal pass\r\n#ifdef GROUND_NORMAL_SHADING\r\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n  vec3 normal \x3d normalize(vpos + localOrigin);\r\n#else\r\n  vec3 normal \x3d vec3(0.0, 0.0, 1.0);\r\n#endif\r\n#else\r\n#ifdef DOUBLESIDED\r\n  vec3 normal \x3d dot(vnormal, viewDir)\x3e0.0 ? -vnormal : vnormal;\r\n#elif defined(WINDINGORDERDOUBLESIDED)\r\n  vec3 normal \x3d gl_FrontFacing ? vnormal : -vnormal;\r\n#else\r\n  vec3 normal \x3d vnormal;\r\n#endif\r\n  normal \x3d normalize(normal);\r\n#endif\r\n\r\n  // compute ssao\r\n#ifdef RECEIVE_SSAO\r\n  float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n  ssao \x3d viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\r\n#else\r\n  float ssao \x3d 1.0;\r\n#endif\r\n\r\n  // At global scale we create some additional ambient light based on the main light to simulate global illumination\r\n  float additionalAmbientScale;\r\n  vec3 additionalLight \x3d sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\r\n\r\n  // compute shadowing\r\n  float shadow \x3d 0.0;\r\n#ifdef RECEIVE_SHADOWS\r\n  shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n#elif VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n  // at global scale (and in global scenes) we fall back to this approximation\r\n  // to shadow objects on the dark side of the earth\r\n  shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\r\n#endif\r\n\r\n  vec3 matColor \x3d max(ambient, diffuse); // combine the old material parameters into a single one\r\n\r\n  vec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n  albedo_+\x3d 0.25 * specular; // don't completely ignore specular for now\r\n\r\n#ifdef TRANSPARENCY_DISCARD\r\n  if (opacity_ \x3c 0.001) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n  gl_FragColor \x3d vec4(shadedColor, opacity_);\r\n  gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\r\n}\r\n",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\r\n\r\nattribute vec3 position;\r\nattribute vec4 auxpos1; // direction offset\r\n#ifdef COMPRESSED_NORMALS\r\nattribute vec2 normalCompressed;\r\n#else\r\nattribute vec3 normal;\r\n#endif\r\nvarying vec3 vpos;\r\nvarying vec3 vnormal;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#ifdef COMPONENTCOLORS\r\nuniform sampler2D uComponentColorTex;\r\nuniform vec2 uComponentColorTexInvDim;\r\n\r\nattribute float componentIndex;\r\n\r\nvec4 readComponentColor() {\r\n  float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\r\n  vec2 indexCoord \x3d vec2(\r\n    mod(normalizedIndex, 1.0),\r\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\r\n  );\r\n  return texture2D(uComponentColorTex, indexCoord);\r\n}\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#endif\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\nattribute vec4 symbolColor;\r\n#endif\r\n\r\n// Workaround for https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13452\r\n// We pass the externalColor uniform from VS to FS through the vcolorExt varying because\r\n// there is a driver bug for Intel Integrated Graphics which led to rendering artifacts\r\n// since the introduction of https://devtopia.esri.com/WebGIS/arcgis-js-api/pull/12673\r\n// This should be further cleaned up later with through the following issue:\r\n// https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12763\r\nuniform vec4 externalColor;\r\n// the vertex color variable will contain vvColor and/or vvOpacity or 1,1,1,1\r\nvarying vec4 vcolor;\r\nvarying vec4 vcolorExt;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_SIZE) || defined(VV_COLOR) || defined(VV_OPACITY)\r\nattribute vec4 auxpos2;\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/pathMaterial/localNormal.glsl\x3e\r\n#include \x3cmaterials/pathMaterial/colorMixMode.glsl\x3e\r\n\r\nvoid main() {\r\n  vpos \x3d calculateVPos();\r\n\r\n  vnormal \x3d normalize((modelNormal * localNormal()).xyz);\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\r\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\r\n  // issues on iPad/iPhone with the 'w' component require the depth to be\r\n  // passed as varying to properly drive the cascading shadow map index.\r\n  linearDepth \x3d gl_Position.w;\r\n#endif\r\n\r\n  vcolorExt \x3d externalColor;\r\n\r\n  vcolor \x3d vec4(1.0, 1.0, 1.0, 1.0);\r\n#ifdef VV_COLOR\r\n  vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors);\r\n#endif\r\n#ifdef VV_OPACITY\r\n  // there might be opacity values in vvColor but according to the logic in graphicUtils.mixinColorAndOpacity,\r\n  // this value will be overridden by vvOpacity so we do the same here\r\n  vcolor.a \x3d vvGetOpacity(auxpos2, vvOpacityValues, vvOpacityOpacities);\r\n#endif\r\n\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\n  int symbolColorMixMode;\r\n  vcolorExt *\x3d decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n\r\n#ifdef COMPONENTCOLORS\r\n  int symbolColorMixMode;\r\n  vcolorExt *\x3d decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n  // the v coordinate is stored in auxpos1.w\r\n#ifndef FLIPV\r\n  vtc \x3d vec2(uv0.x, auxpos1.w);\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-auxpos1.w);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"commonFunctions.glsl":"#include \x3cmaterials/pathMaterial/localPosition.glsl\x3e\r\n#include \x3cutil/doublePrecision.glsl\x3e\r\n\r\nvec3 calculateVPos() {\r\n  return (model * localPosition()).xyz;\r\n}","commonInputs.glsl":"uniform mat4 proj;\r\nuniform mat4 view;\r\n\r\nuniform vec3 camPos;\r\nuniform vec3 localOrigin;\r\n\r\nuniform mat4 model;\r\nuniform mat4 modelNormal;\r\n\r\nuniform float size;\r\n\r\n// ---------------------------------------------- ++","depthPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/depth.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/pathMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  if (textureLookup(tex, vtc).a \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n#ifndef BIAS_SHADOWMAP\r\n  gl_FragColor \x3d float2rgba(depth);\r\n#else\r\n  gl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n#endif\r\n}\r\n",
"depthPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\r\n\r\nuniform vec2 nearFar;\r\nattribute vec3 position;\r\nattribute vec4 auxpos1; // direction offset\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_SIZE)\r\nattribute vec4 auxpos2;\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n  vec4 eye \x3d view * vec4(vpos, 1.0);\r\n\r\n  gl_Position \x3d proj * eye;\r\n  depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"highlightPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/pathMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  if (textureLookup(tex, vtc).a \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n}\r\n",
"highlightPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\r\n\r\nattribute vec3 position;\r\nattribute vec4 auxpos1; // direction offset\r\n\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_SIZE)\r\nattribute vec4 auxpos2;\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"localNormal.glsl":"#include \x3cutil/normalEncoding.glsl\x3e\r\n\r\n# ifdef COMPRESSED_NORMALS\r\nvec4 localNormal() { return vec4(decodeNormal(normalCompressed), 1.0); }\r\n# else\r\nvec4 localNormal() { return vec4(normal, 1.0); }\r\n# endif\r\n","localPosition.glsl":"#ifdef VV_SIZE\r\nvec4 localPosition() {\r\n    vec3 sizeScale \x3d vvGetScale(auxpos2);\r\n    vec3 positionOffset \x3d auxpos1.xyz*sizeScale;\r\n    return vec4( position+positionOffset, 1.0 );\r\n}\r\n#else\r\nvec4 localPosition() {\r\n    vec3 sizeScale \x3d vec3(size);\r\n    vec3 positionOffset \x3d auxpos1.xyz*sizeScale;\r\n    return vec4(position+positionOffset, 1.0);\r\n}\r\n#endif\r\n",
"normalPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/pathMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  if (textureLookup(tex, vtc).a \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  vec3 normal \x3d normalize(vnormal);\r\n  if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n\r\n#ifndef ALPHA_ZERO\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n#else\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n#endif\r\n}\r\n",
"normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/pathMaterial/commonInputs.glsl\x3e\r\n\r\nuniform mat4 viewNormal;\r\nattribute vec3 position;\r\nattribute vec4 auxpos1; // direction offset\r\n#ifdef COMPRESSED_NORMALS\r\nattribute vec2 normalCompressed;\r\n#else\r\nattribute vec3 normal;\r\n#endif\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\n#include \x3cmaterials/pathMaterial/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_SIZE)\r\nattribute vec4 auxpos2;\r\n#endif\r\n\r\n#include \x3cmaterials/pathMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/pathMaterial/localNormal.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n  vnormal \x3d normalize((viewNormal * modelNormal * localNormal()).xyz);\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"texturing.glsl":"float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\r\n  // from:\r\n  //   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\r\n  //   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\r\n  //   - http://www.linedef.com/virtual-texture-demo.html\r\n  float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\r\n  return max(0.0, 0.5 * log2(deltaMaxSqr));\r\n}\r\n\r\nvec4 textureAtlasLookup(sampler2D tex, vec2 uv, vec4 region, vec2 texSize) {\r\n  //[umin, vmin, umax, vmax]\r\n  vec2 atlasScale \x3d region.zw - region.xy;\r\n  vec2 uvAtlas \x3d fract(uv) * atlasScale + region.xy;\r\n\r\n  // calculate derivative of continuous texture coordinate\r\n  // to avoid mipmapping artifacts caused by manual wrapping in shader\r\n  vec2 dUVdx \x3d dFdx(uv) * atlasScale;\r\n  vec2 dUVdy \x3d dFdy(uv) * atlasScale;\r\n\r\n#ifdef GL_EXT_shader_texture_lod\r\n  return texture2DGradEXT(tex, uvAtlas, dUVdx, dUVdy);\r\n#else\r\n  // use bias to compensate for difference in automatic vs desired mipmap level\r\n  vec2 dUVdxAuto \x3d dFdx(uvAtlas);\r\n  vec2 dUVdyAuto \x3d dFdy(uvAtlas);\r\n  float mipMapLevel \x3d calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\r\n  float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\r\n\r\n  return texture2D(tex, uvAtlas, mipMapLevel - autoMipMapLevel);\r\n#endif\r\n}\r\n\r\nvec4 textureLookup(sampler2D tex, vec2 uv) {\r\n#ifdef TEXTURE_ATLAS\r\n  return textureAtlasLookup(tex, uv, regionV, texSize);\r\n#else\r\n  return texture2D(tex, uv);\r\n#endif\r\n}\r\n\r\n",
"visualVariables.glsl":"\r\n#if defined(VV_SIZE)\r\n  uniform vec3 vvSizeMinSize;\r\n  uniform vec3 vvSizeMaxSize;\r\n  uniform vec3 vvSizeOffset;\r\n  uniform vec3 vvSizeFactor;\r\n\r\n  vec3 vvGetScale(vec4 featureAttribute) {\r\n    // the 0.5 factor comes from the fact that the generated profiles have radius of 1\r\n    // but the old implementation of the Graphics3DPathSymbolLayer actually had a profile radius of 0.5\r\n    // for constant size values the 0.5 is applied in Graphcis3DPathSymbolLayer when setting material parms\r\n    // we might want to change the path geometry generation so that it produces profile radius of 0.5 too\r\n    return clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize)*0.5;\r\n  }\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  #define VV_COLOR_N 8\r\n  uniform float vvColorValues[VV_COLOR_N];\r\n  uniform vec4 vvColorColors[VV_COLOR_N];\r\n\r\n  vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\r\n    float value \x3d featureAttribute.y;\r\n    if (value \x3c\x3d values[0]) {\r\n      return colors[0];\r\n    }\r\n\r\n    for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n      if (values[i] \x3e\x3d value) {\r\n        float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\r\n        return mix(colors[i-1], colors[i], f);\r\n      }\r\n    }\r\n\r\n    return colors[VV_COLOR_N - 1];\r\n  }\r\n#endif\r\n\r\n\r\n#ifdef VV_OPACITY\r\n  #define VV_OPACITY_N 8\r\n  uniform float vvOpacityValues[VV_OPACITY_N];\r\n  uniform float vvOpacityOpacities[VV_OPACITY_N];\r\n\r\n  float vvGetOpacity(vec4 featureAttribute, float values[VV_OPACITY_N], float opacities[VV_OPACITY_N]) {\r\n    float value \x3d featureAttribute.z;\r\n    if (value \x3c\x3d values[0]) {\r\n      return opacities[0];\r\n    }\r\n\r\n    for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\r\n      if (values[i] \x3e\x3d value) {\r\n        float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\r\n        return mix(opacities[i-1], opacities[i], f);\r\n      }\r\n    }\r\n\r\n    return opacities[VV_OPACITY_N - 1];\r\n  }\r\n#endif\r\n\r\n"},
ribbonLine:{"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nuniform vec4 eColor;\r\nvarying vec4 vColor;\r\nvarying vec2 vtc;\r\nvarying vec3 vpos;\r\n\r\n#ifdef STIPPLE\r\nuniform float stippleLengthDoubleInv;\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef STIPPLE\r\n  if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  gl_FragColor \x3d highlightSlice(eColor * vColor, vpos);\r\n}\r\n",
"highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying vec2 vtc;\r\nvarying vec3 vpos;\r\n\r\n#ifdef STIPPLE\r\nuniform float stippleLengthDoubleInv;\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef STIPPLE\r\n  if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\r\n}\r\n","ribbonLine.vert":'#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nuniform float extLineWidth;\r\nuniform float nearPlane;\r\nuniform float pixelRatio;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\nattribute vec4 color;\r\n\r\nvarying vec2 vtc;\r\nvarying vec4 vColor;\r\nvarying vec3 vpos;\r\n\r\nattribute float size;\r\n\r\n#ifndef WALL\r\nuniform float miterLimit;\r\nattribute vec3 auxpos1;\r\nattribute vec3 auxpos2;\r\n#endif\r\n\r\n#ifdef SCREENSCALE\r\nuniform vec2 screenSize;\r\n\r\nvec4 toScreenCoords(vec3 vertex) {\r\n  vec4 vClipSpace \x3d proj * view * vec4((model * vec4(vertex, 1.0)).xyz, 1.0);\r\n  vClipSpace.xy *\x3d screenSize;\r\n  return vClipSpace/abs(vClipSpace.w);\r\n}\r\n\r\n#define VECTYPE vec2\r\n#define ZEROVEC vec2(0.0, 0.0)\r\n#define PERPENDICULAR(v) vec2(v.y, -v.x);\r\n#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y \x3e 0.0\r\n\r\n#else //ifdef SCREENSCALE\r\n\r\n#define VECTYPE vec3\r\n#define ZEROVEC vec3(0.0, 0.0, 0.0)\r\n// these macros are only valid for "strip" type lines:\r\n#define PERPENDICULAR(v) cross(up/*vec3(0.0, 1.0, 0.0)*/, v)\r\n#define ISOUTSIDE dot(cross(left, right), up/*vec3(0.0, 1.0, 0.0)*/)*uv0.y \x3c 0.0\r\n\r\n#endif //ifdef SCREENSCALE\r\n\r\nfloat interp(float ncp, vec4 a, vec4 b) {\r\n  return (-ncp - a.z) / (b.z - a.z);\r\n}\r\n\r\n#ifdef SCREENSCALE\r\n\r\nvoid clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next) {\r\n  float vnp \x3d nearPlane*0.99;\r\n\r\n  //We have four vertices per point on the line. Start and end vertices\r\n  //are treated differently --\x3e d \x3e 0, d \x3c 0\r\n  float d \x3d abs(uv0.y) - 1.1;\r\n\r\n  //current pos behind ncp --\x3e we need to clip\r\n  if(pos.z \x3e -nearPlane) {\r\n    if (d \x3c 0.0) {\r\n      //previous in front of ncp\r\n      if(prev.z \x3c -nearPlane) {\r\n        pos \x3d mix(prev, pos, interp(vnp, prev, pos));\r\n        next \x3d pos;\r\n      } else {\r\n        pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\r\n      }\r\n    }\r\n    //next in front of ncp\r\n    if(d \x3e 0.0) {\r\n      if(next.z \x3c -nearPlane) {\r\n        pos \x3d mix(pos, next, interp(vnp, pos, next));\r\n        prev \x3d pos;\r\n      } else {\r\n        pos \x3d vec4(0.0, 0.0, 0.0, 1.0);\r\n      }\r\n    }\r\n  } else {\r\n    //current position visible\r\n    //previous behind ncp\r\n    if (prev.z \x3e -nearPlane) {\r\n      prev \x3d mix(pos, prev, interp(vnp, pos, prev));\r\n    }\r\n    //next behind ncp\r\n    if (next.z \x3e -nearPlane) {\r\n      next \x3d mix(next, pos, interp(vnp, next, pos));\r\n    }\r\n  }\r\n\r\n  pos\x3d proj * pos;\r\n  pos.xy *\x3d screenSize;\r\n  pos /\x3d pos.w;\r\n\r\n  next \x3d proj * next;\r\n  next.xy *\x3d screenSize;\r\n  next /\x3d next.w;\r\n\r\n  prev \x3d proj * prev;\r\n  prev.xy *\x3d screenSize;\r\n  prev /\x3d prev.w;\r\n}\r\n\r\n#endif // SCREENSCALE\r\n\r\nvoid main(void) {\r\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\r\n\r\n#ifdef SCREENSCALE\r\n// Check for special value of uv0.y which is used by the Renderer when graphics\r\n// are removed before the VBO is recompacted. If this is the case, then we just\r\n// project outside of clip space.\r\nif (uv0.y \x3d\x3d 0.0) {\r\n  // Project out of clip space\r\n  gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n}\r\nelse {\r\n#endif\r\n\r\nfloat lineWidth \x3d (extLineWidth + size) * pixelRatio;\r\n\r\n#ifdef SCREENSCALE\r\n\r\n#if 0\r\n  vec4 pos \x3d toScreenCoords(position.xyz);\r\n  vec2 left \x3d (pos - toScreenCoords(auxpos1)).xy;\r\n  vec2 right \x3d (toScreenCoords(auxpos2) - pos).xy;\r\n#else\r\n  vec4 pos  \x3d view * vec4((model * vec4(position.xyz, 1.0)).xyz, 1.0);\r\n  vec4 prev \x3d view * vec4((model * vec4(auxpos1.xyz, 1.0)).xyz, 1.0);\r\n  vec4 next \x3d view * vec4((model * vec4(auxpos2.xyz, 1.0)).xyz, 1.0);\r\n\r\n  clipAndTransform(pos, prev, next);\r\n\r\n  vec2 left \x3d (pos - prev).xy;\r\n  vec2 right \x3d (next - pos).xy;\r\n#endif\r\n\r\n#else // ifdef SCREENSCALE\r\n  vec4 pos \x3d vec4(position, 1.0);\r\n#ifndef WALL\r\n  vec3 left \x3d position.xyz - auxpos1;\r\n  vec3 right \x3d auxpos2 - position.xyz;\r\n  vec3 up \x3d normalize(position.xyz);\r\n#endif // ifndef WALL\r\n#endif // ifdef SCREENSCALE\r\n\r\n#ifdef WALL\r\n  float displacementLen \x3d lineWidth;\r\n  vec3 displacementDir \x3d normalize(position.xyz);//vec3(0.0, 1.0, 0.0);\r\n#else // ifdef WALL\r\n\r\n  float leftLen \x3d length(left);\r\n  left \x3d (leftLen \x3e 0.001) ? left/leftLen : ZEROVEC;\r\n\r\n  float rightLen \x3d length(right);\r\n  right \x3d (rightLen \x3e 0.001) ? right/rightLen : ZEROVEC;\r\n\r\n  // determine if vertex is on the "outside or "inside" of the join\r\n  bool isOutside \x3d ISOUTSIDE;\r\n\r\n  // compute miter join position first\r\n  float displacementLen \x3d lineWidth;\r\n  VECTYPE displacementDir \x3d normalize(left + right);\r\n  displacementDir \x3d PERPENDICULAR(displacementDir);\r\n  if (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\r\n    float nDotSeg \x3d dot(displacementDir, left);\r\n    displacementLen /\x3d length(nDotSeg*left - displacementDir);\r\n\r\n    // limit displacement of inner vertices\r\n    if (!isOutside) {\r\n      displacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\r\n    }\r\n  }\r\n\r\n  if (isOutside \x26\x26 (displacementLen \x3e miterLimit*lineWidth)) {\r\n    // convert to bevel join if miterLimit is exceeded\r\n    if (leftLen \x3c 0.001) {\r\n      displacementDir \x3d right;\r\n    }\r\n    else if (rightLen \x3c 0.001) {\r\n      displacementDir \x3d left;\r\n    }\r\n    else {\r\n      displacementDir \x3d (abs(uv0.y) - 1.1 \x3c 0.0) ? left : right;\r\n    }\r\n    displacementDir \x3d normalize(displacementDir);\r\n    displacementDir \x3d PERPENDICULAR(displacementDir);\r\n    displacementLen \x3d lineWidth;\r\n  }\r\n\r\n#endif // ifdef WALL\r\n\r\n#ifdef SCREENSCALE\r\n  pos.xy +\x3d displacementDir * floor(uv0.y + 0.5) * displacementLen;\r\n  pos.xy /\x3d screenSize;\r\n#else\r\n  pos.xyz +\x3d displacementDir * floor(uv0.y + 0.5) * displacementLen;\r\n  pos \x3d proj * view * model * pos;\r\n#endif\r\n\r\n  vtc \x3d uv0;\r\n  vColor \x3d color * 0.003921568627451; // \x3d 1/255\r\n  gl_Position \x3d pos;\r\n\r\n#ifdef SCREENSCALE\r\n  }\r\n#endif\r\n}\r\n'},
slicePlane:{"slicePlane.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec4 backgroundColor;\r\nuniform vec4 gridColor;\r\nuniform float ratio;\r\nuniform float gridWidth;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main() {\r\n  const float LINE_WIDTH \x3d 1.0;\r\n\r\n  vec2 uvScaled \x3d vUV * gridWidth;\r\n  vec2 gridUV \x3d (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));\r\n  vec2 grid \x3d (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);\r\n\r\n  // mask aliasing along edges\r\n  grid.x *\x3d step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);\r\n  grid.y *\x3d step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);\r\n\r\n  float gridFade \x3d max(grid.x, grid.y);\r\n\r\n  float gridAlpha \x3d gridColor.a * gridFade;\r\n\r\n  // premultiply alpha in output\r\n  gl_FragColor \x3d\r\n    vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +\r\n    vec4(gridColor.rgb, 1.0) * gridAlpha;\r\n}\r\n",
"slicePlane.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main(void) {\r\n  vUV \x3d uv0;\r\n  gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\r\n}\r\n"}},misc:{"blendLayers.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec2 uv;\r\n\r\nuniform sampler2D tex;\r\nuniform float opacity;\r\n\r\nvoid main() {\r\n  vec4 color \x3d texture2D(tex, uv);\r\n\r\n  // Note: output in pre-multiplied alpha for correct alpha compositing\r\n  gl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\r\n}\r\n",
"blendLayers.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nuniform float scale;\r\nuniform vec2 offset;\r\n\r\nvarying vec2 uv;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(position, 1.0);\r\n  uv \x3d uv0 * scale + offset;;\r\n}\r\n","texOnly.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\nuniform vec4 color;\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n  vec4 texColor \x3d texture2D(tex, vtc);\r\n  gl_FragColor \x3d texColor * color;\r\n}\r\n",
"texOnly.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec2 vtc;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(position, 1.0);\r\n  vtc \x3d uv0;\r\n}\r\n"},pointRenderer:{"pointRenderer.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n\r\n#ifdef DEPTH_PASS\r\nvarying float depth;\r\n#else\r\nvarying vec3 vColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n  vec2 vOffset \x3d gl_PointCoord - vec2(0.5, 0.5);\r\n  float r2 \x3d dot(vOffset, vOffset);\r\n\r\n  if (r2 \x3e 0.25) {\r\n    discard;\r\n  }\r\n\r\n#ifdef DEPTH_PASS\r\n  gl_FragColor \x3d float2rgba(depth);\r\n#else\r\n  gl_FragColor \x3d vec4(vColor, 1.0);\r\n#endif\r\n}\r\n",
"pointRenderer.vert":"#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec3 aPosition;\r\nattribute vec3 aColor;\r\n\r\nuniform mat4 uModelViewMatrix;\r\nuniform mat4 uProjectionMatrix;\r\nuniform vec2 uScreenMinMaxSize;\r\nuniform vec2 uPointScale;\r\nuniform vec3 uClipMin;\r\nuniform vec3 uClipMax;\r\n\r\n#ifdef DEPTH_PASS\r\nuniform vec2 nearFar;\r\n\r\nvarying float depth;\r\n#else\r\nvarying vec3 vColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n  // Move clipped points outside of clipspace\r\n  if (aPosition.x \x3c uClipMin.x || aPosition.y \x3c uClipMin.y || aPosition.z \x3c uClipMin.z ||\r\n      aPosition.x \x3e uClipMax.x || aPosition.y \x3e uClipMax.y || aPosition.z \x3e uClipMax.z) {\r\n    gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\r\n    gl_PointSize \x3d 0.0;\r\n    return;\r\n  }\r\n\r\n  if (rejectBySlice(aPosition)) {\r\n    gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\r\n    gl_PointSize \x3d 0.0;\r\n    return;\r\n  }\r\n\r\n  // Position in camera space\r\n  vec4 camera \x3d uModelViewMatrix * vec4(aPosition, 1.0);\r\n\r\n  float pointSize \x3d uPointScale.x;\r\n  vec4 position \x3d uProjectionMatrix * camera;\r\n\r\n  // Calculate Size\r\n#ifdef DRAW_SCREEN_SIZE\r\n    float clampedScreenSize \x3d pointSize;\r\n#else\r\n    float pointRadius \x3d 0.5 * pointSize;\r\n    vec4 cameraOffset \x3d camera + vec4(0.0, pointRadius, 0.0, 0.0);\r\n    vec4 positionOffset \x3d uProjectionMatrix * cameraOffset;\r\n    float radius \x3d abs(positionOffset.y - position.y);\r\n\r\n    float viewHeight \x3d uPointScale.y;\r\n\r\n    // screen diameter \x3d (2 * r / w) * (h / 2)\r\n    float screenPointSize \x3d (radius / position.w) * viewHeight;\r\n    float clampedScreenSize \x3d clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\r\n\r\n    // Shift towards camera, to move rendered point out of terrain i.e. to\r\n    // the camera-facing end of the virtual point when considering it as a\r\n    // 3D sphere.\r\n    camera.xyz -\x3d normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\r\n    position \x3d uProjectionMatrix * camera;\r\n#endif\r\n\r\n  gl_PointSize \x3d clampedScreenSize;\r\n  gl_Position \x3d position;\r\n\r\n#ifdef DEPTH_PASS\r\n  depth \x3d (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\r\n#else\r\n  vColor \x3d aColor;\r\n#endif\r\n}\r\n"},
renderer:{highlight:{"apply.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n// Merging blurred outlines with source image, advanced version\r\n\r\n// Defines:\r\n// GRID_OPTIMIZATION (set or !set)\r\n// GRID_DEBUG (set or !set)\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\nuniform sampler2D tex;\r\nuniform sampler2D origin;\r\n\r\nuniform vec4 color;\r\nuniform float outlineSize;\r\nuniform float blurSize;\r\nuniform vec4 opacities; // [outline, outlineOccluded, fill, fillOccluded]\r\n\r\nvarying vec2 uv;\r\n\r\nvoid main() {\r\n  #if defined(GRID_OPTIMIZATION) \x26\x26 defined(GRID_DEBUG)\r\n    gl_FragColor \x3d vec4(uv, 0.0, 1.0);\r\n  #else\r\n    // Read the highlight intensity from the blurred highlight image\r\n    vec4 blurredHighlightValue \x3d texture2D(tex, uv);\r\n    float highlightIntensity \x3d blurredHighlightValue.a;\r\n\r\n    // Discard all pixels which are not affected by highlight\r\n    if (highlightIntensity \x3d\x3d 0.0) {\r\n      discard;\r\n    }\r\n\r\n    vec4 origin_color \x3d texture2D(origin, uv);\r\n\r\n    float outlineIntensity;\r\n    float fillIntensity;\r\n\r\n    // if occluded\r\n    if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\r\n      outlineIntensity \x3d color.w * opacities[1];\r\n      fillIntensity \x3d color.w * opacities[3];\r\n    }\r\n    // if unoccluded\r\n    else {\r\n      outlineIntensity \x3d color.w * opacities[0];\r\n      fillIntensity \x3d color.w * opacities[2];\r\n    }\r\n\r\n    float inner \x3d 1.0 - outlineSize / 9.0;\r\n    float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\r\n\r\n    float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\r\n    //float fillFactor \x3d smoothstep(0.6, 0.72, highlightIntensity);\r\n    float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\r\n    float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\r\n\r\n    // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n    // I.e., color should not be premultiplied with alpha\r\n    gl_FragColor \x3d vec4(color.xyz, intensity);\r\n  #endif\r\n}\r\n",
"apply.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nvarying vec2 uv;\r\n\r\n#ifdef GRID_OPTIMIZATION\r\n  attribute vec2 uv0;\r\n  uniform sampler2D coverageTex;\r\n#endif\r\n\r\nvoid main() {\r\n  #ifdef GRID_OPTIMIZATION\r\n    #ifdef GRID_DEBUG\r\n      vec4 cov \x3d texture2D(coverageTex, uv0);\r\n      // if no highlight pixel set in this block,\r\n      // or all pixels set, hide block\r\n      if (cov.r \x3d\x3d 0.0 || cov.g \x3d\x3d 1.0 || cov.b \x3d\x3d 1.0) {\r\n        gl_Position \x3d vec4(0.0);\r\n        return;\r\n      }\r\n      gl_Position \x3d vec4(position, .0, 1.0);\r\n      uv \x3d uv0;\r\n      return;\r\n    #else\r\n      vec4 cov \x3d texture2D(coverageTex, uv0);\r\n      // if no highlight pixel set in this block, hide block\r\n      if (cov.r \x3d\x3d 0.0) {\r\n        gl_Position \x3d vec4(0.0);\r\n        return;\r\n      }\r\n    #endif\r\n  #endif\r\n\r\n  gl_Position \x3d vec4(position, .0, 1.0);\r\n  uv \x3d position.xy * .5 + vec2(.5);\r\n}\r\n",
"blur.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n// Gaussian blur with linear sampling. Supports different number of samples, but\r\n// only 5 samples have proper weights. Uses linear texture interpolation to reduce\r\n// the number of samples taken.\r\n\r\n// Defines:\r\n// GRID_OPTIMIZATION (set or !set)\r\n// GAUSSIAN_SAMPLES (3,5,7)\r\n\r\n// This technique requires linear filtering on source texture\r\n// http://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\nuniform sampler2D tex;\r\n\r\n#ifdef GRID_OPTIMIZATION\r\n  uniform vec2 blurSize;\r\n  varying vec3 blurCoordinate;\r\n#else\r\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\r\n#endif\r\n\r\nvoid main() {\r\n  #ifdef GRID_OPTIMIZATION\r\n    vec2 uv \x3d blurCoordinate.xy;\r\n    vec4 center \x3d texture2D(tex, uv);\r\n\r\n    // do not blur if no pixel or all pixels in neighborhood are set\r\n    if (blurCoordinate.z \x3d\x3d 1.0) {\r\n      gl_FragColor \x3d center;\r\n    }\r\n    else {\r\n      vec4 sum \x3d vec4(0.0);\r\n\r\n      #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n        // not proper gaussian weights\r\n        sum +\x3d center * 0.204164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n        sum +\x3d center * 0.204164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n        // not proper gaussian weights\r\n        sum +\x3d center * 0.204164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 5.1) * 0.03;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 5.1) * 0.03;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n        // not proper gaussian weights\r\n        sum +\x3d center * 0.154164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.5) * 0.204005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.5) * 0.204005;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 3.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 3.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 5.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 5.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 7.5) * 0.05;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 7.5) * 0.05;\r\n      #endif\r\n\r\n      gl_FragColor \x3d sum;\r\n    }\r\n  #else\r\n    vec4 sum \x3d vec4(0.0);\r\n\r\n    #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n      // not proper gaussian weights\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n      // not proper gaussian weights\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.03;\r\n      sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.03;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n      // not proper gaussian weights\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.154164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.204005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.204005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.123913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.123913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.09;\r\n      sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.09;\r\n      sum +\x3d texture2D(tex, blurCoordinates[7]) * 0.05;\r\n      sum +\x3d texture2D(tex, blurCoordinates[8]) * 0.05;\r\n    #endif\r\n\r\n    gl_FragColor \x3d sum;\r\n  #endif\r\n}\r\n",
"blur.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nattribute vec2 uv0;\r\n\r\n#ifdef GRID_OPTIMIZATION\r\n  uniform sampler2D coverageTex;\r\n  varying vec3 blurCoordinate;\r\n#else\r\n  uniform vec2 blurSize;\r\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\r\n#endif\r\n\r\nvoid main() {\r\n  gl_Position \x3d vec4(position, 0.0, 1.0);\r\n\r\n  #ifdef GRID_OPTIMIZATION\r\n    // sample the coverage texture at the block center\r\n    // and if no coverage detected, create degenerate triangle\r\n    vec4 cov \x3d texture2D(coverageTex, uv0);\r\n    if (cov.r \x3d\x3d 0.0) {\r\n      gl_Position \x3d vec4(0.0);\r\n    }\r\n\r\n    // create texture coordinate for blur center\r\n    // encode information about fully inside block in z coordinate\r\n    blurCoordinate \x3d vec3(gl_Position.xy * .5 + vec2(.5), max(cov.g, cov.b));\r\n  #else\r\n    vec2 uv \x3d position.xy * .5 + vec2(.5);\r\n\r\n    #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n      // not proper gaussian weights\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n      // not proper gaussian weights\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n      blurCoordinates[5] \x3d uv + blurSize * 5.1;\r\n      blurCoordinates[6] \x3d uv - blurSize * 5.1;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n      // not proper gaussian weights\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n      blurCoordinates[5] \x3d uv + blurSize * 5.1;\r\n      blurCoordinates[6] \x3d uv - blurSize * 5.1;\r\n      blurCoordinates[7] \x3d uv + blurSize * 7.1;\r\n      blurCoordinates[8] \x3d uv - blurSize * 7.1;\r\n    #endif\r\n  #endif\r\n}\r\n",
"downsample.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n// Smartly downsamples a texture, halfing its resolution. This allows for a square\r\n// screen region to check if none, any or all pixels were set.\r\n\r\n// The red channel is always ceiled after interpolating the 4 merged pixels.\r\n// This allows to evaluate:\r\n// any(pixels.red !\x3d 0.0) as red \x3d\x3d 1.0\r\n// none(pixels.red !\x3d 0.0) as red \x3d\x3d 0.0\r\n\r\n// The green and blue channels are set to floor(max(green, blue)).\r\n// This allows to evaluate:\r\n// all(pixels.green || pixels.blue) as green \x3d\x3d 1.0\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\nuniform sampler2D tex;\r\nuniform vec2 invFramebufferDim;\r\n\r\nvoid main() {\r\n  vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\r\n  vec4 value \x3d texture2D(tex, coord);\r\n  float mx \x3d floor(max(value.g, value.b));\r\n  gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\r\n}\r\n",
"downsample.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\n\r\nvoid main() {\r\n  gl_Position \x3d vec4(vec2(1.0) - position * 2.0, .0, 1.0);\r\n}\r\n"},laserLine:{"laserLine.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/depth.glsl\x3e\r\n\r\n//--------------------------------------------------------------------------\r\n// Uniforms\r\n//--------------------------------------------------------------------------\r\n\r\nuniform sampler2D depthMap;\r\n\r\nuniform vec2 nearFar;\r\nuniform vec4 projInfo;\r\nuniform vec2 zScale;\r\nuniform float maxPixelDistance;\r\n\r\n// focus plane in camera space\r\nuniform vec4 focusPlane;\r\n\r\n// focus sphere in camera space\r\nuniform vec4 focusSphere;\r\n\r\n// segment plane in camera space\r\nuniform vec4 segmentPlane;\r\n\r\n// line segment\r\nuniform vec3 segmentStart;\r\nuniform vec3 segmentEnd;\r\n\r\n// styling\r\nuniform vec3 glowColor;\r\nuniform float glowWidth;\r\nuniform vec3 innerColor;\r\nuniform float innerWidth;\r\nuniform float globalAlpha;\r\n\r\n//--------------------------------------------------------------------------\r\n// Inputs\r\n//--------------------------------------------------------------------------\r\n\r\nvarying vec2 uv;\r\n\r\n//--------------------------------------------------------------------------\r\n// Defines\r\n//--------------------------------------------------------------------------\r\n\r\n#define INFINITY 100000.0\r\n\r\n// reconstruct position in view space\r\nvec3 reconstructPosition(vec2 fragCoord, float depth) {\r\n  return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\r\n}\r\n\r\nfloat planeDistancePixels(vec4 plane, vec3 pos) {\r\n  // compute distance to plane\r\n  float dist \x3d dot(plane.xyz, pos) + plane.w;\r\n  // compute derivative of distance function with respect to pixels\r\n  float width \x3d fwidth(dist);\r\n  // normalize distance by the derivative to get a measurement with respect to pixels\r\n  // the clamping is used to prevent excessive artifacts along depth discontinuities\r\n  dist /\x3d min(width, maxPixelDistance);\r\n  return abs(dist);\r\n}\r\n\r\nfloat sphereDistancePixels(vec4 sphere, vec3 pos) {\r\n  // compute distance to sphere\r\n  float dist \x3d distance(sphere.xyz, pos) - sphere.w;\r\n  // compute derivative of distance function with respect to pixels\r\n  float width \x3d fwidth(dist);\r\n  // normalize distance by the derivative to get a measurement with respect to pixels\r\n  // the clamping is used to prevent excessive artifacts along depth discontinuities\r\n  dist /\x3d min(width, maxPixelDistance);\r\n  return abs(dist);\r\n}\r\n\r\nvec4 blendPremultiplied(vec4 source, vec4 dest) {\r\n  float oneMinusSourceAlpha \x3d 1.0 - source.a;\r\n\r\n  return vec4(\r\n    source.rgb + dest.rgb * oneMinusSourceAlpha,\r\n    source.a + dest.a * oneMinusSourceAlpha\r\n  );\r\n}\r\n\r\nvec4 premultipliedColor(vec3 rgb, float alpha) {\r\n  return vec4(rgb * alpha, alpha);\r\n}\r\n\r\n// computes laser line color based on distance in pixels\r\nvec4 laserLineProfile(float dist) {\r\n  if (dist \x3e glowWidth) {\r\n    return vec4(0.0);\r\n  }\r\n\r\n  float innerAlpha \x3d (1.0 - smoothstep(0.0, innerWidth, dist));\r\n  float glowAlpha \x3d pow(max(0.0, 1.0 - dist / glowWidth), 8.0);\r\n\r\n  return blendPremultiplied(\r\n    premultipliedColor(innerColor, innerAlpha),\r\n    premultipliedColor(glowColor, glowAlpha)\r\n  );\r\n}\r\n\r\nvoid main() {\r\n  // do not draw laserline on background\r\n  float depth \x3d linearDepth(depthMap, uv, nearFar);\r\n  if (-depth \x3d\x3d nearFar[0]) {\r\n    discard;\r\n  }\r\n\r\n  // reconstruct position in view space\r\n  vec3 pos \x3d reconstructPosition(gl_FragCoord.xy, depth);\r\n\r\n  // empirical hack to fade out laser line in problematic areas:\r\n  // the derivatives to normalize the distance function are valid inside smooth surfaces,\r\n  // but break down at depth discontinuities (e.g. edges). We fade out the laser lines in\r\n  // areas where depth valus have large variations in order to avoid this problem.\r\n  float ddepth \x3d fwidth(depth);\r\n  float depthDiscontinuityAlpha \x3d 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\r\n\r\n  // reconstruct normal using derivatives\r\n  vec3 normal \x3d normalize(cross(dFdx(pos), dFdy(pos)));\r\n\r\n  // distance to focus plane\r\n  float focusPlaneDistance \x3d planeDistancePixels(focusPlane, pos);\r\n\r\n  // distance to focus sphere\r\n  float focusSphereDistance \x3d sphereDistancePixels(focusSphere, pos);\r\n\r\n  // distance to segment plane\r\n  float segmentDistance \x3d INFINITY;\r\n  float segmentLength \x3d length(segmentEnd - segmentStart);\r\n  vec3 segmentDir \x3d (segmentEnd - segmentStart) / segmentLength;\r\n  float t \x3d dot(segmentDir, pos - segmentStart);\r\n\r\n  if (segmentLength \x3e 0.0 \x26\x26 t \x3e\x3d 0.0 \x26\x26 t \x3c\x3d segmentLength) {\r\n    segmentDistance \x3d planeDistancePixels(segmentPlane, pos);\r\n  }\r\n\r\n  // evaluate color profile for both planes and the sphere\r\n  vec4 focusPlaneColor \x3d laserLineProfile(focusPlaneDistance);\r\n  vec4 focusSphereColor \x3d laserLineProfile(focusSphereDistance);\r\n  vec4 segmentColor \x3d laserLineProfile(segmentDistance);\r\n\r\n  // empirical hack to fade out laser line when planes are nearly parallel\r\n  float focusPlaneAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, focusPlane.xyz)));\r\n  float focusSphereAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, normalize(pos - focusSphere.xyz))));\r\n  float segmentAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, segmentPlane.xyz)));\r\n\r\n  // combine colors\r\n  vec4 color \x3d max(\r\n    focusPlaneColor * focusPlaneAlpha,\r\n    max(\r\n      focusSphereColor * focusSphereAlpha,\r\n      segmentColor * segmentAlpha\r\n    )\r\n  );\r\n\r\n  gl_FragColor \x3d color * globalAlpha * depthDiscontinuityAlpha;\r\n}\r\n"},
offscreen:{"composite.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\n\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d texture2D(tex, vtc);\r\n}\r\n","compositeOccluded.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D occludedColorMap;\r\nuniform float opacity;\r\n\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n  vec4 occludedColor \x3d texture2D(occludedColorMap, vtc);\r\n  gl_FragColor \x3d occludedColor * opacity;\r\n}\r\n","compositeTransparentToHUDVisibility.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\n\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d vec4(1.0 - texture2D(tex, vtc).a);\r\n}\r\n",
"offscreen.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nvarying vec2 vtc;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(position.xy, 0.0, 1.0);\r\n  vtc \x3d position.xy * 0.5 + 0.5;\r\n}\r\n"},ssao:{"blur.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/depth.glsl\x3e\r\n\r\n#ifndef RADIUS\r\n#define RADIUS 4\r\n#endif\r\n\r\nuniform sampler2D normalMap;\r\nuniform sampler2D depthMap;\r\nuniform sampler2D tex;\r\n\r\nuniform vec2 blurSize;\r\n\r\nuniform float g_BlurFalloff;\r\nuniform float projScale;\r\n\r\nuniform vec2 nearFar;\r\n//set z scaling, used to prevent division in ortho mode\r\nuniform vec2 zScale;\r\n\r\nvarying vec2 uv;\r\n\r\nfloat BlurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\r\n  float c \x3d texture2D(tex, uv).r;\r\n  float d \x3d linearDepth(depthMap, uv, nearFar);\r\n\r\n  float ddiff \x3d d - center_d;\r\n\r\n  float w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\r\n\r\n  w_total +\x3d w;\r\n\r\n  return w*c;\r\n}\r\n\r\nvoid main(void) {\r\n  float b \x3d 0.0;\r\n  float w_total \x3d 0.0;\r\n\r\n  float center_d \x3d linearDepth(depthMap, uv, nearFar);\r\n\r\n  float sharpness \x3d -0.05 * projScale/(center_d*zScale.x+zScale.y);\r\n  for (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r) {\r\n    float rf \x3d float(r);\r\n    vec2 uvOffset \x3d uv + rf*blurSize;\r\n    b +\x3d BlurFunction(uvOffset, rf, center_d, w_total, sharpness);\r\n  }\r\n\r\n  gl_FragColor \x3d vec4(b/w_total);\r\n}\r\n",
"ssao.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/depth.glsl\x3e\r\n\r\n#ifndef SAMPLES\r\n#define SAMPLES 4\r\n#endif\r\n\r\nuniform mat4 projMatrixInv;\r\n\r\nuniform sampler2D normalMap;\r\nuniform sampler2D depthMap;\r\n\r\nuniform float intensity;\r\n\r\nuniform float projScale;\r\nuniform float radius;\r\nuniform vec2 nearFar;\r\nuniform vec4 projInfo;\r\nuniform vec2 screenDimensions;\r\n\r\n//noise texture lookup could be replaced with hash function if WebGL gets XOR functionality\r\nuniform vec3 pSphere[SAMPLES]; //tap position\r\nuniform vec2 rnmScale;\r\nuniform sampler2D rnm; //noise texture\r\n\r\n//set z scaling, used to prevent division in ortho mode\r\nuniform vec2 zScale;\r\n\r\nvarying vec2  uv;\r\nvarying vec4  camPos;\r\n\r\nfloat fallOffFunction(float vv, float vn, float bias) {\r\n  float radius2 \x3d radius * radius;\r\n\r\n  // A: From the HPG12 paper\r\n  // Note large epsilon to avoid overdarkening within cracks\r\n  // return float(vv \x3c radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\r\n\r\n  // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\r\n  float f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\r\n\r\n  // C: Medium contrast (which looks better at high radii), no division.  Note that the\r\n  // contribution still falls off with radius^2, but we've adjusted the rate in a way that is\r\n  // more computationally efficient and happens to be aesthetically pleasing.\r\n  // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\r\n\r\n  // D: Low contrast, no division operation\r\n  // return 2.0 * float(vv \x3c radius * radius) * max(vn - bias, 0.0);\r\n}\r\n\r\n\r\n/** Compute the occlusion due to sample point \\a Q about camera-space point \\a C with unit normal \\a n_C */\r\nfloat aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\r\n  vec3 v \x3d Q - C;\r\n  float vv \x3d dot(v, v);\r\n  float vn \x3d dot(normalize(v), n_C);\r\n  return fallOffFunction(vv, vn, 0.1);\r\n}\r\n\r\n\r\n/**\r\n * Reconstruct camera-space P.xyz from screen-space S \x3d (x, y) in\r\n * pixels and camera-space z \x3c 0.  Assumes that the upper-left pixel center\r\n * is at (0.5, 0.5) [but that need not be the location at which the sample tap\r\n * was placed!]\r\n *\r\n * Costs 3 MADD.  Error is on the order of 10^3 at the far plane, partly due to z precision.\r\n */\r\nvec3 reconstructCSPosition(vec2 S, float z) {\r\n  return vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\r\n}\r\n\r\nvoid main(void) {\r\n  //Hash function used in the HPG12 AlchemyAO paper\r\n  //Not supported in WebGL -\x3e using texture lookup as in old SSAO shader instead\r\n  //ivec2 ssC \x3d ivec2(gl_FragCoord.xy);\r\n  //float randomPatternRotationAngle \x3d float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\r\n  vec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\r\n\r\n  float currentPixelDepth \x3d linearDepth(depthMap, uv, nearFar);\r\n\r\n  if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\r\n    gl_FragColor \x3d vec4(0.0);\r\n    return;\r\n  }\r\n\r\n  vec3 currentPixelPos \x3d reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\r\n\r\n  // get the normal of current fragment\r\n  vec4 norm4 \x3d texture2D(normalMap, uv);\r\n  vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\r\n  bool isTerrain \x3d norm4.w\x3c0.5;\r\n\r\n  float sum \x3d .0;\r\n\r\n  vec4 occluderFragment;\r\n  vec3 ray;\r\n\r\n  vec3 tapPixelPos;\r\n\r\n  // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\r\n  // bug or deviation from CE somewhere else?\r\n  float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\r\n\r\n  for(int i \x3d 0; i \x3c SAMPLES; ++i) {\r\n    // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\r\n    //float ssR;\r\n    //vec2 unitOffset \x3d tapLocation(i, randomPatternRotationAngle, ssR);\r\n    // get the depth of the occluder fragment\r\n    //vec2 offset \x3d vec2(-unitOffset*radius*ssR*ps);\r\n\r\n    vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\r\n    vec2 offset \x3d vec2(-unitOffset*radius*ps);\r\n\r\n    //don't use current or very nearby samples\r\n    if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\r\n\r\n    vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\r\n    if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\r\n    vec2 tcTap \x3d tc/screenDimensions;\r\n    float occluderFragmentDepth \x3d linearDepth(depthMap, tcTap, nearFar);\r\n\r\n    if (isTerrain) {\r\n      bool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\r\n      if (isTerrainTap) {\r\n        continue;\r\n      }\r\n    }\r\n\r\n    tapPixelPos \x3d reconstructCSPosition(tc, occluderFragmentDepth);\r\n\r\n    sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\r\n  }\r\n\r\n  // output the result\r\n\r\n  float A \x3d max(1.0-sum*intensity/float(SAMPLES),0.0);\r\n\r\n  // Anti-tone map to reduce contrast and drag dark region farther\r\n  // (x^0.2 + 1.2 * x^4)/2.2\r\n  A \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\r\n\r\n  //gl_FragColor \x3d vec4(norm/2.0+0.5, 1.0);\r\n  //gl_FragColor \x3d vec4(-currentPixelDepth/1000.0);\r\n  //gl_FragColor \x3d vec4(tapPixelPos.x/100.0);\r\n  gl_FragColor \x3d vec4(A);\r\n}\r\n"}},
terrainRenderer:{"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/sceneLighting.glsl\x3e\r\n#include \x3cutil/screenSizePerspective.glsl\x3e\r\n#include \x3cutil/shadow.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cterrainRenderer/overlay.glsl\x3e\r\n\r\nuniform vec3 lightDirection;\r\nuniform vec3 viewDirection;\r\nuniform sampler2D depthTex;\r\nuniform int shadowMapNum;\r\nuniform vec4 shadowMapDistance;\r\nuniform mat4 shadowMapMatrix[4];\r\nuniform float depthHalfPixelSz;\r\nuniform sampler2D ssaoTex;\r\nuniform vec4 viewportPixelSz;\r\nuniform sampler2D tex;\r\nuniform float opacity;\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\nstruct WireframeSettings {\r\n  float width;\r\n  float falloff;\r\n  float subdivision;\r\n  vec4 color;\r\n  float wireOpacity;\r\n  float surfaceOpacity;\r\n};\r\n\r\nuniform WireframeSettings wireframe;\r\n#endif\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\nvarying vec2 vtc;\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\nvarying vec2 vuv;\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\nvarying vec3 wpos;\r\nvarying vec3 wview;\r\nvarying vec3 wnormal;\r\nvarying vec3 wlight;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\nuniform vec4 screenSizePerspective;\r\n\r\nvarying float screenSizeDistanceToCamera;\r\nvarying float screenSizeCosAngle;\r\n#endif\r\n\r\nconst vec3 ambient \x3d vec3(0.2,0.2,0.2);\r\nconst vec3 diffuse \x3d vec3(0.8,0.8,0.8);\r\nconst float diffuseHardness \x3d 2.5;\r\nconst float sliceOpacity \x3d 0.2;\r\n\r\n#ifdef OVERLAY\r\nuniform sampler2D overlay0Tex;\r\nuniform sampler2D overlay1Tex;\r\nuniform float overlayOpacity;\r\nvarying vec4 vtcOverlay;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#endif\r\n\r\nfloat lum(vec3 c) {\r\n  float max \x3d max(max(c.r, c.g), c.b);\r\n  float min \x3d min(min(c.r, c.g), c.b);\r\n  return (min + max) * 0.5;\r\n}\r\n\r\n#ifdef ATMOSPHERE\r\nvec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\r\n  vec3 surfaceColor   \x3d vec3(0.0);\r\n  vec3 fuzzySpecColor \x3d vec3(1.0);\r\n  vec3 subColor       \x3d vec3(0.0);\r\n  float rollOff       \x3d 1.0;\r\n\r\n  vec3 Ln \x3d normalize(lightPos);\r\n  vec3 Nn \x3d normalize(normal);\r\n  vec3 Hn \x3d normalize(view + Ln);\r\n\r\n  float ldn \x3d dot(Ln, Nn);\r\n  float diffComp \x3d max(0.0, ldn);\r\n  float vdn \x3d 1.0 - dot(view, Nn);\r\n  float ndv \x3d dot(view, Ln);\r\n\r\n  vec3 diffContrib \x3d surfaceColor * diffComp;\r\n  float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\r\n\r\n  vec3 subContrib \x3d subLamb * subColor;\r\n  vec3 vecColor \x3d vec3(vdn);\r\n\r\n  vec3 diffuseContrib \x3d (subContrib + diffContrib);\r\n  vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\r\n\r\n  return (diffContrib + specularContrib) * rollOff;\r\n}\r\n#endif\r\n\r\nvoid main() {\r\n  vec3 a \x3d ambient;\r\n\r\n  float shadow \x3d 0.0;\r\n#ifdef RECEIVE_SHADOWS\r\n  shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n#endif\r\n  float vndl \x3d dot(normalize(vnormal), lightDirection);\r\n  float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\r\n  vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\r\n\r\n  float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n\r\n  vec4 tileColor \x3d texture2D(tex, vtc) * opacity;\r\n\r\n#ifdef OVERLAY\r\n  vec4 overlayColor \x3d getOverlayColor(overlay0Tex, overlay1Tex, vtcOverlay, overlayOpacity);\r\n\r\n  // tileColor and overlayTexCols have pre-multiplied alpha\r\n  tileColor \x3d tileColor * (1.0 - overlayColor.a) + overlayColor;\r\n#endif\r\n\r\n  if (rejectBySlice(vpos)) {\r\n    tileColor *\x3d sliceOpacity;\r\n  }\r\n\r\n  vec3 atm \x3d vec3(0.0);\r\n#ifdef ATMOSPHERE\r\n  float ndotl \x3d max(0.0, min(1.0, vndl));\r\n  atm \x3d atmosphere(wlight, wnormal, -viewDirection);\r\n  atm *\x3d max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps\r\n  atm *\x3d max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\r\n  atm *\x3d tileColor.a; // premultiply with tile alpha\r\n#endif\r\n\r\n  vec3 albedo \x3d atm + tileColor.rgb;\r\n  vec3 normal \x3d normalize(vnormal);\r\n\r\n  // heuristic shading function used in the old terrain, now used to add ambient lighting\r\n  float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\r\n  vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\r\n\r\n  gl_FragColor \x3d vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n  // This is only used for debug rendering the screenSize perspective\r\n\r\n  float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\r\n\r\n  if (perspectiveScale \x3c\x3d 0.25) {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);\r\n  }\r\n  else if (perspectiveScale \x3c\x3d 0.5) {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);\r\n  }\r\n  else if (perspectiveScale \x3e\x3d 0.99) {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);\r\n  }\r\n  else {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);\r\n  }\r\n\r\n#endif\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\n\r\n  vec2 vuvScaled \x3d vuv * wireframe.subdivision;\r\n  vec2 vuvMod \x3d fract(vuvScaled);\r\n\r\n  vec2 dVuv \x3d fwidth(vuvScaled);\r\n  dVuv \x3d max(vec2(0.00001), dVuv); // workaround against flickering skirts, see #10245\r\n\r\n  vec2 edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\r\n                                wireframe.width * dVuv, min(vuvMod, 1.0 - vuvMod));\r\n\r\n  float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\r\n\r\n#ifdef WIREFRAME_TEXTURE\r\n  vec3 wireframeColor \x3d mix(gl_FragColor.rgb, wireframe.color.rgb, edgeFactor * wireframe.color.a);\r\n  float wireframeAlpha \x3d mix(wireframe.surfaceOpacity, wireframe.wireOpacity, edgeFactor);\r\n  gl_FragColor \x3d vec4(wireframeColor * wireframeAlpha, wireframeAlpha * gl_FragColor.a);\r\n#endif\r\n\r\n\r\n#ifdef TILE_BORDERS\r\n  dVuv \x3d fwidth(vuv);\r\n  edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\r\n                            wireframe.width * dVuv, min(vuv, 1.0 - vuv));\r\n  edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\r\n\r\n  gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);\r\n#endif\r\n\r\n#endif // defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\n\r\n  gl_FragColor \x3d highlightSlice(gl_FragColor, vpos);\r\n}\r\n",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform vec3 origin;\r\nuniform vec4 texOffsetAndScale;\r\nuniform mat4 viewNormal;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\nvarying vec2 vtc;\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#endif\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\nvarying vec2 vuv;\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\nuniform vec3 lightDirection;\r\nvarying vec3 wpos;\r\nvarying vec3 wview;\r\nvarying vec3 wnormal;\r\nvarying vec3 wlight;\r\n#endif\r\n\r\n#ifdef OVERLAY\r\n// these variables combine two possible overlays into one by using a vec4:\r\n// components x/y are x/y of overlay 0, and components z/w are x/y of overlay 1\r\nuniform vec4 overlayTexOffset;\r\nuniform vec4 overlayTexScale;\r\nvarying vec4 vtcOverlay;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n\r\nuniform vec4 screenSizePerspective;\r\n\r\nvarying float screenSizeDistanceToCamera;\r\nvarying float screenSizeCosAngle;\r\n\r\n#endif\r\n\r\nvoid main(void) {\r\n  vpos \x3d position;\r\n\r\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n  vnormal \x3d normalize(vpos + origin);\r\n#else\r\n  vnormal \x3d vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\r\n#endif\r\n\r\nvec2 uv \x3d uv0;\r\nvpos \x3d applySkirts(uv, vpos, vnormal, skirtScale);\r\n\r\n#ifdef ATMOSPHERE\r\n  wpos \x3d (view * vec4(vpos, 1.0)).xyz;\r\n  wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\r\n  wlight \x3d (view  * vec4(lightDirection, 1.0)).xyz;\r\n#endif\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\n  vuv \x3d uv;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n\r\n  vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\r\n\r\n  screenSizeDistanceToCamera \x3d length(viewPos);\r\n\r\n  vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\r\n  screenSizeCosAngle \x3d abs(viewSpaceNormal.z);\r\n\r\n#endif\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\r\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\r\n  // issues on iPad/iPhone with the 'w' component require the depth to be\r\n  // passed as varying to properly drive the cascading shadow map index.\r\n  linearDepth \x3d gl_Position.w;\r\n#endif\r\n\r\n  vtc \x3d uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\r\n\r\n#ifdef OVERLAY\r\n  vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\r\n#endif\r\n}\r\n",
"depthPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/depth.glsl\x3e\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\nvoid main() {\r\n#ifndef BIAS_SHADOWMAP\r\n  gl_FragColor \x3d float2rgba(depth);\r\n#else\r\n  gl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n#endif\r\n}\r\n","depthPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform vec3 origin;\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform vec2 nearFar;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\nvoid main(void) {\r\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n  vec3 normal \x3d normalize(position + origin);\r\n#else\r\n  vec3 normal \x3d vec3(0.0, 0.0, 1.0);\r\n#endif\r\n\r\n  vec2 uv \x3d uv0;\r\n  vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\r\n\r\n  vec4 eye \x3d view * vec4(vpos, 1.0);\r\n  gl_Position \x3d proj * eye;\r\n  depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\r\n}\r\n",
"highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n#include \x3cterrainRenderer/overlay.glsl\x3e\r\n\r\nuniform sampler2D overlay0Tex;\r\nuniform sampler2D overlay1Tex;\r\nuniform float overlayOpacity;\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\nvarying vec4 vtcOverlay;\r\n\r\nvoid main() {\r\n  vec4 overlayColor \x3d getOverlayColor(overlay0Tex, overlay1Tex, vtcOverlay, overlayOpacity);\r\n\r\n  if (overlayColor.a \x3d\x3d 0.0) {\r\n    // Here we have to write black, instead of discarding the fragment in order to overwrite\r\n    // the highlights which might have been written by skirts of other tiles.\r\n    // As a consequence skirts are not visible, but terrain overwrites draped highlights.\r\n    gl_FragColor \x3d vec4(0.0);\r\n    return;\r\n  }\r\n\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n}\r\n",
"highlightPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform vec3 origin;\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform vec4 overlayTexScale;\r\nuniform vec4 overlayTexOffset;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec3 vpos;\r\nvarying vec4 vtcOverlay;\r\n\r\nvoid main() {\r\n  #if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n    vec3 vnormal \x3d normalize(position + origin);\r\n  #else\r\n    vec3 vnormal \x3d vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code\r\n  #endif\r\n\r\n  vec2 uv \x3d uv0;\r\n  vpos \x3d applySkirts(uv, position, vnormal, skirtScale);\r\n\r\n  vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n}\r\n",
"normalPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\nvoid main() {\r\n  vec3 normal \x3d normalize(vnormal);\r\n  if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n\r\n#ifndef ALPHA_ZERO\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n#else\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n#endif\r\n}\r\n","normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform vec3 origin;\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 viewNormal;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\nvoid main(void) {\r\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n  vec4 normal \x3d vec4(normalize(position + origin), 1.0);\r\n#else\r\n  vec4 normal \x3d vec4(0.0, 0.0, 1.0, 1.0);\r\n#endif\r\n\r\n  vec2 uv \x3d uv0;\r\n  vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n  vnormal \x3d normalize((viewNormal * normal).xyz);\r\n}\r\n",
"overlay.glsl":"vec4 getOverlayColor(sampler2D overlay0Tex, sampler2D overlay1Tex, vec4 texCoords, float opacity) {\r\n  vec4 color \x3d vec4(0.0);\r\n\r\n  // read textures outside of conditions, to avoid artifacts likely related to non-uniform flow control:\r\n  // - https://www.khronos.org/opengl/wiki/Sampler_(GLSL)#Non-uniform_flow_control\r\n  // - https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13657\r\n  vec4 colorInner \x3d texture2D(overlay0Tex, texCoords.xy);\r\n  vec4 colorOuter \x3d texture2D(overlay1Tex, texCoords.zw);\r\n\r\n  if ((texCoords.x \x3e 0.0) \x26\x26 (texCoords.x \x3c 1.0) \x26\x26 (texCoords.y \x3e 0.0) \x26\x26 (texCoords.y \x3c 1.0)) {\r\n    // inner overlay texture coordinates are within bounds -\x3e sample from inner overlay\r\n    color \x3d colorInner;\r\n  } else if ((texCoords.z \x3e 0.0) \x26\x26 (texCoords.z \x3c 1.0) \x26\x26 (texCoords.w \x3e 0.0) \x26\x26 (texCoords.w \x3c 1.0)) {\r\n    // sample from outer overlay\r\n    color \x3d colorOuter;\r\n  }\r\n\r\n  return color * opacity;\r\n}\r\n",
"skirts.glsl":'vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\r\n  float skirtLength \x3d 0.0;\r\n\r\n  if (uv.x \x3e\x3d 2.0) {\r\n    skirtLength \x3d uv.y * skirtScale;\r\n    // decode original uv-coordinates (see "encodeSkirtPos")\r\n    vec2 x \x3d vec2(uv.x) - vec2(3.5, 4.5);\r\n    uv \x3d clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\r\n  }\r\n\r\n  return vpos - vnormal * skirtLength;\r\n}\r\n'},util:{"alignPixel.glsl":"vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\r\n  // From clip space to (0 : 1), bias towards right pixel edge\r\n  vec2 xy \x3d vec2(.500123) + .5 * clipCoord.xy / clipCoord.w;\r\n\r\n  // Size of a pixel in range (0 : 1)\r\n  vec2 pixelSz \x3d vec2(1.0) / widthHeight;\r\n\r\n  // Round to nearest pixel center\r\n  vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\r\n\r\n  // Convert back to clip space\r\n  vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\r\n\r\n  return vec4(result, clipCoord.zw);\r\n}\r\n\r\nvec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\r\n  // From clip space to (0 : 1),\r\n  vec2 xy \x3d vec2(.5) + .5 * clipCoord.xy / clipCoord.w;\r\n\r\n  // Size of a pixel in range (0 : 1)\r\n  vec2 pixelSz \x3d vec2(1.0) / widthHeight;\r\n\r\n  // Round to nearest pixel border, (0 : 1)\r\n  vec2 ij \x3d floor((xy + .5 * pixelSz) * widthHeight) * pixelSz;\r\n\r\n  // Convert back to clip space\r\n  vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\r\n\r\n  return vec4(result, clipCoord.zw);\r\n}\r\n",
"color.glsl":"vec4 premultiplyAlpha(vec4 v) {\r\n  return vec4(v.rgb * v.a, v.a);\r\n}\r\n\r\nvec3 rgb2hsv(vec3 c) {\r\n  vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\r\n  vec4 p \x3d mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\r\n  vec4 q \x3d mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\r\n\r\n  float d \x3d q.x - min(q.w, q.y);\r\n  float e \x3d 1.0e-10;\r\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\r\n}\r\n\r\nvec3 hsv2rgb(vec3 c) {\r\n  vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\r\n  vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\r\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\r\n}\r\n",
"depth.glsl":"#include \x3cutil/encoding.glsl\x3e\r\n\r\n// read linear depth either from native depth texture or custom depth texture encoded in rgba\r\nfloat linearDepth(sampler2D depthTex, vec2 uv, vec2 nearFar) {\r\n  return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\r\n}\r\n\r\nfloat calcFragDepth(const in float depth) {\r\n  // calc polygon offset\r\n  const float SLOPE_SCALE \x3d 2.0;\r\n  const float BIAS \x3d 2.0 * .000015259;    // 1 / (2^16 - 1)\r\n  float m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\r\n  float result \x3d depth + SLOPE_SCALE * m + BIAS;\r\n  return clamp(result, .0, .999999);\r\n}\r\n",
"doublePrecision.glsl":"// based on https://www.thasler.com/blog/blog/glsl-part2-emu\r\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\r\n  vec3 t1 \x3d hiA + hiB;\r\n  vec3 e \x3d t1 - hiA;\r\n  vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\r\n  return t1 + t2;\r\n}\r\n","enableExtensions.glsl":"#define EXTENSIONS_ENABLED\r\n#extension GL_OES_standard_derivatives : enable\r\n#extension GL_EXT_shader_texture_lod : enable\r\n","encoding.glsl":"// This is the maximum float value representable as 32bit fixed point,\r\n// it is rgba2float(vec4(1)) inlined.\r\nconst float MAX_RGBA_FLOAT \x3d\r\n  255.0 / 256.0 +\r\n  255.0 / 256.0 / 256.0 +\r\n  255.0 / 256.0 / 256.0 / 256.0 +\r\n  255.0 / 256.0 / 256.0 / 256.0 / 256.0;\r\n\r\n// Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\r\nconst vec4 fixedPointFactors \x3d vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\r\n\r\nvec4 float2rgba(const float value) {\r\n  // Make sure value is in the domain we can represent\r\n  float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\r\n\r\n  // Decompose value in 32bit fixed point parts represented as\r\n  // uint8 rgba components. Decomposition uses the fractional part after multiplying\r\n  // by a power of 256 (this removes the bits that are represented in the previous\r\n  // component) and then converts the fractional part to 8bits.\r\n  vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * fixedPointFactors) * 256.0);\r\n\r\n  // Convert uint8 values (from 0 to 255) to floating point representation for\r\n  // the shader\r\n  const float toU8AsFloat \x3d 1.0 / 255.0;\r\n\r\n  return fixedPointU8 * toU8AsFloat;\r\n}\r\n\r\n// Factors to convert rgba back to float\r\nconst vec4 rgba2float_factors \x3d vec4(\r\n  255.0 / (256.0),\r\n  255.0 / (256.0 * 256.0),\r\n  255.0 / (256.0 * 256.0 * 256.0),\r\n  255.0 / (256.0 * 256.0 * 256.0 * 256.0)\r\n);\r\n\r\nfloat rgba2float(vec4 rgba) {\r\n  // Convert components from 0-\x3e1 back to 0-\x3e255 and then\r\n  // add the components together with their corresponding\r\n  // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\r\n  return dot(rgba, rgba2float_factors);\r\n}\r\n",
"fsPrecision.glsl":"#ifdef GL_FRAGMENT_PRECISION_HIGH\r\nprecision highp float;\r\nprecision highp sampler2D;\r\n#else\r\nprecision mediump float;\r\nprecision mediump sampler2D;\r\n#endif\r\n","highlight.glsl":"vec4 highlightData(vec4 fragCoord, sampler2D depthTex, vec4 viewportPixelSize) {\r\n  float sceneDepth \x3d texture2D(depthTex, (fragCoord.xy - viewportPixelSize.xy) * viewportPixelSize.zw).r;\r\n  if (fragCoord.z \x3e sceneDepth + 5e-7) {\r\n    return vec4(1.0, 1.0, 0.0, 1.0);\r\n  }\r\n  else {\r\n    return vec4(1.0, 0.0, 1.0, 1.0);\r\n  }\r\n}\r\n",
"hud.glsl":"#include \x3cutil/screenSizePerspective.glsl\x3e\r\n\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec4 auxpos1;\r\n\r\nuniform mat4 proj;\r\n\r\nuniform mat4 view;\r\nuniform mat4 viewNormal;\r\n\r\nuniform mat4 model;\r\nuniform mat4 modelNormal;\r\n\r\nuniform vec4 viewport;\r\n\r\nuniform vec3 camPos;\r\n\r\nuniform float polygonOffset;\r\nuniform float cameraGroundRelative;\r\nuniform float pixelRatio;\r\n\r\nuniform float perDistancePixelRatio;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\r\n// [ screenLength, distanceFactor, minWorldLength, maxWorldLength ]\r\nuniform vec4 verticalOffset;\r\n\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n// [ divisor, offset, minPixelSize, paddingPixels ]\r\nuniform vec4 screenSizePerspectiveAlignment;\r\n\r\n#endif\r\n\r\nuniform sampler2D hudVisibilityTexture;\r\n\r\n\r\n// Corresponds to cos(10 deg), used to compare against dot product of two vectors\r\nconst float SMALL_OFFSET_ANGLE \x3d 0.984807753012208;\r\n\r\nstruct ProjectHUDAux {\r\n  vec3 posModel;\r\n  vec3 posView;\r\n  vec3 vnormal;\r\n\r\n  float distanceToCamera;\r\n  float absCosAngle;\r\n};\r\n\r\n\r\n/**\r\n  * Apply the simulated polygon offset for HUD objects that improves\r\n  * issues with Z-fighting.\r\n  *\r\n  * @param posView {vec3} (inout) the position in view space. Will be modified in place.\r\n  * @param pointGroundDistance {float} the distance from the point geometry to the ground surface.\r\n  * @param absCosAngle {float} the absolute cosine of the angle between the world-up at the point geometry\r\n  *   and the view direction.\r\n  *\r\n  * Dependencies:\r\n  *\r\n  *   Attributes:\r\n  *     - auxpos1: contains centerOffset and pointGroundDistance\r\n  *\r\n  *   Uniforms:\r\n  *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n  *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\r\n  *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\r\n  *         reduced flickering.\r\n  *     - viewport: the viewport [x, y, width, height]\r\n  */\r\nfloat applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\r\n  float pointGroundSign \x3d sign(pointGroundDistance);\r\n\r\n  if (pointGroundSign \x3d\x3d 0.0) {\r\n    pointGroundSign \x3d cameraGroundRelative;\r\n  }\r\n\r\n  // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\r\n  // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\r\n  float groundRelative \x3d cameraGroundRelative * pointGroundSign;\r\n\r\n  // view angle dependent part of polygon offset emulation\r\n  // we take the absolute value because the sign that is dropped is\r\n  // instead introduced using the ground-relative position of the symbol and the camera\r\n  if (polygonOffset \x3e .0) {\r\n    float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\r\n\r\n    float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\r\n    float factor \x3d (1.0 - tanAlpha / viewport[2]);\r\n\r\n    // same side of the terrain\r\n    if (groundRelative \x3e 0.0) {\r\n      posView *\x3d factor;\r\n    }\r\n    // opposite sides of the terrain\r\n    else {\r\n      posView /\x3d factor;\r\n    }\r\n  }\r\n\r\n  return groundRelative;\r\n}\r\n\r\n/**\r\n * Apply small vertical offset along world normal to reduce flickering. The offset\r\n * is distance based is approximately half of a pixel in the plane parallel to the\r\n * view at the HUD origin.\r\n *\r\n * @param normalModel {vec3} the normal in model/world space.\r\n * @param posModel {vec3} (inout) the position in model/world space. This value will\r\n *   be updated with the additional vertical offset.\r\n * @param posView {vec3} (inout) the position in view space. This value is used to\r\n *   determine the distance to the HUD origin and will also be updated with the\r\n *   additional vertical offset.\r\n *\r\n * Dependencies:\r\n *\r\n *   Uniforms:\r\n *     - perDistancePixelRatio: world units per distance per pixel.\r\n *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n *     - viewNormal: the view normal transformation.\r\n */\r\nvoid applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {\r\n  float distanceToCamera \x3d length(posView);\r\n\r\n  // Compute offset in world units for a half pixel shift\r\n  float pixelOffset \x3d distanceToCamera * perDistancePixelRatio * 0.5;\r\n\r\n  // Apply offset along normal in the direction away from the ground surface\r\n  vec3 modelOffset \x3d normalModel * cameraGroundRelative * pixelOffset;\r\n\r\n  // Apply the same offset also on the view space position\r\n  vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\r\n\r\n  posModel +\x3d modelOffset;\r\n  posView +\x3d viewOffset;\r\n}\r\n\r\n/**\r\n  * Project the 3d position of a HUD object from world space to clip space. In addition\r\n  * to standard model view projection, it also emulates a polygon offset to\r\n  * help with points above/below ground and icon flickering. The resulting location\r\n  * is the anchor of the HUD object, i.e. the position that is used also for testing\r\n  * visibility of the HUD object. Note that the returned projected position is not\r\n  * aligned to a pixel center or border, it is up to the caller to align if necessary.\r\n  *\r\n  * Dependencies:\r\n  *\r\n  *   Attributes:\r\n  *     - position: contains the point world position\r\n  *     - normal: contains the world normal pointing up at the point\r\n  *     - auxpos1: contains centerOffset and pointGroundDistance\r\n  *\r\n  *   Uniforms:\r\n  *     - model: the object -\x3e world transformation matrix\r\n  *     - modelNormal: the object -\x3e world normal transformation matrix (inv transp of model)\r\n  *     - view: the world -\x3e view transformation matrix\r\n  *     - viewNormal: the world -\x3e view normal transformation matrix (inv transp of view)\r\n  *     - proj: the view -\x3e clip projection matrix\r\n  *     - verticalOffset: a vec4 containing:\r\n  *         - the screen height of the vertical offset\r\n  *         - the screen height of the vertical offset as a fraction of camera distance.\r\n  *         - the minimum world size vertical offset.\r\n  *         - the maximum world size vertical offset.\r\n  *       This will do a screen sized offset of the point along its normal (used for line callouts)\r\n  *     - screenSizePerspectiveAlignment: a vec3 containing\r\n  *         - the view distance dependent divisor\r\n  *         - the view distance dependent offset\r\n  *         - the minimum pixel size\r\n  *         - the amount of padding in pixels around the region to be scaled (not used for alignment)\r\n  *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n  *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\r\n  *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\r\n  *         reduced flickering.\r\n  *     - camPos: the position of the camera in world space\r\n  *     - viewport: the viewport [x, y, width, height]\r\n  */\r\nvec4 projectPositionHUD(out ProjectHUDAux aux) {\r\n  // centerOffset is in view space and is used to implement world size offsetting\r\n  // of labels with respect to objects. It also pulls the label towards the viewer\r\n  // so that the label is visible in front of the object.\r\n  vec3 centerOffset \x3d auxpos1.xyz;\r\n\r\n  // The pointGroundDistance is the distance of the geometry to the ground and is\r\n  // negative if the point is below the ground, or positive if the point is above\r\n  // ground.\r\n  float pointGroundDistance \x3d auxpos1.w;\r\n\r\n  aux.posModel \x3d (model * vec4(position, 1.0)).xyz;\r\n  aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\r\n  aux.vnormal \x3d (modelNormal * vec4(normal, 1.0)).xyz;\r\n\r\n  applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);\r\n\r\n  // Screen sized offset in world space, used for example for line callouts\r\n  // Note: keep this implementation in sync with the CPU implementation, see\r\n  //   - MaterialUtil.verticalOffsetAtDistance\r\n  //   - HUDMaterial.applyVerticalOffsetTransformation\r\n\r\n  aux.distanceToCamera \x3d length(aux.posView);\r\n\r\n  vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\r\n  float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\r\n\r\n  aux.absCosAngle \x3d abs(cosAngle);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n#if defined(VERTICAL_OFFSET) || defined(CENTER_OFFSET_UNITS_SCREEN)\r\n  vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);\r\n#endif\r\n\r\n#endif\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);\r\n#else\r\n  float verticalOffsetScreenHeight \x3d verticalOffset.x;\r\n#endif\r\n\r\n  float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\r\n  vec3 modelOffset \x3d aux.vnormal * worldOffset;\r\n\r\n  aux.posModel +\x3d modelOffset;\r\n\r\n  vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\r\n  aux.posView +\x3d viewOffset;\r\n\r\n  // Since we elevate the object, we need to take that into account\r\n  // in the distance to ground\r\n  pointGroundDistance +\x3d worldOffset;\r\n\r\n#endif\r\n\r\n  float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\r\n\r\n#ifndef CENTER_OFFSET_UNITS_SCREEN\r\n  // Apply x/y in view space, but z in screen space (i.e. along posView direction)\r\n  aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0.0);\r\n\r\n  // Same material all have same z !\x3d 0.0 condition so should not lead to\r\n  // branch fragmentation and will save a normalization if it's not needed\r\n  if (centerOffset.z !\x3d 0.0) {\r\n    aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\r\n  }\r\n#endif\r\n\r\n  vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\r\n\r\n#ifdef CENTER_OFFSET_UNITS_SCREEN\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);\r\n#else\r\n  float centerOffsetY \x3d centerOffset.y;\r\n#endif\r\n\r\n  posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;\r\n\r\n#endif\r\n\r\n  // constant part of polygon offset emulation\r\n  posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\r\n\r\n  return posProj;\r\n}\r\n\r\nuniform float uRenderTransparentlyOccludedHUD;\r\n\r\n/**\r\n  * Test for visibility of a HUD object.\r\n  *\r\n  * Dependencies:\r\n  *\r\n  *   Uniforms:\r\n  *     - hudVisibilityTexture: the texture that contains the visibility information\r\n  *     - markerColor: the special marker color that is used to write visibility information\r\n  *     - viewport: the viewport\r\n  */\r\nbool testVisibilityHUD(vec4 posProj) {\r\n  // For occlusion testing, use the nearest pixel center to avoid\r\n  // subpixel filtering messing up the color we use to test for\r\n  vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\r\n\r\n  vec4 occlusionPixel \x3d texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\r\n\r\n  // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\r\n  // the green pixel stores transparency of transparent geometry (1.0 -\x3e fully transparent)\r\n  // note that we also check against green \x3d\x3d 0.0, i.e. transparent geometry that has opaque parts\r\n\r\n  // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\r\n  if (uRenderTransparentlyOccludedHUD \x3e 0.5) {\r\n    // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\r\n    // uRenderTransparentlyOccludedHUD \x3d 0.75\r\n    return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g * uRenderTransparentlyOccludedHUD \x3c 1.0;\r\n  }\r\n  // and visible pixels that are not occluded by semi-transparent geometry here\r\n  else {\r\n    return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g \x3d\x3d 1.0;\r\n  }\r\n\r\n  // return texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w).r \x3e 0.0;\r\n}\r\n",
"normalEncoding.glsl":"vec3 decodeNormal(vec2 f) {\r\n    float z \x3d 1.0 - abs(f.x) - abs(f.y);\r\n    return vec3(f + sign(f) * min(z, 0.0), z);\r\n}\r\n","quad.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nvarying vec2 uv;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(position.x, position.y, .0, 1.0);\r\n  uv \x3d position * .5 + vec2(.5);\r\n}\r\n","sceneLighting.glsl":"// Scene Lighting Definitions:\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\n// defines:\r\n//   - SH_ORDER: 1|2|3\r\n// input:\r\n//   - normal: vec3\r\n//   - albedo: vec3\r\n//   - shadow: float\r\n//   - ssao: float\r\n// return:\r\n//   - color: vec3\r\n\r\n// main light\r\n/////////////////////////////////////////\r\nuniform vec3 lightingMainDirection;\r\nuniform vec3 lightingMainIntensity;\r\n\r\n// ambient lighting\r\n/////////////////////////////////////////\r\n#ifndef SH_ORDER\r\n  #define SH_ORDER 2\r\n#endif\r\n\r\n#if SH_ORDER \x3d\x3d 0\r\n  uniform vec3 lightingAmbientSH0;\r\n#elif SH_ORDER \x3d\x3d 1\r\n  uniform vec4 lightingAmbientSH_R;\r\n  uniform vec4 lightingAmbientSH_G;\r\n  uniform vec4 lightingAmbientSH_B;\r\n#elif SH_ORDER \x3d\x3d 2\r\n  uniform vec3 lightingAmbientSH0;\r\n  uniform vec4 lightingAmbientSH_R1;\r\n  uniform vec4 lightingAmbientSH_G1;\r\n  uniform vec4 lightingAmbientSH_B1;\r\n  uniform vec4 lightingAmbientSH_R2;\r\n  uniform vec4 lightingAmbientSH_G2;\r\n  uniform vec4 lightingAmbientSH_B2;\r\n#endif\r\n\r\n// special tweaking\r\n//////////////////////////////////////////\r\nuniform float lightingFixedFactor;\r\nuniform float lightingGlobalFactor;\r\n\r\nuniform float ambientBoostFactor;\r\n\r\n// evaluation\r\n//////////////////////////////////////////\r\n\r\nvec3 evaluateSceneLighting(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\r\n  // evaluate the main light\r\n  #if defined(TREE_RENDERING)\r\n    // Special case for tree rendering:\r\n    // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere\r\n    // facing away from the light. The idea is to get an effect where light is transmitted\r\n    // through the tree.\r\n    float minDot \x3d -0.5;\r\n    float dotRange \x3d 1.0 - minDot;\r\n    float dotNormalization \x3d 0.66; // guessed \x26 hand tweaked value, for an exact value we could precompute an integral over the sphere\r\n\r\n    float dotVal \x3d dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);\r\n  #else\r\n    float dotVal \x3d clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);\r\n  #endif\r\n\r\n  // move lighting towards (1.0, 1.0, 1.0) if requested\r\n  dotVal \x3d mix(dotVal, 1.0, lightingFixedFactor);\r\n\r\n  vec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\r\n\r\n  // evaluate the sh ambient light\r\n  #if SH_ORDER \x3d\x3d 0\r\n    vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\r\n  #elif SH_ORDER \x3d\x3d 1\r\n    vec4 sh0 \x3d vec4(\r\n      0.282095,\r\n      0.488603 * normal.x,\r\n      0.488603 * normal.z,\r\n      0.488603 * normal.y\r\n    );\r\n    vec3 ambientLight \x3d vec3(\r\n      dot(lightingAmbientSH_R, sh0),\r\n      dot(lightingAmbientSH_G, sh0),\r\n      dot(lightingAmbientSH_B, sh0)\r\n    );\r\n  #elif SH_ORDER \x3d\x3d 2\r\n    vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\r\n\r\n    vec4 sh1 \x3d vec4(\r\n      0.488603 * normal.x,\r\n      0.488603 * normal.z,\r\n      0.488603 * normal.y,\r\n      1.092548 * normal.x * normal.y\r\n    );\r\n    vec4 sh2 \x3d vec4(\r\n      1.092548 * normal.y * normal.z,\r\n      0.315392 * (3.0 * normal.z * normal.z - 1.0),\r\n      1.092548 * normal.x * normal.z,\r\n      0.546274 * (normal.x * normal.x - normal.y * normal.y)\r\n    );\r\n    ambientLight +\x3d vec3(\r\n      dot(lightingAmbientSH_R1, sh1),\r\n      dot(lightingAmbientSH_G1, sh1),\r\n      dot(lightingAmbientSH_B1, sh1)\r\n    );\r\n    ambientLight +\x3d vec3(\r\n      dot(lightingAmbientSH_R2, sh2),\r\n      dot(lightingAmbientSH_G2, sh2),\r\n      dot(lightingAmbientSH_B2, sh2)\r\n    );\r\n  #endif\r\n  ambientLight *\x3d (1.0 - ssao);\r\n\r\n  // inverse gamma correction on the albedo color\r\n  float gamma \x3d 2.1;\r\n  vec3 albedoGammaC \x3d pow(albedo, vec3(gamma));\r\n\r\n  // physically correct BRDF normalizes by PI\r\n  const float PI \x3d 3.14159;\r\n  vec3 totalLight \x3d mainLight + ambientLight + additionalLight;\r\n  totalLight \x3d min(totalLight, vec3(PI, PI, PI));\r\n  vec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\r\n\r\n  // apply gamma correction to the computed color\r\n  outColor \x3d pow(outColor, vec3(1.0/gamma));\r\n\r\n  return outColor;\r\n}\r\n\r\nvec3 sceneLightingAdditionalLightGlobal(vec3 worldPos, float ssao, out float additionalAmbientScale) {\r\n  // heuristic lighting model originally used in the terrain shading\r\n  // now used to generated additional ambient light\r\n\r\n#if VIEWING_MODE \x3d\x3d VIEWING_MODE_GLOBAL\r\n    float vndl \x3d -dot(normalize(worldPos), lightingMainDirection);\r\n#else\r\n    float vndl \x3d -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);\r\n#endif\r\n\r\n  additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\r\n  return ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\r\n}\r\n",
"screenSizePerspective.glsl":"// Note that the implementation here should be kept in sync with the corresponding\r\n// CPU implementation (used for hitTest etc) in screenSizePerspectiveUtils.ts\r\n\r\n/**\r\n * Compute the screen size perspective lower bound from pre-computed screen\r\n * size perspective factors (or parameters, since both store the pixel lower\r\n * bound information in the same place). When computing the minimum size,\r\n * the padding (e.g. text halo) is scaled with the same factor as the\r\n * original size scales to reach the minimum size.\r\n *\r\n * {\r\n *    x: N/A\r\n *    y: N/A\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nfloat screenSizePerspectiveMinSize(float size, vec4 factor) {\r\n\r\n  // Original calculation:\r\n  //   padding \x3d 2 * factor.w\r\n  //   minSize \x3d factor.z\r\n  //\r\n  //   minSize + minSize / size * padding\r\n  //\r\n  // Incorporates padding (factor.w, e.g. text halo size) into the\r\n  // minimum bounds calculation, taking into account that padding\r\n  // would scale down proportionally to the size.\r\n  //\r\n  // Calculation below is the same, but avoids division by zero when\r\n  // size would be zero, without branching using step.\r\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10683\r\n\r\n  // nonZeroSize is 1 if size \x3e 0, and 0 otherwise\r\n  float nonZeroSize \x3d 1.0 - step(size, 0.0);\r\n\r\n  return (\r\n    factor.z * (\r\n      1.0 +\r\n      nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\r\n                                   // proportionally scaled padding\r\n      2.0 * factor.w / (\r\n        size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\r\n      )\r\n    )\r\n  );\r\n}\r\n\r\n/**\r\n * Computes the view angle dependent screen size perspective factor. The goal\r\n * of this factor is that:\r\n *\r\n *   1. There is no perspective when looking top-down\r\n *   2. There is a smooth and quick transition to full perspective when\r\n *      tilting.\r\n */\r\nfloat screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\r\n  return absCosAngle * absCosAngle * absCosAngle;\r\n}\r\n\r\n/**\r\n * Precomputes a set of factors that can be used to apply screen size perspective\r\n * The factors are based on the viewing angle, distance to camera and the screen size\r\n * perspective parameters:\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n *\r\n * The result is a set of factors that can be used to apply the perspective:\r\n *\r\n * {\r\n *    x: distance based relative scale factor (0 -\x3e 1)\r\n *    y: view dependent scale factor\r\n *    z: minPixelSize (abs)\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nvec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\r\n}\r\n\r\n/**\r\n * Applies screen size perspective factors to a single dimension size, given the viewing angle,\r\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\r\n * perspective parameters using screenSizePerspectiveScaleFactorFloat.\r\n *\r\n * Note that for single scale application, the screenSizePerspectiveScaleFloat can be used, which\r\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorFloat.\r\n */\r\n\r\nfloat applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\r\n  return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\r\n}\r\n\r\n/**\r\n * Applies screen size perspective parameters to a single dimension size, given the viewing angle,\r\n * distance to camera and perspective parameters\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nfloat screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\r\n}\r\n\r\n/**\r\n * Applies screen size perspective factors to a vec2 size (width/height), given the viewing angle,\r\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\r\n * perspective parameters using screenSizePerspectiveScaleFactorVec2.\r\n *\r\n * Note that for single scale application, the screenSizePerspectiveScaleVec2 can be used, which\r\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorVec2.\r\n */\r\nvec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\r\n  return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\r\n}\r\n\r\n/**\r\n * Applies screen size perspective parameters to a vec2 size (width/height), given the viewing angle,\r\n * distance to camera and perspective parameters\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nvec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\r\n}\r\n",
"shadow.glsl":'#include \x3cutil/encoding.glsl\x3e\r\n\r\n// "matrix" parameter used to have const qualifier as well, but IE11 couldn\'t deal with it at time of writing.\r\n// once IE11 is fine with it, const should probably be re-introduced\r\nfloat evalShadow(const in vec3 vpos, const in float depth, const in sampler2D depthTex, const int num, const in vec4 distance, in mat4 matrix[4], const in float halfPxSz) {\r\n  //choose correct cascade\r\n  int i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\r\n\r\n  if (i \x3e\x3d num) { return .0; }\r\n\r\n  mat4 mat \x3d i \x3d\x3d 0 ? matrix[0] : i \x3d\x3d 1 ? matrix[1] : i \x3d\x3d 2 ? matrix[2] : matrix[3];\r\n\r\n  vec4 lv \x3d mat * vec4(vpos, 1.0);\r\n  lv.xy /\x3d lv.w;\r\n\r\n  //vertex completely outside? -\x3e no shadow\r\n  vec3 lvpos \x3d .5 * lv.xyz + vec3(.5);\r\n  if (lvpos.z \x3e\x3d 1.0) { return .0; }\r\n  if (lvpos.x \x3c .0 || lvpos.x \x3e 1.0 || lvpos.y \x3c .0 || lvpos.y \x3e 1.0) { return .0; }\r\n\r\n  //calc coord in cascade texture\r\n  vec2 uv \x3d vec2(float(i - 2 * (i / 2)) *.5, float(i / 2) * .5) + .5 * lvpos.xy;\r\n\r\n  float texSize \x3d .5 / halfPxSz;\r\n\r\n  //filter, offset by half pixels\r\n  vec2 st \x3d fract((vec2(halfPxSz) + uv) * texSize);\r\n\r\n  float s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n  float s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n  float s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n  float s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n\r\n  return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\r\n}\r\n',
"slice.glsl":"#ifdef SLICE\r\nuniform vec3 slicePlaneOrigin;\r\nuniform vec3 slicePlaneBasis1;\r\nuniform vec3 slicePlaneBasis2;\r\n\r\nstruct SliceFactors {\r\n  float front;\r\n  float side0;\r\n  float side1;\r\n  float side2;\r\n  float side3;\r\n};\r\n\r\nSliceFactors calculateSliceFactors(vec3 pos) {\r\n  vec3 rel \x3d pos - slicePlaneOrigin;\r\n\r\n  vec3 slicePlaneNormal \x3d -cross(slicePlaneBasis1, slicePlaneBasis2);\r\n  float slicePlaneW \x3d -dot(slicePlaneNormal, slicePlaneOrigin);\r\n\r\n  float basis1Len2 \x3d dot(slicePlaneBasis1, slicePlaneBasis1);\r\n  float basis2Len2 \x3d dot(slicePlaneBasis2, slicePlaneBasis2);\r\n\r\n  float basis1Dot \x3d dot(slicePlaneBasis1, rel);\r\n  float basis2Dot \x3d dot(slicePlaneBasis2, rel);\r\n\r\n  return SliceFactors(\r\n    dot(slicePlaneNormal, pos) + slicePlaneW,\r\n    -basis1Dot - basis1Len2,\r\n    basis1Dot - basis1Len2,\r\n    -basis2Dot - basis2Len2,\r\n    basis2Dot - basis2Len2\r\n  );\r\n}\r\n\r\nbool sliceByFactors(SliceFactors factors) {\r\n  return factors.front \x3c 0.0\r\n    \x26\x26 factors.side0 \x3c 0.0\r\n    \x26\x26 factors.side1 \x3c 0.0\r\n    \x26\x26 factors.side2 \x3c 0.0\r\n    \x26\x26 factors.side3 \x3c 0.0;\r\n}\r\n\r\nbool sliceByPlane(vec3 pos) {\r\n  return sliceByFactors(calculateSliceFactors(pos));\r\n}\r\n\r\n#ifdef EXTENSIONS_ENABLED\r\n\r\nvec4 applySliceHighlight(vec4 color, vec3 pos) {\r\n  SliceFactors factors \x3d calculateSliceFactors(pos);\r\n\r\n  if (sliceByFactors(factors)) {\r\n    return color;\r\n  }\r\n\r\n  const float HIGHLIGHT_WIDTH \x3d 1.0;\r\n  const vec4 HIGHLIGHT_COLOR \x3d vec4(0.0, 0.0, 0.0, 0.3);\r\n\r\n  factors.front /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);\r\n  factors.side0 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);\r\n  factors.side1 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);\r\n  factors.side2 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);\r\n  factors.side3 /\x3d (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);\r\n\r\n  float highlightFactor \x3d (1.0 - step(0.5, factors.front))\r\n    * (1.0 - step(0.5, factors.side0))\r\n    * (1.0 - step(0.5, factors.side1))\r\n    * (1.0 - step(0.5, factors.side2))\r\n    * (1.0 - step(0.5, factors.side3));\r\n\r\n  return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);\r\n}\r\n\r\n#else // EXTENSIONS_ENABLED\r\n\r\n// GL_OES_standard_derivatives must be enabled for applySliceHighlight\r\n\r\n#endif // EXTENSIONS_ENABLED\r\n\r\n#define rejectBySlice(_pos_) sliceByPlane(_pos_)\r\n#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\r\n#define highlightSlice(_color_, _pos_) applySliceHighlight(_color_, _pos_)\r\n\r\n#else // SLICE\r\n\r\n#define rejectBySlice(_pos_) false\r\n#define discardBySlice(_pos_) {}\r\n#define highlightSlice(_color_, _pos_) (_color_)\r\n\r\n#endif // SLICE\r\n",
"visualVariables.glsl":"#if defined(VV_SIZE)\r\n  #define VV_CUSTOM_MODEL_MATRIX\r\n#endif\r\n\r\n#if defined(VV_SIZE)\r\n  uniform vec3 vvSizeMinSize;\r\n  uniform vec3 vvSizeMaxSize;\r\n  uniform vec3 vvSizeOffset;\r\n  uniform vec3 vvSizeFactor;\r\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\r\n  uniform vec3 vvSizeValue;\r\n#endif\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  uniform mat3 vvSymbolRotationMatrix;\r\n#endif\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  uniform vec3 vvSymbolAnchor;\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  #define VV_COLOR_N 8\r\n  uniform float vvColorValues[VV_COLOR_N];\r\n  uniform vec4 vvColorColors[VV_COLOR_N];\r\n#endif\r\n\r\n// Evaluation of size\r\n#if defined(VV_SIZE)\r\n  vec3 vvGetScale(vec4 featureAttribute) {\r\n    return clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\r\n  }\r\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\r\n  vec3 vvGetScale(vec4 featureAttribute) {\r\n    return vvSizeValue;\r\n  }\r\n#endif\r\n\r\n// Applying the model matrix\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  vec4 vvTransformPosition(vec3 position, vec4 featureAttribute) {\r\n    return vec4(vvSymbolRotationMatrix * (vvGetScale(featureAttribute) * (position + vvSymbolAnchor)), 1.0);\r\n  }\r\n\r\n  vec4 vvTransformNormal(vec3 normal, vec4 featureAttribute) {\r\n    // Normal transform is the inverse transpose of model transform\r\n    return vec4(vvSymbolRotationMatrix * normal / vvGetScale(featureAttribute), 1.0);\r\n  }\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\r\n    float value \x3d featureAttribute.y;\r\n    if (value \x3c\x3d values[0]) {\r\n      return colors[0];\r\n    }\r\n\r\n    for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n      if (values[i] \x3e\x3d value) {\r\n        float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\r\n        return mix(colors[i-1], colors[i], f);\r\n      }\r\n    }\r\n\r\n    return colors[VV_COLOR_N - 1];\r\n  }\r\n#endif\r\n",
"vsPrecision.glsl":"precision highp float;\r\nprecision highp sampler2D;\r\n"}}})},"esri/views/webgl/ShaderCompiler":function(){define(["require","exports"],function(q,b){return function(){function b(b){this.readFile=b}b.prototype.resolveIncludes=function(b){return this.resolve(b)};b.prototype.resolve=function(b,k){var d=this;void 0===k&&(k=new Map);if(k.has(b))return k.get(b);var h=this.read(b);if(!h)throw Error("cannot find shader file "+b);for(var f=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm,p=f.exec(h),
c=[];null!=p;)c.push({path:p[1],start:p.index,length:p[0].length}),p=f.exec(h);var a=0,l="";c.forEach(function(c){l+=h.slice(a,c.start);l+=k.has(c.path)?"":d.resolve(c.path,k);a=c.start+c.length});l+=h.slice(a);k.set(b,l);return l};b.prototype.read=function(b){return this.readFile(b)};return b}()})},"esri/views/webgl/programUtils":function(){define(["require","exports","./Program"],function(q,b,n){function f(b,d,h,f){h=h||{};f=f||"";h="function"===typeof d.shaders?d.shaders(h):d.shaders;return new n(b,
f+h.vertexShader,f+h.fragmentShader,d.attributes)}Object.defineProperty(b,"__esModule",{value:!0});b.glslifyDefineMap=function(b){var d="",h;for(h in b){var f=b[h];if("boolean"===typeof f)f&&(d+="#define "+h+"\n");else if("number"===typeof f)d+="#define "+h+" "+f.toFixed()+"\n";else if("object"===typeof f){var p=f.options,c=0,a;for(a in p)d+="#define "+p[a]+" "+(c++).toFixed()+"\n";d+="#define "+h+" "+p[f.value]+"\n"}}return d};q=function(){function b(d){this._programCacheByTemplate=new Map;this._rctx=
d}b.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(d){d.programs.forEach(function(d){d.dispose()})});this._programCacheByTemplate=null};b.prototype.getProgram=function(d,b){var h=this;this._programCacheByTemplate.has(d)||this.addProgramTemplate(d,function(b){return f(h._rctx,d,b)});return this.getProgramTemplateInstance(d,b)};b.prototype.addProgramTemplate=function(d,b){this._programCacheByTemplate.set(d,{constructor:b,programs:new Map})};b.prototype.getProgramTemplateInstance=
function(d,b){if(d=this._programCacheByTemplate.get(d)){var h=b?JSON.stringify(b):"default";d.programs.has(h)||(b=d.constructor(b),d.programs.set(h,b));return d.programs.get(h)}return null};return b}();b.ProgramCache=q;b.createProgram=f})},"esri/views/webgl/Program":function(){define(["require","exports","../../core/has","./ShaderTranspiler"],function(q,b,n,f){return function(){function b(d,h,f,p,c){void 0===c&&(c={});this._glName=this._context=null;this._locations={};this._id=void 0;this._initialized=
!1;this._fShader=this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform1v={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};d||console.error("RenderingContext isn't initialized!");0===h.length&&console.error("Shaders source should not be empty!");this._context=d;this._vertexShaderSource=h;this._fragmentShaderSource=f;if(Array.isArray(c))for(h=
0;h<c.length;h++)this._defines[c[h]]="1";else this._defines=c;this._id=b._nextId++;this._locations=p;n("esri-webgl-debug")&&d.instanceCounter.incrementCount(3)}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});b.prototype.getDefine=
function(d){return this._defines[d]};b.prototype.dispose=function(){if(this._context){var d=this._context.gl;this._vShader&&(d.deleteShader(this._vShader),this._vShader=null);this._fShader&&(d.deleteShader(this._fShader),this._fShader=null);this._glName&&(d.deleteProgram(this._glName),this._glName=null);n("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(3);this._context=null}};b.prototype.initialize=function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=
this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var d=this._context.gl,b=d.createProgram();d.attachShader(b,this._vShader);d.attachShader(b,this._fShader);for(var f in this._locations)d.bindAttribLocation(b,this._locations[f],f);d.linkProgram(b);d.getProgramParameter(b,d.LINK_STATUS)||console.error("Could not initialize shader\nVALIDATE_STATUS: "+d.getProgramParameter(b,d.VALIDATE_STATUS)+", gl error ["+d.getError()+"]infoLog: "+d.getProgramInfoLog(b));
this._glName=b;this._initialized=!0}};b.prototype.getUniformLocation=function(d){this.initialize();void 0===this._nameToUniformLocation[d]&&(this._nameToUniformLocation[d]=this._context.gl.getUniformLocation(this._glName,d));return this._nameToUniformLocation[d]};b.prototype.hasUniform=function(d){return null!==this.getUniformLocation(d)};b.prototype.getAttribLocation=function(d){this.initialize();void 0===this._nameToAttribLocation[d]&&(this._nameToAttribLocation[d]=this._context.gl.getAttribLocation(this._glName,
d));return this._nameToAttribLocation[d]};b.prototype.setUniform1i=function(d,b){var h=this._nameToUniform1[d];if(void 0===h||b!==h)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(d),b),this._nameToUniform1[d]=b};b.prototype.setUniform1iv=function(d,h){var f=this._nameToUniform1v[d];void 0!==f&&b._arraysEqual(h,f)||(this._context.bindProgram(this),this._context.gl.uniform1iv(this.getUniformLocation(d),h),void 0===f?this._nameToUniform1v[d]=b._arrayCopy(h):b._arrayAssign(h,
f))};b.prototype.setUniform1f=function(d,b){var h=this._nameToUniform1[d];if(void 0===h||b!==h)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(d),b),this._nameToUniform1[d]=b};b.prototype.setUniform1fv=function(d,h){var f=this._nameToUniform1v[d];void 0!==f&&b._arraysEqual(h,f)||(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(d),h),void 0===f?this._nameToUniform1v[d]=b._arrayCopy(h):b._arrayAssign(h,f))};b.prototype.setUniform2f=
function(d,b,f){var h=this._nameToUniform2[d];if(void 0===h||b!==h[0]||f!==h[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(d),b,f),void 0===h?this._nameToUniform2[d]=[b,f]:(h[0]=b,h[1]=f)};b.prototype.setUniform2fv=function(d,h){var f=this._nameToUniform2[d];void 0!==f&&b._arraysEqual(h,f)||(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(d),h),void 0===f?this._nameToUniform2[d]=b._arrayCopy(h):b._arrayAssign(h,f))};b.prototype.setUniform3f=
function(d,b,f,p){var c=this._nameToUniform3[d];if(void 0===c||b!==c[0]||f!==c[1]||p!==c[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(d),b,f,p),void 0===c?this._nameToUniform3[d]=[b,f,p]:(c[0]=b,c[1]=f,c[2]=p)};b.prototype.setUniform3fv=function(d,h){var f=this._nameToUniform3[d];void 0!==f&&b._arraysEqual(h,f)||(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(d),h),void 0===f?this._nameToUniform3[d]=b._arrayCopy(h):b._arrayAssign(h,
f))};b.prototype.setUniform4f=function(d,b,f,p,c){var a=this._nameToUniform4[d];if(void 0===a||b!==a[0]||f!==a[1]||p!==a[2]||c!==a[3])this._context.bindProgram(this),this._context.gl.uniform4f(this.getUniformLocation(d),b,f,p,c),void 0===a?this._nameToUniform4[d]=[b,f,p,c]:(a[0]=b,a[1]=f,a[2]=p,a[3]=c)};b.prototype.setUniform4fv=function(d,h){var f=this._nameToUniform4[d];void 0!==f&&b._arraysEqual(h,f)||(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(d),h),void 0===
f?this._nameToUniform4[d]=b._arrayCopy(h):b._arrayAssign(h,f))};b.prototype.setUniformMatrix3fv=function(d,h,f){void 0===f&&(f=!1);var m=this._nameToUniformMatrix3[d];void 0!==m&&(9===m.length?b._matrix3Equal(m,h):b._arraysEqual(h,m))||(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(d),f,h),void 0===m?this._nameToUniformMatrix3[d]=b._arrayCopy(h):b._arrayAssign(h,m))};b.prototype.setUniformMatrix4fv=function(d,h,f){void 0===f&&(f=!1);var m=this._nameToUniformMatrix4[d];
void 0!==m&&(16===m.length?b._matrix4Equal(m,h):b._arraysEqual(h,m))||(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(d),f,h),void 0===m?this._nameToUniformMatrix4[d]=b._arrayCopy(h):b._arrayAssign(h,m))};b._padToThree=function(d){var b=d.toString();1E3>d&&(b=("  "+d).slice(-3));return b};b.prototype._addLineNumbers=function(d){var h=2;return d.replace(/\n/g,function(){return"\n"+b._padToThree(h++)+":"})};b.prototype._loadShader=function(d){var b=35633===
d,m=b?this._vertexShaderSource:this._fragmentShaderSource,p;p="";for(var c in this._defines)p+="#define "+c+" "+this._defines[c]+"\n";p+=m;"webgl2"===this._context.contextVersion&&(p=f.transpileShader(p,b?"vertex":"fragment"));b=this._context.gl;d=b.createShader(d);b.shaderSource(d,p);b.compileShader(d);b.getShaderParameter(d,b.COMPILE_STATUS)||(console.error(b.getShaderInfoLog(d)),console.error(this._addLineNumbers(p)),"webgl2"===this._context.contextVersion&&(console.log("Shader source before transpilation:"),
console.log(m)));return d};b._matrix4Equal=function(d,b){return d[0]===b[0]&&d[1]===b[1]&&d[2]===b[2]&&d[3]===b[3]&&d[4]===b[4]&&d[5]===b[5]&&d[6]===b[6]&&d[7]===b[7]&&d[8]===b[8]&&d[9]===b[9]&&d[10]===b[10]&&d[11]===b[11]&&d[12]===b[12]&&d[13]===b[13]&&d[14]===b[14]&&d[15]===b[15]};b._matrix3Equal=function(d,b){return d[0]===b[0]&&d[1]===b[1]&&d[2]===b[2]&&d[3]===b[3]&&d[4]===b[4]&&d[5]===b[5]&&d[6]===b[6]&&d[7]===b[7]&&d[8]===b[8]};b._arraysEqual=function(d,b){if(d.length!==b.length)return!1;for(var h=
0;h<d.length;++h)if(d[h]!==b[h])return!1;return!0};b._arrayCopy=function(d){for(var b=[],f=0;f<d.length;++f)b.push(d[f]);return b};b._arrayAssign=function(d,b){for(var h=0;h<d.length;++h)b[h]=d[h]};b._nextId=0;return b}()})},"esri/views/webgl/ShaderTranspiler":function(){define(["require","exports","./reservedWordsGLSL3","./lib/glsl-tokenizer/string"],function(q,b,n,f){function k(d){return d.map(function(c){return"eof"!==c.type?c.data:""}).join("")}function d(b,c,a,h){h=h||a;for(var g=0;g<b.length;g++){var e=
b[g];if("ident"===e.type&&e.data===a)return h in c?c[h]++:c[h]=0,d(b,c,h+"_"+c[h],h)}return a}function h(d,c,a){void 0===a&&(a="afterVersion");var b={data:"\n",type:"whitespace"},g=function(a){return a<d.length?/[^\r\n]$/.test(d[a].data):!1},e=function(c){for(var d=-1,e=0,b=-1,g=0;g<c.length;g++){var h=c[g];"preprocessor"===h.type&&(h.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++e:h.data.match(/\#endif\s*.*/)&&--e);("afterVersion"===a||"afterPrecision"===a)&&"preprocessor"===h.type&&/^#version/.test(h.data)&&
(b=Math.max(b,g));if("afterPrecision"===a&&"keyword"===h.type&&"precision"===h.data){a:{for(h=g;h<c.length;h++){var l=c[h];if("operator"===l.type&&";"===l.data)break a}h=null}if(null===h)throw Error("precision statement not followed by any semicolons!");b=Math.max(b,h)}d<b&&0===e&&(d=g)}return d+1}(d);g(e-1)&&d.splice(e++,0,b);for(var h=0;h<c.length;h++){var f=c[h];d.splice(e++,0,f)}g(e-1)&&g(e)&&d.splice(e,0,b)}Object.defineProperty(b,"__esModule",{value:!0});var m=["GL_OES_standard_derivatives",
"GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];b.transpileShader=function(b,c){b=f(b);var a;a:{a="100";var l="300 es";void 0===a&&(a="100");void 0===l&&(l="300 es");for(var g=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,e=0;e<b.length;e++){var p=b[e];if("preprocessor"===p.type){var t=g.exec(p.data);if(t){g=t[1].replace(/\s\s+/g," ");if(g===l){a=g;break a}if(g===a){p.data="#version "+l;break a}throw Error("unknown glsl version: "+g);}}}b.splice(0,0,{type:"preprocessor",data:"#version "+
l},{type:"whitespace",data:"\n"});a=null}if("300 es"===a)throw Error("shader is already glsl 300 es");g=p=null;e={};t={};for(a=0;a<b.length;++a)switch(l=b[a],l.type){case "keyword":"vertex"===c&&"attribute"===l.data?l.data="in":"varying"===l.data&&(l.data="vertex"===c?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(l.data.trim())&&(l.data=l.data.replace(/(2D|Cube|EXT)/g,""));if("fragment"===c&&"gl_FragColor"===l.data){if(!p){var p=d(b,e,"fragColor"),r=void 0;void 0===
r&&(r="lowp");h(b,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:r},{type:"whitespace",data:" "},{type:"keyword",data:"vec4"},{type:"whitespace",data:" "},{type:"ident",data:p},{type:"operator",data:";"}],"afterPrecision")}l.data=p}else"fragment"===c&&"gl_FragDepthEXT"===l.data&&(g||(g=d(b,e,"gl_FragDepth")),l.data=g);break;case "ident":if(0<=n.indexOf(l.data)){if(r="vertex"===c)a:{for(r=a-1;0<=r;r--){var y=b[r];if("whitespace"!==y.type&&"block-comment"!==y.type)if("keyword"===
y.type){if("attribute"===y.data||"in"===y.data){r=!0;break a}}else break}r=!1}if(r)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");l.data in t||(t[l.data]=d(b,e,l.data));l.data=t[l.data]}}for(a=b.length-1;0<=a;--a)l=b[a],"preprocessor"===l.type&&((c=l.data.match(/\#extension\s+(.*)\:/))&&c[1]&&0<=m.indexOf(c[1].trim())&&(c=b[a+1],b.splice(a,c&&"whitespace"===c.type?2:1)),(c=l.data.match(/\#ifdef\s+(.*)/))&&c[1]&&0<=m.indexOf(c[1].trim())&&(l.data="#if 1"),
(c=l.data.match(/\#ifndef\s+(.*)/))&&c[1]&&0<=m.indexOf(c[1].trim())&&(l.data="#if 0"));return k(b)}})},"esri/views/webgl/reservedWordsGLSL3":function(){define(["require","exports"],function(q,b){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/string":function(){define(["./index"],function(q){"use strict;";return function(b){var n=q(),f=[],f=f.concat(n(b));return f=f.concat(n(null))}})},"esri/views/webgl/lib/glsl-tokenizer/index":function(){define(["./lib/literals","./lib/operators","./lib/builtins"],function(q,b,n){"use strict;";var f="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");return function(){function k(a){a.length&&y.push({type:f[e],
data:a,position:v,line:w,column:x})}function d(){r=r.length?[]:r;if("/"===t&&"*"===u)return v=g+l-1,e=0,t=u,l+1;if("/"===t&&"/"===u)return v=g+l-1,e=1,t=u,l+1;if("#"===u)return e=2,v=g+l,l;if(/\s/.test(u))return e=9,v=g+l,l;z=/\d/.test(u);A=/[^\w_]/.test(u);v=g+l;e=z?4:A?3:9999;return l}function h(){if(("\r"===u||"\n"===u)&&"\\"!==t)return k(r.join("")),e=999,l;r.push(u);t=u;return l+1}function m(){if("."===t&&/\d/.test(u))return e=5,l;if("/"===t&&"*"===u)return e=0,l;if("/"===t&&"/"===u)return e=
1,l;if("."===u&&r.length){for(;p(r););e=5;return l}if(";"===u||")"===u||"("===u){if(r.length)for(;p(r););k(u);e=999;return l+1}var a=2===r.length&&"\x3d"!==u;if(/[\w_\d\s]/.test(u)||a){for(;p(r););e=999;return l}r.push(u);t=u;return l+1}function p(a){var c=0,d,e;do{d=b.indexOf(a.slice(0,a.length+c).join(""));e=b[d];if(-1===d){if(0<c--+a.length)continue;e=a.slice(0,1).join("")}k(e);v+=e.length;r=r.slice(e.length);return r.length}while(1)}function c(){if("."===u||/[eE]/.test(u))return r.push(u),e=5,
t=u,l+1;if("x"===u&&1===r.length&&"0"===r[0])return e=11,r.push(u),t=u,l+1;if(/[^\d]/.test(u))return k(r.join("")),e=999,l;r.push(u);t=u;return l+1}function a(){"f"===u&&(r.push(u),t=u,l+=1);if(/[eE]/.test(u)||"-"===u&&/[eE]/.test(t))return r.push(u),t=u,l+1;if(/[^\d]/.test(u))return k(r.join("")),e=999,l;r.push(u);t=u;return l+1}var l=0,g=0,e=999,u,t,r=[],y=[],w=1,x=0,v=0,z=!1,A=!1,B="",C;return function(b){y=[];if(null!==b){b=b.replace?b.replace(/\r\n/g,"\n"):b;l=0;B+=b;for(C=B.length;u=B[l],l<
C;){b=l;switch(e){case 0:"/"===u&&"*"===t?(r.push(u),k(r.join("")),e=999):(r.push(u),t=u);l+=1;break;case 1:l=h();break;case 2:l=h();break;case 3:l=m();break;case 4:l=c();break;case 11:/[^a-fA-F0-9]/.test(u)?(k(r.join("")),e=999):(r.push(u),t=u,l+=1);break;case 5:l=a();break;case 9999:if(/[^\d\w_]/.test(u)){var f=r.join("");e=-1<q.indexOf(f)?8:-1<n.indexOf(f)?7:6;k(r.join(""));e=999}else r.push(u),t=u,l+=1;break;case 9:/[^\s]/g.test(u)?(k(r.join("")),e=999):(r.push(u),t=u,l+=1);break;case 999:l=d()}if(b!==
l)switch(B[b]){case "\n":x=0;++w;break;default:++x}}g+=l;B=B.slice(l);return y}r.length&&k(r.join(""));e=10;k("(eof)");return y}}})},"esri/views/webgl/lib/glsl-tokenizer/lib/literals":function(){define([],function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/lib/operators":function(){define([],function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})},"esri/views/webgl/lib/glsl-tokenizer/lib/builtins":function(){define([],function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})},
"esri/views/webgl/BufferObject":function(){define(["require","exports","../../core/has","../../core/typedArrayUtil"],function(q,b,n,f){return function(){function b(d,h,f,p,c){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=void 0;this._context=d;this._bufferType=h;this._usage=f;this._id=b._nextId++;this._glName=this._context.gl.createBuffer();n("esri-webgl-debug")&&d.instanceCounter.incrementCount(1);p&&this.setData(p,c)}b.createIndex=function(d,
h,f,p){return new b(d,34963,h,f,p)};b.createVertex=function(d,h,f){return new b(d,34962,h,f)};Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"usage",{get:function(){return this._usage},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"bufferType",{get:function(){return this._bufferType},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indexType",{get:function(){return this._indexType},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"byteSize",{get:function(){return 34962===this._bufferType?this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!0,configurable:!0});b.prototype.dispose=function(){this._context&&(this._glName&&
(this._context.gl.deleteBuffer(this._glName),this._glName=null),n("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(1),this._context=null)};b.prototype.setData=function(d,b){if(d){if("number"===typeof d){if(0>d&&console.error("Buffer size cannot be negative!"),34963===this._bufferType&&b)switch(this._indexType=b,this._size=d,b){case 5123:d*=2;break;case 5125:d*=4}}else b=d.byteLength,f.isUint16Array(d)&&(b/=2,this._indexType=5123),f.isUint32Array(d)&&(b/=4,this._indexType=5125),this._size=
b;b=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferData(this._bufferType,d,this._usage);this._context.bindVAO(b)}};b.prototype.setSubData=function(d,b,m,p){void 0===b&&(b=0);void 0===m&&(m=0);if(d){(0>b||b>=this._size)&&console.error("offset is out of range!");var c=b,a=m,h=p,g=d.byteLength;f.isUint16Array(d)&&(g/=2,c*=2,a*=2,h*=2);f.isUint32Array(d)&&(g/=4,c*=4,a*=4,h*=4);void 0===p&&(p=g-1);m>=p&&console.error("end must be bigger than start!");
b+m-p>this._size&&console.error("An attempt to write beyond the end of the buffer!");b=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);m=this._context.gl;d=ArrayBuffer.isView(d)?d.buffer:d;m.bufferSubData(this._bufferType,c,d.slice(a,h));this._context.bindVAO(b)}};b._nextId=0;return b}()})},"esri/views/webgl/renderState":function(){define(["require","exports","../../core/tsSupport/assignHelper"],function(q,b,n){function f(a){return v.intern(a)}function k(a){return z.intern(a)}
function d(a){return A.intern(a)}function h(a){return B.intern(a)}function m(a){return C.intern(a)}function p(a){return E.intern(a)}function c(a){return F.intern(a)}function a(a){return H.intern(a)}function l(a){return"["+a.join(",")+"]"}function g(a){return a?l([a.srcRgb,a.srcAlpha,a.dstRgb,a.dstAlpha,a.opRgb,a.opAlpha,a.color.r,a.color.g,a.color.b,a.color.a]):null}function e(a){return a?l([a.face,a.mode]):null}function u(a){return a?l([a.factor,a.units]):null}function t(a){return a?l([a.func]):
null}function r(a){return a?l([a.function.func,a.function.ref,a.function.mask,a.operation.fail,a.operation.zFail,a.operation.zPass]):null}function y(a){return a?l([a.zNear,a.zFar]):null}function w(a){return a?l([a.r,a.g,a.b,a.a]):null}function x(a){return a?l([a.mask]):null}Object.defineProperty(b,"__esModule",{value:!0});b.simpleBlendingParams=function(a,c,d,e){void 0===d&&(d=32774);void 0===e&&(e=[0,0,0,0]);return{srcRgb:a,srcAlpha:a,dstRgb:c,dstAlpha:c,opRgb:d,opAlpha:d,color:{r:e[0],g:e[1],b:e[2],
a:e[3]}}};b.separateBlendingParams=function(a,c,d,e,b,g,h){void 0===b&&(b=32774);void 0===g&&(g=32774);void 0===h&&(h=[0,0,0,0]);return{srcRgb:a,srcAlpha:c,dstRgb:d,dstAlpha:e,opRgb:b,opAlpha:g,color:{r:h[0],g:h[1],b:h[2],a:h[3]}}};b.backFaceCullingParams={face:1029,mode:2305};b.defaultDepthWriteParams={zNear:0,zFar:1};b.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};b.makeBlending=f;b.makeCulling=k;b.makePolygonOffset=d;b.makeDepthTest=h;b.makeStencilTest=m;b.makeDepthWrite=p;b.makeColorWrite=c;b.makeStencilWrite=
a;b.makePipelineState=function(a){return D.intern(a)};q=function(){function a(a,c){this.makeKey=a;this.makeRef=c;this.interns=new Map}a.prototype.intern=function(a){if(!a)return null;var c=this.makeKey(a),d=this.interns;d.has(c)||d.set(c,this.makeRef(a));return d.get(c)};return a}();var v=new q(g,function(a){return n({__tag:"Blending"},a)}),z=new q(e,function(a){return n({__tag:"Culling"},a)}),A=new q(u,function(a){return n({__tag:"PolygonOffset"},a)}),B=new q(t,function(a){return n({__tag:"DepthTest"},
a)}),C=new q(r,function(a){return n({__tag:"StencilTest"},a)}),E=new q(y,function(a){return n({__tag:"DepthWrite"},a)}),F=new q(w,function(a){return n({__tag:"ColorWrite"},a)}),H=new q(x,function(a){return n({__tag:"StencilWrite"},a)}),D=new q(function(a){return a?l([g(a.blending),e(a.culling),u(a.polygonOffset),t(a.depthTest),r(a.stencilTest),y(a.depthWrite),w(a.colorWrite),x(a.stencilWrite)]):null},function(e){return{blending:f(e.blending),culling:k(e.culling),polygonOffset:d(e.polygonOffset),depthTest:h(e.depthTest),
stencilTest:m(e.stencilTest),depthWrite:p(e.depthWrite),colorWrite:c(e.colorWrite),stencilWrite:a(e.stencilWrite)}});q=function(){function a(a){this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=a}a.prototype.setPipeline=function(a){if(this._pipelineInvalid||a!==this._pipeline)this.setBlending(a.blending),this.setCulling(a.culling),
this.setPolygonOffset(a.polygonOffset),this.setDepthTest(a.depthTest),this.setStencilTest(a.stencilTest),this.setDepthWrite(a.depthWrite),this.setColorWrite(a.colorWrite),this.setStencilWrite(a.stencilWrite),this._pipeline=a;this._pipelineInvalid=!1};a.prototype.invalidateBlending=function(){this._pipelineInvalid=this._blendingInvalid=!0};a.prototype.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};a.prototype.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=
!0};a.prototype.invalidateDepthTest=function(){this._pipelineInvalid=this._depthTestInvalid=!0};a.prototype.invalidateStencilTest=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};a.prototype.invalidateDepthWrite=function(){this._pipelineInvalid=this._depthWriteInvalid=!0};a.prototype.invalidateColorWrite=function(){this._pipelineInvalid=this._colorWriteInvalid=!0};a.prototype.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};a.prototype.setBlending=
function(a){this._blending=this.setSubState(a,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1};a.prototype.setCulling=function(a){this._culling=this.setSubState(a,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1};a.prototype.setPolygonOffset=function(a){this._polygonOffset=this.setSubState(a,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};a.prototype.setDepthTest=
function(a){this._depthTest=this.setSubState(a,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1};a.prototype.setStencilTest=function(a){this._stencilTest=this.setSubState(a,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};a.prototype.setDepthWrite=function(a){this._depthWrite=this.setSubState(a,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=
!1};a.prototype.setColorWrite=function(a){this._colorWrite=this.setSubState(a,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};a.prototype.setStencilWrite=function(a){this._stencilWrite=this.setSubState(a,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};a.prototype.setSubState=function(a,c,d,e){if(d||a!==c)e(a),this._pipelineInvalid=!0;return a};return a}();b.StateTracker=q})},"esri/views/webgl/Texture":function(){define(["require",
"exports","../../core/has"],function(q,b,n){return function(){function b(f,d,h){this._glName=this._context=null;this._id=-1;this._desc=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;this._boundToUnits=new Set;this._context=f;this._desc={pixelFormat:d.pixelFormat,internalFormat:d.internalFormat,dataType:d.dataType,target:d.target?d.target:3553,samplingMode:d.samplingMode?d.samplingMode:9729,wrapMode:d.wrapMode?d.wrapMode:10497,maxAnisotropy:d.maxAnisotropy,flipped:void 0!==d.flipped?d.flipped:
!1,hasMipmap:void 0!==d.hasMipmap?d.hasMipmap:!1,unpackAlignment:d.unpackAlignment?d.unpackAlignment:4,width:d.width,height:d.height,preMultiplyAlpha:void 0!==d.preMultiplyAlpha?d.preMultiplyAlpha:!1,textureCoordinateScaleFactor:d.textureCoordinateScaleFactor||null};this._id=++b._nextId;n("esri-webgl-debug")&&f.instanceCounter.incrementCount(0);this.setData(h)}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});b.prototype.dispose=function(){var b=this;if(this._context){if(this._glName){var d=this._context.gl;this._boundToUnits.forEach(function(d){b._context.bindTexture(null,d)});d.deleteTexture(this._glName);this._glName=null}n("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(0);this._context=null}};
b.prototype.resize=function(b,d){var h=this._desc;if(h.width!==b||h.height!==d)h.width=b,h.height=d,this.setData(null)};b.prototype.setData=function(f){var d=this._context.gl;this._glName||(this._glName=d.createTexture());void 0===f&&(f=null);null===f&&(this._desc.width=this._desc.width||4,this._desc.height=this._desc.height||4);var h=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var m=this._desc;b._validateTexture(m);d.pixelStorei(d.UNPACK_ALIGNMENT,m.unpackAlignment);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,
m.flipped?1:0);d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,m.preMultiplyAlpha?1:0);var p=m.pixelFormat,c=m.internalFormat?m.internalFormat:p;if(f instanceof ImageData||f instanceof HTMLImageElement||f instanceof HTMLCanvasElement||f instanceof HTMLVideoElement)m.width&&m.height&&console.assert(f.width===m.width&&f.height===m.height),d.texImage2D(d.TEXTURE_2D,0,c,p,m.dataType,f),m.hasMipmap&&this.generateMipmap(),void 0===this._desc.width&&(this._desc.width=f.width),void 0===this._desc.height&&
(this._desc.height=f.height);else{null!=m.width&&null!=m.height||console.error("Width and height must be specified!");d.DEPTH24_STENCIL8&&c===d.DEPTH_STENCIL&&(c=d.DEPTH24_STENCIL8);var a=m.width,l=m.height;if(null!=f&&"type"in f&&"compressed"===f.type){p=Math.round(Math.log(Math.max(a,l))/Math.LN2)+1;m.hasMipmap=m.hasMipmap&&p===f.levels.length;for(var g=0;;++g){d.compressedTexImage2D(d.TEXTURE_2D,g,c,a,l,0,f.levels[Math.min(g,f.levels.length-1)]);if(1===a&&1===l||!m.hasMipmap)break;a=Math.max(1,
a>>1);l=Math.max(1,l>>1)}}else if(f)d.texImage2D(d.TEXTURE_2D,0,c,a,l,0,p,m.dataType,f),m.hasMipmap&&this.generateMipmap();else for(g=0;;++g){d.texImage2D(d.TEXTURE_2D,g,c,a,l,0,p,m.dataType,null);if(1===a&&1===l||!m.hasMipmap)break;a=Math.max(1,a>>1);l=Math.max(1,l>>1)}}b._applySamplingMode(d,this._desc);b._applyWrapMode(d,this._desc);b._applyAnisotropicFilteringParameters(this._context,this._desc);this._context.bindTexture(h,0)};b.prototype.updateData=function(b,d,h,f,p,c){c||console.error("An attempt to use uninitialized data!");
this._glName||console.error("An attempt to update uninitialized texture!");var a=this._context.gl,l=this._desc,g=this._context.getBoundTexture(0);this._context.bindTexture(this,0);(0>d||0>h||f>l.width||p>l.height||d+f>l.width||h+p>l.height)&&console.error("An attempt to update out of bounds of the texture!");c instanceof ImageData||c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement?(console.assert(c.width===f&&c.height===p),a.texSubImage2D(a.TEXTURE_2D,b,
d,h,l.pixelFormat,l.dataType,c)):a.texSubImage2D(a.TEXTURE_2D,b,d,h,f,p,l.pixelFormat,l.dataType,c);this._context.bindTexture(g,0)};b.prototype.generateMipmap=function(){var f=this._desc;f.hasMipmap||(f.hasMipmap=!0,b._validateTexture(f));9729===f.samplingMode?(this._samplingModeDirty=!0,f.samplingMode=9985):9728===f.samplingMode&&(this._samplingModeDirty=!0,f.samplingMode=9984);f=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var d=this._context.gl;d.generateMipmap(d.TEXTURE_2D);
this._context.bindTexture(f,0)};b.prototype.setSamplingMode=function(f){f!==this._desc.samplingMode&&(this._desc.samplingMode=f,b._validateTexture(this._desc),this._samplingModeDirty=!0)};b.prototype.setWrapMode=function(f){f!==this._desc.wrapMode&&(this._desc.wrapMode=f,b._validateTexture(this._desc),this._wrapModeDirty=!0)};b.prototype.applyChanges=function(){var f=this._context.gl,d=this._desc;this._samplingModeDirty&&(b._applySamplingMode(f,d),this._samplingModeDirty=!1);this._wrapModeDirty&&
(b._applyWrapMode(f,d),this._wrapModeDirty=!1)};b.prototype.setBoundToUnit=function(b,d){d?this._boundToUnits.add(b):this._boundToUnits.delete(b)};b._isPowerOfTwo=function(b){return 0===(b&b-1)};b._validateTexture=function(f){(0>f.width||0>f.height)&&console.error("Negative dimension parameters are not allowed!");b._isPowerOfTwo(f.width)&&b._isPowerOfTwo(f.height)||("number"===typeof f.wrapMode?33071!==f.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):
33071===f.wrapMode.s&&33071===f.wrapMode.t||console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),f.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};b._applySamplingMode=function(b,d){var h=d.samplingMode,f=d.samplingMode;if(9985===h||9987===h)h=9729,d.hasMipmap||(f=9729);else if(9984===h||9986===h)h=9728,d.hasMipmap||(f=9728);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,h);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f)};b._applyWrapMode=
function(b,d){"number"===typeof d.wrapMode?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,d.wrapMode),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,d.wrapMode)):(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,d.wrapMode.s),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,d.wrapMode.t))};b._applyAnisotropicFilteringParameters=function(b,d){if(null!=d.maxAnisotropy){var h=b.capabilities.textureFilterAnisotropic;h&&(b=b.gl,b.texParameterf(b.TEXTURE_2D,h.TEXTURE_MAX_ANISOTROPY,d.maxAnisotropy))}};b._nextId=
0;return b}()})},"esri/views/webgl/Util":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/compilerUtils","../../core/Error"],function(q,b,n,f,k){function d(c){return c[0].stride}function h(c){switch(c){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw Error("Unknown data type");}}function m(c){switch(c){case 6406:case 6409:return 1;case 6410:return 2;case 6407:return 3;
case 6408:return 4;case 34041:return 4;case 33325:return 2;case 33326:return 4;case 35898:return 4;case 33327:return 4;case 33328:return 8;case 34842:return 8;case 34836:return 16;case 33189:return 2;case 34041:return 4;case 32854:return 2;case 36168:return 1;default:f.neverReached(c)}return 0}function p(c){if(!c)return 0;if("colorAttachment"in c)return c.glName?p(c.colorAttachment)+p(c.depthStencilAttachment):0;if("descriptor"in c)return c.glName?p(c.descriptor):0;var a=c.internalFormat||"pixelFormat"in
c&&c.pixelFormat;if(!a)return 0;var d="hasMipmap"in c&&c.hasMipmap?1.3:1;c=c.width*c.height;return m(a)*c*d}Object.defineProperty(b,"__esModule",{value:!0});b.vertexCount=function(c,a){return c.vertexBuffers[a].size/d(c.layout[a])};b.getStride=d;b.getBytesPerElement=h;b.addDescriptor=function(c,a,d,b,e,f){var g=h(b);if(0<c.length){var l=c[0].stride,m=l+g*d;c.forEach(function(a){return a.stride=m});c.push({name:a,count:d,type:b,offset:l,stride:m,normalized:e,divisor:f})}else c.push({name:a,count:d,
type:b,offset:0,stride:g*d,normalized:e,divisor:f})};b.assertCompatibleVertexAttributeLocations=function(c,a){(c=c.locations===a.locations)||console.error("VertexAttributeLocations are incompatible");return c};b.hasAttribute=function(c,a){for(var d=0;d<c.length;d++)if(c[d].name===a)return!0;return!1};b.findAttribute=function(c,a){for(var d=0;d<c.length;d++)if(c[d].name===a)return c[d];return null};b.copyFramebufferToTexture=function(c,a,d,b,e){void 0===e&&(e=0);var g=c.getBoundFramebufferObject(),
h=c.getBoundTexture(0);c.bindFramebuffer(a);c.bindTexture(d,0);c.gl.copyTexImage2D(c.gl.TEXTURE_2D,e,d.descriptor.pixelFormat,b[0],b[1],b[2],b[3],0);c.gl.flush();c.bindFramebuffer(g);c.bindTexture(h,0)};b.assert=function(c,a){if(!c)throw new k(a);};b.setBaseInstanceOffset=function(c,a){var d={},b;for(b in c)d[b]=c[b].map(function(c){return c.divisor?n({},c,{baseInstance:a}):c});return d};b.bindVertexBufferLayout=function(c,a,d,b,e){var g=c.gl,h=c.capabilities.instancing;c.bindBuffer(d);for(c=0;c<
b.length;c++){d=b[c];var f=a[d.name],l=(e?e:0+d.baseInstance?d.baseInstance:0)*d.stride;void 0===f&&console.error("There is no location for vertex attribute '"+d.name+"' defined.");d.baseInstance&&!d.divisor&&console.error("Vertex attribute '"+d.name+"' uses baseInstanceOffset without divisor.");if(4>=d.count)g.vertexAttribPointer(f,d.count,d.type,d.normalized,d.stride,d.offset+l),g.enableVertexAttribArray(f),d.divisor&&0<d.divisor&&h&&h.vertexAttribDivisor(f,d.divisor);else if(9===d.count)for(var m=
0;3>m;m++)g.vertexAttribPointer(f+m,3,d.type,d.normalized,d.stride,d.offset+12*m+l),g.enableVertexAttribArray(f+m),d.divisor&&0<d.divisor&&h&&h.vertexAttribDivisor(f+m,d.divisor);else if(16===d.count)for(m=0;4>m;m++)g.vertexAttribPointer(f+m,4,d.type,d.normalized,d.stride,d.offset+16*m+l),g.enableVertexAttribArray(f+m),d.divisor&&0<d.divisor&&h&&h.vertexAttribDivisor(f+m,d.divisor);else console.error("Unsupported vertex attribute element count: "+d.count)}};b.unbindVertexBufferLayout=function(c,a,
d,b){var e=c.gl,g=c.capabilities.instancing;c.bindBuffer(d);for(d=0;d<b.length;d++){var h=b[d],f=a[h.name];if(4>=h.count)e.disableVertexAttribArray(f),h.divisor&&0<h.divisor&&g&&g.vertexAttribDivisor(f,0);else if(9===h.count)for(var l=0;3>l;l++)e.disableVertexAttribArray(f+l),h.divisor&&0<h.divisor&&g&&g.vertexAttribDivisor(f+l,0);else if(16===h.count)for(l=0;4>l;l++)e.disableVertexAttribArray(f+l),h.divisor&&0<h.divisor&&g&&g.vertexAttribDivisor(f+l,0);else console.error("Unsupported vertex attribute element count: "+
h.count)}c.unbindBuffer(34962)};b.getBytesPerElementFormat=m;b.getGpuMemoryUsage=p})},"esri/views/webgl/VertexArrayObject":function(){define(["require","exports","../../core/has","./Util"],function(q,b,n,f){return function(){function b(d,h,f,p,c){this._locations=this._layout=this._glName=this._context=null;this._indexBuffer=this._buffers=void 0;this._initialized=!1;this._context=d;this._layout=f;this._buffers=p;this._locations=h;c&&(this._indexBuffer=c);this._id=b._nextId++;n("esri-webgl-debug")&&
d.instanceCounter.incrementCount(2)}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vertexBuffers",{get:function(){return this._buffers},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"size",{get:function(){var d=this;return Object.keys(this._buffers).reduce(function(b,f){return b+d._buffers[f].size},this._indexBuffer?this._indexBuffer.size:0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});b.prototype.dispose=function(d){void 0===d&&(d=!0);if(this._context){var b=this._context.capabilities.vao;
b&&this._glName&&(b.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(d){for(var f in this._buffers)this._buffers[f].dispose(),delete this._buffers[f];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}n("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(2);this._context=null}};b.prototype.initialize=function(){if(!this._initialized){var d=this._context.capabilities.vao;if(d){var b=d.createVertexArray();
d.bindVertexArray(b);this._bindLayout();d.bindVertexArray(null);this._glName=b}this._initialized=!0}};b.prototype.bind=function(){this.initialize();var d=this._context.capabilities.vao;d?d.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};b.prototype._bindLayout=function(){var d=this._buffers,b=!!this._context.capabilities.vao,m=this._layout,p=this._indexBuffer;d||console.error("Vertex buffer dictionary is empty!");var c=this._context.gl,a;for(a in d){var l=d[a];l||console.error("Vertex buffer is uninitialized!");
var g=m[a];g||console.error("Vertex element descriptor is empty!");f.bindVertexBufferLayout(this._context,this._locations,l,g)}p&&(b?c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,p.glName):this._context.bindBuffer(p))};b.prototype.unbind=function(){this.initialize();var d=this._context.capabilities.vao;d?d.bindVertexArray(null):this._unbindLayout()};b.prototype._unbindLayout=function(){var d=this._buffers,b=this._layout;d||console.error("Vertex buffer dictionary is empty!");for(var m in d){var p=d[m];p||console.error("Vertex buffer is uninitialized!");
f.unbindVertexBufferLayout(this._context,this._locations,p,b[m])}(d=this._indexBuffer)&&this._context.unbindBuffer(d.bufferType)};b._nextId=0;return b}()})},"esri/views/3d/environment/RealisticAtmosphere":function(){define("require exports ../../../core/Handles ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ./atmosphereUtils ../support/earthUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/shaders/RealisticAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/renderState ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v){q=function(){function b(c){this.needsRender=!1;this.didRender=!0;this.slot=12;this._hazeSlot=13;this._renderData={texDepth:h.vec2f64.create(),v3CameraPos:p.vec3f64.create(),v3CameraUp:p.vec3f64.create(),v3CameraRight:p.vec3f64.create(),v3CameraDir:p.vec3f64.create(),halfSizeNearPlane:h.vec2f64.create(),v2CameraCenterOffset:h.vec2f64.create(),v4SphereComp:a.vec4f64.create(),v4AtmosParams1:a.vec4f64.create(),v4AtmosParams2:a.vec4f64.create(),v4AtmosParams3:a.vec4f64.create(),
v3InvWavelength:A,v3InvWavelengthScaled:B,v4Radii:a.vec4f64.create(),fScale:0,fScaleDepth:C,fLowerAlphaBlendBound:0,fScaleOverScaleDepth:0,fOneOverScaleDepth:0,fScaleDepthBlue:E,fOneOverScaleDepthBlue:H,fScaleOverScaleDepthBlue:0,g:D,g2:D*D,fMiePhaseCoefficients:G,showTest:0,nearFar:h.vec2f64.create(),fCameraHeight:0,fCameraHeight2:0,fC:0,fCSur:0,fInnerFadeDistance:0,fAltitudeFade:0};this._lowerElevationBoundRadius=0;this._earthRadius=g.earthRadius;this.view=c;this._updateRadius(g.earthRadius)}b.prototype.destroy=
function(){this._handles&&(this._handles.destroy(),this._handles=null);this._hazeProgram&&(this._hazeProgram.dispose(),this._hazeProgram=null);this._skyProgram&&(this._skyProgram.dispose(),this._skyProgram=null);this._vao&&(this._vao.dispose(),this._vao=null)};b.prototype.when=function(a){return f.resolve().then(a)};b.prototype.initializeRenderContext=function(a){var c=this;a=a.rctx;this._handles=new n;this._updateElevation({spatialReference:this.view.basemapTerrain.spatialReference,tile:this.view.basemapTerrain.rootTiles[0],
extent:this.view.basemapTerrain.rootTiles[0].extent});this._handles.add(k.on(this.view,"basemapTerrain","elevation-change",function(a){return c._updateElevation(a)},function(){return c._updateElevation()}));this._handles.add(k.on(this.view,"basemapTerrain","elevation-bounds-change",function(){return c._updateVisibleElevationBounds()},function(){return c._updateVisibleElevationBounds()}));this._hazeProgram=y.createProgram(a,t.program,{haze:!0});this._skyProgram=y.createProgram(a,t.program);this._hazePipelineState=
w.makePipelineState({blending:w.separateBlendingParams(1,0,769,1),colorWrite:w.defaultColorWriteParams});this._skyPipelineState=w.makePipelineState({blending:w.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:w.defaultColorWriteParams});this._vao=this._createVertexArrayObject(a)};b.prototype.uninitializeRenderContext=function(a){this.destroy()};b.prototype.render=function(a){if(a.slot!==this._hazeSlot&&a.slot!==this.slot||0!==a.pass)return!1;this._update(a.camera);a.slot===this.slot&&
this._renderSky(a);a.slot===this._hazeSlot&&this._renderHaze(a);this.needsRender=!1;return!0};b.prototype._renderSky=function(a){var c=a.rctx,d=this._skyProgram;c.bindProgram(d);c.setPipelineState(this._skyPipelineState);d.setUniform4fv("v4AtmosParams3",this._renderData.v4AtmosParams3);this._renderCommon(d,a)};b.prototype._renderHaze=function(a){var c=this,d=a.rctx,e=a.offscreenRenderingHelper,b=this._hazeProgram;d.bindProgram(b);d.setPipelineState(this._hazePipelineState);e.renderDepthDetached(function(){d.bindTexture(e.depthTexture,
0);b.setUniform1i("tDepth",0);c._renderCommon(b,a)})};b.prototype._renderCommon=function(a,c){var d=c.rctx;a.setUniform3fv("v3InvWavelength",this._renderData.v3InvWavelength);a.setUniform3fv("v3InvWavelengthScaled",this._renderData.v3InvWavelengthScaled);a.setUniform3fv("v3LightDir",c.lightingData.direction);a.setUniform4fv("v4SphereComp",this._renderData.v4SphereComp);a.setUniform3fv("v3CameraPos",this._renderData.v3CameraPos);a.setUniform3fv("v3CameraUp",this._renderData.v3CameraUp);a.setUniform3fv("v3CameraRight",
this._renderData.v3CameraRight);a.setUniform3fv("v3CameraDir",this._renderData.v3CameraDir);a.setUniform2fv("nearFar",this._renderData.nearFar);a.setUniform2fv("halfSizeNearPlane",this._renderData.halfSizeNearPlane);a.setUniform2fv("v2CameraCenterOffset",this._renderData.v2CameraCenterOffset);a.setUniform4fv("v4Radii",this._renderData.v4Radii);a.setUniform4fv("v4AtmosParams1",this._renderData.v4AtmosParams1);a.setUniform4fv("v4AtmosParams2",this._renderData.v4AtmosParams2);a.setUniform1f("showTest",
this._renderData.showTest);a.setUniform1f("fInnerFadeDistance",this._renderData.fInnerFadeDistance);a.setUniform1f("fAltitudeFade",this._renderData.fAltitudeFade);d.bindVAO(this._vao);x.assertCompatibleVertexAttributeLocations(this._vao,a);d.drawArrays(5,0,4)};b.prototype._createVertexArrayObject=function(a){var c=K.createBuffer(4);c.position.setVec(0,[-1,-1,1]);c.position.setVec(1,[1,-1,1]);c.position.setVec(2,[-1,1,1]);c.position.setVec(3,[1,1,1]);c.uv0.setVec(0,[0,0]);c.uv0.setVec(1,[1,0]);c.uv0.setVec(2,
[0,1]);c.uv0.setVec(3,[1,1]);return new v(a,t.program.attributes,{geometry:e.glLayout(K)},{geometry:r.createVertex(a,35044,c.buffer)})};b.prototype._adjustRadiusForTesselation=function(a){return a*Math.cos(Math.PI/Math.pow(2,4)/16)};b.prototype._updateElevation=function(a){a=a?a.tile:this.view.basemapTerrain.rootTiles[0];0===a.lij[0]&&(a=this._adjustRadiusForTesselation(g.earthRadius+a.elevationBounds[0]),a!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=a,this._earthRadius=-1,
this._updateVisibleElevationBounds()))};b.prototype._updateVisibleElevationBounds=function(){var a=this._adjustRadiusForTesselation(g.earthRadius+this.view.basemapTerrain.getElevationBounds()[0]);(0>this._earthRadius||a<this._earthRadius)&&this._updateRadius(a)};b.prototype._updateRadius=function(a){this._earthRadius=a;var d=a*a,e=a/10*10.25,b=e*e,g=1/(e-a),h=g/C,f=g/E,m=.3*(e-a)+a,p=1/(e-m),r=this._renderData;c.vec4.set(r.v4AtmosParams1,g,C,h,F);c.vec4.set(r.v4AtmosParams2,D,E,f,H);c.vec4.set(r.v4AtmosParams3,
D*D,G,m,p);c.vec4.set(r.v4Radii,a,d,e,b);r.fScale=g;r.fLowerAlphaBlendBound=m;r.fScaleOverScaleDepth=h;r.fScaleOverScaleDepthBlue=f;d=l.INNER_ATMOSPHERE_DEPTH;r.fInnerFadeDistance=2*Math.sqrt((2*a-d)*d)};b.prototype._update=function(c){c&&(m.vec3.negate(this._renderData.v3CameraDir,c.viewForward),m.vec3.copy(this._renderData.v3CameraUp,c.viewUp),m.vec3.copy(this._renderData.v3CameraRight,c.viewRight),this._renderData.fCameraHeight=m.vec3.length(c.eye),this._renderData.fCameraHeight2=this._renderData.fCameraHeight*
this._renderData.fCameraHeight,this._renderData.fC=this._renderData.fCameraHeight2-this._renderData.v4Radii[3],this._renderData.fCSur=this._renderData.fCameraHeight2-this._renderData.v4Radii[1],this._renderData.v4SphereComp=a.vec4f64.fromValues(this._renderData.fCameraHeight,this._renderData.fCameraHeight2,this._renderData.fC,this._renderData.fCSur),m.vec3.copy(this._renderData.v3CameraPos,c.eye),d.vec2.set(this._renderData.halfSizeNearPlane,Math.tan(c.fovX/2)/(c.width/c.fullWidth),Math.tan(c.fovY/
2)/(c.height/c.fullHeight)),d.vec2.set(this._renderData.v2CameraCenterOffset,(c.padding[3]+c.width/2)/c.fullWidth-.5,(c.padding[2]+c.height/2)/c.fullHeight-.5),d.vec2.set(this._renderData.nearFar,c.near,c.far),this._renderData.fAltitudeFade=l.computeInnerAltitudeFade(this._renderData.fCameraHeight-this._earthRadius))};b.isSupported=function(a){return a.rctx.capabilities.depthTexture};return b}();b=.02*Math.PI;var z=.004*Math.PI,A=p.vec3f64.fromValues(1/Math.pow(.65,4),1/Math.pow(.57,4),1/Math.pow(.475,
4)),B=p.vec3f64.clone(A);m.vec3.scale(B,B,b);m.vec3.add(B,B,p.vec3f64.fromValues(z,z,z));var C=.25,E=.05,F=1/C,H=1/E,D=-.99999,G=(1-D*D)/(2+D*D)*1.5,K=u.newLayout().vec3f("position").vec2f("uv0");return q})},"esri/views/3d/environment/atmosphereUtils":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.computeInnerAltitudeFade=function(b){return Math.min(1,Math.max(0,(b-1E5)/9E5))};b.INNER_ATMOSPHERE_DEPTH=1E4})},"esri/views/3d/webgl-engine/shaders/RealisticAtmospherePrograms":function(){define(["require",
"exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});b.program={name:"realistic-atmosphere-color",shaders:function(d){return{vertexShader:k.glslifyDefineMap({HAZE:d.haze})+f.resolveIncludes("environment/realisticAtmosphere.vert"),fragmentShader:k.glslifyDefineMap({HAZE:d.haze})+f.resolveIncludes("environment/realisticAtmosphere.frag")}},attributes:n.Default3D}})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("require exports ../../../core/watchUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ./atmosphereUtils ./resources/SimpleAtmosphereTexture ../support/earthUtils ../support/imageUtils ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../webgl-engine/shaders/SimpleAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/renderState ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C){function E(a,c,d,e,b){var g=m.vec3.length(a),h=e*Math.sqrt(g*g-e*e)/g,f=b.silCircleV1,l=b.silCircleV2;m.vec3.scale(b.silCircleCenter,a,Math.sqrt(e*e-h*h)/g);m.vec3.cross(f,a,c);1>m.vec3.squaredLength(f)&&m.vec3.cross(f,a,d);m.vec3.scale(f,f,h/m.vec3.length(f));m.vec3.cross(l,f,a);m.vec3.scale(l,l,h/m.vec3.length(l));return h}function F(a,c,d,e){m.vec3.add(N,e.silCircleCenter,e.silCircleV2);m.vec3.scale(P,N,K);f.mat4.lookAt(O,c,N,d);y.project(N,
O,a.projectionMatrix,a.viewport);y.project(P,O,a.projectionMatrix,a.viewport);return m.vec3.distance(N,P)/a.height}var H=-c.INNER_ATMOSPHERE_DEPTH,D=(l.earthRadius+H)/l.earthRadius,G=(l.earthRadius+0)/l.earthRadius,K=(l.earthRadius+3E5)/l.earthRadius,M=e.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);q=function(){function b(a){this.needsRender=!1;this.didRender=!0;this.slot=12;this._renderData={texV:h.vec2f64.create(),silCircleCenter:p.vec3f64.create(),silCircleV1:p.vec3f64.create(),
silCircleV2:p.vec3f64.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._fadeVaoCount=0;this.view=a}b.prototype.when=function(a){return this._readyPromise.then(a)};b.prototype.initializeRenderContext=function(c){var d=this,e=c.rctx;this._cameraChangeHandle=n.init(this.view,"state.camera",function(){return d.needsRender=!0},!0);this._program=v.createProgram(e,w.colorPass);this._fadeProgram=v.createProgram(e,w.fadePass);this._vao=this._createRibbon(e);this._vaoCount=B.vertexCount(this._vao,
"geometry");this._fadeVao=r.createQuadVAO(e);this._fadeVaoCount=B.vertexCount(this._fadeVao,"geometry");this._readyPromise=g.requestImage(a).then(function(a){d._texture=new A(e,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},a);d.needsRender=!0});this._pipelineState=z.makePipelineState({blending:z.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:z.defaultColorWriteParams})};b.prototype.uninitializeRenderContext=function(a){this.destroy()};b.prototype.destroy=
function(){this._cameraChangeHandle&&(this._cameraChangeHandle.remove(),this._cameraChangeHandle=null);this._texture&&(this._texture.dispose(),this._texture=null);this._program&&(this._program.dispose(),this._program=null);this._fadeProgram&&(this._fadeProgram.dispose(),this._fadeProgram=null);this._fadeVao&&(this._fadeVao.dispose(),this._fadeVao=null);this._readyPromise&&(this._readyPromise.cancel(),this._readyPromise=null)};b.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass||null==
this._texture)return!1;this._update(a.camera);var c=a.rctx;c.setPipelineState(this._pipelineState);if(1>this._renderData.undergroundFadeAlpha){var d=this._program;c.bindProgram(d);d.setUniformMatrix4fv("proj",a.camera.projectionMatrix);d.setUniformMatrix4fv("view",a.camera.viewMatrix);d.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter);d.setUniform3fv("silCircleV1",this._renderData.silCircleV1);d.setUniform3fv("silCircleV2",this._renderData.silCircleV2);d.setUniform2fv("texV",this._renderData.texV);
c.bindTexture(this._texture,0);d.setUniform1i("tex",0);d.setUniform3fv("lightDirection",a.lightingData.direction);d.setUniform1f("altitudeFade",this._renderData.altitudeFade);d.setUniform1f("innerScale",this._renderData.innerScale);c.bindVAO(this._vao);c.drawArrays(4,0,this._vaoCount)}0<this._renderData.undergroundFadeAlpha&&(d=this._fadeProgram,c.bindProgram(d),d.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),d.setUniform3fv("lightDirection",a.lightingData.direction),
d.setUniform3fv("cameraPosition",a.camera.eye),c.bindVAO(this._fadeVao),c.drawArrays(5,0,this._fadeVaoCount));this.needsRender=!1;return!0};b.prototype._update=function(a){var b=p.vec3f64.create(),g=l.earthRadius,h=m.vec3.length(a.eye),f=h-g;this._renderData.undergroundFadeAlpha=0>f?Math.min(-f/5E3,1):0;var r=g+H,k=g+Math.max(50,f);this._renderData.innerScale=k*k/(Math.sqrt(k*k-g*g)*Math.sqrt(k*k-r*r)+g*r)-1;this._renderData.altitudeFade=c.computeInnerAltitudeFade(f);m.vec3.scale(b,a.eye,(g+50)/h);
E(b,a.center,a.up,g,this._renderData);b=F(a,b,a.up,this._renderData);h=M(f);r=.001953125;k=0+b*h*1;50<f&&(E(a.eye,a.center,a.up,g,this._renderData),a=F(a,a.eye,a.up,this._renderData),a=e.clamp((a-1.5)/(b-1.5),0,1),r=0+.001953125*a,k=0+1*e.lerp(1,b*h,a));d.vec2.set(this._renderData.texV,r,k)};b.prototype._createRibbon=function(a){var c=new Float32Array(1155),d=new Uint32Array(1920);c[0]=0;c[1]=0;c[2]=-1;for(var e=0;128>e;e++){var b=9*e+3;c[b+0]=e;c[b+1]=D;c[b+2]=-1;c[b+3]=e;c[b+4]=G;c[b+5]=0;c[b+6]=
e;c[b+7]=K;c[b+8]=1;var b=3*e+1,g=127===e?1:b+3,h=15*e;d[h+0]=b;d[h+1]=b+1;d[h+2]=g+1;d[h+3]=g+1;d[h+4]=g;d[h+5]=b;d[h+6]=b+1;d[h+7]=b+2;d[h+8]=g+2;d[h+9]=g+2;d[h+10]=g+1;d[h+11]=b+1;d[h+12]=b;d[h+13]=g;d[h+14]=0}b=L.createBuffer(d.length);g=b.position;for(e=0;e<d.length;++e)h=3*d[e],g.set(e,0,c[h]),g.set(e,1,c[h+1]),g.set(e,2,c[h+2]);return new C(a,w.colorPass.attributes,{geometry:u.glLayout(L)},{geometry:x.createVertex(a,35044,b.buffer)})};return b}();var O=k.mat4f64.create(),N=p.vec3f64.create(),
P=p.vec3f64.create(),L=t.newLayout().vec3f("position");return q})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("require exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(q,b,n,f,k,d,h){Object.defineProperty(b,"__esModule",{value:!0});b.createQuadVAO=function(d,b){void 0===b&&(b=f.Pos2);var c=null;switch(b){case f.Pos3Tex:c=new Float32Array([-1,-1,0,0,0,1,-1,
0,1,0,-1,1,0,0,1,1,1,0,1,1]);break;case f.Pos3:c=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);break;case f.Pos2Tex:c=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;default:c=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new h(d,n.Default3D,{geometry:b},{geometry:k.createVertex(d,35044,c)})};b.createEmptyTexture=function(b,h){void 0===h&&(h=4);return new d(b,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:h,height:h})};b.createColorTexture=function(b,h,c){void 0===
c&&(c=4);for(var a=new Uint8Array(c*c*4),f=0;f<a.length;f+=4)a[f+0]=255*h[0],a[f+1]=255*h[1],a[f+2]=255*h[2],a[f+3]=255*h[3];return new d(b,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:c,height:c},a)}})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}];b.Pos3Tex=[{name:"position",count:3,
type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}];b.Pos3NormalTex=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:32,normalized:!1}];b.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];b.Pos2=[{name:"position",
count:2,type:5126,offset:0,stride:8,normalized:!1}];b.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]})},"esri/views/3d/environment/Stars":function(){define("require exports ../../../request ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/shaders/StarsPrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/renderState ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r){var y=k.getLogger("esri.views.3d.environment.Stars");b=function(){function a(a){this.slot=12;this.numBinaryFloats=2;this.numBinaryUInt8=1;this.bytesPerStar=9;this.needsRender=!1;this.didRender=!0;this._numStars=0;this._modelMatrix=p.mat4f64.create();this.view=a;this._loadDataPromise=this._loadBrightStarCatalogue()}a.prototype.destroy=function(){this._loadDataPromise.isFulfilled()||this._loadDataPromise.cancel();this._dateHandle&&(this._dateHandle.remove(),
this._dateHandle=null);this._program&&(this._program.dispose(),this._program=null);this._vao&&(this._vao.dispose(),this._vao=null)};a.prototype.initializeRenderContext=function(a){var c=this,d=a.rctx;this._program=e.createProgram(d,l.program);this._pipelineState=u.makePipelineState({blending:u.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:u.defaultColorWriteParams});this._dateHandle=h.init(this.view,"environment.lighting.date",function(a){return c._update(a)});this._loadDataPromise.then(function(){c._numStars=
c._starData.byteLength/c.bytesPerStar;var a=new Float32Array(c._starData,0,c._numStars*c.numBinaryFloats),e=new Uint8Array(c._starData,c._numStars*c.numBinaryFloats*4,c._numStars*c.numBinaryUInt8);c._vao=c._createVertexArrayObject(d,a,e);c.needsRender=!0})};a.prototype.uninitializeRenderContext=function(a){this.destroy()};a.prototype.render=function(a){if(a.slot!==this.slot||0!==a.pass||null==this._starData)return!1;var c=a.rctx,d=this._program;c.bindProgram(d);a=a.camera;d.setUniformMatrix4fv("view",
a.viewMatrix);d.setUniformMatrix4fv("proj",a.projectionMatrix);d.setUniform4fv("viewport",a.fullViewport);d.setUniformMatrix4fv("model",this._modelMatrix);d.setUniform1f("pixelRatio",a.pixelRatio);c.setPipelineState(this._pipelineState);c.bindVAO(this._vao);t.assertCompatibleVertexAttributeLocations(this._vao,d);c.drawArrays(0,0,this._numStars);this.needsRender=!1;return!0};a.prototype._computeDayDuration=function(a){var c=new Date(a.getFullYear(),0,1,11,58,56),d=new Date(a.getFullYear()+1,0,1,11,
58,55);return(+a-+c)/(+d-+c)};a.prototype._update=function(a){if(a){var c=a.getHours()/12,d=a.getMinutes()/60*(2/24),e=a.getSeconds()/60*(2/1440),c=(c+d+e-.9972222)%2;a=2*this._computeDayDuration(a);d=this._modelMatrix;m.mat4.copy(d,v);m.mat4.rotateZ(d,d,-a*Math.PI);m.mat4.multiply(d,x,d);m.mat4.rotateZ(d,d,-c*Math.PI);this.needsRender=!0}};a.prototype._hexToRGB=function(a){return[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)]};a.prototype._unpackUint8Attributes=
function(a){return 192<=a?[2.9,a-192]:160<=a?[2.5,a-160]:128<=a?[2,a-128]:96<=a?[1.5,a-96]:64<=a?[1,a-64]:32<=a?[.7,a-32]:[.4,a]};a.prototype._createVertexArrayObject=function(a,d,e){for(var b=z.createBuffer(this._numStars),h=b.position,f=b.color,m=b.size,p=0;p<this._numStars;p++){var k=d[2*p+0],u=d[2*p+1];h.set(p,0,-Math.cos(k)*Math.sin(u));h.set(p,1,-Math.sin(k)*Math.sin(u));h.set(p,2,-Math.cos(u));k=this._unpackUint8Attributes(e[p]);u=this._hexToRGB(w[k[1]]);f.set(p,0,255*u[0]);f.set(p,1,255*u[1]);
f.set(p,2,255*u[2]);f.set(p,3,255);m.set(p,k[0])}return new r(a,l.program.attributes,{geometry:c.glLayout(z)},{geometry:g.createVertex(a,35044,b.buffer)})};a.prototype._verifyStartData=function(a){if(!a)throw new f("stars:no-data-received","Failed to create stars because star catalogue is missing");a=a.byteLength/this.bytesPerStar;if(0!==a%1||5E4<a||5E3>a)throw new f("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};a.prototype._loadBrightStarCatalogue=function(){var a=
this;return A?(this._starData=A,d.resolve()):n(q.toUrl("./resources/stars.wsv"),{responseType:"array-buffer"}).then(function(c){c=c.data;a._verifyStartData(c);A=c;a._starData=c}).catch(function(a){a&&"cancel"!==a.dojoType&&y.error("loadBrightStarCatalogue",a.message);throw a;})};return a}();var w="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),x=p.mat4f64.fromValues(1,
0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),v=p.mat4f64.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),z=a.newLayout().vec3f("position").vec4u8("color").f32("size"),A=null;return b})},"esri/views/3d/webgl-engine/shaders/StarsPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(q,b,n,f){Object.defineProperty(b,"__esModule",
{value:!0});b.program={name:"stars",shaders:{vertexShader:f.resolveIncludes("environment/stars.vert"),fragmentShader:f.resolveIncludes("environment/stars.frag")},attributes:n.Default3D}})},"esri/views/3d/support/sunUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../lib/SunCalc ./mathUtils".split(" "),function(q,b,n,f,k,d,h,m){function p(a,c,d,b){for(var e=
[],g=0;g<d.length;g++)e[g]=(b[g]-d[g])*a/c+d[g];return e}Object.defineProperty(b,"__esModule",{value:!0});b.settings={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};b.computeColorAndIntensity=function(a,c){var e,g,f,n,w=c.z,x=l;k.vec3.set(x.ambient.color,1,1,1);x.ambient.intensity=
b.settings.global.ambient;k.vec3.set(x.diffuse.color,1,1,1);x.diffuse.intensity=b.settings.global.diffuse;w=(Math.abs(w)-b.settings.local.altitude)/(b.settings.global.altitude-b.settings.local.altitude);w=m.clamp(w,0,1);x.globalFactor=w;c=h.getTimes(a,c.y,c.x);if(1>w){f=a.valueOf();var v,z;c.polarException===h.POLAR_EXCEPTION.MIDNIGHT_SUN?(v=f-36E5*(a.getHours()+48)-6E4*a.getMinutes(),z=v+432E6):c.polarException===h.POLAR_EXCEPTION.POLAR_NIGHT?(v=f-2,z=f-1):(v=c.sunrise.valueOf(),z=c.sunset.valueOf());
var A=z-v;n=v+A/2;g=A/4;e=n-g;g=n+g;var B=.06*A,A=v-B/2;v+=B/2;var C=z-B/2,q=z+B/2;z=b.settings.local;var F=[.01,z.ambientAtNight],H=[.8,.8,1],D=[.01,.01,.01],G=[z.diffuseAtTwilight,z.ambientAtTwilight],K=[1,.75,.75],M=[.8,.8,1],O=[.9*z.diffuseAtNoon,z.ambientAtNoon],N=[1,.98,.98],P=[.98,.98,1],L=[z.diffuseAtNoon,z.ambientAtNoon],T=[1,1,1],R=[1,1,1];z=[0,0];var J=[0,0,0],B=[0,0,0];f<A||f>q?(z=F,J=D,B=H):f<v?(B=v-A,z=p(f-A,B,F,G),J=p(f-A,B,D,K),B=p(f-A,B,H,M)):f<e?(B=e-v,z=p(f-v,B,G,O),J=p(f-v,B,K,
N),B=p(f-v,B,M,P)):f<n?(B=n-e,z=p(f-e,B,O,L),J=p(f-e,B,N,T),B=p(f-e,B,P,R)):f<g?(B=g-n,z=p(f-n,B,L,O),J=p(f-n,B,T,N),B=p(f-n,B,R,P)):f<C?(B=C-g,z=p(f-g,B,O,G),J=p(f-g,B,N,K),B=p(f-g,B,P,M)):f<q&&(B=q-C,z=p(f-C,B,G,F),J=p(f-C,B,K,D),B=p(f-C,B,M,H));f=z[0];n=d.vec3f64.fromValues(J[0],J[1],J[2]);e=z[1];g=d.vec3f64.fromValues(B[0],B[1],B[2]);k.vec3.lerp(x.ambient.color,g,x.ambient.color,w);x.ambient.intensity=m.lerp(e,x.ambient.intensity,w);k.vec3.lerp(x.diffuse.color,n,x.diffuse.color,w);x.diffuse.intensity=
m.lerp(f,x.diffuse.intensity,w)}w=a.valueOf();c.polarException===h.POLAR_EXCEPTION.MIDNIGHT_SUN?(a=w-36E5*(a.getHours()+48)-6E4*a.getMinutes(),c=a+432E6):c.polarException===h.POLAR_EXCEPTION.POLAR_NIGHT?(a=w-2,c=w-1):(a=c.sunrise.valueOf(),c=c.sunset.valueOf());a=1-m.clamp(Math.abs(w-(a+(c-a)/2))/432E5,0,1);x.noonFactor=a;return x};b.computeDirection=function(g,e,f,l){l||(l=d.vec3f64.create());var p=a,u=n.mat4.identity(c);if("global"===f)h.getPosition(g,0,0,p),k.vec3.set(l,0,0,-1),n.mat4.rotateX(u,
u,-p.azimuth),n.mat4.rotateY(u,u,-p.altitude);else{var t=b.settings.planarDirection;f=t.globalAngles;t=(Math.abs(e.z)-t.localAltitude)/(t.globalAltitude-t.localAltitude);t=m.clamp(t,0,1);1>t?(h.getPosition(g,e.y,e.x,p),p.azimuth=(1-t)*p.azimuth+t*f.azimuth,p.altitude=(1-t)*p.altitude+t*f.altitude):(p.azimuth=f.azimuth,p.altitude=f.altitude);k.vec3.set(l,0,-1,0);n.mat4.rotateZ(u,u,-p.azimuth);n.mat4.rotateX(u,u,-p.altitude)}k.vec3.transformMat4(l,l,u);return l};b.computeShadowsEnabled=function(a,c){return"global"===
c?!0:Math.abs(a.z)<b.settings.planarDirection.localAltitude};var c=f.mat4f64.create(),a={azimuth:0,altitude:0},l={ambient:{color:d.vec3f64.create(),intensity:0},diffuse:{color:d.vec3f64.create(),intensity:0,direction:d.vec3f64.create()},globalFactor:0,noonFactor:0}})},"esri/views/3d/lib/SunCalc":function(){define([],function(){function q(a){return new Date(864E5*(a+.5-2440588))}function b(c,d){return u(a(c)*l(w)-g(d)*a(w),l(c))}function n(c,d){return e(a(d)*l(w)+l(d)*a(w)*a(c))}function f(c,d,e){return u(a(c),
l(c)*a(d)-g(e)*l(d))}function k(c,d,b){return e(a(d)*a(b)+l(d)*l(b)*l(c))}function d(c){return r*(1.9148*a(c)+.02*a(2*c)+3E-4*a(3*c))}function h(a,e){a=r*(357.5291+.98560028*a);var g=d(a);a=a+g+102.9372*r+c;e||(e={dec:0,ra:0});e.dec=n(a,0);e.ra=b(a,0);return e}function m(c,d,e){return 2451545+c+.0053*a(d)-.0069*a(2*e)}function p(c){var d=r*(134.963+13.064993*c),e=r*(93.272+13.22935*c);c=r*(218.316+13.176396*c)+6.289*r*a(d);e=5.128*r*a(e);d=385001-20905*l(d);return{ra:b(c,e),dec:n(c,e),dist:d}}var c=
Math.PI,a=Math.sin,l=Math.cos,g=Math.tan,e=Math.asin,u=Math.atan2,t=Math.acos,r=c/180,y={dec:0,ra:0},w=23.4397*r,x={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(a,c,d,e){d=r*-d;c*=r;var b=a.valueOf()/864E5-.5+2440588-2451545;a=h(b,y);d=r*(280.16+360.9856235*b)-d-a.ra;e||(e={azimuth:0,altitude:0});e.azimuth=f(d,c,a.dec);e.altitude=k(d,c,a.dec);return e}},v=[[-.83,"sunrise","sunset"]];x.addTime=function(a,c,d){v.push([a,c,d])};x.getTimes=function(e,b,g){function h(d){var e=
p,b=y;d=t((a(d)-a(e)*a(b))/(l(e)*l(b)));return m(9E-4+(d+f)/(2*c)+k,u,z)}var f=r*-g,p=r*b,k=Math.round(e.valueOf()/864E5-.5+2440588-2451545-9E-4-f/(2*c));e=9E-4+(0+f)/(2*c)+k;var u=r*(357.5291+.98560028*e);b=d(u);var z=u+b+102.9372*r+c,y=n(z,0);e=m(e,u,z);b={solarNoon:q(e),nadir:q(e-.5),polarException:x.POLAR_EXCEPTION.NORMAL};var w,A,B,P;g=0;for(w=v.length;g<w;g+=1)A=v[g],B=h(A[0]*r),P=e-(B-e),b[A[1]]=q(P),b[A[2]]=q(B);b.polarException=function(c){c=(a(c)-a(p)*a(y))/(l(p)*l(y));return-1>c?x.POLAR_EXCEPTION.MIDNIGHT_SUN:
1<c?x.POLAR_EXCEPTION.POLAR_NIGHT:x.POLAR_EXCEPTION.NORMAL}(v[0][0]*r);return b};x.getMoonPosition=function(a,c,d){d=r*-d;c*=r;var e=a.valueOf()/864E5-.5+2440588-2451545;a=p(e);d=r*(280.16+360.9856235*e)-d-a.ra;e=k(d,c,a.dec);e+=.017*r/g(e+10.26*r/(e+5.1*r));return{azimuth:f(d,c,a.dec),altitude:e,distance:a.dist}};x.getMoonFraction=function(c){var d=c.valueOf()/864E5-.5+2440588-2451545;c=h(d);d=p(d);c=t(a(c.dec)*a(d.dec)+l(c.dec)*l(d.dec)*l(c.ra-d.ra));c=u(149598E3*a(c),d.dist-149598E3*l(c));return(1+
l(c))/2};return x})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3f64"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});q=function(){return function(b,k,d){void 0===b&&(b=n.vec3f64.create());void 0===k&&(k=n.vec3f64.fromValues(.57735,.57735,.57735));void 0===d&&(d=!0);this.intensity=b;this.direction=k;this.castShadows=d}}();b.MainLight=q;q=function(){return function(b,k){void 0===b&&(b=n.vec3f64.create());
void 0===k&&(k=n.vec3f64.fromValues(.57735,.57735,.57735));this.intensity=n.vec3f64.create();this.direction=n.vec3f64.create();this.intensity=b;this.direction=k}}();b.FillLight=q;q=function(){return function(b){void 0===b&&(b=n.vec3f64.create());this.intensity=b}}();b.AmbientLight=q;q=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();b.SphericalHarmonicsLight=q})},"esri/views/3d/input/SceneInputManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/ViewEvents ../../input/handlers/PreventContextMenu".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z){q=function(b){function k(){var a=null!==b&&b.apply(this,arguments)||this;a._handles=new d;return a}n(k,b);k.prototype.initialize=function(){this.viewEvents=new v.ViewEvents(this.view)};k.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this.disconnect()};Object.defineProperty(k.prototype,"primaryDragAction",{get:function(){return this._get("primaryDragAction")},set:function(a){"pan"!==a&&"rotate"!==a||
a===this._get("primaryDragAction")||(this._set("primaryDragAction",a),this._updateMode())},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"mode",{get:function(){return this._get("mode")},set:function(a){"default"!==a&&"pro"!==a||a===this._get("mode")||(this._set("mode",a),this._updateMode())},enumerable:!0,configurable:!0});k.prototype.disconnect=function(){this.viewEvents.disconnect();this._inputManager&&(this._inputManager.destroy(),this._inputManager=null);this._source&&(this._source.destroy(),
this._source=null)};k.prototype.connect=function(){var d=this.view;this._source=new w.BrowserEventSource(this.view.surface,d.input);var b=new x.InputManager(this._source);this._inputManager=b;b.installHandlers("prevent-context-menu",[new z.PreventContextMenu]);this._modeDragPan=new e.PinchAndPanNavigation(d,"primary");this._modeDragRotate=new p.DragRotate(d,"secondary","center");this._modeDragZoom=new c.DragZoom(d,"tertiary");b.installHandlers("navigation",[new u.PointerDownCancelAnimation(d),new m.DoubleClickZoom(d),
new a.GamepadNavigation(d),new l.KeyboardNavigation(d,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s"}),new g.MouseWheelZoom(d),new r.SingleKeyResetTilt(d,"p"),new t.SingleKeyResetHeading(d,"n"),new p.DragRotate(d,"primary","eye",["b"]),new p.DragRotate(d,"secondary","center",["b"]),new e.PinchAndPanNavigation(d,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new y.TwoFingerTilt(d)]);
this.viewEvents.connect(b);this._updateMode()};k.prototype._updateMode=function(){var a=this.primaryDragAction,a=A.get(this.mode).get(a);this._modeDragPan&&(this._modeDragPan.pointerAction=a.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=a.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=a.zoom)};Object.defineProperty(k.prototype,"debug",{get:function(){return{inputManager:this._inputManager}},enumerable:!0,configurable:!0});f([h.property()],k.prototype,"view",void 0);
f([h.property({value:"pan"})],k.prototype,"primaryDragAction",null);f([h.property({value:"default"})],k.prototype,"mode",null);f([h.property({readOnly:!0,aliasOf:"_inputManager.hasPendingInputs"})],k.prototype,"hasPendingInputs",void 0);f([h.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],k.prototype,"latestPointerType",void 0);f([h.property()],k.prototype,"_inputManager",void 0);return k=f([h.subclass("esri.views.3d.input.SceneInputManager")],k)}(h.declared(k));var A=new Map;b=
new Map;k=new Map;b.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});b.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});k.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});k.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});A.set("default",b);A.set("pro",k);return q})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(q,b,n,f,k,d,h,m){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function c(a,c){var d=b.call(this,!0)||this;d.view=a;d.registerIncoming("double-click",c,function(a){return d.handleDoubleClick(a)});return d}n(c,b);c.prototype.handleDoubleClick=function(a){var c=a.data;if(m.eventMatchesPointerAction(c,"primary")){var b=this.view.state.isGlobal?new k.ZoomStepController(this.view,"animation"):new d.ZoomStepController(this.view,"animation");this.view.state.switchCameraController(b);
b.zoomStep(Math.log(.5)/Math.log(.6),f.createScreenPointArray(c.x,c.y));a.stopPropagation()}};return c}(h.InputHandler);b.DoubleClickZoom=q})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function g(a,d){var e=b.call(this,a.state,a.sceneIntersectionHelper,"interaction"===d?null:void 0)||this;e.view=a;e.mode=d;e.zoomLocation=k.vec3f64.create();e.tmpCamera=new c;e.tmpViewDir=k.vec3f64.create();e.targetOnSphere=k.vec3f64.create();e.tmpCenter=k.vec3f64.create();e.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new c,interactionDirection:null,tiltMode:0};
e.sphere=p.sphere.create();return e}n(g,b);Object.defineProperty(g.prototype,"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});g.prototype.zoomStep=function(a,c){if(this.active){var d=this.view.state,e=this.constraintOptions.interactionStartCamera;this.animation.finished?e.copyFrom(d.camera):this.animation.cameraAt(1,e);e=!1;0<a&&this.intersectionHelper.intersectScreen(c,this.zoomLocation)&&(e=!0);this.tmpCamera.copyFrom(d.camera);e?this.intersectionHelper.intersectRay(this.tmpCamera.ray,
this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:f.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,c);this.begin(this.tmpCamera)}};g.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:a.outExpo}};g.prototype.updateCamera=function(a,c,b,g){this.sphere.radius=f.vec3.length(b);f.vec3.subtract(this.tmpViewDir,
a.center,a.eye);var e=f.vec3.length(this.tmpViewDir),h=e*c;1>=c&&4>h&&(h=4,c=h/e);1E-6>Math.abs(e-h)||(e=f.vec3.length(a.center),this.sphere.radius!==e&&f.vec3.scale(a.center,a.center,(this.sphere.radius+c*(e-this.sphere.radius))/e),f.vec3.scale(this.tmpViewDir,this.tmpViewDir,-c),f.vec3.add(a.eye,a.center,this.tmpViewDir),d.applyAll(this.view,a,this.constraintOptions),1E-12<f.vec3.squaredDistance(b,a.center)&&p.sphere.intersectScreen(this.sphere,a,g,this.targetOnSphere)&&m.panToPosition(this.sphere,
a,b,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0),d.applySurfaceCollision(this.view,a))};return g}(h.PointToPointAnimationController);b.ZoomStepController=q})},"esri/views/3d/camera/constraintUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/vec2 ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing ./constraintUtils/tilt ./constraintUtils/altitude ./constraintUtils/distance ./constraintUtils/surfaceCollision".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g){Object.defineProperty(b,"__esModule",{value:!0});b.applyTilt=c.apply;b.tiltError=c.error;b.applyAltitude=a.apply;b.altitudeError=a.error;b.applyDistance=l.apply;b.distanceError=l.error;b.applySurfaceCollision=g.apply;b.applyAll=function(a,c,d,b){void 0===d&&(d=u);void 0===b&&(b=c);var g=!1;b!==c&&b.copyFrom(c);b.markViewDirty();b.computeUp(a.state.mode);for(c=0;c<t;c++){for(var f=0,l=0,m=e;l<m.length;l++){var p=m[l];if(k.hasConstraintType(d.selection,p.type)){var r=
Math.abs(p.error(a,b,d));p.apply(a,b,d)&&(g=!0,f+=r)}}if(0===f)break}c=k.hasConstraintType(d.selection,8);a:switch(d.interactionType){case 4:d=1;break a;case 5:d=a.state.isGlobal?2:1;break a;default:d=0}c&&h.apply(a,b,d)&&(g=!0);g&&b.computeUp(a.state.mode);return g};b.pixelDistanceToInteractionFactor=function(a,c){a="number"===typeof a?a:n.vec2.distance(a,c);return p.inOutCubic(Math.min(1,a/150))};var e=[{type:1,error:function(a,c,d){return m.error(a,c,d)*c.distance},apply:m.apply},{type:2,error:f.error,
apply:f.apply},{type:4,error:d.error,apply:d.apply}],u={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0},t=5})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../support/geometryUtils ../../support/intersectionUtils ../../support/mathUtils".split(" "),function(q,b,n,f,k,d,h,m){function p(c,d,e){void 0===
e&&(e=k.defaultApplyOptions);var b;b=c.state.constraints.altitude;b=c.state.isGlobal&&b?2===e.interactionType&&k.hasConstraintType(e.selection,1)?!1:!0:!1;if(!b)return 0;var g=c.state.constraints.altitude;b=a;b.min=g.min;b.max=g.max;var h=e.interactionType;if(0!==h){var g=b.min,f=b.max,l=e.interactionStartCamera;e=e.interactionFactor;var h=2===h||1===h,r=p(c,l),l=0===r?0:c.renderCoordsHelper.getAltitude(l.eye);b.min=g;b.max=f;k.adjustRangeForInteraction(r,l,h,e,.05*l,b)}c=c.renderCoordsHelper.getAltitude(d.eye);
c=m.clamp(c,b.min,b.max)-c;return 1E-6>=Math.abs(c)?0:c}function c(a,c,d,e){a.renderCoordsHelper.worldUpAtPosition(c.eye,e);n.vec3.scale(e,e,d);return e}Object.defineProperty(b,"__esModule",{value:!0});b.apply=function(a,b,f,y){void 0===f&&(f=k.defaultApplyOptions);void 0===y&&(y=b);y!==b&&y.copyFrom(b);var r=p(a,b,f);if(0===r)return!1;var u=a.renderCoordsHelper,t=u.getAltitude(b.eye)+r;a=k.interactionDirectionTowardsConstraintMinimization(a,b,f.interactionDirection,c(a,b,m.sign(r),g),l);f=n.vec3.copy(e,
b.viewForward);u.intersectInfiniteManifold(d.ray.wrap(b.eye,a),t,y.eye)||u.setAltitude(t,y.eye);h.closestPointOnRay(b.eye,f,b.center,b.center);y.markViewDirty();return!0};b.error=p;var a={min:0,max:0},l=f.vec3f64.create(),g=f.vec3f64.create(),e=f.vec3f64.create()})},"esri/views/3d/camera/constraintUtils/common":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../../support/mathUtils"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});b.hasConstraintType=
function(b,d){return 0!==(b&d)};b.adjustRangeForInteraction=function(b,d,h,f,p,c){0!==b&&(h?(c.min=Math.min(c.min,d),c.max=Math.max(c.max,d)):null!=f?(c.min-=Math.max(0,(d-c.min)*(1-f)),c.max+=Math.max(0,(d-c.max)*(1-f))):p&&(c.min-=Math.max(0,d-c.min-p),c.max+=Math.max(0,d-c.max-p)))};b.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};b.interactionDirectionTowardsConstraintMinimization=function(b,d,h,m,p){h||
(h=d.viewForward);n.vec3.copy(p,h);n.vec3.scale(p,p,f.sign(n.vec3.dot(h,m)));return p}})},"esri/views/3d/support/intersectionUtils":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec2f64","../../../core/libs/gl-matrix-2/vec3","../../../core/libs/gl-matrix-2/vec3f64"],function(q,b,n,f,k){function d(c,a,d,b){var e=p;c?(d&&b&&(e.len=f.vec3.distance(a,d)),f.vec3.copy(e.dir,c)):b?(e.len=f.vec3.distance(a,d),f.vec3.subtract(e.dir,d,a),f.vec3.scale(e.dir,e.dir,1/e.len)):(f.vec3.subtract(e.dir,
d,a),f.vec3.normalize(e.dir,e.dir));return e}function h(c,a){return-f.vec3.dot(a,c)-c[3]}function m(c,a,d,b){b.clip[0]=0;b.clip[1]=d?b.len:Number.MAX_VALUE;for(d=0;d<c.length;d++){var e;var g=c[d],l=a;e=b;var m=f.vec3.dot(g,e.dir),g=h(g,l);0>g&&0<=m?e=!1:-1E-6<m&&1E-6>m?e=0<g:!(0>g||0>m)||0>g&&0>m?(g/=m,0<m?g<e.clip[1]&&(e.clip[1]=g):g>e.clip[0]&&(e.clip[0]=g),e=e.clip[0]<=e.clip[1]):e=!0;if(!e)return!1}return!0}Object.defineProperty(b,"__esModule",{value:!0});b.planeSphere=function(c,a,d){return c[0]*
a[0]+c[1]*a[1]+c[2]*a[2]+c[3]<d};b.frustumSphere=function(c,a,d){var b=a[0],e=a[1];a=a[2];return c[0][0]*b+c[0][1]*e+c[0][2]*a+c[0][3]>d||c[1][0]*b+c[1][1]*e+c[1][2]*a+c[1][3]>d||c[2][0]*b+c[2][1]*e+c[2][2]*a+c[2][3]>d||c[3][0]*b+c[3][1]*e+c[3][2]*a+c[3][3]>d||c[4][0]*b+c[4][1]*e+c[4][2]*a+c[4][3]>d||c[5][0]*b+c[5][1]*e+c[5][2]*a+c[5][3]>d?!1:!0};b.frustumRay=function(c,a,b,g){b=d(g,a,b,!1);return m(c,a,null,b)};b.frustumPoint=function(c,a){for(var d=0;6>d;d++)if(0>h(c[d],a))return!1;return!0};b.frustumLineSegment=
function(c,a,b,g){g=d(g,a,b,!0);return m(c,a,b,g)};b.closestPointOnRay=function(c,a,d,b){d=f.vec3.dot(a,f.vec3.subtract(b,d,c));f.vec3.add(b,c,f.vec3.scale(b,a,d));return b};var p={dir:k.vec3f64.create(),len:0,clip:n.vec2f64.create()}})},"esri/views/3d/camera/constraintUtils/distance":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../support/geometryUtils ../../support/mathUtils".split(" "),function(q,b,n,f,k,d,h){function m(a,
c,d){void 0===d&&(d=k.defaultApplyOptions);if(!a.state.isLocal)return 0;var e=a.state.constraints.distance;if(!a.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===e)return 0;p.min=0;p.max=e;var e=p,b=d.interactionType;if(0!==b){var g=e.min,h=e.max,f=d.interactionStartCamera;d=d.interactionFactor;var b=1===b||4===b,l=m(a,f),f=0===l?0:n.vec3.distance(f.eye,a.pointsOfInterest.surfaceOrigin.renderLocation);e.min=g;e.max=h;k.adjustRangeForInteraction(l,f,b,d,.05*f,e)}a=n.vec3.distance(c.eye,a.pointsOfInterest.surfaceOrigin.renderLocation);
a=p.max-a;return-1E-6<=a?0:a}Object.defineProperty(b,"__esModule",{value:!0});b.error=m;b.apply=function(e,b,f,p){void 0===f&&(f=k.defaultApplyOptions);void 0===p&&(p=b);p!==b&&p.copyFrom(b);var r=m(e,b,f);if(0===r)return!1;var u=e.pointsOfInterest.surfaceOrigin,r=n.vec3.distance(b.eye,e.pointsOfInterest.surfaceOrigin.renderLocation)+r,t=n.vec3.copy(c,b.eye);f=k.interactionDirectionTowardsConstraintMinimization(e,b,f.interactionDirection,h.directionFromTo(g,b.eye,e.pointsOfInterest.surfaceOrigin.renderLocation),
l);return d.sphere.intersectRay(d.sphere.wrap(r,u.renderLocation),d.ray.wrap(b.eye,f),p.eye)?(b=n.vec3.subtract(a,p.eye,t),n.vec3.add(p.center,p.center,b),p.markViewDirty(),b=e.renderCoordsHelper.getAltitude(p.center),e.renderCoordsHelper.intersectInfiniteManifold(p.ray,b,p.center),p.markViewDirty(),!0):!1};var p={min:0,max:0},c=f.vec3f64.create(),a=f.vec3f64.create(),l=f.vec3f64.create(),g=f.vec3f64.create()})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["require",
"exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64","../intersectionUtils"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});b.apply=function(b,f,p,c){void 0===p&&(p=0);void 0===c&&(c=f);var a=b.state.constraints;f!==c&&c.copyFrom(f);if(!a.collision.enabled)return!1;var h=k.surfaceElevationBelowEye(b,f);f=b.renderCoordsHelper.getAltitude(f.eye);a=h+a.collision.elevationMargin;if(f>=a)return!1;h=n.vec3.length(c.eye);n.vec3.subtract(d,c.center,
c.eye);b.renderCoordsHelper.setAltitude(a,c.eye);1===p?n.vec3.add(c.center,c.eye,d):2===p&&n.vec3.scale(c.center,c.center,(h-f+a)/h);c.markViewDirty();return!0};var d=f.vec3f64.create()})},"esri/views/3d/camera/intersectionUtils":function(){define("require exports ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../support/earthUtils ../webgl-engine/lib/Intersector".split(" "),function(q,b,n,f,k,d,h,m){function p(a,
c){return a.renderCoordsHelper.fromRenderCoords(c,u,a.basemapTerrain.spatialReference)?a.basemapTerrain.getElevation(u)||0:0}function c(a,c,d){if(!a.state.isGlobal)return!1;var e=p(a,c);a=a.stateManager.constraintsManager.nearFarHeuristic.compute(c,d,a.dataExtent,e,r).far;a*=a;return n.vec3.squaredDistance(c,d)>a}function a(a,d,e){void 0===e&&(e=f.vec3f64.create());var b=l[a.viewingMode];b||(b=new m(a.viewingMode),b.enable.backfacesTerrain=!a.state.isGlobal,b.enable.invisibleTerrain=!0,l[a.viewingMode]=
b);var g=a.state.isGlobal;return a.sceneIntersectionHelper.intersectRay(d,e,null,b)&&!c(a,d.origin,e)?!0:!a.renderCoordsHelper.intersectManifold(d,0,e)||c(a,d.origin,e)?g?(a=e,e=n.vec3.dot(d.origin,d.origin)-h.earthRadius*h.earthRadius,n.vec3.scale(a,d.direction,(0<e?Math.sqrt(e)/3:1)/n.vec3.length(d.direction)),n.vec3.add(a,a,d.origin),!0):!1:!0}Object.defineProperty(b,"__esModule",{value:!0});b.eyeWithinExtent=function(a,c,e,b){return a.renderCoordsHelper.fromRenderCoords(c.eye,g,b)&&d.containsPoint(e,
g)};b.surfaceElevationBelowEye=function(a,c){return p(a,c.eye)};b.cameraOnContentAlongViewDirection=function(c,d,b,g){var h=c.state.camera.copy();d&&(h.eye=d);b&&(h.center=b);g&&(h.up=g);a(c,h.ray,e)||n.vec3.copy(e,h.center);b=c.state.constraints;g=b.minimumPoiDistance;n.vec3.squaredDistance(h.eye,e)<g&&(d=b.collision.enabled,n.vec3.copy(t,h.viewForward),n.vec3.scale(t,t,g),d?n.vec3.subtract(h.eye,e,t):n.vec3.add(e,h.eye,t),c=c.renderCoordsHelper,g=c.getAltitude(h.eye),b=b.collision.elevationMargin,
d&&g<b&&(n.vec3.subtract(t,e,h.eye),c.setAltitude(b,h.eye),n.vec3.add(e,h.eye,t)));h.center=e;return h};var l={},g=f.vec3f64.create(),e=f.vec3f64.create(),u=new k,t=f.vec3f64.create(),r={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("require exports ../../../../core/has ../../../../core/now ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./intersectorUtils".split(" "),
function(q,b,n,f,k,d,h,m,p){var c=k.mat4f64.create();return function(){function a(a){this.enable=new p.EnableIntersectorOptions;this.results=new p.IntersectorResults;this.transform=new p.IntersectorTransform;this.performanceInfo={queryDuration:0,numObjectsTested:0};this._ray={origin:h.vec3f64.create(),direction:h.vec3f64.create()};this._rayEndPoint=h.vec3f64.create();this._rayStartPointTransformed=h.vec3f64.create();this._rayEndPointTransformed=h.vec3f64.create();this.viewingMode=a||"global"}Object.defineProperty(a.prototype,
"ray",{get:function(){return this._ray},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"rayBeginPoint",{get:function(){return this._ray.origin},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"rayEndPoint",{get:function(){return this._rayEndPoint},enumerable:!0,configurable:!0});a.prototype.intersect=function(a,c,e,b,h,f,p,k,n){var g=this;if(void 0===n||!0===n)this._numObjectsTested=0,m.ray.fromPoints(c,e,this._ray),this.results.init(this._ray);this.point=b;this.camera=
h;this.enable.selectionMode=p;this.filterPredicate=k;this.tolerance=null==f?1E-5:f;d.vec3.add(this._rayEndPoint,this._ray.origin,this._ray.direction);if(a&&0<a.length)for(c=0;c<a.length;c++)if(e=a[c],b=e.getSpatialQueryAccelerator?e.getSpatialQueryAccelerator():void 0)e=function(a){g.intersectObject(a)},b.forEachAlongRay(this._ray.origin,this._ray.direction,e),p&&b.forEachDegenerateObject(e);else for(b=0,e=e.getObjects();b<e.length;b++)this.intersectObject(e[b]);this.sortResults()};a.prototype.intersectObject=
function(a){var b=this;this._numObjectsTested++;for(var e=a.id,h=a.getGeometryRecords(),f=a.objectTransformation,l,m=function(g){g=h[g];var m=g.geometry,r=g.material,u=g.instanceParameters;if(u.hidden)return"continue";l=m.id;k.transform.setAndInvalidateLazyTransforms(f,g.getShaderTransformation());d.vec3.transformMat4(k._rayStartPointTransformed,k._ray.origin,k.transform.inverse);d.vec3.transformMat4(k._rayEndPointTransformed,k._rayEndPoint,k.transform.inverse);var t=k.transform.transform;r.intersect(m,
u,k.transform.transform,k,k._rayStartPointTransformed,k._rayEndPointTransformed,function(d,g,h,f,m,k){0<=d&&(null==b.filterPredicate||b.filterPredicate(b._ray.origin,b._rayEndPoint,d))&&(m?(null==b.results.hud.dist||d<b.results.hud.dist)&&b.results.hud.set(a,e,d,g,c,f,k,l,h):(m=function(c){return c.set(a,e,d,g,t,f,null,l,h)},(null==b.results.min.drapedLayerOrder||f>=b.results.min.drapedLayerOrder)&&(null==b.results.min.dist||d<b.results.min.dist)&&m(b.results.min),(null==b.results.max.drapedLayerOrder||
f<b.results.max.drapedLayerOrder)&&(null==b.results.max.dist||d>b.results.max.dist)&&m(b.results.max),b.enable.storeAll&&(k=new p.IntersectorResult(b._ray),m(k),b.results.all.push(k))))},g.shaderTransformation)},k=this,n=0;n<h.length;n++)m(n)};a.prototype.sortResults=function(){this.results.all.sort(function(a,c){return a.dist!==c.dist?a.dist-c.dist:a.drapedLayerOrder!==c.drapedLayerOrder?(void 0!==a.drapedLayerOrder?a.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==c.drapedLayerOrder?c.drapedLayerOrder:
Number.MAX_VALUE):(void 0!==c.drapedLayerGraphicOrder?c.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==a.drapedLayerGraphicOrder?a.drapedLayerGraphicOrder:Number.MIN_VALUE)})};a.DEFAULT_TOLERANCE=1E-5;return a}()})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define("require exports ../../../../Graphic ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/geometryUtils/boundedPlane ./Object3D".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u){function t(a,c){return f.isNone(a)||null==a.layerUid?null:f.isSome(c.graphicsView)&&a.layerUid===c.graphicsView.mockLayerId?c.graphics:c.map.findLayerByUid(a.layerUid)}function r(a,c,d){if(f.isNone(a))return null;var e=t(a,c);return f.isNone(e)?null:e===c.graphics?f.isSome(c.graphicsView)?f.expect(c.graphicsView.getGraphicFromGraphicUid(a.graphicUid)):null:(c=c.allLayerViews.find(function(a){return a.layer===e}))?y(c,a,d):null}function y(a,c,d){return!a||a.suspended?
null:f.isSome(d)&&"getGraphicFromStageObject"in a?a.getGraphicFromStageObject(d.obj,d.triangleNr):"getGraphicFromGraphicUid"in a&&null!=c.graphicUid?a.getGraphicFromGraphicUid(c.graphicUid):null}Object.defineProperty(b,"__esModule",{value:!0});b.sliceFilterPredicate=function(a){return function(c,d,b){p.vec3.lerp(v,c,d,b);return!e.extrusionContainsPoint(a,v)}};q=function(){return function(){this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.storeAll=this.storeTerrainResults=this.backfacesTerrain=
!0}}();b.EnableIntersectorOptions=q;q=function(){function a(){this._transform=m.mat4f64.create();this._transformInverse=new w({value:this._transform},h.mat4.invert,m.mat4f64.create);this._transformInverseTranspose=new w(this._transformInverse,h.mat4.transpose,m.mat4f64.create);this._transformTranspose=new w({value:this._transform},h.mat4.transpose,m.mat4f64.create);this._transformInverseRotation=new w({value:this._transform},k.mat3.normalFromMat4Legacy,d.mat3f64.create)}a.prototype.invalidateLazyTransforms=
function(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};Object.defineProperty(a.prototype,"transform",{get:function(){return this._transform},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"inverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"inverseTranspose",{get:function(){return this._transformInverseTranspose.value},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"inverseRotation",{get:function(){return this._transformInverseRotation.value},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"transpose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0});a.prototype.setTransformMatrix=function(a){h.mat4.copy(this._transform,a)};a.prototype.multiplyTransform=function(a){h.mat4.multiply(this._transform,this._transform,a)};a.prototype.set=function(a){h.mat4.copy(this._transform,
a);this.invalidateLazyTransforms()};a.prototype.setAndInvalidateLazyTransforms=function(a,c){this.setTransformMatrix(a);this.multiplyTransform(c);this.invalidateLazyTransforms()};return a}();b.IntersectorTransform=q;var w=function(){function a(a,c,d){this.original=a;this.update=c;this.dirty=!0;this.transform=d()}a.prototype.invalidate=function(){this.dirty=!0};Object.defineProperty(a.prototype,"value",{get:function(){this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1);return this.transform},
enumerable:!0,configurable:!0});return a}();q=function(){function a(){this.min=new x;this.max=new x;this.hud=new x;this.terrain=new x}a.prototype.init=function(a){this.min.init(a);this.max.init(a);this.hud.init(a);this.terrain.init(a);this.all=[]};return a}();b.IntersectorResults=q;var x=function(){function d(a){this.normal=c.vec3f64.create();this.transformation=m.mat4f64.create();this._ray=g.ray.create();this.init(a)}Object.defineProperty(d.prototype,"ray",{get:function(){return this._ray},enumerable:!0,
configurable:!0});Object.defineProperty(d.prototype,"hasIntersectionPoint",{get:function(){return null!=this.dist},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"distanceInRenderSpace",{get:function(){if(null!=this.dist)return p.vec3.scale(z,this.ray.direction,this.dist),p.vec3.length(z)},enumerable:!0,configurable:!0});d.prototype.getIntersectionPoint=function(a){if(!this.hasIntersectionPoint)return!1;p.vec3.scale(z,this.ray.direction,this.dist);p.vec3.add(a,this.ray.origin,z);
return!0};d.prototype.getTransformedNormal=function(c){p.vec3.copy(A,this.normal);A[3]=0;a.vec4.transformMat4(A,A,this.transformation);p.vec3.copy(c,A);p.vec3.normalize(c,c);return c};d.prototype.set=function(a,d,e,b,g,f,l,m,k,r){a instanceof u&&(a={type:"stage",obj:a});this.dist=e;p.vec3.copy(this.normal,b);h.mat4.copy(this.transformation,g);this.target=a;this.name=d;this.drapedLayerOrder=f;this.center=l?c.vec3f64.clone(l):null;this.geometryId=m;this.triangleNr=k;this.drapedLayerGraphicOrder=r};
d.prototype.copyFrom=function(a){g.ray.copy(a._ray,this._ray);this.dist=a.dist;this.target=a.target;this.name=a.name;this.drapedLayerOrder=a.drapedLayerOrder;this.center=a.center?c.vec3f64.clone(a.center):null;this.geometryId=a.geometryId;this.triangleNr=a.triangleNr;this.intersector=a.intersector;this.drapedLayerGraphicOrder=a.drapedLayerGraphicOrder;p.vec3.copy(this.normal,a.normal);h.mat4.copy(this.transformation,a.transformation)};d.prototype.init=function(a){this.drapedLayerGraphicOrder=this.drapedLayerOrder=
this.name=this.target=this.dist=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="Stage";a?g.ray.copy(a,this._ray):this._ray=g.ray.create()};d.prototype.toOwner=function(a){if(!this.target)return null;switch(this.target.type){case "stage":var c=this.target.obj.getMetadata();return t(c,a);case "external":switch(this.intersector){case "PointRenderer":return c=this.target.metadata.layerUid,null!=c?a.map.findLayerByUid(c):null;case "LodRenderer":case "DrapedRenderer":return t(this.target.metadata,
a);case "TerrainRenderer":return a.map&&a.map.ground}}return null};d.prototype.toGraphic=function(a){if(!this.target)return null;switch(this.target.type){case "stage":var c=this.target.obj,d=this.triangleNr,e=c.getMetadata();return r(e,a,{obj:c,triangleNr:d});case "external":switch(this.intersector){case "PointRenderer":return d=this.target,c=a.computeMapPointFromVec3d(d.point),c=new n(c),d=d.metadata.layerUid,null!=d&&(a=a.map.findLayerByUid(d),c.layer=a,c.sourceLayer=a),c;case "LodRenderer":case "DrapedRenderer":return r(this.target.metadata,
a,null)}}return null};return d}();b.IntersectorResult=x;b.TERRAIN_ID="terrain";var v=c.vec3f64.create(),z=c.vec3f64.create(),A=l.vec4f64.create()})},"esri/core/libs/gl-matrix-2/mat3":function(){define(["require","exports","./math/mat3"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.mat3=n})},"esri/core/libs/gl-matrix-2/math/mat3":function(){define(["require","exports","./common"],function(q,b,n){function f(d,b,f){var h=b[0],c=b[1],a=b[2],l=b[3],g=b[4],e=b[5],m=b[6],k=b[7];b=b[8];
var r=f[0],n=f[1],w=f[2],x=f[3],v=f[4],z=f[5],A=f[6],B=f[7];f=f[8];d[0]=r*h+n*l+w*m;d[1]=r*c+n*g+w*k;d[2]=r*a+n*e+w*b;d[3]=x*h+v*l+z*m;d[4]=x*c+v*g+z*k;d[5]=x*a+v*e+z*b;d[6]=A*h+B*l+f*m;d[7]=A*c+B*g+f*k;d[8]=A*a+B*e+f*b;return d}function k(d,b,f){d[0]=b[0]-f[0];d[1]=b[1]-f[1];d[2]=b[2]-f[2];d[3]=b[3]-f[3];d[4]=b[4]-f[4];d[5]=b[5]-f[5];d[6]=b[6]-f[6];d[7]=b[7]-f[7];d[8]=b[8]-f[8];return d}Object.defineProperty(b,"__esModule",{value:!0});b.fromMat4=function(d,b){d[0]=b[0];d[1]=b[1];d[2]=b[2];d[3]=b[4];
d[4]=b[5];d[5]=b[6];d[6]=b[8];d[7]=b[9];d[8]=b[10];return d};b.copy=function(d,b){d[0]=b[0];d[1]=b[1];d[2]=b[2];d[3]=b[3];d[4]=b[4];d[5]=b[5];d[6]=b[6];d[7]=b[7];d[8]=b[8];return d};b.set=function(d,b,f,p,c,a,l,g,e,k){d[0]=b;d[1]=f;d[2]=p;d[3]=c;d[4]=a;d[5]=l;d[6]=g;d[7]=e;d[8]=k;return d};b.identity=function(d){d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=1;d[5]=0;d[6]=0;d[7]=0;d[8]=1;return d};b.transpose=function(d,b){if(d===b){var h=b[1],f=b[2],c=b[5];d[1]=b[3];d[2]=b[6];d[3]=h;d[5]=b[7];d[6]=f;d[7]=c}else d[0]=
b[0],d[1]=b[3],d[2]=b[6],d[3]=b[1],d[4]=b[4],d[5]=b[7],d[6]=b[2],d[7]=b[5],d[8]=b[8];return d};b.invert=function(d,b){var h=b[0],f=b[1],c=b[2],a=b[3],l=b[4],g=b[5],e=b[6],k=b[7];b=b[8];var t=b*l-g*k,r=-b*a+g*e,n=k*a-l*e,w=h*t+f*r+c*n;if(!w)return null;w=1/w;d[0]=t*w;d[1]=(-b*f+c*k)*w;d[2]=(g*f-c*l)*w;d[3]=r*w;d[4]=(b*h-c*e)*w;d[5]=(-g*h+c*a)*w;d[6]=n*w;d[7]=(-k*h+f*e)*w;d[8]=(l*h-f*a)*w;return d};b.adjoint=function(d,b){var h=b[0],f=b[1],c=b[2],a=b[3],l=b[4],g=b[5],e=b[6],k=b[7];b=b[8];d[0]=l*b-g*
k;d[1]=c*k-f*b;d[2]=f*g-c*l;d[3]=g*e-a*b;d[4]=h*b-c*e;d[5]=c*a-h*g;d[6]=a*k-l*e;d[7]=f*e-h*k;d[8]=h*l-f*a;return d};b.determinant=function(d){var b=d[3],f=d[4],p=d[5],c=d[6],a=d[7],l=d[8];return d[0]*(l*f-p*a)+d[1]*(-l*b+p*c)+d[2]*(a*b-f*c)};b.multiply=f;b.translate=function(d,b,f){var h=b[0],c=b[1],a=b[2],l=b[3],g=b[4],e=b[5],m=b[6],k=b[7];b=b[8];var r=f[0];f=f[1];d[0]=h;d[1]=c;d[2]=a;d[3]=l;d[4]=g;d[5]=e;d[6]=r*h+f*l+m;d[7]=r*c+f*g+k;d[8]=r*a+f*e+b;return d};b.rotate=function(d,b,f){var h=b[0],
c=b[1],a=b[2],l=b[3],g=b[4],e=b[5],m=b[6],k=b[7];b=b[8];var r=Math.sin(f);f=Math.cos(f);d[0]=f*h+r*l;d[1]=f*c+r*g;d[2]=f*a+r*e;d[3]=f*l-r*h;d[4]=f*g-r*c;d[5]=f*e-r*a;d[6]=m;d[7]=k;d[8]=b;return d};b.scale=function(d,b,f){var h=f[0];f=f[1];d[0]=h*b[0];d[1]=h*b[1];d[2]=h*b[2];d[3]=f*b[3];d[4]=f*b[4];d[5]=f*b[5];d[6]=b[6];d[7]=b[7];d[8]=b[8];return d};b.fromTranslation=function(d,b){d[0]=1;d[1]=0;d[2]=0;d[3]=0;d[4]=1;d[5]=0;d[6]=b[0];d[7]=b[1];d[8]=1;return d};b.fromRotation=function(d,b){var h=Math.sin(b);
b=Math.cos(b);d[0]=b;d[1]=h;d[2]=0;d[3]=-h;d[4]=b;d[5]=0;d[6]=0;d[7]=0;d[8]=1;return d};b.fromScaling=function(d,b){d[0]=b[0];d[1]=0;d[2]=0;d[3]=0;d[4]=b[1];d[5]=0;d[6]=0;d[7]=0;d[8]=1;return d};b.fromMat2d=function(d,b){d[0]=b[0];d[1]=b[1];d[2]=0;d[3]=b[2];d[4]=b[3];d[5]=0;d[6]=b[4];d[7]=b[5];d[8]=1;return d};b.fromQuat=function(d,b){var h=b[0],f=b[1],c=b[2];b=b[3];var a=h+h,l=f+f,g=c+c,h=h*a,e=f*a,f=f*l,k=c*a,t=c*l,c=c*g,a=b*a,l=b*l;b*=g;d[0]=1-f-c;d[3]=e-b;d[6]=k+l;d[1]=e+b;d[4]=1-h-c;d[7]=t-a;
d[2]=k-l;d[5]=t+a;d[8]=1-h-f;return d};b.normalFromMat4Legacy=function(d,b){var h=b[0],f=b[1],c=b[2],a=b[4],l=b[5],g=b[6],e=b[8],k=b[9];b=b[10];var t=b*l-g*k,r=-b*a+g*e,n=k*a-l*e,w=h*t+f*r+c*n;if(!w)return null;w=1/w;d[0]=t*w;d[1]=(-b*f+c*k)*w;d[2]=(g*f-c*l)*w;d[3]=r*w;d[4]=(b*h-c*e)*w;d[5]=(-g*h+c*a)*w;d[6]=n*w;d[7]=(-k*h+f*e)*w;d[8]=(l*h-f*a)*w;return d};b.normalFromMat4=function(d,b){var h=b[0],f=b[1],c=b[2],a=b[3],l=b[4],g=b[5],e=b[6],k=b[7],t=b[8],r=b[9],n=b[10],w=b[11],x=b[12],v=b[13],z=b[14];
b=b[15];var A=h*g-f*l,B=h*e-c*l,C=h*k-a*l,q=f*e-c*g,F=f*k-a*g,H=c*k-a*e,D=t*v-r*x,G=t*z-n*x,t=t*b-w*x,K=r*z-n*v,r=r*b-w*v,n=n*b-w*z,w=A*n-B*r+C*K+q*t-F*G+H*D;if(!w)return null;w=1/w;d[0]=(g*n-e*r+k*K)*w;d[1]=(e*t-l*n-k*G)*w;d[2]=(l*r-g*t+k*D)*w;d[3]=(c*r-f*n-a*K)*w;d[4]=(h*n-c*t+a*G)*w;d[5]=(f*t-h*r-a*D)*w;d[6]=(v*H-z*F+b*q)*w;d[7]=(z*C-x*H-b*B)*w;d[8]=(x*F-v*C+b*A)*w;return d};b.projection=function(d,b,f){d[0]=2/b;d[1]=0;d[2]=0;d[3]=0;d[4]=-2/f;d[5]=0;d[6]=-1;d[7]=1;d[8]=1;return d};b.str=function(d){return"mat3("+
d[0]+", "+d[1]+", "+d[2]+", "+d[3]+", "+d[4]+", "+d[5]+", "+d[6]+", "+d[7]+", "+d[8]+")"};b.frob=function(d){return Math.sqrt(Math.pow(d[0],2)+Math.pow(d[1],2)+Math.pow(d[2],2)+Math.pow(d[3],2)+Math.pow(d[4],2)+Math.pow(d[5],2)+Math.pow(d[6],2)+Math.pow(d[7],2)+Math.pow(d[8],2))};b.add=function(d,b,f){d[0]=b[0]+f[0];d[1]=b[1]+f[1];d[2]=b[2]+f[2];d[3]=b[3]+f[3];d[4]=b[4]+f[4];d[5]=b[5]+f[5];d[6]=b[6]+f[6];d[7]=b[7]+f[7];d[8]=b[8]+f[8];return d};b.subtract=k;b.multiplyScalar=function(d,b,f){d[0]=b[0]*
f;d[1]=b[1]*f;d[2]=b[2]*f;d[3]=b[3]*f;d[4]=b[4]*f;d[5]=b[5]*f;d[6]=b[6]*f;d[7]=b[7]*f;d[8]=b[8]*f;return d};b.multiplyScalarAndAdd=function(d,b,f,p){d[0]=b[0]+f[0]*p;d[1]=b[1]+f[1]*p;d[2]=b[2]+f[2]*p;d[3]=b[3]+f[3]*p;d[4]=b[4]+f[4]*p;d[5]=b[5]+f[5]*p;d[6]=b[6]+f[6]*p;d[7]=b[7]+f[7]*p;d[8]=b[8]+f[8]*p;return d};b.exactEquals=function(d,b){return d[0]===b[0]&&d[1]===b[1]&&d[2]===b[2]&&d[3]===b[3]&&d[4]===b[4]&&d[5]===b[5]&&d[6]===b[6]&&d[7]===b[7]&&d[8]===b[8]};b.equals=function(d,b){var f=d[0],h=d[1],
c=d[2],a=d[3],l=d[4],g=d[5],e=d[6],k=d[7];d=d[8];var t=b[0],r=b[1],y=b[2],w=b[3],x=b[4],v=b[5],z=b[6],A=b[7];b=b[8];return Math.abs(f-t)<=n.EPSILON*Math.max(1,Math.abs(f),Math.abs(t))&&Math.abs(h-r)<=n.EPSILON*Math.max(1,Math.abs(h),Math.abs(r))&&Math.abs(c-y)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(y))&&Math.abs(a-w)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(l-x)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(g-v)<=n.EPSILON*Math.max(1,Math.abs(g),Math.abs(v))&&Math.abs(e-
z)<=n.EPSILON*Math.max(1,Math.abs(e),Math.abs(z))&&Math.abs(k-A)<=n.EPSILON*Math.max(1,Math.abs(k),Math.abs(A))&&Math.abs(d-b)<=n.EPSILON*Math.max(1,Math.abs(d),Math.abs(b))};b.mul=f;b.sub=k})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils ./ComponentUtils ./GeometryRecord ./HighlightUtils ./IdGen ./ModelContentType ./Util".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g){var e=g.assert,u=f.mat4f64.create();q=function(){function b(a){void 0===a&&(a={});this._objectTransformation=f.mat4f64.create();this._bvObjectSpace=new t;this._bvWorldSpace=new t;this._bvDirty=!0;this._hasVolatileTransformation=!1;this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!0;this.id=b._idGen.gen(a.idHint);this.name=a.name;this.castShadow=null!=a.castShadow?a.castShadow:!0;this.metadata=a.metadata;this.objectTransformation=f.mat4f64.create();
this._initializeGeometryRecords(a.geometries,a.materials,a.transformations,a.origins)}Object.defineProperty(b.prototype,"objectTransformation",{get:function(){return this._objectTransformation},set:function(a){n.mat4.copy(this._objectTransformation,a);this._invalidateBoundingVolume();this._notifyDirty("objTransformation")},enumerable:!0,configurable:!0});b.prototype._initializeGeometryRecords=function(a,c,d,b){if(Array.isArray(a)){e(c.length===a.length,"Object3D: materials don't match geometries");
e(d.length===a.length,"Object3D: transformations don't match geometries");this.geometryRecords=Array(a.length);this.geometries=a.slice();for(var g=0;g<a.length;g++)this.geometryRecords[g]=new p(a[g],c[g],f.mat4f64.clone(d[g]),{},b&&b[g]);this._hasVolatileTransformation=!1}else this.geometryRecords=[],this.geometries=[]};Object.defineProperty(b.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(a){e(null==this._parentLayer||null==a,"Object3D can only be added to a single Layer");
this._parentLayer=a},enumerable:!0,configurable:!0});b.prototype.getNumGeometryRecords=function(){return this.geometryRecords.length};b.prototype.getFirstGeometryIndex=function(a){a=this.geometries.indexOf(a);e(-1<a,"Object3D.getFirstGeometryIndex: geometry not found");return a};b.prototype.findGeometryRecords=function(a){for(var c=[],d=0;d<this.geometries.length;d++)this.geometries[d]===a&&c.push(this.geometryRecords[d]);return c};b.prototype.getGeometryRecord=function(a){e(0<=a&&a<this.geometryRecords.length,
"Object3d.getGeometryDataByIndex: index out of range");return this.geometryRecords[a]};b.prototype.getGeometryRecords=function(){return this.geometryRecords};b.prototype.addGeometry=function(a,c,d,b,e,g){void 0===d&&(d=u);this.geometries.push(a);a=new p(a,c,f.mat4f64.clone(d),b||{},e,g);this.geometryRecords.push(a);this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.shaderTransformation});this._notifyDirty("objGeometryAdded",a);this._invalidateBoundingVolume();this._allComponentsVisibleDirty=
this._allComponentsHiddenDirty=!0;return a};b.prototype.hasGeometry=function(a){return-1<this.geometries.indexOf(a)};b.prototype.removeGeometry=function(a){var c=this.geometryRecords.splice(a,1)[0];this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.shaderTransformation});this.geometries.splice(a,1);this._notifyDirty("objGeometryRemoved",c);this._invalidateBoundingVolume();this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!0;return c};b.prototype.removeAllGeometries=
function(){for(;0<this.getNumGeometryRecords();)this.removeGeometry(0)};b.prototype.geometryVertexAttrsUpdated=function(a){this._notifyDirty("vertexAttrsUpdated",this.geometryRecords[a]);this._invalidateBoundingVolume()};b.prototype.areAllComponentsHidden=function(){if(this._allComponentsHiddenDirty){this._allComponentsHiddenDirty=!1;this._allComponentsHidden=!0;for(var a=0,c=this.geometryRecords;a<c.length;a++){var d=c[a];if(!m.isAllHidden(d.instanceParameters.componentVisibilities,d.geometry.data.componentOffsets)){this._allComponentsHidden=
!1;break}}}return this._allComponentsHidden};b.prototype.areAllComponentsVisible=function(){if(this._allComponentsVisibleDirty){this._allComponentsVisibleDirty=!1;this._allComponentsVisible=!0;for(var a=0,c=this.geometryRecords;a<c.length;a++){var d=c[a];if(!m.isAllVisible(d.instanceParameters.componentVisibilities,d.geometry.data.componentOffsets)){this._allComponentsVisible=!1;break}}}return this._allComponentsVisible};b.prototype.hasComponents=function(){for(var a=!1,c=0;c<this.geometries.length&&
!(a=m.hasComponents(this.geometries[c].data.componentOffsets));c++);return a};b.prototype.setComponentVisibility=function(a,c,d){c=m.updateVisibility(a.instanceParameters.componentVisibilities,a.geometry.data.componentOffsets,c,d);a.instanceParameters.componentVisibilities=c;this._notifyDirty("visibilityChanged",a);this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=!0};b.prototype.setHidden=function(a,c){a.instanceParameters.hidden=!!c;this._notifyDirty("visibilityChanged",a)};b.prototype.isHidden=
function(a){return!!a.instanceParameters.hidden};b.prototype.getComponentVisibility=function(a,c){return m.getVisibility(a.instanceParameters.componentVisibilities,c)};b.prototype.hideAllComponents=function(){if(this._allComponentsHiddenDirty||!this._allComponentsHidden){for(var a=0,c=this.geometryRecords;a<c.length;a++){var d=c[a],b=m.hideAllComponents(d.instanceParameters.componentVisibilities);d.instanceParameters.componentVisibilities=b}this._notifyDirty("visibilityChanged");this._allComponentsVisibleDirty=
this._allComponentsHiddenDirty=!1;this._allComponentsHidden=!0;this._allComponentsVisible=!1}};b.prototype.unhideAllComponents=function(){if(this._allComponentsVisibleDirty||!this._allComponentsVisible){for(var a=0,c=this.geometryRecords;a<c.length;a++){var d=c[a],b=m.unhideAllComponents(d.instanceParameters.componentVisibilities);d.instanceParameters.componentVisibilities=b}this._notifyDirty("visibilityChanged");this._allComponentsHidden=this._allComponentsVisibleDirty=this._allComponentsHiddenDirty=
!1;this._allComponentsVisible=!0}};b.prototype._setComponentHighlight=function(a,c,d,b){c=m.addHighlight(a.instanceParameters.componentHighlights,c,d,b);a.instanceParameters.componentHighlights=c};b.prototype.setComponentHighlight=function(a,d,b){var e=c.generateHighlightId();this._setComponentHighlight(a,d,b,e);this._notifyDirty("componentHighlightChanged");return e};b.prototype.highlightAllComponents=function(a){for(var d=c.generateHighlightId(),b=0,e=this.geometryRecords;b<e.length;b++)this._setComponentHighlight(e[b],
null,a,d);this._notifyDirty("componentHighlightChanged");return d};b.prototype.removeHighlights=function(a){for(var c=0,d=this.geometryRecords;c<d.length;c++){var b=d[c].instanceParameters,e=m.removeHighlight(b.componentHighlights,a);b.componentHighlights=e}this._notifyDirty("componentHighlightChanged")};b.prototype.getComponentFromTriangleNr=function(a,c){e(0<=a&&a<this.geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");return m.componentFind(this.geometryRecords[a].geometry.data.componentOffsets,
3*c)};b.prototype.setGeometryTransformation=function(a,c){e(0<=a&&a<this.geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var d=this.geometryRecords[a];c=new p(d.geometry,d.material,f.mat4f64.clone(c),d.instanceParameters);this.geometryRecords[a]=c;this._notifyDirty("objGeometryReplaced",[d,c]);this._invalidateBoundingVolume()};b.prototype.getCombinedStaticTransformation=function(a,c){c=c||f.mat4f64.create();n.mat4.multiply(c,this.objectTransformation,a.getStaticTransformation());
return c};b.prototype.getCombinedShaderTransformation=function(a,c){c=c||f.mat4f64.create();n.mat4.multiply(c,this.objectTransformation,a.getShaderTransformation());return c};b.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation};b.prototype.getCastShadow=function(){return this.castShadow};b.prototype.setCastShadow=function(a){this.castShadow=a};b.prototype.getMetadata=function(){return this.metadata};b.prototype.getName=function(){return this.name};b.prototype.getBBMin=
function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin};b.prototype.getBBMax=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax};b.prototype.getCenter=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.center:this._bvWorldSpace.center};b.prototype.getBSRadius=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius};b.prototype._validateBoundingVolume=
function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var a=0;a<this.geometryRecords.length;++a){var c=this.geometries[a],b=this.geometryRecords[a],c=c.boundingInfo;this._calculateTransformedBoundingVolume(c,this._bvObjectSpace,b.getShaderTransformation());this._calculateTransformedBoundingVolume(c,this._bvWorldSpace,this.getCombinedShaderTransformation(b))}k.vec3.lerp(this._bvObjectSpace.center,this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,
.5);k.vec3.lerp(this._bvWorldSpace.center,this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5);for(var b=d.vec3f64.create(),e=d.vec3f64.create(),g=h.maxScale(this.objectTransformation),a=0;a<this.geometryRecords.length;++a){var c=this.geometries[a],f=this.geometryRecords[a].getShaderTransformation(),l=h.maxScale(f),c=c.boundingInfo;k.vec3.transformMat4(b,c.getCenter(),f);f=k.vec3.distance(b,this._bvObjectSpace.center);c=c.getBSRadius()*l;this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,
f+c);k.vec3.transformMat4(e,b,this.objectTransformation);l=k.vec3.distance(e,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,l+c*g)}this._bvDirty=!1}};b.prototype._calculateTransformedBoundingVolume=function(a,c,b){var e=a.getBBMin();a=a.getBBMax();var g=d.vec3f64.clone(e),f=d.vec3f64.clone(a);k.vec3.transformMat4(g,g,b);k.vec3.transformMat4(f,f,b);for(var h=0;3>h;++h)c.bbMin[h]=Math.min(c.bbMin[h],g[h],f[h]),c.bbMax[h]=Math.max(c.bbMax[h],g[h],f[h]);for(h=
0;3>h;++h){k.vec3.copy(g,e);k.vec3.copy(f,a);g[h]=a[h];f[h]=e[h];k.vec3.transformMat4(g,g,b);k.vec3.transformMat4(f,f,b);for(var l=0;3>l;++l)c.bbMin[l]=Math.min(c.bbMin[l],g[l],f[l]),c.bbMax[l]=Math.max(c.bbMax[l],g[l],f[l])}};b.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0;this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})};b.prototype._notifyDirty=function(a,c,d,b){this._parentLayer&&(d=d||l.OBJECT,
this._parentLayer.notifyDirty(a,c,d,b||this))};b._idGen=new a;return b}();var t=function(){function a(){this.bbMin=d.vec3f64.create();this.bbMax=d.vec3f64.create();this.center=d.vec3f64.create();this.bsRadius=0}a.prototype.init=function(){k.vec3.set(this.bbMin,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);k.vec3.set(this.bbMax,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);k.vec3.set(this.center,0,0,0);this.bsRadius=0};a.prototype.getCenter=function(){return this.center};a.prototype.getBSRadius=
function(){return this.bsRadius};return a}();return q})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define(["require","exports","./IdGen"],function(q,b,n){return function(){function b(f,d,h,m,p,c){this.id=b._idGen.gen(f.id);this.geometry=f;this.material=d;this.transformation=h;this.instanceParameters=m;this.origin=p;this.shaderTransformation=c}b.prototype.getStaticTransformation=function(){return this.transformation};b.prototype.getShaderTransformation=function(){return this.shaderTransformation?
this.shaderTransformation(this.transformation):this.transformation};b._idGen=new n;return b}()})},"esri/views/3d/webgl-engine/lib/IdGen":function(){define(["require","exports"],function(q,b){return function(){function b(){this._count=0}b.prototype.gen=function(b){null==b&&(b="a");return b+"_"+this._count++};return b}()})},"esri/views/3d/webgl-engine/lib/HighlightUtils":function(){define(["require","exports","./IdGen"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});var f=new n;b.generateHighlightId=
function(){return f.gen("highlight")}})},"esri/views/3d/webgl-engine/lib/ModelContentType":function(){define(["require","exports"],function(q,b){return function(){function b(){}b.LAYER="layers";b.OBJECT="objects";b.GEOMETRY="geometries";b.MATERIAL="materials";b.TEXTURE="textures";return b}()})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("require exports ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./common ../../state/utils/viewUtils ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l){function g(a,c,b,h,l){void 0===b&&(b=m.defaultApplyOptions);void 0===h&&(h=c);void 0===l&&(l=!0);c!==h&&h.copyFrom(c);A.eyeCenterDistance=0;A.requiresTwoSteps=!1;var p=e(a,c,b,void 0,A);if(0===p)return!1;f.mat4.identity(y);f.mat4.rotate(y,y,-p,c.viewRight);switch(b.tiltMode){case 1:d.vec3.transformMat4(r,c.viewForward,y);d.vec3.scale(r,r,A.eyeCenterDistance);d.vec3.add(h.center,c.eye,r);break;case 0:d.vec3.subtract(r,c.center,c.eye);d.vec3.transformMat4(r,r,y);d.vec3.subtract(h.eye,
c.center,r);break;default:n.neverReached(b.tiltMode)}d.vec3.transformMat4(h.up,h.up,y);h.markViewDirty();return A.requiresTwoSteps&&l?g(a,h,b,h,!1):!0}function e(b,g,f,h,k){void 0===f&&(f=m.defaultApplyOptions);void 0===h&&(h=m.defaultApplyOptions);if(!b.state.constraints.tilt)return 0;var r=b.state.constraints.tilt(g.distance,v);var y=f;if(0!==y.interactionType){var A=y.interactionStartCamera,B=y.interactionFactor,C=r.min,q=r.max,H=e(b,A,m.defaultApplyOptions,y),E=0===H?0:p.viewAngle(b.renderCoordsHelper,
A.center,A.eye);r.min=C;r.max=q;2===y.interactionType?(m.hasConstraintType(y.selection,2)&&t(b,A,r),m.adjustRangeForInteraction(H,E,!0,B,x,r)):m.adjustRangeForInteraction(H,E,!1,B,x,r)}2===h.interactionType&&m.hasConstraintType(h.selection,2)&&t(b,h.interactionStartCamera,r);if(1===f.tiltMode||1===h.tiltMode){a:{k&&(k.requiresTwoSteps=!1);switch(b.viewingMode){case "global":f=z;y=b.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;h=y+c.earthRadius;y=b.renderCoordsHelper.intersectManifold(g.ray,
y,w);f.eyeCenterDistance=g.distance;y?(f.eyeCenterDistance=d.vec3.distance(g.eye,w),f.tiltAtCenter=p.viewAngle(b.renderCoordsHelper,w,g.eye)):b.state.isLocal?f.tiltAtCenter=p.viewAngle(b.renderCoordsHelper,g.center,g.eye):(a.sphere.closestPointOnSilhouette(a.sphere.wrap(h),g.ray,w),f.eyeCenterDistance=d.vec3.distance(g.eye,w),f.tiltAtCenter=l.acos(-d.vec3.dot(g.viewForward,d.vec3.normalize(w,w))));f.radius=h;f.eyeRadius=d.vec3.length(g.eye);f.constraints=b.state.constraints;f.centerIsOnSurface=y;
g=l.clamp(f.tiltAtCenter,r.min,r.max);if(1E-9<Math.abs(f.tiltAtCenter-g)){if(f.centerIsOnSurface){g=f.constraints;b=h=f.tiltAtCenter;r=g.clampTilt(f.eyeCenterDistance,h);y=u(f,r);if(g.clampTilt(y,h)!==r)for(h=0;10>h&&1E-9<Math.abs(r-b);)y=(b+r)/2,A=u(f,y),A=g.clampTilt(A,y),1E-9<Math.abs(A-y)?b=y:r=y,h++;g=r;r=g;b=l.asin(f.radius/f.eyeRadius*Math.sin(f.tiltAtCenter));r=l.asin(f.radius/f.eyeRadius*Math.sin(r));b=f.eyeRadius>f.radius?b-r:r-b}else g=f.constraints.clampTilt(f.eyeCenterDistance,f.tiltAtCenter),
k&&g<Math.PI/2&&(k.requiresTwoSteps=!0,g=Math.PI/2-1E-5),b=f.tiltAtCenter-Math.PI/2-(g-Math.PI/2);k&&(k.eyeCenterDistance=u(f,g));k=b}else k=0;break a;case "local":h=p.viewAngle(b.renderCoordsHelper,g.center,g.eye);f=l.clamp(h,r.min,r.max);r=h-f;1E-9<Math.abs(r)?(k&&(h=b.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,b=b.renderCoordsHelper.getAltitude(g.eye)-h,f=Math.cos(f),k.eyeCenterDistance=1E-4<Math.abs(f)?b/f:g.distance),k=r):k=0;break a;default:n.neverReached(b.viewingMode)}k=
void 0}return k}k=p.viewAngle(b.renderCoordsHelper,g.center,g.eye);g=l.clamp(k,r.min,r.max);k-=g;k=1E-9<Math.abs(k)?k:0;return k}function u(a,c){if(!a.centerIsOnSurface)return a.eyeCenterDistance;c=Math.PI-l.clamp(c,0,Math.PI);var d=l.asin(a.radius/a.eyeRadius*Math.sin(c)),b=Math.sin(Math.PI-c-d)/Math.sin(c);return a.eyeRadius<a.radius&&1<b?Math.sin(Math.PI-c-(Math.PI-d))/Math.sin(c)*a.eyeRadius:b*a.eyeRadius}function t(a,b,e){if(!a.state.isLocal){var g=a.state.constraints;if(g.altitude){a=d.vec3.squaredLength(b.center);
var f=Math.sqrt(a);b=b.distance;var h=g.altitude.min+c.earthRadius,g=g.altitude.max+c.earthRadius,h=(h*h-b*b-a)/(-2*f*b);e.min=Math.max(e.min,Math.min(Math.PI-l.acos((g*g-b*b-a)/(-2*f*b)),e.max));e.max=Math.min(e.max,Math.PI-l.acos(h))}}}Object.defineProperty(b,"__esModule",{value:!0});b.apply=g;b.error=e;var r=h.vec3f64.create(),y=k.mat4f64.create(),w=h.vec3f64.create(),x=l.deg2rad(5),v={min:0,max:0},z={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},
A={eyeCenterDistance:0,requiresTwoSteps:!1}})},"esri/views/3d/state/utils/viewUtils":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64","../../support/mathUtils"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});b.viewAngle=function(b,f,c){b.worldUpAtPosition(f,d);n.vec3.subtract(h,c,f);b=n.vec3.length(h);return 0===b?0:k.acos(n.vec3.dot(h,d)/b)};var d=f.vec3f64.create(),h=f.vec3f64.create()})},"esri/views/animation/easing":function(){define(["require",
"exports"],function(q,b){function n(d){return d}function f(d){var b=2*(d-Math.sqrt((d-1)*d)),f=b/2/d;return function(h){return h<f?d*h*h:b*h-b+1}}function k(d,b){return function(f){return f<b?b*d(f/b):1-d((1-f)/(1-b))*(1-b)}}Object.defineProperty(b,"__esModule",{value:!0});b.linear=n;b.inQuad=function(d){return d*d};b.outQuad=function(d){return 1-b.inQuad(1-d)};b.inOutQuad=function(d){return.5>d?b.inQuad(2*d)/2:(b.outQuad(2*(d-.5))+1)/2};b.inCubic=function(d){return d*d*d};b.outCubic=function(d){return 1-
b.inCubic(1-d)};b.inOutCubic=function(d){return.5>d?b.inCubic(2*d)/2:(b.outCubic(2*(d-.5))+1)/2};b.inQuart=function(d){return d*d*d*d};b.outQuart=function(d){return 1-b.inQuart(1-d)};b.inOutQuart=function(d){return.5>d?b.inQuart(2*d)/2:(b.outQuart(2*(d-.5))+1)/2};b.inQuint=function(d){return d*d*d*d*d};b.outQuint=function(d){return 1-b.inQuint(1-d)};b.inOutQuint=function(d){return.5>d?b.inQuint(2*d)/2:(b.outQuint(2*(d-.5))+1)/2};b.inSine=function(d){return-Math.cos(d*Math.PI/2)+1};b.outSine=function(d){return 1-
b.inSine(1-d)};b.inOutSine=function(d){return.5>d?b.inSine(2*d)/2:(b.outSine(2*(d-.5))+1)/2};b.inExpo=function(d){return Math.pow(2,10*(d-1))};b.outExpo=function(d){return 1-b.inExpo(1-d)};b.inOutExpo=function(d){return.5>d?b.inExpo(2*d)/2:(b.outExpo(2*(d-.5))+1)/2};b.inCirc=function(d){return-(Math.sqrt(1-d*d)-1)};b.outCirc=function(d){return 1-b.inCirc(1-d)};b.inOutCirc=function(d){return.5>d?b.inCirc(2*d)/2:(b.outCirc(2*(d-.5))+1)/2};b.inCoastQuad=k(f(1),1);b.outCoastQuad=k(f(1),0);b.inOutCoastQuad=
k(f(1),.5);b.inCoastCubic=k(f(2),1);b.outCoastCubic=k(f(2),0);b.inOutCoastCubic=k(f(2),.5);b.inCoastQuart=k(f(3),1);b.outCoastQuart=k(f(3),0);b.inOutCoastQuart=k(f(3),.5);b.inCoastQuint=k(f(4),1);b.outCoastQuint=k(f(4),0);b.inOutCoastQuint=k(f(4),.5);b.named={linear:n,"in-quad":b.inQuad,"out-quad":b.outQuad,"in-out-quad":b.inOutQuad,"in-coast-quad":b.inCoastQuad,"out-coast-quad":b.outCoastQuad,"in-out-coast-quad":b.inOutCoastQuad,"in-cubic":b.inCubic,"out-cubic":b.outCubic,"in-out-cubic":b.inOutCubic,
"in-coast-cubic":b.inCoastCubic,"out-coast-cubic":b.outCoastCubic,"in-out-coast-cubic":b.inOutCoastCubic,"in-quart":b.inQuart,"out-quart":b.outQuart,"in-out-quart":b.inOutQuart,"in-coast-quart":b.inCoastQuart,"out-coast-quart":b.outCoastQuart,"in-out-coast-quart":b.inOutCoastQuart,"in-quint":b.inQuint,"out-quint":b.outQuint,"in-out-quint":b.inOutQuint,"in-coast-quint":b.inCoastQuint,"out-coast-quint":b.outCoastQuint,"in-out-coast-quint":b.inOutCoastQuint,"in-sine":b.inSine,"out-sine":b.outSine,"in-out-sine":b.inOutSine,
"in-expo":b.inExpo,"out-expo":b.outExpo,"in-out-expo":b.inOutExpo,"in-circ":b.inCirc,"out-circ":b.outCirc,"in-out-circ":b.inOutCirc}})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec3f64 ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera".split(" "),function(q,b,n,f,k,d,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(c){function a(a,
d,b){b=c.call(this,b)||this;b.viewState=a;b.intersectionHelper=d;b.hasTarget=!1;b.animation=new k.default(b.viewState.mode);return b}n(a,c);a.prototype.begin=function(a,c){this.hasTarget=!0;c=this.animationSettings(c);m.copyFrom(this.viewState.camera);this.intersectionHelper.intersectRay(m.ray,p)&&(m.center=p);this.animation.update(m,a,c);this.animation.finished&&this.finish()};a.prototype.finish=function(){this.animation.currentTime=this.animation.time;c.prototype.finish.call(this)};Object.defineProperty(a.prototype,
"steppingFinished",{get:function(){return this.hasTarget&&this.animation.finished},enumerable:!0,configurable:!0});a.prototype.stepController=function(a,d){c.prototype.stepController.call(this,a,d);this.hasTarget&&this.animation.step(a,d)};a.prototype.onControllerEnd=function(a){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,a),this.animation.currentTime=this.animation.time);c.prototype.onControllerEnd.call(this,a)};a.prototype.animationSettings=function(a){void 0===
a&&(a={});return{apex:{maximumDistance:this.viewState.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},speedFactor:a.speedFactor,duration:a.duration,maxDuration:a.maxDuration,easing:a.easing}};return a}(d.AnimationController);b.PointToPointAnimationController=q;var m=new h,p=f.vec3f64.create()})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),
function(q,b,n,f,k,d,h,m){Object.defineProperty(b,"__esModule",{value:!0});var p=k.vec3f64.create();q=function(){function c(a){this.currentTime=0;this.animation=new m.Animation(function(){return new d.default(a)});this._current=new d.default(a)}Object.defineProperty(c.prototype,"finished",{get:function(){return this.currentTime>=this.animation.time},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"time",{get:function(){return this.animation.time},enumerable:!0,configurable:!0});
c.prototype.update=function(a,c,d){var b=this.animation.definition.source,g=this.animation.definition.target,h=f.vec3.subtract(p,c.center,a.center),l=f.vec3.length(h);1E-5<=l?(h[0]/=l,h[1]/=l,h[2]/=l):(h[0]=0,h[1]=1,h[0]=0);f.vec3.copy(b.lookAtDirection,h);f.vec3.copy(g.lookAtDirection,h);b.copyFromRenderCamera(a);g.copyFromRenderCamera(c);this._current.copyFrom(b);this.animation.update(b,g,d);this.currentTime=0;a.almostEquals(c,5E-4,!0)&&(this.currentTime=this.animation.time)};c.prototype.cameraAt=
function(a,c){this.animation.cameraAt(a,this._current);c=c||new h;this._current.copyToRenderCamera(c);return c};c.prototype.step=function(a,c){this.finished||(this.currentTime+=a,this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,c)};return c}();b.Animation=q;b.default=q})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils".split(" "),
function(q,b,n,f,k,d,h){Object.defineProperty(b,"__esModule",{value:!0});var m=h.angle,p=h.lerp,c=h.slerp,a=d.vec3f64.create(),l=d.vec3f64.create(),g=d.vec3f64.create(),e=d.vec3f64.create(),u=d.vec3f64.create(),t=d.vec3f64.create(),r=d.vec3f64.fromValues(0,0,1),y=d.vec3f64.fromValues(0,1,0),w=d.vec3f64.fromValues(1,0,0),x=f.mat3f64.create();q=function(){function b(a){void 0===a&&(a="global");this.viewingMode=a;this.center=d.vec3f64.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=
d.vec3f64.clone(y)}b.prototype.pixelsPerPanAtZoom=function(a){return this.size/2/(this._zoomToPanScale*a)};b.prototype.zoomAtPixelsPerPan=function(a){return this.size/2/(this._zoomToPanScale*a)};b.prototype.pixelsPerRotateAtZoom=function(a){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};b.prototype.compareTo=function(a,c){c||(c={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if("global"===this.viewingMode){var d=k.vec3.length(this.center),b=k.vec3.length(a.center),d=(d+b)/2;c.pan=m(this.center,
a.center)*d}else c.pan=k.vec3.distance(this.center,a.center);d=Math.abs(a.yaw-this.yaw);d>=Math.PI&&(d=2*Math.PI-d);c.rotate=Math.max(d,Math.abs(a.pitch-this.pitch));c.sourceZoom=this.distance;c.targetZoom=a.distance;return c};b.prototype.interpolate=function(a,d,b){"global"===this.viewingMode?c(a.center,d.center,b.pan,this.center):k.vec3.lerp(this.center,a.center,d.center,b.pan);this.distance=p(a.distance,d.distance,b.zoom);this.pitch=p(a.pitch,d.pitch,b.rotate);a=a.yaw;d=d.yaw;Math.abs(d-a)>=Math.PI&&
(a+=2*(a<d?1:-1)*Math.PI);this.yaw=p(a,d,b.rotate)};b.prototype.copyFrom=function(a){k.vec3.copy(this.center,a.center);this.pitch=a.pitch;this.yaw=a.yaw;this.distance=a.distance;k.vec3.copy(this.lookAtDirection,a.lookAtDirection);this.size=a.size;this.copyFromCommon(a);this.viewingMode=a.viewingMode};b.prototype.copyFromRenderCamera=function(a){var c=this._lookAtOrientation(a.center,x);k.vec3.copy(this.center,a.center);k.vec3.subtract(e,a.center,a.eye);k.vec3.transformMat3(e,e,c);k.vec3.transformMat3(u,
a.up,c);this.distance=k.vec3.length(e);e[0]/=this.distance;e[1]/=this.distance;e[2]/=this.distance;this.pitch=this._eyeUpToPitch(e,u);this.yaw=this._eyeUpToYaw(e,u);this.size=Math.sqrt(a.width*a.width+a.height*a.height);this.copyFromCommon(a)};b.prototype.copyFromCommon=function(a){this.fov=a.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};b.prototype.copyToRenderCamera=function(a){var c=this._lookAtOrientation(this.center,x);n.mat3.transpose(c,c);this._axisAngleVec3(w,this.pitch-Math.PI/2,y,e);
this._axisAngleVec3(r,this.yaw,e);this._axisAngleVec3(w,this.pitch-Math.PI/2,r,u);this._axisAngleVec3(r,this.yaw,u);k.vec3.scale(e,e,this.distance);k.vec3.transformMat3(e,e,c);k.vec3.transformMat3(u,u,c);a.center=this.center;a.eye=k.vec3.subtract(e,this.center,e);a.up=u};b.prototype._axisAngleVec3=function(c,d,b,e){void 0===e&&(e=b);var f=Math.cos(d);d=Math.sin(d);k.vec3.scale(a,b,f);k.vec3.cross(l,c,b);k.vec3.scale(l,l,d);k.vec3.scale(g,c,(1-f)*k.vec3.dot(c,b));return k.vec3.add(e,k.vec3.add(e,a,
l),g)};b.prototype._lookAtOrientation=function(c,d){this._upAtLookAt(c,g);k.vec3.cross(a,this.lookAtDirection,g);k.vec3.normalize(a,a);0===a[0]&&0===a[1]&&0===a[2]&&k.vec3.copy(a,w);k.vec3.cross(l,g,a);k.vec3.normalize(l,l);d||(d=f.mat3f64.create());d[0]=a[0];d[1]=l[0];d[2]=g[0];d[3]=a[1];d[4]=l[1];d[5]=g[1];d[6]=a[2];d[7]=l[2];d[8]=g[2];return d};b.prototype._upAtLookAt=function(a,c){return"local"===this.viewingMode?k.vec3.copy(c,r):k.vec3.normalize(c,a)};b.prototype._eyeUpToPitch=function(a,c){return Math.PI-
m(r,a)};b.prototype._eyeUpToYaw=function(a,c){.5>Math.abs(c[2])?(k.vec3.copy(t,c),0<a[2]&&k.vec3.scale(t,t,-1)):k.vec3.copy(t,a);k.vec3.cross(l,t,r);k.vec3.normalize(l,l);return m(w,l,r)};return b}();b.default=q})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("require exports ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/mathUtils ../../support/geometryUtils/vector ./Util".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g){function e(a,c){var d=c[0]-a[0],b=c[1]-a[1],e=c[2]-a[2];a=c[3]-a[3];return d*d+b*b+e*e+a*a}function u(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]}function t(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]}q=function(){function b(a,d,b){void 0===a&&(a=h.vec3f64.create());void 0===d&&(d=h.vec3f64.create());void 0===b&&(b=h.vec3f64.fromValues(0,0,1));this._viewUp=h.vec3f64.create();this._viewForward=h.vec3f64.create();this._viewRight=h.vec3f64.create();
this._ray=c.ray.createWrapper();this._viewport=p.vec4f64.fromValues(0,0,1,1);this._padding=p.vec4f64.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._near=1;this._far=1E3;this._viewDirty=!0;this._viewMatrix=k.mat4f64.create();this._projectionDirty=!0;this._projectionMatrix=k.mat4f64.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=k.mat4f64.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=k.mat4f64.create();this._frustumDirty=!0;this._frustum=c.frustum.create();
this._fullViewport=null;this.pixelRatio=1;this.relativeElevation=0;this._eye=h.vec3f64.clone(a);this._center=h.vec3f64.clone(d);this._up=h.vec3f64.clone(b);this._padding=p.vec4f64.create()}Object.defineProperty(b.prototype,"eye",{get:function(){return this._eye},set:function(a){this._compareAndSetView(a,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"center",{get:function(){return this._center},set:function(a){this._compareAndSetView(a,this._center)},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"ray",{get:function(){this._ray.origin=this.eye;this._ray.direction||(this._ray.direction=h.vec3f64.create());d.vec3.subtract(this._ray.direction,this.center,this.eye);return this._ray},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"up",{get:function(){return this._up},set:function(a){this._compareAndSetView(a,this._up)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewMatrix",{get:function(){this._ensureViewClean();return this._viewMatrix},
set:function(a){f.mat4.copy(this._viewMatrix,a);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewForward",{get:function(){this._ensureViewClean();return this._viewForward},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewUp",{get:function(){this._ensureViewClean();return this._viewUp},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"viewRight",{get:function(){this._ensureViewClean();return this._viewRight},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"near",{get:function(){return this._near},set:function(a){this._near!==a&&(this._near=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"far",{get:function(){return this._far},set:function(a){this._far!==a&&(this._far=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=
!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewport",{get:function(){return this._viewport},set:function(a){this.x=a[0];this.y=a[1];this.width=a[2];this.height=a[3]},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"x",{get:function(){return this._viewport[0]},set:function(a){a+=this._padding[3];this._viewport[0]!==a&&(this._viewport[0]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"y",{get:function(){return this._viewport[1]},set:function(a){a+=this._padding[2];this._viewport[1]!==a&&(this._viewport[1]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"width",{get:function(){return this._viewport[2]},set:function(a){this._viewport[2]!==a&&(this._viewport[2]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"height",{get:function(){return this._viewport[3]},set:function(a){this._viewport[3]!==a&&(this._viewport[3]=a,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(a){this.width=a-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullHeight",{get:function(){return this._viewport[3]+
this._padding[0]+this._padding[2]},set:function(a){this.height=a-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fullViewport",{get:function(){this._fullViewport||(this._fullViewport=p.vec4f64.create());this._fullViewport[0]=this._viewport[0]-this._padding[3];this._fullViewport[1]=this._viewport[1]-this._padding[2];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"padding",{get:function(){return this._padding},set:function(a){if(this._padding[0]!==a[0]||this._padding[1]!==a[1]||this._padding[2]!==a[2]||this._padding[3]!==a[3])this._viewport[0]+=a[3]-this._padding[3],this._viewport[1]+=a[2]-this._padding[2],this._viewport[2]-=a[1]+a[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=a[0]+a[2]-(this._padding[0]+
this._padding[2]),m.vec4.copy(this._padding,a),this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewProjectionMatrix",{get:function(){this._viewProjectionDirty&&(f.mat4.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var a=
this.width,c=this.height,d=this.near*Math.tan(this.fovY/2),b=d*this.aspect;f.mat4.frustum(this._projectionMatrix,-b*(1+2*this._padding[3]/a),b*(1+2*this._padding[1]/a),-d*(1+2*this._padding[2]/c),d*(1+2*this._padding[0]/c),this.near,this.far);this._projectionDirty=!1}return this._projectionMatrix},set:function(a){f.mat4.copy(this._projectionMatrix,a);this._projectionDirty=!1;this._frustumDirty=this._viewProjectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fov",{get:function(){return this._fov},
set:function(a){this._fov=a;this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fovX",{get:function(){return g.fovd2fovx(this._fov,this.width,this.height)},set:function(a){this._fov=g.fovx2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fovY",{get:function(){return g.fovd2fovy(this._fov,this.width,
this.height)},set:function(a){this._fov=g.fovy2fovd(a,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"distance",{get:function(){return d.vec3.distance(this._center,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"frustum",{get:function(){this._recomputeFrustum();return this._frustum},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewInverseTransposeMatrix",
{get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=k.mat4f64.create()),f.mat4.invert(this._viewInverseTransposeMatrix,this.viewMatrix),f.mat4.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"perRenderPixelRatio",{get:function(){return Math.tan(this.fovX/
2)/(this.width/2)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"perScreenPixelRatio",{get:function(){return this.perRenderPixelRatio*this.pixelRatio},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"aboveGround",{get:function(){return 0<=this.relativeElevation},enumerable:!0,configurable:!0});b.prototype.copyFrom=function(a){d.vec3.copy(this._eye,a._eye);d.vec3.copy(this._center,a._center);d.vec3.copy(this._up,a._up);m.vec4.copy(this._viewport,a._viewport);
m.vec4.copy(this._padding,a._padding);this._near=a._near;this._far=a._far;this._fov=a._fov;this.relativeElevation=a.relativeElevation;this._viewDirty=a._viewDirty;this._viewDirty||(f.mat4.copy(this._viewMatrix,a._viewMatrix),d.vec3.copy(this._viewRight,a._viewRight),d.vec3.copy(this._viewUp,a._viewUp),d.vec3.copy(this._viewForward,a._viewForward));a._projectionDirty?this._projectionDirty=!0:(f.mat4.copy(this._projectionMatrix,a._projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=
!0;this._frustumDirty=a._frustumDirty;this._frustumDirty||(c.frustum.copy(a._frustum,this._frustum),this._frustumDirty=!1);a._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?f.mat4.copy(this._viewInverseTransposeMatrix,a._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=k.mat4f64.clone(a._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);a._fullViewport?this._fullViewport?m.vec4.copy(this._fullViewport,a._fullViewport):
this._fullViewport=p.vec4f64.clone(a._fullViewport):this._fullViewport=null;this.pixelRatio=a.pixelRatio;return this};b.prototype.copyViewFrom=function(a){this.eye=a.eye;this.center=a.center;this.up=a.up};b.prototype.copy=function(){var a=new b;a.copyFrom(this);return a};b.prototype.equals=function(a){return u(this._eye,a._eye)&&u(this._center,a._center)&&u(this._up,a._up)&&t(this._viewport,a._viewport)&&t(this._padding,a._padding)&&this._near===a._near&&this._far===a._far&&this._fov===a._fov&&this.pixelRatio===
a.pixelRatio};b.prototype.almostEquals=function(c,b,g){void 0===g&&(g=!1);b=d.vec3.distance(this._eye,this._center)*(b||5E-4);b*=b;g?(a.directionFromTo(w,c._eye,c._center),a.directionFromTo(x,this._eye,this._center),g=1E-10):(d.vec3.copy(w,c._center),d.vec3.copy(x,this._center),g=b);return d.vec3.squaredDistance(c._eye,this._eye)<b&&d.vec3.squaredDistance(w,x)<g&&.001>Math.abs(c._fov-this._fov)&&.5>e(c._padding,this._padding)&&.5>e(c._viewport,this._viewport)&&this.pixelRatio===c.pixelRatio};b.prototype.markViewDirty=
function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};b.prototype.computeRenderPixelSizeAt=function(a){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(a))};b.prototype.computeRenderPixelSizeAtDist=function(a){return a*this.perRenderPixelRatio};b.prototype.computeScreenPixelSizeAt=function(a){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(a))};b.prototype.viewDirectionDistance=function(a){return Math.abs(l.projectPointSignedLength(this.viewForward,
d.vec3.subtract(w,a,this._eye)))};b.prototype.computeScreenPixelSizeAtDist=function(a){return a*this.perScreenPixelRatio};b.prototype.computeDistanceFromRadius=function(a,c){return a/Math.tan(Math.min(this.fovX,this.fovY)/(2*(c||1)))};b.prototype.getScreenCenter=function(a){void 0===a&&(a=n.createScreenPointArray());a[0]=(this.padding[3]+this.width/2)/this.pixelRatio;a[1]=(this.padding[2]+this.height/2)/this.pixelRatio;return a};b.prototype.getRenderCenter=function(a){a||(a=n.createRenderScreenPointArray3());
a[0]=this.padding[3]+this.width/2;a[1]=this.padding[2]+this.height/2;2<a.length&&(a[2]=.5);return a};b.prototype.setGLViewport=function(a){var c=this.viewport,d=this.padding;a.setViewport(c[0]-d[3],c[1]-d[2],c[2]+d[1]+d[3],c[3]+d[0]+d[2])};b.prototype.applyProjection=function(c,b,e){void 0===e&&(e=!1);c!==r&&d.vec3.copy(r,c);r[3]=1;e&&(b[2]=-r[2]);m.vec4.transformMat4(r,r,this.projectionMatrix);d.vec3.scale(r,r,1/Math.abs(r[3]));c=this.fullViewport;b[0]=a.lerp(0,c[0]+c[2],.5+.5*r[0]);b[1]=a.lerp(0,
c[1]+c[3],.5+.5*r[1]);e||(b[2]=.5*(r[2]+1));return b};b.prototype.projectPoint=function(c,b){r[0]=c[0];r[1]=c[1];r[2]=c[2];r[3]=1;m.vec4.transformMat4(r,r,this.viewProjectionMatrix);if(0===r[3])return null;d.vec3.scale(r,r,1/Math.abs(r[3]));c=this.fullViewport;"x"in b?(b.x=a.lerp(0,c[0]+c[2],.5+.5*r[0]),b.y=a.lerp(0,c[1]+c[3],.5+.5*r[1])):(b[0]=a.lerp(0,c[0]+c[2],.5+.5*r[0]),b[1]=a.lerp(0,c[1]+c[3],.5+.5*r[1]),2<b.length&&(b[2]=.5*(r[2]+1)));return b};b.prototype.unprojectPoint=function(a,c){f.mat4.multiply(y,
this.projectionMatrix,this.viewMatrix);if(!f.mat4.invert(y,y))return null;var d=this.fullViewport;r[0]=2*(a[0]-d[0])/d[2]-1;r[1]=2*(a[1]-d[1])/d[3]-1;r[2]=2*a[2]-1;r[3]=1;m.vec4.transformMat4(r,r,y);if(0===r[3])return null;c[0]=r[0]/r[3];c[1]=r[1]/r[3];c[2]=r[2]/r[3];return c};b.prototype.computeUp=function(a){"global"===a?this.computeUpGlobal():this.computeUpLocal()};b.prototype.screenToRender=function(a,c){var d=this.fullHeight-a[1]*this.pixelRatio;c[0]=a[0]*this.pixelRatio;c[1]=d;return c};b.prototype.renderToScreen=
function(a,c){var d=(this.fullHeight-a[1])/this.pixelRatio;c[0]=a[0]/this.pixelRatio;c[1]=d;return c};b.prototype.computeUpGlobal=function(){d.vec3.subtract(w,this.center,this.eye);var a=d.vec3.length(this.center);1>a?(d.vec3.set(this.up,0,0,1),this.markViewDirty()):Math.abs(d.vec3.dot(w,this.center))>.9999*d.vec3.length(w)*a||(d.vec3.cross(this.up,w,this.center),d.vec3.cross(this.up,this.up,w),d.vec3.normalize(this.up,this.up),this.markViewDirty())};b.prototype.computeUpLocal=function(){a.directionFromTo(w,
this.eye,this.center);.9999>=Math.abs(w[2])&&(d.vec3.scale(w,w,w[2]),d.vec3.set(this.up,-w[0],-w[1],1-w[2]),d.vec3.normalize(this.up,this.up),this.markViewDirty())};b.prototype._compareAndSetView=function(a,c){u(a,c)||(d.vec3.copy(c,a),this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0)};b.prototype._recomputeFrustum=function(){this._frustumDirty&&(c.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};b.prototype._ensureViewClean=function(){this._viewDirty&&
(f.mat4.lookAt(this._viewMatrix,this._eye,this._center,this._up),d.vec3.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),d.vec3.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),d.vec3.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};return b}();var r=p.vec4f64.create(),y=k.mat4f64.create(),w=h.vec3f64.create(),x=h.vec3f64.create();return q})},
"esri/views/animation/pointToPoint/Animation":function(){define("require exports ../easing ./Definition ./Settings ./apex/Path".split(" "),function(q,b,n,f,k,d){Object.defineProperty(b,"__esModule",{value:!0});var h={zoom:0,pan:0,rotate:0};q=function(){function b(b){this.createCamera=b;this.time=0;this.definition=new f.Definition(b);this.path=new d.Path}b.prototype.update=function(d,c,a){this.definition.update(d,c,a);this.path.update(this.definition,a);this.time=this._applyTimeSettings(this.path.time,
a);this.settings=a};b.prototype.cameraAt=function(d,c){c=c||this.createCamera();d=Math.min(Math.max(0,d),1);d=this.settings.easing?this.normalizedEasing(this.settings.easing,d,1E3*this.time):1<=this.time?this.normalizedEasing(n.inOutCoastQuad,d):this.normalizedEasing(n.outExpo,d);d=this.path.interpolateComponentsAt(d,h);c.interpolate(this.definition.source,this.definition.target,d);return c};b.prototype.normalizedEasing=function(d,c,a){a=d(0);var b=d(1);return(d(c)-a)/(b-a)};b.prototype._applyTimeSettings=
function(d,c){var a=null!=c.speedFactor?c.speedFactor:1;null!=c.duration?d=c.duration:null!=c.speedFactor&&(d/=a);return d=Math.min(Math.max(null!=c.minDuration?c.minDuration:k.defaultSettings.minDuration/a,d),null!=c.maxDuration?c.maxDuration:k.defaultSettings.maxDuration/a)};return b}();b.Animation=q;b.default=q})},"esri/views/animation/pointToPoint/Definition":function(){define(["require","exports","./Settings"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this.createCamera=
b;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:n.defaultSettings.desiredScreenFlow};this.source=b();this.target=b()}b.prototype.clone=function(){var f=new b(this.createCamera);f.copyFrom(this);return f};b.prototype.copyFrom=function(b){this.update(b.source,b.target,b.settings)};b.prototype.update=function(b,d,f){this.source!==b&&this.source.copyFrom(b);this.target!==d&&this.target.copyFrom(d);this.compared=this.source.compareTo(this.target,this.compared);
this.settings.desiredScreenFlow=null!=f.desiredScreenFlow?f.desiredScreenFlow:n.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2};b.prototype.halfWindowPanAtZoom=function(b){b=this.target.pixelsPerPanAtZoom(b);return this.halfWindowSize/b};Object.defineProperty(b.prototype,"hasZoom",{get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"hasPan",{get:function(){return 1E-9<this.compared.pan},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasRotate",{get:function(){return 1E-9<this.compared.rotate},enumerable:!0,configurable:!0});return b}();b.Definition=q;b.default=q})},"esri/views/animation/pointToPoint/Settings":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.defaultSettings={desiredScreenFlow:2,minDuration:.5,maxDuration:8}})},"esri/views/animation/pointToPoint/apex/Path":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../easing ../Path ../Segment ./planning".split(" "),
function(q,b,n,f,k,d,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function m(c,a){var f=b.call(this)||this;f._preallocSegments=[new d.default,new d.default,new d.default];f.update(c,a);return f}n(m,b);m.prototype.update=function(c,a){if(c){this.definition?this.definition.copyFrom(c):this.definition=c.clone();var d=null;a&&a.apex&&(d=h.optimalDistance(c,a.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==d?this._updateWithoutApex():this._updateWithApex(d,
a.apex)}};m.prototype.segmentInterpolateComponentsAt=function(c,a,d){d=c.interpolateComponentsAt(a,d);c===this._ascensionSegment?d.zoom=f.outQuad(d.zoom):c===this._descensionSegment&&(d.zoom=f.inQuad(d.zoom));return d};m.prototype._updateWithApex=function(c,a){var d=this._preallocSegments,b=d[0],e=d[1],d=d[2],f=null!=a.ascensionFactor?a.ascensionFactor:.5;a=Math.min(1-f,null!=a.ascensionFactor?a.descensionFactor:.5);var h=1-f-a;b.definition?b.definition.copyFrom(this.definition):b.definition=this.definition.clone();
b.definition.compared.targetZoom=c;b.definition.compared.pan=this.definition.compared.pan*f;b.definition.compared.rotate=this.definition.compared.rotate*f;b.update();this._ascensionSegment=b;this.segments.push(b);0<h&&(e.definition?e.definition.copyFrom(this.definition):e.definition=this.definition.clone(),e.definition.copyFrom(this.definition),e.definition.compared.sourceZoom=c,e.definition.compared.targetZoom=c,e.definition.compared.pan=this.definition.compared.pan*h,e.definition.compared.rotate=
this.definition.compared.rotate*h,e.update(),this.segments.push(e));d.definition?d.definition.copyFrom(this.definition):d.definition=this.definition.clone();d.definition.compared.sourceZoom=c;d.definition.compared.pan=this.definition.compared.pan*a;d.definition.compared.rotate=this.definition.compared.rotate*a;d.update();this._descensionSegment=d;this.segments.push(d)};m.prototype._updateWithoutApex=function(){var c=this._preallocSegments[0];c.update(this.definition);this.segments.push(c)};return m}(k.default);
b.Path=q;b.default=q})},"esri/views/animation/pointToPoint/Path":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(){this.segments=[]}Object.defineProperty(b.prototype,"time",{get:function(){return this.segments.reduce(function(b,k){return b+k.time},0)},enumerable:!0,configurable:!0});b.prototype.interpolateComponentsAt=function(b,k){b=Math.min(Math.max(b,0),1);b*=this.time;for(var d=0,f=0,m=this.definition,p=0;p<this.segments.length;p++){var c=
this.segments[p],a=c.definition;if(b<=c.time||p===this.segments.length-1)return k=this.segmentInterpolateComponentsAt(c,b/c.time,k),k.pan=m.hasPan?(d+a.compared.pan*k.pan)/m.compared.pan:1,k.rotate=m.hasRotate?(f+a.compared.rotate*k.rotate)/m.compared.rotate:1,b=k.zoom*(a.compared.targetZoom-a.compared.sourceZoom)+a.compared.sourceZoom,d=this.segments[0].definition.compared.sourceZoom,f=this.segments[this.segments.length-1].definition.compared.targetZoom,k.zoom=m.hasZoom?(b-d)/(f-d):1,k;b-=c.time;
d+=a.compared.pan;f+=a.compared.rotate}};b.prototype.segmentInterpolateComponentsAt=function(b,k,d){return b.interpolateComponentsAt(k,d)};return b}();b.Path=q;b.default=q})},"esri/views/animation/pointToPoint/Segment":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){b&&this.update(b)}b.prototype.update=function(b){b&&(this.definition?this.definition.copyFrom(b):this.definition=b.clone());this._updatePrecomputedVariables();
this._updatePixelFlow()};b.prototype._updatePrecomputedVariables=function(){var b=this.definition,k=b.compared,d=k.sourceZoom,h=k.targetZoom;this._zoomSign=d>h?1:-1;this._panPixelsAtSource=k.pan*b.source.pixelsPerPanAtZoom(d);b=(b.source.pixelsPerRotateAtZoom(d)+b.target.pixelsPerRotateAtZoom(h))/2;this._rotatePixels=k.rotate*b};b.prototype._updatePixelFlow=function(){var b=this.definition.compared.sourceZoom,k=this.definition.compared.targetZoom,d=this.definition,h=d.hasZoom,m=d.hasPan,d=d.hasRotate,
p=0,c=0;h&&(m&&(p=(k/b-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),d&&(c=Math.log(b/k)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;b=this.definition.desiredPixelFlow;h&&m&&d?(k=p+c+p*c,this._zoomPixelFlow=p*c/k*b,this._panPixelFlow=c/k*b,this._rotatePixelFlow=p/k*b):h&&m?(k=1+p,this._zoomPixelFlow=p/k*b,this._panPixelFlow=1/k*b):h&&d?(k=1+c,this._zoomPixelFlow=
c/k*b,this._rotatePixelFlow=1/k*b):m&&d?(p=this._panPixelsAtSource/this._rotatePixels,k=1+p,this._panPixelFlow=p/k*b,this._rotatePixelFlow=1/k*b):m?this._panPixelFlow=b:h?this._zoomPixelFlow=b:d&&(this._rotatePixelFlow=b);this.time=d?this.rotateTime:h?this.zoomTime:m?this.panTime:0};Object.defineProperty(b.prototype,"zoomTime",{get:function(){return this.definition.hasZoom?Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/
this._zoomPixelFlow:0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"panTime",{get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){var b=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*b+1)/(b*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"rotateTime",{get:function(){return this.definition.hasRotate?
this._rotatePixels/this._rotatePixelFlow:0},enumerable:!0,configurable:!0});b.prototype._interpolateComponentsZoom=function(b){if(0===b||1===b)return b;if(this.definition.hasZoom){var f=this.definition.compared.sourceZoom,d=this.definition.compared.targetZoom;return(f*Math.pow(f/d,-b)-f)/(d-f)}return b};b.prototype._interpolateComponentsPan=function(b){if(0===b||1===b)return b;if(this.definition.hasPan&&this.definition.hasZoom){var f=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;
return 1/this._panPixelsAtSource*this._panPixelFlow*(Math.pow(2,f*b*this.time)-1)/(f*Math.LN2)}return b};b.prototype._interpolateComponentsRotate=function(b){return b};b.prototype.interpolateComponentsAt=function(b,k){b=Math.min(Math.max(b,0),1);var d=this._interpolateComponentsZoom(b),f=this._interpolateComponentsPan(b);b=this._interpolateComponentsRotate(b);k?(k.zoom=d,k.pan=f,k.rotate=b):k={zoom:d,pan:f,rotate:b};return k};return b}();b.Segment=q;b.default=q})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["require",
"exports","./functions"],function(q,b,n){function f(b,d){var f=Math.max(b.compared.sourceZoom,b.compared.targetZoom);b=b.source.zoomAtPixelsPerPan(b.desiredPixelFlow/b.compared.pan)/2;return b<f?null!=d.maximumDistance?f+(d.maximumDistance-f)/2:1.5*f:d.maximumDistance?Math.min(d.maximumDistance,b):b}Object.defineProperty(b,"__esModule",{value:!0});b.optimalDistance=function(b,d){var h=f(b,d),m={ascensionFactor:null!=d.ascensionFactor?d.ascensionFactor:.5,descensionFactor:null!=d.descensionFactor?
d.descensionFactor:.5},p=0===m.ascensionFactor,c=0===m.descensionFactor,a=p?n.tAscensionZoomOnly:n.tAscensionZoomPan,l=p?n.dtAscensionZoomOnly:n.dtAscensionZoomPan,g=p?n.ddtAscensionZoomOnly:n.ddtAscensionZoomPan,e=c?n.tDescensionZoomOnly:n.tDescensionZoomPan,k=c?n.dtDescensionZoomOnly:n.dtDescensionZoomPan,t=c?n.ddtDescensionZoomOnly:n.ddtDescensionZoomPan,p=function(c){return a(b,m,c)+n.tPanion(b,m,c)+e(b,m,c)},c=function(a){return l(b,m,a)+n.dtPanion(b,m,a)+k(b,m,a)},r=function(a){return g(b,m,
a)+n.ddtPanion(b,m,a)+t(b,m,a)},y=p(h),w=n.tBaseLine(b),x=d.maximumIterations||20,v=null!=d.maximumDistance?d.maximumDistance:Infinity;for(d=0;d<x;d++){var z=(c(h)+1E-6)/r(h);if(isNaN(z)||h>=v&&0>z){if(!isFinite(v))return null;h=v;y=p(h);break}h-=z;if(h<b.compared.sourceZoom||h<b.compared.targetZoom)return null;z=p(h);if(.005>=Math.abs(z-y)/y)break;y=z}return y>.7*w||h<b.compared.sourceZoom||h<b.compared.targetZoom?null:h}})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["require",
"exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.tAscensionZoomPan=function(b,f,k){var d=b.halfWindowPanAtZoom(k-b.compared.sourceZoom);return-b.halfWindowSize*(f.ascensionFactor*Math.LN2*b.compared.pan+d)*Math.log(b.compared.sourceZoom/k)/(b.desiredPixelFlow*Math.LN2*d)};b.dtAscensionZoomPan=function(b,f,k){var d=1/k,h=Math.log(b.compared.sourceZoom*d),m=1/b.desiredPixelFlow,p=1/Math.LN2;k-=b.compared.sourceZoom;var c=1/k;f=(f.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(k))/
b.halfWindowPanAtZoom(1);return b.halfWindowSize*d*m*p*c*f-b.halfWindowSize*h*m*p*c+b.halfWindowSize*h*m*p*f/(k*k)};b.ddtAscensionZoomPan=function(b,f,k){var d=k-b.compared.sourceZoom,h=1/d,m=1/k,p=Math.log(b.compared.sourceZoom*m);f=(f.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(d))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*h*(-2*h*m*f+2*h*p+2*m-2*p*f/(d*d)-f/(k*k))/(b.desiredPixelFlow*Math.LN2)};b.tAscensionZoomOnly=function(b,f,k){return-b.halfWindowSize*Math.log(b.compared.sourceZoom/
k)/(b.desiredPixelFlow*Math.LN2)};b.dtAscensionZoomOnly=function(b,f,k){return b.halfWindowSize/(k*b.desiredPixelFlow*Math.LN2)};b.ddtAscensionZoomOnly=function(b,f,k){return-b.halfWindowSize/(k*k*b.desiredPixelFlow*Math.LN2)};b.tPanion=function(b,f,k){return-b.compared.pan*b.halfWindowSize*(f.ascensionFactor+f.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(k))};b.dtPanion=function(b,f,k){return b.compared.pan*b.halfWindowSize*(f.ascensionFactor+f.descensionFactor-1)/(b.desiredPixelFlow*
b.halfWindowPanAtZoom(k*k))};b.ddtPanion=function(b,f,k){return-2*b.compared.pan*b.halfWindowSize*(f.ascensionFactor+f.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(k*k*k))};b.tDescensionZoomPan=function(b,f,k){return b.halfWindowSize*(-b.halfWindowPanAtZoom(k)-f.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))*Math.log(k/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*b.halfWindowPanAtZoom(-k+b.compared.targetZoom))};b.dtDescensionZoomPan=
function(b,f,k){var d=Math.log(k/b.compared.targetZoom),h=1/b.desiredPixelFlow,m=1/Math.LN2,p=-k+b.compared.targetZoom,c=1/p;f=(-b.halfWindowPanAtZoom(k)-f.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return-b.halfWindowSize*d*h*m*c+b.halfWindowSize*d*h*m*f/(p*p)+b.halfWindowSize*h*m*c*f/k};b.ddtDescensionZoomPan=function(b,f,k){var d=k-b.compared.targetZoom,h=1/d,m=1/k,p=Math.log(k/b.compared.targetZoom);f=(b.halfWindowPanAtZoom(k)+
f.descensionFactor*Math.LN2*b.compared.pan-b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*h*(-2*h*m*f-2*h*p+2*m+2*p*f/(d*d)-f/(k*k))/(b.desiredPixelFlow*Math.LN2)};b.tDescensionZoomOnly=function(b,f,k){return b.halfWindowSize*Math.log(k/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2)};b.dtDescensionZoomOnly=function(b,f,k){return b.halfWindowSize/(k*b.desiredPixelFlow*Math.LN2)};b.ddtDescensionZoomOnly=function(b,f,k){return-b.halfWindowSize/(k*
k*b.desiredPixelFlow*Math.LN2)};b.tBaseLine=function(b){var f=Math.LN2*b.compared.pan,k=b.halfWindowPanAtZoom(b.compared.sourceZoom-b.compared.targetZoom),d=b.halfWindowSize*Math.log(b.compared.sourceZoom/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*k);return b.compared.sourceZoom<=b.compared.targetZoom?d*(f-k):d*(f+k)}})},"esri/views/3d/state/controllers/AnimationController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../ViewAnimation","./CameraController"],
function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});q=function(d){function b(b){void 0===b&&(b=new f);var h=d.call(this)||this;h.viewAnimation=b;return h}n(b,d);Object.defineProperty(b.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"asyncResult",{get:function(){return this._asyncResult},set:function(d){this._asyncResult&&this._asyncResult.reject();this._asyncResult=d;if(this.state===k.State.Finished||this.state===k.State.Stopped)this._asyncResult=
null,this.state===k.State.Finished?d.resolve():d.reject()},enumerable:!0,configurable:!0});b.prototype.onControllerStart=function(b){var f=this;d.prototype.onControllerStart.call(this,b);this.viewAnimation&&this.viewAnimation.when().catch(function(){}).then(function(){f.updateStateFromViewAnimation()})};b.prototype.updateStateFromViewAnimation=function(){!this.viewAnimation||this.state!==k.State.Ready&&this.state!==k.State.Running||(this.viewAnimation.state===f.State.FINISHED?this.finish():this.viewAnimation.state===
f.State.STOPPED&&(this.state=k.State.Stopped))};b.prototype.onControllerEnd=function(b){this.viewAnimation&&(this.viewAnimation.done||(this.state===k.State.Finished?this.viewAnimation.finish():this.state===k.State.Stopped&&this.viewAnimation.stop()));this._asyncResult&&(this.state===k.State.Finished?this._asyncResult.resolve():this._asyncResult.reject());d.prototype.onControllerEnd.call(this,b)};b.prototype.finish=function(){this.finishController()};return b}(k.CameraController);b.AnimationController=
q})},"esri/views/3d/state/controllers/CameraController":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators".split(" "),function(q,b,n,f,k,d){Object.defineProperty(b,"__esModule",{value:!0});var h;(function(d){d.Ready="ready";d.Rejected="rejected";d.Running="running";d.Stopped="stopped";d.Finished="finished"})(h=b.State||(b.State={}));q=function(b){function m(){var c=
null!==b&&b.apply(this,arguments)||this;c.state=h.Ready;return c}n(m,b);Object.defineProperty(m.prototype,"active",{get:function(){return this.state===h.Running},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"isInteractive",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"canStop",{get:function(){return!1},enumerable:!0,configurable:!0});m.prototype.stopController=function(){return this.canStop?(this.state=h.Stopped,!0):!1};m.prototype.finishController=
function(){this.state=h.Finished};m.prototype.onControllerStart=function(c){this.state=h.Running};m.prototype.onControllerEnd=function(c){};m.prototype.stepController=function(c,a){};Object.defineProperty(m.prototype,"steppingFinished",{get:function(){return!1},enumerable:!0,configurable:!0});f([d.property({readOnly:!0,dependsOn:["state"]})],m.prototype,"active",null);f([d.property()],m.prototype,"state",void 0);return m=f([d.subclass()],m)}(d.declared(k));b.CameraController=q})},"esri/views/3d/state/utils/navigationUtils":function(){define("require exports ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils ../../support/stack ../../support/geometryUtils/coordinateSystem ../../webgl-engine/lib/Camera".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u){function t(a,c,d){var b=g.sm4d.get();f.mat4.identity(b);f.mat4.rotate(b,b,d[3],d);m.vec3.subtract(a.eye,a.eye,c);m.vec3.transformMat4(a.eye,a.eye,b);m.vec3.add(a.eye,a.eye,c);m.vec3.subtract(a.center,a.center,c);m.vec3.transformMat4(a.center,a.center,b);m.vec3.add(a.center,a.center,c);m.vec3.transformMat4(a.up,a.up,b);a.markViewDirty()}function r(a,c){m.vec3.set(c,0,0,0);for(var d=0;d<a.length;d++)m.vec3.add(c,c,a[d]);m.vec3.scale(c,c,1/a.length)}function y(a,
d,b){return Math.sin(a/m.vec3.length(d))*(b+c.earthRadius)}function w(c,d,b,e){b=a.ray.fromScreenAtEye(d,b,fa);a.sphere.closestPointOnSilhouette(c,b,O);return a.sphere.intersectRay(c,b,e)?m.vec3.squaredDistance(O,b.origin)<m.vec3.squaredDistance(e,b.origin)?(m.vec3.copy(e,O),!1):!0:(m.vec3.subtract(N,d.eye,d.center),m.vec3.normalize(N,N),a.plane.fromNormalAndOffset(N,-m.vec3.dot(m.vec3.normalize(N,N),O),P),a.plane.intersectRay(P,b,e),!1)}function x(a,c,d,e,g,f){m.vec3.cross(ga,a,c);m.vec3.subtract(Y,
a,c);m.vec3.length(a)<=g||!e.aboveGround?(m.vec3.cross(d,Y,e.eye),a=m.vec3.dot(a,c)/(m.vec3.length(a)*m.vec3.length(c)),f=Math.cos(l.clamp(l.cyclicalPI.normalize(l.deg2rad(f)),0,b.TiltThresholdPanningSpeed)),c=-l.acos(a)-Math.max(0,m.vec3.length(c)-g)/(f*g)):(m.vec3.subtract(L,e.eye,e.center),m.vec3.cross(d,Y,L),c=-m.vec3.length(Y)/g);m.vec3.normalize(d,d);m.vec3.scale(d,d,m.vec3.length(ga));return c}function v(a,c,d,e){e=Math.cos(l.clamp(l.cyclicalPI.normalize(l.deg2rad(e)),0,b.TiltThresholdPanningSpeed));
c=c>d?-(c-d)/(e*d):c<-d?Math.PI-(c+d)/(e*d):l.acos(c/d);return((a>d?-(a-d)/(e*d):a<-d?Math.PI-(a+d)/(e*d):l.acos(a/d))-c)*d}function z(a,c,b,e,g,f,h,l,p,k){p=v(a[2],c[2],h.radius,p);c=k?v(a[0],c[0],h.radius,180):c[0]-a[0];a=Math.sin(l)*c-Math.cos(l)*p;l=Math.cos(l)*c+Math.sin(l)*p;m.vec3.normalize(Z,g);g=k?a/Math.sqrt(Math.abs(Math.pow(h.radius,2)-Math.pow(m.vec3.dot(b,Z),2))):a/h.radius;b=l/Math.sqrt(Math.abs(Math.pow(h.radius,2)-Math.pow(m.vec3.dot(b,e),2)));d.vec2.set(f,g,b)}function A(a,c,d,b,
g,f,h,l,p,k){m.vec3.cross(ga,a,c);e.coordinateSystemFromOneAxisAndNormalVector(f.up,f.eye,U,Q,I);e.coordinateSystemFromOneAxisAndNormalVector([0,0,1],f.eye,T,R,J);m.vec3.copy(d,R);m.vec3.copy(b,T);m.vec3.normalize(d,d);m.vec3.scale(d,d,m.vec3.length(ga));e.vectorCoordinates(a,m.vec3.normalize(Q,Q),m.vec3.normalize(I,I),m.vec3.normalize(U,U),V);e.vectorCoordinates(c,Q,I,U,X);z(V,X,a,T,R,g,h,l,p,k)}function B(a,c,d,b,e,g,h){f.mat4.identity(da);f.mat4.identity(ba);f.mat4.identity(aa);f.mat4.rotate(da,
da,e,b);f.mat4.rotate(ba,ba,h,g);f.mat4.multiply(aa,da,ba);m.vec3.subtract(c,a,d);m.vec3.transformMat4(c,c,aa);m.vec3.add(c,c,d)}function C(a,c,d,b,e,g){f.mat4.identity(da);f.mat4.identity(ba);f.mat4.identity(aa);f.mat4.rotate(da,da,b,d);f.mat4.rotate(ba,ba,g,e);f.mat4.multiply(aa,da,ba);m.vec3.subtract(a.eye,a.eye,c);m.vec3.transformMat4(a.eye,a.eye,aa);m.vec3.add(a.eye,a.eye,c);m.vec3.subtract(a.center,a.center,c);m.vec3.transformMat4(a.center,a.center,aa);m.vec3.add(a.center,a.center,c);m.vec3.subtract(a.up,
a.up,c);m.vec3.transformMat4(a.up,a.up,aa);m.vec3.add(a.up,a.up,c);a.markViewDirty()}function E(a,c,d,e,g,f,h,l){void 0===h&&(h=b.PreservingHeadingThreshold.Pole);void 0===l&&(l=b.PreservingHeadingThreshold.Angle);a=Math.abs(a[2])<d*h||Math.abs(c)>d;return(Math.abs(e)>Math.PI-l||Math.abs(e)<l)&&a&&f.aboveGround&&g<b.PreservingHeadingThreshold.Tilt?!0:!1}function F(c,d,b,e,g,f){f?(a.axisAngle.fromPoints(b,e,ca),t(d,c.center,ca)):(b=x(b,e,ja,d,c.radius,g),t(d,c.center,a.axisAngle.wrapAxisAngle(ja,b)))}
function H(a,c,d,b,e,g,f){var h=f?20:1;m.vec3.copy(S,b);ea.copyFrom(c);for(var l,p=0;p<h&&1E-12<m.vec3.squaredDistance(d,S);p++)if(b=m.vec3.squaredDistance(d,S),A(d,S,R,T,W,ea,a,e,g,f),C(ea,a.center,T,W[1],R,W[0]),B(S,S,a.center,T,W[1],R,W[0]),l=m.vec3.squaredDistance(d,S),l<b||0===p)c.copyFrom(ea);else break}Object.defineProperty(b,"__esModule",{value:!0});b.Earth=a.sphere.fromValues(c.earthRadius,p.vec3f64.create());b.normalizeCoordinate=function(a,c,d){d[0]=c[0]/(a.fullWidth/a.pixelRatio);d[1]=
c[1]/(a.fullHeight/a.pixelRatio);return d};b.rotationFromPointsAroundAxis=function(a,c,d){var b=g.sv3d.get(),e=g.sv3d.get(),f=g.sv3d.get();m.vec3.copy(e,a);m.vec3.copy(f,c);a=m.vec3.dot(e,d);c=m.vec3.dot(f,d);m.vec3.scale(b,d,a);m.vec3.subtract(e,e,b);m.vec3.normalize(e,e);m.vec3.scale(b,d,c);m.vec3.subtract(f,f,b);m.vec3.normalize(f,f);a=m.vec3.dot(e,f);m.vec3.cross(b,d,e);d=m.vec3.dot(f,b);return Math.atan2(d,a)};b.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=
2*Math.PI;return a};b.applyRotation=t;b.intersectPlaneFromScreenPoint=function(c,d,b,e){return a.plane.intersectRay(c,a.ray.fromScreen(d,b,fa),e)};b.applyZoomToPoint=function(a,c,d,b){var e=g.sv3d.get();d=1-d;m.vec3.subtract(e,c,a.eye);var f=m.vec3.length(e),h=f*(1-d);0<=d&&h<b&&(h=b,d=-(h-f)/f);1E-6>Math.abs(f-h)||(m.vec3.scale(e,e,d),m.vec3.add(a.eye,a.eye,e),m.vec3.lerp(a.center,a.center,c,d))};b.applyZoomOnSphere=function(c,d,b){d.getScreenCenter(D);a.sphere.intersectScreen(c,d,D,d.center);d.markViewDirty();
c=d.distance;b*=c;1E-6>Math.abs(c-b)||(b=m.vec3.scale(g.sv3d.get(),d.viewForward,b),m.vec3.subtract(d.eye,d.center,b),d.markViewDirty())};var D=n.createScreenPointArray();b.centroidOnSphere=function(a,c,d){r(c,d);m.vec3.normalize(d,d);m.vec3.scale(d,d,a)};b.centroid=r;b.onSurfaceTiltToEyeTiltGlobal=y;b.offSurfaceTiltToEyeTiltGlobal=function(a,c,d){return y(Math.PI/2,c,d)+(a-Math.PI/2)};var G;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(G=b.PanMode||(b.PanMode={}));b.VerticalPanTresholds=
{Elevation:3E4,Angle:l.deg2rad(8)};b.PreservingHeadingThreshold={Pole:.95,Angle:l.deg2rad(18),Tilt:45};b.TiltThresholdPanningSpeed=l.deg2rad(80);b.pickPointAndInitSphere=function(c,d,e,g){var f=p.vec3f64.create(),h=a.sphere.create(),l=!0;c.intersectScreen(e,f)?h.radius=m.vec3.length(f):(h.radius=d.aboveGround?Math.max(m.vec3.length(d.center),.9*b.Earth.radius):m.vec3.length(d.eye)-d.relativeElevation,g?w(h,d,e,f):l=a.sphere.intersectScreen(h,d,e,f));return{sphere:h,scenePickPoint:l?f:null}};b.decidePanMode=
function(a,c,d){var e=m.vec3.length(a.eye);if(Math.abs(e-b.Earth.radius)>b.VerticalPanTresholds.Elevation)return G.Horizontal;if(a.aboveGround===c.radius>e)return G.Vertical;m.vec3.subtract(K,a.eye,d);m.vec3.normalize(K,K);return Math.abs(.5*Math.PI-l.acos(m.vec3.dot(d,K)/m.vec3.length(d)))<b.VerticalPanTresholds.Angle?G.Vertical:G.Horizontal};var K=p.vec3f64.create();b.applyPanPlanar=function(a,c,d){m.vec3.subtract(M,d,c);m.vec3.subtract(a.eye,a.eye,M);m.vec3.subtract(a.center,a.center,M);a.markViewDirty()};
var M=p.vec3f64.create();b.sphereOrPlanePointFromScreenPoint=w;var O=p.vec3f64.create(),N=p.vec3f64.create(),P=a.plane.create();b.rotationAngleAndAxisDirectRotation=x;var L=p.vec3f64.create();b.lengthFromPoints=v;b.rotationAnglesHeadingPreserving=z;b.rotationAnglesAndAxesHeadingPreserving=A;b.rotatePointAroundTwoAxes=B;b.applyRotationWithTwoAxes=C;b.preserveHeadingThreshold=E;b.applyPanSphericalDirectRotation=F;b.applyPanSphericalPreserveHeading=H;b.panToPosition=function(a,c,d,e,g,f,h){E(d,m.vec3.dot(c.up,
d),a.radius,-l.cyclicalPI.normalize(l.deg2rad(g)),f,c,b.PreservingHeadingThreshold.Pole,b.PreservingHeadingThreshold.Angle)?H(a,c,d,e,-l.cyclicalPI.normalize(l.deg2rad(g)),f,h):F(a,c,d,e,f,h)};b.panMotionToRotationMatrix=function(a,c,d,b,h,p,k,r,t){if(E(a.center,m.vec3.dot(a.up,a.center),m.vec3.length(a.center),-l.cyclicalPI.normalize(l.deg2rad(p)),k,c))switch(a=-l.cyclicalPI.normalize(l.deg2rad(h)),e.coordinateSystemFromOneAxisAndNormalVector([0,0,1],c.eye,T,R,J),h=d.translation[0]*b.pan,p=d.translation[1]*
b.pan,c=Math.max(Math.sqrt(Math.abs(1-Math.pow(m.vec3.dot(c.center,T),2)/Math.pow(m.vec3.length(c.center),2))),.5),k=-Math.cos(a)*p+Math.sin(a)*h,f.mat4.rotate(r.pan.matrix,r.pan.matrix,(Math.sin(a)*p+Math.cos(a)*h)/c,T),r.pan.enabled=!0,t.mode){case "pan":f.mat4.rotate(r.pan.matrix,r.pan.matrix,k,R);r.pan.enabled=!0;break;case "zoom":r.zoom=-d.translation[1]*b.zoom}else switch(a=c.eye,c=c.viewRight,a=m.vec3.cross(g.sv3d.get(),c,a),h=d.translation[0]*b.pan,0!==h&&(f.mat4.rotate(r.pan.matrix,r.pan.matrix,
-h,a),r.pan.enabled=!0),t.mode){case "pan":d=d.translation[1]*b.pan;0!==d&&(f.mat4.rotate(r.pan.matrix,r.pan.matrix,d,c),r.pan.enabled=!0);break;case "zoom":r.zoom=-d.translation[1]*b.zoom}};var T=p.vec3f64.create(),R=p.vec3f64.create(),J=p.vec3f64.create(),U=p.vec3f64.create(),Q=p.vec3f64.create(),I=p.vec3f64.create(),V=p.vec3f64.create(),X=p.vec3f64.create(),W=h.vec2f64.create(),ca=a.axisAngle.create(),da=k.mat4f64.create(),ba=k.mat4f64.create(),aa=k.mat4f64.create(),S=p.vec3f64.create(),Z=p.vec3f64.create(),
Y=p.vec3f64.create(),ea=new u,ga=p.vec3f64.create(),ja=p.vec3f64.create(),fa={origin:p.vec3f64.create(),direction:p.vec3f64.create()}})},"esri/views/3d/support/geometryUtils/coordinateSystem":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat4","../../../../core/libs/gl-matrix-2/vec3","../../../../core/libs/gl-matrix-2/vec3f64"],function(q,b,n,f,k){function d(a){return{operations:a,value:a.create()}}function h(a,c,d,b){return a.operations.setAltitudeAt(a.value,c,d,b)}Object.defineProperty(b,
"__esModule",{value:!0});b.create=function(a){var c=a.operations;return{operations:c,value:c.create(a.value)}};b.setExtent=function(a,c,d){a.operations.setExtent(a.value,c,d.value);return d};b.createFromOperations=d;b.fromValues=function(a,c,b){void 0===b&&(b=d(a));b.operations=a;a.copy(c,b.value);return b};b.wrap=function(a,c){p.operations=a;p.value=c;return p};b.normalAt=function(a,c,d){return a.operations.axisAt(a.value,c,2,d)};b.axisAt=function(a,c,d,b){return a.operations.axisAt(a.value,c,d,
b)};b.intersectRay=function(a,c,d){return a.operations.intersectRay(a.value,c,d)};b.intersectsRay=function(a,c){return a.operations.intersectRay(a.value,c,null)};b.closestPoint=function(a,c,d){return a.operations.closestPoint(a.value,c,d)};b.intersectRayClosestSilhouette=function(a,c,d){return a.operations.intersectRayClosestSilhouette(a.value,c,d)};b.closestPointOnSilhouette=function(a,c,d){return a.operations.closestPointOnSilhouette(a.value,c,d)};b.distanceToSilhouette=function(a,c){return a.operations.distanceToSilhouette(a.value,
c)};b.altitudeAt=function(a,c){return a.operations.altitudeAt(a.value,c)};b.setAltitudeAt=h;b.setAltitudeOfTransformation=function(a,c,d,b){c!==b&&n.mat4.copy(b,c);f.vec3.set(m,b[12],b[13],b[14]);h(a,m,d,m);b[12]=m[0];b[13]=m[1];b[14]=m[2];return b};b.elevate=function(a,c,d){return a.operations.elevate(a.value,c,d.value)};var m=k.vec3f64.create(),p={operations:null,value:null};b.vectorCoordinates=function(a,c,d,b,h){h[0]=f.vec3.dot(a,c);h[1]=f.vec3.dot(a,d);h[2]=f.vec3.dot(a,b);return h};b.coordinateSystemFromOneAxisAndNormalVector=
function(a,d,b,e,h){f.vec3.copy(b,a);f.vec3.copy(c,d);f.vec3.normalize(c,c);f.vec3.cross(e,c,b);f.vec3.cross(h,e,b)};var c=k.vec3f64.create()})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),
function(q,b,n,f,k,d,h,m,p){Object.defineProperty(b,"__esModule",{value:!0});q=function(c){function a(a,d){var b=c.call(this,a.state,a.sceneIntersectionHelper,"interaction"===d?null:void 0)||this;b.view=a;b.mode=d;b.zoomLocation=k.vec3f64.create();b.tmpCamera=new m;b.tmpRayDir=k.vec3f64.create();b.tmpCenter=k.vec3f64.create();b.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new m,interactionDirection:null,tiltMode:0};return b}n(a,c);Object.defineProperty(a.prototype,
"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});a.prototype.zoomStep=function(a,c){if(this.active){var d=this.view.state,b=this.constraintOptions.interactionStartCamera;this.animation.finished?b.copyFrom(d.camera):this.animation.cameraAt(1,b);this.tmpCamera.copyFrom(d.camera);0<a?(this.intersectionHelper.intersectScreenFreePointFallback(c,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.tmpCenter)&&(this.tmpCamera.center=
this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:f.vec3.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,c);this.begin(this.tmpCamera)}};a.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:p.outExpo}};a.prototype.updateCamera=function(a,c,b,h){f.vec3.subtract(this.tmpRayDir,b,a.eye);h=f.vec3.length(this.tmpRayDir);var e=h*c;1>=c&&
4>e&&(e=4,c=e/h);1E-6>Math.abs(h-e)||(f.vec3.scale(this.tmpRayDir,this.tmpRayDir,c),f.vec3.subtract(a.eye,b,this.tmpRayDir),f.vec3.lerp(a.center,a.center,b,1-c),d.applyAll(this.view,a,this.constraintOptions))};return a}(h.PointToPointAnimationController);b.ZoomStepController=q})},"esri/views/input/handlers/support":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.eventMatchesPointerAction=function(b,f){switch(f){case "primary":return"touch"===
b.pointerType||0===b.button;case "secondary":return"touch"!==b.pointerType&&2===b.button;case "tertiary":return"touch"!==b.pointerType&&1===b.button}};b.eventMatchesMousePointerAction=function(b,f){if("touch"===b.pointerType)return!1;switch(f){case "primary":return 0===b.button;case "secondary":return 2===b.button;case "tertiary":return 1===b.button}}})},"esri/views/3d/input/handlers/DragRotate":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(q,b,n,f,k,d,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(d){function b(c,a,b,g){var e=d.call(this,!0)||this;e.view=c;e.pointerAction=a;e.pivotPoint=b;e.registerIncoming("drag",g,function(a){return e.handleDrag(a)});return e}n(b,d);b.prototype.handleDrag=function(c){var a=c.data;if(!(1<a.pointers.size)&&h.eventMatchesMousePointerAction(c.data,this.pointerAction)){var d=f.createScreenPointArray(a.center.x,a.center.y);switch(a.action){case "start":this.cameraController&&(this.cameraController.end(),
this.cameraController=null);this.cameraController=new k.RotateController(this.view,this.view.sceneIntersectionHelper,this.pivotPoint);this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":this.cameraController&&this.cameraController.update(d);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}c.stopPropagation()}};return b}(d.InputHandler);b.DragRotate=q})},"esri/views/3d/state/controllers/RotateController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils ../../support/mathUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function l(a,c,d){var e=b.call(this)||this;e.view=a;e.intersectionHelper=c;e.pivot=d;e.lastPoint=h.vec2f64.create();e.tmpWorldUp=p.vec3f64.create();e.tmpViewDir=p.vec3f64.create();e.tmpRotCurPoint=h.vec2f64.create();e.tmpTransf=k.mat4f64.create();e.tmpAxis=p.vec3f64.create();e.pivotPos=p.vec3f64.create();e.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,
interactionDirection:null,tiltMode:0};e.rotScale="center"===d?3:1.5;return e}n(l,b);l.prototype.begin=function(a){if(this.active){switch(this.pivot){case "eye":m.vec3.copy(this.pivotPos,this.beginCamera.eye);this.constraintOptions.interactionType=3;this.constraintOptions.tiltMode=1;this.constraintOptions.selection=0;break;case "center":this.intersectionHelper.intersectRayFreePointFallback(this.beginCamera.ray,this.pivotPos)||m.vec3.copy(this.pivotPos,this.beginCamera.center),this.beginCamera.center=
this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;g.normalizeCoordinate(this.beginCamera,a,this.lastPoint)}};l.prototype.update=function(a){if(this.active){var d;switch(this.pivot){case "eye":d=this.currentCamera.center;break;case "center":this.currentCamera.center=this.pivotPos,d=this.currentCamera.eye}this.applyRotation(this.currentCamera,a,d,this.pivotPos);c.applyAll(this.view,
this.currentCamera,this.constraintOptions)}};l.prototype.end=function(){this.active&&this.finishController()};l.prototype.applyRotation=function(c,b,h,l){this.view.renderCoordsHelper.worldUpAtPosition(l,this.tmpWorldUp);g.normalizeCoordinate(c,b,this.tmpRotCurPoint);b=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale;var p=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;m.vec3.subtract(this.tmpViewDir,h,l);var k=m.vec3.length(this.tmpViewDir),k=e.acos(m.vec3.dot(this.tmpViewDir,this.tmpWorldUp)/
k);if("eye"===this.pivot){var r=.5*Math.PI-k,t=.495*Math.PI;b=r-Math.max(-t,Math.min(t,r+-.5*b))}b=e.clamp(b+k,a.TiltDefault.min,a.TiltDefault.max)-k;f.mat4.identity(this.tmpTransf);m.vec3.cross(this.tmpAxis,c.up,this.tmpViewDir);"center"===this.pivot&&(p=-p);f.mat4.rotate(this.tmpTransf,this.tmpTransf,p,this.tmpWorldUp);f.mat4.rotate(this.tmpTransf,this.tmpTransf,b,this.tmpAxis);m.vec3.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);m.vec3.add(h,l,this.tmpViewDir);m.vec3.transformMat4(c.up,
c.up,this.tmpTransf);d.vec2.copy(this.lastPoint,this.tmpRotCurPoint);c.markViewDirty()};return l}(l.InteractiveController);b.RotateController=q})},"esri/views/3d/state/controllers/InteractiveController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./CameraController","../../webgl-engine/lib/Camera"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});q=function(d){function b(){var b=null!==d&&d.apply(this,arguments)||this;b.beginCamera=new k;
b.currentCamera=new k;return b}n(b,d);Object.defineProperty(b.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});b.prototype.stepController=function(b,f){d.prototype.stepController.call(this,b,f);f.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(f)};b.prototype.onControllerStart=function(b){d.prototype.onControllerStart.call(this,b);this.beginCamera.copyFrom(b);this.currentCamera.copyFrom(b)};b.prototype.onControllerEnd=function(b){b.copyViewFrom(this.currentCamera);
d.prototype.onControllerEnd.call(this,b)};return b}(f.CameraController);b.InteractiveController=q})},"esri/views/3d/input/handlers/DragZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(q,b,n,f,k,d,h,m){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function c(a,
c,d){var e=b.call(this,!0)||this;e.view=a;e.pointerAction=c;e.registerIncoming("drag",d,function(a){return e.handleDrag(a)});return e}n(c,b);c.prototype.handleDrag=function(a){var c=a.data;if(!(1<c.pointers.size)&&m.eventMatchesMousePointerAction(a.data,this.pointerAction)){var b=f.createScreenPointArray(c.center.x,c.center.y);switch(c.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=this.view.state.isGlobal?new k.ZoomController(this.view,
this.view.sceneIntersectionHelper):new d.ZoomController(this.view,this.view.sceneIntersectionHelper);this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(b);break;case "update":this.cameraController&&this.cameraController.update(b);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}a.stopPropagation()}};return c}(h.InputHandler);b.DragZoom=q})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l){Object.defineProperty(b,"__esModule",{value:!0});q=function(c){function b(a,b){var e=c.call(this)||this;e.view=a;e.intersectionHelper=b;e.pickPoint=m.vec3f64.create();e.tmpP0=d.vec2f64.create();e.panAxisAngle=l.axisAngle.create();e.tmpRayDir=m.vec3f64.create();e.targetOnSphere=m.vec3f64.create();e.dragBeginPoint=f.createScreenPointArray();e.normalizedAnchorPoint=d.vec2f64.create();e.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,
interactionDirection:null,tiltMode:0};e.sphere=l.sphere.create();e.hasPickPoint=!1;return e}n(b,c);b.prototype.begin=function(c){this.active&&(k.vec2.copy(this.dragBeginPoint,c),a.normalizeCoordinate(this.beginCamera,c,this.normalizedAnchorPoint),c=a.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,c,!1),this.hasPickPoint=!!c.scenePickPoint,this.pickPoint=c.scenePickPoint,this.sphere=c.sphere,this.constraintOptions.interactionStartCamera=this.beginCamera)};b.prototype.update=function(c){if(this.active){this.currentCamera.eye=
this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;h.vec3.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var d=h.vec3.length(this.tmpRayDir);a.normalizeCoordinate(this.currentCamera,c,this.tmpP0);var b=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),e=d*Math.pow(2,b),g=this.view.state.constraints.minimumPoiDistance;0>b&&e<g&&(e=g);1E-6>Math.abs(d-e)||(this.hasPickPoint&&e<d&&(b=1-(1-e/d)*(1-this.sphere.radius/
h.vec3.length(this.currentCamera.center)),h.vec3.scale(this.currentCamera.center,this.currentCamera.center,b)),h.vec3.scale(this.tmpRayDir,this.tmpRayDir,-e/d),h.vec3.add(this.currentCamera.eye,this.currentCamera.center,this.tmpRayDir),this.constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(this.dragBeginPoint,c),p.applyAll(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(a.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,
this.targetOnSphere),l.axisAngle.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),a.applyRotation(this.currentCamera,this.sphere.center,this.panAxisAngle)),p.applySurfaceCollision(this.view,this.currentCamera))}};b.prototype.end=function(){this.active&&this.finishController()};return b}(c.InteractiveController);b.ZoomController=q})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec2f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils ../../../support/mathUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g){Object.defineProperty(b,"__esModule",{value:!0});q=function(c){function b(a,b){var e=c.call(this)||this;e.view=a;e.intersectionHelper=b;e.tmpP=m.vec3f64.create();e.tmpN=m.vec3f64.create();e.tmpP0=d.vec2f64.create();e.tmpPoi=m.vec3f64.create();e.tmpRayDir=m.vec3f64.create();e.dragBeginPoint=f.createScreenPointArray();e.normalizedAnchorPoint=d.vec2f64.create();e.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:m.vec3f64.create(),
tiltMode:0};e.plane=l.plane.create();return e}n(b,c);b.prototype.begin=function(c){this.active&&(k.vec2.copy(this.dragBeginPoint,c),a.normalizeCoordinate(this.beginCamera,c,this.normalizedAnchorPoint),this.intersectionHelper.intersectScreenFreePointFallback(c,this.tmpP),h.vec3.subtract(this.tmpN,this.beginCamera.eye,this.beginCamera.center),h.vec3.normalize(this.tmpN,this.tmpN),0>this.tmpN[1]&&h.vec3.negate(this.tmpN,this.tmpN),l.plane.fromPositionAndNormal(this.tmpP,this.tmpN,this.plane),this.constraintOptions.interactionStartCamera=
this.beginCamera)};b.prototype.update=function(c){if(this.active){a.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||h.vec3.copy(this.tmpPoi,this.currentCamera.center);a.normalizeCoordinate(this.currentCamera,c,this.tmpP0);var d=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);k.vec2.copy(this.normalizedAnchorPoint,this.tmpP0);h.vec3.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);var b=h.vec3.length(this.tmpRayDir),e=b*(1-d);h.vec3.copy(this.constraintOptions.interactionDirection,
this.tmpRayDir);h.vec3.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,g.sign(d)/b);var f=this.view.state.constraints.minimumPoiDistance;0<=d&&e<f&&(e=f,d=-(e-b)/b);1E-6>Math.abs(b-e)||(h.vec3.scale(this.tmpRayDir,this.tmpRayDir,d),h.vec3.add(this.currentCamera.eye,this.currentCamera.eye,this.tmpRayDir),h.vec3.lerp(this.currentCamera.center,this.currentCamera.center,this.tmpPoi,d),this.currentCamera.center[2]=this.tmpPoi[2]>this.beginCamera.center[2]?
Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):Math.min(this.beginCamera.center[2],this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=p.pixelDistanceToInteractionFactor(this.dragBeginPoint,c),p.applyAll(this.view,this.currentCamera,this.constraintOptions))}};b.prototype.end=function(){this.active&&this.finishController()};return b}(c.InteractiveController);b.ZoomController=q})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../../../core/watchUtils ../../state/controllers/GamepadKeyboardController ../../../input/InputHandler".split(" "),
function(q,b,n,f,k,d,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function h(c,a){var d=b.call(this,!0)||this;d.view=c;d.watchHandles=new f;d.handle=d.registerIncoming("gamepad",function(a){return d.handleEventGamepad(a)});d.handle.pause();return d}n(h,b);h.prototype.onInstall=function(c){var a=this;b.prototype.onInstall.call(this,c);this.watchHandles.add([k.init(this.view.navigation.gamepad,"enabled",function(c){c?a.handle.resume():(a.handle.pause(),a.cameraControllerGamepad&&
(a.cameraControllerGamepad.finishController(),a.cameraControllerGamepad=null))}),this.view.navigation.gamepad.watch("device",function(c){a.cameraControllerGamepad&&c&&a.cameraControllerGamepad.gamepadDevice!==c&&(a.cameraControllerGamepad.finishController(),a.cameraControllerGamepad=null)})])};h.prototype.onUninstall=function(){this.watchHandles.removeAll();b.prototype.onUninstall.call(this)};h.prototype.handleEventGamepad=function(c){var a=this.view.navigation.gamepad.device;if(!a||c.data.device===
a)if((a=this.cameraControllerGamepad&&this.cameraControllerGamepad.active)||d.GamepadKeyboardController.activatesFor(this.view,c.data))a||(a=new d.GamepadKeyboardController(this.view,c.data.device),this.view.state.switchCameraController(a)&&(this.cameraControllerGamepad=a)),this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===c.data.device&&this.cameraControllerGamepad.handleEventGamepad(c.data)};return h}(h.InputHandler);b.GamepadNavigation=
q})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../camera/constraintUtils ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils ../../support/stack ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z){Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function d(c,d,b){var e=a.call(this)||this;e.view=c;e.gamepadDevice=d;e.disableMovements=b;e.transformation={translation:[0,0,0],heading:0,tilt:0};e.keysButtonState=[0,0,0,0,0,0,0,0,0,0];e.tmpCamera=new v;e.constraintOptions={selection:15,interactionType:0,interactionStartCamera:new v,interactionFactor:0,interactionDirection:null,tiltMode:1};return e}n(d,a);d.prototype.handleEventGamepad=
function(a){var c=z.extractTransformation(a,this.view.navigation.gamepad,this.transformation);("end"===a.action||z.isZeroTransformation(c))&&this.finishController()};d.prototype.activateDirection=function(a){this.keysButtonState[a]=1;z.extractTransformationKeyboard(this.keysButtonState,this.transformation)};d.prototype.deactivateDirection=function(a){this.keysButtonState[a]=0;a=z.extractTransformationKeyboard(this.keysButtonState,this.transformation);z.isZeroTransformation(a)&&this.finishController()};
d.prototype.onControllerStart=function(c){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;this.headingStart=this.view.camera.heading;a.prototype.onControllerStart.call(this,c)};d.prototype.updateFilteredSurfaceElevation=function(a){this.filteredSurfaceElevation+=1*(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*a};d.prototype.stepController=function(c,d){this.updateStartHeading();this.updateFilteredSurfaceElevation(c);this.currentCamera.copyViewFrom(d);
this.updateCameraCenter();this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);this.calculateControlTransformation(c,this.currentCamera,G);this.applyDisabledMovementTypes(G);this.applyPan(G.pan);this.applyRotate(G.rotate);this.applyZoom(G.zoom);this.applyAscend(G.ascend);this.constraintOptions.interactionType=0;this.constraintOptions.selection=8;p.applyAll(this.view,this.currentCamera,this.constraintOptions);a.prototype.stepController.call(this,c,d)};d.prototype.updateStartHeading=
function(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)};d.prototype.applyRotate=function(a){if(a.enabled){var c=this.currentCamera,d=c.center,b=c.up,e=c.eye;h.vec3.subtract(d,d,e);h.vec3.transformMat4(d,d,a.matrix);h.vec3.add(d,d,e);h.vec3.transformMat4(b,b,a.matrix);c.markViewDirty();this.constraintOptions.interactionType=3;this.constraintOptions.selection=7;p.applyAll(this.view,c,this.constraintOptions)}};d.prototype.applyPan=function(a,c){void 0===c&&(c=this.currentCamera);
if(a.enabled){var d=c.center,b=c.eye,e=c.up;h.vec3.transformMat4(b,b,a.matrix);h.vec3.transformMat4(d,d,a.matrix);this.view.state.isGlobal&&h.vec3.transformMat4(e,e,a.matrix);c.markViewDirty();this.constraintOptions.interactionType=4;this.constraintOptions.selection=15;p.applyAll(this.view,c,this.constraintOptions)}};d.prototype.applyZoom=function(a){if(a){var c=this.currentCamera,d=c.eye,c=c.viewForward;h.vec3.add(d,d,h.vec3.scale(x.sv3d.get(),c,a));this.currentCamera.markViewDirty();h.vec3.copy(K,
c);h.vec3.negate(K,K);this.constraintOptions.interactionDirection=K;this.constraintOptions.interactionType=1;this.constraintOptions.selection=7;p.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};d.prototype.applyAscend=function(a){if(a){var c=this.currentCamera,d=c.center,c=c.eye,b=this.view.renderCoordsHelper.worldUpAtPosition(c,x.sv3d.get());this.constraintOptions.interactionDirection=h.vec3.copy(K,b);this.view.state.isGlobal?(b=h.vec3.length(c),
a=(b+a)/b,h.vec3.scale(c,c,a),h.vec3.scale(d,d,a)):(a=h.vec3.scale(x.sv3d.get(),b,a),h.vec3.add(c,c,a),h.vec3.add(d,d,a));this.currentCamera.markViewDirty();this.updateCameraCenter();this.constraintOptions.interactionType=5;this.constraintOptions.selection=8;p.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this.updateCameraCenter();this.constraintOptions.selection=7;p.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};d.prototype.calculateControlTransformation=
function(a,c,d){d.zoom=0;d.ascend=0;d.pan.enabled=!1;k.mat4.identity(d.pan.matrix);d.rotate.enabled=!1;k.mat4.identity(d.rotate.matrix);a=this.computeVelocities(a);this.view.state.isLocal?this.calculateControlTransformationLocal(a,c,d):this.calculateControlTransformationGlobal(a,c,d)};d.prototype.updateCameraCenter=function(){var a=this.currentCamera;this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(a.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,a.center);
this.currentCamera.markViewDirty()};d.prototype.calculateControlTransformationLocal=function(a,d,b){var g=d.viewRight,l=d.viewForward,m=this.transformation,p=this.view.navigation.gamepad,l=h.vec3.set(x.sv3d.get(),l[0],l[1],0);h.vec3.normalize(l,l);var r=m.translation[0]*a.pan;0!==r&&(r=h.vec3.scale(x.sv3d.get(),g,r),k.mat4.translate(b.pan.matrix,b.pan.matrix,r),b.pan.enabled=!0);switch(p.mode){case "pan":p=-m.translation[1]*a.pan;0!==p&&(p=h.vec3.scale(x.sv3d.get(),l,p),k.mat4.translate(b.pan.matrix,
b.pan.matrix,p),b.pan.enabled=!0);break;case "zoom":b.zoom=-m.translation[1]*a.zoom;break;default:f.neverReached(p.mode)}b.ascend=m.translation[2]*a.ascend;p=-m.heading*a.rotate;0!==p&&(k.mat4.rotate(b.rotate.matrix,b.rotate.matrix,p,this.view.renderCoordsHelper.worldUpAtPosition(d.eye,x.sv3d.get())),b.rotate.enabled=!0);a=m.tilt*a.rotate;d=e.viewAngle(this.view.renderCoordsHelper,d.center,d.eye);if(d=w.clamp(d+a,c.TiltDefault.min,c.TiltDefault.max)-d)k.mat4.rotate(b.rotate.matrix,b.rotate.matrix,
d,g),b.rotate.enabled=!0};d.prototype.calculateControlTransformationGlobal=function(a,c,d){var b=c.eye,e=c.viewRight,g=this.transformation,f=this.view.navigation.gamepad,b=h.vec3.cross(x.sv3d.get(),e,b);h.vec3.normalize(b,b);h.vec3.negate(b,b);l.panMotionToRotationMatrix(this.beginCamera,c,g,a,this.view.camera.heading,this.headingStart,this.view.camera.tilt,d,f);this.tmpCamera.copyFrom(this.currentCamera);this.applyPan(G.pan,this.tmpCamera);f=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;
d.ascend=g.translation[2]*a.ascend;b=-g.heading*a.rotate;0!==b&&(k.mat4.rotate(d.rotate.matrix,d.rotate.matrix,b,this.tmpCamera.eye),d.rotate.enabled=!0);a=this.clampTiltDeltaGlobalToValidRange(g.tilt*a.rotate,c.ray,f);0!==a&&(k.mat4.rotate(d.rotate.matrix,d.rotate.matrix,a,this.tmpCamera.viewRight),d.rotate.enabled=!0)};d.prototype.clampTiltDeltaGlobalToValidRange=function(a,d,b){var f=g.onSurfaceTiltToEyeTiltGlobal(c.TiltDefault.min,d.origin,b),l=0,m=0,l=x.sv3d.get();this.view.renderCoordsHelper.intersectManifold(d,
b,l)?(l=e.viewAngle(this.view.renderCoordsHelper,l,d.origin),l=g.onSurfaceTiltToEyeTiltGlobal(l,d.origin,b),m=g.onSurfaceTiltToEyeTiltGlobal(c.TiltDefault.max,d.origin,b)):(y.sphere.closestPointOnSilhouette(y.sphere.wrap(b+r.earthRadius),d,l),l=w.acos(-h.vec3.dot(d.direction,h.vec3.normalize(l,l))),l=g.offSurfaceTiltToEyeTiltGlobal(l,d.origin,b),m=g.offSurfaceTiltToEyeTiltGlobal(c.TiltDefault.max,d.origin,b));return w.clamp(l+a,f,m)-l};d.prototype.getPointAbsoluteSurfaceElevation=function(a,c,d){var b=
this.view.renderCoordsHelper,e=b.getAltitude(a);c+=Math.abs(e-c);h.vec3.copy(d,a);b.setAltitude(c,d);return c};d.prototype.clampedDistanceToSurface=function(a,c){var d=this.view.renderCoordsHelper,b=this.view.state.camera,e=u.headingTiltToDirectionUp(this.view,c,0,B,M).direction,e=d.intersectManifoldClosestSilhouette(y.ray.wrap(c,e),a,x.sv3d.get()),e=h.vec3.distance(c,e);a=d.intersectManifoldClosestSilhouette(y.ray.wrap(c,w.directionFromTo(x.sv3d.get(),c,b.center)),a,x.sv3d.get());c=h.vec3.distance(c,
a);return Math.min(e,c)};d.prototype.computeHeadingRotateRadius=function(a){var c=this.view,d=c.renderCoordsHelper,b=c.state,c=b.isGlobal,b=d.intersectManifoldClosestSilhouette(b.camera.ray,this.filteredSurfaceElevation,x.sv3d.get());if(c)return c=h.vec3.subtract(x.sv3d.get(),a,b),d=h.vec3.length(c),h.vec3.scale(c,c,1/d),a=h.vec3.normalize(x.sv3d.get(),a),a=w.acos(h.vec3.dot(a,c)),d*Math.sin(Math.min(C,a));a=h.vec3.copy(x.sv3d.get(),a);d.setAltitude(this.filteredSurfaceElevation,a);return h.vec3.distance(b,
a)};d.prototype.minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:F};d.prototype.computeVelocities=function(a){var c=this.filteredSurfaceElevation,d=c+r.earthRadius,b=this.view.state,e=b.camera,g=b.isGlobal,f=x.sv3d.get(),h=this.getPointAbsoluteSurfaceElevation(e.eye,c,f),l=this.clampedDistanceToSurface(c,f),m=e.width/2,p=E*e.width,b=E*e.width,e=l*Math.tan(.5*e.fovX)/m,k=e/d,d=e/this.computeHeadingRotateRadius(f),g=(g?k:e)*p*a,c=h-c,c=Math.max(this.minimumAscendVelocity()*
a,Math.pow(2,p*a/m)*c-c),l=Math.pow(2,p*a/m)*l-l;a*=w.clamp(d*b,H,D);return{pan:g,ascend:c,zoom:l,rotate:a}};d.prototype.applyDisabledMovementTypes=function(a){void 0===this.disableMovements||void 0!==this.disableMovements.mode&&this.view.state.mode!==this.disableMovements.mode||(a.zoom=this.disableMovements.zoom?0:a.zoom,a.ascend=this.disableMovements.ascend?0:a.ascend,a.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&k.mat4.identity(a.pan.matrix),a.rotate.enabled=!this.disableMovements.rotate,
this.disableMovements.rotate&&k.mat4.identity(a.rotate.matrix))};d.activatesFor=function(a,c){a=z.extractTransformation(c,a.navigation.gamepad,A);return!("end"===c.action||z.isZeroTransformation(a))};return d}(a.InteractiveController);b.GamepadKeyboardController=q;var A={translation:[0,0,0],heading:0,tilt:0},B=80,C=w.deg2rad(B),E=.75,F=5,H=w.deg2rad(30),D=w.deg2rad(80),G={zoom:0,ascend:0,pan:{enabled:!1,matrix:d.mat4f64.create()},rotate:{enabled:!1,matrix:d.mat4f64.create()}},K=m.vec3f64.create(),
M=t.createDirectionUp()})},"esri/views/3d/support/cameraUtils":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../Camera ../../../config ../../../core/Logger ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtilsPlanar ./cameraUtilsSpherical ./earthUtils ./mathUtils ./projectionUtils ../webgl-engine/lib/Camera".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x){function v(a){return"global"===a.viewingMode?t:u}function z(d,b,e){var g=d.renderSpatialReference,h=m.vec3.copy(J,b.viewForward),h=E(d,b.eye,h,b.up,U);d=d.spatialReference||a.WGS84;w.vectorToVector(b.eye,g,T,d)||(d=a.WGS84,w.vectorToVector(b.eye,g,T,d));if(!e)return new f(new c(T,d),h.heading,h.tilt,y.rad2deg(b.fov));e.position.x=T[0];e.position.y=T[1];e.position.z=T[2];e.position.spatialReference=d;e.heading=h.heading;e.tilt=h.tilt;e.fov=y.rad2deg(b.fov);
return e}function A(a,c,d){var b=a.state.camera,e=b.fovX,b=b.width/2/b.pixelRatio;"global"===a.viewingMode&&null!=d&&(c*=Math.cos(y.deg2rad(d)));c/=a.renderCoordsHelper.unitInMeters;return b/(39.37*k.screenDPI/c)/Math.tan(e/2)}function B(a,c,d){var b=a.state.camera;c=39.37*k.screenDPI/(b.width/2/b.pixelRatio/(c*Math.tan(b.fovX/2)));"global"===a.viewingMode&&(c/=Math.cos(y.deg2rad(d)));return c*=a.renderCoordsHelper.unitInMeters}function C(a,c,d,b,e,g){if(P(g)){var f=h.createResolver();K(a,b.heading,
b.tilt,c,d,e,f);f.promise.then(function(c){return g.resolve(N(a,c,b.fov))})}else return c=K(a,b.heading,b.tilt,c,d,e),N(a,c,b.fov,g)}function E(a,c,d,b,e){return v(a).directionToHeadingTilt(c,d,b,e)}function F(a,c,d){return a.basemapTerrain&&a.renderCoordsHelper.fromRenderCoords(c,Q,a.spatialReference)&&a.basemapTerrain.getElevation(Q)>Q.z-1}function H(a,c,d){return a.renderCoordsHelper.fromRenderCoords(c,Q,a.spatialReference)?a.elevationProvider.queryElevation(Q).then(function(a){return a>Q.z-10}):
h.resolve(!1)}function D(a,d){var b=p.vec3f64.create();if(d)if(d instanceof c){if(w.pointToVector(d,b,a.renderSpatialReference),null==d.z&&null!=a.basemapTerrain)return a.elevationProvider.queryElevation(d).then(function(c){null!=c&&a.renderCoordsHelper.setAltitude(c,b);return b})}else m.vec3.copy(b,d);else m.vec3.copy(b,a.state.camera.center);return h.resolve(b)}function G(a,d){var b=p.vec3f64.create();d&&d instanceof c?(w.pointToVector(d,b,a.renderSpatialReference),null==d.z&&null!=a.basemapTerrain&&
(d=a.elevationProvider.getElevation(d),null!=d&&a.renderCoordsHelper.setAltitude(d,b))):d?m.vec3.copy(b,d):m.vec3.copy(b,a.state.camera.center);return b}function K(a,d,b,e,g,f,h){var l=e&&e instanceof c?e:null;if(P(h))D(a,e).then(function(c){M(a,d,b,l,c,g,f,h)});else return e=G(a,e),M(a,d,b,l,e,g,f,h)}function M(c,d,b,e,g,f,h,l){e||(e=w.vectorToPoint(g,c.renderSpatialReference,c.spatialReference||a.WGS84));f=Math.max(f,c.state.constraints.minimumPoiDistance);var m=O(c,d,b,g,f,h),k=v(c).eyeForCenterWithHeadingTilt,
r=k(g,f,m.heading,m.tilt);if(h===V.ADJUST&&"global"===c.viewingMode&&0<b){var t=function(){var a=f,m=f,p=c.state.constraints.tilt(m),m=v(c).eyeTiltToLookAtTilt(g,m,b),m=Math.min(m,.5*Math.PI),p=p.min*(1-X)+m*X,a=v(c).lookAtTiltToEyeTilt(g,a,p);h=1>b-a?V.LOCKED:V.ADJUST;return M(c,d,a,e,g,f,h,l)};if(F(c,r.eye,r.tilt))return t();if(P(l)){H(c,r.eye,r.tilt).then(function(a){if(a)return t();l.resolve({eye:r.eye,up:r.up,center:p.vec3f64.clone(g),heading:r.heading,tilt:r.tilt})});return}}m={center:p.vec3f64.create(),
eye:p.vec3f64.create(),up:p.vec3f64.create(),tilt:0,heading:0};l&&!P(l)&&(m=l);m.eye=r.eye;m.up=r.up;m.center=p.vec3f64.clone(g);m.heading=r.heading;m.tilt=r.tilt;P(l)&&l.resolve(m);return m}function O(c,d,b,e,g,f){var h=0;if(f=f===V.ADJUST)if(h=c.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(g/h)/Math.LN2)f=!0;else{var l=c.renderSpatialReference,m=c.spatialReference||a.WGS84;f=w.vectorToPoint(e,l,m);l=w.vectorToPoint(c.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,l,m);h*=
Math.tan(.5*c.state.camera.fov);f=5<l.distance(f)/h}f?(d=0,f=c.state.constraints.tilt(g),f.max=Math.min(f.max,.5*Math.PI),f=f.min*(1-X)+f.max*X,b=v(c).eyeTiltToLookAtTilt(e,g,b),h=Math.min(b,f)):h=v(c).eyeTiltToLookAtTilt(e,g,b);b=h=c.state.constraints.clampTilt(g,h);b=v(c).lookAtTiltToEyeTilt(e,g,b);return{heading:d,tilt:b}}function N(c,d,b,e){c=w.vectorToPoint(d.eye,c.renderSpatialReference,c.spatialReference||a.WGS84);return c?e?(e.position=c,e.heading=d.heading,e.tilt=d.tilt,e.fov=b,e):new f(c,
d.heading,d.tilt,b):null}function P(a){return a&&a.resolve&&a.reject}Object.defineProperty(b,"__esModule",{value:!0});var L=d.getLogger("esri.views.3d.support.cameraUtils"),T=p.vec3f64.create(),R=p.vec3f64.create(),J=p.vec3f64.create(),U={heading:0,tilt:0},Q=new c,I=new y.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),V;(function(a){a[a.LOCKED=0]="LOCKED";a[a.ADJUST=1]="ADJUST"})(V=b.OrientationMode||(b.OrientationMode={}));b.headingTiltToDirectionUp=function(a,c,d,b,e){return v(a).headingTiltToDirectionUp(c,
d,b,e)};b.externalToInternal=function(a,c){var d=a.renderSpatialReference,b=v(a).headingTiltToDirectionUp,g=p.vec3f64.create();if(!w.pointToVector(c.position,g,d))return null;d=b(g,c.heading,c.tilt);m.vec3.scale(d.direction,d.direction,a.state.camera.distance);m.vec3.add(d.direction,d.direction,g);a=e.cameraOnContentAlongViewDirection(a,g,d.direction,d.up);a.fov=y.deg2rad(c.fov);return a};b.internalToExternal=z;b.scaleToDistance=A;b.distanceToScale=B;b.fromCenterScale=function(a,c,d,b,e,g){d=A(a,
d,c.latitude);return C(a,c,d,b,e,g)};b.fromCenterDistance=C;b.directionToHeadingTilt=E;b.getObserverForPointAtDistance=K;b.fromExtent=function(d,b,e,f,l,m){var p,k=0;null!=b.zmax&&null!=b.zmin&&(p=(b.zmax+b.zmin)/2,k=b.zmax-b.zmin);var t,u;if("global"===d.viewingMode){t=a.WebMercator;u=b.spatialReference||t;var n=new c(b.xmin,b.ymin,u),x=new c(b.xmax,b.ymax,u),n=g.project(n,t),x=g.project(x,t);if(null===n||null===x){P(m)&&m.reject();return}b=new c(I.center(n.x,x.x),(x.y+n.y)/2,t);null!=p&&(b.z=p);
p=r.getGreatCircleSpanAt(b,n,x);t=p.lon;u=p.lat;I.diff(n.x,x.x)>I.range/2&&(t+=r.halfEarthCircumference);t=Math.min(t,r.halfEarthCircumference);u=Math.min(u,r.halfEarthCircumference)}else n=d.spatialReference||a.WGS84,g.canProject(b,n)&&(b=g.project(b,n)),t=b.xmax-b.xmin,u=b.ymax-b.ymin,b=new c({x:b.xmin+.5*t,y:b.ymin+.5*u,z:p,spatialReference:n});p=d.state.camera;k=Math.max(1/Math.tan(p.fovX/2)*t*.5,1/Math.tan(p.fovY/2)*u*.5,1/Math.tan(p.fov/2)*k*.5)/1;if(P(m))p=h.createResolver(),K(d,e,f,b,k,l,
p),p.promise.then(function(a){return m.resolve(N(d,a,d.camera.fov))});else return e=K(d,e,f,b,k,l),N(d,e,d.camera.fov,m)};b.toExtent=function(c,d,b,e,g){d||(b||(b=c.state.camera),d=z(c,b,g));g=c.renderSpatialReference;var f;if(b)g=w.vectorToPoint(b.center,g,c.spatialReference||a.WGS84),f=b.distance;else{g=c.toMap(c.screenCenter);if(!g)return null;f=r.computeCarthesianDistance(d.position,g)}b||(b=c.state.camera);d=2*f*Math.tan(b.fovX/2)*1;b=2*f*Math.tan(b.fovY/2)*1;return"global"===c.viewingMode?t.toExtent(c,
g,d,b,e):u.toExtent(c,g,d,b,e)};var X=.7;b.observerToCamera=N;b.scaleToZoom=function(a,c){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.levelAtScale(c);L.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};b.zoomToScale=function(a,c){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.scaleAtLevel(c);L.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};b.scaleToResolution=function(a,c){return a.spatialReference?
l.getResolutionForScale(c,a.spatialReference):void 0};b.computeScale=function(c,d,b){var e=c.renderSpatialReference;d||(d=c.state.camera);var g;g=a.WGS84;d instanceof x?(w.vectorToVector(d.center,e,R,g),g=R[1],d=d.distance):(g=d.position.latitude,w.pointToVector(d.position,T,e),w.pointToVector(b,R,e),d=m.vec3.distance(T,R));return B(c,d,g)}})},"esri/views/3d/support/cameraUtilsPlanar":function(){define("require exports ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ./cameraUtilsInternal ./mathUtils ./projectionUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c){function a(a,c,d,b){void 0===b&&(b=m.createDirectionUp());n.mat4.identity(e);a=b.direction;var f=b.up;n.mat4.rotateZ(e,e,-p.deg2rad(c));n.mat4.rotateX(e,e,p.deg2rad(d));k.vec3.transformMat4(a,g,e);k.vec3.scale(a,a,-1);k.vec3.transformMat4(f,l,e);return b}Object.defineProperty(b,"__esModule",{value:!0});var l=d.vec3f64.fromValues(0,1,0),g=d.vec3f64.fromValues(0,0,1),e=f.mat4f64.create(),u=d.vec3f64.create(),t=d.vec3f64.create();b.headingTiltToDirectionUp=a;b.directionToHeadingTilt=
function(a,c,d,b){return m.directionToHeadingTilt(c,d,b,g,l)};b.eyeForCenterWithHeadingTilt=function(c,b,e,g){var f=a(c,e,g),h=d.vec3f64.create();k.vec3.scale(h,f.direction,-b);k.vec3.add(h,h,c);return{up:f.up,eye:h,heading:e,tilt:g}};b.lookAtTiltToEyeTilt=function(a,c,d){return p.rad2deg(d)};b.eyeTiltToLookAtTilt=function(a,c,d){return p.deg2rad(d)};b.toExtent=function(a,d,b,e,g){var f=a.renderSpatialReference;a=a.map&&a.spatialReference||d.spatialReference;c.pointToVector(d,u,f);c.pointToVector(d,
t,f);u[0]-=b/2;t[0]+=b/2;u[1]-=e/2;t[1]+=e/2;c.vectorToVector(u,f,u,a);c.vectorToVector(t,f,t,a);g?(g.xmin=u[0],g.ymin=u[1],g.xmax=t[0],g.ymax=t[1],g.spatialReference=a):g=new h(u[0],u[1],t[0],t[1],a);return g}})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec3","../../../core/libs/gl-matrix-2/vec3f64","./mathUtils"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});var d=f.vec3f64.create(),h=f.vec3f64.create();
b.createDirectionUp=function(){return{direction:f.vec3f64.create(),up:f.vec3f64.create()}};b.directionToHeadingTilt=function(b,f,c,a,l){var g=d;n.vec3.normalize(g,b);var e=n.vec3.dot(g,a),m=0<e,e=Math.abs(e);.99<e&&(e=Math.abs(n.vec3.dot(f,a)),.99>e?(n.vec3.copy(g,f),m&&n.vec3.scale(g,g,-1)):g=null);f=0;g&&(n.vec3.scale(h,a,n.vec3.dot(a,g)),n.vec3.subtract(g,g,h),f=n.vec3.dot(g,l)/(n.vec3.length(g)*n.vec3.length(l)),n.vec3.cross(h,g,l),f=(0<n.vec3.dot(h,a)?1:-1)*k.rad2deg(k.acos(f)));b=k.rad2deg(k.acos(-n.vec3.dot(a,
b)/n.vec3.length(b)));if(!c)return{heading:f,tilt:b};c.heading=f;c.tilt=b;return c}})},"esri/views/3d/support/cameraUtilsSpherical":function(){define("require exports ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./cameraUtilsInternal ./earthUtils ./mathUtils".split(" "),function(q,b,n,f,k,d,h,
m,p,c,a,l){function g(a,d,b,e){void 0===e&&(e=c.createDirectionUp());k.vec3.cross(x,a,t);0===k.vec3.dot(x,x)&&k.vec3.cross(x,a,r);n.mat4.identity(w);n.mat4.rotate(w,w,-l.deg2rad(d),a);n.mat4.rotate(w,w,-l.deg2rad(b),x);d=e.up;b=e.direction;k.vec3.cross(d,x,a);k.vec3.normalize(d,d);k.vec3.transformMat4(d,d,w);k.vec3.normalize(b,a);k.vec3.negate(b,b);k.vec3.transformMat4(b,b,w);return e}function e(a){var c=a[1];a[1]=-a[2];a[2]=c}function u(a,c){c=g(c,a.heading,a.tilt);a.up=c.up;return a}Object.defineProperty(b,
"__esModule",{value:!0});var t=d.vec3f64.fromValues(0,0,1),r=k.vec3.normalize(d.vec3f64.create(),d.vec3f64.fromValues(1,1,1)),y=new l.Cyclical(-180,180),w=f.mat4f64.create(),x=d.vec3f64.create(),v=d.vec3f64.create();b.headingTiltToDirectionUp=g;b.directionToHeadingTilt=function(a,d,b,e){var g=x;k.vec3.normalize(g,a);k.vec3.cross(v,g,t);0===k.vec3.dot(v,v)&&k.vec3.cross(v,g,r);k.vec3.cross(v,v,g);return c.directionToHeadingTilt(d,b,e,g,v)};b.eyeForCenterWithHeadingTilt=function(a,c,b,g){var f={eye:d.vec3f64.create(),
up:null,tilt:g,heading:b},h=x;h[0]=a[0];h[1]=a[2];h[2]=-a[1];b=l.deg2rad(b);var m=l.deg2rad(g);g=Math.sin(b);b=Math.cos(b);var p=Math.sin(m),r=Math.cos(m),t=k.vec3.length(h);if(1E-8>Math.abs(m))m=c+t;else var n=t/p,v=l.asin(c/n),m=n*Math.sin(Math.PI-m-v);var n=p*c,r=r*c,v=b*n,y=m-r,z=y*y,w=c*c*p*p,p=b*b*w,w=g*g*w,A=h[1]*y,B=p*(p+z-h[1]*h[1]);if(0>B)return k.vec3.scale(f.eye,h,m/t),f.tilt=0,f;var q=Math.sqrt(B),B=p+z,A=0<b?-q+A:q+A;if(1E-8>Math.abs(B))return 1E-8>t?(f.eye[0]=0,f.eye[1]=0,f.eye[2]=
c):k.vec3.scale(f.eye,h,m/t),f.tilt=0,e(f.eye),u(f,a);f.eye[1]=A/B;B=f.eye[1]*f.eye[1];c=1-B;A=Math.sqrt(c);v=p*B+w-2*v*f.eye[1]*A*y+c*z;if(1E-8>Math.abs(v))return k.vec3.scale(f.eye,h,m/t),f.tilt=0,e(f.eye),u(f,a);f.eye[0]=(c*(m*h[0]-r*h[0])-n*A*(h[0]*f.eye[1]*b+h[2]*g))/v;f.eye[2]=(c*(m*h[2]-r*h[2])-n*A*(h[2]*f.eye[1]*b-h[0]*g))/v;k.vec3.scale(f.eye,f.eye,m);e(f.eye);return u(f,a)};b.lookAtTiltToEyeTilt=function(a,c,d){a=k.vec3.length(a);c=l.asin(c/(Math.sqrt(c*c+a*a-2*c*a*Math.cos(Math.PI-d))/
Math.sin(d)));return l.rad2deg(d-c)};b.eyeTiltToLookAtTilt=function(a,c,d){d=l.deg2rad(d);a=k.vec3.length(a);return l.asin(c/(a/Math.sin(d)))+d};b.toExtent=function(c,d,b,e,g){function f(a){var c=Math.PI/2;a=l.cyclical2PI.normalize(a,-c);a>c&&(a=Math.PI-a);return a}var k;k=d.latitude;d=d.longitude;var r=a.getLonDeltaForDistance(d,k,b)/2;b=d-r;d+=r;k=l.deg2rad(k);r=a.earthRadius;k=(1+Math.sin(k))/(1-Math.sin(k));var t=(k+1)*Math.tan(e/r/2);k=1.5*Math.PI-2*Math.atan(.5*(t+Math.sqrt(4*k+t*t)));e=k+e/
r;k=f(k);e=f(e);e<k&&(r=e,e=k,k=r);k=Math.max(l.rad2deg(k),-90);e=Math.min(l.rad2deg(e),90);d=y.monotonic(b,d);180<d-b&&(r=(d-b-180)/2,b+=r,d-=r);g?(g.xmin=b,g.ymin=k,g.xmax=d,g.ymax=e,g.spatialReference=m.WGS84):g=new h(b,k,d,e,m.WGS84);c.spatialReference&&c.spatialReference.isWebMercator&&p.geographicToWebMercator(g,!1,g);return g}})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["require","exports","../../core/libs/gl-matrix-2/vec3"],function(q,b,n){function f(b){var d=b*b;
0>b&&(d*=-1);return d}Object.defineProperty(b,"__esModule",{value:!0});b.quadraticAccentuation=f;b.resetTransformation=function(b){b.translation[0]=0;b.translation[1]=0;b.translation[2]=0;b.heading=0;b.tilt=0;return b};b.extractTransformation=function(b,d,h){var m=b.state;b=b.device;d="forward-down"===d.tiltDirection?1:-1;"standard"===b.deviceType?(h.translation[0]=f(m.axes[0]),h.translation[1]=f(m.axes[1]),h.translation[2]=f(m.buttons[7])-f(m.buttons[6]),h.heading=f(m.axes[2]),h.tilt=f(m.axes[3])):
"spacemouse"===b.deviceType&&(h.translation[0]=1.2*f(m.axes[0]),h.translation[1]=1.2*f(m.axes[1]),h.translation[2]=2*-f(m.axes[2]),h.heading=1.2*f(m.axes[5]),h.tilt=1.2*f(m.axes[3]));h.tilt*=d;n.vec3.scale(h.translation,h.translation,1);return h};b.extractTransformationKeyboard=function(b,d){d.translation[0]=b[1]-b[0];d.translation[1]=b[3]-b[2];d.translation[2]=b[4]-b[5];d.heading=b[7]-b[6];d.tilt=b[8]-b[9];return d};b.isZeroTransformation=function(b){return 0===b.translation[0]&&0===b.translation[1]&&
0===b.translation[2]&&0===b.heading&&0===b.tilt}})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});q=function(d){function b(b,f,c){var a,h=d.call(this,!0)||this;h.view=b;h.disableMovements={pan:!0,zoom:!0,ascend:!0,rotate:!1,mode:"local"};h.keyToNumber=(a={},a[f.left]=
0,a[f.right]=1,a[f.forward]=2,a[f.backward]=3,a[f.up]=4,a[f.down]=5,a[f.headingLeft]=6,a[f.headingRight]=7,a[f.tiltUp]=8,a[f.tiltDown]=9,a);h.registerIncoming("key-down",c,function(a){return h.handleKeyDown(a)});h.registerIncoming("key-up",c,function(a){return h.handleKeyUp(a)});return h}n(b,d);b.prototype.handleKeyDown=function(d){if(!d.data.repeat){var b=this.keyToNumber[d.data.key];null!=b&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new f.GamepadKeyboardController(this.view,
void 0,this.disableMovements),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(b),d.stopPropagation()))}};b.prototype.handleKeyUp=function(d){var b=this.keyToNumber[d.data.key];null!=b&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(b),d.stopPropagation())};return b}(k.InputHandler);b.KeyboardNavigation=q})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),
function(q,b,n,f,k,d,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function h(c,a){var d=b.call(this,!0)||this;d.view=c;d.registerIncoming("mouse-wheel",a,function(a){return d.handleMouseWheel(a)});return d}n(h,b);h.prototype.handleMouseWheel=function(c){var a=c.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new k.ZoomStepController(this.view,"interaction"):new d.ZoomStepController(this.view,"interaction"),this.view.state.switchCameraController(this.cameraController));
this.cameraController.zoomStep(-1/60*a.deltaY,f.createScreenPointArray(a.x,a.y));c.stopPropagation()};return h}(h.InputHandler);b.MouseWheelZoom=q})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(q,b,n,f,k,d,h){Object.defineProperty(b,
"__esModule",{value:!0});q=function(d){function b(c,a,b){var g=d.call(this,!0)||this;g.view=c;g.pointerAction=a;g.lastEndTimestamp=0;g.lastTimestamp=0;g.registerIncoming("drag",b,function(a){return g.handleDrag(a)});return g}n(b,d);b.prototype.handleDrag=function(c){if("mouse"!==c.data.pointerType||h.eventMatchesMousePointerAction(c.data,this.pointerAction)){var a=c.timestamp-this.lastEndTimestamp,a=this.momentum&&this.momentum.active&&40>a;switch(c.data.action){case "start":case "update":if(a)break;
this.controller&&this.controller.active?2<c.data.timestamp-this.lastTimestamp&&(this.controller.update(c.data),this.lastTimestamp=c.timestamp):this.startController(c);break;case "end":case "removed":this.endController(c,!0);break;case "added":this.endController(c,!1),this.startController(c)}c.stopPropagation()}};b.prototype.endController=function(c,a){this.controller&&this.controller.active&&(this.lastEndTimestamp=c.timestamp,c=this.controller.end(c.data),a&&c&&(this.momentum=c,this.view.state.switchCameraController(this.momentum)));
this.controller=null};b.prototype.startController=function(c){this.controller=this.createController();this.view.state.switchCameraController(this.controller);this.controller.begin(c.data);this.lastTimestamp=c.timestamp};b.prototype.createController=function(){return this.view.state.isGlobal?new f.PinchAndPanController(this.view,this.view.sceneIntersectionHelper):new k.PinchAndPanController(this.view,this.view.sceneIntersectionHelper)};return b}(d.InputHandler);b.PinchAndPanNavigation=q})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../utils/navigationUtils ../../../support/geometryUtils ../../../support/mathUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C,E){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function l(c,e){var g=b.call(this)||this;g.view=c;g.intersectionHelper=e;g.smoothRotation=new a.ExponentialFalloff(.05);g.rotationAxis=p.vec3f64.create();g.panningPlane=x.plane.create();g.smoothScaling=new a.ExponentialFalloff(.05);g.zoomCenterScreen=f.createScreenPointArray();g.zoomMomentumEstimator=new E.ZoomMomentumEstimator;g.rotationMomentumEstimator=new C.RotationMomentumEstimator;
g.panSphericalMomentumEstimator=new B.PanSphericalMomentumEstimator;g.panPlanarMomentumEstimator=new A.PanPlanarMomentumEstimator;g.adjustedSphere=x.sphere.create();g.tmp3d=p.vec3f64.create();g.tmpMat=d.mat4f64.create();g.tmpAxisAngle=x.axisAngle.create();g.tmpScreenPointArray=f.createScreenPointArray();g.beginScreenPoint=f.createScreenPointArray();g.beginScenePoint=p.vec3f64.create();g.screenPickPoint=f.createScreenPointArray();g.panMode=w.PanMode.Horizontal;g.tmpInteractionDirection=p.vec3f64.create();
g.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new z,interactionDirection:null,tiltMode:0};return g}n(l,b);l.prototype.begin=function(a){if(this.active){this.beginHeading=-v.cyclicalPI.normalize(v.deg2rad(this.view.camera.heading));this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.smoothRotation.reset();f.screenPointObjectToArray(a.center,this.screenPickPoint);h.vec2.copy(this.beginScreenPoint,this.screenPickPoint);
var c=y.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,this.screenPickPoint,!0);this.scenePickPoint=c.scenePickPoint;this.sphere=c.sphere;m.vec3.copy(this.beginScenePoint,this.scenePickPoint);this.panMode=y.decidePanMode(this.beginCamera,this.sphere,this.scenePickPoint);this.panMode===w.PanMode.Vertical&&(this.beginCamera.aboveGround?this.preparePlanarPanModeOverground(a):this.preparePlanarPanMode(a));this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};l.prototype.preparePlanarPanModeOverground=
function(a){var c=m.vec3.negate(this.tmp3d,this.beginCamera.viewForward);x.plane.fromPositionAndNormal(this.scenePickPoint,c,this.panningPlane);var d=f.createScreenPointArray(this.screenPickPoint[0],0),c=p.vec3f64.create(),b=m.vec3.length(this.beginCamera.eye);this.adjustedSphere.radius=b<this.sphere.radius?b-100:this.sphere.radius;y.sphereOrPlanePointFromScreenPoint(this.adjustedSphere,this.beginCamera,d,c);d=f.createRenderScreenPointArray3();this.beginCamera.projectPoint(c,d);this.screenPickPoint[1]=
Math.min(this.screenPickPoint[1],.9*d[1]);this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&x.plane.fromPositionAndNormal(this.scenePickPoint,this.panningPlane,this.panningPlane);a=f.screenPointObjectToArray(a.center,this.tmpScreenPointArray);y.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,a,this.beginScenePoint)};l.prototype.preparePlanarPanMode=function(a){var c=m.vec3.negate(this.tmp3d,this.beginCamera.viewForward);x.plane.fromPositionAndNormal(this.scenePickPoint,
c,this.panningPlane);var d=x.sphere.angleToSilhouette(this.sphere,this.currentCamera.eye),c=x.axisAngle.fromPoints(this.currentCamera.eye,this.scenePickPoint,this.tmpAxisAngle),d=-c[3]-(this.currentCamera.aboveGround?.25:.025)*d;if(0<d){var b=k.mat4.identity(this.tmpMat);k.mat4.rotate(b,b,-d,c);m.vec3.subtract(this.scenePickPoint,this.scenePickPoint,this.sphere.center);m.vec3.transformMat4(this.scenePickPoint,this.scenePickPoint,b);m.vec3.add(this.scenePickPoint,this.scenePickPoint,this.sphere.center);
x.plane.setOffsetFromPoint(this.panningPlane,this.scenePickPoint,this.panningPlane);a=f.screenPointObjectToArray(a.center,this.tmpScreenPointArray);y.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,a,this.beginScenePoint)}};l.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var c=1<a.pointers.size;this.panMode===w.PanMode.Horizontal?(c&&this.zoomSpherical(a),this.panningSpherical(a),c&&this.rotateSpherical(a)):(c&&this.zoomPlanar(a),this.panningPlanar(a),
c&&this.rotatePlanar(a));this.currentCamera.markViewDirty()}};l.prototype.end=function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();if(a=this.zoomMomentumEstimator.evaluateMomentum())return this.panMode===w.PanMode.Horizontal?new r.ZoomSphericalMomentumController(this.view,a,this.zoomCenterScreen,this.beginScenePoint,this.sphere.radius):new t.ZoomPlanarMomentumController(this.view,a,this.beginScenePoint);if(a=this.rotationMomentumEstimator.evaluateMomentum())return new u.RotationMomentumController(this.view,
a,this.sphere.center,this.rotationAxis);if(this.panMode===w.PanMode.Horizontal){if(a=this.panSphericalMomentumEstimator.evaluateMomentum())return new e.PanSphericalMomentumController(this.view,a)}else if(a=this.panPlanarMomentumEstimator.evaluateMomentum())return new g.PanPlanarMomentumController(this.view,a);return null};l.prototype.zoomSpherical=function(a){var d=this.beginRadius/a.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(a.radius,40),120);this.smoothScaling.update(d);y.applyZoomOnSphere(this.sphere,
this.currentCamera,this.smoothScaling.value);f.screenPointObjectToArray(a.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*a.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(a.radius-this.beginRadius);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};l.prototype.panningSpherical=function(a){var d=f.screenPointObjectToArray(a.center,this.tmpScreenPointArray);y.sphereOrPlanePointFromScreenPoint(this.sphere,
this.currentCamera,d,this.tmp3d);y.preserveHeadingThreshold(this.beginScenePoint,m.vec3.dot(this.currentCamera.up,this.beginScenePoint),this.sphere.radius,this.beginHeading,this.view.camera.tilt,this.beginCamera)?(y.applyPanSphericalPreserveHeading(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(d,this.tmp3d,.001*a.timestamp,this.beginCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):
(y.applyPanSphericalDirectRotation(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(d,this.tmp3d,.001*a.timestamp,this.beginCamera,this.sphere.radius,this.view.camera.tilt));this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(this.screenPickPoint,d);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};l.prototype.rotateSpherical=
function(a){m.vec3.normalize(this.rotationAxis,this.scenePickPoint);this.currentCamera.aboveGround||m.vec3.negate(this.rotationAxis,this.rotationAxis);var d=this.smoothRotation.value,b=y.normalizeRotationDelta(a.angle-d),d=d+b;this.smoothRotation.gain=.00125*Math.min(Math.max(a.radius,40),120);this.smoothRotation.update(d);b=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(b,.001*a.timestamp);y.applyRotation(this.currentCamera,this.sphere.center,x.axisAngle.wrapAxisAngle(this.rotationAxis,
b));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(a.radius*d);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};l.prototype.panningPlanar=function(a){var d=f.screenPointObjectToArray(a.center,this.tmpScreenPointArray);y.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,d,this.tmp3d)&&(y.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(d,this.tmp3d,
.001*a.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(this.beginScreenPoint,d),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),c.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};l.prototype.zoomPlanar=function(a){var d=this.beginRadius/a.radius;this.smoothScaling.gain=
.001875*Math.min(Math.max(a.radius,40),120);this.smoothScaling.update(d);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*a.timestamp);y.applyZoomToPoint(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=c.pixelDistanceToInteractionFactor(a.radius-this.beginRadius);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};l.prototype.rotatePlanar=
function(a){m.vec3.copy(this.rotationAxis,this.beginScenePoint);var d=this.smoothRotation.value,b=a.angle-d,b=y.normalizeRotationDelta(b);this.smoothRotation.gain=.00125*Math.min(Math.max(a.radius,40),120);this.smoothRotation.update(d+b);d=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(d,.001*a.timestamp);y.applyRotation(this.currentCamera,this.sphere.center,x.axisAngle.wrapAxisAngle(this.rotationAxis,d));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=
c.pixelDistanceToInteractionFactor(a.radius*d);c.applyAll(this.view,this.currentCamera,this.constraintOptions)};return l}(l.InteractiveController);b.PinchAndPanController=q})},"esri/views/3d/input/util":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this._gain=b}b.prototype.reset=function(b){this._value=b};Object.defineProperty(b.prototype,"gain",{set:function(b){this._gain=b},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"value",{get:function(){return void 0===this._value?0:this._value},enumerable:!0,configurable:!0});b.prototype.update=function(b){this._value=void 0===this._value?b:this._gain*b+(1-this._gain)*this._value};return b}();b.ExponentialFalloff=q})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController".split(" "),
function(q,b,n,f,k,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(d){function b(b,c){b=d.call(this,b,4)||this;b.momentum=c;b.tmpPan=k.vec3f64.create();return b}n(b,d);b.prototype.momentumStep=function(d,c){d=this.momentum.value(d);f.vec3.scale(this.tmpPan,this.momentum.direction,d);f.vec3.subtract(c.eye,c.eye,this.tmpPan);f.vec3.subtract(c.center,c.center,this.tmpPan);c.markViewDirty();this.constraintOptions.interactionDirection=this.tmpPan};return b}(d.MomentumController);b.PanPlanarMomentumController=
q})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),function(q,b,n,f,k,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function h(f,c){c=b.call(this)||this;c.view=f;c.beginCamera=new d;c.elapsedTimeSec=0;c.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new d,
interactionDirection:null,tiltMode:0};return c}n(h,b);Object.defineProperty(h.prototype,"steppingFinished",{get:function(){return this.momentum.isFinished(this.elapsedTimeSec)},enumerable:!0,configurable:!0});h.prototype.onControllerStart=function(d){this.beginCamera.copyFrom(d);this.constraintOptions.interactionStartCamera=this.beginCamera;b.prototype.onControllerStart.call(this,d)};h.prototype.stepController=function(d,c){c.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=d;this.momentumStep(this.elapsedTimeSec,
c);f.applyAll(this.view,c,this.constraintOptions)};return h}(k.AnimationController);b.MomentumController=q})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils".split(" "),function(q,b,n,f,k,d,h){Object.defineProperty(b,"__esModule",{value:!0});var m=k.vec3f64.create(),
p=k.vec3f64.create();q=function(c){function a(a,d){a=c.call(this,a,4)||this;a.momentum=d;return a}n(a,c);a.prototype.momentumStep=function(a,c){var d=this.momentum.value1(a);a=this.momentum.value2(a);f.vec3.copy(p,c.eye);f.vec3.normalize(p,p);f.vec3.cross(this.momentum.axis2,p,this.momentum.axis1);h.applyRotationWithTwoAxes(c,m,this.momentum.axis1,d,this.momentum.axis2,a)};return a}(d.MomentumController);b.PanSphericalMomentumController=q})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(q,b,n,f,k,d,h,m){Object.defineProperty(b,"__esModule",{value:!0});q=function(d){function c(a,c,b,e){a=d.call(this,a,2)||this;a.momentum=c;a.axis=k.vec3f64.create();a.center=k.vec3f64.create();f.vec3.copy(a.axis,e);f.vec3.copy(a.center,b);return a}n(c,d);c.prototype.momentumStep=function(a,c){a=this.momentum.value(a);h.applyRotation(c,this.center,m.axisAngle.wrapAxisAngle(this.axis,a))};return c}(d.MomentumController);b.RotationMomentumController=q})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../support/mathUtils".split(" "),
function(q,b,n,f,k,d,h,m){Object.defineProperty(b,"__esModule",{value:!0});q=function(d){function c(a,c,b){a=d.call(this,a,1)||this;a.momentum=c;a.zoomCenter=k.vec3f64.create();f.vec3.copy(a.zoomCenter,b);a.constraintOptions.interactionDirection=k.vec3f64.create();return a}n(c,d);c.prototype.momentumStep=function(a,c){f.vec3.copy(this.constraintOptions.interactionDirection,c.eye);a=this.momentum.valueDelta(0,a);h.applyZoomToPoint(c,this.zoomCenter,a,this.view.state.constraints.minimumPoiDistance);
this.constraintOptions.interactionDirection=m.directionFromTo(this.constraintOptions.interactionDirection,c.eye,this.constraintOptions.interactionDirection)};return c}(d.MomentumController);b.ZoomPlanarMomentumController=q})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec2 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ./MomentumController ../../utils/navigationUtils ../../../support/geometryUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function g(c,g,l,m,p){c=b.call(this,c,1)||this;c.momentum=g;c.screenCenter=f.createScreenPointArray();c.sceneCenter=h.vec3f64.create();c.tmpSceneCenter=h.vec3f64.create();c.tmpZoomAxisAngle=a.axisAngle.create();c.sphere=a.sphere.create();k.vec2.copy(c.screenCenter,l);d.vec3.copy(c.sceneCenter,m);c.sphere.radius=p;return c}n(g,b);g.prototype.momentumStep=function(d,b){d=this.momentum.valueDelta(0,d);c.applyZoomOnSphere(this.sphere,
b,d);this.constraintOptions.interactionType=1;m.applyAll(this.view,b,this.constraintOptions);c.sphereOrPlanePointFromScreenPoint(this.sphere,b,this.screenCenter,this.tmpSceneCenter);a.axisAngle.fromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle);c.applyRotation(b,this.sphere.center,this.tmpZoomAxisAngle);this.constraintOptions.interactionType=4};return g}(p.MomentumController);b.ZoomSphericalMomentumController=q})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),
function(q,b,n,f,k,d,h){Object.defineProperty(b,"__esModule",{value:!0});var m=function(d){function c(a,c,b,e,f){a=d.call(this,a,c,b)||this;a.sceneVelocity=e;a.direction=f;return a}n(c,d);c.prototype.value=function(a){return d.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,a)};return c}(h.Momentum);b.PanPlanarMomentum=m;q=function(){function b(c,a,b){void 0===c&&(c=300);void 0===a&&(a=12);void 0===b&&(b=.84);this.minimumInitialVelocity=c;this.stopVelocity=a;this.friction=b;this.time=
new d.FilteredFiniteDifference(.6);this.screen=[new d.FilteredFiniteDifference(.4),new d.FilteredFiniteDifference(.4)];this.scene=[new d.FilteredFiniteDifference(.6),new d.FilteredFiniteDifference(.6),new d.FilteredFiniteDifference(.6)];this.tmpDirection=k.vec3f64.create()}b.prototype.add=function(c,a,d){this.time.hasLastValue&&.015>this.time.computeDelta(d)||(this.screen[0].update(c[0]),this.screen[1].update(c[1]),this.scene[0].update(a[0]),this.scene[1].update(a[1]),this.scene[2].update(a[2]),this.time.update(d))};
b.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};b.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var c=this.screen[0].filteredDelta,a=this.screen[1].filteredDelta,c=Math.sqrt(c*c+a*a)/this.time.filteredDelta;return Math.abs(c)<this.minimumInitialVelocity?null:this.createMomentum(c,this.stopVelocity,this.friction)};b.prototype.createMomentum=function(c,
a,d){f.vec3.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);var b=f.vec3.length(this.tmpDirection);0<b&&f.vec3.scale(this.tmpDirection,this.tmpDirection,1/b);return new m(c,a,d,b/this.time.filteredDelta,this.tmpDirection)};return b}();b.PanPlanarMomentumEstimator=q})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this.gain=
b}b.prototype.update=function(b){if(this.hasLastValue){var f=this.computeDelta(b);this.updateDelta(f)}this.lastValue=b};b.prototype.reset=function(){this.filteredDelta=this.lastValue=void 0};Object.defineProperty(b.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!0,configurable:!0});b.prototype.computeDelta=function(b){return b-
this.lastValue};b.prototype.updateDelta=function(b){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*b:b};return b}();b.FilteredFiniteDifference=q})},"esri/views/navigation/Momentum":function(){define(["require","exports","../../core/tsSupport/extendsHelper"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,d,f){this._initialVelocity=b;this._stopVelocity=d;this._friction=f;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/
this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(b.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0});b.prototype.isFinished=function(b){return b>this.duration};Object.defineProperty(b.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});b.prototype.value=function(b){return this.valueFromInitialVelocity(this._initialVelocity,b)};b.prototype.valueDelta=function(b,d){var f=this.value(b);return this.value(b+
d)-f};b.prototype.valueFromInitialVelocity=function(b,d){d=Math.min(d,this.duration);var f=1-this.friction;return b*(Math.pow(f,d)-1)/Math.log(f)};return b}();b.Momentum=q})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/libs/gl-matrix-2/vec2f64 ../../core/libs/gl-matrix-2/vec3 ../../core/libs/gl-matrix-2/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),
function(q,b,n,f,k,d,h,m,p,c){Object.defineProperty(b,"__esModule",{value:!0});var a=function(a){function c(c,d,b,g,f,h,l){void 0===h&&(h=0);c=a.call(this,c,d,b)||this;c.angularVelocity1=g;c.axis1=f;c.angularVelocity2=h;c.axis2=l;return c}n(c,a);c.prototype.value1=function(c){return a.prototype.valueFromInitialVelocity.call(this,this.angularVelocity1,c)};c.prototype.value2=function(c){return a.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,c)};return c}(c.Momentum);b.PanSphericalMomentum=
a;q=function(){function c(a,c,b){void 0===a&&(a=300);void 0===c&&(c=12);void 0===b&&(b=.84);this.minimumInitialVelocity=a;this.stopVelocity=c;this.friction=b;this.tmpAxis1=d.vec3f64.create();this.tmpAxis2=d.vec3f64.create();this.tmpAngles=f.vec2f64.create();this.time=new m.FilteredFiniteDifference(.3);this.screen=[new m.FilteredFiniteDifference(.4),new m.FilteredFiniteDifference(.4)];this.angle1=new p.FilteredValue(.6);this.angle2=new p.FilteredValue(.6);this.axis1=d.vec3f64.create();this.axis2=d.vec3f64.create();
this.lastScene=d.vec3f64.create()}c.prototype.addMomentumDirectRotation=function(a,c,d,b,f,l){if(this.time.hasLastValue){if(.01>this.time.computeDelta(d))return;b=h.rotationAngleAndAxisDirectRotation(this.lastScene,c,this.tmpAxis2,b,f,l);this.angle2.update(0);1E-5>k.vec3.squaredLength(this.tmpAxis2)?b=0:k.vec3.normalize(this.axis1,this.tmpAxis2);this.angle1.update(b);k.vec3.copy(this.lastScene,c)}this.screen[0].update(a[0]);this.screen[1].update(a[1]);this.time.update(d)};c.prototype.addMomentumPreserveHeading=
function(a,c,d,b,f,l,m){if(this.time.hasLastValue){if(.01>this.time.computeDelta(d))return;h.rotationAnglesAndAxesHeadingPreserving(this.lastScene,c,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,b,f,l,m,!1);1E-5>k.vec3.squaredLength(this.tmpAxis2)?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),k.vec3.normalize(this.axis1,this.tmpAxis1),k.vec3.normalize(this.axis2,this.tmpAxis2));k.vec3.copy(this.lastScene,c)}this.screen[0].update(a[0]);
this.screen[1].update(a[1]);this.time.update(d)};c.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle1.reset();this.angle2.reset();this.time.reset()};c.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,c=this.screen[1].filteredDelta,a=Math.sqrt(a*a+c*c)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};c.prototype.createMomentum=
function(c,d,b){return new a(c,d,b,this.angle1.filteredValue/this.time.filteredDelta,this.axis1,this.angle2.filteredValue/this.time.filteredDelta,this.axis2)};return c}();b.PanSphericalMomentumEstimator=q})},"esri/views/navigation/FilteredValue":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this.gain=b}b.prototype.update=function(b){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*
b:b};b.prototype.reset=function(){this.filteredValue=void 0};Object.defineProperty(b.prototype,"hasFilteredValue",{get:function(){return void 0!==this.filteredValue},enumerable:!0,configurable:!0});return b}();b.FilteredValue=q})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./MomentumEstimator"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function d(d,f,p,c){void 0===d&&(d=3);void 0===
f&&(f=.01);void 0===p&&(p=.95);void 0===c&&(c=12);return b.call(this,d,f,p,c)||this}n(d,b);d.prototype.add=function(d,f){if(this.value.hasLastValue){var h=this.value.lastValue;for(d-=h;d>Math.PI;)d-=2*Math.PI;for(;d<-Math.PI;)d+=2*Math.PI;d=h+d}b.prototype.add.call(this,d,f)};return d}(f.MomentumEstimator);b.RotationMomentumEstimator=q})},"esri/views/navigation/MomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/support/mathUtils ./FilteredFiniteDifference ./Momentum".split(" "),
function(q,b,n,f,k,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(d,b,c,a){void 0===d&&(d=2.5);void 0===b&&(b=.01);void 0===c&&(c=.95);void 0===a&&(a=12);this.minimumInitialVelocity=d;this.stopVelocity=b;this.friction=c;this.maxVelocity=a;this.value=new k.FilteredFiniteDifference(.8);this.time=new k.FilteredFiniteDifference(.3)}b.prototype.add=function(d,b){if(this.time.hasLastValue){if(.01>this.time.computeDelta(b))return;if(this.value.hasFilteredDelta){var c=this.value.computeDelta(d);
0>this.value.filteredDelta*c&&this.value.reset()}}this.time.update(b);this.value.update(d)};b.prototype.reset=function(){this.value.reset();this.time.reset()};b.prototype.evaluateMomentum=function(){if(!this.value.hasFilteredDelta)return null;var d=this.value.filteredDelta/this.time.filteredDelta,d=f.clamp(d,-this.maxVelocity,this.maxVelocity);return Math.abs(d)<this.minimumInitialVelocity?null:this.createMomentum(d,this.stopVelocity,this.friction)};b.prototype.createMomentum=function(b,f,c){return new d.Momentum(b,
f,c)};return b}();b.MomentumEstimator=q})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./Momentum","./MomentumEstimator"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});var d=function(d){function b(b,c,a){return d.call(this,b,c,a)||this}n(b,d);b.prototype.value=function(b){b=d.prototype.value.call(this,b);return Math.exp(b)};b.prototype.valueDelta=function(b,c){var a=d.prototype.value.call(this,b);
b=d.prototype.value.call(this,b+c);return Math.exp(b-a)};return b}(f.Momentum);b.ZoomMomentum=d;q=function(b){function f(d,c,a,f){void 0===d&&(d=2.5);void 0===c&&(c=.01);void 0===a&&(a=.95);void 0===f&&(f=12);return b.call(this,d,c,a,f)||this}n(f,b);f.prototype.add=function(d,c){b.prototype.add.call(this,Math.log(d),c)};f.prototype.createMomentum=function(b,c,a){return new d(b,c,a)};return f}(k.MomentumEstimator);b.ZoomMomentumEstimator=q})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/screenUtils ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../camera/constraintUtils ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../support/geometryUtils ../../../support/mathUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w){Object.defineProperty(b,"__esModule",{value:!0});var x;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(x=b.PanMode||(b.PanMode={}));var v=d.vec3f64.fromValues(0,0,1),z=16/180*Math.PI;q=function(b){function p(a,c){var g=b.call(this)||this;g.view=a;g.intersectionHelper=c;g.rotationValueSmooth=new m.ExponentialFalloff(.05);g.scalingValueSmooth=new m.ExponentialFalloff(.05);g.planeHorizontal=e.plane.create();g.planeVertical=e.plane.create();
g.rotationMomentumEstimator=new y.RotationMomentumEstimator;g.panMomentumEstimator=new r.PanPlanarMomentumEstimator(300,12,.9);g.zoomMomentumEstimator=new w.ZoomMomentumEstimator;g.beginCenter=d.vec3f64.create();g.tmpPoints=[];g.beginCenterScreen=f.createScreenPointArray();g.tmpCentroid3d=d.vec3f64.create();g.tmpCentroid2d=f.createScreenPointArray();g.tmp2d=f.createScreenPointArray();g.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new t,interactionDirection:null,
tiltMode:0};return g}n(p,b);p.prototype.begin=function(a){if(this.active){this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();f.screenPointObjectToArray(a.center,this.beginCenterScreen);e.plane.fromNormalAndOffset(v,0,this.planeHorizontal);var c=d.vec3f64.create();this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,c);var b=d.vec3f64.create();k.vec3.negate(b,this.beginCamera.viewForward);
var h=d.vec3f64.create();k.vec3.copy(h,v);var l=k.vec3.dot(b,h);this.panMode=u.asin(0>l?-l:l)>=z?x.Horizontal:x.Vertical;e.plane.setOffsetFromPoint(this.planeHorizontal,c,this.planeHorizontal);0>e.plane.signedDistance(this.planeHorizontal,this.beginCamera.eye)&&e.plane.negate(this.planeHorizontal,this.planeHorizontal);this.panMode===x.Vertical?(k.vec3.scale(h,h,l),k.vec3.subtract(this.planeVertical,b,h),k.vec3.normalize(this.planeVertical,this.planeVertical),e.plane.setOffsetFromPoint(this.planeVertical,
c,this.planeVertical),this.computePlanePoints(a.pointers,this.planeVertical,this.beginCamera,this.tmpPoints)):this.computePlanePoints(a.pointers,this.planeHorizontal,this.beginCamera,this.tmpPoints);g.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};p.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var c=1<a.pointers.size,d=this.panMode===x.Horizontal?this.planeHorizontal:this.planeVertical,
b=this.beginCenter;if(c){var l=this.beginRadius/a.radius,m=.001875*Math.min(Math.max(a.radius,40),120);this.scalingValueSmooth.gain=m;this.scalingValueSmooth.update(l);g.applyZoomToPoint(this.currentCamera,b,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*a.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=h.pixelDistanceToInteractionFactor(Math.abs(a.radius-this.beginRadius));
h.applyAll(this.view,this.currentCamera,this.constraintOptions)}this.computePlanePoints(a.pointers,d,this.currentCamera,this.tmpPoints);g.centroid(this.tmpPoints,this.tmpCentroid3d);f.screenPointObjectToArray(a.center,this.tmpCentroid2d);g.applyPanPlanar(this.currentCamera,b,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*a.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=h.pixelDistanceToInteractionFactor(this.beginCenterScreen,
this.tmpCentroid2d);h.applyAll(this.view,this.currentCamera,this.constraintOptions);c&&(c=this.planeHorizontal,d=this.rotationValueSmooth.value,l=g.normalizeRotationDelta(a.angle-d),m=.00125*Math.min(Math.max(a.radius,40),120),this.rotationValueSmooth.gain=m,this.rotationValueSmooth.update(d+l),m=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(m,.001*a.timestamp),g.applyRotation(this.currentCamera,b,e.axisAngle.wrapAxisAngle(c,m)),this.constraintOptions.interactionType=
2,this.constraintOptions.interactionFactor=h.pixelDistanceToInteractionFactor(Math.abs(a.radius*m)),h.applyAll(this.view,this.currentCamera,this.constraintOptions));this.currentCamera.markViewDirty()}};p.prototype.end=function(d){d.pointers.size===this.pointerCount&&this.update(d);this.finishController();return(d=this.zoomMomentumEstimator.evaluateMomentum())?new l.ZoomPlanarMomentumController(this.view,d,this.beginCenter):(d=this.rotationMomentumEstimator.evaluateMomentum())?new a.RotationMomentumController(this.view,
d,this.beginCenter,this.planeHorizontal):(d=this.panMomentumEstimator.evaluateMomentum())?new c.PanPlanarMomentumController(this.view,d):null};p.prototype.computePlanePoints=function(a,c,b,e){e.length=a.size;var f=this.tmp2d,h=0;a.forEach(function(a){f[0]=a.x;f[1]=a.y;void 0===e[h]&&(e[h]=d.vec3f64.create());g.intersectPlaneFromScreenPoint(c,b,f,e[h]);h+=1});return e};return p}(p.InteractiveController);b.PinchAndPanController=q})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["require",
"exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function d(d,f){var h=b.call(this,!0)||this;h.view=d;h.registerIncoming("pointer-down",f,function(c){return h.view.state.stopActiveCameraController()});return h}n(d,b);return d}(f.InputHandler);b.PointerDownCancelAnimation=q})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper",
"./SingleKey"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function d(d,f,p){p=b.call(this,"esri.views.3d.input.handlers.SingleKeyResetHeading",f,p)||this;p.view=d;p.key=f;return p}n(d,b);d.prototype.activate=function(){this.view.goTo({heading:0})};return d}(f.SingleKey);b.SingleKeyResetHeading=q})},"esri/views/3d/input/handlers/SingleKey":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(q,
b,n,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function d(d,f,p){var c=b.call(this,!0)||this;c.key=f;c.registerIncoming("key-down",p,function(a){return c._handleKeyDown(a)});return c}n(d,b);d.prototype._handleKeyDown=function(d){d.data.key===this.key&&(this.activate(),d.stopPropagation())};return d}(f.InputHandler);b.SingleKey=q})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./SingleKey"],
function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function d(d,f,p){p=b.call(this,"esri.views.3d.input.handlers.SingleKeyResetTilt",f,p)||this;p.view=d;p.key=f;return p}n(d,b);d.prototype.activate=function(){this.view.goTo({tilt:0})};return d}(f.SingleKey);b.SingleKeyResetTilt=q})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler".split(" "),
function(q,b,n,f,k,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(d){function b(b,c){void 0===c&&(c=!1);var a=d.call(this,!0)||this;a.view=b;a.invert=c;a.registerIncoming("vertical-two-finger-drag",function(c){return a.handleTwoFinger(c)});return a}n(b,d);b.prototype.handleTwoFinger=function(d){var c=f.createScreenPointArray(0,d.data.delta*(this.invert?-1:1));switch(d.data.action){case "begin":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=
new k.RotateController(this.view,this.view.sceneIntersectionHelper,"center");this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(c);break;case "update":this.cameraController&&this.cameraController.update(c);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}};return b}(d.InputHandler);b.TwoFingerTilt=q})},"esri/views/input/BrowserEventSource":function(){define("require exports ../../core/has ../../core/screenUtils ../../core/libs/pep/pep ./keys ./gamepad/GamepadSource".split(" "),
function(q,b,n,f,k,d,h){Object.defineProperty(b,"__esModule",{value:!0});var m=n("trident"),p=n("edge"),c=n("chrome"),a=n("ff"),l=n("safari");q=function(){function b(a,c){var d=this;this.input=c;this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._element=a;k.applyLocal(a);a.getAttribute("tabindex")||a.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,
"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._initialCssTouchAction=a.style.touchAction;a.style.touchAction="none";this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new h.GamepadSource(a,this.input);this._gamepadSource.onEvent=function(a){return d._callback("gamepad",
a)}}b.prototype.destroy=function(){var a=this;this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(function(c){a._releasePointerCaptureSafe(c)});this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null);this._activePointerCaptures=null;this._element.style.touchAction=this._initialCssTouchAction;this._element.removeEventListener("keydown",this._preventAltKeyDefault)};Object.defineProperty(b.prototype,"onEventReceived",{set:function(a){this._callback=a},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"activeEvents",{set:function(a){var c=this,d;for(d in this._active)a&&a.has(d)||(this._element.removeEventListener(g[d],this._active[d]),delete this._active[d]);a&&a.forEach(function(a){if(!c._active[a]&&g[a]){var d=(c._eventHandlers[a]||c._handleDefault).bind(c,a);c._element.addEventListener(g[a],d);c._active[a]=d}});this._gamepadSource.pollingEnabled=a&&a.has("gamepad")},enumerable:!0,configurable:!0});b.prototype.setPointerCapture=function(a,
c){c?(this._element.setPointerCapture(a.pointerId),this._activePointerCaptures.add(a.pointerId)):(this._releasePointerCaptureSafe(a.pointerId),this._activePointerCaptures.delete(a.pointerId))};b.prototype._releasePointerCaptureSafe=function(a){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(a)||this._element.releasePointerCapture(a)}catch(t){}};b.prototype._updateNormalizedPointerLikeEvent=function(a,c){a=f.createScreenPointFromNativeEvent(this._element,a);b.test.disableSubpixelCoordinates&&
(a.x=Math.round(a.x),a.y=Math.round(a.y));c.x=a.x;c.y=a.y;return c};b.prototype._handleKey=function(a,c){var b=d.eventKey(c);b&&"key-up"===a&&this._keyDownState.delete(b);c={native:c,key:b,repeat:b&&this._keyDownState.has(b)};b&&"key-down"===a&&this._keyDownState.add(c.key);this._callback(a,c)};b.prototype._handlePointer=function(a,c){c=this._updateNormalizedPointerLikeEvent(c,{native:c,x:0,y:0,pointerType:c.pointerType,button:c.button,buttons:c.buttons,eventId:this._eventId++});this._callback(a,
c)};b.prototype._handlePointerPreventDefault=function(a,c){var d=this._updateNormalizedPointerLikeEvent(c,{native:c,x:0,y:0,pointerType:c.pointerType,button:c.button,buttons:c.buttons,eventId:this._eventId++});c.preventDefault();this._callback(a,d)};b.prototype._handleMouseWheel=function(d,b){b.preventDefault();var e=b.deltaY;switch(b.deltaMode){case 0:if(m||p)e=e/document.documentElement.clientHeight*600;break;case 1:e*=30;break;case 2:e*=900}m||p?e*=.7:c||l?e*=.6:a&&(e*=1.375);var g=Math.abs(e);
100<g&&(e=e/g*200/(1+Math.exp(-.02*(g-100))));b=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0,deltaY:e});this._callback(d,b)};b.prototype._handlePointerCaptureLost=function(a,c){this._activePointerCaptures.delete(c.pointerId);this._handleDefault(a,c)};b.prototype._handleDefault=function(a,c){var d={native:c};c.preventDefault();this._callback(a,d)};b.prototype._preventAltKeyDefault=function(a){"Alt"===a.key&&a.preventDefault()};b.test={disableSubpixelCoordinates:!1};return b}();b.BrowserEventSource=
q;var g={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"}})},"esri/core/libs/pep/pep":function(){define(function(){function q(d,b){b=b||Object.create(null);var e=document.createEvent("Event");
e.initEvent(d,b.bubbles||!1,b.cancelable||!1);d=2;for(var g;d<c.length;d++)g=c[d],e[g]=b[g]||a[d];e.buttons=b.buttons||0;d=0;d=b.pressure&&e.buttons?b.pressure:e.buttons?.5:0;e.x=e.clientX;e.y=e.clientY;e.pointerId=b.pointerId||0;e.width=b.width||0;e.height=b.height||0;e.pressure=d;e.tiltX=b.tiltX||0;e.tiltY=b.tiltY||0;e.twist=b.twist||0;e.tangentialPressure=b.tangentialPressure||0;e.pointerType=b.pointerType||"";e.hwTimestamp=b.hwTimestamp||0;e.isPrimary=b.isPrimary||!1;return e}function b(){this.array=
[];this.size=0}function n(a,c,d,b){this.addCallback=a.bind(b);this.removeCallback=c.bind(b);this.changedCallback=d.bind(b);A&&(this.observer=new A(this.mutationWatcher.bind(this)))}function f(a){return"body /shadow-deep/ "+k(a)}function k(a){return'[touch-action\x3d"'+a+'"]'}function d(a){return"{ -ms-touch-action: "+a+"; touch-action: "+a+"; }"}function h(){if(F){C.forEach(function(a){String(a)===a?(E+=k(a)+d(a)+"\n",H&&(E+=f(a)+d(a)+"\n")):(E+=a.selectors.map(k)+d(a.rule)+"\n",H&&(E+=a.selectors.map(f)+
d(a.rule)+"\n"))});var a=document.createElement("style");a.textContent=E;document.head.appendChild(a)}}function m(a){if(!r.pointermap.has(a))throw a=Error("NotFoundError"),a.name="NotFoundError",a;}function p(a){for(var c=a.parentNode;c&&c!==a.ownerDocument;)c=c.parentNode;if(!c)throw a=Error("InvalidStateError"),a.name="InvalidStateError",a;}var c="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget pageX pageY".split(" "),a=[!1,!1,
null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],l=window.Map&&window.Map.prototype.forEach?Map:b;b.prototype={set:function(a,c){if(void 0===c)return this.delete(a);this.has(a)||this.size++;this.array[a]=c},has:function(a){return void 0!==this.array[a]},delete:function(a){this.has(a)&&(delete this.array[a],this.size--)},get:function(a){return this.array[a]},clear:function(){this.size=this.array.length=0},forEach:function(a,c){return this.array.forEach(function(d,b){a.call(c,d,b,this)},this)}};var g="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget buttons pointerId width height pressure tiltX tiltY pointerType hwTimestamp isPrimary type target currentTarget which pageX pageY timeStamp".split(" "),
e=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],u={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},t="undefined"!==typeof SVGElementInstance,r={pointermap:new l,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(a,c){var d=c.events;d&&(d.forEach(function(a){c[a]&&(this.eventMap[a]=c[a].bind(c))},this),this.eventSources[a]=c,this.eventSourceList.push(c))},register:function(a){for(var c=
this.eventSourceList.length,d=0,b;d<c&&(b=this.eventSourceList[d]);d++)b.register.call(b,a)},unregister:function(a){for(var c=this.eventSourceList.length,d=0,b;d<c&&(b=this.eventSourceList[d]);d++)b.unregister.call(b,a)},contains:function(a,c){try{return a.contains(c)}catch(ba){return!1}},down:function(a){a.bubbles=!0;this.fireEvent("pointerdown",a)},move:function(a){a.bubbles=!0;this.fireEvent("pointermove",a)},up:function(a){a.bubbles=!0;this.fireEvent("pointerup",a)},enter:function(a){a.bubbles=
!1;this.fireEvent("pointerenter",a)},leave:function(a){a.bubbles=!1;this.fireEvent("pointerleave",a)},over:function(a){a.bubbles=!0;this.fireEvent("pointerover",a)},out:function(a){a.bubbles=!0;this.fireEvent("pointerout",a)},cancel:function(a){a.bubbles=!0;this.fireEvent("pointercancel",a)},leaveOut:function(a){this.out(a);this.propagate(a,this.leave,!1)},enterOver:function(a){this.over(a);this.propagate(a,this.enter,!0)},eventHandler:function(a){if(!a._handledByPE){var c=a.type;(c=this.eventMap&&
this.eventMap[c])&&c(a);a._handledByPE=!0}},listen:function(a,c){c.forEach(function(c){this.addEvent(a,c)},this)},unlisten:function(a,c){c.forEach(function(c){this.removeEvent(a,c)},this)},addEvent:function(a,c){a.addEventListener(c,this.boundHandler)},removeEvent:function(a,c){a.removeEventListener(c,this.boundHandler)},makeEvent:function(a,c){this.captureInfo[c.pointerId]&&(c.relatedTarget=null);a=new q(a,c);c.preventDefault&&(a.preventDefault=c.preventDefault);a._target=a._target||c.target;return a},
fireEvent:function(a,c){a=this.makeEvent(a,c);return this.dispatchEvent(a)},cloneEvent:function(a){for(var c=Object.create(null),d,b=0;b<g.length;b++)d=g[b],c[d]=a[d]||e[b],t&&("target"===d||"relatedTarget"===d)&&c[d]instanceof SVGElementInstance&&(c[d]=c[d].correspondingUseElement);a.preventDefault&&(c.preventDefault=function(){a.preventDefault()});return c},getTarget:function(a){var c=this.captureInfo[a.pointerId];if(!c)return a._target;if(a._target===c||!(a.type in u))return c},propagate:function(a,
c,d){for(var b=a.target,e=[];null!=b&&b!==document&&!b.contains(a.relatedTarget);)if(e.push(b),b=b.parentNode,!b)return;d&&e.reverse();e.forEach(function(d){a.target=d;c.call(this,a)},this)},setCapture:function(a,c,d){this.captureInfo[a]&&this.releaseCapture(a,d);this.captureInfo[a]=c;this.implicitRelease=this.releaseCapture.bind(this,a,d);document.addEventListener("pointerup",this.implicitRelease);document.addEventListener("pointercancel",this.implicitRelease);var b=new q("gotpointercapture");b.pointerId=
a;b._target=c;d||this.asyncDispatchEvent(b)},releaseCapture:function(a,c){var d=this.captureInfo[a];if(d){this.captureInfo[a]=void 0;document.removeEventListener("pointerup",this.implicitRelease);document.removeEventListener("pointercancel",this.implicitRelease);var b=new q("lostpointercapture");b.pointerId=a;b._target=d;c||this.asyncDispatchEvent(b)}},dispatchEvent:function(a){var c=this.getTarget(a);if(c)return c.dispatchEvent(a)},asyncDispatchEvent:function(a){requestAnimationFrame(this.dispatchEvent.bind(this,
a))}};r.boundHandler=r.eventHandler.bind(r);var y={shadow:function(a){if(a)return a.shadowRoot||a.webkitShadowRoot},canTarget:function(a){return a&&!!a.elementFromPoint},targetingShadow:function(a){a=this.shadow(a);if(this.canTarget(a))return a},olderShadow:function(a){var c=a.olderShadowRoot;!c&&(a=a.querySelector("shadow"))&&(c=a.olderShadowRoot);return c},allShadows:function(a){var c=[];for(a=this.shadow(a);a;)c.push(a),a=this.olderShadow(a);return c},searchRoot:function(a,c,d){if(a){var b=a.elementFromPoint(c,
d),e;for(e=this.targetingShadow(b);e;){if(a=e.elementFromPoint(c,d))return b=this.targetingShadow(a),this.searchRoot(b,c,d)||a;e=this.olderShadow(e)}return b}},owner:function(a){for(;a.parentNode;)a=a.parentNode;a.nodeType!==Node.DOCUMENT_NODE&&a.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(a=document);return a},findTarget:function(a){var c=a.clientX,d=a.clientY;a=this.owner(a.target);a.elementFromPoint(c,d)||(a=document);return this.searchRoot(a,c,d)}},w=Array.prototype.forEach.call.bind(Array.prototype.forEach),
x=Array.prototype.map.call.bind(Array.prototype.map),v=Array.prototype.slice.call.bind(Array.prototype.slice),z=Array.prototype.filter.call.bind(Array.prototype.filter),A=window.MutationObserver||window.WebKitMutationObserver,B={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};n.prototype={watchSubtree:function(a){this.observer&&y.canTarget(a)&&this.observer.observe(a,B)},enableOnSubtree:function(a){this.watchSubtree(a);a===document&&"complete"!==document.readyState?
this.installOnLoad():this.installNewSubtree(a)},installNewSubtree:function(a){w(this.findElements(a),this.addElement,this)},findElements:function(a){return a.querySelectorAll?a.querySelectorAll("[touch-action]"):[]},removeElement:function(a){this.removeCallback(a)},addElement:function(a){this.addCallback(a)},elementChanged:function(a,c){this.changedCallback(a,c)},concatLists:function(a,c){return a.concat(v(c))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===
document.readyState&&this.installNewSubtree(document)}.bind(this))},isElement:function(a){return a.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(a){var c=x(a,this.findElements,this);c.push(z(a,this.isElement));return c.reduce(this.concatLists,[])},mutationWatcher:function(a){a.forEach(this.mutationHandler,this)},mutationHandler:function(a){"childList"===a.type?(this.flattenMutationTree(a.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(a.removedNodes).forEach(this.removeElement,
this)):"attributes"===a.type&&this.elementChanged(a.target,a.oldValue)}};var C=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],E="",F=window.PointerEvent||window.MSPointerEvent,H=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,D=r.pointermap,G=[1,4,2,8,16],K=!1;try{K=1===(new MouseEvent("test",{buttons:1})).buttons}catch(ca){}var M={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(a){r.listen(a,
this.events)},unregister:function(a){r.unlisten(a,this.events)},lastTouches:[],isEventSimulatedFromTouch:function(a){var c=this.lastTouches,d=a.clientX;a=a.clientY;for(var b=0,e=c.length,g;b<e&&(g=c[b]);b++){var f=Math.abs(a-g.y);if(25>=Math.abs(d-g.x)&&25>=f)return!0}},prepareEvent:function(a){var c=r.cloneEvent(a),d=c.preventDefault;c.preventDefault=function(){a.preventDefault();d()};c.pointerId=this.POINTER_ID;c.isPrimary=!0;c.pointerType=this.POINTER_TYPE;return c},prepareButtonsForMove:function(a,
c){var d=D.get(this.POINTER_ID);a.buttons=0!==c.which&&d?d.buttons:0;c.buttons=a.buttons},mousedown:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=D.get(this.POINTER_ID),d=this.prepareEvent(a);K||(d.buttons=G[d.button],c&&(d.buttons|=c.buttons),a.buttons=d.buttons);D.set(this.POINTER_ID,a);c&&0!==c.buttons?r.move(d):r.down(d)}},mousemove:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=this.prepareEvent(a);K||this.prepareButtonsForMove(c,a);c.button=-1;D.set(this.POINTER_ID,a);r.move(c)}},
mouseup:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=D.get(this.POINTER_ID),d=this.prepareEvent(a);if(!K){var b=G[d.button];d.buttons=c?c.buttons&~b:0;a.buttons=d.buttons}D.set(this.POINTER_ID,a);d.buttons&=~G[d.button];0===d.buttons?r.up(d):r.move(d)}},mouseover:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=this.prepareEvent(a);K||this.prepareButtonsForMove(c,a);c.button=-1;D.set(this.POINTER_ID,a);r.enterOver(c)}},mouseout:function(a){if(!this.isEventSimulatedFromTouch(a)){var c=
this.prepareEvent(a);K||this.prepareButtonsForMove(c,a);c.button=-1;r.leaveOut(c)}},cancel:function(a){a=this.prepareEvent(a);r.cancel(a);this.deactivateMouse()},deactivateMouse:function(){D.delete(this.POINTER_ID)}},O=r.captureInfo,N=y.findTarget.bind(y),P=y.allShadows.bind(y),L=r.pointermap,T,R={events:["touchstart","touchmove","touchend","touchcancel"],register:function(a){T.enableOnSubtree(a)},unregister:function(){},elementAdded:function(a){var c=a.getAttribute("touch-action"),d=this.touchActionToScrollType(c);
d&&(a._scrollType=d,r.listen(a,this.events),P(a).forEach(function(a){a._scrollType=d;r.listen(a,this.events)},this))},elementRemoved:function(a){a._scrollType=void 0;r.unlisten(a,this.events);P(a).forEach(function(a){a._scrollType=void 0;r.unlisten(a,this.events)},this)},elementChanged:function(a,c){var d=a.getAttribute("touch-action"),b=this.touchActionToScrollType(d);c=this.touchActionToScrollType(c);b&&c?(a._scrollType=b,P(a).forEach(function(a){a._scrollType=b},this)):c?this.elementRemoved(a):
b&&this.elementAdded(a)},scrollTypes:{EMITTER:"none",XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(a){var c=this.scrollTypes;if("none"===a)return"none";if(a===c.XSCROLLER)return"X";if(a===c.YSCROLLER)return"Y";if(c.SCROLLER.exec(a))return"XY"},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(0===L.size||1===L.size&&L.has(1))this.firstTouch=
a.identifier,this.firstXY={X:a.clientX,Y:a.clientY},this.scrolling=!1,this.cancelResetClickCount()},removePrimaryPointer:function(a){a.isPrimary&&(this.firstXY=this.firstTouch=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var a=function(){this.clickCount=0;this.resetId=null}.bind(this);this.resetId=setTimeout(a,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(a){var c=0;if("touchstart"===a||"touchmove"===a)c=
1;return c},touchToPointer:function(a){var c=this.currentTouchEvent,d=r.cloneEvent(a),b=d.pointerId=a.identifier+2;d.target=O[b]||N(d);d.bubbles=!0;d.cancelable=!0;d.detail=this.clickCount;d.button=0;d.buttons=this.typeToButtons(c.type);d.width=2*(a.radiusX||a.webkitRadiusX||0);d.height=2*(a.radiusY||a.webkitRadiusY||0);d.pressure=a.force||a.webkitForce||.5;d.isPrimary=this.isPrimaryTouch(a);d.pointerType=this.POINTER_TYPE;d.altKey=c.altKey;d.ctrlKey=c.ctrlKey;d.metaKey=c.metaKey;d.shiftKey=c.shiftKey;
var e=this;d.preventDefault=function(){e.scrolling=!1;e.firstXY=null;c.preventDefault()};return d},processTouches:function(a,c){var d=a.changedTouches;this.currentTouchEvent=a;a=0;for(var b;a<d.length;a++)b=d[a],c.call(this,this.touchToPointer(b))},shouldScroll:function(a){if(this.firstXY){var c;c=a.currentTarget._scrollType;if("none"===c)c=!1;else if("XY"===c)c=!0;else{a=a.changedTouches[0];var d="Y"===c?"X":"Y";c=Math.abs(a["client"+c]-this.firstXY[c])>=Math.abs(a["client"+d]-this.firstXY[d])}this.firstXY=
null;return c}},findTouch:function(a,c){for(var d=0,b=a.length,e;d<b&&(e=a[d]);d++)if(e.identifier===c)return!0},vacuumTouches:function(a){var c=a.touches;if(L.size>=c.length){var d=[];L.forEach(function(a,b){1===b||this.findTouch(c,b-2)||d.push(a.out)},this);d.forEach(this.cancelOut,this)}},touchstart:function(a){this.vacuumTouches(a);this.setPrimaryTouch(a.changedTouches[0]);this.dedupSynthMouse(a);this.scrolling||(this.clickCount++,this.processTouches(a,this.overDown))},overDown:function(a){L.set(a.pointerId,
{target:a.target,out:a,outTarget:a.target});r.enterOver(a);r.down(a)},touchmove:function(a){this.scrolling||(this.shouldScroll(a)?(this.scrolling=!0,this.touchcancel(a)):(a.preventDefault(),this.processTouches(a,this.moveOverOut)))},moveOverOut:function(a){var c=L.get(a.pointerId);if(c){var d=c.out,b=c.outTarget;r.move(a);d&&b!==a.target&&(d.relatedTarget=a.target,a.relatedTarget=b,d.target=b,a.target?(r.leaveOut(d),r.enterOver(a)):(a.target=b,a.relatedTarget=null,this.cancelOut(a)));c.out=a;c.outTarget=
a.target}},touchend:function(a){this.dedupSynthMouse(a);this.processTouches(a,this.upOut)},upOut:function(a){this.scrolling||(r.up(a),r.leaveOut(a));this.cleanUpPointer(a)},touchcancel:function(a){this.processTouches(a,this.cancelOut)},cancelOut:function(a){r.cancel(a);r.leaveOut(a);this.cleanUpPointer(a)},cleanUpPointer:function(a){L.delete(a.pointerId);this.removePrimaryPointer(a)},dedupSynthMouse:function(a){var c=M.lastTouches;a=a.changedTouches[0];this.isPrimaryTouch(a)&&(a={x:a.clientX,y:a.clientY},
c.push(a),c=function(a,c){c=a.indexOf(c);-1<c&&a.splice(c,1)}.bind(null,c,a),setTimeout(c,2500))}};T=new n(R.elementAdded,R.elementRemoved,R.elementChanged,R);var J=r.pointermap,U=window.MSPointerEvent&&"number"===typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,Q={events:"MSPointerDown MSPointerMove MSPointerUp MSPointerOut MSPointerOver MSPointerCancel MSGotPointerCapture MSLostPointerCapture".split(" "),register:function(a){r.listen(a,this.events)},unregister:function(a){r.unlisten(a,this.events)},
POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(a){var c=a;U&&(c=r.cloneEvent(a),c.pointerType=this.POINTER_TYPES[a.pointerType]);return c},cleanup:function(a){J.delete(a)},MSPointerDown:function(a){J.set(a.pointerId,a);a=this.prepareEvent(a);r.down(a)},MSPointerMove:function(a){a=this.prepareEvent(a);r.move(a)},MSPointerUp:function(a){var c=this.prepareEvent(a);r.up(c);this.cleanup(a.pointerId)},MSPointerOut:function(a){a=this.prepareEvent(a);r.leaveOut(a)},MSPointerOver:function(a){a=
this.prepareEvent(a);r.enterOver(a)},MSPointerCancel:function(a){var c=this.prepareEvent(a);r.cancel(c);this.cleanup(a.pointerId)},MSLostPointerCapture:function(a){a=r.makeEvent("lostpointercapture",a);r.dispatchEvent(a)},MSGotPointerCapture:function(a){a=r.makeEvent("gotpointercapture",a);r.dispatchEvent(a)}},I,V,X;window.navigator.msPointerEnabled?(I=function(a){m(a);p(this);0!==r.pointermap.get(a).buttons&&(r.setCapture(a,this,!0),this.msSetPointerCapture(a))},V=function(a){m(a);r.releaseCapture(a,
!0);this.msReleasePointerCapture(a)}):(I=function(a){m(a);p(this);0!==r.pointermap.get(a).buttons&&r.setCapture(a,this)},V=function(a){m(a);r.releaseCapture(a)});X=function(a){return!!r.captureInfo[a]};var W=window.PointerEvent||window.MSPointerEvent;return{dispatcher:r,Installer:n,PointerEvent:q,PointerMap:l,targetFinding:y,applyGlobal:function(){h();window.PointerEvent||(window.PointerEvent=q,window.navigator.msPointerEnabled?(Object.defineProperty(window.navigator,"maxTouchPoints",{value:window.navigator.msMaxTouchPoints,
enumerable:!0}),r.registerSource("ms",Q)):(Object.defineProperty(window.navigator,"maxTouchPoints",{value:0,enumerable:!0}),r.registerSource("mouse",M),void 0!==window.ontouchstart&&r.registerSource("touch",R)),r.register(document));window.Element&&!Element.prototype.setPointerCapture&&Object.defineProperties(Element.prototype,{setPointerCapture:{value:I},releasePointerCapture:{value:V},hasPointerCapture:{value:X}})},applyLocal:function(a){W||(window.PointerEvent||(window.navigator.msPointerEnabled?
r.registerSource("ms",Q):(r.registerSource("mouse",M),void 0!==window.ontouchstart&&r.registerSource("touch",R)),r.register(document)),window.Element&&!Element.prototype.setPointerCapture&&(a.setPointerCapture=I.bind(a),a.releasePointerCapture=V.bind(a),a.hasPointerCapture=X.bind(a)),a.getAttribute("touch-action")||a.setAttribute("touch-action","none"))}}})},"esri/views/input/keys":function(){define(["require","exports","../../core/has"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});
b.primaryKey="Meta";var f={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(q=48;58>q;q++)f[q]=String.fromCharCode(q);for(q=1;25>q;q++)f[111+q]="F"+q;for(q=65;91>q;q++)f[q]=[String.fromCharCode(q+32),String.fromCharCode(q)];var k={Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Esc:"Escape"};b.eventKey=function(d){if(void 0!==d.key)return k[d.key]||d.key;
var b=f[d.keyCode];return Array.isArray(b)?d.shiftKey?b[1]:b[0]:b};b.isSystemModifier=function(d){switch(d){case "Ctrl":case "Alt":case "Shift":case "Meta":case "Primary":return!0}}})},"esri/views/input/gamepad/GamepadSource":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/scheduling ./GamepadInputDevice ./GamepadState".split(" "),function(q,b,n,f,k,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,f){var c=this;this.element=b;this.input=
f;this.handleGamepadConnectedEvent=function(a){c.handleGamepadConnected(a.gamepad)};this.handleGamepadDisconnectedEvent=function(a){a=a.gamepad;var b=c.inputDevices[a.index];b&&(c.emitGamepadEvent(a,d.extractState(b),!1),c.inputDevices[a.index]=void 0,c.latestUpdate[a.index]=void 0,c.input.gamepad.devices.remove(b))};this.frameTask=null;this.latestUpdate=[];this.inputDevices=[];this.callback=null;if(this.supported="getGamepads"in window.navigator)this.forEachGamepad(function(a){return c.handleGamepadConnected(a)}),
window.addEventListener("gamepadconnected",this.handleGamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this.handleGamepadDisconnectedEvent)}b.prototype.destroy=function(){this.pollingEnabled=!1;this.supported&&(window.removeEventListener("gamepadconnected",this.handleGamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this.handleGamepadDisconnectedEvent))};Object.defineProperty(b.prototype,"onEvent",{set:function(d){this.callback=d},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"pollingEnabled",{set:function(d){this.supported&&(d?this.startPolling():this.stopPolling())},enumerable:!0,configurable:!0});b.prototype.handleGamepadConnected=function(d){var b=new k(d);"unknown"!==b.deviceType&&(this.inputDevices[d.index]=b,this.input.gamepad.devices.add(b))};b.prototype.startPolling=function(){var d=this;null==this.frameTask&&(this.frameTask=f.addFrameTask({update:function(){return d.readGamepadState()}}))};b.prototype.stopPolling=function(){null!=
this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=[])};b.prototype.readGamepadState=function(){var b=this,f=document.hasFocus(),c=this.element.contains(document.activeElement),a="document"===this.input.gamepad.enabledFocusMode&&!f||"view"===this.input.gamepad.enabledFocusMode&&!c;this.forEachGamepad(function(c){var g=b.inputDevices[c.index];if(g){var e=b.latestUpdate[c.index],g=d.extractState(g),f=a||d.stateIdle(g);e&&(e.timestamp===c.timestamp||!e.active&&f||d.stateEqual(e.state,
g))||b.emitGamepadEvent(c,g,!f)}})};b.prototype.forEachGamepad=function(d){for(var b=window.navigator.getGamepads(),c=0;c<b.length;c++){var a=b[c];this.validate(a)&&d(a)}};b.prototype.emitGamepadEvent=function(d,b,c){var a=this.latestUpdate[d.index];if((a=a&&a.active)||c)this.latestUpdate[d.index]={timestamp:d.timestamp,state:b,active:c},this.callback&&this.callback({device:this.inputDevices[d.index],state:b,action:!a&&c?"start":a&&c?"update":"end"})};b.prototype.validate=function(d){if(!d||!d.connected)return!1;
for(var b=0;b<d.axes.length;b++)if(isNaN(d.axes[b]))return!1;return!0};return b}();b.GamepadSource=q})},"esri/views/input/gamepad/GamepadState":function(){define(["require","exports","../../3d/support/mathUtils"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.extractState=function(b){var f=b.native;return{buttons:f.buttons.map(function(d){return d.pressed?d.value?d.value:1:0}),axes:f.axes.map(function(d){var f=b.axisThreshold,m=Math.abs(d);d=m<f?0:n.sign(d)*(m-f)/(1-f);return d})}};
b.stateEqual=function(b,k){if(b.axes.length!==k.axes.length||b.buttons.length!==k.buttons.length)return!1;for(var d=0;d<b.axes.length;d++)if(b.axes[d]!==k.axes[d])return!1;for(d=0;d<b.buttons.length;d++)if(b.buttons[d]!==k.buttons[d])return!1;return!0};b.stateIdle=function(b){for(var f=0;f<b.axes.length;f++)if(0!==b.axes[f])return!1;for(f=0;f<b.buttons.length;f++)if(0!==b.buttons[f])return!1;return!0}})},"esri/views/input/InputManager":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Logger ../../core/now ../../core/accessorSupport/decorators ./keys ./recognizers ./handlers/LatestPointerType".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a){Object.defineProperty(b,"__esModule",{value:!0});var l=d.getLogger("esri.views.input.InputManager");q=function(d){function b(a,c){a=d.call(this)||this;a._pointerCaptures=new Map;a._nameToGroup={};a._handlers=[];a._currentPropagation=null;a._sourceEvents=new Set;a._keyModifiers=new Set;a._activeKeyModifiers=new Set;a.primaryKey=p.primaryKey;a.latestPointerType="mouse";a._installRecognizers();return a}n(b,d);b.prototype.normalizeCtorArgs=function(a,d){this._browserEvents=
a;this._browserEvents.onEventReceived=this._onEventReceived.bind(this);this._recognizers=d;this._recognizers||(this._recognizers=c.defaults.map(function(a){return new a}));return{}};b.prototype.destroy=function(){for(var a=0,c=Object.keys(this._nameToGroup);a<c.length;a++)this.uninstallHandlers(c[a]);this._browserEvents=null};Object.defineProperty(b.prototype,"hasPendingInputs",{get:function(){return this._handlers.some(function(a){return a.handler.hasPendingInputs})},enumerable:!0,configurable:!0});
b.prototype.installHandlers=function(a,c){var d=this;if(this._nameToGroup[a])l.error("There is already an InputHandler group registered under the name `"+a+"`");else if(0===c.length)l.error("Can't register a group of zero handlers");else{var b={name:a,handlers:c.map(function(a,c){return{handler:a,active:!0,removed:!1,priorityIndex:0,eventCallback:null,uninstallCallback:null}})};this._nameToGroup[a]=b;a=function(a){var c=b.handlers[a];e._handlers.push(c);c.handler.onInstall({updateDependencies:function(){d.updateDependencies()},
emit:function(a,b,e,g){d._emitInputEvent(c.priorityIndex,a,b,e,g)},setPointerCapture:function(a,e){d._setPointerCapture(b,c,a,e)},setEventCallback:function(a){c.eventCallback=a},setUninstallCallback:function(a){c.uninstallCallback=a},refreshHasPendingInputs:function(){d.notifyChange("hasPendingInputs")}})};var e=this;for(c=b.handlers.length-1;0<=c;c--)a(c);this.updateDependencies()}};b.prototype.uninstallHandlers=function(a){var c=this._nameToGroup[a];c?(c.handlers.forEach(function(a){a.removed=!0;
a.uninstallCallback()}),delete this._nameToGroup[a],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):l.error("There is no InputHandler group registered under the name `"+a+"`")};b.prototype.hasHandlers=function(a){return void 0!==this._nameToGroup[a]};b.prototype.updateDependencies=function(){var a=new Set,c=new Set;this._handlersPriority=[];for(var d=this._handlers.length-1;0<=d;d--){var b=this._handlers[d];b.priorityIndex=d;this._handlersPriority.push(b)}this._handlersPriority=
this._sortHandlersPriority(this._handlersPriority);for(d=this._handlersPriority.length-1;0<=d;d--){b=this._handlersPriority[d];b.priorityIndex=d;var e=b.handler.hasSideEffects;if(!e)for(var g=0,f=b.handler.outgoingEventTypes;g<f.length;g++)if(a.has(f[g])){e=!0;break}if(e)for(g=0,f=b.handler.incomingEventMatches;g<f.length;g++){var h=f[g];a.add(h.eventType);for(var l=0,h=h.keyModifiers;l<h.length;l++){var m=h[l];p.isSystemModifier(m)||c.add(m)}}b.active=e}this._sourceEvents=a;this._keyModifiers=c;
0<this._pointerCaptures.size&&this._sourceEvents.add("pointer-capture-lost");0<this._keyModifiers.size&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up"));this._browserEvents&&(this._browserEvents.activeEvents=this._sourceEvents)};b.prototype._setLatestPointerType=function(a){this._set("latestPointerType",a)};b.prototype._onEventReceived=function(a,c){"pointer-capture-lost"===a&&this._pointerCaptures.delete(c.native.pointerId);this._updateKeyModifiers(a,c);this._emitInputEventFromSource(a,
c,c.native?c.native.timestamp:void 0)};b.prototype._updateKeyModifiers=function(a,c){var d=this;if(c){var b=!1,e=function(){if(!b){var a=new Set;d._activeKeyModifiers.forEach(function(c){a.add(c)});d._activeKeyModifiers=a;b=!0}},g=function(a,c){c&&!d._activeKeyModifiers.has(a)?(e(),d._activeKeyModifiers.add(a)):!c&&d._activeKeyModifiers.has(a)&&(e(),d._activeKeyModifiers.delete(a))};if("key-down"===a||"key-up"===a){var f=c.key;this._keyModifiers.has(f)&&g(f,"key-down"===a)}a=c.native;g("Alt",!(!a||
!a.altKey));g("Ctrl",!(!a||!a.ctrlKey));g("Shift",!(!a||!a.shiftKey));g("Meta",!(!a||!a.metaKey));g("Primary",this._activeKeyModifiers.has(this.primaryKey))}};b.prototype._installRecognizers=function(){var c=this;this._latestPointerTypeHandler=new a.LatestPointerType(function(a){return c._setLatestPointerType(a)});0<this._recognizers.length&&this.installHandlers("default",this._recognizers);this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler])};b.prototype._setPointerCapture=
function(a,c,d,b){a=a.name+"-"+c.priorityIndex;c=this._pointerCaptures.get(d.pointerId)||new Set;this._pointerCaptures.set(d.pointerId,c);b?(c.add(a),1===c.size&&this._browserEvents&&this._browserEvents.setPointerCapture(d,!0)):c.has(a)&&(c.delete(a),0===c.size&&(this._pointerCaptures.delete(d.pointerId),this._browserEvents&&this._browserEvents.setPointerCapture(d,!1)))};b.prototype._garbageCollectRemovedHandlers=function(){this._handlers=this._handlers.filter(function(a){return!a.removed});this.updateDependencies()};
b.prototype._emitInputEventFromSource=function(a,c,d){this._emitInputEvent(0,a,c,d)};b.prototype._emitInputEvent=function(a,c,d,b,e){b=void 0!==b?b:this._currentPropagation?this._currentPropagation.timestamp:h();c=new g(c,d,b,e||this._activeKeyModifiers);this._currentPropagation?this._currentPropagation.addedEvents.push(c):this._doNewPropagation(a,c)};b.prototype._doNewPropagation=function(a,c){for(a=this._currentPropagation={events:[c],addedEvents:[],currentHandler:this._handlersPriority[a],needsHandlerGarbageCollect:!1,
timestamp:c.timestamp};a.currentHandler;){if(a.currentHandler.removed)a.needsHandlerGarbageCollect=!0;else{c=a.events;var d=[];a.addedEvents=[];for(var b=0;b<c.length;b++){var e=c[b];a.currentHandler.active&&a.currentHandler.eventCallback(e);e.shouldStopPropagation()||d.push(e)}a.events=d.concat(a.addedEvents)}a.currentHandler=this._handlersPriority[a.currentHandler.priorityIndex+1]}a.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers();this._currentPropagation=null};b.prototype._compareHandlerPriority=
function(a,c){if(a.handler.hasSideEffects!==c.handler.hasSideEffects)return a.handler.hasSideEffects?1:-1;for(var d=0,b=a.handler.incomingEventMatches;d<b.length;d++)for(var e=b[d],g=function(a){if(e.eventType!==a.eventType)return"continue";var c=e.keyModifiers.filter(function(c){return-1!==a.keyModifiers.indexOf(c)});if(c.length===e.keyModifiers.length!==(c.length===a.keyModifiers.length))return{value:e.keyModifiers.length>a.keyModifiers.length?-1:1}},f=0,h=c.handler.incomingEventMatches;f<h.length;f++){var l=
g(h[f]);if("object"===typeof l)return l.value}return a.priorityIndex>c.priorityIndex?-1:1};b.prototype._sortHandlersPriority=function(a){for(var c=[],d=0;d<a.length;d++){for(var b=a[d],e=0;e<c.length&&0<=this._compareHandlerPriority(b,c[e]);)e++;c.splice(e,0,b)}return c};Object.defineProperty(b.prototype,"debug",{get:function(){var a=this,c=function(c){var d=a._setPointerCapture;a._setPointerCapture=function(){};c();a._setPointerCapture=d};return{injectEvent:function(d,b){c(function(){a._onEventReceived(d,
b)})},disablePointerCapture:c}},enumerable:!0,configurable:!0});f([m.property({readOnly:!0})],b.prototype,"hasPendingInputs",null);f([m.property({readOnly:!0})],b.prototype,"latestPointerType",void 0);return b=f([m.subclass("esri.views.input.InputManager")],b)}(m.declared(k));b.InputManager=q;var g=function(){function a(a,c,d,b){this.type=a;this.data=c;this.timestamp=d;this.modifiers=b;this._stopPropagation=!1}a.prototype.stopPropagation=function(){this._stopPropagation=!0};a.prototype.shouldStopPropagation=
function(){return this._stopPropagation};return a}()})},"esri/views/input/recognizers":function(){define("require exports ./recognizers/Drag ./recognizers/PointerClickHoldAndDrag ./recognizers/SingleAndDoubleClick ./recognizers/VerticalTwoFingerDrag".split(" "),function(q,b,n,f,k,d){Object.defineProperty(b,"__esModule",{value:!0});b.defaults=[f.PointerClickHoldAndDrag,k.SingleAndDoubleClick,n.Drag,d.VerticalTwoFingerDrag]})},"esri/views/input/recognizers/Drag":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/screenUtils ../InputHandler ./support".split(" "),
function(q,b,n,f,k,d){function h(a){var c=[];a.forEach(function(a){c.push(f.createScreenPoint(a.event.x,a.event.y))});return d.fitCircleLSQ(c)}function m(a){var d=h(a),b=0;a.forEach(function(a){for(var e=c(a,d),e=e-a.lastAngle;e>Math.PI;)e-=2*Math.PI;for(;e<-Math.PI;)e+=2*Math.PI;e=a.lastAngle+e;a.lastAngle=e;b+=e-a.initialAngle});b/=a.size||1;return{angle:b,radius:d.radius,center:d.center}}function p(a){var c=new Map;a.forEach(function(a,d){return c.set(d,a.event)});return c}function c(a,c){a=a.event;
return Math.atan2(a.y-c.center.y,a.x-c.center.x)}Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function d(){var c=a.call(this,!1)||this;c.startStateModifiers=new Set;c.activePointerMap=new Map;c.isDragging=!1;c.drag=c.registerOutgoing("drag");c.registerIncoming("pointer-drag",c.handlePointerDrag.bind(c));c.registerIncoming("pointer-up",c.handlePointerUpAndPointerLost.bind(c));c.registerIncoming("pointer-capture-lost",c.handlePointerUpAndPointerLost.bind(c));c.registerIncoming("pointer-cancel",
c.handlePointerUpAndPointerLost.bind(c));return c}n(d,a);d.prototype.createPayload=function(a,c,d,b){return{action:a,pointerType:this.pointerType,button:this.mouseButton,buttons:c.buttons,timestamp:b,pointers:p(this.activePointerMap),pointer:c,angle:d.angle,radius:d.radius,center:d.center}};d.prototype.addPointer=function(a){var d=a.native.pointerId,b=m(this.activePointerMap).angle;a={event:a,initialAngle:0,lastAngle:0};this.activePointerMap.set(d,a);d=c(a,h(this.activePointerMap));a.initialAngle=
d;a.lastAngle=d;this.updatePointerAngles(b)};d.prototype.updatePointer=function(a){if(!a||null!=a.x||null!=a.y){var c=this.activePointerMap.get(a.native.pointerId);c?c.event=a:this.addPointer(a)}};d.prototype.removePointer=function(a){var c=m(this.activePointerMap).angle;this.activePointerMap.delete(a);this.updatePointerAngles(c)};d.prototype.updatePointerAngles=function(a){var d=m(this.activePointerMap);this.activePointerMap.forEach(function(b){b.initialAngle=c(b,d)-a;b.lastAngle=c(b,d)-a})};d.prototype.emitEvent=
function(a,c,d){var b=m(this.activePointerMap);this.drag.emit(this.createPayload(a,c,b,d),void 0,this.startStateModifiers)};d.prototype.handlePointerUpAndPointerLost=function(a){var c=a.data.native.pointerId,d=a.timestamp;this.activePointerMap.get(c)&&(1===this.activePointerMap.size?(this.updatePointer(a.data),this.emitEvent("end",a.data,d),this.isDragging=!1,this.removePointer(c)):(this.removePointer(c),this.emitEvent("removed",a.data,a.timestamp)))};d.prototype.handlePointerDrag=function(a){var c=
a.data,d=c.currentEvent,b=a.timestamp;switch(c.action){case "start":case "update":this.isDragging?this.activePointerMap.has(d.native.pointerId)?(this.updatePointer(d),this.emitEvent("update",d,b)):(this.addPointer(d),this.emitEvent("added",d,b)):(this.updatePointer(d),this.pointerType=a.data.startEvent.pointerType,this.mouseButton=a.data.startEvent.button,this.startStateModifiers=a.modifiers,this.isDragging=!0,this.emitEvent("start",d,b))}};return d}(k.InputHandler);b.Drag=q;(function(a){a[a.Left=
0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right";a[a.Back=3]="Back";a[a.Forward=4]="Forward";a[a.Undefined=-1]="Undefined"})(b.Button||(b.Button={}))})},"esri/views/input/recognizers/support":function(){define(["require","exports","../../../core/screenUtils"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.manhattanDistance=function(b,k){return Math.abs(k.x-b.x)+Math.abs(k.y-b.y)};b.euclideanDistance=function(b,k){var d=k.x-b.x;b=k.y-b.y;return Math.sqrt(d*d+b*b)};b.fitCircleLSQ=
function(b,k){k?(k.radius=0,k.center.x=0,k.center.y=0):k={radius:0,center:n.createScreenPoint()};if(0===b.length)return k;if(1===b.length)return k.center.x=b[0].x,k.center.y=b[0].y,k;if(2===b.length){var d=b[0];b=b[1];var f=[b.x-d.x,b.y-d.y],m=f[0],f=f[1];k.radius=Math.sqrt(m*m+f*f)/2;k.center.x=(d.x+b.x)/2;k.center.y=(d.y+b.y)/2;return k}for(var p=0,c=0,a=0;a<b.length;a++)p+=b[a].x,c+=b[a].y;for(var p=p/b.length,c=c/b.length,l=b.map(function(a){return a.x-p}),g=b.map(function(a){return a.y-c}),e=
d=k=0,u=0,t=m=0,a=f=0;a<l.length;a++){var r=l[a],y=g[a],w=r*r,x=y*y;k+=w;d+=x;e+=r*y;u+=w*r;m+=x*y;t+=r*x;f+=y*w}a=k;l=e;g=d;u=.5*(u+t);m=.5*(m+f);f=a*g-e*l;t=(u*g-m*l)/f;m=(a*m-e*u)/f;f=n.createScreenPoint(t+p,m+c);return{radius:Math.sqrt(t*t+m*m+(k+d)/b.length),center:f}}})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/clock ../InputHandler ./support".split(" "),function(q,b,n,f,k,d){Object.defineProperty(b,
"__esModule",{value:!0});b.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilTouchDrag:6,holdDelay:500};q=function(h){function m(d,c,a,l,g){void 0===d&&(d=b.DefaultParameters.maximumClickDelay);void 0===c&&(c=b.DefaultParameters.movementUntilMouseDrag);void 0===a&&(a=b.DefaultParameters.movementUntilTouchDrag);void 0===l&&(l=b.DefaultParameters.holdDelay);void 0===g&&(g=f.default);var e=h.call(this,!1)||this;e.maximumClickDelay=d;e.movementUntilMouseDrag=c;e.movementUntilTouchDrag=
a;e.holdDelay=l;e._clock=g;e._pointerState=new Map;e._pointerDrag=e.registerOutgoing("pointer-drag");e._immediateClick=e.registerOutgoing("immediate-click");e._pointerHold=e.registerOutgoing("hold");e.registerIncoming("pointer-down",e._handlePointerDown.bind(e));e.registerIncoming("pointer-up",function(a){e._handlePointerLoss(a,"pointer-up")});e.registerIncoming("pointer-capture-lost",function(a){e._handlePointerLoss(a,"pointer-capture-lost")});e.registerIncoming("pointer-cancel",function(a){e._handlePointerLoss(a,
"pointer-cancel")});e._moveHandle=e.registerIncoming("pointer-move",e._handlePointerMove.bind(e));e._moveHandle.pause();return e}n(m,h);m.prototype.onUninstall=function(){this._pointerState.forEach(function(d){null!=d.holdTimeout&&(d.holdTimeout.remove(),d.holdTimeout=null)});h.prototype.onUninstall.call(this)};m.prototype._handlePointerDown=function(d){var c=this,a=d.data,b=a.native.pointerId,g=null;0===this._pointerState.size&&(g=this._clock.setTimeout(function(){var a=c._pointerState.get(b);a&&
(a.isDragging||(c._pointerHold.emit(a.previousEvent,void 0,d.modifiers),a.holdEmitted=!0),a.holdTimeout=null)},this.holdDelay));g={startEvent:a,previousEvent:a,startTimestamp:d.timestamp,isDragging:!1,downButton:a.native.button,holdTimeout:g,modifiers:new Set};this._pointerState.set(b,g);this.startCapturingPointer(a.native);this._moveHandle.resume();1<this._pointerState.size&&this.startDragging(d)};m.prototype._createPointerDragData=function(d,c,a){return{action:d,startEvent:c.startEvent,previousEvent:c.previousEvent,
currentEvent:a}};m.prototype._handlePointerMove=function(b){var c=b.data,a=this._pointerState.get(c.native.pointerId);a&&(a.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",a,c),void 0,a.modifiers):d.euclideanDistance(c,a.startEvent)>("touch"===c.native.pointerType?this.movementUntilTouchDrag:this.movementUntilMouseDrag)&&this.startDragging(b),a.previousEvent=c)};m.prototype.startDragging=function(d){var c=this,a=d.data,b=a.native.pointerId;this._pointerState.forEach(function(g){null!=
g.holdTimeout&&(g.holdTimeout.remove(),g.holdTimeout=null);g.isDragging||(g.modifiers=d.modifiers,g.isDragging=!0,b===g.startEvent.native.pointerId?c._pointerDrag.emit(c._createPointerDragData("start",g,a)):c._pointerDrag.emit(c._createPointerDragData("start",g,g.previousEvent),d.timestamp))})};m.prototype._handlePointerLoss=function(d,c){var a=d.data,b=a.native.pointerId,g=this._pointerState.get(b);g&&(null!=g.holdTimeout&&(g.holdTimeout.remove(),g.holdTimeout=null),g.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",
g,"pointer-up"===c?a:g.previousEvent),void 0,g.modifiers):"pointer-up"===c&&g.downButton===a.native.button&&d.timestamp-g.startTimestamp<=this.maximumClickDelay&&!g.holdEmitted&&this._immediateClick.emit(a),this._pointerState.delete(b),this.stopCapturingPointer(a.native),0===this._pointerState.size&&this._moveHandle.pause())};return m}(k.InputHandler);b.PointerClickHoldAndDrag=q})},"esri/core/clock":function(){define(["require","exports","./global"],function(q,b,n){function f(b){return{setTimeout:function(d,
f){var h=b.setTimeout(d,f);return{remove:function(){return b.clearTimeout(h)}}}}}Object.defineProperty(b,"__esModule",{value:!0});b.wrap=f;b.default=f(n)})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/clock ../../../core/iteratorUtils ../InputHandler ./support".split(" "),function(q,b,n,f,k,d,h){Object.defineProperty(b,"__esModule",{value:!0});b.DefaultParameters={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,
maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};q=function(d){function m(c,a,h,g,e){void 0===c&&(c=b.DefaultParameters.maximumDoubleClickDelay);void 0===a&&(a=b.DefaultParameters.maximumDoubleClickDistance);void 0===h&&(h=b.DefaultParameters.maximumDoubleTouchDelay);void 0===g&&(g=b.DefaultParameters.maximumDoubleTouchDistance);void 0===e&&(e=f.default);var l=d.call(this,!1)||this;l.maximumDoubleClickDelay=c;l.maximumDoubleClickDistance=a;l.maximumDoubleTouchDelay=h;l.maximumDoubleTouchDistance=
g;l._clock=e;l._pointerState=new Map;l._click=l.registerOutgoing("click");l._doubleClick=l.registerOutgoing("double-click");l.registerIncoming("immediate-click",l._handleImmediateClick.bind(l));l.registerIncoming("pointer-drag",l._handlePointerDrag.bind(l));l.registerIncoming("drag",l._handleDrag.bind(l));return l}n(m,d);m.prototype.onUninstall=function(){this._pointerState.forEach(function(c){null!=c.doubleClickTimeout&&(c.doubleClickTimeout.remove(),c.doubleClickTimeout=null)})};Object.defineProperty(m.prototype,
"hasPendingInputs",{get:function(){return!k.everyMap(this._pointerState,function(c){return null==c.doubleClickTimeout})},enumerable:!0,configurable:!0});m.prototype._pointerId=function(c){c=c.native;return"mouse"===c.pointerType?c.pointerId+":"+c.button:""+c.pointerType};m.prototype._handleImmediateClick=function(c){var a=c.data,d=this._pointerId(a),b=this._pointerState.get(d);if(b){var e="touch"===a.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;h.manhattanDistance(b.event.data,
a)>e?(this._clearDoubleClickTimeout(d,!0),this._startClick(c)):(this._clearDoubleClickTimeout(d,!1),this._doubleClick.emit(a,void 0,b.event.modifiers))}else this._startClick(c)};m.prototype._startClick=function(c){var a=this,d=this._pointerId(c.data);this._pointerState.set(d,{event:c,doubleClickTimeout:this._clock.setTimeout(function(){return a._doubleClickTimeoutExceeded(d)},"touch"===c.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)});this.refreshHasPendingInputs()};
m.prototype._handlePointerDrag=function(c){c=this._pointerId(c.data.currentEvent);this._clearDoubleClickTimeout(c,!0)};m.prototype._handleDrag=function(c){c=this._pointerId(c.data.pointer);this._clearDoubleClickTimeout(c,!0)};m.prototype._clearDoubleClickTimeout=function(c,a){var d=this._pointerState.get(c);d&&(d.doubleClickTimeout.remove(),d.doubleClickTimeout=null,a&&this._doubleClickTimeoutExceeded(c),this._pointerState.delete(c),this.refreshHasPendingInputs())};m.prototype._doubleClickTimeoutExceeded=
function(c){var a=this._pointerState.get(c);this._click.emit(a.event.data,void 0,a.event.modifiers);a.doubleClickTimeout=null;this._pointerState.delete(c);this.refreshHasPendingInputs()};return m}(d.InputHandler);b.SingleAndDoubleClick=q})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../DragEventSeparator","../InputHandler"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});q=function(d){function b(b,
h){void 0===b&&(b=20);void 0===h&&(h=40);var c=d.call(this,!1)||this;c._threshold=b;c._maxDelta=h;c.state="ready";c.emittedArtificalEnd2=!1;c._vertical=c.registerOutgoing("vertical-two-finger-drag");c._artificalDrag=c.registerOutgoing("drag");c.dragEventSeparator=new f.DragEventSeparator({start:function(a,d){return c.observeStart(a,d)},update:function(a,d,b){return c.observeUpdate(a,d,b)},end:function(a,d){return c.observeEnd(a,d)}});c.registerIncoming("drag",function(a){return c.dragEventSeparator.handle(a)});
return c}n(b,d);Object.defineProperty(b.prototype,"failed",{get:function(){return"failed"===this.state},enumerable:!0,configurable:!0});b.prototype.observeStart=function(d,b){1===d&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:b.data.button,buttons:b.data.buttons,pointerType:b.data.pointerType,timestamp:b.data.timestamp,pointers:b.data.pointers,pointer:b.data.pointer,angle:b.data.angle,radius:b.data.radius,center:b.data.center,artifical:!0}),
b.stopPropagation());this.state=2===d?"ready":"failed"};b.prototype.observeUpdate=function(d,b,c){"failed"!==this.state&&2===d&&("active"===this.state?(this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"update"}),b.stopPropagation()):this.checkMovementWithinLimits(b.data,c.data)?this.checkVerticalThresholdReached(b.data,c.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=b.data.center,this._artificalDrag.emit({action:"end",button:b.data.button,
buttons:b.data.buttons,pointerType:b.data.pointerType,timestamp:b.data.timestamp,pointers:b.data.pointers,pointer:b.data.pointer,angle:b.data.angle,radius:b.data.radius,center:b.data.center,artifical:!0}),this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),b.stopPropagation()):this.state="failed")};b.prototype.observeEnd=function(d,b){"active"===this.state&&(this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",
b.stopPropagation())};b.prototype.checkMovementWithinLimits=function(d,b){var c=-Infinity,a=Infinity,f=-Infinity,g=Infinity;b.pointers.forEach(function(d){c=Math.max(c,d.x);a=Math.min(a,d.x);f=Math.max(f,d.y);g=Math.min(g,d.y)});var e=-Infinity,h=Infinity,m=-Infinity,p=Infinity;d.pointers.forEach(function(a){e=Math.max(e,a.x);h=Math.min(h,a.x);m=Math.max(m,a.y);p=Math.min(p,a.y)});return Math.abs(d.center.x-b.center.x)<this._threshold&&Math.abs(e-h-(c-a))<=this._maxDelta&&Math.abs(m-p-(f-g))<=this._maxDelta};
b.prototype.checkVerticalThresholdReached=function(d,b){var c=Math.abs(d.center.y-b.center.y);d.pointers.forEach(function(a,d){d=b.pointers.get(d);c=Math.min(c,Math.abs(a.y-d.y))});return c>=this._threshold};return b}(k.InputHandler);b.VerticalTwoFingerDrag=q})},"esri/views/input/DragEventSeparator":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this.callbacks=b;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=
function(){return!0})}b.prototype.handle=function(b){var f=b.data,d=f.pointers.size;switch(f.action){case "start":this.currentCount=d;this.emitStart(b);break;case "added":this.emitEnd(this.previousEvent);this.currentCount=d;this.emitStart(b);break;case "update":this.emitUpdate(b);break;case "removed":this.startEvent&&this.emitEnd(this.previousEvent);this.currentCount=d;this.emitStart(b);break;case "end":this.emitEnd(b),this.currentCount=0}this.previousEvent=b};b.prototype.emitStart=function(b){this.startEvent=
b;this.callbacks.condition(this.currentCount,b)&&this.callbacks.start(this.currentCount,b,this.startEvent)};b.prototype.emitUpdate=function(b){this.callbacks.condition(this.currentCount,b)&&this.callbacks.update(this.currentCount,b,this.startEvent)};b.prototype.emitEnd=function(b){this.callbacks.condition(this.currentCount,b)&&this.callbacks.end(this.currentCount,b,this.startEvent);this.startEvent=null};return b}();b.DragEventSeparator=q})},"esri/views/input/handlers/LatestPointerType":function(){define(["require",
"exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function d(d){var f=b.call(this,!0)||this;f._onChange=d;f._value="mouse";f.registerIncoming("pointer-down",function(d){f._setValue("touch"===d.data.native.pointerType?"touch":"mouse")});f._moveHandler=f.registerIncoming("pointer-move",function(d){f._setValue("touch"===d.data.native.pointerType?"touch":"mouse")});f._moveHandler.pause();return f}n(d,b);
d.prototype._setValue=function(d){d!==this._value&&("touch"===d?this._moveHandler.resume():this._moveHandler.pause(),this._value=d,this._onChange(d))};return d}(f.InputHandler);b.LatestPointerType=q})},"esri/views/input/handlers/PreventContextMenu":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function d(){var d=b.call(this,!0)||this;d.registerIncoming("context-menu",
function(d){d.data.native.preventDefault()});return d}n(d,b);return d}(f.InputHandler);b.PreventContextMenu=q;b.default=q})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/Handles ../../../../core/PooledArray ../../../../core/watchUtils ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingRect ./deconflictorDebug ../../support/debugFlags ../../support/earthUtils ../../support/geometryUtils ../../support/mathUtils ../../support/geometryUtils/sphere ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/Util ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z){function A(a){var c,d,b,e;return f(this,function(g){switch(g.label){case 0:c=[];for(d in a)c.push(d);b=0;g.label=1;case 1:if(!(b<c.length))return[3,4];e=c[b];return[4,a[e]];case 2:g.sent(),g.label=3;case 3:return b++,[3,1];case 4:return[2]}})}Object.defineProperty(b,"__esModule",{value:!0});var B=a.vec4f64.create(),C=a.vec4f64.create(),E=a.vec4f64.create(),F=a.vec4f64.create(),H=c.vec3f64.fromValues(0,0,0),D=t.sphere.create(),G=t.ray.create(),
K=c.vec3f64.create(),M=l.create(),O=l.create(),N=function(){return function(){this.posView=this.yMax=this.yMin=this.xMax=this.xMin=0;this.pooled=this.visible=this.culled=!1}}(),P=function(){return function(a,c,d){void 0===d&&(d={});this.graphics3DGraphic=a;this.slicePlaneEnabled=c;this.info=d}}(),L=function(){return function(a,c){void 0===c&&(c=new Map);this.graphics3DCore=a;this.graphics=c}}();q=function(){function a(a){var c,b,e=this;this.handles=new k;this.dirty=!0;this.state=0;this.contexts=[];
this.iterators=this.graphics=null;this.accBinsNumX=15;this.accBinsNumY=20;this.accBinsSizeY=this.accBinsSizeX=0;this.accBins=null;this.accNumTests=0;this._iconMarginFactor=-.1;this.slicePlaneViewSpace=null;this.view=a;this.graphics=(c={},c[0]={active:{},visible:new d,remove:new d},c[1]={active:{},visible:new d,remove:new d},c);this.iterators=(b={},b[0]={active:null,visible:null,remove:null,sort:null},b[1]={active:null,visible:null,remove:null,sort:null},b);this.handles.add([a.watch("state.camera",
function(){e.updateSlicePlane();e.setDirtyUrgent()}),a.watch("map.ground.opacity",function(a,c){1!==a&&1!==c||e.setDirtyUrgent()}),h.init(a,"slicePlane",function(){return e.updateSlicePlane()})]);this.frameWorker=a.resourceController.scheduler.registerTask(12,function(a){return e.run(a)},function(){return e.shouldRun()})}Object.defineProperty(a.prototype,"iconMarginFactor",{get:function(){return this._iconMarginFactor},set:function(a){this._iconMarginFactor=a;this.setDirty()},enumerable:!0,configurable:!0});
a.prototype.updateSlicePlane=function(){var a=this.view&&this.view.slicePlane;a?(this.slicePlaneViewSpace||(this.slicePlaneViewSpace=t.boundedPlane.create()),t.boundedPlane.transform(a,this.view.state.camera.viewMatrix,this.slicePlaneViewSpace),this.slicePlaneChanged()):this.slicePlaneViewSpace&&(this.slicePlaneViewSpace=null,this.slicePlaneChanged())};a.prototype.slicePlaneChanged=function(){for(var a=0,c=this.contexts;a<c.length;a++)if(c[a].graphics3DCore.symbolCreationContext.slicePlaneEnabled){this.setDirty();
break}};a.prototype.destroy=function(){this.handles.destroy();this.handles=null;this.frameWorker&&(this.frameWorker.remove(),this.frameWorker=null);this.graphics[0].active=null;this.graphics[0].visible.clear();this.graphics[0].remove.clear();this.graphics[1].active=null;this.graphics[1].visible.clear();this.graphics[1].remove.clear();this.view=this.iterators=this.graphics=null};a.prototype.addGraphicsOwner=function(a){var c=this,d=this.findDeconflictionContext(a),b;-1!==d?b=this.contexts[d]:(b=new L(a),
this.contexts.push(b),this.setDirtyUrgent());return{addGraphic:function(a){return c.addGraphic(b,a)},removeGraphic:function(a){return c.removeGraphic(b,a)},labelingInfoChange:function(){return c.globalLabelingInfoChanged(b)},visibilityInfoChange:function(){},featureReductionChange:function(){return c.globalFeatureReductionChanged(b)},slicePlaneEnabledChange:function(){return c.globalSlicePlaneEnabledChanged(b)},clear:function(){b.graphics.forEach(function(a){c.removeGraphic(b,a.graphics3DGraphic)})}}};
a.prototype.removeGraphicsOwner=function(a){var c=this;a=this.findDeconflictionContext(a);if(-1!==a){var d=this.contexts.splice(a,1)[0];d.graphics.forEach(function(a){return c.removeGraphic(d,a.graphics3DGraphic)});this.setDirtyUrgent()}};a.prototype.setInitialIconVisibilityFlag=function(a,c){a=!(this.graphicSupportsDeconfliction(c)&&this.isFeatureReductionEnabled(a));c.setVisibilityFlag(3,a,0)};Object.defineProperty(a.prototype,"isDirty",{get:function(){return 0!==this.state||this.dirty},enumerable:!0,
configurable:!0});a.prototype.setDirtyUrgent=function(){this.dirty=!0;this.frameWorker.priority=2};a.prototype.setDirty=function(){this.dirty=!0;this.frameWorker.priority=12};a.prototype.shouldRun=function(){return this.view.ready&&null!=this.view.state&&this.isDirty};a.prototype.run=function(a){switch(this.state){case 0:g.prepare(this.view),this.dirty=!1,this.camera=this.view.state.camera,this.initBins(this.camera.fullWidth,this.camera.fullHeight),this.resetIterators(),a.madeProgress();case 1:if(this.state=
1,!this.processActiveGraphics(0,a))break;case 3:if(this.state=3,!this.cleanVisibleGraphics(0,a))break;case 5:if(this.state=5,!this.sortVisibleGraphics(0,a))break;case 7:this.state=7;if(!this.deconflictVisibleGraphics(0,a))break;g.drawAccelerationStruct(this,this.graphics[0].visible);case 2:if(this.state=2,!this.processActiveGraphics(1,a))break;case 4:if(this.state=4,!this.cleanVisibleGraphics(1,a))break;case 6:if(this.state=6,!this.sortVisibleGraphics(1,a))break;case 8:this.state=8;if(!this.deconflictVisibleGraphics(1,
a))break;g.drawAccelerationStruct(this,this.graphics[1].visible);default:this.state=0}};a.prototype.findDeconflictionContext=function(a){for(var c=0;c<this.contexts.length;c++)if(this.contexts[c].graphics3DCore===a)return c;return-1};a.prototype.globalFeatureReductionChanged=function(a){var c=this.isFeatureReductionEnabled(a.graphics3DCore);c||this.clearVisibilityFlags(a);this.modifyGraphics(a,c,0)};a.prototype.globalLabelingInfoChanged=function(a){var c=this.isLabelDeconflictionEnabled(a.graphics3DCore);
this.modifyGraphics(a,c,1)};a.prototype.globalSlicePlaneEnabledChanged=function(a){var c=a.graphics3DCore.symbolCreationContext.slicePlaneEnabled;a.graphics.forEach(function(a){a.slicePlaneEnabled=c});this.setDirtyUrgent()};a.prototype.modifyGraphics=function(a,c,d){var b=this;c?a.graphics.forEach(function(a){return b.addToActiveGraphics(a,d)}):a.graphics.forEach(function(a){return b.removeFromActiveGraphics(a,d)});this.setDirtyUrgent()};a.prototype.graphicSupportsDeconfliction=function(a){var c=
a._graphics;if(!c||!c.length||a.isDraped())return!1;for(a=0;a<c.length;a++)if(this.graphics3DGraphicsLayerSupportsDeconfliction(c[a]))return!0;return!1};a.prototype.graphics3DGraphicsLayerSupportsDeconfliction=function(a){if(!a||"object3d"!==a.type)return!1;a=a.stageObject;return 1===(a?a.getNumGeometryRecords():0)&&a.getGeometryRecord(0).material instanceof v?!0:!1};a.prototype.addGraphic=function(a,c){var d=c.graphic.uid;c=new P(c,a.graphics3DCore.symbolCreationContext.slicePlaneEnabled);a.graphics.set(d,
c);this.isFeatureReductionEnabled(a.graphics3DCore)&&this.addToActiveGraphics(c,0);this.isLabelDeconflictionEnabled(a.graphics3DCore)&&this.addToActiveGraphics(c,1);this.setDirty()};a.prototype.removeGraphic=function(a,c){c=c.graphic.uid;var d=a.graphics.get(c);d&&(this.removeFromActiveGraphics(d,0),this.removeFromActiveGraphics(d,1),a.graphics.delete(c),this.setDirty())};a.prototype.addToActiveGraphics=function(a,c){a.info[c]=new N;this.graphics[c].active[a.graphics3DGraphic.graphic.uid]=a};a.prototype.removeFromActiveGraphics=
function(a,c){this.removeFromVisibleGraphics(a,c);this.clearGraphicVisibility(a,c);delete a.info[c];delete this.graphics[c].active[a.graphics3DGraphic.graphic.uid]};a.prototype.addToVisibleGraphics=function(a,c){var d=a.info[c];d&&!d.pooled&&(this.graphics[c].visible.push(a),d.pooled=!0)};a.prototype.removeFromVisibleGraphics=function(a,c){var d=a.info[c];d&&d.pooled&&(this.graphics[c].remove.push(a),d.pooled=!1)};a.prototype.processActiveGraphics=function(a,c){for(var d=this.getOrCreateActiveGraphicsIterator(a),
b="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&this.camera&&0<this.camera.relativeElevation;!c.done;){c.madeProgress();var e=d.next();if(e.done)return this.resetActiveGraphicsIterator(a),!0;var g=(e=e.value)&&e.info[a];g&&(this.collectGraphics3DGraphics(e,a,b),g.culled?this.removeFromVisibleGraphics(e,a):this.addToVisibleGraphics(e,a))}return!1};a.prototype.cleanVisibleGraphics=function(a,c){for(var d=this.graphics[a],b=this.ensureRemoveGraphicsIterator(a,c);!c.done;){var e=
b.next();c.madeProgress();if(e.done)return d.remove.clear(),this.resetRemoveGraphicsIterator(a),!0}return!1};a.prototype.sortVisibleGraphics=function(a,c){for(var d=this.ensureSortGraphicsIterator(a,function(c,d){return c.info[a]&&d.info[a]?d.info[a].posView-c.info[a].posView:Number.MAX_VALUE},c);!c.done;){var b=d.next();c.madeProgress();if(b.done)return this.resetSortGraphicsIterator(a),!0}return!1};a.prototype.deconflictVisibleGraphics=function(a,c){for(var d=this.getOrCreateVisibleGraphicsIterator(a),
b=1===a;!c.done;){c.madeProgress();var e=d.next();if(e.done)return this.resetVisibleGraphicsIterator(a),!0;var e=e.value,f=e.info[a];if(f&&!f.culled){var h=e.graphics3DGraphic,h=!(b&&!h.isVisible())&&!this.doesIntersectExistingPoly(e,a);(f.visible=h)&&this.addToBins(e,a);this.setGraphicVisibility(e,a,h);h&&g.drawPoly(f,h?"green":"red")}}return!1};a.prototype.resetIterators=function(){this.iterators[0].active=null;this.iterators[0].visible=null;this.iterators[0].remove=null;this.iterators[0].sort=
null;this.iterators[1].active=null;this.iterators[1].visible=null;this.iterators[1].remove=null;this.iterators[1].sort=null};a.prototype.getOrCreateActiveGraphicsIterator=function(a){var c=this.graphics[a];a=this.iterators[a];a.active||(a.active=A(c.active));return a.active};a.prototype.resetActiveGraphicsIterator=function(a){this.iterators[a].active=null};a.prototype.getOrCreateVisibleGraphicsIterator=function(a){var c=this.graphics[a];a=this.iterators[a];a.visible||(a.visible=c.visible.iterableForEach());
return a.visible};a.prototype.resetVisibleGraphicsIterator=function(a){this.iterators[a].visible=null};a.prototype.ensureRemoveGraphicsIterator=function(a,c){var d=this.graphics[a];a=this.iterators[a];a.remove||(a.remove=d.visible.iterableRemoveMany(d.remove.data,function(){return c.done}));return a.remove};a.prototype.resetRemoveGraphicsIterator=function(a){this.iterators[a].remove=null};a.prototype.ensureSortGraphicsIterator=function(a,c,d){var b=this.graphics[a];a=this.iterators[a];a.sort||(a.sort=
b.visible.iterableSort(c,function(){return d.done}));return a.sort};a.prototype.resetSortGraphicsIterator=function(a){this.iterators[a].sort=null};a.prototype.collectGraphics3DGraphics=function(a,c,d){var b=a.graphics3DGraphic;if(!b.destroyed){var g=1===c,f=g?b._labelGraphics:b._graphics,g=g?0:this.iconMarginFactor;c=a.info[c];if(b.isVisible(0,3)){for(var b=l.empty(M),h,m,k=0;k<f.length;k++){var n=f[k];if(this.graphics3DGraphicsLayerSupportsDeconfliction(n)){var v=n.stageObject,A=v.getGeometryRecord(0),
q=A.material,J=this.camera,U=A.geometry.data.getVertexAttr();if(d&&(D.radius=u.earthRadius,p.vec3.sub(G.direction,v.getCenter(),this.camera.eye),p.vec3.copy(G.origin,this.camera.eye),y.intersectRay(D,G,K))){var N=1-Math.abs(Math.tan(p.vec3.angle(v.getCenter(),G.direction)))/this.view.width,N=Math.pow(N,4),L=p.vec3.sqrDist(this.camera.eye,K),P=p.vec3.sqrDist(this.camera.eye,v.getCenter());if(N*P>L){c.culled=!0;return}}if(!m){m=v.getCenter();A=A.origin.vec3;z.transformToWorld(m,A,B);z.transformToView(B,
A,J.viewMatrix,C);q.applyVerticalOffsetTransformation(C,U[x.VertexAttrConstants.NORMAL].data,v.objectTransformation,J,T);if(a.slicePlaneEnabled&&this.slicePlaneViewSpace&&t.boundedPlane.extrusionContainsPoint(this.slicePlaneViewSpace,C)){c.culled=!0;return}v=U[x.VertexAttrConstants.AUXPOS1].data;U="screen"!==q.getParameters().centerOffsetUnits;z.transformToProjection(C,J.projectionMatrix,U?v:H,E);m=z.transformToNDC(E,F);U||(m[0]+=v[0]/J.fullWidth*2,m[1]+=v[1]/J.fullHeight*2);if(-1>m[0]||-1>m[1]||
-1>m[2]||1<=m[0]||1<=m[1])break;h=C[2];!e.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET&&c.visible&&(h*=.7)}n=n.getScreenSize(R);n[0]*=J.pixelRatio;n[1]*=J.pixelRatio;w.applyPrecomputedScaleFactorVec2(n,T.factor,n);q=l.offset(q.calculateRelativeScreenBounds(n,T.factorAlignment.scale,O),r.lerp(0,J.fullWidth,.5+.5*m[0]),r.lerp(0,J.fullHeight,.5+.5*m[1]));0!==g&&(J=g*Math.min(l.width(q),l.height(q)),q[0]-=J,q[1]-=J,q[2]+=J,q[3]+=J);l.expand(b,q)}}null==h?c.culled=!0:(c.xMin=b[0],c.yMin=b[1],c.xMax=b[2],c.yMax=
b[3],c.posView=h,c.culled=!1)}else c.culled=!0}};a.prototype.doesIntersectExistingPoly=function(a,c){var d=a.graphics3DGraphic.graphic.uid;a=a.info[c];for(var b=Math.floor(a.xMin/this.accBinsSizeX);b<=Math.floor(a.xMax/this.accBinsSizeX);b++)if(!(0>b||b>=this.accBinsNumX))for(var e=Math.floor(a.yMin/this.accBinsSizeY);e<=Math.floor(a.yMax/this.accBinsSizeY);e++)if(!(0>e||e>=this.accBinsNumY))for(var g=this.accBins[b][e],f=0;f<g.length;f++){var h=g.data[f],l=h.info[c];if(l&&l.visible&&h.graphics3DGraphic.graphic.uid!==
d&&(this.accNumTests++,!(l.xMin>a.xMax||l.xMax<a.xMin||l.yMin>a.yMax||l.yMax<a.yMin)))return!0}return!1};a.prototype.initBins=function(a,c){if(null==this.accBins){this.accBins=[];for(var b=0;b<this.accBinsNumX;b++){this.accBins.push([]);for(var e=this.accBins[this.accBins.length-1],g=0;g<this.accBinsNumY;g++)e.push(new d)}}for(b=0;b<this.accBinsNumX;b++)for(g=0;g<this.accBinsNumY;g++)this.accBins[b][g].clear();this.accBinsSizeX=a/this.accBinsNumX;this.accBinsSizeY=c/this.accBinsNumY;this.accNumTests=
0};a.prototype.addToBins=function(a,c){c=a.info[c];for(var d=Math.floor(c.xMin/this.accBinsSizeX);d<=Math.floor(c.xMax/this.accBinsSizeX);d++)if(!(0>d||d>=this.accBinsNumX))for(var b=Math.floor(c.yMin/this.accBinsSizeY);b<=Math.floor(c.yMax/this.accBinsSizeY);b++)0>b||b>=this.accBinsNumY||this.accBins[d][b].push(a)};a.prototype.isFeatureReductionEnabled=function(a){a=a.layer;return!(!a||!a.featureReduction||"selection"!==a.featureReduction.type)};a.prototype.isLabelDeconflictionEnabled=function(a){return a.labelsEnabled};
a.prototype.clearVisibilityFlags=function(a){(a=a.graphics3DCore.graphics3DGraphics)&&a.forEach(function(a){return a.clearVisibilityFlag(3)})};a.prototype.setGraphicVisibility=function(a,c,d){a=a.graphics3DGraphic;a.destroyed||(a.setVisibilityFlag(3,d,c),1===c&&this.view.labeler.setLabelGraphicVisibility(a,d))};a.prototype.clearGraphicVisibility=function(a,c){a=a.graphics3DGraphic;a.destroyed||a.clearVisibilityFlag(3,c)};return a}();b.Deconflictor=q;var T={factor:{scale:0,factor:0,minPixelSize:0,
paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},R=m.vec2f64.create()})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../support/debugFlags"],function(q,b,n,f){function k(c,a,d,b,e){var g=m.height,f=p;f.beginPath();f.lineWidth=1;f.strokeStyle=e;f.moveTo(c,g-d);f.lineTo(a,g-d);f.stroke();f.lineTo(a,g-b);f.stroke();f.lineTo(a,g-d);f.stroke();f.lineTo(c,g-d);f.stroke();f.lineTo(c,
g-d);f.stroke();f.closePath()}Object.defineProperty(b,"__esModule",{value:!0});var d=!1,h=!1,m,p;b.drawAccelerationStruct=function(c,a){if(h&&p){for(var d=p,b=0,e=0;e<c.accBinsNumX;e++)for(var f=0;f<c.accBinsNumY;f++){var m=c.accBins[e][c.accBinsNumY-1-f],b=b+m.length,r=e*c.accBinsSizeX,n=(e+1)*c.accBinsSizeX,w=f*c.accBinsSizeY,x=(f+1)*c.accBinsSizeY;d.fillText(m.length.toFixed(),r+5,w+15);k(r,n,w,x,"blue")}d.fillText("total totalShownLabels: "+b,70,40);d.fillText("total visible labels: "+a.length,
70,50);d.fillText("total numTests: "+c.accNumTests,70,30)}};b.prepare=function(c){d=f.DECONFLICTOR_SHOW_OUTLINES;h=f.DECONFLICTOR_SHOW_GRID;if(d||h){null==m&&(m=document.createElement("canvas"),m.setAttribute("id","canvas2d"),c.surface.parentElement.style.position="relative",c.surface.parentElement.appendChild(m));var a=c.height*c.pixelRatio;m.setAttribute("width",c.width*c.pixelRatio+"px");m.setAttribute("height",a+"px");m.setAttribute("style","position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:"+
c.width+"px;height:"+c.height+"px");p=m.getContext("2d");p.clearRect(0,0,c.width,c.height);p.font="12px Arial"}};b.drawPoly=function(c,a){d&&k(c.xMin,c.xMax,c.yMin,c.yMax,a)}})},"esri/views/3d/support/debugFlags":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(q,b,n,f,k,d){return new (function(b){function h(){var d=null!==b&&b.apply(this,arguments)||
this;d.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;d.SCENEVIEW_LOCKING_LOG=!1;d.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1;d.HIGHLIGHTS_VISUALIZE_BLOCKS=!1;d.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;d.DECONFLICTOR_SHOW_OUTLINES=!1;d.DECONFLICTOR_SHOW_GRID=!1;d.LABELS_SHOW_BORDER=!1;d.OVERLAY_DRAW_TEST_TEXTURE=!1;d.OVERLAY_SHOW_CENTER=!1;d.TESTS_LIMIT_FEATURE_TILE_TREE_THROTTLING=!1;d.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=!1;d.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=!1;d.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES=
!1;d.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1;d.DRAW_MESH_GEOMETRY_NORMALS=!1;d.FEATURE_TILE_FETCH_SHOW_TILES=!1;d.FEATURE_TILE_TREE_SHOW_TILES=!1;d.ENABLE_PROFILE_DEPTH_RANGE=!1;d.DISABLE_FAST_UPDATES=!1;d.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;d.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;return d}n(h,b);f([d.property()],h.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);f([d.property()],h.prototype,"SCENEVIEW_LOCKING_LOG",void 0);f([d.property()],h.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",
void 0);f([d.property()],h.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0);f([d.property()],h.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);f([d.property()],h.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0);f([d.property()],h.prototype,"DECONFLICTOR_SHOW_GRID",void 0);f([d.property()],h.prototype,"LABELS_SHOW_BORDER",void 0);f([d.property()],h.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0);f([d.property()],h.prototype,"OVERLAY_SHOW_CENTER",void 0);f([d.property()],h.prototype,"TESTS_LIMIT_FEATURE_TILE_TREE_THROTTLING",
void 0);f([d.property()],h.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",void 0);f([d.property()],h.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0);f([d.property()],h.prototype,"DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES",void 0);f([d.property()],h.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0);f([d.property()],h.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);f([d.property()],h.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);f([d.property()],h.prototype,"FEATURE_TILE_TREE_SHOW_TILES",
void 0);f([d.property()],h.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0);f([d.property()],h.prototype,"DISABLE_FAST_UPDATES",void 0);f([d.property()],h.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);f([d.property()],h.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);return h=f([d.subclass()],h)}(d.declared(k)))})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["require","exports","../../support/earthUtils","../../support/mathUtils"],function(q,
b,n,f){function k(a){return Math.abs(a*a*a)}function d(a,c,d,b){void 0===b&&(b=l);var e=d.parameters;d=d.paddingPixelsOverride;b.scale=Math.min(e.divisor/(c-e.offset),1);b.factor=k(a);b.minPixelSize=e.minPixelSize;b.paddingPixels=d;return b}function h(a,c){return 0===a?c.minPixelSize:c.minPixelSize*(1+2*c.paddingPixels/a)}function m(a,c){return Math.max(f.lerp(a*c.scale,a,c.factor),h(a,c))}function p(a,c,b){a=d(a,c,b);a.minPixelSize=0;a.paddingPixels=0;return m(1,a)}Object.defineProperty(b,"__esModule",
{value:!0});b.getSettings=function(a){return new c(a,b.defaultDescription)};b.getLabelSettings=function(d){var e=b.defaultDescription.curvatureDependent;return new c(d,{curvatureDependent:{min:{curvature:e.min.curvature,tiltAngle:e.min.tiltAngle,scaleFallOffFactor:a.curvatureDependent.min.scaleFallOffFactor},max:{curvature:e.max.curvature,tiltAngle:e.max.tiltAngle,scaleFallOffFactor:a.curvatureDependent.max.scaleFallOffFactor}},scaleStart:b.defaultDescription.scaleStart,scaleFallOffRange:b.defaultDescription.scaleFallOffRange,
minPixelSize:a.minPixelSize})};b.perspectiveFactor=k;b.scaleFactor=d;b.applyScaleFactor=m;b.applyScaleFactorVec2=function(a,c,d){void 0===d&&(d=[0,0]);var b=Math.min(Math.max(c.scale,h(a[1],c)/a[1]),1);d[0]=f.lerp(a[0]*b,a[0],c.factor);d[1]=f.lerp(a[1]*b,a[1],c.factor);return d};b.precomputeScale=p;b.precomputeScaleFactor=function(a,c,d,b){b.scale=p(a,c,d);b.factor=0;b.minPixelSize=d.parameters.minPixelSize;b.paddingPixels=d.paddingPixelsOverride;return b};b.applyPrecomputedScaleFactorVec2=function(a,
c,d){void 0===d&&(d=[0,0]);c=Math.min(Math.max(c.scale,h(a[1],c)/a[1]),1);d[0]=a[0]*c;d[1]=a[1]*c;return d};b.scale=function(a,c,b,g){return m(a,d(c,b,g))};var c=function(){function a(a,c,d,b){void 0===d&&(d={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0});this.viewingMode=a;this.description=c;this.parameters=d;this._paddingPixelsOverride=b;"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=
this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}Object.defineProperty(a.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!0,configurable:!0});a.prototype.update=function(a){if(this.parameters&&this.parameters.camera.fovY===a.fovY&&this.parameters.camera.distance===
a.distance)return!1;this.calculateParameters(a,this.parameters);return!0};a.prototype.overridePadding=function(c){return c!==this.paddingPixelsOverride?new a(this.viewingMode,this.description,this.parameters,c):this};a.prototype.calculateParameters=function(a,c){var d=this.description,b=d.scaleStart,e=d.scaleFallOffRange,d=d.minPixelSize,g=a.fovY,f=a.distance,h=this.calculateCurvatureDependentParameters(a),l=this.coverageCompensation(a,h),m=h.tiltAngle,h=h.scaleFallOffFactor,f=Math.sin(m)*f,m=.5*
Math.PI-m-g*(.5-b*l),b=f/Math.cos(m),e=(b-f/Math.cos(m+g*e*l)*h)/(1-h);c.camera.fovY=a.fovY;c.camera.distance=a.distance;c.offset=e;c.divisor=b-e;c.minPixelSize=d;return c};a.prototype.calculateCurvatureDependentParametersLocal=function(a,c){void 0===c&&(c=g);c.tiltAngle=this.description.curvatureDependent.min.tiltAngle;c.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;return c};a.prototype.calculateCurvatureDependentParametersGlobal=function(a,c){void 0===c&&(c=g);var d=
this.description.curvatureDependent;a=1+a.distance/n.earthRadius;var b=[d.min.curvature,d.max.curvature],e=b[0];a=f.clamp((Math.sqrt(a*a-1)-e)/(b[1]-e),0,1);b=[d.min,d.max];d=b[0];b=b[1];c.tiltAngle=f.lerp(d.tiltAngle,b.tiltAngle,a);c.scaleFallOffFactor=f.lerp(d.scaleFallOffFactor,b.scaleFallOffFactor,a);return c};a.prototype.surfaceCoverageCompensationLocal=function(a,c){return(a.fovY-c.tiltAngle)/a.fovY};a.prototype.surfaceCoverageCompensationGlobal=function(a,c){var d=n.earthRadius*n.earthRadius;
c=c.tiltAngle+.5*Math.PI;var b=a.fovY;a=a.distance;a=a*a+d-2*Math.cos(c)*a*n.earthRadius;var e=Math.sqrt(a);return(Math.acos(Math.sqrt(a-d)/e)-Math.asin(n.earthRadius/(e/Math.sin(c)))+.5*b)/b};return a}();b.defaultDescription={curvatureDependent:{min:{curvature:f.deg2rad(10),tiltAngle:f.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:f.deg2rad(70),tiltAngle:f.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0};var a={curvatureDependent:{min:{scaleFallOffFactor:.7},
max:{scaleFallOffFactor:.95}},minPixelSize:14};b.copyParameters=function(a,c){c.camera.distance=a.camera.distance;c.camera.fovY=a.camera.fovY;c.divisor=a.divisor;c.offset=a.offset;c.minPixelSize=a.minPixelSize;return c};var l={scale:0,factor:0,minPixelSize:0,paddingPixels:0},g={tiltAngle:0,scaleFallOffFactor:0}})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterialTexture ../lib/Material ../lib/screenSizePerspectiveUtils ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/HUDPrograms ../../../webgl/renderState".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C){function E(a,c,d){a.setUniform1f("cameraGroundRelative",d.cameraAboveGround?1:-1);a.setUniform1f("polygonOffset",c.shaderPolygonOffset);a.setUniform4fv("viewport",d.viewport);a.setUniform1f("perDistancePixelRatio",Math.tan(d.fovY/2)/(d.viewport[2]/2));z.bindVerticalOffset(c.verticalOffset,d,a);a.setUniformMatrix4fv("viewNormal",d.viewInvTransp);c.screenSizePerspective&&(z.bindScreenSizePerspective(c.screenSizePerspective,a,"screenSizePerspective"),
z.bindScreenSizePerspective(c.screenSizePerspectiveAlignment||c.screenSizePerspective,a,"screenSizePerspectiveAlignment"))}function F(a,c,d,b){d.occlusionTest&&(c.setUniform1i("hudVisibilityTexture",1),a.bindTexture(b.hudVisibilityTexture,1),a.setActiveTexture(0));c.setUniform1f("uRenderTransparentlyOccludedHUD","occluded"===b.renderTransparentlyOccludedHUD?1:"notOccluded"===b.renderTransparentlyOccludedHUD?0:.75);a=b.pixelRatio||1;c.setUniform4fv("overrideColor",d.color);c.setUniform1f("pixelRatio",
a);d.textureIsSignedDistanceField&&(c.setUniform4fv("outlineColor",d.outlineColor),c.setUniform1f("outlineSize",d.outlineSize));d.vvSizeEnabled&&(c.setUniform3fv("vvSizeMinSize",d.vvSizeMinSize),c.setUniform3fv("vvSizeMaxSize",d.vvSizeMaxSize),c.setUniform3fv("vvSizeOffset",d.vvSizeOffset),c.setUniform3fv("vvSizeFactor",d.vvSizeFactor));d.vvColorEnabled&&(c.setUniform1fv("vvColorValues",d.vvColorValues),c.setUniform4fv("vvColorColors",d.vvColorColors));c.setUniform2f("screenOffset",2*d.screenOffset[0]*
a,2*d.screenOffset[1]*a);c.setUniform2fv("anchorPos",H(d))}function H(a,c){void 0===c&&(c=M);if(a.textureIsSignedDistanceField){var d=a.anchorPos;a=a.distanceFieldBoundingBox;var b=c;b[0]=d[0]*(a[2]-a[0])+a[0];b[1]=d[1]*(a[3]-a[1])+a[1]}else p.vec2.copy(c,a.anchorPos);return c}q=function(c){function d(a,d){d=c.call(this,d)||this;d.params=z.copyParameters(a,da);return d}n(d,c);d.prototype.dispose=function(){};d.prototype.setParameterValues=function(a){for(var c in a)"textureId"===c&&x.assert(!!this.params.textureId,
"Can only change texture of material that already has a texture"),this.params[c]=a[c];this.notifyDirty("matChanged")};d.prototype.getParameters=function(){return this.params};d.prototype.intersect=function(a,c,d,b,e,g,f,h,l){l?this.intersectDrapedRenderHudGeometry(a,c,d,b,e,g,f,h):this.intersectHudGeometry(a,c,d,b,e,g,f,h)};d.prototype.intersectDrapedRenderHudGeometry=function(c,d,b,e,g,f,h,l){d=c.getAttribute(x.VertexAttrConstants.POSITION);b=c.getAttribute(x.VertexAttrConstants.SIZE);e=this.params;
g=H(e);var m=1,p=1;l&&(p=l(I),m=p[0],p=p[5]);m*=c.pixelRatio;p*=c.pixelRatio;l=X*c.pixelRatio;for(var k=0;k<d.data.length/d.size;k++){var r=k*d.size;a.vec3.set(O,d.data[r],d.data[r+1],d.data[r+2]);r=k*b.size;W[0]=b.data[r]*m;W[1]=b.data[r+1]*p;var r=O[0],t=O[1],u=void 0;e.textureIsSignedDistanceField&&(u=e.outlineSize*c.pixelRatio/2);this._isInsideIconBoundaries(f,r,t,l,u,e,g)&&h()}};d.prototype.intersectHudGeometry=function(c,d,b,e,g,f,m,p){if(e.enable.selectionMode&&e.enable.hud&&!t.isAllHidden(d.componentVisibilities,
c.componentOffsets)){var r=c.data;c=this.params;g=d=1;k.mat3.fromMat4(R,b);if(p){g=p(I);d=g[0];g=g[5];p=R;f=p[0];var u=p[1],n=p[2],v=p[3],z=p[4],y=p[5],A=p[6],q=p[7],B=p[8],C=1/Math.sqrt(f*f+u*u+n*n),G=1/Math.sqrt(v*v+z*z+y*y),M=1/Math.sqrt(A*A+q*q+B*B);p[0]=f*C;p[1]=u*C;p[2]=n*C;p[3]=v*G;p[4]=z*G;p[5]=y*G;p[6]=A*M;p[7]=q*M;p[8]=B*M}p=r.getVertexAttr()[x.VertexAttrConstants.POSITION];f=r.getVertexAttr()[x.VertexAttrConstants.SIZE];u=r.getVertexAttr()[x.VertexAttrConstants.NORMAL];r=r.getVertexAttr()[x.VertexAttrConstants.AUXPOS1];
x.assert(3<=p.size);n=e.point;v=e.camera;z=H(c);d*=v.pixelRatio;g*=v.pixelRatio;y="screen"===this.params.centerOffsetUnits;for(A=0;A<p.data.length/p.size;A++)q=A*p.size,a.vec3.set(O,p.data[q],p.data[q+1],p.data[q+2]),a.vec3.transformMat4(O,O,b),q=A*f.size,W[0]=f.data[q]*d,W[1]=f.data[q+1]*g,a.vec3.transformMat4(O,O,v.viewMatrix),q=A*r.size,a.vec3.set(U,r.data[q+0],r.data[q+1],r.data[q+2]),y||(O[0]+=U[0],O[1]+=U[1],0!==U[2]&&(q=U[2],a.vec3.normalize(U,O),a.vec3.subtract(O,O,a.vec3.scale(U,U,q)))),
q=A*u.size,a.vec3.set(N,u.data[q],u.data[q+1],u.data[q+2]),this.applyVerticalOffsetTransformation(O,N,R,v,K),v.applyProjection(O,P),-1<P[0]&&(q=Math.floor(P[0])+this.params.screenOffset[0],B=Math.floor(P[1])+this.params.screenOffset[1],y&&(q+=U[0],0!==U[1]&&(B+=w.applyScaleFactor(U[1],K.factorAlignment))),w.applyPrecomputedScaleFactorVec2(W,K.factor,W),C=V*v.pixelRatio,G=void 0,c.textureIsSignedDistanceField&&(G=c.outlineSize*v.pixelRatio/2),this._isInsideIconBoundaries(n,q,B,C,G,c,z)&&(B=e.ray,a.vec3.transformMat4(T,
O,h.mat4.invert(J,v.viewMatrix)),P[0]=n[0],P[1]=n[1],v.unprojectPoint(P,O),q=l.vec3f64.create(),a.vec3.copy(q,B.direction),C=1/a.vec3.length(q),a.vec3.scale(q,q,C),B=a.vec3.distance(B.origin,O)*C,m(B,q,-1,1,!0,T)))}};d.prototype._isInsideIconBoundaries=function(a,c,d,b,e,g,f){c=c-b-(0<f[0]?W[0]*f[0]:0);var h=c+W[0]+2*b;d=d-b-(0<f[1]?W[1]*f[1]:0);b=d+W[1]+2*b;g.textureIsSignedDistanceField&&(g=g.distanceFieldBoundingBox,c+=W[0]*g[0],d+=W[1]*g[1],h-=W[0]*(1-g[2]),b-=W[1]*(1-g[3]),c-=e,h+=e,d-=e,b+=
e);return a[0]>c&&a[0]<h&&a[1]>d&&a[1]<b};d.prototype.createBufferWriter=function(){return new aa(this)};d.prototype.createRenderer=function(a,c){return new A(a,c,this)};d.prototype.normalAndViewAngle=function(c,d,b,e){void 0===e&&(e=Q);a.vec3.transformMat3(e.normal,c,d);a.vec3.transformMat4(e.normal,e.normal,b.viewInverseTransposeMatrix);e.cosAngle=a.vec3.dot(L,ca);return e};d.prototype.updateScaleInfo=function(a,c,d){c=this.params;c.screenSizePerspective?a.factor=w.precomputeScaleFactor(Q.cosAngle,
d,c.screenSizePerspective,a.factor):(a.factor.scale=1,a.factor.factor=0,a.factor.minPixelSize=0,a.factor.paddingPixels=0);c.screenSizePerspectiveAlignment?a.factorAlignment=w.precomputeScaleFactor(Q.cosAngle,d,c.screenSizePerspectiveAlignment,a.factorAlignment):(a.factorAlignment.factor=a.factor.factor,a.factorAlignment.scale=a.factor.scale,a.factorAlignment.minPixelSize=a.factor.minPixelSize,a.factorAlignment.paddingPixels=a.factor.paddingPixels)};d.prototype.applyVerticalOffsetTransformation=function(c,
d,b,e,f,h){var l=this.params;g.isMat4(b)&&(b=k.mat3.fromMat4(R,b));if(!l.verticalOffset||!l.verticalOffset.screenLength)return f&&(l.screenSizePerspective||l.screenSizePerspectiveAlignment)?(e=this.normalAndViewAngle(d,b,e),l=a.vec3.length(c),this.updateScaleInfo(f,e.cosAngle,l)):f&&(f.factor.scale=1,f.factorAlignment.scale=1),h?a.vec3.copy(h,c):c;d=this.normalAndViewAngle(d,b,e);b=a.vec3.length(c);e=z.verticalOffsetAtDistance(e,b,l.verticalOffset,d.cosAngle,l.screenSizePerspectiveAlignment||l.screenSizePerspective);
f&&this.updateScaleInfo(f,d.cosAngle,b);return a.vec3.add(h||c,c,a.vec3.scale(d.normal,d.normal,e))};d.prototype.getGLMaterials=function(){return{color:D,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:G}};d.prototype.getAllTextureIds=function(){return[this.params.textureId]};d.prototype.calculateRelativeScreenBounds=function(a,c,d){void 0===d&&(d=e.create());var b=this.params,g=d;void 0===g&&(g=M);p.vec2.copy(g,b.anchorPos);g[0]*=-a[0];g[1]*=-a[1];g[0]+=b.screenOffset[0]*c;g[1]+=b.screenOffset[1]*
c;d[2]=d[0]+a[0];d[3]=d[1]+a[1];return d};d.prototype.calculateAnchorPosForRendering=function(a){return H(this.params,a)};d.shouldRenderVisibilityDuringRenderPass=function(a){return 0===a||4};return d}(y);var D=function(a){function c(c,d,b){c=a.call(this,c,d,b,c.getParameters().textureId)||this;c.isOcclusionSlot=!1;c.updateParameters();return c}n(c,a);c.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?16:15};c.prototype.selectProgram=function(){var a=this.params;this.occlusionProgram=
this.programRep.getProgram(B.occlusionPass,{verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,slice:a.slicePlaneEnabled});this.renderProgram=this.programRep.getProgram(B.colorPass,{occlTest:a.occlusionTest,sdf:a.textureIsSignedDistanceField,vvSize:!!a.vvSizeEnabled,vvColor:!!a.vvColorEnabled,verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,
debugDrawBorder:!!a.debugDrawBorder,slice:a.slicePlaneEnabled});this.renderPipelineState=C.makePipelineState({blending:C.simpleBlendingParams(1,771),polygonOffset:a.polygonOffset&&S,depthTest:{func:515},depthWrite:C.defaultDepthWriteParams,colorWrite:C.defaultColorWriteParams});this.occlusionPipelineState=C.makePipelineState({depthTest:{func:515},depthWrite:C.defaultDepthWriteParams,colorWrite:C.defaultColorWriteParams})};c.prototype.beginSlot=function(a){if(this.params.occlusionTest)return this.isOcclusionSlot=
10===a,10===a||a===this.mainSlot;this.isOcclusionSlot=!1;return a===this.mainSlot};c.prototype.getProgram=function(){return this.isOcclusionSlot?this.occlusionProgram:this.renderProgram};c.prototype.getPrograms=function(){return[this.occlusionProgram,this.renderProgram]};c.prototype.updateParameters=function(){this.params=z.copyParameters(this.material.getParameters());this.updateTexture(this.params.textureId);this.selectProgram();this.selectSlot()};c.prototype.bind=function(a,c){if(this.isOcclusionSlot){var d=
this.occlusionProgram;a.bindProgram(d);a.setPipelineState(this.occlusionPipelineState);E(d,this.params,c);d.setUniform4f("color",1,1,1,1);d.setUniform1f("pixelRatio",c.pixelRatio||1)}else d=this.renderProgram,a.bindProgram(d),a.setPipelineState(this.renderPipelineState),this.bindTexture(a,d),this.bindTextureScale(a,d),E(d,this.params,c),F(a,d,this.params,c)};c.prototype.bindView=function(a,c){a=c.origin;var d=this.getProgram();z.bindView(a,c.view,d);z.bindCamPos(a,c.viewInvTransp,d);this.params.slicePlaneEnabled&&
z.bindSlicePlane(c.origin,c.slicePlane,d)};c.prototype.bindInstance=function(a,c){a=this.getProgram();a.setUniformMatrix4fv("model",c.transformation);a.setUniformMatrix4fv("modelNormal",c.transformationNormal)};c.prototype.release=function(a){};c.prototype.getDrawMode=function(){return this.isOcclusionSlot?0:4};return c}(r),G=function(a){function c(c,d,b){c=a.call(this,c,d,b,c.getParameters().textureId)||this;c.updateParameters();return c}n(c,a);c.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?
16:15};c.prototype.beginSlot=function(a){return a===this.mainSlot};c.prototype.getProgram=function(){return this.program};c.prototype.updateParameters=function(){this.params=z.copyParameters(this.material.getParameters());this.updateTexture(this.params.textureId);this.selectProgram();this.selectSlot()};c.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(B.highlightPass,{occlTest:a.occlusionTest,sdf:a.textureIsSignedDistanceField,vvSize:!!a.vvSizeEnabled,
vvColor:!!a.vvColorEnabled,verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,binaryHighlightOcclusion:a.binaryHighlightOcclusion,slice:a.slicePlaneEnabled});this.pipelineState=C.makePipelineState({blending:C.separateBlendingParams(1,1,771,771),polygonOffset:a.polygonOffset&&S,depthTest:{func:513},colorWrite:C.defaultColorWriteParams})};c.prototype.bind=function(a,c){var d=this.program;a.bindProgram(d);a.setPipelineState(this.pipelineState);
this.bindTexture(a,d);this.bindTextureScale(a,d);E(d,this.params,c);F(a,d,this.params,c);z.bindHighlightRendering(a,c,this.program)};c.prototype.bindView=function(a,c){a=c.origin;var d=this.getProgram();z.bindView(a,c.view,d);z.bindCamPos(a,c.viewInvTransp,d);this.params.slicePlaneEnabled&&z.bindSlicePlane(c.origin,c.slicePlane,d)};c.prototype.bindInstance=function(a,c){a=this.getProgram();a.setUniformMatrix4fv("model",c.transformation);a.setUniformMatrix4fv("modelNormal",c.transformationNormal)};
c.prototype.release=function(a){};c.prototype.getDrawMode=function(){return 4};return c}(r),K={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},M=c.vec2f64.create(),O=l.vec3f64.create(),N=l.vec3f64.create(),P=f.createRenderScreenPointArray3(),L=l.vec3f64.create(),T=l.vec3f64.create(),R=d.mat3f64.create(),J=m.mat4f64.create(),U=l.vec3f64.create(),Q={normal:L,cosAngle:0},I=m.mat4f64.create();h.mat4.identity(I);var V=1,X=2,W=
[0,0],ca=l.vec3f64.fromValues(0,0,1),da={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,
screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:c.vec2f64.fromValues(.5,.5),shaderPolygonOffset:1E-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1},ba=u.newLayout().vec3f(x.VertexAttrConstants.POSITION).vec3f(x.VertexAttrConstants.NORMAL).vec2f(x.VertexAttrConstants.UV0).vec4u8(x.VertexAttrConstants.COLOR).vec2f(x.VertexAttrConstants.SIZE).vec4f(x.VertexAttrConstants.AUXPOS1).vec4f(x.VertexAttrConstants.AUXPOS2),aa=function(){function a(a){this.material=
a;this.vertexBufferLayout=ba}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return 6*a.indices[x.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,c,d,b,e){v.writePosition(c.indices[x.VertexAttrConstants.POSITION],c.vertexAttr[x.VertexAttrConstants.POSITION].data,a.transformation,b.position,e,6);v.writeNormal(c.indices[x.VertexAttrConstants.NORMAL],c.vertexAttr[x.VertexAttrConstants.NORMAL].data,a.invTranspTransformation,
b.normal,e,6);a=c.vertexAttr[x.VertexAttrConstants.UV0].data;var g=void 0,f=void 0,h=void 0,l=void 0;null==a||4>a.length?(a=this.material.getParameters(),f=g=0,h=a.texCoordScale[0],l=a.texCoordScale[1]):(g=a[0],f=a[1],h=a[2],l=a[3]);var h=Math.min(1.99999,h+1),l=Math.min(1.99999,l+1),m=c.indices[x.VertexAttrConstants.POSITION].length,p=b.uv0;a=e;for(d=0;d<m;++d)p.set(a,0,g),p.set(a,1,f),a+=1,p.set(a,0,h),p.set(a,1,f),a+=1,p.set(a,0,h),p.set(a,1,l),a+=1,p.set(a,0,h),p.set(a,1,l),a+=1,p.set(a,0,g),
p.set(a,1,l),a+=1,p.set(a,0,g),p.set(a,1,f),a+=1;v.writeColor(c.indices[x.VertexAttrConstants.COLOR],c.vertexAttr[x.VertexAttrConstants.COLOR].data,4,b.color,e,6);g=c.indices[x.VertexAttrConstants.SIZE];f=c.vertexAttr[x.VertexAttrConstants.SIZE].data;h=g.length;l=b.size;a=e;for(d=0;d<h;++d)for(var m=f[2*g[d]],p=f[2*g[d]+1],k=0;6>k;++k)l.set(a,0,m),l.set(a,1,p),a+=1;c.indices[x.VertexAttrConstants.AUXPOS1]&&c.vertexAttr[x.VertexAttrConstants.AUXPOS1]&&v.writeBufferVec4(c.indices[x.VertexAttrConstants.AUXPOS1],
c.vertexAttr[x.VertexAttrConstants.AUXPOS1].data,b.auxpos1,e,6);c.indices[x.VertexAttrConstants.AUXPOS2]&&c.vertexAttr[x.VertexAttrConstants.AUXPOS2]&&v.writeBufferVec4(c.indices[x.VertexAttrConstants.AUXPOS2],c.vertexAttr[x.VertexAttrConstants.AUXPOS2].data,b.auxpos2,e,6)};return a}(),S={factor:0,units:-4};return q})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["require","exports"],function(q,b){function n(b){return b instanceof Float32Array&&16<=b.length}function f(b){return Array.isArray(b)&&
16<=b.length}Object.defineProperty(b,"__esModule",{value:!0});b.isMat4f32=n;b.isMat4f64=f;b.isMat4=function(b){return n(b)||f(b)}})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./DefaultTextureUnits ./GLMaterial ../materials/internal/MaterialUtil".split(" "),function(q,b,n,f,k,d){return function(b){function h(f,c,a,h,g,e){void 0===e&&(e=!1);f=b.call(this,f,c)||this;f.textureRep=a;f.textureId=h;f.initTransparent=e;f.glTextureRef=
d.aquireIfNotUndefined(f.textureId,a,f.initTransparent);g&&(f.glTextureRefNormal=d.aquireIfNotUndefined(g,a,f.initTransparent));return f}n(h,b);h.prototype.dispose=function(){d.releaseIfNotUndefined(this.textureId,this.textureRep)};h.prototype.updateTexture=function(b){b!==this.textureId&&(d.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=b,this.glTextureRef=d.aquireIfNotUndefined(this.textureId,this.textureRep,this.initTransparent))};h.prototype.bindTexture=function(d,c){null!=
this.glTextureRef&&(c.setUniform1i("tex",f.DefaultTextureUnits.DIFFUSE),d.bindTexture(this.glTextureRef.getGLTexture(),f.DefaultTextureUnits.DIFFUSE),this.glTextureRefNormal&&(c.setUniform1i("texNormal",f.DefaultTextureUnits.NORMAL),d.bindTexture(this.glTextureRefNormal.getGLTexture(),f.DefaultTextureUnits.NORMAL)))};h.prototype.bindTextureSize=function(d,c){null!=this.glTextureRef&&(d=this.glTextureRef.getGLTexture(),c.setUniform2f("texSize",d.descriptor.width,d.descriptor.height))};h.prototype.bindTextureScale=
function(d,c){(d=this.glTextureRef&&this.glTextureRef.getGLTexture())&&d.descriptor.textureCoordinateScaleFactor?c.setUniform2fv("textureCoordinateScaleFactor",d.descriptor.textureCoordinateScaleFactor):c.setUniform2f("textureCoordinateScaleFactor",1,1)};return h}(k)})},"esri/views/3d/webgl-engine/lib/DefaultTextureUnits":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.DefaultTextureUnits={DIFFUSE:0,COMPONENT_COLOR:1,NORMAL:2}})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["require",
"exports","../../../../core/tsSupport/extendsHelper","./ManagingDisposable"],function(q,b,n,f){return function(b){function d(d,f){var h=b.call(this)||this;h.material=d;h.programRep=f;return h}n(d,b);d.prototype.isVisible=function(){return this.material.isVisible()};d.prototype.isVisibleInPass=function(d){return this.material.isVisibleInPass(d)};d.prototype.getPrograms=function(){return[this.getProgram()]};d.prototype.getDrawMode=function(){return 4};d.prototype.release=function(d,b){};return d}(f.ManagingDisposable)})},
"esri/views/3d/webgl-engine/lib/ManagingDisposable":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(){}b.prototype.dispose=function(){var b=this;(this.__proto__.__managedDisposables__||[]).forEach(function(f){b[f]&&(b[f].dispose(),b[f]=void 0)})};return b}();b.ManagingDisposable=q;b.manageDisposal=function(){return function(b,f){b.__managedDisposables__=b.__managedDisposables__||[];b.__managedDisposables__.push(f)}}})},
"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f32 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4 ../../../../../geometry/support/aaBoundingBox ../../../support/mathUtils ../../lib/ComponentUtils ../../lib/doublePrecisionUtils ../../lib/screenSizePerspectiveUtils ../../lib/Util".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e){function u(a,c,d,b,e){var g=y(c,d,C);p.setMin(A,a.getBBMin());p.setMax(A,a.getBBMax());if(w(A,c,g,b)){var g=a.getPrimitiveIndices(),f=a.getIndices(),h=a.getPosition(),l=g?g.length:f.length/3;if(l>N&&(a=a.getChildren(),void 0!==a)){for(g=0;8>g;++g)void 0!==a[g]&&u(a[g],c,d,b,e);return}t(c,d,0,l,f,h,g,e)}}function t(a,c,d,b,e,g,f,h){if(f){var l=g.data,m=g.offsetIdx;g=g.strideIdx;var p=a[0],k=a[1];a=a[2];var t=c[0]-p,u=c[1]-k;for(c=c[2]-a;d<b;++d){var n=f[d],x=3*
n,v=m+g*e[x++],z=l[v++],y=l[v++],w=l[v],v=m+g*e[x++],A=l[v++],q=l[v++],B=l[v],v=m+g*e[x],x=l[v++],C=l[v++],A=A-z,q=q-y,B=B-w,x=x-z,C=C-y,v=l[v]-w,G=u*v-C*c,M=c*x-v*t,K=t*C-x*u,D=A*G+q*M+B*K;if(!(Math.abs(D)<=E)){z=p-z;y=k-y;w=a-w;G=z*G+y*M+w*K;if(0<D){if(0>G||G>D)continue}else if(0<G||G<D)continue;M=y*B-q*w;w=w*A-B*z;y=z*q-A*y;z=t*M+u*w+c*y;if(0<D){if(0>z||G+z>D)continue}else if(0<z||G+z<D)continue;w=(x*M+C*w+v*y)/D;0<=w&&(A=r(A,q,B,x,C,v,F),h(w,A,n))}}}else for(f=g.data,l=g.offsetIdx,m=g.strideIdx,
g=a[0],p=a[1],k=a[2],a=c[0]-g,t=c[1]-p,u=c[2]-k,c=d,d*=3;c<b;++c)if(C=l+m*e[d++],D=f[C++],y=f[C++],w=f[C],C=l+m*e[d++],n=f[C++],A=f[C++],q=f[C],C=l+m*e[d++],B=f[C++],x=f[C++],n-=D,A-=y,q-=w,B-=D,x-=y,C=f[C]-w,z=t*C-x*u,G=u*B-C*a,M=a*x-B*t,v=n*z+A*G+q*M,!(Math.abs(v)<=E)){D=g-D;y=p-y;w=k-w;z=D*z+y*G+w*M;if(0<v){if(0>z||z>v)continue}else if(0<z||z<v)continue;G=y*q-A*w;w=w*n-q*D;y=D*A-n*y;D=a*G+t*w+u*y;if(0<v){if(0>D||z+D>v)continue}else if(0<D||z+D<v)continue;w=(B*G+x*w+C*y)/v;0<=w&&(n=r(n,A,q,B,x,
C,F),h(w,n,c))}}function r(a,c,b,e,g,f,h){d.vec3.set(H,a,c,b);d.vec3.set(D,e,g,f);d.vec3.cross(h,H,D);d.vec3.normalize(h,h);return h}function y(a,c,b){return d.vec3.set(b,1/(c[0]-a[0]),1/(c[1]-a[1]),1/(c[2]-a[2]))}function w(a,c,d,b){var e=(a[0]-b-c[0])*d[0],g=(a[3]+b-c[0])*d[0],f=Math.min(e,g),e=Math.max(e,g),g=(a[1]-b-c[1])*d[1],h=(a[4]+b-c[1])*d[1],f=Math.max(f,Math.min(g,h)),e=Math.min(e,Math.max(g,h));if(f>e)return!1;g=(a[2]-b-c[2])*d[2];a=(a[5]+b-c[2])*d[2];f=Math.max(f,Math.min(g,a));e=Math.min(e,
Math.max(g,a));return f<=e}function x(a,c){c=c?x(c):{};for(var d in a){var b=a[d];b&&b.forEach&&(b=v(b));null==b&&d in c||(c[d]=b)}return c}function v(a){var c=[];a.forEach(function(a){return c.push(a)});return c}Object.defineProperty(b,"__esModule",{value:!0});var z=k.mat4f64.create(),A=p.create(),B=e.VertexAttrConstants;b.IDENTITY=k.mat4f64.create();b.intersectTriangleGeometry=function(c,d,b,g,f,h,l,m){d=d&&d.componentVisibilities;g=g.tolerance;if(1<c.componentCount)a:{b=y(f,h,C);m=c.componentCount;
var k=c.componentOffsets,r=c.getIndices(B.POSITION),n=c.getAttribute(B.POSITION),x=c.boundingInfo;if(x&&(p.setMin(A,x.getBBMin()),p.setMax(A,x.getBBMax()),!w(A,f,b,g)))break a;for(x=0;x<m;x++)if(!d||a.getVisibility(d,x)){if(c.getComponentAABB){var v=c.getComponentAABB(x,A);if(!w(v,f,b,g))continue}t(f,h,k[x]/3,k[x+1]/3,r,n,void 0,l)}}else if(!d||a.getVisibility(d,0))c.boundingInfo?(e.assert("triangle"===c.data.primitiveType),u(c.boundingInfo,f,h,g,l)):(d=c.getIndices(B.POSITION),c=c.getAttribute(B.POSITION),
t(f,h,0,d.length/3,d,c,void 0,l))};var C=h.vec3f64.create(),E=Math.pow(2,-52),F=h.vec3f64.create();b.intersectTriangles=t;var H=h.vec3f64.create(),D=h.vec3f64.create();b.computeNormal=r;b.intersectAabbInvDir=w;b.transformToWorld=function(a,c,d){return m.vec4.set(d,a[0]-c[0],a[1]-c[1],a[2]-c[2],1)};b.transformToView=function(a,c,d,b){n.mat4.translate(z,d,c);d=z;return m.vec4.transformMat4(b,a,d)};b.transformToProjection=function(a,c,d,b){b[0]=a[0]+d[0];b[1]=a[1]+d[1];b[2]=a[2]+d[2];b[3]=a[3];return m.vec4.transformMat4(b,
b,c)};b.transformToNDC=function(a,c){return m.vec4.scale(c,a,1/Math.abs(a[3]))};b.applyScreenSizePerspectiveScale=function(a,c,d,b,e){return g.scale(a,b,d,e)};b.verticalOffsetAtDistance=function(a,d,b,e,f){var h=(b.screenLength||0)*a.pixelRatio;f&&(h=g.scale(h,e,d,f));return c.clamp(h*Math.tan(.5*a.fovY)/(.5*a.fullHeight)*d,b.minWorldLength||0,null!=b.maxWorldLength?b.maxWorldLength:Infinity)};b.aquireIfNotUndefined=function(a,c,d){if(void 0!==a)return c.aquire(a,d)};b.releaseIfNotUndefined=function(a,
c){void 0!==a&&c.release(a)};var G=f.mat4f32.create();b.bindView=function(a,c,d){n.mat4.translate(G,c,a);d.setUniform3fv("localOrigin",a);d.setUniformMatrix4fv("view",G)};b.bindCamPos=function(a,c,d){d.setUniform3f("camPos",c[3]-a[0],c[7]-a[1],c[11]-a[2])};var K=h.vec3f64.create(),M=h.vec3f64.create();b.bindViewOriginDouble=function(a,c){l.encodeDoubleArraySplit(a,K,M,3);c.setUniform3fv("viewOriginHi",K);c.setUniform3fv("viewOriginLo",M)};var O=h.vec3f64.create();b.bindSlicePlane=function(a,c,b){d.vec3.subtract(O,
c.origin,a);b.setUniform3fv("slicePlaneOrigin",O);b.setUniform3fv("slicePlaneBasis1",c.basis1);b.setUniform3fv("slicePlaneBasis2",c.basis2)};b.bindVerticalOffset=function(a,c,d){if(a){var b=c.fovY,e=c.viewport[3],g=void 0;void 0===g&&(g=P);g.screenLength=a.screenLength;g.perDistance=Math.tan(.5*b)/(.5*e);g.minWorldLength=a.minWorldLength;g.maxWorldLength=a.maxWorldLength;a=g;d.setUniform4f("verticalOffset",a.screenLength*(c.pixelRatio||1),a.perDistance,a.minWorldLength,a.maxWorldLength)}};b.bindHighlightRendering=
function(a,c,d){a.bindTexture(c.highlightDepthTexture,5);d.setUniform1i("depthTex",5);d.setUniform4f("highlightViewportPixelSz",0,0,1/c.viewport[2],1/c.viewport[3])};b.bindScreenSizePerspective=function(a,c,d){void 0===d&&(d="screenSizePerspectiveAlignment");if(a){var b=a.parameters;c.setUniform4f(d,b.divisor,b.offset,b.minPixelSize,a.paddingPixelsOverride)}};b.copyParameters=x;b.updateParameters=function(a,c){var d=!1,b;for(b in c){var e=c[b];void 0!==e&&(d=!0,Array.isArray(e)?a[b]=e.slice():a[b]=
e)}return d};(function(a){function c(a){return(a.shadowMappingEnabled?1:0)|(a.ssaoEnabled?2:0)}a.create=function(a,d){for(var b=[],e=0;2>e;e++)for(var g=0;2>g;g++){var f=c({shadowMappingEnabled:1===e,ssaoEnabled:1===g}),h=c({shadowMappingEnabled:1===e,ssaoEnabled:1===g&&a.receiveSSAO});b[f]=b[h]||d({receiveShadows:1===e,receiveSSAO:1===g&&a.receiveSSAO})}return{programs:b.filter(function(a){return null!=a}),byParameter:b}};a.lookup=function(a,d){return a.byParameter[c(d)]};a.programs=function(a){return a.programs}})(b.BindParametersMap||
(b.BindParametersMap={}));b.intersectDrapedRenderLineGeometry=function(a,d,b,e,g,f,h,l,m){if(e.enable.selectionMode){d=a.getAttribute(B.POSITION).data;e=a.getAttribute(B.SIZE);b=f[0];f=f[1];a=(((e&&e.data[0])+h)/2+4)*a.pixelRatio;h=Number.MAX_VALUE;for(e=0;e<d.length-5;e+=3){var p=d[e],k=d[e+1];m=b-p;g=f-k;var p=d[e+3]-p,k=d[e+4]-k,r=c.clamp((p*m+k*g)/(p*p+k*k),0,1);m=p*r-m;g=k*r-g;g=m*m+g*g;g<h&&(h=g)}h<a*a&&l()}};b.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var N=1E3,P={screenLength:0,
perDistance:0,minWorldLength:0,maxWorldLength:0}})},"esri/core/libs/gl-matrix-2/mat4f32":function(){define(["require","exports","./factories/mat4f32"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.mat4f32=n})},"esri/core/libs/gl-matrix-2/factories/mat4f32":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var b=new Float32Array(16);b[0]=1;b[5]=1;b[10]=1;b[15]=1;return b};b.clone=function(b){var f=new Float32Array(16);
f[0]=b[0];f[1]=b[1];f[2]=b[2];f[3]=b[3];f[4]=b[4];f[5]=b[5];f[6]=b[6];f[7]=b[7];f[8]=b[8];f[9]=b[9];f[10]=b[10];f[11]=b[11];f[12]=b[12];f[13]=b[13];f[14]=b[14];f[15]=b[15];return f};b.fromValues=function(b,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y){var n=new Float32Array(16);n[0]=b;n[1]=f;n[2]=k;n[3]=d;n[4]=h;n[5]=m;n[6]=p;n[7]=c;n[8]=a;n[9]=l;n[10]=g;n[11]=e;n[12]=u;n[13]=t;n[14]=r;n[15]=y;return n};b.createView=function(b,f){return new Float32Array(b,f,16)}})},"esri/views/3d/webgl-engine/lib/doublePrecisionUtils":function(){define(["require",
"exports"],function(q,b){function n(d,b,f){for(var h=0;h<f;++h)b[2*h]=d[h],b[2*h+1]=d[h]-b[2*h]}Object.defineProperty(b,"__esModule",{value:!0});b.encodeDouble=function(d,b){k[0]=d;k[1]=d-k[0];b[0]=k[0];b[1]=k[1]};b.encodeDoubleArray=n;b.decodeDoubleArray=function(d,b,f){for(var h=0;h<f;++h)b[h]=d[2*h]+d[2*h+1]};b.encodeDoubleArraySplit=function(d,b,m,p){for(var c=0;c<p;++c)f[0]=d[c],n(f,k,1),b[c]=k[0],m[c]=k[1]};var f=new Float64Array(1),k=new Float32Array(2)})},"esri/views/3d/webgl-engine/lib/Material":function(){define(["require",
"exports","./IdGen","./ModelContentType"],function(q,b,n,f){return function(){function b(d){this.supportsEdges=!1;this._parentStage=null;this._visible=!0;this._renderOccluded=1;this._renderPriority=0;this.id=b._idGen.gen(d)}Object.defineProperty(b.prototype,"parentStage",{get:function(){return this._parentStage},enumerable:!0,configurable:!0});b.prototype.addParentStage=function(d){this._parentStage=d};b.prototype.removeParentStage=function(d){this._parentStage=null};Object.defineProperty(b.prototype,
"visible",{get:function(){return this._visible},set:function(d){d!==this._visible&&(this._visible=d,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(d){d!==this._renderOccluded&&(this._renderOccluded=d,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(d){d!==
this._renderPriority&&(this._renderPriority=d,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});b.prototype.isVisibleInPass=function(d){return!0};b.prototype.isVisible=function(){return this._visible};b.prototype.notifyDirty=function(d){this.parentStage&&this.parentStage.notifyDirty(f.MATERIAL,this,d)};b._idGen=new n;return b}()})},"esri/views/3d/webgl-engine/materials/internal/bufferWriters":function(){define(["require","exports","../../../support/buffer/BufferView","../../lib/Util"],
function(q,b,n,f){function k(a,c,d,b,f){var e=d.typedBuffer;d=d.typedBufferStride;var g=a.length;b*=d;if(null==f||1===f)for(var h=0;h<g;++h){var l=2*a[h];e[b]=c[l];e[b+1]=c[l+1];b+=d}else for(h=0;h<g;++h)for(var l=2*a[h],m=0;m<f;++m)e[b]=c[l],e[b+1]=c[l+1],b+=d}function d(a,c,d,b,f){var e=d.typedBuffer;d=d.typedBufferStride;var g=a.length;b*=d;if(null==f||1===f)for(var h=0;h<g;++h){var l=3*a[h];e[b]=c[l];e[b+1]=c[l+1];e[b+2]=c[l+2];b+=d}else for(h=0;h<g;++h)for(var l=3*a[h],m=0;m<f;++m)e[b]=c[l],
e[b+1]=c[l+1],e[b+2]=c[l+2],b+=d}function h(a,c,d,b,f){var e=d.typedBuffer;d=d.typedBufferStride;var g=a.length;b*=d;if(null==f||1===f)for(var h=0;h<g;++h){var l=4*a[h];e[b]=c[l];e[b+1]=c[l+1];e[b+2]=c[l+2];e[b+3]=c[l+3];b+=d}else for(h=0;h<g;++h)for(var l=4*a[h],m=0;m<f;++m)e[b]=c[l],e[b+1]=c[l+1],e[b+2]=c[l+2],e[b+3]=c[l+3],b+=d}function m(a,c,b,f,h,m){if(b){var e=f.typedBuffer;f=f.typedBufferStride;var g=a.length;h*=f;if(null==m||1===m)for(var l=0;l<g;++l){var p=3*a[l],k=c[p],r=c[p+1],t=c[p+2];
e[h]=b[0]*k+b[4]*r+b[8]*t+b[12];e[h+1]=b[1]*k+b[5]*r+b[9]*t+b[13];e[h+2]=b[2]*k+b[6]*r+b[10]*t+b[14];h+=f}else for(l=0;l<g;++l)for(var p=3*a[l],k=c[p],r=c[p+1],t=c[p+2],p=b[0]*k+b[4]*r+b[8]*t+b[12],u=b[1]*k+b[5]*r+b[9]*t+b[13],k=b[2]*k+b[6]*r+b[10]*t+b[14],r=0;r<m;++r)e[h]=p,e[h+1]=u,e[h+2]=k,h+=f}else d(a,c,f,h,m)}function p(a,c,b,f,h,m){if(b){var e=f.typedBuffer;f=f.typedBufferStride;var g=a.length;h*=f;if(null==m||1===m)for(var l=0;l<g;++l){var p=3*a[l],k=c[p],r=c[p+1],t=c[p+2];e[h]=b[0]*k+b[4]*
r+b[8]*t;e[h+1]=b[1]*k+b[5]*r+b[9]*t;e[h+2]=b[2]*k+b[6]*r+b[10]*t;h+=f}else for(l=0;l<g;++l)for(var p=3*a[l],k=c[p],r=c[p+1],t=c[p+2],p=b[0]*k+b[4]*r+b[8]*t,u=b[1]*k+b[5]*r+b[9]*t,k=b[2]*k+b[6]*r+b[10]*t,r=0;r<m;++r)e[h]=p,e[h+1]=u,e[h+2]=k,h+=f}else d(a,c,f,h,m)}function c(a,c,d,b,f,h){var e=b.typedBuffer;b=b.typedBufferStride;var g=a.length;f*=b;if(null==h||1===h)if(4===d)for(d=0;d<g;++d){var l=4*a[d];e[f]=c[l];e[f+1]=c[l+1];e[f+2]=c[l+2];e[f+3]=c[l+3];f+=b}else{if(3===d)for(d=0;d<g;++d)l=3*a[d],
e[f]=c[l],e[f+1]=c[l+1],e[f+2]=c[l+2],e[f+3]=255,f+=b}else if(4===d)for(d=0;d<g;++d)for(var l=4*a[d],m=0;m<h;++m)e[f]=c[l],e[f+1]=c[l+1],e[f+2]=c[l+2],e[f+3]=c[l+3],f+=b;else if(3===d)for(d=0;d<g;++d)for(l=3*a[d],m=0;m<h;++m)e[f]=c[l],e[f+1]=c[l+1],e[f+2]=c[l+2],e[f+3]=255,f+=b}function a(a,c,d,b,f,h,m){var e=f.typedBuffer;f=f.typedBufferStride;var g=a.length;h*=f;if(null==m||1===m)if(4===d)for(d=0;d<g;++d){var l=4*a[d];e[h]=c[l]*b[0];e[h+1]=c[l+1]*b[1];e[h+2]=c[l+2]*b[2];e[h+3]=c[l+3]*b[3];h+=f}else{if(3===
d){var p=255*b[3];for(d=0;d<g;++d)l=3*a[d],e[h]=c[l]*b[0],e[h+1]=c[l+1]*b[1],e[h+2]=c[l+2]*b[2],e[h+3]=p,h+=f}}else if(4===d)for(d=0;d<g;++d)for(var l=4*a[d],k=0;k<m;++k)e[h]=c[l]*b[0],e[h+1]=c[l+1]*b[1],e[h+2]=c[l+2]*b[2],e[h+3]=c[l+3]*b[3],h+=f;else if(3===d)for(p=255*b[3],d=0;d<g;++d)for(l=3*a[d],k=0;k<m;++k)e[h]=c[l]*b[0],e[h+1]=c[l+1]*b[1],e[h+2]=c[l+2]*b[2],e[h+3]=p,h+=f}Object.defineProperty(b,"__esModule",{value:!0});b.writeBufferVec2=k;b.writeBufferVec3=d;b.writeBufferVec4=h;b.writePosition=
m;b.writeNormal=p;b.writeColor=c;b.writeMultipliedColor=a;b.writeDefaultAttributes=function(d,b,e,u,t,r,y){var g=0;for(e=e.fieldNames;g<e.length;g++){var l=e[g],v=d.vertexAttr[l],z=d.indices[l];if(v&&z)switch(l){case f.VertexAttrConstants.POSITION:f.assert(3===v.size);(l=r.getField(l,n.BufferViewVec3f))&&m(z,v.data,u,l,y);break;case f.VertexAttrConstants.NORMAL:f.assert(3===v.size);(l=r.getField(l,n.BufferViewVec3f))&&p(z,v.data,t,l,y);break;case f.VertexAttrConstants.UV0:f.assert(2===v.size);(l=
r.getField(l,n.BufferViewVec2f))&&k(z,v.data,l,y);break;case f.VertexAttrConstants.REGION:f.assert(4===v.size);(l=r.getField(l,n.BufferViewVec4u16))&&h(z,v.data,l,y);break;case f.VertexAttrConstants.COLOR:f.assert(3===v.size||4===v.size);(l=r.getField(l,n.BufferViewVec4u8))&&(b&&b.color?a(z,v.data,v.size,b.color,l,y):c(z,v.data,v.size,l,y));break;case f.VertexAttrConstants.SYMBOLCOLOR:f.assert(3===v.size||4===v.size);(l=r.getField(l,n.BufferViewVec4u8))&&c(z,v.data,v.size,l,y);break;case f.VertexAttrConstants.TANGENT:f.assert(4===
v.size),(l=r.getField(l,n.BufferViewVec4f))&&h(z,v.data,l,y)}}}})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../support/buffer/glUtil ../../lib/DefaultVertexAttributeLocations ../../lib/Float32ArrayList ../../lib/IntervalUtilities ../../lib/Util ./Instance ./utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e){function u(a,c,d,b){for(var e=new Map,f=c.vertexBufferLayout.stride/4,g=function(d,b){var g=d.origin,h=a.get(g.id),l=e.get(g.id);null==l&&(l={optimalCount:null==h?0:h.optimalCount,sparseCount:null==h?0:h.buffer.getSize(),toAdd:[],toRemove:[],origin:g.vec3},e.set(g.id,l));g=c.elementCount(d.data)*f;b?(l.optimalCount+=g,l.sparseCount+=g,l.toAdd.push(d)):(l.optimalCount-=g,l.toRemove.push(d))},h=0;h<d.length;h++){var l=d[h];g(l,!0)}for(d=0;d<b.length;d++)l=b[d],
g(l,!1);return e}q=function(){function b(c,d,b){this._dataByOrigin=new Map;this._highlightCount=0;this._rctx=c;this._material=b;this._materialRep=d;this._glMaterials=a.acquireMaterials(this._material,this._materialRep);this._bufferWriter=b.createBufferWriter()}b.prototype.dispose=function(){a.releaseMaterials(this._material,this._materialRep)};Object.defineProperty(b.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"hasHighlights",{get:function(){return 0<this._highlightCount},enumerable:!0,configurable:!0});b.prototype.renderPriority=function(){return this._material.renderPriority};b.prototype.modify=function(a){var c=this,d=v;d.clear();this.updateGeometries(a.toUpdate,d);this.addAndRemoveGeometries(a.toAdd,a.toRemove,d);this.updateHighlightCount();d.forEach(function(a){return c.updateDisplayedIndexRanges(a)})};b.prototype.addAndRemoveGeometries=function(a,c,d){var b=this,e=this._material,g=this._bufferWriter,
f=g.vertexBufferLayout,h=f.stride/4,l=this._dataByOrigin,m=u(l,g,a,c);m.forEach(function(a,c){m.delete(c);var g=a.optimalCount,k=a.sparseCount,u=l.get(c);null==u&&(p.assert(0<g),u=b.createData(f,g,a.origin),l.set(c,u));if(0===g)u.vao.dispose(!0),u.vao=null,l.delete(c);else{var n=(c=g<a.sparseCount/2)?g:k,g=t,k=u.buffer.getSize(),x=u.buffer.getArray(),n=u.buffer.resize(n);c||n?b.removeAndRebuild(u,a.toRemove,h,x,g):0<a.toRemove.length?(b.removeByErasing(u,a.toRemove,h,g),0<a.toAdd.length&&(g.end=k)):
(g.begin=k,g.end=k);c=r;p.setMatrixTranslation3(c,-a.origin[0],-a.origin[1],-a.origin[2]);b.append(u,e,a.toAdd,h,c,g);a=u.vao.vertexBuffers.geometry;a.byteSize!==u.buffer.getArray().buffer.byteLength?a.setData(u.buffer.getArray()):(x=g.begin,c=g.end,x<c&&(k=u.buffer.getArray(),x*=4,a.setSubData(k,x,x,4*c)));(g.updatedDisplayedIndexRange||u.displayedIndexRanges)&&d.add(u)}})};b.prototype.updateGeometries=function(c,d){for(var b=this._bufferWriter,e=b.vertexBufferLayout.stride/4,g=0;g<c.length;g++){var f=
c[g],h=f.updateType,f=f.renderGeometry,l=this._dataByOrigin.get(f.origin.id),m=l&&l.instances.get(f.uniqueName);if(!m)break;h&1&&(m.displayedIndexRange=a.generateRenderGeometryVisibleIndexRanges(f),d.add(l));h&17&&(m.highlightedIndexRanges=a.generateRenderGeometryHighlightRanges(f),l.highlightCount=null);h&6&&(h=l.buffer.getArray(),l=l.vao,a.calculateTransformRelToOrigin(f,y,w),b.write({transformation:y,invTranspTransformation:w},f.data,f.instanceParameters,b.vertexBufferLayout.createView(h.buffer),
m.from),p.assert(m.from+b.elementCount(f.data)===m.to,"material VBO layout has changed"),l.vertexBuffers.geometry.setSubData(h,m.from*e*4,m.from*e*4,m.to*e*4))}};b.prototype.updateDisplayedIndexRanges=function(a){var c=a.instances;a.displayedIndexRanges=[];var d=!0;c.forEach(function(c){c.displayedIndexRange?(a.displayedIndexRanges.push.apply(a.displayedIndexRanges,m.offsetIntervals(c.displayedIndexRange,c.from)),d=!1):a.displayedIndexRanges.push([c.from,c.to-1])});a.displayedIndexRanges=d?null:m.mergeIntervals(a.displayedIndexRanges)};
b.prototype.updateHighlightCount=function(){var a=this;this._highlightCount=0;this._dataByOrigin.forEach(function(c){if(null==c.highlightCount){var d=0;c.instances.forEach(function(a){a.highlightedIndexRanges&&++d});c.highlightCount=d}a._highlightCount+=c.highlightCount})};b.prototype.render=function(a,c,d,b){var e=this,g=this._rctx,f=this._glMaterials.get(c.pass),h=4===c.pass;if(!f||null!=a&&!f.beginSlot(a)||h&&0===this._highlightCount)return!1;f.bind(g,d);a=f.getProgram();a.setUniformMatrix4fv("model",
x);a.hasUniform("modelNormal")&&a.setUniformMatrix4fv("modelNormal",x);var l=!1;this._dataByOrigin.forEach(function(a){h&&0===a.highlightCount||(d.origin=a.origin,f.bindView(g,d),l=h?e.renderHighlightPass(f,a,b)||l:e.renderDefaultPass(f,a,b)||l)});f.release(g,d);return l};b.prototype.renderDefaultPass=function(c,d,b){var e=this._rctx,f=c.getProgram();c=c.getDrawMode();var h=d.displayedIndexRanges;if(h&&0===h.length)return!1;g.assertCompatibleVertexAttributeLocations(d.vao,f);e.bindVAO(d.vao);h?a.drawArraysFaceRange(e,
h,0,c,b):a.drawArrays(e,c,0,g.vertexCount(d.vao,"geometry"),b);return!0};b.prototype.renderHighlightPass=function(c,d,b){var e=this._rctx,f=c.getProgram(),h=c.getDrawMode();c=d.vao;g.assertCompatibleVertexAttributeLocations(c,f);e.bindVAO(c);var l=!1;d.instances.forEach(function(c){var d=c.highlightedIndexRanges;if(d&&0!==d.length)for(var g=0;g<d.length;g++){var f=d[g];a.drawArrays(e,h,f.range?f.range[0]+c.from:c.from,f.range?f.range[1]-f.range[0]+1:c.to-c.from,b);l=!0}});return l};b.prototype.createData=
function(a,c,b){return{instances:new Map,vao:new e(this._rctx,d.Default3D,{geometry:k.glLayout(a)},{geometry:l.createVertex(this._rctx,35044)}),buffer:new h(c),optimalCount:0,origin:b,highlightCount:0}};b.prototype.removeAndRebuild=function(a,c,d,b,e){for(var f=0;f<c.length;f++){var g=c[f].uniqueName,h=a.instances.get(g);a.optimalCount-=(h.to-h.from)*d;a.instances.delete(g)}var l=0,m=a.buffer.getArray();e.begin=0;e.end=0;var p=-1,k=-1,r=0;a.instances.forEach(function(a){var c=a.from*d,e=a.to*d,f=
e-c;p!==k&&k!==c?(m.set(b.subarray(p,k),r),r+=k-p,p=c):-1===p&&(p=c);k=e;a.from=l/d;l+=f;a.to=l/d});p!==k&&m.set(b.subarray(p,k),r);e.end=l};b.prototype.removeByErasing=function(a,c,d,b){if(0!==c.length){b.begin=Infinity;b.end=-Infinity;for(var e=-1,f=-1,g=0;g<c.length;g++){var h=c[g].uniqueName,l=a.instances.get(h),m=l.from*d,l=l.to*d;e!==f&&f!==m?(a.buffer.erase(e,f),e=m):-1===e&&(e=m);f=l;a.instances.delete(h);a.optimalCount-=l-m;m<b.begin&&(b.begin=m);l>b.end&&(b.end=l)}e!==f&&a.buffer.erase(e,
f)}};b.prototype.append=function(d,b,e,f,g,h){h.updatedDisplayedIndexRange=!1;b=this._bufferWriter;for(var l=0;l<e.length;l++){var m=e[l],k=m.data;n.mat4.multiply(y,g,m.transformation);n.mat4.invert(w,y);n.mat4.transpose(w,w);var r=h.end;b.write({transformation:y,invTranspTransformation:w},k,m.instanceParameters,b.vertexBufferLayout.createView(d.buffer.getArray().buffer),h.end/f);var k=b.elementCount(k)*f,t=r+k;p.assert(null==d.instances.get(m.uniqueName));var u=a.generateRenderGeometryVisibleIndexRanges(m),
x=a.generateRenderGeometryHighlightRanges(m);x&&(d.highlightCount=null);r=new c(m.name,r/f,t/f,u,x,void 0,void 0,m.idx);d.instances.set(m.uniqueName,r);u&&(h.updatedDisplayedIndexRange=!0);d.optimalCount+=k;h.end+=k}};return b}();var t={updatedDisplayedIndexRange:!1,begin:0,end:0},r=f.mat4f64.create(),y=f.mat4f64.create(),w=f.mat4f64.create(),x=f.mat4f64.create(),v=new Set;return q})},"esri/views/3d/webgl-engine/lib/Float32ArrayList":function(){define(["require","exports","../../../../core/mathUtils"],
function(q,b,n){return function(){function b(b){null==b?b=16:65536>b&&(b=n.nextHighestPowerOfTwo(b));this.array=new Float32Array(b);this.size=0}b.prototype.resize=function(b,d){void 0===d&&(d=!1);this.size=b;var f;if(this.size>this.array.length){for(b=this.array.length||1;b<this.size;)b*=2;f=new Float32Array(b);d&&f.set(this.array);this.array=f;return!0}if(this.size<=this.array.length/2){b=this.array.length;for(f=2*this.size;b>=f;)b=Math.floor(b/2);f=new Float32Array(b);d&&f.set(this.array.subarray(0,
b));this.array=f;return!0}return!1};b.prototype.append=function(b){var d=this.size;this.resize(this.size+b.length,!0);this.array.set(b,d)};b.prototype.erase=function(b,d){for(;b<d;++b)this.array[b]=0};b.prototype.getArray=function(){return this.array};b.prototype.getSize=function(){return this.size};return b}()})},"esri/views/3d/webgl-engine/lib/IntervalUtilities":function(){define(["require","exports"],function(q,b){return function(){function b(){}b.copyIntervals=function(b){for(var f=[],d=0;d<b.length;d++){var h=
b[d];f.push([h[0],h[1]])}return f};b.convertFaceToIndexRange=function(b,k){for(var d=0;d<b.length;d++){var f=b[d];f[0]*=k;f[1]=f[1]*k+(k-1)}};b.sortIntervals=function(b){return b.sort(function(b,d){return b[0]===d[0]?b[1]>d[1]?1:b[1]<d[1]?-1:0:b[0]>d[0]?1:b[0]<d[0]?-1:0})};b.intersectIntervals=function(b,k){if(0>=b.length)return[];for(var d=[],f=0;f<b.length;f++){var m=b[f];m[1]<k[0]||m[0]>k[1]||(m=[m[0],m[1]],m[0]<k[0]&&(m[0]=k[0]),m[1]>k[1]&&(m[1]=k[1]),d.push(m))}return d};b.mergeIntervals=function(b){if(0>=
b.length)return[];var f=[];b=this.sortIntervals(b);f.push(b[0]);for(var d=1;d<b.length;d++){var h=f[f.length-1];h[1]+1<b[d][0]?f.push(b[d]):h[1]<b[d][1]&&(h[1]=b[d][1],f.pop(),f.push(h))}return f};b.invertIntervals=function(b,k){for(var d=[],f=0,m=0;m<b.length;m++){var p=b[m];p[0]>f&&d.push([f,p[0]-1]);f=p[1]+1}f<=k&&d.push([f,k]);return d};b.offsetIntervals=function(b,k){for(var d=[],f=0;f<b.length;f++){var m=b[f];d.push([m[0]+k,m[1]+k])}return d};return b}()})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["require",
"exports","../../../../../core/libs/gl-matrix-2/mat4","../../../../../core/libs/gl-matrix-2/mat4f64"],function(q,b,n,f){return function(){return function(b,d,h,m,p,c,a,l,g){this.name=b;this.from=d;this.to=h;this.displayedIndexRange=m;this.highlightedIndexRanges=p;this.transformation=c;this.instanceParameters=a;this.idx=l;this.dataId=g;null!=c&&(this.transformationNormal=f.mat4f64.clone(c),n.mat4.invert(this.transformationNormal,this.transformationNormal),n.mat4.transpose(this.transformationNormal,
this.transformationNormal))}}()})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../lib/ComponentUtils ../../lib/Util ../../../../webgl/Util".split(" "),function(q,b,n,f,k,d,h){Object.defineProperty(b,"__esModule",{value:!0});b.generateRenderGeometryVisibleIndexRanges=function(d){return d.instanceParameters.hidden?[]:k.generateVisibleIndexRanges(d.instanceParameters.componentVisibilities,
d.componentOffsets)};b.generateRenderGeometryHighlightRanges=function(d){return d.instanceParameters.hidden?null:k.generateHighlightedIndexRanges(d.instanceParameters.componentVisibilities,d.instanceParameters.componentHighlights,d.componentOffsets)};b.doesRenderGeometryHaveHighlights=function(d){return d.instanceParameters.hidden?!1:k.hasHighlights(d.instanceParameters.componentVisibilities,d.instanceParameters.componentHighlights,d.componentOffsets)};b.isRenderGeometryHidden=function(d){return d.instanceParameters.hidden?
!0:k.isAllHidden(d.instanceParameters.componentVisibilities,d.componentOffsets)};b.drawArrays=function(d,c,a,b,f){d.drawArrays(c,a,b);f&&(f.drawCalls++,4===c&&(f.triangles+=b))};b.drawElements=function(d,c,a,b,f,e){var g=h.getBytesPerElement(a);d.drawElements(c,f,a,b*g);e&&(e.drawCalls++,4===c&&(e.triangles+=f))};b.drawArraysFaceRange=function(d,c,a,b,f){for(var e=0,g=0;g<c.length;g++){var h=c[g],l=h[0]+a,h=h[1]-h[0]+1,e=e+h;d.drawArrays(b,l,h)}f&&(f.drawCalls+=c.length,4===b&&(f.triangles=e/3))};
b.drawElementsFaceRange=function(d,c,a,b,f,e){for(var g=h.getBytesPerElement(f),l=0,m=0;m<c.length;m++){var p=c[m],k=p[0]+a,p=p[1]-p[0]+1,l=l+p;d.drawElements(b,p,f,k*g)}e&&(e.drawCalls+=c.length,4===b&&(e.triangles+=l/3))};b.acquireMaterials=function(d,c){var a=new Map;a.set(0,c.aquire(d,"color"));a.set(3,c.aquire(d,"depthShadowMap"));a.set(2,c.aquire(d,"normal"));a.set(1,c.aquire(d,"depth"));a.set(4,c.aquire(d,"highlight"));return a};b.releaseMaterials=function(d,c){c.release(d.id,"color");c.release(d.id,
"depthShadowMap");c.release(d.id,"normal");c.release(d.id,"depth");c.release(d.id,"highlight")};b.calculateTransformRelToOrigin=function(b,c,a){var f=b.origin.vec3;d.setMatrixTranslation3(m,-f[0],-f[1],-f[2]);n.mat4.multiply(c,m,b.transformation);a&&(n.mat4.invert(a,c),n.mat4.transpose(a,a))};var m=f.mat4f64.create()})},"esri/views/3d/webgl-engine/shaders/HUDPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],
function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});var d=function(d){return k.glslifyDefineMap({OCCL_TEST:d.occlTest,SIGNED_DISTANCE_FIELD:d.sdf,VV_SIZE:d.vvSize,VV_COLOR:d.vvColor,VERTICAL_OFFSET:d.verticalOffset,SCREEN_SIZE_PERSPECTIVE:d.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:d.centerOffsetUnitsScreen,DEBUG_DRAW_BORDER:d.debugDrawBorder,BINARY_HIGHLIGHT_OCCLUSION:d.binaryHighlightOcclusion,SLICE:d.slice})};b.colorPass={name:"hud-color",shaders:function(b){return{vertexShader:d(b)+
f.resolveIncludes("materials/hud/hud.vert"),fragmentShader:d(b)+f.resolveIncludes("materials/hud/colorPass.frag")}},attributes:n.Default3D};b.highlightPass={name:"hud-highlight",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("materials/hud/hud.vert"),fragmentShader:d(b)+f.resolveIncludes("materials/hud/highlightPass.frag")}},attributes:n.Default3D};b.occlusionPass={name:"hud-occlusion",shaders:function(d){return{vertexShader:k.glslifyDefineMap({VERTICAL_OFFSET:d.verticalOffset,SCREEN_SIZE_PERSPECTIVE:d.screenSizePerspective,
CENTER_OFFSET_UNITS_SCREEN:d.centerOffsetUnitsScreen,SLICE:d.slice})+f.resolveIncludes("materials/hud/occlusionTest.vert"),fragmentShader:f.resolveIncludes("materials/hud/occlusionTest.frag")}},attributes:n.Default3D}})},"esri/views/3d/layers/graphics/Labeler":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators ../../../../layers/support/LabelClass ../../../../layers/support/labelFormatUtils ../../../../support/arcadeUtils ../../../../symbols/callouts/calloutUtils ./Graphics3DCalloutSymbolLayerFactory ./graphicSymbolUtils ./labelPlacement ../../support/debugFlags ../../webgl-engine/Stage ../../webgl-engine/lib/Layer ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A){Object.defineProperty(b,"__esModule",{value:!0});var B=h.getLogger("esri.views.3d.layers.graphics.Labeler");q=function(b){function h(a){a=b.call(this)||this;a.idHint="__labeler";a._dirty=!1;a.labels={};a.labelsToAdd={};a.labelsToRemove={};a.labelingContexts=[];return a}n(h,b);h.prototype.setup=function(){var a=this;this.handles||(this.handles=new d,this.handles.add([this.view.watch("state.camera",function(){return a.setDirty()}),this.view.watch("pixelRatio",
function(){return a.resetAllLabels()})]));this.textTextureAtlas||(this.textTextureAtlas=new A.default(this.idHint+"_atlas",this.view),this.hudMaterialCollection=new x(this.view._stage),this.calloutMaterialCollection=new x(this.view._stage));this.handles.add(this.view.resourceController.scheduler.registerTask(8,function(c){return a.update(c)},function(){return a.needsUpdate()}))};h.prototype.dispose=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.textTextureAtlas&&(this.textTextureAtlas.dispose(),
this.textTextureAtlas=null);this.hudMaterialCollection&&(this.hudMaterialCollection.dispose(),this.hudMaterialCollection=null);this.calloutMaterialCollection&&(this.calloutMaterialCollection.dispose(),this.calloutMaterialCollection=null);this.labelingContexts=[];this.labels={};this.labelsToAdd={};this.labelsToRemove={}};h.prototype.isActiveLabelingContext=function(a){return a.active&&this.labelsEnabled(a)};h.prototype.activateLabelingContext=function(a){for(var c in a.labels){var d=a.labels[c];this.labels[c]=
d;d.graphics3DGraphic.setVisibilityFlag(0,!0,1)}a.active=!0};h.prototype.deactivateLabelingContext=function(a){for(var c in a.labels){var d=a.labels[c];d.graphics3DGraphic.setVisibilityFlag(0,!1,1);d.rendered&&(this.labelsToRemove[c]=a.labels[c]);delete this.labels[c];delete this.labelsToAdd[c]}a.active=!1};h.prototype.addLabelTextureToAtlas=function(a){for(var c=0;c<a.graphics3DGraphic._labelGraphics.length;c++){var d=a.graphics3DGraphic._labelGraphics[c];if(d._labelClass){var b=a.textRenderers[d._labelIndex];
b&&this.textTextureAtlas.addTextTexture(b,d.stageObject)}}a.rendered=!0};h.prototype.removeLabelTextureFromAtlas=function(a){for(var c=a.graphics3DGraphic,d=0;d<c._labelGraphics.length;d++){var b=c._labelGraphics[d];b._labelClass&&(b=a.textRenderers[b._labelIndex])&&this.textTextureAtlas.removeTextTexture(b,c._labelGraphics[d].stageObject)}a.rendered=!1};h.prototype.needsUpdate=function(){return this.view.ready&&this.isDirty};h.prototype.update=function(a){for(var c=null!=a,d=this._dirty=!1,b=0,e=
this.labelingContexts;b<e.length;b++){var f=e[b];if(this.isActiveLabelingContext(f)){if(!this.hasValidLabelClassContext(f)){if(this.hasInvalidLabelClassContext(f)){this.deactivateLabelingContext(f);continue}this.createLabelClassContext(f);if(this.hasPendingLabelClassContext(f)){this._dirty=!0;continue}if(!this.hasValidLabelClassContext(f))continue}for(var g in f.labelsToInitialize){var h=f.labelsToInitialize[g];this.ensureGraphics3DResources(h)&&(this.labels[g]=h,d=!0);(h.visible&&h.hasTextTextureResources||
!h.visible&&h.hasGraphics3DResources)&&delete f.labelsToInitialize[g];if(c&&(a.madeProgress(),a.done)){this._dirty=!0;return}}}}c&&d&&this.view.deconflictor.setDirty();for(g in this.labelsToRemove)this.removeLabelTextureFromAtlas(this.labelsToRemove[g]),delete this.labelsToRemove[g];for(g in this.labelsToAdd)this.addLabelTextureToAtlas(this.labelsToAdd[g]),delete this.labelsToAdd[g]};h.prototype.hasPendingLabelClassContext=function(a){return a.labelClassPromise&&!a.labelClassPromise.isResolved()};
h.prototype.hasValidLabelClassContext=function(a){return a.labelClassContexts&&a.labelClassContexts.length};h.prototype.hasInvalidLabelClassContext=function(a){return null===a.labelClassContexts};h.prototype.createLabelClassContext=function(c){var d=this;if(c.labelClassPromise)return c.labelClassPromise;c.labelClassPromise=c.layer.when(function(){c.scaleVisibility&&c.scaleVisibility.updateScaleRangeActive();var b=c.graphics3DCore,f=b.layer.labelingInfo&&b.layer.labelingInfo.filter(function(a){return!!a.symbol});
if(!f||0===f.length)return null;if(f.some(function(a){return l.hasGeometryOperations(a)}))return B.warn('Label expressions with arcade geometry operations are not supported. Labels for layer "'+c.layer.title+'" will not display '),null;var h=Array(f.length),f=f.map(function(c,f){var l=c.symbol,m=u.getGraphics3DSymbol(b.getOrCreateGraphics3DSymbol(l)),p=null;g.isCalloutSupport(l)&&l.hasVisibleCallout()&&(p=e.make(l,b.symbolCreationContext));h[f]={labelClass:c,graphics3DSymbol:m,graphics3DCalloutSymbolLayer:p,
options:a.getLabelingOptions(c),calloutSymbolLayerIndex:0,textRenderParameters:d.createTextRenderParameters(m.symbol)};return m});return m.all(f).then(function(){return h})}).then(function(a){a&&(c.labelClassContexts=a)}).catch(function(){c.labelClassContexts=null});return c.labelClassPromise};h.prototype.createTextRenderParameters=function(a){return(a=a.symbolLayers.getItemAt(0))&&"text"===a.type?z.default.fromSymbol(a,this.view.pixelRatio):null};h.prototype.destroyLabelClassContext=function(a){for(var c=
0,d=a.labelClassContexts;c<d.length;c++){var b=d[c];--b.graphics3DSymbol.referenced;b.graphics3DSymbol=null}a.labelClassContexts=[];a.labelClassPromise=null};h.prototype.createLabelText=function(d,b,e,f){if(!c.evaluateWhere(b.where,d.attributes))return null;b=b.getLabelExpression();return b.expression?a.buildLabelText(b.expression,d,f.fields,e):null};h.prototype.createTextSymbolGraphic=function(a,c,d,b,e){a={text:a.text,centerOffset:d.centerOffset,translation:d.translation,elevationOffset:d.elevationOffset,
screenOffset:d.screenOffset,anchor:d.anchor,centerOffsetUnits:d.centerOffsetUnits,verticalOffset:d.verticalOffset,debugDrawBorder:r.LABELS_SHOW_BORDER,displayWidth:a.displayWidth,displayHeight:a.displayHeight};C.graphic=c;C.renderingInfo=null;C.layer=b;return e.createLabel(C,a,this.hudMaterialCollection,this.textTextureAtlas)};h.prototype.createLineCalloutGraphic=function(a,c,d,b,e){c={symbol:c,translation:b.translation,elevationOffset:b.elevationOffset,screenOffset:b.screenOffset,centerOffset:b.centerOffset,
centerOffsetUnits:b.centerOffsetUnits,materialCollection:this.calloutMaterialCollection};C.graphic=a;C.renderingInfo=c;C.layer=e;return d.createGraphics3DGraphic(C)};h.prototype.ensureGraphics3DResources=function(a){var c=a.graphics3DGraphic;if(c.destroyed||a.hasGraphics3DResources)return!1;this.ensureTextTextureResources(a);var d=a.labelingContext,b=!1,e=c.graphic,f=d.labelClassContexts,g=d.layer,h=this.labelsEnabled(d);if(!f||0===f.length||!c._graphics[0])return!1;for(var l=0;l<f.length;l++){var m=
f[l],p=m.labelClass,k=a.textRenderers[l];if(k){var r=m.graphics3DSymbol,u=null;r.symbol&&"label-3d"===r.symbol.type&&(u=r.symbol);var n=r.childGraphics3DSymbols[0],r=t.get({graphics3DGraphic:c,labelSymbol:u,labelClass:m.labelClass});if(n&&r){if(b=this.createTextSymbolGraphic(k,e,r,g,n)){if(b._labelClass=p,b._labelIndex=l,c.addLabelGraphic(b,d.stageLayer,this.view._stage),d.spatialIndex&&d.spatialIndex.add(c),c.setVisibilityFlag(0,h,1),c.clearVisibilityFlag(1,1),c.setVisibilityFlag(3,!1,1),b=!0,m.graphics3DCalloutSymbolLayer&&
r.hasLabelVerticalOffset&&(e=this.createLineCalloutGraphic(e,u,m.graphics3DCalloutSymbolLayer,r,g)))m.calloutSymbolLayerIndex=c._labelGraphics.length,c.addLabelGraphic(e,d.stageLayer,this.view._stage)}else return!1;break}}}d.scaleVisibility&&b&&d.scaleVisibility.updateGraphicLabelScaleVisibility(c);return a.hasGraphics3DResources=!0};h.prototype.destroyGraphics3DResources=function(a){a.graphics3DGraphic.clearLabelGraphics();a.hasGraphics3DResources=!1};h.prototype.ensureTextTextureResources=function(a){if(!a.hasTextTextureResources){var c=
a.labelingContext,d=c.labelClassContexts,c=c.layer,b=a.graphics3DGraphic.graphic;if(d&&0!==d.length){for(var e=0;e<d.length;e++){var f=d[e];a.textRenderers[e]=null;if(f.textRenderParameters){var g=this.createLabelText(b,f.labelClass,f.options,c);g&&(a.textRenderers[e]=new v.default(g,f.textRenderParameters))}}a.hasTextTextureResources=!0}}};h.prototype.destroyTextTextureResources=function(a){a.textRenderers=[];a.hasTextTextureResources=!1};h.prototype.addGraphic=function(a,c){var d={hasGraphics3DResources:!1,
hasTextTextureResources:!1,visible:!1,rendered:!1,labelingContext:a,graphics3DGraphic:c,textRenderers:[]};c=c.graphic.uid;a.labels[c]=d;this.isActiveLabelingContext(a)&&this.hasValidLabelClassContext(a)&&this.ensureGraphics3DResources(d)?this.labels[c]=d:a.labelsToInitialize[c]=d;this.setDirty(a.graphics3DCore.asyncUpdates);this.view.deconflictor.setDirty()};h.prototype.removeGraphic=function(a,c){c=c.graphic.uid;var d=a.labels[c];d&&(this.labels[c]&&(this.removeLabelTextureFromAtlas(d),delete this.labels[c],
delete this.labelsToAdd[c],delete this.labelsToRemove[c]),d.hasTextTextureResources&&this.destroyTextTextureResources(d),d.hasGraphics3DResources&&this.destroyGraphics3DResources(d),delete a.labels[c],delete a.labelsToInitialize[c],this.setDirty(a.graphics3DCore.asyncUpdates),this.view.deconflictor.setDirty())};h.prototype.labelsEnabled=function(a){return!0===a.layer.labelsVisible&&null!=a.layer.labelingInfo&&0<a.layer.labelingInfo.length};h.prototype.labelingInfoChange=function(a,c){if(c){for(var d=
0;d<c.length;d++){var b=a.labels[c[d]];b&&(this.removeGraphic(a,b.graphics3DGraphic),this.addGraphic(a,b.graphics3DGraphic))}return m.create(function(a){return!0})}this.visibilityInfoChange(a);this.resetLabels(a);return this.createLabelClassContext(a)};h.prototype.globalPropertyChanged=function(a,c){for(var d=function(d){var b=new Map,e;for(e in c.labels){var f=c.labels[e].graphics3DGraphic;b.set(f.graphic.uid,f)}d.graphics3DSymbol.childGraphics3DSymbols[0].globalPropertyChanged(a,b,function(a){return a._labelGraphics[0]});
d.graphics3DCalloutSymbolLayer&&d.graphics3DCalloutSymbolLayer.globalPropertyChanged(a,b,function(a){return a._labelGraphics[d.calloutSymbolLayerIndex]})},b=0,e=c.labelClassContexts;b<e.length;b++)d(e[b])};h.prototype.visibilityInfoChange=function(a){var c=a.layer.labelsVisible;c&&!a.active&&this.activateLabelingContext(a);!c&&a.active&&this.deactivateLabelingContext(a);this.setDirty(a.graphics3DCore.asyncUpdates)};h.prototype.resetAllLabels=function(){for(var a=0,c=this.labelingContexts;a<c.length;a++)this.resetLabels(c[a])};
h.prototype.resetLabels=function(a){for(var c in a.labels){var d=a.labels[c];this.labels[c]&&(this.removeLabelTextureFromAtlas(d),delete this.labels[c],delete this.labelsToAdd[c],delete this.labelsToRemove[c]);d.hasTextTextureResources&&this.destroyTextTextureResources(d);d.hasGraphics3DResources&&this.destroyGraphics3DResources(d);d.visible=!1;d.rendered=!1;a.labelsToInitialize[c]=d}this.destroyLabelClassContext(a);this.setDirty(a.graphics3DCore.asyncUpdates);this.view.deconflictor.setDirty()};h.prototype.findLabelingContext=
function(a){for(var c=0,d=this.labelingContexts;c<d.length;c++){var b=d[c];if(b.graphics3DCore===a)return b}return null};h.prototype.addGraphicsOwner=function(a,c,d){var b=this;if(!this.findLabelingContext(a)){var e=a.layer,f={graphics3DCore:a,layer:e,scaleVisibility:c,spatialIndex:d,active:a.layer.labelsVisible,labelClassPromise:null,labelClassContexts:[],labels:{},labelsToInitialize:{},stageLayer:new w(this.idHint+"_"+e.uid,{isPickable:!0},e.uid)};this.view._stage.add(y.ModelContentType.LAYER,f.stageLayer);
this.view._stage.addToViewContent([f.stageLayer.id]);this.labelingContexts.push(f);this.setDirty();return{addGraphic:function(a){return b.addGraphic(f,a)},removeGraphic:function(a){return b.removeGraphic(f,a)},featureReductionChange:function(){},layerLabelsEnabled:function(){return b.labelsEnabled(f)},labelingInfoChange:function(a){return b.labelingInfoChange(f,a)},elevationInfoChange:function(){return b.globalPropertyChanged("elevationInfo",f)},slicePlaneEnabledChange:function(){return b.globalPropertyChanged("slicePlaneEnabled",
f)},visibilityInfoChange:function(){return b.visibilityInfoChange(f)},reset:function(){return b.resetLabels(f)},clear:function(){},processStageDirty:function(){return b.view._stage.processDirtyLayer(f.stageLayer.id)}}}};h.prototype.removeGraphicsOwner=function(a){if(a=this.findLabelingContext(a)){var c=this.labelingContexts.indexOf(a);this.labelingContexts.splice(c,1);for(var d in a.labels)this.removeGraphic(a,a.labels[d].graphics3DGraphic);d=a.stageLayer.id;this.view._stage.removeFromViewContent([d]);
this.view._stage.remove(y.ModelContentType.LAYER,d);a.stageLayer=null;this.setDirty()}};h.prototype.setLabelGraphicVisibility=function(a,c){a=a.graphic.uid;var d=this.labels[a];d&&(c&&!d.rendered?(this.labelsToAdd[a]=d,d.hasTextTextureResources||(d.labelingContext.labelsToInitialize[a]=d)):!c&&d.rendered&&(this.labelsToRemove[a]=d),d.visible=c,this.setDirty(d.labelingContext.graphics3DCore.asyncUpdates))};Object.defineProperty(h.prototype,"isDirty",{get:function(){return this._dirty||this.textTextureAtlas&&
this.textTextureAtlas.isDirty},enumerable:!0,configurable:!0});h.prototype.setDirty=function(a){void 0===a&&(a=!0);this._dirty=!0;a||this.update(null)};Object.defineProperty(h.prototype,"updating",{get:function(){return this.labelingContexts.some(function(a){return a.labelClassPromise&&!a.labelClassPromise.isResolved()})},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"test",{get:function(){return{textTextureAtlas:this.textTextureAtlas}},enumerable:!0,configurable:!0});f([p.property({constructOnly:!0})],
h.prototype,"view",void 0);f([p.property({type:Boolean,readOnly:!0})],h.prototype,"updating",null);return h=f([p.subclass()],h)}(p.declared(k));b.Labeler=q;var C={graphic:null,renderingInfo:null,layer:null}})},"esri/layers/support/labelFormatUtils":function(){define("require exports ../../core/tsSupport/decorateHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper dojo/number ../../arcade/Feature ../../core/date ../../core/lang ../../core/promiseUtils ./fieldUtils ../../support/arcadeUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g){function e(){return d(this,void 0,void 0,function(){return k(this,function(c){return[2,a.create(function(a){q(["../../core/sql/WhereClause"],a)})]})})}function u(){return d(this,void 0,void 0,function(){return k(this,function(c){return[2,a.create(function(a){q(["../../support/arcadeUtils"],a)})]})})}function t(a,c){c={spatialReference:c};if(a=a.labelExpressionInfo){var d=a.expression;d&&!a.value&&(c.hasArcadeExpression=!0,c.compiledArcadeFunc=g.createFunction(d))}return c}
function r(a,d,b,e){a=l.getField(e,a);if(!a)return d;if(null==b[a.name])return"";if(d=a.domain)if("codedValue"===d.type||"coded-value"===d.type){e=b[a.name];var f=0;for(d=d.codedValues;f<d.length;f++){var g=d[f];if(g.code===e)return g.name}}else if("range"===d.type&&(e=+b[a.name],f="range"in d?d.range[1]:d.maxValue,("range"in d?d.range[0]:d.minValue)<=e&&e<=f))return d.name;b=b[a.name];"date"===a.type||"esriFieldTypeDate"===a.type?(a=p.fromJSON("shortDate"),(a="DateFormat"+p.getFormat(a))&&(b=c.substitute({myKey:b},
"{myKey:"+a+"}"))):l.isNumericField(a)&&(b=h.format(+b));return b?b:""}Object.defineProperty(b,"__esModule",{value:!0});var y=new m,w=function(a){return null};b.createLabelFunction=function(c,b,f){return d(this,void 0,void 0,function(){var d,g,h,l,m,p,n,x,v,z,q;return k(this,function(k){switch(k.label){case 0:if(!c||!c.symbol)return[2,w];d=c.where;g=c.getLabelExpression();return[4,a.all([d?e():null,"arcade"===g.type?u():null])];case 1:return h=k.sent(),l=h[0],m=h[1],"arcade"===g.type?(n=t(c,f),x=
m.createFunction(g.expression),v={fields:b},z={vars:{$feature:y,$view:n.view},spatialReference:f},p=function(a){y.repurposeFromGraphicLikeObject(a.geometry,a.attributes,v);a=m.executeFunction(x,z);return null!=a?a.toString():null}):p=function(a){var c=a&&a.attributes;return c?g.expression.replace(/{[^}]*}/g,function(a){return r(a.slice(1,-1),a,c,b)}):null},d?(q=l.create(d),[2,function(a){return q.testFeature(a)?p(a):null}]):[2,p]}})})};b.getLabelingOptions=t;b.buildLabelText=function(a,c,d,b){var e=
"";if(b&&b.hasArcadeExpression){if(b.compiledArcadeFunc)return y.repurposeFromGraphicLikeObject(c.geometry,c.attributes,{fields:d}),a=g.executeFunction(b.compiledArcadeFunc,{vars:{$feature:y,$view:b.view},spatialReference:b.spatialReference}),null!=a?a.toString():null}else var f=c&&c.attributes||{},e=a.replace(/{[^}]*}/g,function(a){return r(a.slice(1,-1),a,f,d)});return e};b.formatField=r})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["require","exports",
"../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});var d=n.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");b.make=function(b,p){if(!f.isCalloutSupport(b))return d.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+b.type+"' does not support callouts"),null;if(!b.callout)return null;var c=h[b.callout.type];return c?new c(b,p):
(d.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+b.callout.type),null)};var h={line:k.default}})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./symbolComplexity ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t){Object.defineProperty(b,"__esModule",{value:!0});var r,y,w=u.VertexAttrConstants;q=function(b){function p(a,c){a=b.call(this,a,null,c,!0)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};c=a._getStageIdHint();a._createMaterialsAndAddToStage(a._context.stage,c);a.resolve();return a}n(p,b);p.prototype.destroy=function(){b.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(l.ModelContentType.MATERIAL,
this._material.id),this._material=null)};p.prototype.perInstanceMaterialParameters=function(a){var c=this.materialParameters;c.screenOffset=a.screenOffset||[0,0];c.centerOffsetUnits=a.centerOffsetUnits||"world";return c};Object.defineProperty(p.prototype,"materialParameters",{get:function(){var a=this.symbol,c=a.callout,d=f.toUnitRGBA(c.color);d[3]*=this._getLayerOpacity();var b=k.pt2px(c.size||0),e=null;if(a.verticalOffset)var e=a.verticalOffset,g=e.minWorldLength,h=e.maxWorldLength,e={screenLength:k.pt2px(e.screenLength),
minWorldLength:g||0,maxWorldLength:null!=h?h:Infinity};c=c.border&&c.border.color?f.toUnitRGBA(c.border.color):null;g="object"===a.symbolLayers.getItemAt(0).type;return{color:d,size:b,verticalOffset:e,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:c,occlusionTest:!g,shaderPolygonOffset:g?0:void 0,depthHUDAlignStart:"label-3d"===a.type,slicePlaneEnabled:this._context.slicePlaneEnabled}},
enumerable:!0,configurable:!0});p.prototype._createMaterialsAndAddToStage=function(a,c){this._material=new t(this.materialParameters,c+"_lineCallout_common");a.add(l.ModelContentType.MATERIAL,this._material)};p.prototype._defaultElevationInfoNoZ=function(){return z};p.prototype.createGraphics3DGraphic=function(a){var d=a.renderingInfo;a=a.graphic;var b=this.getGraphicElevationContext(a,d.elevationOffset||0),e=d.symbol,f="on-the-ground"===this._elevationContext.mode&&!e.symbolLayers.some(function(a){return"object"===
a.type||"text"===a.type});if("label-3d"!==e.type&&f)return null;e=c.computeCentroid(a.geometry);return null==e?null:this._createAs3DShape(a,e,b,d,"graphic"+a.uid,a.uid)};p.prototype.layerOpacityChanged=function(){this._material.setParameterValues(this.materialParameters);return!0};p.prototype.layerElevationInfoChanged=function(a,c,d){var b=this,e=this._elevationContext.mode;if(d!==e&&("on-the-ground"===d||"on-the-ground"===e))return!1;a.forEach(function(a){var d=c(a);d&&b.updateGraphicElevationContext(a.graphic,
d)});return!0};p.prototype.slicePlaneEnabledChanged=function(a,c){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};p.prototype.pixelRatioChanged=function(a,c){return!0};p.prototype.getGraphicElevationContext=function(a,c){void 0===c&&(c=0);a=b.prototype.getGraphicElevationContext.call(this,a);a.addOffsetRenderUnits(c);return a};p.prototype.updateGraphicElevationContext=function(a,c){a=this.getGraphicElevationContext(a,c.metadata.elevationOffset);c.elevationContext.set(a);
c.needsElevationUpdates=m.needsElevationUpdates2D(a.mode)};p.prototype.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,memory:a.emptySymbolComplexity.memory}};p.prototype.createVertexData=function(a){var c,d=a.translation;a=a.centerOffset;if(!d&&!a)return x;d=d?{size:3,data:[d[0],d[1],d[2]]}:x[w.POSITION];a=a?{size:4,data:[a[0],a[1],a[2],a[3]]}:x[w.AUXPOS1];return c={},c[w.POSITION]=d,c[w.NORMAL]=x[w.NORMAL],c[w.AUXPOS1]=a,c};p.prototype.getOrCreateMaterial=function(a,
c){var d=this.perInstanceMaterialParameters(a),b=t.uniqueMaterialIdentifier(d);if(b===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(a.materialCollection){var e=a.materialCollection.getMaterial(b);e||(e=new t(d,c+"_lineCallout_shared"),a.materialCollection.addMaterial(b,e));return{material:e,isUnique:!1}}e=new t(d,c+"_lineCallout_unique");return{material:e,isUnique:!0}};p.prototype._createAs3DShape=function(a,c,b,f,l,p){a=new e(this.createVertexData(f),v,e.DefaultOffsets,
"point");a=[new g(a,l)];var k=this.getOrCreateMaterial(f,l);l=m.createStageObjectForPoint(this._context,c,a,[k.material],null,null,b,l,this._context.layer.uid,p,!0);if(null===l)return null;p=new h(this,l.object,a,k.isUnique?[k.material]:null,null,d.perObjectElevationAligner,b);p.metadata={elevationOffset:f.elevationOffset||0};p.alignedTerrainElevation=l.terrainElevation;p.needsElevationUpdates=m.needsElevationUpdates2D(b.mode);m.extendPointGraphicElevationContext(p,c,this._context.elevationProvider);
return p};return p}(p.Graphics3DSymbolLayer);b.Graphics3DLineCalloutSymbolLayer=q;var x=(r={},r[w.POSITION]={size:3,data:[0,0,0]},r[w.NORMAL]={size:3,data:[0,0,1]},r[w.AUXPOS1]={size:4,data:[0,0,0,1]},r);r=new Uint32Array([0]);var v=(y={},y[w.POSITION]=r,y[w.NORMAL]=r,y[w.AUXPOS1]=r,y),z={mode:"relative-to-ground",offset:0};b.default=q})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ./Graphics3DSymbolCommonCode ./graphicUtils ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l){Object.defineProperty(b,"__esModule",{value:!0});var g=l.VertexAttrConstants,e=new h,u=d.vec3f64.create(),t=d.vec3f64.create(),r=d.vec3f64.create(),y=f.mat4f64.create(),w=d.vec3f64.create(),x={verticalDistanceToGround:0,terrainElevation:0};b.perVertexElevationAligner=function(a,d,f,h){a=a.stageObject;e.spatialReference=f.spatialReference;for(var l=a.getGeometryRecords(),p=l.length,k="absolute-height"!==d.mode,n=0,v=0;v<p;v++){var z=l[v].geometry,y=l[v].getShaderTransformation();
t[0]=y[12];t[1]=y[13];t[2]=y[14];z.invalidateBoundingInfo();for(var y=z.data.getVertexAttr(),w=y[g.POSITION],z=w.data,y=y.mapPos.data,w=w.size,q=z.length/w,A=0,B=0,C=!1,R=0,J=0;J<q;J++){e.x=y[B++];e.y=y[B++];e.z=y[B++];r[0]=z[A];r[1]=z[A+1];r[2]=z[A+2];var U=m.computeElevation(f,e,d,h,k?x:null);k&&(R+=x.terrainElevation);u[0]=z[A]+t[0];u[1]=z[A+1]+t[1];u[2]=z[A+2]+t[2];h.setAltitude(U,u);z[A]=u[0]-t[0];z[A+1]=u[1]-t[1];z[A+2]=u[2]-t[2];if(c.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS)C=!0;else if(U=
b.updateThresholdInMeters/h.unitInMeters,Math.abs(r[0]-z[A])>=U||Math.abs(r[1]-z[A+1])>=U||Math.abs(r[2]-z[A+2])>=U)C=!0;A+=w}n+=R/q;C&&a.geometryVertexAttrsUpdated(v)}return n/p};b.perObjectElevationAligner=function(d,e,f,g,h){d=d.stageObject;var l=e.centerPointInElevationSR,r=0;h=0;if(d.metadata.usesVerticalDistanceToGround)r=m.computeElevation(f,l,e,g,x),p.updateVertexAttributeAuxpos1w(d,x.verticalDistanceToGround),h=x.terrainElevation;else{var t="absolute-height"!==e.mode,r=m.computeElevation(f,
l,e,g,t?x:null);t&&(h=x.terrainElevation)}e=n.mat4.copy(v,d.objectTransformation);f=k.vec3.set(w,e[12],e[13],e[14]);c.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(u[0]=l.x,u[1]=l.y,u[2]=r,a.computeLinearTransformation(l.spatialReference,u,e,g.spatialReference)&&(d.objectTransformation=e)):g.setAltitudeOfTransformation(r,e);g=b.updateThresholdInMeters/g.unitInMeters;if(Math.abs(e[12]-f[0])>=g||Math.abs(e[13]-f[1])>=g||Math.abs(e[14]-f[2])>=g)d.objectTransformation=e;return h};var v=f.mat4f64.create();
b.perLodInstanceElevationAligner=function(d,e,f,g,h){var l=e.centerPointInElevationSR,p=0;h=0;var r="absolute-height"!==e.mode,p=m.computeElevation(f,l,e,g,r?x:null);r&&(h=x.terrainElevation);e=d.graphics3DSymbolLayer.lodRenderer.instanceData;d=d.instanceIndex;e.getGlobalTransform(d,y);f=k.vec3.set(w,y[12],y[13],y[14]);c.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(u[0]=l.x,u[1]=l.y,u[2]=p,a.computeLinearTransformation(l.spatialReference,u,y,g.spatialReference)&&e.setGlobalTransform(d,y)):g.setAltitudeOfTransformation(p,
y);g=b.updateThresholdInMeters/g.unitInMeters;(Math.abs(y[12]-f[0])>=g||Math.abs(y[13]-f[1])>=g||Math.abs(y[14]-f[2])>=g)&&e.setGlobalTransform(d,y);return h};b.updateThresholdInMeters=.01;b.iterativeUpdatesEnabled=!0})},"esri/views/3d/layers/graphics/Graphics3DSymbolCommonCode":function(){define("require exports ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/coordsUtils ../../../../geometry/support/triangulationUtils ../../../../layers/graphics/dehydratedFeatures ./graphicUtils ../../support/projectionUtils ../../webgl-engine/lib/Object3D".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l){function g(a,c,d,b,e){var f=c.z||0,g=d.featureExpressionInfoContext;switch(d.mode){case "on-the-ground":return d=a.getElevation(c,"ground")||0,e&&(e.verticalDistanceToGround=0,e.terrainElevation=d),d;case "relative-to-ground":return a=a.getElevation(c,"ground")||0,d=d.calculateOffsetRenderUnits(b),null==g&&(d+=f),e&&(e.verticalDistanceToGround=d,e.terrainElevation=a),d+a;case "relative-to-scene":return a=a.getElevation(c,"scene")||0,d=d.calculateOffsetRenderUnits(b),
e&&(e.verticalDistanceToGround=d,e.terrainElevation=a),d+a;case "absolute-height":return d=d.calculateOffsetRenderUnits(b),null==g&&(d+=f),e&&(a=a.getElevation(c,"ground")||0,e.verticalDistanceToGround=d-a,e.terrainElevation=a),d;default:n.neverReached(d.mode)}return 0}function e(a,c){a=m.pathsToTriangulationInfo(a,c);return{vertexData:a.position,polygons:a.polygons,outlines:a.outlines}}function u(a,c,d,b,e){c*=3;b*=3;for(var f=0;f<e;++f)d[b++]=a[c++],d[b++]=a[c++],d[b++]=a[c++]}function t(c,d,b,
e,f,g,h){return a.bufferToBuffer(c,b,d,e,g,f,h)}function r(c,d,b){a.pointToVector(c,d,b)}function y(a,c){return!(a[0]>c[3]||a[0]<c[0]||a[1]>c[4]||a[1]<c[1])}function w(a,c){return!(c[0]>a[3]||c[3]<a[0]||c[1]>a[4]||c[4]<a[1])}Object.defineProperty(b,"__esModule",{value:!0});var x=d.vec3f64.create(),v=k.mat4f64.create(),z=p.makeDehydratedPoint(0,0,0,null);b.createStageObjectForPoint=function(d,b,e,h,m,p,k,t,u,n,z,w){var q=e?e.length:0,C=d.clippingExtent;r(b,x,d.elevationProvider.spatialReference);if(C&&
!y(x,C))return null;r(b,x,d.renderSpatialReference);C=d.localOriginFactory.getOrigin(x);t=new l({castShadow:!1,metadata:{layerUid:u,graphicUid:n,usesVerticalDistanceToGround:!!z},idHint:t});for(u=0;u<q;u++)t.addGeometry(e[u],h[u],m?m[u]:v,p,C,w);e=d.renderSpatialReference;h=d.elevationProvider;m=d.renderCoordsHelper;d=0;var M;t.metadata.usesVerticalDistanceToGround?(d=g(h,b,k,m,B),c.updateVertexAttributeAuxpos1w(t,B.verticalDistanceToGround),M=B.terrainElevation):(p="absolute-height"!==k.mode,d=g(h,
b,k,m,p?B:null),p&&(M=B.terrainElevation));k=f.mat4.copy(A,t.objectTransformation);x[0]=b.x;x[1]=b.y;x[2]=d;a.computeLinearTransformation(b.spatialReference,x,k,e)?t.objectTransformation=k:console.warn("Could not locate symbol object properly, it might be misplaced");return{object:t,terrainElevation:M}};b.extendPointGraphicElevationContext=function(a,c,d){a=a.elevationContext;d=d.spatialReference;r(c,x,d);a.centerPointInElevationSR=p.makeDehydratedPoint(x[0],x[1],c.hasZ?x[2]:0,d)};b.placePointOnGeometry=
function(a){switch(a.type){case "point":return a;case "polygon":case "extent":return c.computeCentroid(a);case "polyline":var d=a.paths[0];if(!d||0===d.length)break;d=h.getPointOnPath(d,h.getPathLength(d)/2);return p.makeDehydratedPoint(d[0],d[1],d[2],a.spatialReference);case "mesh":return a.extent.center}return null};b.computeElevation=g;var A=k.mat4f64.create();b.getSingleSizeDriver=function(a,c){void 0===c&&(c=0);return isFinite(a[c])?a[c]:null};b.copyPathData=e;b.copyVertices=u;b.chooseOrigin=
function(a,c,d,b){c=Math.floor(c+(d-1)/2);b[0]=a[3*c+0];b[1]=a[3*c+1];b[2]=a[3*c+2]};b.subtractCoordinates=function(a,c,d,b){c*=3;for(var e=0;e<d;++e)a[c++]-=b[0],a[c++]-=b[1],a[c++]-=b[2]};b.setZ=function(a,c,d,b){c*=3;for(var e=0;e<d;++e)a[c+2]=b,c+=3};b.offsetZ=function(a,c,d,b){c*=3;for(var e=0;e<d;++e)a[c+2]+=b,c+=3};b.scaleZ=function(a,c,d,b){c*=3;for(var e=0;e<d;++e)a[c+2]*=b,c+=3};b.flatArrayToArrayOfArrays=function(a,c,d){var b=[];c*=3;for(var e=0;e<d;++e)b.push([a[c++],a[c++],a[c++]]);return b};
b.reproject=t;b.reprojectPoint=r;b.getGeometryVertexData3D=function(a,c,d,b,f,g,h){var l=f.spatialReference;a=e(a,c);c=a.vertexData;var m=c.length/3,p=new Float64Array(c.length),k=!0;d.equals(l)?u(c,0,p,0,c.length):k=t(c,0,d,p,0,l,m);var r=d=0,n=h.mode,x=0,v=0,y=0;g=h.calculateOffsetRenderUnits(g);h=h.featureExpressionInfoContext;z.spatialReference=f.spatialReference;d*=3;for(var r=3*r,w=0;w<m;++w){z.x=p[d+0];z.y=p[d+1];z.z=p[d+2];switch(n){case "on-the-ground":v=x=f.getElevation(z)||0;y+=x;break;
case "relative-to-ground":x=f.getElevation(z)||0;v=x+g;null==h&&(v+=z.z);y+=x;break;case "relative-to-scene":x=f.getElevation(z,"scene")||0;v=x+g;y+=x;break;case "absolute-height":v=g,null==h&&(v+=z.z)}c[r+0]=p[d+0];c[r+1]=p[d+1];c[r+2]=v;d+=3;r+=3}f=y/m;l.equals(b)||t(c,0,l,c,0,b,m);return{geometryData:a,vertexData:c,eleVertexData:p,terrainElevation:f,projectionSuccess:k}};b.getGeometryVertexDataDraped=function(c,d,b){c=e(c,!1);var f=c.vertexData,g=f.length/3,h=!0;d.equals(b)||(h=a.bufferToBuffer(f,
d,0,f,b,0,g));return{geometryData:c,vertexData:f,projectionSuccess:h}};b.computeBoundingBox=function(a,c,d,b){b[0]=Number.MAX_VALUE;b[1]=Number.MAX_VALUE;b[2]=Number.MAX_VALUE;b[3]=-Number.MAX_VALUE;b[4]=-Number.MAX_VALUE;b[5]=-Number.MAX_VALUE;c*=3;for(var e=0;e<d;++e){var f=a[c++],g=a[c++],h=a[c++];f<b[0]&&(b[0]=f);g<b[1]&&(b[1]=g);h<b[2]&&(b[2]=h);f>b[3]&&(b[3]=f);g>b[4]&&(b[4]=g);h>b[5]&&(b[5]=h)}return b};b.pointInBox2D=y;b.boxesIntersect2D=w;b.boundingBoxClipped=function(a,c){return c?!w(a,
c):!1};b.needsElevationUpdates2D=function(a){return"relative-to-ground"===a||"relative-to-scene"===a};b.needsElevationUpdates3D=function(a){return"absolute-height"!==a};var B={verticalDistanceToGround:0,terrainElevation:0}})},"esri/geometry/support/triangulationUtils":function(){define(["require","exports","../../core/libs/earcut/earcut","./coordsUtils","./meshUtils/deduplicate"],function(q,b,n,f,k){function d(d,c,a){if(1===d.length)return d[0];c=new Float64Array(c);a=new Uint32Array(a);for(var b=
0,f=0,e=0,h=0;h<d.length;h++){for(var m=d[h],p=0;p<m.position.length;p++)c[b++]=m.position[p];for(p=0;p<m.faces.length;p++)a[f++]=m.faces[p]+e;e=b/3}return{position:c,faces:a}}function h(d,c){for(var a=d.length,b=Array(a),g=Array(a),e=Array(a),h=0,p=0,k=0,n=0,w=0;w<a;++w)n+=d[w].length;for(var n=new Float64Array(3*n),x=0,v=a-1;0<=v;v--){var z=d[v],q=!f.isClockwise(z,!1,!1);if(q&&1!==a)b[h++]=z;else{for(var B=z.length,w=0;w<h;++w)B+=b[w].length;w={index:x,pathLengths:Array(h+1),count:B,holeIndices:Array(h)};
w.pathLengths[0]=z.length;0<z.length&&(e[k++]={index:x,count:z.length});x=q?m(z,z.length-1,-1,n,x,z.length,c):m(z,0,1,n,x,z.length,c);for(z=0;z<h;++z)q=b[z],w.holeIndices[z]=x,w.pathLengths[z+1]=q.length,0<q.length&&(e[k++]={index:x,count:q.length}),x=m(q,0,1,n,x,q.length,c);h=0;0<w.count&&(g[p++]=w)}}for(z=0;z<h;++z)q=b[z],0<q.length&&(e[k++]={index:x,count:q.length}),x=m(q,0,1,n,x,q.length,c);p<a&&(g.length=p);k<a&&(e.length=k);return{position:n,polygons:g,outlines:e}}function m(d,c,a,b,f,e,h){f*=
3;for(var g=0;g<e;++g){var l=d[c];b[f++]=l[0];b[f++]=l[1];b[f++]=h?l[2]:0;c+=a}return f/3}Object.defineProperty(b,"__esModule",{value:!0});b.triangulate=function(b){var c=h(b.rings,b.hasZ),a=[],f=0,g=0;b=function(d){var b=d.index,e=new Float64Array(c.position.buffer,3*b*c.position.BYTES_PER_ELEMENT,3*d.count);d=d.holeIndices.map(function(a){return a-b});d=new Uint32Array(n(e,d,3));a.push({position:e,faces:d});f+=e.length;g+=d.length};for(var e=0,m=c.polygons;e<m.length;e++)b(m[e]);b=d(a,f,g);e=k.default(b.position.buffer,
6,b.faces);b.position=new Float64Array(e.buffer);b.faces=e.indices;return b};b.pathsToTriangulationInfo=h})},"esri/core/libs/earcut/earcut":function(){define([],function(){function q(a,c,e){e=e||2;var g=c&&c.length,l=g?c[0]*e:a.length,m=b(a,0,l,e,!0),k=[];if(!m||m.next===m.prev)return k;var r,t,x,v;if(g){var z=e,g=[],y,w,q;v=0;for(y=c.length;v<y;v++)w=c[v]*z,q=v<y-1?c[v+1]*z:a.length,w=b(a,w,q,z,!1),w===w.next&&(w.steiner=!0),g.push(p(w));g.sort(d);for(v=0;v<g.length;v++){c=g[v];z=m;if(z=h(c,z))c=
u(z,c),n(c,c.next);m=n(m,m.next)}}if(a.length>80*e){r=x=a[0];t=g=a[1];for(z=e;z<l;z+=e)v=a[z],c=a[z+1],v<r&&(r=v),c<t&&(t=c),v>x&&(x=v),c>g&&(g=c);x=Math.max(x-r,g-t);x=0!==x?1/x:0}f(m,k,e,r,t,x);return k}function b(a,c,d,b,e){var f;if(e===0<w(a,c,d,b))for(e=c;e<d;e+=b)f=t(e,a[e],a[e+1],f);else for(e=d-b;e>=c;e-=b)f=t(e,a[e],a[e+1],f);f&&l(f,f.next)&&(r(f),f=f.next);return f}function n(c,d){if(!c)return c;d||(d=c);var b;do if(b=!1,c.steiner||!l(c,c.next)&&0!==a(c.prev,c,c.next))c=c.next;else{r(c);
c=d=c.prev;if(c===c.next)break;b=!0}while(b||c!==d);return d}function f(d,b,h,p,t,y,w){if(d){if(!w&&y){var x=d,v=x;do null===v.z&&(v.z=m(v.x,v.y,p,t,y)),v.prevZ=v.prev,v=v.nextZ=v.next;while(v!==x);v.prevZ.nextZ=null;v.prevZ=null;var x=v,z,q,A,B,C,E,P=1;do{v=x;A=x=null;for(B=0;v;){B++;q=v;for(z=C=0;z<P&&(C++,q=q.nextZ,q);z++);for(E=P;0<C||0<E&&q;)0!==C&&(0===E||!q||v.z<=q.z)?(z=v,v=v.nextZ,C--):(z=q,q=q.nextZ,E--),A?A.nextZ=z:x=z,z.prevZ=A,A=z;v=q}A.nextZ=null;P*=2}while(1<B)}for(x=d;d.prev!==d.next;){v=
d.prev;q=d.next;if(y)A=k(d,p,t,y);else a:if(A=d,B=A.prev,C=A,P=A.next,0<=a(B,C,P))A=!1;else{for(z=A.next.next;z!==A.prev;){if(c(B.x,B.y,C.x,C.y,P.x,P.y,z.x,z.y)&&0<=a(z.prev,z,z.next)){A=!1;break a}z=z.next}A=!0}if(A)b.push(v.i/h),b.push(d.i/h),b.push(q.i/h),r(d),x=d=q.next;else if(d=q,d===x){if(!w)f(n(d),b,h,p,t,y,1);else if(1===w){w=b;x=h;v=d;do q=v.prev,A=v.next.next,!l(q,A)&&g(q,v,v.next,A)&&e(q,A)&&e(A,q)&&(w.push(q.i/x),w.push(v.i/x),w.push(A.i/x),r(v),r(v.next),v=d=A),v=v.next;while(v!==d);
d=v;f(d,b,h,p,t,y,2)}else if(2===w)a:{w=d;do{for(x=w.next.next;x!==w.prev;){if(v=w.i!==x.i){v=w;q=x;A=void 0;if(A=v.next.i!==q.i&&v.prev.i!==q.i){A=void 0;b:{A=v;do{if(A.i!==v.i&&A.next.i!==v.i&&A.i!==q.i&&A.next.i!==q.i&&g(A,A.next,v,q)){A=!0;break b}A=A.next}while(A!==v);A=!1}A=!A}B=void 0;if(B=A&&e(v,q)&&e(q,v)){A=v;B=!1;C=(v.x+q.x)/2;q=(v.y+q.y)/2;do A.y>q!==A.next.y>q&&A.next.y!==A.y&&C<(A.next.x-A.x)*(q-A.y)/(A.next.y-A.y)+A.x&&(B=!B),A=A.next;while(A!==v)}v=B}if(v){d=u(w,x);w=n(w,w.next);d=
n(d,d.next);f(w,b,h,p,t,y);f(d,b,h,p,t,y);break a}x=x.next}w=w.next}while(w!==d)}break}}}}function k(d,b,e,f){var g=d.prev,h=d.next;if(0<=a(g,d,h))return!1;var l=g.x>d.x?g.x>h.x?g.x:h.x:d.x>h.x?d.x:h.x,p=g.y>d.y?g.y>h.y?g.y:h.y:d.y>h.y?d.y:h.y,k=m(g.x<d.x?g.x<h.x?g.x:h.x:d.x<h.x?d.x:h.x,g.y<d.y?g.y<h.y?g.y:h.y:d.y<h.y?d.y:h.y,b,e,f);b=m(l,p,b,e,f);e=d.prevZ;for(f=d.nextZ;e&&e.z>=k&&f&&f.z<=b;){if(e!==d.prev&&e!==d.next&&c(g.x,g.y,d.x,d.y,h.x,h.y,e.x,e.y)&&0<=a(e.prev,e,e.next))return!1;e=e.prevZ;
if(f!==d.prev&&f!==d.next&&c(g.x,g.y,d.x,d.y,h.x,h.y,f.x,f.y)&&0<=a(f.prev,f,f.next))return!1;f=f.nextZ}for(;e&&e.z>=k;){if(e!==d.prev&&e!==d.next&&c(g.x,g.y,d.x,d.y,h.x,h.y,e.x,e.y)&&0<=a(e.prev,e,e.next))return!1;e=e.prevZ}for(;f&&f.z<=b;){if(f!==d.prev&&f!==d.next&&c(g.x,g.y,d.x,d.y,h.x,h.y,f.x,f.y)&&0<=a(f.prev,f,f.next))return!1;f=f.nextZ}return!0}function d(a,c){return a.x-c.x}function h(a,d){var b=d,f=a.x,g=a.y,h=-Infinity,l;do{if(g<=b.y&&g>=b.next.y&&b.next.y!==b.y){var m=b.x+(g-b.y)*(b.next.x-
b.x)/(b.next.y-b.y);if(m<=f&&m>h){h=m;if(m===f){if(g===b.y)return b;if(g===b.next.y)return b.next}l=b.x<b.next.x?b:b.next}}b=b.next}while(b!==d);if(!l)return null;if(f===h)return l.prev;d=l;for(var m=l.x,p=l.y,k=Infinity,r,b=l.next;b!==d;)f>=b.x&&b.x>=m&&f!==b.x&&c(g<p?f:h,g,m,p,g<p?h:f,g,b.x,b.y)&&(r=Math.abs(g-b.y)/(f-b.x),(r<k||r===k&&b.x>l.x)&&e(b,a)&&(l=b,k=r)),b=b.next;return l}function m(a,c,d,b,e){a=32767*(a-d)*e;c=32767*(c-b)*e;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;
c=(c|c<<8)&16711935;c=(c|c<<4)&252645135;c=(c|c<<2)&858993459;return(a|a<<1)&1431655765|((c|c<<1)&1431655765)<<1}function p(a){var c=a,d=a;do c.x<d.x&&(d=c),c=c.next;while(c!==a);return d}function c(a,c,d,b,e,f,g,h){return 0<=(e-g)*(c-h)-(a-g)*(f-h)&&0<=(a-g)*(b-h)-(d-g)*(c-h)&&0<=(d-g)*(f-h)-(e-g)*(b-h)}function a(a,c,d){return(c.y-a.y)*(d.x-c.x)-(c.x-a.x)*(d.y-c.y)}function l(a,c){return a.x===c.x&&a.y===c.y}function g(c,d,b,e){return l(c,d)&&l(b,e)||l(c,e)&&l(b,d)?!0:0<a(c,d,b)!==0<a(c,d,e)&&0<
a(b,e,c)!==0<a(b,e,d)}function e(c,d){return 0>a(c.prev,c,c.next)?0<=a(c,d,c.next)&&0<=a(c,c.prev,d):0>a(c,d,c.prev)||0>a(c,c.next,d)}function u(a,c){var d=new y(a.i,a.x,a.y),b=new y(c.i,c.x,c.y),e=a.next,f=c.prev;a.next=c;c.prev=a;d.next=e;e.prev=d;b.next=d;d.prev=b;f.next=b;b.prev=f;return b}function t(a,c,d,b){a=new y(a,c,d);b?(a.next=b.next,a.prev=b,b.next.prev=a,b.next=a):(a.prev=a,a.next=a);return a}function r(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&
(a.nextZ.prevZ=a.prevZ)}function y(a,c,d){this.i=a;this.x=c;this.y=d;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function w(a,c,d,b){for(var e=0,f=d-b;c<d;c+=b)e+=(a[f]-a[c])*(a[c+1]+a[f+1]),f=c;return e}q.deviation=function(a,c,d,b){var e=c&&c.length,f=Math.abs(w(a,0,e?c[0]*d:a.length,d));if(e)for(var e=0,g=c.length;e<g;e++)f-=Math.abs(w(a,c[e]*d,e<g-1?c[e+1]*d:a.length,d));for(e=c=0;e<b.length;e+=3){var g=b[e]*d,h=b[e+1]*d,l=b[e+2]*d;c+=Math.abs((a[g]-a[l])*(a[h+1]-a[g+
1])-(a[g]-a[h])*(a[l+1]-a[g+1]))}return 0===f&&0===c?0:Math.abs((c-f)/f)};q.flatten=function(a){for(var c=a[0][0].length,d={vertices:[],holes:[],dimensions:c},b=0,e=0;e<a.length;e++){for(var f=0;f<a[e].length;f++)for(var g=0;g<c;g++)d.vertices.push(a[e][f][g]);0<e&&(b+=a[e-1].length,d.holes.push(b))}return d};return q})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["require","exports","../../../core/mathUtils"],function(q,b,n){function f(d,b,f,p){void 0===p&&(p=0);var c=d.byteLength/
(4*b),a=new Uint32Array(d,0,c*b);d=new Uint32Array(c);var h=Math.floor(1.1*c)+1;if(null==k||k.length<2*h)k=new Uint32Array(n.nextHighestPowerOfTwo(2*h));for(var g=0;g<2*h;g++)k[g]=0;for(var e=0,m=0!==p?Math.ceil(7.84*1.96/(p*p)*p*(1-p)):c,g=0;g<c;g++){if(g===m){var t=1-e/g;if(t+1.96*Math.sqrt(t*(1-t)/g)<p)return null;m*=2}for(var t=g*b,r,y=r=0;y<b;y++)r=a[t+y]+r|0,r=r+(r<<11)+(r>>>2)|0;r>>>=0;for(var y=r%h,w=e;0!==k[2*y+1];){if(k[2*y]===r){var x=k[2*y+1]-1,v=x*b;a:{for(var z=0;z<b;z++)if(a[t+z]!==
a[v+z]){v=!1;break a}v=!0}if(v){w=d[x];break}}y++;y>=h&&(y-=h)}w===e&&(k[2*y]=r,k[2*y+1]=g+1,e++);d[g]=w}if(0!==p&&1-e/c<p)return null;p=new Uint32Array(b*e);for(g=e=0;g<c;g++)if(d[g]===e){h=a;m=g*b;t=p;r=e*b;y=b;for(w=0;w<y;w++)t[r+w]=h[m+w];e++}if(f){b=new Uint32Array(f.length);for(g=0;g<b.length;g++)b[g]=d[f[g]];d=b}return{buffer:p.buffer,indices:d,uniqueCount:e}}Object.defineProperty(b,"__esModule",{value:!0});b.deduplicate=f;var k=null;b.default=f})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("require exports ../../../../geometry ../../../../core/mathUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../geometry/support/webMercatorUtils ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u){function t(a){var c=a.paths[0];if(!c||0===c.length)return null;c=g.getPointOnPath(c,g.getPathLength(c)/2);return u.makeDehydratedPoint(c[0],c[1],c[2],a.spatialReference)}function r(a,c,d){if(!c||!a)return a;var b=a.spatialReference;b.isWebMercator&&c.isWGS84?(e.xyToLngLat(a.x,a.y,x),d||(a=u.clonePoint(a)),a.x=x[0],a.y=x[1],a.spatialReference=n.SpatialReference.WGS84):c.isWebMercator&&b.isWGS84&&(e.lngLatToXY(a.x,a.y,x),d||(a=u.clonePoint(a)),a.x=x[0],a.y=x[1],
a.spatialReference=n.SpatialReference.WebMercator);return a}function y(a){if(Array.isArray(a)){for(var c=0;c<a.length;c++)if(!y(a[c]))return!1;return!0}return null==a||0<=a}Object.defineProperty(b,"__esModule",{value:!0});var w=m.vec3f64.fromValues(1,1,1);b.computeCentroid=function(a,c){if("point"===a.type)return r(a,c,!1);if(u.isHydratedGeometry(a))switch(a.type){case "extent":return r(a.center,c,!1);case "polygon":return r(a.centroid,c,!1);case "polyline":return r(t(a),c,!0);case "mesh":return r(a.extent.center,
c,!1)}else switch(a.type){case "extent":var d=f.isFinite(a.zmin);a=u.makeDehydratedPoint(.5*(a.xmax+a.xmin),.5*(a.ymax+a.ymin),d?.5*(a.zmax+a.zmin):void 0,a.spatialReference);return r(a,c,!0);case "polygon":return(d=a.rings[0])&&0!==d.length?(d=l.ringsCentroid(a.rings,a.hasZ),a=u.makeDehydratedPoint(d[0],d[1],d[2],a.spatialReference)):a=null,r(a,c,!0);case "polyline":return r(t(a),c,!0)}};b.convertPointSR=r;b.enlargeExtent=function(c,d,b){if(c){d||(d=a.create());var e=.5*c.width*(b-1);b=.5*c.height*
(b-1);c.width<1E-7*c.height?e+=b/20:c.height<1E-7*c.width&&(b+=e/20);p.vec4.set(d,c.xmin-e,c.ymin-b,c.xmax+e,c.ymax+b);return d}return null};b.updateVertexAttributeAuxpos1w=function(a,c){for(var d=0;d<a.geometries.length;++d){var b=a.geometries[d].data.vertexAttributes.auxpos1;b&&b.data[3]!==c&&(b.data[3]=c,a.geometryVertexAttrsUpdated(d))}};b.mixinColorAndOpacity=function(a,c){var d=[1,1,1,1];null!=a&&(d[0]=a[0],d[1]=a[1],d[2]=a[2]);null!==c&&void 0!==c?d[3]=c:null!=a&&3<a.length&&(d[3]=a[3]);return d};
b.overrideColor=function(a,c,d,b,e,f){void 0===f&&(f=[0,0,0,0]);for(var g=0;3>g;++g)f[g]=a&&null!=a[g]?a[g]:d&&null!=d[g]?d[g]:e[g];f[3]=null!=c?c:null!=b?b:e[3];return f};b.computeObjectScale=function(a,c,d,b){void 0===a&&(a=w);void 0===b&&(b=1);var e=Array(3);if(null==c||null==d)e[0]=1,e[1]=1,e[2]=1;else{for(var f=void 0,g=0,h=2;0<=h;h--){var l=a[h],p=void 0,k=null!=l,r=0===h&&!f&&!k,t=d[h];"symbolValue"===l||r?p=0!==t?c[h]/t:1:k&&"proportional"!==l&&isFinite(l)&&(p=0!==t?l/t:1);null!=p&&(f=e[h]=
p,g=Math.max(g,Math.abs(p)))}for(h=2;0<=h;h--)null==e[h]?e[h]=f:0===e[h]&&(e[h]=.001*g)}for(h=2;0<=h;h--)e[h]/=b;return m.vec3f64.fromArray(e)};b.computeSizeWithResourceSize=function(a,c){var d=c.width,b=c.depth,e=c.height;c=c.isPrimitive?10:1;if(null==d&&null==e&&null==b)return[c*a[0],c*a[1],c*a[2]];for(var d=m.vec3f64.fromValues(d,b,e),f,b=0;3>b;b++)if(e=d[b],null!=e){f=e/a[b];break}for(b=0;3>b;b++)null==d[b]&&(d[b]=a[b]*f);return d};b.validateSymbolLayerSize=function(a){null!=a.isPrimitive&&(a=
[a.width,a.depth,a.height]);return y(a)?null:"Symbol sizes may not be negative values"};b.computeObjectRotation=function(a,c,b,e){void 0===e&&(e=d.mat4f64.create());a=a||0;c=c||0;b=b||0;0!==a&&k.mat4.rotateZ(e,e,-a/180*Math.PI);0!==c&&k.mat4.rotateX(e,e,c/180*Math.PI);0!==b&&k.mat4.rotateY(e,e,b/180*Math.PI);return e};b.demResolutionForBoundingBox=function(a,d){return null!=d.minDemResolution?d.minDemResolution:c.isPoint(a)?d.minDemResolutionForPoints:.01*c.maximumDimension(a)};b.namedAnchorToHUDMaterialAnchorPos=
{"bottom-left":h.vec2f64.fromValues(0,0),bottom:h.vec2f64.fromValues(.5,0),"bottom-right":h.vec2f64.fromValues(1,0),left:h.vec2f64.fromValues(0,.5),center:h.vec2f64.fromValues(.5,.5),right:h.vec2f64.fromValues(1,.5),"top-left":h.vec2f64.fromValues(0,1),top:h.vec2f64.fromValues(.5,1),"top-right":h.vec2f64.fromValues(1,1)};var x=[0,0]})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils ../../webgl-engine/Stage".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l){q=function(){function b(a,d,e,f,g,h,l,m){this.type="object3d";this._addedToStage=!1;this.alignedTerrainElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.uniqueMaterials=f;this.uniqueGeometries=e;this.uniqueTextures=g;this.stageObject=d;this.elevationAligner=h;this.elevationContext=new c(l);this.stageLayer=this.stage=null;this._visible=!1;this.visibilityMode=null!=m?m:b.VisibilityModes.HIDE_FACERANGE}b.prototype.initialize=function(a,c){this.stageLayer=
a;this.stage=c;if(this.uniqueMaterials)for(a=0;a<this.uniqueMaterials.length;a++)c.add(l.ModelContentType.MATERIAL,this.uniqueMaterials[a]);if(this.uniqueGeometries)for(a=0;a<this.uniqueGeometries.length;a++)c.add(l.ModelContentType.GEOMETRY,this.uniqueGeometries[a]);if(this.uniqueTextures)for(a=0;a<this.uniqueTextures.length;a++)c.add(l.ModelContentType.TEXTURE,this.uniqueTextures[a]);c.add(l.ModelContentType.OBJECT,this.stageObject)};b.prototype.setVisibility=function(a){if(null!=this.stage)return this._visible!==
a?((this._visible=a)?this._addedToStage?this.stageObject.unhideAllComponents():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===b.VisibilityModes.HIDE_FACERANGE?this.stageObject.hideAllComponents():(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1),a=this.stage.view.ensureEdgeView(),a.hasObject(this.stageObject)&&a.updateObjectVisibility(this.stageObject,this._visible),!0):!1};Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},
enumerable:!0,configurable:!0});b.prototype.destroy=function(){var a=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var c=0;c<this.uniqueMaterials.length;c++)a.remove(l.ModelContentType.MATERIAL,this.uniqueMaterials[c].id);if(this.uniqueGeometries)for(c=0;c<this.uniqueGeometries.length;c++)a.remove(l.ModelContentType.GEOMETRY,this.uniqueGeometries[c].id);if(this.uniqueTextures)for(c=0;c<this.uniqueTextures.length;c++)a.remove(l.ModelContentType.TEXTURE,this.uniqueTextures[c].id)}a.remove(l.ModelContentType.OBJECT,
this.stageObject.id);this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);a=this.stage.view.ensureEdgeView();a.hasObject(this.stageObject)&&a.removeObject(this.stageObject);this._visible=!1;this.stage=this.stageLayer=null};b.prototype.alignWithElevation=function(a,c,d){this.elevationAligner&&(p.setContextFeature(this.elevationContext.featureExpressionInfoContext,d),a=this.elevationAligner(this,this.elevationContext,a,c),null!=a&&(this.alignedTerrainElevation=
a))};b.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()};b.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=h.vec3f64.create());return d.vec3.copy(a,this.stageObject.getCenter(!0))};b.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=m.create());var c=this.stageObject;a||(a=m.create());m.setMin(a,c.getBBMin(!0));m.setMax(a,c.getBBMax(!0));return a};b.prototype.getProjectedBoundingBox=function(c,b,h,l){return k(this,void 0,void 0,function(){var p,k,r,n,x,
v,y,w,q,K;return f(this,function(f){switch(f.label){case 0:p=this.getBoundingBoxObjectSpace(l);k=t;r=m.isPoint(p)?1:k.length;for(n=0;n<r;n++)x=k[n],e[0]=p[x[0]],e[1]=p[x[1]],e[2]=p[x[2]],d.vec3.transformMat4(e,e,this.stageObject.objectTransformation),g[3*n+0]=e[0],g[3*n+1]=e[1],g[3*n+2]=e[2];if(!c(g,0,r))return[2,null];m.empty(p);v=null;this.calculateRelativeScreenBounds&&(v=this.calculateRelativeScreenBounds());for(n=0;n<3*r;n+=3){for(y=0;3>y;y++)p[y]=Math.min(p[y],g[n+y]),p[y+3]=Math.max(p[y+3],
g[n+y]);v&&h.push({location:g.slice(n,n+3),screenSpaceBoundingRect:v})}if(!b||!b.service||"absolute-height"===this.elevationContext.mode)return[3,5];m.center(p,u);w="relative-to-scene"===this.elevationContext.mode?"scene":"ground";q=void 0;if(!b.useViewElevation)return[3,1];q=b.service.getElevation(u[0],u[1],w);return[3,4];case 1:return f.trys.push([1,3,,4]),K=a.demResolutionForBoundingBox(p,b),[4,b.service.queryElevation(u[0],u[1],K,w)];case 2:return q=f.sent(),[3,4];case 3:return f.sent(),q=null,
[3,4];case 4:m.offset(p,0,0,-this.alignedTerrainElevation+q),f.label=5;case 5:return[2,p]}})})};b.prototype.addHighlight=function(a,c){c=this.stageObject.highlightAllComponents(c);a.addObject(this.stageObject,c)};b.prototype.removeHighlight=function(a){a.removeObject(this.stageObject)};return b}();(function(a){a=a.VisibilityModes||(a.VisibilityModes={});a[a.REMOVE_OBJECT=0]="REMOVE_OBJECT";a[a.HIDE_FACERANGE=1]="HIDE_FACERANGE"})(q||(q={}));var g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
e=h.vec3f64.create(),u=h.vec3f64.create(),t=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return q})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["require","exports","../../../../support/arcadeUtils"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.createContext=function(b,k,d){var f=null;b=b&&b.expression;"string"===typeof b&&(f="0"===b?0:null,null!=f?f={cachedResult:f}:(f=n.createSyntaxTree(b),n.dependsOnView(f)?(null!=d&&
d.error("Expressions containing '$view' are not supported on ElevationInfo"),f={cachedResult:0}):f={arcade:{func:n.createFunction(f),context:n.createExecContext(null,{sr:k})}}));return f};b.createFeature=function(b,k){return n.createFeature(b.attributes,b.geometry,k)};b.setContextFeature=function(b,k){null!=b&&null==b.cachedResult&&n.updateExecContext(b.arcade.context,k)};b.execute=function(b){if(null!=b){if(null!=b.cachedResult)return b.cachedResult;var f=b.arcade,f=n.executeFunction(f.func,f.context);
"number"!==typeof f&&(f=b.cachedResult=0);return f}return 0};b.extractExpressionInfo=function(b,k){void 0===k&&(k=!1);var d=(b=b&&b.featureExpressionInfo)&&b.expression;k||"0"===d||(b=null);return b};b.zeroContext={cachedResult:0}})},"esri/views/3d/layers/graphics/Graphics3DGraphicElevationContext":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./ElevationContext"],function(q,b,n,f){return function(b){function d(d){d=b.call(this,d)||this;d.centerPointInElevationSR=
null;return d}n(d,b);return d}(f)})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["require","exports","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(q,b,n,f){return function(){function b(d){d?this.set(d):this.setDefaults()}Object.defineProperty(b.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"unit",{get:function(){return this._unit},enumerable:!0,
configurable:!0});b.prototype.setUnit=function(d){this._unit=d;this._metersPerElevationInfoUnit=n.getMetersPerUnit(d)};b.prototype.setDefaults=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this.featureExpressionInfoContext=null;this.setUnit("meters")};b.prototype.set=function(d){this.mode=d.mode;this._meterUnitOffset=d._meterUnitOffset||0;this._renderUnitOffset=d._renderUnitOffset||0;this.featureExpressionInfoContext=d.featureExpressionInfoContext;this.setUnit(d.unit)};
b.prototype.setOffsetMeters=function(d){this._meterUnitOffset=d;this._renderUnitOffset=0};b.prototype.setOffsetElevationInfoUnits=function(d){this._meterUnitOffset=d*this._metersPerElevationInfoUnit;this._renderUnitOffset=0};b.prototype.addOffsetRenderUnits=function(d){this._renderUnitOffset+=d};b.prototype.mixinApi=function(d){null!=d.mode&&(this.mode=d.mode);null!=d.unit&&this.setUnit(d.unit);null!=d.offset&&this.setOffsetElevationInfoUnits(d.offset)};b.prototype.calculateOffsetRenderUnits=function(d){var b=
this._meterUnitOffset,m=this.featureExpressionInfoContext;null!=m&&(b+=f.execute(m)*this._metersPerElevationInfoUnit);return b/d.unitInMeters+this._renderUnitOffset};return b}()})},"esri/views/3d/webgl-engine/Stage":function(){define("require exports ../../../core/libs/gl-matrix-2/vec3f64 ./lib/ModelContentType ./lighting/Lightsources ./parts/Model ./parts/View".split(" "),function(q,b,n,f,k,d,h){function m(d){return"function"===typeof d.addParentStage&&"function"===typeof d.removeParentStage}return function(){function b(c,
a,b,f){this.sceneIntersectionHelper=f;this._viewContent=[];this.container=a;this.viewingMode=c;this.model=new d;this.view=new h(a,this,this.model.getDirtySet(),b);this.view.setLighting({lights:[new k.MainLight(n.vec3f64.fromValues(.7,.7,.7)),new k.AmbientLight(n.vec3f64.fromValues(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})}b.prototype.setNeedsRender=function(){this.view.setNeedsRender()};b.prototype.dispose=function(){this.view.dispose();this.model=this.view=null};b.prototype.add=function(c,
a){this.model.add(c,a);m(a)&&a.addParentStage(this)};b.prototype.remove=function(c,a){c=this.model.remove(c,a);m(c)&&c.removeParentStage(this);return c};b.prototype.notifyDirty=function(c,a,d,b){this.model.notifyDirty(c,a,d,b)};b.prototype.processDirty=function(){var c=this.model.getDirtySet(),a=c.getDirtyMaterials();if(c.hasDirtyGeometryRecords()||a){b.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));var d=c.commitLayers(this._viewContent);(0<d[0].length+
d[1].length+d[2].length||a)&&this.view.modify(d[0],d[1],d[2],a);b.DebugSettings.logDirtySet&&(console.log("RGs add: "+d[0].map(function(a){return a.uniqueName})),console.log("RGs remove: "+d[1].map(function(a){return a.uniqueName})));c.commit();c.clearDirtyMaterials();this.view.setNeedsRender()}};b.prototype.processDirtyLayer=function(c){var a=this.model.getDirtySet(),d=a.getDirtyMaterials();c=a.commitLayers([c]);(0<c[0].length+c[1].length+c[2].length||d)&&this.view.modify(c[0],c[1],c[2],d);a.clearDirtyMaterials();
this.view.setNeedsRender()};b.prototype.get=function(c,a){return this.model.get(c,a)};b.prototype.getAll=function(c){return this.model.getAll(c)};b.prototype.getCamera=function(){return this.view.getCamera()};b.prototype.setCamera=function(c){this.view.setCamera(c)};b.prototype.setViewParams=function(c){this.view.setViewParams(c)};b.prototype.getLayers=function(){return this.model.getAll(f.LAYER)};b.prototype.setLighting=function(c){this.view.setLighting(c)};b.prototype.getCanvas=function(){return this.view.getCanvas()};
b.prototype.setRenderParams=function(c){this.view.setRenderParams(c)};b.prototype.getRenderParams=function(){return this.view.getRenderParams()};b.prototype.has=function(c){return this.view.has(c)};b.prototype.getViewContent=function(){return this._viewContent.slice(0)};b.prototype.addToViewContent=function(c){for(var a=[],d=0;d<c.length;d++)-1===this._viewContent.indexOf(c[d])&&a.push(c[d]);0<c.length&&(this.processDirty(),c=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(a),
this.view.modify(c,[],[]),this._viewContent.push.apply(this._viewContent,a))};b.prototype.removeFromViewContent=function(c){this.processDirty();for(var a=this.model.getDirtySet(),d=this._viewContent,b=[],e=0;e<c.length;e++){var f=d.indexOf(c[e]);-1<f&&(d[f]=d[d.length-1],d.pop(),b.push(c[e]))}c=a.getResidentRenderGeometriesFilteredByLayers(b);this.view.modify([],c,[])};b.prototype.getFrameTask=function(){return this.view.getFrameTask()};b.prototype.takeScreenshot=function(c){return this.view.takeScreenshot(c)};
b.prototype.addRenderPlugin=function(c,a){"intersect"in a&&this.sceneIntersectionHelper.addIntersectionHandler(a);return this.view.renderPlugins.add(c,a)};b.prototype.removeRenderPlugin=function(c){"intersect"in c&&this.sceneIntersectionHelper.removeIntersectionHandler(c);return this.view.renderPlugins.remove(c)};b.prototype.getContentDebugStrings=function(c){return this.model.formatDebugInfo(c)};b.prototype.getRenderStats=function(){return this.view.getCombinedStats()};b.prototype.getRenderStatString=
function(c){var a=this.getRenderStats(),d="";if(c){var d=d+"\x3ctable\x3e",b;for(b in a)d+="\x3ctr\x3e\x3ctd\x3e"+b+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Math.round(a[b])+"\x3c/td\x3e\x3c/tr\x3e";d+="\x3c/table\x3e"}else for(b in a)d+=b+": "+a[b]+"\n";return d};b.prototype.getFramebufferTexture=function(c){void 0===c&&(c="color");return this.view.getFramebufferTexture(c)};b.prototype.getDrapedRenderer=function(){return this.view.getDrapedRenderer()};b.DebugSettings={endFrameContentValidation:!1,
logDirtySet:!1};b.ModelContentType=f;return b}()})},"esri/views/3d/webgl-engine/parts/Model":function(){define("require exports dojo/string ../../support/mathUtils ../lib/localOrigin ../lib/ModelContentType ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util".split(" "),function(q,b,n,f,k,d,h,m,p){var c=p.assert,a=p.logWithBase;return function(){function b(){this.dirtySet=new h(this);this._uniqueIdx=0;this._id2origin={};this.content={};for(var a in d)this.content[d[a]]={}}b.prototype.getAll=function(a){a=
this.content[a];c(void 0!==a);return a};b.prototype.get=function(a,c){return this.getAll(a)[c]};b.prototype.add=function(a,b){var e=this.content[a];c(void 0!==e);var f=b.id;c(null==e[f],"Model/Stage already contains object to be added");e[f]=b;a===d.LAYER&&this.notifyDirty(a,b,"layerAdded")};b.prototype.remove=function(a,b){var e=this.content[a];c(void 0!==e);var f=e[b];c(void 0!==f,"Model/Stage doesn't contain object to be removed");delete e[b];a===d.TEXTURE&&f.unload();a===d.LAYER&&this.notifyDirty(a,
f,"layerRemoved");return f};b.prototype.getDirtySet=function(){return this.dirtySet};b.prototype.notifyDirty=function(a,c,d,b){this.dirtySet.handleUpdate(c,d,b)};b.prototype.getOrigin=function(c,d,b){void 0===b&&(b=10);var e=0;d=d*b/1E4;1<d&&(e=Math.ceil(a(d,2)));d=1E4*Math.pow(2,e);b=Math.round(c[0]/d);var f=Math.round(c[1]/d);c=Math.round(c[2]/d);var e=e+"_"+b+"_"+f+"_"+c,g=this._id2origin[e];null==g&&(g=k.fromValues(b*d,f*d,c*d,e),this._id2origin[e]=g);return g};b.prototype.getGeometryRenderGeometries=
function(a,c,d){var b=a.id,e=c.geometry,g=a.getCombinedStaticTransformation(c),h=f.maxScale(g),l=c.origin,p=c.id,k=this._uniqueIdx++;a=new m(e.data,e.boundingInfo,c.material,g,c.shaderTransformation,h,a.getCastShadow(),!!e.singleUse,b,p,k);a.origin=l||this.getOrigin(a.center,a.bsRadius);a.instanceParameters=c.instanceParameters;d.push(a)};b.prototype.updateRenderGeometryTransformation=function(a,c,d){a.getCombinedStaticTransformation(c,d.transformation);d.updateTransformation(d.transformation);a=
this.getOrigin(d.center,d.bsRadius);return d.origin!==a};b.prototype.formatDebugInfo=function(a){var c=[];if(a){c[0]="\x3ctable\x3e";for(var b in d)a=d[b],c[0]+="\x3ctr\x3e\x3ctd\x3e"+a+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Object.keys(this.getAll(a)).length+"\x3c/td\x3e\x3c/tr\x3e";c[0]+="\x3c/table\x3e";c[1]=this.dirtySet.formatDebugInfo(!0)}else{c[0]="";for(b in d)a=d[b],c[0]+=n.pad(String(Object.keys(this.getAll(a)).length),6," ")+" "+a+", ";c[1]=this.dirtySet.formatDebugInfo(!1)}return c};
b.prototype.validateObject=function(a){a=a.geometryRecords;for(var b=0;b<a.length;++b){var f=a[b];c(null!=this.get(d.GEOMETRY,f.geometry.id));c(null!=this.get(d.MATERIAL,f.material.id))}};b.prototype.validateLayer=function(a){a=a.getObjects();for(var b=0;b<a.length;++b){var f=this.get(d.OBJECT,a[b].id);c(null!=f)}};b.ContentType=d;return b}()})},"esri/views/3d/webgl-engine/lib/localOrigin":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/vec3f64"],function(q,b,n){Object.defineProperty(b,
"__esModule",{value:!0});b.fromVector=function(b,k){return{vec3:n.vec3f64.clone(b),id:k}};b.fromValues=function(b,k,d,h){return{vec3:n.vec3f64.fromValues(b,k,d),id:h}}})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("require exports ../../../../core/arrayUtils ../../../../core/iteratorUtils ./ModelContentType ./Util".split(" "),function(q,b,n,f,k,d){return function(){function b(d){this._residentGeomRecords=new Map;this._dirtyGeomRecords=new Map;this._dirtyMaterials=new Set;this._model=
d}Object.defineProperty(b.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"residentObjectCount",{get:function(){var d=0;this._residentGeomRecords.forEach(function(b){d+=b.size});return d},enumerable:!0,configurable:!0});b.prototype.getDirtyMaterials=function(){return 0<this._dirtyMaterials.size?this._dirtyMaterials:null};b.prototype.clearDirtyMaterials=function(){this._dirtyMaterials.clear()};b.prototype.hasDirtyGeometryRecords=
function(){var d=!1;f.everyMap(this._dirtyGeomRecords,function(b){if(d)return!1;f.everyMap(b,function(c){if(!d&&c&&0<c.size)return d=!0,!1})});return d};b.prototype.handleUpdate=function(b,f,c){d.assert(this[f],"ModelDirtySet doesn't know how to process "+f);return this[f](b,c)};b.prototype.shaderTransformationChanged=function(d){var b=this;(d=this._residentGeomRecords.get(d.id))&&d.forEach(function(c,a){(a=b._model.content[k.OBJECT][a])&&a.hasVolativeTransformation()&&c.forEach(function(a){var c=
0;for(a=a[1];c<a.length;c++)a[c].shaderTransformationChanged()})})};b.prototype.commit=function(){return this.commitLayers(n.keysOfMap(this._dirtyGeomRecords))};b.prototype.commitLayers=function(b){for(var f=this,c=[],a=[],h=[],g=function(g){var l=b[g];g=e._dirtyGeomRecords.get(l);if(!g)return"continue";g.forEach(function(b,e){var g=f._ensureGeomRecord(l,e);b.forEach(function(b,l){var m=b[0],p=b[1];b=b[2];var r=!1;if(p&2){var t=g.get(l);if(t){t=t[1];if(b&4)for(var n=f._model.get(k.OBJECT,e),u=0;u<
t.length;u++){var x=t[u];if(f._model.updateRenderGeometryTransformation(n,m,x)){r=!0;break}}if(!r)for(n=0;n<t.length;n++)x=t[n],h.push({renderGeometry:x,updateType:b})}else d.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(p&4||r)(t=g.get(l))?a.push.apply(a,t[1]):4===p&&d.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove"),t&&g.delete(l);if(p&1||r)p=[m,[]],n=f._model.get(k.OBJECT,e),f._model.getGeometryRenderGeometries(n,m,p[1]),c.push.apply(c,
p[1]),g.set(l,p)});0===g.size&&f._residentGeomRecords.get(l).delete(e)});0===e._residentGeomRecords.get(l).size&&e._residentGeomRecords.delete(l);e._dirtyGeomRecords.delete(l)},e=this,m=0;m<b.length;m++)g(m);return[c,a,h]};b.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(n.keysOfMap(this._residentGeomRecords))};b.prototype.getResidentRenderGeometriesFilteredByLayers=function(d){for(var b=[],c=0;c<d.length;c++){var a=this._residentGeomRecords.get(d[c]);
a&&a.forEach(function(a){a.forEach(function(a){b.push.apply(b,a[1])})})}return b};b.prototype.visibilityChanged=function(d,b,c){if(null!=b)this._componentPropertyChanged(d,b,c,1);else{b=0;for(var a=d.getGeometryRecords();b<a.length;b++)this._componentPropertyChanged(d,a[b],c,1)}};b.prototype.componentHighlightChanged=function(d,b,c){if(null!=b)this._componentPropertyChanged(d,b,c,16);else{b=0;for(var a=d.getGeometryRecords();b<a.length;b++)this._componentPropertyChanged(d,a[b],c,16)}};b.prototype.vertexAttrsUpdated=
function(d,b,c){this._updateOrCreateDirtyRecord(d,b,c,2,0,0,2,5,2)};b.prototype.matChanged=function(d){this._dirtyMaterials.add(d.id);if(this.onMaterialChanged)this.onMaterialChanged(d)};b.prototype.layerAdded=function(d){for(var b=d.getObjects(),c=0;c<b.length;c++)this.layObjectAdded(d,b[c])};b.prototype.layerRemoved=function(d){for(var b=d.getObjects(),c=0;c<b.length;c++)this.layObjectRemoved(d,b[c])};b.prototype.layObjectAdded=function(d,b){d=d.id;for(var c=b.getGeometryRecords(),a=0;a<c.length;a++)this.objGeometryAdded(b,
c[a],d)};b.prototype.layObjectRemoved=function(d,b){d=d.id;for(var c=b.getGeometryRecords(),a=0;a<c.length;a++)this.objGeometryRemoved(b,c[a],d)};b.prototype.layObjectReplaced=function(d,b){this.layObjectRemoved(d,b[0]);this.layObjectAdded(d,b[1])};b.prototype.objTransformation=function(d,b){var c=this;b=b||this._getParentLayerId(d);this._ensureGeomRecord(b,d.id).forEach(function(a){c._updateOrCreateDirtyRecord(d,a[0],b,2,0,0,2,5,4)})};b.prototype.objGeometryAdded=function(d,b,c){this._updateOrCreateDirtyRecord(d,
b,c,1,4,0,0,0)};b.prototype.objGeometryRemoved=function(d,b,c){this._updateOrCreateDirtyRecord(d,b,c,4,1,2,0,0)};b.prototype.objGeometryReplaced=function(d,b){this.objGeometryRemoved(d,b[0]);this.objGeometryAdded(d,b[1])};b.prototype.objGeometryTransformation=function(d,b){this.objGeometryReplaced(d,b)};b.prototype._componentPropertyChanged=function(d,b,c,a){this._updateOrCreateDirtyRecord(d,b,c,2,0,0,2,5,a)};b.prototype._updateOrCreateDirtyRecord=function(b,f,c,a,h,g,e,k,t){c=c||this._getParentLayerId(b);
var l=f.id;b=this._ensureDirtyRecord(c,b.id);(c=b.get(l))?(f=c[1],f&h?b.delete(l):f&g?(c[1]=a,c[2]=t):f&e?c[2]|=t:f&k||d.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")):b.set(l,[f,a,t])};b.prototype._ensureGeomRecord=function(d,b){var c=this._residentGeomRecords.get(d);c||(c=new Map,this._residentGeomRecords.set(d,c));d=c.get(b);d||(d=new Map,c.set(b,d));return d};b.prototype._ensureDirtyRecord=function(d,b){var c=this._dirtyGeomRecords.get(d);c||(c=new Map,this._dirtyGeomRecords.set(d,
c));d=c.get(b);d||(d=new Map,c.set(b,d));return d};b.prototype._getParentLayerId=function(d){return d.parentLayer.id};b.prototype.formatDebugInfo=function(d){if(d)return"";var b=["ADD","UPD",void 0,"REM"],c="";this._dirtyGeomRecords.forEach(function(a,d){a.forEach(function(a,e){0<c.length&&(c+="\n");c+=d+"."+e;var f=[];a.forEach(function(a){var c=a[1];f[c]||(f[c]=[]);f[c].push(a[0].geometry.id)});for(a=0;a<f.length;a++)if(f[a])for(c+=" "+b[a-1]+": ",e=0;e<f[a].length;e++)c+=f[a][e]+", "})});return c};
return b}()})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils ./ComponentUtils ./HighlightUtils".split(" "),function(q,b,n,f,k,d,h,m,p){return function(){function c(a,c,b,e,f,h,m,k,p,n,v){this.shaderTransformationDirty=!0;this.data=a.toRenderData();this.componentOffsets=a.componentOffsets;
this.boundingInfo=c;this.material=b;this.origin=null;this.center=d.vec3f64.create();this.bsRadius=0;this.transformation=null;this.calculateShaderTransformation=f;e&&this.updateTransformation(e,h);this.castShadow=m;this.singleUse=k;this.name=p;this.uniqueName=n;this.idx=v;this.instanceParameters={}}c.prototype.updateTransformation=function(a,c){this.transformation=a;this.shaderTransformationDirty=!0;this.bsRadius=this.getBoundingSphere(a,c,this.center)};c.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=
!0};c.prototype.getBoundingSphere=function(a,c,d){c=c||h.maxScale(a);k.vec3.transformMat4(d,this.boundingInfo.getCenter(),a);return this.boundingInfo.getBSRadius()*c};Object.defineProperty(c.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"componentCount",{get:function(){return m.componentCount(this.componentOffsets)},enumerable:!0,configurable:!0});c.prototype.getShaderTransformation=
function(){if(!this.calculateShaderTransformation)return this.transformation;this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=f.mat4f64.create()),n.mat4.copy(this.shaderTransformation,this.calculateShaderTransformation(this.transformation)),this.shaderTransformationDirty=!1);return this.shaderTransformation};c.prototype.getIndices=function(a){return"indices"in this.data?this.data.indices[a]:null};c.prototype.getAttribute=function(a){return"vertexAttr"in this.data?
this.data.vertexAttr[a]:null};c.prototype.addHighlight=function(a){var c=p.generateHighlightId(),d=this.instanceParameters;d.componentHighlights=m.addHighlight(d.componentHighlights,null,a,c);return c};c.prototype.removeHighlight=function(a){var c=this.instanceParameters;c.componentHighlights=m.removeHighlight(c.componentHighlights,a)};return c}()})},"esri/views/3d/webgl-engine/parts/View":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/has ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../lib/DrapedRenderer ../lib/GLMaterialRep ../lib/GLTextureRep ../lib/ProgramRepository ../lib/tracer ../lighting/Lightsources ./Model ./Viewport ../shaders/globalOptions ../../../support/screenshotUtils ../../../webgl/context-util ../../../webgl/FramebufferObject ../../../webgl/RenderingContext".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z){var A=k.getLogger("esri.views.3d.webgl-engine.parts.View");q=function(){function b(d,b,e,f){var h=this;this.options=f;this._backgroundColor=p.vec4f64.fromValues(1,1,1,1);this._lightDirection=m.vec3f64.fromValues(0,1,0);this._didRender=!1;this._idleSuspend=this._needsRender=!0;this._shouldRender=!1;this._supersampleScreenshots=!0;this._screenshotQueue=[];this._container=d;this._stage=b;this._initializeContext(f);d=y.glslifyGlobalOptions({viewingMode:f.viewingMode});
this._programRepository=new g(this._rctx,d);this._textureRep=new l(b.getAll(t.ContentType.TEXTURE),this._programRepository,function(){return h._viewport.getCamera().viewport},this._rctx);this._materialRep=new a(this._textureRep,this._programRepository);this._viewport=new r(this._stage,this._programRepository,this._materialRep,this._textureRep,this._rctx);this._initializeViewportCamera();this._drapedRenderer=new c(this._rctx,this._canvas,this._programRepository,this._materialRep,this._textureRep,e);
this._initializeFrameTask()}Object.defineProperty(b.prototype,"isLoadingResources",{get:function(){return this._viewport.isLoadingResources},enumerable:!0,configurable:!0});b.prototype._initializeFrameTask=function(){var a=this;this._frameTask={preRender:function(){e.begin();a._stage.processDirty();a.needsRender()?(a._shouldRender=!0,a._viewport.getCamera().setGLViewport(a._rctx),a._rctx.setClearColor.apply(a._rctx,a._backgroundColor),a._rctx.clearSafe(16640)):a._shouldRender=!1},render:function(){a._shouldRender&&
(a._didRender=!0,B.lightDirection=a._lightDirection,B.disableSlice=!1,a._viewport.render(B))},postRender:function(){e.end()},update:function(){a.resetNeedsRender();a._performScreenshots()}}};b.prototype._initializeViewportCamera=function(){var a=this._container.getBoundingClientRect(),c=this._viewport.getCamera();c.viewport[2]=a.width;c.viewport[3]=a.height;this._viewport.setCamera(c)};b.prototype._initializeContext=function(a){this._canvas=a.canvas;this._canvas||(this._canvas=document.createElement("canvas"));
this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");var c=x.createContextOrErrorHTML(this._canvas,{alpha:a.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==a.stencil?!0:a.stencil},a.renderContext);this._gl=e.instrumentContext(c);this._rctx=new z(this._gl,{disabledExtensions:a.deactivatedWebGLExtensions||{}});!a.alpha&&this._rctx.contextAttributes.alpha&&A.error("WebGL context has alpha channel even though no alpha channel was requested");!this._rctx.contextAttributes.alpha&&
11<=f("safari")&&(this._container.style.backgroundColor="black");this._container.appendChild(this._canvas);null!=a.supersampleScreenshots&&(this._supersampleScreenshots=a.supersampleScreenshots)};b.prototype.dispose=function(){this._viewport.dispose();this._viewport=null;this._drapedRenderer.dispose();this._drapedRenderer=null;this._programRepository.dispose();this._programRepository=null;this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask=this._gl=this._canvas=
this._container=null};b.prototype.getCombinedStats=function(){return this._viewport.getCombinedStats()};b.prototype.setNeedsRender=function(){this._didRender=!1;this._needsRender=!0};b.prototype.resetNeedsRender=function(){this._didRender&&(this._didRender=this._needsRender=!1);this._viewport.resetNeedsRender();this._textureRep.resetNeedsRender()};b.prototype.needsRender=function(){var a=this._viewport.getCamera();return 0===a.fullWidth||0===a.fullHeight?!1:this._needsRender||!this._idleSuspend||
this._viewport.needsRender()||this._textureRep.needsRender()};b.prototype.getFrameTask=function(){return this._frameTask};b.prototype.setLighting=function(a){h.vec3.set(this._lightDirection,0,0,0);for(var c=0,d=a.lights;c<d.length;c++){var b=d[c];if(b instanceof u.MainLight){h.vec3.negate(this._lightDirection,b.direction);break}}this._viewport.setLighting(a);this._needsRender=!0};b.prototype.ensureEdgeView=function(){return this._viewport.ensureEdgeView()};Object.defineProperty(b.prototype,"edgeView",
{get:function(){return this._viewport.edgeView},enumerable:!0,configurable:!0});b.prototype.getMainLightDirection=function(){return this._lightDirection};b.prototype.setViewParams=function(a){"backgroundColor"in a&&(this._needsRender=!0,this._backgroundColor=a.backgroundColor);"supersampleScreenshots"in a&&(this._supersampleScreenshots=a.supersampleScreenshots)};b.prototype.setRenderParams=function(a){this._needsRender=!0;void 0!==a.idleSuspend&&(this._idleSuspend=!!a.idleSuspend);this._viewport.setRenderParams(a)};
b.prototype.getRenderParams=function(){var a=this._viewport.getRenderParams();a.anisotropicFiltering=this._textureRep.getMaxAnisotropy();a.idleSuspend=this._idleSuspend;return a};Object.defineProperty(b.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0});b.prototype.has=function(a){return"s3tc"===a?!!this._rctx.capabilities.compressedTextureS3TC:"shaderTextureLOD"===a?!!this._rctx.capabilities.shaderTextureLOD:!1};b.prototype.modify=function(a,c,d,b){this._viewport.modify(a,
c,d,b)};b.prototype.setCamera=function(a){this._viewport.setCamera(a)};b.prototype.getCamera=function(){return this._viewport.getCamera()};b.prototype.getCanvas=function(){return this._canvas};b.prototype.getDrapedRenderer=function(){return this._drapedRenderer};b.prototype.takeScreenshot=function(a){var c=this,b=d.createResolver(function(){c._screenshotQueue=c._screenshotQueue.filter(function(a){return a.resolver!==b})});this._screenshotQueue.push({settings:a,resolver:b});this._needsRender=!0;return b.promise};
b.prototype.getFramebufferTexture=function(a){return this._viewport.getFramebufferTexture(a)};Object.defineProperty(b.prototype,"renderPlugins",{get:function(){return this._viewport.renderPlugins},enumerable:!0,configurable:!0});b.prototype._renderScreenshotOverlay=function(a,c,d){if(this.options.renderScreenshotOverlay){a.width=c.width;a.height=c.height;var b=a.getContext("2d"),e=this._viewport.getCamera().pixelRatio*d.pixelRatio;b.save();b.translate(0,c.height);b.scale(1,-1);d.region&&b.translate(-d.region.x,
-d.region.y);b.scale(e,e);this.options.renderScreenshotOverlay(a,c);b.restore()}};b.prototype._readbackScreenshot=function(a){return a.resample?this._readbackScreenshotResampled(a):this._readbackScreenshotImmediate(a)};b.prototype._readbackScreenshotResampled=function(a){var c=a.framebufferWidth,d=a.framebufferHeight,b=a.region,e=a.resample,f=this._ensureScreenshotEncodeCanvas(),g=w.createEmptyImageData(c,d,f);this._gl.readPixels(0,0,c,d,6408,5121,new Uint8Array(g.data.buffer));this._renderScreenshotOverlay(f,
g,n({},a,{region:null}));a=w.createEmptyImageData(b.width,b.height,f);return w.resampleHermite(g,a,!0,e.region.x,d-(e.region.y+e.region.height),e.region.width,e.region.height)};b.prototype._readbackScreenshotImmediate=function(a){var c=a.framebufferHeight,d=a.region,b=this._ensureScreenshotEncodeCanvas(),e=w.createEmptyImageData(d.width,d.height,b);this._gl.readPixels(d.x,c-(d.y+d.height),d.width,d.height,6408,5121,new Uint8Array(e.data.buffer));this._renderScreenshotOverlay(b,e,a);return e};b.prototype._renderScreenshot=
function(a){var c=null,d=this._viewport.getCamera(),b=w.screenshotSuperSampleSettings(a,this._supersampleScreenshots),e=b.framebufferWidth,f=b.framebufferHeight,g=!1,h=this._viewport.hasSlicePlane&&a.disableSlice;if(h=e!==d.fullWidth||f!==d.fullHeight||h){var l=d.copy();l.fullWidth=e;l.fullHeight=f;l.pixelRatio*=b.pixelRatio;c=d.fovX-l.fovX;g=d.fovY-l.fovY;0>c&&c<g?l.fovX=d.fovX:0>g&&g<c&&(l.fovY=d.fovY);this._drapedRenderer.forceUpdate&&this._drapedRenderer.forceUpdate(l);g=!0;c=new v(this._rctx,
{width:l.fullWidth,height:l.fullHeight,colorTarget:0,depthStencilTarget:3});this._rctx.bindFramebuffer(c);l.setGLViewport(this._rctx);this._rctx.setClearColor.apply(this._rctx,this._backgroundColor);this._rctx.clearSafe(16640);this._viewport.render({lightDirection:this._lightDirection,fbo:c,camera:l,disableSlice:a.disableSlice})}a=this._readbackScreenshot(b);if(h&&!this._rctx.contextAttributes.alpha)for(b=3;b<a.data.length;b+=4)a.data[b]=255;c&&c.dispose();this._rctx.bindFramebuffer(null);g&&this._drapedRenderer.forceUpdate&&
this._drapedRenderer.forceUpdate(d);return a};b.prototype._performScreenshots=function(){if(0!==this._screenshotQueue.length){for(var a=0,c=this._screenshotQueue;a<c.length;a++){var d=c[a],b=d.settings;if(this._gl){var e=this._ensureScreenshotEncodeCanvas(),f=this._renderScreenshot(b),b=w.encodeResult(f,b,e,{flipY:!0,premultipliedAlpha:!0});d.resolver(b)}else d.resolver.reject()}this._screenshotQueue=[]}};b.prototype._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=
document.createElement("canvas"));return this._screenshotEncodeCanvas};Object.defineProperty(b.prototype,"test",{get:function(){return{viewport:this._viewport}},enumerable:!0,configurable:!0});b.prototype.getGpuMemoryUsage=function(){return n({},this._viewport.getGpuMemoryUsage(),{draped:this._drapedRenderer?this._drapedRenderer.getGpuMemoryUsage():0})};return b}();var B={fbo:null,camera:null,lightDirection:m.vec3f64.create(),disableSlice:!1};return q})},"esri/views/3d/webgl-engine/lib/DrapedRenderer":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/debugFlags ../../webgl-engine/lib/intersectorUtils ./Camera ./DefaultVertexBufferLayouts ./glUtil3D ./GridLocalOriginFactory ./Renderer ../lighting/Lightsources ../materials/ColorMaterial ../materials/HUDMaterial ../materials/RibbonLineMaterial ../shaders/MiscPrograms ../../../webgl/FramebufferObject ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v){q=function(){function b(c,d,b,e,h,m){var p=this;this._renderTargets={};this._clearColor=k.vec4f64.fromValues(0,0,0,0);this._uniqueIdx=0;this._localOrigins=new a;this._rctx=c;this._canvas=d;this._programRep=b;this._modelDirtySet=m;this._modelDirtySet.onMaterialChanged=function(a){return p.materialChanged(a)};this._renderer=new l(b,e,h,this._rctx,"draped");this._renderer.onHasHighlightsChanged=function(a){if(p.onHasHighlightsChanged)p.onHasHighlightsChanged(a)};
this._renderer.setLighting({lights:[new g.AmbientLight(f.vec3f64.fromValues(1,1,1))],groundLightingFactor:1,globalFactor:0})}b.prototype.dispose=function(){for(var a in this._renderTargets)this._renderTargets[a].dispose();this._renderTargets=null;this._renderer.dispose();this._renderer=null};b.prototype.createRenderTarget=function(a){return this.createRenderTargetInternal(a,!0)};b.prototype.createHighlightRenderTarget=function(a){return this.createRenderTargetInternal(a,!1)};b.prototype.disposeRenderTarget=
function(a){var c=this._renderTargets[a];c&&c.dispose();delete this._renderTargets[a]};b.prototype.getRenderTargetTexture=function(a){return(a=this._renderTargets[a])?a.colorTexture:null};b.prototype.addRenderGeometries=function(a){var c=this;a.forEach(function(a){null==a.origin&&(a.origin=c._localOrigins.getOrigin(a.center));a.idx=c._uniqueIdx++});this._renderer.modify(a,[]);if(this.onContentChanged)this.onContentChanged()};b.prototype.removeRenderGeometries=function(a){this._renderer.modify([],
a);if(this.onContentChanged)this.onContentChanged()};b.prototype.updateRenderGeometries=function(a,c){a=a.map(function(a){return{renderGeometry:a,updateType:c}});this._renderer.modify([],[],a);if(this.onContentChanged)this.onContentChanged()};b.prototype.updateRenderOrder=function(a){if(0<a.size&&(this._renderer.modifyRenderOrder(a),this.onContentChanged))this.onContentChanged()};b.prototype.setBackgroundColor=function(a){this._clearColor=a;if(this.onContentChanged)this.onContentChanged()};b.prototype.updateHighlights=
function(a){this.updateRenderGeometries(a,16)};b.prototype.isEmpty=function(){return this._renderer.isEmpty()&&!d.OVERLAY_DRAW_TEST_TEXTURE};b.prototype.processDirtyMaterials=function(){var a=this._modelDirtySet.getDirtyMaterials();a&&this._renderer.modify([],[],[],a);this._modelDirtySet.clearDirtyMaterials()};Object.defineProperty(b.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});b.prototype.draw=function(a,c){return this.drawPass(0,
a,c)};b.prototype.drawHighlights=function(a,c){return this.drawPass(4,a,c)};b.prototype.drawPass=function(a,c,b){z=b.pixelRatio*Math.abs(b.views[0].extent[2]-b.views[0].extent[0])/Math.abs(b.views[0].viewport[2]-b.views[0].viewport[0]);if(this.isEmpty()||4===a&&!this.hasHighlights)return!1;this.processDirtyMaterials();if(!b.views.some(function(a){return a.extent[0]!==a.extent[2]&&a.extent[1]!==a.extent[3]}))return!1;c=this._renderTargets[c];if(!c)return!1;var e=this._rctx,f=b.width,g=b.height;if(c.width!==
f||c.height!==g)c.resize(f,g),c.colorTexture.setSamplingMode(9729);var h=B.camera;B.fbo=c;h.near=1;h.far=1E4;h.pixelRatio=b.pixelRatio||1;e.bindFramebuffer(c);e.setClearColor.apply(e,this._clearColor);e.clearSafe(16384);for(var l=0;l<b.views.length;l++){var m=b.views[l];h.viewport=m.viewport;n.mat4.ortho(h.projectionMatrix,0,m.extent[2]-m.extent[0],0,m.extent[3]-m.extent[1],h.near,h.far);n.mat4.identity(h.viewMatrix);n.mat4.translate(h.viewMatrix,h.viewMatrix,[-m.extent[0],-m.extent[1],0]);h.setGLViewport(this._rctx);
d.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(f,g,A[b.index%A.length]);this._renderer.renderPass(a,B)}e.bindFramebuffer(null);e.setViewport(0,0,this._canvas.width,this._canvas.height);c.colorTexture.descriptor.hasMipmap&&c.colorTexture.generateMipmap();return!0};b.prototype._drawTestTexture=function(a,d,b){var e=this._rctx;if(!this._testPatternTexture){for(var f=new Uint8Array(a*d*4),g=0,h=0;h<d;h++)for(var l=0;l<a;l++){var m=Math.floor(l/10),k=Math.floor(h/10);2>m||2>k||10*m>a-20||10*k>d-20?
(f[g++]=255,f[g++]=255,f[g++]=255,f[g++]=255):(f[g++]=255,f[g++]=255,f[g++]=255,m&1&&k&1?f[g++]=l&1^h&1?0:255:f[g++]=m&1^k&1?0:128)}this._testPatternTexture=new x(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:a,height:d},f);this._testPatternProgram=this._programRep.getProgram(r.texOnly);this._testPatternPipelineState=w.makePipelineState({blending:w.separateBlendingParams(770,1,771,771),colorWrite:w.defaultColorWriteParams});this._quadVAO=c.createQuadVAO(e,p.Pos3Tex)}a=this._testPatternProgram;
e.bindProgram(a);e.setPipelineState(this._testPatternPipelineState);a.setUniform4f("color",b[0],b[1],b[2],1);a.setUniform1i("tex",0);e.bindTexture(this._testPatternTexture,0);e.bindVAO(this._quadVAO);e.drawArrays(5,0,v.vertexCount(this._quadVAO,"geometry"))};b.prototype.materialChanged=function(a){if(this.onContentChanged)this.onContentChanged()};b.prototype.createRenderTargetInternal=function(a,c){for(var d=a,b=0;this._renderTargets[d];)d=a+"_"+ ++b;this._renderTargets[d]=y.createWithAttachments(this._rctx,
{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:c,maxAnisotropy:8,width:0,height:0},{colorTarget:0,depthStencilTarget:0});return d};b.prototype.getGpuMemoryUsage=function(){var a=0,c;for(c in this._renderTargets)a+=v.getGpuMemoryUsage(this._renderTargets[c]);return a};b.prototype.intersect=function(a,c,d){var b=this,f=0;this._renderer.forEachRenderGeometry(function(g){if(!d||d(g)){if(g.material instanceof e||g.material instanceof t||g.material instanceof u){var h=
g.transformation[12],l=g.transformation[13];C[0]=c[0]-h;C[1]=c[1]-l;C[2]=1;E[0]=c[0]-h;E[1]=c[1]-l;E[2]=0;g.pixelRatio=z;g.material.intersect(g,null,g.getShaderTransformation(),a,C,E,function(c,d,e,h,l,m){b.addIntersectionResult(c,d,e,g.material.renderPriority,f,l,m,a,g.data.layerUid,g.data.graphicUid)},g.calculateShaderTransformation,!0)}f++}})};b.prototype.addIntersectionResult=function(a,c,d,b,e,f,g,l,m,k){var p={type:"external",metadata:{layerUid:m,graphicUid:k}};a=function(a){a.set(p,null,l.results.terrain.dist,
l.results.terrain.normal,l.results.terrain.transformation,b,null,null,d,e);a.intersector="DrapedRenderer"};(null==l.results.min.drapedLayerOrder||b>=l.results.min.drapedLayerOrder)&&(null==l.results.min.dist||l.results.terrain.dist<=l.results.min.dist)&&a(l.results.min);(null==l.results.max.drapedLayerOrder||b<l.results.max.drapedLayerOrder)&&(null==l.results.max.dist||l.results.terrain.dist>l.results.max.dist)&&a(l.results.max);l.enable.storeAll&&(c=new h.IntersectorResult(l.ray),a(c),l.results.all.push(c))};
return b}();var z,A=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],B={fbo:null,camera:new m,lightDirection:f.vec3f64.fromValues(0,0,1)},C=f.vec3f64.create(),E=f.vec3f64.create();return q})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("require exports ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/SpatialReference ../../support/projectionUtils ./Geometry ./GeometryData ./Layer ./localOrigin ./Object3D ./Util ../materials/RibbonLineMaterial ../parts/Model".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t){var r=0;q=function(){function d(){this.ROOT_ORIGIN_ID="rg_root_"+r++;this._origins=new Map;this._gridSize=42E5;if(n.isSome(d.testOrigin)){var a=d.testOrigin;this._origins.set(this.ROOT_ORIGIN_ID,l.fromValues(a[0],a[1],a[2],this.ROOT_ORIGIN_ID))}}d.prototype.getOrigin=function(a){var c=this._origins.get(this.ROOT_ORIGIN_ID);if(null==c){var d=l.fromValues(a[0]+Math.random()-.5,a[1]+Math.random()-.5,a[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);this._origins.set(this.ROOT_ORIGIN_ID,
d);return d}k.vec3.subtract(w,a,c.vec3);w[0]=Math.abs(w[0]);w[1]=Math.abs(w[1]);w[2]=Math.abs(w[2]);d=this._gridSize;if(w[0]<d&&w[1]<d&&w[2]<d)return c;var c=Math.round(a[0]/d),b=Math.round(a[1]/d);a=Math.round(a[2]/d);var e="rg_"+c+"/"+b+"/"+a,f=this._origins.get(e);f||(f=l.fromValues(c*d,b*d,a*d,e),this._origins.set(e,f));return f};d.prototype._drawOriginBox=function(d){var b=window.view,f=b._stage;if(null==this._object){this._material=new u({width:2,color:[0,1,0,1]},"GridLocalOriginMaterial");
f.add(t.ContentType.MATERIAL,this._material);var l=new a("GridLocalOrigin",{isPickable:!1});f.add(t.ContentType.LAYER,l);this._object=new g({name:"GridLocalOrigin",idHint:"GridLocalOrigin",castShadow:!1});f.add(t.ContentType.OBJECT,this._object);l.addObject(this._object);f.addToViewContent([l.id])}for(var k=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],r=k.length,n=new Float32Array(3*r),l=new Uint32Array(2*(r-1)),x=.5*this._gridSize,v=0;v<r;v++)n[3*v+0]=d[0]+(k[v]&1?x:-x),n[3*v+1]=d[1]+(k[v]&2?x:-x),n[3*
v+2]=d[2]+(k[v]&4?x:-x),0<v&&(l[2*v+0]=v-1,l[2*v+1]=v);m.bufferToBuffer(n,h.WebMercator,0,n,b.spatialReference,0,r);b={};b[e.VertexAttrConstants.POSITION]={size:3,data:n};n={};n[e.VertexAttrConstants.POSITION]=l;l=new c(b,n,void 0,"line");l=new p(l,"GridLocalOriginBox");f.add(t.ContentType.GEOMETRY,l);this._object.addGeometry(l,this._material,y);console.log(this._origins.size,d)};return d}();var y=f.mat4f64.create(),w=d.vec3f64.create();(q||(q={})).testOrigin=null;return q})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("require exports ./BoundingInfo ./ComponentUtils ./geometryDataUtils ./IdGen ./Util ./Util".split(" "),
function(q,b,n,f,k,d,h,m){return function(){function b(c,a,d){this.singleUse=!1;this._componentAABBs=this._boundingInfo=null;this._id=b.__idGen.gen(a);this._data=c;this._boundingInfo=d}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});b.prototype.getIndices=function(c){return this.data.getIndices(c)};Object.defineProperty(b.prototype,"indexCount",
{get:function(){return this.data.indexCount},enumerable:!0,configurable:!0});b.prototype.getAttribute=function(c){return this.data.getAttribute(c)};Object.defineProperty(b.prototype,"componentCount",{get:function(){return f.componentCount(this.data.componentOffsets)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"componentOffsets",{get:function(){return this.data.componentOffsets},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vertexCount",{get:function(){return this.data.indexCount},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"faceCount",{get:function(){return this.data.indexCount/3},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"boundingInfo",{get:function(){null==this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo},enumerable:!0,configurable:!0});b.prototype.invalidateBoundingInfo=function(){this._componentAABBs=this._boundingInfo=null};b.prototype.getComponentAABB=function(c,a){null==this._componentAABBs&&
(this._componentAABBs=this._computeComponentAABBs());for(var d=0;6>d;d++)a[d]=this._componentAABBs[6*c+d];return a};b.prototype._computeComponentAABBs=function(){for(var c=this.componentCount,a=new Float32Array(6*c),d=0;d<c;d++)this._calculateAABB(d,a,6*d);return a};b.prototype._calculateAABB=function(c,a,d){void 0===d&&(d=0);var b=this.data.getIndices(m.VertexAttrConstants.POSITION),e=this.data.getAttribute(m.VertexAttrConstants.POSITION),f=this.data.componentOffsets,h=f.length?f[c+1]:b.length,l=
Infinity,k=Infinity,p=Infinity,n=-Infinity,v=-Infinity,q=-Infinity,A=e.offsetIdx,B=e.strideIdx;for(c=f.length?f[c]:0;c<h;c++)var C=A+B*b[c],f=e.data[C],E=e.data[C+1],C=e.data[C+2],l=Math.min(l,f),k=Math.min(k,E),p=Math.min(p,C),n=Math.max(n,f),v=Math.max(v,E),q=Math.max(q,C);a[d]=l;a[d+1]=k;a[d+2]=p;a[d+3]=n;a[d+4]=v;a[d+5]=q};b.prototype._calculateBoundingInfo=function(){var c=this.data.getIndices(m.VertexAttrConstants.POSITION),a=this.data.getAttribute(m.VertexAttrConstants.POSITION),d="triangle"===
this.data.primitiveType?3:1;if(0===c.length)for(var c=new Uint32Array(d),b=0;b<d;++b)c[b]=b;b=c.length;h.assert(0===b%d);b=k.generateDefaultIndexArray(b/d);return new n(b,d,c,a)};b.__idGen=new d;return b}()})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./Util".split(" "),function(q,b,n,f,k,d){q=function(){function b(h,p,c,a){d.assert(1<=h.length);d.assert(0===
c.length%p);d.assert(c.length>=h.length*p);d.assert(3===a.size||4===a.size);this.primitiveIndices=h;this.indices=c;this._position=a;this._numIndexPerPrimitive=p;var l=a.data,g=a.offsetIdx,e=a.strideIdx;a=0;var m=h.length,t=g+e*c[p*h[a]];b.tmpIndices.clear();b.tmpIndices.push(t);this.bbMin=k.vec3f64.fromValues(l[t],l[t+1],l[t+2]);for(this.bbMax=k.vec3f64.clone(this.bbMin);a<m;++a)for(var r=p*h[a],n=0;n<p;++n){t=g+e*c[r+n];b.tmpIndices.push(t);var w=l[t];this.bbMin[0]=Math.min(w,this.bbMin[0]);this.bbMax[0]=
Math.max(w,this.bbMax[0]);w=l[t+1];this.bbMin[1]=Math.min(w,this.bbMin[1]);this.bbMax[1]=Math.max(w,this.bbMax[1]);w=l[t+2];this.bbMin[2]=Math.min(w,this.bbMin[2]);this.bbMax[2]=Math.max(w,this.bbMax[2])}this.center=k.vec3f64.create();f.vec3.lerp(this.center,this.bbMin,this.bbMax,.5);this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);h=this.bsRadius*this.bsRadius;for(a=0;a<b.tmpIndices.length;++a)t=b.tmpIndices.data[a],p=l[t]-this.center[0],
c=l[t+1]-this.center[1],t=l[t+2]-this.center[2],g=p*p+c*c+t*t,g<=h||(g=Math.sqrt(g),e=.5*(g-this.bsRadius),this.bsRadius+=e,h=this.bsRadius*this.bsRadius,g=e/g,this.center[0]+=p*g,this.center[1]+=c*g,this.center[2]+=t*g);b.tmpIndices.clear()}b.prototype.getCenter=function(){return this.center};b.prototype.getBSRadius=function(){return this.bsRadius};b.prototype.getBBMin=function(){return this.bbMin};b.prototype.getBBMax=function(){return this.bbMax};b.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};
b.prototype.getIndices=function(){return this.indices};b.prototype.getPosition=function(){return this._position};b.prototype.getChildren=function(){if(this.children)return this.children;if(1<f.vec3.squaredDistance(this.bbMin,this.bbMax)){for(var d=f.vec3.lerp(k.vec3f64.create(),this.bbMin,this.bbMax,.5),h=this.primitiveIndices.length,c=new Uint8Array(h),a=Array(8),l=0;8>l;++l)a[l]=0;for(var l=this._position,g=l.data,e=l.offsetIdx,n=l.strideIdx,l=0;l<h;++l){for(var t=0,r=this._numIndexPerPrimitive*
this.primitiveIndices[l],y=e+n*this.indices[r],w=g[y],x=g[y+1],v=g[y+2],q=1;q<this._numIndexPerPrimitive;++q){var y=e+n*this.indices[r+q],A=g[y],B=g[y+1],y=g[y+2];A<w&&(w=A);B<x&&(x=B);y<v&&(v=y)}w<d[0]&&(t|=1);x<d[1]&&(t|=2);v<d[2]&&(t|=4);c[l]=t;++a[t]}for(l=d=0;8>l;++l)0<a[l]&&++d;if(2>d)return;d=Array(8);for(l=0;8>l;++l)d[l]=0<a[l]?new Uint32Array(a[l]):void 0;for(l=0;8>l;++l)a[l]=0;for(l=0;l<h;++l)t=c[l],d[t][a[t]++]=this.primitiveIndices[l];this.children=Array(8);for(l=0;8>l;++l)void 0!==d[l]&&
(this.children[l]=new b(d[l],this._numIndexPerPrimitive,this.indices,this._position))}return this.children};return b}();(q||(q={})).tmpIndices=new n({deallocator:null});return q})},"esri/views/3d/webgl-engine/lib/Layer":function(){define("require exports ../../../../core/arrayUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./IdGen ./ModelContentType ./Octree".split(" "),function(q,b,n,f,k,d,h,m){return function(){function b(c,a,d){this._parentStages=[];this._children=
new Set;this.id=b._idGen.gen(c);this.apiLayerUid=d;this.name=c;a=a||{};this.group=a.group||"";this.isVisible=null!=a.isVisible?a.isVisible:!0;this.isPickable=null!=a.isPickable?a.isPickable:!0;this.isSliceable=!1;this.translation=a.translation?k.vec3f64.clone(a.translation):k.vec3f64.create();this._extent=[k.vec3f64.fromValues(0,0,0),k.vec3f64.fromValues(1E3,1E3,1E3)];this._extentDirty=!0}b.prototype.addParentStage=function(c){-1===this._parentStages.indexOf(c)&&this._parentStages.push(c)};b.prototype.removeParentStage=
function(c){c=this._parentStages.indexOf(c);-1<c&&this._parentStages.splice(c,1);this.invalidateSpatialQueryAccelerator()};b.prototype.getName=function(){return this.name};b.prototype.getGroup=function(){return this.group};b.prototype.getTranslation=function(){return this.translation};b.prototype.getObjectIds=function(){return n.keysOfSet(this._children,function(c){return c.id})};b.prototype.getObjects=function(){return n.keysOfSet(this._children)};b.prototype.getExtent=function(){this._updateExtent();
return this._extent};b.prototype.addObject=function(c){this._children.add(c);c.parentLayer=this;this.notifyDirty("layObjectAdded",c);this._invalidateExtent();this._octree&&this._octree.add(c)};b.prototype.hasObject=function(c){return this._children.has(c)};b.prototype.removeObject=function(c){return this._children.delete(c)?(c.parentLayer=null,this.notifyDirty("layObjectRemoved",c),this._invalidateExtent(),this._octree&&this._octree.remove(c),!0):!1};b.prototype.notifyObjectBBChanged=function(c,a){this._octree&&
this._octree.update(c,a)};b.prototype.getCenter=function(){this._updateExtent();var c=k.vec3f64.create();return f.vec3.lerp(c,this._extent[0],this._extent[1],.5)};b.prototype.getBSRadius=function(){this._updateExtent();return.5*f.vec3.distance(this._extent[0],this._extent[1])};b.prototype.getSpatialQueryAccelerator=function(){!this._octree&&50<this._children.size&&this._createOctree();return this._octree};b.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",
null)};b.prototype.invalidateSpatialQueryAccelerator=function(){this._octree&&(this._octree.destroy(),this._octree=null)};b.prototype.notifyDirty=function(c,a,d,b){d=d||h.LAYER;b=b||this;for(var e=0;e<this._parentStages.length;e++)this._parentStages[e].notifyDirty(d,b,c,a)};b.prototype._createOctree=function(){for(var c=this.getExtent(),a=0,d=0;3>d;d++)a=Math.max(a,c[1][d]-c[0][d]);d=k.vec3f64.create();f.vec3.lerp(d,c[0],c[1],.5);this._octree=new m(d,1.2*a,{getRadius:function(a){return a.getBSRadius()},
getCenter:function(a){return a.getCenter()}});this._octree.add(n.keysOfSet(this._children))};b.prototype._invalidateExtent=function(){this._extentDirty=!0};b.prototype._updateExtent=function(){var c=this;if(this._extentDirty)if(this._extentDirty=!1,0===this._children.size)this._extent=[[0,0,0],[0,0,0]];else{var a=null;this._children.forEach(function(d){var b=d.getBBMin();d=d.getBBMax();if(a)for(var e=0;3>e;++e)c._extent[0][e]=Math.min(c._extent[0][e],b[e]),c._extent[1][e]=Math.max(c._extent[1][e],
d[e]);else a=[k.vec3f64.clone(b),k.vec3f64.clone(d)]});this._extent=a}};b._idGen=new d;return b}()})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("require exports ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ./Util".split(" "),function(q,b,n,f,k,d,h,m){function p(a,c,d){d=d||a;d[0]=a[0]+c;d[1]=a[1]+c;d[2]=a[2]+c;return d}function c(a,c,d){return!h.frustum.intersectsSphere(d.planes,
h.sphere.wrap(c,a))}function a(a,c,d){if(!D.length)for(var b=0;8>b;++b)D.push({index:0,distance:0});for(b=0;8>b;++b){var e=u[b];D.data[b].index=b;D.data[b].distance=g(a,c,e)}D.sort(function(a,c){return a.distance-c.distance});d.clear();for(b=0;8>b;++b)d.push(D.data[b].index)}function l(a,c){for(var d=Infinity,b=null,e=0;8>e;++e){var f=g(a,c,t[e]);f<d&&(d=f,b=t[e])}return b}function g(a,c,d){return c*(a[0]*d[0]+a[1]*d[1]+a[2]*d[2])}q=function(){function b(a,c,b,f){this._maximumObjectsPerNode=10;this._maximumDepth=
20;this._degenerateObjects=new Set;this._objectCount=0;this._objectToBoundingSphere=b;f&&(void 0!==f.maximumObjectsPerNode&&(this._maximumObjectsPerNode=f.maximumObjectsPerNode),void 0!==f.maximumDepth&&(this._maximumDepth=f.maximumDepth));isNaN(a[0])||isNaN(a[1])||isNaN(a[2])||isNaN(c)?this._root=new e(null,d.vec3f64.fromValues(0,0,0),.5):this._root=new e(null,a,c/2)}Object.defineProperty(b.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"objectCount",
{get:function(){return this._objectCount},enumerable:!0,configurable:!0});b.prototype.destroy=function(){this._degenerateObjects.clear();this._root=null;e.clearPool();y=[null];A.prune();D.prune();G.prune()};b.prototype.add=function(a,c){a=this._objectOrObjectsArray(a);c=null==c?a.length:c;this._objectCount+=c;this._grow(a);for(var d=e.acquire(),b=0;b<c;b++){var f=a[b];d.init(this._root);this._isDegenerate(f)?this._degenerateObjects.add(f):this._add(f,d)}e.release(d)};b.prototype.remove=function(a,
c){a=this._objectOrObjectsArray(a);this._objectCount-=a.length;for(var d=e.acquire(),b=0;b<a.length;b++){var f=a[b],g=c||this._boundingSphereFromObject(f,B);this._isValidRadius(g.radius)?(d.init(this._root),this._remove(f,g,d)):this._degenerateObjects.delete(f)}e.release(d);this._shrink()};b.prototype.update=function(a,c){if(this._isValidRadius(c.radius)||!this._isDegenerate(a))this.remove(a,c),this.add(a)};b.prototype.forEachAlongRay=function(a,c,d){var b=this;this._forEachNode(this._root,function(e){if(!b._intersectsNode(a,
c,e))return!1;e=e.node;e.terminals.forEach(function(e){b._intersectsObject(a,c,e)&&d(e)});null!==e.residents&&e.residents.forEach(function(e){b._intersectsObject(a,c,e)&&d(e)});return!0})};b.prototype.forEach=function(a){this._forEachNode(this._root,function(c){c=c.node;c.terminals.forEach(a);null!==c.residents&&c.residents.forEach(a);return!0});this._degenerateObjects.forEach(a)};b.prototype.forEachDegenerateObject=function(a){this._degenerateObjects.forEach(a)};b.prototype.findClosest=function(a,
c,d,b,e){return this._findClosest(a,"front-to-back"===c?1:-1,d,b,e)};b.prototype.forEachInDepthRange=function(a,c,d,b,e,f,g,h){this._forEachInDepthRange(a,c,"front-to-back"===d?1:-1,b,e,f,g,h)};b.prototype.forEachNode=function(a){this._forEachNode(this._root,function(c){return a(c.node,c.center,2*c.halfSize)})};b.prototype._intersectsNode=function(a,c,d){p(d.center,2*-d.halfSize,v);p(d.center,2*d.halfSize,z);return m.rayBoxTest(a,c,v,z)};b.prototype._intersectsObject=function(a,c,d){var b=this._objectToBoundingSphere.getRadius(d);
return 0<b?h.sphere.intersectsRay(h.sphere.wrap(b,this._objectToBoundingSphere.getCenter(d)),h.ray.wrap(a,c)):!0};b.prototype._forEachNode=function(a,c){a=e.acquire().init(a);for(var d=[a];0!==d.length;){a=d.pop();if(c(a)&&!a.isLeaf())for(var b=0;b<a.node.children.length;b++)a.node.children[b]&&d.push(e.acquire().init(a).advance(b));e.release(a)}};b.prototype._forEachNodeDepthOrdered=function(c,d,b,f){void 0===f&&(f=1);c=e.acquire().init(c);var g=[c];for(a(b,f,G);0!==g.length;){c=g.pop();if(d(c)&&
!c.isLeaf())for(b=7;0<=b;--b)f=G.data[b],f>=c.node.children.length||c.node.children[f]&&g.push(e.acquire().init(c).advance(f));e.release(c)}};b.prototype._findClosest=function(a,d,b,e,f){var h=this,m=Infinity,p=Infinity,t=null,n=l(a,d),u=0,v=function(f){++u;if(!e||e(f)){var l=h._objectToBoundingSphere.getCenter(f),k=h._objectToBoundingSphere.getRadius(f);if(!b||!c(l,k,b)){var l=g(a,d,l),r=l-k;r<m&&(m=r,p=l+k,t=f)}}};this._forEachNodeDepthOrdered(this._root,function(e){if(null!=f&&u>=f||b&&c(e.center,
e.halfSize*r,b))return!1;k.vec3.scale(x,n,e.halfSize);k.vec3.add(x,x,e.center);if(g(a,d,x)>p)return!1;e=e.node;e.terminals.forEach(function(a){v(a)});null!==e.residents&&e.residents.forEach(function(a){v(a)});return!0},a,d);return t};b.prototype._forEachInDepthRange=function(a,d,b,e,f,h,m,p){var t=this,n=-Infinity,u=Infinity,v={setRange:function(a){1===b?(n=Math.max(n,a.near),u=Math.min(u,a.far)):(n=Math.max(n,-a.far),u=Math.min(u,-a.near))}};v.setRange(e);var y=g(d,b,a),w=l(d,b),q=l(d,-1*b),z=0,
A=function(a){++z;if(!m||m(a)){var e=t._objectToBoundingSphere.getCenter(a),l=t._objectToBoundingSphere.getRadius(a),k=g(d,b,e)-y;k-l>u||k+l<n||h&&c(e,l,h)||f(a,v)}};this._forEachNodeDepthOrdered(this._root,function(a){if(null!=p&&z>=p||h&&c(a.center,a.halfSize*r,h))return!1;k.vec3.scale(x,w,a.halfSize);k.vec3.add(x,x,a.center);if(g(d,b,x)-y>u)return!1;k.vec3.scale(x,q,a.halfSize);k.vec3.add(x,x,a.center);if(g(d,b,x)-y<n)return!1;a=a.node;a.terminals.forEach(function(a){A(a)});null!==a.residents&&
a.residents.forEach(function(a){A(a)});return!0},d,b)};b.prototype._objectOrObjectsArray=function(a){if(Array.isArray(a))return a;y[0]=a;return y};b.prototype._remove=function(a,c,d){A.clear();c=d.advanceTo(c,function(a,c){A.push(a.node);A.push(c)})?d.node.terminals:d.node.residents;c.removeUnordered(a);if(0===c.length)for(a=A.length-2;0<=a&&this._purge(A.data[a],A.data[a+1]);a-=2);};b.prototype._nodeIsEmpty=function(a){if(0!==a.terminals.length)return!1;if(null!==a.residents)return 0===a.residents.length;
for(var c=0;c<a.children.length;c++)if(a.children[c])return!1;return!0};b.prototype._purge=function(a,c){0<=c&&(a.children[c]=null);return this._nodeIsEmpty(a)?(null===a.residents&&(a.residents=new f({shrink:!0})),!0):!1};b.prototype._add=function(a,c){c.advanceTo(this._boundingSphereFromObject(a,B))?c.node.terminals.push(a):(c.node.residents.push(a),c.node.residents.length>this._maximumObjectsPerNode&&c.depth<this._maximumDepth&&this._split(c))};b.prototype._split=function(a){var c=a.node.residents;
a.node.residents=null;for(var d=0;d<c.length;d++){var b=e.acquire().init(a);this._add(c.data[d],b);e.release(b)}};b.prototype._grow=function(a){var c=this;if(0!==a.length&&(a=this._boundingSphereFromObjects(a,function(a,d){return c._boundingSphereFromObject(a,d)},C),this._isValidRadius(a.radius)&&!this._fitsInsideTree(a)))if(this._nodeIsEmpty(this._root.node))k.vec3.copy(this._root.center,a.center),this._root.halfSize=1.25*a.radius;else{var d=e.acquire();this._rootBoundsForRootAsSubNode(a,d);this._placingRootViolatesMaxDepth(d)?
this._rebuildTree(a,d):this._growRootAsSubNode(d);e.release(d)}};b.prototype._rebuildTree=function(a,c){var d=this;k.vec3.copy(E.center,c.center);E.radius=c.halfSize;a=this._boundingSphereFromObjects([a,E],function(a){return a},F);c=e.acquire().init(this._root);this._root.initFrom(null,a.center,1.25*a.radius);this._forEachNode(c,function(a){d.add(a.node.terminals.data,a.node.terminals.length);null!==a.node.residents&&d.add(a.node.residents.data,a.node.residents.length);return!0});e.release(c)};b.prototype._placingRootViolatesMaxDepth=
function(a){var c=0;this._forEachNode(this._root,function(a){c=Math.max(c,a.depth);return!0});return c+Math.log(a.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth};b.prototype._rootBoundsForRootAsSubNode=function(a,c){var d=a.radius,b=a.center;a=-Infinity;for(var e=this._root.center,f=this._root.halfSize,g=0;3>g;g++){var h=Math.max(0,Math.ceil((e[g]-f-(b[g]-d))/(2*f))),l=Math.max(0,Math.ceil((b[g]+d-(e[g]+f))/(2*f)))+1;a=Math.max(a,Math.pow(2,Math.ceil(Math.log(h+l)*Math.LOG2E)));H[g].min=
h;H[g].max=l}for(g=0;3>g;g++)h=H[g].min,l=H[g].max,d=(a-(h+l))/2,h+=Math.ceil(d),l+=Math.floor(d),w[g]=e[g]-f-h*f*2+(l+h)*f;return c.initFrom(null,w,a*f,0)};b.prototype._growRootAsSubNode=function(a){var c=this._root.node;k.vec3.copy(C.center,this._root.center);C.radius=this._root.halfSize;this._root.init(a);a.advanceTo(C,null,!0);a.node.children=c.children;a.node.residents=c.residents;a.node.terminals=c.terminals};b.prototype._shrink=function(){for(;;){var a=this._findShrinkIndex();if(-1===a)break;
this._root.advance(a);this._root.depth=0}};b.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var a=null,c=this._root.node.children,d=0,b=0;b<c.length&&null==a;)d=b++,a=c[d];for(;b<c.length;)if(c[b++])return-1;return d};b.prototype._isDegenerate=function(a){a=this._objectToBoundingSphere.getRadius(a);return!this._isValidRadius(a)};b.prototype._isValidRadius=function(a){return!isNaN(a)&&-Infinity!==a&&Infinity!==a&&0<a};b.prototype._fitsInsideTree=
function(a){var c=this._root.center,d=this._root.halfSize,b=a.center;return a.radius<=d&&b[0]>=c[0]-d&&b[0]<=c[0]+d&&b[1]>=c[1]-d&&b[1]<=c[1]+d&&b[2]>=c[2]-d&&b[2]<=c[2]+d};b.prototype._boundingSphereFromObject=function(a,c){k.vec3.copy(c.center,this._objectToBoundingSphere.getCenter(a));c.radius=this._objectToBoundingSphere.getRadius(a);return c};b.prototype._boundingSphereFromObjects=function(a,c,d){if(1===a.length){var b=c(a[0],C);k.vec3.copy(d.center,b.center);d.radius=b.radius}else{v[0]=Infinity;
v[1]=Infinity;v[2]=Infinity;z[0]=-Infinity;z[1]=-Infinity;z[2]=-Infinity;for(var e=0;e<a.length;e++)if(b=c(a[e],C),this._isValidRadius(b.radius)){var f=v,g=b.center,h=b.radius;f[0]=Math.min(f[0],g[0]-h);f[1]=Math.min(f[1],g[1]-h);f[2]=Math.min(f[2],g[2]-h);f=z;g=b.center;b=b.radius;f[0]=Math.max(f[0],g[0]+b);f[1]=Math.max(f[1],g[1]+b);f[2]=Math.max(f[2],g[2]+b)}k.vec3.lerp(d.center,v,z,.5);d.radius=Math.max(z[0]-v[0],z[1]-v[1],z[2]-v[2])/2}return d};return b}();var e=function(){function a(a,c,b,e){void 0===
b&&(b=0);void 0===e&&(e=0);this.center=d.vec3f64.create();this.initFrom(a,c,b,0)}a.prototype.init=function(a){return this.initFrom(a.node,a.center,a.halfSize,a.depth)};a.prototype.initFrom=function(c,d,b,e){void 0===c&&(c=null);void 0===b&&(b=this.halfSize);void 0===e&&(e=this.depth);this.node=c||a.createEmptyNode();d&&k.vec3.copy(this.center,d);this.halfSize=b;this.depth=e;return this};a.prototype.advance=function(c){var d=this.node.children[c];d||(d=a.createEmptyNode(),this.node.children[c]=d);
this.node=d;this.halfSize/=2;this.depth++;c=u[c];this.center[0]+=c[0]*this.halfSize;this.center[1]+=c[1]*this.halfSize;this.center[2]+=c[2]*this.halfSize;return this};a.prototype.advanceTo=function(a,c,d){for(void 0===d&&(d=!1);;){if(this.isTerminalFor(a))return c&&c(this,-1),!0;if(this.isLeaf()&&!d)return c&&c(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var b=this._childIndex(a);c&&c(this,b);this.advance(b)}};a.prototype.isLeaf=function(){return null!=this.node.residents};a.prototype.isTerminalFor=
function(a){return a.radius>this.halfSize/2};a.prototype._childIndex=function(a){a=a.center;for(var c=this.center,d=0,b=0;3>b;b++)c[b]<a[b]&&(d|=1<<b);return d};a.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new f({shrink:!0}),residents:new f({shrink:!0})}};a.acquire=function(){return a._pool.acquire()};a.release=function(c){a._pool.release(c)};a.clearPool=function(){a._pool.prune()};a._pool=new n(a);return a}(),u=[d.vec3f64.fromValues(-1,-1,-1),d.vec3f64.fromValues(1,
-1,-1),d.vec3f64.fromValues(-1,1,-1),d.vec3f64.fromValues(1,1,-1),d.vec3f64.fromValues(-1,-1,1),d.vec3f64.fromValues(1,-1,1),d.vec3f64.fromValues(-1,1,1),d.vec3f64.fromValues(1,1,1)],t=[d.vec3f64.fromValues(-1,-1,-1),d.vec3f64.fromValues(-1,-1,1),d.vec3f64.fromValues(-1,1,-1),d.vec3f64.fromValues(-1,1,1),d.vec3f64.fromValues(1,-1,-1),d.vec3f64.fromValues(1,-1,1),d.vec3f64.fromValues(1,1,-1),d.vec3f64.fromValues(1,1,1)],r=Math.sqrt(3),y=[null],w=d.vec3f64.create(),x=d.vec3f64.create(),v=d.vec3f64.create(),
z=d.vec3f64.create(),A=new f,B={center:d.vec3f64.create(),radius:0},C={center:d.vec3f64.create(),radius:0},E={center:d.vec3f64.create(),radius:0},F={center:d.vec3f64.create(),radius:0},H=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],D=new f,G=new f;return q})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Logger ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/MaterialUtil ./renderers/InstancedRenderer ./renderers/MergedRenderer ../shaders/RibbonLinePrograms ../../../webgl/renderState".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w){var x=f.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");q=function(c){function b(a,d){d=c.call(this,d)||this;d.params=u.copyParameters(a,A);"miter"!==d.params.join&&(d.params.miterLimit=0);d.numVertsAtJoin="wall"===d.params.type?2:4;d.numVertsAtCap=2;d.canBeMerged="screen"===d.params.type&&null==d.params.stippleLength;return d}n(b,c);b.prototype.getColor=function(){return this.params.color};b.prototype.dispose=function(){};b.prototype.setParameterValues=
function(a){for(var c in a)e.assert("type"!==c,"RibbonLineMaterial: type cannot be changed after creation"),e.assert("stippleLength"!==c||null!=a[c]===(null!=this.params[c]),"RibbonLineMaterial: stippleLength on/off cannot be changed after creation"),this.params[c]=a[c];"miter"!==this.params.join&&(this.params.miterLimit=0);this.notifyDirty("matChanged")};b.prototype.getParameters=function(){return this.params};b.prototype.intersect=function(a,c,d,b,e,f,g,h,l){l?u.intersectDrapedRenderLineGeometry(a,
c,d,b,e,f,this.params.width,g):this.intersectLineGeometry(a,c,d,b,e,f,g)};b.prototype.intersectLineGeometry=function(c,b,f,g,l,m,k,r){if(g.enable.selectionMode&&!a.isAllHidden(b.componentVisibilities,c.componentOffsets))if(e.isTranslationMatrix(f)){b=c.data;c=b.getVertexAttr()[e.VertexAttrConstants.POSITION].data;b=(b=b.getVertexAttr()[e.VertexAttrConstants.SIZE])&&b.data[0];m=g.camera;r=P;d.vec2.copy(r,g.point);b=(b+this.params.width*m.pixelRatio)/2+4*m.pixelRatio;h.vec3.set(I[0],r[0]-b,r[1]+b,0);
h.vec3.set(I[1],r[0]+b,r[1]+b,0);h.vec3.set(I[2],r[0]+b,r[1]-b,0);h.vec3.set(I[3],r[0]-b,r[1]-b,0);for(var t=0;4>t;t++)m.unprojectPoint(I[t],V[t]);p.plane.fromPoints(m.eye,V[0],V[1],X);p.plane.fromPoints(m.eye,V[1],V[2],W);p.plane.fromPoints(m.eye,V[2],V[3],ca);p.plane.fromPoints(m.eye,V[3],V[0],da);l=Number.MAX_VALUE;for(t=0;t<c.length-5;t+=3)if(K[0]=c[t]+f[12],K[1]=c[t+1]+f[13],K[2]=c[t+2]+f[14],M[0]=c[t+3]+f[12],M[1]=c[t+4]+f[13],M[2]=c[t+5]+f[14],!(0>p.plane.signedDistance(X,K)&&0>p.plane.signedDistance(X,
M)||0>p.plane.signedDistance(W,K)&&0>p.plane.signedDistance(W,M)||0>p.plane.signedDistance(ca,K)&&0>p.plane.signedDistance(ca,M)||0>p.plane.signedDistance(da,K)&&0>p.plane.signedDistance(da,M))){m.projectPoint(K,L);m.projectPoint(M,T);if(0>L[2]&&0<T[2]){h.vec3.subtract(O,K,M);var n=m.frustum,u=-p.plane.signedDistance(n.planes[4],K),n=u/h.vec3.dot(O,n.planes[4]);h.vec3.scale(O,O,n);h.vec3.add(K,K,O);m.projectPoint(K,L)}else if(0<L[2]&&0>T[2])h.vec3.subtract(O,M,K),n=m.frustum,u=-p.plane.signedDistance(n.planes[4],
M),n=u/h.vec3.dot(O,n.planes[4]),h.vec3.scale(O,O,n),h.vec3.add(M,M,O),m.projectPoint(M,T);else if(0>L[2]&&0>T[2])continue;L[2]=0;T[2]=0;n=p.lineSegment.distance2(p.lineSegment.fromPoints(L,T,U),r);n<l&&(l=n,h.vec3.copy(R,K),h.vec3.copy(J,M))}f=g.rayBeginPoint;g=g.rayEndPoint;l<b*b&&(c=Number.MAX_VALUE,p.lineSegment.closestLineSegmentPoint(p.lineSegment.fromPoints(R,J,U),p.lineSegment.fromPoints(f,g,Q),N)&&(h.vec3.subtract(N,N,f),c=h.vec3.length(N),h.vec3.scale(N,N,1/c),c/=h.vec3.distance(f,g)),k(c,
N))}else x.error("intersection assumes a translation-only matrix")};b.prototype.createBufferWriter=function(){return"wall"===this.params.type?new F:new C(this.canBeMerged)};b.prototype.createRenderer=function(a,c){return this.canBeMerged?new r(a,c,this):new t(a,c,this)};b.prototype.getGLMaterials=function(){return{color:v,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:z}};b.prototype.getAllTextureIds=function(){return[]};return b}(g);var v=function(a){function c(c,d){c=a.call(this,c,d)||
this;c.updateParameters();return c}n(c,a);c.prototype.updateParameters=function(){this.params=u.copyParameters(this.material.getParameters());this.selectProgram()};c.prototype.beginSlot=function(a){return a===(this.params.writeDepth?6:9)};c.prototype.getProgram=function(){return this.program};c.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(y.colorPass,{screenScale:"screen"===a.type,wall:"wall"===a.type,stipple:null!=a.stippleLength,slice:a.slicePlaneEnabled});
this.pipelineState=w.makePipelineState({blending:w.separateBlendingParams(770,1,771,771),polygonOffset:a.polygonOffset&&H,depthTest:{func:513},depthWrite:1<=a.color[3]&&a.writeDepth&&w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams})};c.prototype.bind=function(a,c){var d=this.program,b=this.params;a.bindProgram(d);a.setPipelineState(this.pipelineState);d.setUniform4fv("eColor",b.color);d.setUniform1f("miterLimit",b.miterLimit);d.setUniform1f("nearPlane",c.nearFar[0]);d.setUniform1f("pixelRatio",
c.pixelRatio);d.setUniform1f("extLineWidth",b.width);"screen"===b.type&&d.setUniform2fv("screenSize",[c.viewport[2],c.viewport[3]]);null!=b.stippleLength&&d.setUniform1f("stippleLengthDoubleInv",b.stippleLength?1/(2*b.stippleLength):0)};c.prototype.release=function(a){};c.prototype.bindView=function(a,c){a=this.program;var d=this.params;u.bindView(c.origin,c.view,a);d.slicePlaneEnabled&&u.bindSlicePlane(c.origin,c.slicePlane,a)};c.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",
c.transformation)};c.prototype.getDrawMode=function(){return 5};return c}(l),z=function(a){function c(c,d){c=a.call(this,c,d)||this;c.updateParameters();return c}n(c,a);c.prototype.updateParameters=function(){this.params=u.copyParameters(this.material.getParameters());this.selectProgram()};c.prototype.beginSlot=function(a){return 4===a};c.prototype.getProgram=function(){return this.program};c.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(y.highlightPass,
{screenScale:"screen"===a.type,wall:"wall"===a.type,stipple:null!=a.stippleLength,slice:a.slicePlaneEnabled});this.pipelineState=w.makePipelineState({polygonOffset:a.polygonOffset&&H,depthTest:{func:513},depthWrite:1<=a.color[3]&&w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams})};c.prototype.bind=function(a,c){var d=this.program,b=this.params;a.bindProgram(d);a.setPipelineState(this.pipelineState);u.bindHighlightRendering(a,c,d);d.setUniform4fv("eColor",b.color);d.setUniform1f("miterLimit",
b.miterLimit);d.setUniform1f("nearPlane",c.nearFar[0]);d.setUniform1f("pixelRatio",c.pixelRatio);d.setUniform1f("extLineWidth",b.width);"screen"===b.type&&d.setUniform2fv("screenSize",[c.viewport[2],c.viewport[3]]);null!=b.stippleLength&&d.setUniform1f("stippleLengthDoubleInv",b.stippleLength?1/(2*b.stippleLength):0)};c.prototype.release=function(a){};c.prototype.bindView=function(a,c){a=this.program;var d=this.params;u.bindView(c.origin,c.view,a);d.slicePlaneEnabled&&u.bindSlicePlane(c.origin,c.slicePlane,
a)};c.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",c.transformation)};c.prototype.getDrawMode=function(){return 5};return c}(l),A={color:[1,1,1,1],width:0,type:"screen",join:"miter",miterLimit:5,writeDepth:!0,polygonOffset:!1,stippleLength:null,slicePlaneEnabled:!1},B=c.newLayout().vec3f(e.VertexAttrConstants.POSITION).vec2f(e.VertexAttrConstants.UV0).vec3f(e.VertexAttrConstants.AUXPOS1).vec3f(e.VertexAttrConstants.AUXPOS2).vec4f(e.VertexAttrConstants.COLOR).f32(e.VertexAttrConstants.SIZE),
C=function(){function a(a){this.canBeMerged=a;this.vertexBufferLayout=B;this.numVertsAtJoin=4;this.numVertsAtCap=2}a.prototype.allocate=function(a){return B.createBuffer(a)};a.prototype.elementCount=function(a){a=(a.indices[e.VertexAttrConstants.POSITION].length/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap;this.canBeMerged&&(a+=2);return a};a.prototype.write=function(a,c,d,b,f){d=c.vertexAttr[e.VertexAttrConstants.POSITION].data;var g=c.indices&&c.indices[e.VertexAttrConstants.POSITION];g&&g.length!==
2*(d.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");g=c.vertexAttr[e.VertexAttrConstants.COLOR]?c.vertexAttr[e.VertexAttrConstants.COLOR].data:D;c=c.vertexAttr[e.VertexAttrConstants.SIZE]?c.vertexAttr[e.VertexAttrConstants.SIZE].data:G;var h=d.length/3;a=a.transformation;b=b.position.typedBuffer;var l=0,m=this.vertexBufferLayout.stride/4,k=f*=m;this.canBeMerged&&(f+=m);var p=d[0],r=d[1],t=d[2];if(a)var n=p,u=r,x=t,p=a[0]*n+a[4]*u+a[8]*x+a[12],r=a[1]*n+a[5]*u+a[9]*x+a[13],
t=a[2]*n+a[6]*u+a[10]*x+a[14];var v=d[3],y=d[4],x=d[5];a&&(n=v,u=y,v=a[0]*n+a[4]*u+a[8]*x+a[12],y=a[1]*n+a[5]*u+a[9]*x+a[13],x=a[2]*n+a[6]*u+a[10]*x+a[14]);for(var w=p,q=r,z=t,A=0;A<h;A++)n=3*A,A<h-1&&(v=d[n+3],y=d[n+4],x=d[n+5],a&&(n=v,u=y,v=a[0]*n+a[4]*u+a[8]*x+a[12],y=a[1]*n+a[5]*u+a[9]*x+a[13],x=a[2]*n+a[6]*u+a[10]*x+a[14])),l+=Math.sqrt((w-p)*(w-p)+(q-r)*(q-r)+(z-t)*(z-t)),b[f++]=w,b[f++]=q,b[f++]=z,b[f++]=l,b[f++]=0===A?-1.2:-1,b[f++]=p,b[f++]=r,b[f++]=t,b[f++]=v,b[f++]=y,b[f++]=x,b[f++]=g[0],
b[f++]=g[1],b[f++]=g[2],b[f++]=g[3],b[f++]=c[0],b[f++]=w,b[f++]=q,b[f++]=z,b[f++]=l,b[f++]=0===A?1.2:1,b[f++]=p,b[f++]=r,b[f++]=t,b[f++]=v,b[f++]=y,b[f++]=x,b[f++]=g[0],b[f++]=g[1],b[f++]=g[2],b[f++]=g[3],b[f++]=c[0],0<A&&A<h-1&&(b[f++]=w,b[f++]=q,b[f++]=z,b[f++]=l,b[f++]=-1.2,b[f++]=p,b[f++]=r,b[f++]=t,b[f++]=v,b[f++]=y,b[f++]=x,b[f++]=g[0],b[f++]=g[1],b[f++]=g[2],b[f++]=g[3],b[f++]=c[0],b[f++]=w,b[f++]=q,b[f++]=z,b[f++]=l,b[f++]=1.2,b[f++]=p,b[f++]=r,b[f++]=t,b[f++]=v,b[f++]=y,b[f++]=x,b[f++]=g[0],
b[f++]=g[1],b[f++]=g[2],b[f++]=g[3],b[f++]=c[0]),p=w,r=q,t=z,w=v,q=y,z=x;if(this.canBeMerged){for(A=k;A<k+m;A++)b[A]=b[A+m];d=f-m;for(A=0;A<m;A++)b[f++]=b[d++]}};return a}(),E=c.newLayout().vec3f(e.VertexAttrConstants.POSITION).vec2f(e.VertexAttrConstants.UV0),F=function(){function a(){this.vertexBufferLayout=E;this.numVertsAtCap=this.numVertsAtJoin=2;this.tmpCurrent=m.vec3f64.create();this.tmpLast=m.vec3f64.create()}a.prototype.allocate=function(a){return B.createBuffer(a)};a.prototype.elementCount=
function(a){return(a.indices[e.VertexAttrConstants.POSITION].length/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap};a.prototype.write=function(a,c,d,b,f){d=c.vertexAttr[e.VertexAttrConstants.POSITION].data;(c=c.indices&&c.indices[e.VertexAttrConstants.POSITION])&&c.length!==2*(d.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");c=d.length/3;a=a.transformation;var g=0,l=this.tmpCurrent,m=this.tmpLast;h.vec3.set(l,d[0],d[1],d[2]);for(var k=0;k<c;k++){var p=3*k;h.vec3.copy(m,
l);h.vec3.set(l,d[p],d[p+1],d[p+2]);a&&h.vec3.transformMat4(l,l,a);g+=h.vec3.squaredDistance(m,l);b.position.setVec(f,l);b.uv0.set(f,0,g);b.uv0.set(f,1,-1);++f;b.position.setVec(f,l);b.uv0.set(f,0,g);b.uv0.set(f,1,1);++f}};return a}(),H={factor:0,units:-4},D=[255,255,255,255],G=[0,0,0,0],K=m.vec3f64.create(),M=m.vec3f64.create(),O=m.vec3f64.create(),N=m.vec3f64.create(),P=m.vec3f64.create(),L=k.createRenderScreenPointArray3(),T=k.createRenderScreenPointArray3(),R=m.vec3f64.create(),J=m.vec3f64.create(),
U=p.lineSegment.create(),Q=p.lineSegment.create(),I=[k.createRenderScreenPointArray3(),k.createRenderScreenPointArray3(),k.createRenderScreenPointArray3(),k.createRenderScreenPointArray3()],V=[m.vec3f64.create(),m.vec3f64.create(),m.vec3f64.create(),m.vec3f64.create()],X=p.plane.create(),W=p.plane.create(),ca=p.plane.create(),da=p.plane.create();return q})},"esri/views/3d/webgl-engine/materials/renderers/InstancedRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../support/buffer/glUtil ../../lib/DefaultVertexAttributeLocations ./Instance ./utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(q,b,n,f,k,d,h,m,p,c){function a(a,c){var d=new Map,b=function(a,c){var b=a.origin.id,e=a.data.id,f=d.get(b);f||(f={origin:a.origin.vec3,deltaByGeometry:new Map},d.set(b,f));b=f.deltaByGeometry.get(e);b||(b={renderData:a.data,toAdd:[],toRemove:[]},f.deltaByGeometry.set(e,b));(c?b.toAdd:b.toRemove).push(a)};a.forEach(function(a){b(a,!0)});c.forEach(function(a){b(a,!1)});return d}function l(a,c,d){var b=c.elementCount(a),b=c.allocate(b);c.write({},a,null,b,0);d.setData(b.buffer)}return function(){function b(a,
c,d){this._dataByOrigin=new Map;this._highlightCount=0;this._rctx=a;this._material=d;this._materialRep=c;this._glMaterials=h.acquireMaterials(this._material,this._materialRep);this._bufferWriter=d.createBufferWriter()}b.prototype.dispose=function(){h.releaseMaterials(this._material,this._materialRep)};Object.defineProperty(b.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasHighlights",{get:function(){return 0<
this._highlightCount},enumerable:!0,configurable:!0});b.prototype.renderPriority=function(){return this._material.renderPriority};b.prototype.modify=function(a){this.updateGeometries(a.toUpdate);this.addAndRemoveGeometries(a.toAdd,a.toRemove);this.updateHighlightCount()};b.prototype.addAndRemoveGeometries=function(b,g){var e=this._rctx,r=this._bufferWriter,u=this._dataByOrigin;b=a(b,g);var w=r.vertexBufferLayout;b.forEach(function(a,b){var g=u.get(b);g||(g={origin:a.origin,highlightCount:0,dataByGeometry:new Map},
u.set(b,g));a.deltaByGeometry.forEach(function(a,b){var t=g.dataByGeometry.get(b);!t&&0<a.toAdd.length&&(t={vao:new c(e,k.Default3D,{geometry:f.glLayout(w)},{geometry:m.createVertex(e,35044)}),vertexCount:0,instances:new Map,highlightCount:0},l(a.renderData,r,t.vao.vertexBuffers.geometry),t.vertexCount=p.vertexCount(t.vao,"geometry"),g.dataByGeometry.set(b,t));var u=t.instances;a.toAdd.forEach(function(a){var c=n.mat4f64.create();h.calculateTransformRelToOrigin(a,c);var b=h.generateRenderGeometryVisibleIndexRanges(a),
e=h.generateRenderGeometryHighlightRanges(a),c=new d(a.name,0,t.vertexCount,b,e,c,a.instanceParameters,a.idx,a.data.id);u.set(a.uniqueName,c);g.highlightCount=null;t.highlightCount=null});a.toRemove.forEach(function(a){u.delete(a.uniqueName)});0===u.size&&(t.vao.dispose(),g.dataByGeometry.delete(b))});0===g.dataByGeometry.size&&u.delete(b)})};b.prototype.updateGeometries=function(a){var c=this._dataByOrigin,d=this._bufferWriter;a.forEach(function(a){var b=a.updateType;a=a.renderGeometry;var e=c.get(a.origin.id),
f=e&&e.dataByGeometry.get(a.data.id),g=f&&f.instances.get(a.uniqueName);g&&(b&1&&(g.displayedIndexRange=h.generateRenderGeometryVisibleIndexRanges(a)),b&17&&(g.highlightedIndexRanges=h.generateRenderGeometryHighlightRanges(a),e.highlightCount=null,f.highlightCount=null),b&2&&l(a.data,d,f.vao.vertexBuffers.geometry),b&4&&h.calculateTransformRelToOrigin(a,g.transformation,g.transformationNormal))})};b.prototype.updateHighlightCount=function(){var a=this;this._highlightCount=0;this._dataByOrigin.forEach(function(c){if(null==
c.highlightCount){var d=0;c.dataByGeometry.forEach(function(a){if(null==a.highlightCount){var c=0;a.instances.forEach(function(a){a.highlightedIndexRanges&&++c});a.highlightCount=c}d+=a.highlightCount});c.highlightCount=d}a._highlightCount+=c.highlightCount})};b.prototype.render=function(a,c,d,b){var e=this,f=this._rctx,g=this._glMaterials.get(c.pass),h=4===c.pass;if(!g||null!=a&&!g.beginSlot(a)||h&&0===this._highlightCount)return!1;g.bind(f,d);var l=!1;this._dataByOrigin.forEach(function(a){h&&0===
a.highlightCount||(d.origin=a.origin,g.bindView(f,d),a.dataByGeometry.forEach(function(a){l=h?e.renderHighlightPass(g,a,b)||l:e.renderDefaultPass(g,a,b)||l}))});f.bindVAO(null);g.release(f,d);return l};b.prototype.renderDefaultPass=function(a,c,d){var b=this._rctx,e=a.getProgram(),f=a.getDrawMode(),g=c.vao,l=c.vertexCount;p.assertCompatibleVertexAttributeLocations(g,e);b.bindVAO(g);var m=!1;c.instances.forEach(function(c){var e=c.displayedIndexRange;e&&0===e.length||(a.bindInstance(b,c),e?h.drawArraysFaceRange(b,
e,0,f,d):h.drawArrays(b,f,0,l,d),m=!0)});return m};b.prototype.renderHighlightPass=function(a,c,d){var b=this._rctx,e=a.getProgram(),f=a.getDrawMode(),g=c.vao,l=c.vertexCount;if(0!==c.highlightCount){p.assertCompatibleVertexAttributeLocations(g,e);b.bindVAO(g);var m=!1;c.instances.forEach(function(c){var e=c.highlightedIndexRanges;if(e&&0!==e.length)for(a.bindInstance(b,c),c=0;c<e.length;c++){var g=e[c];h.drawArrays(b,f,g.range?g.range[0]:0,g.range?g.range[1]-g.range[0]+1:l,d);m=!0}});return m}};
return b}()})},"esri/views/3d/webgl-engine/shaders/RibbonLinePrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});var d=function(d){return k.glslifyDefineMap({WALL:d.wall,SCREENSCALE:d.screenScale,STIPPLE:d.stipple,SLICE:d.slice})};b.colorPass={name:"ribbon-line-color",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),
fragmentShader:d(b)+f.resolveIncludes("materials/ribbonLine/colorPass.frag")}},attributes:n.Default3D};b.highlightPass={name:"ribbon-line-highlight",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),fragmentShader:d(b)+f.resolveIncludes("materials/ribbonLine/highlightPass.frag")}},attributes:n.Default3D}})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("require exports ../../../../core/maybe ../../../../core/TimeProfiler ../../../../core/libs/gl-matrix-2/vec2f64 ../../support/debugFlags ../lib/Util ./BoundingInfo ./depthRange ./depthRangeUtils ./FxaaRenderPass ./HighlightHelper ./OffscreenRenderingHelper ./RenderContext ./RenderPluginManager ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./Util ./edgeRendering/EdgeView ../lighting/SceneLighting ../materials/HUDMaterial ../../../webgl/Profiling ../../../webgl/Texture".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C){function E(a,c){var d=new Map,b=null,e=null,f=function(a){if(a===b)return e;var c=d.get(a);c||(c={toAdd:[],toRemove:[],toUpdate:[]},d.set(a,c));b=a;return e=c};a.toAdd.forEach(function(a){1<=F(a.data)&&f(a.material).toAdd.push(a)});a.toRemove.forEach(function(a){1<=F(a.data)&&f(a.material).toRemove.push(a)});var g=0;a.toUpdate.forEach(function(a){1<=F(a.renderGeometry.data)&&(f(a.renderGeometry.material).toUpdate.push(a),g|=a.updateType)});
c&&(c.updateTypes=g);return d}function F(a){return!1===a.preinterleaved?x.getFirstObjectValue(a.indices).length:a.indexCount}function H(a,c){return a.isVisible()&&a.isVisibleInPass(c.pass)&&0!==(a.renderOccluded&c.renderOccludedMask)}q=function(){function b(c,d,f,h,m,k){var p=this;this._materialRenderers=new Map;this._orderedMaterialRenderers=[];this._hasHighlights=!1;this._lighting=new z.SceneLighting;this._content=new Map;this._isRendering=!1;this._needsRender=!0;this._fallbackDepthStencilTexture=
null;this._stats=new b.RenderStats;this._edgeView=null;this.renderOptions={antialiasing:"smaa"};this._programRep=c;this._materialRep=d;this._rctx=h;this._mode=m;this._stage=k;this._fxaaPass=new a(h);this._smaaPass=new y(h);this._bindParameters={view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,lightingData:null,viewport:null,shadowMappingEnabled:!1,ssaoEnabled:!1,origin:null,pixelRatio:null,slicePlane:null};this._offscreenRendering=new g(c,this._rctx);this._sliceHelper=new r;"scene"===this._mode&&
(this._shadowMap=new t(this._rctx),this._ssaoHelper=new w(c,this._rctx,function(){p._needsRender=!0}),this._highlightHelper=new l(c,this._rctx));this._renderPlugins=new u.RenderPluginManager({rctx:h,programRep:c,textureRep:f,materialRep:d});this._renderContext=new e(h,this._offscreenRendering,this._lighting.getOld(),this._shadowMap,this._ssaoHelper,this._sliceHelper)}b.prototype.dispose=function(){this._materialRenderers.forEach(function(a){a.dispose()});this._orderedMaterialRenderers=this._materialRenderers=
null;this._edgeView&&(this._edgeView.destroy(),this._edgeView=null);this._offscreenRendering.enabled=!1;this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null);this._shadowMap&&(this._shadowMap.enabled=!1,this._shadowMap.dispose());this._ssaoHelper&&(this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose());this._highlightHelper&&(this._highlightHelper.enabled=!1);m.tmpIndices.prune();this._content.clear();this._content=null};Object.defineProperty(b.prototype,
"isLoadingResources",{get:function(){return"smaa"===this.renderOptions.antialiasing&&this._smaaPass.isLoadingResources},enumerable:!0,configurable:!0});b.prototype.ensureEdgeView=function(){var a=this;null==this._edgeView&&(this._edgeView=new v.EdgeView(this._rctx,this._programRep,{setNeedsRender:function(){return a._needsRender=!0}}),this._edgeView.initialize());return this._edgeView};Object.defineProperty(b.prototype,"edgeView",{get:function(){return this._edgeView},enumerable:!0,configurable:!0});
b.prototype.setLighting=function(a){this._lighting.set(a)};b.prototype.setRenderParams=function(a){void 0!==a.shadowMapResolution&&!1===this._shadowMap.enabled&&(this._shadowMap.textureResolution=a.shadowMapResolution);void 0!==a.shadowMap&&(this._shadowMap.enabled=a.shadowMap);void 0!==a.shadowMapMaxCascades&&(this._shadowMap.maxCascades=a.shadowMapMaxCascades);this._highlightHelper.enabled=!0;void 0!==a.ssao&&(this._ssaoHelper.enabled=a.ssao);void 0!==a.ssaoAttenuation&&(this._ssaoHelper.attenuation=
a.ssaoAttenuation);void 0!==a.ssaoRadius&&(this._ssaoHelper.radius=a.ssaoRadius);void 0!==a.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter.");void 0!==a.ssaoSamples&&(this._ssaoHelper.samples=a.ssaoSamples);a.background&&(this._offscreenRendering.background=a.background);void 0!==a.antialiasingEnabled&&(this.renderOptions.antialiasing=a.antialiasingEnabled?"smaa":"none");void 0!==a.defaultHighlightOptions&&this._highlightHelper.setDefaultOptions(a.defaultHighlightOptions);
void 0!==a.slicePlane&&(this._sliceHelper.plane=a.slicePlane);this._needsRender=!0};Object.defineProperty(b.prototype,"hasSlicePlane",{get:function(){return!!this._sliceHelper.plane},enumerable:!0,configurable:!0});b.prototype.getRenderParams=function(){var a={};this._shadowMap&&(a.shadowMap=this._shadowMap.enabled,a.shadowMapResolution=this._shadowMap.textureResolution,a.shadowMapMaxCascades=this._shadowMap.maxCascades);this._ssaoHelper&&this._ssaoHelper.isSupported&&(a.ssao=this._ssaoHelper.enabled,
a.ssaoAttenuation=this._ssaoHelper.attenuation,a.ssaoRadius=this._ssaoHelper.radius,a.ssaoFilterRadius=this._ssaoHelper.filterRadius,a.ssaoSamples=this._ssaoHelper.samples);return a};Object.defineProperty(b.prototype,"renderPlugins",{get:function(){return this._renderPlugins},enumerable:!0,configurable:!0});b.prototype.resetNeedsRender=function(){this._needsRender=!1;this._renderPlugins.resetNeedsRender()};b.prototype.needsRender=function(){return this._needsRender||this._renderPlugins.needsRender()};
b.prototype.getCombinedStats=function(){this._stats.VBOallocatedSize=0;this._stats.VBOoptimalSize=0;this._stats.VBOusedSize=0;this._stats.VBOallocatedSize*=.00390625;this._stats.VBOusedSize*=.00390625;this._stats.VBOoptimalSize*=.00390625;return this._stats};b.prototype.getFramebufferTexture=function(a){switch(a){case "color":return this._offscreenRendering.colorTexture;case "hudVisibility":return this._offscreenRendering.hudVisibilityTexture;case "shadowMap":return this._shadowMap&&this._shadowMap.getDepthTexture();
case "linearDepth":return this._offscreenRendering.linearDepthTexture;case "normals":return this._offscreenRendering.normalTexture;case "highlight":return this._offscreenRendering.highlightTexture}return null};Object.defineProperty(b.prototype,"hasHighlights",{get:function(){return this._hasHighlights},enumerable:!0,configurable:!0});b.prototype.isEmpty=function(){return 0===this._materialRenderers.size};b.prototype.modify=function(a,c,d,b){var e=this;void 0===d&&(d=[]);this._isRendering&&console.warn("Renderer.modify called while rendering");
for(var f=0;f<c.length;++f)this._content.delete(c[f].uniqueName);for(f=0;f<a.length;++f)this._content.set(a[f].uniqueName,a[f]);if(d)for(f=0;f<d.length;++f)h.assert(this._content.get(d[f].renderGeometry.uniqueName)===d[f].renderGeometry);if(a.length||c.length||d.length){var g=!1;E({toAdd:a,toRemove:c,toUpdate:d}).forEach(function(a,c){var d=e._materialRenderers.get(c);!d&&0<a.toAdd.length&&(d=c.createRenderer(e._rctx,e._materialRep),e._materialRenderers.set(c,d),e._orderedMaterialRenderers.push(d),
e.sortOrderedMaterialRenderers());d&&(d.modify(a),d.isEmpty&&(g=!0))});g&&this._materialRenderers.forEach(function(a,c){a.isEmpty&&(e._materialRenderers.delete(c),e._orderedMaterialRenderers.splice(e._orderedMaterialRenderers.indexOf(a),1),a.dispose())});var l=!1;this._materialRenderers.forEach(function(a){l=l||a.hasHighlights});if(l!==this._hasHighlights){if(this.onHasHighlightsChanged)this.onHasHighlightsChanged(l);this._hasHighlights=l}this._needsRender=!0}b&&(b.forEach(function(a){e._materialRep.updateMaterialParameters(a)}),
this._needsRender=!0)};b.prototype.modifyRenderOrder=function(a){"draped"===this._mode&&(this.sortOrderedMaterialRenderers(),this._needsRender=!0)};b.prototype.render=function(a){switch(this._mode){case "scene":this.renderScene(a);break;case "draped":this.renderDraped(a)}if(this.onPostRender)this.onPostRender()};b.prototype.renderPass=function(a,c){this.renderGeometryPass(a,c)};b.prototype.renderScene=function(a){var c=this;this._isRendering=!0;var d=this._rctx,b=this._offscreenRendering,e=this._ssaoHelper,
f=a.camera,g=a.fbo,h=this._sliceHelper.plane;a.disableSlice&&(this._sliceHelper.plane=null);this.prepareRender(f);this.renderShadowMap(a);b.enabled=!0;b.initializeFrame(f,g);this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth()?b.renderToTargets(function(){c.renderGeometryPass(1,a)},b.linearDepth,b.tmpDepth,[0,0,0,0],!0):b.disposeTarget(b.linearDepth);this._ssaoHelper.enabled?b.renderToTargets(function(){c.renderGeometryPass(2,a)},b.normal,b.tmpDepth,[0,0,0,0],!0):b.disposeTarget(b.normal);
this._ssaoHelper.enabled&&e.computeSSAO(f,b.linearDepthTexture,b.normalTexture);e.bindAll(this._programRep);this._stats.reset();this.updateGlobalUniforms(f.projectionMatrix);this._renderContext.pass=0;this._renderContext.camera=f;this._renderContext.options=this.renderOptions;b.bindTarget(b.mainColor,b.mainDepth);this._renderPlugins.render(0,this._renderContext);this.renderGeometrySlotsPt1(this._renderContext);this._edgeView&&this._edgeView.shouldRender()&&b.renderSeparateAndComposite(function(){return c._edgeView.render(c._bindParameters)},
void 0,"alpha");f=e=!1;e=this.renderHUDVisibility(this._renderContext);this.renderInternalSlot(17,this._renderContext);(f=this.renderTransparentTerrain(this._renderContext))&&e&&(b.compositeTransparentTerrainOntoHUDVisibility(),b.renderToTargets(function(){return c.renderHUD("occluded")},b.mainColor,b.tmpDepth,void 0,!0));f&&b.compositeTransparentTerrainOntoMain();b.renderToTargets(function(){c.renderInternalSlot(9,c._renderContext);c._renderPlugins.render(13,c._renderContext);c._renderPlugins.render(14,
c._renderContext)},b.mainColor,b.mainDepth);this.renderOccluded();e=this.renderOptions.antialiasing;"smaa"===e&&this._smaaPass.loadResources(function(){c._needsRender=!0});"smaa"===e&&this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:b.colorTexture},g)):"fxaa"===e&&this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:b.colorTexture},g)):(b.composite(),this._fxaaPass.disable(),this._smaaPass.disable());d.bindFramebuffer(g);this.renderHUD("notOccluded");
this.renderHighlights(a,g);this._sliceHelper.plane=h;this._isRendering=!1};b.prototype.renderDraped=function(a){this._stats.reset();this.renderGeometryPass(0,a)};b.prototype.prepareRender=function(a){this._renderPlugins.prepareRender(a)};b.prototype.renderShadowMap=function(a){var c=this._shadowMap,b=a.camera,e=a.fbo,g=a.lightDirection;if(c.enabled){d.ENABLE_PROFILE_DEPTH_RANGE&&f.begin("depthRange");var h=this.computeDepthRange(b);d.ENABLE_PROFILE_DEPTH_RANGE&&f.end("depthRange");c.prepare(b,g,h);
g=c.getCascades();for(h=0;h<g.length;++h){var l=g[h];l.camera.setGLViewport(this._rctx);a.camera=l.camera;this.renderGeometryPass(3,a)}a.camera=b;c.finish(e);b.setGLViewport(this._rctx)}c.bindAll(this._programRep)};b.prototype.computeDepthRange=function(a){var d=c.depthRangeFromScene(a,this._content,this._stage.getLayers());p.union(d,this.renderPlugins.queryDepthRange(a));d.near=Math.max(a.near,d.near);d.far=Math.min(a.far,d.far);return d};b.prototype.renderGeometryPass=function(a,c){this._isRendering=
!0;c=c.camera;this.updateGlobalUniforms(c.projectionMatrix);this._renderContext.pass=a;this._renderContext.camera=c;"draped"===this._mode?this.renderGeometryPassDraped(this._renderContext):this.renderGeometryPassScene(this._renderContext);this._isRendering=!1};b.prototype.renderGeometryPassDraped=function(a){var c=this,d=a.camera;this._bindParameters.view=d.viewMatrix;this._bindParameters.proj=d.projectionMatrix;this._bindParameters.viewInvTransp=d.viewInverseTransposeMatrix;D[0]=d.near;D[1]=d.far;
this._bindParameters.nearFar=D;this._bindParameters.lightingData=a.lightingData;this._bindParameters.viewport=d.fullViewport;this._bindParameters.pixelRatio=d.pixelRatio;this._bindParameters.slicePlane=a.sliceHelper&&a.sliceHelper.plane;this._bindParameters.highlightDepthTexture=this.getFallbackDepthTexture();this._orderedMaterialRenderers.forEach(function(d){d.render(null,a,c._bindParameters)})};b.prototype.renderGeometryPassScene=function(a){this.renderGeometrySlotsPt1(a);this.renderTransparentTerrain(a)};
b.prototype.renderGeometrySlotsPt1=function(a){this._renderPlugins.render(1,a);this.renderInternalSlot(2,a);this._renderPlugins.render(3,a);this.renderInternalSlot(4,a);this._renderPlugins.render(5,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep);this._renderPlugins.render(12,this._renderContext);this.renderInternalSlot(6,a);this._renderPlugins.render(7,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep)};b.prototype.renderTransparentTerrain=function(a){return this._renderPlugins.render(8,
a)};b.prototype.renderHUDVisibility=function(a){var c=this,d=A.shouldRenderVisibilityDuringRenderPass(a.pass),b=a.offscreenRenderingHelper&&a.offscreenRenderingHelper.enabled,e=!1;d&&b&&a.offscreenRenderingHelper.renderHUDVisibility(function(){e=c.renderInternalSlot(10,a)});return e};b.prototype.renderHUD=function(a){this._bindParameters.renderTransparentlyOccludedHUD=a;this.renderInternalSlot(18,this._renderContext);this.renderInternalSlot(15,this._renderContext);this.renderInternalSlot(16,this._renderContext)};
b.prototype.renderHighlights=function(a,c){var d=this,b=this._highlightHelper;if(b&&b.enabled&&(this.hasHighlights||this._renderPlugins.needsHighlight())){var e=null;b.profilingCallback&&(e=B.startMeasurement(this._renderContext.rctx));var f=this._offscreenRendering,f=f.renderToTargets(function(){d.renderGeometryPass(4,a);d._rctx.clearSafe(256);d.renderHUD("both")},f.highlight,f.tmpDepth,[0,0,0,0],!0);b.render(a.camera,f,c);null!==e&&b.profilingCallback&&e.stop(function(a){b.profilingCallback&&b.profilingCallback(a)})}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)};
b.prototype.renderOccluded=function(){var a=this;this._materialRenderers.forEach(function(a,c){c&&c.isVisible()&&1!==c.renderOccluded&&G.push(c)});if(0!==G.length){var c=this._offscreenRendering,d=this._renderContext,b=function(b,e){d.renderOccludedMask=e;c.renderToTargets(function(){a.renderInternalSlot(4,d,G);a.renderInternalSlot(6,d,G);a.renderInternalSlot(9,d,G)},c.tmpColor,c.tmpDepth,[0,0,0,0],!0);d.resetRenderOccludedMask();c.compositeOccludedOntoMain(b)};d.pass=0;b(.4,4);b(.5,2);b(1,8);G.length=
0}};b.prototype.renderInternalSlot=function(a,c,d){this._bindParameters.view=c.camera.viewMatrix;this._bindParameters.proj=c.camera.projectionMatrix;this._bindParameters.viewInvTransp=c.camera.viewInverseTransposeMatrix;this._bindParameters.cameraAboveGround=c.camera.aboveGround;this._bindParameters.fovY=c.camera.fovY;D[0]=c.camera.near;D[1]=c.camera.far;var b=this._renderContext.offscreenRenderingHelper;this._bindParameters.nearFar=D;this._bindParameters.lightingData=c.lightingData;this._bindParameters.viewport=
c.camera.fullViewport;this._bindParameters.shadowMap=c.shadowMap;this._bindParameters.shadowMappingEnabled=!!c.shadowMap&&c.shadowMap.enabled;this._bindParameters.ssaoEnabled=!!c.ssaoHelper&&c.ssaoHelper.enabled;this._bindParameters.pixelRatio=c.camera.pixelRatio;this._bindParameters.slicePlane=c.sliceHelper&&c.sliceHelper.plane;this._bindParameters.hudVisibilityTexture=b?b.hudVisibilityTexture:null;this._bindParameters.highlightDepthTexture=b&&b.depthTexture||this.getFallbackDepthTexture();return this.renderInternalSlotMaterials(a,
c,d)};b.prototype.renderInternalSlotMaterials=function(a,c,d){var b=this,e=!1;n.isSome(d)?d.forEach(function(d){H(d,c)&&(e=b._materialRenderers.get(d).render(a,c,b._bindParameters)||e)}):this._materialRenderers.forEach(function(d,f){H(f,c)&&(e=d.render(a,c,b._bindParameters)||e)});return e};b.prototype.updateGlobalUniforms=function(a){for(var c=this._programRep.getProgramsUsingUniform("proj"),d=0;d<c.length;d++)c[d].setUniformMatrix4fv("proj",a);if(this._lighting){c=this._programRep.getProgramsUsingUniform("lightingMainDirection");
for(d=0;d<c.length;d++)this._lighting.setUniforms(c[d]);c=this._programRep.getProgramsUsingUniform("lightDirection");for(d=0;d<c.length;d++)this._lighting.setUniforms(c[d])}};b.prototype.sortOrderedMaterialRenderers=function(){"draped"===this._mode&&this._orderedMaterialRenderers.sort(function(a,c){return c.renderPriority()-a.renderPriority()})};b.prototype.getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new C(this._rctx,{target:3553,pixelFormat:6408,
dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255])));return this._fallbackDepthStencilTexture};b.prototype.getGpuMemoryUsage=function(){return{offscreen:this._offscreenRendering?this._offscreenRendering.getGpuMemoryUsage():0,highlights:this._highlightHelper?this._highlightHelper.getGpuMemoryUsage():0,shadows:this._shadowMap?this._shadowMap.getGpuMemoryUsage():0,ssao:this._ssaoHelper?this._ssaoHelper.getGpuMemoryUsage():0}};b.prototype.forEachRenderGeometry=function(a){this._content.forEach(function(c,
d){a(c)})};return b}();(function(a){var c=function(){function a(){this.reset()}a.prototype.reset=function(){this.VBOusedSize=this.VBOoptimalSize=this.VBOallocatedSize=this.instancesDrawnAngle=this.drawCallsHighlight=this.drawCallsFragmented=this.drawCallsPreinterleaved=this.drawCallsMerged=this.drawCallsAngleInstanced=this.drawCallsInstanced=this.trianglesRendered=0};return a}();a.RenderStats=c})(q||(q={}));var D=k.vec2f64.create(),G=[];return q})},"esri/core/TimeProfiler":function(){define(["require",
"exports"],function(q,b){q=function(){function b(b,k){void 0===k&&(k=.9);this._alpha=.9;this._name=b;this._alpha=k;this.reset()}b.prototype.reset=function(){this._smooth=this._sum=this._count=0;this._min=Infinity;this._max=0};Object.defineProperty(b.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"count",{get:function(){return this._count},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"average",{get:function(){return 0<
this._count?this._sum/this._count:0},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0});b.prototype.begin=function(){this._startTime=performance.now()};b.prototype.end=function(){var b=performance.now()-
this._startTime;this._count+=1;this._sum+=b;this._smooth=this._alpha*b+(1-this._alpha)*this._smooth;this._min=Math.min(this._min,b);this._max=Math.max(this._max,b)};b.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}};return b}();(function(b){function f(f){f in d||(d[f]=new b(f));return d[f]}function k(d){console.log(f(d).toJSON())}var d={},h={};b.get=f;b.begin=function(d){f(d).begin()};b.end=function(d,b){void 0===
b&&(b=!0);f(d).end();var c=performance.now();!b||d in h&&!(c>=h[d]+1E3)||(k(d),h[d]=c)};b.log=k;b.logAll=function(){for(var b in d)k(b)}})(q||(q={}));return q})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["require","exports"],function(q,b){function n(b,d){return{near:b,far:d}}function f(b,d,f){b.near=d;b.far=f;return b}Object.defineProperty(b,"__esModule",{value:!0});b.create=n;b.empty=function(b){return b?f(b,Infinity,-Infinity):n(Infinity,-Infinity)};b.set=f;b.union=function(b,
d,f){void 0===f&&(f=b);f.near=Math.min(b.near,d.near);f.far=Math.max(b.far,d.far);return f}})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("require exports ../../../../core/PooledArray ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/geometryUtils ../../support/mathUtils ./ComponentUtils ./depthRange ./Util".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e){function u(a,c){if(c.isVisible){var d=g.empty(),b=c.getObjects();c.getSpatialQueryAccelerator()?t(d,a,c.getSpatialQueryAccelerator()):r(d,a,b);return d}}function t(a,c,d){var b=c.eye,e=c.viewForward,f=c.frustum,h=function(a){return!a.areAllComponentsHidden()},l=d.objectCount;500>l?(g.set(C,c.near,Math.min(a.near,c.far)),d.forEachInDepthRange(b,e,"front-to-back",C,function(d,b){y(a,c,d);C.far=a.near;b.setRange(C)},f,h),g.set(C,Math.max(a.far,c.near),c.far),d.forEachInDepthRange(b,
e,"back-to-front",C,function(d,b){y(a,c,d);C.near=a.far;b.setRange(C)},f,h)):(l=Math.max(Math.min(l,500),Math.ceil(.1*l)),b=d.findClosest(e,"front-to-back",f,h,l),d=d.findClosest(e,"back-to-front",f,h,l),b&&d&&(x(a,c,b.getCenter(),b.getBSRadius()),x(a,c,d.getCenter(),d.getBSRadius())))}function r(a,c,d){E.clear();d.forEach(function(a){a.areAllComponentsHidden()||E.add(a)});E.empty||(E.sort(c),g.set(C,c.near,Math.min(a.near,c.far)),E.forEachInDepthRange(C,"front-to-back",function(d,b,e){b<a.near&&
y(a,c,d)}),g.set(C,Math.max(a.far,c.near),c.far),E.forEachInDepthRange(C,"back-to-front",function(c,d,b){a.far=Math.max(a.far,b)}))}function y(d,b,e){if(!e.areAllComponentsHidden()&&c.frustum.intersectsSphere(b.frustum.planes,c.sphere.wrap(e.getBSRadius(),e.getCenter()))){var g=e.objectTransformation,h=B;e.geometryRecords.forEach(function(c){f.mat4.multiply(h,g,c.getShaderTransformation());var e=a.maxScale(h);w(d,b,c.geometry.boundingInfo,h,e)})}}function w(a,b,e,f,g){var h=b.eye,l=b.viewForward;
d.vec3.transformMat4(A,e.center,f);h=l[0]*(A[0]-h[0])+l[1]*(A[1]-h[1])+l[2]*(A[2]-h[2]);l=e.bsRadius*g;if(!(h-l>a.near&&h+l<a.far)&&c.frustum.intersectsSphere(b.frustum.planes,c.sphere.wrap(l,A)))if(100<e.bsRadius&&e.getChildren())for(e=e.getChildren(),h=0;8>h;++h)e[h]&&w(a,b,e[h],f,g);else H.unionDepthRangeWithAABB(a,b.viewProjectionMatrix,f,e.bbMin,e.bbMax)}function x(a,c,d,b){var e=c.eye;c=c.viewForward;d=(d[0]-e[0])*c[0]+(d[1]-e[1])*c[1]+(d[2]-e[2])*c[2];a.near=Math.min(a.near,d-b);a.far=Math.max(a.far,
d+b)}Object.defineProperty(b,"__esModule",{value:!0});b.depthRangeFromScene=function(a,c,d){if(1E4>c.size)return F.compute(a,c);c=g.empty();for(var b in d){var e=d[b];e.isVisible&&g.union(c,u(a,e))}return c};b.depthRangeFromLayer=u;q=function(){function a(){this._items=new n({allocator:function(a){return a||{obj:null,distance:0,near:0,far:0}},deallocator:function(a){a.obj=null;a.distance=0;a.near=0;a.far=0;return a}})}Object.defineProperty(a.prototype,"length",{get:function(){return this._items.length},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this._items.clear()};a.prototype.add=function(a){this._items.pushNew().obj=a};a.prototype.sort=function(a){var c=a.eye,d=a.viewForward;this._items.forEach(function(a){var b=a.obj,e=b.getCenter(),b=b.getBSRadius(),e=(e[0]-c[0])*d[0]+(e[1]-c[1])*d[1]+(e[2]-c[2])*d[2];a.distance=e;a.near=e-b;a.far=e+b});this._items.sort(function(a,
c){return a.distance-c.distance})};a.prototype.forEachInDepthRange=function(a,c,d){if("front-to-back"===c)for(c=0;c<this._items.length;++c){var b=this._items.data[c];b.far<a.near||b.near>a.far||d(b.obj,b.near,b.far)}else for(c=this._items.length-1;0<=c;--c)b=this._items.data[c],b.far<a.near||b.near>a.far||d(b.obj,b.near,b.far)};return a}();var v=function(){function b(){this.view=k.mat4f64.create();this.viewProj=k.mat4f64.create();this.frustum=c.frustum.create();this.geometries=[];this.near=[];this.far=
[];this.nearCandidates=[];this.farCandidates=[];this.range={near:0,far:0};this.looseRange={near:0,far:0}}b.prototype.compute=function(a,d){var b=this;this.reset();f.mat4.copy(this.view,a.viewMatrix);f.mat4.multiply(this.viewProj,a.projectionMatrix,this.view);c.frustum.copy(a.frustum,this.frustum);a=this.view;var e=a[2],g=a[6],h=a[10],m=a[14];a=this.range;var k=0;d.forEach(function(a){if(!l.isAllHidden(a.instanceParameters.componentVisibilities,a.componentOffsets)&&a.castShadow){var c,d;a.hasShaderTransformation?
(c=a.getBoundingSphere(a.getShaderTransformation(),1,A),d=A):(c=a.bsRadius,d=a.center);d=e*d[0]+g*d[1]+h*d[2]+m;b.geometries[k]=a;b.near[k]=-(d+c);b.far[k]=-(d-c);++k}});if(0===this.geometries.length)return a;for(d=0;d<this.geometries.length;++d)this.near[d]>a.far&&(a.far=this.near[d]),2<this.near[d]&&this.far[d]<a.near&&(a.near=this.far[d]);var p=this.looseRange;p.near=Math.max(.5*a.near,2);p.far=2*a.far;var r=0,t=0;for(d=0;d<this.geometries.length;++d)this.near[d]<a.near&&(this.near[d]>=p.near?
a.near=this.near[d]:this.nearCandidates[r++]=d),this.far[d]>a.far&&(this.far[d]<=p.far?a.far=this.far[d]:this.farCandidates[t++]=d);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return a;this.nearCandidates.sort(function(a,c){return b.near[a]<b.near[c]?-1:b.near[a]>b.near[c]?1:0});this.farCandidates.sort(function(a,c){return b.far[a]<b.far[c]?1:b.far[a]>b.far[c]?-1:0});for(d=0;d<this.nearCandidates.length;++d)p=this.nearCandidates[d],this.near[p]<a.near&&(p=this.geometries[p],r=
p.boundingInfo,this.includeNearBoundingInfoRec(r,p.getShaderTransformation()));for(d=0;d<this.farCandidates.length;++d)p=this.farCandidates[d],this.far[p]>a.far&&(p=this.geometries[p],r=p.boundingInfo,this.includeFarBoundingInfoRec(r,p.getShaderTransformation()));return a};b.prototype.reset=function(){this.geometries.length=0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};b.prototype.includeNearBoundingInfoRec=
function(c,b){var e=c.getBSRadius(),f=c.getCenter();d.vec3.transformMat4(A,f,b);var g=a.maxScale(b),f=A[0],h=A[1],l=A[2],e=e*g,g=this.frustum.planes;if(!(g[0][0]*f+g[0][1]*h+g[0][2]*l+g[0][3]>e||g[1][0]*f+g[1][1]*h+g[1][2]*l+g[1][3]>e||g[2][0]*f+g[2][1]*h+g[2][2]*l+g[2][3]>e||g[3][0]*f+g[3][1]*h+g[3][2]*l+g[3][3]>e||(f=this.view[2]*f+this.view[6]*h+this.view[10]*l+this.view[14],h=f+e,2>-(f-e)||-h>=this.range.near)))if(-h>this.looseRange.near)this.range.near=-h;else{if(100<e&&(e=c.getChildren(),void 0!==
e)){for(c=0;8>c;++c)void 0!==e[c]&&this.includeNearBoundingInfoRec(e[c],b);return}H.unionDepthRangeWithAABB(this.range,this.viewProj,b,c.getBBMin(),c.getBBMax())}};b.prototype.includeFarBoundingInfoRec=function(c,b){var e=c.getBSRadius(),f=c.getCenter();d.vec3.transformMat4(A,f,b);var g=a.maxScale(b),f=A[0],h=A[1],l=A[2],e=e*g,g=this.frustum.planes;if(!(g[0][0]*f+g[0][1]*h+g[0][2]*l+g[0][3]>e||g[1][0]*f+g[1][1]*h+g[1][2]*l+g[1][3]>e||g[2][0]*f+g[2][1]*h+g[2][2]*l+g[2][3]>e||g[3][0]*f+g[3][1]*h+g[3][2]*
l+g[3][3]>e||(f=this.view[2]*f+this.view[6]*h+this.view[10]*l+this.view[14]-e,-f<=this.range.far)))if(-f<this.looseRange.far)this.range.far=-f;else{if(100<e&&(e=c.getChildren(),void 0!==e)){for(c=0;8>c;++c)void 0!==e[c]&&this.includeFarBoundingInfoRec(e[c],b);return}H.unionDepthRangeWithAABB(this.range,this.viewProj,b,c.getBBMin(),c.getBBMax())}};return b}();b.DepthRangeFromRenderGeometries=v;b=function(){function a(){this.modelViewProj=k.mat4f64.create();this.clipPosition=[p.vec4f64.create(),p.vec4f64.create(),
p.vec4f64.create(),p.vec4f64.create(),p.vec4f64.create(),p.vec4f64.create(),p.vec4f64.create(),p.vec4f64.create()]}a.prototype.unionDepthRangeWithAABB=function(a,c,d,b,e){var g=this.modelViewProj;f.mat4.multiply(g,c,d);c=!1;for(d=0;8>d;++d){var h=this.clipPosition[d],l=0===d||3===d||4===d||7===d?b[0]:e[0],m=0===d||1===d||4===d||5===d?b[1]:e[1],k=4>d?b[2]:e[2];h[0]=g[0]*l+g[4]*m+g[8]*k+g[12];h[1]=g[1]*l+g[5]*m+g[9]*k+g[13];h[2]=g[2]*l+g[6]*m+g[10]*k+g[14];h[3]=g[3]*l+g[7]*m+g[11]*k+g[15]}for(d=0;12>
d;++d){b=this.clipTriangle(this.clipPosition[z[d][0]],this.clipPosition[z[d][1]],this.clipPosition[z[d][2]]);e=!0;for(g=0;g<b.length;++g)if(h=b[g][3],2<=h){e=!1;break}if(!e)for(c=!0,g=0;g<b.length;++g)h=b[g][3],h<a.near&&(a.near=h),h>a.far&&(a.far=h)}return c};a.prototype.inside=function(a,c){if(0===c)return a[0]>=-a[3];if(1===c)return a[1]>=-a[3];if(2===c)return a[0]<=a[3];if(3===c)return a[1]<=a[3];e.assert(!1)};a.prototype.intersect=function(a,c,d){var b=0;0===d?b=(-a[3]-a[0])/(c[0]-a[0]+c[3]-
a[3]):1===d?b=(-a[3]-a[1])/(c[1]-a[1]+c[3]-a[3]):2===d?b=(a[3]-a[0])/(c[0]-a[0]-c[3]+a[3]):3===d&&(b=(a[3]-a[1])/(c[1]-a[1]-c[3]+a[3]));return m.vec4.lerp(p.vec4f64.create(),a,c,b)};a.prototype.clipTriangle=function(a,c,d){a=[a,c,d];for(c=0;4>c;++c){d=a;a=[];for(var b=0;b<d.length;++b){var e=d[b],f=d[(b+1)%d.length];this.inside(f,c)?(this.inside(e,c)||a.push(this.intersect(e,f,c)),a.push(f)):this.inside(e,c)&&a.push(this.intersect(e,f,c))}}return a};return a}();var z=[[0,1,3],[2,3,1],[1,5,2],[6,2,
5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],A=h.vec3f64.create(),B=k.mat4f64.create(),C=g.empty(),E=new q,F=new v,H=new b})},"esri/views/3d/webgl-engine/lib/FxaaRenderPass":function(){define("require exports ../../../webgl/BufferObject ../../../webgl/Program ../../../webgl/renderState ../../../webgl/VertexArrayObject".split(" "),function(q,b,n,f,k,d){return function(){function b(d){this.isEnabled=!1;this.vertexAttributeLocations={position:0};this.vertexBufferLayout=[{name:"position",
count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=d}b.prototype.enable=function(){if(this.isEnabled)return!0;var b=this.rctx;this.program=new f(b,"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate \x3d (position + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(position, -1, 1);\n      }","\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x \x3d pos.x + float(off.x) * rcpFrame.x;\n        float y \x3d pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -\x3e actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN \x3d FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN \x3d FxaaLuma(rgbN);\n        float lumaW \x3d FxaaLuma(rgbW);\n        float lumaM \x3d FxaaLuma(rgbM);\n        float lumaE \x3d FxaaLuma(rgbE);\n        float lumaS \x3d FxaaLuma(rgbS);\n        float rangeMin \x3d min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax \x3d max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range \x3d rangeMax - rangeMin;\n        if (range \x3c max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL \x3d rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL \x3d (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL \x3d abs(lumaL - lumaM);\n        float blendL \x3d max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL \x3d min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL +\x3d (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *\x3d vec3(1.0/9.0);\n        float lumaNW \x3d FxaaLuma(rgbNW);\n        float lumaNE \x3d FxaaLuma(rgbNE);\n        float lumaSW \x3d FxaaLuma(rgbSW);\n        float lumaSE \x3d FxaaLuma(rgbSE);\n        float edgeVert \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan \x3d edgeHorz \x3e\x3d edgeVert;\n        float lengthSign \x3d horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN \x3d lumaW;\n          lumaS \x3d lumaE;\n        }\n        float gradientN \x3d abs(lumaN - lumaM);\n        float gradientS \x3d abs(lumaS - lumaM);\n        lumaN \x3d (lumaN + lumaM) * 0.5;\n        lumaS \x3d (lumaS + lumaM) * 0.5;\n        if (gradientN \x3c gradientS)\n        {\n          lumaN \x3d lumaS;\n          lumaN \x3d lumaS;\n          gradientN \x3d gradientS;\n          lengthSign *\x3d -1.0;\n        }\n        vec2 posN;\n        posN.x \x3d pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y \x3d pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *\x3d FXAA_SEARCH_THRESHOLD;\n        vec2 posP \x3d posN;\n        vec2 offNP \x3d horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN \x3d lumaN;\n        float lumaEndP \x3d lumaN;\n        bool doneN \x3d false;\n        bool doneP \x3d false;\n        posN +\x3d offNP * vec2(-1.0, -1.0);\n        posP +\x3d offNP * vec2( 1.0,  1.0);\n        for(int i \x3d 0; i \x3c FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN \x3d FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP \x3d FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN \x3d doneN || (abs(lumaEndN - lumaN) \x3e\x3d gradientN);\n          doneP \x3d doneP || (abs(lumaEndP - lumaN) \x3e\x3d gradientN);\n          if(doneN \x26\x26 doneP) { break; }\n          if(!doneN) {\n            posN -\x3d offNP;\n          }\n          if(!doneP) {\n            posP +\x3d offNP;\n          }\n        }\n        float dstN \x3d horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP \x3d horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN \x3d dstN \x3c dstP;\n        lumaEndN \x3d directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) \x3c 0.0) \x3d\x3d ((lumaEndN - lumaN) \x3c 0.0)) {\n          lengthSign \x3d 0.0;\n        }\n        float spanLength \x3d (dstP + dstN);\n        dstN \x3d directionN ? dstN : dstP;\n        float subPixelOffset \x3d (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF \x3d texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord \x3d fCoordinate;\n        // if (screenCoord.x \x3c 0.5) {\n          color.rgb \x3d FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x \x3c 0.501 \x26\x26 screenCoord.x \x3e 0.499) {\n        //   color.rgb \x3d vec3(1,0,0);\n        // } else {\n        //   color \x3d texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a \x3d 1.0;\n        gl_FragColor \x3d color;\n      }",
this.vertexAttributeLocations);this.pipelineState=k.makePipelineState({colorWrite:k.defaultColorWriteParams});var h=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new d(b,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new n(b,34962,35044,h)});return this.isEnabled=!0};b.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)};b.prototype.render=function(d,b){this.enable();var c=this.rctx;c.bindVAO(this.vao);
c.bindFramebuffer(b);var a=0,f=0;null!=b?(a=b.descriptor.width,f=b.descriptor.height):(a=c.gl.canvas.width,f=c.gl.canvas.height);c.bindProgram(this.program);c.setPipelineState(this.pipelineState);c.bindTexture(d.colorTexture,0);this.program.setUniform1i("uColorTexture",0);this.program.setUniform2f("uRcpFrameDimension",1/a,1/f);c.drawArrays(4,0,3)};return b}()})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f32 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/debugFlags ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./Util ../shaders/HighlightPrograms ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/renderState ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t){return function(){function b(c,d){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};this.blur1Fbo=this.blur0Fbo=this.quadVAO=null;this._rctx=d;this.viewportToRestore=k.vec4f64.create();this.defaultOptions={color:f.vec4f32.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05};this.blurProgram=c.getProgram(a.blurPass,
{gaussianSamples:5});this.blurGridProgram=c.getProgram(a.blurPass,{gaussianSamples:5,gridOptimization:!0});this.applyProgram=c.getProgram(a.applyPass);this.applyGridProgram=c.getProgram(a.applyPass,{gridOptimization:!0});this.applyGridDebugProgram=c.getProgram(a.applyPass,{gridOptimization:!0,gridDebug:!0});this.downsampleProgram=c.getProgram(a.downsamplePass);this.preprocessPipelineState=e.makePipelineState({colorWrite:e.defaultColorWriteParams});this.applyPipelineState=e.makePipelineState({blending:e.separateBlendingParams(770,
1,771,771),colorWrite:e.defaultColorWriteParams})}Object.defineProperty(b.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"profilingCallback",{get:function(){return d.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(a){return console.log(a)}:null},enumerable:!0,configurable:!0});b.prototype.setDefaultOptions=function(a){this.defaultOptions=a};b.prototype.render=function(a,b,e){var f=
a.pixelRatio,g=!d.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,h=d.HIGHLIGHTS_VISUALIZE_BLOCKS,l=this._rctx;c.assert(this.enabled);n.vec4.copy(this.viewportToRestore,a.fullViewport);var m=Math.ceil(a.fullWidth/f);a=Math.ceil(a.fullHeight/f);this.blur0Fbo.resize(m,a);this.blur1Fbo.resize(m,a);l.bindVAO(this.quadVAO);l.setPipelineState(this.preprocessPipelineState);var k=null,p=f=k=null;if(g){var r=this._grid;this._gridUpdateResources(b,32);this._gridComputeMipmap();f=r.vao;p=4;k=this.blurGridProgram;l.bindProgram(k);
l.bindTexture(r.coverageMipmap[r.mipmapLevels].colorTexture,1);k.setUniform1i("coverageTex",1)}else f=this.quadVAO,p=5,k=this.blurProgram,l.bindProgram(k);l.bindVAO(f);l.bindFramebuffer(this.blur0Fbo);l.setViewport(0,0,m,a);l.setClearColor(0,0,0,0);l.clear(16384);k.setUniform1i("tex",0);l.bindTexture(b.colorTexture,0);k.setUniform2f("blurSize",1/m,0);l.drawArrays(p,0,u.vertexCount(f,"geometry"));l.bindFramebuffer(this.blur1Fbo);l.clear(16384);l.bindTexture(this.blur0Fbo.colorTexture,0);k.setUniform2f("blurSize",
0,1/a);l.drawArrays(p,0,u.vertexCount(f,"geometry"));l.bindFramebuffer(e);l.setPipelineState(this.applyPipelineState);l.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);g?(k=h?this.applyGridDebugProgram:this.applyGridProgram,l.bindProgram(k),k.setUniform1i("coverageTex",2),l.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,2)):(k=this.applyProgram,l.bindProgram(k));k.setUniform1i("tex",0);l.bindTexture(this.blur1Fbo.colorTexture,
0);k.setUniform1i("origin",1);l.bindTexture(b.colorTexture,1);k.setUniform4fv("color",this.defaultOptions.color);k.setUniform1f("outlineSize",8.6);k.setUniform1f("blurSize",.4);k.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded);l.drawArrays(p,0,u.vertexCount(f,"geometry"));l.bindVAO(null)};b.prototype.enable=function(){if(!this.enabled){this.quadVAO=p.createQuadVAO(this._rctx);
var a={colorTarget:0,depthStencilTarget:0,width:0,height:0},c={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=g.createWithAttachments(this._rctx,c,a);this.blur1Fbo=g.createWithAttachments(this._rctx,c,a)}};b.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.blur1Fbo=this.blur0Fbo=this.quadVAO=null)};b.prototype._gridUpdateResources=function(a,c){var d=this._rctx,b=this._grid,
e=!1;null===b.coverageMipmap&&(b.coverageMipmap=[a],e=!0);if(b.viewportWidth!==a.width||b.viewportHeight!==a.height)e=!0,b.viewportWidth=a.width,b.viewportHeight=a.height;b.coverageMipmap[0]=a;b.cellPixelSize!==c&&(b.cellPixelSize=c,e=!0);if(e){for(c=1;c<b.coverageMipmap.length;c++)b.coverageMipmap[c].dispose();b.mipmapLevels=Math.ceil(Math.log(b.cellPixelSize)*Math.LOG2E);b.coverageMipmap.length=b.mipmapLevels+1;for(c=0;c<b.mipmapLevels;c++)e=b.coverageMipmap[c],e=g.createWithAttachments(d,{target:3553,
pixelFormat:6407,dataType:33635,samplingMode:9729,wrapMode:33071,width:Math.ceil(e.width/2),height:Math.ceil(e.height/2)},{colorTarget:0,depthStencilTarget:0,width:Math.ceil(e.width/2),height:Math.ceil(e.height/2)}),b.coverageMipmap[c+1]=e}var e=Math.ceil(a.height/b.cellPixelSize),f=Math.ceil(a.width/b.cellPixelSize);if(!b.vao||b.verticalCellCount!==e||b.horizontalCellCount!==f){b.verticalCellCount=e;b.horizontalCellCount=f;a=e+1;c=f+1;for(var e=1/e,f=1/f,k=new Float32Array(24*a*c),p=0,r=0;r<a;r++)for(var n=
0;n<c;n++)k[p+0]=(n-.5)*f*2-1,k[p+1]=(r-.5)*e*2-1,k[p+2]=n*f,k[p+3]=r*e,k[p+4]=(n+.5)*f*2-1,k[p+5]=(r-.5)*e*2-1,k[p+6]=n*f,k[p+7]=r*e,k[p+8]=(n-.5)*f*2-1,k[p+9]=(r+.5)*e*2-1,k[p+10]=n*f,k[p+11]=r*e,k[p+12]=(n-.5)*f*2-1,k[p+13]=(r+.5)*e*2-1,k[p+14]=n*f,k[p+15]=r*e,k[p+16]=(n+.5)*f*2-1,k[p+17]=(r-.5)*e*2-1,k[p+18]=n*f,k[p+19]=r*e,k[p+20]=(n+.5)*f*2-1,k[p+21]=(r+.5)*e*2-1,k[p+22]=n*f,k[p+23]=r*e,p+=24;b.vao&&b.vao.dispose(!0);b.vao=new t(d,h.Default3D,{geometry:m.Pos2Tex},{geometry:l.createVertex(d,
35044,k)})}};b.prototype._gridComputeMipmap=function(){var a=this._rctx,c=this._grid,b=this.downsampleProgram;a.bindVAO(this.quadVAO);for(var d=0;d<c.mipmapLevels;d++){a.bindFramebuffer(c.coverageMipmap[d+1]);a.bindTexture(c.coverageMipmap[d].colorTexture,0);var e=c.coverageMipmap[d+1].width,f=c.coverageMipmap[d+1].height;a.bindProgram(b);b.setUniform1i("tex",0);b.setUniform2f("invFramebufferDim",1/e,1/f);a.setViewport(0,0,e,f);a.drawArrays(5,0,u.vertexCount(this.quadVAO,"geometry"))}};b.prototype.getGpuMemoryUsage=
function(){var a=u.getGpuMemoryUsage(this.blur0Fbo)+u.getGpuMemoryUsage(this.blur1Fbo);if(this._grid&&this._grid.coverageMipmap)for(var c=0,b=this._grid.coverageMipmap;c<b.length;c++)a+=u.getGpuMemoryUsage(b[c]);return a};return b}()})},"esri/core/libs/gl-matrix-2/vec4f32":function(){define(["require","exports","./factories/vec4f32"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.vec4f32=n})},"esri/core/libs/gl-matrix-2/factories/vec4f32":function(){define(["require","exports"],
function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return new Float32Array(4)};b.clone=function(b){var f=new Float32Array(4);f[0]=b[0];f[1]=b[1];f[2]=b[2];f[3]=b[3];return f};b.fromValues=function(b,f,k,d){var h=new Float32Array(4);h[0]=b;h[1]=f;h[2]=k;h[3]=d;return h};b.createView=function(b,f){return new Float32Array(b,f,4)}})},"esri/views/3d/webgl-engine/shaders/HighlightPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver",
"../../../webgl/programUtils"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});var d=function(b){return k.glslifyDefineMap({GRID_OPTIMIZATION:b.gridOptimization,GAUSSIAN_SAMPLES:b.gaussianSamples})},h=function(b){return k.glslifyDefineMap({GRID_OPTIMIZATION:b.gridOptimization,GRID_DEBUG:b.gridDebug})};b.downsamplePass={name:"highlight-downsample",shaders:{vertexShader:f.resolveIncludes("renderer/highlight/downsample.vert"),fragmentShader:f.resolveIncludes("renderer/highlight/downsample.frag")},
attributes:n.Default3D};b.blurPass={name:"highlight-blur",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("renderer/highlight/blur.vert"),fragmentShader:d(b)+f.resolveIncludes("renderer/highlight/blur.frag")}},attributes:n.Default3D};b.applyPass={name:"highlight-apply",shaders:function(b){return{vertexShader:h(b)+f.resolveIncludes("renderer/highlight/apply.vert"),fragmentShader:h(b)+f.resolveIncludes("renderer/highlight/apply.frag")}},attributes:n.Default3D}})},"esri/views/webgl/FramebufferObject":function(){define(["require",
"exports","../../core/has","./Renderbuffer","./Texture"],function(q,b,n,f,k){return function(){function b(d,m,p,c){this._colorAttachment=this._stencilAttachment=this._depthAttachment=this._glName=this._context=null;this._initialized=!1;this._context=d;this._desc={colorTarget:m.colorTarget,depthStencilTarget:m.depthStencilTarget,width:m.width,height:m.height,multisampled:m.multisampled};this._id=b._nextId++;n("esri-webgl-debug")&&d.instanceCounter.incrementCount(4);p&&(d=void 0,p instanceof k?(this._colorAttachment=
p,d=p.descriptor):(d=p,this._colorAttachment=new k(this._context,d)),0!==this._desc.colorTarget&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),b._validateTextureDimensions(d,this._desc));c instanceof f?(2===m.depthStencilTarget?this._stencilAttachment=c:1===m.depthStencilTarget||3===m.depthStencilTarget?this._depthAttachment=c:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),
b._validateBufferDimensions(c.descriptor,this._desc)):c&&(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),m=void 0,c instanceof k?(this._depthStencilTexture=c,m=this._depthStencilTexture.descriptor):(m=c,this._depthStencilTexture=new k(this._context,m)),b._validateTextureDimensions(m,this._desc))}b.create=function(d,f){return new b(d,f)};b.createWithAttachments=function(d,
f,k,c){return new b(d,k,f,c)};Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof k?this._colorAttachment:null},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"colorAttachment",{get:function(){return this._colorAttachment},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"depthStencilAttachment",{get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0});b.prototype.dispose=function(){if(this._context){var b=this._context,d=b.getBoundFramebufferObject();this._disposeColorAttachment();this._disposeDepthStencilAttachments();this._glName&&(b.gl.deleteFramebuffer(this._glName),this._glName=null);n("esri-webgl-debug")&&b.instanceCounter.decrementCount(4);b.bindFramebuffer(d);
this._context=null}};b.prototype.attachColorTexture=function(d){if(d){b._validateTextureDimensions(d.descriptor,this._desc);this._disposeColorAttachment();if(this._initialized){this._context.bindFramebuffer(this);var f=this._context.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,d.glName,0)}this._colorAttachment=d}};b.prototype.detachColorTexture=function(){var b=void 0;if(this._colorAttachment instanceof k){b=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);
var d=this._context.gl;this._context.gl.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,null,0)}this._colorAttachment=null}return b};b.prototype.attachDepthStencilTexture=function(d){if(d){var f=d.descriptor;34041!==f.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");34042!==f.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");
b._validateTextureDimensions(f,this._desc);4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),f=this._context.gl,f.framebufferTexture2D(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.TEXTURE_2D,d.glName,0));this._depthStencilTexture=d}};b.prototype.detachDepthStencilTexture=function(){var b=this._depthStencilTexture;if(b&&this._initialized){this._context.bindFramebuffer(this);var d=this._context.gl;
this._context.gl.framebufferTexture2D(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.TEXTURE_2D,null,0)}this._depthStencilTexture=null;return b};b.prototype.attachDepthStencilBuffer=function(d){if(d){var f=d.descriptor;34041!==f.internalFormat&&33189!==f.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat");b._validateBufferDimensions(f,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=34041===f.internalFormat?3:1;this._initialized&&(this._context.bindFramebuffer(this),
f=this._context.gl,f.framebufferRenderbuffer(f.FRAMEBUFFER,1===this._desc.depthStencilTarget?f.DEPTH_ATTACHMENT:f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,d.glName));this._depthAttachment=d}};b.prototype.detachDepthStencilBuffer=function(){var b=this._context.gl,d=this._depthAttachment;d&&this._initialized&&(this._context.bindFramebuffer(this),b.framebufferRenderbuffer(b.FRAMEBUFFER,1===this._desc.depthStencilTarget?b.DEPTH_ATTACHMENT:b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,null));this._depthAttachment=
null;return d};b.prototype.copyToTexture=function(b,d,f,c,a,l,g){(0>b||0>d||0>a||0>l)&&console.error("Offsets cannot be negative!");(0>=f||0>=c)&&console.error("Copy width and height must be greater than zero!");var e=this._desc,h=g.descriptor;3553!==g.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");(b+f>e.width||d+c>e.height||a+f>h.width||l+c>h.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");e=this._context;e.bindTexture(g);
e.bindFramebuffer(this);e.gl.copyTexSubImage2D(3553,0,a,l,b,d,f,c)};b.prototype.readPixels=function(b,d,f,c,a,l,g){(0>=f||0>=c)&&console.error("Copy width and height must be greater than zero!");g||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(b,d,f,c,a,l,g)};b.prototype.resize=function(d,f){var h=this._desc;if(h.width!==d||h.height!==f)if(this._initialized)h.width=d,h.height=f,this._colorAttachment instanceof k?(c=this._colorAttachment,
h=c.descriptor,h.width=d,h.height=f,this._colorAttachment.dispose(),this._colorAttachment=new k(this._context,h),b._validateTextureDimensions(c.descriptor,this._desc)):this._colorAttachment&&this._disposeColorAttachment(),null!=this._depthStencilTexture?(h=this._depthStencilTexture.descriptor,h.width=d,h.height=f,this._depthStencilTexture.dispose(),this._depthStencilTexture=new k(this._context,h)):(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments(),this._context.getBoundFramebufferObject()===
this&&this._context.bindFramebuffer(null),this._initialized=!1;else{h.width=d;h.height=f;if(this._colorAttachment instanceof k){var c=this._colorAttachment;c.resize(d,f)}this._depthStencilTexture&&this._depthStencilTexture.resize(d,f)}};b.prototype.initialize=function(){if(this._initialized)return!1;var b=this._context.gl;this._glName&&b.deleteFramebuffer(this._glName);var d=b.createFramebuffer(),p=this._desc;b.bindFramebuffer(b.FRAMEBUFFER,d);if(!this._colorAttachment)if(0===p.colorTarget)this._colorAttachment=
new k(this._context,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:p.width,height:p.height});else{var c=new f(this._context,{internalFormat:32854,width:p.width,height:p.height});b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,c.glName);this._colorAttachment=c}this._colorAttachment instanceof k&&b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this._colorAttachment.glName,0);switch(p.depthStencilTarget){case 1:case 3:this._depthAttachment||
(this._depthAttachment=new f(this._context,{internalFormat:1===p.depthStencilTarget?33189:34041,width:p.width,height:p.height}));b.framebufferRenderbuffer(b.FRAMEBUFFER,1===p.depthStencilTarget?b.DEPTH_ATTACHMENT:b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new f(this._context,{internalFormat:36168,width:p.width,height:p.height}));b.framebufferRenderbuffer(b.FRAMEBUFFER,b.STENCIL_ATTACHMENT,b.RENDERBUFFER,this._stencilAttachment.glName);
break;case 4:this._depthStencilTexture||(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new k(this._context,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:p.width,height:p.height})),b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,this._depthStencilTexture.glName,0)}b.checkFramebufferStatus(b.FRAMEBUFFER)!==
b.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=d;return this._initialized=!0};b.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof k){var b=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var d=this._context.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,null,0)}b.dispose()}else this._colorAttachment instanceof WebGLRenderbuffer&&(b=this._colorAttachment,d=this._context.gl,this._initialized&&
(this._context.bindFramebuffer(this),d.framebufferRenderbuffer(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(b));this._colorAttachment=null};b.prototype._disposeDepthStencilAttachments=function(){var b=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),b.framebufferRenderbuffer(b.FRAMEBUFFER,1===this._desc.depthStencilTarget?b.DEPTH_ATTACHMENT:b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,null)),this._depthAttachment.dispose(),
this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.STENCIL_ATTACHMENT,b.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};b._validateBufferDimensions=
function(b,d){console.assert(0<=b.width&&0<=b.height);void 0!==d.width&&0<=d.width&&void 0!==d.height&&0<=d.height?d.width===b.width&&d.height===b.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(d.width=b.width,d.height=b.height)};b._validateTextureDimensions=function(b,d){console.assert(0<=b.width&&0<=b.height);3553!==b.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==d.width&&0<=d.width&&void 0!==d.height&&0<=d.height?d.width===b.width&&d.height===
b.height||console.error("Color attachment texture must match the framebuffer's!"):(d.width=b.width,d.height=b.height)};b._nextId=0;return b}()})},"esri/views/webgl/Renderbuffer":function(){define(["require","exports","../../core/has"],function(q,b,n){return function(){function b(f,d){this._context=f;this._desc=d;this._glName=null;this._id=-1;f=this._context.gl;n("esri-webgl-debug")&&this._context.instanceCounter.incrementCount(5);this._id=++b._nextId;this._glName=f.createRenderbuffer();this._context.bindRenderbuffer(this);
f.renderbufferStorage(f.RENDERBUFFER,d.internalFormat,d.width,d.height)}Object.defineProperty(b.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});b.prototype.resize=function(b,d){var f=this._context.gl,m=this._desc;if(m.width!==b||m.height!==d)m.width=
b,m.height=d,this._context.bindRenderbuffer(this),f.renderbufferStorage(f.RENDERBUFFER,m.internalFormat,m.width,m.height)};b.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null);n("esri-webgl-debug")&&this._context.instanceCounter.decrementCount(5);this._context=null};b._nextId=0;return b}()})},"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":function(){define("require exports ./glUtil3D ./RenderTargetHelper ./Util ../shaders/OffscreenPrograms ../../../webgl/renderState ../../../webgl/Util".split(" "),
function(q,b,n,f,k,d,h,m){var p=[0,0,0,0],c=[0,1,0,1];return function(){function a(a,c){this.dimensions={width:4,height:4};this._enabled=!1;this._background={type:"color",color:[0,0,0,1]};this._compositePipelineState=new Map;this._rctx=c;c=this.renderTargetHelper=new f.RenderTargetHelper(c);this.mainColor=c.registerColorTarget({name:"mainColor"});this.mainDepth=c.registerDepthTarget({name:"mainDepth"});this.linearDepth=c.registerColorTarget({name:"linearDepth"});this.normal=c.registerColorTarget({name:"normal"});
this.highlight=c.registerColorTarget({name:"highlight",dataType:32819});this.hudVisibility=c.registerColorTarget({name:"hudVisibility",dataType:32819});this.tmpColor=c.registerColorTarget({name:"tmpColor"});this.tmpDepth=c.registerDepthTarget({name:"tmpDepth"});this._compositeProgram=a.getProgram(d.composite);this._compositePipelineState.set("none",h.makePipelineState({colorWrite:h.defaultColorWriteParams}));this._compositePipelineState.set("alpha",h.makePipelineState({blending:h.separateBlendingParams(770,
1,771,771),colorWrite:h.defaultColorWriteParams}));this._compositePipelineState.set("premultiplied-alpha",h.makePipelineState({blending:h.simpleBlendingParams(1,771),colorWrite:h.defaultColorWriteParams}));this._compositeTransparentToHUDVisibilityProgram=a.getProgram(d.compositeTransparentToHUDVisibility);this._compositeTransparentToHUDVisibilityPipelineState=h.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}});this._compositeOccludedProgram=a.getProgram(d.compositeOccluded);this._compositeOccludedPipelineState=
h.makePipelineState({blending:h.simpleBlendingParams(1,771),colorWrite:h.defaultColorWriteParams})}Object.defineProperty(a.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this.dimensions.height},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});
Object.defineProperty(a.prototype,"background",{get:function(){return this._background},set:function(a){this._background=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"framebuffer",{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.mainColor,this.mainDepth)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorTexture",{get:function(){return this.framebuffer.colorTexture},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"depthTexture",{get:function(){return this.framebuffer.depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"linearDepthTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.linearDepth)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"normalTexture",{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.normal)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"highlightTexture",
{get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.highlight)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hudVisibilityTexture",{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"tmpColorTexture",{get:function(){return this.getColorTexture(this.tmpColor)},enumerable:!0,configurable:!0});a.prototype.initializeFrame=function(a,c){k.assert(this.enabled);var b=this._rctx;
this.dimensions.width=a.fullWidth;this.dimensions.height=a.fullHeight;this.outputFramebuffer=c;this.bindTarget(this.mainColor,this.mainDepth);b.setClearStencil(0);a=this._background.color;b.setClearColor(a[0]*a[3],a[1]*a[3],a[2]*a[3],a[3]);b.clearSafe(17664)};a.prototype.renderSeparateAndComposite=function(a,c,b){void 0===c&&(c=p);void 0===b&&(b="none");this.renderToTargets(a,this.tmpColor,this.mainDepth,c);this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,b)};a.prototype.renderHUDVisibility=
function(a){this.renderToTargets(a,this.hudVisibility,this.mainDepth,c)};a.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var a=this,c=this._rctx;this.renderToTargets(function(){var b=a._compositeTransparentToHUDVisibilityProgram;c.bindProgram(b);c.setPipelineState(a._compositeTransparentToHUDVisibilityPipelineState);b.setUniform1i("tex",1);c.bindTexture(a.getColorTexture(a.tmpColor),1);c.bindVAO(a.quadVAO);c.drawArrays(5,0,m.vertexCount(a.quadVAO,"geometry"))},this.hudVisibility,
this.mainDepth)};a.prototype.compositeTransparentTerrainOntoMain=function(){this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,"premultiplied-alpha")};a.prototype.compositeOccludedOntoMain=function(a){var c=this._rctx,b=this._compositeOccludedProgram;this.bindFramebuffer();c.bindProgram(b);c.setPipelineState(this._compositeOccludedPipelineState);c.bindVAO(this.quadVAO);c.bindTexture(this.getColorTexture(this.tmpColor),0);b.setUniform1i("occludedColorMap",0);b.setUniform1f("opacity",
a);c.drawArrays(5,0,m.vertexCount(this.quadVAO,"geometry"));c.bindVAO(null)};a.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};a.prototype.renderDepthDetached=function(a){var c=this.bindTarget(this.mainColor);a(c);this.bindTarget(this.mainColor,this.mainDepth)};a.prototype.composite=function(a,c,b){void 0===a&&(a=this.framebuffer.colorTexture);void 0===c&&(c=this.outputFramebuffer);void 0===b&&(b="none");var d=this._rctx,e=this._compositeProgram;d.bindFramebuffer(c);
d.bindProgram(e);d.setPipelineState(this._compositePipelineState.get(b));e.setUniform1i("tex",1);d.bindTexture(a,1);d.bindVAO(this.quadVAO);d.drawArrays(5,0,m.vertexCount(this.quadVAO,"geometry"))};a.prototype.disposeTarget=function(a){this.renderTargetHelper.disposeTargetResource(a)};a.prototype.enable=function(){this.enabled||(this._enabled=!0,this.quadVAO=n.createQuadVAO(this._rctx))};a.prototype.disable=function(){this.enabled&&(this._enabled=!1,this.renderTargetHelper.disposeAllResource(),this.quadVAO.dispose(!0),
this.quadVAO=null)};a.prototype.renderToTargets=function(a,c,b,d,f){var e=this._rctx;c=this.bindTarget(c,b);b=0;d&&(e.setClearColor(d[0],d[1],d[2],Math.max(1E-13,d[3])),b|=16384);f&&(b|=256);e.clearSafe(b);a(c);e.gl.flush();this.bindTarget(this.mainColor,this.mainDepth);return c};a.prototype.bindTarget=function(a,c){a=this.renderTargetHelper.getFramebuffer(this.dimensions,a,c);this._rctx.bindFramebuffer(a);return a};a.prototype.getColorTexture=function(a){return this.renderTargetHelper.getColorTexture(a,
this.dimensions)};a.prototype.getGpuMemoryUsage=function(){var a=0;this.renderTargetHelper&&(a+=this.renderTargetHelper.getGpuMemoryUsage());return a};return a}()})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/Texture ../../../webgl/Util".split(" "),function(q,b,n,f,k,d,h){Object.defineProperty(b,"__esModule",{value:!0});var m={dataType:5121},
p={};q=function(){function c(a){this.rctx=a;this.activeTargets=new Set;this.depthTextures=new Map;this.depthBuffers=new Map;this.colorTextures=new Map;this.framebuffers=new Map;this.nextId=1;this.depthTextureSupported=a.capabilities.depthTexture}c.prototype.disposeAllResource=function(){this.depthBuffers.forEach(function(a){return a.dispose()});this.depthBuffers.clear();this.depthTextures.forEach(function(a){return a.dispose()});this.depthTextures.clear();this.colorTextures.forEach(function(a){return a.dispose()});
this.colorTextures.clear()};c.prototype.disposeTargetResource=function(a){a=a.id;this.activeTargets.has(a)&&(this.activeTargets.delete(a),this.depthTextures.has(a)&&(this.depthTextures.get(a).dispose(),this.depthTextures.delete(a)),this.depthBuffers.has(a)&&(this.depthBuffers.get(a).dispose(),this.depthBuffers.delete(a)),this.colorTextures.has(a)&&(this.colorTextures.get(a).dispose(),this.colorTextures.delete(a)))};c.prototype.getDepthTexture=function(a,c){if(this.depthTextureSupported){var b=this.depthTextures.get(a.id);
!b||b.descriptor.width===c.width&&b.descriptor.height===c.height||(b.dispose(),b=void 0);b||(b=new d(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:c.width,height:c.height}),this.depthTextures.set(a.id,b),this.activeTargets.add(a.id));return b}};c.prototype.getDepthBuffer=function(a,c){if(!this.depthTextureSupported){var b=this.depthBuffers.get(a.id);b?b.descriptor.width===c.width&&b.descriptor.height===c.height||b.resize(c.width,c.height):(b=new k(this.rctx,
n({internalFormat:34041},c)),this.depthBuffers.set(a.id,b),this.activeTargets.add(a.id));return b}};c.prototype.getColorTexture=function(a,c){var b=this.colorTextures.get(a.id);!b||b.descriptor.width===c.width&&b.descriptor.height===c.height||(b.dispose(),b=void 0);b||(b=new d(this.rctx,{target:3553,pixelFormat:6408,dataType:a.dataType,samplingMode:9729,wrapMode:33071,width:c.width,height:c.height}),this.colorTextures.set(a.id,b),this.activeTargets.add(a.id));return b};c.prototype.getAllocatedColorTexture=
function(a){return this.colorTextures.get(a.id)};c.prototype.registerDepthTarget=function(a){void 0===a&&(a={});var c=this.nextId++;return n({id:c},p,a)};c.prototype.registerColorTarget=function(a){void 0===a&&(a={});var c=this.nextId++;return n({id:c},m,a)};c.prototype.getFramebuffer=function(a,c,b){var d=this.getKey(c,b),g=this.framebuffers.get(d);c=this.getColorTexture(c,a);if(this.depthTextureSupported){var h=b?this.getDepthTexture(b,a):void 0;if(!g)return g=b?f.createWithAttachments(this.rctx,
c,{colorTarget:0,depthStencilTarget:4},h):f.createWithAttachments(this.rctx,c,{colorTarget:0,depthStencilTarget:0}),this.framebuffers.set(d,g),g;if(b=g.width!==a.width||g.height!==a.height||g.colorTexture!==c||g.depthStencilTexture!==h)g.detachColorTexture(),g.detachDepthStencilTexture(),g.resize(a.width,a.height),g.attachColorTexture(c),g.attachDepthStencilTexture(h);return g}h=b?this.getDepthBuffer(b,a):void 0;if(!g)return g=f.createWithAttachments(this.rctx,c,{colorTarget:0,depthStencilTarget:b?
3:0},h),this.framebuffers.set(d,g),g;if(b=g.width!==a.width||g.height!==a.height||g.colorTexture!==c)g.detachColorTexture(),g.detachDepthStencilBuffer(),g.resize(a.width,a.height),g.attachColorTexture(c),g.attachDepthStencilBuffer(h);return g};c.prototype.getKey=function(a,c){return a.id+"_"+(c?c.id:"X")+"_"+a.name+(c?"_"+c.name:"")};c.prototype.getGpuMemoryUsage=function(){var a=0,c=new Set,b=function(b){c.has(b)||(c.add(b),a+=h.getGpuMemoryUsage(b))};this.depthTextures.forEach(b);this.colorTextures.forEach(b);
this.depthBuffers.forEach(b);this.framebuffers.forEach(b);return a};return c}();b.RenderTargetHelper=q})},"esri/views/3d/webgl-engine/shaders/OffscreenPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});b.composite={name:"offscreen-composite",shaders:{vertexShader:f.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:f.resolveIncludes("renderer/offscreen/composite.frag")},
attributes:n.Default3D};b.compositeTransparentToHUDVisibility={name:"offscreen-composite-transparent-to-hud-visibility",shaders:{vertexShader:f.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:f.resolveIncludes("renderer/offscreen/compositeTransparentToHUDVisibility.frag")},attributes:n.Default3D};b.compositeOccluded={name:"offscreen-composite-occluded",shaders:{vertexShader:f.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:f.resolveIncludes("renderer/offscreen/compositeOccluded.frag")},
attributes:n.Default3D}})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["require","exports"],function(q,b){return function(){function b(b,k,d,h,m,p){this.camera=null;this.slot=this.pass=0;this.options=null;this.renderOccludedMask=5;this.rctx=b;this.offscreenRenderingHelper=k;this.lightingData=d;this.shadowMap=h;this.ssaoHelper=m;this.sliceHelper=p}b.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=5};Object.defineProperty(b.prototype,"isHighlightPass",{get:function(){return 4===
this.pass},enumerable:!0,configurable:!0});return b}()})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define(["require","exports","./depthRange"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this.pluginContext=b;this.pluginsChanged=!1;this.renderPlugins=[];this.slots=[];for(b=0;19>b;++b)this.slots[b]=[]}b.prototype.add=function(b,f){this.renderPlugins.push(f);for(var d=0;d<b.length;++d)this.slots[b[d]].push(f);f.initializeRenderContext(this.pluginContext);
this.pluginsChanged=!0};b.prototype.remove=function(b){this.renderPlugins=this.renderPlugins.filter(function(d){return d!==b});for(var d=0;d<this.slots.length;++d)this.slots[d]=this.slots[d].filter(function(d){return d!==b});b.uninitializeRenderContext(this.pluginContext);this.pluginsChanged=!0};b.prototype.prepareRender=function(b){for(var d=0,f=this.renderPlugins;d<f.length;d++){var k=f[d];k.prepareRender&&k.prepareRender(b)}};b.prototype.render=function(b,f){f.slot=b;var d=!1,h=0;for(b=this.slots[b];h<
b.length;h++){var c=b[h];c.render(f)&&(d=c.didRender=!0)}return d};b.prototype.queryDepthRange=function(b){var d=f;d.near=Infinity;d.far=-Infinity;for(var m=0,k=this.renderPlugins;m<k.length;m++){var c=k[m];c.queryDepthRange&&(c=c.queryDepthRange(b))&&n.union(d,c,d)}return d};b.prototype.needsRender=function(){if(this.pluginsChanged)return!0;for(var b=0,f=this.renderPlugins;b<f.length;b++)if(f[b].needsRender)return!0;return!1};b.prototype.needsHighlight=function(){for(var b=0,f=this.renderPlugins;b<
f.length;b++)if(f[b].needsHighlight)return!0;return!1};b.prototype.needsLinearDepth=function(){for(var b=0,f=this.renderPlugins;b<f.length;b++)if(f[b].needsLinearDepth)return!0;return!1};b.prototype.resetNeedsRender=function(){this.pluginsChanged=!1;for(var b=0,f=this.renderPlugins;b<f.length;b++){var m=f[b];m.resetNeedsRender?m.resetNeedsRender():m.didRender&&(m.needsRender=!1,m.didRender=!1)}};return b}();b.RenderPluginManager=q;var f={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("require exports ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/mathUtils ./Camera ./glUtil3D ./Util ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y){function w(a,c){d.vec2.set(ba,a[c],a[c+3]);return ba}var x=function(){return function(){this.camera=new g;this.lightMat=k.mat4f64.create()}}();q=function(){function a(a){this.doShadowMapMipmapsWork=!1;this.textureRes=4096;this.numCascades=1;this.maxNumCascades=2;this.cascadeDistances=[0,0,0,0,0];this.cascades=[];this.rctx=a;this.emptyTexture=e.createEmptyTexture(a);for(a=0;4>a;++a)this.cascades.push(new x)}a.prototype.dispose=function(){this.emptyTexture.dispose();
this.emptyTexture=null};Object.defineProperty(a.prototype,"textureResolution",{get:function(){return this.textureRes},set:function(a){this.textureRes=a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(a){this.maxNumCascades=l.clamp(Math.floor(a),1,4)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"enabled",{get:function(){return!!this.depthTexture},set:function(a){a?this.enable():this.disable()},
enumerable:!0,configurable:!0});a.prototype.getDepthTexture=function(){return this.depthTexture};a.prototype.getCascades=function(){for(var a=0;a<this.numCascades;++a)P[a]=this.cascades[a];P.length=this.numCascades;return P};a.prototype.prepare=function(a,b,e){u.assert(this.enabled);f.mat4.multiply(z,a.projectionMatrix,a.viewMatrix);var g=e.near,h=e.far;2>g&&(g=2);2>h&&(h=2);g>=h&&(g=2,h=4);this.numCascades=Math.min(1+Math.floor(u.logWithBase(h/g,4)),this.maxNumCascades);var k=Math.pow(h/g,1/this.numCascades);
for(e=0;e<this.numCascades+1;++e)this.cascadeDistances[e]=g*Math.pow(k,e);f.mat4.invert(A,z);f.mat4.lookAt(O,[0,0,0],[-b[0],-b[1],-b[2]],[0,1,0]);k=a.viewMatrix;a=a.projectionMatrix;for(e=0;e<this.numCascades;++e){var p=this.cascades[e],h=-this.cascadeDistances[e],g=-this.cascadeDistances[e+1],h=(a[10]*h+a[14])/Math.abs(a[11]*h+a[15]),g=(a[10]*g+a[14])/Math.abs(a[11]*g+a[15]);u.assert(h<g);for(var r=0;8>r;++r){c.vec4.set(B,0===r%4||3===r%4?-1:1,0===r%4||1===r%4?-1:1,4>r?h:g,1);c.vec4.transformMat4(C[r],
B,A);for(var n=0;3>n;++n)C[r][n]/=C[r][3]}m.vec3.negate(N,C[0]);f.mat4.translate(v,O,N);p.camera.viewMatrix=v;for(r=0;8>r;++r)m.vec3.transformMat4(C[r],C[r],p.camera.viewMatrix);m.vec3.copy(E,C[0]);m.vec3.copy(F,C[0]);for(r=1;8>r;++r)for(n=0;3>n;++n)E[n]=Math.min(E[n],C[r][n]),F[n]=Math.max(F[n],C[r][n]);E[2]-=200;F[2]+=200;p.camera.near=-F[2];p.camera.far=-E[2];g=1/C[0][3];h=1/C[4][3];u.assert(g<h);var n=g+Math.sqrt(g*h),r=Math.sin(l.acos(k[2]*b[0]+k[6]*b[1]+k[10]*b[2])),n=n/r,g=C,t=n,x=r,r=H,y=
D,q=G,Z=K,n=M;d.vec2.set(R,0,0);for(var L=0;4>L;++L)d.vec2.add(R,R,g[L]);d.vec2.scale(R,R,.25);d.vec2.set(J,0,0);for(L=4;8>L;++L)d.vec2.add(J,J,g[L]);d.vec2.scale(J,J,.25);d.vec2.lerp(U[0],g[4],g[5],.5);d.vec2.lerp(U[1],g[5],g[6],.5);d.vec2.lerp(U[2],g[6],g[7],.5);d.vec2.lerp(U[3],g[7],g[4],.5);for(var ea=0,T=d.vec2.squaredDistance(U[0],R),L=1;4>L;++L){var P=d.vec2.squaredDistance(U[L],R);P<T&&(T=P,ea=L)}d.vec2.subtract(Q,U[ea],g[ea+4]);L=Q[0];Q[0]=-Q[1];Q[1]=L;d.vec2.subtract(I,J,R);d.vec2.lerp(Q,
Q,I,x);d.vec2.normalize(Q,Q);ea=x=void 0;x=ea=d.vec2.dot(d.vec2.subtract(V,g[0],R),Q);for(L=1;8>L;++L)T=d.vec2.dot(d.vec2.subtract(V,g[L],R),Q),T<x?x=T:T>ea&&(ea=T);d.vec2.copy(r,R);d.vec2.scale(V,Q,x-t);d.vec2.add(r,r,V);for(var P=-1,ga=1,L=t=T=0;8>L;++L){d.vec2.subtract(X,g[L],r);d.vec2.normalize(X,X);var Y=Q[0]*X[1]-Q[1]*X[0];0<Y?Y>P&&(P=Y,T=L):Y<ga&&(ga=Y,t=L)}u.verify(0<P,"leftArea");u.verify(0>ga,"rightArea");d.vec2.scale(W,Q,x);d.vec2.add(W,W,R);d.vec2.scale(ca,Q,ea);d.vec2.add(ca,ca,R);da[0]=
-Q[1];da[1]=Q[0];y=u.rayRay2D(r,g[t],ca,d.vec2.add(V,ca,da),1,y);q=u.rayRay2D(r,g[T],ca,V,1,q);Z=u.rayRay2D(r,g[T],W,d.vec2.add(V,W,da),1,Z);g=u.rayRay2D(r,g[t],W,V,1,n);u.verify(y,"rayRay");u.verify(q,"rayRay");u.verify(Z,"rayRay");u.verify(g,"rayRay");q=H;g=D;r=K;Z=M;n=p.camera.projectionMatrix;d.vec2.subtract(aa,r,Z);d.vec2.scale(aa,aa,.5);S[0]=aa[0];S[1]=aa[1];S[2]=0;S[3]=aa[1];S[4]=-aa[0];S[5]=0;S[6]=aa[0]*aa[0]+aa[1]*aa[1];S[7]=aa[0]*aa[1]-aa[1]*aa[0];S[8]=1;S[6]=-d.vec2.dot(w(S,0),q);S[7]=
-d.vec2.dot(w(S,1),q);q=d.vec2.dot(w(S,0),r)+S[6];y=d.vec2.dot(w(S,1),r)+S[7];L=d.vec2.dot(w(S,0),Z)+S[6];Z=d.vec2.dot(w(S,1),Z)+S[7];q=-(q+L)/(y+Z);S[0]+=S[1]*q;S[3]+=S[4]*q;S[6]+=S[7]*q;q=1/(d.vec2.dot(w(S,0),r)+S[6]);y=1/(d.vec2.dot(w(S,1),r)+S[7]);S[0]*=q;S[3]*=q;S[6]*=q;S[1]*=y;S[4]*=y;S[7]*=y;S[2]=S[1];S[5]=S[4];S[8]=S[7];S[7]+=1;q=d.vec2.dot(w(S,1),g)+S[7];y=d.vec2.dot(w(S,2),g)+S[8];L=d.vec2.dot(w(S,1),r)+S[7];Z=d.vec2.dot(w(S,2),r)+S[8];q=-.5*(q/y+L/Z);S[1]+=S[2]*q;S[4]+=S[5]*q;S[7]+=S[8]*
q;q=d.vec2.dot(w(S,1),g)+S[7];y=d.vec2.dot(w(S,2),g)+S[8];L=-y/q;S[1]*=L;S[4]*=L;S[7]*=L;n[0]=S[0];n[1]=S[1];n[2]=0;n[3]=S[2];n[4]=S[3];n[5]=S[4];n[6]=0;n[7]=S[5];n[8]=0;n[9]=0;n[10]=1;n[11]=0;n[12]=S[6];n[13]=S[7];n[14]=0;n[15]=S[8];p.camera.projectionMatrix[10]=2/(E[2]-F[2]);p.camera.projectionMatrix[14]=-(E[2]+F[2])/(E[2]-F[2]);f.mat4.multiply(p.lightMat,p.camera.projectionMatrix,p.camera.viewMatrix);g=this.textureRes/2;p.camera.viewport[0]=0===e%2?0:g;p.camera.viewport[1]=0===Math.floor(e/2)?
0:g;p.camera.viewport[2]=g;p.camera.viewport[3]=g}this.lastOrigin=null;this.cascadeDistances[this.numCascades]=100*h;b=this.rctx;b.bindFramebuffer(this.fbo);b.bindTexture(null,7);b.setClearColor(1,1,1,1);b.clearSafe(16640)};a.prototype.finish=function(a){u.assert(this.enabled);this.rctx.bindFramebuffer(a);this.doShadowMapMipmapsWork&&this.depthTexture.generateMipmap()};a.prototype.bind=function(a){var c=this.rctx,b=this.enabled;c.bindTexture(b?this.depthTexture:this.emptyTexture,7);c.bindProgram(a);
a.setUniform1i("depthTex",7);a.setUniform1f("depthHalfPixelSz",b?.5/this.textureRes:-1);a.setUniform1i("shadowMapNum",this.numCascades);a.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.cascadeDistances[1],this.cascadeDistances[2],this.cascadeDistances[3])};a.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("shadowMapDistance");for(var c=0;c<a.length;c++)this.bind(a[c])};a.prototype.bindView=function(a,c){if(this.enabled){var b=this.lastOrigin;if(!b||b[0]!==c[0]||b[1]!==c[1]||
b[2]!==c[2])for(this.lastOrigin=this.lastOrigin||p.vec3f64.create(),m.vec3.copy(this.lastOrigin,c),b=0;b<this.numCascades;++b){f.mat4.translate(L,this.cascades[b].lightMat,c);for(var d=0;16>d;++d)T[16*b+d]=L[d]}a.setUniformMatrix4fv("shadowMapMatrix",T)}};a.prototype.enable=function(){this.enabled||(this.depthTexture=new r(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureRes,height:this.textureRes}),this.fbo=t.createWithAttachments(this.rctx,
this.depthTexture,{colorTarget:0,depthStencilTarget:1,width:this.textureRes,height:this.textureRes}))};a.prototype.disable=function(){this.enabled&&this.fbo&&(this.fbo.dispose(),this.depthTexture=this.fbo=null)};a.prototype.getGpuMemoryUsage=function(){return y.getGpuMemoryUsage(this.fbo)};return a}();var v=k.mat4f64.create(),z=k.mat4f64.create(),A=k.mat4f64.create(),B=a.vec4f64.create(),C=[];for(b=0;8>b;++b)C.push(a.vec4f64.create());var E=p.vec3f64.create(),F=p.vec3f64.create(),H=h.vec2f64.create(),
D=h.vec2f64.create(),G=h.vec2f64.create(),K=h.vec2f64.create(),M=h.vec2f64.create(),O=k.mat4f64.create(),N=p.vec3f64.create(),P=[],L=k.mat4f64.create(),T=new Float32Array(64),R=h.vec2f64.create(),J=h.vec2f64.create(),U=[h.vec2f64.create(),h.vec2f64.create(),h.vec2f64.create(),h.vec2f64.create()],Q=h.vec2f64.create(),I=h.vec2f64.create(),V=h.vec2f64.create(),X=h.vec2f64.create(),W=h.vec2f64.create(),ca=h.vec2f64.create(),da=h.vec2f64.create(),ba=h.vec2f64.create(),aa=h.vec2f64.create(),S=n.mat3f64.create();
return q})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["require","exports","../../support/geometryUtils"],function(q,b,n){var f=n.boundedPlane.create();return function(){function b(){this._worldPlane=f}Object.defineProperty(b.prototype,"isEnabled",{get:function(){return this.plane!==f},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"plane",{get:function(){return this._worldPlane},set:function(b){this._worldPlane=b?b:f},enumerable:!0,configurable:!0});return b}()})},
"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../support/imageUtils ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(q,b,n,f,k,d,h,m,p){return function(){function c(a){this.isEnabled=this._isLoadingResources=!1;this.vertexAttributeLocations={vPosition:0};this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,
stride:8,normalized:!1}];this.rctx=a}c.prototype.loadResources=function(a){var c=this;return this.data?!0:(this._isLoadingResources=!0,q(["./SmaaRenderPassData"],function(b){c.data=b;c._isLoadingResources=!1;a&&a()}),!1)};Object.defineProperty(c.prototype,"isLoadingResources",{get:function(){return this._isLoadingResources},enumerable:!0,configurable:!0});c.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;var a=this.rctx;this.programEdgeDetect=new d(a,this.data.edgeDetectShader.vertex,
this.data.edgeDetectShader.fragment,this.vertexAttributeLocations);this.programBlendWeights=new d(a,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations);this.programBlur=new d(a,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);this.pipelineState=h.makePipelineState({colorWrite:h.defaultColorWriteParams});var c=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new p(a,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},
{geometry:new f(a,34962,35044,c)});this.tmpFramebufferEdges=k.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.tmpFramebufferBlend=k.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.textureArea=this.loadTextureFromBase64(this.data.areaTexture,9729,6407);this.textureSearch=
this.loadTextureFromBase64(this.data.searchTexure,9728,6409);return this.isEnabled=!0};c.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=
null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)};c.prototype.render=function(a,c){this.enable();var b=this.rctx,d=0,f=0;null!=c?(d=c.descriptor.width,f=c.descriptor.height):(d=b.gl.canvas.width,f=b.gl.canvas.height);b.bindVAO(this.vao);b.setPipelineState(this.pipelineState);b.setViewport(0,0,d,f);this.tmpFramebufferEdges.resize(d,f);b.bindFramebuffer(this.tmpFramebufferEdges);b.setClearColor(0,0,0,1);b.clear(16384);b.bindProgram(this.programEdgeDetect);b.bindTexture(a.colorTexture,
0);this.programEdgeDetect.setUniform1i("tColor",0);this.programEdgeDetect.setUniform4f("uResolution",1/d,1/f,d,f);b.drawArrays(4,0,3);this.tmpFramebufferBlend.resize(d,f);b.bindFramebuffer(this.tmpFramebufferBlend);b.setClearColor(0,0,1,1);b.clear(16384);b.bindProgram(this.programBlendWeights);this.programBlendWeights.setUniform4f("uResolution",1/d,1/f,d,f);b.bindTexture(this.textureSearch,1);this.programBlendWeights.setUniform1i("tSearch",1);b.bindTexture(this.textureArea,2);this.programBlendWeights.setUniform1i("tArea",
2);b.bindTexture(this.tmpFramebufferEdges.colorTexture,3);this.programBlendWeights.setUniform1i("tEdges",3);b.drawArrays(4,0,3);b.bindFramebuffer(c);b.setClearColor(0,1,0,1);b.clear(16384);b.bindProgram(this.programBlur);this.programBlur.setUniform4f("uResolution",1/d,1/f,d,f);b.bindTexture(a.colorTexture,0);this.programBlur.setUniform1i("tColor",0);b.bindTexture(this.tmpFramebufferBlend.colorTexture,1);this.programBlur.setUniform1i("tBlendWeights",1);b.drawArrays(4,0,3)};c.prototype.loadTextureFromBase64=
function(a,c,b){var d=new m(this.rctx,{pixelFormat:b,dataType:5121,wrapMode:33071,samplingMode:c},null);n.requestImage(a).then(function(a){d.resize(a.width,a.height);d.setData(a)});return d};return c}()})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require exports ../../../../core/Logger ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec4 ../../../../core/libs/gl-matrix-2/vec4f64 ../../support/imageUtils ./glUtil3D ./Util ../shaders/SSAOPrograms ../../../webgl/FramebufferObject ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u){var t=n.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper");b=function(){function b(a,c,b){this._enabled=!1;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=h.vec4f64.create();this._rctx=c;this._programRep=a;this._requestRender=b;this._emptyTexture=p.createEmptyTexture(c)}b.prototype.dispose=function(){this._emptyTexture.dispose();this._emptyTexture=null};Object.defineProperty(b.prototype,"isSupported",{get:function(){var a=
this._rctx,c=-1!==a.parameters.versionString.indexOf("WebGL 0.93"),a=-1!==a.parameters.versionString.indexOf("WebGL 0.94");return!(c||a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"attenuation",{get:function(){return this._attenuation},set:function(a){this._attenuation=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"radius",{get:function(){return this._radius},set:function(a){this._radius=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"samples",{get:function(){return this._samples},set:function(a){this._samples=a;this._enabled&&this.selectPrograms()},enumerable:!0,configurable:!0});b.prototype.computeSSAO=function(a,b,e){if(this._noiseTexture){c.assert(this.enabled);var f=this._rctx,
g=a.fullViewport,h=g[2],l=g[3],g=h/this._BLUR_F,m=l/this._BLUR_F;this._ssaoFBO.resize(h,l);this._blur0FBO.resize(g,m);this._blur1FBO.resize(g,m);g=1*h;m=1*l;f.bindFramebuffer(this._ssaoFBO);d.vec4.copy(this._viewportToRestore,a.fullViewport);f.setViewport(0,0,h,l);var n=this._ssaoProgram,t=this._blurProgram;n.setUniform2f("rnmScale",h/this._noiseTexture.descriptor.width,l/this._noiseTexture.descriptor.height);n.setUniform3fv("pSphere",8>=this._samples?this._data.random8:16>=this._samples?this._data.random16:
32>=this._samples?this._data.random32:this._data.random64);f.bindProgram(n);f.setPipelineState(this._pipelineState);h=this._data.minDiscrepancy;n.setUniform1f("numSpiralTurns",this._samples<h.length?h[this._samples]:5779);h=y;l=r;c.inverseProjectionInfo(a.projectionMatrix,a.fullWidth,a.fullHeight,h,l);n.setUniform4fv("projInfo",h);n.setUniform2fv("zScale",l);n.setUniform2f("nearFar",a.near,a.far);h=1/a.computeRenderPixelSizeAtDist(1);n.setUniform1f("projScale",1*h);n.setUniform2f("screenDimensions",
g,m);var x=2*this._radius,l=k.vec3.distance(a.eye,a.center),x=20*a.computeRenderPixelSizeAtDist(l),x=Math.max(.1,x);n.setUniform1f("radius",x);n.setUniform1f("intensity",4*this._attenuation/Math.pow(x,6));n.setUniform1i("rnm",0);n.setUniform1i("normalMap",1);n.setUniform1i("depthMap",2);f.bindTexture(this._noiseTexture,0);f.bindTexture(e,1);f.bindTexture(b,2);b=p.createQuadVAO(this._rctx);f.bindVAO(b);f.drawArrays(5,0,u.vertexCount(b,"geometry"));f.bindTexture(this._ssaoFBO.colorTexture,0);f.setViewport(0,
0,g/this._BLUR_F,m/this._BLUR_F);f.bindFramebuffer(this._blur0FBO);t.setUniform2f("screenDimensions",g,m);t.setUniform1i("tex",0);t.setUniform1i("normalMap",1);t.setUniform1i("depthMap",2);t.setUniform2f("blurSize",0,1*this._BLUR_F/m);t.setUniform1i("radius",4);t.setUniform1f("g_BlurFalloff",.08);t.setUniform2f("nearFar",a.near,a.far);5E4<l&&(h=Math.max(0,h-(l-5E4)));t.setUniform1f("projScale",h);t.setUniform2f("zScale",1,0);f.drawArrays(5,0,u.vertexCount(b,"geometry"));t.setUniform2f("blurSize",
1*this._BLUR_F/g,0);f.bindFramebuffer(this._blur1FBO);f.bindTexture(this._blur0FBO.colorTexture,0);f.drawArrays(5,0,u.vertexCount(b,"geometry"));f.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}};b.prototype.setUniforms=function(a){var c=this.enabled&&this._noiseTexture,b=this._rctx;b.bindTexture(c?this._blur1FBO.colorTexture:this._emptyTexture,6);b.setActiveTexture(0);a.setUniform1i("ssaoTex",6);c?a.setUniform4f("viewportPixelSz",
this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):a.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};b.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("viewportPixelSz");for(var c=0;c<a.length;c++)this.setUniforms(a[c])};b.prototype.selectPrograms=function(){this._ssaoProgram=this._programRep.getProgram(a.ssaoPass,{samples:8>=this._samples?8:16>=this._samples?16:32>=this._samples?32:64});this._blurProgram=this._programRep.getProgram(a.blurPass,
{radius:4});this._pipelineState=g.makePipelineState({colorWrite:g.defaultColorWriteParams})};b.prototype.enable=function(){var a=this;this.enabled||(this.isSupported?(this._enabled=!0,this.loadResources(function(){a._enabled&&a.initialize()})):t.warn("SSAO is not supported for this browser or hardware"))};b.prototype.loadResources=function(a){var c=this;this._data?a():q(["./SSAOHelperData"],function(b){c._data=b;a()})};b.prototype.initialize=function(){var a=this,c={target:3553,pixelFormat:6408,dataType:5121,
samplingMode:9729,wrapMode:33071,width:0,height:0},b={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=l.createWithAttachments(this._rctx,c,b);this._blur0FBO=l.createWithAttachments(this._rctx,c,b);this._blur1FBO=l.createWithAttachments(this._rctx,c,b);m.requestImage(this._data.noiseTexture).then(function(c){a._enabled&&(a._noiseTexture=new e(a._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:c.width,height:c.height},c),a._requestRender())});this.selectPrograms()};b.prototype.disable=
function(){this.enabled&&(this._enabled=!1,this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))};b.prototype.getGpuMemoryUsage=function(){return u.getGpuMemoryUsage(this._blur0FBO)+u.getGpuMemoryUsage(this._blur1FBO)+u.getGpuMemoryUsage(this._ssaoFBO)};
return b}();var r=f.vec2f64.create(),y=h.vec4f64.create();return b})},"esri/views/3d/webgl-engine/shaders/SSAOPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});b.ssaoPass={name:"ssao",shaders:function(b){return{vertexShader:f.resolveIncludes("util/quad.vert"),fragmentShader:"#define SAMPLES "+b.samples+"\n"+f.resolveIncludes("renderer/ssao/ssao.frag")}},attributes:n.Default3D};
b.blurPass={name:"ssao-blur",shaders:function(b){return{vertexShader:f.resolveIncludes("util/quad.vert"),fragmentShader:"#define RADIUS "+b.radius+"\n"+f.resolveIncludes("renderer/ssao/blur.frag")}},attributes:n.Default3D}})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/arrayUtils ../../../../../core/promiseUtils ../../../../../core/requireUtils ../../../../../core/typedArrayUtil ../../../../../core/workers ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4f64 ../../../support/mathUtils ../../../support/buffer/BufferView ../../../support/buffer/utils ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../PreinterleavedGeometryData ../TextureBackedBuffer/BufferManager ./bufferLayouts ./edgeBufferWriters ./EdgeProcessingWorker ./EdgeRenderer ./strokes ./util ../../../../webgl/BufferObject ../../../../webgl/renderState ../../../../webgl/VertexArrayObject module".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C,E,F,H,D,G,K,M){Object.defineProperty(b,"__esModule",{value:!0});var O=function(){function b(a,c,b){this.rctx=a;this.programRepository=c;this.callbacks=b;this.profilingCallback=null;this.perObjectData=new Map;this.renderers=new Map;this.localOrigins=new x.LocalOriginManager(new y);this.gpuMemoryUsage=this.numberOfRenderedEdges=0;this.worker=new C;this.workerThread=null;this.destroyed=!1;this.tmpModelPosition=g.vec3f64.create();this.tmpCameraPosition=
g.vec3f64.create();this.componentColorManager=new z.BufferManager(this.rctx,2)}b.prototype.initialize=function(){var a=this;c.open(m.getAbsMid("./EdgeProcessingWorker",q,M)).then(function(c){a.destroyed?c.close():a.workerThread=c});for(var b=A.VertexLayout.createBuffer(4),d=0;4>d;d++)b.sideness.set(d,0,0===d||3===d?0:1),b.sideness.set(d,1,0===d||1===d?0:1);this.verticesBufferObject=D.createVertex(this.rctx,35044,b.buffer);this.pipelineState=(b=this.rctx.capabilities.blendMinMax)?G.makePipelineState({blending:G.separateBlendingParams(1,
1,0,1,32774,b.MAX),depthTest:{func:515},colorWrite:G.defaultColorWriteParams}):G.makePipelineState({depthTest:{func:515},depthWrite:G.defaultDepthWriteParams,colorWrite:G.defaultColorWriteParams})};b.prototype.destroy=function(){this.destroyed||(this.workerThread&&(this.workerThread.close(),this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.destroyed=!0)};b.prototype.getUsedMemory=function(){return this.gpuMemoryUsage};Object.defineProperty(b.prototype,
"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0});b.prototype.shouldRender=function(){return 0<this.renderers.size};b.prototype.addObject=function(a,c,b,d,e){return f(this,void 0,void 0,function(){var f,g,l,m,p,r,n;return k(this,function(k){switch(k.label){case 0:if(this.hasObject(a))return[2];f=[];l={loaded:h.create(function(a){return g=a}),renderables:[]};this.perObjectData.set(a,l);if(e&&e.mergeGeometries&&1<a.geometries.length&&this.canMergeGeometries(a))f.push(this.addObjectMergedGeometries(a,
l,c,b));else for(m=0;m<a.geometries.length;m++)p=a.geometries[m],r=a.geometryRecords[m],n=r.material,n.supportsEdges&&(p.data instanceof v?f.push(this.addGeometryPreinterleaved(a,l,p,p.data,r,c,b,d)):f.push(this.addGeometryNonPreinterleaved(a,l,p,p.data,r,c[0],b,d)));return[4,h.all(f)];case 1:return k.sent(),this.callbacks.setNeedsRender(),g(),[2]}})})};b.prototype.hasObject=function(a){return this.perObjectData.has(a)};b.prototype.updateAllComponentOpacities=function(a,c){return f(this,void 0,void 0,
function(){var b,d;return k(this,function(e){switch(e.label){case 0:return[4,this.getObjectEntry(a)];case 1:return b=e.sent(),d=c instanceof Array?function(a){return c[a]}:function(a){return c},b.renderables.forEach(function(a){for(var c=a.components.meta.length,b=0;b<c;b++){var e=d(b),f=a.components.meta[b],g=f.index;f.material.opacity=e;a.components.buffer.textureBuffer.setDataElement(g,1,3,255*e)}a.allTransparent=H.determineAllTransparent(a.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})};
b.prototype.updateAllComponentMaterials=function(a,c,b,d){void 0===d&&(d=!0);return f(this,void 0,void 0,function(){var e,f,g,h,l=this;return k(this,function(m){switch(m.label){case 0:return[4,this.getObjectEntry(a)];case 1:return e=m.sent(),f=b.slicePlaneEnabled||!1,g=H.determineRendererType(c),h=E.EdgeRenderer.getKey(g,f),e.renderables.forEach(function(a){if(h!==a.rendererKey){var b=l.renderers.get(a.rendererKey),e=l.acquireRenderer(g,f);b.removeRenderable(a);b.refCount.decrement();a.rendererKey=
h;e.addRenderable(a)}for(b=0;b<c.length;b++)a.components.meta[b].material=c[b];d&&l.updateComponentBuffer(a.components);a.allTransparent=H.determineAllTransparent(a.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})};b.prototype.updateObjectVisibility=function(a,c){return f(this,void 0,void 0,function(){var b;return k(this,function(d){switch(d.label){case 0:return[4,this.getObjectEntry(a)];case 1:return b=d.sent(),b.renderables.forEach(function(a){a.visible=c}),this.callbacks.setNeedsRender(),
[2]}})})};b.prototype.removeObject=function(a){var c=this,b=this.perObjectData.get(a);b&&(this.perObjectData.delete(a),b.loaded.then(function(){b.renderables.forEach(function(a){c.removeRenderable(a)});c.callbacks.setNeedsRender()}))};b.prototype.getObjectEntry=function(a){return f(this,void 0,void 0,function(){var c;return k(this,function(b){switch(b.label){case 0:c=this.perObjectData.get(a);if(!c)throw"no object";return[4,c.loaded];case 1:return b.sent(),[2,c]}})})};b.prototype.removeAll=function(){var a=
this;this.perObjectData.forEach(function(c,b){a.removeObject(b)})};b.prototype.createSolidEdgeMaterial=function(a){return n({},N,a,{type:"solid"})};b.prototype.createSketchEdgeMaterial=function(a){return n({},P,a,{type:"sketch"})};b.prototype.render=function(a){var c=this;this.localOrigins.updateViewMatrices(a.view);this.renderers.forEach(function(a){0===a.refCount.value&&(c.renderers.delete(a.key),a.dispose())});this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();
var b=a.view,d=0,e=0;this.renderers.forEach(function(a){a.forEachRenderable(function(a){d+=a.statistics.averageEdgeLength;e++})});var f={distanceFalloffFactor:d/e*40,minimumEdgeLength:H.estimateLengthAtDistance(a.viewport[3],a.fovY,1,3.5*a.pixelRatio)};this.rctx.setPipelineState(this.pipelineState);this.updateObjectCameraDistances(a);this.numberOfRenderedEdges=0;this.renderers.forEach(function(b){c.renderRegularEdges(b,a,f);c.renderSilhouetteEdges(b,a,f)});a.view=b};b.prototype.computeModelTransformWithLocalOrigin=
function(a,c,b){a.getCombinedStaticTransformation(c,b);c.origin?this.localOrigins.register(c.origin):(a=l.vec3.set(this.tmpModelPosition,b[12],b[13],b[14]),c.origin=this.localOrigins.aquire(a));w.applyToModelMatrix(c.origin.vec3,b);return b};b.prototype.updateComponentBuffer=function(a){var c=a.meta;a=a.buffer;for(var b=0;b<c.length;b++){var d=c[b].material,e=c[b].index,f=u.clamp(Math.round(d.size*E.LINE_WIDTH_FRACTION_FACTOR),0,255),g=u.clamp(d.extensionLength,-E.EXTENSION_LENGTH_OFFSET,255-E.EXTENSION_LENGTH_OFFSET)+
E.EXTENSION_LENGTH_OFFSET,h="solid"===d.type?0:1,l=255*d.opacity,d=d.color;a.textureBuffer.setData(e,0,255*d[0],255*d[1],255*d[2],255*d[3]);a.textureBuffer.setData(e,1,f,g,h,l)}};b.prototype.createComponentBuffers=function(a){for(var c=[],b=this.componentColorManager.getBuffer(a.length),d=0;d<a.length;d++){var e=a[d],f=b.aquireIndex();c.push({index:f,material:e})}a={meta:c,buffer:b};this.updateComponentBuffer(a);return a};b.prototype.extractEdges=function(a,c,b,d,e){return this.worker.process({data:c,
originalIndices:e,writerSettings:a,skipDeduplicate:b},d?null:this.workerThread)};b.prototype.createEdgeResources=function(a){var c={};if(0<a.regular.lodInfo.lengths.length){var b=new K(this.rctx,A.EdgeShaderAttributeLocations,{vertices:A.glVertexLayout,instances:B.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:D.createVertex(this.rctx,35044,a.regular.instancesData.buffer)});c.regular={vao:b,lod:a.regular.lodInfo}}0<a.silhouette.lodInfo.lengths.length&&(b=new K(this.rctx,
A.EdgeShaderAttributeLocations,{vertices:A.glVertexLayout,instances:B.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:D.createVertex(this.rctx,35044,a.silhouette.instancesData.buffer)}),c.silhouette={vao:b,lod:a.silhouette.lodInfo});return c};b.prototype.disposeEdgeResources=function(a){a.regular&&(a.regular.vao.vertexBuffers.instances.dispose(),a.regular.vao.dispose(!1),a.regular.vao=null);a.silhouette&&(a.silhouette.vao.vertexBuffers.instances.dispose(),a.silhouette.vao.dispose(!1),
a.silhouette.vao=null)};b.prototype.addGeometryNonPreinterleaved=function(c,b,d,e,g,h,l,m){return f(this,void 0,void 0,function(){var d,f,p,r;return k(this,function(k){d=e.getAttribute("position");f=this.computeModelTransformWithLocalOrigin(c,g,a.mat4f64.create());p=g.origin;r={position:d,indices:e.getIndices("position"),modelTransform:f,origin:p};return[2,this.addNonPreinterleaved(c,b,r,h,l,m)]})})};b.prototype.addNonPreinterleaved=function(a,c,b,d,e,g){void 0===g&&(g=!1);return f(this,void 0,void 0,
function(){var a,f,h,l,m,p,r,n,t,u,x,y,v,q,w;return k(this,function(k){switch(k.label){case 0:a=this.acquireRenderer(d.type,e.slicePlaneEnabled||!1);f=b.modelTransform;h=b.origin;l=b.indices;m=b.position;p=m.data.length/m.strideIdx;r=A.EdgeInputBufferLayout.createBuffer(p);for(n=0;n<p;n++)r.position.set(n,0,m.data[m.offsetIdx+n*m.strideIdx+0]),r.position.set(n,1,m.data[m.offsetIdx+n*m.strideIdx+1]),r.position.set(n,2,m.data[m.offsetIdx+n*m.strideIdx+2]);t=this.createComponentBuffers([d]);H.fillComponenBufferIndices(t.meta,
[0,r.componentIndex.count],r.componentIndex);return[4,this.extractEdges(a.writerSettings,r,!1,g,l)];case 1:return u=k.sent(),x=this.createEdgeResources(u),y=x.regular,v=x.silhouette,q=(y?y.vao.size:0)+(v?v.vao.size:0),w={regular:y,silhouette:v,transform:{modelMatrix:f,origin:h},statistics:{gpuMemoryUsage:q,averageEdgeLength:u.averageEdgeLength},components:t,visible:!0,allTransparent:H.determineAllTransparent(t.meta),distanceToCamera:0,rendererKey:a.key},c.renderables.push(w),a.addRenderable(w),this.gpuMemoryUsage+=
q,[2]}})})};b.prototype.addGeometryPreinterleaved=function(c,b,d,e,g,h,l,m){return f(this,void 0,void 0,function(){var d,f,n,u,x,y,v,q,w,z,B,C,G,D,K,M;return k(this,function(k){switch(k.label){case 0:d=e.getAttribute("position");if(!d||!p.isFloat32Array(d.data))return console.warn("Geometry has no float32 `position` attribute, skipping it."),[2];f=H.determineRendererType(h);n=this.acquireRenderer(f,l.slicePlaneEnabled||!1);u=this.computeModelTransformWithLocalOrigin(c,g,a.mat4f64.create());x=g.origin;
y=e.getIndices("position");v=new t.BufferViewVec3f(d.data.buffer,4*d.offsetIdx,4*d.strideIdx);q=A.EdgeInputBufferLayout.createBuffer(v.count);r.vec3.copy(q.position,v);w=this.createComponentBuffers(h);H.fillComponenBufferIndices(w.meta,e.componentOffsets,q.componentIndex,y);z=e.hasPositionData;return[4,this.extractEdges(n.writerSettings,q,z,m,y)];case 1:return B=k.sent(),C=this.createEdgeResources(B),G=C.regular,D=C.silhouette,K=(G?G.vao.size:0)+(D?D.vao.size:0),M={regular:G,silhouette:D,transform:{modelMatrix:u,
origin:x},statistics:{gpuMemoryUsage:K,averageEdgeLength:B.averageEdgeLength},components:w,visible:!c.isHidden(g),allTransparent:H.determineAllTransparent(w.meta),distanceToCamera:0,rendererKey:n.key},b.renderables.push(M),n.addRenderable(M),this.gpuMemoryUsage+=K,[2]}})})};b.prototype.canMergeGeometries=function(a){for(var c=null,b=null,e=0;e<a.geometries.length;e++){var f=a.geometryRecords[e];if(f.material.supportsEdges){if(a.geometries[e].data instanceof v)return!1;if(!c)c=f.transformation;else if(!d.equals(c,
f.transformation))return!1;if(!b&&f.origin)b=f;else if(b&&f.origin&&b.origin.id!==f.origin.id)return!1}}return!0};b.prototype.addObjectMergedGeometries=function(c,b,d,e){return f(this,void 0,void 0,function(){var f,g,h,l,m,r,n,t,u,x,y,v,q,w,z,A,B,C,G,D,K;return k(this,function(k){switch(k.label){case 0:f=new Map;g=0;l=h=null;for(m=0;m<c.geometries.length;m++)if(r=c.geometries[m],n=c.geometryRecords[m],t=n.material,t.supportsEdges&&(!l&&n.origin&&(l=n),u=r.data.getIndices("position"),g+=u?u.length:
0,u&&null==h||h===Uint16Array))h=p.isUint16Array(u)?Uint16Array:Uint32Array;x=g?new h(g):null;y=[];for(m=v=0;m<c.geometries.length;m++)if(r=c.geometries[m],q=c.geometryRecords[m],t=q.material,t.supportsEdges){w=r.data.getAttribute("position");u=r.data.getIndices("position");z=f.get(w.data);if(null==z){z=y.length/3;for(A=w.offsetIdx;A<w.data.length;A+=w.strideIdx)y.push(w.data[A+0]),y.push(w.data[A+1]),y.push(w.data[A+2]);f.set(w.data,z)}if(u)for(B=0;B<u.length;B++)x[v++]=z+u[B]}C=l||c.geometryRecords[0];
G=this.computeModelTransformWithLocalOrigin(c,C,a.mat4f64.create());D=C.origin;for(m=0;m<c.geometryRecords.length;m++)c.geometryRecords[m].origin=D;K={position:{data:y,offsetIdx:0,strideIdx:3},indices:x,modelTransform:G,origin:D};return[4,this.addNonPreinterleaved(c,b,K,d[0],e)];case 1:return k.sent(),[2]}})})};b.prototype.acquireRenderer=function(a,c){var b=E.EdgeRenderer.getKey(a,c),d=this.renderers.get(b);this.strokesTexture||(this.strokesTexture=F.generateStrokesTexture(this.rctx));d||(d=new E.EdgeRenderer(this.rctx,
this.programRepository,{type:a,slicePlaneEnabled:c,strokesTexture:this.strokesTexture}),this.renderers.set(b,d));d.refCount.increment();return d};b.prototype.removeRenderable=function(a){var c=this.renderers.get(a.rendererKey);c.removeRenderable(a);c.refCount.decrement();this.disposeEdgeResources(a);this.localOrigins.release(a.transform.origin);this.gpuMemoryUsage-=a.statistics.gpuMemoryUsage;for(var c=0,b=a.components.meta;c<b.length;c++)a.components.buffer.releaseIndex(b[c].index)};b.prototype.updateObjectCameraDistances=
function(a){var c=this;a=a.viewInvTransp;l.vec3.set(this.tmpCameraPosition,a[3],a[7],a[11]);this.perObjectData.forEach(function(a,b){var d=l.vec3.distance(b.getCenter(),c.tmpCameraPosition);a.renderables.forEach(function(a){return a.distanceToCamera=d})})};b.prototype.renderRegularEdges=function(a,c,b){var d=this;a.bindRegularEdges(c,b);a.forEachRenderable(function(e){if(e.visible&&e.regular&&!e.allTransparent){var f=H.computeEdgeCount(e.regular.lod.lengths,e.distanceToCamera,b);c.view=d.localOrigins.getViewMatrix(e.transform.origin);
a.renderRegularEdges(e,c,f);d.numberOfRenderedEdges+=f}})};b.prototype.renderSilhouetteEdges=function(a,c,b){var d=this;a.bindSilhouetteEdges(c,b);a.forEachRenderable(function(e){if(e.visible&&e.silhouette&&!e.allTransparent){var f=H.computeEdgeCount(e.silhouette.lod.lengths,e.distanceToCamera,b);c.view=d.localOrigins.getViewMatrix(e.transform.origin);a.renderSilhouetteEdges(e,c,f);d.numberOfRenderedEdges+=f}})};return b}();b.EdgeView=O;var N={color:e.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,
opacity:1},P={color:e.vec4f64.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1}})},"esri/views/3d/support/buffer/utils":function(){define("require exports ./types ./utils/mat3 ./utils/mat4 ./utils/scalar ./utils/vec2 ./utils/vec3 ./utils/vec4".split(" "),function(q,b,n,f,k,d,h,m,p){Object.defineProperty(b,"__esModule",{value:!0});b.mat3=f;b.mat4=k;b.scalar=d;b.vec2=h;b.vec3=m;b.vec4=p;b.createBuffer=function(c,a){return new c(new ArrayBuffer(a*c.ElementCount*n.elementTypeSize(c.ElementType)))}})},
"esri/views/3d/support/buffer/utils/mat3":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,f,k){var d=b.typedBuffer;b=b.typedBufferStride;var h=f.typedBuffer,m=f.typedBufferStride;f=k?k.count:f.count;var p=(k&&k.dstIndex?k.dstIndex:0)*b;k=(k&&k.srcIndex?k.srcIndex:0)*m;for(var c=0;c<f;++c){for(var a=0;9>a;++a)d[p+a]=h[k+a];p+=b;k+=m}}})},"esri/views/3d/support/buffer/utils/mat4":function(){define(["require","exports"],function(q,
b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,f,k){var d=b.typedBuffer;b=b.typedBufferStride;var h=f.typedBuffer,m=f.typedBufferStride;f=k?k.count:f.count;var p=(k&&k.dstIndex?k.dstIndex:0)*b;k=(k&&k.srcIndex?k.srcIndex:0)*m;for(var c=0;c<f;++c){for(var a=0;16>a;++a)d[p+a]=h[k+a];p+=b;k+=m}}})},"esri/views/3d/support/buffer/utils/scalar":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,f,k){var d=b.typedBuffer;
b=b.typedBufferStride;var h=f.typedBuffer,m=f.typedBufferStride;f=k?k.count:f.count;var p=(k&&k.dstIndex?k.dstIndex:0)*b;k=(k&&k.srcIndex?k.srcIndex:0)*m;for(var c=0;c<f;++c)d[p]=h[k],p+=b,k+=m};b.makeDense=function(b,f){var k=b.count;f||(f=new b.TypedArrayConstructor(k));for(var d=0;d<k;d++)f[d]=b.get(d);return f}})},"esri/views/3d/support/buffer/utils/vec2":function(){define(["require","exports","../types"],function(q,b,n){function f(b,d,f){var h=b.typedBuffer;b=b.typedBufferStride;var k=d.typedBuffer,
c=d.typedBufferStride;d=f?f.count:d.count;var a=(f&&f.dstIndex?f.dstIndex:0)*b;f=(f&&f.srcIndex?f.srcIndex:0)*c;for(var l=0;l<d;++l)h[a]=k[f],h[a+1]=k[f+1],a+=b,f+=c}Object.defineProperty(b,"__esModule",{value:!0});b.copy=f;b.normalizeIntegerBuffer=function(b,d,h){var m=b.typedBuffer,k=b.typedBufferStride,c=d.typedBuffer,a=d.typedBufferStride,l=h?h.count:d.count,g=(h&&h.dstIndex?h.dstIndex:0)*k,e=(h&&h.srcIndex?h.srcIndex:0)*a;if(n.isInteger(d.elementType))if(h=n.maximumValue(d.elementType),n.isSigned(d.elementType))for(d=
0;d<l;++d)m[g]=Math.max(c[e]/h,-1),m[g+1]=Math.max(c[e+1]/h,-1),g+=k,e+=a;else for(d=0;d<l;++d)m[g]=c[e]/h,m[g+1]=c[e+1]/h,g+=k,e+=a;else f(b,d,h);return b}})},"esri/views/3d/support/buffer/utils/vec3":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,f,k){var d=b.typedBuffer;b=b.typedBufferStride;var h=f.typedBuffer,m=f.typedBufferStride;f=k?k.count:f.count;var p=(k&&k.dstIndex?k.dstIndex:0)*b;k=(k&&k.srcIndex?k.srcIndex:0)*m;
for(var c=0;c<f;++c)d[p]=h[k],d[p+1]=h[k+1],d[p+2]=h[k+2],p+=b,k+=m}})},"esri/views/3d/support/buffer/utils/vec4":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.copy=function(b,f,k){var d=b.typedBuffer;b=b.typedBufferStride;var h=f.typedBuffer,m=f.typedBufferStride;f=k?k.count:f.count;var p=(k&&k.dstIndex?k.dstIndex:0)*b;k=(k&&k.srcIndex?k.srcIndex:0)*m;for(var c=0;c<f;++c)d[p]=h[k],d[p+1]=h[k+1],d[p+2]=h[k+2],d[p+3]=h[k+3],p+=b,k+=m};b.fill=
function(b,f,k,d,h,m){var p=b.typedBuffer,c=b.typedBufferStride;b=m?m.count:b.count;m=(m&&m.dstIndex?m.dstIndex:0)*c;for(var a=0;a<b;++a)p[m]=f,p[m+1]=k,p[m+2]=d,p[m+3]=h,m+=c}})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.applyToModelMatrix=function(b,f){var k=-b[0],d=-b[1];b=-b[2];var h=f[3],m=f[7],p=f[11],c=f[15];f[0]+=h*k;f[1]+=h*d;f[2]+=h*b;f[4]+=m*k;f[5]+=m*d;f[6]+=m*b;f[8]+=p*k;
f[9]+=p*d;f[10]+=p*b;f[12]+=c*k;f[13]+=c*d;f[14]+=c*b};b.applyToViewMatrix=function(b,f){var k=b[0],d=b[1];b=b[2];f[12]+=k*f[0]+d*f[4]+b*f[8];f[13]+=k*f[1]+d*f[5]+b*f[9];f[14]+=k*f[2]+d*f[6]+b*f[10];f[14]+=k*f[3]+d*f[7]+b*f[11]}})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat4","../../../../core/libs/gl-matrix-2/mat4f64","./localOriginHelper"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});q=
function(){function b(b){this.factory=b;this.originData=new Map}b.prototype.aquire=function(b){return this.register(this.factory.getOrigin(b))};b.prototype.register=function(b){var d=this.originData.get(b.id);if(d)return d.refCount++,d.origin;this.originData.set(b.id,{refCount:1,viewMatrix:f.mat4f64.create(),origin:b});return b};b.prototype.release=function(b){var d=this.originData.get(b.id);d&&(d.refCount--,0===d.refCount&&this.originData.delete(b.id))};b.prototype.updateViewMatrices=function(b){this.originData.forEach(function(d){n.mat4.copy(d.viewMatrix,
b);k.applyToViewMatrix(d.origin.vec3,d.viewMatrix)})};b.prototype.getViewMatrix=function(b){return this.originData.get(b.id).viewMatrix};return b}();b.LocalOriginManager=q})},"esri/views/3d/webgl-engine/lib/PreinterleavedGeometryData":function(){define(["require","exports","./ComponentUtils","./geometryDataUtils","../../../webgl/Util"],function(q,b,n,f,k){function d(b){switch(b){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;
case 5125:return Uint32Array;case 5123:return Uint16Array}throw Error("Unhandled data type: "+b);}return function(){function b(h,p,c,a,l){void 0===c&&(c=null);void 0===a&&(a=b.DefaultOffsets);void 0===l&&(l=b.DefaultIndices);this.preinterleaved=!0;this.primitiveType="triangle";this._positionData=null;var g=k.getStride(p)/4,g=h.length/g;(this._hasDefaultIndices=l===b.DefaultIndices)&&(l=f.generateDefaultIndexArray(g));for(var g={},e=0;e<p.length;e++){var m=p[e],t=new (d(m.type))(h.buffer),r=k.getBytesPerElement(m.type);
g[m.name]={data:t,size:m.count,offsetIdx:m.offset/r,strideIdx:m.stride/r}}c&&(this._positionData=c,g.position={data:c.data,size:3,offsetIdx:0,strideIdx:3});this._id=f.getNewId();this._vertexData=h;this._vertexAttributes=g;this._layout=p;this._indexData=l;this._componentOffsets=n.createOffsets(a);this._gpuMemoryUsage=h.byteLength+(this._hasDefaultIndices?0:l.byteLength);this._indexCount=l.length}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"componentOffsets",{get:function(){return this._componentOffsets},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indexCount",{get:function(){return this._indexCount},enumerable:!0,configurable:!0});b.prototype.toRenderData=function(){var b={id:this._id.toString(),preinterleaved:!0,indexData:this._hasDefaultIndices?null:this._indexData,
indexCount:this._indexCount,vertexData:this._vertexData,layout:this._layout};this._indexData=this._vertexData=null;this._vertexAttributes={position:this._vertexAttributes.position};return b};b.prototype.getIndices=function(b){return"position"===b&&this._positionData?this._positionData.indices:this._indexData};b.prototype.getAttribute=function(b){return this._vertexAttributes[b]};b.prototype.estimateGpuMemoryUsage=function(){return this._gpuMemoryUsage};Object.defineProperty(b.prototype,"hasPositionData",
{get:function(){return!!this._positionData},enumerable:!0,configurable:!0});b.DefaultOffsets=new Uint32Array(0);b.DefaultIndices=new Uint32Array(0);return b}()})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["require","exports","./ManagedTextureBackedBuffer"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,d){void 0===d&&(d=1);this.rctx=b;this.fieldCount=d;this.buffers=[]}b.prototype.garbageCollect=function(){this.buffers=
this.buffers.filter(function(b){return 0===b.activeCount?(b.dispose(),!1):!0})};b.prototype.getBuffer=function(b){for(var d=0,f=this.buffers;d<f.length;d++){var m=f[d];if(m.availableCount>=b)return m}if(b>n.MAX_INDEX_COUNT)return null;b=new n.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);this.buffers.push(b);return b};b.prototype.updateTextures=function(){for(var b=0,d=this.buffers;b<d.length;b++)d[b].textureBuffer.updateTexture()};return b}();b.BufferManager=q})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["require",
"exports","./SimpleIndexManager","./TextureBackedBuffer"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});b.MAX_INDEX_COUNT=65536;q=function(){function k(d,h){void 0===h&&(h=1);this.textureBuffer=new f.TextureBackedBuffer(d,h);this.indexManager=new n.SimpleIndexManager(b.MAX_INDEX_COUNT)}k.prototype.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};Object.defineProperty(k.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},
enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0});k.prototype.aquireIndex=function(){var b=this.indexManager.aquire();this.textureBuffer.resizeToFit(b);return b};k.prototype.releaseIndex=function(b){this.indexManager.release(b)};return k}();b.ManagedTextureBackedBuffer=q})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["require","exports"],
function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this.maxCount=b;this._nextIndex=0;this.recycledIndices=[]}Object.defineProperty(b.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"availableCount",{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0});b.prototype.aquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();
if(this.availableCount)return this._nextIndex++};b.prototype.release=function(b){this.recycledIndices.push(b)};return b}();b.SimpleIndexManager=q})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["require","exports","../../../support/buffer/BufferView","../../../../webgl/Texture"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,h){void 0===h&&(h=1);this.rctx=b;this.fieldCount=h;this.textureWidth=4096;this.dirty=
!0;this.texture=new f(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1});this.data=new n.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}b.prototype.dispose=function(){this.texture.dispose();this.data=this.texture=void 0};b.prototype.setData=function(b,f,m,k,c,a){b=b*this.fieldCount+f;this.dirty=!0;this.data.set(b,0,m);this.data.set(b,1,k);this.data.set(b,2,c);this.data.set(b,3,a)};b.prototype.setDataElement=
function(b,f,m,k){b=b*this.fieldCount+f;this.dirty=!0;this.data.set(b,m,k)};b.prototype.resizeToFit=function(b){b*=this.fieldCount;b>=this.data.count&&(b=new n.BufferViewVec4u8(new ArrayBuffer(Math.ceil((b+1)/this.textureWidth)*this.textureWidth*4)),b.typedBuffer.set(this.data.typedBuffer),this.data=b)};b.prototype.updateTexture=function(){if(this.dirty){var b=this.texture.descriptor.width;this.data.count>b*this.texture.descriptor.height&&this.texture.resize(b,this.data.count/b);this.texture.setData(this.data.typedBuffer);
this.dirty=!1}};b.prototype.bind=function(b,f){this.rctx.bindTexture(this.texture,f.unit);b.setUniform1i(f.texName,f.unit);b.setUniform2f(f.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return b}();b.TextureBackedBuffer=q})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["require","exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});
b.EdgeInputBufferLayout=f.newLayout().vec3f("position").u16("componentIndex").u16("_padding");b.VertexLayout=f.newLayout().vec2u8("sideness");b.glVertexLayout=n.glLayout(b.VertexLayout,{prefixA:!0});b.CommonInstancesLayout=f.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").vec2u8("packedAttributes").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("_padding",{glPadding:!0});b.RegularEdgeInstancesLayout=b.CommonInstancesLayout.clone().vec3f("normal");
b.SilhouetteEdgeInstancesLayout=b.CommonInstancesLayout.clone().vec3f("normalA").vec3f("normalB");b.EdgeShaderAttributeLocations={aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/RandomLCG ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),
function(q,b,n,f,k,d,h,m,p){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function c(){}c.prototype.updateSettings=function(a){this.settings=a};c.prototype.write=function(c,b,d){var f=a;f[0]=d.position0[0];f[1]=d.position0[1];f[2]=d.position0[2];f[3]=d.position1[0];f[4]=d.position1[1];f[5]=d.position1[2];g[0]=5381;for(f=0;f<l.length;f++)g[0]=31*g[0]+l[f];e.seed=g[0];var f=e.getIntRange(0,255),h=e.getIntRange(0,this.settings.variants-1),m=e.getFloat(),m=-(1-Math.min(m/.7,1))+Math.max(0,
m-.7)/(1-.7),m=255*(Math.pow(Math.abs(m),1.2)*(0>m?-1:1)*.5+.5);c.position0.setVec(b,d.position0);c.position1.setVec(b,d.position1);c.componentIndex.set(b,d.componentIndex);c.variantOffset.set(b,f);c.variantStroke.set(b,h);c.variantExtension.set(b,m)};c.prototype.trim=function(a,c){return a.slice(0,c)};return c}();b.CommonBufferWriter=c;var a=new Float32Array(6),l=new Uint32Array(a.buffer),g=new Uint32Array(1),e=new k;q=function(){function a(){this.commonWriter=new c}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};
a.prototype.allocate=function(a){return p.RegularEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,c,b){this.commonWriter.write(a,c,b);d.vec3.add(u,b.faceNormal0,b.faceNormal1);d.vec3.normalize(u,u);a.normal.setVec(c,u)};a.prototype.trim=function(a,c){return this.commonWriter.trim(a,c)};a.Layout=p.RegularEdgeInstancesLayout;a.glLayout=m.glLayout(p.RegularEdgeInstancesLayout,{prefixA:!0,divisor:1});return a}();b.RegularEdgeBufferWriter=q;q=function(){function a(){this.commonWriter=
new c}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};a.prototype.allocate=function(a){return p.SilhouetteEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,c,b){this.commonWriter.write(a,c,b);a.normalA.setVec(c,b.faceNormal0);a.normalB.setVec(c,b.faceNormal1)};a.prototype.trim=function(a,c){return this.commonWriter.trim(a,c)};a.Layout=p.SilhouetteEdgeInstancesLayout;a.glLayout=m.glLayout(p.SilhouetteEdgeInstancesLayout,{prefixA:!0,divisor:1});return a}();
b.SilhouetteEdgeBufferWriter=q;var u=h.vec3f64.create()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("require exports ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/typedArrayUtil ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/workerHelper ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),function(q,b,n,f,k,d,h,
m,p,c,a){return function(){function b(){this.regularWriter=new c.RegularEdgeBufferWriter;this.silhouetteWriter=new c.SilhouetteEdgeBufferWriter}b.prototype.process=function(a,c){return n(this,void 0,void 0,function(){var b,d,e;return f(this,function(f){switch(f.label){case 0:if(!c)return[3,2];b=[];d=this.packInput(a,b);this.wrappedWork;return[4,c.invoke("wrappedWork",d,{transferList:b})];case 1:return e=f.sent(),[2,this.unpackOutput(e)];case 2:return[2,this.work(a)]}})})};b.prototype.wrappedWork=
function(a){return n(this,void 0,void 0,function(){var c,b,d,g;return f(this,function(e){c=this.unpackInput(a);b=this.work(c);d=[];this.packInputTransferables(c,d);g=this.packOutput(b,d);return[2,{result:g,transferList:d}]})})};b.prototype.work=function(c){var b=this.extractEdgeInformation(c.data,c.skipDeduplicate,c.originalIndices);this.regularWriter.updateSettings(c.writerSettings);this.silhouetteWriter.updateSettings(c.writerSettings);return a.extractEdges(b,this.regularWriter,this.silhouetteWriter)};
b.prototype.packInputTransferables=function(a,c){c.push(a.data.buffer)};b.prototype.packInput=function(a,c){this.packInputTransferables(a,c);c={dataBuffer:a.data.buffer,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate};a.originalIndices&&(c.originalIndicesBuffer=a.originalIndices.buffer,c.originalIndicesType=k.isUint32Array(a.originalIndices)?"Uint32Array":"Uint16Array");return c};b.prototype.unpackInput=function(a){return{data:p.EdgeInputBufferLayout.createView(a.dataBuffer),originalIndices:"Uint32Array"===
a.originalIndicesType?new Uint32Array(a.originalIndicesBuffer):"Uint16Array"===a.originalIndicesType?new Uint16Array(a.originalIndicesBuffer):void 0,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate}};b.prototype.packOutput=function(a,c){c.push(a.regular.lodInfo.lengths.buffer);c.push(a.silhouette.lodInfo.lengths.buffer);return{regular:{instancesData:m.packInterleavedBuffer(a.regular.instancesData,c),lodInfo:{lengths:a.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:m.packInterleavedBuffer(a.silhouette.instancesData,
c),lodInfo:{lengths:a.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:a.averageEdgeLength}};b.prototype.unpackOutput=function(a){return{regular:{instancesData:m.unpackInterleavedBuffer(a.regular.instancesData),lodInfo:{lengths:new Float32Array(a.regular.lodInfo.lengths)}},silhouette:{instancesData:m.unpackInterleavedBuffer(a.silhouette.instancesData),lodInfo:{lengths:new Float32Array(a.silhouette.lodInfo.lengths)}},averageEdgeLength:a.averageEdgeLength}};b.prototype.extractEdgeInformation=function(a,
c,b){if(c&&b)return c=h.computeNeighbors(b,a.count),{faces:b,neighbors:c,vertices:a};a=d.default(a.buffer,a.stride/4,b);c=h.computeNeighbors(a.indices,a.uniqueCount);return{faces:a.indices,neighbors:c,vertices:p.EdgeInputBufferLayout.createView(a.buffer)}};return b}()})},"esri/views/3d/support/meshProcessing":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.computeNeighbors=function(b,f){for(var k=b.length/3,d=new Uint32Array(f+1),h=new Uint32Array(f+
1),m=function(a,c){a<c?d[a+1]++:h[c+1]++},p=0;p<k;p++){var c=b[3*p],a=b[3*p+1],l=b[3*p+2];m(c,a);m(a,l);m(l,c)}for(p=a=c=0;p<f;p++)l=d[p+1],m=h[p+1],d[p+1]=c,h[p+1]=a,c+=l,a+=m;for(var g=new Uint32Array(6*k),e=d[f],m=function(a,c,b){if(a<c){var f=d[a+1]++;g[2*f]=c;g[2*f+1]=b}else f=h[c+1]++,g[2*e+2*f]=a,g[2*e+2*f+1]=b},p=0;p<k;p++)c=b[3*p],a=b[3*p+1],l=b[3*p+2],m(c,a,p),m(a,l,p),m(l,c,p);c=function(a,c){var b=2*a;a=c-a;for(c=1;c<a;c++){var d=g[b+2*c],e=g[b+2*c+1],f=c-1;for(f;0<=f&&g[b+2*f]>d;f--)g[b+
2*f+2]=g[b+2*f],g[b+2*f+3]=g[b+2*f+1];g[b+2*f+2]=d;g[b+2*f+3]=e}};for(p=0;p<f;p++)c(d[p],d[p+1]),c(e+h[p],e+h[p+1]);for(var n=new Int32Array(3*k),t=function(a,c){return a===b[3*c]?0:a===b[3*c+1]?1:a===b[3*c+2]?2:-1},k=function(a,c){a=t(a,c);n[3*c+a]=-1},c=function(a,c,b,d){a=t(a,c);n[3*c+a]=d;b=t(b,d);n[3*d+b]=c},p=0;p<f;p++){for(var a=d[p],l=d[p+1],m=h[p],r=h[p+1];a<l&&m<r;){var y=g[2*a],q=g[2*e+2*m];y===q?(c(p,g[2*a+1],q,g[2*e+2*m+1]),a++,m++):y<q?(k(p,g[2*a+1]),a++):(k(q,g[2*e+2*m+1]),m++)}for(;a<
l;)k(p,g[2*a+1]),a++;for(;m<r;)q=g[2*e+2*m],k(q,g[2*e+2*m+1]),m++}return n}})},"esri/views/3d/support/buffer/workerHelper":function(){define(["require","exports","../../../../core/tsSupport/assignHelper","./BufferView","./InterleavedLayout"],function(q,b,n,f,k){function d(b){var c=[];b.fields.forEach(function(a,b){var d=a.constructor;a=n({},a,{constructor:d.ElementType+"_"+d.ElementCount});c.push([b,a])});return{stride:b.stride,fields:c,fieldNames:b.fieldNames}}function h(b){var c=k.newLayout();c.stride=
b.stride;c.fieldNames=b.fieldNames;b.fields.forEach(function(a){return c.fields.set(a[0],n({},a[1],{constructor:m.get(a[1].constructor)}))});return c}Object.defineProperty(b,"__esModule",{value:!0});b.packInterleavedBuffer=function(b,c){c.push(b.buffer);return{buffer:b.buffer,layout:d(b.layout)}};b.unpackInterleavedBuffer=function(b){return h(b.layout).createView(b.buffer)};b.packLayout=d;b.unpackLayout=h;q=[f.BufferViewFloat,f.BufferViewVec2f,f.BufferViewVec3f,f.BufferViewVec4f,f.BufferViewMat3f,
f.BufferViewMat4f,f.BufferViewFloat64,f.BufferViewVec2f64,f.BufferViewVec3f64,f.BufferViewVec4f64,f.BufferViewMat3f64,f.BufferViewMat4f64,f.BufferViewUint8,f.BufferViewVec2u8,f.BufferViewVec3u8,f.BufferViewVec4u8,f.BufferViewUint16,f.BufferViewVec2u16,f.BufferViewVec3u16,f.BufferViewVec4u16,f.BufferViewUint32,f.BufferViewVec2u32,f.BufferViewVec3u32,f.BufferViewVec4u32,f.BufferViewInt8,f.BufferViewVec2i8,f.BufferViewVec3i8,f.BufferViewVec4i8,f.BufferViewInt16,f.BufferViewVec2i16,f.BufferViewVec3i16,
f.BufferViewVec4i16,f.BufferViewInt32,f.BufferViewVec2i32,f.BufferViewVec3i32,f.BufferViewVec4i32];var m=new Map;q.forEach(function(b){return m.set(b.ElementType+"_"+b.ElementCount,b)})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("require exports ../../../../../core/arrayUtils ../../../../../core/typedArrayUtil ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils".split(" "),function(q,b,n,f,k,d,
h){function m(c,b){var d=h.acos(c.cosAngle),e=a.fwd,f=a.ortho;h.directionFromTo(e,c.position1,c.position0);c=0<k.vec3.dot(k.vec3.cross(f,c.faceNormal0,c.faceNormal1),e)?-1:1;return d*c>b}function p(a){var c=a.faces.length/3,b=a.faces;a=a.neighbors;for(var d=0,e=0;e<c;e++)var f=a[3*e+0],g=a[3*e+1],h=a[3*e+2],l=b[3*e+0],m=b[3*e+1],k=b[3*e+2],d=d+(-1===f||l<m?1:0),d=d+(-1===g||m<k?1:0),d=d+(-1===h||k<l?1:0);for(var d=new Int32Array(4*d),p=0,e=0;e<c;e++){f=a[3*e+0];g=a[3*e+1];h=a[3*e+2];l=b[3*e+0];m=
b[3*e+1];k=b[3*e+2];if(-1===f||l<m)d[p++]=l,d[p++]=m,d[p++]=e,d[p++]=f;if(-1===g||m<k)d[p++]=m,d[p++]=k,d[p++]=e,d[p++]=g;if(-1===h||k<l)d[p++]=k,d[p++]=l,d[p++]=e,d[p++]=h}return d}function c(a){var c=a.faces.length/3,b=a.vertices.position;a=a.faces;for(var d=l.v0,e=l.v1,f=l.v2,g=new Float32Array(3*c),h=0;h<c;h++){var m=a[3*h+1],p=a[3*h+2];b.getVec(a[3*h+0],d);b.getVec(m,e);b.getVec(p,f);k.vec3.subtract(e,e,d);k.vec3.subtract(f,f,d);k.vec3.cross(d,e,f);k.vec3.normalize(d,d);g[3*h+0]=d[0];g[3*h+1]=
d[1];g[3*h+2]=d[2]}return g}Object.defineProperty(b,"__esModule",{value:!0});b.extractEdges=function(b,d,l,r){void 0===r&&(r=g);var e=b.vertices.position,t=b.vertices.componentIndex,u=h.deg2rad(r.anglePlanar);r=h.deg2rad(r.angleSignificantEdge);var q=Math.cos(r),z=Math.cos(u),A=a.edge,B=A.position0,C=A.position1,E=A.faceNormal0,F=A.faceNormal1,H=c(b),D=p(b),G=D.length/4;b=d.allocate(G);r=0;var K=l.allocate(G),M=0,O=0,N=0,P=n.range(0,G),L=new Float32Array(G);f.forEach(L,function(a,c,b){e.getVec(D[4*
c+0],B);e.getVec(D[4*c+1],C);b[c]=k.vec3.distance(B,C)});P.sort(function(a,c){return L[c]-L[a]});for(var T=[],R=[],J=0;J<G;J++){var U=P[J],Q=L[U],I=D[4*U+0],V=D[4*U+1],X=D[4*U+2],U=D[4*U+3],W=-1===U;e.getVec(I,B);e.getVec(V,C);if(W)k.vec3.set(E,H[3*X+0],H[3*X+1],H[3*X+2]),k.vec3.copy(F,E),A.componentIndex=t.get(I),A.cosAngle=k.vec3.dot(E,F);else{k.vec3.set(E,H[3*X+0],H[3*X+1],H[3*X+2]);k.vec3.set(F,H[3*U+0],H[3*U+1],H[3*U+2]);A.componentIndex=t.get(I);A.cosAngle=k.vec3.dot(E,F);if(A.cosAngle>z)continue;
-.9999>A.cosAngle&&k.vec3.copy(F,E)}O+=Q;N++;W||A.cosAngle<q?(d.write(b,r++,A),T.push(Q)):m(A,u)&&(l.write(K,M++,A),R.push(Q))}t=new Float32Array(T.reverse());u=new Float32Array(R.reverse());return{regular:{instancesData:d.trim(b,r),lodInfo:{lengths:t}},silhouette:{instancesData:l.trim(K,M),lodInfo:{lengths:u}},averageEdgeLength:O/N}};var a={edge:{position0:d.vec3f64.create(),position1:d.vec3f64.create(),faceNormal0:d.vec3f64.create(),faceNormal1:d.vec3f64.create(),componentIndex:0,cosAngle:0},ortho:d.vec3f64.create(),
fwd:d.vec3f64.create()},l={v0:d.vec3f64.create(),v1:d.vec3f64.create(),v2:d.vec3f64.create()},g={anglePlanar:4,angleSignificantEdge:35}})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../support/mathUtils ../../materials/internal/MaterialUtil ../../shaders/EdgeRendererPrograms".split(" "),
function(q,b,n,f,k,d,h,m,p){Object.defineProperty(b,"__esModule",{value:!0});b.LINE_WIDTH_FRACTION_FACTOR=8;b.EXTENSION_LENGTH_OFFSET=128;var c={type:"uber",slicePlaneEnabled:!1,strokesTexture:null},a=function(){function a(){this._value=0}Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});a.prototype.increment=function(){this._value++};a.prototype.decrement=function(){this._value--};return a}();q=function(){function f(b,e,h){this.rctx=b;this.programRepository=
e;this.refCount=new a;this.renderables=new Set;this.depthBiasZ=-4E-4;this.depthBiasXY=.5;this.tmpViewToWorldNormalMatrix=d.mat3f64.create();this.settings=n({},c,h);this.key=f.getKey(this.settings.type,this.settings.slicePlaneEnabled);this.writerSettings={variants:this.settings.strokesTexture.variants};this.createPrograms()}f.prototype.dispose=function(){for(var a in this.programs){var c=this.programs[a];c&&(this.programRepository.decreaseRefCount(c),this.programs[a]=null)}};f.prototype.addRenderable=
function(a){this.renderables.add(a)};f.prototype.removeRenderable=function(a){this.renderables.delete(a)};f.prototype.forEachRenderable=function(a){this.renderables.forEach(a)};f.prototype.bindRegularEdges=function(a,c){this.bind(this.programs.regular,a,c)};f.prototype.bindSilhouetteEdges=function(a,c){this.bind(this.programs.silhouette,a,c)};f.prototype.bind=function(a,c,b){this.rctx.bindProgram(a);a.setUniformMatrix4fv("uProj",c.proj);a.setUniform2f("uDepthBias",this.depthBiasXY,this.depthBiasZ);
a.setUniform2f("uPixelToNDC",2/c.viewport[2],2/c.viewport[3]);a.setUniform2f("uNDCToPixel",c.viewport[2]/2,c.viewport[3]/2);a.setUniform1f("uDistanceFalloffFactor",b.distanceFalloffFactor);a.setUniform2f("uViewportDimInv",1/c.viewport[2],1/c.viewport[3]);a.setUniform1f("uPixelRatio",c.pixelRatio||1)};f.prototype.renderRegularEdges=function(a,c,b){this.render(this.programs.regular,a,a.regular.vao,c,b)};f.prototype.renderSilhouetteEdges=function(a,c,b){this.render(this.programs.silhouette,a,a.silhouette.vao,
c,b)};f.prototype.render=function(a,c,b,d,f){this.setUniforms(a,c,d);a=this.rctx;a.bindVAO(b);a.capabilities.instancing.drawArraysInstanced(6,0,4,f)};f.prototype.setUniforms=function(a,c,d){c.components.buffer.textureBuffer.bind(a,b.componentDataBindParameters);a.setUniformMatrix4fv("uView",d.view);a.setUniformMatrix4fv("uModel",c.transform.modelMatrix);var e=d.viewInvTransp,f=k.mat3.fromMat4(this.tmpViewToWorldNormalMatrix,e);a.setUniform3f("uCameraPosition",e[3],e[7],e[11]);a.setUniformMatrix3fv("uViewToWorldNormalMatrix",
f);"uber"!==this.settings.type&&"sketch"!==this.settings.type||this.setSketchUniforms(a);a.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(d.fovY/2)/(d.viewport[3]/2));a.setUniform3fv("uLocalOrigin",c.transform.origin.vec3);this.settings.slicePlaneEnabled&&m.bindSlicePlane(c.transform.origin.vec3,d.slicePlane,a)};f.prototype.setSketchUniforms=function(a){var c=this.settings.strokesTexture,b=c.texture;this.rctx.bindTexture(b,0);a.setUniform1i("uStrokesTexture",0);a.setUniform2f("uStrokesTextureScale",
1/b.descriptor.width,1/b.descriptor.height);a.setUniform1f("uStrokesLog2Resolution",h.log2(c.resolution));a.setUniform1f("uStrokesNormalizationScale",c.normalizationScale);a.setUniform1f("uStrokesAmplitude",c.amplitude);a.setUniform1f("uStrokeVariants",c.variants)};f.prototype.getOptions=function(a){return n({},a,{antialiasing:!!this.rctx.capabilities.blendMinMax,mode:this.settings.type,slice:this.settings.slicePlaneEnabled})};f.prototype.createPrograms=function(){var a=this.programRepository.getProgram(p.program,
this.getOptions({silhouette:!1})),c=this.programRepository.getProgram(p.program,this.getOptions({silhouette:!0}));this.programRepository.increaseRefCount(a);this.programRepository.increaseRefCount(c);this.programs={regular:a,silhouette:c}};f.getKey=function(a,c){return"edges-t:"+a+":"+c};return f}();b.EdgeRenderer=q;b.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2}})},"esri/views/3d/webgl-engine/shaders/EdgeRendererPrograms":function(){define(["require",
"exports","./sources/resolver","../../../webgl/programUtils"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});var k=function(b){return f.glslifyDefineMap({MODE:{value:b.mode,options:{solid:"MODE_SOLID",sketch:"MODE_SKETCH",uber:"MODE_UBER"}},SILHOUETTE:b.silhouette,ANTIALIASING:b.antialiasing,SLICE:b.slice})};b.program={name:"edges",shaders:function(b){return{vertexShader:k(b)+n.resolveIncludes("edgeRenderer/edgeRenderer.vert"),fragmentShader:k(b)+n.resolveIncludes("edgeRenderer/edgeRenderer.frag")}},
attributes:{aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}}})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../support/mathUtils ../Util ../../../../webgl/Texture".split(" "),function(q,b,n,f,k,d){function h(c,a){if(!c)return null;var b=c.length/2,d=m*b,b=Array(b),e=0;a=1===a;for(var f=0;f<
c.length;f+=2){var h=(c[f]+c[f+1])/2;a?b[e++]=Math.min(d,1-(1-h)*p):b[e++]=Math.min(d,h*p)}return b}Object.defineProperty(b,"__esModule",{value:!0});b.generateStrokesTexture=function(c){for(var a=b.strokesDefinition.resolution,l=a/2,g=new Uint8Array(4*a*a),e=4*a*l,l=b.strokesDefinition.amplitude,m=2*l,p=4*a,r=f.log2(a)+1,n=b.strokesDefinition.strokes.length,q=(r-1)*n*p,x=0,v=b.strokesDefinition.strokes;x<v.length;x++){for(var z=v[x],A=z.distance,z=z.pressure,B=q,C=0;C<r;C++){0!==C&&(A=h(A,0),z=h(z,
1));for(var E=0;E<b.strokesDefinition.resolution;E++){var F=z?z[E%z.length]:1;k.packFloatRGBA((A?A[E%A.length]/m:0)+.5,g,B);k.packFloatRGBA(F,g,B+e);B+=4}B-=p*(n+1)}q+=p}c=new d(c,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:a,height:a,wrapMode:10497},g);return{resolution:a,texture:c,normalizationScale:m,amplitude:l,variants:n}};var m=.1,p=.5;b.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,
-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,
.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,
.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,
-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,
.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,
.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,
.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,
-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,
-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,
1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,
.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,
-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,
.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,
.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,
.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,
.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,
4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,
3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,
.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,
.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,
.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,
.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,
.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,
1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,
-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,
.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,
2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,
.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,
.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,
.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,
-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,
1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,
.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,
-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,
.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,
.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,
.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,
.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,
4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,
.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,
-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],
pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,
.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,
.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,
.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["require","exports","../../../../../core/arrayUtils","../../../../../core/maybe","../../../../../core/typedArrayUtil"],function(q,b,n,f,k){function d(b,d){var f=
n.binaryIndexOf(b,d,!0);return-1===f?d<b[0]?0:b.length:f}Object.defineProperty(b,"__esModule",{value:!0});b.determineRendererType=function(b){for(var d=null,h=0;h<b.length;h++){var c=b[h],a=c.type;if(0<c.size*c.color[3]*c.opacity)if(f.isNone(d))d=a;else if(d!==a)return"uber"}return f.isSome(d)?d:"solid"};b.determineAllTransparent=function(b){if(0===b.length)return!0;for(var d=0;d<b.length;d++){var f=b[d].material;if(0<f.size*f.color[3]*f.opacity)return!1}return!0};b.cloneIndices=function(b){if(Uint16Array.from)return k.isUint16Array(b)?
Uint16Array.from(b):Uint32Array.from(b);for(var d=k.isUint16Array(b)?new Uint16Array(b.length):new Uint32Array(b.length),f=0;f<b.length;f++)d[f]=b[f];return d};b.estimateLengthAtDistance=function(b,d,f,c){return c/b*f*2*Math.tan(.5*d)};b.findLowerBoundIndex=d;b.computeEdgeCount=function(b,f,k){return b.length-d(b,f*k.minimumEdgeLength)};b.fillComponenBufferIndices=function(b,d,f,c){for(var a=0;a<b.length;a++){var h=b[a].index,g=d[a],e=d[a+1];if(c)for(;g<e;g++)f.set(c[g],h);else for(;g<e;g++)f.set(g,
h)}}})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ./SphericalHarmonics".split(" "),function(q,b,n,f,k,d){Object.defineProperty(b,"__esModule",{value:!0});var h=f.vec3f64.create();q=function(){function b(){this._renderLighting={main:{intensity:f.vec3f64.create(),direction:f.vec3f64.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],
g:[0],b:[0]}}};this._shOrder=2;this._oldDirection=f.vec3f64.create();this._oldSpecular=k.vec4f64.create();this._oldDiffuse=k.vec4f64.create();this._oldAmbient=k.vec4f64.create()}b.prototype.setUniforms=function(b,c){void 0===c&&(c=!1);c||b.getDefine("GROUND_NORMAL_SHADING")?b.setUniform1f("lightingFixedFactor",(1-this._info.groundLightingFactor)*(1-this._info.globalFactor)):b.setUniform1f("lightingFixedFactor",0);b.setUniform1f("lightingGlobalFactor",this._info.globalFactor);b.setUniform3fv("lightingMainDirection",
this._renderLighting.main.direction);b.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity);b.setUniform1f("ambientBoostFactor",.4);c=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?b.setUniform3f("lightingAmbientSH0",c.r[0],c.g[0],c.b[0]):1===this._shOrder?(b.setUniform4f("lightingAmbientSH_R",c.r[0],c.r[1],c.r[2],c.r[3]),b.setUniform4f("lightingAmbientSH_G",c.g[0],c.g[1],c.g[2],c.g[3]),b.setUniform4f("lightingAmbientSH_B",c.b[0],c.b[1],c.b[2],c.b[3])):2===this._shOrder&&
(b.setUniform3f("lightingAmbientSH0",c.r[0],c.g[0],c.b[0]),b.setUniform4f("lightingAmbientSH_R1",c.r[1],c.r[2],c.r[3],c.r[4]),b.setUniform4f("lightingAmbientSH_G1",c.g[1],c.g[2],c.g[3],c.g[4]),b.setUniform4f("lightingAmbientSH_B1",c.b[1],c.b[2],c.b[3],c.b[4]),b.setUniform4f("lightingAmbientSH_R2",c.r[5],c.r[6],c.r[7],c.r[8]),b.setUniform4f("lightingAmbientSH_G2",c.g[5],c.g[6],c.g[7],c.g[8]),b.setUniform4f("lightingAmbientSH_B2",c.b[5],c.b[6],c.b[7],c.b[8]));b.setUniform3fv("lightDirection",this._oldDirection)};
b.prototype.set=function(b){this._info=b;d.combineLights(b.lights,this._shOrder,this._renderLighting.main,this._renderLighting.sphericalHarmonics);n.vec3.negate(this._oldDirection,this._renderLighting.main.direction);b=1/Math.PI;this._oldAmbient[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*b;this._oldAmbient[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*b;this._oldAmbient[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*b;this._oldAmbient[3]=1;this._oldDiffuse[0]=
this._renderLighting.main.intensity[0]*b;this._oldDiffuse[1]=this._renderLighting.main.intensity[1]*b;this._oldDiffuse[2]=this._renderLighting.main.intensity[2]*b;this._oldDiffuse[3]=1;b=n.vec3.copy(h,this._oldDiffuse);n.vec3.scale(b,b,.4*this._info.globalFactor);n.vec3.add(this._oldAmbient,this._oldAmbient,b)};Object.defineProperty(b.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0});b.prototype.getOld=function(){return{ambient:this._oldAmbient,
diffuse:this._oldDiffuse,specular:this._oldSpecular,direction:this._oldDirection,helper:this}};return b}();b.SceneLighting=q})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("require exports ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/mathUtils ../lib/LongVectorMath ./Lightsources".split(" "),function(q,b,n,f,k,d,h){function m(a){return(a+1)*(a+1)}function p(a){return k.clamp(Math.floor(Math.sqrt(a)-1),0,2)}function c(a,
c,b){var d=a[0],e=a[1];a=a[2];b=b||[];b.length=m(c);0<=c&&(b[0]=.28209479177);1<=c&&(b[1]=.4886025119*d,b[2]=.4886025119*a,b[3]=.4886025119*e);2<=c&&(b[4]=1.09254843059*d*e,b[5]=1.09254843059*e*a,b[6]=.31539156525*(3*a*a-1),b[7]=1.09254843059*d*a,b[8]=.54627421529*(d*d-e*e));return b}function a(a,c){a=m(a);c=c||{r:[],g:[],b:[]};c.r.length=c.g.length=c.b.length=a;for(var b=0;b<a;b++)c.r[b]=c.g[b]=c.b[b]=0;return c}function l(a,b){for(var e=p(b.r.length),f=0;f<a.length;f++){var g=a[f];n.vec3.negate(w,
g.direction);c(w,e,r);d.elementwiseProduct(r,x);d.scalarProduct(r,g.intensity[0],y);d.add(b.r,y);d.scalarProduct(r,g.intensity[1],y);d.add(b.g,y);d.scalarProduct(r,g.intensity[2],y);d.add(b.b,y)}return b}function g(a,b){c(w,0,r);for(var d=0;d<a.length;d++){var e=a[d];b.r[0]+=r[0]*x[0]*e.intensity[0]*4*Math.PI;b.g[0]+=r[0]*x[0]*e.intensity[1]*4*Math.PI;b.b[0]+=r[0]*x[0]*e.intensity[2]*4*Math.PI}return b}Object.defineProperty(b,"__esModule",{value:!0});b.numberOfCoefficients=m;b.numberOfCoefficientsInBand=
function(a){return 2*a+1};b.orderFromNumberOfCoefficients=p;b.computeCoefficients=c;b.initSHCoefficients=a;b.projectFillLights=l;b.projectAmbientLights=g;b.combineLights=function(c,b,f,m){a(b,m.sh);n.vec3.set(f.intensity,0,0,0);var k=!1,p=e,r=u;b=t;p.length=0;r.length=0;for(var x=b.length=0;x<c.length;x++){var q=c[x];q instanceof h.MainLight&&!k?(n.vec3.copy(f.direction,q.direction),f.intensity[0]=q.intensity[0],f.intensity[1]=q.intensity[1],f.intensity[2]=q.intensity[2],f.castShadows=q.castShadows,
k=!0):q instanceof h.MainLight||q instanceof h.FillLight?p.push(q):q instanceof h.AmbientLight?r.push(q):q instanceof h.SphericalHarmonicsLight&&b.push(q)}l(p,m.sh);g(r,m.sh);for(c=0;c<b.length;c++)q=b[c],d.add(m.sh.r,q.sh.r),d.add(m.sh.g,q.sh.g),d.add(m.sh.b,q.sh.b)};var e=[],u=[],t=[],r=[0],y=[0],w=f.vec3f64.create(),x=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398]})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["require","exports"],function(q,
b){Object.defineProperty(b,"__esModule",{value:!0});b.dotProduct=function(b,f){for(var k=0,d=0;d<b.length;d++)k+=b[d]*f[d];return k};b.elementwiseProduct=function(b,f,k){k=k||b;k.length=b.length;for(var d=0;d<b.length;d++)k[d]=b[d]*f[d];return k};b.scalarProduct=function(b,f,k){k=k||b;k.length=b.length;for(var d=0;d<b.length;d++)k[d]=b[d]*f;return k};b.add=function(b,f,k){k=k||b;k.length=b.length;for(var d=0;d<b.length;d++)k[d]=b[d]+f[d];return k}})},"esri/views/webgl/Profiling":function(){define(["require",
"exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.startMeasurement=function(b){return(b=b.capabilities.disjointTimerQuery)?new n(b):null};b.getTimestamp=function(b,k,d){void 0===d&&(d=50);var f=b.capabilities.disjointTimerQuery;if(!f||0>=f.timestampBits())return null;var m=f.createQuery();f.createTimestamp(m);var p=function(){var c=f.resultAvailable(m),a=f.disjoint();c&&!a?(c=f.getResult(m),k(c/1E6)):a?k():setTimeout(p,d)};p()};b.supportsTimestamps=function(b){b=b.capabilities.disjointTimerQuery;
if(!b)return!1;b=b.timestampBits();console.log({bits:b});return 0<b};var n=function(){function b(b){this.timer=b;this.query=b.createQuery();this.timer.beginTimeElapsed(this.query)}b.prototype.stop=function(b,d){void 0===d&&(d=50);this.cb=b;this.checkInterval=d;this.timer.endTimeElapsed();this.checkQueryResult()};b.prototype.checkQueryResult=function(){var b=this.timer.resultAvailable(this.query),d=this.timer.disjoint();b&&!d?(b=this.timer.getResult(this.query),this.cb(b/1E6)):d?this.cb():setTimeout(this.checkQueryResult.bind(this),
this.checkInterval)};return b}()})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/ColorPrograms ../../../webgl/renderState".split(" "),function(q,b,n,f,k,d,h,m,p,c,a,l){q=function(a){function b(c,b){b=a.call(this,b)||this;b.supportsEdges=!0;b.params=
p.copyParameters(c,u);return b}n(b,a);b.prototype.setParameterValues=function(a){var c=this.params,b;for(b in a)c[b]=a[b];this.notifyDirty("matChanged")};b.prototype.getParameters=function(){return this.params};b.prototype.setColor=function(a){this.params.color=a;this.notifyDirty("matChanged")};b.prototype.getColor=function(){return this.params.color};b.prototype.setTransparent=function(a){this.params.transparent=a;this.notifyDirty("matChanged")};b.prototype.getTransparent=function(){return this.params.transparent};
b.prototype.intersect=function(a,c,b,d,e,f,g,h,l){p.intersectTriangleGeometry(a,c,b,d,e,f,g,l)};b.prototype.getGLMaterials=function(){return{color:g,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:e}};b.prototype.getAllTextureIds=function(){return[]};b.prototype.createBufferWriter=function(){return new r};b.prototype.createRenderer=function(a,b){return new c(a,b,this)};return b}(d);var g=function(c){function b(a,b,d){a=c.call(this,a,b)||this;a.updateParameters();return a}n(b,c);b.prototype.updateParameters=
function(){this.params=p.copyParameters(this.material.getParameters());this.selectProgram()};b.prototype.selectProgram=function(){var c=this.params;this.program=this.programRep.getProgram(a.colorPass,{vertexColors:c.vertexColors,slice:c.slicePlaneEnabled});this.pipelineState=l.makePipelineState({blending:c.transparent&&l.separateBlendingParams(770,1,771,771),polygonOffset:c.polygonOffset&&y,culling:w(c.cullFace),depthTest:c.testDepth&&{func:513},depthWrite:c.writeDepth&&l.defaultDepthWriteParams,
colorWrite:l.defaultColorWriteParams})};b.prototype.beginSlot=function(a){var c=4;this.params.transparent&&(c=this.params.writeDepth?6:9);return a===c};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,c){c=this.program;var b=this.params;a.bindProgram(c);a.setPipelineState(this.pipelineState);c.setUniform4fv("eColor",b.color)};b.prototype.release=function(a){};b.prototype.bindView=function(a,c){a=this.program;var b=this.params;p.bindView(c.origin,c.view,a);b.slicePlaneEnabled&&
p.bindSlicePlane(c.origin,c.slicePlane,a)};b.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",c.transformation)};b.prototype.getDrawMode=function(){return 4};return b}(k),e=function(c){function b(a,b,d){a=c.call(this,a,b)||this;a.updateParameters();return a}n(b,c);b.prototype.updateParameters=function(){this.params=p.copyParameters(this.material.getParameters());this.selectProgram()};b.prototype.selectProgram=function(){var c=this.params;this.program=this.programRep.getProgram(a.colorPass,
{vertexColors:c.vertexColors,slice:c.slicePlaneEnabled});this.pipelineState=l.makePipelineState({polygonOffset:c.polygonOffset&&y,culling:w(c.cullFace),depthTest:c.testDepth&&{func:513},depthWrite:c.writeDepth&&l.defaultDepthWriteParams,colorWrite:l.defaultColorWriteParams})};b.prototype.beginSlot=function(a){return 4===a};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,c){var b=this.program,d=this.params;a.bindProgram(b);a.setPipelineState(this.pipelineState);p.bindHighlightRendering(a,
c,b);b.setUniform4fv("eColor",d.color)};b.prototype.release=function(a){};b.prototype.bindView=function(a,c){a=this.program;var b=this.params;p.bindView(c.origin,c.view,a);b.slicePlaneEnabled&&p.bindSlicePlane(c.origin,c.slicePlane,a)};b.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",c.transformation)};b.prototype.getDrawMode=function(){return 4};return b}(k),u={color:[1,1,1,1],transparent:!1,writeDepth:!0,testDepth:!0,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,
cullFace:"none"},t=f.newLayout().vec3f(h.VertexAttrConstants.POSITION).vec4u8(h.VertexAttrConstants.COLOR),r=function(){function a(){this.vertexBufferLayout=t}a.prototype.allocate=function(a){return t.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices[h.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,c,b,d,e){m.writeDefaultAttributes(c,b,t,a.transformation,a.invTranspTransformation,d,e)};return a}(),y={factor:1,units:1},w=function(a){return"none"!==a&&{face:"front"===
a?1028:1029,mode:2305}};return q})},"esri/views/3d/webgl-engine/shaders/ColorPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});var d=function(b){return k.glslifyDefineMap({VERTEX_COLORS:b.vertexColors,SLICE:b.slice})};b.colorPass={name:"color-color",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("materials/color/color.vert"),
fragmentShader:d(b)+f.resolveIncludes("materials/color/color.frag")}},attributes:n.Default3D}})},"esri/views/3d/webgl-engine/shaders/MiscPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});b.blendLayers={name:"blend-layers",shaders:{vertexShader:f.resolveIncludes("misc/blendLayers.vert"),fragmentShader:f.resolveIncludes("misc/blendLayers.frag")},attributes:n.Default3D};b.texOnly=
{name:"tex-only",shaders:{vertexShader:f.resolveIncludes("misc/texOnly.vert"),fragmentShader:f.resolveIncludes("misc/texOnly.frag")},attributes:n.Default3D}})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define(["require","exports","../../../../core/compilerUtils","./Util"],function(q,b,n,f){var k=function(){function b(b){this.refCnt=0;this.glMaterial=b}b.prototype.incRefCnt=function(){++this.refCnt};b.prototype.decRefCnt=function(){--this.refCnt;f.assert(0<=this.refCnt)};b.prototype.getRefCnt=
function(){return this.refCnt};b.prototype.getGLMaterial=function(){return this.glMaterial};return b}();q=function(){function b(b,d){this._textureRep=b;this._programRep=d;this._id2glMaterialRef=new Map}b.prototype.aquire=function(b,d){var c=b.id+"_"+d,a=this._id2glMaterialRef.get(c);null==a?(b=(a=b.getGLMaterials()[d])?new a(b,this._programRep,this._textureRep):void 0,a=new k(b),this._id2glMaterialRef.set(c,a)):b=a.getGLMaterial();a.incRefCnt();b&&this.increaseProgramReferences(b);return b};b.prototype.release=
function(b,d){b=b+"_"+d;d=this._id2glMaterialRef.get(b);d.decRefCnt();if(0===d.getRefCnt()){if(d=d.getGLMaterial())this.decreaseProgramReferences(d),d.dispose();this._id2glMaterialRef.delete(b)}};b.prototype.updateMaterialParameters=function(b){for(var f=0,c=d;f<c.length;f++){var a=this._id2glMaterialRef.get(b+"_"+c[f]);a&&a.getGLMaterial()&&this.updateParamsForMat(a.getGLMaterial())}};b.prototype.updateParamsForMat=function(b){b.updateParameters&&(this.decreaseProgramReferences(b),b.updateParameters(),
this.increaseProgramReferences(b))};b.prototype.increaseProgramReferences=function(b){b=b.getPrograms();for(var d=this._programRep,c=0;c<b.length;c++)d.increaseRefCount(b[c])};b.prototype.decreaseProgramReferences=function(b){b=b.getPrograms();for(var d=this._programRep,c=0;c<b.length;c++)d.decreaseRefCount(b[c])};return b}();var d=n.tuple("color","depth","depthShadowMap","normal","highlight");return q})},"esri/views/3d/webgl-engine/lib/GLTextureRep":function(){define(["require","exports","../../../../core/Logger",
"./Util","../../../webgl/Texture"],function(q,b,n,f,k){var d=n.getLogger("esri.views.3d.webgl-engine.lib.GLTextureRep");q=function(){function b(b,d,c,a){this.NUM_PARALLEL=8;this._fallbackTextureTransparent=this._fallbackTexture=null;this.textures=b;this._programRepository=d;this.getViewportToRestore=c;this._rctx=a;this.NUM_PARALLEL=8;this.id2textureRef={};this.loading={};this._queue=[];this.listeners=[];this.maxMaxAnisotropy=(this.afExt=a.capabilities.textureFilterAnisotropic)?a.parameters.maxMaxAnisotropy:
1;this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy);this._needsRender=!0;this._fallbackTextureData=new Uint8Array(256);this._fallbackTextureTransparentData=new Uint8Array(256);for(b=0;b<this._fallbackTextureData.length;++b)this._fallbackTextureData[b]=255,this._fallbackTextureTransparentData[b]=0!==(b+1)%4?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8}}b.prototype.resetNeedsRender=function(){this._needsRender=!1};
b.prototype.needsRender=function(){return this._needsRender};b.prototype.aquire=function(h,k,c){var a=this,l=this.id2textureRef[h];if(null==l){var g=this.textures[h];f.assert(void 0!==g);g.setUnloadFunc(this._unload.bind(this));k=!0===k;var e=this._createGLTextureDescription(g),l=new b.TextureRef(null);f.assert(null==this.id2textureRef[h]);this.id2textureRef[h]=l;if(g.initializeThroughRender)h=g.initializeThroughRender(this._rctx,e),l.setGLTexture(h),c&&c(l);else if(g.deferredLoading())this.getLoadingCount()<
this.NUM_PARALLEL?this._loadImage(h,e,c):this._queue.push([h,e,c]);else try{g.initializeThroughUpload(this._rctx,e,this._programRepository,this.getViewportToRestore(),function(b){l.setGLTexture(b);a._needsRender=!0;c&&c(l)})}catch(u){d.error("#aquire","Error loading texture: "+u.toString())}null==l.getGLTexture()&&l.setGLTexture(k?this.fallbackTextureTransparent:this.fallbackTexture);this._needsRender=!0}l.incRefCnt();return l};b.prototype.release=function(b){b=this.id2textureRef[b];void 0!==b&&(b.decRefCnt(),
f.assert(0<=b.getRefCnt()))};b.prototype.getLoadingCount=function(){return Object.keys(this.loading).length};b.prototype.getTexture=function(b){return this.textures[b]};b.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy};b.prototype._unload=function(b){var d=this.id2textureRef[b];void 0!==d&&((d=d.getGLTexture())&&d.dispose(),delete this.id2textureRef[b]);this.next(b)};b.prototype._createGLTextureDescription=function(b){return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&
b.params&&b.params.mipmap&&!b.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:b.params&&b.params.wrap}};b.prototype.next=function(b){if(b in this.loading){delete this.loading[b];var d=Object.keys(this.id2textureRef),c=Object.keys(this.loading);this.listeners.forEach(function(a){a(b,d,c)});this.processQueue()}};b.prototype._loadImage=function(b,d,c){var a=this;f.assert(null==this.loading[b]);this.loading[b]=!0;var h=this.textures[b];f.assert(void 0!==h);setTimeout(function(){var f=a.id2textureRef[b];
f&&f.getRefCnt()&&h.initializeThroughUpload(a._rctx,d,a._programRepository,a.getViewportToRestore(),function(d){a.next(b);a._needsRender=!0;f&&f.getRefCnt()&&(f.setGLTexture(d),c&&c(f))})},0)};b.prototype.processQueue=function(){for(var b=[],d=0;d<this._queue.length;++d){var c=this._queue[d][0],a=this.id2textureRef[c];void 0!==a&&(0===a.getRefCnt()?(a.getGLTexture().dispose(),delete this.id2textureRef[c]):b.push(this._queue[d]))}this._queue=b;b=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,
this._queue.length);for(d=0;d<b;++d)this._loadImage(this._queue[d][0],this._queue[d][1],this._queue[d][2]);this._queue.splice(0,b)};Object.defineProperty(b.prototype,"fallbackTexture",{get:function(){this._fallbackTexture||(this._fallbackTexture=new k(this._rctx,this._fallbackTextureDesc,this._fallbackTextureData));return this._fallbackTexture},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"fallbackTextureTransparent",{get:function(){this._fallbackTextureTransparent||(this._fallbackTextureTransparent=
new k(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData));return this._fallbackTextureTransparent},enumerable:!0,configurable:!0});return b}();(function(b){var d=function(){function b(c){this._glTexture=null;this._refCount=0;this._glTexture=c}b.prototype.incRefCnt=function(){++this._refCount};b.prototype.decRefCnt=function(){--this._refCount;f.assert(0<=this._refCount)};b.prototype.getRefCnt=function(){return this._refCount};b.prototype.setGLTexture=function(c){this._glTexture=
c};b.prototype.getGLTexture=function(){return this._glTexture};return b}();b.TextureRef=d})(q||(q={}));return q})},"esri/views/3d/webgl-engine/lib/ProgramRepository":function(){define(["require","exports","./Util","../../../webgl/programUtils"],function(q,b,n,f){return function(){function b(b,f){void 0===f&&(f="");this._rctx=b;this._shaderPrefix=f;this._programCacheByTemplate=new Map;this._programRefCount=[];this._commonUniforms={model:[],modelNormal:[],lightDirection:[],proj:[],shadowMapDistance:[],
viewportPixelSz:[],lightingMainDirection:[]}}b.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(b){b.programs.forEach(function(b){b.dispose()})});this._rctx=this._commonUniforms=this._programRefCount=this._programCacheByTemplate=null};b.prototype.getProgram=function(b,h){var d=this;this._programCacheByTemplate.has(b)||this.addProgramTemplate(b,function(h){return f.createProgram(d._rctx,b,h,d._shaderPrefix)});return this.getProgramTemplateInstance(b,h)};b.prototype.addProgramTemplate=
function(b,f){this._programCacheByTemplate.set(b,{constructor:f,programs:new Map})};b.prototype.getProgramTemplateInstance=function(b,f){if(b=this._programCacheByTemplate.get(b)){var d=f?JSON.stringify(f):"default";b.programs.has(d)||(f=b.constructor(f),b.programs.set(d,f));return b.programs.get(d)}return null};b.prototype.getProgramsUsingUniform=function(b){return this._commonUniforms[b]||[]};b.prototype.increaseRefCount=function(b){var d=b.id;this._programRefCount[d]?this._programRefCount[d]++:
(this._programRefCount[d]=1,this._findCommonUniforms(b))};b.prototype.decreaseRefCount=function(b){var d=b.id;1<this._programRefCount[d]?this._programRefCount[d]--:(this._forgetCommonUniforms(b),this._programRefCount[d]=0)};b.prototype._findCommonUniforms=function(b){for(var d in this._commonUniforms)b.hasUniform(d)&&(n.assert(-1===this._commonUniforms[d].indexOf(b),"common uniforms of program have already been determined"),this._commonUniforms[d].push(b))};b.prototype._forgetCommonUniforms=function(b){for(var d in this._commonUniforms){var f=
this._commonUniforms[d],k=f.indexOf(b);-1<k&&(f[k]=f[f.length-1],f.pop())}};return b}()})},"esri/views/3d/webgl-engine/lib/tracer":function(){define(["require","exports","./webgl-debug","../../../webgl/capabilities/isWebGL2Context"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});var k=null,d=[];b.enabled=!1;b.begin=function(){b.enabled&&(k=[])};b.trace=function(d){b.enabled&&null!=k&&k.push(d)};b.end=function(){if(b.enabled){var f=k;k=null;f&&(d.forEach(function(b){return b(f)}),
d.length=0);return f}};b.instrumentContext=function(d){return b.enabled?f.default(d)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),d):n.makeDebugContext(d,void 0,function(d,f){b.enabled&&k&&k.push("gl."+d+"("+n.glFunctionArgsToString(d,f)+")")}):d};b.request=function(b){d.push(b)}})},"esri/views/3d/webgl-engine/lib/webgl-debug":function(){define([],function(){function q(a){if(null==p){p={};c={};for(var b in a)"number"==typeof a[b]&&(p[a[b]]=b,c[b]=a[b])}}function b(){if(null==
p)throw"WebGLDebugUtils.init(ctx) not called";}function n(a){b();var c=p[a];return void 0!==c?"gl."+c:"/*UNKNOWN WebGL ENUM*/ 0x"+a.toString(16)+""}function f(a,b,d,e){a=m[a];if(void 0!==a&&(a=a[b],void 0!==a&&a[d])){if("object"===typeof a[d]&&void 0!==a[d].enumBitwiseOr){b=a[d].enumBitwiseOr;d=0;a=[];for(var f=0;f<b.length;++f){var g=c[b[f]];0!==(e&g)&&(d|=g,a.push(n(g)))}return d===e?a.join(" | "):n(e)}return n(e)}return null===e?"null":void 0===e?"undefined":e.toString()}function k(a,c,b){a.__defineGetter__(b,
function(){return c[b]});a.__defineSetter__(b,function(a){c[b]=a})}function d(a,c,b,e){function g(a,d){return function(){b&&b(d,arguments);var f=a[d].apply(a,arguments),g=e.getError();0!=g&&(h[g]=!0,c(g,d,arguments));return f}}e=e||a;q(a);c=c||function(a,c,b){for(var d="",e=b.length,g=0;g<e;++g)d+=(0==g?"":", ")+f(c,e,g,b[g]);a="WebGL error "+n(a)+" in "+c+"("+d+")";window.console&&window.console.error?window.console.error(a):window.console&&window.console.log&&window.console.log(a)};var h={},l={},
m;for(m in a)if("function"==typeof a[m])if("getExtension"!=m)l[m]=g(a,m);else{var p=g(a,m);l[m]=function(){var f=p.apply(a,arguments);return d(f,c,b,e)}}else k(l,a,m);l.getError=function(){for(var c in h)if(h.hasOwnProperty(c)&&h[c])return h[c]=!1,c;return a.NO_ERROR};return l}function h(a){var c=a.getParameter(a.MAX_VERTEX_ATTRIBS),b=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,b);for(var d=0;d<c;++d)a.disableVertexAttribArray(d),a.vertexAttribPointer(d,4,a.FLOAT,!1,0,0),a.vertexAttrib1f(d,0);a.deleteBuffer(b);
c=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(d=0;d<c;++d)a.activeTexture(a.TEXTURE0+d),a.bindTexture(a.TEXTURE_CUBE_MAP,null),a.bindTexture(a.TEXTURE_2D,null);a.activeTexture(a.TEXTURE0);a.useProgram(null);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.disable(a.BLEND);a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.blendColor(0,0,0,0);a.blendEquation(a.FUNC_ADD);
a.blendFunc(a.ONE,a.ZERO);a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(-1);a.colorMask(!0,!0,!0,!0);a.cullFace(a.BACK);a.depthFunc(a.LESS);a.depthMask(!0);a.depthRange(0,1);a.frontFace(a.CCW);a.hint(a.GENERATE_MIPMAP_HINT,a.DONT_CARE);a.lineWidth(1);a.pixelStorei(a.PACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);a.UNPACK_COLORSPACE_CONVERSION_WEBGL&&a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,
a.BROWSER_DEFAULT_WEBGL);a.polygonOffset(0,0);a.sampleCoverage(1,!1);a.scissor(0,0,a.canvas.width,a.canvas.height);a.stencilFunc(a.ALWAYS,0,4294967295);a.stencilMask(4294967295);a.stencilOp(a.KEEP,a.KEEP,a.KEEP);a.viewport(0,0,a.canvas.width,a.canvas.height);for(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);a.getError(););}var m={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},
getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,
2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,
1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,
2:!0}},blendEquationEXT:{1:{0:!0}}},p=null,c=null;return{init:q,mightBeEnum:function(a){b();return void 0!==p[a]},glEnumToString:n,glFunctionArgToString:f,glFunctionArgsToString:function(a,c){for(var b="",d=c.length,h=0;h<d;++h)b+=(0==h?"":", ")+f(a,d,h,c[h]);return b},makeDebugContext:d,makeLostContextSimulatingCanvas:function(a){function c(a){return"function"==typeof a?a:function(c){a.handleEvent(c)}}function b(){for(var a=Object.keys(D),c=0;c<a.length;++c)delete D[a]}function d(){++E;A||C==E&&
a.loseContext()}function f(a,c){var b=a[c];return function(){d();if(!A)return b.apply(a,arguments)}}function m(a){return{statusMessage:a,preventDefault:function(){F=!0}}}function p(a){for(var c in a)"function"==typeof a[c]?q[c]=f(a,c):k(q,a,c);q.getError=function(){d();if(!A)for(var a;a=n.getError();)D[a]=!0;for(a in D)if(D[a])return delete D[a],a;return q.NO_ERROR};var b="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(c=0;c<b.length;++c){var e=
b[c];q[e]=function(c){return function(){d();if(A)return null;var b=c.apply(a,arguments);b.__webglDebugContextLostId__=z;B.push(b);return b}}(a[e])}b="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");for(c=0;c<b.length;++c)e=
b[c],q[e]=function(c){return function(){d();return A?null:c.apply(a,arguments)}}(q[e]);b="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(c=0;c<b.length;++c)e=b[c],q[e]=function(c){return function(){d();return A?!1:c.apply(a,arguments)}}(q[e]);q.checkFramebufferStatus=function(c){return function(){d();return A?q.FRAMEBUFFER_UNSUPPORTED:c.apply(a,arguments)}}(q.checkFramebufferStatus);q.getAttribLocation=function(c){return function(){d();return A?-1:c.apply(a,
arguments)}}(q.getAttribLocation);q.getVertexAttribOffset=function(c){return function(){d();return A?0:c.apply(a,arguments)}}(q.getVertexAttribOffset);q.isContextLost=function(){return A};return q}var n,q,x=[],v=[];q={};var z=1,A=!1,B=[],C=0,E=0,F=!1,H=0,D={};a.getContext=function(c){return function(){var b=c.apply(a,arguments);if(b instanceof WebGLRenderingContext){if(b!=n){if(n)throw"got different context";n=b;q=p(n)}return q}return b}}(a.getContext);(function(a){var b=a.addEventListener;a.addEventListener=
function(d,e,f){switch(d){case "webglcontextlost":x.push(c(e));break;case "webglcontextrestored":v.push(c(e));break;default:b.apply(a,arguments)}}})(a);a.loseContext=function(){if(!A){A=!0;C=0;for(++z;n.getError(););b();D[n.CONTEXT_LOST_WEBGL]=!0;var c=m("context lost"),d=x.slice();setTimeout(function(){for(var b=0;b<d.length;++b)d[b](c);0<=H&&setTimeout(function(){a.restoreContext()},H)},0)}};a.restoreContext=function(){A&&v.length&&setTimeout(function(){if(!F)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var a=0;a<B.length;++a){var c=B[a];c instanceof WebGLBuffer?n.deleteBuffer(c):c instanceof WebGLFramebuffer?n.deleteFramebuffer(c):c instanceof WebGLProgram?n.deleteProgram(c):c instanceof WebGLRenderbuffer?n.deleteRenderbuffer(c):c instanceof WebGLShader?n.deleteShader(c):c instanceof WebGLTexture&&n.deleteTexture(c)}h(n);A=!1;E=0;F=!1;for(var a=v.slice(),c=m("context restored"),b=0;b<a.length;++b)a[b](c)},0)};a.loseContextInNCalls=function(a){if(A)throw"You can not ask a lost contet to be lost";
C=E+a};a.getNumCalls=function(){return E};a.setRestoreTimeout=function(a){H=a};return a},resetToInitialState:h}})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.default=function(b){return window.WebGL2RenderingContext&&b instanceof window.WebGL2RenderingContext}})},"esri/views/3d/webgl-engine/parts/Viewport":function(){define("require exports ../../../../core/has ../../../../core/now ../../../../core/libs/gl-matrix-2/vec3f64 ../lib/Camera ../lib/Renderer".split(" "),
function(q,b,n,f,k,d,h){var m={fbo:null,lightDirection:null,camera:null,disableSlice:!1};return function(){function b(c,a,b,f,e){this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,renderTimeTotal:0,renderTimeLast:0,frameCount:0};this._needsRender=!0;this._rctx=e;this._renderer=new h(a,b,f,e,"scene",c);this._camera=new d(k.vec3f64.fromValues(0,100,-100))}Object.defineProperty(b.prototype,"isLoadingResources",{get:function(){return this._renderer.isLoadingResources},enumerable:!0,configurable:!0});
b.prototype.getCombinedStats=function(){var c=this._rctx.gl,a={},b=this._renderer.getCombinedStats(),d;for(d in b)a[d]=b[d];a.renderGeometriesTotal=this._stats.renderGeometriesTotal;a.renderGeometriesVisible=this._stats.renderGeometriesVisible;void 0!==c.getUsedTextureMemory&&(a.textureMemory=c.getUsedTextureMemory());void 0!==c.getUsedRenderbufferMemory&&(a.renderbufferMemory=c.getUsedRenderbufferMemory());void 0!==c.getUsedVBOMemory&&(a.VBOMemory=c.getUsedVBOMemory());if(void 0!==c.getUsedTextureMemoryStats){var c=
c.getUsedTextureMemoryStats(),e;for(e in c)a["texMem type: "+e]=c[e]}return a};b.prototype.dispose=function(){this._renderer.dispose();this._renderer=null};b.prototype.setLighting=function(c){this._renderer.setLighting(c)};b.prototype.setRenderParams=function(c){this._renderer.setRenderParams(c)};b.prototype.getRenderParams=function(){return this._renderer.getRenderParams()};b.prototype.ensureEdgeView=function(){return this._renderer.ensureEdgeView()};Object.defineProperty(b.prototype,"hasSlicePlane",
{get:function(){return this._renderer.hasSlicePlane},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"edgeView",{get:function(){return this._renderer.edgeView},enumerable:!0,configurable:!0});b.prototype.modify=function(c,a,b,d){this._renderer.modify(c,a,b,d)};b.prototype.setCamera=function(c){this._camera.copyFrom(c);this._needsRender=!0};b.prototype.getCamera=function(){return this._camera};Object.defineProperty(b.prototype,"renderPlugins",{get:function(){return this._renderer.renderPlugins},
enumerable:!0,configurable:!0});b.prototype.getFramebufferTexture=function(c){return this._renderer.getFramebufferTexture(c)};b.prototype.render=function(c){m.camera=c.camera||this._camera;m.fbo=c.fbo;m.lightDirection=c.lightDirection;m.disableSlice=c.disableSlice||!1;this._renderer.render(m)};b.prototype.resetNeedsRender=function(){this._needsRender=!1;this._renderer.resetNeedsRender()};b.prototype.needsRender=function(){return this._needsRender||this._renderer.needsRender()};Object.defineProperty(b.prototype,
"test",{get:function(){return{renderer:this._renderer}},enumerable:!0,configurable:!0});b.prototype.getGpuMemoryUsage=function(){return this._renderer.getGpuMemoryUsage()};return b}()})},"esri/views/3d/webgl-engine/shaders/globalOptions":function(){define(["require","exports","../../../webgl/programUtils"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.glslifyGlobalOptions=function(b){return n.glslifyDefineMap({VIEWING_MODE:{value:b.viewingMode,options:{global:"VIEWING_MODE_GLOBAL",
local:"VIEWING_MODE_LOCAL"}}})}})},"esri/views/support/screenshotUtils":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/compilerUtils"],function(q,b,n,f){function k(a,c){var b=a||{},d=b.format,h=b.quality,l=b.rotation,b=b.disableSlice,k=c.padding||u,r;r=c.width-k.left-k.right;c=c.height-k.top-k.bottom;var n=k=0,t=r,q=c;if(a&&a.area){var k=Math.floor(a.area.x)||0,n=Math.floor(a.area.y)||0,F=null!=a.area.width?Math.floor(a.area.width):null,H=null!=a.area.height?
Math.floor(a.area.height):null,t=t-k,q=q-n;null!=F&&null!=H?(t=Math.min(t,F),q=Math.min(q,H)):null==F&&null!=H?(F=Math.min(t,F),q*=F/t,t=F):null!=F&&null==H&&(F=Math.min(q,H),t*=F/q,q=F)}k=p({x:k,y:n,width:t,height:q},a);n=Math.floor(Math.max(k.x,0));t=Math.floor(Math.max(k.y,0));r={x:n,y:t,width:Math.floor(Math.min(k.width,r-n)),height:Math.floor(Math.min(k.height,c-t))};c=r.width/r.height;k=k.width/k.height;k!==c&&(k>c?(c=Math.floor(r.width/k),r={x:r.x,y:Math.floor(r.y+(r.height-c)/2),width:r.width,
height:c}):(c=Math.floor(r.height*k),r={x:Math.floor(r.x+(r.width-c)/2),y:r.y,width:c,height:r.height}));c=m(a,r);a=c.width;c=c.height;a:switch(d){case "png":case "jpg":case "jpeg":break a;case null:case void 0:d=g;break a;default:f.neverReached(d),d=g}k=e[d];h=null!=h?h:k;return{format:d,quality:0>h?0:100<h?100:h,area:r,width:a,height:c,rotation:l,disableSlice:b||!1}}function d(a,c){return a.toDataURL(l[c.format],c.quality/100)}function h(a,b,d){d||(c||(c=document.createElement("canvas"),c.width=
1,c.height=1),d=c);return d.getContext("2d").createImageData(a,b)}function m(a,c){if(!a)return c;var b=a.width;a=a.height;if(null!=b&&null!=a)return{width:Math.floor(b),height:Math.floor(a)};if(null==b&&null==a)return c;c=c.width/c.height;return null==a?{width:Math.floor(b),height:Math.floor(b/c)}:{width:Math.floor(a*c),height:Math.floor(a)}}function p(a,c){if(!c||null==c.width||null==c.height)return a;c=c.width/c.height;var b=a.width/a.height;if(b===c)return a;if(b<c)return a.width=Math.floor(a.height*
c),a.height=a.height,a;a.width=a.width;a.height=Math.floor(a.width/c);return a}Object.defineProperty(b,"__esModule",{value:!0});b.completeUserSettings=k;b.toRenderSettings=function(a,c){var b=k(a,c),d=b.area,e=b.width/d.width,f=c.padding,g=f.left+f.right,h=f.top+f.bottom;return{framebufferWidth:Math.floor((c.width-g)*e+g),framebufferHeight:Math.floor((c.height-h)*e+h),region:{x:Math.floor(d.x*e)+f.left,y:Math.floor(d.y*e)+f.top,width:b.width,height:b.height},format:b.format,quality:b.quality,rotation:b.rotation,
pixelRatio:e,layers:a&&a.layers?a.layers:[],disableSlice:b.disableSlice}};b.encodeResult=function(a,c,b,e){if(e.premultipliedAlpha)for(var f=a.data,g=f.length,h=0;h<g;h+=4){var l=f[h+3];0<l&&(l/=255,f[h+0]/=l,f[h+1]/=l,f[h+2]/=l)}b.width=a.width;b.height=a.height;f=b.getContext("2d");f.putImageData(a,0,0);e.flipY&&(f.save(),f.globalCompositeOperation="copy",f.scale(1,-1),f.translate(0,-f.canvas.height),f.drawImage(f.canvas,0,0),f.restore());a=f.getImageData(0,0,a.width,a.height);c=d(b,c);b.width=
0;b.height=0;return{dataUrl:c,data:a}};b.toDataUrl=d;b.createEmptyImageData=function(c,b,d){if(!c||!b)throw Error("Cannot construct image data without dimensions");if(a)try{return new ImageData(c,b)}catch(w){a=!1}return h(c,b,d)};b.wrapImageData=function(c,b,d,e){if(!b||!d)throw Error("Cannot construct image data without dimensions");if(a)try{return new ImageData(c,b,d)}catch(x){a=!1}b=h(b,d,e);b.data.set(c,0);return b};b.resampleHermite=function(a,c,b,d,e,f,g,h){void 0===d&&(d=0);void 0===e&&(e=
0);void 0===f&&(f=a.width-d);void 0===g&&(g=a.height-e);void 0===h&&(h=!1);var l=a.data,m=c.width,k=c.height,p=c.data;f/=m;g/=k;var r=Math.ceil(f/2),n=Math.ceil(g/2);a=a.width;for(var t=0;t<k;t++)for(var u=0;u<m;u++){for(var q=4*(u+(h?k-t-1:t)*m),x=0,y=0,w=0,v=0,z=0,A=0,J=(t+.5)*g,U=Math.floor(t*g);U<(t+1)*g;U++)for(var Q=Math.abs(J-(U+.5))/n,I=(u+.5)*f,Q=Q*Q,V=Math.floor(u*f);V<(u+1)*f;V++){var X=Math.abs(I-(V+.5))/r,X=Math.sqrt(Q+X*X);if(!(1<=X)){var X=2*X*X*X-3*X*X+1,W=4*(d+V+(e+U)*a),A=A+X*l[W+
3],y=y+X;!b&&255>l[W+3]&&(X=X*l[W+3]/255);w+=X*l[W];v+=X*l[W+1];z+=X*l[W+2];x+=X}}p[q]=w/x;p[q+1]=v/x;p[q+2]=z/x;p[q+3]=A/y}return c};b.screenshotSuperSampleSettings=function(a,c){if(!c)return a;c=a.framebufferWidth;var b=a.framebufferHeight,d=a.region,e=Math.min(8,2048/Math.max(c,b));return 1.5>e?a:n({},a,{framebufferWidth:Math.round(c*e),framebufferHeight:Math.round(b*e),pixelRatio:a.pixelRatio*e,resample:{region:{x:Math.round(d.x*e),y:Math.round(d.y*e),width:Math.round(d.width*e),height:Math.round(d.height*
e)},width:c,height:b}})};var c=null,a=!0,l={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},g="jpg",e={png:100,jpg:98,jpeg:98},u={top:0,right:0,bottom:0,left:0}})},"esri/views/webgl/RenderingContext":function(){define("require exports ../../core/has ./enums ./InstanceCounter ./renderState ./capabilities/isWebGL2Context ./capabilities/load".split(" "),function(q,b,n,f,k,d,h,m){function p(c,a){switch(c){case 0:return 2*a;case 4:return a/3;case 5:return a-2;case 6:return a-2}return 0}return function(){function c(a,
c){var b=this;this.gl=null;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange=
{zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._clearColor={r:0,g:0,b:0,a:0};this._activeRenderbuffer=this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap=
{};this._numOfTriangles=this._numOfDrawCalls=0;this.contextVersion=h.default(a)?"webgl2":"webgl";this.gl=a;a instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=m.loadCapabilities(a,c);a=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:a[0],y:a[1],width:a[2],height:a[3]};a=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),
maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:a?this.gl.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)};n("esri-webgl-debug")&&(this.instanceCounter=new k);this._stateTracker=new d.StateTracker({setBlending:function(a){a?(b.setBlendingEnabled(!0),b.setBlendEquationSeparate(a.opRgb,a.opAlpha),b.setBlendFunctionSeparate(a.srcRgb,a.dstRgb,a.srcAlpha,a.dstAlpha),a=a.color,b.setBlendColor(a.r,
a.g,a.b,a.a)):b.setBlendingEnabled(!1)},setCulling:function(a){a?(b.setFaceCullingEnabled(!0),b.setCullFace(a.face),b.setFrontFace(a.mode)):b.setFaceCullingEnabled(!1)},setPolygonOffset:function(a){a?(b.setPolygonOffsetFillEnabled(!0),b.setPolygonOffset(a.factor,a.units)):b.setPolygonOffsetFillEnabled(!1)},setDepthTest:function(a){a?(b.setDepthTestEnabled(!0),b.setDepthFunction(a.func)):b.setDepthTestEnabled(!1)},setStencilTest:function(a){if(a){b.setStencilTestEnabled(!0);var c=a.function;b.setStencilFunction(c.func,
c.ref,c.mask);a=a.operation;b.setStencilOp(a.fail,a.zFail,a.zPass)}else b.setStencilTestEnabled(!1)},setDepthWrite:function(a){a?(b.setDepthWriteEnabled(!0),b.setDepthRange(a.zNear,a.zFar)):b.setDepthWriteEnabled(!1)},setColorWrite:function(a){a?b.setColorMask(a.r,a.g,a.b,a.a):b.setColorMask(!1,!1,!1,!1)},setStencilWrite:function(a){a?b.setStencilWriteMask(a.mask):b.setStencilWriteMask(0)}});this.enforceState()}Object.defineProperty(c.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0});c.prototype.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap={};n("esri-webgl-debug")&&this.instanceCounter.printResourceCount();this.gl=null};c.prototype.setPipelineState=function(a){this._stateTracker.setPipeline(a)};c.prototype.setBlendingEnabled=function(a){this._blendEnabled!==a&&(!0===
a?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=a,this._stateTracker.invalidateBlending())};c.prototype.setBlendColor=function(a,c,b,d){if(a!==this._blendColorState.r||c!==this._blendColorState.g||b!==this._blendColorState.b||d!==this._blendColorState.a)this.gl.blendColor(a,c,b,d),this._blendColorState.r=a,this._blendColorState.g=c,this._blendColorState.b=b,this._blendColorState.a=d,this._stateTracker.invalidateBlending()};c.prototype.setBlendFunction=function(a,
c){if(a!==this._blendFunctionState.srcRGB||c!==this._blendFunctionState.dstRGB)this.gl.blendFunc(a,c),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=a,this._blendFunctionState.dstRGB=c,this._blendFunctionState.dstAlpha=c,this._stateTracker.invalidateBlending()};c.prototype.setBlendFunctionSeparate=function(a,c,b,d){if(this._blendFunctionState.srcRGB!==a||this._blendFunctionState.srcAlpha!==b||this._blendFunctionState.dstRGB!==c||this._blendFunctionState.dstAlpha!==d)this.gl.blendFuncSeparate(a,
c,b,d),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=b,this._blendFunctionState.dstRGB=c,this._blendFunctionState.dstAlpha=d,this._stateTracker.invalidateBlending()};c.prototype.setBlendEquation=function(a){this._blendEquationState.mode!==a&&(this.gl.blendEquation(a),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=a,this._stateTracker.invalidateBlending())};c.prototype.setBlendEquationSeparate=function(a,c){if(this._blendEquationState.mode!==a||this._blendEquationState.modeAlpha!==
c)this.gl.blendEquationSeparate(a,c),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=c,this._stateTracker.invalidateBlending()};c.prototype.setColorMask=function(a,c,b,d){if(this._colorMaskState.r!==a||this._colorMaskState.g!==c||this._colorMaskState.b!==b||this._colorMaskState.a!==d)this.gl.colorMask(a,c,b,d),this._colorMaskState.r=a,this._colorMaskState.g=c,this._colorMaskState.b=b,this._colorMaskState.a=d,this._stateTracker.invalidateColorWrite()};c.prototype.setClearColor=function(a,
c,b,d){if(this._clearColor.r!==a||this._clearColor.g!==c||this._clearColor.b!==b||this._clearColor.a!==d)this.gl.clearColor(a,c,b,d),this._clearColor.r=a,this._clearColor.g=c,this._clearColor.b=b,this._clearColor.a=d};c.prototype.setFaceCullingEnabled=function(a){this._polygonCullingEnabled!==a&&(!0===a?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=a,this._stateTracker.invalidateCulling())};c.prototype.setPolygonOffsetFillEnabled=function(a){this._polygonOffsetFillEnabled!==
a&&(!0===a?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=a,this._stateTracker.invalidatePolygonOffset())};c.prototype.setPolygonOffset=function(a,c){if(this._polygonOffset[0]!==a||this._polygonOffset[1]!==c)this._polygonOffset[0]=a,this._polygonOffset[1]=c,this.gl.polygonOffset(a,c),this._stateTracker.invalidatePolygonOffset()};c.prototype.setCullFace=function(a){this._cullFace!==a&&(this.gl.cullFace(a),this._cullFace=a,this._stateTracker.invalidateCulling())};
c.prototype.setFrontFace=function(a){this._frontFace!==a&&(this.gl.frontFace(a),this._frontFace=a,this._stateTracker.invalidateCulling())};c.prototype.setScissorTestEnabled=function(a){this._scissorTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=a)};c.prototype.setScissorRect=function(a,c,b,d){if(this._scissorRect.x!==a||this._scissorRect.y!==c||this._scissorRect.width!==b||this._scissorRect.height!==d)this.gl.scissor(a,
c,b,d),this._scissorRect.x=a,this._scissorRect.y=c,this._scissorRect.width=b,this._scissorRect.height=d};c.prototype.setDepthTestEnabled=function(a){this._depthTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=a,this._stateTracker.invalidateDepthTest())};c.prototype.setClearDepth=function(a){this._clearDepth!==a&&(this.gl.clearDepth(a),this._clearDepth=a)};c.prototype.setDepthFunction=function(a){this._depthFunction!==a&&(this.gl.depthFunc(a),
this._depthFunction=a,this._stateTracker.invalidateDepthTest())};c.prototype.setDepthWriteEnabled=function(a){this._depthWriteEnabled!==a&&(this.gl.depthMask(a),this._depthWriteEnabled=a,this._stateTracker.invalidateDepthWrite())};c.prototype.setDepthRange=function(a,c){if(this._depthRange.zNear!==a||this._depthRange.zFar!==c)this.gl.depthRange(a,c),this._depthRange.zNear=a,this._depthRange.zFar=c,this._stateTracker.invalidateDepthWrite()};c.prototype.setStencilTestEnabled=function(a){this._stencilTestEnabled!==
a&&(!0===a?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=a,this._stateTracker.invalidateStencilTest())};c.prototype.setClearStencil=function(a){a!==this._clearStencil&&(this.gl.clearStencil(a),this._clearStencil=a)};c.prototype.setStencilFunction=function(a,c,b){if(this._stencilFunction.func!==a||this._stencilFunction.ref!==c||this._stencilFunction.mask!==b)this.gl.stencilFunc(a,c,b),this._stencilFunction.face=1032,this._stencilFunction.func=a,
this._stencilFunction.ref=c,this._stencilFunction.mask=b,this._stateTracker.invalidateStencilTest()};c.prototype.setStencilFunctionSeparate=function(a,c,b,d){if(this._stencilFunction.face!==a||this._stencilFunction.func!==c||this._stencilFunction.ref!==b||this._stencilFunction.mask!==d)this.gl.stencilFuncSeparate(a,c,b,d),this._stencilFunction.face=a,this._stencilFunction.func=c,this._stencilFunction.ref=b,this._stencilFunction.mask=d,this._stateTracker.invalidateStencilTest()};c.prototype.setStencilWriteMask=
function(a){this._stencilWriteMask!==a&&(this.gl.stencilMask(a),this._stencilWriteMask=a,this._stateTracker.invalidateStencilWrite())};c.prototype.setStencilOp=function(a,c,b){if(this._stencilOperation.fail!==a||this._stencilOperation.zFail!==c||this._stencilOperation.zPass!==b)this.gl.stencilOp(a,c,b),this._stencilOperation.face=1032,this._stencilOperation.fail=a,this._stencilOperation.zFail=c,this._stencilOperation.zPass=b,this._stateTracker.invalidateStencilTest()};c.prototype.setStencilOpSeparate=
function(a,c,b,d){if(this._stencilOperation.face!==a||this._stencilOperation.fail!==c||this._stencilOperation.zFail!==b||this._stencilOperation.zPass!==d)this.gl.stencilOpSeparate(a,c,b,d),this._stencilOperation.face=a,this._stencilOperation.face=a,this._stencilOperation.fail=c,this._stencilOperation.zFail=b,this._stencilOperation.zPass=d,this._stateTracker.invalidateStencilTest()};c.prototype.setActiveTexture=function(a){var c=this._activeTextureUnit;0<=a&&a!==this._activeTextureUnit&&(this.gl.activeTexture(f.BASE_TEXTURE_UNIT+
a),this._activeTextureUnit=a);return c};c.prototype.clear=function(a){a&&this.gl.clear(a)};c.prototype.clearSafe=function(a){a&&(a&16384&&this.setColorMask(!0,!0,!0,!0),a&256&&this.setDepthWriteEnabled(!0),a&1024&&this.setStencilWriteMask(255),this.gl.clear(a))};c.prototype.drawArrays=function(a,c,b){n("esri-webgl-debug")&&(this._numOfDrawCalls++,this._numOfTriangles+=p(a,b));this.gl.drawArrays(a,c,b)};c.prototype.drawElements=function(a,c,b,d){n("esri-webgl-debug")&&(this._numOfDrawCalls++,this._numOfTriangles+=
p(a,c));5123===b?this.gl.drawElements(a,c,b,d):5125===b&&this.gl.drawElements(a,c,b,d)};c.prototype.logIno=function(){n("esri-webgl-debug")&&console.log("DrawCalls: "+this._numOfDrawCalls+", Triangles: "+this._numOfTriangles)};Object.defineProperty(c.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0});c.prototype.setViewport=function(a,c,b,d){var e=this._viewport;if(e.x!==a||e.y!==c||e.width!==b||e.height!==d)e.x=a,e.y=c,e.width=b,e.height=d,this.gl.viewport(a,
c,b,d)};c.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};c.prototype.bindProgram=function(a){a?this._activeShaderProgram!==a&&(a.initialize(),this.gl.useProgram(a.glName),this._activeShaderProgram=a):(this.gl.useProgram(null),this._activeShaderProgram=null)};c.prototype.bindTexture=function(a,b){void 0===b&&(b=0);-1===c._MAX_TEXTURE_IMAGE_UNITS&&(c._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));
(b>=c._MAX_TEXTURE_IMAGE_UNITS||0>b)&&console.error("Input texture unit is out of range of available units!");var d=this._textureUnitMap[b];this.setActiveTexture(b);null==a||null==a.glName?(null!=d&&(this.gl.bindTexture(d.descriptor.target,null),d.setBoundToUnit(b,!1)),this._textureUnitMap[b]=null):d&&d.id===a.id?a.applyChanges():(this.gl.bindTexture(a.descriptor.target,a.glName),a.setBoundToUnit(b,!0),a.applyChanges(),this._textureUnitMap[b]=a)};c.prototype.bindFramebuffer=function(a){a?this._activeFramebuffer!==
a&&(a.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.glName),this._activeFramebuffer=a):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null)};c.prototype.bindBuffer=function(a){a&&(34962===a.bufferType?this._activeVertexBuffer=c._bindBuffer(this.gl,a,a.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=c._bindBuffer(this.gl,a,a.bufferType,this._activeIndexBuffer))};c.prototype.bindRenderbuffer=function(a){var c=this.gl;a||(c.bindRenderbuffer(c.RENDERBUFFER,
null),this._activeRenderbuffer=null);this._activeRenderbuffer!==a&&(c.bindRenderbuffer(c.RENDERBUFFER,a.glName),this._activeRenderbuffer=a)};c.prototype.unbindBuffer=function(a){34962===a?this._activeVertexBuffer=c._bindBuffer(this.gl,null,a,this._activeVertexBuffer):this._activeIndexBuffer=c._bindBuffer(this.gl,null,a,this._activeIndexBuffer)};c.prototype.bindVAO=function(a){a?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===a.id||(a.bind(),this._activeVertexArrayObject=a):this._activeVertexArrayObject&&
(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};c.prototype.getBoundTexture=function(a){return this._textureUnitMap[a]};c.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer};c.prototype.getBoundVAO=function(){return this._activeVertexArrayObject};c.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);for(var a=0;a<this.parameters.maxTextureImageUnits;a++)this.bindTexture(null,
a);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,
7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};c.prototype.enforceState=function(){var a=this.gl,c=this._capabilities.vao;c&&c.bindVertexArray(null);for(var b=0;b<this.parameters.maxVertexAttributes;b++)a.disableVertexAttribArray(b);this._activeVertexBuffer?a.bindBuffer(this._activeVertexBuffer.bufferType,
this._activeVertexBuffer.glName):a.bindBuffer(34962,null);this._activeIndexBuffer?a.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):a.bindBuffer(34963,null);if(c&&this._activeVertexArrayObject){if(c=this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(c)}a.bindFramebuffer(a.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null);a.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:
null);a.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);a.bindRenderbuffer(a.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null);!0===this._blendEnabled?a.enable(this.gl.BLEND):a.disable(this.gl.BLEND);a.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);a.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);
a.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);a.clearDepth(this._clearDepth);a.clearStencil(this._clearStencil);a.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);a.cullFace(this._cullFace);a.depthFunc(this._depthFunction);a.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST);a.depthMask(this._depthWriteEnabled);a.frontFace(this._frontFace);
a.lineWidth(1);!0===this._polygonCullingEnabled?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE);a.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?a.enable(a.POLYGON_OFFSET_FILL):a.disable(a.POLYGON_OFFSET_FILL);a.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?a.enable(a.SCISSOR_TEST):a.disable(a.SCISSOR_TEST);a.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,
this._stencilFunction.mask);a.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);!0===this._stencilTestEnabled?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST);a.stencilMask(this._stencilWriteMask);for(c=0;c<this.parameters.maxTextureImageUnits;c++)a.activeTexture(f.BASE_TEXTURE_UNIT+c),a.bindTexture(3553,null),(b=this._textureUnitMap[c])&&a.bindTexture(b.descriptor.target,b.glName);a.activeTexture(f.BASE_TEXTURE_UNIT+
this._activeTextureUnit);a.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height);n("esri-webgl-debug")&&(this._numOfTriangles=this._numOfDrawCalls=0)};c._bindBuffer=function(a,c,b,d){if(!c)return a.bindBuffer(b,null),null;if(d===c)return d;a.bindBuffer(b,c.glName);return c};c._MAX_TEXTURE_IMAGE_UNITS=-1;return c}()})},"esri/views/webgl/enums":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.BASE_TEXTURE_UNIT=
33984})},"esri/views/webgl/InstanceCounter":function(){define(["require","exports"],function(q,b){return function(){function b(){this._instanceCount={textureCount:0,bufferCount:0,vaoCount:0,programCount:0,framebufferCount:0,renderBufferCount:0}}b.prototype.incrementCount=function(b){switch(b){case 0:this._instanceCount.textureCount++;break;case 1:this._instanceCount.bufferCount++;break;case 2:this._instanceCount.vaoCount++;break;case 3:this._instanceCount.programCount++;break;case 4:this._instanceCount.framebufferCount++;
break;case 5:this._instanceCount.renderBufferCount++}};b.prototype.decrementCount=function(b){switch(b){case 0:this._instanceCount.textureCount--;break;case 1:this._instanceCount.bufferCount--;break;case 2:this._instanceCount.vaoCount--;break;case 3:this._instanceCount.programCount--;break;case 4:this._instanceCount.framebufferCount--;break;case 5:this._instanceCount.renderBufferCount--}};b.prototype.printResourceCount=function(){console.log("Live objects:");console.log("Textures: "+this._instanceCount.textureCount);
console.log("Buffers: "+this._instanceCount.bufferCount);console.log("VAOs: "+this._instanceCount.vaoCount);console.log("Programs: "+this._instanceCount.programCount);console.log("Framebuffers: "+this._instanceCount.framebufferCount);console.log("Renderbuffers: "+this._instanceCount.renderBufferCount)};return b}()})},"esri/views/webgl/capabilities/load":function(){define("require exports ./DisjointTimerQuery ./Instancing ./isWebGL2Context ./VertexArrayObjects".split(" "),function(q,b,n,f,k,d){function h(b,
d,c,a,f){if(a&&k.default(b))return!0;if(d[c])return!1;for(d=0;d<f.length;d++)if(b.getExtension(f[d]))return!0;return!1}Object.defineProperty(b,"__esModule",{value:!0});b.loadCapabilities=function(b,p){p=p&&p.disabledExtensions||{};h(b,p,"standardDerivatives",!0,["OES_standard_derivatives"]);var c=f.load(b),a=d.load(b,p),l;l=p.compressedTextureS3TC?null:(l=b.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:l.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:l.COMPRESSED_RGBA_S3TC_DXT1_EXT,
COMPRESSED_RGBA_S3TC_DXT3:l.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:l.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null;var g;g=p.textureFilterAnisotropic?null:(g=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:g.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:g.TEXTURE_MAX_ANISOTROPY_EXT}:null;var e=n.load(b,p),m;k.default(b)?m={textureFloat:!0,textureFloatLinear:!p.textureFloatLinear&&
!!b.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!p.textureHalfFloatLinear&&!!b.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:b.HALF_FLOAT}:b instanceof WebGLRenderingContext?(m=!p.textureHalfFloat&&b.getExtension("OES_texture_half_float"),m={textureFloat:!p.textureFloat&&!!b.getExtension("OES_texture_float"),textureFloatLinear:!p.textureFloatLinear&&!!b.getExtension("OES_texture_float_linear"),textureHalfFloat:!!m,textureHalfFloatLinear:!p.textureHalfFloatLinear&&
!!b.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:m?m.HALF_FLOAT_OES:void 0}):m=void 0;var t;if(k.default(b)){t=!p.colorBufferFloat&&b.getExtension("EXT_color_buffer_half_float");var r=!p.colorBufferFloat&&b.getExtension("EXT_color_buffer_float");t=t||r?{textureFloat:!!r,textureHalfFloat:!!t,R16F:b.R16F,RG16F:b.RG16F,RGBA16F:b.RGBA16F,R32F:b.R32F,RG32F:b.RG32F,RGBA32F:b.RGBA32F,R11F_G11F_B10F:b.R11F_G11F_B10F,RGB16F:b.RGB16F}:null}else b instanceof WebGLRenderingContext?(t=!p.colorBufferFloat&&
b.getExtension("EXT_color_buffer_half_float"),r=!p.colorBufferFloat&&b.getExtension("WEBGL_color_buffer_float"),t=t||r?{textureFloat:!!r,textureHalfFloat:!!t,RGBA16F:t?t.RGBA16F_EXT:void 0,RGB16F:t?t.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null):t=void 0;r=k.default(b)?{MIN:b.MIN,MAX:b.MAX}:p.blendMinMax?null:(r=b.getExtension("EXT_blend_minmax"))?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null;return{instancing:c,vao:a,compressedTextureS3TC:l,textureFilterAnisotropic:g,disjointTimerQuery:e,textureFloat:m,
colorBufferFloat:t,blendMinMax:r,depthTexture:h(b,p,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),standardDerivatives:!0,shaderTextureLOD:h(b,p,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]),fragDepth:h(b,p,"fragDepth",!0,["EXT_frag_depth"])}}})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["require","exports","./isWebGL2Context"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.load=function(b,k){if(k.disjointTimerQuery)return null;
var d=b.getExtension("EXT_disjoint_timer_query")||b.getExtension("EXT_disjoint_timer_query_webgl2");return d?n.default(b)?{createQuery:function(){return b.createQuery()},resultAvailable:function(d){return b.getQueryParameter(d,b.QUERY_RESULT_AVAILABLE)},getResult:function(d){return b.getQueryParameter(d,b.QUERY_RESULT)},disjoint:function(){return b.getParameter(d.GPU_DISJOINT_EXT)},beginTimeElapsed:function(f){return b.beginQuery(d.TIME_ELAPSED_EXT,f)},endTimeElapsed:function(){return b.endQuery(d.TIME_ELAPSED_EXT)},
createTimestamp:function(b){return d.queryCounterEXT(b,d.TIMESTAMP_EXT)},timestampBits:function(){return b.getQuery(d.TIMESTAMP_EXT,d.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return d.createQueryEXT()},resultAvailable:function(b){return d.getQueryObjectEXT(b,d.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(b){return d.getQueryObjectEXT(b,d.QUERY_RESULT_EXT)},disjoint:function(){return b.getParameter(d.GPU_DISJOINT_EXT)},beginTimeElapsed:function(b){return d.beginQueryEXT(d.TIME_ELAPSED_EXT,
b)},endTimeElapsed:function(){return d.endQueryEXT(d.TIME_ELAPSED_EXT)},createTimestamp:function(b){return d.queryCounterEXT(b,d.TIMESTAMP_EXT)},timestampBits:function(){return d.getQueryEXT(d.TIMESTAMP_EXT,d.QUERY_COUNTER_BITS_EXT)}}:null}})},"esri/views/webgl/capabilities/Instancing":function(){define(["require","exports","./isWebGL2Context"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.load=function(b){return n.default(b)?{drawArraysInstanced:b.drawArraysInstanced.bind(b),
drawElementsInstanced:b.drawElementsInstanced.bind(b),vertexAttribDivisor:b.vertexAttribDivisor.bind(b)}:(b=b.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:b.drawArraysInstancedANGLE.bind(b),drawElementsInstanced:b.drawElementsInstancedANGLE.bind(b),vertexAttribDivisor:b.vertexAttribDivisorANGLE.bind(b)}:null}})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["require","exports","./isWebGL2Context"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});
b.load=function(b,k){return n.default(b)?{createVertexArray:b.createVertexArray.bind(b),deleteVertexArray:b.deleteVertexArray.bind(b),bindVertexArray:b.bindVertexArray.bind(b)}:k.vao?null:(b=b.getExtension("OES_vertex_array_object")||b.getExtension("MOZ_OES_vertex_array_object")||b.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:b.createVertexArrayOES.bind(b),deleteVertexArray:b.deleteVertexArrayOES.bind(b),bindVertexArray:b.bindVertexArrayOES.bind(b)}:null}})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/scheduling ../../../../core/libs/gl-matrix-2/vec4f64 ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./symbolComplexity ../../support/PromiseLightweight".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e){function u(a,c){a=null!=a?c.attributes[a]:0;return null!=a&&isFinite(a)?a:0}Object.defineProperty(b,"__esModule",{value:!0});var t=new c,r=d.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");q=function(b){function d(a,d,e,f){var g=b.call(this)||this;g.complexity=null;g._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};g.symbol=a;g.symbolLayer=d;g._context=e;g._symbolLayerOrder=e.layerOrder;g._symbolLayerOrderDelta=e.layerOrderDelta;
g._elevationContext=new c;g._material=null;g.complexity=g.computeComplexity();g._geometryCreationWarningHandle=null;g._updateDrivenProperties(f);g._updateElevationContext();return g}n(d,b);d.prototype.getCachedSize=function(){return null};d.prototype._logWarning=function(a){r.warn(a)};d.prototype._logGeometryCreationWarnings=function(a,c,b,d){var e=this;if(null==this._geometryCreationWarningHandle){var f=a.geometryData&&a.geometryData.polygons;d+=" geometry failed to be created";var g=null;a.projectionSuccess?
!c.length||1===c.length&&!c[0].length?g=d+" (no "+b+" were defined)":Array.isArray(c)&&Array.isArray(c[0])?c.some(function(a){return 1===a.length})?g=d+" ("+b+" should contain at least 2 vertices)":f&&0===f.length&&"rings"===b&&(g=d+" (filled "+b+" should use clockwise winding - try reversing the order of vertices)"):g=d+" ("+b+" should be defined as a 2D array)":g=d+" (failed to project geometry to view spatial reference)";g&&(this._geometryCreationWarningHandle=m.schedule(function(){return e._onNextTick()}),
this._logWarning(g))}};d.prototype._onNextTick=function(){this._geometryCreationWarningHandle=null};d.prototype._validateGeometry=function(a){return"point"!==a.type||h.isFinite(a.x)&&h.isFinite(a.y)?!0:(this._logWarning("point coordinate is not a valid number, graphic skipped"),!1)};d.prototype._defaultElevationInfoNoZ=function(){return y};d.prototype._defaultElevationInfoZ=function(){return w};d.prototype._updateElevationContext=function(){this._elevationContext.setDefaults();var a=this._context.layer.elevationInfo;
a&&this._elevationContext.mixinApi(a);(a=this.symbolLayer&&this.symbolLayer.elevationInfo)&&this._elevationContext.mixinApi(a);this._elevationContext.featureExpressionInfoContext=this._context.featureExpressionInfoContext};d.prototype.getDefaultElevationInfo=function(a){return a.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};d.prototype.getGeometryElevationMode=function(a,c){void 0===c&&(c=this.getDefaultElevationInfo(a));return this._elevationContext.mode||c.mode};d.prototype.getGraphicElevationContext=
function(c){var b=c.geometry,d=this.getDefaultElevationInfo(b);t.setUnit(null!=this._elevationContext.unit?this._elevationContext.unit:d.unit);t.mode=this.getGeometryElevationMode(b,d);t.setOffsetMeters(null!=this._elevationContext.meterUnitOffset?this._elevationContext.meterUnitOffset:d.offset);t.featureExpressionInfoContext=this._elevationContext.featureExpressionInfoContext;this._elevationOptions.supportsOnTheGround||"on-the-ground"!==t.mode||(t.mode="relative-to-ground",t.setOffsetMeters(0),t.featureExpressionInfoContext=
a.zeroContext);c=a.createFeature(c,this._context.layer);a.setContextFeature(t.featureExpressionInfoContext,c);return t};d.prototype.prepareSymbolLayerPatch=function(a){};d.prototype.updateGeometry=function(a,c){return!1};d.prototype._getDrapedZ=function(){return-2};d.prototype._updateDrivenProperties=function(a){var c={color:!1,opacity:!1,size:!1};a||(a=this._context.renderer)&&"visualVariables"in a&&a.visualVariables&&a.visualVariables.forEach(function(a){switch(a.type){case "color":c.color=!0;if(a.stops)for(var b=
0;b<a.stops.length;b++){var d=a.stops[b].color;d&&(Array.isArray(d)&&3<d.length&&255!==d[3]||void 0!==d.a&&255!==d.a)&&(c.opacity=!0)}break;case "opacity":c.opacity=!0;break;case "size":c.size=!0}});this._drivenProperties=c};d.prototype._isPropertyDriven=function(a){return this._drivenProperties[a]};d.prototype._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var a=this._context.layer.opacity;return null==a?
1:a};d.prototype._getMaterialOpacity=function(){var a;a=1*this._getLayerOpacity();var c=this.symbolLayer&&this.symbolLayer.material;c&&!this._isPropertyDriven("opacity")&&c.color&&(a*=c.color.a);return a};d.prototype._getMaterialOpacityAndColor=function(){var a=this.symbolLayer&&this.symbolLayer.material,c=this._getMaterialOpacity(),a=!this._isPropertyDriven("color")&&a&&a.color?f.toUnitRGB(a.color):null;return l.mixinColorAndOpacity(a,c)};d.prototype._getVertexOpacityAndColor=function(a,c,b){var d=
this._isPropertyDriven("color")?a.color:null;a=this._isPropertyDriven("opacity")?a.opacity:null;d=l.mixinColorAndOpacity(d,a);b&&(d[0]*=b,d[1]*=b,d[2]*=b,d[3]*=b);return c?new c(d):d};d.prototype._getStageIdHint=function(){return this._context.layer.id+"_symbol"};d.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};d.prototype.updateSymbolLayerOrder=function(a,c){this._symbolLayerOrder=a;this._symbolLayerOrderDelta=c};d.prototype.computeComplexity=function(){return g.defaultSymbolLayerComplexity(this.symbol,
this.symbolLayer)};d.prototype.setDrawOrder=function(a,c,b){this.updateSymbolLayerOrder(a,c);this._material&&(this._material.renderPriority=a,b.add(this._material.id))};d.prototype.destroy=function(){this._geometryCreationWarningHandle&&(this._geometryCreationWarningHandle.remove(),this._geometryCreationWarningHandle=null)};d.prototype.globalPropertyChanged=function(a,c,b){switch(a){case "opacity":return this.layerOpacityChanged();case "elevationInfo":return a=this._elevationContext.mode,this._updateElevationContext(),
this.layerElevationInfoChanged(c,b,a);case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(c,b);case "pixelRatio":return this.pixelRatioChanged(c,b);default:return k.neverReachedSilent(a),!1}};d.prototype.updateGraphics3DGraphicElevationInfo=function(a,c,b){var d=this,e=!0;a.forEach(function(a){var f=c(a);f?(a=d.getGraphicElevationContext(a.graphic),f.needsElevationUpdates=b(a.mode),f.elevationContext.set(a)):e=!1});return e};d.prototype.applyRendererDiff=function(a,c){return!1};d.prototype.getFastUpdateAttrValues=
function(a){if(!this._fastUpdates.enabled)return null;var c=this._fastUpdates.visualVariables,b=c.size?u(c.size.field,a):0,d=c.color?u(c.color.field,a):0;a=c.opacity?u(c.opacity.field,a):0;return p.vec4f64.fromValues(b,d,a,0)};return d}(e.default);b.Graphics3DSymbolLayer=q;b.getAttributeValue=u;var y={mode:"on-the-ground",offset:0,unit:"meters"},w={mode:"absolute-height",offset:0,unit:"meters"};b.default=q})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/compilerUtils ../../../../core/has ../../../../symbols/support/ObjectSymbol3DLayerResource ./primitiveObjectSymbolUtils ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodResources".split(" "),
function(q,b,n,f,k,d,h,m,p){function c(a){for(var c=0,b=0,d={bytesPerFeature:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerCoordinate:0}},e=0;e<a.length;e++){var f=a[e];f&&(c+=f.primitivesPerFeature,b+=f.primitivesPerCoordinate,d.bytesPerFeature+=f.memory.bytesPerFeature,d.bytesPerCoordinate+=f.memory.bytesPerCoordinate,d.draped.bytesPerFeature+=f.memory.bytesPerFeature,d.draped.bytesPerCoordinate+=f.memory.bytesPerCoordinate)}return{primitivesPerFeature:c,primitivesPerCoordinate:b,memory:d}}
function a(a,c){var b=l(a,c);switch(c.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,memory:b};case "fill":return"mesh-3d"===a.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,memory:b}:c.outline&&0<c.outline.size?{primitivesPerFeature:-4,primitivesPerCoordinate:3,memory:b}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,memory:b};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,memory:b};case "object":return c.resource&&c.resource.href?
{primitivesPerFeature:16,primitivesPerCoordinate:0,memory:b}:n({},g(c.resource&&c.resource.primitive||d.defaultPrimitive),{memory:b});case "path":return{primitivesPerFeature:-4,primitivesPerCoordinate:20,memory:b};case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,memory:b};default:f.neverReached(c)}}function l(a,c){a="point-3d"===a.type;switch(c.type){case "extrude":return c.edges&&0<c.edges.size?b.memoryEstimators.EXTRUDE_EDGES:b.memoryEstimators.EXTRUDE;case "fill":return c.outline&&
0<c.outline.size?b.memoryEstimators.FILL_OUTLINE:b.memoryEstimators.FILL;case "line":return b.memoryEstimators.LINE;case "path":return b.memoryEstimators.PATH;case "object":return k("enable-feature:skallweit/lod-rendering")?a?b.memoryEstimators.OBJECT_POINT_LOD:b.memoryEstimators.OBJECT_POLYGON_LOD:a?b.memoryEstimators.OBJECT_POINT:b.memoryEstimators.OBJECT_POLYGON;case "icon":case "text":return a?b.memoryEstimators.ICON_POINT:b.memoryEstimators.ICON_POLYGON;default:f.neverReached(c)}}function g(a){var c=
e[a];if(c)return c;k("enable-feature:skallweit/lod-rendering")?(c=h.primitiveLodResources(a,null,null),c=p.geometriesFromLodLevelResources(c.levels[0]).reduce(function(a,c){return a+c.data.getIndices(m.VertexAttrConstants.POSITION).length/3},0)):c=h.primitiveGeometryData(a).getIndices(m.VertexAttrConstants.POSITION).length/3;c={primitivesPerFeature:c,primitivesPerCoordinate:0};return e[a]=c}Object.defineProperty(b,"__esModule",{value:!0});b.emptySymbolComplexity={primitivesPerFeature:0,primitivesPerCoordinate:0,
memory:{bytesPerFeature:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerCoordinate:0}}};b.defaultSymbolComplexity=function(d){if("web-style"===d.type)return b.emptySymbolComplexity;var e=d.symbolLayers.toArray().map(function(c){return a(d,c)});return c(e)};b.totalSymbolComplexities=c;var e={};b.defaultSymbolLayerComplexity=a;b.defaultSymbolLayerMemoryComplexity=l;b.memoryEstimators={ICON_POINT:{bytesPerFeature:7478.781325779039,bytesPerCoordinate:0,draped:{bytesPerFeature:5712.082651558076,
bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9679.372971750396,bytesPerCoordinate:56.86422538239579,draped:{bytesPerFeature:7883.966873022898,bytesPerCoordinate:56.89697037586389}},OBJECT_POINT:{bytesPerFeature:5177.80657223796,bytesPerCoordinate:0,draped:{bytesPerFeature:5177.80657223796,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:7372.024890546556,bytesPerCoordinate:56.80425878144206,draped:{bytesPerFeature:7372.024890546556,bytesPerCoordinate:56.80425878144206}},OBJECT_POINT_LOD:{bytesPerFeature:1770.211558073654,
bytesPerCoordinate:0,draped:{bytesPerFeature:1770.211558073654,bytesPerCoordinate:0}},OBJECT_POLYGON_LOD:{bytesPerFeature:3958.8422890890743,bytesPerCoordinate:56.88697205558441,draped:{bytesPerFeature:3958.8422890890743,bytesPerCoordinate:56.88697205558441}},LINE:{bytesPerFeature:7586.045782417972,bytesPerCoordinate:112.02132538683836,draped:{bytesPerFeature:4775.97368572266,bytesPerCoordinate:111.85995483757563}},PATH:{bytesPerFeature:7563.020535856769,bytesPerCoordinate:119.1242257528872,draped:{bytesPerFeature:7563.020535856769,
bytesPerCoordinate:119.1242257528872}},FILL:{bytesPerFeature:8702.040510627665,bytesPerCoordinate:56.610361738134486,draped:{bytesPerFeature:5921.70744530372,bytesPerCoordinate:56.58839624148057}},FILL_OUTLINE:{bytesPerFeature:12168.362923563885,bytesPerCoordinate:56.265773613009564,draped:{bytesPerFeature:7929.090679733446,bytesPerCoordinate:56.17528027868163}},EXTRUDE:{bytesPerFeature:11409.738625531325,bytesPerCoordinate:56.99136098105536,draped:{bytesPerFeature:11409.738625531325,bytesPerCoordinate:56.99136098105536}},
EXTRUDE_EDGES:{bytesPerFeature:19399.52461450617,bytesPerCoordinate:52.052414603432105,draped:{bytesPerFeature:19399.52461450617,bytesPerCoordinate:52.052414603432105}}}})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define("require exports ../../../../core/compilerUtils ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil".split(" "),function(q,b,n,f,k,d){Object.defineProperty(b,"__esModule",{value:!0});var h=f.fromValues(-.5,
-.5,-.5,.5,.5,.5),m=f.fromValues(-.5,-.5,0,.5,.5,1),p=f.fromValues(-.5,-.5,0,.5,.5,.5);b.isValidPrimitive=function(a){switch(a){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};b.primitiveBoundingBox=function(a){switch(a){case "sphere":case "cube":case "diamond":return h;case "cylinder":case "cone":case "inverted-cone":return m;case "tetrahedron":return p;default:n.neverReached(a)}};b.primitiveGeometryData=function(a){switch(a){case "sphere":return d.createPolySphereGeometry(.5,
2,!0);case "cube":return d.createBoxGeometry(1);case "cylinder":return d.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);case "cone":return d.cgToGIS(d.createConeGeometry(1,.5,15,!1));case "inverted-cone":return d.cgToGIS(d.createConeGeometry(1,.5,15,!0));case "tetrahedron":return d.cgToGIS(d.createTetrahedronGeometry(1));case "diamond":return d.cgToGIS(d.createDiamondGeometry(1));default:n.neverReached(a)}};b.primitiveLodResources=function(a,b,f){var e=function(a,c,e){void 0===e&&(e=!1);return{levels:a.map(function(a,
g){var h=c(a.tesselation);e&&d.cgToGIS(h);return{components:[{geometry:new k(h,f+("_lod"+g)),material:b}],faceCount:h.indexCount/3,minScreenSpaceRadius:a.minScreenSpaceRadius}})}};switch(a){case "sphere":return e([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],function(a){return d.createPolySphereGeometry(.5,a,!0)});case "cube":return e([{tesselation:0,
minScreenSpaceRadius:0}],function(a){return d.createBoxGeometry(1)});case "cone":return e(c,function(a){return d.createConeGeometry(1,.5,a,!1)},!0);case "inverted-cone":return e(c,function(a){return d.createConeGeometry(1,.5,a,!0)},!0);case "cylinder":return e(c,function(a){return d.createCylinderGeometry(1,.5,a,[0,0,1],[0,0,.5])});case "tetrahedron":return e([{tesselation:0,minScreenSpaceRadius:0}],function(a){return d.createTetrahedronGeometry(1)},!0);case "diamond":return e([{tesselation:0,minScreenSpaceRadius:0}],
function(a){return d.createDiamondGeometry(1)},!0);default:n.neverReached(a)}};var c=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}]})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["require","exports","../../../../../core/arrayUtils"],function(q,b,n){function f(b){var d=[];b.components.forEach(function(b){d.push(b.geometry)});return n.unique(d)}Object.defineProperty(b,"__esModule",{value:!0});
b.materialsFromLodResources=function(b){var d=[];b.levels.forEach(function(b){b.components.forEach(function(b){d.push(b.material)})});return n.unique(d)};b.texturesFromLodResources=function(b){var d=[];b.levels.forEach(function(b){b.components.forEach(function(b){b.textures&&d.push.apply(d,b.textures)})});return n.unique(d)};b.geometriesFromLodLevelResources=f;b.geometriesFromLodResources=function(b){var d=[];b.levels.forEach(function(b){b.components.forEach(function(b){d.push(b.geometry)})});return n.unique(d)};
b.computeFaceCount=function(b){var d=0;f(b).forEach(function(b){d+=b.data.indexCount/3});return d}})},"esri/views/3d/support/PromiseLightweight":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){void 0===b&&(b=null);this._cancelCallback=b;this._callbacks=[];this._errbacks=[];this._iserr=this._isdone=this._iscancelled=!1;this.error=this.result=null}b.prototype.cancel=function(b){this._iscancelled||this._iserr||this._isdone||
(this._callbacks=[],this._errbacks=[],this._iscancelled=!0,this._cancelCallback&&this._cancelCallback(b))};b.prototype.then=function(b,k,d){void 0===d&&(d=null);this._iscancelled||(this._isdone?b.call(d,this.result):this._iserr&&k?k.call(d,this.result):(this._callbacks.push(d?b.bind(d):b),k&&this._errbacks.push(d?k.bind(d):k)))};b.prototype.resolve=function(b){void 0===b&&(b=null);if(!(this._iscancelled||this._iserr||this._isdone)){this.result=b;this._isdone=!0;for(var f=0,d=this._callbacks;f<d.length;f++)(0,d[f])(b);
this._callbacks=[];this._errbacks=[]}};b.prototype.reject=function(b){void 0===b&&(b=null);if(!(this._iscancelled||this._iserr||this._isdone)){this.error=b;this._iserr=!0;for(var f=0,d=this._errbacks;f<d.length;f++)(0,d[f])(b);this._callbacks=[];this._errbacks=[]}};b.prototype.isRejected=function(){return this._iserr};b.prototype.isFulfilled=function(){return this._isdone||this._iserr};b.prototype.isResolved=function(){return this._isdone};b.prototype.isCancelled=function(){return this._iscancelled};
return b}();b.PromiseLightweight=q;b.default=q})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec2f32 ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/LineCalloutPrograms ../../../webgl/renderState".split(" "),function(q,b,n,f,k,d,h,m,p,c,a,l,g){function e(a,
c,b){3===b.length?a.setUniform4f(c,b[0],b[1],b[2],1):a.setUniform4fv(c,b)}q=function(b){function d(a,e){e=b.call(this,e)||this;e.params=c.copyParameters(a,t);e._uniqueMaterialIdentifier=d.uniqueMaterialIdentifier(e.params);return e}n(d,b);Object.defineProperty(d.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0});d.prototype.dispose=function(){};d.prototype.getGLMaterials=function(){return{color:u,depthShadowMap:void 0,normal:void 0,
depth:void 0,highlight:void 0}};d.prototype.getAllTextureIds=function(){return[]};d.prototype.intersect=function(a,c,b,d,e,f,g,h){};d.prototype.createBufferWriter=function(){return new w};d.prototype.createRenderer=function(c,b){return new a(c,b,this)};d.prototype.setParameterValues=function(a){c.updateParameters(this.params,a)&&(this._uniqueMaterialIdentifier=d.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))};d.prototype.getParameters=function(){return this.params};d.uniqueMaterialIdentifier=
function(a){return JSON.stringify({screenOffset:a.screenOffset||[0,0],centerOffsetUnits:a.centerOffsetUnits||"world"})};return d}(h);var u=function(a){function b(c,b,d){c=a.call(this,c,b)||this;c.isRenderSlot=!0;c.updateParameters();return c}n(b,a);b.prototype.updateParameters=function(){this.params=c.copyParameters(this.material.getParameters());this.selectProgram()};b.prototype.selectProgram=function(){var a=this.params;this.renderProgram=this.programRep.getProgram(l.program,{occlTest:!!a.occlusionTest,
verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,depthHud:!1,depthHudAlignStart:!!a.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,slice:a.slicePlaneEnabled});this.depthProgram=this.programRep.getProgram(l.program,{occlTest:!!a.occlusionTest,verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,depthHud:!0,depthHudAlignStart:!!a.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,slice:a.slicePlaneEnabled});
this.renderPipelineState=g.makePipelineState({blending:g.separateBlendingParams(1,770,771,771),depthTest:{func:513},colorWrite:g.defaultColorWriteParams});this.depthPipelineState=g.makePipelineState({depthTest:{func:513},depthWrite:g.defaultDepthWriteParams})};b.prototype.beginSlot=function(a){switch(a){case 17:return this.isRenderSlot=!0;case 18:return this.isRenderSlot=!1,!0}return!1};Object.defineProperty(b.prototype,"program",{get:function(){return this.isRenderSlot?this.renderProgram:this.depthProgram},
enumerable:!0,configurable:!0});b.prototype.getProgram=function(){return this.program};b.prototype.getPrograms=function(){return[this.renderProgram,this.depthProgram]};b.prototype.getDrawMode=function(){return 4};b.prototype.bind=function(a,b){var d=b.cameraAboveGround?1:-1,f=this.program,g=this.params;a.bindProgram(f);f.setUniform1f("cameraGroundRelative",d);f.setUniform1f("polygonOffset",g.shaderPolygonOffset);f.setUniform4fv("viewport",b.viewport);f.setUniform1f("perDistancePixelRatio",Math.tan(b.fovY/
2)/(b.viewport[2]/2));f.setUniformMatrix4fv("viewNormal",b.viewInvTransp);f.setUniform1i("hudVisibilityTexture",0);a.bindTexture(b.hudVisibilityTexture,0);e(f,"color",g.color);d=b.pixelRatio||1;f.setUniform1f("pixelRatio",d);f.setUniform2f("screenOffset",g.screenOffset[0]*d,g.screenOffset[1]*d);this.bindBorder(a,b);c.bindVerticalOffset(g.verticalOffset,b,f);this.bindSizing(a,b);c.bindScreenSizePerspective(g.screenSizePerspective,f);this.isRenderSlot?a.setPipelineState(this.renderPipelineState):a.setPipelineState(this.depthPipelineState)};
b.prototype.bindView=function(a,b){a=this.program;var d=this.params;c.bindView(b.origin,b.view,a);c.bindCamPos(b.origin,b.viewInvTransp,a);d.slicePlaneEnabled&&c.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,c){a=this.program;a.setUniformMatrix4fv("model",c.transformation);a.setUniformMatrix4fv("modelNormal",c.transformationNormal)};b.prototype.release=function(a,c){};b.prototype.bindSizing=function(a,c){a=this.program;var b=this.params;a.setUniform2f("pixelToNDC",2/
c.viewport[2],2/c.viewport[3]);a.setUniform1f("lineSize",Math.ceil(b.size)*(c.pixelRatio||1))};b.prototype.bindBorder=function(a,c){a=this.program;var b=this.params;c=c.pixelRatio||1;null!==b.borderColor?(e(a,"borderColor",b.borderColor),a.setUniform1f("borderSize",c)):(a.setUniform4f("borderColor",0,0,0,0),a.setUniform1f("borderSize",0))};return b}(d),t={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,
depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1},r=k.newLayout().vec3f(m.VertexAttrConstants.POSITION).vec3f(m.VertexAttrConstants.NORMAL).vec2f(m.VertexAttrConstants.UV0).vec4f(m.VertexAttrConstants.AUXPOS1),y=[f.vec2f32.fromValues(0,0),f.vec2f32.fromValues(1,0),f.vec2f32.fromValues(0,1),f.vec2f32.fromValues(1,0),f.vec2f32.fromValues(1,1),f.vec2f32.fromValues(0,1)],w=function(){function a(){this.vertexBufferLayout=r}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};
a.prototype.elementCount=function(a){return 6*a.indices[m.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,c,b,d,e){p.writePosition(c.indices[m.VertexAttrConstants.POSITION],c.vertexAttr[m.VertexAttrConstants.POSITION].data,a.transformation,d.position,e,6);p.writeNormal(c.indices[m.VertexAttrConstants.NORMAL],c.vertexAttr[m.VertexAttrConstants.NORMAL].data,a.invTranspTransformation,d.normal,e,6);p.writeBufferVec4(c.indices[m.VertexAttrConstants.AUXPOS1],c.vertexAttr[m.VertexAttrConstants.AUXPOS1].data,
d.auxpos1,e,6);for(a=0;a<y.length;++a)d.uv0.setVec(e+a,y[a])};return a}();return q})},"esri/core/libs/gl-matrix-2/vec2f32":function(){define(["require","exports","./factories/vec2f32"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.vec2f32=n})},"esri/core/libs/gl-matrix-2/factories/vec2f32":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){return new Float32Array(2)};b.clone=function(b){var f=new Float32Array(2);
f[0]=b[0];f[1]=b[1];return f};b.fromValues=function(b,f){var k=new Float32Array(2);k[0]=b;k[1]=f;return k};b.createView=function(b,f){return new Float32Array(b,f,2)}})},"esri/views/3d/webgl-engine/shaders/LineCalloutPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});var d=function(b){return k.glslifyDefineMap({OCCL_TEST:b.occlTest,VERTICAL_OFFSET:b.verticalOffset,
SCREEN_SIZE_PERSPECTIVE:b.screenSizePerspective,DEPTH_HUD:b.depthHud,DEPTH_HUD_ALIGN_START:b.depthHudAlignStart,CENTER_OFFSET_UNITS_SCREEN:b.centerOffsetUnitsScreen,SLICE:b.slice})};b.program={name:"line-callout",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("materials/lineCallout/lineCallout.vert"),fragmentShader:d(b)+f.resolveIncludes("materials/lineCallout/lineCallout.frag")}},attributes:n.Default3D}})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define("require exports ../../../../symbols ../../../../symbols/MeshSymbol3D ./Graphics3DSymbol ./Graphics3DWebStyleSymbol".split(" "),
function(q,b,n,f,k,d){Object.defineProperty(b,"__esModule",{value:!0});b.getGraphics3DSymbol=function(b){return b instanceof d?b.graphics3DSymbol:b instanceof k?b:null};b.getDefaultSymbol=function(b){if(!b||!b.geometry)return null;switch(b.geometry.type){case "mesh":return h}return null};var h=new f({symbolLayers:[new n.FillSymbol3DLayer]})})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./symbolComplexity ../../support/PromiseLightweight".split(" "),
function(q,b,n,f,k,d,h,m){return function(b){function c(a,c,f){var e=b.call(this)||this;e._symbol=a;e.referenced=0;a=a.symbolLayers;f&&(a=f.concat(a));f=a.length;e.childGraphics3DSymbols=Array(a.length);e.childGraphics3DSymbolPromises=Array(a.length);for(var g=c.layerOrder,h=0,l=0,m=function(a,c){c&&(e.childGraphics3DSymbols[a]=c,l++);h--;!e.isRejected()&&1>h&&(0<l?e.resolve():e.reject())},k=0;k<f;k++){var p=a.getItemAt(k);!1!==p.enabled&&(c.layerOrder=g+(1-(1+k)/f),c.layerOrderDelta=1/f,p=d.make(e.symbol,
p,c,p._ignoreDrivers))&&(h++,e.childGraphics3DSymbolPromises[k]=p)}c.layerOrder=g;if(0===h)e.resolve();else{c=function(a){var c=n.childGraphics3DSymbolPromises[a];c&&c.then(function(){return m(a,c)},function(){return m(a,null)})};for(var n=this,k=0;k<f;k++)c(k)}return e}n(c,b);c.prototype.getSymbolLayerSize=function(a,c){var b=this;this.then(function(){var d=b.childGraphics3DSymbols[a];c(d?d.getCachedSize():null)},function(){return c(null)})};Object.defineProperty(c.prototype,"symbol",{get:function(){return this._symbol},
set:function(a){this._symbol=a;if(this.childGraphics3DSymbols)for(var c=0;c<a.symbolLayers.length;c++){var b=this.childGraphics3DSymbols[c];b&&(b.symbol=a,b.symbolLayer=a.symbolLayers.items[c])}},enumerable:!0,configurable:!0});c.prototype.createGraphics3DGraphic=function(a,c){for(var b=a.graphic,d=Array(this.childGraphics3DSymbols.length),h=0;h<this.childGraphics3DSymbols.length;h++){var l=this.childGraphics3DSymbols[h];l&&(d[h]=l.createGraphics3DGraphic(a))}return new f(b,c||this,d,a.layer)};Object.defineProperty(c.prototype,
"complexity",{get:function(){return h.totalSymbolComplexities(this.childGraphics3DSymbols.map(function(a){return a&&a.complexity}))},enumerable:!0,configurable:!0});c.prototype.globalPropertyChanged=function(a,c){for(var b=this.childGraphics3DSymbols.length,d=function(b){var d=f.childGraphics3DSymbols[b],e=function(a){a=a._graphics[b];return a instanceof k?a:null};if(d&&!d.globalPropertyChanged(a,c,e))return{value:!1}},f=this,h=0;h<b;h++){var l=d(h);if("object"===typeof l)return l.value}return!0};
c.prototype.applyRendererDiff=function(a,c){return this.isResolved()?this.childGraphics3DSymbols.reduce(function(b,d,f){return b&&(!d||d.applyRendererDiff(a,c))},!0):!1};c.prototype.prepareSymbolPatch=function(a){if(!this.isRejected()&&"partial"===a.diff.type){var c=a.diff.diff;if(c.symbolLayers&&"partial"===c.symbolLayers.type){var b=c.symbolLayers.diff;(this.isResolved()?this.childGraphics3DSymbols:this.childGraphics3DSymbolPromises).forEach(function(c,d){var e;if(c){var f=b[d];if(f){var g={diff:f,
graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};c.prepareSymbolLayerPatch(g);(e=a.symbolStatePatches).push.apply(e,g.symbolLayerStatePatches);g.graphics3DGraphicPatches.length&&a.graphics3DGraphicPatches.push(function(a,c){var b=a._graphics[d];g.graphics3DGraphicPatches.forEach(function(a){return a(b,c)})})}}})}}};c.prototype.updateGeometry=function(a,c){for(var b=0;b<this.childGraphics3DSymbols.length;b++){var d=this.childGraphics3DSymbols[b];if(d&&!d.updateGeometry(a._graphics[b],c))return!1}return!0};
c.prototype.getFastUpdateStatus=function(){var a=0,c=0,b=0;this.childGraphics3DSymbolPromises.forEach(function(d){d&&!d.isFulfilled()?a++:d&&d.isFastUpdatesEnabled()?b++:d&&c++});return{loading:a,slow:c,fast:b}};c.prototype.setDrawOrder=function(a,c){for(var b=this.childGraphics3DSymbols.length,d=1/b,f=0;f<b;f++){var h=this.childGraphics3DSymbols[f];h&&h.setDrawOrder(a+(1-(1+f)/b),d,c)}};c.prototype.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");
else{this.isFulfilled()||this.reject();for(var a=0;a<this.childGraphics3DSymbolPromises.length;a++)this.childGraphics3DSymbolPromises[a]&&this.childGraphics3DSymbolPromises[a].destroy();this.childGraphics3DSymbols=this.childGraphics3DSymbolPromises=null}};Object.defineProperty(c.prototype,"destroyed",{get:function(){return null==this.childGraphics3DSymbols},enumerable:!0,configurable:!0});return c}(m.default)})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ./featureExpressionInfoUtils ../../support/projectionUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l){var g=new d(Array,function(a){return m.set(a,m.ZERO)},null,10,5),e=p.create();return function(){function b(c,b,d,e){this.addedToSpatialIndex=!1;this._labelGraphics=[];this._auxiliaryGraphics=[];for(var f=Array(2),g=0;g<f.length;g++)f[g]=Array(4);this._visibilityFlags=f;this.extent=this._featureExpressionFeature=null;++b.referenced;this.graphics3DSymbol=b;this.graphic=c;this._graphics=d;this._featureExpressionFeature=a.createFeature(c,e)}b.prototype.initialize=function(a,
c){var b=this;this._layer=a;this._stage=c;this.forEachSymbolLayerGraphic(function(d){d.initialize(a,c);d.setVisibility(b.isVisible())})};b.prototype.destroy=function(){this.forEachSymbolLayerGraphic(function(a){return a.destroy()});this._auxiliaryGraphics=this._graphics=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=null};Object.defineProperty(b.prototype,"destroyed",{get:function(){return null==this._graphics},enumerable:!0,configurable:!0});b.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(a){return a.destroy()});
this._labelGraphics.length=0};b.prototype.addLabelGraphic=function(a,c,b){this._labelGraphics.push(a);a.initialize(c,b);a.setVisibility(this.isVisible(1))};b.prototype.addAuxiliaryGraphic=function(a){this._auxiliaryGraphics.push(a);this._layer&&(a.initialize(this._layer,this._stage),a.setVisibility(this.isVisible()))};b.prototype.isDraped=function(){var a=!1;this.forEachSymbolLayerGraphic(function(c){"draped"===c.type&&(a=!0)});return a};b.prototype.isVisible=function(a,c){void 0===a&&(a=0);for(var b=
0;b<=a;b++)for(var d=this._visibilityFlags[b],e=0;e<d.length;++e)if(!1===d[e]&&e!==c)return!1;return!0};b.prototype.hasVisibilityFlag=function(a,c){return null!=this._visibilityFlags[c][a]};b.prototype.setVisibilityFlag=function(a,c,b){var d=this.isVisible(b);this._visibilityFlags[b][a]=c;var e=this.isVisible(b);if(d===e)return!1;if(1===b)this.forEachLabelGraphic(function(a){return a.setVisibility(e)});else{this.forEachSymbolLayerGraphic(function(a){return a.setVisibility(e)});var f=this.isVisible(1);
this.forEachLabelGraphic(function(a){return a.setVisibility(f)})}return!0};b.prototype.clearVisibilityFlag=function(a,c){void 0===c&&(c=0);return this.setVisibilityFlag(a,void 0,c)};b.prototype.getBSRadius=function(){var a=0;this.forEachSymbolLayerGraphic(function(c){a=Math.max(a,c.getBSRadius())});return a};b.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=h.vec3f64.create());return this._graphics[0].getCenterObjectSpace(a)};b.prototype.computeExtent=function(a){if(!this.extent){this.extent=
p.create();var b=this.graphic.geometry,d=b.spatialReference;c.computeAABR(b,this.extent);if(!d.equals(a)&&!l.boundingRectToBoundingRect(this.extent,d,this.extent,a))return this.extent=null,!1}return!0};Object.defineProperty(b.prototype,"usedMemory",{get:function(){var a=this,b=0;this.forEachSymbolLayerGraphic(function(d){var e=d.graphics3DSymbolLayer.complexity;d="draped"===d.type?e.memory.draped:e.memory;b+=d.bytesPerFeature;d.bytesPerCoordinate&&(b+=c.numVertices(a.graphic.geometry)*d.bytesPerCoordinate)});
return b},enumerable:!0,configurable:!0});b.prototype.getProjectedBoundingBox=function(a,c,b,d){return f(this,void 0,void 0,function(){var h=this;return n(this,function(l){switch(l.label){case 0:return d||(d={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),d.boundingBox?m.empty(d.boundingBox):d.boundingBox=m.empty(),d.requiresDrapedElevation=!1,[4,k.forEach(this._graphics,function(e){return f(h,void 0,void 0,function(){var f,h,l;return n(this,function(k){switch(k.label){case 0:if(!e)return[2];
f="draped"===e.type?c:a;h=g.acquire();return[4,e.getProjectedBoundingBox(f,b,d.screenSpaceObjects,h)];case 1:return l=k.sent(),isFinite(l[2])&&isFinite(l[5])||(d.requiresDrapedElevation=!0),l&&m.expand(d.boundingBox,h),g.release(h),[2]}})})})];case 1:return l.sent(),m.allFinite(d.boundingBox)||p.allFinite(m.toRect(d.boundingBox,e))?[2,d]:[2,null]}})})};b.prototype.needsElevationUpdates=function(){for(var a=0,c=this._graphics;a<c.length;a++){var b=c[a];if(b&&("object3d"===b.type||"lod-instance"===
b.type)&&b.needsElevationUpdates)return!0}a=0;for(c=this._labelGraphics;a<c.length;a++)if((b=c[a])&&b.needsElevationUpdates)return!0;return!1};b.prototype.alignWithElevation=function(a,c){var b=this;this.forEachRenderedGraphic(function(d){"object3d"!==d.type&&"lod-instance"!==d.type||d.alignWithElevation(a,c,b._featureExpressionFeature)})};b.prototype.addHighlight=function(a,c){this.forEachSymbolLayerGraphic(function(b){return b.addHighlight(a,c)})};b.prototype.removeHighlight=function(a){this.forEachSymbolLayerGraphic(function(c){return c.removeHighlight(a)})};
b.prototype.forEachGraphicList=function(a,c){a.forEach(function(a,b){return a&&c(a,b)})};b.prototype.forEachSymbolLayerGraphic=function(a){this.forEachGraphicList(this._graphics,a);this.forEachGraphicList(this._auxiliaryGraphics,a)};b.prototype.forEachLabelGraphic=function(a){this.forEachGraphicList(this._labelGraphics,a)};b.prototype.forEachRenderedGraphic=function(a){this.forEachSymbolLayerGraphic(a);this.forEachLabelGraphic(a)};return b}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("require exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a){Object.defineProperty(b,"__esModule",{value:!0});var l=n.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");b.make=function(a,c,b,d){var f=e[a.type]&&e[a.type][c.type]||g[c.type];return f?new f(a,c,b,d):(l.error("GraphicsLayerFactory#make","unknown symbol type "+c.type),null)};var g={icon:k.default,object:m.default,line:d.default,path:p.default,fill:c.default,extrude:f.default,text:a.default};b.setSymbolClass=function(a,c){g[a]=c};var e={"mesh-3d":{fill:h.default}}})},
"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/maybe ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Polygon ../../../../layers/graphics/dehydratedFeatures ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../support/edgeUtils ../../support/projectionUtils ../../support/buffer/BufferView ../../support/buffer/math/vec3 ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C,E,F){function H(a,b,d,e,f,g,h,l,m,k,p,r,n,t){var u=d.length/3,q=0;p+=2*e.count;var x=e.index,y=e.count,w=m,v=p;c.vec3.copy(M,n);var z=0<r?1:-1,x=3*x,A=w;n=3*A;for(var B=w+y,w=3*B,C=0;C<y;++C)t&&(M[0]=a[x+0],M[1]=a[x+1],M[2]=a[x+2],c.vec3.normalize(M,M)),f[n+0]=a[x+0],f[n+1]=a[x+1],f[n+2]=a[x+2],g[n+0]=b[x+0],g[n+1]=b[x+1],g[n+2]=b[x+2],h[n+0]=-z*M[0],h[n+1]=-z*M[1],h[n+2]=-z*M[2],l[A]=0,f[w+0]=a[x+0]+r*M[0],f[w+1]=a[x+1]+r*M[1],f[w+2]=a[x+
2]+r*M[2],g[w+0]=b[x+0],g[w+1]=b[x+1],g[w+2]=b[x+2],h[w+0]=z*M[0],h[w+1]=z*M[1],h[w+2]=z*M[2],l[B]=r,n+=3,w+=3,x+=3,A+=1,B+=1;x=0;n=3*v;w=3*(v+u);n=3*(v+u);w=3*v;a=O;b=N;0>r&&(a=N,b=O);for(C=0;C<u;++C)k[n+0]=d[x+a[0]],k[n+1]=d[x+a[1]],k[n+2]=d[x+a[2]],k[w+0]=d[x+b[0]]+y,k[w+1]=d[x+b[1]]+y,k[w+2]=d[x+b[2]]+y,n+=3,w+=3,x+=3;m+=2*e.count;p=p+2*u-(2*e.count+2*u);G(f,g,l,h,q,e.pathLengths[0],e.count,m,k,p,r);m+=4*e.pathLengths[0];p+=2*e.pathLengths[0];q+=e.pathLengths[0];for(d=1;d<e.pathLengths.length;++d)G(f,
g,l,h,q,e.pathLengths[d],e.count,m,k,p,r),m+=4*e.pathLengths[d],p+=2*e.pathLengths[d],q+=e.pathLengths[d]}function D(a,c,b,d,e,f,g){d[f]=d[g];g*=3;f*=3;a[f+0]=a[g+0];a[f+1]=a[g+1];a[f+2]=a[g+2];c[f+0]=c[g+0];c[f+1]=c[g+1];c[f+2]=c[g+2];b[f+0]=e[0];b[f+1]=e[1];b[f+2]=e[2]}function G(a,b,d,e,f,g,h,l,m,k,p){var r=f,n=f+1,t=f+h,u=f+h+1,q=l,x=l+1,y=l+2*g;l=l+2*g+1;0>p&&(r=f+h+1,u=f);k*=3;for(var w=0;w<g;++w){w===g-1&&(0<p?(n=f,u=f+h):(n=f,r=f+h));var v=a,z=r,A=n,B=t,C=T,z=3*z,A=3*A,B=3*B;c.vec3.set(R,
v[z++],v[z++],v[z++]);c.vec3.set(J,v[A++],v[A++],v[A++]);c.vec3.set(U,v[B++],v[B++],v[B++]);c.vec3.subtract(Q,J,R);c.vec3.subtract(I,U,R);c.vec3.cross(C,I,Q);c.vec3.normalize(C,C);D(a,b,e,d,T,q,r);D(a,b,e,d,T,x,n);D(a,b,e,d,T,y,t);D(a,b,e,d,T,l,u);m[k++]=q;m[k++]=y;m[k++]=l;m[k++]=q;m[k++]=l;m[k++]=x;r++;n++;t++;u++;q+=2;x+=2;y+=2;l+=2}}Object.defineProperty(b,"__esModule",{value:!0});var K=a.vec3f64.create(),M=a.vec3f64.create(),O=[0,2,1],N=[0,1,2],P=g.makeDehydratedPoint(0,0,0,null),L={verticalDistanceToGround:0,
terrainElevation:0};q=function(b){function g(c,d,e,f){c=b.call(this,c,d,e,f)||this;c._edgeStageObjects=new Set;if(!c._isPropertyDriven("size")&&(d=r.validateSymbolLayerSize(c._getSymbolSize())))return c._logWarning(d),c.reject(),c;d=c._getStageIdHint();f=c._getMaterialOpacityAndColor();e=a.vec3f64.fromArray(f);f=f[3];e={diffuse:e,ambient:e,opacity:f,transparent:1>f||c._isPropertyDriven("opacity"),vertexColors:!0,slicePlaneEnabled:c._context.slicePlaneEnabled,castShadows:c.symbolLayer.castShadows};
c._material=new F(e,d+"_3dlinemat");c._context.stage.add(z.ModelContentType.MATERIAL,c._material);c.resolve();return c}n(g,b);g.prototype.destroy=function(){b.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&this._context.stage.remove(z.ModelContentType.MATERIAL,this._material.id)};g.prototype.createGraphics3DGraphic=function(a){var c=a.renderingInfo;a=a.graphic;var b=a.geometry;if("polygon"!==b.type&&"extent"!==b.type)return this._logWarning("unsupported geometry type for extrude symbol: "+
b.type),null;if(!this._validateGeometry(b))return null;var d="graphic"+a.uid,e=this._getVertexOpacityAndColor(c,Float32Array,255),f=this.getGraphicElevationContext(a);return this._createAs3DShape(b,c,e,f,d,a.uid)};g.prototype.layerOpacityChanged=function(){var a=this._getMaterialOpacity(),c=1>a||this._isPropertyDriven("opacity");this._material.setParameterValues({opacity:a,transparent:c});if(0<this._edgeStageObjects.size){var b=this._context.stage.view.ensureEdgeView(),d=this._getLayerOpacity();this._edgeStageObjects.forEach(function(a){return b.updateAllComponentOpacities(a,
[d])})}return!0};g.prototype.layerElevationInfoChanged=function(a,c){return this.updateGraphics3DGraphicElevationInfo(a,c,u.needsElevationUpdates3D)};g.prototype.slicePlaneEnabledChanged=function(a,c){var b=this;this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});if(0<this._edgeStageObjects.size){var d=this._context.stage.view.ensureEdgeView();a=this._createEdgeMaterial(d);if(f.isSome(a)){var e=[a];this._edgeStageObjects.forEach(function(a){return d.updateAllComponentMaterials(a,
e,{slicePlaneEnabled:b._context.slicePlaneEnabled},!1)})}}return!0};g.prototype.pixelRatioChanged=function(a,c){return!0};g.prototype._getExtrusionSize=function(a){a=a.size&&this._isPropertyDriven("size")?u.getSingleSizeDriver(a.size,2):this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};g.prototype._getSymbolSize=function(){return this.symbolLayer.size||1};g.prototype._createAs3DShape=function(b,g,n,t,q,y){var z=this,B="extent"===b.type?l.fromExtent(b):b;b=B.rings;var G=
[],D=[],M=[],J=Array(6),U=this._context.renderSpatialReference===w.SphericalECEFSpatialReference,F=this._getExtrusionSize(g),I=a.vec3f64.create();U||this._context.renderCoordsHelper.worldUpAtPosition(null,I);g=u.getGeometryVertexData3D(b,B.hasZ,B.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,t);this._logGeometryCreationWarnings(g,b,"rings","ExtrudeSymbol3DLayer");if(0===b.length||!b.some(function(a){return 0<a.length}))return null;
var O=r.computeCentroid(B);b=p.mat4f64.create();w.computeLinearTransformation(B.spatialReference,[O.x,O.y,0],b,this._context.renderSpatialReference);var Q=p.mat4f64.create();m.mat4.invert(Q,b);var Z=h.mat3f64.create();d.mat3.normalFromMat4(Z,Q);for(var X=g.geometryData.polygons,N=g.eleVertexData,ca=g.vertexData,B=ca.length/3,S=new Float64Array(18*B),aa=new Float64Array(18*B),T=new Float64Array(18*B),R=new Float64Array(6*B),W=0,B=function(a){var c=X[a],b=c.count,d=c.index;if(da._context.clippingExtent&&
(u.computeBoundingBox(N,d,b,J),u.boundingBoxClipped(J,da._context.clippingExtent)))return"continue";var e=new Float64Array(N.buffer,3*d*S.BYTES_PER_ELEMENT,3*b),f=c.holeIndices.map(function(a){return a-d}),e=k(e,f,3);if(0===e.length)return"continue";var f=new Uint32Array(6*b+2*e.length),g=6*b,h=3*S.BYTES_PER_ELEMENT,h=new x.BufferViewVec3f64(S.buffer,W*h,h,(W+g)*h),l=3*aa.BYTES_PER_ELEMENT,l=new x.BufferViewVec3f64(aa.buffer,W*l,l,(W+g)*l),m=new Float64Array(T.buffer,3*W*T.BYTES_PER_ELEMENT,3*g),
g=new Float64Array(R.buffer,1*W*R.BYTES_PER_ELEMENT,1*g);H(ca,N,e,c,h.typedBuffer,m,l.typedBuffer,g,0,f,0,F,I,U);v.transformMat4(h,h,Q);v.transformMat3(l,l,Z);W+=6*b;c=da._createExtrudeGeometry(f,{positions:h.typedBuffer,elevation:m,normals:l.typedBuffer,heights:g},n);a=new A(c,q+"path"+a);a.singleUse=!0;G.push(a);D.push(da._material);M.push(p.mat4f64.create())},da=this,O=0;O<X.length;++O)B(O);if(0===G.length)return null;var ba=new C({geometries:G,materials:D,transformations:M,castShadow:!0,metadata:{layerUid:this._context.layer.uid,
graphicUid:y},idHint:q});ba.objectTransformation=b;var la=function(a){var c=z._context.stage.view.ensureEdgeView();c.removeObject(a);z._edgeStageObjects.delete(a);var b=z._createEdgeMaterial(c);f.isSome(b)&&(z._edgeStageObjects.add(a),c.addObject(a,[b],{slicePlaneEnabled:z._context.slicePlaneEnabled},!z._context.isAsync))};la(ba);y=new e(this,ba,G,null,null,function(a,b,d,e){a=a.stageObject;P.spatialReference=d.spatialReference;for(var f=a.getGeometryRecords(),g=f.length,h="absolute-height"!==b.mode,
l=0,k=a.objectTransformation,r=m.mat4.invert(p.mat4f64.create(),k),n=0;n<g;n++){var t=f[n].geometry;t.invalidateBoundingInfo();for(var q=t.data.getVertexAttr(),t=q[E.VertexAttrConstants.POSITION].data,x=q[E.VertexAttrConstants.SIZE].data,q=q.mapPos.data,y=t.length/3,w=0,v=0,z=!1,A=0,B=0;B<y;B++){P.x=q[v];P.y=q[v+1];P.z=q[v+2];V[0]=t[w];V[1]=t[w+1];V[2]=t[w+2];var C=u.computeElevation(d,P,b,e,h?L:null);h&&(A+=L.terrainElevation);c.vec3.set(K,t[w+0],t[w+1],t[w+2]);c.vec3.transformMat4(K,K,k);e.setAltitude(C+
x[w/3],K);c.vec3.transformMat4(K,K,r);t[w]=K[0];t[w+1]=K[1];t[w+2]=K[2];C=.01/e.unitInMeters;if(Math.abs(V[0]-t[w])>C||Math.abs(V[1]-t[w+1])>C||Math.abs(V[2]-t[w+2])>C)z=!0;v+=3;w+=3}z&&a.geometryVertexAttrsUpdated(n);l+=A/y}b=l/g;la(ba);return b},t);y.alignedTerrainElevation=g.terrainElevation;y.needsElevationUpdates=u.needsElevationUpdates3D(t.mode);return y};g.prototype._createExtrudeGeometry=function(a,c,b){for(var d=a.length,e=new Uint32Array(d),f=0;f<d;f++)e[f]=0;d={};f={};d[E.VertexAttrConstants.POSITION]=
a;d[E.VertexAttrConstants.NORMAL]=a;d[E.VertexAttrConstants.COLOR]=e;f[E.VertexAttrConstants.POSITION]={size:3,data:c.positions};f[E.VertexAttrConstants.NORMAL]={size:3,data:c.normals};f[E.VertexAttrConstants.COLOR]={size:4,data:b};f[E.VertexAttrConstants.SIZE]={size:1,data:c.heights};c.elevation&&(f.mapPos={size:3,data:c.elevation},d.mapPos=a);return new B(f,d)};g.prototype._createEdgeMaterial=function(a){var c={opacity:this._getLayerOpacity()};return y.createMaterial(a,this.symbolLayer,c)};return g}(t.default);
b.Graphics3DExtrudeSymbolLayer=q;var T=a.vec3f64.create(),R=a.vec3f64.create(),J=a.vec3f64.create(),U=a.vec3f64.create(),Q=a.vec3f64.create(),I=a.vec3f64.create(),V=a.vec3f64.create();b.default=q})},"esri/views/3d/layers/support/edgeUtils":function(){define("require exports ../../../../Color ../../../../core/compilerUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec4f64".split(" "),function(q,b,n,f,k,d,h){function m(b,c,a){if(k.isNone(c))return null;var l=
h.vec4f64.fromArray(n.toUnitRGBA(c.color));a=a.opacity;switch(c.type){case "solid":return b.createSolidEdgeMaterial({color:l,size:d.pt2px(c.size),extensionLength:d.pt2px(c.extensionLength),opacity:a});case "sketch":return b.createSketchEdgeMaterial({color:l,size:d.pt2px(c.size),extensionLength:d.pt2px(c.extensionLength),opacity:a});default:f.neverReached(c)}}Object.defineProperty(b,"__esModule",{value:!0});b.createMaterial=function(b,c,a){return m(b,c&&c.enabled&&c.edges||null,a)};b.createMaterialFromEdges=
m})},"esri/views/3d/support/buffer/math/vec3":function(){define(["require","exports","./common"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.transformMat4=function(b,k,d){if(b.count!==k.count)n.logger.error("source and destination buffers need to have the same number of elements");else{var f=b.count,m=d[0],p=d[1],c=d[2],a=d[4],l=d[5],g=d[6],e=d[8],u=d[9],t=d[10],r=d[12],q=d[13];d=d[14];var w=b.typedBuffer;b=b.typedBufferStride;var x=k.typedBuffer;k=k.typedBufferStride;for(var v=
0;v<f;v++){var z=v*b,A=v*k,B=x[A],C=x[A+1],A=x[A+2];w[z]=m*B+a*C+e*A+r;w[z+1]=p*B+l*C+u*A+q;w[z+2]=c*B+g*C+t*A+d}}};b.transformMat3=function(b,k,d){if(b.count!==k.count)n.logger.error("source and destination buffers need to have the same number of elements");else{var f=b.count,m=d[0],p=d[1],c=d[2],a=d[3],l=d[4],g=d[5],e=d[6],u=d[7];d=d[8];var t=b.typedBuffer;b=b.typedBufferStride;var r=k.typedBuffer;k=k.typedBufferStride;for(var q=0;q<f;q++){var w=q*b,x=q*k,v=r[x],z=r[x+1],x=r[x+2];t[w]=m*v+a*z+e*
x;t[w+1]=p*v+l*z+u*x;t[w+2]=c*v+g*z+d*x}}};b.scale=function(b,k,d){var f=Math.min(b.count,k.count),m=b.typedBuffer;b=b.typedBufferStride;var p=k.typedBuffer;k=k.typedBufferStride;for(var c=0;c<f;c++){var a=c*b,l=c*k;m[a]=d*p[l];m[a+1]=d*p[l+1];m[a+2]=d*p[l+2]}}})},"esri/views/3d/support/buffer/math/common":function(){define(["require","exports","../../../../../core/Logger"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.logger=n.getLogger("esri.views.3d.support.buffer.math")})},
"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/has ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/buffer/InterleavedLayout ../lib/GLMaterialTexture ../lib/Material ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ./internal/MaterialUtil ./renderers/HardwareInstancedRenderer ./renderers/MergedRenderer ../shaders/DefaultPrograms ../../../webgl/renderState".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w){function x(a,c){var b=c.vvSizeEnabled;c.vvSizeEnabled?(a.setUniform3fv("vvSizeMinSize",c.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",c.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",c.vvSizeOffset),a.setUniform3fv("vvSizeFactor",c.vvSizeFactor)):b&&a.setUniform3fv("vvSizeValue",c.vvSizeValue);b&&(a.setUniform3fv("vvSymbolAnchor",c.vvSymbolAnchor),a.setUniformMatrix3fv("vvSymbolRotationMatrix",c.vvSymbolRotationMatrix));c.vvColorEnabled&&(a.setUniform1fv("vvColorValues",
c.vvColorValues),a.setUniform4fv("vvColorColors",c.vvColorColors))}var v=l.assert;q=function(a){function c(b,d){d=a.call(this,d)||this;d.supportsEdges=!0;d.params=u.copyParameters(b,F);d.vertexBufferLayout=c.getVertexBufferLayout(d.params);d.instanceBufferLayout=b.instanced?c.getInstanceBufferLayout(d.params):null;d.textureMode=d.vertexBufferLayout.hasField("uv0")?"Textured":"none";return d}n(c,a);c.prototype.isVisibleInPass=function(a){return 3===a?this.params.castShadows:!0};c.prototype.isVisible=
function(){var c=this.params;if(!a.prototype.isVisible.call(this)||0===c.layerOpacity)return!1;var b=c.instanced,d=c.vertexColors,e=c.symbolColors,b=!!b&&-1<b.indexOf("color"),f=c.vvColorEnabled,g="replace"===c.colorMixMode,h=0<c.opacity,c=c.externalColor&&0<c.externalColor[3];return d&&(b||f||e)?g?!0:h:d?g?c:h:b||f||e?g?!0:h:g?c:h};c.prototype.setParameterValues=function(a){var c=this.params,b;for(b in a)"instanced"===b&&v(a.instanced===c.instanced,"Can not change instanced attributes"),"textureId"===
b&&v(c.textureId,"Can only change texture of material that already has a texture"),"vertexColors"===b&&!0===a[b]&&a[b]!==c[b]&&v(c.vertexColors,"Can not enable vertex colors after DefaultMaterial creation"),c[b]=a[b];this.notifyDirty("matChanged")};c.prototype.getParameters=function(){return this.params};c.prototype.intersect=function(a,c,b,d,e,f,g,l){if(null!==this.params.verticalOffset){l=d.camera;h.vec3.set(L,b[12],b[13],b[14]);var m=h.vec3.subtract(T,L,l.eye),k=h.vec3.length(m),p=h.vec3.scale(m,
m,1/k),r=null,m=null;switch(d.viewingMode){case "global":m=h.vec3.normalize(N,L);break;case "local":m=h.vec3.copy(N,O)}this.params.screenSizePerspective&&(r=h.vec3.dot(m,p));l=u.verticalOffsetAtDistance(l,k,this.params.verticalOffset,r,this.params.screenSizePerspective);h.vec3.scale(m,m,l);h.vec3.transformMat3(P,m,d.transform.inverseRotation);e=h.vec3.subtract(K,e,P);f=h.vec3.subtract(M,f,P)}u.intersectTriangleGeometry(a,c,b,d,e,f,g)};c.prototype.getGLMaterials=function(){return{color:z,depthShadowMap:B,
normal:C,depth:A,highlight:E}};c.prototype.getAllTextureIds=function(){var a=[];this.params.textureId&&a.push(this.params.textureId);this.params.normalTextureId&&a.push(this.params.normalTextureId);return[]};c.prototype.createRenderer=function(a,c){return this.params.instanced&&0<this.params.instanced.length?new t(a,c,this):new r(a,c,this)};c.prototype.createBufferWriter=function(){return new H(this.vertexBufferLayout,this.instanceBufferLayout)};c.getVertexBufferLayout=function(a){var c=p.newLayout().vec3f("position").vec3f("normal");
a.vertexTangents&&c.vec4f("aTangent");a.textureId&&c.vec2f("uv0");a.vertexColors&&c.vec4u8("color");a.symbolColors&&c.vec4u8("symbolColor");return c};c.getInstanceBufferLayout=function(a){var c=p.newLayout(),c=a.instancedDoublePrecision?c.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):c.mat4f("model").mat4f("modelNormal");a.instanced&&-1<a.instanced.indexOf("color")&&(c=c.vec4f("instanceColor"));a.instanced&&-1<a.instanced.indexOf("featureAttribute")&&(c=c.vec4f("instanceFeatureAttribute"));
return c};return c}(a);var z=function(a){function c(c,b,d){var e=this,f=c.getParameters(),e=a.call(this,c,b,d,f.textureId,f.normalTextureId,f.textureInitTransparent)||this;e.params=u.copyParameters(f);b=e.params;e.slot=b.transparent?b.writeDepth?6:9:4;e.textureMode=c.textureMode;c=b.instanced;e.instanced=!!c;e.instancedColor=!!c&&-1<c.indexOf("color");e._createPrograms();e.selectPipeline();return e}n(c,a);c.prototype._createPrograms=function(){var a=this;this.programs=e.BindParametersMap.create(this.params,
function(c){return a._createProgram(c)})};c.prototype._createProgram=function(a){var c=this.params;return this.programRep.getProgram(y.colorPass,{treeRendering:!!c.treeRendering,textureMode:this.textureMode,normalTexture:!!c.normalTextureId,tangents:c.vertexTangents?"vertex":"none",vertexColors:c.vertexColors,symbolColors:c.symbolColors,flipV:c.flipV,doubleSided:c.doubleSided&&"normal"===c.doubleSidedType,windowOrderDoubleSided:c.doubleSided&&"winding-order"===c.doubleSidedType,instanced:!!this.instanced,
instancedDoublePrecision:c.instancedDoublePrecision,instancedColor:this.instancedColor,receiveShadows:a.receiveShadows,receiveSSAO:a.receiveSSAO,vvSize:c.vvSizeEnabled,vvColor:c.vvColorEnabled,verticalOffset:null!==c.verticalOffset,screenSizePerspective:null!==c.screenSizePerspective,slice:c.slicePlaneEnabled,normals:c.normals,textureAlphaMode:c.textureAlphaMode,textureAlphaPremultiplied:!!c.textureAlphaPremultiplied,iosSafariFix:G})};c.prototype.selectPipeline=function(){var a=this.params;this.pipelineState=
w.makePipelineState({blending:a.transparent&&w.separateBlendingParams(770,1,771,771),culling:D(a),depthTest:{func:513},depthWrite:a.writeDepth&&w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams})};c.prototype.beginSlot=function(a){return a===this.slot};c.prototype.getProgram=function(){return this.program||this.getPrograms()[0]};c.prototype.getPrograms=function(){return e.BindParametersMap.programs(this.programs)};c.prototype.updateParameters=function(){this.params=u.copyParameters(this.material.getParameters());
this.slot=this.params.transparent?this.params.writeDepth?6:9:4;this.updateTexture(this.params.textureId);this._createPrograms();this.selectPipeline()};c.prototype.bind=function(a,c){var b=this.params,d=this.program=e.BindParametersMap.lookup(this.programs,c);a.bindProgram(d);a.setPipelineState(this.pipelineState);d.setUniform3fv("ambient",b.ambient);d.setUniform3fv("diffuse",b.diffuse);d.setUniform3fv("specular",b.specular);d.setUniform4fv("externalColor",b.externalColor);d.setUniform1i("colorMixMode",
u.colorMixModes[b.colorMixMode]);d.setUniform1f("opacity",b.opacity);d.setUniform1f("layerOpacity",b.layerOpacity);u.bindVerticalOffset(b.verticalOffset,c,d);u.bindScreenSizePerspective(b.screenSizePerspective,d);x(d,b);this.bindTexture(a,d);"none"!==this.textureMode&&this.bindTextureSize(a,d);"mask"!==b.textureAlphaMode&&"maskBlend"!==b.textureAlphaMode||d.setUniform1f("textureAlphaCutoff",b.textureAlphaCutoff)};c.prototype.release=function(a,c){};c.prototype.bindView=function(a,c){a=this.program=
e.BindParametersMap.lookup(this.programs,c);var b=this.params,d=b.instancedDoublePrecision?m.vec3f64.fromValues(c.viewInvTransp[3],c.viewInvTransp[7],c.viewInvTransp[11]):c.origin;u.bindView(d,c.view,a);u.bindCamPos(d,c.viewInvTransp,a);b.instancedDoublePrecision&&u.bindViewOriginDouble(d,a);b.slicePlaneEnabled&&u.bindSlicePlane(d,c.slicePlane,a);c.shadowMappingEnabled&&c.shadowMap.bindView(a,d)};c.prototype.bindInstance=function(a,c){a=this.program;a.setUniformMatrix4fv("model",c.transformation);
a.setUniformMatrix4fv("modelNormal",c.transformationNormal)};c.prototype.getDrawMode=function(){return 4};return c}(c),A=function(a){function c(c,b,d,e){void 0===e&&(e=!1);b=a.call(this,c,b,d,c.getParameters().textureId)||this;b.textureMode=c.textureMode;b.biased=e;b.updateParameters();return b}n(c,a);c.prototype.beginSlot=function(a){return a===this.slot};c.prototype.getProgram=function(){return this.program};c.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(y.depthPass,
{textureMode:this.textureMode,normalTexture:!!a.normalTextureId,tangents:a.vertexTangents?"vertex":"none",flipV:a.flipV,instanced:!!a.instanced,instancedDoublePrecision:a.instancedDoublePrecision,shadowMap:this.biased,vvSize:a.vvSizeEnabled,verticalOffset:null!==a.verticalOffset,screenSizePerspective:null!==a.screenSizePerspective,slice:a.slicePlaneEnabled,textureAlphaMode:a.textureAlphaMode,normals:a.normals,iosSafariFix:G});this.pipelineState=w.makePipelineState({culling:D(a),depthTest:{func:513},
depthWrite:a.writeDepth&&w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams})};c.prototype.selectSlot=function(){this.slot=this.params.transparent?this.params.writeDepth?6:9:4};c.prototype.updateParameters=function(){this.params=u.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};c.prototype.bind=function(a,c){var b=this.program,d=this.params;a.bindProgram(b);a.setPipelineState(this.pipelineState);b.setUniform2fv("nearFar",
c.nearFar);u.bindVerticalOffset(d.verticalOffset,c,b);u.bindScreenSizePerspective(d.screenSizePerspective,b);x(b,d);"mask"!==d.textureAlphaMode&&"maskBlend"!==d.textureAlphaMode||b.setUniform1f("textureAlphaCutoff",d.textureAlphaCutoff);this.bindTexture(a,b)};c.prototype.release=function(a){};c.prototype.bindView=function(a,c){a=this.program;var b=this.params,d=b.instancedDoublePrecision?m.vec3f64.fromValues(c.viewInvTransp[3],c.viewInvTransp[7],c.viewInvTransp[11]):c.origin;u.bindView(d,c.view,a);
b.slicePlaneEnabled&&u.bindSlicePlane(d,c.slicePlane,a);b.screenSizePerspective&&u.bindCamPos(d,c.viewInvTransp,a);b.instancedDoublePrecision&&u.bindViewOriginDouble(d,a)};c.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",c.transformation)};c.prototype.getDrawMode=function(){return 4};return c}(c),B=function(a){function c(c,b,d){return a.call(this,c,b,d,!0)||this}n(c,a);return c}(A),C=function(a){function c(c,b,d){b=a.call(this,c,b,d,c.getParameters().textureId)||this;
b.params=u.copyParameters(c.getParameters());b.textureMode=c.textureMode;b.selectProgram();b.selectSlot();return b}n(c,a);c.prototype.beginSlot=function(a){return a===this.slot};c.prototype.getProgram=function(){return this.program};c.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(y.normalPass,{textureMode:this.textureMode,normalTexture:!!a.normalTextureId,tangents:a.vertexTangents?"vertex":"none",flipV:a.flipV,instanced:!!a.instanced,instancedDoublePrecision:a.instancedDoublePrecision,
vvSize:a.vvSizeEnabled,verticalOffset:null!==a.verticalOffset,screenSizePerspective:null!==a.screenSizePerspective,slice:a.slicePlaneEnabled,textureAlphaMode:a.textureAlphaMode,normals:a.normals,iosSafariFix:G});this.pipelineState=w.makePipelineState({culling:D(a),depthTest:{func:513},depthWrite:a.writeDepth&&w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams})};c.prototype.selectSlot=function(){this.slot=this.params.transparent?this.params.writeDepth?6:9:4};c.prototype.updateParameters=
function(){this.params=u.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};c.prototype.bind=function(a,c){var b=this.program,d=this.params;a.bindProgram(b);a.setPipelineState(this.pipelineState);this.bindTexture(a,b);u.bindVerticalOffset(d.verticalOffset,c,b);u.bindScreenSizePerspective(d.screenSizePerspective,b);x(b,d);"mask"!==d.textureAlphaMode&&"maskBlend"!==d.textureAlphaMode||b.setUniform1f("textureAlphaCutoff",d.textureAlphaCutoff)};
c.prototype.release=function(a){};c.prototype.bindView=function(a,c){a=this.program;var b=this.params,d=b.instancedDoublePrecision?m.vec3f64.fromValues(c.viewInvTransp[3],c.viewInvTransp[7],c.viewInvTransp[11]):c.origin;u.bindView(d,c.view,a);a.setUniformMatrix4fv("viewNormal",c.viewInvTransp);b.slicePlaneEnabled&&u.bindSlicePlane(d,c.slicePlane,a);b.screenSizePerspective&&u.bindCamPos(d,c.viewInvTransp,a);b.instancedDoublePrecision&&u.bindViewOriginDouble(d,a)};c.prototype.bindInstance=function(a,
c){a=this.program;a.setUniformMatrix4fv("model",c.transformation);a.setUniformMatrix4fv("modelNormal",c.transformationNormal)};c.prototype.getDrawMode=function(){return 4};return c}(c),E=function(a){function c(c,b,d){b=a.call(this,c,b,d,c.getParameters().textureId)||this;b.textureMode=c.textureMode;b.updateParameters();return b}n(c,a);c.prototype.beginSlot=function(a){return a===this.slot};c.prototype.getProgram=function(){return this.program};c.prototype.selectProgram=function(){var a=this.params;
this.program=this.programRep.getProgram(y.highlightPass,{textureMode:this.textureMode,normalTexture:!!a.normalTextureId,tangents:a.vertexTangents?"vertex":"none",flipV:a.flipV,instanced:!!a.instanced,instancedDoublePrecision:a.instancedDoublePrecision,vvSize:a.vvSizeEnabled,verticalOffset:null!==a.verticalOffset,screenSizePerspective:null!==a.screenSizePerspective,slice:a.slicePlaneEnabled,textureAlphaMode:a.textureAlphaMode,normals:a.normals,iosSafariFix:G});this.pipelineState=w.makePipelineState({culling:D(a),
depthTest:{func:513},depthWrite:a.writeDepth&&w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams})};c.prototype.selectSlot=function(){this.slot=this.params.transparent?this.params.writeDepth?6:9:4};c.prototype.updateParameters=function(){this.params=u.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};c.prototype.bind=function(a,c){var b=this.program,d=this.params;a.bindProgram(b);a.setPipelineState(this.pipelineState);
u.bindHighlightRendering(a,c,b);this.bindTexture(a,b);u.bindVerticalOffset(d.verticalOffset,c,b);u.bindScreenSizePerspective(d.screenSizePerspective,b);x(b,d);"mask"!==d.textureAlphaMode&&"maskBlend"!==d.textureAlphaMode||b.setUniform1f("textureAlphaCutoff",d.textureAlphaCutoff)};c.prototype.release=function(a){};c.prototype.bindView=function(a,c){a=this.program;var b=this.params,d=b.instancedDoublePrecision?m.vec3f64.fromValues(c.viewInvTransp[3],c.viewInvTransp[7],c.viewInvTransp[11]):c.origin;
u.bindView(d,c.view,a);b.slicePlaneEnabled&&u.bindSlicePlane(d,c.slicePlane,a);b.screenSizePerspective&&u.bindCamPos(d,c.viewInvTransp,a);b.instancedDoublePrecision&&u.bindViewOriginDouble(d,a)};c.prototype.bindInstance=function(a,c){a=this.program;a.setUniformMatrix4fv("model",c.transformation);a.setUniformMatrix4fv("modelNormal",c.transformationNormal)};c.prototype.getDrawMode=function(){return 4};return c}(c);(q||(q={})).COLOR_GAMMA=2.1;var F={textureId:void 0,textureInitTransparent:!1,normalTextureId:void 0,
vertexTangents:!1,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,
1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:d.mat3f64.create(),transparent:!1,writeDepth:!0,textureAlphaMode:"blend",textureAlphaCutoff:.1,textureAlphaPremultiplied:!1},H=function(){function a(a,c){this.vertexBufferLayout=a;this.instanceBufferLayout=c}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=
function(a){return a.indices.position.length};a.prototype.write=function(a,c,b,d,e){g.writeDefaultAttributes(c,b,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,d,e)};return a}(),D=function(a){var c;c=a.slicePlaneEnabled?!1:a.cullFace?"none"!==a.cullFace:!a.transparent&&!a.doubleSided;return c&&{face:"front"===a.cullFace?1028:1029,mode:2305}},G=!!k("ios")&&!!k("safari"),K=m.vec3f64.create(),M=m.vec3f64.create(),O=m.vec3f64.fromValues(0,0,1),N=m.vec3f64.create(),P=m.vec3f64.create(),
L=m.vec3f64.create(),T=m.vec3f64.create();return q})},"esri/views/3d/webgl-engine/materials/renderers/HardwareInstancedRenderer":function(){define("require exports ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../support/buffer/BufferView ../../../support/buffer/glUtil ../../lib/DefaultVertexAttributeLocations ../../lib/InstanceBufferData ./utils ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),function(q,b,n,f,k,d,h,m,p,c,a){function l(a,
c){var b=new Map,d=function(a,c){var d=a.origin.id,e=a.data.id,f=b.get(d);f||(f={origin:a.origin.vec3,deltaByGeometry:new Map},b.set(d,f));d=f.deltaByGeometry.get(e);d||(d={renderData:a.data,toAdd:[],toRemove:[]},f.deltaByGeometry.set(e,d));(c?d.toAdd:d.toRemove).push(a)};a.forEach(function(a){d(a,!0)});c.forEach(function(a){d(a,!1)});return b}function g(a,c,b){var d=c.elementCount(a),d=c.allocate(d);c.write({},a,null,d,0);b.setData(d.buffer)}var e=function(){function c(c,b,e,f,g){void 0===g&&(g=
0);this.data=new h(e,g);this.instanceBuffer=p.createVertex(c,35044);this.vao=new a(c,d.Default3D,{geometry:k.glLayout(b),instance:k.glLayout(e,{divisor:1})},{geometry:f,instance:this.instanceBuffer})}c.prototype.dispose=function(){this.vao.dispose(!1);this.instanceBuffer.dispose()};Object.defineProperty(c.prototype,"count",{get:function(){return this.data.getCount()},enumerable:!0,configurable:!0});c.prototype.has=function(a){return this.data.hasSlot(a.idx)};c.prototype.prepareAdd=function(a){this.data.prepareAllocate(a)};
c.prototype.add=function(a){var c=this.data.allocate(a.idx);this.writeInstance(a,c)};c.prototype.prepareRemove=function(a){this.data.prepareFree(a)};c.prototype.remove=function(a){this.data.free(a.idx)};c.prototype.updateTransform=function(a,c){void 0===c&&(c=!0);var b=this.data.getSlot(a.idx);null!=b&&(this.writeTransform(a,b),c&&this.uploadSlot(b))};c.prototype.uploadAll=function(){this.data.compact();this.instanceBuffer.setData(this.data.getBuffer().buffer)};c.prototype.uploadSlot=function(a){var c=
this.data,b=c.layout.stride;a*=b;this.instanceBuffer.setSubData(c.getBuffer().buffer,a,a,a+b)};c.prototype.instanceBufferView=function(){var a=this.data.getBuffer();this._buffer!==a&&(this._bufferView={transformation:a.getField("model",f.BufferViewMat4f),transformationNormal:a.getField("modelNormal",f.BufferViewMat4f),instanceColor:a.getField("instanceColor",f.BufferViewVec4f),instanceFeatureAttribute:a.getField("instanceFeatureAttribute",f.BufferViewVec4f)});return this._bufferView};c.prototype.writeTransform=
function(a,c){var b=this.instanceBufferView();m.calculateTransformRelToOrigin(a,u,t);b.transformation.setMat(c,u);b.transformationNormal.setMat(c,t)};c.prototype.writeInstance=function(a,c){var b=this.instanceBufferView();m.calculateTransformRelToOrigin(a,u,t);b.transformation.setMat(c,u);b.transformationNormal.setMat(c,t);b.instanceColor&&b.instanceColor.setVec(c,a.instanceParameters.color);b.instanceFeatureAttribute&&b.instanceFeatureAttribute.setVec(c,a.instanceParameters.featureAttribute)};return c}();
q=function(){function a(a,c,b){this._dataByOrigin=new Map;this._highlightCount=0;this._instanceDataToUploadCache=new Set;this._rctx=a;this._material=b;this._materialRep=c;this._glMaterials=m.acquireMaterials(this._material,this._materialRep);this._bufferWriter=b.createBufferWriter()}a.prototype.dispose=function(){m.releaseMaterials(this._material,this._materialRep)};Object.defineProperty(a.prototype,"isEmpty",{get:function(){return 0===this._dataByOrigin.size},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"hasHighlights",{get:function(){return 0<this._highlightCount},enumerable:!0,configurable:!0});a.prototype.renderPriority=function(){return this._material.renderPriority};a.prototype.modify=function(a){this.updateGeometries(a.toUpdate);this.addAndRemoveGeometries(a.toAdd,a.toRemove);this.updateHighlightCount()};a.prototype.addAndRemoveGeometries=function(a,c){var b=this._rctx,d=this._bufferWriter,f=this._dataByOrigin;a=l(a,c);var h=d.vertexBufferLayout,k=d.instanceBufferLayout;a.forEach(function(a,
c){var l=f.get(c);l||(l={origin:a.origin,highlightCount:0,dataByGeometry:new Map},f.set(c,l));a.deltaByGeometry.forEach(function(a,c){var f=l.dataByGeometry.get(c);!f&&0<a.toAdd.length&&(f=p.createVertex(b,35044),g(a.renderData,d,f),f={count:0,vertexBuffer:f,instanceData:new e(b,h,k,f,a.toAdd.length),highlightInstanceData:new e(b,h,k,f)},l.dataByGeometry.set(c,f));var r=f.instanceData,n=f.highlightInstanceData;r.prepareAdd(a.toAdd.length);a.toAdd.forEach(function(a){m.isRenderGeometryHidden(a)||(r.add(a),
m.doesRenderGeometryHaveHighlights(a)&&(n.add(a),l.highlightCount=null))});r.prepareRemove(a.toRemove.length);a.toRemove.forEach(function(a){r.remove(a);n.remove(a)});a.toAdd.length+a.toRemove.length&&(r.uploadAll(),n.uploadAll());f.count+=a.toAdd.length;f.count-=a.toRemove.length;0===f.count&&(f.instanceData.dispose(),f.highlightInstanceData.dispose(),f.vertexBuffer.dispose(),l.dataByGeometry.delete(c))});0===l.dataByGeometry.size&&f.delete(c)})};a.prototype.updateGeometries=function(a){var c=this._dataByOrigin,
b=this._bufferWriter;this._instanceDataToUploadCache.clear();var d=this._instanceDataToUploadCache;a.forEach(function(a){var e=a.updateType;a=a.renderGeometry;var f=c.get(a.origin.id),h=f&&f.dataByGeometry.get(a.data.id);if(h){var l=h.instanceData,k=h.highlightInstanceData,p=e&1;p&&(m.isRenderGeometryHidden(a)?(l.remove(a),d.add(l),k.has(a)&&(k.remove(a),d.add(k))):l.has(a)||(l.add(a),d.add(l),m.doesRenderGeometryHaveHighlights(a)&&!k.has(a)&&(k.add(a),d.add(k))));if(l=e&16)m.doesRenderGeometryHaveHighlights(a)?
k.has(a)||(k.add(a),d.add(k)):(k.remove(a),d.add(k)),f.highlightCount=null;e&2&&g(a.data,b,h.vertexBuffer);e&4&&(h.instanceData.updateTransform(a,!p),h.highlightInstanceData.updateTransform(a,!l))}});d.forEach(function(a){a.uploadAll()})};a.prototype.updateHighlightCount=function(){var a=this;this._highlightCount=0;this._dataByOrigin.forEach(function(c){if(null==c.highlightCount){var b=0;c.dataByGeometry.forEach(function(a){b+=a.highlightInstanceData.count});c.highlightCount=b}a._highlightCount+=
c.highlightCount})};a.prototype.render=function(a,b,d,e){var f=this._rctx,g=f.capabilities.instancing,h=this._glMaterials.get(b.pass),l=4===b.pass;if(!h||null!=a&&!h.beginSlot(a)||l&&0===this._highlightCount)return!1;var k=h.getProgram(),m=h.getDrawMode();h.bind(f,d);var p=!1;this._dataByOrigin.forEach(function(a){l&&0===a.highlightCount||(d.origin=a.origin,h.bindView(f,d),a.dataByGeometry.forEach(function(a){var b=l?a.highlightInstanceData:a.instanceData;a=b.count;l&&0===a||(b=b.vao,c.assertCompatibleVertexAttributeLocations(b,
k),f.bindVAO(b),b=c.vertexCount(b,"geometry"),g.drawArraysInstanced(m,0,b,a),e&&(e.drawCallsInstanced++,4===m&&(e.triangles+=b/3*a)),p=!0)}))});f.bindVAO(null);h.release(f,d);return p};return a}();var u=n.mat4f64.create(),t=n.mat4f64.create();return q})},"esri/views/3d/webgl-engine/lib/InstanceBufferData":function(){define(["require","exports","../../../../core/mathUtils"],function(q,b,n){return function(){function b(b,d){void 0===d&&(d=0);this.count=this.capacity=0;this.emptySlots=[];this.emptySlotCount=
0;this.id2slot=new Map;this.slot2id=[];this.layout=b;this.resize(d)}b.prototype.prepareAllocate=function(b){b=this.count+b;b>this.capacity&&this.resize(b)};b.prototype.allocate=function(b){this.count>=this.capacity&&this.resize(this.count+1);var d=0<this.emptySlotCount?this.emptySlots[--this.emptySlotCount]:this.count;this.id2slot.set(b,d);this.slot2id[d]=b;this.count++;return d};b.prototype.prepareFree=function(b){this.emptySlots.length+=b};b.prototype.free=function(b){var d=this.id2slot.get(b);
null!=d&&(this.emptySlots.length<=this.emptySlotCount&&(this.emptySlots.length=this.emptySlotCount+1),this.emptySlots[this.emptySlotCount++]=d,this.id2slot.delete(b),this.slot2id[d]=null,this.count--)};b.prototype.getCount=function(){return this.count};b.prototype.getSlot=function(b){return this.id2slot.get(b)};b.prototype.hasSlot=function(b){return this.id2slot.has(b)};b.prototype.getBuffer=function(){return this.buffer};b.prototype.compact=function(){if(0<this.emptySlotCount){var b=this.emptySlots,
d=this.emptySlotCount,f=this.count+d;b.length=d;for(b.sort(function(a,c){return a-c});0<d;){if(b[d-1]!==f-1){var m=f-1,p=b[d-1];this.buffer.copyFrom(this.buffer,m,p,1);var c=this.slot2id[m];this.slot2id[m]=null;this.slot2id[p]=c;this.id2slot.set(c,p)}d--;f--}}this.emptySlotCount=0;this.emptySlots.length=0;this.resize(this.count)};b.prototype.resize=function(b){var d=this.capacity;b=Math.max(0,b);0<b&&(b=n.nextHighestPowerOfTwo(b));if(b>d){var f=this.layout.createBuffer(b);this.buffer&&f.copyFrom(this.buffer,
0,0,d);this.buffer=f}else b<d&&(f=this.layout.createBuffer(b),f.copyFrom(this.buffer,0,0,b),this.buffer=f);this.buffer||(this.buffer=this.layout.createBuffer(0));this.capacity=b;this.slot2id.length=b};return b}()})},"esri/views/3d/webgl-engine/shaders/DefaultPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});var d=function(b){return k.glslifyDefineMap({TEXTURING:"none"!==
b.textureMode,TEXTURE_ATLAS:"AtlasTextured"===b.textureMode,VERTEXCOLORS:b.vertexColors,SYMBOLVERTEXCOLORS:b.symbolColors,FLIPV:b.flipV,DOUBLESIDED:b.doubleSided,WINDINGORDERDOUBLESIDED:b.windowOrderDoubleSided,INSTANCED:b.instanced,INSTANCED_DOUBLE_PRECISION:b.instancedDoublePrecision,INSTANCEDCOLOR:b.instancedColor,RECEIVE_SHADOWS:b.receiveShadows,RECEIVE_SSAO:b.receiveSSAO,VV_SIZE:b.vvSize,VV_COLOR:b.vvColor,VERTICAL_OFFSET:b.verticalOffset,SCREEN_SIZE_PERSPECTIVE:b.screenSizePerspective,SLICE:b.slice,
GROUND_NORMAL_SHADING:b.groundNormalShading,NORMALS:{value:b.normals,options:{default:"NORMALS_DEFAULT",compressed:"NORMALS_COMPRESSED",screenDerivative:"NORMALS_SCREEN_DERIVATIVE"}},COMPONENTCOLORS:b.componentColor,TEXTURE_ALPHA_MODE_MASK:"mask"===b.textureAlphaMode,TEXTURE_ALPHA_MODE_MASK_BLEND:"maskBlend"===b.textureAlphaMode,TEXTURE_ALPHA_MODE_OPAQUE:"opaque"===b.textureAlphaMode,BIAS_SHADOWMAP:b.shadowMap,VERTEX_TANGENTS:"vertex"===b.tangents,TEXTURE_NORMALS:!!b.normalTexture,TEXTURE_COORDINATES:!!b.normalTexture||
"none"!==b.textureMode,TREE_RENDERING:b.treeRendering,IOS_SAFARI_FIX:b.iosSafariFix,TEXTURE_ALPHA_PREMULTIPLIED:!!b.textureAlphaPremultiplied})};b.colorPass={name:"default-color",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("materials/defaultMaterial/colorPass.vert"),fragmentShader:d(b)+f.resolveIncludes("materials/defaultMaterial/colorPass.frag")}},attributes:n.Default3D};b.depthPass={name:"default-depth",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("materials/defaultMaterial/depthPass.vert"),
fragmentShader:d(b)+f.resolveIncludes("materials/defaultMaterial/depthPass.frag")}},attributes:n.Default3D};b.normalPass={name:"default-normal",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("materials/defaultMaterial/normalPass.vert"),fragmentShader:d(b)+f.resolveIncludes("materials/defaultMaterial/normalPass.frag")}},attributes:n.Default3D};b.highlightPass={name:"default-highlight",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("materials/defaultMaterial/highlightPass.vert"),
fragmentShader:d(b)+f.resolveIncludes("materials/defaultMaterial/highlightPass.frag")}},attributes:n.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper dojo/errors/CancelError ../../../../Color ../../../../core/asyncUtils ../../../../core/compilerUtils ../../../../core/Error ../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./sdfPrimitives ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C,E,F,H,D,G,K,M,O,N,P,L,T,R){function J(a){return e.isSome(a)?"cross"===a||"x"===a:!1}Object.defineProperty(b,"__esModule",{value:!0});var U=y.mat4f64.create(),Q=x.vec3f64.fromValues(0,0,1),I=[0,0,0,0],V=x.vec3f64.fromValues(0,0,0),X=x.vec3f64.fromValues(1,1,1),W=[.25,.25,.75,.75],ca=[64,64];q=function(b){function q(a,c,d,f){a=b.call(this,a,c,d,f)||this;a._size=null;a._symbolTextureRatio=1;a._outlineSize=0;a._texture=null;a._drapedMaterial=
null;a._releaseTexture=null;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};if(!a._validate())return a;c=a._prepareMaterialParameters();d=a._getPrimitive();e.isSome(d)?a._prepareResourcesPrimitive(c,d):a._prepareResourcesHref(c);return a}f(q,b);q.prototype.getCachedSize=function(){return{size:this._getIconSize()}};q.prototype._validate=function(){if(this._isPropertyDriven("size"))return!0;var a=D.validateSymbolLayerSize(this._getIconSize());return a?(this._logWarning(a),this.reject(),
!1):!0};q.prototype._getIconSize=function(){var a=this.symbolLayer,a=Math.round(null!=a.size?t.pt2px(a.size):16);return this._isPropertyDriven("size")?Math.max(a,64):a};q.prototype._prepareMaterialParameters=function(){var a={anchorPos:this._getAnchorPos()},c=this.symbol;if(this._hasVisibleVerticalOffset(c)){var c=c.verticalOffset,b=c.minWorldLength,d=c.maxWorldLength;a.verticalOffset={screenLength:t.pt2px(c.screenLength),minWorldLength:b||0,maxWorldLength:null!=d?d:Infinity}}this._context.screenSizePerspectiveEnabled&&
(a.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);return a};q.prototype._prepareResourcesPrimitive=function(a,b){var d=this,e=this._getOutlineSize();if(J(b)&&0===e)this.reject();else{this._outlineSize=e;a.color=this._getFillColor();a.outlineColor=this._getOutlineColor();a.outlineSize=this._outlineSize;var f=this._context.sharedResources.textures.fromData(b,function(){var a;switch(b){case "circle":a=G.createCircle(128,64);break;case "square":a=G.createSquare(128,
64);break;case "kite":a=G.createKite(128,64);break;case "cross":a=G.createCross(128,64);break;case "x":a=G.createX(128,64);break;case "triangle":a=G.createTriangle(128,64);break;default:c.neverReached(b)}return new T(a,"sdf_"+b,{mipmap:!1,wrap:{s:33071,t:33071},width:128,height:128,components:4,noUnpackFlip:!0})});this._texture=f.texture;this._releaseTexture=function(){return d._context.sharedResources.textures.release(f.uid)};a.textureIsSignedDistanceField=!0;a.distanceFieldBoundingBox=W;a.textureId=
this._texture.id;e=this._getIconSize();this._size=[e,e];this._symbolTextureRatio=2;this._createMaterialsAndAddToStage(a,this._context.stage);this.resolve()}};q.prototype._prepareResourcesHref=function(c){return d(this,void 0,void 0,function(){var b,d,e,f,g,m,n,t,q,x,w=this;return k(this,function(k){switch(k.label){case 0:b=A.getIconHref(this.symbol,this.symbolLayer);if(!l("esri-canvas-svg-support")&&r.isSVG(b))return d="IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)",this._logWarning(d),
this.reject(new a("SVG Not Supported",d)),[2];this._outlineSize=this._getOutlineSize();c.color=this._getFillColor();c.outlineColor=this._getOutlineColor();c.outlineSize=this._outlineSize;c.textureIsSignedDistanceField=!1;e=this._getIconSize();f=e*this._context.layerView.view.pixelRatio;return[4,p.result(u.when(this._context.sharedResources.textures.fromUrl(b,f)))];case 1:g=k.sent();if(!1===g.ok)return g.error instanceof h?this.reject():(d="IconSymbol3DLayer failed to load (Request for icon resource failed: "+
b+")",this._logWarning(d),this.reject(new a("Request Failed",d))),[2];m=g.value;n=m.uid;t=m.texture;if(this.isRejected())return this._context.sharedResources.textures.release(n),[2];this._releaseTexture=function(){return w._context.sharedResources.textures.release(n)};q=t.params;x=q.width/q.height;this._size=1<x?[e,Math.round(e/x)]:[Math.round(e*x),e];c.textureId=t.id;this._createMaterialsAndAddToStage(c,this._context.stage);this.resolve();return[2]}})})};q.prototype._getPrimitive=function(){return this.symbolLayer.resource&&
this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||z.defaultPrimitive};q.prototype._getOutlineSize=function(){var a=0,a=this.symbolLayer;if(a.outline&&null!=a.outline.size)return Math.max(t.pt2px(a.outline.size),0);a=this._getPrimitive();a=J(a)?1.5:0;return Math.max(a,0)};q.prototype._getOutlineColor=function(){var a=this._getLayerOpacity(),c=this.symbolLayer;if(c.outline&&null!=c.outline.color){var b=m.toUnitRGB(c.outline.color);return[b[0],b[1],b[2],
c.outline.color.a*a]}return[0,0,0,a]};q.prototype._getFillColor=function(){return J(this._getPrimitive())?I:this._getMaterialOpacityAndColor()};q.prototype._getAnchorPos=function(){var a=this.symbolLayer.anchor,c=this.symbolLayer.anchorPosition;return"relative"===a?w.vec2f64.fromValues((c.x||0)+.5,-(c.y||0)+.5):a in D.namedAnchorToHUDMaterialAnchorPos?D.namedAnchorToHUDMaterialAnchorPos[a]:D.namedAnchorToHUDMaterialAnchorPos.center};q.prototype._createMaterialsAndAddToStage=function(a,c){this._fastUpdates=
K.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&g.mixin(a,this._fastUpdates.materialParameters);var b=n({},a);b.verticalOffset=null;b.screenSizePerspective=null;b.occlusionTest=!1;b.slicePlaneEnabled=!1;b.shaderPolygonOffset=0;var d=this._getStageIdHint();this._drapedMaterial=new R(b,d+"_iconDraped");c.add(O.ModelContentType.MATERIAL,this._drapedMaterial);a.occlusionTest=!0;a.slicePlaneEnabled=this._context.slicePlaneEnabled;
this._material=new R(a,d+"_icon");c.add(O.ModelContentType.MATERIAL,this._material)};q.prototype.destroy=function(){b.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(O.ModelContentType.MATERIAL,this._material.id),this._material=null);this._drapedMaterial&&(this._context.stage.remove(O.ModelContentType.MATERIAL,this._drapedMaterial.id),this._drapedMaterial=null);this._releaseTexture&&(this._releaseTexture(),this._releaseTexture=null)};q.prototype._getScaleFactor=
function(a){if(this._isPropertyDriven("size")&&a.size){for(var c=0;3>c;c++){var b=a.size[c];b&&"symbolValue"!==b&&"proportional"!==b&&(a.size[c]=t.pt2px(b))}c=this._size[0]>this._size[1]?this._size[0]:this._size[1];if("symbolValue"===a.size[0])return 1;if(isFinite(+a.size[0]))return+a.size[0]/c;if(isFinite(+a.size[2]))return+a.size[2]/c}return 1};q.prototype.createGraphics3DGraphic=function(a){var c=a.renderingInfo,b=a.graphic;if(!this._validateGeometry(b.geometry))return null;var d=F.placePointOnGeometry(b.geometry);
if(!d)return this._logWarning("unsupported geometry type for icon symbol: "+b.geometry.type),null;var e="graphic"+b.uid,f=this._getVertexOpacityAndColor(c),g=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(g=this._getScaleFactor(c));g*=this._symbolTextureRatio;c=[this._size[0]*g,this._size[1]*g];g=this.getGraphicElevationContext(b);return"on-the-ground"===g.mode?this._createAsOverlay(b,d,f,c,g,e,b.uid,a.layer.uid):this._createAs3DShape(b,d,f,c,g,e,b.uid)};q.prototype.layerOpacityChanged=
function(){var a=this._getFillColor();this._drapedMaterial.setParameterValues({color:a});this._material.setParameterValues({color:a});a=this._getOutlineColor();this._drapedMaterial.setParameterValues({outlineColor:a});this._material.setParameterValues({outlineColor:a});return!0};q.prototype.layerElevationInfoChanged=function(a,c,b){var d=this._elevationContext.mode;if("on-the-ground"===b&&"on-the-ground"===d)return!0;if(b!==d&&("on-the-ground"===b||"on-the-ground"===d))return!1;var e=F.needsElevationUpdates2D(d)||
"absolute-height"===d;return this.updateGraphics3DGraphicElevationInfo(a,c,function(){return e})};q.prototype.slicePlaneEnabledChanged=function(a,c){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};q.prototype.pixelRatioChanged=function(a,c){return this._getPrimitive()?!0:!1};q.prototype.applyRendererDiff=function(a,c){for(var b in a.diff)switch(b){case "visualVariables":if(K.updateFastSymbolUpdatesState(this._fastUpdates,c,this._fastVisualVariableConvertOptions()))this._material.setParameterValues(this._fastUpdates.materialParameters),
this._drapedMaterial.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};q.prototype.setDrawOrder=function(a,c,b){this.updateSymbolLayerOrder(a,c);this._drapedMaterial&&(this._drapedMaterial.renderPriority=a,b.add(this._drapedMaterial.id))};q.prototype._defaultElevationInfoNoZ=function(){return da};q.prototype._createAs3DShape=function(a,c,b,d,e,f,g){var h=this,l=this.getFastUpdateAttrValues(a);a=l?function(a){return K.evaluateModelTransform(h._fastUpdates.materialParameters,
l,a)}:null;b=P.createPointGeometry(Q,null,b,d,ba,null,l);b=[new N(b,f)];f=F.createStageObjectForPoint(this._context,c,b,[this._material],null,null,e,f,this._context.layer.uid,g,!0,a);if(null===f)return null;var m=new E(this,f.object,b,null,null,B.perObjectElevationAligner,e);m.alignedTerrainElevation=f.terrainElevation;m.needsElevationUpdates=F.needsElevationUpdates2D(e.mode)||"absolute-height"===e.mode;m.getScreenSize=this._createScreenSizeGetter(d,a);m.calculateRelativeScreenBounds=function(a){return h._material.calculateRelativeScreenBounds(m.getScreenSize(),
1,a)};F.extendPointGraphicElevationContext(m,c,this._context.elevationProvider);return m};q.prototype._createAsOverlay=function(a,c,b,d,e,f,g,h){var l=this;this._drapedMaterial.renderPriority=this._symbolLayerOrder;e=x.vec3f64.create();M.pointToVector(c,e,this._context.overlaySR);e[2]=this._getDrapedZ();if((c=this._context.clippingExtent)&&!F.pointInBox2D(e,c))return null;var m=this.getFastUpdateAttrValues(a);c=m?function(a){return K.evaluateModelTransform(l._fastUpdates.materialParameters,m,a)}:
null;b=P.createPointGeometry(Q,e,b,d,null,null,m);g=new L(b);g.material=this._drapedMaterial;g.center=e;g.bsRadius=0;g.transformation=U;g.name=f;g.uniqueName=f+"#"+b.id;g.data.layerUid=h;g.data.graphicUid=a.uid;g.calculateShaderTransformation=c;var k=new C(this,[g],null);k.getScreenSize=this._createScreenSizeGetter(d,c);k.calculateRelativeScreenBounds=function(a){return l._drapedMaterial.calculateRelativeScreenBounds(k.getScreenSize(),1,a)};return k};q.prototype._createScreenSizeGetter=function(a,
c){var b=this._outlineSize+2;if(this._fastUpdates.enabled){var d=a[0]/this._symbolTextureRatio,e=a[1]/this._symbolTextureRatio;return function(a){void 0===a&&(a=w.vec2f64.create());var f=c(U);a[0]=f[0]*d+b;a[1]=f[5]*e+b;return a}}var f=a[0]/this._symbolTextureRatio+b,g=a[1]/this._symbolTextureRatio+b;return function(a){void 0===a&&(a=w.vec2f64.create());a[0]=f;a[1]=g;return a}};q.prototype._fastVisualVariableConvertOptions=function(){var a=this._size[0]>this._size[1]?this._size[0]:this._size[1],c=
x.vec3f64.fromValues(a,a,a),b=t.px2pt(1),a=a*b,a=x.vec3f64.fromValues(a,a,a);return{modelSize:c,symbolSize:a,unitInMeters:b,transformation:{anchor:V,scale:X,rotation:V}}};q.prototype._hasVisibleVerticalOffset=function(a){return this.symbol&&"point-3d"===this.symbol.type&&this.symbol.hasVisibleVerticalOffset()};q.PRIMITIVE_SIZE=ca;return q}(H.default);b.Graphics3DIconSymbolLayer=q;var da={mode:"relative-to-ground",offset:0},ba=v.vec4f64.fromValues(0,0,0,1);b.default=q})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c){q=function(){function b(a,c,b){this.type="draped";this.graphics3DSymbolLayer=a;this.renderGeometries=c;this.boundingBox=b;this.stage=null;this._visible=!1}b.prototype.cachedSymbolSize=function(){return this.graphics3DSymbolLayer.getCachedSize()};b.prototype.initialize=function(a,c){this.stage=c};b.prototype.setVisibility=function(a){if(null!=this.stage)return this._visible!==a?((this._visible=a)?this.stage.getDrapedRenderer().addRenderGeometries(this.renderGeometries):
this.stage.getDrapedRenderer().removeRenderGeometries(this.renderGeometries),!0):!1};b.prototype.destroy=function(){this.stage&&this._visible&&this.stage.getDrapedRenderer().removeRenderGeometries(this.renderGeometries);this._visible=!1;this.stage=null};b.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(a,c){return Math.max(a,c.bsRadius)},0)};b.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=h.vec3f64.create());return d.vec3.set(a,0,0,0)};b.prototype.getBoundingBoxObjectSpace=
function(a){void 0===a&&(a=m.create());return m.empty(a)};b.prototype.addHighlight=function(a,c){var b=this;this.renderGeometries.forEach(function(d){var e=d.addHighlight(c);a.addRenderGeometry(d,e,b)});this._visible&&this.stage.getDrapedRenderer().updateHighlights(this.renderGeometries)};b.prototype.removeHighlight=function(a){this.renderGeometries.forEach(function(c){a.removeRenderGeometry(c)})};b.prototype.removeRenderGeometryHighlight=function(a,c){a.removeHighlight(c);this._visible&&this.stage.getDrapedRenderer().updateHighlights(this.renderGeometries)};
b.prototype.getProjectedBoundingBox=function(b,d,e,h){return k(this,void 0,void 0,function(){var l,k,p,r;return f(this,function(f){switch(f.label){case 0:m.empty(h);for(l=0;l<this.renderGeometries.length;l++)k=this.renderGeometries[l],this._getRenderGeometryProjectedBoundingRect(k,b,a,e),m.expand(h,a);if(!d)return[3,5];m.center(h,g);p=void 0;r=c.demResolutionForBoundingBox(h,d);f.label=1;case 1:return f.trys.push([1,3,,4]),[4,d.service.queryElevation(g[0],g[1],r)];case 2:return p=f.sent(),[3,4];case 3:return f.sent(),
p=null,[3,4];case 4:null!=p&&(h[2]=Math.min(h[2],p),h[5]=Math.max(h[5],p)),f.label=5;case 5:return[2,h]}})})};b.prototype._getRenderGeometryProjectedBoundingRect=function(a,c,b,d){if(this.boundingBox)m.set(l,this.boundingBox);else{var e=a.center;a=a.bsRadius;l[0]=e[0]-a;l[1]=e[1]-a;l[2]=e[2]-a;l[3]=e[0]+a;l[4]=e[1]+a;l[5]=e[2]+a}c(l,0,2);this.calculateRelativeScreenBounds&&d.push({location:m.center(l),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return m.toRect(l,b)};return b}();
var a=p.create(),l=m.create(),g=[0,0,0];return q})},"esri/views/3d/layers/graphics/sdfPrimitives":function(){define(["require","exports","../../webgl-engine/lib/Util"],function(q,b,n){function f(b,f,m){m&&(f/=Math.SQRT2);for(var d=new Uint8Array(4*b*b),c=0;c<b;c++)for(var a=0;a<b;a++){var h=a-.5*b+.25,g=-c+.5*b-.75,e=c*b+a;if(m)var k=(h+g)/Math.SQRT2,g=(g-h)/Math.SQRT2,h=k;h=Math.max(Math.abs(h),Math.abs(g))-.5*f;h=h/b+.5;n.packFloatRGBA(h,d,4*e)}return d}function k(b,f,m){m&&(f*=Math.SQRT2);f*=.5;
for(var d=new Uint8Array(4*b*b),c=0;c<b;c++)for(var a=0;a<b;a++){var h=a-.5*b,g=-c+.5*b-1,e=c*b+a;if(m)var k=(h+g)/Math.SQRT2,g=(g-h)/Math.SQRT2,h=k;k=void 0;h=Math.abs(h);g=Math.abs(g);k=h>g?h>f?Math.sqrt((h-f)*(h-f)+g*g):g:g>f?Math.sqrt(h*h+(g-f)*(g-f)):h;k=k/b+.5;n.packFloatRGBA(k,d,4*e)}return d}Object.defineProperty(b,"__esModule",{value:!0});b.createCircle=function(b,f){var d=new Uint8Array(4*b*b),h=b/2-.5;f/=2;for(var c=0;c<b;c++)for(var a=0;a<b;a++){var l=a+b*c,g=a-h,e=c-h,g=Math.sqrt(g*g+
e*e)-f,g=g/b+.5;n.packFloatRGBA(g,d,4*l)}return d};b.createSquare=function(b,h){return f(b,h,!1)};b.createKite=function(b,h){return f(b,h,!0)};b.createCross=function(b,f){return k(b,f,!1)};b.createX=function(b,f){return k(b,f,!0)};b.createTriangle=function(b,f){for(var d=new Uint8Array(4*b*b),h=Math.sqrt(1.25),c=(b-f)/2,a=0;a<b;a++)for(var l=0;l<b;l++){var g=(l-c)/f,e=(a-c+.75)/f;n.packFloatRGBA(Math.max(-(1*g+-.5*e)/h,(1*(g-1)+-.5*-e)/h,-e)*f/b+.5,d,4*(a*b+l))}return d}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("require exports ../../../../core/compilerUtils ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../renderers/support/utils ../../support/debugFlags".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a){function l(a){return null!==a&&void 0!==a}function g(a){return"number"===typeof a}function e(a){return"string"===typeof a}function u(a,c){a&&a.push(c)}function t(a,b,d,e,f){var h=a.minSize,m=a.maxSize;if(a.expression)return u(f,"Could not convert size info: expression not supported"),!1;if(a.useSymbolValue)return a=e.symbolSize[d],b.minSize[d]=a,b.maxSize[d]=a,b.offset[d]=b.minSize[d],b.factor[d]=0,b.type[d]=1,!0;if(l(a.field)){if(l(a.stops)){if(2===a.stops.length&&
g(a.stops[0].size)&&g(a.stops[1].size))return r(a.stops[0].size,a.stops[1].size,a.stops[0].value,a.stops[1].value,b,d),b.type[d]=1,!0;u(f,"Could not convert size info: stops only supported with 2 elements");return!1}if(g(h)&&g(m)&&l(a.minDataValue)&&l(a.maxDataValue))return r(h,m,a.minDataValue,a.maxDataValue,b,d),b.type[d]=1,!0;if(null!=c.meterIn[a.valueUnit])return b.minSize[d]=-Infinity,b.maxSize[d]=Infinity,b.offset[d]=0,b.factor[d]=1/c.meterIn[a.valueUnit],b.type[d]=1,!0;if("unknown"===a.valueUnit)return u(f,
"Could not convert size info: proportional size not supported"),!1;u(f,"Could not convert size info: scale-dependent size not supported");return!1}if(!l(a.field)){if(a.stops&&a.stops[0]&&g(a.stops[0].size))return b.minSize[d]=a.stops[0].size,b.maxSize[d]=a.stops[0].size,b.offset[d]=b.minSize[d],b.factor[d]=0,b.type[d]=1,!0;if(g(h))return b.minSize[d]=h,b.maxSize[d]=h,b.offset[d]=h,b.factor[d]=0,b.type[d]=1,!0}u(f,"Could not convert size info: unsupported variant of sizeInfo");return!1}function r(a,
c,b,d,e,f){d=0<Math.abs(d-b)?(c-a)/(d-b):0;e.minSize[f]=0<d?a:c;e.maxSize[f]=0<d?c:a;e.offset[f]=a-b*d;e.factor[f]=d}function y(a,c,b,d){if(a.normalizationField||a.valueRepresentation)return u(d,"Could not convert size info: unsupported property"),null;var f=a.field;if(null!=f&&!e(f))return u(d,"Could not convert size info: field is not a string"),null;if(!c.size)c.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!c.size.field)c.size.field=
a.field;else if(a.field!==c.size.field)return u(d,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(f=t(a,c.size,0,b,d))?c:null;case "height":return(f=t(a,c.size,2,b,d))?c:null;case "depth":return(f=t(a,c.size,1,b,d))?c:null;case "width-and-depth":return(f=t(a,c.size,0,b,d))&&t(a,c.size,1,b,d),f?c:null;case null:case void 0:case "all":return(f=(f=(f=t(a,c.size,0,b,d))&&t(a,c.size,1,b,d))&&t(a,c.size,2,b,d))?c:null;default:return u(d,'Could not convert size info: unknown axis "'+
a.axis+'""'),null}}function w(a,c,b){for(var d=0;3>d;++d){var e=c.unitInMeters;1===a.type[d]&&(e*=c.modelSize[d],a.type[d]=2);a.minSize[d]/=e;a.maxSize[d]/=e;a.offset[d]/=e;a.factor[d]/=e}if(0!==a.type[0])c=0;else if(0!==a.type[1])c=1;else if(0!==a.type[2])c=2;else return u(b,"No size axis contains a valid size or scale"),!1;for(d=0;3>d;++d)0===a.type[d]&&(a.minSize[d]=a.minSize[c],a.maxSize[d]=a.maxSize[c],a.offset[d]=a.offset[c],a.factor[d]=a.factor[c],a.type[d]=a.type[c]);return!0}function x(a,
c,b){a[4*c+0]=b.r/255;a[4*c+1]=b.g/255;a[4*c+2]=b.b/255;a[4*c+3]=b.a}function v(a,c,b){if(a.normalizationField)return u(b,"Could not convert color info: unsupported property"),null;if(e(a.field))if(a.stops){if(8<a.stops.length)return u(b,"Could not convert color info: too many color stops"),null;c.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};b=a.stops;for(a=0;8>a;++a){var d=b[Math.min(a,b.length-1)];c.color.values[a]=d.value;
x(c.color.colors,a,d.color)}}else return u(b,"Could not convert color info: missing stops or colors"),null;else if(a.stops&&0<=a.stops.length)for(b=a.stops&&0<=a.stops.length&&a.stops[0].color,c.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},a=0;8>a;a++)c.color.values[a]=Infinity,x(c.color.colors,a,b);else return u(b,"Could not convert color info: no field and no colors/stops"),null;return c}function z(a,c,b){if(a.normalizationField)return u(b,
"Could not convert opacity info: unsupported property"),null;if(e(a.field))if(a.stops){if(8<a.stops.length)return u(b,"Could not convert opacity info: too many opacity stops"),null;c.opacity={field:a.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};b=a.stops;for(a=0;8>a;++a){var d=b[Math.min(a,b.length-1)];c.opacity.values[a]=d.value;c.opacity.opacityValues[a]=d.opacity}}else return u(b,"Could not convert opacity info: missing stops or opacities"),null;else if(a.stops&&0<=a.stops.length)for(b=
a.stops&&0<=a.stops.length&&a.stops[0].opacity,c.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},a=0;8>a;a++)c.opacity.values[a]=Infinity,c.opacity.opacityValues[a]=b;else return u(b,"Could not convert opacity info: no field and no opacities/stops"),null;return c}function A(a,c,b,d){a=2===b&&"arithmetic"===a.rotationType;c.offset[b]=a?90:0;c.factor[b]=a?-1:1;c.type[b]=1}function B(a,c,b){if(!e(a.field))return u(b,"Could not convert rotation info: field is not a string"),
null;if(!c.rotation)c.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(a.field)if(!c.rotation.field)c.rotation.field=a.field;else if(a.field!==c.rotation.field)return u(b,"Could not convert rotation info: multiple fields in use"),null;switch(a.axis){case "tilt":return A(a,c.rotation,0,b),c;case "roll":return A(a,c.rotation,1,b),c;case null:case void 0:case "heading":return A(a,c.rotation,2,b),c;default:return u(b,'Could not convert rotation info: unknown axis "'+a.axis+
'""'),null}}function C(a,c,b){if(!a)return null;var d=!c.supportedTypes||!!c.supportedTypes.size,e=!c.supportedTypes||!!c.supportedTypes.color,f=!c.supportedTypes||!!c.supportedTypes.rotation,g=!!c.supportedTypes&&!!c.supportedTypes.opacity,h=a.reduce(function(a,h){if(!a)return a;if(h.valueExpression)return u(b,"Could not convert visual variables: arcade expressions not supported"),null;switch(h.type){case "size":return d?y(h,a,c,b):a;case "color":return e?v(h,a,b):a;case "opacity":return g?z(h,a,
b):a;case "rotation":return f?B(h,a,b):a;default:return n.neverReached(h),null}},{size:null,color:null,opacity:null,rotation:null});return 0<a.length&&h&&!h.size&&!h.color&&!h.opacity&&!h.rotation||h&&h.size&&!w(h.size,c,b)?null:h}function E(a,c,b){if(!!a!==!!c||a&&a.field!==c.field)return!1;if(a&&"rotation"===b)for(b=0;3>b;b++)if(a.type[b]!==c.type[b]||a.offset[b]!==c.offset[b]||a.factor[b]!==c.factor[b])return!1;return!0}function F(a,c){var b={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,
vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},e=a&&null!=a.size;a&&a.size?(b.vvSizeEnabled=!0,b.vvSizeMinSize=a.size.minSize,b.vvSizeMaxSize=a.size.maxSize,b.vvSizeOffset=a.size.offset,b.vvSizeFactor=a.size.factor):a&&e&&(b.vvSizeValue=c.transformation.scale);if(a&&e){b.vvSymbolAnchor=c.transformation.anchor;b.vvSymbolRotationMatrix=
k.mat3f64.create();d.mat4.identity(D);var g=c.transformation.rotation[2],e=c.transformation.rotation[0],l=c.transformation.rotation[1];c=D;void 0===c&&(c=h.mat4f64.create());g=g||0;e=e||0;l=l||0;0!==g&&d.mat4.rotateZ(c,c,-g/180*Math.PI);0!==e&&d.mat4.rotateX(c,c,e/180*Math.PI);0!==l&&d.mat4.rotateY(c,c,l/180*Math.PI);f.mat3.fromMat4(b.vvSymbolRotationMatrix,D)}a&&a.color&&(b.vvColorEnabled=!0,b.vvColorValues=a.color.values,b.vvColorColors=a.color.colors);a&&a.opacity&&(b.vvOpacityEnabled=!0,b.vvOpacityValues=
a.opacity.values,b.vvOpacityOpacities=a.opacity.opacityValues);return b}Object.defineProperty(b,"__esModule",{value:!0});b.convertVisualVariables=C;b.initFastSymbolUpdatesState=function(c,b){return!c||a.DISABLE_FAST_UPDATES?{enabled:!1}:(c=C(c.visualVariables,b))?{enabled:!0,visualVariables:c,materialParameters:F(c,b),requiresShaderTransformation:c&&null!=c.size}:{enabled:!1}};b.updateFastSymbolUpdatesState=function(a,c,b){if(!c||!a.enabled)return!1;var d=a.visualVariables;c=C(c.visualVariables,b);
if(!(c&&E(d.size,c.size,"size")&&E(d.color,c.color,"color")&&E(d.rotation,c.rotation,"rotation")))return!1;a.visualVariables=c;a.materialParameters=F(c,b);a.requiresShaderTransformation=c&&null!=c.size;return!0};b.getMaterialParams=F;var H;(function(a){var c=h.mat4f64.create(),b=p.vec3f64.create();a.evaluateModelTransform=function(a,e,f){if(!a.vvSizeEnabled)return f;d.mat4.copy(c,f);f=a.vvSymbolRotationMatrix;d.mat4.set(D,f[0],f[1],f[2],0,f[3],f[4],f[5],0,f[6],f[7],f[8],0,0,0,0,1);d.mat4.multiply(c,
c,D);for(f=0;3>f;++f){var g=a.vvSizeOffset[f]+e[0]*a.vvSizeFactor[f],h=a.vvSizeMinSize[f],l=a.vvSizeMaxSize[f];b[f]=g<h?h:g>l?l:g}d.mat4.scale(c,c,b);d.mat4.translate(c,c,a.vvSymbolAnchor);return c};a.evaluateModelTransformScale=function(a,c,b){if(!c.vvSizeEnabled)return m.vec3.set(a,1,1,1);for(var d=0;3>d;++d){var e=c.vvSizeOffset[d]+b[0]*c.vvSizeFactor[d],f=c.vvSizeMinSize[d],g=c.vvSizeMaxSize[d];a[d]=e<f?f:e>g?g:e}return a}})(H||(H={}));var D=h.mat4f64.create();b.evaluateModelTransform=H.evaluateModelTransform;
b.evaluateModelTransformScale=H.evaluateModelTransformScale})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/typedArrayUtil ../../support/imageUtils ../../support/mathUtils ./DDSUtil ./DefaultVertexBufferLayouts ./glUtil3D ./IdGen ./Util ../shaders/MiscPrograms ../../../webgl/FramebufferObject ../../../webgl/renderState ../../../webgl/Texture ../../../webgl/Util ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w){var x=f.getLogger("esri.views.3d.webgl-engine.lib.Texture");q=function(){function b(a,c,d){this.data=a;this.id=b.idGen.gen(c);this.unloadFunc=void 0;this.params=d||{};this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1;this.params.wrap=this.params.wrap||{s:10497,t:10497};this.params.powerOfTwoResizeMode=this.params.powerOfTwoResizeMode||1;this.estimatedTexMemRequired=
b.estimateTexMemRequired(this.data,this.params)}b.estimateTexMemRequired=function(a,c){return null==a?0:d.isArrayBuffer(a)||d.isUint8Array(a)?a.byteLength:a instanceof Image||a instanceof ImageData||a instanceof HTMLCanvasElement?(c.mipmap?4/3:1)*a.width*a.height*(c.components||4):(c.mipmap?4/3:1)*c.width*c.height*(c.components||4)||0};b.prototype.getEstimatedTexMemRequired=function(){return this.estimatedTexMemRequired};b.prototype.dispose=function(){this.data=void 0};b.prototype.deferredLoading=
function(){return"string"===typeof this.data};b.prototype.getWidth=function(){return this.params.width};b.prototype.getHeight=function(){return this.params.height};b.prototype.initializeThroughUpload=function(a,c,e,f,h){var l=this.data;c.flipped=!this.params.noUnpackFlip;c.samplingMode=this.params.mipmap?9987:9729;c.hasMipmap=this.params.mipmap;c.wrapMode=this.params.wrap;c.preMultiplyAlpha=this.params.preMultiplyAlpha;if("string"===typeof l)this.loadTextureFromUri(a,l,c,e,f,h);else if(l instanceof
Image||l instanceof ImageData||l instanceof HTMLCanvasElement)this.loadTextureFromImageData(a,l,c,e,f,h);else{if(d.isArrayBuffer(l)&&this.params.encoding===b.DDS_ENCODING)c=p.createDDSTexture(a,c,l,this.params.mipmap);else if(d.isUint8Array(l)&&this.params.encoding===b.DDS_ENCODING)c=p.createDDSTexture(a,c,l.buffer,this.params.mipmap);else if(d.isUint8Array(l))g.assert(0<this.params.width&&0<this.params.height),c.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408,c.width=
this.params.width,c.height=this.params.height,c=new r(a,c,l);else{if(null!==l)throw console.warn("Unsupported image data"),Error("Unsupported image data");c=new r(a,c,null)}a.bindTexture(c);h(c)}this.data=void 0};b.prototype.loadTextureFromImageData=function(a,c,b,d,e,f){this.params.width=c.width;this.params.height=c.height;b.pixelFormat=3===this.params.components?6407:6408;var g=33071===this.params.wrap.s&&33071===this.params.wrap.t;w.default(a.gl)||!this.params.mipmap&&g||m.isPowerOfTwo(c.width)&&
m.isPowerOfTwo(c.height)?(b.width=c.width,b.height=c.height,c=new r(a,b,c)):c=this.makePowerOfTwoTexture(a,c,b,d,e);a.bindTexture(c);f(c)};b.prototype.loadTextureFromUri=function(a,c,b,d,e,f){var l=this,k=!1!==this.params.mipmap;h.requestImage(c).then(function(c){g.assert(1<=c.width&&1<=c.height);b.samplingMode=k?9987:9729;b.hasMipmap=k;!k&&33071===b.wrapMode||m.isPowerOfTwo(c.width)&&m.isPowerOfTwo(c.height)?(b.width=c.width,b.height=c.height,c=new r(a,b,c)):c=l.makePowerOfTwoTexture(a,c,b,d,e);
a.bindTexture(c);f(c)}).catch(function(a){var b=200<c.length?c.slice(0,100)+"..."+c.slice(c.length-100):c;x.error("Failed to load image from uri",b,a);f(null)})};b.prototype.makePowerOfTwoTexture=function(a,c,b,d,e){var f=c.width,g=c.height,h=k.nextHighestPowerOfTwo(f),l=k.nextHighestPowerOfTwo(g);b.width=h;b.height=l;var m;switch(this.params.powerOfTwoResizeMode){case 2:b.textureCoordinateScaleFactor=[f/h,g/l];m=new r(a,b);m.updateData(0,0,0,f,g,c);break;case 1:case null:case void 0:m=this.stretchToPowerOfTwo(a,
c,b,d,e);break;default:n.neverReached(this.params.powerOfTwoResizeMode)}b.hasMipmap&&m.generateMipmap();return m};b.prototype.stretchToPowerOfTwo=function(b,d,f,g,h){var l=new r(b,f),m=u.createWithAttachments(b,l,{colorTarget:0,depthStencilTarget:0});d=new r(b,{target:3553,pixelFormat:f.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!f.flipped,maxAnisotropy:8,preMultiplyAlpha:f.preMultiplyAlpha},d);b.bindFramebuffer(m);void 0===h&&(h=b.getViewport(),h=[h.x,h.y,h.width,h.height]);
b.setViewport(0,0,f.width,f.height);f=g.getProgram(e.texOnly);b.bindProgram(f);f.setUniform4f("color",1,1,1,1);f.setUniform1i("tex",0);f=a.createQuadVAO(b,c.Pos3Tex);b.bindTexture(d,0);b.bindVAO(f);b.setPipelineState(v);b.drawArrays(5,0,y.vertexCount(f,"geometry"));b.bindFramebuffer(null);b.setViewport(h[0],h[1],h[2],h[3]);f.dispose(!0);d.dispose();b.bindFramebuffer(null);m.detachColorTexture();m.dispose();return l};b.prototype.setUnloadFunc=function(a){this.unloadFunc=a};b.prototype.unload=function(){void 0!==
this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)};b.createEmpty=function(a){void 0===a&&(a="emptyTexture");return new b(new Uint8Array([0,0,0,0]),a,{width:1,height:1,wrap:{s:33071,t:33071}})};b.idGen=new l;b.DDS_ENCODING="image/vnd-ms.dds";return b}();var v=t.makePipelineState({colorWrite:t.defaultColorWriteParams});return q})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["require","exports","../../../webgl/Texture"],function(q,b,n){function f(b){return b.charCodeAt(0)+
(b.charCodeAt(1)<<8)+(b.charCodeAt(2)<<16)+(b.charCodeAt(3)<<24)}Object.defineProperty(b,"__esModule",{value:!0});var k=f("DXT1"),d=f("DXT3"),h=f("DXT5");b.createDDSTexture=function(b,f,c,a){var l=new Int32Array(c,0,31);if(542327876!==l[0])return console.error("Invalid magic number in DDS header"),null;if(!(l[20]&4))return console.error("Unsupported format, must contain a FourCC code"),null;var g=l[21],e;switch(g){case k:g=8;e=33776;break;case d:g=16;e=33778;break;case h:g=16;e=33779;break;default:return console.error("Unsupported FourCC code:",
String.fromCharCode(g&255,g>>8&255,g>>16&255,g>>24&255)),null}var m=1;l[2]&131072&&!1!==a&&(m=Math.max(1,l[7]));a=l[4];for(var p=l[3],r=l[1]+4,q,w,x=[],v=0;v<m;++v)w=Math.floor((a+3)/4)*Math.floor((p+3)/4)*g,q=new Uint8Array(c,r,w),x.push(q),r+=w,a=Math.max(1,a>>1),p=Math.max(1,p>>1);f.samplingMode=1<m?9987:9729;f.hasMipmap=1<m;f.width=l[4];f.height=l[3];f.internalFormat=e;f=new n(b,f,{type:"compressed",levels:x});b.bindTexture(f);return f}})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function e(a,c,d,e){a=b.call(this,a,c,d,e)||this;d=a._getStageIdHint();c=null!=c.size?f.pt2px(c.size):1;c={idHint:d,width:c,color:a._getMaterialOpacityAndColor(),slicePlaneEnabled:a._context.slicePlaneEnabled};if(!a._isPropertyDriven("size")&&(d=u.validateSymbolLayerSize(c.width)))return a._logWarning(d),a.reject(),a;if(0>=c.width)return a.reject(),a;a._isPropertyDriven("size")&&(c.width=
0);a._material=t.createRibbonMaterial(c);a._context.stage.add(r.ModelContentType.MATERIAL,a._material);a.resolve();return a}n(e,b);e.prototype.destroy=function(){b.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(r.ModelContentType.MATERIAL,this._material.id),this._material=null)};e.prototype.createGraphics3DGraphic=function(a){var c=a.renderingInfo;a=a.graphic;var b=a.geometry;if("polyline"!==b.type&&"polygon"!==b.type&&"extent"!==b.type)return this._logWarning("unsupported geometry type for line symbol: "+
b.type),null;if(!this._validateGeometry(b))return null;var b="polygon"===b.type||"extent"===b.type?"rings":"paths",d="graphic"+a.uid,e=this._getVertexOpacityAndColor(c,Float32Array,255),h=0;c.size&&this._isPropertyDriven("size")&&(h=g.getSingleSizeDriver(c.size),h=f.pt2px(h));c=this.getGraphicElevationContext(a);return"on-the-ground"===c.mode?this._createAsOverlay(a,b,e,h,c,d,this._context.layer.uid):this._createAs3DShape(a,b,e,h,c,d,a.uid)};e.prototype.layerOpacityChanged=function(){var a=this._material.getColor(),
a={color:[a[0],a[1],a[2],this._getMaterialOpacity()]};this._material.setParameterValues(a);return!0};e.prototype.layerElevationInfoChanged=function(a,c,b){var d=this._elevationContext.mode;if(null==b||null==d)return!1;if("on-the-ground"===b&&"on-the-ground"===d)return!0;if(b!==d&&("on-the-ground"===b||"on-the-ground"===d))return!1;var e=g.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,c,function(){return e})};e.prototype.slicePlaneEnabledChanged=function(a,c){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});
return!0};e.prototype.pixelRatioChanged=function(a,c){return!0};e.prototype._getOutlineGeometry=function(a,c){return c};e.prototype._getGeometry=function(a){a=a.geometry;"extent"===a.type&&(a=m.fromExtent(a));return a};e.prototype._createAs3DShape=function(a,b,e,f,m,p,r){var n=this._getGeometry(a),u=n[b],q=this._getOutlineGeometry(n,u);a=[];var x=[],v=[],z=h.vec3f64.create(),B=Array(6),n=g.getGeometryVertexData3D(q,n.hasZ,n.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,
this._context.renderCoordsHelper,m);this._logGeometryCreationWarnings(n,u,b,"LineSymbol3DLayer");if(0<q.length){for(var u=n.geometryData.outlines,q=n.eleVertexData,A=n.vertexData,C=0;C<u.length;++C){var D=u[C];if(!(1>=D.count)){var F=D.index,E=D.count;if(this._context.clippingExtent&&(g.computeBoundingBox(q,F,E,B),g.boundingBoxClipped(B,this._context.clippingExtent)))continue;g.chooseOrigin(A,F,E,z);g.subtractCoordinates(A,F,E,z);D=new Float64Array(q.buffer,3*F*q.BYTES_PER_ELEMENT,3*E);F=new Float64Array(A.buffer,
3*F*A.BYTES_PER_ELEMENT,3*E);F=t.createPolylineGeometry(F,D,"rings"===b,e,f);F=new y(F,p+"path"+C);F.singleUse=!0;a.push(F);x.push(this._material);F=d.mat4f64.create();k.mat4.translate(F,F,z);v.push(F)}}if(0<a.length)return b=new w({geometries:a,materials:x,transformations:v,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:r},idHint:p}),b=new l(this,b,a,null,null,c.perVertexElevationAligner,m),b.alignedTerrainElevation=n.terrainElevation,b.needsElevationUpdates=g.needsElevationUpdates2D(m.mode),
b}return null};e.prototype._createAsOverlay=function(c,b,e,f,l,m,r){var n=this._getGeometry(c);this._material.renderPriority=this._symbolLayerOrder;var u=n[b],q=this._getOutlineGeometry(n,u);l=[];var w=Array(6),y=p.empty(),v=h.vec3f64.create(),n=g.getGeometryVertexDataDraped(q,n.spatialReference,this._context.overlaySR);this._logGeometryCreationWarnings(n,u,b,"LineSymbol3DLayer");if(0<q.length){u=n.vertexData;q=n.geometryData.outlines;for(n=0;n<q.length;++n){var z=q[n],B=z.index,z=z.count;g.computeBoundingBox(u,
B,z,w);if(!g.boundingBoxClipped(w,this._context.clippingExtent)){p.expand(y,w);g.chooseOrigin(u,B,z,v);g.subtractCoordinates(u,B,z,v);g.setZ(u,B,z,this._getDrapedZ());z=new Float64Array(u.buffer,3*B*u.BYTES_PER_ELEMENT,3*z);B=d.mat4f64.create();k.mat4.translate(B,B,v);var z=t.createPolylineGeometry(z,null,"rings"===b,e,f),A=new x(z);A.data.layerUid=r;A.data.graphicUid=c.uid;A.material=this._material;A.center=[.5*(w[0]+w[3]),.5*(w[1]+w[4]),0];A.bsRadius=.5*Math.sqrt((w[3]-w[0])*(w[3]-w[0])+(w[4]-w[1])*
(w[4]-w[1]));A.transformation=B;A.name=m;A.uniqueName=m+"#"+z.id;l.push(A)}}return new a(this,l,y)}return null};return e}(e.default);b.Graphics3DLineSymbolLayer=q;b.default=q})},"esri/views/3d/layers/graphics/lineUtils":function(){define("require exports ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),function(q,b,n,f,k,d){function h(b){var c=b.length;return b[0]===b[c-3]&&b[1]===
b[c-2]&&b[2]===b[c-1]}Object.defineProperty(b,"__esModule",{value:!0});var m=f.VertexAttrConstants;b.createRibbonMaterial=function(b){var c={width:b.width,color:b.color,miterLimit:b.miterLimit,polygonOffset:!0,join:"miter",slicePlaneEnabled:b.slicePlaneEnabled};"miter"===b.join||"bevel"===b.join?c.join=b.join:b.join&&console.warn("unsupported join type for line symbol: "+b.join);return new d(c,b.idHint+"_ribbonlinemat")};b.createNativeMaterial=function(b){return new k({color:b.color,slicePlaneEnabled:b.slicePlaneEnabled},
b.idHint+"_nativelinemat")};b.isClosed=h;b.createPolylineGeometry=function(b,c,a,d,f){var e,g,l;if(a=a&&!h(b)){a=new Float32Array(b.length+3);for(g=0;g<b.length;g++)a[g]=b[g];g=a.length;a[g-3]=b[0];a[g-2]=b[1];a[g-1]=b[2];e=b.length/3+1;g=new Uint32Array(2*(e-1));l=new Uint32Array(2*(e-1))}else e=b.length/3,g=new Uint32Array(2*(e-1)),l=new Uint32Array(2*(e-1)),a=b;b=new Float32Array(1);b[0]=f;for(var k=f=0,p=0;p<e-1;p++)g[f++]=p,g[f++]=p+1,l[k++]=0,l[k++]=0;f={};e={};f[m.POSITION]=g;f[m.COLOR]=l;
f[m.SIZE]=l;e[m.POSITION]={size:3,data:a,offsetIdx:0,strideIdx:3};e[m.COLOR]={size:4,data:d,offsetIdx:0,strideIdx:4};e[m.SIZE]={size:1,data:b,offsetIdx:0,strideIdx:1};c&&(f.mapPos=g,e.mapPos={size:3,data:c,offsetIdx:0,strideIdx:3});return new n(e,f,n.DefaultOffsets,"line")}})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Logger ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterial ../lib/Material ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/NativeLinePrograms ../../../webgl/renderState".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w){var x=f.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");q=function(c){function b(a,b){b=c.call(this,b)||this;b.params=t.copyParameters(a,A);return b}n(b,c);b.prototype.setParameterValues=function(a){var c=this.params,b;for(b in a)c[b]=a[b];this.notifyDirty("matChanged")};b.prototype.getParameters=function(){return this.params};b.prototype.getColor=function(){return this.params.color};b.prototype.intersect=function(a,c,b,d,e,f,g,
h,l){l?this.intersectLineGeometry(a,c,b,d,e,f,g):t.intersectDrapedRenderLineGeometry(a,c,b,d,e,f,1,g)};b.prototype.intersectLineGeometry=function(c,b,f,g,l,m,k,r){if(g.enable.selectionMode&&!a.isAllHidden(b.componentVisibilities,c.componentOffsets))if(e.isTranslationMatrix(f)){b=c.data.getVertexAttr().position.data;l=g.camera;m=L;d.vec2.copy(m,g.point);h.vec3.set(T[0],m[0]-2,m[1]+2,0);h.vec3.set(T[1],m[0]+2,m[1]+2,0);h.vec3.set(T[2],m[0]+2,m[1]-2,0);h.vec3.set(T[3],m[0]-2,m[1]-2,0);for(r=0;4>r;r++)l.unprojectPoint(T[r],
R[r]);p.plane.fromPoints(l.eye,R[0],R[1],J);p.plane.fromPoints(l.eye,R[1],R[2],U);p.plane.fromPoints(l.eye,R[2],R[3],Q);p.plane.fromPoints(l.eye,R[3],R[0],I);c=Number.MAX_VALUE;for(r=0;r<b.length-5;r+=3)if(E[0]=b[r]+f[12],E[1]=b[r+1]+f[13],E[2]=b[r+2]+f[14],F[0]=b[r+3]+f[12],F[1]=b[r+4]+f[13],F[2]=b[r+5]+f[14],!(0>p.plane.signedDistance(J,E)&&0>p.plane.signedDistance(J,F)||0>p.plane.signedDistance(U,E)&&0>p.plane.signedDistance(U,F)||0>p.plane.signedDistance(Q,E)&&0>p.plane.signedDistance(Q,F)||0>
p.plane.signedDistance(I,E)&&0>p.plane.signedDistance(I,F))){l.projectPoint(E,G);l.projectPoint(F,K);if(0>G[2]&&0<K[2]){h.vec3.subtract(H,E,F);var n=l.frustum,t=-p.plane.signedDistance(n.planes[4],E),n=t/h.vec3.dot(H,n.planes[4]);h.vec3.scale(H,H,n);h.vec3.add(E,E,H);l.projectPoint(E,G)}else if(0<G[2]&&0>K[2])h.vec3.subtract(H,F,E),n=l.frustum,t=-p.plane.signedDistance(n.planes[4],F),n=t/h.vec3.dot(H,n.planes[4]),h.vec3.scale(H,H,n),h.vec3.add(F,F,H),l.projectPoint(F,K);else if(0>G[2]&&0>K[2])continue;
G[2]=0;K[2]=0;n=p.lineSegment.distance2(p.lineSegment.fromPoints(G,K,N),m);n<c&&(c=n,h.vec3.copy(M,E),h.vec3.copy(O,F))}f=g.rayBeginPoint;g=g.rayEndPoint;4>c&&(c=Number.MAX_VALUE,p.lineSegment.closestLineSegmentPoint(p.lineSegment.fromPoints(M,O,N),p.lineSegment.fromPoints(f,g,P),D)&&(h.vec3.subtract(D,D,f),c=h.vec3.length(D),h.vec3.scale(D,D,1/c),c/=h.vec3.distance(f,g)),k(c,D))}else x.error("intersection assumes a translation-only matrix")};b.prototype.createBufferWriter=function(){return new C(this.params)};
b.prototype.createRenderer=function(a,c){return new r(a,c,this)};b.prototype.getGLMaterials=function(){return{color:v,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:z}};b.prototype.getAllTextureIds=function(){return[]};return b}(g);var v=function(a){function c(c,b,d){c=a.call(this,c,b)||this;c.updateParameters();return c}n(c,a);c.prototype.updateParameters=function(){this.params=t.copyParameters(this.material.getParameters());this.selectProgram()};c.prototype.selectProgram=function(){var a=
this.params;this.program=this.programRep.getProgram(y.colorPass,{slice:a.slicePlaneEnabled,vertexColors:this.params.vertexColors});this.pipelineState=w.makePipelineState({blending:1>a.color[3]&&w.separateBlendingParams(770,1,771,771),depthTest:{func:513},depthWrite:w.defaultDepthWriteParams,colorWrite:w.defaultColorWriteParams})};c.prototype.beginSlot=function(a){return 4===a};c.prototype.getProgram=function(){return this.program};c.prototype.bind=function(a,c){c=this.program;var b=this.params;a.bindProgram(c);
a.setPipelineState(this.pipelineState);c.setUniform4fv("constantColor",b.color)};c.prototype.release=function(a){};c.prototype.bindView=function(a,c){a=this.program;var b=this.params;t.bindView(c.origin,c.view,a);b.slicePlaneEnabled&&t.bindSlicePlane(c.origin,c.slicePlane,a)};c.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",c.transformation)};c.prototype.getDrawMode=function(){return 1};return c}(l),z=function(a){function c(c,b,d){c=a.call(this,c,b)||this;c.updateParameters();
return c}n(c,a);c.prototype.updateParameters=function(){this.params=t.copyParameters(this.material.getParameters());this.selectProgram()};c.prototype.beginSlot=function(a){return 4===a};c.prototype.getProgram=function(){return this.program};c.prototype.selectProgram=function(){this.program=this.programRep.getProgram(y.highlightPass,{slice:this.params.slicePlaneEnabled,vertexColors:this.params.vertexColors});this.pipelineState=w.makePipelineState({depthTest:{func:513},colorWrite:w.defaultColorWriteParams})};
c.prototype.bind=function(a,c){a.bindProgram(this.program);a.setPipelineState(this.pipelineState);t.bindHighlightRendering(a,c,this.program)};c.prototype.release=function(a){};c.prototype.bindView=function(a,c){a=this.program;var b=this.params;t.bindView(c.origin,c.view,a);b.slicePlaneEnabled&&t.bindSlicePlane(c.origin,c.slicePlane,a)};c.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",c.transformation)};c.prototype.getDrawMode=function(){return 1};return c}(l),A={color:[1,
1,1,1],vertexColors:!1,slicePlaneEnabled:!1},B=c.newLayout().vec3f(e.VertexAttrConstants.POSITION),C=function(){function a(a){this.vertexBufferLayout=c.newLayout().vec3f(e.VertexAttrConstants.POSITION);a.vertexColors&&(this.vertexBufferLayout=B.vec4u8(e.VertexAttrConstants.COLOR))}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices[e.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,c,b,d,e){u.writeDefaultAttributes(c,
b,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,d,e)};return a}(),E=m.vec3f64.create(),F=m.vec3f64.create(),H=m.vec3f64.create(),D=m.vec3f64.create(),G=k.createRenderScreenPointArray3(),K=k.createRenderScreenPointArray3(),M=m.vec3f64.create(),O=m.vec3f64.create(),N=p.lineSegment.create(),P=p.lineSegment.create(),L=m.vec3f64.create(),T=[k.createRenderScreenPointArray3(),k.createRenderScreenPointArray3(),k.createRenderScreenPointArray3(),k.createRenderScreenPointArray3()],R=[m.vec3f64.create(),
m.vec3f64.create(),m.vec3f64.create(),m.vec3f64.create()],J=p.plane.create(),U=p.plane.create(),Q=p.plane.create(),I=p.plane.create();return q})},"esri/views/3d/webgl-engine/shaders/NativeLinePrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});var d=function(b){return k.glslifyDefineMap({SLICE:b.slice,VERTEXCOLORS:b.vertexColors})};b.colorPass=
{name:"native-line-color",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("materials/nativeLine/nativeLine.vert"),fragmentShader:d(b)+f.resolveIncludes("materials/nativeLine/colorPass.frag")}},attributes:n.Default3D};b.highlightPass={name:"native-line-highlight",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("materials/nativeLine/nativeLine.vert"),fragmentShader:d(b)+f.resolveIncludes("materials/nativeLine/highlightPass.frag")}},attributes:n.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../Color ../../../../core/compilerUtils ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat3 ../../../../core/libs/gl-matrix-2/mat3f64 ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/webMercatorUtils ../../../../geometry/support/meshUtils/projection ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C,E,F,H,D,G,K,M,O){Object.defineProperty(b,"__esModule",{value:!0});var N=K.VertexAttrConstants;q=function(b){function e(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._edgeStageObjects=new Set;a._materials={};a._textures={};B.DRAW_MESH_GEOMETRY_NORMALS&&(a._debugVertexNormalMaterial=new O({color:[1,0,1,1]},"debugVertexNormal"),a._debugFaceNormalMaterial=new O({color:[0,1,1,1]},"debugFAceNormal"));a.resolve();return a}n(e,b);e.prototype.destroy=function(){b.prototype.destroy.call(this);
this.isFulfilled()||this.reject();for(var a in this._materials)this._context.stage.remove(E.ModelContentType.MATERIAL,this._materials[a].material.id);for(a in this._textures)this._context.stage.remove(E.ModelContentType.TEXTURE,this._textures[a].id);this._materials={};this._textures={}};e.prototype.createGraphics3DGraphic=function(a){var c=a.graphic;if("mesh"!==c.geometry.type)return this._logWarning("unsupported geometry type for fill on mesh-3d symbol: "+c.geometry.type),null;if(!this._validateGeometry(c.geometry))return null;
var b="graphic"+c.uid,d=this.getGraphicElevationContext(c);return this._createAs3DShape(c,a.renderingInfo,d,b,c.uid)};e.prototype.layerOpacityChanged=function(){var a=this._getLayerOpacity(),c;for(c in this._materials){var b=this._materials[c];b.material.setParameterValues({layerOpacity:a});var d=b.material.getParameters();this._setMaterialTransparentParameter(d,b);b.material.setParameterValues({transparent:d.transparent})}if(0<this._edgeStageObjects.size){var e=this._context.stage.view.ensureEdgeView(),
f=this._getLayerOpacity();this._edgeStageObjects.forEach(function(a){return e.updateAllComponentOpacities(a,[f])})}return!0};e.prototype.layerElevationInfoChanged=function(a,c){return this.updateGraphics3DGraphicElevationInfo(a,c,x.needsElevationUpdates3D)};e.prototype.slicePlaneEnabledChanged=function(a,c){var b=this,d;for(d in this._materials)this._materials[d].material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});if(0<this._edgeStageObjects.size){var e=this._context.stage.view.ensureEdgeView();
a=this._createEdgeMaterial(e);if(h.isSome(a)){var f=[a];this._edgeStageObjects.forEach(function(a){return e.updateAllComponentMaterials(a,f,{slicePlaneEnabled:b._context.slicePlaneEnabled},!1)})}}return!0};e.prototype.pixelRatioChanged=function(a,c){return!0};e.prototype._requiresSymbolVertexColors=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};e.prototype._colorOrTextureUid=function(a){return a?a instanceof k?a.toHex():a.uid:"-"};e.prototype._materialProperties=
function(a,c,b){var d=this._requiresSymbolVertexColors(),e,f,g,h,l,m;c.material&&(f=c.material.color,e=this._colorOrTextureUid(c.material.color),g=c.material.colorTexture,h=this._colorOrTextureUid(c.material.colorTexture),l=c.material.normalTexture,m=this._colorOrTextureUid(c.material.normalTexture));c=!!a.vertexAttributes.color;a=!!a.vertexAttributes.tangent;return{hasSymbolVertexColors:d,hasVertexColors:c,hasVertexTangents:a,color:f,colorTexture:g,normalTexture:l,uid:"vc:"+c+",vt:"+a+",vct"+b+",svc:"+
d+",cmuid:"+e+",ctmuid:"+h+",ntmuid:"+m}};e.prototype._setInternalColorValueParameters=function(a,c){c.diffuse=f.toUnitRGB(a);c.opacity=a.a};e.prototype._getLoadableTextureResource=function(a){return a.data?a.data instanceof HTMLImageElement?a.data.complete?a.data:a.data.src:a.data:a.url};e.prototype._getInternalTextureId=function(a,c){var b=this._getLoadableTextureResource(a);if(b){var d=this._textures[a.uid];d||(d=new G(b,c+"_"+a.uid+"_tex",{mipmap:!0,wrap:this._castTextureWrap(a.wrap),noUnpackFlip:!0}),
this._textures[a.uid]=d,this._context.stage.add(E.ModelContentType.TEXTURE,d));return d.id}};e.prototype._castTextureWrap=function(a){void 0===a&&(a="repeat");return"string"===typeof a?(a=this._castTextureWrapIndividual(a),{s:a,t:a}):{s:this._castTextureWrapIndividual(a.horizontal),t:this._castTextureWrapIndividual(a.vertical)}};e.prototype._castTextureWrapIndividual=function(a){switch(a){case "clamp":return 33071;case "mirror":return 33648;default:return 10497}};e.prototype._setInternalMaterialParameters=
function(a,c,b){a.color&&this._setInternalColorValueParameters(a.color,b);a.colorTexture&&(b.textureId=this._getInternalTextureId(a.colorTexture,c));a.hasVertexTangents&&a.normalTexture&&(b.normalTextureId=this._getInternalTextureId(a.normalTexture,c))};e.prototype._setExternalMaterialParameters=function(a){if(this._isPropertyDriven("color"))a.externalColor=L;else{var c=this.symbolLayer.material?f.toUnitRGBA(this.symbolLayer.material.color):L;a.externalColor=c}if(c=this.symbolLayer.material&&this.symbolLayer.material.colorMixMode)a.colorMixMode=
c};e.prototype._hasTransparentVertexColors=function(a){a=a.vertexAttributes.color;if(!a)return!1;for(var c=3;c<a.length;c+=4)if(255!==a[c])return!0;return!1};e.prototype._getOrCreateMaterial=function(a,c){var b=c.material&&c.material.color,d=c.material&&c.material.colorTexture,b=this._hasTransparentVertexColors(a)||b&&1>b.a||d&&d.transparent;a=this._materialProperties(a,c,b);if(d=this._materials[a.uid])return d.material;var b={material:null,isComponentTransparent:b,alphaMode:c.material?c.material.alphaMode:
"opaque"},d=this._getStageIdHint(),e={specular:T,vertexColors:a.hasVertexColors,symbolColors:a.hasSymbolVertexColors,vertexTangents:a.hasVertexTangents,ambient:T,diffuse:P,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:"none",layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,textureInitTransparent:!0};c.material&&(e.doubleSided=c.material.doubleSided,e.cullFace=c.material.doubleSided?"none":"back",e.textureAlphaCutoff=c.material.alphaCutoff);
this._setInternalMaterialParameters(a,d,e);this._setExternalMaterialParameters(e);this._setMaterialTransparentParameter(e,b);c=new M(e,d+"_"+a.uid+"_mat");b.material=c;this._materials[a.uid]=b;this._context.stage.add(E.ModelContentType.MATERIAL,c);return c};e.prototype._setMaterialTransparentParameter=function(a,c){var b=this._isPropertyDriven("opacity");a.transparent=b||c.isComponentTransparent||1>a.layerOpacity||1>a.opacity||a.externalColor&&1>a.externalColor[3];a.textureAlphaMode="auto"===c.alphaMode?
a.transparent?"maskBlend":"opaque":c.alphaMode};e.prototype._addDebugNormals=function(c,b,d,e){var f,g,h,m,k=b.length,p=c.spatialReference.isWGS84?20015077/180:1,r=.1*Math.max(c.extent.width*p,c.extent.height*p,c.extent.zmax-c.extent.zmin),n=[],t=[];c=[];for(var p=[],u=0;u<k;u++)for(var q=b[u],x=q.data.getAttribute(N.POSITION),w=q.data.getAttribute(N.NORMAL),y=q.data.getIndices(N.POSITION),q=q.data.getIndices(N.NORMAL),x=x.data,w=w.data,v=0;v<y.length;v++){for(var z=3*y[v],B=3*q[v],A=0;3>A;A++)n.push(x[z+
A]);for(A=0;3>A;A++)n.push(x[z+A]+w[B+A]*r);t.push(t.length);t.push(t.length);if(0===v%3){this._calculateFaceNormal(x,y,v,I);this._getFaceVertices(x,y,v,J,U,Q);l.vec3.add(J,J,U);l.vec3.add(J,J,Q);l.vec3.scale(J,J,1/3);for(A=0;3>A;A++)c.push(J[A]);for(A=0;3>A;A++)c.push(J[A]+I[A]*r);p.push(p.length);p.push(p.length)}}k=(f={},f[N.POSITION]={data:new Float64Array(n),size:3},f);f=(g={},g[N.POSITION]=new Uint32Array(t),g);g=new H(k,f,void 0,"line");g=new F(g,"debugVertexNormal");g.singleUse=!0;b.push(g);
d.push(this._debugVertexNormalMaterial);e.push(a.mat4f64.clone(e[0]));k=(h={},h[N.POSITION]={data:new Float64Array(c),size:3},h);f=(m={},m[N.POSITION]=new Uint32Array(p),m);g=new H(k,f,void 0,"line");g=new F(g,"debugFaceNormal");g.singleUse=!0;b.push(g);d.push(this._debugFaceNormalMaterial);e.push(a.mat4f64.clone(e[0]))};e.prototype._createAs3DShape=function(a,c,b,d,e){var f=this;a=a.geometry;if("mesh"!==a.type)return null;var g=this._createGeometryInfo(a,c,d);if(!g)return null;c=g.geometries;var l=
g.materials,m=g.transformations,g=g.objectTransformation;B.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(a,c,l,m);var k=new D({geometries:c,materials:l,transformations:m,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:e},idHint:d});k.objectTransformation=g;var p=function(a){var c=f._context.stage.view.ensureEdgeView();c.removeObject(a);f._edgeStageObjects.delete(a);var b=f._createEdgeMaterial(c);h.isSome(b)&&(f._edgeStageObjects.add(a),c.addObject(a,[b],{slicePlaneEnabled:f._context.slicePlaneEnabled},
!f._context.isAsync,{mergeGeometries:!0}))};p(k);d=function(a,c,b,d,e){a=y.perObjectElevationAligner(a,c,b,d,e);p(k);return a};e=new w(this,k,c,null,null,d,b);e.needsElevationUpdates=x.needsElevationUpdates3D(b.mode);b=a.extent.center.clone();b.z=0;e.elevationContext.centerPointInElevationSR=b;e.alignedTerrainElevation=d(e,e.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper,this._context.featureExpressionInfoContext);return e};e.prototype._createComponentNormals=function(a,
c,b,e){var f=b.shading||"flat";switch(f){case "source":return this._createComponentNormalsSource(a,c,b,e);case "flat":return this._createComponentNormalsFlat(a,b,e);case "smooth":return this._createComponentNormalsSmooth(a,b,e);default:d.neverReached(f)}};e.prototype._createComponentNormalsSource=function(a,c,b,d){if(!c)return this._createComponentNormalsFlat(a,b,d);var e=!1;if(!b.trustSourceNormals)for(b=0;b<d.length;b+=3){this._calculateFaceNormal(a,d,b,I);for(var f=0;3>f;f++){var g=3*d[b+f];J[0]=
c[g+0];J[1]=c[g+1];J[2]=c[g+2];0>l.vec3.dot(I,J)&&(c[g+0]=-c[g+0],c[g+1]=-c[g+1],c[g+2]=-c[g+2],e=!0)}}return{normals:c,indices:d,didFlipNormals:e}};e.prototype._createComponentNormalsFlat=function(a,c,b){c=new Float32Array(b.length);for(var d=new Uint32Array(3*b.length),e=0;e<b.length;e+=3)for(var f=this._calculateFaceNormal(a,b,e,I),g=0;3>g;g++)c[e+g]=f[g],d[e+g]=e/3;return{normals:c,indices:d,didFlipNormals:!1}};e.prototype._createComponentNormalsSmooth=function(a,c,b){c={};for(var d=0;d<b.length;d+=
3)for(var e=this._calculateFaceNormal(a,b,d,I),f=0;3>f;f++){var h=b[d+f],m=c[h];m||(m={normal:g.vec3f64.create(),count:0},c[h]=m);l.vec3.add(m.normal,m.normal,e);m.count++}a=new Float32Array(3*b.length);e=new Uint32Array(3*b.length);for(d=0;d<b.length;d++){h=b[d];m=c[h];1!==m.count&&(l.vec3.normalize(m.normal,m.normal),m.count=1);for(f=0;3>f;f++)a[3*d+f]=m.normal[f];e[d]=d}return{normals:a,indices:e,didFlipNormals:!1}};e.prototype._getFaceVertices=function(a,c,b,d,e,f){var g=3*c[b+0],h=3*c[b+1];c=
3*c[b+2];d[0]=a[g+0];d[1]=a[g+1];d[2]=a[g+2];e[0]=a[h+0];e[1]=a[h+1];e[2]=a[h+2];f[0]=a[c+0];f[1]=a[c+1];f[2]=a[c+2]};e.prototype._calculateFaceNormal=function(a,c,b,d){this._getFaceVertices(a,c,b,J,U,Q);l.vec3.subtract(U,U,J);l.vec3.subtract(Q,Q,J);l.vec3.cross(J,U,Q);l.vec3.normalize(d,J);return d};e.prototype._getOrCreateComponents=function(a){return a.components?a.components:ca};e.prototype._createPositionBuffer=function(a){var c=a.vertexAttributes.position,b=new Float64Array(c.length);x.reproject(a.vertexAttributes.position,
0,a.spatialReference,b,0,this._context.renderSpatialReference,c.length/3);return b};e.prototype._createNormalBuffer=function(a,c){var b=a.vertexAttributes.normal;if(!b)return null;if("local"===this._context.layerView.view.viewingMode)return b;var d=a.vertexAttributes.position,e=new Float32Array(b.length);return r.projectNormalToECEF(b,d,c,a.spatialReference,e)};e.prototype._createTangentBuffer=function(a,c){var b=a.vertexAttributes.tangent;if(!b)return null;if("local"===this._context.layerView.view.viewingMode)return b;
var d=a.vertexAttributes.position,e=new Float32Array(b.length);return r.projectTangentToECEF(b,d,c,a.spatialReference,e)};e.prototype._createColorBuffer=function(a){return a.vertexAttributes.color};e.prototype._createSymbolColorBuffer=function(a){if(this._requiresSymbolVertexColors()){a=this._getVertexOpacityAndColor(a);var c=this.symbolLayer.material&&this.symbolLayer.material.colorMixMode||null,b=new Uint8Array(4);A.encodeSymbolColor(a,c,b);return b}return null};e.prototype._createColorIndices=
function(a,c){a=new Uint32Array(c.length);for(c=0;c<a.length;c++)a[c]=0;return a};e.prototype._createBuffers=function(a,c){var b=a.vertexAttributes&&a.vertexAttributes.position;if(!b)return this._logWarning("Mesh geometry must contain position vertex attributes"),null;var d=a.vertexAttributes.normal,e=a.vertexAttributes.uv,f=a.vertexAttributes.tangent;if(d&&d.length!==b.length)return this._logWarning("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;
if(f&&f.length/4!==b.length/3)return this._logWarning("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(e&&e.length/2!==b.length/3)return this._logWarning("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;b=this._createPositionBuffer(a);d=this._createColorBuffer(a);c=this._createSymbolColorBuffer(c);var f=this._createNormalBuffer(a,b),g=this._createTangentBuffer(a,b);a=this._transformCenterLocal(a,b,f);
return{positionBuffer:b,normalBuffer:f,tangentBuffer:g,uvBuffer:e,colorBuffer:d,symbolColorBuffer:c,objectTransformation:a}};e.prototype._transformCenterLocal=function(b,d,e){var f=b.extent.center,g=this._context.renderSpatialReference;R[0]=f.x;R[1]=f.y;R[2]=0;f=a.mat4f64.create();C.computeLinearTransformation(b.spatialReference,R,f,g);c.mat4.invert(V,f);for(b=0;b<d.length;b+=3)J[0]=d[b+0],J[1]=d[b+1],J[2]=d[b+2],l.vec3.transformMat4(J,J,V),d[b+0]=J[0],d[b+1]=J[1],d[b+2]=J[2];if(e)for(m.mat3.fromMat4(X,
f),m.mat3.transpose(X,X),b=0;b<e.length;b+=3)J[0]=e[b+0],J[1]=e[b+1],J[2]=e[b+2],l.vec3.transformMat3(J,J,X),e[b+0]=J[0],e[b+1]=J[1],e[b+2]=J[2];return f};e.prototype._validateFaces=function(a,c){a=a.vertexAttributes.position.length/3;if(c=c.faces){for(var b=-1,d=0;d<c.length;d++){var e=c[d];e>b&&(b=e)}if(a<=b)return this._logWarning("Vertex index "+b+" is out of bounds of the mesh position buffer"),!1}else if(0!==a%3)return this._logWarning("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),
!1;return!0};e.prototype._getOrCreateFaces=function(a,c){if(c.faces)return c.faces;a=new Uint32Array(a.vertexAttributes.position.length/3);for(c=0;c<a.length;c++)a[c]=c;return a};e.prototype._isOutsideClippingArea=function(a){if(!this._context.clippingExtent)return!1;var c=a.vertexAttributes&&a.vertexAttributes.position;if(!c)return!1;var b=this._context.elevationProvider.spatialReference,d=c.length/3;a.spatialReference.equals(b)||(c=new Float64Array(c.length),x.reproject(a.vertexAttributes.position,
0,a.spatialReference,c,0,b,d));x.computeBoundingBox(c,0,d,W);return x.boundingBoxClipped(W,this._context.clippingExtent)};e.prototype._createGeometryInfo=function(c,b,d){var e,f;if(!t.canProject(c,this._context.layerView.view.spatialReference))return this._logWarning("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(c))return null;var g=this._createBuffers(c,b);if(!g)return null;b=g.positionBuffer;for(var h=g.uvBuffer,l=g.colorBuffer,m=g.symbolColorBuffer,
k=g.normalBuffer,p=g.tangentBuffer,g=g.objectTransformation,r=[],n=[],u=[],q=!1,x=0,w=this._getOrCreateComponents(c);x<w.length;x++){var y=w[x];if(!this._validateFaces(c,y))return null;var v=this._getOrCreateFaces(c,y);if(0!==v.length){var z=this._createComponentNormals(b,k,y,v);z.didFlipNormals&&(q=!0);var A=(e={},e[N.POSITION]={size:3,data:b},e[N.NORMAL]={size:3,data:z.normals},e),z=(f={},f[N.POSITION]=v,f[N.NORMAL]=z.indices,f);l&&(A[N.COLOR]={size:4,data:l},z[N.COLOR]=v);m&&(A[N.SYMBOLCOLOR]=
{size:4,data:m},z[N.SYMBOLCOLOR]=this._createColorIndices(y,v));c.vertexAttributes.uv&&(A[N.UV0]={size:2,data:h},z[N.UV0]=v);c.vertexAttributes.tangent&&(A[N.TANGENT]={size:4,data:p},z[N.TANGENT]=v);v=new H(A,z);v=new F(v,d+"_mesh");v.singleUse=!0;r.push(v);n.push(a.mat4f64.create());u.push(this._getOrCreateMaterial(c,y))}}q&&this._logWarning("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");
return{geometries:r,transformations:n,materials:u,objectTransformation:g}};e.prototype._createEdgeMaterial=function(a){var c={opacity:this._getLayerOpacity()};return z.createMaterial(a,this.symbolLayer,c)};return e}(v.default);b.Graphics3DMeshFillSymbolLayer=q;var P=[1,1,1],L=[1,1,1,1],T=[0,0,0],R=g.vec3f64.create(),J=g.vec3f64.create(),U=g.vec3f64.create(),Q=g.vec3f64.create(),I=g.vec3f64.create(),V=a.mat4f64.create(),X=p.mat3f64.create(),W=e.create(),ca=[new u];b.default=q})},"esri/geometry/support/MeshComponent":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ./MeshMaterial ./MeshVertexAttributes".split(" "),
function(q,b,n,f,k,d,h,m,p,c){var a=h.getLogger("esri.geometry.support.MeshComponent");return function(b){function g(a){a=b.call(this)||this;a.faces=null;a.material=null;a.shading="source";a.trustSourceNormals=!1;return a}n(g,b);e=g;g.prototype.castFaces=function(b){return c.castArray(b,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},a)};g.prototype.clone=function(){return new e({faces:d.clone(this.faces),shading:this.shading,material:d.clone(this.material),trustSourceNormals:this.trustSourceNormals})};
g.prototype.cloneWithSharedTextures=function(){return new e({faces:d.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithSharedTextures():null,trustSourceNormals:this.trustSourceNormals})};var e;f([m.property({json:{write:!0}})],g.prototype,"faces",void 0);f([m.cast("faces")],g.prototype,"castFaces",null);f([m.property({type:p.MeshMaterial,json:{write:!0}})],g.prototype,"material",void 0);f([m.property({type:String,json:{write:!0}})],g.prototype,"shading",void 0);
f([m.property({type:Boolean})],g.prototype,"trustSourceNormals",void 0);return g=e=f([m.subclass("esri.geometry.support.MeshComponent")],g)}(m.declared(k))})},"esri/geometry/support/MeshMaterial":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ../../core/accessorSupport/ensureType ./ImageMeshColor ./MeshTexture ./ValueMeshColor".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g){function e(){u.warn('Assigning ImageMeshColor to "MeshMaterial.color" is deprecated. Assigning to "MeshMaterial.colorTexture" instead.')}Object.defineProperty(b,"__esModule",{value:!0});var u=m.getLogger("esri.geometry.support.MeshMaterial");q=function(b){function d(a){a=b.call(this)||this;a.color=null;a.colorTexture=null;a.normalTexture=null;a.alphaMode="auto";a.alphaCutoff=.5;a.doubleSided=!0;return a}n(d,b);m=d;d.prototype.castColor=function(b){if(!b)return b;
if(Array.isArray(b))return new k(b);if(b instanceof k||b instanceof l)return b;if("string"===typeof b){if(t.test(b)||k.named[b])return new k(b);e();this.colorTexture=new l({url:b});return null}return b instanceof HTMLImageElement||b instanceof HTMLCanvasElement||b instanceof ImageData?(e(),this.colorTexture=new l({data:b}),null):b instanceof a?(e(),this.colorTexture=new l({url:b.url,data:b.data}),null):"image"===b.type?(e(),this.colorTexture=new l(b),null):b instanceof g?(u.warn('Assigning ValueMeshColor to "MeshMaterial.color" is deprecated. Automatically converting it to esri.Color.'),
new k(b.value)):c.ensureType(k,b)};d.prototype.castColorTexture=function(a){return a?"string"===typeof a?new l({url:a}):a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof ImageData?new l({data:a}):c.ensureType(l,a):a};d.prototype.readColorTexture=function(a,c,b){if(a)return new l(a)};d.prototype.castNormalTexture=function(a){return a?"string"===typeof a?new l({url:a}):a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof ImageData?new l({data:a}):c.ensureType(l,
a):a};d.prototype.readNormalTexture=function(a,c,b){if(a)return new l(a)};d.prototype.clone=function(){return new m({color:h.clone(this.color),colorTexture:h.clone(this.colorTexture),normalTexture:h.clone(this.normalTexture),alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided})};d.prototype.cloneWithSharedTextures=function(){return new m({color:h.clone(this.color),colorTexture:this.colorTexture,normalTexture:this.normalTexture,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,
doubleSided:this.doubleSided})};var m;f([p.property({type:k,json:{write:!0}})],d.prototype,"color",void 0);f([p.cast("color")],d.prototype,"castColor",null);f([p.property({json:{write:!0}})],d.prototype,"colorTexture",void 0);f([p.cast("colorTexture")],d.prototype,"castColorTexture",null);f([p.reader("colorTexture")],d.prototype,"readColorTexture",null);f([p.property({json:{write:!0}})],d.prototype,"normalTexture",void 0);f([p.cast("normalTexture")],d.prototype,"castNormalTexture",null);f([p.reader("normalTexture")],
d.prototype,"readNormalTexture",null);f([p.property({json:{write:!0}})],d.prototype,"alphaMode",void 0);f([p.property({json:{write:!0}})],d.prototype,"alphaCutoff",void 0);f([p.property({json:{write:!0}})],d.prototype,"doubleSided",void 0);return d=m=f([p.subclass("esri.geometry.support.MeshMaterial")],d)}(p.declared(d));b.MeshMaterial=q;var t=/^\s*(#|rgba?\()/;b.default=q})},"esri/geometry/support/ImageMeshColor":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/compilerUtils ../../core/Identifiable ../../core/Logger ../../core/urlUtils ../../core/accessorSupport/decorators ./MeshColor ../../views/support/screenshotUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a){var l=h.getLogger("esri.geometry.support.ImageMeshColor");return function(c){function b(a){a=c.call(this)||this;a.type="image";l.warn("esri/geometry/support/ImageMeshColor is deprecated since version 4.11. Use esri/geometry/support/MeshTexture instead.");return a}n(b,c);d=b;Object.defineProperty(b.prototype,"url",{get:function(){return this._get("url")||null},set:function(a){this._set("url",a);a&&this._set("data",null)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"data",{get:function(){return this._get("data")||null},set:function(a){this._set("data",a);a&&this._set("url",null)},enumerable:!0,configurable:!0});b.prototype.writeData=function(a,c,b,d){a instanceof HTMLImageElement?a={type:"image-element",src:m.toJSON(a.src,d)}:a instanceof HTMLCanvasElement?(a=a.getContext("2d").getImageData(0,0,a.width,a.height),a={type:"canvas-element",imageData:this.encodeImageData(a)}):a={type:"image-data",imageData:this.encodeImageData(a)};c[b]=a};b.prototype.readData=function(a,
c){switch(a.type){case "image-element":return c=new Image,c.src=a.src,c;case "canvas-element":return a=this.decodeImageData(a.imageData),c=document.createElement("canvas"),c.width=a.width,c.height=a.height,c.getContext("2d").putImageData(a,0,0),c;case "image-data":return this.decodeImageData(a.imageData);default:k.neverReached(a)}};Object.defineProperty(b.prototype,"transparent",{get:function(){var a=this.data,c=this.url;return a instanceof HTMLCanvasElement?this.imageDataContainsTransparent(a.getContext("2d").getImageData(0,
0,a.width,a.height)):a instanceof ImageData?this.imageDataContainsTransparent(a):c&&(a=c.substr(c.length-4,4).toLowerCase(),c=c.substr(0,15).toLocaleLowerCase(),".png"===a||"data:image/png;"===c)?!0:!1},set:function(a){null!=a?this._override("transparent",a):this._clearOverride("transparent")},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new d({url:this.url,data:this.data})};b.prototype.encodeImageData=function(a){for(var c="",b=0;b<a.data.length;b++)c+=String.fromCharCode(a.data[b]);
return{data:btoa(c),width:a.width,height:a.height}};b.prototype.decodeImageData=function(c){for(var b=atob(c.data),d=new Uint8ClampedArray(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return a.wrapImageData(d,c.width,c.height)};b.prototype.imageDataContainsTransparent=function(a){for(var c=3;c<a.data.length;c+=4)if(255!==a.data[c])return!0;return!1};var d;f([p.property()],b.prototype,"type",void 0);f([p.property({type:String,json:{write:m.write}})],b.prototype,"url",null);f([p.property({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),
p.property()],b.prototype,"data",null);f([p.writer("data")],b.prototype,"writeData",null);f([p.reader("data")],b.prototype,"readData",null);f([p.property({type:Boolean,dependsOn:["data","url"],json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],b.prototype,"transparent",null);return b=d=f([p.subclass("esri.geometry.support.ImageMeshColor")],b)}(p.declared(c.default,d.Identifiable))})},"esri/geometry/support/MeshColor":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),
function(q,b,n,f,k,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function h(d){return b.call(this)||this}n(h,b);h.prototype.clone=function(){throw Error("not implemented");};f([d.property({readOnly:!0,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0,enabled:!0}}})],h.prototype,"type",void 0);return h=f([d.subclass("esri.geometry.support.MeshColor")],h)}(d.declared(k));b.MeshColor=q;b.default=q})},"esri/geometry/support/MeshTexture":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/compilerUtils ../../core/Identifiable ../../core/JSONSupport ../../core/urlUtils ../../core/accessorSupport/decorators ../../views/support/screenshotUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c){return function(a){function b(c){c=a.call(this)||this;c.wrap="repeat";return c}n(b,a);d=b;Object.defineProperty(b.prototype,"url",{get:function(){return this._get("url")||null},set:function(a){this._set("url",a);a&&this._set("data",null)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"data",{get:function(){return this._get("data")||null},set:function(a){this._set("data",a);a&&this._set("url",null)},enumerable:!0,configurable:!0});b.prototype.writeData=
function(a,c,b,d){a instanceof HTMLImageElement?a={type:"image-element",src:m.toJSON(a.src,d)}:a instanceof HTMLCanvasElement?(a=a.getContext("2d").getImageData(0,0,a.width,a.height),a={type:"canvas-element",imageData:this.encodeImageData(a)}):a={type:"image-data",imageData:this.encodeImageData(a)};c[b]=a};b.prototype.readData=function(a,c){switch(a.type){case "image-element":return c=new Image,c.src=a.src,c;case "canvas-element":return a=this.decodeImageData(a.imageData),c=document.createElement("canvas"),
c.width=a.width,c.height=a.height,c.getContext("2d").putImageData(a,0,0),c;case "image-data":return this.decodeImageData(a.imageData);default:k.neverReached(a)}};Object.defineProperty(b.prototype,"transparent",{get:function(){var a=this.data,c=this.url;return a instanceof HTMLCanvasElement?this.imageDataContainsTransparent(a.getContext("2d").getImageData(0,0,a.width,a.height)):a instanceof ImageData?this.imageDataContainsTransparent(a):c&&(a=c.substr(c.length-4,4).toLowerCase(),c=c.substr(0,15).toLocaleLowerCase(),
".png"===a||"data:image/png;"===c)?!0:!1},set:function(a){null!=a?this._override("transparent",a):this._clearOverride("transparent")},enumerable:!0,configurable:!0});b.prototype.clone=function(){return new d({url:this.url,data:this.data,wrap:this.cloneWrap()})};b.prototype.cloneWrap=function(){return"string"===typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};b.prototype.encodeImageData=function(a){for(var c="",b=0;b<a.data.length;b++)c+=String.fromCharCode(a.data[b]);
return{data:btoa(c),width:a.width,height:a.height}};b.prototype.decodeImageData=function(a){for(var b=atob(a.data),d=new Uint8ClampedArray(b.length),e=0;e<b.length;e++)d[e]=b.charCodeAt(e);return c.wrapImageData(d,a.width,a.height)};b.prototype.imageDataContainsTransparent=function(a){for(var c=3;c<a.data.length;c+=4)if(255!==a.data[c])return!0;return!1};var d;f([p.property({type:String,json:{write:m.write}})],b.prototype,"url",null);f([p.property({json:{write:{overridePolicy:function(){return{enabled:!this.url}}}}}),
p.property()],b.prototype,"data",null);f([p.writer("data")],b.prototype,"writeData",null);f([p.reader("data")],b.prototype,"readData",null);f([p.property({type:Boolean,dependsOn:["data","url"],json:{write:{overridePolicy:function(){return{enabled:this._isOverridden("transparent")}}}}})],b.prototype,"transparent",null);f([p.property({json:{write:!0}})],b.prototype,"wrap",void 0);return b=d=f([p.subclass("esri.geometry.support.MeshTexture")],b)}(p.declared(h,d.Identifiable))})},"esri/geometry/support/ValueMeshColor":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../Color ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators ./MeshColor".split(" "),
function(q,b,n,f,k,d,h,m,p){var c=h.getLogger("esri.geometry.support.ValueMeshColor");return function(a){function b(b){b=a.call(this)||this;b.type="value";b.value=null;c.warn("esri/geometry/support/ValueMeshColor is deprecated since version 4.11. Use esri/Color instead.");return b}n(b,a);g=b;b.prototype.clone=function(){return new g({value:d.clone(this.value)})};var g;f([m.property()],b.prototype,"type",void 0);f([m.property({type:k})],b.prototype,"value",void 0);return b=g=f([m.subclass("esri.geometry.support.ValueMeshColor")],
b)}(m.declared(p.default))})},"esri/geometry/support/MeshVertexAttributes":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators".split(" "),function(q,b,n,f,k,d,h,m){function p(a,c,b,d){var e=c.loggerTag;c=c.stride;return 0!==a.length%c?(d.error(e,"Invalid array length, expected a multiple of "+c),new b([])):a}function c(a,c,b,d,f){if(!a)return a;
if(a instanceof c)return p(a,d,c,f);for(var e=0;e<b.length;e++)if(a instanceof b[e])return p(new c(a),d,c,f);if(Array.isArray(a))return p(new c(a),d,c,f);b=b.map(function(a){return"'"+a.name+"'"});f.error("Failed to set property, expected one of "+b+", but got "+a.constructor.name);return new c([])}function a(a,c,b){for(var d=Array(a.length),e=0;e<a.length;e++)d[e]=a[e];c[b]=d}Object.defineProperty(b,"__esModule",{value:!0});var l=h.getLogger("esri.geometry.support.MeshVertexAttributes");q=function(b){function e(a){a=
b.call(this)||this;a.color=null;a.position=new Float64Array(0);a.uv=null;a.normal=null;a.tangent=null;return a}n(e,b);g=e;e.prototype.castColor=function(a){return c(a,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},l)};e.prototype.castPosition=function(a){a&&a instanceof Float32Array&&l.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return c(a,Float64Array,[Float32Array],
{loggerTag:".position\x3d",stride:3},l)};e.prototype.castUv=function(a){return c(a,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},l)};e.prototype.castNormal=function(a){return c(a,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},l)};e.prototype.castTangent=function(a){return c(a,Float32Array,[Float64Array],{loggerTag:".tangent\x3d",stride:4},l)};e.prototype.clone=function(){return new g({position:d.clone(this.position),uv:d.clone(this.uv),normal:d.clone(this.normal),tangent:d.clone(this.tangent)})};
var g;f([m.property({json:{write:a}})],e.prototype,"color",void 0);f([m.cast("color")],e.prototype,"castColor",null);f([m.property({nonNullable:!0,json:{write:a}})],e.prototype,"position",void 0);f([m.cast("position")],e.prototype,"castPosition",null);f([m.property({json:{write:a}})],e.prototype,"uv",void 0);f([m.cast("uv")],e.prototype,"castUv",null);f([m.property({json:{write:a}})],e.prototype,"normal",void 0);f([m.cast("normal")],e.prototype,"castNormal",null);f([m.property({json:{write:a}})],
e.prototype,"tangent",void 0);f([m.cast("tangent")],e.prototype,"castTangent",null);return e=g=f([m.subclass("esri.geometry.support.MeshVertexAttributes")],e)}(m.declared(k));b.MeshVertexAttributes=q;b.castArray=c;b.default=q})},"esri/geometry/support/meshUtils/projection":function(){define("require exports ../../../core/Logger ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../views/3d/support/projectionUtils ../../../views/3d/support/buffer/BufferView".split(" "),
function(q,b,n,f,k,d,h,m,p,c){function a(a,c,b,d,l,m){if(c){var k=b.count;if(l.isWGS84)for(l=0;l<k;l++)d.getVec(l,g),c.getVec(l,e),p.computeLinearTransformation(p.SphericalECEFSpatialReference,g,u,p.SphericalECEFSpatialReference),f.mat3.fromMat4(t,u),1===a&&f.mat3.transpose(t,t),h.vec3.transformMat3(e,e,t),m.setVec(l,e);else for(l=0;l<k;l++){d.getVec(l,g);c.getVec(l,e);p.computeLinearTransformation(p.SphericalECEFSpatialReference,g,u,p.SphericalECEFSpatialReference);f.mat3.fromMat4(t,u);var r=p.webMercator.y2lat(b.get(l,
1)),r=Math.cos(r);0===a&&(r=1/r);t[0]*=r;t[1]*=r;t[2]*=r;t[3]*=r;t[4]*=r;t[5]*=r;1===a&&f.mat3.transpose(t,t);h.vec3.transformMat3(e,e,t);h.vec3.normalize(e,e);m.setVec(l,e)}return m}}Object.defineProperty(b,"__esModule",{value:!0});var l=n.getLogger("esri.geometry.support.meshUtils.normalProjection");b.projectNormalToECEF=function(b,d,e,f,g){if(!f.isWebMercator&&!f.isWGS84)return l.error("Cannot convert PCS spatial reference buffer to ECEF"),g;a(0,new c.BufferViewVec3f(b.buffer,b.byteOffset),new c.BufferViewVec3f64(d.buffer,
d.byteOffset),new c.BufferViewVec3f64(e.buffer,e.byteOffset),f,new c.BufferViewVec3f(g.buffer,g.byteOffset));return g};b.projectNormalFromECEF=function(b,d,e,f,g){if(!f.isWebMercator&&!f.isWGS84)return l.error("Cannot convert to PCS spatial reference buffer from ECEF"),g;a(1,new c.BufferViewVec3f(b.buffer,b.byteOffset),new c.BufferViewVec3f64(d.buffer,d.byteOffset),new c.BufferViewVec3f64(e.buffer,e.byteOffset),f,new c.BufferViewVec3f(g.buffer,g.byteOffset));return g};b.projectToECEF=function(a,c,
b){p.bufferToBuffer(a,c,0,b,p.SphericalECEFSpatialReference,0,a.length/3);return b};b.projectFromECEF=function(a,c,b){p.bufferToBuffer(a,p.SphericalECEFSpatialReference,0,c,b,0,a.length/3);return c};b.transformBufferInPlace=function(a,c,b){void 0===b&&(b=!1);if(a)for(var d=0;d<a.length;d+=3){for(var e=0;3>e;e++)g[e]=a[d+e];h.vec3.transformMat4(g,g,c);b&&h.vec3.normalize(g,g);for(e=0;3>e;e++)a[d+e]=g[e]}};b.projectTangentToECEF=function(b,d,e,f,g){if(!f.isWebMercator&&!f.isWGS84)return l.error("Cannot convert PCS spatial reference buffer to ECEF"),
g;a(0,new c.BufferViewVec3f(b.buffer,b.byteOffset,16),new c.BufferViewVec3f64(d.buffer,d.byteOffset),new c.BufferViewVec3f64(e.buffer,e.byteOffset),f,new c.BufferViewVec3f(g.buffer,g.byteOffset,16));for(d=3;d<b.length;d+=4)g[d]=b[d];return g};b.projectTangentFromECEF=function(b,d,e,f,g){if(!f.isWebMercator&&!f.isWGS84)return l.error("Cannot convert to PCS spatial reference buffer from ECEF"),g;a(1,new c.BufferViewVec3f(b.buffer,b.byteOffset,16),new c.BufferViewVec3f64(d.buffer,d.byteOffset),new c.BufferViewVec3f64(e.buffer,
e.byteOffset),f,new c.BufferViewVec3f(g.buffer,g.byteOffset,16));for(d=3;d<b.length;d+=4)g[d]=b[d];return g};var g=m.vec3f64.create(),e=m.vec3f64.create(),u=d.mat4f64.create(),t=k.mat3f64.create()})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.encodeSymbolColor=function(b,d,p,c){void 0===c&&(c=0);null==b||"ignore"===d?(p[c+0]=255,p[c+1]=255,p[c+2]=255,p[c+3]=255):(p[c+0]=Math.floor(255*b[0]),
p[c+1]=Math.floor(255*b[1]),p[c+2]=Math.floor(255*b[2]),b=Math.floor(b[3]*n),p[c+3]=0===b?0:"tint"===d?b:"replace"===d?b+f:b+k)};b.decodeSymbolColor=function(b,d){void 0===d&&(d=0);var h=0,c="multiply",a=b[d+3];a>k?h=(a-k)/n:a>f?(h=(a-f)/n,c="replace"):0<a&&(h=a/n,c="tint");return{color:[b[d+0]/255,b[d+1]/255,b[d+2]/255,h],colorMixMode:c}};b.isOpaqueSymbolColor=function(b,m){void 0===m&&(m=0);b=b[m+3];return b===f||b===k||b===d};var n=85,f=n,k=2*n,d=3*n})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/errors/CancelError ../../../../Color ../../../../core/asyncUtils ../../../../core/lang ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ./ElevationAligners ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lodResourceUtils ./objectResourceUtils ./primitiveObjectSymbolUtils ./symbolComplexity ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C,E,F,H,D,G,K){Object.defineProperty(b,"__esModule",{value:!0});q=function(c){function b(a,b,d,e){a=c.call(this,a,b,d,e)||this;a._optionalFields=[];a._instanceIndexToGraphicUid=new Map;d=a._getStageIdHint();if(!a._isPropertyDriven("size")&&(e=x.validateSymbolLayerSize(a.symbolLayer)))return a._logWarning(e),a.reject(),a;b.resource&&b.resource.href?a._prepareModelResources(b.resource.href,d):a._preparePrimitiveResources(b.resource?b.resource.primitive:
u.defaultPrimitive,d);return a}n(b,c);b.prototype.getCachedSize=function(){var a=this._symbolSize;return{width:a[0],depth:a[1],height:a[2]}};Object.defineProperty(b.prototype,"lodRenderer",{get:function(){return this._lodRenderer},enumerable:!0,configurable:!0});b.prototype._preparePrimitiveResources=function(a,c){if(A.isValidPrimitive(a)){var b=this.symbolLayer;this._resourceBoundingBox=e.create(A.primitiveBoundingBox(a));this._resourceSize=l.vec3f64.fromArray(e.size(this._resourceBoundingBox));
this._symbolSize=l.vec3f64.fromArray(x.computeSizeWithResourceSize(this._resourceSize,b));var d=this._getMaterialOpacity(),d={specular:[0,0,0],opacity:d,transparent:1>d||this._isPropertyDriven("opacity"),instanced:["transformation"],ambient:M,diffuse:M,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},f=this.symbol;if("point-3d"===f.type&&f.verticalOffset){var f=f.verticalOffset,g=f.minWorldLength,p=f.maxWorldLength;d.verticalOffset={screenLength:m.pt2px(f.screenLength),
minWorldLength:g||0,maxWorldLength:null!=p?p:Infinity};d.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(d.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._isPropertyDriven("color")?d.externalColor=O:(b=b.material?k.toUnitRGBA(b.material.color):O,d.externalColor=b);this._fastUpdates=C.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(h.mixin(d,this._fastUpdates.materialParameters),
d.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(d.instanced.push("color"),this._optionalFields.push("color"));b=new K(d,c+"_objectmat");this._lodResources=A.primitiveLodResources(a,b,c);this._originalOpacities=G.materialsFromLodResources(this._lodResources).map(function(){return 1});this._lodResources?(this.finalizeSymbolResources(),this.initializeLodRenderer(),this.complexity=this.computeComplexity(),this.resolve()):(this._logWarning("Unknown object symbol primitive: "+
a),this.reject())}else this._logWarning("Unknown object symbol primitive: "+a),this.reject()};b.prototype._prepareModelResources=function(a,c){var b=this,g=["transformation"];c={materialParamsMixin:{instanced:g,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},idHint:c,streamDataSupplier:this._context.streamDataSupplier};this._fastUpdates=C.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?
(h.mixin(c.materialParamsMixin,this._fastUpdates.materialParameters),g.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(g.push("color"),this._optionalFields.push("color"));g=this.symbol;if("point-3d"===g.type&&g.verticalOffset){var g=g.verticalOffset,k=g.minWorldLength,p=g.maxWorldLength;c.materialParamsMixin.verticalOffset={screenLength:m.pt2px(g.screenLength),minWorldLength:k||0,maxWorldLength:null!=p?p:Infinity};c.materialParamsMixin.castShadows=
!1}this._symbolLoaderPromise=d.safeCast(z.fetch(a,c));this._symbolLoaderPromise.then(function(a){b._symbolLoaderPromise=null;if(!b.isRejected()){var c=v.makeLodResources(a.lods);v.fillEstimatedMinScreenSpaceRadius(c);c.levels.sort(function(a,c){return a.minScreenSpaceRadius-c.minScreenSpaceRadius});c.levels[0].minScreenSpaceRadius=Math.min(2,c.levels[0].minScreenSpaceRadius);b._lodResources=c;var d=b._context,f=b._getExternalColorParameters(b.symbolLayer.material),g=b._getMaterialOpacity(),h=b._isPropertyDriven("opacity"),
c=G.materialsFromLodResources(b._lodResources);b._originalOpacities=c.map(function(a){return a.getParameters().opacity||1});c.forEach(function(a){var c=a.getParameters();a.setParameterValues(f);var b=c.opacity*g;a.setParameterValues({opacity:b,transparent:1>b||h||c.transparent});d.screenSizePerspectiveEnabled&&a.setParameterValues({screenSizePerspective:d.sharedResources.screenSizePerspectiveSettings})});b._resourceBoundingBox=a.referenceBoundingBox;b._resourceSize=l.vec3f64.fromArray(e.size(b._resourceBoundingBox));
b._pivotOffset=l.vec3f64.fromArray(b._lodResources.levels[0].pivotOffset);b._symbolSize=l.vec3f64.fromArray(x.computeSizeWithResourceSize(b._resourceSize,b.symbolLayer));C.updateFastSymbolUpdatesState(b._fastUpdates,b._context.renderer,b._fastVisualVariableConvertOptions())&&c.forEach(function(a){return a.setParameterValues(b._fastUpdates.materialParameters)});b.finalizeSymbolResources();b.initializeLodRenderer();b.complexity=b.computeComplexity();b.resolve()}},function(a){b._symbolLoaderPromise=
null;if(!b.isFulfilled()){if(!(a instanceof f)){var c="ObjectSymbol3DLayer failed to load";a&&a.message&&(c+=" ("+a.message+")");b._logWarning(c)}b.reject()}})};b.prototype.finalizeSymbolResources=function(){var a=this._context.stage;this._materials=G.materialsFromLodResources(this._lodResources);this._materials.forEach(function(c){a.add(F.ModelContentType.MATERIAL,c)});this._textures=G.texturesFromLodResources(this._lodResources);this._textures.forEach(function(c){a.add(F.ModelContentType.TEXTURE,
c)});this._geometries=G.geometriesFromLodResources(this._lodResources);this._geometries.forEach(function(c){a.add(F.ModelContentType.GEOMETRY,c)})};b.prototype.initializeLodRenderer=function(){var a=this,c=this._context.stage;this._lodRenderer=new D.LodRenderer(this._lodResources,this._optionalFields,{layerUid:this._context.layer.uid,graphicUid:function(c){return a._instanceIndexToGraphicUid.get(c)}},this._fastUpdates.enabled?{applyTransform:function(c,b,d){c.getFeatureAttribute(b,R);p.mat4.copy(d,
C.evaluateModelTransform(a._fastUpdates.materialParameters,R,d))},scaleFactor:function(c,b,d){b.getFeatureAttribute(d,R);return C.evaluateModelTransformScale(c,a._fastUpdates.materialParameters,R)}}:null);this._lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;c.addRenderPlugin(this._lodRenderer.slots,this._lodRenderer)};b.prototype._getExternalColorParameters=function(a){var c={};this._isPropertyDriven("color")?c.externalColor=O:a&&a.color?c.externalColor=k.toUnitRGBA(a.color):(c.externalColor=
O,c.colorMixMode="ignore");return c};b.prototype.destroy=function(){c.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._symbolLoaderPromise&&this._symbolLoaderPromise.cancel();var a=this._context.stage;this._lodRenderer&&(a.removeRenderPlugin(this._lodRenderer),this._lodRenderer.destroy());this._materials&&this._materials.forEach(function(c){return a.remove(F.ModelContentType.MATERIAL,c.id)});this._textures&&this._textures.forEach(function(c){return a.remove(F.ModelContentType.TEXTURE,
c.id)});this._geometries&&this._geometries.forEach(function(c){return a.remove(F.ModelContentType.GEOMETRY,c.id)})};b.prototype.createGraphics3DGraphic=function(a){var c=a.graphic;if(!this._validateGeometry(c.geometry))return null;var b=y.placePointOnGeometry(c.geometry);if(!b)return this._logWarning("unsupported geometry type for icon symbol: "+c.geometry.type),null;var d=this.getGraphicElevationContext(c);return this._createAs3DShape(c,b,a.renderingInfo,d,c.uid)};b.prototype.notifyDestroyGraphicLayer=
function(a){this._instanceIndexToGraphicUid.delete(a.instanceIndex)};b.prototype.graphicLayerToGraphicId=function(a){return 0};b.prototype.layerOpacityChanged=function(){var a=this,c=this._isPropertyDriven("opacity");this._materials.forEach(function(b,d){d=a._getMaterialOpacity()*a._originalOpacities[d];b.setParameterValues({opacity:d,transparent:1>d||c})});return!0};b.prototype.layerElevationInfoChanged=function(a,c){return this.updateGraphics3DGraphicElevationInfo(a,c,y.needsElevationUpdates3D)};
b.prototype.slicePlaneEnabledChanged=function(a,c){var b=this;this._lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;this._materials.forEach(function(a){a.setParameterValues({slicePlaneEnabled:b._context.slicePlaneEnabled})});return!0};b.prototype.pixelRatioChanged=function(a,c){return!0};b.prototype.applyRendererDiff=function(a,c){var b=this,d;for(d in a.diff)switch(d){case "visualVariables":if(C.updateFastSymbolUpdatesState(this._fastUpdates,c,this._fastVisualVariableConvertOptions()))this._materials.forEach(function(a){return a.setParameterValues(b._fastUpdates.materialParameters)}),
this._lodRenderer.notifyShaderTransformationChanged();else return!1;break;default:return!1}return!0};b.prototype.computeComplexity=function(){if(!this._lodResources)return c.prototype.computeComplexity.call(this);var a=G.geometriesFromLodLevelResources(this._lodResources.levels[0]).reduce(function(a,c){return a+c.data.getIndices(H.VertexAttrConstants.POSITION).length},0)/3,b=B.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer);return{primitivesPerFeature:a,primitivesPerCoordinate:0,
memory:b}};b.prototype._createAs3DShape=function(a,c,b,d,e){a=this.getFastUpdateAttrValues(a);var f=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?x.mixinColorAndOpacity(b.color,b.opacity):null,g=this._context.clippingExtent;E.pointToVector(c,P,this._context.elevationProvider.spatialReference);if(g&&!y.pointInBox2D(P,g))return null;var g=this._requiresTerrainElevation(d),h=this._computeGlobalTransform(c,d,T,g?J:null);b=this._computeLocalTransform(this.symbolLayer,b,L);var l=this._lodRenderer.instanceData,
m=l.addInstance();this._instanceIndexToGraphicUid.set(m,e);l.setLocalTransform(m,b,!1);l.setGlobalTransform(m,h);a&&l.setFeatureAttribute(m,a);f&&l.setColor(m,f);e=new r(this,m,t.perLodInstanceElevationAligner,d);g&&(e.alignedTerrainElevation=J.terrainElevation);e.needsElevationUpdates=y.needsElevationUpdates3D(d.mode);y.extendPointGraphicElevationContext(e,c,this._context.elevationProvider);return e};b.prototype._computeGlobalTransform=function(a,c,b,d){c=y.computeElevation(this._context.elevationProvider,
a,c,this._context.renderCoordsHelper,d);P[0]=a.x;P[1]=a.y;P[2]=c;E.computeLinearTransformation(a.spatialReference,P,b,this._context.renderSpatialReference);return b};b.prototype._computeLocalTransform=function(a,c,b){p.mat4.identity(b);this._applyObjectRotation(c,!1,b);this._applyObjectRotation(a,!0,b);this._applyObjectScale(c,b);this._applyAnchor(a,b);return b};b.prototype._applyObjectScale=function(a,c){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(a=this._isPropertyDriven("size")&&
a.size?a.size:this._symbolSize,a=x.computeObjectScale(a,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters),1===a[0]&&1===a[1]&&1===a[2]||p.mat4.scale(c,c,a))};b.prototype.prepareSymbolLayerPatch=function(a){if("partial"===a.diff.type){var c=a.diff.diff;this._preparePatchTransform(a,c);this._preparePatchColor(a,c)}};b.prototype.updateGeometry=function(a,c){var b=c&&y.placePointOnGeometry(c);if(!b)return!1;c=this.getGeometryElevationMode(c);if(a.elevationContext.mode!==
c)return!1;c=this._requiresTerrainElevation(a.elevationContext);this._computeGlobalTransform(b,a.elevationContext,T,c?J:null);c&&(a.alignedTerrainElevation=J.terrainElevation);this._lodRenderer.instanceData.setGlobalTransform(a.instanceIndex,T,!0);y.extendPointGraphicElevationContext(a,b,this._context.elevationProvider);return!0};b.prototype._preparePatchTransform=function(a,c){var b=this;if(c.heading||c.tilt||c.roll||c.width||c.height||c.depth||c.anchor||c.anchorPosition){var d=function(a,c,b){return(null!=
a&&"complete"===a.type?a.newValue:c)||b},e=d(c.heading,this.symbolLayer.heading,0),f=d(c.tilt,this.symbolLayer.tilt,0),g=d(c.roll,this.symbolLayer.roll,0),h=d(c.width,this.symbolLayer.width,void 0),m=d(c.height,this.symbolLayer.height,void 0),k=d(c.depth,this.symbolLayer.depth,void 0),p=d(c.anchor,this.symbolLayer.anchor,void 0),d=d(c.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete c.heading;delete c.tilt;delete c.roll;delete c.width;delete c.height;delete c.depth;delete c.anchor;delete c.anchorPosition;
var r={heading:e,tilt:f,roll:g,anchor:p,anchorPosition:d};this.isResolved()&&a.symbolLayerStatePatches.push(function(){b._symbolSize=l.vec3f64.fromArray(x.computeSizeWithResourceSize(b._resourceSize,{width:h,height:m,depth:k,isPrimitive:b.symbolLayer.isPrimitive}))});a.graphics3DGraphicPatches.push(function(a,c){c=b._computeLocalTransform(r,c,L);b._lodRenderer.instanceData.setLocalTransform(a.instanceIndex,c,!0)})}};b.prototype._preparePatchColor=function(a,c){var b=this;if(c.material&&"partial"===
c.material.type&&(c=c.material.diff,c.color&&"complete"===c.color.type)){var d=c.color.newValue,e=d?k.toUnitRGBA(d):O;delete c.color;a.graphics3DGraphicPatches.push(function(a,c){if(b._hasPerInstanceColor())b._lodRenderer.instanceData.setColor(a.instanceIndex,e);else for(a=0,c=b._materials;a<c.length;a++)c[a].setParameterValues({externalColor:e})})}};b.prototype._requiresTerrainElevation=function(a){return"absolute-height"!==a.mode};b.prototype._applyObjectRotation=function(a,c,b){if(!(this._fastUpdates.enabled&&
this._fastUpdates.requiresShaderTransformation&&c))return x.computeObjectRotation(a.heading,a.tilt,a.roll,b)};b.prototype._computeAnchor=function(c){var b=l.vec3f64.create();switch(c.anchor){case "center":a.vec3.copy(b,e.center(this._resourceBoundingBox));a.vec3.negate(b,b);break;case "top":var d=e.center(this._resourceBoundingBox);a.vec3.set(b,-d[0],-d[1],-this._resourceBoundingBox[5]);break;case "bottom":d=e.center(this._resourceBoundingBox);a.vec3.set(b,-d[0],-d[1],-this._resourceBoundingBox[2]);
break;case "relative":var d=e.center(this._resourceBoundingBox),f=e.size(this._resourceBoundingBox);c=(c=c.anchorPosition)?l.vec3f64.fromValues(c.x,c.y,c.z):N;a.vec3.multiply(b,f,c);a.vec3.add(b,b,d);a.vec3.negate(b,b);break;default:this._pivotOffset?a.vec3.negate(b,this._pivotOffset):a.vec3.copy(b,N)}return b};b.prototype._applyAnchor=function(a,c){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(a=this._computeAnchor(a))&&p.mat4.translate(c,c,a)};b.prototype._hasPerInstanceColor=
function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};b.prototype._fastVisualVariableConvertOptions=function(){var a=this._resourceBoundingBox?l.vec3f64.fromArray(e.size(this._resourceBoundingBox)):M,c=this._resourceBoundingBox?this._computeAnchor(this.symbolLayer):N,b=this._context.renderCoordsHelper.unitInMeters,d=x.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,b),f=l.vec3f64.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||
0);return{modelSize:a,symbolSize:this._symbolSize||M,unitInMeters:b,transformation:{anchor:c,scale:d,rotation:f}}};return b}(w.default);b.Graphics3DObjectSymbolLayer=q;var M=l.vec3f64.fromValues(1,1,1),O=g.vec4f64.fromValues(1,1,1,1),N=l.vec3f64.fromValues(0,0,0),P=l.vec3f64.create(),L=c.mat4f64.create(),T=c.mat4f64.create(),R=g.vec4f64.create(),J={verticalDistanceToGround:0,terrainElevation:0};b.default=q})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils ../../webgl-engine/lib/HighlightUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g){q=function(){function b(c,b,d,e){this.type="lod-instance";this.alignedTerrainElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=c;this.instanceIndex=b;this.elevationAligner=d;this.elevationContext=new a(e)}b.prototype.initialize=function(a,c){};b.prototype.setVisibility=function(a){var c=this.lodRenderer.instanceData;return a!==c.getVisible(this.instanceIndex)?(c.setVisible(this.instanceIndex,a),!0):!1};b.prototype.destroy=function(){null!=this.instanceIndex&&
(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};b.prototype.alignWithElevation=function(a,b,d){this.elevationAligner&&(c.setContextFeature(this.elevationContext.featureExpressionInfoContext,d),a=this.elevationAligner(this,this.elevationContext,a,b),null!=a&&(this.alignedTerrainElevation=a))};b.prototype.getBSRadius=function(){var a=this.lodRenderer;return a.baseBoundingSphere.radius*a.instanceData.getCombinedMaxScaleFactor(this.instanceIndex)};
b.prototype.getCenterObjectSpace=function(a){void 0===a&&(a=m.vec3f64.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,y);return h.vec3.transformMat4(a,this.lodRenderer.baseBoundingSphere.center,y)};b.prototype.getBoundingBoxObjectSpace=function(a){void 0===a&&(a=p.create());this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,y);var c=this.lodRenderer.baseBoundingBox;p.empty(a);for(var b=0;8>b;++b)h.vec3.set(u,0===(b&1)?c[0]:c[3],0===(b&2)?
c[1]:c[4],0===(b&4)?c[2]:c[5]),h.vec3.transformMat4(u,u,y),p.expandPointInPlace(a,u);return a};b.prototype.getProjectedBoundingBox=function(a,c,b,d){return k(this,void 0,void 0,function(){var g,m,k,n,q,x,w,v,z;return f(this,function(f){switch(f.label){case 0:g=this.getBoundingBoxObjectSpace(d);m=r;k=p.isPoint(g)?1:m.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,y);for(n=0;n<k;n++)q=m[n],u[0]=g[q[0]],u[1]=g[q[1]],u[2]=g[q[2]],h.vec3.transformMat4(u,u,y),e[3*n+0]=u[0],e[3*
n+1]=u[1],e[3*n+2]=u[2];if(!a(e,0,k))return[2,null];p.empty(g);x=null;this.calculateRelativeScreenBounds&&(x=this.calculateRelativeScreenBounds());for(n=0;n<3*k;n+=3){for(w=0;3>w;w++)g[w]=Math.min(g[w],e[n+w]),g[w+3]=Math.max(g[w+3],e[n+w]);x&&b.push({location:e.slice(n,n+3),screenSpaceBoundingRect:x})}if(!c)return[3,5];p.center(g,t);if("absolute-height"===this.elevationContext.mode)return[3,5];v=void 0;z=l.demResolutionForBoundingBox(g,c);f.label=1;case 1:return f.trys.push([1,3,,4]),[4,c.service.queryElevation(t[0],
t[1],z)];case 2:return v=f.sent(),[3,4];case 3:return f.sent(),v=null,[3,4];case 4:null!=v&&p.offset(g,0,0,-this.alignedTerrainElevation+v),f.label=5;case 5:return[2,g]}})})};b.prototype.addHighlight=function(a,c){var b=this;c=g.generateHighlightId();this.addHighlightId(c);a.addExternal(function(a){b.removeHighlightId(a)},c)};b.prototype.removeHighlight=function(a){this.highlights&&this.highlights.forEach(function(c){return a.remove(c)})};b.prototype.addHighlightId=function(a){this.highlights=this.highlights||
new Set;this.highlights.add(a);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};b.prototype.removeHighlightId=function(a){this.highlights&&(this.highlights.delete(a),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,0<this.highlights.size),0===this.highlights.size&&(this.highlights=null))};Object.defineProperty(b.prototype,"lodRenderer",{get:function(){return this.graphics3DSymbolLayer.lodRenderer},enumerable:!0,configurable:!0});return b}();var e=[0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u=m.vec3f64.create(),t=m.vec3f64.create(),r=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],y=d.mat4f64.create();return q})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["require","exports","../../../../core/tsSupport/generatorHelper","../../../../core/tsSupport/awaiterHelper","../../webgl-engine/lib/lodRendering/LodResources"],function(q,b,n,f,k){function d(b){var c=[];b.stageResources.geometries.forEach(function(a,d){c.push({material:b.stageResources.materials[d],
geometry:a,textures:b.stageResources.textures})});return{components:c,minScreenSpaceRadius:b.lodThreshold,pivotOffset:b.pivotOffset}}function h(b,c){void 0===c&&(c=m);b=k.computeFaceCount(b);return Math.sqrt(b/(c*Math.PI))}Object.defineProperty(b,"__esModule",{value:!0});b.makeLodLevelResources=d;b.makeLodResources=function(b){return{levels:b.map(function(c){return d(c)})}};b.estimateMinScreenSpaceRadius=h;b.fillEstimatedMinScreenSpaceRadius=function(b){b.levels.forEach(function(c){c.minScreenSpaceRadius||
(c.minScreenSpaceRadius=h(c))})};var m=.05})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../core/lang ../../../../core/maybe ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../glTF/DefaultLoadingContext ../../glTF/esriProvidedModelParameters ../../glTF/loader ../../glTF/internal/indexUtils ./wosrLoader ../../support/mathUtils ../../support/buffer/BufferView ../../support/buffer/math ../../support/buffer/utils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C,E){function F(a){var c=a.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return c?{fileType:"gltf",url:c[1],specifiedLodIndex:null!=c[4]?Number(c[4]):null}:a.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:a,specifiedLodIndex:null}:{fileType:"unknown",url:a,specifiedLodIndex:null}}function H(a,b,e){var f=a.model,h=c.mat4f64.create(),l=[],k=new Map,n=new Map;f.lods.forEach(function(a,c){if(void 0===e||c===e){var t=0,u={stageResources:{textures:[],
materials:[],geometries:[]},lodThreshold:m.isSome(a.lodThreshold)?a.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:g.empty()};l.push(u);a.parts.forEach(function(c){var e=c.material+(c.attributes.normal?"_normal":"")+(c.attributes.color?"_color":"")+(c.attributes.texCoord0?"_texCoord0":"")+(c.attributes.tangent?"_tangent":""),l=f.materials.get(c.material),q=m.isSome(c.attributes.texCoord0),w=m.isSome(c.attributes.normal);if(!k.has(e)){if(m.isSome(l.textureColor)&&q&&!n.has(l.textureColor)){var y=
f.textures.get(l.textureColor),F=d({},y.parameters,{preMultiplyAlpha:!0});n.set(l.textureColor,new C(y.data,l.textureColor,F))}m.isSome(l.textureNormal)&&q&&!n.has(l.textureNormal)&&(y=f.textures.get(l.textureNormal),F=d({},y.parameters,{preMultiplyAlpha:!0}),n.set(l.textureNormal,new C(y.data,l.textureNormal,F)));var G=E.COLOR_GAMMA,y=Math.pow(l.color[0],1/G),F=Math.pow(l.color[1],1/G),G=Math.pow(l.color[2],1/G);k.set(e,new E(d({transparent:"BLEND"===l.alphaMode,textureAlphaMode:D(l.alphaMode),textureAlphaCutoff:l.alphaCutoff,
diffuse:[y,F,G],ambient:[y,F,G],opacity:l.opacity,doubleSided:l.doubleSided,doubleSidedType:"winding-order",vertexColors:!!c.attributes.color,vertexTangents:!!c.attributes.tangent,normals:w?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:m.isSome(l.textureColor)&&q?n.get(l.textureColor).id:void 0,colorMixMode:l.colorMixMode,normalTextureId:m.isSome(l.textureNormal)&&q?n.get(l.textureNormal).id:void 0,textureAlphaPremultiplied:!0},b),e))}a:{w=c.indices||c.attributes.position.count;
switch(c.primitiveType){case 4:y=r.trianglesToTriangles(w);break a;case 5:y=r.triangleStripToTriangles(w);break a;case 6:y=r.triangleFanToTriangles(w);break a}y=void 0}var F={},G={},w=c.attributes.position.count,J=z.createBuffer(x.BufferViewVec3f,w);v.vec3.transformMat4(J,c.attributes.position,c.transform);G.position={data:J.typedBuffer,size:J.elementCount};F.position=y;m.isSome(c.attributes.normal)&&(J=z.createBuffer(x.BufferViewVec3f,w),p.mat4.invert(h,c.transform),p.mat4.transpose(h,h),v.vec3.transformMat4(J,
c.attributes.normal,h),G.normal={data:J.typedBuffer,size:J.elementCount},F.normal=y);m.isSome(c.attributes.tangent)&&(J=z.createBuffer(x.BufferViewVec4f,w),p.mat4.invert(h,c.transform),p.mat4.transpose(h,h),v.vec4.transformMat4(J,c.attributes.tangent,h),G.aTangent={data:J.typedBuffer,size:J.elementCount},F.aTangent=y);m.isSome(c.attributes.texCoord0)&&(J=z.createBuffer(x.BufferViewVec2f,w),z.vec2.normalizeIntegerBuffer(J,c.attributes.texCoord0),G.uv0={data:J.typedBuffer,size:J.elementCount},F.uv0=
y);if(m.isSome(c.attributes.color)){J=z.createBuffer(x.BufferViewVec4u8,w);if(4===c.attributes.color.elementCount)c.attributes.color instanceof x.BufferViewVec4f?v.vec4.scale(J,c.attributes.color,255):c.attributes.color instanceof x.BufferViewVec4u8?z.vec4.copy(J,c.attributes.color):c.attributes.color instanceof x.BufferViewVec4u16&&v.vec4.scale(J,c.attributes.color,1/256);else{z.vec4.fill(J,255,255,255,255);var M=new x.BufferViewVec3u8(J.buffer,0,4);c.attributes.color instanceof x.BufferViewVec3f?
v.vec3.scale(M,c.attributes.color,255):c.attributes.color instanceof x.BufferViewVec3u8?z.vec3.copy(M,c.attributes.color):c.attributes.color instanceof x.BufferViewVec3u16&&v.vec3.scale(M,c.attributes.color,1/256)}G.color={data:J.typedBuffer,size:J.elementCount};F.color=y}c=new A(new B(G,F),"gltf_"+a.name+"_"+t++);u.stageResources.geometries.push(c);u.stageResources.materials.push(k.get(e));m.isSome(l.textureColor)&&q&&u.stageResources.textures.push(n.get(l.textureColor));m.isSome(l.textureNormal)&&
q&&u.stageResources.textures.push(n.get(l.textureNormal));u.numberOfVertices+=w;e=c.boundingInfo;g.expand(u.boundingBox,e.getBBMin());g.expand(u.boundingBox,e.getBBMax())})}});return l}function D(a){switch(a){case "BLEND":return"blend";case "MASK":return"mask";case "OPAQUE":return"opaque";default:return"blend"}}function G(a,c){void 0===a&&(a="");void 0===c&&(c="");var b=h.endsWith(a,"Imposter");a=a.split("__")[0];if(-1!==c.indexOf("/RealisticTrees/")&&(c=u.treeParamsTable[a]))return{crownCenter:c.center,
crownDimensions:c.radius,imposter:b}}function K(b){b.meta.isEsriSymbolResource&&b.model.lods.forEach(function(d){var e=G(d.name,b.meta.uri);e&&(b.customMeta.esriTreeRendering=!0,d.parts.forEach(function(b){var d=b.attributes.normal,f=b.attributes.position,g=f.count;if(!m.isNone(d)){for(var h=l.vec3f64.create(),k=l.vec3f64.create(),r=l.vec3f64.create(),n=z.createBuffer(x.BufferViewVec4u8,g),t=z.createBuffer(x.BufferViewVec3f,g),u=p.mat4.invert(c.mat4f64.create(),b.transform),q=a.vec3.transformMat4(l.vec3f64.create(),
e.crownCenter,u),u=a.vec3.transformMat4(l.vec3f64.create(),e.crownDimensions,u),y=0;y<g;y++){f.getVec(y,k);d.getVec(y,h);a.vec3.subtract(r,k,q);a.vec3.divide(r,r,u);var v=w.clamp(a.vec3.length(r),0,1),v=.6+.4*v*v;a.vec3.lerp(r,r,h,.2);t.setVec(y,r);n.set(y,0,255*v);n.set(y,1,255*v);n.set(y,2,255*v);n.set(y,3,255)}b.attributes.normal=t;b.attributes.color=n}}))})}function M(a){var c=a.model.lods.length;a.meta.isEsriSymbolResource&&a.model.lods.forEach(function(a){if(!m.isSome(a.lodThreshold)){var b=
(a.name||"").split("__")[0],d=a.parts.reduce(function(a,c){return a+c.attributes.position.count},0);a.lodThreshold=O(b,d,c)}})}function O(a,c,b){void 0===a&&(a="");if(1===b)return null;if(a in u.lodThresholdLUT){b=u.lodThresholdLUT[a].vertexCounts;a=u.lodThresholdLUT[a].thresholds;var d=b.length;if(1>=d)return null;if(c<=b[0]){var e=(b[1]-b[0])/(a[1]-a[0]);c-=b[0];return Math.max(0,a[0]+c*e)}if(c>=b[d-1])return e=(b[d-1]-b[d-2])/(a[d-1]-a[d-2]),c-=b[d-1],a[d-1]+c*e;for(var f=1;f<b.length;++f){var g=
b[f-1],h=b[f],d=a[f-1],e=a[f];if(c<h)return c=(c-g)/(h-g),d*(1-c)+e*c}}return null}Object.defineProperty(b,"__esModule",{value:!0});b.fetch=function(a,c){void 0===c&&(c={});return k(this,void 0,void 0,function(){var b,g,h,l,m,k,p,r,n,u;return f(this,function(f){switch(f.label){case 0:return b=F(a),"wosr"!==b.fileType?[3,2]:[4,y.load(b.url,c)];case 1:return g=f.sent(),[2,{lods:[g],referenceBoundingBox:g.boundingBox}];case 2:return h=new e.DefaultLoadingContext(c.streamDataSupplier),[4,t.load(h,b.url,
c)];case 3:l=f.sent();K(l);M(l);m=d({},c.materialParamsMixin,{treeRendering:l.customMeta.esriTreeRendering});if(null!=b.specifiedLodIndex)return k=H(l,m,b.specifiedLodIndex),p=k[0].boundingBox,0!==b.specifiedLodIndex&&(r=H(l,m,b.specifiedLodIndex),p=r[0].boundingBox),[2,{lods:k,referenceBoundingBox:p}];n=H(l,m);u=n[0].boundingBox;return[2,{lods:n,referenceBoundingBox:u}]}})})};b.parseUrl=F;b.gltfToEngineResources=H})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/assignHelper dojo/errors/CancelError ../../../request ../../../core/Error ../../../core/promiseUtils ../../../core/urlUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a){this.streamDataSupplier=a}b.prototype.loadJson=function(a){return n(this,void 0,void 0,function(){return f(this,function(c){return[2,this.load("json",a)]})})};b.prototype.loadBinary=function(a){return n(this,void 0,void 0,function(){return f(this,function(b){return c.isDataProtocol(a)?[2,c.dataToArrayBuffer(a)]:[2,this.load("binary",a)]})})};b.prototype.loadImage=function(a){return n(this,void 0,
void 0,function(){return f(this,function(c){return[2,this.load("image",a)]})})};b.prototype.load=function(c,b){return n(this,void 0,void 0,function(){var e,g,l=this;return f(this,function(f){switch(f.label){case 0:return this.streamDataSupplier?(e=this.streamDataSupplier.request(b,c),[2,p.create(function(a,c){e.then(function(c){a(c.data)},function(a){c(a instanceof d?a:new m("","Request for resource failed: "+a))})},function(){l.streamDataSupplier.cancelRequest(e)})]):[4,h(b,a[c])];case 1:return g=
f.sent(),[2,g.data]}})})};return b}();b.DefaultLoadingContext=q;var a={image:{responseType:"image"},binary:{responseType:"array-buffer"},json:void 0}})},"esri/views/3d/glTF/esriProvidedModelParameters":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.treeParamsTable={Alder_Buckthorn:{center:[0,0,2.5],radius:[2,2,3.5]},American_Chestnut:{center:[0,0,12],radius:[10,10,10]},American_Sycamore:{center:[0,0,16],radius:[6.3,6.3,11.5]},Apricot:{center:[0,
0,5],radius:[4.5,4.5,4]},Australian_Pine:{center:[0,0,8],radius:[3,3,11.5]},Baldcypress:{center:[0,0,11.5],radius:[4.2,4.2,16.5]},Balsam_Fir:{center:[0,0,2.9],radius:[3,3,9.7]},Basswood:{center:[0,0,19],radius:[9,9,11]},Bay_Laurel:{center:[0,0,1.4],radius:[.6,.6,2.7]},Black_Locust:{center:[0,0,15],radius:[9.5,9.5,9.5]},Blue_Gum_Eucalyptus:{center:[0,0,12],radius:[5,5,10]},Boxwood:{center:[0,0,.5],radius:[.3,.3,.5]},California_Bay:{center:[0,0,16],radius:[9,9,9.6]},California_Incense_Cedar:{center:[0,
0,6.6],radius:[3.8,3.8,14]},California_Redwood:{center:[0,0,55],radius:[6.5,6.5,19]},California_Walnut:{center:[0,0,5.3],radius:[5,5,4.5]},Common_Hawthorn:{center:[0,0,2.8],radius:[1.9,1.9,2.8]},Common_Whitebeam:{center:[0,0,4.5],radius:[2.5,2.5,3.5]},Conker_Tree:{center:[0,0,10],radius:[6,6,10]},Desert_Willow:{center:[0,0,3],radius:[2.4,2.4,2.8]},Douglas_Fir:{center:[0,0,40],radius:[4.5,4.5,22]},European_Beech:{center:[0,0,12],radius:[7.5,7.5,11.5]},European_Larch:{center:[0,0,9],radius:[3,3,9]},
Ficus:{center:[0,0,10],radius:[12,12,18.5]},Field_Elm:{center:[0,0,12.5],radius:[10,10,9.5]},Flannelbush:{center:[0,0,0],radius:[1.3,1.3,1.7]},Flowering_Dogwood:{center:[0,0,2.5],radius:[2.4,2.4,3]},Generic_Unknown:{center:[0,0,11.5],radius:[5,5,6.5]},Giant_Sequoia:{center:[0,0,35.5],radius:[11,11,26]},Japanese_Angelica_Tree:{center:[0,0,3.8],radius:[2.8,2.8,2]},Leyland_Cypress:{center:[0,0,2.8],radius:[1,1,4]},Lodgepole_Pine:{center:[0,0,23.25],radius:[4.7,4.7,19]},Mediterranean_Buckthorn:{center:[0,
0,1.5],radius:[1.2,1.2,2.5]},Mountain_Mahogany:{center:[0,0,2],radius:[1.3,1.3,1.5]},Northern_Red_Oak:{center:[0,0,11.5],radius:[7.2,7.2,9]},Norway_Maple:{center:[0,0,12.2],radius:[6,6,8.2]},Norway_Spruce:{center:[0,0,5],radius:[6.5,6.5,20]},Oval_Leaved_Privet:{center:[0,0,0],radius:[.45,.45,2.95]},Palo_Verde:{center:[0,0,4.25],radius:[4,4,2.75]},Paper_Birch:{center:[0,0,13.25],radius:[5.5,5.5,9.5]},Red_Alder:{center:[0,0,13.25],radius:[5.5,5.5,9.5]},Red_Hickory:{center:[0,0,9],radius:[4.5,4.5,7.5]},
Rhododendron_Azaleas:{center:[0,0,.55],radius:[.4,.4,.35]},Rose:{center:[0,0,.55],radius:[.45,.45,.55]},Ruffle_Palm:{center:[0,0,6.4],radius:[3,3,3]},Sassafras:{center:[0,0,8],radius:[3,3,7]},Scots_Pine:{center:[0,0,18],radius:[3,3,9]},Shadbush:{center:[0,0,1.5],radius:[1.5,1.5,1.5]},Southern_Magnolia:{center:[0,0,10.5],radius:[5.5,5.5,8]},Spanish_Broom:{center:[0,0,1.5],radius:[2.5,2.5,1.5]},Strawberry_Tree:{center:[0,0,4],radius:[2.8,2.8,3.3]},Sugar_Maple:{center:[0,0,8],radius:[4.5,4.5,7]},Sweetgum:{center:[0,
0,8],radius:[4,4,6.5]},Umbrella_Acacia:{center:[0,0,10.8],radius:[15,15,6.8]},Western_Juniper:{center:[0,0,3.2],radius:[2.5,2.5,7]},White_Ash:{center:[0,0,14.5],radius:[9.5,9.5,11]},White_Oak:{center:[0,0,15],radius:[14,14,14]},White_Poplar:{center:[0,0,10],radius:[4.3,4.3,8.2]},White_Willow:{center:[0,0,12],radius:[8.9,8.9,9]},Witch_Hazel:{center:[0,0,1.5],radius:[1.5,1.5,2]}};b.lodThresholdLUT={Alder_Buckthorn:{thresholds:[2,65.698,384.294],vertexCounts:[18,2034,8220]},Amazon_Sword_Plant:{thresholds:[2,
22.848,88.819,200.491],vertexCounts:[18,246,888,3246]},American_Chestnut:{thresholds:[2,27.57,59.244,360.286],vertexCounts:[18,444,1782,10332]},American_Sycamore:{thresholds:[2,60.765,228.586],vertexCounts:[18,1740,8562]},Apricot:{thresholds:[2,33.695,132.332],vertexCounts:[18,1776,10626]},Australian_Pine:{thresholds:[2,131.057],vertexCounts:[18,8094]},Baldcypress:{thresholds:[2,31.791,212.226],vertexCounts:[18,1638,10164]},Balsam_Fir:{thresholds:[2,64.674],vertexCounts:[18,10266]},Bamboo:{thresholds:[2,
22.347,90.113,213.818],vertexCounts:[18,216,978,7740]},Banana_Tree:{thresholds:[2,28.096,88.837,345.976],vertexCounts:[18,372,1986,10743]},Basswood:{thresholds:[2,59.387,199.555],vertexCounts:[18,1662,7998]},Bay_Laurel:{thresholds:[2,28.653,204.352],vertexCounts:[18,1728,10938]},Black_Locust:{thresholds:[2,28.546,88.164,229.447],vertexCounts:[18,384,1638,9768]},Blue_Gum_Eucalyptus:{thresholds:[2,56.98,201.358],vertexCounts:[18,1530,9762]},Boxwood:{thresholds:[2,28.768,62.215,191.034],vertexCounts:[18,
390,1824,9876]},Cabbage_Palm_Fern:{thresholds:[2,26.932,215.221],vertexCounts:[18,150,1314]},California_Bay:{thresholds:[2,30.627,204.223],vertexCounts:[18,1878,9054]},California_Incense_Cedar:{thresholds:[2,30.533,197.262],vertexCounts:[18,1644,11214]},California_Palm:{thresholds:[2,30.538,210.616],vertexCounts:[18,612,5760]},California_Redwood:{thresholds:[2,110.805],vertexCounts:[18,10260]},California_Walnut:{thresholds:[2,26.702,64.525,199.228],vertexCounts:[18,336,1962,10992]},Coconut_Palm:{thresholds:[2,
21.77,63.23,199.556],vertexCounts:[18,402,1884,9240]},Common_Hawthorn:{thresholds:[2,45.588,205.35],vertexCounts:[18,300,9492]},Common_Whitebeam:{thresholds:[2,56.42,186.382],vertexCounts:[18,2142,10524]},Conker_Tree:{thresholds:[2,25.977,58.524,195.139],vertexCounts:[18,318,1614,8886]},Date_Palm:{thresholds:[2,31.107,67.609,186.723],vertexCounts:[18,456,2154,9054]},Desert_Willow:{thresholds:[2,29.425,59.815,203.238],vertexCounts:[18,408,1686,9720]},Douglas_Fir:{thresholds:[2,69.576],vertexCounts:[18,
8544]},European_Beech:{thresholds:[2,29.854,201.521],vertexCounts:[18,420,7572]},European_Larch:{thresholds:[2,65.346],vertexCounts:[18,10314]},Ficus:{thresholds:[2,28.768,58.849,210.62],vertexCounts:[18,390,1632,7728]},Field_Elm:{thresholds:[2,34.435,192.436],vertexCounts:[18,1746,10950]},Flannelbush:{thresholds:[2,27.408,55.566,196.843],vertexCounts:[18,354,1455,8706]},Flowering_Dogwood:{thresholds:[2,28.768,194.687],vertexCounts:[18,390,8664]},Generic_Dead_Tree:{thresholds:[2,67.891],vertexCounts:[18,
2172]},Generic_Stump:{thresholds:[2,19.544,57.757,171.552],vertexCounts:[18,180,1572,2634]},Generic_Unknown:{thresholds:[2,32.379,221.987],vertexCounts:[18,1572,9006]},Giant_Sequoia:{thresholds:[2,30.664,204.84],vertexCounts:[18,2160,8232]},Hedgehog_Agave:{thresholds:[2,28.546,96.141,228.435],vertexCounts:[18,384,1980,11094]},Japanese_Angelica_Tree:{thresholds:[2,25.482,61.287,202.909],vertexCounts:[18,306,1770,7806]},Lacy_Tree_Philodendron:{thresholds:[2,28.768,62.974,231.634],vertexCounts:[18,390,
1752,10227]},Leyland_Cypress:{thresholds:[2,66.246],vertexCounts:[18,10182]},Lily_Of_The_Valley:{thresholds:[2,28.322,55.738,198.232],vertexCounts:[18,378,1464,4152]},Scots_Pine:{thresholds:[2,60.554],vertexCounts:[18,7524]},Mediterranean_Buckthorn:{thresholds:[2,31.82,211.856],vertexCounts:[18,2196,9030]},Mexican_Palmetto:{thresholds:[2,29.425,68.358,212.659],vertexCounts:[18,408,2202,10194]},Mountain_Mahogany:{thresholds:[2,31.199,198.614],vertexCounts:[18,1614,8094]},White_Oak:{thresholds:[2,15.204,
33.801,129.392],vertexCounts:[18,372,1674,9222]},Sugar_Maple:{thresholds:[2,28.322,59.495,216.901],vertexCounts:[18,378,1668,9462]},Norway_Spruce:{thresholds:[2,63.101],vertexCounts:[18,9630]},Orchid:{thresholds:[2,30.383,63.93,198.664],vertexCounts:[18,435,1926,8346]},Other:{thresholds:[2,30.504,194.487],vertexCounts:[18,1572,9006]},Oval_Leaved_Privet:{thresholds:[2,59.468],vertexCounts:[18,9162]},Palm_Lily:{thresholds:[2,57.977,200.406],vertexCounts:[18,1584,8112]},Palo_Verde:{thresholds:[2,65.31,
198.124],vertexCounts:[18,2010,7668]},Paper_Birch:{thresholds:[2,117.074],vertexCounts:[18,10578]},Parlour_Palm:{thresholds:[2,30.695,60.974,194.832],vertexCounts:[18,444,1752,8388]},Prickly_Pear_Cactus:{thresholds:[2,28.657,66.946,214.478],vertexCounts:[18,387,2112,11028]},Red_Alder:{thresholds:[2,30.518,192.513],vertexCounts:[18,1770,8274]},Red_Hickory:{thresholds:[2,31.604,192.085],vertexCounts:[18,1680,7908]},Rhododendron_Azaleas:{thresholds:[2,47.068,192.681],vertexCounts:[18,1044,8160]},Rose:{thresholds:[2,
66.085,212.061],vertexCounts:[18,2058,10968]},Ruffle_Palm:{thresholds:[2,64.994],vertexCounts:[18,9534]},Saguaro_Cactus:{thresholds:[2,34.779,56.703,197.566],vertexCounts:[18,570,1050,1992]},Sassafras:{thresholds:[2,110.697],vertexCounts:[18,10944]},Sea_Islands_Yucca:{thresholds:[2,61.287,219.899],vertexCounts:[18,1770,10176]},Shadbush:{thresholds:[2,26.702,64.03,201.856],vertexCounts:[18,336,1932,9030]},Snake_Plant:{thresholds:[2,23.803,68.265,193.203],vertexCounts:[18,267,2196,5280]},Southern_Magnolia:{thresholds:[2,
63.431,212.165],vertexCounts:[18,1896,8472]},Spanish_Broom:{thresholds:[2,29.854,192.889],vertexCounts:[18,420,7896]},Strawberry_Tree:{thresholds:[2,16.772,32.081,186.987],vertexCounts:[18,300,1560,8148]},Sunflower:{thresholds:[2,28.768,66.373,194.987],vertexCounts:[18,390,2076,7902]},Sweetgum:{thresholds:[2,31.436,201.223],vertexCounts:[18,1848,7674]},Umbrella_Acacia:{thresholds:[2,62.137],vertexCounts:[18,8880]},Western_Juniper:{thresholds:[2,62.683],vertexCounts:[18,9120]},White_Ash:{thresholds:[2,
33.326,192.138],vertexCounts:[18,2070,10542]},White_Poplar:{thresholds:[2,30.615,196.71],vertexCounts:[18,1530,9888]},White_Willow:{thresholds:[2,62.983],vertexCounts:[18,10422]},Witch_Hazel:{thresholds:[2,26.463,66.277,200.916],vertexCounts:[18,330,2070,10386]},ATM:{thresholds:[2,46.933],vertexCounts:[150,1038]},Bus_Stop_1:{thresholds:[2,42.67],vertexCounts:[150,858]},Bus_Stop_2:{thresholds:[2,46.112],vertexCounts:[138,1002]},Dumpster:{thresholds:[2,48.006],vertexCounts:[138,1086]},Newspaper_Vending_Machine:{thresholds:[2,
57.203],vertexCounts:[144,1542]},Overhanging_Sidewalk_Light_Off:{thresholds:[2,43.847],vertexCounts:[141,906]},Overhanging_Sidewalk_Light_On:{thresholds:[2,43.847],vertexCounts:[141,906]},Overhanging_Street_And_Sidewalk_Light_Off:{thresholds:[2,46.524],vertexCounts:[147,1020]},Overhanging_Street_And_Sidewalk_Light_On:{thresholds:[2,46.524],vertexCounts:[147,1020]},Overhanging_Street_Light_Off:{thresholds:[2,34.225],vertexCounts:[144,552]},Overhanging_Street_Light_On:{thresholds:[2,34.225],vertexCounts:[144,
552]},Park_Bench_1:{thresholds:[2,23.669],vertexCounts:[96,264]},Park_Bench_2:{thresholds:[2,44.71],vertexCounts:[144,942]},Park_Bench_3:{thresholds:[2,41.917],vertexCounts:[120,828]},Park_Bench_4:{thresholds:[2,69.923],vertexCounts:[144,2304]},Payphone:{thresholds:[2,58.524],vertexCounts:[156,1614]},Picnic_Table:{thresholds:[2,35.504],vertexCounts:[90,594]},Planter_Circular:{thresholds:[2,99.368],vertexCounts:[153,4653]},Planter_Square:{thresholds:[2,65.212],vertexCounts:[150,2004]},Planter_Tapered:{thresholds:[2,
89.669],vertexCounts:[141,3789]},Rock_1:{thresholds:[2,28.768,50.463],vertexCounts:[132,390,1200]},Rock_2:{thresholds:[2,43.556,73.127],vertexCounts:[150,894,2520]},Rock_3:{thresholds:[2,37.931,70.286],vertexCounts:[144,678,2328]},Rock_4:{thresholds:[2,41.613,70.738],vertexCounts:[150,816,2358]},Street_Light_Off:{thresholds:[2,39.734,56.869],vertexCounts:[150,744,1524]},Street_Light_On:{thresholds:[2,39.734,56.869],vertexCounts:[150,744,1524]},Traffic_Barrier_2:{thresholds:[2,42.819],vertexCounts:[132,
864]},Trash_Bin_1:{thresholds:[2,50.019],vertexCounts:[132,1179]},Trash_Bin_2:{thresholds:[2,36.038,63.028],vertexCounts:[108,612,1872]},Trash_Bin_3:{thresholds:[2,42.371,64.03],vertexCounts:[102,846,1932]},Trash_Can_1:{thresholds:[2,58.524,98.628],vertexCounts:[150,1614,4584]},Trash_Can_2:{thresholds:[2,53.166],vertexCounts:[84,1332]},US_Mailbox:{thresholds:[2,48.402],vertexCounts:[156,1104]},Ambulance:{thresholds:[2,67.121,343.733],vertexCounts:[294,3285,13758]},Audi_A6:{thresholds:[2,63.823,484.156],
vertexCounts:[300,4311,14280]},Backhoe:{thresholds:[2,60.173,391.986],vertexCounts:[453,5895,14679]},BMW_3Series:{thresholds:[2,68.886,417.563],vertexCounts:[294,4188,14727]},Bobcat:{thresholds:[2,61.105,269.127],vertexCounts:[438,4476,14952]},Bus:{thresholds:[2,63.803,402.682],vertexCounts:[300,4398,14988]},Crane:{thresholds:[2,65.969,386.67],vertexCounts:[438,4497,14487]},Dumptruck:{thresholds:[2,66.91,354.365],vertexCounts:[456,6294,14052]},Eurocopter_AS365:{thresholds:[2,227.817],vertexCounts:[432,
14733]},Eurocopter_AS365_Flying:{thresholds:[2,96.244,380.211],vertexCounts:[306,4365,10575]},Eurocopter_H125:{thresholds:[2,96.567,378.995],vertexCounts:[438,4440,14763]},Eurocopter_H125_Flying:{thresholds:[2,94.002,366.378],vertexCounts:[294,4164,13569]},Firetruck:{thresholds:[2,65.762,383.645],vertexCounts:[276,4482,14901]},Ford_Edge:{thresholds:[2,68.763,419.635],vertexCounts:[294,4368,14733]},Ford_Expedition:{thresholds:[2,62.994,388.251],vertexCounts:[276,4410,14868]},Ford_F150:{thresholds:[2,
60.495,394.682],vertexCounts:[300,4950,14988]},Ford_Fiesta:{thresholds:[2,64.994,355.46],vertexCounts:[282,4185,14223]},Ford_Focus_Hatchback:{thresholds:[2,62.072,387.932],vertexCounts:[300,4470,14925]},Ford_Fusion:{thresholds:[2,64.485,370.289],vertexCounts:[294,4500,14955]},Ford_Mustang:{thresholds:[2,64.812,351.721],vertexCounts:[288,4197,14574]},Ford_Taurus:{thresholds:[2,67.461,379.324],vertexCounts:[282,4404,15042]},Ford_Transit_Commercial_Van:{thresholds:[2,88.6,384.491],vertexCounts:[276,
4443,14721]},Ford_Transit_Connect:{thresholds:[2,67.006,336.74],vertexCounts:[258,4344,14328]},Mercedes_SClass:{thresholds:[2,66.188,349.491],vertexCounts:[300,4377,14721]},Motorboat:{thresholds:[2,67.436,364.325],vertexCounts:[315,4491,14958]},Motorcycle:{thresholds:[2,35.435,357.215],vertexCounts:[294,4806,14865]},Police_Car:{thresholds:[2,68.116,350.794],vertexCounts:[294,3987,14580]},Porsche_Boxter:{thresholds:[2,67.717,361.95],vertexCounts:[312,6225,14676]},Porsche_Carrera:{thresholds:[2,66.588,
392.685],vertexCounts:[306,4473,14571]},Sailboat:{thresholds:[2,97.329,383.075],vertexCounts:[294,4464,14937]},Sailboat_Sails_Up:{thresholds:[2,97.46,360.432],vertexCounts:[300,4476,14967]},Taxi:{thresholds:[2,64.415,381.491],vertexCounts:[300,4305,14721]},Taxi_Van:{thresholds:[2,64.614,364.475],vertexCounts:[288,4341,11949]},Tesla_P7:{thresholds:[2,58.155],vertexCounts:[300,16062]},Tower_Crane:{thresholds:[2,106.34,419.821],vertexCounts:[432,4488,14832]},Toyota_Prius:{thresholds:[2,66.448,357.251],
vertexCounts:[288,4266,14370]},Tram:{thresholds:[2,65.43,369.937],vertexCounts:[420,5610,19605]},Volkswagen_Jetta_Wagon:{thresholds:[2,65.925,354.416],vertexCounts:[294,4443,14466]},Traffic_Light_1:{thresholds:[2,75.315],vertexCounts:[135,2673]},Traffic_Light_3:{thresholds:[2,49.12],vertexCounts:[132,1137]},Traffic_Light_4:{thresholds:[2,70.962,115.735],vertexCounts:[96,2373,6312]}}})},"esri/views/3d/glTF/loader":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/assignHelper ../../../core/maybe ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4f64 ./DefaultErrorContext ./LoaderResult ./internal/Resource".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a){function l(a,c){return n(this,void 0,void 0,function(){function b(e,g){return n(this,void 0,void 0,function(){var h,l,m,k,p,r,n,u,q;return f(this,function(f){switch(f.label){case 0:h=d.nodes[e];l=a.getNodeTransform(e);t.warnUnsupportedIf(null!=h.weights,"Morph targets are not supported.");if(null==h.mesh)return[3,4];m=d.meshes[h.mesh];k=0;p=m.primitives;f.label=1;case 1:if(!(k<p.length))return[3,4];r=p[k];return[4,c(r,l,g,m.name)];case 2:f.sent(),f.label=3;case 3:return k++,
[3,1];case 4:n=0,u=h.children||[],f.label=5;case 5:if(!(n<u.length))return[3,8];q=u[n];return[4,b(q,g)];case 6:f.sent(),f.label=7;case 7:return n++,[3,5];case 8:return[2]}})})}var d,e,g,l,m,k,p,r,u,q;return f(this,function(c){switch(c.label){case 0:d=a.json,e=d.scenes[d.scene||0],g=e.nodes,l=1<g.length,m=0,k=g,c.label=1;case 1:if(!(m<k.length))return[3,4];p=k[m];r=d.nodes[p];u=[b(p,0)];r.extensions&&r.extensions.MSFT_lod&&Array.isArray(r.extensions.MSFT_lod.ids)&&!l&&(q=r.extensions.MSFT_lod.ids,
u.push.apply(u,q.map(function(a,c){return b(a,c+1)})));return[4,h.all(u)];case 2:c.sent(),c.label=3;case 3:return m++,[3,1];case 4:return[2]}})})}function g(a,b,d){var f=function(b){var f=d+"_tex_"+(b&&b.id)+(b&&b.name?"_"+b.name:"");if(b&&!a.textures.has(f)){var g=c.makeTextureSource(b.data,{wrap:{s:e(b.wrapS),t:e(b.wrapT)},mipmap:r.some(function(a){return a===b.minFilter}),noUnpackFlip:!0});a.textures.set(f,g)}return f},g=d+"_mat_"+b.id+"_"+b.name;a.materials.has(g)||(b=c.makeMaterialParameters({color:[b.color[0],
b.color[1],b.color[2]],opacity:b.color[3],alphaMode:b.alphaMode,alphaCutoff:b.alphaCutoff,doubleSided:b.doubleSided,colorMixMode:b.ESRI_externalColorMixMode,textureColor:b.colorTexture?f(b.colorTexture):void 0,textureNormal:b.normalTexture?f(b.normalTexture):void 0}),a.materials.set(g,b));return g}function e(a){if(33071===a||33648===a||10497===a)return a;t.error("Unexpected TextureSampler WrapMode: "+a)}Object.defineProperty(b,"__esModule",{value:!0});var u=0;b.load=function(c,b,e){void 0===e&&(e=
{});return n(this,void 0,void 0,function(){var e,h,k,p,r=this;return f(this,function(q){switch(q.label){case 0:return[4,a.Resource.load(c,t,b)];case 1:return e=q.sent(),h="gltf_"+u++,k={lods:[],materials:new Map,textures:new Map},p=!(!e.json.asset.extras||"symbolResource"!==e.json.asset.extras.ESRI_type),[4,l(e,function(a,c,b,l){return n(r,void 0,void 0,function(){var p,r,n,u,q,w,x,v,z,A;return f(this,function(f){switch(f.label){case 0:p=a.mode||4;a:switch(p){case 4:case 5:case 6:r=p;break a;default:r=
null}return d.isNone(r)?(t.warnUnsupported("Unsupported primitive mode ("+y[p]+"). Skipping primitive."),[2]):[4,e.getMaterial(a)];case 1:return n=f.sent(),q={transform:m.mat4f64.clone(c)},w={},[4,e.getPositionData(a)];case 2:return q.attributes=(w.position=f.sent(),w.normal=null,w.texCoord0=null,w.color=null,w.tangent=null,w),[4,e.getIndexData(a)];case 3:u=(q.indices=f.sent(),q.primitiveType=r,q.material=g(k,n,h),q);if(!e.hasNormals(a))return[3,5];x=u.attributes;return[4,e.getNormalData(a)];case 4:x.normal=
f.sent(),f.label=5;case 5:if(!e.hasTangents(a))return[3,7];v=u.attributes;return[4,e.getTangentData(a)];case 6:v.tangent=f.sent(),f.label=7;case 7:if(!e.hasTextureCoordinates(a))return[3,9];z=u.attributes;return[4,e.getTextureCoordinates(a)];case 8:z.texCoord0=f.sent(),f.label=9;case 9:if(!e.hasVertexColors(a))return[3,11];A=u.attributes;return[4,e.getVertexColors(a)];case 10:A.color=f.sent(),f.label=11;case 11:return k.lods[b]=k.lods[b]||{parts:[],name:l,lodThreshold:null},k.lods[b].parts.push(u),
[2]}})})})];case 2:return q.sent(),[2,{model:k,meta:{isEsriSymbolResource:p,uri:e.uri},customMeta:{}}]}})})};var t=new p.DefaultErrorContext,r=[9987,9985],y="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" ")})},"esri/views/3d/glTF/DefaultErrorContext":function(){define(["require","exports","../../../core/Logger"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});var f=n.getLogger("esri.views.3d.glTF");q=function(){function b(){}b.prototype.error=function(b){throw Error("[glTF loader]"+
b);};b.prototype.errorUnsupported=function(b){this.error("[Unsupported Feature] "+b)};b.prototype.errorUnsupportedIf=function(b,f){b&&this.error("[Unsupported Feature] "+f)};b.prototype.assert=function(b,f){b||this.error(f)};b.prototype.warn=function(b){f.warn(b)};b.prototype.warnUnsupported=function(b){this.warn("[Unsupported Feature] "+b)};b.prototype.warnUnsupportedIf=function(b,f){b&&this.warnUnsupported(f)};return b}();b.DefaultErrorContext=q})},"esri/views/3d/glTF/LoaderResult":function(){define(["require",
"exports","../../../core/tsSupport/assignHelper"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.makeMaterialParameters=function(b){void 0===b&&(b={});return n({color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,colorMixMode:"multiply"},b)};b.makeTextureSource=function(b,k){void 0===k&&(k={});return{data:b,parameters:n({wrap:n({s:10497,t:10497},k.wrap),noUnpackFlip:!0,
mipmap:!1},k)}}})},"esri/views/3d/glTF/internal/Resource":function(){define("require exports ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/assignHelper ../../../../core/compilerUtils ../../../../core/lang ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/Version ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/quat ../../../../core/libs/gl-matrix-2/quatf64 ./BinaryStreamReader ./fillDefaults ./pathUtils ../../support/buffer/BufferView ../../support/buffer/utils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w){function x(a){switch(a.componentType){case 5120:return new y.BufferViewVec2i8(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5121:return new y.BufferViewVec2u8(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5122:return new y.BufferViewVec2i16(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5123:return new y.BufferViewVec2u16(a.raw,a.byteOffset,a.byteStride,a.byteOffset+
a.byteStride*a.entryCount);case 5125:return new y.BufferViewVec2u32(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);case 5126:return new y.BufferViewVec2f(a.raw,a.byteOffset,a.byteStride,a.byteOffset+a.byteStride*a.entryCount);default:d.neverReached(a.componentType)}}function v(a){return n(this,void 0,void 0,function(){return f(this,function(c){return[2,m.create(function(c,b){var d=new Blob([a]),e=new FileReader;e.onload=function(){c(JSON.parse(e.result))};e.onerror=function(a){b(a)};
e.readAsText(d)})]})})}function z(a,c){return n(this,void 0,void 0,function(){return f(this,function(b){return[2,m.create(function(b,d){var e=new Blob([a],{type:c}),f=URL.createObjectURL(e),g=new Image;g.addEventListener("load",function(){URL.revokeObjectURL(f);b(g)});g.addEventListener("error",function(a){URL.revokeObjectURL(f);d(a)});g.src=f})]})})}Object.defineProperty(b,"__esModule",{value:!0});var A;q=function(){function b(a,c,b,d,e){this.context=a;this.errorContext=c;this.uri=b;this.json=d;
this.glbBuffer=e;this.bufferCache=new Map;this.textureCache=new Map;this.materialCache=new Map;this.nodeParentMap=new Map;this.nodeTransformCache=new Map;this.baseUri=r.splitURI(this.uri).dirPart;this.checkVersionSupported();this.checkRequiredExtensionsSupported();c.errorUnsupportedIf(null==d.scenes,"Scenes must be defined.");c.errorUnsupportedIf(null==d.meshes,"Meshes must be defined");c.errorUnsupportedIf(null==d.nodes,"Nodes must be defined.");this.computeNodeParents()}b.load=function(a,c,d){return n(this,
void 0,void 0,function(){var e,g,l,m,k,p;return f(this,function(f){switch(f.label){case 0:return h.endsWith(d,".gltf")?[4,a.loadJson(d)]:[3,2];case 1:return e=f.sent(),[2,new b(a,c,d,e)];case 2:return h.endsWith(d,".glb")?[4,a.loadBinary(d)]:[3,5];case 3:return g=f.sent(),[4,b.parseGLB(c,g)];case 4:return l=f.sent(),[2,new b(a,c,d,l.json,l.binaryData)];case 5:return[4,a.loadBinary(d)];case 6:return m=f.sent(),k=new u.BinaryStreamReader(m),4<=k.remainingBytes()&&1179937895===k.readUint32()?[4,b.parseGLB(c,
m)]:[3,8];case 7:return l=f.sent(),[2,new b(a,c,d,l.json,l.binaryData)];case 8:return[4,a.loadJson(d)];case 9:return p=f.sent(),[2,new b(a,c,d,p)]}})})};b.parseGLB=function(a,c){return n(this,void 0,void 0,function(){var b,d,e,g,h,l,m,k,p;return f(this,function(f){switch(f.label){case 0:b=new u.BinaryStreamReader(c),a.assert(12<=b.remainingBytes(),"GLB binary data is insufficiently large."),d=b.readUint32(),e=b.readUint32(),g=b.readUint32(),a.assert(1179937895===d,"Magic first 4 bytes do not fit to expected GLB value."),
a.assert(c.byteLength>=g,"GLB binary data is smalller than header specifies."),a.errorUnsupportedIf(2!==e,"Only GLB container version 2 is supported."),h=0,f.label=1;case 1:if(!(8<=b.remainingBytes()))return[3,5];k=b.readUint32();p=b.readUint32();if(0!==h)return[3,3];a.assert(1313821514===p,"First GLB chunck must be JSON.");a.assert(0<=k,"No JSON data found.");return[4,v(b.readUint8Array(k))];case 2:return l=f.sent(),[3,4];case 3:1===h?(a.errorUnsupportedIf(5130562!==p,"Second GLB chunck expected to be BIN."),
m=b.readUint8Array(k)):a.warnUnsupported("More than 2 GLB chunks detected. Skipping."),f.label=4;case 4:return h+=1,[3,1];case 5:return l||a.error("No GLB JSON chunk detected."),[2,{json:l,binaryData:m}]}})})};b.prototype.getBuffer=function(a){return n(this,void 0,void 0,function(){var c,b,d,e;return f(this,function(f){switch(f.label){case 0:return c=this.json.buffers[a],b=this.errorContext,null==c.uri?(b.assert(null!=this.glbBuffer,"GLB buffer not present"),[2,this.glbBuffer]):(d=this.bufferCache.get(a))?
[3,2]:[4,this.context.loadBinary(this.resolveUri(c.uri))];case 1:e=f.sent(),d=new Uint8Array(e),this.bufferCache.set(a,d),b.assert(d.byteLength===c.byteLength,"Buffer byte lengths should match."),f.label=2;case 2:return[2,d]}})})};b.prototype.getAccessor=function(a){return n(this,void 0,void 0,function(){var c,b,d,e,g,h,l,m;return f(this,function(f){switch(f.label){case 0:return c=this.json.accessors[a],b=this.errorContext,b.errorUnsupportedIf(null==c.bufferView,"An accessor bufferView is required."),
b.errorUnsupportedIf(c.type in["MAT2","MAT3","MAT4"],"AttributeType "+c.type+" is not supported"),d=this.json.bufferViews[c.bufferView],[4,this.getBuffer(d.buffer)];case 1:return e=f.sent(),g=F[c.type],h=H[c.componentType],l=g*h,m=d.byteStride||l,[2,{raw:e.buffer,byteStride:m,byteOffset:e.byteOffset+(d.byteOffset||0)+(c.byteOffset||0),entryCount:c.count,isDenselyPacked:m===l,componentCount:g,componentByteSize:h,componentType:c.componentType,min:c.min,max:c.max,normalized:!!c.normalized}]}})})};b.prototype.getIndexData=
function(a){return n(this,void 0,void 0,function(){var c;return f(this,function(b){switch(b.label){case 0:return null==a.indices?[2,null]:[4,this.getAccessor(a.indices)];case 1:c=b.sent();if(c.isDenselyPacked)switch(c.componentType){case 5121:return[2,new Uint8Array(c.raw,c.byteOffset,c.entryCount)];case 5123:return[2,new Uint16Array(c.raw,c.byteOffset,c.entryCount)];case 5125:return[2,new Uint32Array(c.raw,c.byteOffset,c.entryCount)]}else switch(c.componentType){case 5121:return[2,w.scalar.makeDense(this.wrapAccessor(y.BufferViewUint8,
c))];case 5123:return[2,w.scalar.makeDense(this.wrapAccessor(y.BufferViewUint16,c))];case 5125:return[2,w.scalar.makeDense(this.wrapAccessor(y.BufferViewUint32,c))]}return[2]}})})};b.prototype.getPositionData=function(a){return n(this,void 0,void 0,function(){var c,b;return f(this,function(d){switch(d.label){case 0:return c=this.errorContext,c.errorUnsupportedIf(null==a.attributes.POSITION,"POSITION vertex data is required."),[4,this.getAccessor(a.attributes.POSITION)];case 1:return b=d.sent(),c.errorUnsupportedIf(5126!==
b.componentType,"[POSITION attribute] Expected type FLOAT, found "+D[b.componentType]),c.errorUnsupportedIf(3!==b.componentCount,"POSITION attribute must have 3 components."),[2,this.wrapAccessor(y.BufferViewVec3f,b)]}})})};b.prototype.getNormalData=function(a){return n(this,void 0,void 0,function(){var c,b;return f(this,function(d){switch(d.label){case 0:return c=this.errorContext,c.errorUnsupportedIf(null==a.attributes.NORMAL,"NORMAL vertex data is required."),[4,this.getAccessor(a.attributes.NORMAL)];
case 1:return b=d.sent(),c.errorUnsupportedIf(5126!==b.componentType,"[NORMAL attribute] Expected type FLOAT, found "+D[b.componentType]),c.errorUnsupportedIf(3!==b.componentCount,"NORMAL attribute must have 3 components."),[2,this.wrapAccessor(y.BufferViewVec3f,b)]}})})};b.prototype.getTangentData=function(a){return n(this,void 0,void 0,function(){var c,b;return f(this,function(d){switch(d.label){case 0:return c=this.errorContext,c.errorUnsupportedIf(null==a.attributes.TANGENT,"TANGENT vertex data is required."),
[4,this.getAccessor(a.attributes.TANGENT)];case 1:return b=d.sent(),c.errorUnsupportedIf(5126!==b.componentType,"[TANGENT attribute] Expected type FLOAT, found "+D[b.componentType]),c.errorUnsupportedIf(4!==b.componentCount,"NORMAL attribute must have 4 components."),[2,new y.BufferViewVec4f(b.raw,b.byteOffset,b.byteStride,b.byteOffset+b.byteStride*b.entryCount)]}})})};b.prototype.getTextureCoordinates=function(a){return n(this,void 0,void 0,function(){var c,b;return f(this,function(d){switch(d.label){case 0:return c=
this.errorContext,c.errorUnsupportedIf(null==a.attributes.TEXCOORD_0,"TEXCOORD_0 vertex data is required."),[4,this.getAccessor(a.attributes.TEXCOORD_0)];case 1:b=d.sent();c.errorUnsupportedIf(2!==b.componentCount,"TEXCOORD_0 attribute must have 2 components.");if(5126===b.componentType)return[2,this.wrapAccessor(y.BufferViewVec2f,b)];c.errorUnsupportedIf(!b.normalized,"[TEXCOORD_0 attribute] Integer ComponentTypes are only supported for a normalized accessor.");return[2,x(b)]}})})};b.prototype.hasNormals=
function(a){return!!a.attributes.NORMAL};b.prototype.hasVertexColors=function(a){return!!a.attributes.COLOR_0};b.prototype.hasTextureCoordinates=function(a){return!!a.attributes.TEXCOORD_0};b.prototype.hasTangents=function(a){return!!a.attributes.TANGENT};b.prototype.getVertexColors=function(a){return n(this,void 0,void 0,function(){var c,b;return f(this,function(d){switch(d.label){case 0:return c=this.errorContext,c.errorUnsupportedIf(null==a.attributes.COLOR_0,"COLOR_0 vertex data is required."),
[4,this.getAccessor(a.attributes.COLOR_0)];case 1:b=d.sent();c.errorUnsupportedIf(4!==b.componentCount&&3!==b.componentCount,"COLOR_0 attribute must have 3 or 4 components.");if(4===b.componentCount){if(5126===b.componentType)return[2,this.wrapAccessor(y.BufferViewVec4f,b)];if(5121===b.componentType)return[2,this.wrapAccessor(y.BufferViewVec4u8,b)];if(5123===b.componentType)return[2,this.wrapAccessor(y.BufferViewVec4u16,b)]}else if(3===b.componentCount){if(5126===b.componentType)return[2,this.wrapAccessor(y.BufferViewVec3f,
b)];if(5121===b.componentType)return[2,this.wrapAccessor(y.BufferViewVec3u8,b)];if(5123===b.componentType)return[2,this.wrapAccessor(y.BufferViewVec3u16,b)]}c.errorUnsupported("[COLOR_0 attribute] Unsupported component type: "+D[b.componentType]);return[2]}})})};b.prototype.getMaterial=function(a){return n(this,void 0,void 0,function(){var c,b,d,e,g,h,l,m;return f(this,function(f){switch(f.label){case 0:c=this.errorContext;if(b=this.materialCache.get(a.material))return[3,6];d=null!=a.material?t.material(this.json.materials[a.material]):
t.material();e=d.pbrMetallicRoughness;g=this.hasVertexColors(a);h=void 0;if(!e.baseColorTexture)return[3,2];c.errorUnsupportedIf(0!==(e.baseColorTexture.texCoord||0),"Only TEXCOORD_0 is supported");return[4,this.getTexture(e.baseColorTexture.index)];case 1:h=f.sent(),f.label=2;case 2:l=void 0;if(!d.normalTexture)return[3,5];if(0===(e.baseColorTexture.texCoord||0))return[3,3];c.warnUnsupported("Only TEXCOORD_0 is supported for normal map");return[3,5];case 3:return[4,this.getTexture(d.normalTexture.index)];
case 4:l=f.sent(),f.label=5;case 5:m=null!=a.material?a.material:-1,b={alphaMode:d.alphaMode,alphaCutoff:d.alphaCutoff,color:e.baseColorFactor,doubleSided:!!d.doubleSided,colorTexture:h,normalTexture:l,name:d.name,id:m,vertexColors:g,ESRI_externalColorMixMode:d.extras.ESRI_externalColorMixMode},f.label=6;case 6:return[2,b]}})})};b.prototype.getTexture=function(a){return n(this,void 0,void 0,function(){var c,b,d,e,g,h,l,m;return f(this,function(f){switch(f.label){case 0:c=this.errorContext;b=this.json.textures[a];
d=t.textureSampler(null!=b.sampler?this.json.samplers[b.sampler]:{});c.errorUnsupportedIf(null==b.source,"source must be defined for a texture");e=this.json.images[b.source];if(g=this.textureCache.get(a))return[3,6];h=void 0;return e.uri?[4,this.context.loadImage(this.resolveUri(e.uri))]:[3,2];case 1:return h=f.sent(),[3,5];case 2:return c.errorUnsupportedIf(null==e.bufferView,"Image bufferView must be defined."),c.errorUnsupportedIf(null==e.mimeType,"Image mimeType must be defined."),l=this.json.bufferViews[e.bufferView],
[4,this.getBuffer(l.buffer)];case 3:return m=f.sent(),c.errorUnsupportedIf(null!=l.byteStride,"byteStride not supported for image buffer"),[4,z(new Uint8Array(m.buffer,m.byteOffset+(l.byteOffset||0),l.byteLength),e.mimeType)];case 4:h=f.sent(),f.label=5;case 5:g={data:h,wrapS:d.wrapS,wrapT:d.wrapT,minFilter:d.minFilter,name:e.name,id:a},this.textureCache.set(a,g),f.label=6;case 6:return[2,g]}})})};b.prototype.getNodeTransform=function(c){if(void 0===c)return C;var b=this.nodeTransformCache.get(c);
if(!b){var b=this.getNodeTransform(this.getNodeParent(c)),d=this.json.nodes[c];if(d.matrix)b=a.mat4.multiply(l.mat4f64.create(),b,d.matrix);else if(d.translation||d.rotation||d.scale)b=l.mat4f64.clone(b),d.translation&&a.mat4.translate(b,b,d.translation),d.rotation&&(E[3]=g.quat.getAxisAngle(E,d.rotation),a.mat4.rotate(b,b,E[3],E)),d.scale&&a.mat4.scale(b,b,d.scale);this.nodeTransformCache.set(c,b)}return b};b.prototype.wrapAccessor=function(a,c){return new a(c.raw,c.byteOffset,c.byteStride,c.byteOffset+
c.byteStride*(c.entryCount-1)+c.componentByteSize*c.componentCount)};b.prototype.resolveUri=function(a){return p.makeAbsolute(a,this.baseUri)};b.prototype.getNodeParent=function(a){return this.nodeParentMap.get(a)};b.prototype.checkVersionSupported=function(){c.Version.parse(this.json.asset.version,"glTF").validate(B)};b.prototype.checkRequiredExtensionsSupported=function(){var a=this.json,c=this.errorContext;a.extensionsRequired&&0!==a.extensionsRequired.length&&c.errorUnsupportedIf(!0,"Extensions: "+
a.extensionsRequired.join(", "))};b.prototype.computeNodeParents=function(){var a=this;this.json.nodes.forEach(function(c,b){c.children&&c.children.forEach(function(c){a.nodeParentMap.set(c,b)})})};return b}();b.Resource=q;var B=new c.Version(2,0,"glTF"),C=a.mat4.fromXRotation(l.mat4f64.create(),Math.PI/2),E=e.quatf64.create(),F={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},H=(A={},A[5120]=1,A[5121]=1,A[5122]=2,A[5123]=2,A[5126]=4,A[5125]=4,A),D={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",
5125:"UNSIGNED_INT",5126:"FLOAT"}})},"esri/core/libs/gl-matrix-2/quat":function(){define(["require","exports","./math/quat"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.quat=n})},"esri/core/libs/gl-matrix-2/math/quat":function(){define("require exports ../factories/mat3f64 ../factories/quatf64 ../factories/vec3f64 ./common ./vec3 ./vec4".split(" "),function(q,b,n,f,k,d,h,m){function p(a,c,b){b*=.5;var d=Math.sin(b);a[0]=d*c[0];a[1]=d*c[1];a[2]=d*c[2];a[3]=Math.cos(b);return a}
function c(a,c,b){var d=c[0],e=c[1],f=c[2];c=c[3];var g=b[0],h=b[1],l=b[2];b=b[3];a[0]=d*b+c*g+e*l-f*h;a[1]=e*b+c*h+f*g-d*l;a[2]=f*b+c*l+d*h-e*g;a[3]=c*b-d*g-e*h-f*l;return a}function a(a,c,b,e){var f=c[0],g=c[1],h=c[2];c=c[3];var l=b[0],m=b[1],k=b[2];b=b[3];var p,r,n;r=f*l+g*m+h*k+c*b;0>r&&(r=-r,l=-l,m=-m,k=-k,b=-b);1-r>d.EPSILON?(p=Math.acos(r),n=Math.sin(p),r=Math.sin((1-e)*p)/n,e=Math.sin(e*p)/n):r=1-e;a[0]=r*f+e*l;a[1]=r*g+e*m;a[2]=r*h+e*k;a[3]=r*c+e*b;return a}function l(a,c){var b=c[0]+c[4]+
c[8];if(0<b)b=Math.sqrt(b+1),a[3]=.5*b,b=.5/b,a[0]=(c[5]-c[7])*b,a[1]=(c[6]-c[2])*b,a[2]=(c[1]-c[3])*b;else{var d=0;c[4]>c[0]&&(d=1);c[8]>c[3*d+d]&&(d=2);var e=(d+1)%3,f=(d+2)%3,b=Math.sqrt(c[3*d+d]-c[3*e+e]-c[3*f+f]+1);a[d]=.5*b;b=.5/b;a[3]=(c[3*e+f]-c[3*f+e])*b;a[e]=(c[3*e+d]+c[3*d+e])*b;a[f]=(c[3*f+d]+c[3*d+f])*b}return a}Object.defineProperty(b,"__esModule",{value:!0});b.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};b.setAxisAngle=p;b.getAxisAngle=function(a,c){var b=2*Math.acos(c[3]),
e=Math.sin(b/2);e>d.EPSILON?(a[0]=c[0]/e,a[1]=c[1]/e,a[2]=c[2]/e):(a[0]=1,a[1]=0,a[2]=0);return b};b.multiply=c;b.rotateX=function(a,c,b){b*=.5;var d=c[0],e=c[1],f=c[2];c=c[3];var g=Math.sin(b);b=Math.cos(b);a[0]=d*b+c*g;a[1]=e*b+f*g;a[2]=f*b-e*g;a[3]=c*b-d*g;return a};b.rotateY=function(a,c,b){b*=.5;var d=c[0],e=c[1],f=c[2];c=c[3];var g=Math.sin(b);b=Math.cos(b);a[0]=d*b-f*g;a[1]=e*b+c*g;a[2]=f*b+d*g;a[3]=c*b-e*g;return a};b.rotateZ=function(a,c,b){b*=.5;var d=c[0],e=c[1],f=c[2];c=c[3];var g=Math.sin(b);
b=Math.cos(b);a[0]=d*b+e*g;a[1]=e*b-d*g;a[2]=f*b+c*g;a[3]=c*b-f*g;return a};b.calculateW=function(a,c){var b=c[0],d=c[1];c=c[2];a[0]=b;a[1]=d;a[2]=c;a[3]=Math.sqrt(Math.abs(1-b*b-d*d-c*c));return a};b.slerp=a;b.random=function(a){var c=d.RANDOM(),b=d.RANDOM(),e=d.RANDOM(),f=Math.sqrt(1-c),c=Math.sqrt(c);a[0]=f*Math.sin(2*Math.PI*b);a[1]=f*Math.cos(2*Math.PI*b);a[2]=c*Math.sin(2*Math.PI*e);a[3]=c*Math.cos(2*Math.PI*e);return a};b.invert=function(a,c){var b=c[0],d=c[1],e=c[2];c=c[3];var f=b*b+d*d+e*
e+c*c,f=f?1/f:0;a[0]=-b*f;a[1]=-d*f;a[2]=-e*f;a[3]=c*f;return a};b.conjugate=function(a,c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=c[3];return a};b.fromMat3=l;b.fromEuler=function(a,c,b,d){var e=.5*Math.PI/180;c*=e;b*=e;d*=e;e=Math.sin(c);c=Math.cos(c);var f=Math.sin(b);b=Math.cos(b);var g=Math.sin(d);d=Math.cos(d);a[0]=e*b*d-c*f*g;a[1]=c*f*d+e*b*g;a[2]=c*b*g-e*f*d;a[3]=c*b*d+e*f*g;return a};b.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};b.copy=m.copy;b.set=m.set;b.add=m.add;
b.mul=c;b.scale=m.scale;b.dot=m.dot;b.lerp=m.lerp;b.length=m.length;b.len=b.length;b.squaredLength=m.squaredLength;b.sqrLen=b.squaredLength;b.normalize=m.normalize;b.exactEquals=m.exactEquals;b.equals=m.equals;b.rotationTo=function(a,c,d){var f=h.dot(c,d);if(-.999999>f)return h.cross(g,e,c),1E-6>h.len(g)&&h.cross(g,u,c),h.normalize(g,g),p(a,g,Math.PI),a;if(.999999<f)return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a;h.cross(g,c,d);a[0]=g[0];a[1]=g[1];a[2]=g[2];a[3]=1+f;return b.normalize(a,a)};var g=k.create(),
e=k.fromValues(1,0,0),u=k.fromValues(0,1,0);b.sqlerp=function(c,b,d,e,f,g){a(t,b,f,g);a(r,d,e,g);a(c,t,r,2*g*(1-g));return c};var t=f.create(),r=f.create();b.setAxes=function(a,c,d,e){var f=y;f[0]=d[0];f[3]=d[1];f[6]=d[2];f[1]=e[0];f[4]=e[1];f[7]=e[2];f[2]=-c[0];f[5]=-c[1];f[8]=-c[2];return b.normalize(a,l(a,f))};var y=n.create()})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this.data=
b;this.offset4=0;this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}b.prototype.readUint32=function(){var b=this.offset4;this.offset4+=1;return this.dataUint32[b]};b.prototype.readUint8Array=function(b){var f=4*this.offset4;this.offset4+=b/4;return new Uint8Array(this.data,f,b)};b.prototype.remainingBytes=function(){return this.data.byteLength-4*this.offset4};return b}();b.BinaryStreamReader=q})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["require",
"exports","../../../../core/tsSupport/assignHelper"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});var f={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},k={pbrMetallicRoughness:f,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},d={ESRI_externalColorMixMode:"tint"};b.material=function(b){void 0===b&&(b={});var h=n({},f,b.pbrMetallicRoughness),c=n({},d,b.extras);switch(c.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":break;
default:c.ESRI_externalColorMixMode="tint"}return n({},k,b,{pbrMetallicRoughness:h,extras:c})};var h={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};b.textureSampler=function(b){return n({},h,b)}})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.splitURI=function(b){var f,k;b.replace(/^(.*\/)?([^/]*)$/,function(b,h,m){f=h||"";k=m||"";return""});return{dirPart:f,filePart:k}}})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["require",
"exports","../../../../core/typedArrayUtil","../../webgl-engine/lib/geometryDataUtils"],function(q,b,n,f){function k(b){return f.generateDefaultIndexArray(b)}Object.defineProperty(b,"__esModule",{value:!0});b.linearIndexArray=k;b.trianglesToTriangles=function(b){return"number"===typeof b?k(b):n.isUint16Array(b)||n.isUint8Array(b)?new Uint32Array(b):b};b.triangleStripToTriangles=function(b){var d="number"===typeof b?b:b.length;if(3>d)return new Uint32Array(0);var d=d-2,f=new Uint32Array(3*d);if("number"===
typeof b)for(var k=0,c=0;c<d;c+=1)0===c%2?(f[k++]=c,f[k++]=c+1):(f[k++]=c+1,f[k++]=c),f[k++]=c+2;else for(c=k=0;c<d;c+=1){if(0===c%2)var a=b[c],l=b[c+1],g=b[c+2];else a=b[c+1],l=b[c],g=b[c+2];f[k++]=a;f[k++]=l;f[k++]=g}return f};b.triangleFanToTriangles=function(b){var d="number"===typeof b?b:b.length;if(3>d)return new Uint32Array(0);var d=d-2,f=new Uint32Array(3*d);if("number"===typeof b){for(var k=0,c=0;c<d;++c)f[k++]=0,f[k++]=c+1,f[k++]=c+2;return f}for(var a=b[0],l=b[1],c=k=0;c<d;++c){var g=b[c+
2];f[k++]=a;f[k++]=l;l=f[k++]=g}return f}})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper dojo/errors/CancelError ../../../../request ../../../../core/Error ../../../../core/lang ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/Version ../../../../geometry/support/aaBoundingBox ../../support/imageUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y){function w(c,b){if(b){var e=b.request(c,"json");return a.create(function(a,c){e.then(function(c){a(c.data)},function(a){c(a instanceof d?a:x(a.url))})},function(){b.cancelRequest(e)})}var f=h(c);return a.create(function(a,c){f.then(function(c){a(c.data)},function(a){c(a instanceof d?a:x(a))})},function(){f.cancel()})}function x(a){return new m("","Request for object resource failed: "+a)}function v(a,c){return k(this,void 0,void 0,function(){var b,d,e,
g,h,m,k,r,n,q,w,x,v,F,H,X,W,ca,da,ba,aa,S,Z,Y,ea,ga,ja,fa,ha,ka,ia,ma,na,pa,sa;return f(this,function(f){switch(f.label){case 0:return e=[],g=[],h=[],m=[],k=l.Version.parse(a.version||"1.0","wosr"),E.validate(k),r="meshsymbol_"+a.model.name,n=a.textureDefinitions,[4,A(r,n,c)];case 1:q=f.sent();for(w in q)m.push(q[w].engineTexObj);x=a.model.geometries;v=a.materialDefinitions;for(H=F=0;H<x.length;H++){var D=X=x[H],J=D.params,G=J.topology;f=!0;J.vertexAttributes||(C.warn("Geometry must specify vertex attributes"),
f=!1);switch(J.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:G=J.faces;if(!G)C.warn("Indexed geometries must specify faces"),f=!1;else if(J.vertexAttributes){var M=void 0;for(M in J.vertexAttributes)(J=G[M])&&J.values?(null!=J.valueType&&"UInt32"!==J.valueType&&(C.warn("Unsupported indexed geometry indices type '"+J.valueType+"', only UInt32 is currently supported"),f=!1),null!=J.valuesPerElement&&1!==J.valuesPerElement&&(C.warn("Unsupported indexed geometry values per element '"+
J.valuesPerElement+"', only 1 is currently supported"),f=!1)):(C.warn("Indexed geometry does not specify face indices for '"+M+"' attribute"),f=!1)}break;default:C.warn("Unsupported topology '"+G+"'"),f=!1}D.params.material||(C.warn("Geometry requires material"),f=!1);D=D.params.vertexAttributes;J=void 0;for(J in D)D[J].values||(C.warn("Geometries with externally defined attributes are not yet supported"),f=!1);if(f){f=X.params;b=f.material;d=f.texture;W=X.params.vertexAttributes;ca={};for(da in W)ba=
W[da],aa=ba.values,ca[da]={data:aa,size:ba.valuesPerElement};S={};if("PerAttributeArray"===X.params.topology){f=Z=ca.position.data.length/ca.position.size;D=new Uint32Array(f);for(J=0;J<f;J++)D[J]=J;Y=D;for(ea in ca)S[ea]=Y}else for(ja in ga=X.params.faces,ga)S[ja]=new Uint32Array(ga[ja].values);fa=d?q[d]:null;ha=h[b]?h[b][d]:null;ha||(ka=b.substring(b.lastIndexOf("/")+1),ia=v[ka].params,1===ia.transparency&&(ia.transparency=0),ma=fa&&fa.alphaChannelUsage,na=0<ia.transparency||"transparency"===ma||
"maskAndTransparency"===ma,pa={ambient:ia.diffuse,diffuse:ia.diffuse,specular:[0,0,0],opacity:1-(ia.transparency||0),transparent:na,textureAlphaMode:fa?B(fa.alphaChannelUsage):void 0,textureAlphaCutoff:.33,textureId:fa?fa.engineTexObj.id:void 0,textureInitTransparent:!0,doubleSided:!0,cullFace:"none",flipV:!1,colorMixMode:ia.externalColorMixMode||"tint",textureAlphaPremultiplied:!0},c&&c.materialParamsMixin&&p.mixin(pa,c.materialParamsMixin),ha=new y(pa,r),h[b]||(h[b]={}),h[b][d]=ha);g.push(ha);sa=
new u(new t(ca,S),r);F+=S.position?S.position.length:0;e.push(sa)}}return[2,{stageResources:{textures:m,materials:g,geometries:e},pivotOffset:a.model.pivotOffset,boundingBox:z(e),numberOfVertices:F,lodThreshold:null}]}})})}function z(a){var c=g.empty();a.forEach(function(a){a=a.boundingInfo;g.expand(c,a.getBBMin());g.expand(c,a.getBBMax())});return c}function A(c,b,d){return k(this,void 0,void 0,function(){var g,h,l,m,k,p,n,t;return f(this,function(f){switch(f.label){case 0:g=[];h=function(f){var h=
b[f],l=h.images[0].data;if(!l)return C.warn("Externally referenced texture data is not yet supported"),"continue";var l=h.encoding+";base64,"+l,m="/textureDefinitions/"+f,k={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:!0};f=d&&d.disableTextures?a.resolve(null):e.requestImage(l);g.push(f.then(function(a){return{refId:m,engineTexObj:new r(a,c,k),alphaChannelUsage:"rgba"===h.channels?h.alphaChannelUsage||"transparency":"none"}}))};for(l in b)h(l);return[4,a.all(g)];case 1:m=f.sent();k={};
p=0;for(n=m;p<n.length;p++)t=n[p],k[t.refId]=t;return[2,k]}})})}function B(a){switch(a){case "mask":return"mask";case "maskAndTransparency":return"maskBlend";case "none":return"opaque";case "transparency":return"blend";default:return"blend"}}Object.defineProperty(b,"__esModule",{value:!0});var C=c.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");b.load=function(a,c){return k(this,void 0,void 0,function(){var b;return f(this,function(d){switch(d.label){case 0:return[4,w(a,c.streamDataSupplier)];
case 1:return b=d.sent(),[2,v(b,c)]}})})};b.createStageResources=v;var E=new l.Version(1,2,"wosr")})},"esri/views/3d/support/buffer/math":function(){define(["require","exports","./math/vec3","./math/vec4"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});b.vec3=n;b.vec4=f})},"esri/views/3d/support/buffer/math/vec4":function(){define(["require","exports","./common"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.transformMat4=function(b,k,d){if(b.count!==k.count)n.logger.error("source and destination buffers need to have the same number of elements");
else{var f=b.count,m=d[0],p=d[1],c=d[2],a=d[3],l=d[4],g=d[5],e=d[6],u=d[7],t=d[8],r=d[9],q=d[10],w=d[11],x=d[12],v=d[13],z=d[14];d=d[15];var A=b.typedBuffer;b=b.typedBufferStride;var B=k.typedBuffer;k=k.typedBufferStride;for(var C=0;C<f;C++){var E=C*b,F=C*k,H=B[F],D=B[F+1],G=B[F+2],F=B[F+3];A[E]=m*H+l*D+t*G+x*F;A[E+1]=p*H+g*D+r*G+v*F;A[E+2]=c*H+e*D+q*G+z*F;A[E+3]=a*H+u*D+w*G+d*F}}};b.transformMat3=function(b,k,d){if(b.count!==k.count)n.logger.error("source and destination buffers need to have the same number of elements");
else{var f=b.count,m=d[0],p=d[1],c=d[2],a=d[3],l=d[4],g=d[5],e=d[6],u=d[7];d=d[8];var t=b.typedBuffer;b=b.typedBufferStride;var r=k.typedBuffer;k=k.typedBufferStride;for(var q=0;q<f;q++){var w=q*b,x=q*k,v=r[x],z=r[x+1],A=r[x+2],x=r[x+3];t[w]=m*v+a*z+e*A;t[w+1]=p*v+l*z+u*A;t[w+2]=c*v+g*z+d*A;t[w+3]=x}}};b.scale=function(b,k,d){var f=Math.min(b.count,k.count),m=b.typedBuffer;b=b.typedBufferStride;var p=k.typedBuffer;k=k.typedBufferStride;for(var c=0;c<f;c++){var a=c*b,l=c*k;m[a]=d*p[l];m[a+1]=d*p[l+
1];m[a+2]=d*p[l+2];m[a+3]=d*p[l+3]}}})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../../../core/libs/gl-matrix-2/vec4f64 ../../../../../geometry/support/aaBoundingBox ../../../support/debugFlags ../../../support/buffer/glUtil ../Camera ../DefaultVertexAttributeLocations ../intersectorUtils ./InstanceData ./InstanceOctree ./LevelSelector ./RenderInstanceData ./utils ../../materials/DefaultMaterial ../../materials/internal/MaterialUtil ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A){function B(a,c,b,d){y.encodeDoubleVec3(a.modelOrigin,c,b.modelOriginHi,b.modelOriginLo,d);b.model.copyFrom(d,a.model,c);b.modelNormal.copyFrom(d,a.modelNormal,c);a.color&&b.color&&b.color.copyFrom(d,a.color,c);a.featureAttribute&&b.featureAttribute&&b.featureAttribute.copyFrom(d,a.featureAttribute,c)}Object.defineProperty(b,"__esModule",{value:!0});var C=z.assert,E=function(a){var c=a.baseBoundingSphere.radius;a=a.levels.map(function(a){return a.minScreenSpaceRadius});
return new t.LevelSelector(c,a)};b.setLevelSelectorFactory=function(a){E=a};var F=function(){function a(a,b){this.glMaterials={};var d=a.rctx,e=b.geometry;b=b.material;var f=e.data.toRenderData();this.materialRep=a.materialRep;b.setParameterValues({instancedDoublePrecision:!0});a=b.createBufferWriter();var g=a.vertexBufferLayout,h=a.elementCount(f),m=a.allocate(h);a.write({},f,void 0,m,0);this.geometry=e;this.material=b;this.glMaterials=y.acquireGLMaterials(b,this.materialRep);this.vertexBufferLayout=
g;this.vbo=v.createVertex(d,35044,m.buffer);this.vao=new A(d,l.Default3D,{geometry:c.glLayout(g)},{geometry:this.vbo});this.vertexCount=h}a.prototype.destroy=function(){y.releaseGLMaterials(this.material,this.materialRep);this.vbo.dispose();this.vao.dispose()};Object.defineProperty(a.prototype,"boundingInfo",{get:function(){return this.geometry.boundingInfo},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"triangleCount",{get:function(){return this.vertexCount/3},enumerable:!0,configurable:!0});
a.prototype.intersect=function(a,c,b,d,e,f){var h=this.geometry.id,l=e.toString();this.material.intersect(this.geometry,null,a.transform.transform,a,b,d,function(b,d,m,k,p,r){if(0<=b&&(null==c||c(a.rayBeginPoint,a.rayEndPoint,b))){p={type:"external",metadata:{layerUid:f.layerUid,graphicUid:f.graphicUid(e)}};if(null==a.results.min.drapedLayerOrder||k>=a.results.min.drapedLayerOrder)if(null==a.results.min.dist||b<a.results.min.dist)a.results.min.set(p,l,b,d,a.transform.transform,k,null,h,m),a.results.min.intersector=
"LodRenderer";if(null==a.results.max.drapedLayerOrder||k>=a.results.max.drapedLayerOrder)if(null==a.results.max.dist||b>a.results.max.dist)a.results.max.set(p,l,b,d,a.transform.transform,k,null,h,m),a.results.min.intersector="LodRenderer";a.enable.storeAll&&(r=new g.IntersectorResult(a.results.min.ray),r.set(p,l,b,d,a.transform.transform,k,null,h,m),r.intersector="LodRenderer",a.results.all.push(r))}},null)};return a}();b.LodComponentData=F;var H=function(){function a(a,c){var b=this;this.components=
[];this.minScreenSpaceRadius=c.minScreenSpaceRadius;c.components.forEach(function(c){b.components.push(new F(a,c))})}a.prototype.destroy=function(){this.components.forEach(function(a){a.destroy()})};a.prototype.intersect=function(a,c,b,d,e,f){this.components.forEach(function(g){g.intersect(a,c,b,d,e,f)})};Object.defineProperty(a.prototype,"boundingBox",{get:function(){if(!this._boundingBox){var a=m.empty();this.components.forEach(function(c){m.expand(a,c.boundingInfo.bbMin);m.expand(a,c.boundingInfo.bbMax)});
this._boundingBox=a}return this._boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"boundingSphere",{get:function(){if(!this._boundingSphere){var a=this.boundingBox,c=d.vec3f64.create();m.center(a,c);this._boundingSphere={center:c,radius:.5*m.diameter(a)}}return this._boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"triangleCount",{get:function(){return this.components.reduce(function(a,c){return a+c.triangleCount},0)},enumerable:!0,configurable:!0});
return a}();b.LodLevelData=H;q=function(){function f(d,f,g,h){var l=this;this._levels=[];this._renderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._slicePlaneEnabled=!1;this._enableLevelSelection=!0;this._lastCamera=new a;this._updateCyclesWithStaticCamera=-1;this.didRender=this._needFullCycle=!1;this._symbol=d;this._optionalFields=f;this._metadata=g;this._instanceBufferLayout=w.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:f});this._glInstanceBufferLayout=
c.glLayout(this._instanceBufferLayout,{divisor:1});this._instanceData=new e.InstanceData(this._optionalFields,h);this._instanceData.on("instance-added",function(a){l.requestUpdateCycle()});this._instanceData.on("instance-removed",function(a){l.requestUpdateCycle()});this._instanceData.on("instance-transform-changed",function(a){l.requestUpdateCycle()});this._instanceData.on("instance-visibility-changed",function(a){l.requestUpdateCycle(!0)});this._instanceData.on("instance-highlight-changed",function(a){l.requestUpdateCycle(!0)});
this._enableLevelSelection=1<this._symbol.levels.length;b.lodRenderers.push(this)}f.prototype.destroy=function(){b.lodRenderers.splice(b.lodRenderers.indexOf(this),1)};Object.defineProperty(f.prototype,"levels",{get:function(){return this._levels},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"baseBoundingBox",{get:function(){return this._levels[this._levels.length-1].boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"baseBoundingSphere",{get:function(){return this._levels[this._levels.length-
1].boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"baseMaterial",{get:function(){return this._levels[this._levels.length-1].components[0].material},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"slicePlaneEnabled",{get:function(){return this._slicePlaneEnabled},set:function(a){this._slicePlaneEnabled=a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"intersectionHandlerId",{get:function(){return this._metadata.layerUid},enumerable:!0,
configurable:!0});Object.defineProperty(f.prototype,"instanceData",{get:function(){return this._instanceData},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"memoryUsage",{get:function(){var a={cpu:0,gpu:0};this._renderInstanceData.forEach(function(c){c=c.memoryUsage;a.cpu+=c.cpu;a.gpu+=c.gpu});this._highlightRenderInstanceData.forEach(function(c){c=c.memoryUsage;a.cpu+=c.cpu;a.gpu+=c.gpu});return a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"renderStats",
{get:function(){var a=this,c=this._instanceData.size,b=[];this._levels.forEach(function(c,d){d=a._renderInstanceData[d].size+a._highlightRenderInstanceData[d].size;c=c.triangleCount;b.push({renderedInstances:d,renderedTriangles:d*c,trianglesPerInstance:c})});return{totalInstances:c,renderedInstances:b.reduce(function(a,c){return a+c.renderedInstances},0),renderedTriangles:b.reduce(function(a,c){return a+c.renderedTriangles},0),levels:b}},enumerable:!0,configurable:!0});f.prototype.initializeRenderContext=
function(a){var c=this,b=a.rctx;this._symbol.levels.forEach(function(d){c._levels.push(new H(a,d));c._renderInstanceData.push(new r.RenderInstanceData(b,c._instanceBufferLayout));c._highlightRenderInstanceData.push(new r.RenderInstanceData(b,c._instanceBufferLayout))});this._levelSelector=E(this)};f.prototype.uninitializeRenderContext=function(a){this.invalidateOctree();this._levels.forEach(function(a){a.destroy()});this._renderInstanceData.forEach(function(a){a.destroy()});this._highlightRenderInstanceData.forEach(function(a){a.destroy()})};
Object.defineProperty(f.prototype,"slots",{get:function(){return[5,7]},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"needsHighlight",{get:function(){return 0<this._highlightRenderInstanceData.reduce(function(a,c){return a+c.size},0)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"needsRender",{get:function(){return this.needsUpdates()},enumerable:!0,configurable:!0});f.prototype.resetNeedsRender=function(){this.didRender&&(this.didRender=!1)};f.prototype.prepareRender=
function(a){this.runUpdates(a)};f.prototype.render=function(a){var c=a.rctx,b=5===a.slot?4:7===a.slot?6:null;if(b){if(!this.baseMaterial.isVisible()||!this.baseMaterial.isVisibleInPass(a.pass))return!1;var d=a.camera,d={view:d.viewMatrix,proj:d.projectionMatrix,origin:[0,0,0],viewInvTransp:d.viewInverseTransposeMatrix,lightingData:a.lightingData,viewport:d.viewport,fovY:d.fovY,nearFar:[d.near,d.far],shadowMap:a.shadowMap,shadowMappingEnabled:!!a.shadowMap&&a.shadowMap.enabled,ssaoEnabled:!!a.ssaoHelper&&
a.ssaoHelper.enabled,pixelRatio:d.pixelRatio,slicePlane:a.sliceHelper&&a.sliceHelper.plane,cameraAboveGround:d.aboveGround,hudVisibilityTexture:a.offscreenRenderingHelper?a.offscreenRenderingHelper.hudVisibilityTexture:null};c.bindVAO();for(c=0;c<this._levels.length;++c)this.renderLevel(a,b,d,a.isHighlightPass?this._highlightRenderInstanceData[c]:this._renderInstanceData[c],c);return!0}};f.prototype.intersect=function(a,c,b,f,g){var h=this;if(this.baseMaterial.isVisible()){g=d.vec3f64.create();k.vec3.subtract(g,
f,b);var l=function(d){h._instanceData.getCombinedModelTransform(d,K);a.transform.set(K);k.vec3.transformMat4(M,b,a.transform.inverse);k.vec3.transformMat4(O,f,a.transform.inverse);var g=h._instanceData.getState(d),l=h._instanceData.getLodLevel(d);C(g&e.StateFlags.ACTIVE,"invalid instance state");C(0<=l&&l<h._levels.length,"invaid lod level");h._levels[l].intersect(a,c,M,O,d,h._metadata)};this.baseMaterial.getParameters().verticalOffset?this.octree.forEach(l):this.octree.forEachAlongRay(b,g,l)}};
f.prototype.queryDepthRange=function(a){return this.queryDepthRangeOctree(a)};f.prototype.notifyShaderTransformationChanged=function(){this.invalidateOctree()};f.prototype.requestUpdateCycle=function(a){void 0===a&&(a=!1);this._updateCyclesWithStaticCamera=-1;a&&(this._needFullCycle=!0)};f.prototype.needsUpdates=function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera};f.prototype.runUpdates=function(a){if(!p.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var c=
a.equals(this._lastCamera);this._lastCamera.copyFrom(a);c||this.requestUpdateCycle()}c=this._needFullCycle?this._instanceData.size:2E3;this._needFullCycle=!1;this.updateInstances(a,c)}};Object.defineProperty(f.prototype,"octree",{get:function(){this._octree||(this._octree=this.buildOctree());return this._octree},enumerable:!0,configurable:!0});f.prototype.invalidateOctree=function(){this._octree&&(this._octree.destroy(),this._octree=null)};f.prototype.buildOctree=function(){for(var a=new u.InstanceOctree(this._instanceData,
this.baseBoundingSphere),c=this._instanceData,c=c.view?c.view.state:null,b=0;b<this._instanceData.capacity;++b)c.get(b)&e.StateFlags.ACTIVE&&a.addInstance(b);return a};f.prototype.queryDepthRangeOctree=function(a){var c=a.eye,b=a.viewForward,d=this.octree.findClosest(b,"front-to-back",a.frustum),e=this.octree.findClosest(b,"back-to-front",a.frustum);return null!=d&&null!=e?(this._instanceData.view.boundingSphere.getVec(d,G),k.vec3.subtract(G,G,c),d=k.vec3.dot(G,b)-G[3],this._instanceData.view.boundingSphere.getVec(e,
G),k.vec3.subtract(G,G,c),c=k.vec3.dot(G,b)+G[3],{near:Math.max(a.near,d),far:Math.min(a.far,c)}):{near:Infinity,far:-Infinity}};f.prototype.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;this._renderInstanceData.forEach(function(a){a.startUpdateCylce()});this._highlightRenderInstanceData.forEach(function(a){a.startUpdateCylce()})};f.prototype.updateInstances=function(a,c){var b=this._enableLevelSelection,d=this._levelSelector;d.updateCamera(a);this._renderInstanceData.forEach(function(a){a.beginUpdate()});
this._highlightRenderInstanceData.forEach(function(a){a.beginUpdate()});a=this._instanceData;var f=this._instanceData.view,g=a.capacity,h=this._instanceIndex;c=Math.min(a.size,c);for(var l=0;l<c;++l){0===h&&this.startUpdateCycle();var m=f.state.get(h),k=0;if(m&e.StateFlags.ALLOCATED){var p=f.lodLevel.get(h);m&e.StateFlags.ACTIVE&&this._renderInstanceData[p].freeTail();m&e.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[p].freeTail();if(m&e.StateFlags.REMOVE)a.freeInstance(h);else if(m&
e.StateFlags.VISIBLE){p=0;b&&(f.modelOrigin.getVec(h,D),p=d.selectLevel(D,a.getCombinedMedianScaleFactor(h)));k=m&~(e.StateFlags.ACTIVE|e.StateFlags.HIGHLIGHT_ACTIVE|e.StateFlags.TRANSFORM_CHANGED);if(0<=p){var r=this._renderInstanceData[p],n=r.allocateHead();B(f,h,r.view,n);k|=e.StateFlags.ACTIVE;m&e.StateFlags.HIGHLIGHT&&(r=this._highlightRenderInstanceData[p],n=r.allocateHead(),B(f,h,r.view,n),k|=e.StateFlags.HIGHLIGHT_ACTIVE)}f.state.set(h,k);f.lodLevel.set(h,p)}else k=m&~(e.StateFlags.ACTIVE|
e.StateFlags.HIGHLIGHT_ACTIVE|e.StateFlags.TRANSFORM_CHANGED),f.state.set(h,k);this._octree&&(p=!!(m&e.StateFlags.ACTIVE),k=!!(k&e.StateFlags.ACTIVE),!p&&k?this._octree.addInstance(h):p&&!k?this._octree.removeInstance(h):p&&k&&m&e.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(h),this._octree.addInstance(h)));h=(h+1)%g}else h=(h+1)%g,c++}this._instanceIndex=h;this._renderInstanceData.forEach(function(a){a.endUpdate()});this._highlightRenderInstanceData.forEach(function(a){a.endUpdate()})};
f.prototype.renderLevel=function(a,c,b,d,e){var f=this;this._levels[e].components.forEach(function(g){f.renderComponent(a,c,b,d,g,e)})};f.prototype.renderComponent=function(a,c,b,d,e,f){var g=e.glMaterials[a.pass];if(g&&g.beginSlot(c)&&g.isVisible()&&g.isVisibleInPass(a.pass)&&0!==d.size){var h=a.rctx,m=h.capabilities.instancing,k=g.getDrawMode();b.origin=[0,0,0];g.bind(h,b);h.bindVAO(e.vao);c=g.getProgram();z.assertCompatibleVertexAttributeLocations(e.vao,c);a.isHighlightPass&&(h.bindTexture(a.offscreenRenderingHelper?
a.offscreenRenderingHelper.depthTexture:null,5),c.setUniform1i("depthTex",5),c.setUniform4f("highlightViewportPixelSz",0,0,1/b.viewport[2],1/b.viewport[3]));g.bindView(h,b);p.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===a.pass&&(c.setUniform4fv("externalColor",N[Math.min(f,N.length-1)]),c.setUniform1i("colorMixMode",x.colorMixModes.replace));a=d.capacity;f=d.headIndex;c=d.tailIndex;var r=d.firstIndex,n=this._glInstanceBufferLayout,t=function(a,c){z.bindVertexBufferLayout(h,l.Default3D,d.buffer,n,
a);m.drawArraysInstanced(k,0,e.vertexCount,c-a);z.unbindVertexBufferLayout(h,l.Default3D,d.buffer,n)};e.material.getParameters().transparent&&null!=r?f>c?(C(r>=c&&r<=f,"invalid firstIndex"),t(r,f),t(c,r)):f<c&&(r<=f?(C(0<=r&&r<=f,"invalid firstIndex"),t(r,f),t(c,a),t(0,r)):(C(r>=c&&r<=a,"invalid firstIndex"),t(r,a),t(0,f),t(c,r))):f>c?t(c,f):f<c&&(t(0,f),t(c,a));h.bindVAO(null);g.release(h,b)}};return f}();b.LodRenderer=q;b.lodRenderers=[];var D=d.vec3f64.create(),G=h.vec4f64.create(),K=f.mat4f64.create(),
M=d.vec3f64.create(),O=d.vec3f64.create(),N=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]]})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat3 ../../../../../core/libs/gl-matrix-2/mat3f64 ../../../../../core/libs/gl-matrix-2/mat4 ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/Evented ../../../support/mathUtils ../../../support/buffer/BufferView ../../../support/buffer/InterleavedLayout ../../../../webgl/Util".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e){Object.defineProperty(b,"__esModule",{value:!0});var u=e.assert,t;(function(a){a[a.ALLOCATED=1]="ALLOCATED";a[a.ACTIVE=2]="ACTIVE";a[a.VISIBLE=4]="VISIBLE";a[a.HIGHLIGHT=8]="HIGHLIGHT";a[a.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";a[a.REMOVE=32]="REMOVE";a[a.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED"})(t=b.StateFlags||(b.StateFlags={}));var r=function(){return function(a){this.localTransform=a.getField("localTransform",l.BufferViewMat4f64);this.globalTransform=a.getField("globalTransform",
l.BufferViewMat4f64);this.modelOrigin=a.getField("modelOrigin",l.BufferViewVec3f64);this.model=a.getField("model",l.BufferViewMat3f);this.modelNormal=a.getField("modelNormal",l.BufferViewMat3f);this.modelScaleFactors=a.getField("modelScaleFactors",l.BufferViewVec2f);this.boundingSphere=a.getField("boundingSphere",l.BufferViewVec4f64);this.color=a.getField("color",l.BufferViewVec4f);this.featureAttribute=a.getField("featureAttribute",l.BufferViewVec4f);this.state=a.getField("state",l.BufferViewUint8);
this.lodLevel=a.getField("lodLevel",l.BufferViewUint8)}}();b.View=r;q=function(c){function b(a,b){var d=c.call(this)||this;d._capacity=0;d._size=0;d._next=0;var e=g.newLayout().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").vec2f("modelScaleFactors");0<=a.indexOf("color")&&(e=e.vec4f("color"));0<=a.indexOf("featureAttribute")&&(e=e.vec4f("featureAttribute"));e=e.u8("state").u8("lodLevel").alignTo(8);d._layout=
e;d._shaderTransformation=b;return d}n(b,c);Object.defineProperty(b.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0});b.prototype.addInstance=
function(){this._size+1>this._capacity&&this.grow();var a=this.findSlot();this._view.state.set(a,t.ALLOCATED);this._size++;this.emit("instance-added",{index:a});return a};b.prototype.removeInstance=function(a){var c=this._view.state;u(0<=a&&a<this._capacity&&c.get(a)&t.ALLOCATED,"invalid instance handle");this.getStateFlag(a,t.ACTIVE)?this.setStateFlags(a,t.REMOVE):this.freeInstance(a);this.emit("instance-removed",{index:a})};b.prototype.freeInstance=function(a){var c=this._view.state;u(0<=a&&a<this._capacity&&
c.get(a)&t.ALLOCATED,"invalid instance handle");c.set(a,0);this._size--};b.prototype.setLocalTransform=function(a,c,b){void 0===b&&(b=!0);this._view.localTransform.setMat(a,c);b&&this.updateModelTransform(a)};b.prototype.getLocalTransform=function(a,c){this._view.localTransform.getMat(a,c)};b.prototype.setGlobalTransform=function(a,c,b){void 0===b&&(b=!0);this._view.globalTransform.setMat(a,c);b&&this.updateModelTransform(a)};b.prototype.getGlobalTransform=function(a,c){this._view.globalTransform.getMat(a,
c)};b.prototype.updateModelTransform=function(c){var b=this._view,e=x,g=v;b.localTransform.getMat(c,z);b.globalTransform.getMat(c,A);var h=d.mat4.multiply(A,A,z);m.vec3.set(e,h[12],h[13],h[14]);b.modelOrigin.setVec(c,e);f.mat3.fromMat4(g,h);b.model.setMat(c,g);e=a.scaleFromMatrix(x,h);e.sort();b.modelScaleFactors.set(c,0,e[1]);b.modelScaleFactors.set(c,1,e[2]);f.mat3.invert(g,g);f.mat3.transpose(g,g);b.modelNormal.setMat(c,g);this.setStateFlags(c,t.TRANSFORM_CHANGED);this.emit("instance-transform-changed",
{index:c})};b.prototype.getModelTransform=function(a,c){var b=this._view;b.model.getMat(a,v);b.modelOrigin.getVec(a,x);c[0]=v[0];c[1]=v[1];c[2]=v[2];c[3]=0;c[4]=v[3];c[5]=v[4];c[6]=v[5];c[7]=0;c[8]=v[6];c[9]=v[7];c[10]=v[8];c[11]=0;c[12]=x[0];c[13]=x[1];c[14]=x[2];c[15]=1};b.prototype.applyShaderTransformation=function(a,c){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,a,c)};b.prototype.getCombinedModelTransform=function(a,c){this.getModelTransform(a,c);this._shaderTransformation&&
this._shaderTransformation.applyTransform(this,a,c);return c};b.prototype.getCombinedLocalTransform=function(a,c){this._view.localTransform.getMat(a,c);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,a,c);return c};b.prototype.getCombinedMaxScaleFactor=function(a){var c=this._view.modelScaleFactors.get(a,1);this._shaderTransformation&&(a=this._shaderTransformation.scaleFactor(x,this,a),c*=Math.max(a[0],a[1],a[2]));return c};b.prototype.getCombinedMedianScaleFactor=function(a){var c=
this._view.modelScaleFactors.get(a,0);this._shaderTransformation&&(a=this._shaderTransformation.scaleFactor(x,this,a),a.sort(),c*=a[1]);return c};b.prototype.getModel=function(a,c){this._view.model.getMat(a,c)};b.prototype.setFeatureAttribute=function(a,c){this._view.featureAttribute.setVec(a,c)};b.prototype.getFeatureAttribute=function(a,c){this._view.featureAttribute.getVec(a,c)};b.prototype.setColor=function(a,c){this._view.color.setVec(a,c)};b.prototype.getColor=function(a,c){this._view.color.getVec(a,
c)};b.prototype.setVisible=function(a,c){c!==this.getVisible(a)&&(this.setStateFlag(a,t.VISIBLE,c),this.emit("instance-visibility-changed",{index:a}))};b.prototype.getVisible=function(a){return this.getStateFlag(a,t.VISIBLE)};b.prototype.setHighlight=function(a,c){c!==this.getHighlight(a)&&(this.setStateFlag(a,t.HIGHLIGHT,c),this.emit("instance-highlight-changed",{index:a}))};b.prototype.getHighlight=function(a){return this.getStateFlag(a,t.HIGHLIGHT)};b.prototype.getState=function(a){return this._view.state.get(a)};
b.prototype.getLodLevel=function(a){return this._view.lodLevel.get(a)};b.prototype.countFlags=function(a){for(var c=0,b=0;b<this._capacity;++b)this.getState(b)&a&&++c;return c};b.prototype.setStateFlags=function(a,c){var b=this._view.state;c|=b.get(a);b.set(a,c)};b.prototype.clearStateFlags=function(a,c){var b=this._view.state;c=b.get(a)&~c;b.set(a,c)};b.prototype.setStateFlag=function(a,c,b){b?this.setStateFlags(a,c):this.clearStateFlags(a,c)};b.prototype.getStateFlag=function(a,c){return!!(this._view.state.get(a)&
c)};b.prototype.grow=function(){var a=Math.max(y,Math.floor(this._capacity*w)),c=this._layout.createBuffer(a);if(this._buffer){var b=new Uint8Array(this._buffer.buffer);(new Uint8Array(c.buffer)).set(b)}this._capacity=a;this._buffer=c;this._view=new r(this._buffer)};b.prototype.findSlot=function(){for(var a=this._view.state,c=this._next;a.get(c)&t.ALLOCATED;)c=(c+1)%this._capacity;this._next=(c+1)%this._capacity;return c};return b}(c.Evented);b.InstanceData=q;var y=1024,w=2,x=p.vec3f64.create(),v=
k.mat3f64.create(),z=h.mat4f64.create(),A=h.mat4f64.create()})},"esri/views/3d/support/Evented":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(){this._listeners={}}b.prototype.hasEventListener=function(b){return null!=this._listeners[b]&&0<this._listeners[b].size};b.prototype.on=function(b,k){var d=this;null==this._listeners[b]&&(this._listeners[b]=new Map);var f={};this._listeners[b].set(f,k);return{remove:function(){return d._listeners[b].delete(f)}}};
b.prototype.emit=function(b,k){null!=this._listeners[b]&&this._listeners[b].forEach(function(b){return b(k)})};return b}();b.Evented=q})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix-2/mat4f64 ../../../../../core/libs/gl-matrix-2/vec3 ../../../../../core/libs/gl-matrix-2/vec3f64 ../../../support/mathUtils ../Octree".split(" "),function(q,b,n,f,k,d,h,m){Object.defineProperty(b,
"__esModule",{value:!0});q=function(b){function c(a,c){var g=b.call(this,[0,0,0],1,{getCenter:function(a){var c=g._instanceData.view.boundingSphere,b=g._tmpCenter;b[0]=c.get(a,0);b[1]=c.get(a,1);b[2]=c.get(a,2);return b},getRadius:function(a){return g._instanceData.view.boundingSphere.get(a,3)}},{maximumDepth:25})||this;g._tmpCenter=d.vec3f64.create();g._tmpMat4=f.mat4f64.create();g._instanceData=a;g._boundingSphere=c;return g}n(c,b);c.prototype.addInstance=function(a){var c=this._instanceData.view.boundingSphere,
b=this._instanceData.getCombinedModelTransform(a,this._tmpMat4),d=k.vec3.transformMat4(this._tmpCenter,this._boundingSphere.center,b),b=this._boundingSphere.radius*h.maxScale(b);c.set(a,0,d[0]);c.set(a,1,d[1]);c.set(a,2,d[2]);c.set(a,3,b);this.add(a)};c.prototype.removeInstance=function(a){this.remove(a)};return c}(m);b.InstanceOctree=q})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["require","exports","../Camera"],function(q,b,n){Object.defineProperty(b,"__esModule",
{value:!0});q=function(){function b(b,d){this.thresholdScale=1;this._camera=new n;this._worldSpaceRadius=b;this._thresholds=d.map(function(b){return b})}b.prototype.updateCamera=function(b){this._camera.copyFrom(b)};b.prototype.selectLevel=function(b,d){b=this._camera.computeScreenPixelSizeAt(b);d=this._worldSpaceRadius*d/b;b=this._thresholds;for(var f=-1,m=0;m<b.length;++m)d>=b[m]*this.thresholdScale&&(f=m);return f};return b}();b.LevelSelector=q})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define(["require",
"exports","../../../support/buffer/BufferView","./BackedBufferObject","../../../../webgl/Util"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});var d=k.assert,h=function(){return function(a){this.modelOriginHi=a.getField("modelOriginHi",n.BufferViewVec3f);this.modelOriginLo=a.getField("modelOriginLo",n.BufferViewVec3f);this.model=a.getField("model",n.BufferViewMat3f);this.modelNormal=a.getField("modelNormal",n.BufferViewMat3f);this.color=a.getField("instanceColor",n.BufferViewVec4f);
this.featureAttribute=a.getField("instanceFeatureAttribute",n.BufferViewVec4f)}}();b.View=h;q=function(){function b(a,c){this._tailIndex=this._headIndex=0;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=a;this._instanceBufferLayout=c;this._elementSize=c.stride;this._capacity=1}b.prototype.destroy=function(){this._buffer&&this._buffer.destroy()};Object.defineProperty(b.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,configurable:!0});
Object.defineProperty(b.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){var a=this._headIndex,c=this._tailIndex;return a>=c?a-c:a+this._capacity-c},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isEmpty",{get:function(){return this._headIndex===this._tailIndex},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"isFull",{get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"headIndex",{get:function(){return this._headIndex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tailIndex",{get:function(){return this._tailIndex},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"firstIndex",{get:function(){return this._firstIndex},enumerable:!0,
configurable:!0});Object.defineProperty(b.prototype,"memoryUsage",{get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}},enumerable:!0,configurable:!0});b.prototype.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=null};b.prototype.startUpdateCylce=function(){this._captureFirstIndex=!0};b.prototype.beginUpdate=function(){d(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex};b.prototype.endUpdate=function(){d(this._updating,
"not updating");this.size<c*this.capacity&&this.shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};b.prototype.allocateHead=function(){d(this._updating,"not updating");this.isFull&&this.grow();var a=this.headIndex;this._captureFirstIndex&&(this._firstIndex=a,this._captureFirstIndex=!1);this.incrementHead();d(this._headIndex!==this._tailIndex,"invalid pointers");return a};b.prototype.freeTail=function(){d(this._updating,
"not updating");d(0<this.size,"invalid size");var a=this._tailIndex===this._firstIndex;this.incrementTail();a&&(this._firstIndex=this._tailIndex)};b.prototype.grow=function(){this.resize(Math.max(m,Math.floor(this._capacity*p)))};b.prototype.shrink=function(){l&&this.resize(Math.max(m,Math.floor(this._capacity*a)))};b.prototype.resize=function(a){d(this._updating,"not updating");if(a!==this._capacity){var c=new f(this._rctx,34962,35044,this._elementSize,a);if(this._buffer){this._firstIndex&&(this._firstIndex=
(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);var b=this.size,e=this.compactInstances(c);d(e===b,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=e;this._prevHeadIndex=0}this._resized=!0;this._capacity=a;this._buffer=c;this._view=new h(this._instanceBufferLayout.createView(this._buffer.array))}};b.prototype.compactInstances=function(a){var c=this._headIndex,b=this._tailIndex;return b<c?(this._buffer.copyRange(b,c,a),c-b):b>c?(this._buffer.copyRange(b,
this._capacity,a),0<c&&this._buffer.copyRange(0,c,a,this._capacity-b),c+(this._capacity-b)):0};b.prototype.incrementHead=function(a){void 0===a&&(a=1);this._headIndex=(this._headIndex+a)%this._capacity};b.prototype.incrementTail=function(a){void 0===a&&(a=1);this._tailIndex=(this._tailIndex+a)%this._capacity};b.prototype.transferRange=function(a,c){a<c?this._buffer.transferRange(a,c):a>c&&(0<c&&this._buffer.transferRange(0,c),this._buffer.transferRange(a,this._capacity))};return b}();b.RenderInstanceData=
q;var m=1024,p=2,c=.3,a=.5,l=!0})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["require","exports","../../../../webgl/BufferObject"],function(q,b,n){return function(){function b(b,d,f,m,p){this._elementSize=m;this._buffer=new n(b,d,f);this.resize(p)}b.prototype.destroy=function(){this._buffer.dispose()};Object.defineProperty(b.prototype,"elementSize",{get:function(){return this._elementSize},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"memoryUsage",{get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}},enumerable:!0,configurable:!0});b.prototype.copyRange=
function(b,d,f,m){void 0===m&&(m=0);b=new Uint8Array(this.array,b*this.elementSize,(d-b)*this.elementSize);(new Uint8Array(f.array,m*this.elementSize)).set(b)};b.prototype.transferAll=function(){this._buffer.setData(this._array)};b.prototype.transferRange=function(b,d){b*=this._elementSize;this._buffer.setSubData(this._array,b,b,d*this._elementSize)};b.prototype.resize=function(b){var d=b*this._elementSize,f=new ArrayBuffer(d);this._array&&(b>=this._capacity?(new Uint8Array(f)).set(new Uint8Array(this._array)):
(new Uint8Array(f)).set((new Uint8Array(this._array)).subarray(0,b*this._elementSize)));this._array=f;this._buffer.setData(d);this._capacity=b};return b}()})},"esri/views/3d/webgl-engine/lib/lodRendering/utils":function(){define(["require","exports","../doublePrecisionUtils"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.acquireGLMaterials=function(b,f){var d={};d[0]=f.aquire(b,"color");d[3]=f.aquire(b,"depthShadowMap");d[2]=f.aquire(b,"normal");d[1]=f.aquire(b,"depth");d[4]=
f.aquire(b,"highlight");return d};b.releaseGLMaterials=function(b,f){f.release(b.id,"color");f.release(b.id,"depthShadowMap");f.release(b.id,"normal");f.release(b.id,"depth");f.release(b.id,"highlight")};b.encodeDoubleVec3=function(b,h,m,p,c){f[0]=b.get(h,0);f[1]=b.get(h,1);f[2]=b.get(h,2);n.encodeDoubleArray(f,k,3);m.set(c,0,k[0]);p.set(c,0,k[1]);m.set(c,1,k[2]);p.set(c,1,k[3]);m.set(c,2,k[4]);p.set(c,2,k[5])};var f=new Float64Array(3),k=new Float32Array(6)})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/assignHelper ../../../../core/lang ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../support/FastSymbolUpdates ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v){function z(c,b,d,e){c=c.stageObject;var f=c.getMetadata().pathGeometries,g=c.getGeometryRecords(),h=g.length;A.spatialReference=d.spatialReference;for(var l="absolute-height"!==b.mode,m=0,k=0;k<h;k++){for(var p=g[k].geometry,r=f[p.id],n=0,t=0,u=r.builder.path.vertices;t<u.length;t++){var q=u[t];A.x=q.mapPos[0];A.y=q.mapPos[1];A.z=q.mapPos[2];q.elevation=a.computeElevation(d,A,b,e,l?B:null);l&&(n+=B.terrainElevation)}r.updateElevation(e);p.invalidateBoundingInfo();
c.geometryVertexAttrsUpdated(k);m+=n/r.builder.path.vertices.length}return m/h}Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function f(a,c,d,f){a=b.call(this,a,c,d,f)||this;if(!a._isPropertyDriven("size")&&(c=g.validateSymbolLayerSize(a._getSymbolSize())))return a._logWarning(c),a.reject(),a;a._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:a._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,
color:!0,opacity:!0,rotation:!1}};a._fastUpdates=a._context.renderer&&a._context.renderer.visualVariables&&0<a._context.renderer.visualVariables.length?e.initFastSymbolUpdatesState(a._context.renderer,a._vvConvertOptions):{enabled:!1};c=a._getStageIdHint();f=a._getMaterialOpacityAndColor();d=m.vec3f64.fromArray(f);f=f[3];d={diffuse:d,ambient:d,opacity:f,transparent:1>f||a._isPropertyDriven("opacity"),vertexColors:!1,slicePlaneEnabled:a._context.slicePlaneEnabled,castShadows:a.symbolLayer.castShadows};
a._fastUpdates.enabled?(k.mixin(d,a._fastUpdates.materialParameters,{size:a._getSize()}),a._material=new v(d,c+"_pathmat")):(d.vertexColors=a._isPropertyDriven("color")||a._isPropertyDriven("opacity"),a._material=new x(d,c+"_pathmat"));a._context.stage.add(t.ModelContentType.MATERIAL,a._material);a._profile=w.Profile.tube(C);c="tube";"profile"in a.symbolLayer&&(c=a.symbolLayer.profile);switch(c){default:a._profile=w.Profile.tube(C);break;case "strip":a._profile=w.Profile.strip();a._material.setParameterValues({cullFace:"none"});
break;case "fence":a._profile=w.Profile.fence();a._material.setParameterValues({cullFace:"none"});break;case "wall":a._profile=w.Profile.wall()}a._extruder=new w.SimpleExtruder;c="simple";"joint"in a.symbolLayer&&(c=a.symbolLayer.joint);switch(c){case "round":a._extruder=new w.RoundExtruder(4);break;case "bevel":a._extruder=new w.BevelExtruder;break;default:a._extruder=new w.SimpleExtruder}a.resolve();return a}n(f,b);f.prototype.destroy=function(){b.prototype.destroy.call(this);this.isFulfilled()||
this.reject();this._material&&(this._context.stage.remove(t.ModelContentType.MATERIAL,this._material.id),this._material=null)};f.prototype.createGraphics3DGraphic=function(a){var c=a.graphic;if("polyline"!==c.geometry.type)return this._logWarning("unsupported geometry type for path symbol: "+c.geometry.type),null;if(!this._validateGeometry(c.geometry))return null;var b="graphic"+c.uid,d=this.getGraphicElevationContext(c);return this._createAs3DShape(c,a.renderingInfo,d,b,c.uid)};f.prototype.layerOpacityChanged=
function(){var a=this._getMaterialOpacity(),c=1>a||this._isPropertyDriven("opacity");this._material.setParameterValues({opacity:a,transparent:c});return!0};f.prototype.layerElevationInfoChanged=function(c,b,d){var e=this;c.forEach(function(c){var d=b(c);d&&(c=e.getGraphicElevationContext(c.graphic),d.needsElevationUpdates=a.needsElevationUpdates3D(c.mode),d.elevationContext.set(c))});return!0};f.prototype.slicePlaneEnabledChanged=function(a,c){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});
return!0};f.prototype.pixelRatioChanged=function(a,c){return!0};f.prototype.applyRendererDiff=function(a,c){for(var b in a.diff)switch(b){case "visualVariables":if(e.updateFastSymbolUpdatesState(this._fastUpdates,c,this._vvConvertOptions))a={},k.mixin(a,this._fastUpdates.materialParameters),this._material.setParameterValues(a);else return!1;break;default:return!1}return!0};f.prototype._getSymbolSize=function(){return this.symbolLayer.size||1};f.prototype._getSize=function(){return this._fastUpdates.enabled&&
this._fastUpdates.visualVariables.size?1:.5*this._getSymbolSize()/this._context.renderCoordsHelper.unitInMeters};f.prototype._createAs3DShape=function(b,e,f,g,k){var p={},n=b.geometry,t=n.paths,q=[],x=[],v=[],A=m.vec3f64.create(),B=this._context.renderSpatialReference===u.SphericalECEFSpatialReference,C=Array(6),n=a.getGeometryVertexData3D(t,n.hasZ,n.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,f);this._logGeometryCreationWarnings(n,
t,"paths","PathSymbol3DLayer");if(0<t.length){for(var t=n.geometryData.outlines,D=n.eleVertexData,F=n.vertexData,G=0;G<t.length;++G){var E=t[G],M=E.index,H=E.count;if(!(2>H)){if(this._context.clippingExtent&&(a.computeBoundingBox(D,M,H,C),a.boundingBoxClipped(C,this._context.clippingExtent)))continue;a.chooseOrigin(F,M,H,A);a.subtractCoordinates(F,M,H,A);E=h.mat4f64.create();d.mat4.translate(E,E,A);M=new w.Path(F,D,M,H,B,A);M=new w.Builder(M,this._profile,this._extruder);H=null;if(this._fastUpdates.enabled)var K=
this._fastUpdates.visualVariables,H=K.size?l.getAttributeValue(K.size.field,b):0,aa=K.color?l.getAttributeValue(K.color.field,b):0,K=K.opacity?l.getAttributeValue(K.opacity.field,b):0,H=new w.FastUpdatePathGeometry(M,H,aa,K);else H=1,this._isPropertyDriven("size")?H=e.size[0]:this.symbolLayer.size&&(H=this.symbolLayer.size),H*=.5/this._context.renderCoordsHelper.unitInMeters,aa=null,this._isPropertyDriven("color")&&(aa=e.color),this._isPropertyDriven("opacity")&&null!=e.opacity&&(aa=aa?[aa[0],aa[1],
aa[2],e.opacity]:[1,1,1,e.opacity]),H=new w.StaticPathGeometry(M,H,aa);M=H.createGeometryData();M=new r(M,g+"path"+G);p[M.id]=H;M.singleUse=!0;q.push(M);x.push(this._material);v.push(E)}}b={layerUid:this._context.layer.uid,graphicUid:k,pathGeometries:p};if(0<q.length)return g=new y({geometries:q,materials:x,transformations:v,castShadow:!0,metadata:b,idHint:g}),q=new c(this,g,q,null,null,z,f),q.alignedTerrainElevation=n.terrainElevation,q.needsElevationUpdates=a.needsElevationUpdates3D(f.mode),q}return null};
return f}(l.Graphics3DSymbolLayer);b.Graphics3DPathSymbolLayer=q;var A=new p,B={verticalDistanceToGround:0,terrainElevation:0},C=10;b.default=q})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f32 ../../../../core/libs/gl-matrix-2/vec2 ../../../../core/libs/gl-matrix-2/vec2f32 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f32 ../../../../core/libs/gl-matrix-2/vec3f64 ../../support/geometryUtils ../../support/mathUtils ./GeometryData ./GeometryUtil ./Util".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t){var r;(function(b){var d=function(){function a(a){this.pos=a;this.mapPos=c.vec3f32.create();this.vRight=c.vec3f32.create();this.vLeft=c.vec3f32.create();this.frame={forward:c.vec3f32.create(),up:c.vec3f32.create(),right:c.vec3f32.create()};this.rotationAxis=c.vec3f32.create();this.angle=0}a.prototype.profileSpaceToVertexSpace=function(a,c){a[0]=c[0]*this.frame.right[0]+c[1]*this.frame.up[0];a[1]=c[0]*this.frame.right[1]+c[1]*this.frame.up[1];a[2]=c[0]*this.frame.right[2]+
c[1]*this.frame.up[2]};return a}();b.PathVertex=d;var r=function(){function a(){this.vertices=[];this.vertexIndices=[];this.uvIndices=this.uvs=this.normalIndices=this.normals=null}a.prototype.addVertex=function(a){this.vertices.push(m.vec2f32.clone(a));return this.vertices.length-1};a.prototype.addNormal=function(a){this.normals||(this.normals=[],this.normalIndices=[]);this.normals.push(m.vec2f32.clone(a));return this.normals.length-1};a.prototype.addUV=function(a){this.uvs||(this.uvs=[],this.uvIndices=
[]);this.uvs.push(a);return this.uvs.length-1};a.prototype.addSegment=function(a,c,b,d,e,f){void 0===b&&(b=null);void 0===d&&(d=null);void 0===e&&(e=null);void 0===f&&(f=null);this.vertexIndices.push(a);this.vertexIndices.push(c);null!==b&&null!==d&&(this.normalIndices.push(b),this.normalIndices.push(d));null!==e&&null!==f&&(this.uvIndices.push(e),this.uvIndices.push(f))};Object.defineProperty(a.prototype,"numSegments",{get:function(){return this.vertexIndices.length/2},enumerable:!0,configurable:!0});
a.prototype.hasNormals=function(){return null!=this.normals};a.prototype.hasUV=function(){return null!=this.uvs};a.prototype.normalize=function(){for(var a=0,c=0,b=this.vertices;c<b.length;c++)var d=b[c],a=Math.max(a,h.vec2.length(d));a=1/a;c=0;for(b=this.vertices;c<b.length;c++)d=b[c],h.vec2.scale(d,d,a)};a.tube=function(c){void 0===c&&(c=20);for(var b=new a,d=0;d<c;++d){var e=2*d*Math.PI/c;b.addVertex(m.vec2f32.fromValues(1*Math.cos(e),1*Math.sin(e)));b.addUV(d/c)}b.addUV(1);for(d=0;d<c-1;++d)b.addSegment(d,
d+1,null,null,d,d+1);b.addSegment(c-1,0,null,null,c-1,c);return b};a.line=function(c,b){var d=new a,e=b[0]-c[0],f=b[1]-c[1];d.addVertex(c);d.addVertex(b);d.addNormal(m.vec2f32.fromValues(-f,e));d.addUV(0);d.addUV(1);d.addSegment(0,1,0,0,0,1);return d};a.point=function(c){var b=new a;b.addVertex(c);return b};a.wall=function(c,b){void 0===c&&(c=.2);void 0===b&&(b=1);var d=new a;d.addVertex(m.vec2f32.fromValues(.5*-c,0));d.addVertex(m.vec2f32.fromValues(.5*c,0));d.addVertex(m.vec2f32.fromValues(.5*c,
b));d.addVertex(m.vec2f32.fromValues(.5*-c,b));d.addNormal(m.vec2f32.fromValues(0,-1));d.addNormal(m.vec2f32.fromValues(1,0));d.addNormal(m.vec2f32.fromValues(0,1));d.addNormal(m.vec2f32.fromValues(-1,0));d.addUV(0);d.addUV(1);d.addSegment(0,1,0,0,0,1);d.addSegment(1,2,1,1,0,1);d.addSegment(2,3,2,2,0,1);d.addSegment(3,0,3,3,0,1);return d};a.strip=function(){return this.line(m.vec2f32.fromValues(-1,0),m.vec2f32.fromValues(1,0))};a.fence=function(){return this.line(m.vec2f32.fromValues(0,0),m.vec2f32.fromValues(0,
1))};return a}();b.Profile=r;r=function(){return function(b,e,f,h,m,k){this.vertices=[];this.offset=c.vec3f32.create();p.vec3.copy(this.offset,k);for(k=f;k<f+h;++k){var r=new d(c.vec3f32.fromValues(b[3*k+0],b[3*k+1],b[3*k+2]));p.vec3.set(r.mapPos,e[3*k+0],e[3*k+1],e[3*k+2]);this.vertices.push(r)}b=c.vec3f32.create();e=c.vec3f32.create();f=c.vec3f32.create();k=c.vec3f32.create();var r=c.vec3f32.create(),n=a.vec3f64.create(),t=c.vec3f32.create(),q=c.vec3f32.create(),y=c.vec3f32.create(),w=c.vec3f32.create(),
x,z,A=l.plane.create(),B=this.vertices[0];p.vec3.set(t,0,1,0);p.vec3.subtract(e,this.vertices[1].pos,B.pos);x=0;z=p.vec3.length(e);p.vec3.normalize(e,e);m?(p.vec3.add(n,B.pos,this.offset),p.vec3.normalize(f,n)):p.vec3.set(f,0,0,1);u.makeOrthoBasisDirUpFallback(e,f,t,t,r,f,.99619469809);p.vec3.copy(k,f);p.vec3.copy(w,r);p.vec3.copy(B.vRight,e);p.vec3.copy(B.vLeft,b);p.vec3.copy(B.frame.forward,e);p.vec3.copy(B.frame.up,f);p.vec3.copy(B.frame.right,r);B.vLeftLength=x;B.vRightLength=z;B.index=0;p.vec3.cross(B.rotationAxis,
B.vLeft,B.vRight);p.vec3.normalize(B.rotationAxis,B.rotationAxis);B.angle=0;for(m=1;m<h;++m)B=this.vertices[m],p.vec3.copy(b,e),x=z,m<h-1&&(p.vec3.subtract(e,this.vertices[m+1].pos,B.pos),z=p.vec3.length(e),p.vec3.normalize(e,e)),p.vec3.add(q,b,e),p.vec3.normalize(q,q),p.vec3.add(y,this.vertices[m-1].pos,k),l.plane.fromPositionAndNormal(this.vertices[m].pos,q,A),l.plane.intersectRay(A,l.ray.wrap(y,b),n)?(p.vec3.subtract(n,n,this.vertices[m].pos),p.vec3.normalize(f,n),p.vec3.cross(r,q,f),p.vec3.normalize(r,
r)):u.makeOrthoBasisDirUpFallback(q,k,w,t,r,f,.99619469809),p.vec3.copy(k,f),p.vec3.copy(w,r),p.vec3.copy(B.vRight,e),p.vec3.copy(B.vLeft,b),p.vec3.copy(B.frame.forward,q),p.vec3.copy(B.frame.up,f),p.vec3.copy(B.frame.right,r),B.vLeftLength=x,B.vRightLength=z,B.index=m,p.vec3.cross(B.rotationAxis,B.vLeft,B.vRight),p.vec3.normalize(B.rotationAxis,B.rotationAxis),p.vec3.negate(v,B.vLeft),B.angle=Math.PI-g.acos(p.vec3.dot(v,B.vRight))}}();b.Path=r;r=function(){return function(){}}();b.Extruder=r;r=function(){function a(){}
a.prototype.numVertices=function(a){return a.vertices.length};a.prototype.extrude=function(a,c,b){for(var d=0;d<c.vertices.length;++d){var e=c.vertices[d];e.profileSpaceToVertexSpace(y,a);b(e.pos,y,d)}};return a}();b.SimpleExtruder=r;r=function(){function a(a){void 0===a&&(a=1);this._segmentsPerRadian=a/Math.PI}a.prototype.getNumSegments=function(a){return Math.ceil(a*this._segmentsPerRadian)};a.prototype.numVertices=function(a){for(var c=2,b=1;b<a.vertices.length-1;++b)c+=this.getNumSegments(a.vertices[b].angle)+
1;return c};a.prototype.extrude=function(a,c,b){c.vertices[0].profileSpaceToVertexSpace(y,a);b(c.vertices[0].pos,y,0);p.vec3.copy(z,y);for(var d=1;d<c.vertices.length-1;++d){var e=c.vertices[d];e.profileSpaceToVertexSpace(y,a);var f=this.getNumSegments(e.angle);k.mat4.identity(C);k.mat4.rotate(C,C,.5*-e.angle,e.rotationAxis);p.vec3.transformMat4(A,y,C);if(0<=p.vec3.dot(A,e.vRight)){for(var g=0;g<f+1;++g)b(e.pos,y,d);p.vec3.copy(z,y)}else{k.mat4.identity(C);k.mat4.rotate(C,C,e.angle/f,e.rotationAxis);
b(e.pos,A,d);p.vec3.copy(B,A);for(g=0;g<f;++g)p.vec3.transformMat4(B,B,C),b(e.pos,B,d);p.vec3.copy(z,B)}}d=c.vertices.length-1;c.vertices[d].profileSpaceToVertexSpace(y,a);b(c.vertices[d].pos,y,d)};return a}();b.RoundExtruder=r;r=function(a){function c(){return a.call(this,1)||this}f(c,a);return c}(r);b.BevelExtruder=r;var n={generateUV:!1},r=function(){function a(a,c,b,d){void 0===d&&(d=n);this.options=d;this._capNormalsOffset=this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=this._numExtrusionVertices=
this._extrusionNormalCount=this._extrusionVertexCount=0;this.profile=c;this.profile.normalize();this.path=a;this.extruder=b;this._numExtrusionVertices=b.numVertices(a);this.numVerticesTotal=c.vertices.length*this._numExtrusionVertices;this.profile.hasNormals()?this.numNormalsTotal=this.profile.normals.length*this._numExtrusionVertices:this.numNormalsTotal=this.numVerticesTotal;this.numNormalsTotal+=2;this.originData=new Float32Array(3*this.numVerticesTotal);this.directionData=new Float32Array(4*this.numVerticesTotal);
this.normalData=new Float32Array(3*this.numNormalsTotal);this.pathVertexData=new Float32Array(1*this.numVerticesTotal);this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));this.buildGeometry();this.buildTopology()}a.prototype.emitVertex=function(a,c,b){this.originData[3*this._extrusionVertexCount+0]=a[0];this.originData[3*this._extrusionVertexCount+1]=a[1];this.originData[3*this._extrusionVertexCount+2]=a[2];this.directionData[4*
this._extrusionVertexCount+0]=c[0];this.directionData[4*this._extrusionVertexCount+1]=c[1];this.directionData[4*this._extrusionVertexCount+2]=c[2];this.directionData[4*this._extrusionVertexCount+3]=b/(this.path.vertices.length-1);this.pathVertexData[this._extrusionVertexCount]=b;++this._extrusionVertexCount};a.prototype.emitNormal=function(a,c,b){p.vec3.normalize(w,c);this.normalData[3*this._extrusionNormalCount+0]=w[0];this.normalData[3*this._extrusionNormalCount+1]=w[1];this.normalData[3*this._extrusionNormalCount+
2]=w[2];++this._extrusionNormalCount};a.prototype.buildGeometry=function(){for(var a=this.emitVertex.bind(this),c=this.emitNormal.bind(this),b=this._extrusionNormalCount=this._extrusionVertexCount=0;b<this.profile.vertices.length;++b)this.extruder.extrude(this.profile.vertices[b],this.path,a);if(this.profile.hasNormals())for(a=0;a<this.profile.normals.length;++a)this.extruder.extrude(this.profile.normals[a],this.path,c);else for(a=0;a<this._extrusionVertexCount;++a)p.vec3.set(w,this.directionData[4*
a+0],this.directionData[4*a+1],this.directionData[4*a+2]),p.vec3.normalize(w,w),this.normalData[3*this._extrusionNormalCount+0]=w[0],this.normalData[3*this._extrusionNormalCount+1]=w[1],this.normalData[3*this._extrusionNormalCount+2]=w[2],++this._extrusionNormalCount;this._capNormalsOffset=this._extrusionNormalCount;c=this.path.vertices[0];a=this.path.vertices[this.path.vertices.length-1];this.normalData[3*this._extrusionNormalCount+0]=-c.vRight[0];this.normalData[3*this._extrusionNormalCount+1]=
-c.vRight[1];this.normalData[3*this._extrusionNormalCount+2]=-c.vRight[2];++this._extrusionNormalCount;this.normalData[3*this._extrusionNormalCount+0]=a.vRight[0];this.normalData[3*this._extrusionNormalCount+1]=a.vRight[1];this.normalData[3*this._extrusionNormalCount+2]=a.vRight[2];++this._extrusionNormalCount;if(this.profile.hasUV()&&this.options.generateUV)for(a=0;a<this.profile.uvs.length;++a)this.uvData[2*a+0]=this.profile.uvs[a],this.uvData[2*a+1]=0};a.prototype.buildTopology=function(){var a=
this.profile.numSegments,c=this._numExtrusionVertices-1,b=a*c*6;2<this.profile.vertices.length&&(b+=6*(this.profile.vertices.length-2));this.vertexIndices=new Uint32Array(b);this.normalIndices=new Uint32Array(b);this.pathVertexIndices=new Uint32Array(b);this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(b));for(var d=b=0;d<a;++d){var e=this.profile.vertexIndices[2*d],f=this.profile.vertexIndices[2*d+1],g=e,h=f,l=0,m=0;this.profile.hasNormals()&&(g=this.profile.normalIndices[2*
d],h=this.profile.normalIndices[2*d+1]);this.profile.hasUV()&&this.options.generateUV&&(l=this.profile.uvIndices[2*d],m=this.profile.uvIndices[2*d+1]);for(var k=0;k<c;++k){var p=e*this._numExtrusionVertices+k,r=e*this._numExtrusionVertices+k+1,n=f*this._numExtrusionVertices+k+1,t=f*this._numExtrusionVertices+k,u=g*this._numExtrusionVertices+k,q=g*this._numExtrusionVertices+k+1,y=h*this._numExtrusionVertices+k+1,w=h*this._numExtrusionVertices+k,x=l,v=l,z=m,A=m;this.vertexIndices[3*b+0]=p;this.vertexIndices[3*
b+1]=r;this.vertexIndices[3*b+2]=n;this.pathVertexIndices[3*b+0]=this.pathVertexData[p];this.pathVertexIndices[3*b+1]=this.pathVertexData[r];this.pathVertexIndices[3*b+2]=this.pathVertexData[n];this.normalIndices[3*b+0]=u;this.normalIndices[3*b+1]=q;this.normalIndices[3*b+2]=y;this.vertexIndices[3*b+3]=p;this.vertexIndices[3*b+4]=n;this.vertexIndices[3*b+5]=t;this.pathVertexIndices[3*b+3]=this.pathVertexData[p];this.pathVertexIndices[3*b+4]=this.pathVertexData[n];this.pathVertexIndices[3*b+5]=this.pathVertexData[t];
this.normalIndices[3*b+3]=u;this.normalIndices[3*b+4]=y;this.normalIndices[3*b+5]=w;this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices[3*b+0]=x,this.uvIndices[3*b+1]=v,this.uvIndices[3*b+2]=z,this.uvIndices[3*b+3]=x,this.uvIndices[3*b+4]=z,this.uvIndices[3*b+5]=A);b+=2}}if(2<this.profile.vertices.length)for(a=this.profile.vertices.length-2,e=0,c=e*this._numExtrusionVertices+0,e=(e+1)*this._numExtrusionVertices-1,k=0;k<a;++k)f=k+1,d=f*this._numExtrusionVertices+0,f=(f+1)*this._numExtrusionVertices-
1,h=k+2,g=h*this._numExtrusionVertices+0,h=(h+1)*this._numExtrusionVertices-1,this.vertexIndices[3*b+0]=c,this.vertexIndices[3*b+1]=d,this.vertexIndices[3*b+2]=g,this.normalIndices[3*b+0]=this._capNormalsOffset+0,this.normalIndices[3*b+1]=this._capNormalsOffset+0,this.normalIndices[3*b+2]=this._capNormalsOffset+0,this.pathVertexIndices[3*b+0]=this.pathVertexData[c],this.pathVertexIndices[3*b+1]=this.pathVertexData[d],this.pathVertexIndices[3*b+2]=this.pathVertexData[g],++b,this.vertexIndices[3*b+
0]=h,this.vertexIndices[3*b+1]=f,this.vertexIndices[3*b+2]=e,this.normalIndices[3*b+0]=this._capNormalsOffset+1,this.normalIndices[3*b+1]=this._capNormalsOffset+1,this.normalIndices[3*b+2]=this._capNormalsOffset+1,this.pathVertexIndices[3*b+0]=this.pathVertexData[h],this.pathVertexIndices[3*b+1]=this.pathVertexData[f],this.pathVertexIndices[3*b+2]=this.pathVertexData[e],++b};return a}();b.Builder=r;r=function(){function a(a){this.builder=a}a.prototype.updateElevation=function(a){for(var c=this.builder.path.offset,
b=this.builder.originData,d=0;d<this.builder.numVerticesTotal;++d){var e=this.builder.path.vertices[this.builder.pathVertexData[d]];x[0]=b[3*d+0]+c[0];x[1]=b[3*d+1]+c[1];x[2]=b[3*d+2]+c[2];a.setAltitude(e.elevation,x);b[3*d+0]=x[0]-c[0];b[3*d+1]=x[1]-c[1];b[3*d+2]=x[2]-c[2]}};return a}();b.PathGeometry=r;var q=function(a){function c(c,b,d){c=a.call(this,c)||this;c.size=b;c.vertexAttributePosition=null;c.vertexAttributeNormal=null;c.vertexAttributeColor=null;c.vertexAttributePosition=new Float32Array(3*
c.builder.numVerticesTotal);c.vertexAttributeNormal=c.builder.normalData;c._bakeVertexPositions();d&&(c.vertexAttributeColor=new Uint8Array(4),c.vertexAttributeColor[0]=255*d[0],c.vertexAttributeColor[1]=255*d[1],c.vertexAttributeColor[2]=255*d[2],c.vertexAttributeColor[3]=255*(3<d.length?d[3]:1));return c}f(c,a);c.prototype._bakeVertexPositions=function(){for(var a=0;a<this.builder.numVerticesTotal;++a)this.vertexAttributePosition[3*a+0]=this.builder.originData[3*a+0]+this.builder.directionData[4*
a+0]*this.size,this.vertexAttributePosition[3*a+1]=this.builder.originData[3*a+1]+this.builder.directionData[4*a+1]*this.size,this.vertexAttributePosition[3*a+2]=this.builder.originData[3*a+2]+this.builder.directionData[4*a+2]*this.size};c.prototype.createGeometryData=function(){var a={};a[t.VertexAttrConstants.POSITION]=this.builder.vertexIndices;a[t.VertexAttrConstants.NORMAL]=this.builder.normalIndices;this.vertexAttributeColor&&(a[t.VertexAttrConstants.COLOR]=new Uint32Array(a[t.VertexAttrConstants.POSITION].length));
var c={};c[t.VertexAttrConstants.POSITION]={size:3,data:this.vertexAttributePosition};c[t.VertexAttrConstants.NORMAL]={size:3,data:this.vertexAttributeNormal};this.vertexAttributeColor&&(c[t.VertexAttrConstants.COLOR]={size:4,data:this.vertexAttributeColor});return new e(c,a,e.DefaultOffsets,"triangle")};c.prototype.updateElevation=function(c){a.prototype.updateElevation.call(this,c);this._bakeVertexPositions()};return c}(r);b.StaticPathGeometry=q;r=function(a){function c(c,b,d,e){c=a.call(this,c)||
this;c.vvData=null;c.vvData=new Float32Array(4*c.builder.path.vertices.length);for(var f=0;f<c.builder.path.vertices.length;++f)c.vvData[4*f+0]=b,c.vvData[4*f+1]=d,c.vvData[4*f+2]=e,c.vvData[4*f+3]=0;return c}f(c,a);c.prototype.createGeometryData=function(){var a={};a[t.VertexAttrConstants.POSITION]=this.builder.vertexIndices;a[t.VertexAttrConstants.AUXPOS1]=this.builder.vertexIndices;a[t.VertexAttrConstants.NORMAL]=this.builder.normalIndices;a[t.VertexAttrConstants.AUXPOS2]=this.builder.pathVertexIndices;
var c={};c[t.VertexAttrConstants.POSITION]={size:3,data:this.builder.originData};c[t.VertexAttrConstants.AUXPOS1]={size:4,data:this.builder.directionData};c[t.VertexAttrConstants.NORMAL]={size:3,data:this.builder.normalData};c[t.VertexAttrConstants.AUXPOS2]={size:4,data:this.vvData};this.builder.profile.hasUV()&&this.builder.options.generateUV&&(a[t.VertexAttrConstants.UV0]=this.builder.uvIndices,c[t.VertexAttrConstants.UV0]={size:2,data:this.builder.uvData});return new e(c,a,e.DefaultOffsets,"triangle")};
return c}(r);b.FastUpdatePathGeometry=r})(r||(r={}));var y=c.vec3f32.create(),w=c.vec3f32.create(),x=a.vec3f64.create(),v=c.vec3f32.create(),z=c.vec3f32.create(),A=c.vec3f32.create(),B=c.vec3f32.create(),C=d.mat4f32.create();return r})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingBox ../../support/buffer/BufferView ../../support/buffer/InterleavedLayout ../lib/GLMaterialTexture ../lib/Material ../lib/Util ../lib/Util ./VisualVariableMaterialParameters ./internal/bufferWriters ./internal/MaterialUtil ./internal/MaterialUtil ./renderers/MergedRenderer ../shaders/PathPrograms ../../../webgl/renderState".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x){function v(a,c){c.vvSizeEnabled&&(a.setUniform3fv("vvSizeMinSize",c.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",c.vvSizeMaxSize),a.setUniform3fv("vvSizeOffset",c.vvSizeOffset),a.setUniform3fv("vvSizeFactor",c.vvSizeFactor));c.vvColorEnabled&&(a.setUniform1fv("vvColorValues",c.vvColorValues),a.setUniform4fv("vvColorColors",c.vvColorColors));c.vvOpacityEnabled&&(a.setUniform1fv("vvOpacityValues",c.vvOpacityValues),a.setUniform1fv("vvOpacityOpacities",
c.vvOpacityOpacities))}var z=g.assert;q=function(a){function c(b,d){d=a.call(this,d)||this;d.supportsEdges=!0;d.params=r.copyParameters(b,H);d.vertexBufferLayout=c.getVertexBufferLayout(d.params);d.textureMode=b.textureId?b.atlasRegions?"AtlasTextured":"Textured":"none";return d}f(c,a);c.prototype.isVisibleInPass=function(a){return 3===a?this.params.castShadows:!0};c.prototype.isVisible=function(){var c=this.params;if(!a.prototype.isVisible.call(this)||0===c.layerOpacity)return!1;var b=c.symbolColors,
d="replace"===c.colorMixMode,e=0<c.opacity,f=c.externalColor&&0<c.externalColor[3];return c.vvColorEnabled||b?d?!0:e:d?f:e};c.prototype.setParameterValues=function(a){var c=this.params,b;for(b in a)"textureId"===b&&z(c.textureId,"Can only change texture of material that already has a texture"),"wireframe"===b&&z(c.wireframe,"wireframe flag affects drawmode (lines instead of triangles) and therefore can only be set during contruction"),"atlasRegions"===b&&z(a.atlasRegions===c.atlasRegions,"Can not change texture atlas mode."),
!a[b]||"vvSizeMinSize"!==b&&"vvSizeMaxSize"!==b&&"vvSizeOffset"!==b&&"vvSizeFactor"!==b?c[b]=a[b]:k.vec3.set(c[b],a[b][0],a[b][1],a[b][2]);this.notifyDirty("matChanged")};c.prototype.getParameters=function(){return this.params};c.prototype.computeVertexPosition=function(a,c,b,d){k.vec3.copy(d,c);if(this.params.vvSizeEnabled){k.vec3.copy(N,this.params.vvSizeFactor);k.vec3.scale(N,N,b);k.vec3.add(N,N,this.params.vvSizeOffset);c=N;b=this.params.vvSizeMinSize;var e=this.params.vvSizeMaxSize;c[0]=Math.min(Math.max(c[0],
b[0]),e[0]);c[1]=Math.min(Math.max(c[1],b[1]),e[1]);c[2]=Math.min(Math.max(c[2],b[2]),e[2]);k.vec3.multiply(d,d,N)}else k.vec3.scale(d,d,this.params.size);k.vec3.add(d,d,a)};c.prototype.intersectTriangles=function(a,c,b,d,e,f,g,h,l,m,p){var n=a[0],t=a[1];a=a[2];var u=c[0]-n,q=c[1]-t;for(c=c[2]-a;b<d;b++){var y=m?m[b]:b,w=g.offsetIdx+g.strideIdx*e[3*y],x=g.offsetIdx+g.strideIdx*e[3*y+1],v=g.offsetIdx+g.strideIdx*e[3*y+2],z=h.offsetIdx+h.strideIdx*e[3*y],A=h.offsetIdx+h.strideIdx*e[3*y+1],B=h.offsetIdx+
h.strideIdx*e[3*y+2],C=0;this.params.vvSizeEnabled&&(C=l.data[l.offsetIdx+l.strideIdx*f[3*y]]);k.vec3.set(P,g.data[w],g.data[w+1],g.data[w+2]);k.vec3.set(L,h.data[z],h.data[z+1],h.data[z+2]);this.computeVertexPosition(P,L,C,O);var D=O[0],z=O[1],w=O[2];k.vec3.set(P,g.data[x],g.data[x+1],g.data[x+2]);k.vec3.set(L,h.data[A],h.data[A+1],h.data[A+2]);this.computeVertexPosition(P,L,C,O);var G=O[0],A=O[1],x=O[2];k.vec3.set(P,g.data[v],g.data[v+1],g.data[v+2]);k.vec3.set(L,h.data[B],h.data[B+1],h.data[B+
2]);this.computeVertexPosition(P,L,C,O);var v=G-D,B=A-z,C=x-w,x=O[0]-D,A=O[1]-z,G=O[2]-w,F=q*G-A*c,J=c*x-G*u,E=u*A-x*q,H=v*F+B*J+C*E,D=n-D,K=t-z,U=a-w,w=K*C-B*U,z=U*v-C*D,I=D*B-v*K;if(H>M){D=D*F+K*J+U*E;if(0>D||D>H)continue;F=u*w+q*z+c*I;if(0>F||D+F>H)continue}else if(H<-M){D=D*F+K*J+U*E;if(0<D||D<H)continue;F=u*w+q*z+c*I;if(0<F||D+F<H)continue}else continue;w=(x*w+A*z+G*I)/H;0<=w&&(v=r.computeNormal(v,B,C,x,A,G,T),p(w,v,y))}};c.prototype.intersect=function(a,c,b,d,e,f,g,m){"triangle"===a.data.primitiveType&&
(c=0,c=this.params.vvSizeEnabled?Math.max(this.params.vvSizeMaxSize[0],Math.max(this.params.vvSizeMaxSize[1],this.params.vvSizeMaxSize[2])):this.params.size,c=h.fromValues(a.boundingInfo.bbMin[0]-c,a.boundingInfo.bbMin[1]-c,a.boundingInfo.bbMin[2]-c,a.boundingInfo.bbMax[0]+c,a.boundingInfo.bbMax[1]+c,a.boundingInfo.bbMax[2]+c),b=[f[0]-e[0],f[1]-e[1],f[2]-e[2]],m=Math.sqrt(b[0]*b[0]+b[1]*b[1]+b[2]*b[2]),r.intersectAabbInvDir(c,e,[m/b[0],m/b[1],m/b[2]],d.tolerance)&&this.intersectTriangles(e,f,0,a.indexCount/
3,a.getIndices(l.VertexAttrConstants.POSITION),a.getIndices(l.VertexAttrConstants.AUXPOS2),a.getAttribute(l.VertexAttrConstants.POSITION),a.getAttribute(l.VertexAttrConstants.AUXPOS1),a.getAttribute(l.VertexAttrConstants.AUXPOS2),null,g))};c.prototype.createBufferWriter=function(){return new D(this.vertexBufferLayout)};c.prototype.createRenderer=function(a,c){return new y(a,c,this)};c.prototype.getGLMaterials=function(){return{color:A,depth:B,depthShadowMap:this.params.castShadows?C:null,normal:E,
highlight:F}};c.prototype.getAllTextureIds=function(){return this.params.textureId?[this.params.textureId]:[]};c.getVertexBufferLayout=function(a){var c=p.newLayout().vec3f("position").vec3f("normal");c.vec4f(l.VertexAttrConstants.AUXPOS1);a.textureId&&(c=c.vec2f("uv0"),a.atlasRegions&&(c=c.vec4u16("region",{glNormalized:!0})));a.symbolColors&&(c=c.vec4u8("symbolColor"));if(a.vvColorEnabled||a.vvSizeEnabled||a.vvOpacityEnabled)c=c.vec4f(l.VertexAttrConstants.AUXPOS2);return c};return c}(a);var A=
function(a){function c(c,b,d){var e=this,f=c.getParameters(),e=a.call(this,c,b,d,f.textureId,void 0,f.textureInitTransparent)||this;e.params=r.copyParameters(f);e.slot=e.params.transparent?6:4;e.textureMode=c.textureMode;e._createPrograms();e.selectPipeline();return e}f(c,a);c.prototype._createPrograms=function(){var a=this;this.programs=t.BindParametersMap.create(this.params,function(c){return a._createProgram(c)})};c.prototype._createProgram=function(a){var c=this.params;return this.programRep.getProgram(w.colorPass,
{textureMode:this.textureMode,symbolColors:c.symbolColors,flipV:c.flipV,doubleSided:c.doubleSided&&"normal"===c.doubleSidedType,windowOrderDoubleSided:c.doubleSided&&"winding-order"===c.doubleSidedType,receiveShadows:a.receiveShadows,receiveSSAO:a.receiveSSAO,vvSize:c.vvSizeEnabled,vvColor:c.vvColorEnabled,vvOpacity:c.vvOpacityEnabled,verticalOffset:null!==c.verticalOffset,screenSizePerspective:null!==c.screenSizePerspective,slice:c.slicePlaneEnabled,compressedNormals:c.compressedNormals,transparencyDiscard:c.transparent,
wireframe:c.wireframe})};c.prototype.selectPipeline=function(){var a=this.params;this.pipelineState=x.makePipelineState({blending:a.transparent&&x.separateBlendingParams(770,1,771,771),culling:K(a),polygonOffset:a.polygonOffset&&G,depthTest:{func:513},depthWrite:x.defaultDepthWriteParams,colorWrite:x.defaultColorWriteParams})};c.prototype.beginSlot=function(a){return a===this.slot};c.prototype.getProgram=function(){return this.program||this.getPrograms()[0]};c.prototype.getPrograms=function(){return t.BindParametersMap.programs(this.programs)};
c.prototype.updateParameters=function(){this.params=r.copyParameters(this.material.getParameters());this.slot=this.params.transparent?6:4;this.updateTexture(this.params.textureId);this._createPrograms();this.selectPipeline()};c.prototype.bind=function(a,c){var b=this.params,d=this.program=t.BindParametersMap.lookup(this.programs,c);a.bindProgram(d);a.setPipelineState(this.pipelineState);d.setUniform1f("size",b.size);d.setUniform3fv("ambient",b.ambient);d.setUniform3fv("diffuse",b.diffuse);d.setUniform3fv("specular",
b.specular);d.setUniform4fv("externalColor",b.externalColor);d.setUniform1i("colorMixMode",r.colorMixModes[b.colorMixMode]);d.setUniform1f("opacity",b.opacity);d.setUniform1f("layerOpacity",b.layerOpacity);r.bindVerticalOffset(b.verticalOffset,c,d);r.bindScreenSizePerspective(b.screenSizePerspective,d);v(d,b);this.bindTexture(a,d);"none"!==this.textureMode&&this.bindTextureSize(a,d)};c.prototype.release=function(a,c){};c.prototype.bindView=function(a,c){a=this.program=t.BindParametersMap.lookup(this.programs,
c);var b=this.params,d=c.origin;r.bindView(d,c.view,a);r.bindCamPos(d,c.viewInvTransp,a);b.slicePlaneEnabled&&r.bindSlicePlane(d,c.slicePlane,a);c.shadowMappingEnabled&&c.shadowMap.bindView(a,d)};c.prototype.bindInstance=function(a,c){a=this.program;a.setUniformMatrix4fv("model",c.transformation);a.setUniformMatrix4fv("modelNormal",c.transformationNormal)};c.prototype.getDrawMode=function(){return this.params.wireframe?1:4};return c}(c),B=function(a){function c(c,b,d,e){void 0===e&&(e=!1);b=a.call(this,
c,b,d,c.getParameters().textureId)||this;b.textureMode=c.textureMode;b.biased=e;b.updateParameters();return b}f(c,a);c.prototype.beginSlot=function(a){return a===this.slot};c.prototype.getProgram=function(){return this.program};c.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(w.depthPass,{textureMode:this.textureMode,flipV:a.flipV,shadowMap:this.biased,vvSize:a.vvSizeEnabled,verticalOffset:null!==a.verticalOffset,screenSizePerspective:null!==a.screenSizePerspective,
slice:a.slicePlaneEnabled,transparencyDiscard:a.transparent});this.pipelineState=x.makePipelineState({culling:K(a),polygonOffset:a.polygonOffset&&G,depthTest:{func:513},depthWrite:x.defaultDepthWriteParams,colorWrite:x.defaultColorWriteParams})};c.prototype.selectSlot=function(){this.slot=this.params.transparent?6:4};c.prototype.updateParameters=function(){this.params=r.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};
c.prototype.bind=function(a,c){var b=this.program,d=this.params;a.bindProgram(b);a.setPipelineState(this.pipelineState);b.setUniform1f("size",d.size);b.setUniform2fv("nearFar",c.nearFar);r.bindVerticalOffset(d.verticalOffset,c,b);r.bindScreenSizePerspective(d.screenSizePerspective,b);v(b,d);this.bindTexture(a,b)};c.prototype.release=function(a){};c.prototype.bindView=function(a,c){a=this.program;var b=this.params,d=c.origin;r.bindView(d,c.view,a);b.slicePlaneEnabled&&r.bindSlicePlane(c.origin,c.slicePlane,
a);b.screenSizePerspective&&r.bindCamPos(d,c.viewInvTransp,a)};c.prototype.bindInstance=function(a,c){this.program.setUniformMatrix4fv("model",c.transformation)};c.prototype.getDrawMode=function(){return this.params.wireframe?1:4};return c}(c),C=function(a){function c(c,b,d){return a.call(this,c,b,d,!0)||this}f(c,a);return c}(B),E=function(a){function c(c,b,d){b=a.call(this,c,b,d,c.getParameters().textureId)||this;b.textureMode=c.textureMode;b.updateParameters();return b}f(c,a);c.prototype.beginSlot=
function(a){return a===this.slot};c.prototype.getProgram=function(){return this.program};c.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(w.normalPass,{textureMode:this.textureMode,flipV:a.flipV,vvSize:a.vvSizeEnabled,verticalOffset:null!==a.verticalOffset,screenSizePerspective:null!==a.screenSizePerspective,slice:a.slicePlaneEnabled,compressedNormals:a.compressedNormals,transparencyDiscard:a.transparent});this.pipelineState=x.makePipelineState({polygonOffset:a.polygonOffset&&
G,culling:K(a),depthTest:{func:513},depthWrite:x.defaultDepthWriteParams,colorWrite:x.defaultColorWriteParams})};c.prototype.selectSlot=function(){this.slot=this.params.transparent?6:4};c.prototype.updateParameters=function(){this.params=r.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};c.prototype.bind=function(a,c){var b=this.program,d=this.params;a.bindProgram(b);a.setPipelineState(this.pipelineState);b.setUniform1f("size",
d.size);this.bindTexture(a,b);r.bindVerticalOffset(d.verticalOffset,c,b);r.bindScreenSizePerspective(d.screenSizePerspective,b);v(b,d)};c.prototype.release=function(a){};c.prototype.bindView=function(a,c){a=this.program;var b=this.params,d=c.origin;r.bindView(d,c.view,a);a.setUniformMatrix4fv("viewNormal",c.viewInvTransp);b.slicePlaneEnabled&&r.bindSlicePlane(c.origin,c.slicePlane,a);b.screenSizePerspective&&r.bindCamPos(d,c.viewInvTransp,a)};c.prototype.bindInstance=function(a,c){a=this.program;
a.setUniformMatrix4fv("model",c.transformation);a.setUniformMatrix4fv("modelNormal",c.transformationNormal)};c.prototype.getDrawMode=function(){return this.params.wireframe?1:4};return c}(c),F=function(a){function c(c,b,d){b=a.call(this,c,b,d,c.getParameters().textureId)||this;b.textureMode=c.textureMode;b.updateParameters();return b}f(c,a);c.prototype.beginSlot=function(a){return a===this.slot};c.prototype.getProgram=function(){return this.program};c.prototype.selectProgram=function(){var a=this.params;
this.program=this.programRep.getProgram(w.highlightPass,{textureMode:this.textureMode,flipV:a.flipV,vvSize:a.vvSizeEnabled,verticalOffset:null!==a.verticalOffset,screenSizePerspective:null!==a.screenSizePerspective,slice:a.slicePlaneEnabled,transparencyDiscard:a.transparent});this.pipelineState=x.makePipelineState({polygonOffset:a.polygonOffset&&G,culling:K(a),depthTest:{func:513},depthWrite:x.defaultDepthWriteParams,colorWrite:x.defaultColorWriteParams})};c.prototype.selectSlot=function(){this.slot=
this.params.transparent?6:4};c.prototype.updateParameters=function(){this.params=r.copyParameters(this.material.getParameters());this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};c.prototype.bind=function(a,c){var b=this.program,d=this.params;a.bindProgram(b);a.setPipelineState(this.pipelineState);b.setUniform1f("size",d.size);this.bindTexture(a,b);r.bindVerticalOffset(d.verticalOffset,c,b);r.bindScreenSizePerspective(d.screenSizePerspective,b);v(b,d)};c.prototype.release=
function(a){};c.prototype.bindView=function(a,c){a=this.program;var b=this.params,d=c.origin;r.bindView(d,c.view,a);b.slicePlaneEnabled&&r.bindSlicePlane(c.origin,c.slicePlane,a);b.screenSizePerspective&&r.bindCamPos(d,c.viewInvTransp,a)};c.prototype.bindInstance=function(a,c){a=this.program;a.setUniformMatrix4fv("model",c.transformation);a.setUniformMatrix4fv("modelNormal",c.transformationNormal)};c.prototype.getDrawMode=function(){return this.params.wireframe?1:4};return c}(c),H=n({size:1,wireframe:!1,
textureId:void 0,textureInitTransparent:!1,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,symbolColors:!1,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,compressedNormals:!1,receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,transparent:!1,polygonOffset:!1,atlasRegions:!1},e.Default),D=function(){function a(a){this.vertexBufferLayout=a}a.prototype.allocate=
function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices.position.length};a.prototype.write=function(a,c,b,d,e){if(l.VertexAttrConstants.AUXPOS1 in c.vertexAttr){var f=c.vertexAttr[l.VertexAttrConstants.AUXPOS1],g=c.indices[l.VertexAttrConstants.AUXPOS1];z(4===f.size);var h=d.getField(l.VertexAttrConstants.AUXPOS1,m.BufferViewVec4f);if(h)u.writeBufferVec4(g,f.data,h,e);else throw Error("unable to aquire view for "+l.VertexAttrConstants.AUXPOS1);
}if(l.VertexAttrConstants.AUXPOS2 in c.vertexAttr)if(f=c.vertexAttr[l.VertexAttrConstants.AUXPOS2],g=c.indices[l.VertexAttrConstants.AUXPOS2],z(4===f.size),h=d.getField(l.VertexAttrConstants.AUXPOS2,m.BufferViewVec4f))u.writeBufferVec4(g,f.data,h,e);else throw Error("unable to aquire view for "+l.VertexAttrConstants.AUXPOS2);u.writeDefaultAttributes(c,b,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,d,e)};return a}(),G={factor:2,units:2},K=function(a){var c;c=a.slicePlaneEnabled?
!1:a.cullFace?"none"!==a.cullFace:!a.transparent&&!a.doubleSided;return c&&{face:"front"===a.cullFace?1028:1029,mode:2305}},M=Math.pow(2,-52),O=d.vec3f64.create(),N=d.vec3f64.create(),P=d.vec3f64.create(),L=d.vec3f64.create(),T=d.vec3f64.create();return q})},"esri/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":function(){define(["require","exports","../../../../core/libs/gl-matrix-2/mat4f64","../../../../core/libs/gl-matrix-2/vec3f32"],function(q,b,n,f){var k;(k||(k={})).Default=
{vvSizeEnabled:!1,vvSizeMinSize:f.vec3f32.fromValues(1,1,1),vvSizeMaxSize:f.vec3f32.fromValues(100,100,100),vvSizeOffset:f.vec3f32.fromValues(0,0,0),vvSizeFactor:f.vec3f32.fromValues(1,1,1),vvSizeValue:f.vec3f32.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:n.mat4f64.create()};
return k})},"esri/views/3d/webgl-engine/shaders/PathPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});var d=function(b){return k.glslifyDefineMap({TEXTURING:"none"!==b.textureMode,TEXTURE_ATLAS:"AtlasTextured"===b.textureMode,SYMBOLVERTEXCOLORS:b.symbolColors,FLIPV:b.flipV,DOUBLESIDED:b.doubleSided,WINDINGORDERDOUBLESIDED:b.windowOrderDoubleSided,
RECEIVE_SHADOWS:b.receiveShadows,RECEIVE_SSAO:b.receiveSSAO,VV_SIZE:b.vvSize,VV_COLOR:b.vvColor,VV_OPACITY:b.vvOpacity,SCREEN_SIZE_PERSPECTIVE:b.screenSizePerspective,SLICE:b.slice,COMPRESSED_NORMALS:b.compressedNormals,COMPONENTCOLORS:b.componentColor,TRANSPARENCY_DISCARD:b.transparencyDiscard,BIAS_SHADOWMAP:b.shadowMap,WIREFRAME:b.wireframe})};b.colorPass={name:"path-color",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("materials/pathMaterial/colorPass.vert"),fragmentShader:d(b)+
f.resolveIncludes("materials/pathMaterial/colorPass.frag")}},attributes:n.Default3D};b.depthPass={name:"path-depth",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("materials/pathMaterial/depthPass.vert"),fragmentShader:d(b)+f.resolveIncludes("materials/pathMaterial/depthPass.frag")}},attributes:n.Default3D};b.normalPass={name:"path-normal",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("materials/pathMaterial/normalPass.vert"),fragmentShader:d(b)+f.resolveIncludes("materials/pathMaterial/normalPass.frag")}},
attributes:n.Default3D};b.highlightPass={name:"path-highlight",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("materials/pathMaterial/highlightPass.vert"),fragmentShader:d(b)+f.resolveIncludes("materials/pathMaterial/highlightPass.frag")}},attributes:n.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ../../../../core/libs/gl-matrix-2/mat4 ../../../../core/libs/gl-matrix-2/mat4f64 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Util ../../webgl-engine/materials/ColorMaterial".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function p(a,c,d,e){a=b.call(this,a,c,d,e)||this;a._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};a._prepareFillResources();a._prepareOutlineResources();a.resolve();return a}n(p,b);p.prototype._prepareFillResources=function(){var a=this._getStageIdHint(),c=this._getMaterialOpacityAndColor(),c={color:c,transparent:1>c[3]||this._isPropertyDriven("opacity"),
polygonOffset:!1,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled};this._material=new C(c,a+"_colormat");this._context.stage.add(w.ModelContentType.MATERIAL,this._material)};p.prototype._prepareOutlineResources=function(){var a=this.symbolLayer.outline;if(this._hasOutline=!!(a&&a.size&&0<a.size&&a.color))a={idHint:this._getStageIdHint()+"_outline",color:this._getOutlineColor(),width:k.pt2px(a.size),slicePlaneEnabled:this._context.slicePlaneEnabled},this._outlineMaterial=1.5<=a.width?
y.createRibbonMaterial(a):y.createNativeMaterial(a),this._context.stage.add(w.ModelContentType.MATERIAL,this._outlineMaterial)};p.prototype.destroy=function(){b.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(w.ModelContentType.MATERIAL,this._material.id),this._material=null);this._outlineMaterial&&(this._context.stage.remove(w.ModelContentType.MATERIAL,this._outlineMaterial.id),this._outlineMaterial=null)};p.prototype.createGraphics3DGraphic=
function(a){var c=a.graphic,b=c.geometry.type;if("polyline"!==b&&"polygon"!==b&&"extent"!==b)return this._logWarning("unsupported geometry type for fill symbol: "+b),null;if(!this._validateGeometry(c.geometry))return null;b="graphic"+c.uid;a=this._getVertexOpacityAndColor(a.renderingInfo,Uint8Array,255);var d=this.getGraphicElevationContext(c);return"on-the-ground"===d.mode?this._createAsOverlay(c,a,d,b):this._createAs3DShape(c,a,d,b,c.uid)};p.prototype.layerOpacityChanged=function(){var a=this._material.getColor(),
c=this._getMaterialOpacity();this._material.setColor([a[0],a[1],a[2],c]);this._material.setTransparent(1>c||this._isPropertyDriven("opacity"));this._outlineMaterial&&(a=this._outlineMaterial.getColor(),a={color:[a[0],a[1],a[2],this._getOutlineOpacity()]},this._outlineMaterial.setParameterValues(a));return!0};p.prototype.layerElevationInfoChanged=function(a,c,b){var d=this._elevationContext.mode;if(null==b||null==d)return!1;if("on-the-ground"===b&&"on-the-ground"===d)return!0;if(b!==d&&("on-the-ground"===
b||"on-the-ground"===d))return!1;var e=u.needsElevationUpdates2D(d);return this.updateGraphics3DGraphicElevationInfo(a,c,function(){return e})};p.prototype.slicePlaneEnabledChanged=function(a,c){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});this._outlineMaterial&&this._outlineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};p.prototype.pixelRatioChanged=function(a,c){return!0};p.prototype.setDrawOrder=function(a,c,
b){this.updateSymbolLayerOrder(a,c);this._material&&(this._material.renderPriority=a+c/2,b.add(this._material.id));this._outlineMaterial&&(this._outlineMaterial.renderPriority=a,b.add(this._outlineMaterial.id))};p.prototype._createAs3DShape=function(a,c,b,d,f){var g=this._getPolyGeometry(a);a=g.rings;var h=this._getOutlineGeometry(g,a),g=u.getGeometryVertexData3D(h,g.hasZ,g.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,b);D.idHint=
d;D.color=c;D.data=g;var m;this._hasOutline&&(m=new g.vertexData.constructor(g.vertexData));D.outNum=0;D.outGeometries=[];D.outTransforms=[];D.outMaterials=[];this._createAs3DShapeFill(D);D.data.vertexData=m;this._createAs3DShapeOutline(D);this._logGeometryCreationWarnings(D.data,a,"rings","FillSymbol3DLayer");if(0===D.outNum)return null;c=new z({geometries:D.outGeometries,materials:D.outMaterials,transformations:D.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:f},
idHint:d});c=new e(this,c,D.outGeometries,null,null,l.perVertexElevationAligner,b);c.alignedTerrainElevation=g.terrainElevation;c.needsElevationUpdates=u.needsElevationUpdates2D(b.mode);return c};p.prototype._createAs3DShapeFill=function(a){for(var c=a.data.geometryData.polygons,b=a.data.eleVertexData,e=a.data.vertexData,f=function(f){var l=c[f];f=l.count;var k=l.index;if(g._context.clippingExtent&&(u.computeBoundingBox(b,k,f,E),u.boundingBoxClipped(E,g._context.clippingExtent)))return"continue";
var p=new Float64Array(b.buffer,3*k*b.BYTES_PER_ELEMENT,3*f),r=new Float64Array(e.buffer,3*k*e.BYTES_PER_ELEMENT,3*f),l=l.holeIndices.map(function(a){return a-k}),l=d(p,l,3);if(0===l.length)return"continue";u.chooseOrigin(e,k,f,F);u.subtractCoordinates(e,k,f,F);f=g._createFillGeometry(l,0,r,p,a.color);f=new x(f,a.idHint);f.singleUse=!0;p=m.mat4f64.create();h.mat4.translate(p,p,F);a.outGeometries.push(f);a.outMaterials.push(g._material);a.outTransforms.push(p);a.outNum++},g=this,l=0;l<c.length;++l)f(l)};
p.prototype._createAs3DShapeOutline=function(a){if(this._hasOutline)for(var c=a.data.geometryData.outlines,b=a.data.eleVertexData,d=a.data.vertexData,e=0;e<c.length;++e){var f=c[e],g=f.index,l=f.count;if(this._context.clippingExtent&&(u.computeBoundingBox(b,g,l,E),u.boundingBoxClipped(E,this._context.clippingExtent)))continue;u.chooseOrigin(d,g,l,F);u.subtractCoordinates(d,g,l,F);f=new Float64Array(b.buffer,3*g*b.BYTES_PER_ELEMENT,3*l);g=new Float64Array(d.buffer,3*g*d.BYTES_PER_ELEMENT,3*l);g=y.createPolylineGeometry(g,
f,!1,H,0);g=new x(g,a.idHint+"outline"+e);g.singleUse=!0;f=m.mat4f64.create();h.mat4.translate(f,f,F);a.outGeometries.push(g);a.outMaterials.push(this._outlineMaterial);a.outTransforms.push(f);a.outNum++}};p.prototype._createAsOverlay=function(c,b,d,e){var f=this._getPolyGeometry(c);d=f.rings;var h=this._getOutlineGeometry(f,d);this._material.renderPriority=this._symbolLayerOrder+this._symbolLayerOrderDelta/2;this._hasOutline&&(this._outlineMaterial.renderPriority=this._symbolLayerOrder);f=u.getGeometryVertexDataDraped(h,
f.spatialReference,this._context.overlaySR);D.idHint=e;D.color=b;D.data=f;var l;this._hasOutline&&(l=new f.vertexData.constructor(f.vertexData));D.outNum=0;D.outGeometries=[];D.outBoundingBox=a.empty();D.layerUid=this._context.layer.uid;D.graphicsUid=c.uid;this._createAsOverlayFill(D);D.data.vertexData=l;this._createAsOverlayOutline(D);this._logGeometryCreationWarnings(D.data,d,"rings","FillSymbol3DLayer");return 0<D.outNum?new g(this,D.outGeometries,D.outBoundingBox):null};p.prototype._createAsOverlayFill=
function(c){for(var b=c.data.vertexData,e=c.data.geometryData.polygons,f=function(f){var l=e[f];f=l.count;var k=l.index,p=new Float64Array(b.buffer,3*k*b.BYTES_PER_ELEMENT,3*f),l=l.holeIndices.map(function(a){return a-k}),p=d(p,l,3);if(0===p.length)return"continue";u.computeBoundingBox(b,k,f,E);if(u.boundingBoxClipped(E,g._context.clippingExtent))return"continue";a.expand(c.outBoundingBox,E);u.chooseOrigin(b,k,f,F);u.subtractCoordinates(b,k,f,F);u.setZ(b,k,f,g._getDrapedZ());f=m.mat4f64.create();
h.mat4.translate(f,f,F);p=g._createFillGeometry(p,k,b,null,c.color);l=new A(p);l.data.layerUid=c.layerUid;l.data.graphicUid=c.graphicsUid;l.material=g._material;var r=E;l.center=[.5*(r[0]+r[3]),.5*(r[1]+r[4]),0];l.bsRadius=.5*Math.sqrt((r[3]-r[0])*(r[3]-r[0])+(r[4]-r[1])*(r[4]-r[1]));l.transformation=f;l.name=c.idHint;l.uniqueName=c.idHint+"#"+p.id;c.outGeometries.push(l);c.outNum++},g=this,l=0;l<e.length;++l)f(l)};p.prototype._createAsOverlayOutline=function(c){if(this._hasOutline)for(var b=c.data.vertexData,
d=c.data.geometryData.outlines,e=0;e<d.length;++e){var f=d[e],g=f.index,f=f.count;u.computeBoundingBox(b,g,f,E);if(!u.boundingBoxClipped(E,this._context.clippingExtent)){a.expand(c.outBoundingBox,E);u.chooseOrigin(b,g,f,F);u.subtractCoordinates(b,g,f,F);u.setZ(b,g,f,this._getDrapedZ());f=new Float64Array(b.buffer,3*g*b.BYTES_PER_ELEMENT,3*f);g=m.mat4f64.create();h.mat4.translate(g,g,F);var f=y.createPolylineGeometry(f,null,!0,H,0),l=new A(f);l.data.layerUid=c.layerUid;l.data.graphicUid=c.graphicsUid;
l.material=this._outlineMaterial;var k=E;l.center=[.5*(k[0]+k[3]),.5*(k[1]+k[4]),0];l.bsRadius=.5*Math.sqrt((k[3]-k[0])*(k[3]-k[0])+(k[4]-k[1])*(k[4]-k[1]));l.transformation=g;l.name=c.idHint+"outline";l.uniqueName=c.idHint+"outline#"+f.id;c.outGeometries.push(l);c.outNum++}}};p.prototype._getOutlineGeometry=function(a,c){return c};p.prototype._getOutlineOpacity=function(){return this._getLayerOpacity()*this.symbolLayer.outline.color.a};p.prototype._getOutlineColor=function(){var a=this.symbolLayer.outline.color,
c=this._getOutlineOpacity();return r.mixinColorAndOpacity(f.toUnitRGB(a),c)};p.prototype._getPolyGeometry=function(a){a=a.geometry;return"extent"===a.type?c.fromExtent(a):a};p.prototype._createFillGeometry=function(a,c,b,d,e){for(var f=a.length,g=new Uint32Array(f),h=new Uint32Array(f),l=0;l<f;l++)g[l]=a[l]+c,h[l]=0;a={};c={};a[B.VertexAttrConstants.POSITION]=g;a[B.VertexAttrConstants.COLOR]=h;c[B.VertexAttrConstants.POSITION]={size:3,data:b};c[B.VertexAttrConstants.COLOR]={size:4,data:e};d&&(c.mapPos=
{size:3,data:d},a.mapPos=g);return new v(c,a)};return p}(t.default);b.Graphics3DPolygonFillSymbolLayer=q;var E=a.create(),F=p.vec3f64.create(),H=new Float32Array([255,255,255,255]),D={idHint:null,color:null,data:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};b.default=q})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r){function y(a,c,b){a&&a.forEach(function(a){var d=c(a);d&&b(d,a.graphic)})}Object.defineProperty(b,"__esModule",{value:!0});var w=[0,0,1];q=function(a){function b(c,b,d,e){c=a.call(this,c,b,d,e)||this;c._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};if(!c._isPropertyDriven("size")&&(b=l.validateSymbolLayerSize(c.symbolLayer.size)))return c._logWarning(b),c.reject(),c;c._createTextRenderParameters();c.resolve();return c}n(b,a);b.prototype._createTextRenderParameters=
function(){this._textRenderParameters=u.default.fromSymbol(this.symbolLayer,this._context.layerView.view.pixelRatio)};b.prototype.destroy=function(){a.prototype.destroy.call(this);this.isFulfilled()||this.reject()};b.prototype.createGraphics3DGraphic=function(a){a=a.graphic;var b=c.placePointOnGeometry(a.geometry);if(!b)return this._logWarning("unsupported geometry type for text symbol: "+a.geometry.type),null;var d=this.symbolLayer.text;if(!d)return null;var e=h.isCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?
this.symbol:null;return this._createAs3DShape(a,b,d,e)};b.prototype.createLabel=function(a,b,d,e){a=a.graphic;var f=c.placePointOnGeometry(a.geometry);if(!f)return this._logWarning("unsupported geometry type for label: "+a.geometry.type),null;var g=b.text;return g?this._createAs3DShape(a,f,g,b,b,d,e):null};b.prototype.getGraphicElevationContext=function(c,b){void 0===b&&(b=0);c=a.prototype.getGraphicElevationContext.call(this,c);c.addOffsetRenderUnits(b);return c};b.prototype.layerOpacityChanged=
function(){this._logWarning("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");return!1};b.prototype.layerElevationInfoChanged=function(a,c){var b=this;y(a,c,function(a,c){b.updateGraphicElevationContext(c,a)});return!0};b.prototype.slicePlaneEnabledChanged=function(a,c){var b=this;y(a,c,function(a){var c=0;for(a=a.stageObject.geometryRecords;c<a.length;c++)a[c].material.setParameterValues({slicePlaneEnabled:b._context.slicePlaneEnabled})});return!0};b.prototype.pixelRatioChanged=
function(a,c){return!1};b.prototype.updateGraphicElevationContext=function(a,b){a=this.getGraphicElevationContext(a,b.metadata.elevationOffset);b.elevationContext.set(a);b.needsElevationUpdates=c.needsElevationUpdates2D(a.mode)||"absolute-height"===a.mode};b.prototype._defaultElevationInfoNoZ=function(){return x};b.prototype._createAs3DShape=function(a,b,h,n,u,q,y){void 0===u&&(u=v);var x=this.getGraphicElevationContext(a,u.elevationOffset),z=this._context.layer.id+"_label_"+a.uid,A="polyline"===
a.geometry.type,B=a.uid;a=this._context.stage.view.renderingContext;var C=l.namedAnchorToHUDMaterialAnchorPos[u.anchor in l.namedAnchorToHUDMaterialAnchorPos?u.anchor:"center"];a=f.isNone(y)?new t(a,h,this._textRenderParameters,z):null;C={occlusionTest:!0,screenOffset:u.screenOffset,anchorPos:C,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:u.centerOffsetUnits,debugDrawBorder:u.debugDrawBorder,drawInSecondSlot:!0};f.isSome(a)&&(C.textureId=a.id,C.texCoordScale=a.texcoordScale);f.isSome(y)&&(C.textureId=
y.textureId);if(f.isSome(n)&&f.isSome(n.verticalOffset)){n=n.verticalOffset;var D=n.minWorldLength,G=n.maxWorldLength;C.verticalOffset={screenLength:k.pt2px(n.screenLength),minWorldLength:D||0,maxWorldLength:null!=G?G:Infinity}}this._context.screenSizePerspectiveEnabled&&(n=this._context.sharedResources,D=n.screenSizePerspectiveSettings,C.screenSizePerspective=n.screenSizePerspectiveSettingsLabels.overridePadding(this._textRenderParameters.haloSize),C.screenSizePerspectiveAlignment=D);A&&(C.shaderPolygonOffset=
1E-4);C.slicePlaneEnabled=this._context.slicePlaneEnabled;A=null;n=JSON.stringify(C);f.isSome(q)?(A=q.getMaterial(n),null==A&&(A=new r(C,z),q.addMaterial(n,A))):A=new r(C,z);A=[A];y=e.createPointGeometry(w,u.translation,void 0,f.isSome(a)?[a.displayWidth,a.displayHeight]:[0,0],u.centerOffset,f.isSome(y)?[0,0]:null);y=[new g(y,z)];z=c.createStageObjectForPoint(this._context,b,y,A,null,null,x,z,this._context.layer.uid,B,!0);if(null===z)return null;B=m.perObjectElevationAligner;q=new p(this,z.object,
y,f.isNone(q)?A:null,f.isSome(a)?[a]:null,B,x);q.alignedTerrainElevation=z.terrainElevation;q.needsElevationUpdates=c.needsElevationUpdates2D(x.mode)||"absolute-height"===x.mode;var x=f.isSome(a)?a:u,F=x.displayWidth,E=x.displayHeight;q.getScreenSize=function(a){void 0===a&&(a=d.vec2f64.create());a[0]=F;a[1]=E;return a};q.metadata={labelText:h,elevationOffset:u.elevationOffset};c.extendPointGraphicElevationContext(q,b,this._context.elevationProvider);return q};return b}(a.default);b.Graphics3DTextSymbolLayer=
q;var x={mode:"relative-to-ground",offset:0},v={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawBorder:!1,displayWidth:0,displayHeight:0};b.default=q})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define(["require","exports","../../../../Color","../../../../core/screenUtils"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this.definition=
b;this.key=JSON.stringify(b);this.haloSize=Math.round(b.halo.size);this.fillStyle=this.colorToRGBA(b.color);this.haloStyle=this.colorToRGB(b.halo.color)}b.prototype.colorToRGB=function(b){return"rgb("+b.slice(0,3).map(function(b){return Math.floor(255*b)}).toString()+")"};b.prototype.colorToRGBA=function(b){return"rgba("+b.slice(0,3).map(function(b){return Math.floor(255*b)}).toString()+","+b[3]+")"};b.fromSymbol=function(d,m){void 0===m&&(m=1);var h=d.material?n.toUnitRGBA(d.material.color):k,c=
d.halo&&d.halo.color&&0<d.halo.size,a=null!=d.size?f.pt2px(d.size):12,l={family:d.font&&d.font.family?d.font.family:"sans-serif",weight:d.font&&d.font.weight?d.font.weight:"normal",style:d.font&&d.font.style?d.font.style:"normal"};d={size:c?f.pt2px(d.halo.size):0,color:c?n.toUnitRGBA(d.halo.color):k};return new b({size:a,color:h,font:l,halo:d,pixelRatio:m})};return b}();b.TextRenderParameters=q;var k=[1,1,1,1];b.default=q})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define("require exports ../../../../core/mathUtils ./TextRenderer ./Texture ../../../webgl/Texture ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(q,b,n,f,k,d,h){var m={canvas:null};return function(){function b(c,a,b,d){this._idHint=d;this._requiresPowerOfTwo=!h.default(c.gl);this._renderer=new f.default(a,b)}Object.defineProperty(b.prototype,"id",{get:function(){null==this._id&&(this._id=k.idGen.gen(this._idHint));return this._id},enumerable:!0,configurable:!0});b.prototype.deferredLoading=function(){return!1};b.prototype.getWidth=function(){return this._renderer.renderedWidth};b.prototype.getHeight=function(){return this._renderer.renderedHeight};
Object.defineProperty(b.prototype,"textureWidth",{get:function(){var c=this.getWidth();return this._requiresPowerOfTwo?n.nextHighestPowerOfTwo(c):c},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"textureHeight",{get:function(){var c=this.getHeight();return this._requiresPowerOfTwo?n.nextHighestPowerOfTwo(c):c},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"displayWidth",{get:function(){return this._renderer.displayWidth},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"displayHeight",{get:function(){return this._renderer.displayHeight},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"texcoordScale",{get:function(){return[this._renderer.renderedWidth/this.textureWidth,this._renderer.renderedHeight/this.textureHeight]},enumerable:!0,configurable:!0});b.prototype.initializeThroughRender=function(c,a){var b=f.getTextHelperCanvas(m,this.textureWidth,this.textureHeight),g=b.getContext("2d");g.save();a.samplingMode=9987;a.wrapMode=33071;a.flipped=!0;
a.preMultiplyAlpha=!0;a.hasMipmap=!0;this._renderer.render(g,0,this.textureHeight-this._renderer.renderedHeight);c=new d(c,a,b);g.restore();return c};b.prototype.setUnloadFunc=function(c){this._unloadFunc=c};b.prototype.unload=function(){this._unloadFunc&&(this._unloadFunc(this._id),this._unloadFunc=null)};return b}()})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["require","exports","../../../../core/maybe","./TextRenderParameters"],function(q,b,n,f){function k(c,a,b){c.canvas||
(c.canvas=document.createElement("canvas"));c.canvas.width=a;c.canvas.height=b;return c.canvas}Object.defineProperty(b,"__esModule",{value:!0});q=function(){function c(a,c,b){void 0===b&&(b=2048);this.text=a;this.maxSize=b;this._displayWidth=this._renderPixelRatio=null;this.parameters=c instanceof f.default?c:new f.default(c);this.key=this.parameters.key+"--"+a;this.textLines=a.split(/\r?\n/);this.lineHeight=this.computeLineHeight()}Object.defineProperty(c.prototype,"displayWidth",{get:function(){n.isNone(this._displayWidth)&&
(this._displayWidth=this.computeTextWidth());return this._displayWidth},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"displayHeight",{get:function(){return this.lineHeight*this.textLines.length},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderedWidth",{get:function(){return Math.round(this.displayWidth*this.renderPixelRatio)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderedHeight",{get:function(){return Math.round(this.displayHeight*
this.renderPixelRatio)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderedLineHeight",{get:function(){return Math.round(this.lineHeight*this.renderPixelRatio)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderedFontSize",{get:function(){return this.parameters.definition.size*this.renderPixelRatio},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderedHaloSize",{get:function(){return this.parameters.haloSize*this.renderPixelRatio},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderPixelRatio",{get:function(){if(n.isNone(this._renderPixelRatio)){var a=this.parameters.definition.pixelRatio;this._renderPixelRatio=0<this.maxSize?Math.min(a,Math.min(this.maxSize/(this.displayWidth*a),this.maxSize/(this.displayHeight*a))):a}return this._renderPixelRatio},enumerable:!0,configurable:!0});c.prototype.render=function(a,c,b){void 0===c&&(c=0);void 0===b&&(b=0);var d=this.renderedLineHeight,f=this.renderedHaloSize,
g=a.textAlign,h=this.renderedWidth,g=("center"===g?.5*h:"right"===g?h:0)+f;a.save();0<f&&this.renderHalo(a,g,f,c,b);this.setFontProperties(a,this.renderedFontSize);b+=f;c+=g;f=0;for(g=this.textLines;f<g.length;f++)h=g[f],a.globalCompositeOperation="destination-out",a.fillStyle="rgb(0, 0, 0)",a.fillText(h,c,b),a.globalCompositeOperation="source-over",a.fillStyle=this.parameters.fillStyle,a.fillText(h,c,b),b+=d;a.restore()};c.prototype.renderHalo=function(a,c,b,d,f){var e=this.renderedWidth,g=this.renderedHeight,
h=k(m,Math.max(e,p),Math.max(g,p)),l=h.getContext("2d");l.clearRect(0,0,e,g);this.setFontProperties(l,this.renderedFontSize);l.fillStyle=this.parameters.haloStyle;l.strokeStyle=this.parameters.haloStyle;var n=3>this.renderedHaloSize;l.lineJoin=n?"miter":"round";n?this.renderHaloEmulated(l,c,b):this.renderHaloNative(l,c,b);a.globalAlpha=this.parameters.definition.halo.color[3];a.drawImage(h,0,0,e,g,d,f,e,g);a.globalAlpha=1};c.prototype.renderHaloEmulated=function(a,c,b){for(var e=this.renderedLineHeight,
f=this.renderedHaloSize,g=0,h=this.textLines;g<h.length;g++){for(var l=h[g],k=0,m=d;k<m.length;k++){var p=m[k];a.fillText(l,c+f*p[0],b+f*p[1])}b+=e}};c.prototype.renderHaloNative=function(a,c,b){for(var d=this.renderedLineHeight,f=this.renderedHaloSize,g=0,h=this.textLines;g<h.length;g++){for(var l=h[g],k=2*f,m=0;5>m;m++)a.lineWidth=(.6+.1*m)*k,a.strokeText(l,c,b);b+=d}};c.prototype.setFontProperties=function(a,c){var b=this.parameters.definition.font;a.font=b.style+" "+b.weight+" "+c+"px "+b.family+
", sans-serif";a.textAlign="left";a.textBaseline="top"};c.prototype.computeTextWidth=function(){var a=k(m,p,p).getContext("2d");this.setFontProperties(a,this.parameters.definition.size);for(var c=0,b=0,d=this.textLines;b<d.length;b++)c=Math.max(c,a.measureText(d[b]).width);b=this.parameters.definition.font;if("italic"===b.style||"oblique"===b.style||"string"===typeof b.weight&&("bold"===b.weight||"bolder"===b.weight)||"number"===typeof b.weight&&600<b.weight)c+=.3*a.measureText("A").width;c+=2*this.parameters.haloSize;
return Math.round(c)};c.prototype.computeLineHeight=function(){return Math.floor(1.275*this.parameters.definition.size+2*this.parameters.haloSize)};return c}();b.TextRenderer=q;for(var d=[],h=0;360>h;h+=22.5)d.push([Math.cos(Math.PI*h/180),Math.sin(Math.PI*h/180)]);b.getTextHelperCanvas=k;var m={canvas:null},p=512;b.default=q})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./symbolComplexity","../../support/PromiseLightweight"],
function(q,b,n,f,k){return function(b){function d(d,f){var c=b.call(this)||this;c.symbol=d;c.graphics3DSymbol=null;c.referenced=0;d.fetchSymbol().then(function(a){if(c.isRejected())throw Error();a.id=c.symbol.id;c.graphics3DSymbol=f(a)}).then(function(){if(c.isRejected())throw Error();c.graphics3DSymbol.then(function(){c.isRejected()||c.resolve()},function(a){c.isRejected()||c.reject(a)})}).catch(function(a){c.isRejected()||c.reject(a)});return c}n(d,b);d.prototype.getSymbolLayerSize=function(b,d){d(null)};
d.prototype.createGraphics3DGraphic=function(b){return this.graphics3DSymbol.createGraphics3DGraphic(b,this)};Object.defineProperty(d.prototype,"complexity",{get:function(){return this.graphics3DSymbol?this.graphics3DSymbol.complexity:f.emptySymbolComplexity},enumerable:!0,configurable:!0});d.prototype.globalPropertyChanged=function(b,d){return this.graphics3DSymbol.globalPropertyChanged(b,d)};d.prototype.applyRendererDiff=function(b,d){return this.graphics3DSymbol.applyRendererDiff(b,d)};d.prototype.prepareSymbolPatch=
function(b){this.graphics3DSymbol&&this.graphics3DSymbol.prepareSymbolPatch(b)};d.prototype.updateGeometry=function(b,d){return this.graphics3DSymbol?this.graphics3DSymbol.updateGeometry(b,d):!1};d.prototype.getFastUpdateStatus=function(){return this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};d.prototype.setDrawOrder=function(b,d){this.graphics3DSymbol&&this.graphics3DSymbol.setDrawOrder(b,d)};d.prototype.destroy=function(){this.isFulfilled()||this.reject();
this.graphics3DSymbol&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0};Object.defineProperty(d.prototype,"destroyed",{get:function(){return void 0===this.graphics3DSymbol},enumerable:!0,configurable:!0});return d}(k.default)})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("require exports ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/scheduling ../../../../core/libs/gl-matrix-2/vec2f64 ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../core/libs/gl-matrix-2/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicSymbolUtils ../../webgl-engine/materials/HUDMaterial".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l){function g(c){return a.getGraphics3DSymbol(c.graphics3DGraphic.graphics3DSymbol).symbol.symbolLayers.getItemAt(0)}function e(a){var c=a.graphics3DGraphic.graphic.geometry.type;switch(c){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return"extrude"===g(a).type?v["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};case "point":return v["above-center"];
case "mesh":return v["above-center"];default:n.neverReached(c)}}function u(a,c){null==x&&(w.log(a,c),x=k.schedule(function(){x.remove();x=null}))}function t(a,c,b){b=b.graphics3DGraphic._graphics[0].getBoundingBoxObjectSpace(E);b=m.vec3f64.fromValues(b[3]-b[0],b[4]-b[1],b[5]-b[2]);a.centerOffset[0]=1.1*Math.sqrt(b[0]*b[0]+b[1]*b[1])/2*c.normalizedOffset[0];var d=a.translation[2],e=b[2]/2*c.normalizedOffset[1];a.translation[2]=e*(1.1-1);a.elevationOffset=d+e;b=h.vec3.length(b);a.centerOffset[2]=1.1*
b/2*c.normalizedOffset[2]}function r(c){var b=c.labelClass.labelPlacement,d=c.labelSymbol,f=c.graphics3DGraphic,g=a.getGraphics3DSymbol(f.graphics3DSymbol).symbol;c=v[b]||e(c);if("point-3d"===g.type&&g.supportsCallout()&&g.hasVisibleVerticalOffset()&&!f.isDraped())return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:y(g.verticalOffset),anchor:null,normalizedOffset:null};if(d&&d.hasVisibleVerticalOffset()&&("point-3d"!==g.type||!g.supportsCallout()||!g.verticalOffset||f.isDraped())){a:switch(c.placement){case "above-center":f=
!0;break a;default:f=!1}return f?{placement:"above-center",verticalOffset:y(d.verticalOffset),anchor:"bottom",normalizedOffset:[0,c.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(u("error","Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+b+" placement)"),null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function y(a){return{screenLength:a.screenLength,minWorldLength:a.minWorldLength,
maxWorldLength:a.maxWorldLength}}Object.defineProperty(b,"__esModule",{value:!0});var w=f.getLogger("esri.views.3d.layers.graphics.labelPlacement"),x=null;b.get=function(a){var b=r(a);if(!b)return null;var f;if(b.anchor)f=b;else{var h=a.labelClass.labelPlacement,k=v[h];f=k||e(a);h&&!k&&u("warn","the requested label placement '"+h+"' is not currently supported in SceneView");h=a.graphics3DGraphic.graphic.geometry.type;switch(h){case "polyline":case "polygon":case "extent":case "multipoint":a.labelClass.labelPlacement&&
(u("warn","the requested label placement '"+f.placement+"' is currently unsupported for '"+h+"' geometries in SceneView"),f=e(a));break;case "point":case "mesh":break;default:n.neverReached(h)}}h=!!b.hasLabelVerticalOffset;b={anchor:f.anchor,verticalOffset:b.verticalOffset,screenOffset:d.vec2f64.create(),centerOffset:p.vec4f64.fromValues(0,0,0,-1),centerOffsetUnits:"world",translation:m.vec3f64.create(),elevationOffset:0,hasLabelVerticalOffset:h};switch(a.graphics3DGraphic.graphic.geometry.type){case "point":h=
a.graphics3DGraphic;k=g(a);h.getCenterObjectSpace(b.translation);switch(k.type){case "icon":case "text":k=a.graphics3DGraphic;h=k._graphics[0].getScreenSize();k.isDraped()?b.hasLabelVerticalOffset||"center"===b.anchor||(v[a.labelClass.labelPlacement]&&u("warn","the requested placement '"+f.placement+"' is currently unsupported for draped graphics"),b.anchor="center"):(k=void 0,void 0===k&&(k=C),a=a.graphics3DGraphic._graphics[0].stageObject.getGeometryRecords()[0].material,a instanceof l?(a=a.getParameters().anchorPos,
k[0]=2*(a[0]-.5),k[1]=2*(a[1]-.5)):(k[0]=0,k[1]=0),a=k,B[0]=h[0]/2*(f.normalizedOffset[0]-a[0]),B[1]=h[1]/2*(f.normalizedOffset[1]-a[1]),b.screenOffset[0]=B[0],b.hasLabelVerticalOffset?(b.centerOffset[1]=B[1],b.centerOffsetUnits="screen"):b.screenOffset[1]=B[1]);break;case "object":t(b,f,a)}break;case "polygon":switch(g(a).type){case "extrude":a.graphics3DGraphic._graphics[0].getBoundingBoxObjectSpace(E),c.center(E,b.translation),b.translation[2]=c.height(E)/2,t(b,f,a)}break;case "mesh":t(b,f,a)}return b};
var v={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},
"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},z={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],
"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};q=function(a){var c=v[a];z[a].forEach(function(a){v[a]=c})};for(var A in z)q(A);Object.freeze&&(Object.freeze(v),Object.keys(v).forEach(function(a){Object.freeze(v[a]);Object.freeze(v[a].normalizedOffset)}));var B=[0,0],C=[0,0],E=c.create()})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["require",
"exports","./ModelContentType"],function(q,b,n){return function(){function b(b){this.materials={};this.stage=b}b.prototype.getMaterial=function(b){return this.materials[b]};b.prototype.addMaterial=function(b,d){this.materials[b]=d;this.stage.add(n.MATERIAL,d)};b.prototype.dispose=function(){for(var b in this.materials)this.stage.remove(n.MATERIAL,this.materials[b].id);this.materials={}};return b}()})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("require exports ../../../../core/iteratorUtils ../../../../core/mathUtils ./ModelContentType ./Texture ../../../webgl/Texture".split(" "),
function(q,b,n,f,k,d,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function a(a,c){this.dirty=!1;this.elementsToAdd=new Map;this.elementsToRemove=new Map;this.elementsToRender=new Map;this.elements=new Map;this.stageObjects=new Map;this.id=d.idGen.gen(a);this.stage=c._stage;this.scheduler=c.resourceController.scheduler;this.canvas=this.create2DCanvas();this.ctx=this.canvas.getContext("2d");this.stage.add(k.TEXTURE,this);a=this.computeAtlasResolution(c.width,c.height);this.createAtlasRegion(a);
this.update2DCanvasSize()}a.prototype.setUnloadFunc=function(a){this.unloadFunc=a};a.prototype.unload=function(){null!=this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=null)};a.prototype.deferredLoading=function(){return!1};a.prototype.getWidth=function(){return this.atlas.size.width};a.prototype.getHeight=function(){return this.atlas.size.height};a.prototype.initializeThroughRender=function(a,c){var b=this;c.wrapMode=33071;c.samplingMode=9987;c.flipped=!0;c.preMultiplyAlpha=!0;c.hasMipmap=
!0;this.glTexture=new h(a,c,this.canvas);this.frameWorker=this.scheduler.registerTask(12,function(a){return b.run(b.makeRunContext(a))},function(){return b.dirty});return this.glTexture};a.prototype.dispose=function(){this.elementsToRender=this.elementsToRemove=this.elementsToAdd=this.elements=null;this.frameWorker&&(this.frameWorker.remove(),this.frameWorker=null);this.glTexture&&(this.glTexture=null,this.stage.remove(k.TEXTURE,this.id))};a.prototype.create2DCanvas=function(){var a=document.createElement("canvas");
a.setAttribute("id","canvas2d");a.setAttribute("style","display:none");a.setAttribute("width",(512).toString());a.setAttribute("height",(512).toString());return a};a.prototype.update2DCanvasSize=function(){this.canvas.setAttribute("width",this.atlas.size.width.toString());this.canvas.setAttribute("height",this.atlas.size.height.toString())};a.prototype.createAtlasRegion=function(a){void 0===a&&(a=512);this.atlas={size:{width:a,height:a},cursor:{x:0,y:0},lineHeight:0}};a.prototype.computeAtlasResolution=
function(a,c){a=Math.max(a,c);a=f.nextHighestPowerOfTwo(a+256);return a=Math.min(a,4096)};a.prototype.resizeAtlas=function(a,c){c=c||a;var b=this.atlas;b.size.width=a;b.size.height=c;this.glTexture&&this.glTexture.resize(a,c);this.update2DCanvasSize()};a.prototype.resetAtlasCursor=function(){var a=this.atlas;a.cursor.x=m;a.cursor.y=m+p;a.lineHeight=0};a.prototype.getAtlasUsage=function(){var a=this.atlas;return(a.cursor.x+a.cursor.y*a.size.width)/(a.size.width*a.size.height)};a.prototype.getExpectedAtlasUsage=
function(){var a=this.elementsToRemove.size,c=this.elementsToAdd.size,b=this.elements.size;return this.getAtlasUsage()/b*(b+c-a)};a.prototype.addAtlasElement=function(a,c,b,d){var e=this.atlas,f=a.textRenderer,g=f.renderedWidth,h=f.renderedHeight,l=f.displayWidth,f=f.displayHeight;a.placement.offset.x=e.cursor.x;a.placement.offset.y=e.cursor.y;a.placement.size.width=g;a.placement.size.height=h;a.placement.size.displayWidth=l;a.placement.size.displayHeight=f;a.placement.uvMinMax=[a.placement.offset.x/
e.size.width,1-(a.placement.offset.y+h)/e.size.height,(a.placement.offset.x+g)/e.size.width,1-a.placement.offset.y/e.size.height];e.cursor.x+=b;e.lineHeight=Math.max(e.lineHeight,d);this.elements.set(c,a)};a.prototype.removeAtlasElement=function(a){if(a&&this.elements.has(a.textId)){var c=a.placement.offset,b=a.placement.size;this.ctx.clearRect(c.x,c.y,b.width,b.height);this.elements.delete(a.textId)}};a.prototype.ensureStageObjects=function(a){var c=this.stageObjects.get(a);c||(c=new Set,this.stageObjects.set(a,
c));return c};a.prototype.addStageObject=function(a,c){this.ensureStageObjects(a).add(c)};a.prototype.removeStageObject=function(a,c){(a=this.stageObjects.get(a))&&a.delete(c)&&(c.geometries[0].data.vertexAttributes.size.data=new Float32Array([0,0]),c.geometryVertexAttrsUpdated(0))};a.prototype.processAdditionRequest=function(a,c){var b=this.atlas,d=a.textId,f=a.textRenderer.renderedWidth+m,g=a.textRenderer.renderedHeight+m+p;c=c.repackingEnabled;if(b.cursor.x+f<b.size.width&&b.cursor.y+g<b.size.height)this.addAtlasElement(a,
d,f,g),this.elementsToRender.set(d,a),this.elementsToAdd.delete(d);else if(b.cursor.y+g+b.lineHeight<b.size.height)b.cursor.x=m,b.cursor.y+=b.lineHeight,b.lineHeight=0,this.addAtlasElement(a,d,f,g),this.elementsToRender.set(d,a),this.elementsToAdd.delete(d);else{a=this.getExpectedAtlasUsage();(d=.85<a&&4096>b.size.width)&&this.resizeAtlas(2*b.size.width,2*b.size.height);if(!c||!d&&.95<a&&4096===b.size.width)return this.processRemovals(),0;this.repack();return 1}return 0};a.prototype.processRemovals=
function(){var a=this;this.elementsToRemove.forEach(function(c,b){var d=a.stageObjects.get(b);d&&0!==d.size||a.removeAtlasElement(c);d&&0===d.size&&a.stageObjects.delete(b)});this.elementsToRemove.clear()};a.prototype.repack=function(){var a=this;this.processRemovals();this.elements.forEach(function(c,b){c.rendered=!1;a.elementsToAdd.set(b,c)});this.elements.clear();this.resetAtlasCursor();this.elementsToRender.clear()};a.prototype.processRenderingRequest=function(a){this.ctx.clearRect(a.placement.offset.x,
a.placement.offset.y,a.placement.size.width,a.placement.size.height);a.textRenderer.render(this.ctx,a.placement.offset.x,a.placement.offset.y);var c=this.stageObjects.get(a.textId);c&&c.forEach(function(c){c.geometries[0].data.vertexAttributes.uv0.data=new Float32Array(a.placement.uvMinMax);c.geometries[0].data.vertexAttributes.size.data=new Float32Array([a.placement.size.displayWidth,a.placement.size.displayHeight]);c.geometryVertexAttrsUpdated(0)});a.rendered=!0};a.prototype.run=function(c){var b=
this;if(this.dirty&&this.glTexture){var d=c.budget,f=!1;n.everyMap(this.elementsToAdd,function(a,d){return(a=b.elements.get(d))&&a.rendered?((a=b.stageObjects.get(d))&&a.forEach(function(a){var c=a.geometries[0].data.vertexAttributes,e=b.elements.get(d);c.uv0.data=new Float32Array(e.placement.uvMinMax);c.size.data=new Float32Array([e.placement.size.displayWidth,e.placement.size.displayHeight]);a.geometryVertexAttrsUpdated(0)}),b.elementsToAdd.delete(d),!0):1===b.processAdditionRequest(b.elementsToAdd.get(d),
c)?(f=!0,!1):!0});if(f)c.budget=null,c.repackingEnabled=!1,this.run(c);else{var h=!1;n.everyMap(this.elementsToRender,function(a,c){b.processRenderingRequest(a);b.elementsToRender.delete(c);h=!0;return d&&(d.madeProgress(),d.done)?!1:!0});h&&this.glTexture.setData(this.canvas);this.dirty=0<this.elementsToRender.size;!this.dirty&&a.test.orderedRepackingEnabled&&this.repackOrdered()}}};a.prototype.makeRunContext=function(a){void 0===a&&(a=null);c.budget=a;c.repackingEnabled=!0;return c};a.prototype.addTextTexture=
function(a,c){var b=a.key;this.elementsToAdd.has(b)||this.elementsToAdd.set(b,{textId:b,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:a,rendered:!1});this.addStageObject(b,c);this.elementsToRemove.delete(b);this.setDirty()};a.prototype.removeTextTexture=function(a,c){a=a.key;this.elementsToRemove.set(a,this.elements.get(a));this.removeStageObject(a,c)};Object.defineProperty(a.prototype,"textureId",{get:function(){return this.id},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"isDirty",{get:function(){return this.dirty},enumerable:!0,configurable:!0});a.prototype.setDirty=function(){this.dirty=!0};Object.defineProperty(a.prototype,"test",{get:function(){return{elements:this.elements,stageObjects:this.stageObjects,elementsToRemove:this.elementsToRemove,atlas:this.atlas,resizeAtlas:this.resizeAtlas.bind(this)}},enumerable:!0,configurable:!0});a.prototype.repackOrdered=function(){if(0!==this.elements.size){var a=[];this.elements.forEach(function(c,
b){return a.push({element:c,key:b})});for(var c=!0,b=0;b<a.length-1;b++)if(0<a[b].key.localeCompare(a[b+1].key)){c=!1;break}if(!c){a.sort(function(a,c){return a.key.localeCompare(c.key)});this.elements.clear();for(c=0;c<a.length;c++)b=a[c],this.elements.set(b.key,b.element);this.repack();this.setDirty()}}};a.test={orderedRepackingEnabled:!1};return a}();b.TextTextureAtlas=q;var m=2,p=2,c={budget:null,repackingEnabled:!0};b.default=q})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/throttle ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/debugFlags ../../support/projectionUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t){Object.defineProperty(b,"__esModule",{value:!0});var r=m.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");q=function(b){function k(a){a=b.call(this,a)||this;a.tiles=new d;a.tileSize=512;a.disableThrottling=!1;a.idToTile=new Map;a.handles=new h;a.clients=new Set;a._dirty=!1;return a}n(k,b);Object.defineProperty(k.prototype,"tilingScheme",{get:function(){var a=this.tilingSchemeOwner.tilingScheme;return a?a.clone():null},enumerable:!0,configurable:!0});
Object.defineProperty(k.prototype,"filterExtent",{set:function(a){if(a&&!a.spatialReference.equals(this.viewState.spatialReference))r.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");else{var c=this._get("filterExtent");c===a||c&&a&&c.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this.setDirty())}},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"filterExtentRect",{get:function(){if(!this.filterExtent||!this.tilingScheme)return null;
var a=l.create();t.extentToBoundingRect(this.filterExtent,a,this.tilingScheme.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"rootTileIds",{get:function(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"suspended",{set:function(a){a!==this._get("suspended")&&(this._set("suspended",a),a||this.setDirty())},enumerable:!0,configurable:!0});
Object.defineProperty(k.prototype,"updating",{get:function(){return this.throttledUpdate.hasPendingUpdates()||this._dirty},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"changeId",{get:function(){var a=this._get("changeId")||0;return!this.hasClients||this.suspended?a:a+1},enumerable:!0,configurable:!0});k.prototype.initialize=function(){var a=this;this.throttledUpdate=p.throttle(this.setDirty,function(){return a.notifyChange("updating")},u.TESTS_LIMIT_FEATURE_TILE_TREE_THROTTLING?
100:1E3,this);var b=this.disableThrottling?function(){return a.setDirty}:this.throttledUpdate;this.handles.add(this.watch(["tilingScheme","tileSize"],function(){return a.tileMeasurements=null},!0));this.handles.add(c.init(this,"changeId",b));this.scheduler&&(this._frameWorker=this.scheduler.registerTask(2,function(){return a.update()},function(){return a.needsUpdate()}))};k.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this.handles&&(this.handles.destroy(),
this.handles=null)};k.prototype.addClient=function(){var a=this,c=y++;this.clients.add(c);1===this.clients.size&&this.setDirty();return{remove:function(){return a.removeClient(c)}}};k.prototype.removeClient=function(a){this.clients.delete(a);this.hasClients||this.setDirty()};Object.defineProperty(k.prototype,"hasClients",{get:function(){return 0<this.clients.size},enumerable:!0,configurable:!0});k.prototype.setDirty=function(){this.suspended?this.notifyChange("updating"):(this._dirty=!0,this._frameWorker||
this.update())};k.prototype.needsUpdate=function(){return this._dirty&&!this.suspended};k.prototype.update=function(){this._dirty=!1;if(this.tilingScheme&&this.hasClients){this.tileMeasurements||(this.tileMeasurements=new e.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,maxVerticalScreenSize:x}));var a=this.cameraOnSurface.location;this.tileMeasurements.begin(this.viewState.camera,this.focus?this.focus.locationOnSurface:
a,a.z);this.updateTiles(this.subdivideTilesForView(this.getRootTiles()));this.tileMeasurements.end()}else this.tiles.removeAll(),this.idToTile.clear();this.notifyChange("updating")};k.prototype.getRootTiles=function(){var a=this;return this.rootTileIds.map(function(c){return new g.FeatureTileDescriptor3D(c[0],c[1],c[2],a.tilingScheme)})};k.prototype.purgeHorizonTiles=function(a){a.sort(function(a,c){a=a.measures.screen.rect;c=c.measures.screen.rect;return a[1]+a[3]-(c[1]+c[3])});l.empty(w);for(var c=
0;c<a.length;c++)if(l.expand(w,a[c].measures.screen.rect),l.height(w)>x)return a.slice(c);return[]};k.prototype.subdivideTilesForView=function(a){a=a.slice();for(var c=[];0<a.length;){var b=a.pop();if(!this.filterExtentRect||l.intersects(this.filterExtentRect,b.extent))this.tileMeasurements.updateTile(b),0!==b.measures.visibility&&(b.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(b.lij[0]+1),a.push.apply(a,b.getChildren())):c.push(b))}return this.purgeHorizonTiles(c)};k.prototype.updateTiles=
function(a){for(var c=this,b=0,d=this.tiles.items;b<d.length;b++)d[b].used=!1;a=a.filter(function(a){var b=c.idToTile.get(a.id);b?(b.copyMeasurementsFrom(a),b.used=!0):c.idToTile.set(a.id,a);return!b});b=this.tiles.items.filter(function(a){return a.used?!1:(c.idToTile.delete(a.id),!0)});this.tiles.removeMany(b);this.tiles.addMany(a);this.sortTiles()};k.prototype.sortTiles=function(){this.tiles.sort(function(a,c){return a.measures.visibility!==c.measures.visibility?2===a.measures.visibility?-1:1:a.measures.distance-
c.measures.distance});this.tiles.forEach(function(a,c){return a.loadPriority=c})};f([a.property({constructOnly:!0})],k.prototype,"scheduler",void 0);f([a.property({constructOnly:!0})],k.prototype,"renderCoordsHelper",void 0);f([a.property({constructOnly:!0})],k.prototype,"tilingSchemeOwner",void 0);f([a.property({constructOnly:!0})],k.prototype,"cameraOnSurface",void 0);f([a.property({constructOnly:!0})],k.prototype,"focus",void 0);f([a.property({constructOnly:!0})],k.prototype,"viewState",void 0);
f([a.property()],k.prototype,"tiles",void 0);f([a.property()],k.prototype,"tileSize",void 0);f([a.property({readOnly:!0,dependsOn:["tilingSchemeOwner.tilingScheme"]})],k.prototype,"tilingScheme",null);f([a.property()],k.prototype,"filterExtent",null);f([a.property({readOnly:!0,dependsOn:["filterExtent","tilingScheme"]})],k.prototype,"filterExtentRect",null);f([a.property({readOnly:!0,dependsOn:["filterExtentRect"]})],k.prototype,"rootTileIds",null);f([a.property({value:!1})],k.prototype,"suspended",
null);f([a.property()],k.prototype,"updating",null);f([a.property({readOnly:!0,dependsOn:["tileSize","cameraOnSurface.location","tilingScheme","viewState.camera","focus.locationOnSurface"]})],k.prototype,"changeId",null);f([a.property({constructOnly:!0})],k.prototype,"disableThrottling",void 0);return k=f([a.subclass()],k)}(a.declared(k));b.FeatureTileTree3D=q;var y=0,w=l.create(),x=10;b.default=q})},"esri/core/throttle":function(){define(["require","exports"],function(q,b){function n(b,k,d,h){var f=
null,p=1E3;"number"===typeof k?(p=k,h=d):(f=k,p=d);var c=0,a,l=function(){c=0;b.apply(h,a)};k=function(){for(var b=[],d=0;d<arguments.length;d++)b[d]=arguments[d];f&&f.apply(h,b);a=b;p?c||(c=setTimeout(l,p)):l()};k.remove=function(){c&&(clearTimeout(c),c=0)};k.forceUpdate=function(){c&&(clearTimeout(c),l())};k.hasPendingUpdates=function(){return!!c};return k}Object.defineProperty(b,"__esModule",{value:!0});b.throttle=n;b.default=n})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["require",
"exports","../../../../geometry/support/aaBoundingRect"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,d,f,m){void 0===m&&(m=null);this.lij=[0,0,0];this.extent=n.create();this.loadPriority=this.resolution=0;this.measures={visibility:2,screen:{rect:n.create()},distance:0,shouldSplit:!1};this.used=!1;m&&this.acquire(b,d,f,m)}b.prototype.acquire=function(f,d,h,m){this.tilingScheme=m;this.id=b.id(f,d,h);this.lij[0]=f;this.lij[1]=d;this.lij[2]=h;m.getExtent(f,
d,h,this.extent);this.resolution=m.resolutionAtLevel(f)};b.prototype.release=function(){this.tilingScheme=null};b.prototype.getChildren=function(f){var d=this.lij[0]+1,h=2*this.lij[1],k=2*this.lij[2];if(!f)return[new b(d,h,k,this.tilingScheme),new b(d,h+1,k,this.tilingScheme),new b(d,h,k+1,this.tilingScheme),new b(d,h+1,k+1,this.tilingScheme)];f[0].acquire(d,h,k,this.tilingScheme);f[1].acquire(d,h+1,k,this.tilingScheme);f[2].acquire(d,h,k+1,this.tilingScheme);f[3].acquire(d,h+1,k+1,this.tilingScheme);
return f};b.prototype.copyMeasurementsFrom=function(b){this.measures.visibility=b.measures.visibility;this.measures.shouldSplit=b.measures.shouldSplit;this.measures.distance=b.measures.distance;n.set(b.measures.screen.rect,this.measures.screen.rect)};b.id=function(b,d,f){return b+"/"+d+"/"+f};return b}();b.FeatureTileDescriptor3D=q;b.default=q})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("require exports ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ./FeatureTileVisibility3D ../../support/geometryUtils".split(" "),
function(q,b,n,f,k,d,h,m){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a){this.pointOfInterestInMap=[0,0];this.screenRect=d.create();this.tileSize=a.tileSize;this.maxVerticalScreenSize=a.maxVerticalScreenSize;this.renderCoordsHelper=a.renderCoordsHelper;this.tilingScheme=a.tilingScheme;this.visibility=new h.FeatureTileVisibility3D({renderCoordsHelper:a.renderCoordsHelper})}b.prototype.begin=function(a,c,b){this.camera=a;this.z=b;this.pointOfInterestInMap[0]=c.x;this.pointOfInterestInMap[1]=
c.y;d.fromValues(0,0,a.fullWidth,a.fullHeight,this.screenRect);this.visibility.begin(a,b)};b.prototype.end=function(){this.visibility.end()};b.prototype.updateTile=function(a){a.measures.visibility=this.visibility.calculate(a);0!==a.measures.visibility&&this.updateScreenMeasure(a);this.updateDistanceMeasure(a)};b.prototype.updateDistanceMeasure=function(a){a.measures.distance=d.distance(a.extent,this.pointOfInterestInMap)};b.prototype.updateScreenMeasure=function(c){var b=a,e=1<<b,f=c.measures.screen.rect;
d.empty(f);for(var g=0,h=c.lij[0]+b,l=c.lij[1]<<b,b=c.lij[2]<<b,k=this.tileSizeWithBias(c),k=k*k,m=!1,p=0;p<e;p++){for(var r=0;r<e&&!(m=this.computeScreenArea(c,h,l+p,b+r,f),g+=m.area,m=g>k&&d.height(f)>this.maxVerticalScreenSize);r++);if(m)break}c.measures.shouldSplit=g>k};b.prototype.tileSizeWithBias=function(a){return 1===a.measures.visibility?this.tileSize*l:this.tileSize};b.prototype.computeScreenArea=function(a,b,e,f,h){var l=g.points;this.projectToScreen(b,e,f,1===a.measures.visibility,l);
d.empty(p);for(a=0;4>a;a++)d.expandPointInPlace(p,l[a]);d.expand(h,p);d.intersection(p,this.screenRect,c);g.screenOverlap=d.area(c)/d.area(p);g.area=m.triangle.areaPoints2d(l[0],l[1],l[2])+m.triangle.areaPoints2d(l[0],l[2],l[3]);return g};b.prototype.projectToScreen=function(a,c,b,d,f){this.tilingScheme.ensureMaxLod(a);this.tilingScheme.getExtent(a,c,b,e);this.toRenderCoords(e,0,3,t[0]);this.toRenderCoords(e,2,3,t[1]);this.toRenderCoords(e,2,1,t[2]);this.toRenderCoords(e,0,1,t[3]);d&&(this.projectToPlane(t,
this.camera.frustum.planes[4]),this.projectToPlane(t,this.camera.frustum.planes[3]),this.projectToPlane(t,this.camera.frustum.planes[2]));for(a=0;4>a;a++)this.camera.projectPoint(t[a],y),this.camera.renderToScreen(y,f[a])};b.prototype.projectToPlane=function(a,c){for(var b=0;4>b;b++)r[b]=m.plane.signedDistance(c,a[b]);b=Math.max(r[0],r[1],r[2],r[3]);if(0<b)for(c=f.vec3.scale(u,c,-b),b=0;4>b;b++)f.vec3.add(a[b],a[b],c)};b.prototype.toRenderCoords=function(a,c,b,d){u[0]=a[c];u[1]=a[b];u[2]=this.z;this.renderCoordsHelper.toRenderCoords(u,
this.tilingScheme.spatialReference,d);return d};return b}();b.FeatureTileMeasurements3D=q;var p=d.create(),c=d.create(),a=2,l=5,g={points:[n.createScreenPointArray(),n.createScreenPointArray(),n.createScreenPointArray(),n.createScreenPointArray()],area:0,screenOverlap:0},e=d.create(),u=k.vec3f64.create(),t=[k.vec3f64.create(),k.vec3f64.create(),k.vec3f64.create(),k.vec3f64.create()],r=[0,0,0,0],y=n.createRenderScreenPointArray3();b.default=q})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("require exports ../../../../core/ObjectPool ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection ../../support/geometryUtils ../../support/mathUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a){this.surfaceElevation=0;this.cache=new Map;a=a.renderCoordsHelper;this.frustum=new h.Frustum({renderCoordsHelper:a});this.extendedFrustum=new h.Frustum({renderCoordsHelper:a});this.intersector=new m.FrustumExtentIntersection({renderCoordsHelper:a});this.renderCoordsHelper=a}b.prototype.begin=function(a,c){this.surfaceElevation=c;this.aboveGround=this.renderCoordsHelper.getAltitude(a.eye)>c;this.frustum.update(a);
this.shortenFrustumFarPlane(this.frustum);this.updateExtendedFrustum(a,c)};b.prototype.end=function(){this.cache.clear()};b.prototype.calculate=function(c){if(this.allTilesInvisible)return 0;var b="global"===this.renderCoordsHelper.type&&c.lij[0]>=a&&c.lij[0]<l,d=this.getOrCalculateSingleTileVisibility(c,!b);return 0!==d&&b?this.calculateAggregatedChildrenVisibility(c):d};b.prototype.shortenFrustumFarPlane=function(a){for(var c=a.mutablePoints,b=0,d=h.Frustum.nearFarLineIndices;b<d.length;b++){var g=
d[b],l=g[1],g=c[g[0]];f.vec3.subtract(u,c[l],g);f.vec3.scale(u,u,e);f.vec3.add(c[l],g,u)}a.updatePoints(c)};b.prototype.calculateAggregatedChildrenVisibility=function(a){var c=0,b=this.cache.get(a.id);if(null!=b)return b;b=t.acquire();a.getChildren(b);for(var d=0;d<b.length;d++){var e=this.calculate(b[d]);if(0!==e&&(c=e,2===e))break}t.release(b);this.cache.set(a.id,c);return c};b.prototype.getOrCalculateSingleTileVisibility=function(a,c){var b=this.cache.get(a.id);if(null!=b)return b;b=this.calculateSingleTileVisibility(a);
c&&this.cache.set(a.id,b);return b};b.prototype.calculateSingleTileVisibility=function(a){if(!this.aboveGround&&"global"===this.renderCoordsHelper.type&&a.lij[0]<g){if(0===this.calculateSingleTileVisibilitySided(a,!1))return this.calculateSingleTileVisibilitySided(a,!0)}else return this.calculateSingleTileVisibilitySided(a,this.aboveGround)};b.prototype.calculateSingleTileVisibilitySided=function(a,c){this.intersector.update(a.extent,a.tilingScheme.spatialReference,this.surfaceElevation,c);return this.intersector.isVisibleInFrustum(this.extendedFrustum)?
this.intersector.isVisibleInFrustum(this.frustum,!0)?2:1:0};b.prototype.updateExtendedFrustum=function(a,b){var d=this.renderCoordsHelper;this.extendedFrustum.update(a);this.shortenFrustumFarPlane(this.extendedFrustum);var e=this.renderCoordsHelper.worldUpAtPosition(a.eye,u);this.aboveGround||f.vec3.negate(e,e);e=c.acos(-f.vec3.dot(e,a.viewForward));this.allTilesInvisible=e>(Math.PI+a.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=e>a.fovY/2)){a=this.extendedFrustumParameters(b);b=this.extendedFrustum.mutablePoints;
for(e=0;4>e;e++){var g=a.pointIndices[e],h=b[g],l=d.getAltitude(h);if(a.needsAltitudeAdjustment(l)){this.renderCoordsHelper.worldUpAtPosition(h,u);switch(g){case 4:case 7:case 0:case 3:p.plane.projectVector(this.extendedFrustum.planes[0],u,u);break;case 5:case 6:case 1:case 2:p.plane.projectVector(this.extendedFrustum.planes[1],u,u)}f.vec3.scale(u,u,a.direction);this.renderCoordsHelper.intersectInfiniteManifold(p.ray.wrap(h,u),a.zWithMargin,h)}}this.extendedFrustum.updatePoints(b);0>f.vec3.dot(this.extendedFrustum.planes[4],
this.frustum.planes[4])&&(d=this.extendedFrustum.mutablePoints,this.aboveGround?(a=[d[1],d[0]],d[0]=a[0],d[1]=a[1]):(a=[d[2],d[3]],d[3]=a[0],d[2]=a[1]),this.extendedFrustum.updatePoints(d))}};b.prototype.extendedFrustumParameters=function(a){return this.aboveGround?this.extendedFrustumParametersAboveSurface(a,1):this.extendedFrustumParametersBelowSurface(a,1)};b.prototype.extendedFrustumParametersAboveSurface=function(a,c){var b=a-c;return{zWithMargin:b,pointIndices:h.Frustum.planePointIndices.bottom,
direction:-1,needsAltitudeAdjustment:function(a){return a>b}}};b.prototype.extendedFrustumParametersBelowSurface=function(a,c){var b=a+c;return{zWithMargin:b,pointIndices:h.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment:function(a){return a<b}}};return b}();b.FeatureTileVisibility3D=q;var a=2,l=6,g=12,e=.95,u=k.vec3f64.create(),t=new n(Array,function(a){4!==a.length&&(a[0]=new d.FeatureTileDescriptor3D,a[1]=new d.FeatureTileDescriptor3D,a[2]=new d.FeatureTileDescriptor3D,a[3]=new d.FeatureTileDescriptor3D)},
function(a){a[0].release();a[1].release();a[2].release();a[3].release()});b.default=q})},"esri/views/3d/state/Frustum":function(){define("require exports ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/mathUtils ../support/geometryUtils/frustum".split(" "),function(q,b,n,f,k,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this.frustum=d.create();this.lines=Array(12);this.origin=f.vec3f64.create();this.direction=f.vec3f64.create();
this._altitude=null;this.renderCoordsHelper=b?b.renderCoordsHelper:null;for(b=0;12>b;b++)this.lines[b]={origin:null,direction:f.vec3f64.create(),endpoint:null}}Object.defineProperty(b.prototype,"planes",{get:function(){return this.frustum.planes},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"points",{get:function(){return this.frustum.points},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"mutablePoints",{get:function(){return this.frustum.points},enumerable:!0,
configurable:!0});b.prototype.update=function(b){d.fromMatrix(b.viewMatrix,b.projectionMatrix,this.frustum);n.vec3.copy(this.origin,b.eye);n.vec3.copy(this.direction,b.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this.origin);this.updateLines()};b.prototype.updatePoints=function(b){for(var f=0;f<this.frustum.points.length;f++)n.vec3.copy(this.frustum.points[f],b[f]);d.recomputePlanes(this.frustum);this.updateLines()};Object.defineProperty(b.prototype,"altitude",{get:function(){return this._altitude},
enumerable:!0,configurable:!0});b.prototype.intersectsSphere=function(b){return d.intersectsSphere(this.frustum.planes,b)};b.prototype.intersectsRay=function(b){return d.intersectsRay(this.frustum.planes,b)};b.prototype.intersectsLineSegment=function(b,f){return d.intersectsLineSegment(this.frustum.planes,b,f)};b.prototype.intersectsPoint=function(b){return d.intersectsPoint(this.frustum.planes,b)};b.prototype.updateLines=function(){for(var b=this.frustum.points,d=0;4>d;d++){var c=d,a=d+4;this.updateLine(this.lines[d],
b[c],b[a]);this.updateLine(this.lines[d+4],b[c],3===d?b[0]:b[c+1]);this.updateLine(this.lines[d+8],b[a],3===d?b[4]:b[a+1])}};b.prototype.updateLine=function(b,d,c){b.origin=d;b.endpoint=c;k.directionFromTo(b.direction,d,c)};b.planePointIndices=d.planePointIndices;b.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];return b}();b.Frustum=q;b.default=q})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("require exports ../../../core/compilerUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./earthUtils ./geometryUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e){Object.defineProperty(b,"__esModule",{value:!0});q=.5*Math.PI;var u=q/Math.PI*180,t=q*c.earthRadius,r=.9*c.earthRadius;c=function(){function c(c){this.renderCoordsHelper=c.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:h.vec3f64.create(),direction:h.vec3f64.create()};for(c=0;4>c;c++)this.extent[c]={origin:h.vec3f64.create(),direction:h.vec3f64.create(),cap:{next:null,direction:h.vec3f64.create()}},this.planes[c]=
a.plane.create();this.planes[4]=a.plane.create();this.planes[5]=a.plane.create();this.planesWithoutFar=this.planes.slice(0,5)}c.prototype.update=function(c,b,e,f){void 0===f&&(f=!0);var h=this.extent;this.toRenderBoundingExtent(c,b,e);d.vec3.add(this.center.origin,h[0].origin,h[2].origin);d.vec3.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);f||d.vec3.scale(this.center.direction,this.center.direction,-1);for(e=0;4>
e;e++){var l=h[e];this.renderCoordsHelper.worldUpAtPosition(l.origin,l.direction);var k=h[3===e?0:e+1];l.cap.next=k.origin;g.directionFromTo(l.cap.direction,l.origin,k.origin);a.plane.fromVectorsAndPoint(l.direction,l.cap.direction,l.origin,this.planes[e]);f||d.vec3.scale(l.direction,l.direction,-1)}a.plane.fromVectorsAndPoint(h[0].cap.direction,h[1].cap.direction,h[0].origin,this.planes[4]);f?a.plane.negate(this.planes[4],this.planes[5]):(a.plane.copy(this.planes[4],this.planes[5]),a.plane.negate(this.planes[4],
this.planes[4]));this.maxSpan=Math.max(Math.abs(c[0]-c[2]),Math.abs(c[1]-c[3]));this.maxSpanSpatialReference=b};c.prototype.isVisibleInFrustum=function(c,b){void 0===b&&(b=!1);if(null==c)return!1;if("global"===this.renderCoordsHelper.type){if(this.maxSpan>(this.maxSpanSpatialReference.isWGS84?u:t))return!0;if(c.altitude>=r)return this.isVisibleInFrustumGlobal(c)}if(0===this.maxSpan){var d=this.extent[0];return!b&&c.intersectsRay(a.ray.wrap(d.origin,d.direction))?!0:!1}for(var e=0;e<this.extent.length;e++)if(d=
this.extent[e],!b&&c.intersectsRay(a.ray.wrap(d.origin,d.direction))||c.intersectsLineSegment(a.lineSegment.fromPoints(d.origin,d.cap.next,A),d.cap.direction))return!0;b=b?this.planes:this.planesWithoutFar;for(e=0;e<c.lines.length;e++)if(d=c.lines[e],l.frustumLineSegment(b,d.origin,d.endpoint,d.direction))return!0;return!1};c.prototype.toRenderBoundingExtentGlobal=function(a,c,b){p.center(a,w);w[2]=b;e.computeLinearTransformation(c,w,x,this.renderCoordsHelper.spatialReference);f.mat4.invert(v,x);
m.empty(z);for(var h=0,l=y;h<l.length;h++)for(var k=l[h],r=k.x0,n=k.x1,t=k.y0,k=k.y1,u=0;5>u;u++){var q=u/4;w[0]=g.lerp(a[r],a[n],q);w[1]=g.lerp(a[t],a[k],q);w[2]=b;e.vectorToVector(w,c,w,this.renderCoordsHelper.spatialReference);d.vec3.transformMat4(w,w,v);m.expandPointInPlace(z,w)}d.vec3.set(this.extent[0].origin,z[0],z[1],z[2]);d.vec3.set(this.extent[1].origin,z[3],z[1],z[2]);d.vec3.set(this.extent[2].origin,z[3],z[4],z[2]);d.vec3.set(this.extent[3].origin,z[0],z[4],z[2]);for(u=0;4>u;++u)d.vec3.transformMat4(this.extent[u].origin,
this.extent[u].origin,x)};c.prototype.toRenderBoundingExtentLocal=function(a,c,b){d.vec3.set(this.extent[0].origin,a[0],a[1],b);d.vec3.set(this.extent[1].origin,a[2],a[1],b);d.vec3.set(this.extent[2].origin,a[2],a[3],b);d.vec3.set(this.extent[3].origin,a[0],a[3],b)};c.prototype.toRenderBoundingExtent=function(a,c,b){switch(this.renderCoordsHelper.type){case "global":this.toRenderBoundingExtentGlobal(a,c,b);break;case "local":this.toRenderBoundingExtentLocal(a,c,b);break;default:n.neverReached(this.renderCoordsHelper.type)}};
c.prototype.isVisibleInFrustumGlobal=function(a){if(0>d.vec3.dot(this.center.direction,a.direction))return!0;for(var c=0;4>c;c++)if(0>d.vec3.dot(this.extent[c].direction,a.direction))return!0;return!1};return c}();b.FrustumExtentIntersection=c;var y=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],w=h.vec3f64.create(),x=k.mat4f64.create(),v=k.mat4f64.create(),z=m.create(),A=a.lineSegment.create();b.default=c})},"esri/views/3d/layers/support/FeatureTileTree3DDebugger":function(){define("require exports ../../../../Graphic ../../../../core/Handles ../../../../core/watchUtils ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../support/mathUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c){Object.defineProperty(b,"__esModule",{value:!0});var a=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];q=function(){function b(c){var b=this;this.view=c;this.graphics=[];this.handles=new f;this._enabled=!0;this.symbols=a.map(function(a){return new m(new d({material:{color:[a[0],a[1],
a[2],.6]},outline:{color:"black",size:1}}))});this.handles.add([c.featureTiles.addClient(),k.on(c.featureTiles,"tiles","change",function(){return b.update()},function(){return b.update()})])}Object.defineProperty(b.prototype,"enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a;this.update()},enumerable:!0,configurable:!0});b.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.view&&(this.clear(),this.view=null)};b.prototype.update=
function(){var a=this;this.clear();if(this._enabled){var b=this.view.featureTiles,d=b.tilingScheme,f=b.tiles.toArray().sort(function(a,c){return a.loadPriority-c.loadPriority});f.forEach(function(b,e){var g=b.lij,l=g[0],k=g[1],m=g[2],r=d.getExtentGeometry(l,k,m),g=new n({geometry:r,symbol:a.symbols[l%a.symbols.length]}),t=e/(f.length-1);e=c.lerp(0,200,t);var t=c.lerp(20,6,t),u=b.loadPriority>=f.length;b=new n({geometry:r.center,symbol:new h({verticalOffset:{screenLength:40/.75},callout:{type:"line",
color:"white",border:{color:"black"}},symbolLayers:[new p({text:l+"/"+k+"/"+m+" ("+b.loadPriority+")",halo:{color:"white",size:1/.75},material:{color:[e,u?0:e,u?0:e]},size:t/.75})]})});a.graphics.push(g,b);a.view.graphics.addMany([g,b])})}};b.prototype.clear=function(){this.view.graphics.removeMany(this.graphics);this.graphics=[]};return b}();b.FeatureTileTree3DDebugger=q;b.default=q})},"esri/views/3d/state/ViewState":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec3f64 ../../ViewAnimation ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/earthUtils ../support/Evented ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function k(a){a=b.call(this,a)||this;a.propertiesPool=new e.default({camera:u},a);a.lastSeenCameraProjectionValues=new u;a.events=new g.Evented;a.updateQueue=[];a.processingUpdates=!1;return a}n(k,b);k.prototype.destroy=function(){this.cameraController=null;this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};k.prototype.normalizeCtorArgs=function(a){return{camera:this.createInitialCamera(a.viewingMode),
mode:a.viewingMode,spatialReference:a.spatialReference,constraints:new p.default({mode:a.viewingMode})}};Object.defineProperty(k.prototype,"animation",{get:function(){return this.cameraController instanceof c.AnimationController?this.cameraController.viewAnimation:null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"camera",{get:function(){return this._get("camera")},set:function(a){a!==t&&t.copyFrom(a);t.markViewDirty();t.computeUp(this.mode);r.camera=t;this.events.emit("before-camera-change",
r);a=this._get("camera");this.cameraProjectionChanged(this.lastSeenCameraProjectionValues,t)&&(this.lastSeenCameraProjectionValues.copyFrom(t),y.camera=this.lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",y));a&&a.equals(t)||this._set("camera",this.propertiesPool.get("camera").copyFrom(t))},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"isLocal",
{get:function(){return"local"===this.mode},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"interacting",{get:function(){return!!this.cameraController&&this.cameraController.isInteractive},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"cameraController",{get:function(){return this._get("cameraController")},set:function(c){var b=this;this.stopActiveCameraController()?(c&&(c.watch("state",function(d){if(d===a.State.Finished||d===a.State.Stopped)b._set("cameraController",
null),b.updateCamera(function(a){return c.onControllerEnd(a)})},!0),c.onControllerStart(this.camera)),this._set("cameraController",c)):c&&(c.state=a.State.Rejected)},enumerable:!0,configurable:!0});k.prototype.switchCameraController=function(c){this.cameraController=c;return c.state!==a.State.Rejected};k.prototype.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};k.prototype.cameraChanged=function(){this.updateCamera(function(){})};
k.prototype.updateCamera=function(a){this.updateQueue.push(a);this.processUpdateQueue()};k.prototype.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var a=this.updateQueue.shift();t.copyFrom(this._get("camera"));a(t);this.camera=t;this.processingUpdates=!1;this.processUpdateQueue()}};k.prototype.createInitialCamera=function(a){return"global"===a?new u(h.vec3f64.fromValues(4*l.earthRadius,0,0),h.vec3f64.fromValues(l.earthRadius,0,0),
h.vec3f64.fromValues(0,0,1)):new u(h.vec3f64.fromValues(0,0,100),h.vec3f64.fromValues(0,0,0),h.vec3f64.fromValues(0,1,0))};k.prototype.cameraProjectionChanged=function(a,c){return a.fov!==c.fov||a.fullViewport[0]!==c.fullViewport[0]||a.fullViewport[1]!==c.fullViewport[1]||a.fullViewport[2]!==c.fullViewport[2]||a.fullViewport[3]!==c.fullViewport[3]||a.padding[0]!==c.padding[0]||a.padding[1]!==c.padding[1]||a.padding[2]!==c.padding[2]||a.padding[3]!==c.padding[3]?!0:!1};f([d.property({readOnly:!0,type:m,
dependsOn:["cameraController"]})],k.prototype,"animation",null);f([d.property({type:u})],k.prototype,"camera",null);f([d.property({constructOnly:!0})],k.prototype,"constraints",void 0);f([d.property({readOnly:!0})],k.prototype,"events",void 0);f([d.property({readOnly:!0,dependsOn:["isLocal"]})],k.prototype,"isGlobal",null);f([d.property({readOnly:!0,dependsOn:["mode"]})],k.prototype,"isLocal",null);f([d.property({constructOnly:!0})],k.prototype,"mode",void 0);f([d.property({constructOnly:!0})],k.prototype,
"spatialReference",void 0);f([d.property({readOnly:!0,dependsOn:["cameraController"]})],k.prototype,"interacting",null);f([d.property()],k.prototype,"cameraController",null);return k=f([d.subclass()],k)}(d.declared(k));b.ViewState=q;var t=new u,r={camera:null},y={camera:null};b.default=q})},"esri/views/3d/support/PropertiesPool":function(){define(["require","exports","../../../core/ReentrantObjectPool","../../../core/accessorSupport/watch"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});
q=function(){function b(b,h){var d=this;this.owner=h;this.properties={};this.afterDispatchHandle=null;for(var k in b)h=new n.ReentrantObjectPool(b[k],null,null,2,2),this.properties[k]={pool:h,acquired:[]};this.afterDispatchHandle=f.afterDispatch(function(){return d.release()})}b.prototype.destroy=function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(var b in this.properties){for(var h=this.properties[b],k=0,p=h.acquired;k<p.length;k++){var c=p[k];
f.isValueInUse(c)||h.pool.release(c)}h.pool.destroy();h.pool=null;h.acquired=null}this.owner=this.properties=null};b.prototype.get=function(b){var d=this.owner._get(b);b=this.properties[b];var f=b.pool.acquire();for(b.acquired.push(f);f===d;)b.acquired.push(f),f=b.pool.acquire();return f};b.prototype.release=function(){for(var b in this.properties){for(var h=this.properties[b],k=0,p=0,c=h.acquired;p<c.length;p++){var a=c[p];f.isValueInUse(a)?h.acquired[k++]=a:h.pool.release(a)}h.acquired.length=k}};
return b}();b.PropertiesPool=q;b.default=q})},"esri/views/3d/state/ViewStateManager":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Error ../../../core/Handles ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/screenUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../../animation/easing".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C,E,F,H,D,G,K,M,O){Object.defineProperty(b,"__esModule",{value:!0});var N=a.getLogger("esri.views.3d.state.ViewStateManager");q=function(a){function b(b){b=a.call(this)||this;b.propertiesPool=new G.default({frustum:E.default},b);b.handles=new c;b.cameraSetByUser=!1;b.internalSetOrder=[];b.immediateGoToPromise=null;b.animatedGoToPromise=null;b.ready=!1;b.updateDevicePixelRatio=null;return b}f(b,a);Object.defineProperty(b.prototype,"camera",{get:function(){return this.ready?
D.internalToExternal(this.view,this.view.state.camera):this._get("camera")},set:function(a){this.updatePropertyBeforeReady("camera",a)||this.setStateCamera(D.externalToInternal(this.view,a),{applyConstraints:!1})||N.error("#camera\x3d","Invalid camera",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"center",{get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(a){this.updatePropertyBeforeReady("center",a)||(a?
this.isCompatible(a)?this.setStateCamera(this.centerToCamera(a),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.forceUpdate():N.error("#center\x3d","Invalid center",a):N.error("#center\x3d","Center has an incompatible spatial reference (center: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):N.error("#center\x3d","Center may not be null or undefined"))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"extent",
{get:function(){return this.ready?D.toExtent(this.view,null,null,null,R):this._get("extent")},set:function(a){this.updatePropertyBeforeReady("extent",a)||(a?this.isCompatible(a)?this.setStateCamera(this.extentToCamera(a),{applyConstraints:!0})||N.error("#extent\x3d","Invalid extent",a):N.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):N.error("#extent\x3d","Extent may not be null or undefined"))},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"frustum",{get:function(){var a=this.propertiesPool.get("frustum");a.renderCoordsHelper=this.view.renderCoordsHelper;a.update(this.view.state.camera);return a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"hasInitialView",{get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"scale",{get:function(){if(!this.ready)return this._get("scale");
var a=this.view.pointsOfInterest.centerOnContent;return D.distanceToScale(this.view,a.distance,a.location.latitude)},set:function(a){this.updatePropertyBeforeReady("scale",a)||this.setStateCamera(this.scaleToCamera(a),{applyConstraints:!0})||N.error("#scale\x3d","Invalid scale",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"padding",{get:function(){if(!this.ready)return this._get("padding");var a=this.view.state.camera,c=a.padding,b=a.pixelRatio,a=this._get("padding"),d=c[0]/
b,e=c[1]/b,f=c[2]/b,c=c[3]/b;return null!=a&&a.top===d&&a.right===e&&a.bottom===f&&a.left===c?a:{top:d,right:e,bottom:f,left:c}},set:function(a){this.updatePropertyBeforeReady("padding",a)||(this.paddingToArray(a,this.view.state.camera.pixelRatio,U),this.view.state.updateCamera(function(a){return a.padding=U}))},enumerable:!0,configurable:!0});b.prototype.paddingToArray=function(a,c,b){a?y.vec4.set(b,a.top||0,a.right||0,a.bottom||0,a.left||0):y.vec4.set(b,0,0,0,0);for(a=0;4>a;a++)b[a]=Math.round(b[a]*
c)};Object.defineProperty(b.prototype,"screenCenter",{get:function(){var a=this.padding;return u.createScreenPoint((this.view.width-(a.left+a.right))/2+a.left,(this.view.height-(a.top+a.bottom))/2+a.top)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"viewpoint",{get:function(){return this.ready?K.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(a){if(!this.updatePropertyBeforeReady("viewpoint",a))if(a)if(this.isCompatible(a))this.setStateCamera(this.viewpointToCamera(a),
{applyConstraints:!a.camera})||N.error("#viewpoint\x3d","Invalid viewpoint",a);else{var c=a.camera?a.camera.position:a.targetGeometry,c=c&&c.spatialReference;N.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(c?c.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a)}else N.error("#viewpoint\x3d","Viewpoint may not be null or undefined")},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"zoom",{get:function(){return this.ready?D.scaleToZoom(this.view,
this.scale):this._get("zoom")},set:function(a){this.updatePropertyBeforeReady("zoom",a)||this.setStateCamera(this.zoomToCamera(a),{applyConstraints:!0})||N.error("#zoom\x3d","Invalid zoom",a)},enumerable:!0,configurable:!0});b.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch("state.camera",function(c){return a.cameraChangedSync(c)},!0),t.on(this.view,"state.events","before-camera-change",function(c){return a.beforeCameraChangeHandle(c.camera)})]);t.once(this.view,"state.camera",
function(c){return a.updateCameraElevation(c)});this.handles.add(e.addFrameTask({prepare:function(){return a.prepareFrame()}}));this.handles.add(this.view.watch("state.cameraController",function(){a.cameraSetByUser=!0;a.handles.remove(Q);a.cancelImmediateGoTo()}));this.handles.add(t.on(this.view,"state.events","camera-projection-changed",function(){return a.notifyChange("scale")}))};b.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),
this.propertiesPool=null)};b.prototype.init=function(){var a=this;this.constraintsManager=new C.default({view:this.view});this.prepareFrame();var c=this.getInitialProperties();this.cameraSetByUser=!1;this._set("ready",!0);for(var b=0;b<c.length;b++){var d=c[b];this.set(d.name,d.value)}this.cameraSetByUser||((c=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(c)?this.setInitialView(c):"local"===this.view.state.mode&&this.handles.add(t.whenOnce(this.view.basemapTerrain,
"ready",function(){a.handles.remove(Q);a.setInitialView(a.view.groundExtent)}),Q))};b.prototype.deinit=function(){this.ready&&(this._override("padding",this.padding),this.cancelImmediateGoTo(),this.cancelAnimatedGoTo(),this._set("ready",!1),this._clearOverride("hasInitialView"),this.internalSetOrder.length=0,this.cameraSetByUser=!1,this.handles.remove(Q),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};b.prototype.goTo=function(a,c){c=n({animate:!0},c);return c.animate?
this.goToAnimated(a,c):this.goToImmediate(a,c)};b.prototype.debugSetCameraOnContent=function(){this.setStateCamera(B.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};b.prototype.step=function(a){var c=this.view.state,b=c&&this.view.state.cameraController;b&&(c.updateCamera(function(c){b.stepController(a,c)}),b.steppingFinished&&b.finishController())};b.prototype.cancelImmediateGoTo=function(){var a=this.immediateGoToPromise;a&&(this.immediateGoToPromise=null,a.cancel())};b.prototype.cancelAnimatedGoTo=
function(){var a=this.animatedGoToPromise;a&&(this.animatedGoToPromise=null,a.cancel())};b.prototype.getInitialProperties=function(){for(var a=this,c=new Set,b=[],d=0,e=L;d<e.length;d++){var f=e[d],g=f.propertyName,f=f.overrides,h=c.has(g),l=this._isOverridden(g);!h&&l&&b.push({name:g,value:this._get(g)});this._clearOverride(g);(h||l)&&f.forEach(function(a){return c.add(a)})}return b.sort(function(c,b){c=a.internalSetOrder.indexOf(c.name);b=a.internalSetOrder.indexOf(b.name);return c<b?-1:c>b?1:0})};
b.prototype.setInitialView=function(a){if(a&&!this.cameraSetByUser)if(a instanceof d)this.setStateCamera(D.externalToInternal(this.view,a),{applyConstraints:!1});else if(a instanceof h)if(a.targetGeometry instanceof x){var c=D.fromExtent(this.view,a.targetGeometry,0,.5,D.OrientationMode.LOCKED);this.setStateCamera(D.externalToInternal(this.view,c),{applyConstraints:!0})}else c={applyConstraints:!a.camera},a=this.viewpointToCamera(a),this.setStateCamera(a,c);else c=D.fromExtent(this.view,a,0,.5,D.OrientationMode.LOCKED),
this.setStateCamera(D.externalToInternal(this.view,c),{applyConstraints:!0})};b.prototype.updatePropertyBeforeReady=function(a,c){if(!this.ready){this._override(a,c);var b=this.internalSetOrder.indexOf(a);-1!==b&&(this.internalSetOrder=this.internalSetOrder.splice(b,1));c&&(this.internalSetOrder.push(a),-1!==P.indexOf(a)&&this._override("hasInitialView",!0));return!0}return!1};b.prototype.isCompatible=function(a){return a?a instanceof h?a.camera?this.isCompatible(a.camera):this.isCompatible(a.targetGeometry):
a instanceof d?this.isCompatible(a.position):a.spatialReference&&z.canProject(a.spatialReference,this.view.spatialReference):!1};b.prototype.getPreservingHeadingTilt=function(a){void 0===a&&(a=T);this.cameraSetByUser?(a.heading=this.camera.heading,a.tilt=this.camera.tilt):(a.heading=0,a.tilt=.5);return a};b.prototype.centerPointAtDistanceToCamera=function(a,c,b){void 0===b&&(b=J);var d=this.getPreservingHeadingTilt();return(a=D.getObserverForPointAtDistance(this.view,d.heading,d.tilt,a,c,D.OrientationMode.ADJUST))?
(b.copyFrom(this.view.state.camera),b.eye=a.eye,b.center=a.center,b.up=a.up,b):null};b.prototype.centerToCamera=function(a){var c=this.view.pointsOfInterest.centerOnContent;c.forceUpdate();return this.centerPointAtDistanceToCamera(a,c.distance)};b.prototype.extentToCamera=function(a){var c=this.getPreservingHeadingTilt();a=D.fromExtent(this.view,a,c.heading,c.tilt,D.OrientationMode.ADJUST,R);return D.externalToInternal(this.view,a)};b.prototype.scaleToCamera=function(a){if(null==a)return null;var c=
this.view.pointsOfInterest.centerOnContent;c.forceUpdate();var b=c.renderLocation;a=D.scaleToDistance(this.view,a,c.location.latitude);return this.centerPointAtDistanceToCamera(b,a)};b.prototype.zoomToCamera=function(a){return this.scaleToCamera(D.zoomToScale(this.view,a))};b.prototype.viewpointToCamera=function(a){return(a=K.toCamera(this.view,a))?D.externalToInternal(this.view,a):null};b.prototype.setStateCamera=function(a,c){var b=this;if(!a||!this.view.state.stopActiveCameraController())return!1;
this.cameraSetByUser=!0;this.cancelImmediateGoTo();this.view.state.updateCamera(function(d){d.copyFrom(a);c.applyConstraints&&A.applyAll(b.view,d)});c.applyConstraints||(this.view.state.cameraController=new H.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:a}));return!0};b.prototype.prepareFrame=function(){var a=this.view,c=a.container,b=a.canvas;if(c&&b){l.isSome(this.updateDevicePixelRatio)&&this.updateDevicePixelRatio();var a=this.view.pixelRatio,d=Math.round(c.clientWidth*a),
c=Math.round(c.clientHeight*a);0!==d&&0!==c&&(b.width=d,b.height=c,this.view.state&&(b=this.view.state.camera,b.fullWidth!==d||b.fullHeight!==c||b.pixelRatio!==a))&&(J.copyFrom(b),J.pixelRatio!==a&&(this.paddingToArray(this.padding,a,U),J.padding=U),J.fullWidth=d,J.fullHeight=c,J.pixelRatio=a,this.view.state.camera=J)}};b.prototype.beforeCameraChangeHandle=function(a){this.updateCameraElevation(a)};b.prototype.cameraChangedSync=function(a){a&&this.view._stage&&this.view._stage.setCamera(a)};b.prototype.updateCameraElevation=
function(a){var c=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference,b=this.view.renderCoordsHelper.getAltitude(a.eye),c=c?B.surfaceElevationBelowEye(this.view,a):0;a.relativeElevation=b-c};b.prototype.createGoToCamera=function(a){var c=this;return t.whenOnce(this,"ready",null,!0).then(function(){return K.create(c.view,a)}).then(function(b){var e=!!(a instanceof h&&a.camera||a instanceof d),f=b.camera;if(!c.isCompatible(f))throw b=(b=f.position)&&b.spatialReference,new p("goto:incompatible-spatialreference",
"Resulting camera has an incompatible spatial reference (camera: "+(b?b.wkid:"none")+", view: "+c.view.spatialReference.wkid+")",{camera:f});f=D.externalToInternal(c.view,f);if(!f)throw new p("goto:invalid-camera","Resulting camera is invalid");return{viewpoint:b,camera:f,isFullySpecified:e}})};b.prototype.cancellableGoTo=function(a){var c=this,b;return g.create(function(c,d){b={resolve:c,reject:d};a.asyncResult=b},function(){c.view.state.cameraController===a&&a.active&&a.asyncResult===b&&a.stopController()})};
b.prototype.goToImmediate=function(a,c){var b=this;this.cancelAnimatedGoTo();this.cancelImmediateGoTo();var d=this.createGoToCamera(a).then(function(a){b.immediateGoToPromise===d&&(b.immediateGoToPromise=null);b.setStateCamera(a.camera,{applyConstraints:!a.isFullySpecified})}).catch(function(a){b.immediateGoToPromise===d&&(b.immediateGoToPromise=null);a instanceof p&&a.message&&N.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));throw a;});return this.immediateGoToPromise=
d};b.prototype.goToAnimatedBeforeReady=function(a,c){var b=this;this.cancelAnimatedGoTo();var d=t.whenOnce(this.view,"ready").then(function(){if(d===b.animatedGoToPromise)return b.animatedGoToPromise=null,b.goToAnimated(a,c);throw new p("view:goto-cancelled","Cancelled");});return this.animatedGoToPromise=d};b.prototype.goToAnimated=function(a,c){var b=this;this.cancelAnimatedGoTo();if(!this.ready)return this.goToAnimatedBeforeReady(a,c);var d=this.view.state.cameraController,e;d instanceof F.PointToPointAnimationController&&
(d.updateStateFromViewAnimation(),d.active&&(e=d));null==e&&(e=new F.PointToPointAnimationController(this.view.state,this.view.sceneIntersectionHelper));var f=e.viewAnimation;a=this.createGoToCamera(a);var h=a.then(function(a){return a.viewpoint});f.update(h);if(e!==d&&!this.view.state.switchCameraController(e))return f.stop(),N.error("#goTo()","Cannot start an animation while interacting"),g.reject(new p("view:goto-cannot-interrupt","Cannot start an animation while interacting"));var l=f.target,
k=function(){return b.view.state.cameraController===e&&e.viewAnimation.target===l&&e.active};a.then(function(a){var d=a.viewpoint,g=a.camera;a=a.isFullySpecified;if(k()){e.viewAnimation.update(d);l=e.viewAnimation.target;var h;a?(h=new H.SurfaceCollisionCorrectionController({view:b.view,desiredCamera:g}),A.applySurfaceCollision(b.view,g,1)):A.applyAll(b.view,g);e.begin(g,b.internalAnimateOptions(c));return f.when().then(function(){var a=b.view.state.cameraController;h&&(a&&a.active?a instanceof F.PointToPointAnimationController&&
a.viewAnimation.target===l&&(b.view.state.cameraController=h):e.viewAnimation.target===l&&(b.view.state.cameraController=h))})}}).catch(function(a){a instanceof p&&a.message&&N.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));if(k())throw b.view.state.cameraController.stopController(),a;});return this.cancellableGoTo(e)};b.prototype.internalAnimateOptions=function(a){var c={};a&&(null!=a.speedFactor&&(c.speedFactor=a.speedFactor),null!=a.duration&&
(c.duration=a.duration/1E3),null!=a.maxDuration&&(c.maxDuration=a.maxDuration/1E3),null!=a.easing&&(c.easing="string"===typeof a.easing?O.named[a.easing]:a.easing));return c};k([r.property({type:d,dependsOn:["view.state.camera","ready"]})],b.prototype,"camera",null);k([r.property({type:v,dependsOn:["view.pointsOfInterest.centerOnContent.location","ready"]})],b.prototype,"center",null);k([r.property({type:x,dependsOn:["view.state.camera","ready"]})],b.prototype,"extent",null);k([r.property({readOnly:!0,
dependsOn:["view.state.camera","ready"]})],b.prototype,"frustum",null);k([r.property({readOnly:!0,dependsOn:["view.map.initialViewProperties?.viewpoint"]})],b.prototype,"hasInitialView",null);k([r.property({readOnly:!0,type:Boolean})],b.prototype,"ready",void 0);k([r.property({dependsOn:["view.pointsOfInterest.centerOnContent.distance","ready"],type:Number})],b.prototype,"scale",null);k([r.property({dependsOn:["view.state.camera","ready"]})],b.prototype,"padding",null);k([r.property({readOnly:!0,
dependsOn:["view.width","view.height","padding"]})],b.prototype,"screenCenter",null);k([r.property({constructOnly:!0})],b.prototype,"view",void 0);k([r.property({type:h,dependsOn:["camera","ready"]})],b.prototype,"viewpoint",null);k([r.property({type:Number,dependsOn:["scale"]})],b.prototype,"zoom",null);k([r.property({constructOnly:!0})],b.prototype,"updateDevicePixelRatio",void 0);return b=k([r.subclass("esri.views.3d.state.ViewStateManager")],b)}(r.declared(m));b.ViewStateManager=q;var P="camera viewpoint extent scale center zoom".split(" "),
L=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"center",overrides:[]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],T={heading:0,tilt:0},R=new d,J=new M,U=w.vec4f64.create(),Q="pending-initial-view";b.default=q})},"esri/views/3d/state/ConstraintsManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils ./NearFarHeuristic ./SurfaceCollisionConstraint ../support/mathUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function e(c){var e=b.call(this)||this;e.handles=new d;e.nearFarHeuristic=a.createNearFarHeuristic(c.view.state.mode,c.view.basemapTerrain,c.view.renderCoordsHelper.spatialReference);return e}n(e,b);e.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],function(){return a.handleClipDistanceNearFarChanged()}),this.view.watch("constraints.clipDistance.mode",
function(){return a.handleClipDistanceModeChanged()}),this.view.state.events.on("before-camera-change",function(c){return a.cameraUpdateNearFar(c.camera)}),this.view.watch("dataExtent",function(){return a.updateNearFar()},!0)]);this.handles.add([this.view.watch(["constraints.altitude.min","constraints.altitude.max"],function(){return a.handleAltitudeMinMaxChanged()},!0)]);this.handles.add([this.view.watch("constraints.tilt.max",function(){return a.handleTiltMaxChanged()},!0),this.view.watch("constraints.tilt.mode",
function(){return a.handleTiltModeChanged()},!0),this.view.watch("state.camera",function(){return a.tiltAutoUpdateMax()},!0)]);this.handles.add(this.view.watch(["map.ground.navigationConstraint.type","constraints.collision.enabled"],function(){return a.updateCollision()},!0));this.view.state.isLocal&&this.handles.add(h.init(this.view,"dataExtent",function(c){return a.updateLocalSurfaceDistance(c)}));this.updateNearFar();"local"!==this.view.state.mode&&this.updateAltitude();this.updateTilt();this.updateCollision();
this._set("surfaceCollisionConstraint",new l.default({view:this.view}))};e.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))};e.prototype.handleClipDistanceNearFarChanged=function(){var a=this,c=this.view.constraints&&this.view.constraints.clipDistance;c&&"auto"!==c.mode&&this.view.state.updateCamera(function(b){a.cameraUpdateNearFarManual(b,
c);return!0})};e.prototype.handleClipDistanceModeChanged=function(){this.updateNearFar()};e.prototype.updateNearFar=function(){var a=this;this.view.state.updateCamera(function(c){a.cameraUpdateNearFar(c);return!0})};e.prototype.cameraUpdateNearFar=function(a){var c=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(c?c.mode:"auto")?this.cameraUpdateNearFarManual(a,c):this.cameraUpdateNearFarAuto(a,c)};e.prototype.cameraUpdateNearFarAuto=function(a,b){this.nearFarHeuristic.compute(a.eye,
a.center,this.view.dataExtent,c.surfaceElevationBelowEye(this.view,a),a);b&&b.autoUpdate(a.near,a.far)};e.prototype.cameraUpdateNearFarManual=function(a,c){c&&(a.near=c.near,a.far=c.far)};e.prototype.updateCollision=function(){var a=this.view.map&&this.view.map.ground&&this.view.map.ground.navigationConstraint,c=this.view.constraints&&this.view.constraints.collision.enabled,a=a?"stay-above"===a.type:c,c=this.view.state.constraints.collision;a!==c.enabled&&((c.enabled=a)&&this.reapplyConstraints(8),
(a=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==a.mode||this.updateTiltAuto(a))};e.prototype.handleAltitudeMinMaxChanged=function(){this.updateAltitude()};e.prototype.updateAltitude=function(){var a=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=a&&"local"!==this.view.state.mode?{min:a.min,max:a.max}:null;this.reapplyConstraints()};e.prototype.handleTiltModeChanged=function(){this.updateTilt()};e.prototype.handleTiltMaxChanged=function(){var a=
this.view.constraints&&this.view.constraints.tilt;a&&"auto"!==a.mode&&(this.updateTiltManual(a),this.reapplyConstraints())};e.prototype.updateTilt=function(){var a=this.view.constraints&&this.view.constraints.tilt;"manual"===(a?a.mode:"auto")?this.updateTiltManual(a):this.updateTiltAuto(a);this.reapplyConstraints()};e.prototype.updateTiltManual=function(a){var c=this.view.state.constraints;c.tilt=c.createConstantMaxTilt(g.deg2rad(a.max))};e.prototype.updateTiltAuto=function(a){a=this.view.state.constraints;
a.tilt=a.createDefaultTilt();this.tiltAutoUpdateMax()};e.prototype.tiltAutoUpdateMax=function(){var a=this.view.constraints&&this.view.constraints.tilt;if(a&&"auto"===a.mode){var c=this.view.state.constraints;c.tilt&&(c=c.tilt(this.view.state.camera.distance).max,a.autoUpdate(g.rad2deg(c)))}};e.prototype.updateLocalSurfaceDistance=function(a){var c=Math.max(a.width,a.height);0>=c||(a.hasZ&&(c=Math.max(c,a.zmax-a.zmin)),a=this.view.state,c=3*c/Math.atan(a.camera.fov/2),c!==a.constraints.distance&&
(a.constraints.distance=c))};e.prototype.reapplyConstraints=function(a){var c=this;void 0===a&&(a=15);this.view.state.updateCamera(function(b){return p.applyAll(c.view,b,{selection:a,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:0})})};f([m.property({constructOnly:!0})],e.prototype,"view",void 0);f([m.property({readOnly:!0})],e.prototype,"surfaceCollisionConstraint",void 0);return e=f([m.subclass("esri.views.3d.state.ConstraintsManager")],
e)}(m.declared(k));b.ConstraintsManager=q;b.default=q})},"esri/views/3d/state/NearFarHeuristic":function(){define("require exports ../../../core/unitUtils ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/earthUtils ../support/mathUtils".split(" "),function(q,b,n,f,k,d,h){function m(a,c,b,d){b=l/b;a/c>b?(d.far=a,d.near=d.far/c):(d.near=b,d.far=d.near*c);return d}Object.defineProperty(b,"__esModule",{value:!0});b.createNearFarHeuristic=function(a,b,d){return"global"===
a?new c:new p(b,d)};var p=function(){function c(a,c){this.elevationProvider=a;this.unitInMeters=n.getMetersPerUnitForSR(c)}c.prototype.compute=function(c,b,l,k,p){p||(p={near:0,far:0});var n=d.earthRadius,r=c[2]*this.unitInMeters,q=r;k=r-k;var y=this.elevationProvider?this.elevationProvider.getElevationBounds():null;y&&(r=0<=k?q-this.unitInMeters*y[0]:this.unitInMeters*y[1]-q);q=Math.max(l.xmax-l.xmin,l.ymax-l.ymin,4*Math.max(l.xmax-l.xmin,l.ymax-l.ymin));f.vec3.subtract(t,b,c);u[0]=0<t[0]?l.xmax:
l.xmin;u[1]=0<t[1]?l.ymax:l.ymin;u[2]=0<t[2]?q/2:-q/2;f.vec3.subtract(u,u,c);f.vec3.normalize(t,t);c=1.1*f.vec3.dot(u,t)*this.unitInMeters;n=Math.sqrt(r*(r+2*n));l=Math.max(l.xmax-l.xmin,l.ymax-l.ymin);b=l*e*this.unitInMeters;r=h.clamp((r-b)/(l*g*this.unitInMeters-b),0,1);r=h.lerp(n,c,r*r*r);r*=Math.max(Math.log(Math.abs(k)),1);r=Math.min(r,Math.max(34064E4,q));r/=this.unitInMeters;return m(r,a,this.unitInMeters,p)};return c}(),c=function(){function a(){}a.prototype.compute=function(a,c,b,e,g){g||
(g={near:0,far:0});c=d.earthRadius;a=f.vec3.length(a)-c;a=Math.max(Math.abs(a-e),Math.abs(a));e=Math.sqrt(a*(a+2*(c+Math.min(0,e))));a=h.clamp(2E4-(Math.log(a)-7.983)/9.011*19E3,1E3,2E4);return m(1.2*e,a,1,g)};return a}(),a=2E4,l=2,g=.001,e=1E-4,u=k.vec3f64.create(),t=k.vec3f64.create()})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils".split(" "),
function(q,b,n,f,k,d,h,m,p){Object.defineProperty(b,"__esModule",{value:!0});q=function(c){function a(a){a=c.call(this)||this;a.handles=new d;return a}n(a,c);a.prototype.initialize=function(){var a=this;this.handles.add(this.view.basemapTerrain.on("elevation-change",function(c){return a.handleElevationChangeEvent(c)}))};a.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};a.prototype.handleElevationChangeEvent=function(a){if(this.view.state.cameraController)return!1;
p.eyeWithinExtent(this.view,this.view.state.camera,a.extent,a.spatialReference)&&this.applyToCurrentCamera()};a.prototype.applyToCurrentCamera=function(){var a=this;this.view.state.updateCamera(function(c){m.applySurfaceCollision(a.view,c,1)})};f([h.property({constructOnly:!0})],a.prototype,"view",void 0);return a=f([h.subclass("esri.views.3d.state.ElevationCollisionConstraint")],a)}(h.declared(k));b.SurfaceCollisionConstraint=q;b.default=q})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../camera/constraintUtils ../../camera/intersectionUtils ./CameraController".split(" "),
function(q,b,n,f,k,d,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function m(c){var a=b.call(this)||this;a.handles=new f;a.view=c.view;a.desiredCamera=c.desiredCamera.copy();return a}n(m,b);Object.defineProperty(m.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"constraintEnabled",{get:function(){return this.view.state.constraints.collision.enabled},enumerable:!0,configurable:!0});m.prototype.onControllerStart=function(c){var a=
this;b.prototype.onControllerStart.call(this,c);this.handles.add(this.view.basemapTerrain.on("elevation-change",function(c){return a.handleElevationChangeEvent(c)}));this.applyCorrection()};m.prototype.onControllerEnd=function(c){this.handles.removeAll();this.view=null;b.prototype.onControllerEnd.call(this,c)};m.prototype.handleElevationChangeEvent=function(c){d.eyeWithinExtent(this.view,this.desiredCamera,c.extent,c.spatialReference)&&this.applyCorrection()};m.prototype.applyCorrection=function(){var c=
this;this.view.state.updateCamera(function(a){a.copyViewFrom(c.desiredCamera);k.applySurfaceCollision(c.view,a,1)||c.constraintEnabled||(c.state=h.State.Stopped)})};return m}(h.CameraController);b.SurfaceCollisionCorrectionController=q})},"esri/views/3d/support/viewpointUtils":function(){define("require exports ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/compilerUtils ../../../core/Error ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat3 ../../../core/libs/gl-matrix-2/mat3f64 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtils ./geometryUtils ./mathUtils ./projectionUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z){function A(a){return 360-v.cyclicalDeg.normalize(a)}function B(a){return v.cyclicalDeg.normalize(360-a)}function C(a,c){a&&(null==c?a.reject():a.resolve(c));return c}function E(a,c,b,d){if(!c)return C(d);var e=a.spatialReference||f.SpatialReference.WGS84;if(c.camera){a=c.get("camera.position.spatialReference");if(!r.canProject(a,e))return C(d);c=c.camera.clone();a.equals(e)||(c.position=r.project(c.position,e));return C(d,c)}var g=c.get("targetGeometry.spatialReference");
if(g&&!r.canProject(g,e))return C(d);e=w.internalToExternal(a,a.state.camera);g=w.OrientationMode.ADJUST;null!=c.rotation&&(e.heading=A(c.rotation),g=w.OrientationMode.LOCKED);null!=b&&(e.tilt=b);if("point"===c.targetGeometry.type){b=c.targetGeometry;var h=void 0,l=c.targetGeometry.clone(),h=null!=c.scale?w.scaleToDistance(a,c.scale,b.latitude):a.state.camera.distance;return w.fromCenterDistance(a,l,h,e,g,d)}return w.fromExtent(a,c.targetGeometry.extent,e.heading,e.tilt,g,d)}function F(a,c){return null==
c.scale&&null!=c.zoom?w.zoomToScale(a,c.zoom):c.scale}function H(a,c){var b=!1;null!=c.heading?(a.heading=c.heading,b=!0):null!=c.rotation&&(a.heading=A(c.rotation),b=!0);null!=c.tilt&&(a.tilt=c.tilt,b=!0);null!=c.fov&&(a.fov=c.fov);return b}function D(a,c,b){var d=a.spatialReference||f.SpatialReference.WGS84;c=c||w.externalToInternal(a,b.camera);b.targetGeometry=z.vectorToPoint(c.center,a.renderSpatialReference,d);b.scale=w.computeScale(a,c);b.rotation=B(b.camera.heading);return b}function G(a,c,
b){if(c){if(!r.canProject(c.spatialReference,a.spatialReference))throw new m("viewpointutils:incompatible-spatialreference","Spatial reference ("+(c.spatialReference?c.spatialReference.wkid:"unknown")+") is incompatible with the view ("+a.spatialReference.wkid+")",{geometry:c});var d=[];if(!c.hasZ&&a.basemapTerrain){var e=void 0;switch(c.type){case "point":e=c;break;case "multipoint":case "polyline":case "mesh":e=c.extent.center;break;case "extent":e=c.center;break;case "polygon":e=c.centroid;break;
default:h.neverReached(c)}e&&r.canProject(e,a.basemapTerrain.spatialReference)?I[2]=a.basemapTerrain.getElevation(e)||0:I[2]=0}(0,Y[c.type])(c,function(a){d.push(a[0],a[1],a[2])},I);var f=d.length/3;if(0!==f&&(e=Array(d.length),z.bufferToBuffer(d,c.spatialReference,0,e,a.spatialReference,0,f)))for(c.hasZ&&(b.hasZ=!0),a=0;a<e.length;a+=3)c.hasZ?(I[0]=e[a+0],I[1]=e[a+1],I[2]=e[a+2]):(I[0]=e[a+0],I[1]=e[a+1]),u.expand(b.boundingBox,I)}}function K(a,c,b,d){return a.whenViewForGraphic(c).then(function(a){if(a&&
a.whenGraphicBounds)return a.whenGraphicBounds(c,{minDemResolution:b})}).then(function(a){var c=a.boundingBox;u.expand(d.boundingBox,c);a.screenSpaceObjects&&a.screenSpaceObjects.forEach(function(a){d.screenSpaceObjects.push(a)});isFinite(c[2])&&(d.hasZ=!0)}).catch(function(){G(a,c.geometry,d)})}function M(a,c,b,d){if(Array.isArray(c)&&2===c.length){var e=c[0],g=c[1];if("number"===typeof e&&"number"===typeof g)return Z.x=e,Z.y=g,Z.z=void 0,Z.spatialReference=f.SpatialReference.WGS84,G(a,Z,d),p.resolve()}if(c&&
"function"===typeof c.map)return p.eachAlways(c.map(function(c){return M(a,c,b,d)}));if(c instanceof f.BaseGeometry)try{G(a,c,d)}catch(ia){return p.reject(ia)}else if(c instanceof k)return K(a,c,b,d);return p.resolve()}function O(a,c,b,d){if(c.camera)return p.resolve(N(a,b,c.camera,d));d.scale=c.scale;d.rotation=c.rotation;d.targetGeometry=c.targetGeometry?c.targetGeometry.clone():null;d.camera=null;null!=b.heading?d.rotation=B(b.heading):null!=b.rotation&&(d.rotation=b.rotation);c=F(a,b);null!=c&&
(d.scale=c);c=p.createResolver();E(a,d,b.tilt,c);return c.promise.then(function(a){d.camera=a;return d})}function N(a,c,b,d){d.camera=b.clone();d.camera.fov=a.camera.fov;c=a.spatialReference;b=d.camera.position.spatialReference;if(!r.canProject(b,c))return null;b.equals(c)||(d.camera.position=r.project(d.camera.position,c));return D(a,null,d)}function P(a,c,b,d,e){var h=a.renderSpatialReference;z.pointToVector(b.position,ba,h);z.pointToVector(c,aa,h);e.targetGeometry=new f.Point(c);e.camera.position=
new f.Point(b.position);g.vec3.subtract(da,aa,ba);w.directionToHeadingTilt(a,ba,da,d.up,e.camera);e.scale=w.distanceToScale(a,g.vec3.distance(ba,aa),e.targetGeometry.latitude);e.rotation=B(e.camera.heading);return e}function L(a,c,b,d){if(!b)return p.reject();d.targetGeometry=b.clone();var e=y.cameraOnContentAlongViewDirection(a);if(c.position)return p.resolve(P(a,d.targetGeometry,c,e,d));if(c.zoomFactor){var f=e.distance/c.zoomFactor,h=g.vec3.scale(I,e.viewForward,-f);g.vec3.add(e.eye,e.center,h);
e.markViewDirty();d.scale=w.distanceToScale(a,f,b.latitude)}w.internalToExternal(a,e,d.camera);f=H(d.camera,c)?w.OrientationMode.LOCKED:w.OrientationMode.ADJUST;return c.zoomFactor?p.resolve(d):(d.scale=F(a,c),null==d.scale&&(z.pointToVector(b,I,a.renderSpatialReference),x.frustum.intersectsPoint(e.frustum.planes,I)?d.scale=w.distanceToScale(a,g.vec3.distance(e.eye,I),b.latitude):d.scale=w.computeScale(a,e)),c=p.createResolver(),w.fromCenterScale(a,d.targetGeometry,d.scale,d.camera,f,c),c.promise.then(function(a){d.camera=
a;return d}))}function T(a,c,b,d){d.targetGeometry=b.clone();var e=y.cameraOnContentAlongViewDirection(a);w.internalToExternal(a,e,d.camera);c=H(d.camera,c)?w.OrientationMode.LOCKED:w.OrientationMode.ADJUST;e=p.createResolver();w.fromExtent(a,b,d.camera.heading,d.camera.tilt,c,e);return e.promise.then(function(a){d.camera=a;return d})}function R(a,b,d,e,f){var h=0;d.hasZ?h=d.z:a.basemapTerrain&&(h=a.basemapTerrain.getElevation(d));g.vec3.set(I,d.x,d.y,h);z.computeLinearTransformation(a.spatialReference,
I,V,a.renderSpatialReference);c.mat3.fromMat4(X,V);c.mat3.transpose(X,X);u.empty(W);d=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var l=0;l<d.length;l++){var k=d[l],m=e[k[2]];isFinite(m)||(m=h);g.vec3.set(I,e[k[0]],e[k[1]],m);z.vectorToVector(I,a.spatialReference,I,a.renderSpatialReference);u.expand(W,g.vec3.transformMat3(I,I,X))}a=u.width(W);e=u.height(W);h=u.depth(W);d=1/Math.tan(b.fovY/2);return Math.max(.5*Math.sqrt(a*a+h*h)*Math.max(d,1/Math.tan(b.fovX/2))+.5*e,.5*e*
d+.5*Math.max(a,h))/f}function J(a,c,b,d,e,f){f.targetGeometry=b.clone();var g=y.cameraOnContentAlongViewDirection(a);b=R(a,g,b,d,e);w.internalToExternal(a,g,f.camera);c=H(f.camera,c)?w.OrientationMode.LOCKED:w.OrientationMode.ADJUST;f.scale=w.distanceToScale(a,b,f.targetGeometry.latitude);g=p.createResolver();w.fromCenterScale(a,f.targetGeometry,f.scale,f.camera,c,g);return g.promise.then(function(a){f.camera=a;return f})}function U(a,c){if(!c||!a.spatialReference)return null;a={target:null};if("declaredClass"in
c||Array.isArray(c))a.target=c;else{for(var b in c)a[b]=c[b];c.center&&!a.target&&(a.target=c.center)}return a}function Q(a){a&&(a.rotation=B(a.camera.heading));return a}Object.defineProperty(b,"__esModule",{value:!0});b.DEFAULT_FRAME_COVERAGE=.66;b.rotationToHeading=A;b.headingToRotation=B;b.toCamera=E;b.fromInternalCamera=function(a,c,b){b||(b=new d({camera:new n}));w.internalToExternal(a,c,b.camera);return D(a,c,b)};b.fromCamera=function(a,c,b){b||(b=new d);b.camera=c.clone();return D(a,null,b)};
b.create=function(a,c){var e=U(a,c);if(!e)return p.reject(new m("viewpointutils-create:no-target","Missing target for creating viewpoint"));var h=new d({camera:new n({fov:a.camera.fov})});if(e.target instanceof d)return O(a,e.target,e,h).then(function(a){return Q(a)});if(e.target instanceof n)return p.resolve(Q(N(a,e,e.target,h)));var l=null!=e.scale||null!=e.zoom;if(e.target instanceof f.Extent)return c=e.target.xmin===e.target.xmax||e.target.ymin===e.target.ymax,l||c?L(a,e,e.target.center,h).then(function(a){return Q(a)}):
T(a,e,e.target,h).then(function(a){return Q(a)});var k={boundingBox:u.empty(),hasZ:!1,screenSpaceObjects:[]};c=l?w.scaleToResolution(a,F(a,e)):void 0;return M(a,e.target,c,k).then(function(){if(isFinite(k.boundingBox[0])){u.center(k.boundingBox,I);Z.x=I[0];Z.y=I[1];Z.z=I[2];Z.spatialReference=a.spatialReference;var c=void 0;isFinite(Z.z)&&k.hasZ?c=u.isPoint(k.boundingBox):(Z.z=void 0,c=t.isPoint(u.toRect(k.boundingBox,ca)));if(l||c)return L(a,e,Z,h);var c=k.screenSpaceObjects,d=b.DEFAULT_FRAME_COVERAGE;
if(c.length){for(var m=Number.NEGATIVE_INFINITY,p=0;p<c.length;p++)var n=c[p].screenSpaceBoundingRect,m=Math.max(m,Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2]),Math.abs(n[3]));c=d-m/Math.min(a.width,a.height)*2}else c=d;return J(a,e,Z,k.boundingBox,c,h)}if(e.position)return c=y.cameraOnContentAlongViewDirection(a),g.vec3.copy(da,c.viewForward),w.directionToHeadingTilt(a,c.eye,da,c.up,S),h.camera.position=new f.Point(e.position),h.camera.heading=null!=e.heading?e.heading:S.heading,h.camera.tilt=null!=
e.tilt?e.tilt:S.tilt,D(a,null,h);c=y.cameraOnContentAlongViewDirection(a);c=z.vectorToPoint(c.center,a.renderSpatialReference,Z,a.spatialReference);return L(a,e,c,h)}).then(function(a){return Q(a)})};var I=e.vec3f64.create(),V=l.mat4f64.create(),X=a.mat3f64.create(),W=u.create(),ca=t.create(),da=e.vec3f64.create(),ba=e.vec3f64.create(),aa=e.vec3f64.create(),S={heading:0,tilt:0},Z=new f.Point,Y={point:function(a,c,b){b[0]=a.x;b[1]=a.y;a.hasZ&&(b[2]=a.z);c(b)},polygon:function(a,c,b){for(var d=a.hasZ,
e=0;e<a.rings.length;e++)for(var f=a.rings[e],g=0;g<f.length;g++)b[0]=f[g][0],b[1]=f[g][1],d&&(b[2]=f[g][2]),c(b)},polyline:function(a,c,b){for(var d=a.hasZ,e=0;e<a.paths.length;e++)for(var f=a.paths[e],g=0;g<f.length;g++)b[0]=f[g][0],b[1]=f[g][1],d&&(b[2]=f[g][2]),c(b)},multipoint:function(a,c,b){var d=a.points;a=a.hasZ;for(var e=0;e<d.length;e++)b[0]=d[e][0],b[1]=d[e][1],a&&(b[2]=d[e][2]),c(b)},extent:function(a,c,b){a.hasZ?(c(g.vec3.set(b,a.xmin,a.ymin,a.zmin)),c(g.vec3.set(b,a.xmax,a.ymin,a.zmin)),
c(g.vec3.set(b,a.xmin,a.ymax,a.zmin)),c(g.vec3.set(b,a.xmax,a.ymax,a.zmin)),c(g.vec3.set(b,a.xmin,a.ymin,a.zmax)),c(g.vec3.set(b,a.xmax,a.ymin,a.zmax)),c(g.vec3.set(b,a.xmin,a.ymax,a.zmax)),c(g.vec3.set(b,a.xmax,a.ymax,a.zmax))):(c(g.vec3.set(b,a.xmin,a.ymin,b[2])),c(g.vec3.set(b,a.xmax,a.ymin,b[2])),c(g.vec3.set(b,a.xmin,a.ymax,b[2])),c(g.vec3.set(b,a.xmax,a.ymax,b[2])))},mesh:function(a,c,b){if(a=a.vertexAttributes&&a.vertexAttributes.position)for(var d=0;d<a.length;d+=3)c(g.vec3.set(b,a[d+0],a[d+
1],a[d+2]))}}})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("require exports ../../../../core/maybe ../../../../core/screenUtils ../../../../core/libs/gl-matrix-2/vec3 ../../support/geometryUtils ../../support/stack ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/intersectorUtils".split(" "),function(q,b,n,f,k,d,h,m,p){function c(a,c,b){for(var d=0;d<a.length;d++){var e=a[d];c&&!c(e)||b.push(e)}return b}Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,
c,b){this.viewingMode=a;this.layerProvider=c;this.view=b;this.tmpIntersector=new m(this.viewingMode);this.tmpRay=d.ray.create();this.externalIntersectionHandlers=new Set;this.intersectionTolerance=m.DEFAULT_TOLERANCE;this.validateHUDIntersector=new m(this.viewingMode);this.validateHUDIntersector.enable.hud=!1}b.prototype.intersectScreen=function(a,c,b,d){return this.intersectRay(this.getPickRay(a,this.tmpRay),c,b,d)};b.prototype.intersectScreenFreePointFallback=function(a,c,b,d){return this.intersectRayFreePointFallback(this.getPickRay(a,
this.tmpRay),c,b,d)};b.prototype.intersectRay=function(a,c,b,d){d=this.computeIntersection(a,b,!1,d||this.tmpIntersector);c=d?(a=d.results.min)?a.getIntersectionPoint(c):!1:!1;return c};b.prototype.intersectRayFreePointFallback=function(a,c,b,d){return this.intersectRay(a,c,b,d)||this.intersectRayFreePointLocal(a,c)};b.prototype.intersectIntersectorScreen=function(a,c,b,d,f){void 0===d&&(d=!1);void 0===f&&(f=!1);return this.computeIntersection(this.getPickRay(a,this.tmpRay),b,d,c,f)};b.prototype.intersectToolIntersectorScreen=
function(a,c,b){a=this.getPickRay(a,this.tmpRay);var d=this.computeIntersection(a,b,!0,c),e=d.results.min;this.view.basemapTerrain&&this.view.basemapTerrain.isOpaque()||e.hasIntersectionPoint&&"TerrainRenderer"!==e.intersector||(d=this.computeIntersection(a,b,!1,c));return d};b.prototype.setTolerance=function(a){void 0===a&&(a=m.DEFAULT_TOLERANCE);this.intersectionTolerance=a};b.prototype.addIntersectionHandler=function(a){this.externalIntersectionHandlers.add(a)};b.prototype.removeIntersectionHandler=
function(a){this.externalIntersectionHandlers.delete(a)};b.prototype.getPickRay=function(a,c){void 0===c&&(c=d.ray.create());return d.ray.fromScreen(this.view.state.camera,a,c)};b.prototype.intersectRayFreePointLocal=function(a,c){if("local"!==this.viewingMode)return!1;var b=this.view.dataExtent,d=Math.max(b.xmax-b.xmin,b.ymax-b.ymin,8*Math.max(b.xmax-b.xmin,b.ymax-b.ymin));if(0===d)return k.vec3.add(c,a.origin,k.vec3.normalize(h.sv3d.get(),a.direction)),!0;var e=this.view.state.camera,f=Math.max(0,
b.xmin-e.eye[0],e.eye[0]-b.xmax),b=Math.max(0,b.ymin-e.eye[1],e.eye[1]-b.ymax),e=d/Math.max(1,Math.pow(Math.max(0,Math.log(d/(Math.abs(e.relativeElevation)+Number.MIN_VALUE))),2)),e=Math.max(e,Math.min(Math.sqrt(f*f+b*b),d)),d=k.vec3.scale(h.sv3d.get(),a.direction,e/k.vec3.length(a.direction));k.vec3.add(c,a.origin,d);return!0};b.prototype.computeIntersection=function(c,b,d,l,n){var e=this,g=this.view.state.camera,r=f.castRenderScreenPointArray3(h.sv3d.get());g.projectPoint(c.origin,r);var t=this.prepareFilters(b,
a);l=l||new m(this.viewingMode);l.enable.storeAll=b&&b.allEnabled;l.enable.storeTerrainResults=t.filterLayerUid(p.TERRAIN_ID);l.enable.selectOpaqueTerrainOnly=!b||!("include"in b||"exclude"in b);var u=c.origin,q=k.vec3.add(h.sv3d.get(),c.origin,c.direction);l.intersect(t.layers,u,q,r,g,this.intersectionTolerance,d,null);var B=(c=this.view.slicePlane)?p.sliceFilterPredicate(c):null;l.intersect(t.sliceableLayers,u,q,r,g,this.intersectionTolerance,d,B,!1);var C=b&&b.terrainLocationFeedbackEnabled||n;
this.externalIntersectionHandlers.forEach(function(a){if(a.intersectionHandlerId===p.TERRAIN_ID){if(!C&&!t.filterLayerUid(p.TERRAIN_ID))return}else if(!t.filterLayerUid(a.intersectionHandlerId))return;a.intersect(l,a.slicePlaneEnabled?B:null,u,q,r)});b=h.sv3d.get();n&&l.results.terrain.getIntersectionPoint(b)&&(n=this.view._stage.getDrapedRenderer(),c=h.sv3d.get(),this.view.renderCoordsHelper.fromRenderCoords(b,c,this.view.spatialReference),c[2]=this.view.basemapTerrain.getElevation(b)||0,n.intersect(l,
c,t.filterRenderGeometry));l.sortResults();n=l.results.hud;if(n.hasIntersectionPoint){var E=f.castRenderScreenPointArray3(h.sv3d.get()),F=h.sv3d.get(),H=h.sv3d.get();this.unprojectHUDResultRay(n.center,E,F,H);b=k.vec3.distance(n.center,F)/k.vec3.distance(F,H)*.99;this.validateHUDIntersector.intersect(t.layers,F,H,E,g,this.intersectionTolerance,d,null);this.validateHUDIntersector.intersect(t.sliceableLayers,F,H,E,g,this.intersectionTolerance,d,B,!1);this.externalIntersectionHandlers.forEach(function(a){t.filterLayerUid(a.intersectionHandlerId)&&
a.intersect(e.validateHUDIntersector,a.slicePlaneEnabled?B:null,F,H,E)});d=this.validateHUDIntersector.results.min;if(null==d.dist||b<=d.dist)l.results.min.copyFrom(n),l.results.all.splice(0,0,n)}return l};b.prototype.prepareFilters=function(a,b){var d=[],e=[];this.layerProvider.forEachLayer(function(a){a.isPickable&&(a.isSliceable?e:d).push(a)});b.include=a&&a.include;b.exclude=a&&a.exclude;b.layers.length=0;b.sliceableLayers.length=0;c(d,b.filterLayer,b.layers);c(e,b.filterLayer,b.sliceableLayers);
return b};b.prototype.unprojectHUDResultRay=function(a,c,b,d){var e=this.view.state.camera;e.projectPoint(a,c);a=f.castRenderScreenPointArray3(h.sv3d.get());a[0]=c[0];a[1]=c[1];a[2]=0;e.unprojectPoint(a,b);a[2]=1;e.unprojectPoint(a,d)};return b}();b.SceneIntersectionHelper=q;var a={include:null,exclude:null,layers:[],sliceableLayers:[],filterLayer:function(c){return a.filterLayerUid(c.apiLayerUid)},filterLayerUid:function(c){var b=a.include,d=a.exclude;return n.isNone(c)?null==b&&null==d:(null==b||
b.has(c))&&(null==d||!d.has(c))},filterRenderGeometry:function(c){return a.filterLayerUid(c.data.layerUid)}}})},"esri/views/3d/support/CombinedElevationProvider":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/Accessor ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../layers/graphics/ElevationQuery ./Evented".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l){return function(b){function d(a){a=b.call(this)||this;a.providers={im:[],ground:[],scene:[]};a.handles=new Map;return a}n(d,b);d.prototype.getElevation=function(a,c){var b=-Infinity,d=!0;"scene"===c&&(b=this._updateElevation(b,this.providers.im,a,c),isFinite(b)&&(d=!1));d&&(b=this._updateElevation(b,this.providers.ground,a,c));"scene"===c&&(b=this._updateElevation(b,this.providers.scene,a,c));return isFinite(b)?b:null};d.prototype._updateElevation=function(a,c,b,
d){for(var e=0;e<c.length;e++){var f=c[e].getElevation(b,d);null!=f&&(a=Math.max(f,a))}return a};d.prototype.queryElevation=function(b,d,e){var f=this;void 0===d&&(d=0);this._elevationService||(this._elevationService=new a.ElevationQuery(this.view.spatialReference,function(){return f.view.map&&f.view.map.ground},{maximumAutoTileRequests:4}));var g=m.createResolver();(c.isPoint(b)?this._elevationService.queryElevation(b.x,b.y,d):this._elevationService.queryElevation(b[0],b[1],d)).then(function(a){"scene"===
e&&(a=f._updateElevation(a,f.providers.scene,b,e));g.resolve(isFinite(a)?a:null)}).catch(function(){return g.resolve(f.getElevation(b))});return g.promise};d.prototype.register=function(a,c){var b=this;this.handles.set(c,c.on("elevation-change",function(a){return b.emit("elevation-change",a)}));this.providers[a].push(c)};d.prototype.unregister=function(a){this.handles.has(a)&&(this.handles.get(a).remove(),this.handles.delete(a));for(var c=0,b=Object.keys(this.providers);c<b.length;c++){var d=b[c],
e=this.providers[d].indexOf(a);-1<e&&this.providers[d].splice(e,1)}};f([p.property({constructOnly:!0})],d.prototype,"view",void 0);f([p.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],d.prototype,"spatialReference",void 0);return d=f([p.subclass("esri.views.3d.support.CombinedElevationProvider")],d)}(p.declared(h,l.Evented))})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper ../../../../geometry ../../../../core/promiseUtils ../../../../core/scheduling".split(" "),
function(q,b,n,f,k,d,h,m){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(c,a){this.spatialReference=c;this.view=a;this.point=new d.Point;this.point.spatialReference=c}b.prototype.getElevation=function(c,a,b){this.point.x=c;this.point.y=a;return this.view.elevationProvider.getElevation(this.point,b)};b.prototype.queryElevation=function(c,a,b,d){return f(this,void 0,void 0,function(){return n(this,function(e){this.point.x=c;this.point.y=a;return[2,this.view.elevationProvider.queryElevation(this.point,
b,d)]})})};return b}();b.ViewElevationProvider=q;q=function(){function b(c,a,b){this.spatialReference=c;this._getElevationQueryProvider=a;this._queries=[];this._isScheduled=!1;this._queryOptions=k({},b,{ignoreInvisibleLayers:!0})}b.prototype.queryElevation=function(c,a,b){void 0===b&&(b=0);return f(this,void 0,void 0,function(){var d=this;return n(this,function(e){return[2,h.create(function(e,f){d._queries.push({x:c,y:a,minDemResolution:b,result:{resolve:e,reject:f}});d._scheduleDoQuery()})]})})};
b.prototype._scheduleDoQuery=function(){var c=this;this._isScheduled||(m.schedule(function(){return c._doQuery()}),this._isScheduled=!0)};b.prototype._doQuery=function(){return f(this,void 0,void 0,function(){var c,a,b,f,e,h,m,p,q;return n(this,function(g){switch(g.label){case 0:this._isScheduled=!1;c=this._queries;this._queries=[];a=c.map(function(a){return[a.x,a.y]});b=c.reduce(function(a,c){return Math.min(a,c.minDemResolution)},Infinity);f=new d.Multipoint({points:a,spatialReference:this.spatialReference});
e=this._getElevationQueryProvider();if(!e)return c.forEach(function(a,c){return a.result.reject()}),[2];m=k({},this._queryOptions,{minDemResolution:b});g.label=1;case 1:return g.trys.push([1,3,,4]),[4,e.queryElevation(f,m)];case 2:return h=g.sent(),[3,4];case 3:return p=g.sent(),c.forEach(function(a){return a.result.reject(p)}),[2];case 4:return q=h.geometry.points,c.forEach(function(a,c){return a.result.resolve(q[c][2])}),[2]}})})};return b}();b.ElevationQuery=q})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["require",
"exports","../../../core/has"],function(q,b,n){function f(){var b=!!n("esri-mobile");return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfPrimitives:85E4},sceneService:{"3dObject":{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5},antialiasingEnabled:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},
medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:b},tiledSurface:{lodBias:0,angledSplitBias:1},antialiasingEnabled:!0,memoryLimit:b?400:500,additionalCacheMemory:b?0:100,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5},sceneService:{"3dObject":{lodFactor:1},
point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1},antialiasingEnabled:!0,memoryLimit:b?600:1E3,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:b?null:4096,maximumPixelRatio:b?1:null}}}q=function(){function b(){}b.isValidProfile=function(d){return d in b.profiles};b.getDefaultProfile=function(){return n("esri-iPhone")?"low":"medium"};b.apply=function(d,f){d=b.profiles[d];f.graphics3D.maxTotalNumberOfFeatures=
d.graphics3D.maxTotalNumberOfFeatures;f.graphics3D.maxTotalNumberOfPrimitives=d.graphics3D.maxTotalNumberOfPrimitives;f.sceneService["3dObject"].lodFactor=d.sceneService["3dObject"].lodFactor;f.sceneService.point.lodFactor=d.sceneService.point.lodFactor;f.sceneService.integratedMesh.lodFactor=d.sceneService.integratedMesh.lodFactor;f.sceneService.pointCloud.lodFactor=d.sceneService.pointCloud.lodFactor;f.sceneService.uncompressedTextureDownsamplingEnabled=d.sceneService.uncompressedTextureDownsamplingEnabled;
f.tiledSurface.lodBias=d.tiledSurface.lodBias;f.tiledSurface.angledSplitBias=d.tiledSurface.angledSplitBias;f.antialiasingEnabled=d.antialiasingEnabled;f.memoryLimit=d.memoryLimit;f.additionalCacheMemory=d.additionalCacheMemory;f.frameRate=d.frameRate;f.maximumRenderResolution=d.maximumRenderResolution;f.maximumPixelRatio=d.maximumPixelRatio};b.debug={reset:function(){var d=f(),h;for(h in d)b.profiles[h]=d[h]}};return b}();(q||(q={})).profiles=f();return q})},"esri/views/3d/support/HighlightOptions":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec4f32".split(" "),
function(q,b,n,f,k,d,h,m){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.color=new k([0,255,255]);a.haloOpacity=1;a.fillOpacity=.25;return a}n(c,b);c.toEngineOptions=function(a){var c=k.toUnitRGBA(a.color);return{color:m.vec4f32.fromValues(c[0],c[1],c[2],c[3]),haloOpacity:a.haloOpacity,haloOpacityOccluded:.25*a.haloOpacity,fillOpacity:a.fillOpacity,fillOpacityOccluded:.25*a.fillOpacity}};f([h.property({type:k})],c.prototype,"color",void 0);f([h.property()],c.prototype,
"haloOpacity",void 0);f([h.property()],c.prototype,"fillOpacity",void 0);return c=f([h.subclass()],c)}(h.declared(d))})},"esri/views/3d/support/index":function(){define(["require","exports","./ResourceController","./MemoryController"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});b.newResourceController=n.newResourceController;b.newMemoryController=f.newMemoryController;q=b.ClientType||(b.ClientType={});q.TERRAIN="terrain";q.SCENE="scene";q.SYMBOLOGY="symbology"})},"esri/views/3d/support/ResourceController":function(){define("require exports ../../../core/Handles ../../../core/now ../../../core/scheduling ./index ./MemoryController ./StreamDataLoader ./StreamDataSupplier ../../support/Scheduler".split(" "),
function(q,b,n,f,k,d,h,m,p,c){Object.defineProperty(b,"__esModule",{value:!0});b.newResourceController=function(c,b){void 0===b&&(b=f);return new a.ResourceController(c,b)};var a;(function(a){function b(a){var c={},b;for(b in d.ClientType)c[d.ClientType[b]]=0;c[d.ClientType.TERRAIN]=15;c[d.ClientType.SCENE]=20;c[d.ClientType.SYMBOLOGY]=5;return new m.default(c,a)}var e=function(){function a(a,d){void 0===d&&(d=f);var e=this;this._view=a;this._streamDataLoader=this._memoryController=this._scheduler=
null;this._lastTargetChangeTime=0;this._handles=new n;this._frameTask=null;this._lastTargetChangeTime=d();this._scheduler=c.newScheduler(d);this._memoryController=h.newMemoryController(this._view);this._streamDataLoader=b(this._scheduler);this._handles.add(this._view.watch("state.camera",function(){return e._cameraChangedHandler()},!0));this._frameTask=k.addFrameTask({update:function(a){return e.frame(a)}})}a.prototype.destroy=function(){this._handles.remove();this._frameTask&&(this._frameTask.remove(),
this._frameTask=null);this._streamDataLoader&&(this._streamDataLoader.destroy(),this._streamDataLoader=null);this._memoryController.destroy();this._scheduler=this._memoryController=null};Object.defineProperty(a.prototype,"updating",{get:function(){return this._memoryController.updating},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"scheduler",{get:function(){return this._scheduler},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"memoryController",{get:function(){return this._memoryController},
enumerable:!0,configurable:!0});a.prototype.getStreamDataSupplier=function(a,c){return new p.StreamDataSupplier(a,this._streamDataLoader,c)};a.prototype.frame=function(a){this._view.suspended||(this._view.stateManager&&this._view.stateManager.step(a.deltaTime/1E3),this._scheduler.state=this.state,this._scheduler.updateBudget(a)?(this._memoryController.update(),this._scheduler.frame(a)):this._memoryController.updating&&this._memoryController.update())};a.prototype._cameraChangedHandler=function(){this._lastTargetChangeTime=
this._scheduler.now;this._scheduler.state=this.state;this.memoryController.notifyViewChanged()};Object.defineProperty(a.prototype,"state",{get:function(){return this._scheduler.now-this._lastTargetChangeTime>l?2:this._view.animation?0:1},enumerable:!0,configurable:!0});return a}();a.ResourceController=e;var l=300})(a||(a={}))})},"esri/views/3d/support/MemoryController":function(){define("require exports ../../../core/Logger ../../../core/MemCache ../layers/support/MemoryManagedLayerView ./Evented".split(" "),
function(q,b,n,f,k,d){Object.defineProperty(b,"__esModule",{value:!0});var h=n.getLogger("esri.views.3d.support.MemoryController");b.newMemoryController=function(b){return new m(b)};var m=function(){function b(c){this._view=c;this.events=new d.Evented;this._maxMemory=500;this._additionalCacheMemory=100;this._quality=1;this._downscaleMemoryUsed=this._stableQuality=0;this._canFastRecover=!1;this._memoryPredicted=this._memoryUsed=0;this._cacheStorage=new f.Storage;this._updating=!1}b.prototype.destroy=
function(){this.events=null};b.prototype.getMemCache=function(c,a){return new f(c,this._cacheStorage,a)};Object.defineProperty(b.prototype,"maxMemory",{set:function(c){null!=c&&0<c&&(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<c&&this._updateQuality(1),this._maxMemory=c)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"additionalCacheMemory",{set:function(c){null!=c&&0<=c&&(this._additionalCacheMemory=c)},enumerable:!0,configurable:!0});b.prototype.disableMemCache=
function(){this._additionalCacheMemory=-4096};Object.defineProperty(b.prototype,"memoryFactor",{get:function(){return this._quality},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"updating",{get:function(){return this._updating},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"usedMemory",{get:function(){return this._memoryUsed},enumerable:!0,configurable:!0});b.prototype.notifyViewChanged=function(){this._stableQuality=0};b.prototype.update=function(){this._updateMemory();
if(!(0>=this._memoryPredicted)||this._updating){var c=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(c){if(.1>=this._quality)return;if(1.1<this._memoryPredicted||1<this._memoryUsed)0<this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=
this._memoryUsed)}else this._downscaleMemoryUsed=0,1<this._memoryUsed?(this._stableQuality=0,this._canFastRecover=!1,c=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._memoryUsed&&1>this._quality?(this._stableQuality=this._quality,c=this._updateQuality(this._quality+.1*(.75-this._memoryPredicted+.1))):1>this._quality&&(this._canFastRecover=!0));this.updating!==c&&(this._updating=c,this.events.emit("updating-changed",
this.updating))}};b.prototype._updateQuality=function(c){c=Math.min(Math.max(c,.1),1);if(c===this._quality)return!1;this._quality=c;this.events.emit("quality-changed",this._quality);return!0};b.prototype._layersUpdating=function(){var c=this._view.basemapTerrain&&this._view.basemapTerrain.hasPendingUpdates();this._view.allLayerViews.forEach(function(a){return c=c||a.updating});return!!c};b.prototype._updateMemory=function(){var c=this,a=0,b=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&
(a+=this._view.basemapTerrain.getUsedMemory());var d=this._view._stage&&this._view._stage.view&&this._view._stage.view.edgeView;d&&(a+=d.getUsedMemory());this._view.allLayerViews&&this._view.allLayerViews.forEach(function(d){if(k.isMemoryManagedLayerView(d)){var e=d.ignoresMemoryFactor()?c._quality:1;a+=d.getUsedMemory()*e;b+=d.getUnloadedMemory()*e}});var e=null==this._warnMemoryUsage||Math.round(10*a)!==Math.round(10*this._warnMemoryUsage),d=1048576*this._maxMemory;if(a>d&&e){this._warnMemoryUsage=
a;var e=function(a){return(a/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB"},f=Math.round(100*this._quality);h.warn("Memory Limit exceeded! Limit: "+e(d)+" Current: "+e(a)+" Projected: "+e(a+b)+" Quality: "+f+"%")}this._memoryUsed=a/d;this._memoryPredicted=(a+b)/d;this._cacheStorage.maxSize=Math.max(0,d-a+1048576*this._additionalCacheMemory);this.events.emit("memory-used",this._memoryUsed)};Object.defineProperty(b.prototype,"test",{get:function(){return{cacheStorage:this._cacheStorage}},
enumerable:!0,configurable:!0});return b}()})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.isMemoryManagedLayerView=function(b){return"function"===typeof b.getUsedMemory}})},"esri/views/3d/support/StreamDataLoader":function(){define("require exports dojo/errors/CancelError ../../../request ../../../core/arrayUtils ../../../core/lang ../../../core/now ./AsyncQuotaRoundRobinQueue ./PromiseLightweight ../webgl-engine/lib/Util".split(" "),
function(q,b,n,f,k,d,h,m,p,c){Object.defineProperty(b,"__esModule",{value:!0});b.ClientPromise=p.default;q=function(){function a(a,c){var b=this;this.tasks=new Map;this.clientPromiseToTask=new Map;this.doneQueue=[];this.loadQueue=new m(this.startLoading.bind(this),this.doneLoadingCallback,this,a);c&&(this.taskHandle=c.registerTask(1,function(a){return b.update(a)},function(){return 0<b.doneQueue.length}))}a.prototype.destroy=function(){var a=this;this.taskHandle&&(this.taskHandle.remove(),this.taskHandle=
null);this.tasks.forEach(function(c){var b=0;for(c=c.clientPromises;b<c.length;b++)a.cancel(c[b])});this.loadQueue.clear();this.clientPromiseToTask=this.tasks=this.doneQueue=this.loadQueue=null};a.prototype.request=function(a,c,d,f){var e=this;void 0===f&&(f=a);var g=new b.ClientPromise(function(){e.cancel(g)});this.createOrUpdateTask(a,c,d,f,g);return g};a.prototype.createTask=function(a,c,b,d,f){a={url:a,docType:c,clientType:b,key:d,result:null,status:1,clientPromises:[],downloadObj:null,_cancelledInQueue:!1,
startTime:0,duration:0,size:0};this.updateTask(a,f);this.tasks.set(d,a);this.loadQueue.push(a)};a.prototype.cancel=function(a){var c=this.clientPromiseToTask.get(a);c&&(a.reject(new n),k.removeUnordered(c.clientPromises,a),this.clientPromiseToTask.delete(a),0===c.clientPromises.length&&(2===c.status&&(this.loadQueue.workerCancelled(c),c.status=4,c.downloadObj.cancel(),c.downloadObj=null),c.status=4,this.tasks.delete(c.key)))};a.prototype.hasPendingDownloads=function(){return 0<this.tasks.size};a.prototype.taskKey=
function(a,c,b){return a+":"+c+":"+b};a.prototype.updateTask=function(a,c){this.clientPromiseToTask.set(c,a);a.clientPromises.push(c)};a.prototype.createOrUpdateTask=function(a,c,b,d,f){d=this.taskKey(d,c,b);var e=this.tasks.get(d);e?this.updateTask(e,f):this.createTask(a,c,b,d,f)};a.prototype.doneLoadingCallback=function(a,b){c.assert(2===a.status);this.taskHandle?(a.status=3,this.doneQueue.push({task:a,err:b})):this.doneLoading(a,b)};a.prototype.update=function(a){for(;!a.done&&0<this.doneQueue.length;){var c=
this.doneQueue.shift();3!==c.task.status&&(c.err=c.err||new n);this.doneLoading(c.task,c.err);a.madeProgress()}};a.prototype.doneLoading=function(a,c){for(var b=a.result instanceof HTMLImageElement?0:a.clientPromises.length,f=0,g=a.clientPromises;f<g.length;f++){var h=g[f];this.clientPromiseToTask.delete(h);if(c)h.isRejected()||h.reject({url:a.url,error:c});else{--b;var l=0>=b?a.result:d.clone(a.result);h.resolve({url:a.url,data:l})}}this.tasks.delete(a.key)};a.prototype.startLoading=function(a,c){if(4===
a.status)return!1;a.status=2;var b,d;switch(a.docType){case "binary":d="array-buffer";b=0;break;case "image":d="image";break;default:d="json"}a.startTime=h();a.downloadObj=f(a.url,{responseType:d,timeout:b});a.downloadObj.then(function(b){a.duration=h()-a.startTime;a.size="binary"===a.docType?b.data.byteLength:0;a.result=b.data;c(a)},function(b){a.downloadObj.isCanceled()||c(a,b)});return!0};Object.defineProperty(a.prototype,"test",{get:function(){return{loadQueue:this.loadQueue}},enumerable:!0,configurable:!0});
return a}();b.StreamDataLoader=q;b.default=q})},"esri/views/3d/support/AsyncQuotaRoundRobinQueue":function(){define(["require","exports","../../../core/arrayUtils","../webgl-engine/lib/Util"],function(q,b,n,f){return function(){function b(b,f,k,p){this.workerFunc=b;this.robin=0;this.type2id={};this.tasks=[];this.typeNumWorkers=[];this.typeWorkerQuota=[];this.typeStatistics=[];this.numTypes=this.maxTotalNumWorkers=this.totalNumWorkers=0;for(var c in p)this.type2id[c]=this.tasks.length,this.tasks.push([]),
this.typeNumWorkers.push(0),this.typeStatistics.push({requests:0,size:0,duration:0,speed:0}),this.typeWorkerQuota.push(p[c]),this.maxTotalNumWorkers+=p[c];this.numTypes=this.tasks.length;var a=this;this.taskCallback=function(c){c._cancelledInQueue||(f.apply(k,arguments),a.taskFinished(c))}}b.prototype.setWorkerQuota=function(b){f.assert(n.equals(Object.keys(this.typeWorkerAllocation),Object.keys(b)));this.typeWorkerAllocation=b;this.maxTotalNumWorkers=0;for(var d in b)this.typeWorkerQuota[this.type2id[d]]=
b[d],this.maxTotalNumWorkers+=b[d]};b.prototype.push=function(b){var d=this.type2id[b.clientType];this.totalNumWorkers<this.maxTotalNumWorkers?(this.typeNumWorkers[d]++,this.totalNumWorkers++,this.workerFunc(b,this.taskCallback)):this.tasks[d].push(b)};b.prototype._getStatsForType=function(b){b=this.type2id[b];return{quota:this.typeWorkerQuota[b],workers:this.typeNumWorkers[b],queueSize:this.tasks[b].length,requestStats:this.typeStatistics[b]}};b.prototype.removeTasks=function(b,f){for(var d=[],h=
0,c=this.tasks[this.type2id[f]];h<c.length;h++){var a=c[h];-1===b.indexOf(a)&&d.push(a)}this.tasks[this.type2id[f]]=d};b.prototype.workerCancelled=function(b){this.taskFinished(b);b._cancelledInQueue=!0};b.prototype.clear=function(){for(var b=0;b<this.tasks.length;b++)this.tasks[b]=[]};b.prototype.taskFinished=function(b){var d=this.type2id[b.clientType];this.typeNumWorkers[d]--;this.totalNumWorkers--;this.typeStatistics[d].requests++;this.typeStatistics[d].size+=b.size||0;this.typeStatistics[d].duration+=
b.duration||0;this.typeStatistics[d].speed=0<this.typeStatistics[d].duration?this.typeStatistics[d].size/this.typeStatistics[d].duration:0;f.assert(0<=this.typeNumWorkers[d]);this.next()};b.prototype.next=function(){var b=this.robin,f=!1;do this.typeNumWorkers[b]<this.typeWorkerQuota[b]&&this.processQueue(b)&&(f=!0),b=(b+1)%this.numTypes;while(!f&&b!==this.robin);if(!f){do this.processQueue(b)&&(f=!0),b=(b+1)%this.numTypes;while(!f&&b!==this.robin)}this.robin=b};b.prototype.processQueue=function(b){for(;0<
this.tasks[b].length;)if(this.workerFunc(this.tasks[b].shift(),this.taskCallback))return this.typeNumWorkers[b]++,this.totalNumWorkers++,!0;return!1};Object.defineProperty(b.prototype,"test",{get:function(){var b=this;return{set workerFunc(d){b.workerFunc=d}}},enumerable:!0,configurable:!0});return b}()})},"esri/views/3d/support/StreamDataSupplier":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,k,d){this._clientType=
b;this._loader=k;this._activeRequests=null;d&&d.trackRequests&&(this._activeRequests=new Map)}b.prototype.request=function(b,k,d){var f=this;void 0===d&&(d=b);if(this._activeRequests&&this._activeRequests.has(b))return null;b=this._loader.request(b,k,this._clientType,d);this._activeRequests&&(this._activeRequests.set(d,b),k=function(){return f._activeRequests.delete(d)},b.then(k,k));return b};b.prototype.cancelRequest=function(b){this._loader.cancel(b)};b.prototype.cancelAll=function(){var b=this;
this._activeRequests&&(this._activeRequests.forEach(function(f){return b._loader.cancel(f)}),this._activeRequests.clear())};b.prototype.hasPendingDownloads=function(){return this._loader.hasPendingDownloads()};return b}();b.StreamDataSupplier=q;b.default=q})},"esri/views/support/Scheduler":function(){define(["require","exports","../../core/maybe","../../core/PooledArray"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});b.newScheduler=function(b){return new k.Scheduler(b)};b.newBudget=
function(b){return new k.Budget(b)};var k;(function(b){var d=function(){function d(c){this._now=c;this._budget=null;this._state=1;this._tasks=new f;this._runQueue=new f;this._idleStateCallbacks=new f;this._forceTask=this._idleUpdatesStartFired=!1;this._safetyBudget=0;this._budget=new b.Budget(c);var a=this;this._test={state:void 0,idleBudget:100,get budget(){return a._budget.budget},elapsed:0}}d.prototype.registerTask=function(c,a,b){var d=this,e={update:a,needsUpdate:b,priority:c,schedule:c};this._tasks.push(e);
return{remove:function(){return d._removeTask(e)},set priority(a){e.priority=a;0!==e.schedule&&(e.schedule=a)}}};d.prototype.registerIdleStateCallbacks=function(c,a){var b=this,d={idleBegin:c,idleEnd:a};this._idleStateCallbacks.push(d);2===this.state&&this._idleUpdatesStartFired&&d.idleBegin();var e=this;return{remove:function(){return b._removeIdleStateCallbacks(d)},set idleBegin(a){e._idleUpdatesStartFired&&(d.idleEnd(),2===e._state&&a());d.idleBegin=a},set idleEnd(a){d.idleEnd=a}}};Object.defineProperty(d.prototype,
"now",{get:function(){return this._now()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"state",{get:function(){return n.isNone(this._test.state)?this._state:this._test.state},set:function(c){this._state!==c&&(this._state=c,2!==this.state&&this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=!1,this._idleStateCallbacks.forEach(function(a){return a.idleEnd()})))},enumerable:!0,configurable:!0});d.prototype.updateBudget=function(c){var a=2===this.state,b=c.frameDuration;switch(this.state){case 2:b=
100;break;case 1:b=Math.max(33,c.frameDuration);break;case 0:b=c.frameDuration}this._safetyBudget=a?0:b>2.5*c.tickTime?c.tickTime:5;b-=c.elapsedFrameTime+this._safetyBudget;this._test.elapsed=0;if(!a&&0>b&&!this._forceTask)return this._forceTask=!0,!1;b=Math.max(b,5);this._budget.reset(b,a);return this._schedule()};d.prototype.frame=function(c){this._forceTask=!1;switch(this.state){case 2:this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this._idleStateCallbacks.forEach(function(a){return a.idleBegin()}));
this._idleFrame();break;case 1:this._movingFrame();break;default:this._run()}this._test.elapsed=this._budget.elapsed};d.prototype._removeIdleStateCallbacks=function(c){this._idleUpdatesStartFired&&c.idleEnd();this._idleStateCallbacks.removeUnordered(c)};d.prototype._removeTask=function(c){this._tasks.removeUnordered(c);this._runQueue.removeUnordered(c)};d.prototype._idleFrame=function(){this._run()};d.prototype._movingFrame=function(){this._run()};d.prototype._schedule=function(){var c=this;this._runQueue.forEach(function(a){a.needsUpdate()||
(k.push(a),a.schedule=a.priority)});this._runQueue.removeUnorderedMany(k.data,k.length);k.clear();for(var a=function(){var a=!1;b._tasks.forEach(function(b){if(b.needsUpdate())switch(a=!0,b.schedule){case 0:break;case 1:b.schedule=0;c._runQueue.push(b);break;default:--b.schedule}});if(!a)return{value:!1}},b=this;0===this._runQueue.length;){var d=a();if("object"===typeof d)return d.value}return!0};d.prototype._run=function(){for(;0<this._runQueue.length;){var c=this._runQueue.pop();this._budget.resetProgress();
c.update(this._budget);c.schedule=c.priority;if(0>=this._budget.remaining)break}};Object.defineProperty(d.prototype,"test",{get:function(){return this._test},enumerable:!0,configurable:!0});return d}();b.Scheduler=d;var k=new f,d=function(){function b(c){this.now=c;this._budget=this._begin=0;this._didWork=this._idle=!1}b.prototype.run=function(c){if(this.done)return!1;!0===c()&&(this._didWork=!0);return!0};Object.defineProperty(b.prototype,"done",{get:function(){return this._didWork&&this.elapsed>=
this._budget},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"budget",{get:function(){return this._budget},enumerable:!0,configurable:!0});b.prototype.madeProgress=function(){this._didWork=!0};Object.defineProperty(b.prototype,"idleFrame",{get:function(){return this._idle},enumerable:!0,configurable:!0});b.prototype.reset=function(c,a){this._begin=this.now();this._budget=c;this._idle=a;this._didWork=!1};Object.defineProperty(b.prototype,"remaining",{get:function(){return Math.max(this._budget-
this.elapsed,0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"elapsed",{get:function(){return this.now()-this._begin},enumerable:!0,configurable:!0});b.prototype.resetProgress=function(){this._didWork=!1};Object.defineProperty(b.prototype,"hasProgressed",{get:function(){return this._didWork},enumerable:!0,configurable:!0});return b}();b.Budget=d})(k||(k={}))})},"esri/views/3d/support/MapCoordsHelper":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/promiseUtils ../../../core/unitUtils ../../../portal/support/geometryServiceUtils ../../../tasks/support/ProjectParameters".split(" "),
function(q,b,n,f,k,d,h,m){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(c,a,b){void 0===b&&(b=null);var f=this;this.spatialReference=a;this.unitInMeters=d.getMetersPerUnitForSR(this.spatialReference);(this.geometryService=b)||h.create(c&&c.get("portalItem")).then(function(a){f.geometryService=a}).catch(function(){})}b.prototype.toGeographic=function(c){var a=this,b=!0;if(!this.geometryService)return k.reject(new f("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config"));
Array.isArray(c[0])&&"number"!==typeof c[0]||(c=[c],b=!1);c=c.map(function(c){return c instanceof n.Point?c:new n.Point(c,a.spatialReference)});c=new m({geometries:c,outSpatialReference:n.SpatialReference.WGS84});return this.geometryService.project(c).then(function(a){a=a.map(function(a){if("point"===a.type)return[a.x,a.y]});return b?a:a[0]})};b.prototype.canProject=function(){return!!this.geometryService};return b}();b.MapCoordsHelper=q;b.default=q})},"esri/views/3d/support/QualitySettings":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(q,b,n,f,k,d){var h=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.minTotalNumberOfFeatures=2E3;c.maxTotalNumberOfFeatures=5E4;c.maxTotalNumberOfPrimitives=17E5;return c}n(c,a);f([d.property()],c.prototype,"minTotalNumberOfFeatures",void 0);f([d.property()],c.prototype,"maxTotalNumberOfFeatures",void 0);f([d.property()],c.prototype,"maxTotalNumberOfPrimitives",void 0);return c=f([d.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],c)}(d.declared(k)),
m=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.lodFactor=1;return c}n(c,a);f([d.property()],c.prototype,"lodFactor",void 0);return c=f([d.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],c)}(d.declared(k)),p=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c["3dObject"]=new m;c.point=new m;c.integratedMesh=new m;c.pointCloud=new m;c.uncompressedTextureDownsamplingEnabled=!1;return c}n(c,a);f([d.property({type:m})],c.prototype,"3dObject",
void 0);f([d.property({type:m})],c.prototype,"point",void 0);f([d.property({type:m})],c.prototype,"integratedMesh",void 0);f([d.property({type:m})],c.prototype,"pointCloud",void 0);f([d.property()],c.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return c=f([d.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],c)}(d.declared(k)),c=function(a){function c(){var c=null!==a&&a.apply(this,arguments)||this;c.lodBias=0;c.angledSplitBias=1;return c}n(c,a);f([d.property()],
c.prototype,"lodBias",void 0);f([d.property()],c.prototype,"angledSplitBias",void 0);return c=f([d.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],c)}(d.declared(k));return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b.graphics3D=new h;b.sceneService=new p;b.tiledSurface=new c;b.antialiasingEnabled=!0;return b}n(b,a);f([d.property({type:h})],b.prototype,"graphics3D",void 0);f([d.property({type:p})],b.prototype,"sceneService",void 0);f([d.property({type:c})],
b.prototype,"tiledSurface",void 0);f([d.property()],b.prototype,"antialiasingEnabled",void 0);f([d.property()],b.prototype,"memoryLimit",void 0);f([d.property()],b.prototype,"additionalCacheMemory",void 0);f([d.property()],b.prototype,"frameRate",void 0);f([d.property()],b.prototype,"maximumRenderResolution",void 0);f([d.property()],b.prototype,"maximumPixelRatio",void 0);return b=f([d.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],b)}(d.declared(k))})},"esri/views/3d/support/RenderCoordsHelper":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/compilerUtils ../../../core/unitUtils ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/vec3 ../../../geometry/SpatialReference ../../../layers/graphics/dehydratedFeatures ./earthUtils ./geometryUtils ./projectionUtils ./stack ./geometryUtils/coordinateSystem".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a,c,b,d){this.type=a;this.spatialReference=c;this.unitInMeters=b;this.coordinateSystem=d;this.tmpCoordinateSystem=e.create(d)}Object.defineProperty(b.prototype,"extent",{set:function(a){a&&e.setExtent(this.coordinateSystem,a,this.coordinateSystem)},enumerable:!0,configurable:!0});b.prototype.getAltitude=function(a){return e.altitudeAt(this.coordinateSystem,a)};b.prototype.setAltitude=function(a,
c){e.setAltitudeAt(this.coordinateSystem,c,a,c)};b.prototype.setAltitudeOfTransformation=function(a,c){e.setAltitudeOfTransformation(this.coordinateSystem,c,a,c)};b.prototype.worldUpAtPosition=function(a,c){return e.normalAt(this.coordinateSystem,a,c)};b.prototype.worldBasisAtPosition=function(a,c,b){return e.axisAt(this.coordinateSystem,a,c,b)};b.prototype.basisMatrixAtPosition=function(a,c){var b=this.worldBasisAtPosition(a,0,g.sv3d.get()),e=this.worldBasisAtPosition(a,1,g.sv3d.get());a=this.worldBasisAtPosition(a,
2,g.sv3d.get());d.mat4.set(c,b[0],b[1],b[2],0,e[0],e[1],e[2],0,a[0],a[1],a[2],0,0,0,0,1);return c};b.prototype.intersectManifoldClosestSilhouette=function(a,c,b){e.elevate(this.coordinateSystem,c,this.tmpCoordinateSystem);e.intersectRayClosestSilhouette(this.tmpCoordinateSystem,a,b);return b};b.prototype.intersectManifold=function(a,c,b){e.elevate(this.coordinateSystem,c,this.tmpCoordinateSystem);c=g.sv3d.get();return e.intersectRay(this.tmpCoordinateSystem,a,c)?(h.vec3.copy(b,c),!0):!1};b.prototype.intersectInfiniteManifold=
function(c,b,d){if("global"===this.type)return this.intersectManifold(c,b,d);e.elevate(this.coordinateSystem,b,this.tmpCoordinateSystem);b=this.tmpCoordinateSystem.value;var f=g.sv3d.get();return a.plane.intersectRay(b.plane,c,f)?(h.vec3.copy(d,f),!0):!1};b.prototype.toRenderCoords=function(a,c,b){return p.isPoint(a)?l.pointToVector(a,c,this.spatialReference):l.vectorToVector(a,c,b,this.spatialReference)};b.prototype.fromRenderCoords=function(a,c,b){return p.isPoint(c)?l.vectorToPoint(a,this.spatialReference,
c,b):c instanceof m?l.vectorToPoint(a,this.spatialReference,c):l.vectorToVector(a,this.spatialReference,c,b)};b.createGlobal=function(d){void 0===d&&(d=l.SphericalECEFSpatialReference);var f=e.fromValues(a.sphere,a.sphere.fromValues(c.earthRadius,[0,0,0]));return new b("global",d,1,f)};b.createLocal=function(c){var d=e.fromValues(a.boundedPlane,a.boundedPlane.fromValues([0,0,0],[u,0,0],[0,u,0])),f=k.getMetersPerUnitForSR(c);return new b("local",c,f,d)};b.createMode=function(a,c){switch(a){case "local":return b.createLocal(c);
case "global":return b.createGlobal();default:f.neverReached(a)}};return b}();b.RenderCoordsHelper=q;var u=Math.pow(2,50)})},"esri/views/3d/support/SharedSymbolResources":function(){define("require exports ../../../core/arrayUtils ../../../core/Handles ./index ./TextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),function(q,b,n,f,k,d,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(c){this.streamDataSupplier=this.textures=null;this.graphicsOwners=
[];this.screenSizePerspectiveHandles=null;var a=k.ClientType.SYMBOLOGY;this.viewState=c.viewState;this.stage=c.stage;this.pointsOfInterest=c.pointsOfInterest;this.resourceController=c.resourceController;this.streamDataSupplier=this.resourceController.getStreamDataSupplier(a);this.textures=new d.default(this.streamDataSupplier,c.stage,{preMultiplyAlpha:!0,wrap:{s:33071,t:33071}});this.screenSizePerspectiveSettings=h.getSettings(c.viewingMode);this.screenSizePerspectiveSettingsLabels=h.getLabelSettings(c.viewingMode)}
b.prototype.destroy=function(){this.streamDataSupplier=null;this.textures.destroy();this.streamDataSupplier=this.textures=null};b.prototype.addGraphicsOwner=function(c){var a=this;if(!c)return{remove:function(){}};this.graphicsOwners.push(c);var b="layer"in c?c.watch("layer.screenSizePerspectiveEnabled",function(){return a.updateScreenSizePerspectiveEnabled()}):null;this.updateScreenSizePerspectiveEnabled();return{remove:function(){b&&(b.remove(),n.removeUnordered(a.graphicsOwners,c),a.updateScreenSizePerspectiveEnabled())}}};
b.prototype.updateScreenSizePerspectiveEnabled=function(){var c=this,a=this.graphicsOwners.some(function(a){return!0===a.get("layer.screenSizePerspectiveEnabled")});a&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new f,a=function(){return c.updateScreenSizePerspectiveSettings()},this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",a,!0),this.viewState.events.on("camera-projection-changed",a)]),this.updateScreenSizePerspectiveSettings()):
!a&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};b.prototype.updateScreenSizePerspectiveSettings=function(){m.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;m.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(m);this.screenSizePerspectiveSettingsLabels.update(m);this.stage.setNeedsRender()};return b}();b.SharedSymbolResources=q;var m={distance:0,fovY:0};b.default=q})},"esri/views/3d/support/TextureCollection":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/promiseUtils ../../../core/scheduling ../../../core/urlUtils ../webgl-engine/Stage ../webgl-engine/lib/Texture".split(" "),
function(q,b,n,f,k,d,h,m){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(c,a,b){this._streamDataSupplier=c;this._stage=a;this._textureOptions=b;this._textureRequests=new Map}b.prototype.destroy=function(){var c=this;this._textureRequests.forEach(function(a,b){return c.releaseNow(b)});this._textureRequests=null};b.prototype.fromUrl=function(c,a){var b=this,d=this.makeUid(c,a),e=this._textureRequests.get(d);if(e)return e.referenceCount++,e.textureAsync;var h=this._streamDataSupplier.request(c,
"image",d),e={referenceCount:1,texture:null,textureAsync:null};this._textureRequests.set(d,e);e.textureAsync=f.create(function(c,f){h.then(function(f){f=b.createTexture(f.url,f.data,a);e.texture=f;b.addToStage(f);c({uid:d,texture:f})},function(){return f()})},function(){h.cancel()});return e.textureAsync};b.prototype.fromData=function(c,a){c=this.makeUid(c);var b=this._textureRequests.get(c);b||(b={referenceCount:0,texture:a(),textureAsync:null},this.addToStage(b.texture),this._textureRequests.set(c,
b));b.referenceCount++;return{uid:c,texture:b.texture}};b.prototype.release=function(c){var a=this._textureRequests.get(c);a?(1>a.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+c),a.referenceCount--,1>a.referenceCount&&this.scheduleRelease(c)):console.warn("TextureCollection: texture doesn't exist: '"+c+"'")};b.prototype.scheduleRelease=function(c){var a=this;k.schedule(function(){return a.releaseNow(c)})};b.prototype.releaseNow=function(c){if(this._textureRequests){var a=
this._textureRequests.get(c);!a||0<a.referenceCount||(a.texture?this.removeFromStage(a.texture):a.textureAsync.cancel(),this._textureRequests.delete(c))}};b.prototype.createTexture=function(c,a,b){d.isSVG(c)&&(b||0===a.width&&0===a.height)&&(c=a.width?a.height/a.width:1,b=b||64,1<c?(a.width=Math.round(b/c),a.height=b):(a.width=b,a.height=Math.round(b*c)));b=n({},this._textureOptions,{width:a.width,height:a.height,powerOfTwoResizeMode:2});return new m(a,"symbol",b)};b.prototype.addToStage=function(c){this._stage.add(h.ModelContentType.TEXTURE,
c)};b.prototype.removeFromStage=function(c){this._stage.remove(h.ModelContentType.TEXTURE,c.id)};b.prototype.makeUid=function(c,a){return null!=a?c+"."+a+"px":c};return b}();b.TextureCollection=q;b.default=q})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper @dojo/framework/shim/Set ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../PropertiesPool ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./disposeMembers ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/intersectorUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v){Object.defineProperty(b,"__esModule",{value:!0});var z=Array;q=function(b){function d(d){d=b.call(this,d)||this;d.handles=new h;d.surfaceAltitudeAtCenter=0;d.surfaceAltitudeAtCenterDirty=!0;d.surfaceAltitudeAtCenterWithContent=0;d.surfaceAltitudeAtCenterWithContentDirty=!0;d.propertiesPool=new l.default({pointOfView:a,renderPointOfView:z},d);d.updateSurfaceAltitudeFrequentInterval=B;d.updateSurfaceAltitudeInfrequentInterval=C;d.renderPointOfView=
c.vec3f64.create();return d}n(d,b);d.prototype.initialize=function(){var a=this,c=this.view,b=c.state,d=c.basemapTerrain,f=c.renderCoordsHelper,c=c.map,h=this.view.resourceController.scheduler;this.surfaceIntersector=new x(b.mode);this.surfaceIntersector.enable.backfacesTerrain=b.isGlobal?!1:!0;this.surfaceIntersector.enable.invisibleTerrain=!1;this.contentIntersector=new x(b.mode);this.contentIntersectorOptions={exclude:new k.Set([v.TERRAIN_ID])};var l=this.estimateSurfaceAltitudeAtCenter.bind(this);
this._set("centerOnSurfaceInfrequent",new e.default({state:b,scheduler:h,surface:d,renderCoordsHelper:f,estimateSurfaceAltitudeAtCenter:l,altitudeEstimationInterval:this.updateSurfaceAltitudeInfrequentInterval}));this._set("centerOnSurfaceFrequent",new e.default({state:b,scheduler:h,surface:d,renderCoordsHelper:f,estimateSurfaceAltitudeAtCenter:l,altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));this._set("centerOnContent",new e.default({state:b,scheduler:h,surface:d,renderCoordsHelper:f,
estimateSurfaceAltitudeAtCenter:this.estimateSurfaceAltitudeAtCenterWithContent.bind(this),altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));this._set("cameraOnSurface",new g.default({state:b,scheduler:h,surface:d,renderCoordsHelper:f,altitudeEstimationInterval:this.updateSurfaceAltitudeInfrequentInterval,map:c}));this._set("surfaceGeometryUpdates",new w.default({state:b,surface:d,renderCoordsHelper:f,centerOnSurfaceInstances:[this.centerOnSurfaceFrequent,this.centerOnContent,
this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new u.default({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:f}));this._set("surfaceOrigin",new y.default({view:this.view}));this._set("focus",new r.default({state:b,surface:d,renderCoordsHelper:f,centerOnSurface:this.centerOnSurfaceFrequent}));this.handles.add(b.watch("camera",function(c){return a.cameraChanged(c)},!0));this.handles.add(this.surfaceGeometryUpdates.events.on("request-update",function(){return a.updateCenterPointsOfInterest()}));
this.handles.add(d.watch("extent",function(){return a.updateCenterPointsOfInterest()}));this.handles.add(this.contentGeometryUpdates.events.on("request-update",function(){return a.updateCenterOnContent()}));this.cameraChanged(this.view.state.camera);this.forceUpdate()};d.prototype.destroy=function(){t.default(this,"handles","centerOnSurfaceInfrequent","centerOnSurfaceFrequent","cameraOnSurface","centerOnContent","surfaceOrigin","focus","propertiesPool")};Object.defineProperty(d.prototype,"pointOfView",
{get:function(){var a=this.propertiesPool.get("pointOfView");this.view.renderCoordsHelper.fromRenderCoords(this.renderPointOfView,a,this.view.state.spatialReference);return a},enumerable:!0,configurable:!0});d.prototype.forceUpdate=function(){this.surfaceGeometryUpdates.forceUpdate();this.centerOnSurfaceInfrequent.forceUpdate();this.centerOnSurfaceFrequent.forceUpdate();this.cameraOnSurface.forceUpdate();this.centerOnContent.forceUpdate();this.focus.forceUpdate()};d.prototype.hasPendingUpdates=function(){return this.surfaceGeometryUpdates.hasPendingUpdates()||
this.centerOnContent.hasPendingUpdates()||this.centerOnSurfaceInfrequent.hasPendingUpdates()||this.cameraOnSurface.hasPendingUpdates()||this.centerOnSurfaceFrequent.hasPendingUpdates()||this.focus.hasPendingUpdates()};d.prototype.estimateSurfaceAltitudeAtCenterWithContent=function(){if(!this.surfaceAltitudeAtCenterWithContentDirty)return this.surfaceAltitudeAtCenterWithContent;this.surfaceAltitudeAtCenterWithContentDirty=!1;this.view.sceneIntersectionHelper.intersectRay(this.view.state.camera.ray,
A,this.contentIntersectorOptions,this.contentIntersector)?this.surfaceAltitudeAtCenterWithContent=this.view.renderCoordsHelper.getAltitude(A):this.surfaceAltitudeAtCenterWithContent=this.estimateSurfaceAltitudeAtCenter();return this.surfaceAltitudeAtCenterWithContent};d.prototype.estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this.surfaceAltitudeAtCenterDirty)return this.surfaceAltitudeAtCenter;this.surfaceAltitudeAtCenterDirty=!1;var a=this.view.state.camera;
this.surfaceIntersector.intersect(null,a.eye,a.center,null,a,null,!1);this.view.basemapTerrain.intersect(this.surfaceIntersector,null,a.eye,a.center);this.surfaceIntersector.results.min.getIntersectionPoint(A)&&(this.surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(A));return this.surfaceAltitudeAtCenter};d.prototype.cameraChanged=function(a){this.updateCenterPointsOfInterest(a);a=a.eye;this.renderPointOfView[0]===a[0]&&this.renderPointOfView[1]===a[1]&&this.renderPointOfView[2]===
a[2]||this._set("renderPointOfView",p.vec3.copy(this.propertiesPool.get("renderPointOfView"),a))};d.prototype.updateCenterPointsOfInterest=function(a){void 0===a&&(a=this.view.state.camera);this.surfaceAltitudeAtCenterWithContentDirty=this.surfaceAltitudeAtCenterDirty=!0;this.centerOnSurfaceFrequent.update(a);this.centerOnSurfaceInfrequent.update(a);this.cameraOnSurface.update(a);this.centerOnContent.update(a);this.focus.update(a)};d.prototype.updateCenterOnContent=function(){this.surfaceAltitudeAtCenterWithContentDirty=
!0;this.centerOnContent.update(this.view.state.camera)};f([m.property({constructOnly:!0})],d.prototype,"updateSurfaceAltitudeFrequentInterval",void 0);f([m.property({constructOnly:!0})],d.prototype,"updateSurfaceAltitudeInfrequentInterval",void 0);f([m.property({readOnly:!0})],d.prototype,"centerOnContent",void 0);f([m.property({readOnly:!0})],d.prototype,"centerOnSurfaceFrequent",void 0);f([m.property({readOnly:!0})],d.prototype,"centerOnSurfaceInfrequent",void 0);f([m.property({readOnly:!0})],d.prototype,
"cameraOnSurface",void 0);f([m.property({readOnly:!0})],d.prototype,"focus",void 0);f([m.property({readOnly:!0})],d.prototype,"surfaceOrigin",void 0);f([m.property({readOnly:!0})],d.prototype,"contentGeometryUpdates",void 0);f([m.property({readOnly:!0,dependsOn:["renderPointOfView"]})],d.prototype,"pointOfView",null);f([m.property({readOnly:!0})],d.prototype,"renderPointOfView",void 0);f([m.property({readOnly:!0})],d.prototype,"surfaceGeometryUpdates",void 0);f([m.property({constructOnly:!0})],d.prototype,
"view",void 0);return d=f([m.subclass("esri.views.3d.support.PointsOfInterest")],d)}(m.declared(d));b.PointsOfInterest=q;var A=c.vec3f64.create(),B=200,C=3E3;b.default=q})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../PropertiesPool ./PointOfInterest".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a){Object.defineProperty(b,"__esModule",{value:!0});var l=Array;q=function(a){function b(b){b=a.call(this,b)||this;b._dirtyTimeStamp=0;b.propertiesPool=new c.default({location:p,renderLocation:l},b);b.estimatedSurfaceAltitude=0;b.pendingElevationQuery=null;b.renderLocation=m.vec3f64.create();return b}n(b,a);b.prototype.initialize=function(){var a=this;null!=this.scheduler&&this.handles.add(this.scheduler.registerTask(1,function(){return a.measureSurfaceAltitude()},function(){return a.needsUpdate()}));
this.measureSurfaceAltitude();if(this.map){var c=function(){return a._setDirty()};this.handles.add([k.on(this.map,"ground.layers","change",c,c,c)])}};b.prototype.destroy=function(){this.cancelPendingRequest();this.propertiesPool.destroy();this.propertiesPool=null};Object.defineProperty(b.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});
b.prototype.update=function(a){this._setDirty();this.updateCameraOnSurface()};b.prototype.forceUpdate=function(){this.measureSurfaceAltitude();this.updateCameraOnSurface()};b.prototype.hasPendingUpdates=function(){return 0<this._dirtyTimeStamp};b.prototype._setDirty=function(){this._dirtyTimeStamp=this._dirtyTimeStamp||this.scheduler.now};b.prototype.needsUpdate=function(){return!this.pendingElevationQuery&&0<this._dirtyTimeStamp&&this.scheduler.now-this._dirtyTimeStamp>=this.altitudeEstimationInterval};
b.prototype.cancelPendingRequest=function(){var a=this.pendingElevationQuery;a&&(this.pendingElevationQuery=null,a.cancel())};b.prototype.measureSurfaceAltitude=function(){var a=this;this.cancelPendingRequest();this._dirtyTimeStamp=0;if(this.map&&this.map.ground){this.renderCoordsHelper.fromRenderCoords(this.state.camera.eye,e,this.state.spatialReference);var c=this.map.ground.queryElevation(e).then(function(c){return a.updateSurfaceAltitude(c.geometry.z)}).catch(function(c){c&&"cancel"===c.dojoType||
a.updateSurfaceAltitude(0)}).catch(function(){}).then(function(){a.pendingElevationQuery===c&&(a.pendingElevationQuery=null)});c.isFulfilled()||(this.pendingElevationQuery=c)}else this.updateSurfaceAltitude(0)};b.prototype.updateSurfaceAltitude=function(a){this.estimatedSurfaceAltitude!==a&&(this.estimatedSurfaceAltitude=a,this.updateCameraOnSurface())};b.prototype.updateCameraOnSurface=function(){h.vec3.copy(g,this.state.camera.eye);this.renderCoordsHelper.setAltitude(this.estimatedSurfaceAltitude,
g);var a=this._get("renderLocation");h.vec3.equals(a,g)||this._set("renderLocation",h.vec3.copy(this.propertiesPool.get("renderLocation"),g))};f([d.property({constructOnly:!0})],b.prototype,"scheduler",void 0);f([d.property({constructOnly:!0})],b.prototype,"altitudeEstimationInterval",void 0);f([d.property({readOnly:!0,dependsOn:["renderLocation"]})],b.prototype,"location",null);f([d.property({constructOnly:!0})],b.prototype,"map",void 0);f([d.property({readOnly:!0})],b.prototype,"renderLocation",
void 0);return b=f([d.subclass("esri.views.3d.support.CameraOnSurface")],b)}(d.declared(a.PointOfInterest));b.CameraOnSurface=q;var g=m.vec3f64.create(),e=new p;b.default=q})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ./disposeMembers".split(" "),function(q,b,n,f,k,
d,h,m){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function c(a){a=b.call(this)||this;a.handles=new d;return a}n(c,b);c.prototype.destroy=function(){m.default(this,"handles")};f([h.property({constructOnly:!0})],c.prototype,"renderCoordsHelper",void 0);f([h.property({constructOnly:!0})],c.prototype,"surface",void 0);f([h.property({constructOnly:!0})],c.prototype,"state",void 0);return c=f([h.subclass("esri.views.3d.support.PointOfInterest")],c)}(h.declared(k));b.PointOfInterest=
q;b.default=q})},"esri/views/3d/support/pointsOfInterest/disposeMembers":function(){define(["require","exports","../../../../core/Accessor"],function(q,b,n){function f(b){for(var d=[],f=1;f<arguments.length;f++)d[f-1]=arguments[f];if(b instanceof n&&b.destroyed)try{throw Error("instance is already destroyed");}catch(c){console.warn(c.stack)}else for(f=0;f<d.length;f++){var k=d[f];if(!(k in b))throw Error("Property '"+k+"' does not exist and cannot be disposed");var p=b[k];p&&("function"===typeof p.destroy?
p.destroy():"function"===typeof p.dispose?p.dispose():"function"===typeof p.remove&&p.remove());b instanceof n&&k in b.__accessor__.metadatas?b._set(k,null):b[k]=null}}Object.defineProperty(b,"__esModule",{value:!0});b.disposeMembers=f;b.default=f})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../debugFlags ../earthUtils ../mathUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g){Object.defineProperty(b,"__esModule",{value:!0});var e=Array;q=function(b){function g(a){a=b.call(this,a)||this;a.propertiesPool=new l.default({location:m,renderLocation:e},a);a._dirtyTimeStamp=0;a.currentSurfaceAltitude=0;a.latestSurfaceAltitude=0;a.distance=0;a.renderLocation=h.vec3f64.create();return a}n(g,b);r=g;g.prototype.initialize=function(){var a=this;this._frameWorker=this.scheduler.registerTask(1,function(){return a.measureSurfaceAltitude()},function(){return a.needsUpdate()});
this.measureSurfaceAltitude()};g.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this.propertiesPool.destroy();this.propertiesPool=null};Object.defineProperty(g.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});g.prototype.update=function(a){this._setDirty();this.updateCenterOnSurface()};
g.prototype.forceUpdate=function(){this.measureSurfaceAltitude();this.updateCenterOnSurface()};g.prototype.hasPendingUpdates=function(){return 0<this._dirtyTimeStamp};Object.defineProperty(g.prototype,"estimatedSurfaceAltitude",{get:function(){return this.latestSurfaceAltitude},enumerable:!0,configurable:!0});g.prototype._setDirty=function(){this._dirtyTimeStamp=this._dirtyTimeStamp||this.scheduler.now};g.prototype.needsUpdate=function(){return 0<this._dirtyTimeStamp&&this.scheduler.now-this._dirtyTimeStamp>=
this.altitudeEstimationInterval};g.prototype.measureSurfaceAltitude=function(){this.latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this.updateCenterOnSurface();this._dirtyTimeStamp=0};g.prototype.updateCenterOnSurface=function(){var a=u,c=this.calculateSurfaceIntersection(this.currentSurfaceAltitude,a),b=this.currentSurfaceAltitude!==this.latestSurfaceAltitude;!c&&b&&(c=this.calculateSurfaceIntersection(this.latestSurfaceAltitude,a))&&(this.currentSurfaceAltitude=this.latestSurfaceAltitude);
b=t;c&&this.latestSurfaceAltitudeChangesDistanceSignificantly(a,b)&&(d.vec3.copy(a,b),this.currentSurfaceAltitude=this.latestSurfaceAltitude);c?(c=d.vec3.distance(this.state.camera.eye,a),c!==this._get("distance")&&this._set("distance",c)):(c=this.state.camera,d.vec3.scale(a,c.viewForward,this._get("distance")),d.vec3.add(a,a,c.eye));c=this._get("renderLocation");c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]||this._set("renderLocation",d.vec3.copy(this.propertiesPool.get("renderLocation"),a))};g.prototype.calculateSurfaceIntersection=
function(b,e){var f=this.state.camera;if(!this.renderCoordsHelper.intersectManifold(f.ray,b,e))return!1;if(this.state.isGlobal){b=c.earthRadius+b;var g=d.vec3.squaredLength(f.eye),h=g<b*b,l=d.vec3.distance(f.eye,e);h&&l>c.earthRadius/4&&(d.vec3.scale(e,f.viewForward,b-Math.sqrt(g)),d.vec3.add(e,e,f.eye))}else if(f=this.surface.ready&&this.surface.extent)e[0]=a.clamp(e[0],f[0],f[2]),e[1]=a.clamp(e[1],f[1],f[3]);return!0};g.prototype.latestSurfaceAltitudeChangesDistanceSignificantly=function(a,c){if(this.latestSurfaceAltitude===
this.currentSurfaceAltitude||null==a)return!1;if(this.calculateSurfaceIntersection(this.latestSurfaceAltitude,c)){var b=this.state.camera.eye;a=d.vec3.distance(b,a);c=d.vec3.distance(b,c);if(p.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS||Math.abs(c-a)/a>r.RELATIVE_ALTITUDE_CHANGE_THRESHOLD)return!0}return!1};var r;g.RELATIVE_ALTITUDE_CHANGE_THRESHOLD=.05;f([k.property({constructOnly:!0})],g.prototype,"scheduler",void 0);f([k.property({constructOnly:!0})],g.prototype,"altitudeEstimationInterval",void 0);
f([k.property({readOnly:!0})],g.prototype,"distance",void 0);f([k.property({constructOnly:!0})],g.prototype,"estimateSurfaceAltitudeAtCenter",void 0);f([k.property({readOnly:!0,dependsOn:["renderLocation"]})],g.prototype,"location",null);f([k.property({readOnly:!0})],g.prototype,"renderLocation",void 0);return g=r=f([k.subclass("esri.views.3d.support.CenterOnSurface")],g)}(k.declared(g.PointOfInterest));b.CenterOnSurface=q;var u=h.vec3f64.create(),t=h.vec3f64.create();b.default=q})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["require",
"exports","../../../../core/Handles","../Evented"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this.handles=new n;this.events=new f.Evented;this.contentLayerViews=b.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",this.layerViewsChanged.bind(this)));this.layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}b.prototype.destroy=function(){this.handles&&(this.handles.destroy(),
this.handles=null)};b.prototype.layerViewsChanged=function(b){var d=this;b.added.forEach(function(b){"esri.views.3d.layers.SceneLayerView3D"===b.declaredClass&&d.handles.add(b.on("visible-geometry-changed",d.contentChanged.bind(d)),b.uid)});b.removed.forEach(function(b){return d.handles.remove(b.uid)})};b.prototype.contentChanged=function(){this.events.emit("request-update",k)};return b}();b.ContentGeometryUpdates=q;var k={};b.default=q})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3 ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../geometryUtils ../mathUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g){Object.defineProperty(b,"__esModule",{value:!0});var e=Array;q=function(b){function g(a){a=b.call(this,a)||this;a.propertiesPool=new l.default({locationOnSurface:p,renderLocationOnSurface:e},a);a.centerOnSurface=null;return a}n(g,b);g.prototype.destroy=function(){this.propertiesPool.destroy();this.propertiesPool=null};Object.defineProperty(g.prototype,"locationOnSurface",{get:function(){var a=this.propertiesPool.get("locationOnSurface");this.renderCoordsHelper.fromRenderCoords(this.renderLocationOnSurface,
a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"renderLocationOnSurface",{get:function(){var c=this.centerOnSurface.renderLocation,b=this.renderCoordsHelper,d=this.calculateScreenHorizontalEdgeOnSurface(y);h.vec3.subtract(u,c,this.state.camera.eye);h.vec3.normalize(u,u);b.worldUpAtPosition(c,t);var e=Math.abs(Math.acos(h.vec3.dot(t,u))-.5*Math.PI),b=this.propertiesPool.get("renderLocationOnSurface"),e=1-a.clamp(e/(.5*Math.PI),0,1);h.vec3.lerp(b,
c,d,e*e*e);return b},enumerable:!0,configurable:!0});g.prototype.update=function(a){};g.prototype.forceUpdate=function(){};g.prototype.hasPendingUpdates=function(){return this.centerOnSurface.hasPendingUpdates()};g.prototype.calculateScreenHorizontalEdgeOnSurface=function(a){var b=this.state.camera,d=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation),e=this.renderCoordsHelper.getAltitude(b.eye)>=d,f=b.getRenderCenter(k.createRenderScreenPointArray3());f[1]=e?b.padding[2]:b.fullHeight-
b.padding[0];b.unprojectPoint(f,r);h.vec3.subtract(r,r,b.eye);e=h.vec3.normalize(r,r);if(this.renderCoordsHelper.intersectManifold(c.ray.wrap(b.eye,e),d,a))return a;h.vec3.copy(a,b.eye);this.renderCoordsHelper.setAltitude(d,a);return a};f([d.property({constructOnly:!0})],g.prototype,"centerOnSurface",void 0);f([d.property({readOnly:!0,dependsOn:["renderLocationOnSurface"]})],g.prototype,"locationOnSurface",null);f([d.property({readOnly:!0,dependsOn:["centerOnSurface.renderLocation"]})],g.prototype,
"renderLocationOnSurface",null);return g=f([d.subclass("esri.views.3d.support.CenterOnSurface")],g)}(d.declared(g.PointOfInterest));b.Focus=q;var u=m.vec3f64.create(),t=m.vec3f64.create(),r=m.vec3f64.create(),y=m.vec3f64.create();b.default=q})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function g(a){a=b.call(this,a)||this;a.location=null;a._updatePromise=null;a._handles=new d;return a}n(g,b);Object.defineProperty(g.prototype,"renderLocation",{get:function(){if(!this.location)return null;var a=p.vec3f64.create();this.view.renderCoordsHelper.toRenderCoords(this.location,a);return a},enumerable:!0,configurable:!0});g.prototype.initialize=function(){var a=this;this.view.state.isLocal&&(this._handles.add([this.watch(["surfaceView.spatialReference",
"surfaceView.extent"],function(){return a._update()}),h.on(this,"surface.layers","change",function(){return a._update()})]),this._update())};g.prototype.destroy=function(){this._handles.destroy()};g.prototype._update=function(){var b=this;this._updatePromise&&(this._updatePromise.cancel("cancel"),this._updatePromise=null);if(this.surfaceView&&this.surfaceView.extent&&this.surfaceView.spatialReference){var d=a.center(this.surfaceView.extent),d=new c({x:d[0],y:d[1],z:0,spatialReference:this.surfaceView.spatialReference});
this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updatePromise=this.surface.queryElevation(d,{noDataValue:0}).then(function(a){b._updatePromise=null;b._set("location",a.geometry)}).catch(function(a){"cancel"===a||a&&("cancel"===a.dojoType||"AbortError"===a.name||"elevation-query:invalid-layer"===a.name)||console.error("StableSurfaceCenter failed to update: ",a)})):this._set("location",d)}else this._set("location",null)};f([m.property({constructOnly:!0})],g.prototype,"view",
void 0);f([m.property({readOnly:!0,aliasOf:"view.map.ground"})],g.prototype,"surface",void 0);f([m.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],g.prototype,"surfaceView",void 0);f([m.property({readOnly:!0})],g.prototype,"location",void 0);f([m.property({readOnly:!0,dependsOn:["location"]})],g.prototype,"renderLocation",null);return g=f([m.subclass("esri.views.3d.terrain.StableSurfaceCenter")],g)}(m.declared(k));b.StableSurfaceCenter=q;b.default=q})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("require exports ../../../../core/Handles ../../../../core/scheduling ../../../../core/libs/gl-matrix-2/vec3f64 ../../../../geometry/support/aaBoundingRect ../debugFlags ../Evented".split(" "),
function(q,b,n,f,k,d,h,m){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(a){var c=this;this.handles=new n;this.tileGeometryUpdateExtent=d.empty();this.tileGeometryUpdateSpatialReference=null;this.hasPendingTileGeometryChanges=!0;this.events=new m.Evented;this.centerOnSurfaceInstances=a.centerOnSurfaceInstances;this.renderCoordsHelper=a.renderCoordsHelper;this.state=a.state;this.handles.add(a.surface.on("elevation-change",function(a){return c.tileGeometryChangeHandler(a)}))}
b.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};b.prototype.forceUpdate=function(){this.handles.has("tile-geometry-update")&&this.updateCenterOnGeometryUpdate();this.hasPendingTileGeometryChanges&&(this.events.emit("request-update",p),this.hasPendingTileGeometryChanges=!1)};b.prototype.hasPendingUpdates=function(){return this.handles.has("tile-geometry-update")};b.prototype.tileGeometryChangeHandler=function(a){var c=this;this.tileGeometryUpdateSpatialReference=
a.spatialReference;d.expand(this.tileGeometryUpdateExtent,a.tile.extent);this.handles.has("tile-geometry-update")||this.handles.add(f.schedule(function(){return c.updateCenterOnGeometryUpdate()}),"tile-geometry-update")};b.prototype.updateCenterOnGeometryUpdate=function(){this.handles.remove("tile-geometry-update");this.centerIntersectsExtent(this.tileGeometryUpdateExtent,this.tileGeometryUpdateSpatialReference)&&(h.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES?this.hasPendingTileGeometryChanges=
!0:this.events.emit("request-update",p));d.empty(this.tileGeometryUpdateExtent)};b.prototype.furthestCenterOnSurface=function(){for(var a=this.centerOnSurfaceInstances[0],c=1;c<this.centerOnSurfaceInstances.length;c++){var b=this.centerOnSurfaceInstances[c];b.distance>a.distance&&(a=b)}return a};b.prototype.centerIntersectsExtent=function(b,f){var e=this.state.camera.eye,g=l,h=this.furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(e,c,f);this.renderCoordsHelper.fromRenderCoords(h.renderLocation,
a,f);c[0]<a[0]?(g[0]=c[0],g[2]=a[0]):(g[0]=a[0],g[2]=c[0]);c[1]<a[1]?(g[1]=c[1],g[3]=a[1]):(g[1]=a[1],g[3]=c[1]);return d.intersects(g,b)};return b}();b.SurfaceGeometryUpdates=q;var p={},c=k.vec3f64.create(),a=k.vec3f64.create(),l=d.empty();b.default=q})},"esri/views/3d/terrain/TerrainSurface":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Handles ../../../core/Logger ../../../core/ObjectPool ../../../core/PooledArray ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/mat4 ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingRect ../../../layers/support/LercWorker ../support/Evented ../support/geometryUtils ../support/index ../support/mathUtils ../support/projectionUtils ../support/PromiseLightweight ./ElevationData ./ElevationTileAgent ./MapTileAgent ./OverlayManager ./PlanarTile ./SphericalTile ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainConst ./TerrainRenderer ./terrainUtils ./TileGeometryFactory ./TilemapOnlyTile ./tileUtils ./tileUtils ./UpsampleInfo ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture ../../webgl/Util".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C,E,F,H,D,G,K,M,O,N,P,L,T,R,J,U,Q,I,V,X,W,ca){function da(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]}function ba(a){return a&&("cancel"===a||"cancel"===a.dojoType||"AbortError"===a.name)}function aa(a,c){var b=!1;c=c||a;var d=0;for(a=a.children;d<a.length;d++){var e=a[d];if(e){for(var f in e.layerInfo)for(var g in e.layerInfo[f]){var h=e.layerInfo[f][g].upsampleFromTile;if(h&&h.tile===c)return!0}b=b||aa(e,c)}}return b}var S=c.getLogger("esri.views.3d.terrain.TerrainSurface");
q=function(c){function b(b,d){d=c.call(this)||this;d.defaultTileBackground=L.DEFAULT_TILE_BACKGROUND;d.hideSkirtsDistanceFromExtentMargin=Z;d.hideSkirtsMinimumCameraTilt=Y;d.hideSkirtsMaximumCameraTilt=ea;d._clippingExtent=null;d._dataExtent=null;d._elevationBounds=[0,0];d._rootExtent=x.create();d._iteratorPool=new a(I.IteratorPreorder);d._postorderIterator=new I.IteratorPostorder;d.visible=!1;d.suspended=!1;d._pendingUpdates=!1;d._lvPendingUpdates=!1;d._updateNextFrame=0;d._vectorTileLayerRequests=
0;d._memoryUsed=0;d._overlayOpacity=1;d._eyePosRenderSR=y.vec3f64.create();d._eyePosSurfaceSR=y.vec3f64.create();d._splitLimits=[0,0,0,0,0,0];d._frustum=A.frustum.create();d._viewProjectionMatrix=t.mat4f64.create();d.tilemapStats={tilemapRequestsSent:0,tilemapRequestsPending:0,tilemapRequestErrors:0,fullTilemaps:0,emptyTilemaps:0,tilesRequested:0,tileRequestsSent:0,tileRequestErrors:0,tilesNotPresent:0};d._layerViews=[[],[]];d._layerIndexByLayerViewId=[{},{}];d._basemapLayerViewHandles={};d._handles=
new p;d._lowPrioUpdates=new l;d._topLevelTilemapOnlyTiles=Array(L.TILEMAP_SIZE_EXP+1);d._upsampleInfoPool=new a(V);d._getElevationData={spatialReference:null,rootTiles:null};d.loaded=!1;d.maxTextureScaleRaster=1.2;d.maxTextureScaleVector=1.8;d.rootTiles=null;d.backgroundImage=L.DEFAULT_TILE_BACKGROUND;d.backgroundColor=null;d._lercWorker=v.acquireInstance(b.resourceController.scheduler);for(b=0;b<d._topLevelTilemapOnlyTiles.length;b++)d._topLevelTilemapOnlyTiles[b]=new U([b-L.TILEMAP_SIZE_EXP,0,0],
d._upsampleInfoPool);return d}n(b,c);b.prototype.normalizeCtorArgs=function(a,c){this._view=a;this._stage=a._stage;this._set("manifold",c);return{}};b.prototype.initialize=function(){var c=this;this._tilePool="planar"===this.manifold?new a(M):new a(O);this._memCache=this._view.resourceController.memoryController.getMemCache("esri.views.3d.terrain",function(a){return c._renderer.releaseTileGeometry(a.renderData)});this._renderer=new T(this.manifold,this._memCache);this._renderer.loaded=this._setLoaded.bind(this);
this._renderer.install(this._view._stage);g.init(this,"_background",function(){c._renderer.updateTileBackground(c._background)});this._handles.add(this._view.watch("pointsOfInterest",function(a){c._renderer.pointsOfInterest=a}));this._set("overlayManager",new K({terrainSurface:this,view:this._view}));this._handles.add(this.watch("overlayManager.hasHighlights",this._handleHasHighlights.bind(this)),"overlayManager");var b={layers:this._view.map.allLayers,layerViews:this._view.allLayerViews,spatialReference:this._view.spatialReference};
this.extentHelper="spherical"===this.manifold?new N.SurfaceExtentHelperGlobal(b):new N.SurfaceExtentHelperLocal(b);this._handles.add(g.init(this.extentHelper,"stencilEnabledExtents",function(a){c._renderer.setStencilEnabledLayerExtents(a)}),"extentHelper");b=this._view.defaultsFromMap?new m({root:this._view.map,rootCollectionNames:this._view.defaultsFromMap.mapCollectionPaths,getChildrenFunction:function(a){return a.layers}}):this._view.map.allLayers;b=new P({layers:b,extentHelper:this.extentHelper,
manifold:this.manifold,viewSpatialReference:this._view.spatialReference});this._set("tilingSchemeLogic",b);this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",this._updateTilingSchemeAndExtent.bind(this),!0),this.tilingSchemeLogic.watch("extent",this._updateTilingSchemeAndExtent.bind(this),!0)],"tilingSchemeLogic");this._updateTilingSchemeAndExtent();this._streamDataSupplier=this._view.resourceController.getStreamDataSupplier(B.ClientType.TERRAIN);this._handles.add(this._view.resourceController.scheduler.registerTask(1,
function(a){return c._frame(a)},function(){return c.ready}));this._viewChangeUpdate=this._viewChangeUpdate.bind(this);this._view.resourceController.memoryController.events.on("quality-changed",function(){return c._viewChangeUpdate()});this._handles.add([this._view.on("resize",this._viewChangeUpdate),this._view.watch("state.camera",this._viewChangeUpdate,!0),this._view.watch("qualitySettings.tiledSurface.lodBias",this._viewChangeUpdate),this._view.watch("clippingArea",this._clippingChanged.bind(this))],
"view");this._handles.add(this._view.allLayerViews.on("change",this._handleLayerViewChanges.bind(this)),"allLayerViews");this._handleLayerViewChanges({added:this._view.allLayerViews.toArray(),removed:[],moved:[],target:this._view.allLayerViews});this._updateClippingExtent();this.notifyChange("extent")};b.prototype.destroy=function(){this._handles.destroy();v.releaseInstance(this._lercWorker);this._lercWorker=null;this._removeAllTiles();this._memCache.destroy();this._memCache=null;this.tilingSchemeLogic.destroy();
this._set("tilingSchemeLogic",null);this.extentHelper.destroy();this.extentHelper=null;for(var a in this._basemapLayerViewHandles)this._unregisterTiledLayerView(a);this._streamDataSupplier=null;this.overlayManager&&(this.overlayManager.destroy(),this._set("overlayManager",null));this._tilePool.destroy();this._tilePool=null;D.Pool.prune(0);G.Pool.prune(0);this._renderer.destroy(this._stage);this._renderer=null;this._iteratorPool.destroy();this._streamDataSupplier=this._stage=this._view=this._iteratorPool=
null;this._upsampleInfoPool.destroy();this._upsampleInfoPool=null};Object.defineProperty(b.prototype,"renderer",{get:function(){return this._renderer},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"frustum",{get:function(){return this._frustum},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"upsampleInfoPool",{get:function(){return this._upsampleInfoPool},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"cullBackFaces",{set:function(a){this._renderer.cullBackFaces=
a;this._set("cullBackFaces",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"extent",{get:function(){return this._clippingExtent||this._rootExtent},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"baseOpacity",{set:function(a){this._renderer.opaque=1<=a;this._set("baseOpacity",a);this._updateTileTextures(!0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maxTextureScale",{get:function(){for(var a=!1,c=!1,b=0,d=this._layerViews[L.LayerClass.MAP];b<
d.length;b++){var e=d[b].layer;e.visible&&0!==e.opacity&&("vector-tile"===e.type?a=!0:c=!0)}return a&&!c?this.maxTextureScaleVector:this.maxTextureScaleRaster},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"ready",{get:function(){return!!this.rootTiles},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"renderOrder",{set:function(a){this._renderer.renderOrder=a;this._set("renderOrder",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"skirtScale",
{set:function(a){this._renderer.skirtScale=a;this._set("skirtScale",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"spatialReference",{get:function(){var a=this.tilingScheme&&this.tilingScheme.spatialReference||null;return this._getElevationData.spatialReference=a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"_background",{get:function(){return null!=this.backgroundColor?this.backgroundColor:this.backgroundImage},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"slicePlaneEnabled",{set:function(a){this._renderer.slicePlaneEnabled=a;this._set("slicePlaneEnabled",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"velvetOverground",{set:function(a){a!==this.velvetOverground&&(this._renderer.velvetOverground=a);this._set("velvetOverground",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"wireframe",{set:function(a){this._renderer.setWireframe(a);this._set("wireframe",a)},enumerable:!0,configurable:!0});b.prototype.setVisibility=
function(a){a!==this.visible&&(this.visible=a,this._renderer.setVisibility(a),this.setUpdatesDisabled(!a),a&&this._viewChangeUpdate())};b.prototype.isVisible=function(){return this.visible&&this.ready};b.prototype.isOpaque=function(){return this._renderer.isOpaque()};b.prototype.setUpdatesDisabled=function(a){(this.suspended=a)||this._viewChangeUpdate()};b.prototype.intersect=function(a,c,b,d){this._renderer.intersect(a,c,b,d,null)};b.prototype.getElevation=function(a){var c=this._getElevationData.rootTiles;
if(!c||!c.length||0===c[0].layerInfo[L.LayerClass.ELEVATION].length)return null;var b=ja;if(Array.isArray(a))b=a;else if("point"===a.type&&!E.pointToVector(a,b,this._getElevationData.spatialReference))return S.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(var d=0;d<c.length;d++)if(a=c[d],Q.isPosWithinTile(a,b)){for(;a&&!a.renderData;)c=0,b[0]>.5*(a.extent[0]+a.extent[2])&&(c+=1),b[1]<.5*(a.extent[1]+a.extent[3])&&(c+=2),a=a.children[c];
if(c=(c=a.renderData)&&c.geometryState?c.geometryState.samplerData:null)return J.elevationSampler(b[0],b[1],c);break}return null};b.prototype.getElevationBounds=function(){return this._elevationBounds};b.prototype.getScale=function(a){if(this.tilingScheme){if(!E.pointToVector(a,ja,this.spatialReference))return S.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;if(this.rootTiles)for(var c=0;c<this.rootTiles.length;c++)if(a=this.rootTiles[c],
Q.isPosWithinTile(a,ja)){for(;a.children[0];)c=0,ja[0]>a.children[0].extent[2]&&(c+=1),ja[1]<a.children[0].extent[1]&&(c+=2),a=a.children[c];return this._getLodBiasCorrectedScale(a.lij[0])}}return 1E100};b.prototype.queryVisibleScaleRange=function(a,c,b,d){c=c?this.tilingScheme.levelAtScale(c):0;b=b?this.tilingScheme.levelAtScale(b):Infinity;var e=this._getLodBias();this._renderer.queryVisibleLevelRange(a,c+e,b+e,d)};b.prototype._setLoaded=function(){this.loaded||this._set("loaded",!0)};b.prototype._updateTilingSchemeAndExtent=
function(){var a=this.tilingSchemeLogic.extent,c=a&&!x.equals(a,this._dataExtent);c&&(this._dataExtent?x.set(this._dataExtent,a):this._dataExtent=x.create(a));var a=this.tilingSchemeLogic.tilingScheme,b=a!==this.tilingScheme;b&&(R.weakAssert(!!a,"tiling scheme cannot be reset to undefined"),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",a),this._updateClippingExtent(),a&&(this._updateTiledLayers(),this._renderer.setTileSize(a.pixelSize[0]),this.overlayManager.setSpatialReference(a.spatialReference,
"spherical"===this.manifold)));(c||b)&&this._updateRootTiles()};b.prototype._acquireTile=function(a,c,b,d){var e=this._tilePool.acquire();ha[0]=a;ha[1]=c;ha[2]=b;e.init(ha,d,this);return e};b.prototype._updateRootTiles=function(){var a=this,c=this._clippingExtent||this._dataExtent,b=this.tilingScheme;if(c&&b){var d=fa,e=b.rootTilesInExtent(c,d,Infinity),f=function(c){c=a._acquireTile(0,c[1],c[2],null);c.shouldSplit(a._splitLimits,a._eyePosRenderSR)===L.TileUpdate.SPLIT&&c.setPendingUpdate(L.TileUpdate.SPLIT);
a._loadTile(c);return c};if(this.rootTiles){if(e.length>L.MAX_ROOT_TILES){S.warn(L.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}var c=this.rootTiles.map(function(a){return a.lij}),g=h.difference(c,e,da);if(0<g.removed.length||0<g.added.length){var l=this.rootTiles.filter(function(c){return-1<h.findIndex(g.removed,da.bind(null,c.lij))?(a._purgeTile(c),!1):!0});g.added.forEach(function(a){return l.push(f(a))});this._setRootTiles(l)}}else e.length>L.MAX_ROOT_TILES&&(S.warn(L.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),
e=b.rootTilesInExtent(c,d,L.MAX_ROOT_TILES)),this._setRootTiles(e.map(function(a){return f(a)}));h.equals(d,this._rootExtent)||(this._rootExtent=x.create(d),this._hasFixedExtent()||this.notifyChange("extent"));this.setVisibility(!0);this._viewChangeUpdate();this.overlayManager.setOverlayPlacementDirty();this.notifyChange("ready")}};b.prototype._setRootTiles=function(a){this._set("rootTiles",a);this._getElevationData.rootTiles=a;this._renderer.setRootTiles(this.rootTiles)};b.prototype._viewChangeUpdate=
function(){this._stage&&!this.suspended&&this.tilingScheme&&this.visible&&(this._updateViewDependentParameters(),this._updateSkirts(),this._updateOverlayOpacity(this._eyePosSurfaceSR[2]),this._updateTiles())};b.prototype._updateClippingStatus=function(a){a.updateClippingStatus(this._clippingExtent)&&a.resetPendingUpdate(L.TileUpdate.GEOMETRY)&&this._updateTileGeometry(a)};b.prototype._updateTiles=function(a){void 0===a&&(a=this.rootTiles);if(a){var c=this._iteratorPool.acquire();c.reset(a);var b=
this._splitLimits,d;Q.hasVisibleSiblings(a)?(a=this._elevationBounds[0],d=this._elevationBounds[1]):(a=Infinity,d=-Infinity);for(;!c.done;){var e=c.next();this._updateClippingStatus(e);e.updateVisibility();if(e.visible){e.updateScreenDepth(this._viewProjectionMatrix);e.renderData&&(a=Math.min(e.elevationBounds[0],a),d=Math.max(e.elevationBounds[1],d));var f=e.shouldSplit(b,this._eyePosRenderSR);if(f===L.TileUpdate.SPLIT){e.resetPendingUpdate(L.TileUpdate.MERGE);e.isLeaf&&(e.setPendingUpdate(L.TileUpdate.SPLIT),
c.skipSubtree());this._pendingUpdates=this._pendingUpdates||e.hasPendingUpdates;continue}e.resetPendingUpdate(L.TileUpdate.SPLIT)&&e.updateAgentSuspension();f===L.TileUpdate.VSPLITMERGE&&e.updateAgents(L.LayerClass.ELEVATION)}c.skipSubtree();if(!e.renderData){e.setPendingUpdate(L.TileUpdate.MERGE);e.resetPendingUpdate(L.TileUpdate.SPLIT);f=this._iteratorPool.acquire();for(f.resetOne(e);!f.done;){var g=f.next();this._updateClippingStatus(g);g.updateVisibility();g.visible&&g.updateScreenDepth(this._viewProjectionMatrix)}this._iteratorPool.release(f)}this._pendingUpdates=
this._pendingUpdates||e.hasPendingUpdates}this._iteratorPool.release(c);isFinite(a)&&isFinite(d)&&(this._elevationBounds[0]!==a||this._elevationBounds[1]!==d)&&(this._elevationBounds[0]=a,this._elevationBounds[1]=d,this.emit("elevation-bounds-change",null))}};b.prototype._updateViewDependentParameters=function(){var a=this._view.state.camera,c=Math.tan(.5*a.fovX),b=Math.tan(.5*a.fovY),d=this.tilingScheme.pixelSize,e=Math.pow(2,-this._getLodBias())*a.pixelRatio;this._splitLimits[0]=c;this._splitLimits[1]=
d[0]/a.width*this.maxTextureScale*e;this._splitLimits[2]=b;this._splitLimits[3]=d[1]/a.height*this.maxTextureScale*e;this._splitLimits[4]=this.tilingScheme.getMaxLod();this._splitLimits[5]=this._view.qualitySettings.tiledSurface.angledSplitBias;A.frustum.copy(a.frustum,this._frustum);u.mat4.multiply(this._viewProjectionMatrix,a.projectionMatrix,a.viewMatrix);r.vec3.copy(this._eyePosRenderSR,a.eye);E.vectorToVector(this._eyePosRenderSR,this._view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};
b.prototype._updateSkirts=function(){R.autoUpdateSkirtsVisibility(this,this._eyePosSurfaceSR,this._view.state.camera.near)};b.prototype._setLayerViewsUpdating=function(){for(var a=0;a<L.LayerClass.COUNT;a++)for(var c=this._layerViews[a],b=0;b<c.length;b++)c[b].updatingChanged(this._pendingUpdates)};b.prototype._updateTileGeometry=function(a){a.updateVisibility();this._renderer.updateTileGeometry(a);this._elevationUpdate(a);this._memoryUsed=0};b.prototype._elevationUpdate=function(a){ka.spatialReference=
this.spatialReference;ka.tile=a;ka.extent=a.extent;this.emit("elevation-change",ka);x.containsPoint(a.extent,this._eyePosSurfaceSR)&&this._updateSkirts()};b.prototype._frame=function(a){var c=this;this._frameTraversal(a);a.run(function(){Q.sortTiles(c._renderer.renderOrder,c._lowPrioUpdates);return!1});this._processElevation(a)&&this._processTextures(a)&&!this._streamDataSupplier.hasPendingDownloads()&&0===this._vectorTileLayerRequests||(this._pendingUpdates=!0);!a.done&&this.isVisible()&&this.overlayManager&&
this.overlayManager.overlaysNeedUpdate()&&(this.overlayManager.updateOverlays(),this._updateOverlayOpacity(this._eyePosSurfaceSR[2]));this._lowPrioUpdates.clear();this._pendingUpdates===this._lvPendingUpdates||!this._pendingUpdates&&20!==++this._updateNextFrame||(this._setLayerViewsUpdating(),this._lvPendingUpdates=this._pendingUpdates,this._updateNextFrame=0)};b.prototype._frameTraversal=function(a){if(!this.suspended&&this._pendingUpdates){this._lowPrioUpdates.clear();this._pendingUpdates=!1;var c=
this._renderer.resourceCounter,b=c.numTileTexturesComposited,d=this._iteratorPool.acquire();d.reset(this.rootTiles);for(var e=0,f=[];!d.done&&!a.done&&c.numTileTexturesComposited-b<ga;){var g=d.next(),e=e+g.memoryUsed;g.resetPendingUpdate(L.TileUpdate.MERGE)?(this._mergeTile(g),a.madeProgress(),d.skipSubtree()):g.resetPendingUpdate(L.TileUpdate.SPLIT)?(this._splitTile(g)&&(this._pendingUpdates=!0,f.push(g)),a.madeProgress(),d.skipSubtree()):g.hasPendingUpdates&&this._lowPrioUpdates.push(g);this._pendingUpdates=
this._pendingUpdates||g.hasPendingUpdates;d.done&&(d.reset(f),f.length=0)}d.done?this._memoryUsed=e:this._pendingUpdates=!0;this._iteratorPool.release(d)}};b.prototype._processElevation=function(a){for(var c=this,b=function(b){var e=d._lowPrioUpdates.data[b];if(!a.run(function(){if(e.resetPendingUpdate(L.TileUpdate.GEOMETRY))return c._updateTileGeometry(e),!0}))return{value:!1}},d=this,e=0;e<this._lowPrioUpdates.length;++e){var f=b(e);if("object"===typeof f)return f.value}return!0};b.prototype._processTextures=
function(a){for(var c=this,b=function(b){var e=d._lowPrioUpdates.data[b];if(!a.run(function(){return e.resetPendingUpdate(L.TileUpdate.TEXTURE)?(c._renderer.updateTileTexture(e),c._memoryUsed=0,!0):!1}))return{value:!1}},d=this,e=0;e<this._lowPrioUpdates.length;++e){var f=b(e);if("object"===typeof f)return f.value}return!0};b.prototype._updateClippingExtent=function(){if(!this.spatialReference)return!1;var a=x.create(),c=null;E.extentToBoundingRect(this._view.clippingArea,a,this.spatialReference)&&
(c=a);if(h.equals(c,this._clippingExtent))return!1;this._memCache.clear();this._clippingExtent=c;this._renderer.clippingExtent=c;this.notifyChange("extent");this._updateTileOverlayParams();this.overlayManager.setOverlayPlacementDirty();return!0};b.prototype._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()};b.prototype._getLodBias=function(){return this._view.qualitySettings.tiledSurface.lodBias-(1-this._view.resourceController.memoryController.memoryFactor)*L.MAX_MEMORY_LOD_BIAS};
b.prototype._getLodBiasCorrectedScale=function(a){var c=this.tilingScheme.levels;a=C.clamp(a-this._getLodBias(),0,c.length-1);var b=a-Math.floor(a);return c[Math.floor(a)].scale*(1-b)+c[Math.ceil(a)].scale*b};b.prototype._cancelTilemapRequests=function(a){for(var c=0;c<L.LayerClass.COUNT;c++){var b=a.layerInfo[c];if(b)for(var d=0;d<b.length;d++){var e=b[d];e.tilemapRequest&&(e.tilemapRequest.cancel(),e.tilemapRequest=null)}}};b.prototype._removeAllTiles=function(){var a=this;this.rootTiles&&(this.rootTiles.forEach(function(c){return a._purgeTile(c)}),
this._setRootTiles(null),this.notifyChange("ready"));for(var c=0;c<this._topLevelTilemapOnlyTiles.length;c++)this._cancelTilemapRequests(this._topLevelTilemapOnlyTiles[c]);this.setVisibility(!1)};b.prototype._purgeChildTiles=function(a){for(var c in a.children){var b=a.children[c];null!=b&&(a.children[c]=null,this._purgeTile(b))}};b.prototype._purgeTile=function(a){this._purgeChildTiles(a);a.unload(this._renderer);this._cancelTilemapRequests(a);a.dispose();this._tilePool.release(a)};b.prototype._splitTile=
function(a){var c=a.lij[0]+1,b=2*a.lij[1],d=2*a.lij[2];a.children[0]=this._createTile(c,b,d,a);a.children[1]=this._createTile(c,b,d+1,a);a.children[2]=this._createTile(c,b+1,d,a);a.children[3]=this._createTile(c,b+1,d+1,a);a.unload(this._renderer);ia.spatialReference=this.spatialReference;ia.extent=a.extent;ia.scale=this._getLodBiasCorrectedScale(c);this.emit("scale-change",ia);return a.children[0].hasPendingUpdate(L.TileUpdate.SPLIT)||a.children[1].hasPendingUpdate(L.TileUpdate.SPLIT)||a.children[2].hasPendingUpdate(L.TileUpdate.SPLIT)||
a.children[3].hasPendingUpdate(L.TileUpdate.SPLIT)};b.prototype._createTile=function(a,c,b,d){R.weakAssert(!!d,"_createTile sanity check");a=this._acquireTile(a,c,b,d);a.updateClippingStatus(this._clippingExtent);a.visible&&(a.updateScreenDepth(this._viewProjectionMatrix),a.shouldSplit(this._splitLimits,this._eyePosRenderSR)===L.TileUpdate.SPLIT&&a.setPendingUpdate(L.TileUpdate.SPLIT));this._loadTile(a);return a};b.prototype._mergeTile=function(a){R.weakAssert(!a.renderData,"_mergeTile sanity check");
R.weakAssert(!a.hasPendingUpdate(L.TileUpdate.SPLIT),"_mergeTile sanity check");this._loadTile(a);this._purgeChildTiles(a);ia.spatialReference=this.spatialReference;ia.extent=a.extent;ia.scale=this._getLodBiasCorrectedScale(a.lij[0]);this.emit("scale-change",ia)};b.prototype._loadTile=function(a){a.load(this._renderer);this.overlayManager&&this.overlayManager.hasOverlays()&&this.overlayManager.setOverlayParamsOfTile(a,a.renderData,this._overlayOpacity);this._elevationUpdate(a)};b.prototype._handleHasHighlights=
function(a){this._renderer.setNeedsHighlight(a)};b.prototype._elevationDataUpdated=function(a,c){var b=a.layerInfo[L.LayerClass.ELEVATION][c],d=[a],e=a.lij[0],f=this._iteratorPool.acquire();for(f.reset(d);!f.done;){var g=f.next();g.findElevationBoundsForLayer(c,e);g.computeElevationBounds()}this._iteratorPool.release(f);a.dataArrived(c,L.LayerClass.ELEVATION,b.data);this._updateTiles(d)};b.prototype._handleLayerViewChanges=function(a){var c=this,b=!1;a.added.forEach(function(a){var d=a.layer;R.isTiledLayerView(a)?
(c._registerTiledLayer(a),d.loaded&&(b=!0)):a.supportsDraping&&c.overlayManager&&c.overlayManager.registerLayerView(a)});a.removed.forEach(function(a){R.isTiledLayerView(a)?(b=!0,c._unregisterTiledLayerView(a.uid)):a.supportsDraping&&c.overlayManager&&c.overlayManager.unregisterLayerView(a)});(b=b||0<a.moved.filter(R.isTiledLayerView).length)&&this._updateTiledLayers()};b.prototype._registerTiledLayer=function(a){var c=this,b=[];b.push(a.watch("visible",function(){return c._updateTiledLayers()}));
b.push(a.watch("fullOpacity",function(){return c._updateTileTextures()}));a.on("data-changed",function(){var b=R.isElevationLayerView(a)?L.LayerClass.ELEVATION:L.LayerClass.MAP,d=c._layerIndexByLayerViewId[b][a.uid];null!=d&&c._invalidateLayerData(d,b)});this._basemapLayerViewHandles[a.uid]=b};b.prototype._unregisterTiledLayerView=function(a){var c=this._basemapLayerViewHandles[a];if(c){for(var b=0;b<c.length;b++)c[b].remove();delete this._basemapLayerViewHandles[a]}};b.prototype._updateTiledLayers=
function(){var a=this;if(this.tilingScheme){var c=this._view.allLayerViews,b=[[],[]],d=null,e=x.empty();c.forEach(function(c){var f=c.layer;if(f&&c.visible&&R.isTiledLayerView(c)){var g=c.fullExtent;g?a.tilingScheme.compatibleWith(c.tileInfo)?(x.expand(e,g),R.isElevationLayerView(c)?b[L.LayerClass.ELEVATION].push(c):(Infinity!==c.maxDataLevel&&(null===d||c.maxDataLevel>d)&&(d=c.maxDataLevel),b[L.LayerClass.MAP].push(c))):S.warn("Terrain: tiling scheme of layer "+f.id+" is incompatible with other tiled layers, will not be drawn"):
S.warn("Terrain: Map or elevation layer does not have fullExtent: "+f.id)}},this);for(var c=function(a){var c=f._layerViews[a],d=b[a];d.reverse();var e=d.length,g=c.length!==e,h=Array(e),l=Array(c.length);f._layerIndexByLayerViewId[a]={};for(var k=0;k<e;k++){f._layerIndexByLayerViewId[a][d[k].uid]=k;var m=c.indexOf(d[k]);h[k]=m;k!==m&&(g=!0);-1<m&&(l[m]=k)}if(g){f._topLevelTilemapOnlyTiles.forEach(function(c){return c.modifyLayers(l,h,a)});c=f._postorderIterator;for(c.reset(f.rootTiles);!c.done;)c.next().modifyLayers(l,
h,a);f._layerViews[a]=d;a===L.LayerClass.ELEVATION&&f._memCache.clear();for(c.reset(f.rootTiles);!c.done;)d=c.next(),d.restartAgents(a),a===L.LayerClass.ELEVATION&&d.computeElevationBounds();f._updateTiles()}},f=this,g=0;g<L.LayerClass.COUNT;g++)c(g);this.tilingScheme.levels.length-1<d&&(this.tilingScheme.ensureMaxLod(d),this._viewChangeUpdate())}};b.prototype._hasFixedExtent=function(){return!!this._clippingExtent};b.prototype.layerViewByIndex=function(a,c){return this._layerViews[c][a]};b.prototype.numLayers=
function(a){return this._layerViews[a].length};b.prototype._updateTileTextures=function(a){void 0===a&&(a=!1);a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;)a.next().updateTexture();this._iteratorPool.release(a)};b.prototype._invalidateLayerData=function(a,c){var b=this._iteratorPool.acquire();for(b.reset(this.rootTiles);!b.done;)b.next().removeLayerAgent(a,c);for(b.reset(this.rootTiles);!b.done;)b.next().invalidateLayerData(a,c);this._iteratorPool.release(b);c===L.LayerClass.ELEVATION&&
this._memCache.clear()};b.prototype.setPendingUpdates=function(){this._pendingUpdates=!0};b.prototype.requestTileData=function(a,c,b){var d=this;this.tilemapStats.tilesRequested++;var e=this.layerViewByIndex(c,b),f=e.layer;if(f.tilemapCache&&!R.isVectorTileLayerView(e)){var g=this.getTilemapTile(a),h=g.layerInfo[b][c];if(h.tilemap){if(!g.hasDataAvailable(a,c,b))return this.tilemapStats.tilesNotPresent++,this._dispatchDataEvent(a,"dataMissing",b,e,{notInTilemap:!0}),c=new F.default,c.reject(),c}else{h.tilemapRequest||
(h.tilemapRequest=this.requestTilemap(g,c,b,e,f));var l,k=new F.default(function(){return l&&l.cancel()});h.tilemapRequest.catch(function(){}).then(function(){h.tilemapRequest=null;if(!k.isCancelled()){var c=d._layerIndexByLayerViewId[b][e.uid];null!=c&&(g.hasDataAvailable(a,c,b)?(l=d._requestTileData(a,c,b,e),l.then(function(){return k.resolve()})):(d.tilemapStats.tilesNotPresent++,d._dispatchDataEvent(a,"dataMissing",b,e,{notInTilemap:!0}),k.reject()))}});return k}}return this._requestTileData(a,
c,b,e)};b.prototype._requestTileData=function(a,c,b,d){this.tilemapStats.tileRequestsSent++;return b===L.LayerClass.ELEVATION?this._requestElevationTileData(a,c,b,d):this._requestMapTileData(a,c,b,d)};b.prototype._requestElevationTileData=function(a,c,b,d){var e=this;if(R.isElevationLayerView(d)){var f=function(f){var g=e._layerIndexByLayerViewId[b][d.uid];null==g?S.warn("TerrainSurface: received data from unknown layer %d %s",b,a.lij.toString()):(g=a.layerInfo[b][g],e._memoryUsed=0,g.data=H.create(a.lij,
a.extent,f),e._elevationDataUpdated(a,c),e._pendingUpdates=!0)},g=function(c){ba(c)||(e.tilemapStats.tileRequestErrors++,e._dispatchDataEvent(a,"dataMissing",b,d,c))};if(R.useFetchTileForLayer(d.layer))return d.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2],L.ELEVATION_NODATA_VALUE).then(function(a){return f(a)},g);var h=d.getTileUrl(a.lij[0],a.lij[1],a.lij[2]),h=this._streamDataSupplier.request(h,"binary");h.then(function(a){return e._lercWorker.decode(a.data,L.noDataValueOpt).then(function(a){return f({values:a.pixelData,
width:a.width,height:a.height,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue})},g)},g);return h}R.weakAssert(!1,"_requestElevationTileData can only be called for elevation layer views")};b.prototype._requestMapTileData=function(a,c,b,d){var e=this,f=function(c){return e._dispatchDataEvent(a,"dataArrived",b,d,c)};c=function(c){ba(c)||(e._dispatchDataEvent(a,"dataMissing",b,d,c),e.tilemapStats.tileRequestErrors++)};if(R.isVectorTileLayerView(d)){var g=d.tileHandler,h=d.schemaHelper.getLevelRowColumn(a.lij);
++this._vectorTileLayerRequests;return g.getVectorTile(h[0],h[1],h[2],0).then(f).catch(c).then(function(){--e._vectorTileLayerRequests})}if(R.useFetchTileForLayer(d.layer)&&R.isTileLayerView(d))return d.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2]).then(f).catch(c);g=d.getTileUrl(a.lij[0],a.lij[1],a.lij[2]);null!=d.refreshInterval&&d.refreshTimestamp&&(g+=(-1<g.indexOf("?")?"\x26":"?")+"_ts\x3d"+d.refreshTimestamp);g=this._streamDataSupplier.request(g,"image");g.then(function(a){return f(a.data)},c);
return g};b.prototype.requestTilemap=function(a,c,b,d,e){var f=this,g=a.lij[0]+L.TILEMAP_SIZE_EXP,h=a.lij[1]<<L.TILEMAP_SIZE_EXP,l=a.lij[2]<<L.TILEMAP_SIZE_EXP;this.tilemapStats.tilemapRequestsSent++;this.tilemapStats.tilemapRequestsPending++;return e.tilemapCache.fetchTilemap(g,h,l,{timeout:6E3}).then(function(e){f.tilemapStats.tilemapRequestsPending--;c=f._layerIndexByLayerViewId[b][d.uid];null!=c&&(a.layerInfo[b][c].tilemap=e)}).catch(function(a){f.tilemapStats.tilemapRequestsPending--;f.tilemapStats.tilemapRequestErrors++})};
b.prototype.getTilemapTile=function(a){var c=a.lij[0];return c>L.TILEMAP_SIZE_EXP?Q.getTileNLevelsUp(a,L.TILEMAP_SIZE_EXP):this._topLevelTilemapOnlyTiles[c]};b.prototype._dispatchDataEvent=function(a,c,b,d,e){d=this._layerIndexByLayerViewId[b][d.uid];if(null!=d)a[c](d,b,e);else S.warn("TerrainSurface: received data from unknown layer")};b.prototype._updateTileOverlayParams=function(){if(this.rootTiles){var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;){var c=a.next();c.renderData&&
this.overlayManager&&this.overlayManager.setOverlayParamsOfTile(c,c.renderData,this._overlayOpacity)}this._iteratorPool.release(a);this._renderer.setNeedsRender()}};b.prototype._updateOverlayOpacity=function(a){if(this.overlayManager&&(a=this.overlayManager.updateOpacity(a),!isNaN(a))){if(a!==this._overlayOpacity){var c=this._iteratorPool.acquire();for(c.reset(this.rootTiles);!c.done;){var b=c.next();b.renderData&&(b.renderData.overlayOpacity=a)}this._iteratorPool.release(c)}this._overlayOpacity=
a;this._renderer.setNeedsRender()}};b.prototype.getStats=function(){var a={numNodes:0,numLeaves:0,numVisible:0,numVisiblePerLevel:[]},c=this._iteratorPool.acquire();for(c.reset(this.rootTiles);!c.done;){var b=c.next();a.numNodes++;b.renderData&&(a.numLeaves++,b.visible&&(a.numVisible++,b=b.lij[0],a.numVisiblePerLevel[b]=null==a.numVisiblePerLevel[b]?1:a.numVisiblePerLevel[b]+1))}this._iteratorPool.release(c);return a};b.prototype.getUsedMemory=function(){if(!this.tilingScheme)return 0;if(0<this._memoryUsed)return this._memoryUsed;
var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;){var c=a.next();this._memoryUsed+=c.memoryUsed}this._iteratorPool.release(a);return this._memoryUsed};b.prototype.getMemoryUsage=function(){if(!this.tilingScheme)return{};var a=0,c=0,b=0,d=0,e=0,f=0,g=this._iteratorPool.acquire();g.reset(this.rootTiles);for(var h=this.tilingScheme.pixelSize,h=h[0]*h[1]*4;!g.done;){for(var l=g.next(),k=aa(l),m=0,p=l.layerInfo[L.LayerClass.MAP];m<p.length;m++){var n=p[m],n=n.data,r=0,t=0;n instanceof
W?r+=ca.getGpuMemoryUsage(n):n instanceof HTMLImageElement?t+=h:n instanceof X&&(f+=n.getGpuMemoryUsage(),b+=n.getCpuMemoryUsage());l.renderData||k?(a+=t,d+=r):(c+=t,e+=r)}k=0;for(m=l.layerInfo[L.LayerClass.ELEVATION];k<m.length;k++)n=m[k],n=n.data,a+=n?h:0;l.renderData&&(n=l.renderData.textureDescriptor,d+=n?ca.getGpuMemoryUsage(n):0,l=l.renderData.estimatedGeometryMemoryUsage,f+=l,b+=l)}this._iteratorPool.release(g);return{cpuVisibleImageData:a,cpuInvisibleImageData:c,cpuGeometryData:b,gpuVisibleImageData:d,
gpuInvisibleImageData:e,gpuGeometryData:f}};b.prototype.hasPendingUpdates=function(){if(this._streamDataSupplier.hasPendingDownloads()||0!==this._vectorTileLayerRequests)return!0;var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;)if(a.next().hasPendingUpdates)return this._iteratorPool.release(a),!0;this._iteratorPool.release(a);return!1};b.prototype.getTile=function(a){var c=a.split("/").map(function(a){return+a});if(0===c[0])return this.rootTiles.forEach(function(a){if(a.lij[1]===
c[1]&&a.lij[2]===c[2])return a}),null;var b=Math.pow(2,c[0]),d=Math.floor(c[1]/b),e=Math.floor(c[2]/b),f;this.rootTiles.some(function(a){return a.lij[1]===d&&a.lij[2]===e?(f=a,!0):!1});if(f){for(b=1<<c[0]-1;f.lij[0]<c[0];){var g=c[1]&b?2:0;0<(c[2]&b)&&g++;if(!f.children[g])return console.log("Tile "+a+" doesn't exist, smallest ancestor is "+Q.tile2str(f)),null;f=f.children[g];b>>=1}R.weakAssert(f.lij[0]===c[0]&&f.lij[1]===c[1]&&f.lij[2]===c[2],"not the right tile?");return f}return null};b.prototype.setBorders=
function(a){this._renderer.drawBorders=a};b.prototype.setDisableRendering=function(a){this._renderer.disableRendering=a};Object.defineProperty(b.prototype,"test",{get:function(){var a=this;return{renderer:this._renderer,lercWorker:this._lercWorker,mergeTile:function(c){return a._mergeTile(c)},updateTiles:function(c){return a._updateTiles(c)}}},enumerable:!0,configurable:!0});f([e.property({value:!1})],b.prototype,"cullBackFaces",null);f([e.property({readOnly:!0})],b.prototype,"extent",null);f([e.property({readOnly:!0})],
b.prototype,"loaded",void 0);f([e.property({value:1})],b.prototype,"baseOpacity",null);f([e.property({readOnly:!0})],b.prototype,"overlayManager",void 0);f([e.property({readOnly:!0})],b.prototype,"manifold",void 0);f([e.property()],b.prototype,"maxTextureScaleRaster",void 0);f([e.property()],b.prototype,"maxTextureScaleVector",void 0);f([e.property({readOnly:!0})],b.prototype,"ready",null);f([e.property({value:1})],b.prototype,"renderOrder",null);f([e.property({readOnly:!0})],b.prototype,"rootTiles",
void 0);f([e.property({value:!0})],b.prototype,"skirtScale",null);f([e.property({readOnly:!0,dependsOn:["tilingScheme.spatialReference"]})],b.prototype,"spatialReference",null);f([e.property({})],b.prototype,"backgroundImage",void 0);f([e.property({type:k})],b.prototype,"backgroundColor",void 0);f([e.property({dependsOn:["backgroundColor","backgroundImage"]})],b.prototype,"_background",null);f([e.property({value:!1})],b.prototype,"slicePlaneEnabled",null);f([e.property({readOnly:!0})],b.prototype,
"tilingScheme",void 0);f([e.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],b.prototype,"tilingSchemeLocked",void 0);f([e.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],b.prototype,"tilingSchemeDone",void 0);f([e.property({readOnly:!0})],b.prototype,"tilingSchemeLogic",void 0);f([e.property({value:!0})],b.prototype,"velvetOverground",null);f([e.property({value:!1})],b.prototype,"wireframe",null);return b=f([e.subclass("esri.views.3d.terrain.TerrainSurface")],
b)}(e.declared(d,z.Evented));var Z=1.2,Y=80/180*Math.PI,ea=110/180*Math.PI,ga=12,ja=w.vec4f64.create(),fa=x.create(),ha=[0,0,0],ka={spatialReference:null,tile:null,extent:null},ia={spatialReference:null,extent:null,scale:0};return q})},"esri/layers/support/LercWorker":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/promiseUtils ../../core/requireUtils ../../core/workers module".split(" "),function(q,b,n,f,k,d,h){function m(){return f.create(function(a){q(["./rasterFormats/LercCodec"],
a)})}Object.defineProperty(b,"__esModule",{value:!0});var p=function(){function a(){}a.prototype._decode=function(a){return m().then(function(c){c=c.decode;c=c(a.buffer,a.options);return{result:c,transferList:[c.pixelData.buffer]}})};return a}(),c=function(a){function c(c){var b=a.call(this)||this;b.scheduler=c;b._thread=void 0;d.open(k.getAbsMid("./LercWorker",q,h),{strategy:"dedicated",scheduler:c}).then(function(a){void 0===b._thread?b._thread=a:a.close()});return b}n(c,a);c.prototype.destroy=
function(){this._thread&&this._thread.close();this._thread=null};c.prototype.decode=function(a,c){return a&&0!==a.byteLength?this._thread?this._thread.invoke("_decode",{buffer:a,options:c},{transferList:[a]}):m().then(function(b){b=b.decode;return b(a,c)}):f.resolve(null)};return c}(p),a=new Map;b.acquireInstance=function(b){var d=a.get(b);d||(d={instance:new c(b),ref:0},a.set(b,d));++d.ref;return d.instance};b.releaseInstance=function(c){if(null!=c){c=c.scheduler;var b=a.get(c);b&&0>=--b.ref&&(b.instance.destroy(),
a.delete(c))}};b.default=function(){return new p}})},"esri/views/3d/terrain/ElevationData":function(){define(["require","exports","../support/mathUtils","./TerrainConst"],function(q,b,n,f){return function(){function b(b,f,k,p){this.samplerData=null;this.level=b;this.i=f;this.j=k;this.extent=p}b.prototype.computeMinMaxValue=function(b,h,k,p){var c=Infinity,a=-Infinity;b-=this.level;var d=Math.pow(2,b);if(Math.floor(h/d)===this.i&&Math.floor(k/d)===this.j&&0<b){var g=this.samplerData.width,e=this.samplerData.pixelData,
m=.5*f.ELEVATION_NODATA_VALUE;b=(g-1)/d;k=(k-this.j*d)*b;var t=(h-this.i*d)*b;if(1>b){var r=Math.floor(k),q=Math.floor(t),w=r+q*g;h=e[w];var d=e[w+1],x=e[w+g],w=e[w+g+1];if(h+d+x+w<m)return c=k-r,m=t-q,a=n.bilerp(h,d,x,w,c,m),g=n.bilerp(h,d,x,w,c+b,m),e=n.bilerp(h,d,x,w,c,m+b),b=n.bilerp(h,d,x,w,c+b,m+b),p[0]=Math.min(a,g,e,b),p[1]=Math.max(a,g,e,b),p;k=r;t=q;b=1}else k=Math.floor(k),t=Math.floor(t),b=Math.ceil(b);for(h=k;h<=k+b;h++)for(d=t;d<=t+b;d++)w=h+d*g,x=e[w],x<m?(c=Math.min(c,x),a=Math.max(a,
x)):(c=0<c?0:c,a=0>a?0:a)}p[0]=c;p[1]=a;return p};b.create=function(d,f,k){d=new b(d[0],d[1],d[2],f);f=k.noDataValue;var h=k.minValue,c=k.maxValue;if(null==h||null==c){for(var a=k.values,h=Infinity,c=-Infinity,l=!0,g=0;g<a.length;g++){var e=a[g];e!==f&&(h=e<h?e:h,c=e>c?e:c,l=!1)}l&&(c=h=0)}c=-3E38<c?c:0;d.samplerData={pixelData:k.values,width:k.width,height:k.height,minValue:h,maxValue:c,noDataValue:f,safeWidth:.99999999*(k.width-1),dx:(k.width-1)/(d.extent[2]-d.extent[0]),dy:(k.width-1)/(d.extent[3]-
d.extent[1]),x0:d.extent[0],y1:d.extent[3]};d.bounds=[h,c];return d};return b}()})},"esri/views/3d/terrain/ElevationTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TerrainConst ./TileAgent".split(" "),function(q,b,n,f,k,d){return function(b){function d(){var d=null!==b&&b.apply(this,arguments)||this;d._scaleRangeEnabled=!1;return d}n(d,b);d.prototype._desiredMinLevelDelta=function(){return k.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-
this.tile.lij[0])};d.Pool=new f(d);return d}(d)})},"esri/views/3d/terrain/TileAgent":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","./TerrainConst","./tileUtils"],function(q,b,n,f,k){var d=Error("Abstract method called on TileAgent");q=function(){function b(){}b.prototype.init=function(b,d,c,a){this.tile=b;this._layerIdx=d;this._layerClass=c;this._suspended=a;this._tileLayerInfo=b.getLayerInfo(d,c);this._dataRequested=null;b=this._findAncestorWithData();this._setUpsampleTile(b)};
b.prototype.startLoading=function(){return this._requestNext()};b.prototype.dispose=function(){this._dataRequested&&(this._dataRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._dataRequested=null);this._tileLayerInfo=this.tile=null};b.prototype.setSuspension=function(b){b!==this._suspended&&((this._suspended=b)?this._dataRequested&&(this._dataRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._dataRequested=null):this._tileLayerInfo.data||this.update())};
b.prototype.update=function(){var b=this._findAncestorWithData();this._setUpsampleTile(b);return this._requestNext()};b.prototype.dataArrived=function(b){this._setUpsampleTile(b);this._dataRequested=null;b===this.tile?this.tile.updateRenderData(this._layerClass):this._requestNext()};b.prototype.dataMissing=function(b){this._dataRequested=null;this._tileLayerInfo.disposeData();this._requestNext()};b.prototype._agentDone=function(){this.tile.agentDone(this._layerIdx,this._layerClass);this.dispose()};
b.prototype._requestNext=function(){if(this._suspended)return!0;var b=this._findNextDownload();if(this._dataRequested){if(b===this._dataRequested)return!0;this._dataRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._dataRequested=null}b?b.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._dataRequested=b):this._agentDone();return!!this._dataRequested};b.prototype._findNextDownload=function(){for(var b=this._layerIdx,d=this._layerClass,c=this.tile.surface.layerViewByIndex(b,
d),a=c.layer,h=c.minDataLevel,c=c.maxDataLevel,g=this._desiredMinLevelDelta(),e=f.START_LOADING_LEVEL_DELTA+g,n=this._scaleRangeEnabled?k.fallsWithinLayer:function(){return!0},q,r=this.tile,y=0,w=this._tileLayerInfo.upsampleFromTile,w=w?w.tile.lij[0]:-1,x=this.tile.surface,v=x.tilemapStats,z=x.getTilemapTile(r),A=!1;r&&n(r,a,!1)&&r.lij[0]>=h;){var B=r.lij[0],C=r.layerInfo[d][b];if(C.data&&y>=g){B>w&&this._setUpsampleTile(r);C.dataInvalidated&&(q=r);break}if(z&&!z.hasDataAvailable(r,b,d))A=!0;else if(B<=
c&&!C.data&&!C.dataMissing){if(!q||0===B%f.LOADING_LEVEL_MODULO||this.tile.lij[0]-q.lij[0]<g)q=r;if(y>=e)break}(r=r.parent)&&z&&(z=z.parent||x.getTilemapTile(r));y++}q&&this.tile.lij[0]-q.lij[0]<g&&this._tileLayerInfo.upsampleFromTile&&(q=null);!q&&A&&v.tilesNotPresent++;return q};b.prototype._findAncestorWithData=function(){for(var b=this.tile.vlevel,d=this._desiredMinLevelDelta(),c,a=this.tile;a;a=a.parent)if(a.hasLayerData(this._layerIdx,this._layerClass)){if(b-a.lij[0]>=d)return a;c=a}return c};
b.prototype._setUpsampleTile=function(b){this._tileLayerInfo.setUpsampleInfo(this.tile,b);this.tile.updateRenderData(this._layerClass)};return b}();b=function(b){function f(){return null!==b&&b.apply(this,arguments)||this}n(f,b);f.prototype._desiredMinLevelDelta=function(){throw d;};return f}(q);(q||(q={})).DONE=new b;return q})},"esri/views/3d/terrain/tileUtils":function(){define("require exports ../../../core/PooledArray ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(q,b,n,f,k,d){function h(a){return a[0]+"/"+a[1]+"/"+a[2]}function m(a,c){c(a);for(var b=0;4>b;b++){var d=a.children[b];d&&m(d,c)}}function p(a,c){for(var b=0;4>b;b++){var d=a.children[b];d&&p(d,c)}c(a)}function c(a,c,b){a=a.screenDepth;c=c.screenDepth;return a<c?-b:a>c?b:0}Object.defineProperty(b,"__esModule",{value:!0});q=function(){function a(){this.q=new n;this._last=null;this.done=!0}a.prototype.resetOne=function(a){this.q.clear();this.q.push(a);this._last=null;this.done=!1};a.prototype.reset=
function(a){this.q.clear();a&&this.q.pushArray(a);this._last=null;this.done=0===this.q.length};a.prototype.skipSubtree=function(){this._last=null;0===this.q.length&&(this.done=!0)};a.prototype.next=function(){if(this.done)return null;if(this._last){var a=this._last.children;if(a[0])for(var c=3;0<=c;c--){var b=a[c];b&&this.q.push(b)}}this._last=this.q.pop();0!==this.q.length||this._last.children[0]||(this.done=!0);return this._last};return a}();b.IteratorPreorder=q;q=function(){function a(){this.q=
new n;this.done=!0}a.prototype.reset=function(a){this.q.clear();if(a)for(this.q.pushArray(a),a=0;a<this.q.length;++a)for(var c=this.q.data[a],b=0;4>b;b++){var d=c.children[b];d&&this.q.push(d)}this.done=0===this.q.length};a.prototype.next=function(){var a=this.q.pop();this.done=0===this.q.length;return a};return a}();b.IteratorPostorder=q;b.lij2str=h;b.tile2str=function(a){return h(a.lij)};b.traverseTilesPreorder=function(a,c){if(Array.isArray(a))for(var b=0;b<a.length;b++)m(a[b],c);else m(a,c)};
b.traverseTilesPostorder=function(a,c){if(Array.isArray(a))for(var b=0;b<a.length;b++)p(a[b],c);else p(a,c)};b.findParentByLIJ=function(a,c){for(;a;a=a.parent)if(a.hasLij(c))return a;return null};b.fallsWithinLayer=function(a,c,b){if(!c)return!1;var d=c.fullExtent,e=a.extent;if(b){if(e[0]<d.xmin||e[1]<d.ymin||e[2]>d.xmax||e[3]>d.ymax)return!1}else if(d.xmin>e[2]||d.ymin>e[3]||d.xmax<e[0]||d.ymax<e[1])return!1;a=a.surface.tilingScheme.levels[a.lij[0]].scale;return 0<c.minScale&&a>1.00000001*c.minScale||
0<c.maxScale&&a<.99999999*c.maxScale?!1:!0};b.isPosWithinTile=function(a,c){a=a.extent;return c[0]>=a[0]&&c[1]>=a[1]&&c[0]<=a[2]&&c[1]<=a[3]};b.getTileNLevelsUp=function(a,c){for(;c--;)a=a.parent;return a};b.nextTileInAncestry=function(a,c){var b=a.lij[0]-c.lij[0]-1,d=a.lij[2]>>b,e=0;a.lij[1]>>b&1&&(e+=2);d&1&&(e+=1);return c.children[e]};b.sortTiles=function(a,b){b.sort(function(b,d){return c(b,d,a)})};b.compareTiles=c;b.computeUpsampleInfo=function(a,c,b){for(var d=1,e=0,f=0;a!==c;)if(d*=.5,e*=
.5,f*=.5,a.lij[2]&1&&(e+=.5),0===(a.lij[1]&1)&&(f+=.5),a=a.parent,null==a)throw Error("tile was not a descendant of upsampleTile");b.init(c,e,f,d)};b.hasVisibleSiblings=function(a){for(var c=0;c<a.length;c++){var b=a[c],d=b.parent;if(d)for(var e=0;4>e;e++){var f=d.children[e];if(f&&f!==b&&f.visible)return!0}}return!1};var a=Math.pow(2,-52),l=k.vec3f64.create(),g=k.vec3f64.create();b.intersectSkirts=function(c,b,h,k,m,p,n,q,z){var e=p.data,r=p.offsetIdx;p=p.strideIdx;var t=c[0],u=c[1];c=c[2];var w=
b[0]-t,y=b[1]-u;for(b=b[2]-c;h<k;h++){var v=n?n[h]:h,x=r+p*m[3*v],K=r+p*m[3*v+1],M=r+p*m[3*v+2],O=e[x],N=e[x+1],P=e[x+2];2<=e[x+3]&&(f.vec3.set(l,O,N,P),q(l),O+=l[0],N+=l[1],P+=l[2]);var L=e[K],x=e[K+1],T=e[K+2];2<=e[K+3]&&(f.vec3.set(l,L,x,T),q(l),L+=l[0],x+=l[1],T+=l[2]);var K=e[M],R=e[M+1],J=e[M+2];2<=e[M+3]&&(f.vec3.set(l,K,R,J),q(l),K+=l[0],R+=l[1],J+=l[2]);var M=L-O,x=x-N,T=T-P,K=K-O,R=R-N,J=J-P,U=y*J-R*b,Q=b*K-J*w,I=w*R-K*y,L=M*U+x*Q+T*I,O=t-O,V=u-N,X=c-P,P=V*T-x*X,N=X*M-T*O,W=O*x-M*V;if(L>
a){O=O*U+V*Q+X*I;if(0>O||O>L)continue;U=w*P+y*N+b*W;if(0>U||O+U>L)continue}else if(L<-a){O=O*U+V*Q+X*I;if(0<O||O<L)continue;U=w*P+y*N+b*W;if(0<U||O+U<L)continue}else continue;P=(K*P+R*N+J*W)/L;0<=P&&(M=d.computeNormal(M,x,T,K,R,J,g),z(P,M,v))}}})},"esri/views/3d/terrain/MapTileAgent":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../../../core/ObjectPool","./TileAgent"],function(q,b,n,f,k){return function(b){function d(){var d=b.call(this)||this;d._scaleRangeEnabled=
!0;return d}n(d,b);d.prototype._desiredMinLevelDelta=function(){return 0};d.Pool=new f(d);return d}(k)})},"esri/views/3d/terrain/OverlayManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Graphic ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/scheduling ../../../core/screenUtils ../../../core/accessorSupport/decorators ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../../../symbols/SimpleMarkerSymbol ../state/utils/viewUtils ../support/debugFlags ../support/debugFlags ../support/earthUtils ../support/mathUtils ../support/projectionUtils ../support/stack ../webgl-engine/lib/Intersector ../webgl-engine/lib/localOrigin".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C,E,F,H,D,G,K){var M=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],O=p.getLogger("esri.views.3d.OverlayManager"),N,P=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a._handles=new h;a._overlaySR=null;a._renderSR=null;a._overlaySREqualsRenderSR=!0;a._connectedLayers={};a._scale=0;a._placementDirty=!1;a._drawTexturesDirty=!1;a._isSpherical=
!1;a._latestOriginId=0;a._maxResolution=m("esri-mobile")?2048:4096;a.opacity=0;return a}n(d,b);Object.defineProperty(d.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});d.prototype.initialize=function(){var a=this;this._stage=this.view._stage;this._renderer=this._stage.getDrapedRenderer();this._renderer.onHasHighlightsChanged=function(){return a.onHasHighlightsChanged()};this._renderer.onContentChanged=function(){return a.setDrawTexturesDirty()};
this._renderer.forceUpdate=function(c){a.updateOverlays(c);a._preRender()};this.groundIntersector=new G(this.view.viewingMode);this.groundIntersector.enable.backfacesTerrain=!0;this.groundIntersector.enable.invisibleTerrain=!0;this.groundIntersector.enable.hud=!1;this._handles.add(this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location","pixelRatio"],function(){return a.setOverlayPlacementDirty()}));this._handles.add(this.view.on("resize",function(){return a.setOverlayPlacementDirty()}));
this._handles.add(l.addFrameTask({preRender:function(){return a._preRender()}}))};d.prototype.destroy=function(){for(var a in this._connectedLayers)this.unregisterLayerView(this._connectedLayers[a].layerView);this._disposeOverlays();this._handles&&(this._handles.destroy(),this._handles=null)};d.prototype.onHasHighlightsChanged=function(){this.setOverlayPlacementDirty();this.notifyChange("hasHighlights")};d.prototype.hasOverlays=function(){return!!this._overlays};d.prototype.setSpatialReference=function(a,
c){(this._overlaySR=a)?(this._renderSR=this.view.renderSpatialReference,this._overlaySREqualsRenderSR=this._overlaySR.equals(this._renderSR),this._longitudeCyclical=(this._isSpherical=c)?a.isWebMercator?new F.Cyclical(-2.0037508342788905E7,2.0037508342788905E7):new F.Cyclical(-180,180):null):(this._disposeOverlays(),this._longitudeCyclical=null)};d.prototype.registerLayerView=function(a){var c=this,b=a.layer.uid;if(this._connectedLayers[b])O.warn("[OverlayManager#registerLayerView]: Layer "+b+" is already connected");
else{var d=a.on("draped-data-change",function(){return c.setOverlayPlacementDirty()});this._connectedLayers[b]={eventHandles:[d],layerView:a};a.setDrapingExtent&&this._overlays&&[this._overlays.inner,this._overlays.outer].forEach(function(b,d){a.setDrapingExtent(d,b.extent,c._overlaySR,b.resolution,b.renderLocalOrigin,b.pixelRatio)});this.setOverlayPlacementDirty();this._setLayerViewOverlayUpdating(a,!0)}};d.prototype.unregisterLayerView=function(a){for(var c in this._connectedLayers){var b=this._connectedLayers[c];
if(b.layerView===a){if(b.eventHandles)for(var d=0;d<b.eventHandles.length;d++)b.eventHandles[d].remove();delete this._connectedLayers[c];this.setOverlayPlacementDirty();a.destroyed||(a.overlayUpdating=!1)}}};d.prototype.setOverlayPlacementDirty=function(){this._placementDirty||(this._setOverlayUpdating(!0),this._placementDirty=!0)};d.prototype._setLayerViewOverlayUpdating=function(a,c){if(!c||!a.suspended&&a.hasDraped)a.overlayUpdating=c};d.prototype._setOverlayUpdating=function(c){for(var b in this._connectedLayers)this._setLayerViewOverlayUpdating(this._connectedLayers[b].layerView,
c);b=this.view.graphicsView;a.isSome(b)&&(b.overlayUpdating=c)};d.prototype.updateOverlays=function(a){void 0===a&&(a=this.view.state.camera);if(this._overlaySR){var b;b=c.nextHighestPowerOfTwo(Math.max(a.fullWidth,a.fullHeight)+256);var d=Math.min(b,this._maxResolution);this._computeOverlayExtents(a,b,Q);this._overlays||this._initOverlays();this._updateOverlay(this._overlays.inner,0,Q.inner,d,1);this._updateOverlay(this._overlays.outer,1,Q.outer,d,v.width(Q.inner)/v.width(Q.outer));this.opacity=
1;this.terrainSurface._updateTileOverlayParams();this._placementDirty=!1;this.setDrawTexturesDirty()}};d.prototype._updateOverlay=function(a,c,b,d,e){var f;a:{f=a.extent;for(var g=B.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS?0:P.EXTENTS_DIFFER_THRESHOLD*Math.max(b[2]-b[0],b[3]-b[1],f[2]-f[0],f[3]-f[1]),h=0;4>h;h++)if(Math.abs(f[h]-b[h])>g){f=!0;break a}f=!1}if(f||d!==a.resolution||a.pixelRatio!==e){v.set(a.extent,b);a.resolution=d;a.pixelRatio=e;e=v.center(a.extent);a.renderLocalOrigin=K.fromValues(e[0],
e[1],0,"OV_"+this._latestOriginId++);for(var l in this._connectedLayers)e=this._connectedLayers[l].layerView,e.setDrapingExtent&&e.setDrapingExtent(c,b,this._overlaySR,d,a.renderLocalOrigin,a.pixelRatio)}};d.prototype.overlaysNeedUpdate=function(){return this._placementDirty&&!!this._overlaySR};d.prototype.updateOpacity=function(a){var c=1;if(this._overlays){var b=this._scale;3.5*a<b&&(c=Math.sqrt(F.clamp((a-b/10)/(b/3.5-b/10),0,1)))}return c};d.prototype.setOverlayParamsOfTile=function(a,c,b){var d=
this._overlays.inner,e=this._overlays.outer;a=v.intersection(a.extent,a.surface.extent,I);this._rectInsideRect(a,d.extent)?(this._setTileOverlayData(a,d,c.overlays[0]),this._invalidateTileOverlayData(c.overlays[1])):this._rectanglesOverlap(a,d.extent)?(this._setTileOverlayData(a,d,c.overlays[0]),this._setTileOverlayData(a,e,c.overlays[1])):(this._rectanglesOverlap(a,e.extent)?this._setTileOverlayData(a,e,c.overlays[0]):this._invalidateTileOverlayData(c.overlays[0]),this._invalidateTileOverlayData(c.overlays[1]));
c.overlayOpacity=void 0!==b?b:1};d.prototype.overlayPixelSizeInMapUnits=function(a){var c;this._overlays&&(c=this._pointIsInExtent(a,this._overlays.inner.extent)?this._overlays.inner:this._overlays.outer);return c?(c.extent[2]-c.extent[0])/c.resolution:0};d.prototype._setTileOverlayData=function(a,c,b){var d=c.extent;b.texScale[0]=(a[2]-a[0])/(d[2]-d[0]);b.texScale[1]=(a[3]-a[1])/(d[3]-d[1]);var e=a[0];if(this._longitudeCyclical){var e=this._longitudeCyclical.minimalMonotonic(d[0],e),f=this._longitudeCyclical.minimalMonotonic(d[0],
a[2]);e>f&&(e=f-(a[2]-a[0]))}b.texOffset[0]=(e-d[0])/(d[2]-d[0]);b.texOffset[1]=(a[1]-d[1])/(d[3]-d[1]);b.renderTargetId=c.valid?c.renderTargetId:null;b.highlightRenderTargetId=c.highlightValid?c.highlightRenderTargetId:null};d.prototype._invalidateTileOverlayData=function(a){a.renderTargetId=null;a.highlightRenderTargetId=null};Object.defineProperty(d.prototype,"test",{get:function(){return{overlays:this._overlays}},enumerable:!0,configurable:!0});d.prototype._createEmptyOverlay=function(a){var c=
this._renderer.createRenderTarget("overlay"+a);a=this._renderer.createHighlightRenderTarget("overlayHighlight"+a);return{extent:v.create(),resolution:0,renderTargetId:c,valid:!1,highlightRenderTargetId:a,highlightValid:!1,renderLocalOrigin:K.fromValues(0,0,0,"O"),pixelRatio:1}};d.prototype._initOverlays=function(){this._overlays={inner:this._createEmptyOverlay(0),outer:this._createEmptyOverlay(1)}};d.prototype._disposeOverlays=function(){this._overlays&&(this._renderer.disposeRenderTarget(this._overlays.inner.renderTargetId),
this._renderer.disposeRenderTarget(this._overlays.inner.highlightRenderTargetId),this._renderer.disposeRenderTarget(this._overlays.outer.renderTargetId),this._renderer.disposeRenderTarget(this._overlays.outer.highlightRenderTargetId),this._overlays=null)};d.prototype._preRender=function(){this._drawTexturesDirty&&(this._drawOverlays(),this._drawTexturesDirty=!1)};d.prototype.setDrawTexturesDirty=function(){this._overlays?this._drawTexturesDirty||(this._drawTexturesDirty=!0,this._setOverlayUpdating(!0)):
this.setOverlayPlacementDirty()};d.prototype._intersectGroundFromView=function(a,c,b,d){var e=g.createRenderScreenPointArray3(c*a.fullWidth,b*a.fullHeight,1),e=a.unprojectPoint(e,D.sv3d.get());c=g.createRenderScreenPointArray3(c*a.fullWidth,b*a.fullHeight,0);c=a.unprojectPoint(c,D.sv3d.get());this.groundIntersector.intersect([],c,e,null,a,null,!1);this.view.basemapTerrain.intersect(this.groundIntersector,null,c,e);return this.groundIntersector.results.min.getIntersectionPoint(d)};d.prototype._findHorizonBasedPointOfInterest=
function(a,c,b){var d=.5;if("global"===this.view.viewingMode){d=r.vec3f64.clone(a.eye);t.vec3.normalize(d,d);t.vec3.negate(d,d);c=t.vec3.length(c);c=Math.asin(c/t.vec3.length(a.eye));var e=Math.acos(t.vec3.dot(a.viewForward,d)),d=F.clamp((c-(e-.5*a.fovY))/a.fovY,0,1);c=F.clamp((-c-(e-.5*a.fovY))/a.fovY,0,1);d=1===d&&0===c?.5:c+.55*(d-c)}else d=w.vec4f64.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-a.viewForward[2])),1,0),d=y.vec4.transformMat4(d,d,a.projectionMatrix)[1],d=F.clamp(.5+.5*d,0,1),d=1===
d||0===d?.5:0<a.eye[2]?.55*d:1-.55*(1-d);return this._intersectGroundFromView(a,.5,d,b)?!0:!1};d.prototype._computeOverlayExtents=function(a,c,b){var d=this.terrainSurface.extent,e=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,f=r.vec3f64.create();this._findHorizonBasedPointOfInterest(a,e,f)||t.vec3.copy(f,e);this._scale=this.view.renderCoordsHelper.getAltitude(a.eye);var g=t.vec3.distance(a.eye,f),e=A.viewAngle(this.view.renderCoordsHelper,e,a.eye),e=Math.PI/2-Math.abs(e-Math.PI/
2);if(C.OVERLAY_SHOW_CENTER){var h=new z({color:[255,0,0],outline:{color:[255,255,255],width:2}}),l=new x;H.vectorToPoint(f,this._renderSR,l,this._overlaySR);h=new k({geometry:l,symbol:h});void 0!==N&&this.view.graphics.remove(N);this.view.graphics.add(h);N=h}this._overlaySREqualsRenderSR||H.vectorToVector(f,this._renderSR,f,this._overlaySR);c=c*a.perRenderPixelRatio*g/2;l=!1;g=Infinity;this._isSpherical&&(this._overlaySR.isWebMercator?(c/=Math.cos(H.webMercator.y2lat(f[1])),g=this.terrainSurface.extent[3],
g*=.999):(l=!0,c/=E.metersPerDegree,g=90),c>=g&&(c=g,f[1]=0,this._overlaySR.isWebMercator&&(f[0]=0)));h=1;l&&(h=1/Math.max(.2,Math.cos(Math.abs(F.deg2rad(f[1])))),180<c*h&&(h=180/c));var m=c*h,l=b.inner;l[0]=f[0]-m;l[1]=f[1]-c;l[2]=f[0]+m;l[3]=f[1]+c;this._isSpherical&&this._shiftExtentToFitBounds(l,Infinity,g);b=b.outer;v.set(b,l);6*m>d[2]-d[0]?v.set(b,d):e<=.25*Math.PI?(b[0]-=m,b[1]-=c,b[2]+=m,b[3]+=c):(H.vectorToVector(a.eye,this._renderSR,U,this._overlaySR),u.vec2.subtract(J,f,U),a=-Math.atan2(J[1],
J[0])+.125*Math.PI,0>a&&(a+=2*Math.PI),y.vec4.scale(J,M[Math.floor(a/(.25*Math.PI))],2*c),J[0]*=h,J[2]*=h,y.vec4.add(b,b,J));this._isSpherical&&(b[0]=this._longitudeCyclical.clamp(b[0]),b[2]=this._longitudeCyclical.clamp(b[2]),b[1]=Math.max(b[1],-g),b[3]=Math.min(b[3],g));!this._isSpherical&&d&&(a=v.intersection(l,d,I),d=v.intersection(b,d,V),v.contains(a,d)&&(b[2]=b[0],b[3]=b[1]))};d.prototype._drawOverlays=function(){var a=!this._overlays.inner.valid||!this._overlays.outer.valid;this._drawOverlay(this._overlays.inner,
0);this._drawOverlay(this._overlays.outer,1);a&&this.terrainSurface._updateTileOverlayParams();this._setOverlayUpdating(!1);this._stage.setNeedsRender()};d.prototype._drawOverlay=function(a,c){var b=this._renderer,d=a.extent,e=a.resolution,f=a.pixelRatio,g=this._longitudeCyclical?d[2]>this._longitudeCyclical.max:!1,h=this._longitudeCyclical?d[0]<this._longitudeCyclical.min:!1;if(g||h){L.views=R;var h=void 0,h=g?this._longitudeCyclical.max-d[0]:this._longitudeCyclical.min-d[0],h=Math.round(h/(d[2]-
d[0])*e),l=L.views[0];y.vec4.set(l.viewport,0,0,h,e);y.vec4.set(l.extent,d[0],d[1],this._longitudeCyclical.max,d[3]);g||(l.extent[0]+=this._longitudeCyclical.range);l=L.views[1];y.vec4.set(l.viewport,h,0,e-h,e);y.vec4.set(l.extent,this._longitudeCyclical.min,d[1],d[2],d[3]);g&&(l.extent[2]-=this._longitudeCyclical.range)}else L.views=T,v.set(L.views[0].extent,d),y.vec4.set(L.views[0].viewport,0,0,e,e);L.width=e;L.height=e;L.pixelRatio=f*this.view.state.camera.pixelRatio;L.index=c;a.valid=b.draw(a.renderTargetId,
L);a.highlightValid=b.drawHighlights(a.highlightRenderTargetId,L)};d.prototype._rectanglesOverlap=function(a,c){return this._longitudeCyclical?(this._longitudeCyclical.contains(c[0],c[2],a[0])||this._longitudeCyclical.contains(c[0],c[2],a[2])||this._longitudeCyclical.contains(a[0],a[2],c[0]))&&!(a[1]>c[3]||a[3]<c[1]):v.intersects(a,c)};d.prototype._rectInsideRect=function(a,c){return this._longitudeCyclical?this._longitudeCyclical.contains(c[0],c[2],a[0])&&this._longitudeCyclical.contains(c[0],c[2],
a[2])&&a[1]>c[1]&&a[3]<c[3]:v.contains(c,a)};d.prototype._pointIsInExtent=function(a,c){if(this._longitudeCyclical)return this._longitudeCyclical.contains(c[0],c[2],a.x)&&a.y>=c[1]&&a.y<=c[3];var b=a.x;a=a.y;return b>c[0]&&b<c[2]&&a>c[1]&&a<c[3]};d.prototype._shiftExtentToFitBounds=function(a,c,b){var d=0,e=0;a[0]<-c?d=a[0]+c:a[2]>c&&(d=c-a[2]);a[1]<-b?e=a[1]+b:a[3]>b&&(e=b-a[3]);v.offset(a,d,e)};d.EXTENTS_DIFFER_THRESHOLD=1E-5;f([e.property()],d.prototype,"view",void 0);f([e.property()],d.prototype,
"terrainSurface",void 0);f([e.property({type:Boolean})],d.prototype,"hasHighlights",null);return d=f([e.subclass("esri.views.3d.terrain.OverlayManager")],d)}(e.declared(d)),L={width:0,height:0,pixelRatio:0,views:null,index:0},T=[{viewport:v.create(),extent:v.create()}],R=[T[0],{viewport:v.create(),extent:v.create()}],J=w.vec4f64.create(),U=r.vec3f64.create(),Q={inner:v.create(),outer:v.create()},I=v.create(),V=v.create();return P})},"esri/views/3d/terrain/PlanarTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingBox ../support/geometryUtils ../support/mathUtils ./Tile ./TileGeometryFactory".split(" "),
function(q,b,n,f,k,d,h,m,p){q=function(a){function b(d,e,f){var g=a.call(this,b.NumSubdivisionsAtLevel)||this;g.tileUp=c;void 0!==d&&g.init(d,e,f);return g}n(b,a);b.prototype.init=function(c,b,d){a.prototype.init.call(this,c,b,d);this.edgeLen=this.extent[2]-this.extent[0];this.edgeLen2=this.edgeLen*this.edgeLen;this.curvatureHeight=0;this.centerAtSeaLevel[0]=h.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=h.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=0;this.updateRadiusAndCenter()};
b.prototype.updateRadiusAndCenter=function(){a.prototype.updateRadiusAndCenter.call(this);var c=(this.extent[2]-this.extent[0])*Math.SQRT1_2,b=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this.radius=Math.sqrt(c*c+b*b)};b.prototype._isVisible=function(){return this.intersectsClippingArea&&d.frustum.intersectsAABB(this.surface.frustum.planes,k.wrap(this.extent[0],this.extent[1],this.elevationBounds[0],this.extent[2],this.extent[3],this.elevationBounds[1]))};b.prototype.createGeometry=function(a,
c,b){p.createPlanarGlobeTile(a,this.extent,c,b,this.renderData);this.updateMemoryUsed()};b.NumSubdivisionsAtLevel=[2,2,2,2,2,2,2,2];return b}(m);var c=f.vec3f64.fromValues(0,0,1);return q})},"esri/views/3d/terrain/Tile":function(){define("require exports ../../../core/arrayUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingRect ../support/mathUtils ./ElevationTileAgent ./MapTileAgent ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./tileUtils ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture ../../webgl/Util".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v){function z(a){a.dispose();a instanceof l?l.Pool.release(a):a instanceof g&&g.Pool.release(a)}var A=u.weakAssert,B=h.vec3f64.create(),C=h.vec3f64.create(),E=p.vec4f64.create(),F=h.vec3f64.create();return function(){function b(a){this._numSubdivisionAtLevel=a;this.lij=[0,0,0];this._dirty=!0;this.extent=c.create();this._elevationBounds=k.vec2f64.create();this.children=[null,null,null,null];this.layerInfo=Array(e.LayerClass.COUNT);this.extentWGS84Rad=
c.create();this.centerAtSeaLevel=h.vec3f64.create();this.center=h.vec3f64.create();this.tileUp=F;this.intersectsClippingArea=this._isWithinClippingArea=!0;this.clippingArea=null;this._memoryUsed=this.radius=this.edgeLen2=this.edgeLen=this.renderOrder=this.screenDepth=this._maxTesselation=0}Object.defineProperty(b.prototype,"memoryUsed",{get:function(){return this._memoryUsed},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"maxTesselation",{get:function(){return this._maxTesselation},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"numSubdivisionsAtLevel",{get:function(){return this._numSubdivisionAtLevel},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isWithinClippingArea",{get:function(){return this._isWithinClippingArea},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"surface",{get:function(){return this._surface},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"elevationBounds",{get:function(){return this._elevationBounds},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"visible",{get:function(){if(this._dirty){var a=this._isVisible();a!==this._visible&&(this._visible=a,this.updateAgentSuspension(),this._visible=a);this._dirty=!1}return this._visible},enumerable:!0,configurable:!0});b.prototype.init=function(a,c,b){this.lij[0]=a[0];this.lij[1]=a[1];this.lij[2]=a[2];b.tilingScheme.getExtent(a[0],
a[1],a[2],this.extent,this.extentWGS84Rad);this.intersectsClippingArea=this._isWithinClippingArea=!0;this.clippingArea=null;this.radius=this.edgeLen2=this.edgeLen=0;this.vlevel=a?a[0]:0;c&&c._elevationBounds?f.vec2.copy(this.elevationBounds,c.elevationBounds):f.vec2.set(this.elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this.screenDepth=0;this._visible=!1;this._dirty=!0;this._parent=c;this._surface=b;for(a=0;4>a;a++)this.children[a]=null;for(a=0;a<e.LayerClass.COUNT;a++){c=b.numLayers(a);
var d=this.layerInfo[a];this.layerInfo[a]?d.length=c:(d=Array(c),this.layerInfo[a]=d);for(var g=0;g<c;g++)d[g]=r.TilePerLayerInfo.makeEmptyLayerInfo(a,this._surface.upsampleInfoPool,d[g]),a===e.LayerClass.ELEVATION&&this.findElevationBoundsForLayer(g,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(b.tilingScheme.pixelSize[0],e.MAX_TILE_TESSELATION)};b.prototype.dispose=function(){A(!this.renderData,"tile.renderData was not unloaded");this._parent&&A(-1===this._parent.children.indexOf(this),
"still linked");for(var a=0;a<e.LayerClass.COUNT;a++)for(var c=0,b=this.layerInfo[a];c<b.length;c++)b[c].dispose();this._surface=this._parent=null;this._memoryUsed=0};b.prototype.updateMemoryUsed=function(){for(var a=this._surface.tilingScheme.pixelSize,a=a[0]*a[1]*4,c=this._memoryUsed=0,b=this.layerInfo[e.LayerClass.MAP];c<b.length;c++){var d=b[c],d=d.data;d instanceof x?this._memoryUsed+=v.getGpuMemoryUsage(d):d instanceof HTMLImageElement?this._memoryUsed+=a:d instanceof w&&(this._memoryUsed+=
d.getGpuMemoryUsage()+d.getCpuMemoryUsage())}c=0;for(b=this.layerInfo[e.LayerClass.ELEVATION];c<b.length;c++)d=b[c],this._memoryUsed+=d.data?a:0;this.renderData&&(this._memoryUsed+=this.renderData.estimatedGeometryMemoryUsage,a=this.renderData.textureDescriptor)&&(this._memoryUsed+=v.getGpuMemoryUsage(a))};b.prototype.updateScreenDepth=function(a){d.vec3.copy(E,this.center);E[3]=1;m.vec4.transformMat4(E,E,a);this.screenDepth=E[2]/E[3]};b.prototype.shouldSplit=function(c,b){var f=this.lij[0];d.vec3.subtract(B,
this.center,b);var g=d.vec3.squaredLength(B),h=c[4];if(g<this.edgeLen2&&f<h)return e.TileUpdate.SPLIT;var l=c[1],g=2*Math.sqrt(g),k=this.edgeLen/(c[0]*g);return k<l?this.vlevel!==this.lij[0]?(this.vlevel=this.lij[0],e.TileUpdate.VSPLITMERGE):e.TileUpdate.NONE:f>=h?(c=f+Math.ceil(-a.log2(l/k)),c!==this.vlevel?(this.vlevel=c,e.TileUpdate.VSPLITMERGE):e.TileUpdate.NONE):6<f&&(d.vec3.scale(C,this.tileUp,d.vec3.dot(this.tileUp,B)),d.vec3.subtract(C,C,B),f=d.vec3.squaredLength(C),f>this.radius*this.radius&&
(d.vec3.scale(C,C,this.radius/Math.sqrt(f)),d.vec3.add(C,C,this.center),d.vec3.subtract(C,b,C),b=this._elevationBounds[1]-this._elevationBounds[0],Math.min(1,(Math.abs(d.vec3.dot(C,this.tileUp))+.5*b+this.curvatureHeight)/d.vec3.length(C))*(this.edgeLen/(c[2]*g))<.1/c[5]*c[3]))?e.TileUpdate.NONE:e.TileUpdate.SPLIT};b.prototype.getWGS84Extent=function(){var b=this.extentWGS84Rad;return c.fromValues(a.rad2deg(b[0]),a.rad2deg(b[1]),a.rad2deg(b[2]),a.rad2deg(b[3]))};b.prototype.load=function(a){for(var c=
null==this.renderData&&a.loadCachedElevationData(this),b=0;b<e.LayerClass.COUNT;b++)if(this.layerInfo[b])if(b===e.LayerClass.ELEVATION&&c)for(var d=0,f=this.layerInfo[b];d<f.length;d++)f[d].loadingAgent=t.DONE;else this._createOrUpdateAgents(0,b);a.loadTile(this)};b.prototype.unload=function(a){a.unloadTile(this,this.elevationDone);for(a=0;a<e.LayerClass.COUNT;a++)for(var c=0,b=this.layerInfo[a];c<b.length;c++){var d=b[c];d.loadingAgent&&d.loadingAgent!==t.DONE&&(z(d.loadingAgent),d.loadingAgent=
null);d.pendingUpdates=0}this._pendingUpdates&=~e.TileUpdate.GEOMETRY;this._pendingUpdates&=~e.TileUpdate.TEXTURE};b.prototype.updateClippingStatus=function(a){if(n.equals(a,this.clippingArea))return!1;var c=this.intersectsClippingArea,b=this._isWithinClippingArea;a?(this.intersectsClippingArea=this.intersectsExtent(a),this._isWithinClippingArea=this.isWithinExtent(a)):this._isWithinClippingArea=this.intersectsClippingArea=!0;this.clippingArea=a;this._dirty=!0;a=b&&this._isWithinClippingArea;c=!b&&
!c&&!this._isWithinClippingArea&&!this.intersectsClippingArea;!this.renderData||a||c||this.setPendingUpdate(e.TileUpdate.GEOMETRY);return!0};b.prototype.updateVisibility=function(){this._dirty=!0};b.prototype.getLayerInfo=function(a,c){return this.layerInfo[c][a]};b.prototype.hasLayerData=function(a,c){return(a=this.layerInfo[c][a])&&a.data&&!a.dataInvalidated};b.prototype.hasDataAvailable=function(a,c,b){return(c=this.layerInfo[b][c].tilemap)?"unavailable"!==c.getAvailability(a.lij[1],a.lij[2]):
!0};Object.defineProperty(b.prototype,"hasPendingUpdates",{get:function(){return 0!==this._pendingUpdates},enumerable:!0,configurable:!0});b.prototype.isSuspended=function(a){return this.hasPendingUpdate(e.TileUpdate.SPLIT)?!0:a===e.LayerClass.ELEVATION?!1:!this.visible};Object.defineProperty(b.prototype,"elevationDone",{get:function(){if(this.hasPendingUpdate(e.TileUpdate.GEOMETRY))return!1;for(var a=0,c=this.layerInfo[e.LayerClass.ELEVATION];a<c.length;a++){var b=c[a];if(b.loadingAgent!==t.DONE||
!b.upsampleFromTile)return!1}return!0},enumerable:!0,configurable:!0});b.prototype.hasPendingUpdate=function(a){return(this._pendingUpdates&a)===a};b.prototype.setPendingUpdate=function(a){this._pendingUpdates|=a;this._surface.setPendingUpdates()};b.prototype.resetPendingUpdate=function(a){return this.hasPendingUpdate(a)?(this._pendingUpdates&=~a,!0):!1};b.prototype.requestLayerData=function(a,c,b){e.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d requested by tile %s",this.lij.toString(),
c,a,b.tile.lij.toString());var d=this.layerInfo[c][a];if(-1<d.waitingAgents.indexOf(b))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),b.tile.lij.toString(),c,a),!0;d.waitingAgents.push(b);if(d.data&&!d.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),b.tile.lij.toString(),c,a),setTimeout(b.dataArrived.bind(b,this),0),!0;if(d.requestPromise)return!0;
var f=this._surface.requestTileData(this,a,c);if(!f||f.isFulfilled())return!1;a=function(){d.requestPromise===f&&(d.requestPromise=null)};d.requestPromise=f;f.then(a,a);return!0};b.prototype.descendants=function(a){a||(a=[]);for(var c=0;4>c;c++){var b=this.children[c];b&&(b.descendants(a),a.unshift(this.children[c]))}return a};Object.defineProperty(b.prototype,"isLeaf",{get:function(){return!this.children[0]&&!this.children[1]&&!this.children[2]&&!this.children[3]},enumerable:!0,configurable:!0});
b.prototype.hasLij=function(a){return this.lij[0]===a[0]&&this.lij[1]===a[1]&&this.lij[2]===a[2]};b.prototype.findByLij=function(a){if(this.hasLij(a))return this;for(var c=0;4>c;c++){var b=this.children[c];if(b&&(b=b.findByLij(a)))return b}return null};b.prototype.unrequestLayerData=function(a,c,b){e.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d canceled by tile %s",this.lij.toString(),c,a,b.tile.lij.toString());var d=this.layerInfo[c][a],f=d.waitingAgents;b=null!=n.removeUnordered(f,b);
A(b,"agent has not requested this piece of map data");1>f.length&&((f=d.requestPromise)&&!f.isFulfilled()&&(f.cancel(),d.requestPromise=null),e.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d request/loading canceled",this.lij.toString(),c,a),this.updateMemoryUsed())};b.prototype.dataArrived=function(a,c,b){a=this.layerInfo[c][a];a.data=b;a.dataInvalidated=!1;for(b=0;b<a.waitingAgents.length;b++)a.waitingAgents[b].dataArrived(this);a.waitingAgents.length=0;this.updateMemoryUsed()};b.prototype.dataMissing=
function(a,c,b){b.notInTilemap||console.error("Tile %s layer %d/%d error",this.lij.toString(),c,a);a=this.layerInfo[c][a];a.dataMissing=!0;for(c=0;c<a.waitingAgents.length;c++)a.waitingAgents[c].dataMissing(this);a.waitingAgents.length=0;this.updateMemoryUsed()};b.prototype.updateRenderData=function(a){switch(a){case e.LayerClass.MAP:return this.updateTexture();case e.LayerClass.ELEVATION:return this.updateGeometry()}};b.prototype.updateTexture=function(){this.renderData&&(this._pendingUpdates|=e.TileUpdate.TEXTURE,
this._surface.setPendingUpdates())};b.prototype.updateGeometry=function(){this.setPendingUpdate(e.TileUpdate.GEOMETRY);for(var a=0,c=this.layerInfo[e.LayerClass.ELEVATION];a<c.length;a++)c[a].pendingUpdates|=e.TileUpdate.GEOMETRY;this._surface.setPendingUpdates()};b.prototype.invalidateLayerData=function(a,c){this.layerInfo[c][a].invalidateSourceData();this.restartAgents(c)};b.prototype.computeElevationBounds=function(){f.vec2.set(this._elevationBounds,Number.MAX_VALUE,-Number.MAX_VALUE);for(var a=
!1,c=0,b=this.layerInfo[e.LayerClass.ELEVATION];c<b.length;c++){var d=b[c];d.elevationBounds&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],d.elevationBounds[0]),this._elevationBounds[1]=Math.max(this._elevationBounds[1],d.elevationBounds[1]),a=!0)}a||f.vec2.set(this._elevationBounds,0,0);this.updateRadiusAndCenter()};b.prototype.updateRadiusAndCenter=function(){d.vec3.scale(C,this.tileUp,.5*(this._elevationBounds[0]+this._elevationBounds[1]));d.vec3.add(this.center,this.centerAtSeaLevel,
C)};b.prototype.findElevationBoundsForLayer=function(a,c){var b=this.layerInfo[e.LayerClass.ELEVATION][a];if(!b.elevationBounds||b.elevationBounds[2]<c)if(c=this._surface.layerViewByIndex(a,e.LayerClass.ELEVATION),y.fallsWithinLayer(this,c.layer,!1)){c=!1;if(b.data){var g=b.data;f.vec2.copy(E,g.bounds);E[2]=this.lij[0];c=!0}else{for(var h=0,l=void 0,g=void 0,k=this._parent;k&&(!g||h<e.ELEVATION_DESIRED_RESOLUTION_LEVEL)&&!(h=this.vlevel-k.lij[0],l=g||l,g=k.layerInfo[e.LayerClass.ELEVATION][a].data,
!g&&l&&h>=e.ELEVATION_DESIRED_RESOLUTION_LEVEL);k=k._parent);if(g=g||l)g.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],E),Infinity!==E[0]&&(E[2]=g.level,c=!0)}c&&(b.elevationBounds?d.vec3.copy(b.elevationBounds,E):b.elevationBounds=[E[0],E[1],E[2]])}};b.prototype.modifyLayers=function(a,c,b){for(var d=this.layerInfo[b],f=0;f<d.length;f++){var g=d[f];g.loadingAgent&&g.loadingAgent!==t.DONE&&(z(g.loadingAgent),g.loadingAgent=null);g.waitingAgents.length=0}if(b===e.LayerClass.MAP)for(f=0;f<
d.length;++f)void 0===a[f]&&d[f].dispose();a=c.length;g=Array(a);for(f=0;f<a;f++){var h=c[f];g[f]=-1<h?d[h]:r.TilePerLayerInfo.makeEmptyLayerInfo(b,this._surface.upsampleInfoPool)}this.layerInfo[b]=g;this.updateMemoryUsed()};b.prototype.restartAgents=function(a){this.renderData&&(this._createOrUpdateAgents(0,a),this.updateRenderData(a))};b.prototype.updateAgents=function(a){if(this.renderData){for(var c=this.layerInfo[a],b=0;b<c.length;b++){var d=c[b];d.loadingAgent===t.DONE&&(d.loadingAgent=null)}this._createOrUpdateAgents(0,
a)}};b.prototype.updateAgentSuspension=function(){for(var a=0;a<e.LayerClass.COUNT;a++)for(var c=this.isSuspended(a),b=0,d=this.layerInfo[a];b<d.length;b++){var f=d[b];f.loadingAgent&&f.loadingAgent!==t.DONE&&(f.loadingAgent.setSuspension(c),f.loadingAgent===t.DONE&&this.updateRenderData(a))}};b.prototype.removeLayerAgent=function(a,c){a=this.layerInfo[c][a];a.loadingAgent&&a.loadingAgent!==t.DONE&&a.loadingAgent.dispose();a.loadingAgent=null};b.prototype.agentDone=function(a,c){var b=this.layerInfo[c][a];
b.loadingAgent=t.DONE;b.data||b.upsampleFromTile||this._createOrUpdateAgents(a+1,c)};b.prototype._createOrUpdateAgents=function(a,c){for(var b=this.isSuspended(c),d=this.layerInfo[c];a<d.length;++a){var f=d[a],h=!1,k=this._surface.layerViewByIndex(a,c);if(f.loadingAgent)f.loadingAgent!==t.DONE&&f.loadingAgent.setSuspension(b),f.loadingAgent!==t.DONE&&(h=f.loadingAgent.update());else if(y.fallsWithinLayer(this,k.layer,!1)){var h=f,m=a,p=c,n=b,r=p===e.LayerClass.ELEVATION?l.Pool.acquire():g.Pool.acquire();
r.init(this,m,p,n);h.loadingAgent=r;(h=f.loadingAgent.startLoading())?f.loadingAgent===t.DONE&&this.setPendingUpdate(e.TileUpdate.GEOMETRY):(z(f.loadingAgent),f.loadingAgent=t.DONE)}f.loadingAgent===t.DONE&&this.updateRenderData(c);if(h&&k.isOpaque)break}};b.prototype.isWithinExtent=function(a){var c=this.extent;return c[0]>=a[0]&&a[2]>=c[2]&&c[1]>=a[1]&&a[3]>=c[3]};b.prototype.intersectsExtent=function(a){var c=this.extent;return c[2]>=a[0]&&a[2]>=c[0]&&c[3]>=a[1]&&a[3]>=c[1]};return b}()})},"esri/views/3d/terrain/terrainUtils":function(){define("require exports ../../../layers/ElevationLayer ../../../layers/TileLayer ../../../layers/VectorTileLayer ../../../support/basemapDefinitions ./terrainUtilsPlanar ./terrainUtilsSpherical".split(" "),
function(q,b,n,f,k,d,h,m){function p(a){return a&&"esri.views.3d.layers.TileLayerView3D"===a.declaredClass}function c(a){return a&&"esri.views.3d.layers.VectorTileLayerView3D"===a.declaredClass}function a(a){return a&&"esri.views.3d.layers.WMTSLayerView3D"===a.declaredClass}function l(a){return a&&"esri.views.3d.layers.ElevationLayerView3D"===a.declaredClass}function g(){t={};for(var a in d)d[a].baseMapLayers.forEach(function(a){t[a.url]=19});t["//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"]=
20}function e(a,c,b,d){return u["local"===d||"planar"===d?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(a,c,b)}Object.defineProperty(b,"__esModule",{value:!0});var u={planar:h,spherical:m};b.weakAssert=function(a,c){a||console.warn("Terrain: "+c)};b.autoUpdateSkirtsVisibility=function(a,c,b){var d=u[a.manifold],e,f=d.isInsideExtent(a,c);f?e=a.getElevation(c):(e=a.getElevationBounds(),e=.5*(e[0]+e[1]));e=c[2]-e;b=.9*Math.abs(e)<b?0:0>e?-1:1;f||(d.isInsideExtent(a,c,a.hideSkirtsDistanceFromExtentMargin)?
(c=d.tiltToExtentEdge(a,c),c>a.hideSkirtsMinimumCameraTilt&&c<a.hideSkirtsMaximumCameraTilt&&(b=0)):b=0);a.skirtScale=b};b.isTiledLayer=function(a){return a&&"base-tile"===a.type||"tile"===a.type||"elevation"===a.type||"base-elevation"===a.type||"open-street-map"===a.type||"web-tile"===a.type||"wmts"===a.type||"vector-tile"===a.type};b.isVectorTileLayer=function(a){return a&&a.isInstanceOf(k)};b.isTileLayerView=p;b.isVectorTileLayerView=c;b.isWMTSLayerView=a;b.isElevationLayerView=l;b.isTiledLayerView=
function(b){return b&&(p(b)||l(b)||c(b)||a(b))};b.useFetchTileForLayer=function(a){return a.fetchTile&&!(a.fetchTile===f.prototype.fetchTile||a.fetchTile===n.prototype.fetchTile)};var t=null;b.getKnownTiledServiceLevelCap=function(a){t||g();a=a&&a.replace(/https?:/,"");return a in t?t[a]:Infinity};b.prepareKnownTiledServiceLevelCaps=g;b.checkIfTileInfoSupportedForView=e;b.getTiledLayerInfo=function(a,c,b){var d,f;if("wmts"===a.type){if(a=a.activeLayer){var g=a.tileMatrixSet;if(g)d=g.tileInfo,f=g.fullExtent;
else if(a=a.tileMatrixSets)if(a=a.find(function(a){return null==e(a.tileInfo,a.fullExtent,c,b)}))return{tileInfo:a.tileInfo,fullExtent:a.fullExtent}}}else d="vector-tile"===a.type?a.compatibleTileInfo256:a.tileInfo,f=a.fullExtent;return d&&f&&null==e(d,f,c,b)?{tileInfo:d,fullExtent:f}:{tileInfo:null,fullExtent:null}}})},"esri/layers/ElevationLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/io-query dojo/_base/kernel ../request ../core/Error ../core/promiseUtils ../core/accessorSupport/decorators ../geometry/HeightModelInfo ./Layer ./mixins/ArcGISCachedService ./mixins/OperationalLayer ./mixins/PortalLayer ./support/commonProperties ./support/LercWorker".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y){return function(b){function e(a){a=b.call(this)||this;a.copyright=null;a.heightModelInfo=null;a.path=null;a.opacity=1;a.operationalLayerType="ArcGISTiledElevationServiceLayer";a.type="elevation";a.url=null;a.version=null;a._lercWorker=y.acquireInstance();return a}f(e,b);e.prototype.normalizeCtorArgs=function(a,c){return"string"===typeof a?n({url:a},c):a};e.prototype.destroy=function(){y.releaseInstance(this._lercWorker);this._lercWorker=null};Object.defineProperty(e.prototype,
"minScale",{get:function(){},set:function(a){this.constructed&&h.deprecated(this.declaredClass+".minScale support has been removed.","","4.5")},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"maxScale",{get:function(){},set:function(a){this.constructed&&h.deprecated(this.declaredClass+".maxScale support has been removed.","","4.5")},enumerable:!0,configurable:!0});e.prototype.readVersion=function(a,c){(a=c.currentVersion)||(a=9.3);return a};e.prototype.load=function(){var a=this;
this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:function(a){for(var c=0;c<a.typeKeywords.length;c++)if("elevation 3d layer"===a.typeKeywords[c].toLowerCase())return!0;throw new p("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"});}}).then(function(){return a._fetchImageService()},function(){return a._fetchImageService()}));
return this.when()};e.prototype.fetchTile=function(a,c,b,d){var e=this;void 0===d&&(d=0);return this.load().then(function(){return e._fetchTileAvailability(a,c,b)}).then(function(){return m(e.getTileUrl(a,c,b),{responseType:"array-buffer"})}).then(function(a){return e._lercWorker.decode(a.data,{noDataValue:d,returnFileInfo:!0})}).then(function(a){return{values:a.pixelData,width:a.width,height:a.height,maxZError:a.fileInfo.maxZError,noDataValue:a.noDataValue,minValue:a.minValue,maxValue:a.maxValue}})};
e.prototype.getTileUrl=function(a,c,b){var e=d.objectToQuery(n({},this.parsedUrl.query,{blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null}));return this.parsedUrl.path+"/tile/"+a+"/"+c+"/"+b+(e?"?"+e:"")};e.prototype.queryElevation=function(a,c){var b=this;return this._importElevationQuery().then(function(d){return(new d.ElevationQuery).query(b,a,c)})};e.prototype.createElevationSampler=function(a,c){var b=this;return this._importElevationQuery().then(function(d){return(new d.ElevationQuery).createSampler(b,
a,c)})};e.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return c.reject(new p("elevation-layer:view-not-supported","ElevationLayer is only supported in 3D"));case "3d":return c.create(function(a){return q(["../views/3d/layers/ElevationLayerView3D"],a)})}};e.prototype._fetchTileAvailability=function(a,b,d){return this.tilemapCache?this.tilemapCache.fetchAvailability(a,b,d):c.resolve("unknown")};e.prototype._fetchImageService=function(){var a=this;return c.resolve().then(function(){if(a.resourceInfo)return a.resourceInfo;
var c={query:n({f:"json"},a.parsedUrl.query),responseType:"json"};return m(a.parsedUrl.path,c)}).then(function(c){c.ssl&&(a.url=a.url.replace(/^http:/i,"https:"));a.read(c.data,{origin:"service",url:a.parsedUrl})})};e.prototype._importElevationQuery=function(){return c.create(function(a){q(["./support/ElevationQuery"],a)})};k([a.property({json:{read:{source:"copyrightText"}}})],e.prototype,"copyright",void 0);k([a.property({readOnly:!0,type:l})],e.prototype,"heightModelInfo",void 0);k([a.property({type:String,
json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],e.prototype,"path",void 0);k([a.property({type:["show","hide"]})],e.prototype,"listMode",void 0);k([a.property({json:{read:!1,write:!1}})],e.prototype,"minScale",null);k([a.property({json:{read:!1,write:!1}})],e.prototype,"maxScale",null);k([a.property({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],e.prototype,"opacity",void 0);k([a.property({type:["ArcGISTiledElevationServiceLayer"]})],e.prototype,"operationalLayerType",
void 0);k([a.property()],e.prototype,"resourceInfo",void 0);k([a.property({json:{read:!1},value:"elevation",readOnly:!0})],e.prototype,"type",void 0);k([a.property(r.url)],e.prototype,"url",void 0);k([a.property()],e.prototype,"version",void 0);k([a.reader("version",["currentVersion"])],e.prototype,"readVersion",null);return e=k([a.subclass("esri.layers.ElevationLayer")],e)}(a.declared(g,e,u,t))})},"esri/layers/VectorTileLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../request ../core/Error ../core/global ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ./Layer ./mixins/ArcGISCachedService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/SpriteSource ./support/TileInfo ./support/TilemapCache ./support/vectorTileLayerLoader ../portal/support/jsonContext ../views/vectorTiles/SchemaHelper ../views/vectorTiles/style/StyleRepository".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C,E,F){return function(b){function p(a,c){a=b.call(this)||this;a._spriteSourceMap=new Map;a.currentStyleInfo=null;a.style=null;a.operationalLayerType="VectorTileLayer";a.type="vector-tile";a.url=null;return a}f(p,b);p.prototype.normalizeCtorArgs=function(a,c){return"string"===typeof a?n({url:a},c):a};p.prototype.load=function(){var a=this,c=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1}).then(function(){if(a.portalItem&&
a.portalItem.id){var c=a.portalItem.itemUrl+"/resources/styles/root.json";return d(c,{query:{f:"json"}}).then(function(b){b.data&&a.read({url:c},C.createForItem(a.portalItem))})}}).then(function(){return a.loadStyle()},function(){return a.loadStyle()});this.addResolvingPromise(c);return this.when()};Object.defineProperty(p.prototype,"attributionDataUrl",{get:function(){var a=this.currentStyleInfo;return(a=a&&a.serviceUrl&&l.urlToObject(a.serviceUrl))?this._getDefaultAttribution(a.path):null},enumerable:!0,
configurable:!0});Object.defineProperty(p.prototype,"capabilities",{get:function(){var a=this._getPrimarySource();return a?a.capabilities:{operations:{supportsExportTiles:!1,supportsTileMap:!1},exportTiles:null}},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fullExtent",{get:function(){var a=this._getPrimarySource();return a?a.fullExtent:null},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"parsedUrl",{get:function(){return this.serviceUrl?a.urlToObject(this.serviceUrl):
null},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"serviceUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.serviceUrl||null},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"spatialReference",{get:function(){return this.tileInfo&&this.tileInfo.spatialReference||null},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"styleUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.styleUrl||null},enumerable:!0,
configurable:!0});p.prototype.writeStyleUrl=function(a,c){a&&l.isProtocolRelative(a)&&(a="https:"+a);c.styleUrl=a};Object.defineProperty(p.prototype,"tileIndexType",{get:function(){var a=this._getPrimarySource();return a?a.type:""},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"tileIndexUrl",{get:function(){var a=this._getPrimarySource();return a?a.tileMapURL:""},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"tileInfo",{get:function(){var a=this._getPrimarySource();
return a?a.tileInfo:null},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"tilemapCache",{get:function(){var a=this._getPrimarySource();return a?a.capabilities.operations.supportsTileMap?a.tilemapCache:null:null},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"tileServers",{get:function(){var a=this._getPrimarySource();return a?a.tileServers:[]},enumerable:!0,configurable:!0});p.prototype.readVersion=function(a,c){return c.version?parseFloat(c.version):parseFloat(c.currentVersion)};
p.prototype.readCompatibleTileInfo256=function(a,c){return z.fromJSON(E.create256x256CompatibleTileInfo(c.tileInfo))};p.prototype.readCompatibleTileInfo512=function(a,c){return z.fromJSON(E.create512x512CompatibleTileInfo(c.tileInfo))};p.prototype.loadSpriteSource=function(a){void 0===a&&(a=1);if(!this._spriteSourceMap.has(a)){var b=new v.default(this.styleRepository.sprite,a);this._spriteSourceMap.set(a,b.load())}var d=this._spriteSourceMap.get(a);return c.create(function(a,c){d.then(a,c)})};p.prototype.loadStyle=
function(a){var c=this;a=a||this.style||this.url;if(this._loadingPromise&&"string"===typeof a&&this.url===a)return this._loadingPromise;var b=this._loadingPromise;this._loadingPromise=this._getSourceAndStyle(a).then(function(){c.loadSpriteSource(m.devicePixelRatio||1)});b&&!b.isFulfilled()&&b.cancel();return this._loadingPromise};p.prototype.getStyleLayerId=function(a){return this.styleRepository.getStyleLayerId(a)};p.prototype.getPaintProperties=function(a){return this.styleRepository.getPaintProperties(a)};
p.prototype.setPaintProperties=function(a,c){a=this.styleRepository.setPaintProperties(a,c);this.emit("paint-change",{layer:a,paint:c})};p.prototype.getLayoutProperties=function(a){return this.styleRepository.getLayoutProperties(a)};p.prototype.setLayoutProperties=function(a,c){a=this.styleRepository.setLayoutProperties(a,c);this.emit("layout-change",{layer:a,layout:c})};p.prototype.getTileUrl=function(a,c,b){var d=this.tileServers[c%this.tileServers.length];return d=d.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,
c.toString()).replace(/\{x\}/gi,b.toString())};p.prototype.write=function(a,c){return c&&c.origin&&!this.styleUrl?(c.messages&&c.messages.push(new h("vectortilelayer:unsupported","VectorTileLayer ("+this.title+", "+this.id+") with style defined by JSON only are not supported",{layer:this})),null):this.inherited(arguments,[a,c])};p.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return c.create(function(a){return q(["../views/2d/layers/VectorTileLayerView2D"],a)});case "3d":return c.create(function(a){return q(["../views/3d/layers/VectorTileLayerView3D"],
a)})}};p.prototype._getSourceAndStyle=function(a){var b=this;return a?B.loadMetadata(a).then(function(c){b._set("currentStyleInfo",{serviceUrl:c.serviceUrl,styleUrl:c.styleUrl,spriteUrl:c.spriteUrl,glyphsUrl:c.glyphsUrl,style:c.style,layerDefinition:c.layerDefinition});"string"===typeof a?(b.url=a,b.style=null):(b.url=null,b.style=a);b._set("sourceNameToSource",c.sourceNameToSource);b._set("primarySourceName",c.primarySourceName);b._set("styleRepository",new F(c.style,c));b.read(c.layerDefinition,
{origin:"service"})}):c.reject(Error("invalid style!"))};p.prototype._getDefaultAttribution=function(a){var c=a.match(/^https?:\/\/(basemaps|basemapsbeta|basemapsdev)\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);if(c&&(a=c[3]&&c[3].toLowerCase()))for(var c=c[2]||"",b=0,d="OpenStreetMap_v2 OpenStreetMap_Export_v2 OpenStreetMap_FTS_v2 OpenStreetMap_GCS_v2 World_Basemap World_Basemap_v2 World_Basemap_Export_v2 World_Basemap_GCS_v2 World_Basemap_WGS84".split(" ");b<
d.length;b++){var e=d[b];if(-1<e.toLowerCase().indexOf(a))return l.normalize("//static.arcgis.com/attribution/Vector"+c+"/"+e)}};p.prototype._getPrimarySource=function(){return this.sourceNameToSource&&this.primarySourceName in this.sourceNameToSource?this.sourceNameToSource[this.primarySourceName]:null};k([g.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],p.prototype,"attributionDataUrl",null);k([g.property({type:["show","hide"]})],p.prototype,"listMode",void 0);k([g.property({json:{read:!1},
readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],p.prototype,"capabilities",null);k([g.property({readOnly:!0})],p.prototype,"currentStyleInfo",void 0);k([g.property({json:{read:!1},readOnly:!0,type:e,dependsOn:["sourceNameToSource","primarySourceName"]})],p.prototype,"fullExtent",null);k([g.property()],p.prototype,"style",void 0);k([g.property({type:["VectorTileLayer"]})],p.prototype,"operationalLayerType",void 0);k([g.property({readOnly:!0,dependsOn:["serviceUrl"]})],p.prototype,
"parsedUrl",null);k([g.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],p.prototype,"serviceUrl",null);k([g.property({type:u,dependsOn:["tileInfo"],readOnly:!0})],p.prototype,"spatialReference",null);k([g.property({readOnly:!0})],p.prototype,"styleRepository",void 0);k([g.property({readOnly:!0})],p.prototype,"sourceNameToSource",void 0);k([g.property({readOnly:!0})],p.prototype,"primarySourceName",void 0);k([g.property({type:String,readOnly:!0,dependsOn:["currentStyleInfo"],json:{write:{ignoreOrigin:!0},
origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],p.prototype,"styleUrl",null);k([g.writer(["portal-item","web-document"],"styleUrl")],p.prototype,"writeStyleUrl",null);k([g.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],p.prototype,"tileIndexType",null);k([g.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],p.prototype,"tileIndexUrl",null);k([g.property({json:{read:!1},readOnly:!0,type:z,dependsOn:["sourceNameToSource",
"primarySourceName"]})],p.prototype,"tileInfo",null);k([g.property({json:{read:!1},readOnly:!0,type:A,dependsOn:["sourceNameToSource","primarySourceName"]})],p.prototype,"tilemapCache",null);k([g.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],p.prototype,"tileServers",null);k([g.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],p.prototype,"type",void 0);k([g.property({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},
write:!1,read:!1}})],p.prototype,"url",void 0);k([g.property({readOnly:!0})],p.prototype,"version",void 0);k([g.reader("version",["version","currentVersion"])],p.prototype,"readVersion",null);k([g.property({readOnly:!0})],p.prototype,"compatibleTileInfo256",void 0);k([g.reader("compatibleTileInfo256",["tileInfo"])],p.prototype,"readCompatibleTileInfo256",null);k([g.property({readOnly:!0})],p.prototype,"compatibleTileInfo512",void 0);k([g.reader("compatibleTileInfo512",["tileInfo"])],p.prototype,"readCompatibleTileInfo512",
null);return p=k([g.subclass("esri.layers.VectorTileLayer")],p)}(g.declared(t,y,w,x,p,r))})},"esri/layers/support/SpriteSource":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ../../request ../../core/promiseUtils".split(" "),function(q,b,n,f,k,d){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,d){this.baseURL=b;this.devicePixelRatio=d;this._isRetina=!1;this._spritesData={};this.height=this.width=this.image=null;
this.loadStatus="not-loaded"}Object.defineProperty(b.prototype,"spriteNames",{get:function(){var b=[],d;for(d in this._spritesData)b.push(d);b.sort();return b},enumerable:!0,configurable:!0});b.prototype.getSpriteInfo=function(b){return this._spritesData[b]};b.prototype.load=function(){var b=this;this.loadStatus="loading";return this.baseURL?this._loadSprites().then(function(){b.loadStatus="loaded";return b}).catch(function(d){b.loadStatus="failed";return b}):d.resolve(this)};b.prototype._loadSprites=
function(){var b=this;this._isRetina=1.15<this.devicePixelRatio?!0:!1;var f=this.baseURL,c=this._isRetina?"@2x":"",a=""+f+c+".png";return d.all([k(f+c+".json",{responseType:"json"}),k(a,{responseType:"image"})]).then(function(a){var c=a[0];a=a[1];var e=Object.keys(c.data);if(!e||0===e.length||1===e.length&&"_ssl"===e[0]||!a||!a.data)return b._spritesData=b.image=null,b.width=b.height=0,d.resolve(null);b._spritesData=c.data;c=a.data;b.width=c.width;b.height=c.height;a=document.createElement("canvas");
e=a.getContext("2d");a.width=c.width;a.height=c.height;e.drawImage(c,0,0,c.width,c.height);c=e.getImageData(0,0,c.width,c.height);c=new Uint8Array(c.data);for(e=0;e<c.length;e+=4)a=c[e+3]/255,c[e]*=a,c[e+1]*=a,c[e+2]*=a;b.image=c})};return b}();b.default=q})},"esri/layers/support/vectorTileLayerLoader":function(){define("require exports ../../core/tsSupport/assignHelper ../../config ../../request ../../core/promiseUtils ../../core/urlUtils ../../views/vectorTiles/style/VectorTileSource".split(" "),
function(q,b,n,f,k,d,h,m){function p(a){a&&(a=h.getOrigin(a),e&&-1===e.indexOf(a)&&e.push(a))}function c(){for(var a=[],c=0;c<arguments.length;c++)a[c]=arguments[c];for(var c=void 0,b=0;b<a.length;++b)h.isProtocolRelative(a[b])?c&&(c=c.split("://")[0]+":"+a[b].trim()):c=h.isAbsolute(a[b])?a[b]:h.join(c,a[b]);return c}function a(a,c,b,e){var f,m,n;"string"===typeof b?(b=h.normalize(b),p(b),f=h.urlToObject(b),f=k(f.path,{query:{f:"json"},responseType:"json"}),n=m=b):(f=d.resolve({data:b}),m=b.jsonUrl||
null,n=e);return f.then(function(b){var e=b.data;b.ssl&&(m&&(m=m.replace(/^http:/i,"https:")),n&&(n=n.replace(/^http:/i,"https:")));return e.sources?(a.styleUrl=m||null,l(a,e,n)):e.sources?d.reject("You must specify the URL or the JSON for a service or for a style."):a.sourceUrl?g(a,e,n,!1,c):(a.sourceUrl=m||null,g(a,e,n,!0,c))})}function l(b,e,f){var g=f?h.removeFile(f):h.appBaseUrl;b.styleBase=g;b.style=e;b.styleUrl&&p(b.styleUrl);if(!b.source){var l=[];f=null;if(e.sources.esri){var k=e.sources.esri;
k.url?f=a(b,"esri",c(g,k.url)):l.push(a(b,"esri",k,g))}null===f&&(f=d.resolve());return f.then(function(){for(var f=0,h=Object.keys(e.sources);f<h.length;f++){var k=h[f];"esri"!==k&&"vector"===e.sources[k].type&&(e.sources[k].url?l.push(a(b,k,c(g,e.sources[k].url))):l.push(a(b,k,e.sources[k],g)))}return d.eachAlways(l).then(function(){})})}return d.resolve()}function g(b,e,f,g,l){f=f?h.removeTrailingSlash(f)+"/":h.appBaseUrl;var k;if(e.hasOwnProperty("tileInfo"))k=e;else{k={xmin:-2.0037507067161843E7,
ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,spatialReference:{wkid:102100}};for(var n=(k.xmax-k.xmin)/512,r=[],q=e.hasOwnProperty("minzoom")?parseFloat(e.minzoom):0,t=e.hasOwnProperty("maxzoom")?parseFloat(e.maxzoom):16;q<t;q++){var u=n/Math.pow(2,q);r.push({level:q,scale:Math.floor(3779.527559055118*u),resolution:u})}n=0;for(t=e.tiles;n<t.length;n++)p(c(f,t[n]));k={capabilities:"TilesOnly",initialExtent:k,fullExtent:k,minScale:r[0].scale,maxScale:r[r.length-1].scale,
tiles:e.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:r,spatialReference:{wkid:102100}}}}r=new m(l,f,k);if(!g&&b.primarySourceName in b.sourceNameToSource){n=b.sourceNameToSource[b.primarySourceName];if(!n.isCompatibleWith(r))return d.resolve();n.fullExtent.union(r.fullExtent);n.tileInfo.lods.length<r.tileInfo.lods.length&&(n.tileInfo=r.tileInfo)}g?(b.sourceBase=f,b.source=e,b.validatedSource=k,b.primarySourceName=l,b.sourceUrl&&p(b.sourceUrl)):
p(f);b.sourceNameToSource[l]=r;return b.style?d.resolve():null==e.defaultStyles?d.reject():"string"===typeof e.defaultStyles?a(b,"",c(f,e.defaultStyles,"root.json")):a(b,"",e.defaultStyles,c(f,"root.json"))}Object.defineProperty(b,"__esModule",{value:!0});var e=f.defaults&&f.defaults.io.corsEnabledServers;b.loadMetadata=function(b){var d={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,sourceNameToSource:{},primarySourceName:""},e="string"===
typeof b?[b,null]:[null,b.jsonUrl],f=e[0],e=e[1],g=f?h.urlToObject(f):null;return a(d,"esri",b,e).then(function(){var a={layerDefinition:d.validatedSource,url:f,parsedUrl:g,serviceUrl:d.sourceUrl,style:d.style,styleUrl:d.styleUrl,spriteUrl:d.style.sprite&&c(d.styleBase,d.style.sprite),glyphsUrl:d.style.glyphs&&c(d.styleBase,d.style.glyphs),sourceNameToSource:d.sourceNameToSource,primarySourceName:d.primarySourceName};p(a.spriteUrl);p(a.glyphsUrl);return a})}})},"esri/views/vectorTiles/style/VectorTileSource":function(){define("require exports ../../../core/lang ../../../core/promiseUtils ../../../core/urlUtils ../../../geometry/Extent ../../../layers/support/TileInfo ../../../layers/support/TilemapCache ../TileIndex".split(" "),
function(q,b,n,f,k,d,h,m,p){return function(){function c(a,c,b){this.tileMapURL="";this.fullExtent=this.tileIndex=this.capabilities=this.tileInfo=this.parsedUrl=this.tilemapCache=null;this.name=a;if(this.sourceUrl=c)this.parsedUrl=k.urlToObject(this.sourceUrl);a=n.clone(b);var e=a.tiles;c&&e.forEach(function(a,b){k.isAbsolute(a)||(e[b]=k.join(c,a))});this.tileServers=e;b.tileMap&&(this.tileMapURL=k.join(c,b.tileMap));var f=b.capabilities&&b.capabilities.split(",").map(function(a){return a.toLowerCase().trim()}),
g=!!b.exportTilesAllowed,f=!!f&&-1!==f.indexOf("tilemap"),h=g&&b.hasOwnProperty("maxExportTilesCount")?b.maxExportTilesCount:0;this.capabilities={operations:{supportsExportTiles:g,supportsTileMap:f},exportTiles:g?{maxExportTilesCount:+h}:null};this.tileInfo=this.readTileInfo(a.tileInfo,a);f&&(this.type="vector-tile",this.tilemapCache=new m({layer:this}),this.tileIndex=new p(this.tilemapCache));this.fullExtent=d.fromJSON(b.fullExtent)}c.prototype.getRefKey=function(a){return this.tileIndex?this.tileIndex.dataKey(a):
f.resolve(a)};c.prototype.getSourceTileUrl=function(a,c,b){var d=this.tileServers[c%this.tileServers.length];return d=d.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,c.toString()).replace(/\{x\}/gi,b.toString())};c.prototype.isCompatibleWith=function(a){var c=this.tileInfo;a=a.tileInfo;if(!c.spatialReference.equals(a.spatialReference)||!c.origin.equals(a.origin)||Math.round(c.dpi)!==Math.round(a.dpi))return!1;c=c.lods;a=a.lods;for(var b=Math.min(c.length,a.length),d=0;d<b;d++){var f=c[d],h=a[d];
if(f.level!==h.level||Math.round(f.scale)!==Math.round(h.scale))return!1}return!0};c.prototype.readTileInfo=function(a,c){var b=c.minScale?Math.round(1E4*c.minScale)/1E4:Infinity,d=c.maxScale?Math.round(1E4*c.maxScale)/1E4:-Infinity;return a?(a.lods=a.lods.filter(function(a){a=Math.round(1E4*a.scale)/1E4;return a<=b&&a>=d}),h.fromJSON(a)):null};return c}()})},"esri/views/vectorTiles/TileIndex":function(){define(["require","exports","../../core/promiseUtils","../../layers/support/TilemapCache","../2d/tiling/TileKey"],
function(q,b,n,f,k){return function(){function b(b){if(b instanceof f)this._tilemapCache=b;else if(b&&"index"in b)this._tilemap=b.index;else throw Error("Invalid tilemap!");}b.prototype.dataKey=function(b){if(this._tilemapCache){var d=b.level,f=b.row,c=b.col,a=new k(b);return this._tilemapCache.fetchAvailabilityUpsample(d,f,c,a).then(function(){return a}).catch(function(b){if(b&&"cancel"===b.dojoType)throw b;a.level=d;a.row=f;a.col=c;return a})}return this._getIndexedDataKey(b)};b.prototype.forEach=
function(b,d,f,c,a){this._callback=a;this._maxLevel=d+b;this._forEach(this._tilemap,d,f,c)};b.prototype._forEach=function(b,d,f,c){0!==b&&(this._callback(d,f,c),d!==this._maxLevel&&"object"===typeof b&&(this._forEach(b[0],d+1,2*f,2*c),this._forEach(b[1],d+1,2*f,2*c+1),this._forEach(b[2],d+1,2*f+1,2*c),this._forEach(b[3],d+1,2*f+1,2*c+1)))};b.prototype._getIndexedDataKey=function(b){var d=[b];if(0>b.level||0>b.row||0>b.col||0<b.row>>b.level||0<b.col>>b.level)return n.resolve(null);for(;0!==b.level;)b=
new k(b.level-1,b.row>>1,b.col>>1,b.world),d.push(b);b=this._tilemap;var f=d.pop(),c,a;if(1===b)return n.resolve(f);for(;d.length;)if(c=d.pop(),a=(c.col&1)+((c.row&1)<<1),b){if(0===b[a]){f=null;break}if(1===b[a]){f=c;break}f=c;b=b[a]}return n.resolve(f)};return b}()})},"esri/views/2d/tiling/TileKey":function(){define(["require","exports","../../../core/ObjectPool"],function(q,b,n){return function(){function b(b,d,f,m){this.set(b,d,f,m)}b.from=function(f,d,h,m){return b.pool.acquire(f,d,h,m)};b.getId=
function(b,d,f,m){return"object"===typeof b?b.level+"/"+b.row+"/"+b.col+"/"+b.world:b+"/"+d+"/"+f+"/"+m};Object.defineProperty(b.prototype,"key",{get:function(){return this},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"id",{get:function(){return this.toString()},enumerable:!0,configurable:!0});b.prototype.equals=function(b){return this.level===b.level&&this.row===b.row&&this.col===b.col&&this.world===b.world};b.prototype.release=function(){this.world=this.col=this.row=this.level=
0};b.prototype.set=function(b,d,f,m){null==b?this.world=this.col=this.row=this.level=0:"object"===typeof b?(this.level=b.level||0,this.row=b.row||0,this.col=b.col||0,this.world=b.world||0):"string"===typeof b?(b=b.split("/"),d=b[1],f=b[2],m=b[3],this.level=parseFloat(b[0]),this.row=parseFloat(d),this.col=parseFloat(f),this.world=parseFloat(m)):(this.level=+b,this.row=+d,this.col=+f,this.world=+m||0);return this};b.prototype.toString=function(){return this.level+"/"+this.row+"/"+this.col+"/"+this.world};
b.prototype.getChildKeys=function(){var f=this.level+1,d=this.row<<1,h=this.col<<1,m=this.world;return[b.pool.acquire(f,d,h,m),b.pool.acquire(f,d,h+1,m),b.pool.acquire(f,d+1,h,m),b.pool.acquire(f,d+1,h+1,m)]};b.prototype.compareRowMajor=function(b){return this.row<b.row?-1:this.row>b.row?1:this.col<b.col?-1:this.col>b.col?1:0};b.sort=function(f){return f.map(function(d){return b.from(d)}).sort(function(b,f){return b.compareRowMajor(f)}).map(function(b){return b.id})};b.pool=new n(b,!0,null,25,50);
return b}()})},"esri/portal/support/jsonContext":function(){define(["require","exports","../../core/urlUtils","../Portal"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});b.createForItem=function(b){return{origin:"portal-item",url:n.urlToObject(b.itemUrl),portal:b.portal||f.getDefault()}}})},"esri/views/vectorTiles/SchemaHelper":function(){define(["require","exports"],function(q,b){return function(){function b(b,k){this.lockedSchemaPixelSize=b;this.isWGS84=k}b.prototype.getLevelRowColumn=
function(b){return this.isWGS84?[b[0],b[1]>>1,b[2]>>1]:256===this.lockedSchemaPixelSize&&0<b[0]?[b[0]-1,b[1]>>1,b[2]>>1]:b};b.prototype.adjustLevel=function(b){return this.isWGS84?b:256===this.lockedSchemaPixelSize?0<b?b-1:0:b};b.prototype.getShift=function(b,k){var d=0,f=0;if(256===this.lockedSchemaPixelSize||this.isWGS84)b[2]%2&&(d=2*k),b[1]%2&&(f=2*k);return[d,f]};b.prototype.getScale=function(b){if(this.isWGS84){if(512===this.lockedSchemaPixelSize)return 2}else if(256===this.lockedSchemaPixelSize&&
0===b)return.5;return 1};b.create256x256CompatibleTileInfo=function(b){if(!b)return null;if(256===b.rows&&256===b.cols)return b;for(var f=4326===b.spatialReference.wkid,d=[],h=b.lods.length,m=0;m<h;m++){var p=b.lods[m];d.push({level:p.level,scale:p.scale,resolution:f?p.resolution:2*p.resolution})}return{rows:256,cols:256,dpi:b.dpi,format:b.format,compressionQuality:b.compressionQuality,origin:b.origin,spatialReference:b.spatialReference,lods:d}};b.create512x512CompatibleTileInfo=function(b){if(!b||
256===b.rows||256===b.cols)return null;for(var f=[],d=b.lods.length,h=0;h<d;h++){var m=b.lods[h];f.push({level:m.level,scale:m.scale,resolution:.5*m.resolution})}return{rows:512,cols:512,dpi:b.dpi,format:b.format,compressionQuality:b.compressionQuality,origin:b.origin,spatialReference:b.spatialReference,lods:f}};return b}()})},"esri/views/vectorTiles/style/StyleRepository":function(){define(["require","exports","../../../core/has","./StyleLayer"],function(q,b,n,f){return function(){function b(d,f){this._layerByName=
{};this.styleJSON=d;this.version=parseFloat(d.version);this.sprite=f?f.spriteUrl:d.sprite;this.glyphs=f?f.glyphsUrl:d.glyphs;if(n("stable-symbol-rendering")){var h=(d.layers||[]).filter(function(b){return b.layout&&b.layout["text-font"]})[0];h&&(d.layers||[]).forEach(function(b){b.layout&&b.layout["text-font"]&&(b.layout["text-font"]=h.layout["text-font"])})}if(this.layers=(d.layers||[]).map(b._create))for(d=void 0,f=0;f<this.layers.length;f++)d=this.layers[f],this._layerByName[d.id.toLowerCase()]=
d;this._identifyRefLayers()}b.prototype.getStyleLayerId=function(b){return b>=this.layers.length?null:this.layers[b].id};b.prototype.getLayoutProperties=function(b){return(b=this._layerByName[b.toLowerCase()])?b.layout:null};b.prototype.getPaintProperties=function(b){return(b=this._layerByName[b.toLowerCase()])?b.paint:null};b.prototype.setPaintProperties=function(d,f){d=this._layerByName[d.toLowerCase()];if(!d)return"";var h=this.layers.indexOf(d);this.styleJSON.layers[h].paint=f;f=b._recreateLayer({id:d.id,
type:d.typeName,source:d.source,sourceLayer:d["source-layer"],minzoom:d.minzoom,maxzoom:d.maxzoom,filter:d.filter,layout:d.layout,paint:f},d);this.layers[h]=f;this._layerByName[d.id.toLowerCase()]=f;return d.id};b.prototype.setLayoutProperties=function(d,f){d=this._layerByName[d.toLowerCase()];if(!d)return"";var h=this.layers.indexOf(d);this.styleJSON.layers[h].layout=f;f=b._recreateLayer({id:d.id,type:d.typeName,source:d.source,sourceLayer:d["source-layer"],minzoom:d.minzoom,maxzoom:d.maxzoom,filter:d.filter,
layout:f,paint:d.paint},d);this.layers[h]=f;this._layerByName[d.id.toLowerCase()]=f;return d.id};b.prototype._identifyRefLayers=function(){for(var b=[],f=[],k=0,p=0,c=this.layers;p<c.length;p++){var a=c[p];if(1===a.type){var l=a,g=a.sourceLayer,g=g+("|"+JSON.stringify(a.layout&&a.layout.visibility)),g=g+("|"+JSON.stringify(a.minzoom)),g=g+("|"+JSON.stringify(a.maxzoom)),g=g+("|"+JSON.stringify(a.filter));if(l.hasDataDrivenFill||l.hasDataDrivenOutline)g+="|"+JSON.stringify(k);b.push({key:g,layer:a})}2===
a.type&&(l=a,g=a.sourceLayer,g+="|"+JSON.stringify(a.layout&&a.layout.visibility),g+="|"+JSON.stringify(a.minzoom),g+="|"+JSON.stringify(a.maxzoom),g+="|"+JSON.stringify(a.filter),g+="|"+JSON.stringify(a.layout&&a.layout["line-cap"]),g+="|"+JSON.stringify(a.layout&&a.layout["line-join"]),l.hasDataDrivenLine&&(g+="|"+JSON.stringify(k)),f.push({key:g,layer:a}));++k}this._assignRefLayers(b);this._assignRefLayers(f)};b.prototype._assignRefLayers=function(b){b.sort(function(a,b){return a.key<b.key?-1:
a.key>b.key?1:0});for(var d,f,k=b.length,c=0;c<k;c++){var a=b[c];if(a.key===d)a.layer.refLayerId=f;else if(d=a.key,f=a.layer.id,1===a.layer.type&&!a.layer.getPaintProperty("fill-outline-color"))for(var l=c+1;l<k;l++){var g=b[l];if(g.key===d){if(g.layer.getPaintProperty("fill-outline-color")){b[c]=g;b[l]=a;f=g.layer.id;break}}else break}}};b._create=function(b,h,k){h=1-1/(k.length+1)*(1+h);switch(b.type){case "background":return new f.BackgroundStyleLayer(0,b,h);case "fill":return new f.FillStyleLayer(1,
b,h);case "line":return new f.LineStyleLayer(2,b,h);case "symbol":return new f.SymbolStyleLayer(3,b,h);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new f.CircleStyleLayer(4,b,h)}throw Error("Unknown vector tile layer");};b._recreateLayer=function(b,h){switch(b.type){case "background":return new f.BackgroundStyleLayer(0,b,h.z);case "fill":return new f.FillStyleLayer(1,b,h.z);case "line":return new f.LineStyleLayer(2,b,h.z);case "symbol":return new f.SymbolStyleLayer(3,
b,h.z);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new f.CircleStyleLayer(4,b,h.z)}};return b}()})},"esri/views/vectorTiles/style/StyleLayer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ./Filter ./StyleDefinition ./StyleProperty".split(" "),function(q,b,n,f,k,d,h){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,c,a){this.type=b;this.typeName=c.type;this.id=c.id;
this.source=c.source;this.sourceLayer=c["source-layer"];this.minzoom=c.minzoom;this.maxzoom=c.maxzoom;this.filter=c.filter;this.layout=c.layout;this.paint=c.paint;this.z=a;switch(b){case 0:this._layoutDefinition=d.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=d.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=d.StyleDefinition.fillLayoutDefinition;this._paintDefinition=d.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=d.StyleDefinition.lineLayoutDefinition;
this._paintDefinition=d.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=d.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=d.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=d.StyleDefinition.circleLayoutDefinition,this._paintDefinition=d.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}b.prototype.getFeatureFilter=function(){return void 0!==this._featureFilter?
this._featureFilter:this._featureFilter=k.createFilter(this.filter)};b.prototype.getLayoutProperty=function(b){var c=this._layoutProperties;if(c)return c[b]};b.prototype.getPaintProperty=function(b){var c=this._paintProperties;if(c)return c[b]};b.prototype.getLayoutValue=function(b,c,a){var d,f=this._layoutProperties;f&&(f=f[b])&&(d=f.getValue(c,a));b=this._layoutDefinition[b];void 0===d&&(d=b["default"]);"enum"===b.type&&(d=b.values.indexOf(d));return d};b.prototype.getPaintValue=function(b,c,a){var d,
f=this._paintProperties;f&&(f=f[b])&&(d=f.getValue(c,a));b=this._paintDefinition[b];void 0===d&&(d=b["default"]);"enum"===b.type&&(d=b.values.indexOf(d));return d};b.prototype._parseLayout=function(b){var c={},a;for(a in b){var d=this._layoutDefinition[a];d&&(c[a]=new h(a,d,b[a]))}return c};b.prototype._parsePaint=function(b){var c={},a;for(a in b){var d=this._paintDefinition[a];d&&(c[a]=new h(a,d,b[a]))}return c};return b}();b.StyleLayer=q;f=function(b){function d(c,a,d){return b.call(this,c,a,d)||
this}n(d,b);return d}(q);b.BackgroundStyleLayer=f;f=function(b){function d(c,a,d){c=b.call(this,c,a,d)||this;a=c.getPaintProperty("fill-color");c.hasDataDrivenColor=a?a.isDataDriven:!1;a=c.getPaintProperty("fill-opacity");c.hasDataDrivenOpacity=a?a.isDataDriven:!1;c.hasDataDrivenFill=c.hasDataDrivenColor||c.hasDataDrivenOpacity;a=c.getPaintProperty("fill-outline-color");c.outlineUsesFillColor=!a;c.hasDataDrivenOutlineColor=a?a.isDataDriven:!1;c.hasDataDrivenOutline=(a?c.hasDataDrivenOutlineColor:
c.hasDataDrivenColor)||c.hasDataDrivenOpacity;return c}n(d,b);return d}(q);b.FillStyleLayer=f;f=function(b){function d(c,a,d){c=b.call(this,c,a,d)||this;a=c.getPaintProperty("line-color");c.hasDataDrivenColor=a?a.isDataDriven:!1;a=c.getPaintProperty("line-opacity");c.hasDataDrivenOpacity=a?a.isDataDriven:!1;a=c.getPaintProperty("line-width");c.hasDataDrivenWidth=a?a.isDataDriven:!1;c.hasDataDrivenLine=c.hasDataDrivenColor||c.hasDataDrivenOpacity||c.hasDataDrivenWidth;return c}n(d,b);return d}(q);
b.LineStyleLayer=f;f=function(b){function d(c,a,d){c=b.call(this,c,a,d)||this;a=c.getPaintProperty("icon-color");c.hasDataDrivenIconColor=a?a.isDataDriven:!1;a=c.getPaintProperty("icon-opacity");c.hasDataDrivenIconOpacity=a?a.isDataDriven:!1;a=c.getLayoutProperty("icon-size");c.hasDataDrivenIconSize=a?a.isDataDriven:!1;c.hasDataDrivenIcon=c.hasDataDrivenIconColor||c.hasDataDrivenIconOpacity||c.hasDataDrivenIconSize;a=c.getPaintProperty("text-color");c.hasDataDrivenTextColor=a?a.isDataDriven:!1;a=
c.getPaintProperty("text-opacity");c.hasDataDrivenTextOpacity=a?a.isDataDriven:!1;a=c.getLayoutProperty("text-size");c.hasDataDrivenTextSize=a?a.isDataDriven:!1;c.hasDataDrivenText=c.hasDataDrivenTextColor||c.hasDataDrivenTextOpacity||c.hasDataDrivenTextSize;return c}n(d,b);return d}(q);b.SymbolStyleLayer=f;q=function(b){function d(c,a,d){c=b.call(this,c,a,d)||this;a=c.getPaintProperty("circle-radius");c.hasDataDrivenRadius=a?a.isDataDriven:!1;a=c.getPaintProperty("circle-color");c.hasDataDrivenColor=
a?a.isDataDriven:!1;a=c.getPaintProperty("circle-opacity");c.hasDataDrivenOpacity=a?a.isDataDriven:!1;a=c.getPaintProperty("circle-stroke-width");c.hasDataDrivenStrokeWidth=a?a.isDataDriven:!1;a=c.getPaintProperty("circle-stroke-color");c.hasDataDrivenStrokeColor=a?a.isDataDriven:!1;a=c.getPaintProperty("circle-stroke-opacity");c.hasDataDrivenStrokeOpacity=a?a.isDataDriven:!1;a=c.getPaintProperty("circle-blur");c.hasDataDrivenBlur=a?a.isDataDriven:!1;return c}n(d,b);return d}(q);b.CircleStyleLayer=
q;q=function(){return function(b,d,c){this.cap=b.getLayoutValue("line-cap",d,c);this.join=b.getLayoutValue("line-join",d,c);this.miterLimit=b.getLayoutValue("line-miter-limit",d,c);this.roundLimit=b.getLayoutValue("line-round-limit",d,c)}}();b.LineLayout=q;q=function(){return function(b,d,c,a){this.allowOverlap=b.getLayoutValue("icon-allow-overlap",d,a);this.ignorePlacement=b.getLayoutValue("icon-ignore-placement",d,a);this.optional=b.getLayoutValue("icon-optional",d,a);this.rotationAlignment=b.getLayoutValue("icon-rotation-alignment",
d,a);this.size=b.getLayoutValue("icon-size",d,a);this.rotate=b.getLayoutValue("icon-rotate",d,a);this.padding=b.getLayoutValue("icon-padding",d,a);this.keepUpright=b.getLayoutValue("icon-keep-upright",d,a);this.offset=b.getLayoutValue("icon-offset",d,a);2===this.rotationAlignment&&(this.rotationAlignment=c?0:1)}}();b.IconLayout=q;q=function(){return function(b,d,c,a){this.allowOverlap=b.getLayoutValue("text-allow-overlap",d,a);this.ignorePlacement=b.getLayoutValue("text-ignore-placement",d,a);this.optional=
b.getLayoutValue("text-optional",d,a);this.rotationAlignment=b.getLayoutValue("text-rotation-alignment",d,a);this.fontArray=b.getLayoutValue("text-font",d,a);this.maxWidth=b.getLayoutValue("text-max-width",d,a);this.lineHeight=b.getLayoutValue("text-line-height",d,a);this.letterSpacing=b.getLayoutValue("text-letter-spacing",d,a);this.justify=b.getLayoutValue("text-justify",d,a);this.anchor=b.getLayoutValue("text-anchor",d,a);this.maxAngle=b.getLayoutValue("text-max-angle",d,a);this.size=b.getLayoutValue("text-size",
d,a);this.rotate=b.getLayoutValue("text-rotate",d,a);this.padding=b.getLayoutValue("text-padding",d,a);this.keepUpright=b.getLayoutValue("text-keep-upright",d,a);this.transform=b.getLayoutValue("text-transform",d,a);this.offset=b.getLayoutValue("text-offset",d,a);2===this.rotationAlignment&&(this.rotationAlignment=c?0:1)}}();b.TextLayout=q})},"esri/views/vectorTiles/style/Filter":function(){define(["require","exports"],function(q,b){return function(){function b(f,k,d){this._op=f;"$type"===k?(this._val=
d instanceof Array?d.map(function(d){return b._types.indexOf(d)}):b._types.indexOf(d),this._op+=11):(this._key=k,this._val=d)}b.prototype.filter=function(b){switch(this._op){case 0:return this._val;case 1:return b.values[this._key]===this._val;case 2:return b.values[this._key]!==this._val;case 3:return b.values[this._key]<this._val;case 4:return b.values[this._key]>this._val;case 5:return b.values[this._key]<=this._val;case 6:return b.values[this._key]>=this._val;case 7:return-1!==this._val.indexOf(b.values[this._key]);
case 8:return-1===this._val.indexOf(b.values[this._key]);case 9:for(var f=0,d=this._val;f<d.length;f++){var h=d[f];if(h.filter(b))return!0}return!1;case 10:f=0;for(d=this._val;f<d.length;f++)if(h=d[f],!h.filter(b))return!1;return!0;case 11:f=0;for(d=this._val;f<d.length;f++)if(h=d[f],h.filter(b))return!1;return!0;case 12:return b.type===this._val;case 13:return b.type!==this._val;case 14:return b.type<this._val;case 15:return b.type>this._val;case 16:return b.type>=this._val;case 17:return b.type<=
this._val;case 18:return-1!==this._val.indexOf(b.type);case 19:return-1===this._val.indexOf(b.type);case 20:return void 0!==b.values[this._key];case 21:return void 0===b.values[this._key]}};b.createFilter=function(f){if(!f)return new b(0,void 0,!0);var k=f[0];if(1>=f.length)return new b(0,void 0,"any"!==k);switch(k){case "\x3d\x3d":return new b(1,f[1],f[2]);case "!\x3d":return new b(2,f[1],f[2]);case "\x3e":return new b(4,f[1],f[2]);case "\x3c":return new b(3,f[1],f[2]);case "\x3e\x3d":return new b(6,
f[1],f[2]);case "\x3c\x3d":return new b(5,f[1],f[2]);case "in":return new b(7,f[1],f.slice(2));case "!in":return new b(8,f[1],f.slice(2));case "any":return new b(9,void 0,f.slice(1).map(b.createFilter.bind(this)));case "all":return new b(10,void 0,f.slice(1).map(b.createFilter.bind(this)));case "none":return new b(11,void 0,f.slice(1).map(b.createFilter.bind(this)));case "has":return new b(20,f[1],void 0);case "!has":return new b(21,f[1],void 0);default:throw Error("invalid operator: "+k);}};b._types=
["Unknown","Point","LineString","Polygon"];return b}()})},"esri/views/vectorTiles/style/StyleDefinition":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(){}b.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};b.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};b.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],
default:"visible"},"line-cap":{type:"enum",values:["butt","round","square"],default:"butt"},"line-join":{type:"enum",values:["bevel","round","miter"],default:"miter"},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};b.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"symbol-placement":{type:"enum",values:["point","line"],default:"point"},"symbol-spacing":{type:"number",minimum:1,default:250},"symbol-avoid-edges":{type:"boolean",
default:!1},"icon-image":{type:"string"},"icon-allow-overlap":{type:"boolean",default:!1},"icon-ignore-placement":{type:"boolean",default:!1},"icon-optional":{type:"boolean",default:!1},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"icon-size":{type:"number",minimum:0,default:1},"icon-rotate":{type:"number",default:0},"icon-padding":{type:"number",minimum:0,default:2},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",
length:2,default:[0,0]},"text-field":{type:"string"},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-size":{type:"number",minimum:0,default:16},"text-max-width":{type:"number",minimum:0,default:10},"text-line-height":{type:"number",default:1.2},"text-letter-spacing":{type:"number",default:0},"text-justify":{type:"enum",values:["left","center","right"],default:"center"},
"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:"center"},"text-max-angle":{type:"number",minimum:0,default:45},"text-rotate":{type:"number",default:0},"text-padding":{type:"number",minimum:0,default:2},"text-keep-upright":{type:"boolean",default:!0},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:"none"},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-allow-overlap":{type:"boolean",
default:!1},"text-ignore-placement":{type:"boolean",default:!1},"text-optional":{type:"boolean",default:!1}};b.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};b.backgroundPaintDefinition={"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-color":{type:"color",default:[0,0,0,1]},"background-pattern":{type:"string"}};b.fillPaintDefinition={"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-antialias":{type:"boolean",
default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"fill-pattern":{type:"string"}};b.linePaintDefinition={"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-color":{type:"color",default:[0,0,0,1]},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",
values:["map","viewport"],default:"map"},"line-width":{type:"number",minimum:0,default:1},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-blur":{type:"number",minimum:0,default:0},"line-dasharray":{type:"array",value:"number",default:[]},"line-pattern":{type:"string"}};b.symbolPaintDefinition={"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-color":{type:"color",default:[0,0,0,0]},
"icon-halo-width":{type:"number",minimum:0,default:0},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-halo-blur":{type:"number",minimum:0,
default:0},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"}};b.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},
"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};b.circlePaintDefinition={"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-color":{type:"color",default:[0,0,0,1]},"circle-blur":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],
default:"map"},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1}};return b}();b.StyleDefinition=q})},"esri/views/vectorTiles/style/StyleProperty":function(){define(["require","exports","../../../Color","../GeometryUtils"],function(q,b,n,f){return function(){function b(d,f,k){this.isDataDriven=!1;switch(f.type){case "number":d=!0;break;case "color":d=!0;k=b._parseColor(k);
break;case "array":d="number"===f.value;break;default:d=!1}null==k&&(k=f.default);d&&"interval"===k.type&&(d=!1);var h=k&&k.stops&&0<k.stops.length;if(h)for(var c=0,a=k.stops;c<a.length;c++){var l=a[c];l[1]=this._validate(l[1],f)}if(this.isDataDriven=k?!!k.property:!1)if(void 0!==k.default&&(k.default=this._validate(k.default,f)),h)switch(k.type){case "identity":this.getValue=this._buildIdentity(k,f);break;case "categorical":this.getValue=this._buildCategorical(k,f);break;default:this.getValue=d?
this._buildInterpolate(k,f):this._buildInterval(k,f)}else this.getValue=this._buildIdentity(k,f);else h?this.getValue=d?this._buildZoomInterpolate(k):this._buildZoomInterval(k):(k=this._validate(k,f),this.getValue=this._buildSimple(k))}b.prototype._validate=function(b,f){if("number"===f.type){if(b<f.minimum)return f.minimum;if(b>f.maximum)return f.maximum}return b};b.prototype._buildSimple=function(b){return function(){return b}};b.prototype._buildIdentity=function(d,f){var h=this;return function(k,
c){var a;c&&(a=c.values[d.property],"color"===f.type&&(a=b._parseColor(a)));void 0===a&&(a=d.default);return void 0!==a?h._validate(a,f):f.default}};b.prototype._buildCategorical=function(b,f){var d=this;return function(h,c){var a;c&&(a=c.values[b.property]);a=d._categorical(a,b.stops);return void 0!==a?a:void 0!==b.default?b.default:f.default}};b.prototype._buildInterval=function(b,f){var d=this;return function(h,c){var a;c&&(a=c.values[b.property]);return"number"===typeof a?d._interval(a,b.stops):
void 0!==b.default?b.default:f.default}};b.prototype._buildInterpolate=function(b,f){var d=this;return function(h,c){var a;c&&(a=c.values[b.property]);return"number"===typeof a?d._interpolate(a,b.stops,b.base||1):void 0!==b.default?b.default:f.default}};b.prototype._buildZoomInterpolate=function(b){var d=this;return function(f){return d._interpolate(f,b.stops,b.base||1)}};b.prototype._buildZoomInterval=function(b){var d=this;return function(f){return d._interval(f,b.stops)}};b.prototype._categorical=
function(b,f){for(var d=f.length,h=0;h<d;h++)if(f[h][0]===b)return f[h][1]};b.prototype._interval=function(b,f){for(var d=f.length,h=0,c=0;c<d;c++)if(f[c][0]<=b)h=c;else break;return f[h][1]};b.prototype._interpolate=function(b,h,k){for(var d,c,a=h.length,l=0;l<a;l++){var g=h[l];if(g[0]<=b)d=g;else{c=g;break}}if(d&&c){l=c[0]-d[0];b-=d[0];k=1===k?b/l:(Math.pow(k,b)-1)/(Math.pow(k,l)-1);if(Array.isArray(d[1])){d=d[1];c=c[1];b=[];for(l=0;l<d.length;l++)b.push(f.interpolate(d[l],c[l],k));return b}return f.interpolate(d[1],
c[1],k)}if(d)return d[1];if(c)return c[1]};b._isEmpty=function(b){for(var d in b)if(b.hasOwnProperty(d))return!1;return!0};b._parseColor=function(d){if(Array.isArray(d))return d;if("string"===typeof d){if(d=new n(d),!this._isEmpty(d))return n.toUnitRGBA(d)}else return d&&d.default&&(d.default=b._parseColor(d.default)),d&&d.stops&&(d.stops=d.stops.map(function(d){return[d[0],b._parseColor(d[1])]})),d};return b}()})},"esri/views/vectorTiles/GeometryUtils":function(){define(["require","exports"],function(q,
b){function n(b,d){b%=d;return 0<=b?b:b+d}Object.defineProperty(b,"__esModule",{value:!0});b.C_INFINITY=Number.POSITIVE_INFINITY;b.C_PI=Math.PI;b.C_2PI=2*b.C_PI;b.C_PI_BY_2=b.C_PI/2;b.C_RAD_TO_256=128/b.C_PI;b.C_256_TO_RAD=b.C_PI/128;b.C_DEG_TO_256=256/360;b.C_DEG_TO_RAD=b.C_PI/180;b.C_SQRT2=1.414213562;b.C_SQRT2_INV=1/b.C_SQRT2;var f=1/Math.LN2;b.positiveMod=n;b.radToByte=function(f){return n(f*b.C_RAD_TO_256,256)};b.degToByte=function(f){return n(f*b.C_DEG_TO_256,256)};b.log2=function(b){return Math.log(b)*
f};b.sqr=function(b){return b*b};b.clamp=function(b,d,f){return Math.min(Math.max(b,d),f)};b.interpolate=function(b,d,f){return b*(1-f)+d*f};b.between=function(b,d,f){return b>=d&&b<=f||b>=f&&b<=d}})},"esri/views/3d/terrain/terrainUtilsPlanar":function(){define("require exports ../../../core/Error ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../geometry/support/aaBoundingRect ./TerrainConst ./TilingScheme".split(" "),function(q,b,n,f,k,d,h,m){function p(b,d,g,h){f.vec3.copy(c,
g);c[h]=d[h];h=f.vec3.subtract(c,c,d);var e=f.vec3.subtract(a,b,d),e=f.vec3.dot(e,h),l=f.vec3.dot(h,h);d=0>=e?d:l<=e?g:f.vec3.add(c,d,f.vec3.scale(h,h,e/l));b=f.vec3.subtract(c,b,d);return Math.PI/2-Math.atan(b[2]/Math.sqrt(b[0]*b[0]+b[1]*b[1]))}Object.defineProperty(b,"__esModule",{value:!0});var c=k.vec3f64.create(),a=k.vec3f64.create(),l=k.vec3f64.create(),g=k.vec3f64.create();b.isInsideExtent=function(a,b,c){void 0===c&&(c=0);a=a.extent;return 0===c?d.containsPoint(a,b):d.containsPointWithMargin(a,
b,c*Math.min(a[2]-a[0],a[3]-a[1]))};b.tiltOnEdge=p;b.tiltToExtentEdge=function(a,b){var c=a.getElevationBounds();a=a.extent;c=.5*(c[0]+c[1]);l[0]=a[0];l[1]=a[1];l[2]=c;g[0]=a[2];g[1]=a[3];g[2]=c;a=c=Infinity;b[0]<l[0]?c=p(b,l,g,0):b[0]>g[0]&&(c=p(b,g,l,0));b[1]<l[1]?a=p(b,l,g,1):b[1]>g[1]&&(a=p(b,g,l,1));return Math.min(c,a)};b.checkIfTileInfoSupportedForViewSR=function(a,b,c){if(a.spatialReference.isGeographic)return new n("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");
var e=m.checkUnsupported(a);if(e)return e;var f=a.lods,e=f[0].resolution*Math.pow(2,f[0].level),g=[e*a.size[0],e*a.size[1]],l=[a.origin.x,a.origin.y];b=d.fromExtent(b);var k=d.create();m.computeRowColExtent(b,g,l,k);g=(k[2]-k[0])*(k[3]-k[1]);g>h.MAX_ROOT_TILES?(f=f[0].scale*Math.pow(2,f[0].level),e=Math.max((b[3]-b[1])/a.size[1],(b[2]-b[0])/a.size[0])*f/e,b=Math.floor(Math.log(e)/Math.log(10)),e=Math.ceil(e/Math.pow(10,b))*Math.pow(10,b),e=new n("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+
Math.floor(f).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+e.toLocaleString()+".",{level0Scale:f,suggestedLevel0Scale:e,requiredNumRootTiles:g,allowedNumRootTiles:h.MAX_ROOT_TILES})):e=null;return e?e:c&&!a.spatialReference.equals(c)?new n("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}})},"esri/views/3d/terrain/terrainUtilsSpherical":function(){define(["require","exports","../../../core/Error",
"./TilingScheme"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});b.isInsideExtent=function(b,d,f){void 0===f&&(f=0);return!0};b.tiltToExtentEdge=function(b,d){return 0};b.checkIfTileInfoSupportedForViewSR=function(b,d,h){d=b.lods.length-1;if(b.spatialReference.isWebMercator){if(!f.makeWebMercatorAuxiliarySphere(d).compatibleWith(b))return new n("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(b.spatialReference.isWGS84){if(!f.makeWGS84WithTileSize(b.size[1],
d).compatibleWith(b))return new n("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme")}else return new n("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(h&&!b.spatialReference.equals(h))return new n("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define(["require",
"exports","./TerrainConst","./TileAgent","./tileUtils"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b,d){this._pool=d;this.waitingAgents=[];this.requestPromise=this.loadingAgent=this._upsampleFromTile=this.tilemapRequest=this.tilemap=this.data=null;this.pendingUpdates=0;this.elevationBounds=void 0;this.init(b)}b.prototype.init=function(b){this.waitingAgents.length=0;this.data=null;this.dataInvalidated=this.dataMissing=!1;this.tilemapRequest=this.tilemap=
null;this._unsetUpsampleInfo();this.requestPromise=this.loadingAgent=null;this.pendingUpdates=0;b===n.LayerClass.ELEVATION&&(this.elevationBounds=null)};b.prototype.invalidateSourceData=function(){this.tilemap=null;this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};b.prototype.dispose=function(){this.loadingAgent&&this.loadingAgent!==f.DONE&&(this.loadingAgent.dispose(),this.loadingAgent=null);this.requestPromise&&(this.requestPromise.cancel(),this.requestPromise=null);this.tilemap=
null;this.tilemapRequest&&(this.tilemapRequest.cancel(),this.tilemapRequest=null);this._unsetUpsampleInfo();this.pendingUpdates=0;this.disposeData()};b.prototype.disposeData=function(){this.data&&this.data.hasOwnProperty("dispose")&&this.data.dispose();this.data=null};Object.defineProperty(b.prototype,"upsampleFromTile",{get:function(){return this._upsampleFromTile},enumerable:!0,configurable:!0});b.prototype._unsetUpsampleInfo=function(){this._upsampleFromTile&&(this._pool.release(this._upsampleFromTile),
this._upsampleFromTile=null)};b.prototype.setUpsampleInfo=function(b,d){if(b===d||null==d)this._unsetUpsampleInfo();else{if(null==this._upsampleFromTile)this._upsampleFromTile=this._pool.acquire();else if(this._upsampleFromTile.tile===d)return;k.computeUpsampleInfo(b,d,this._upsampleFromTile)}};b.makeEmptyLayerInfo=function(d,f,k){return k?(k.init(d),k):new b(d,f)};return b}();b.TilePerLayerInfo=q})},"esri/views/vectorTiles/VectorTileDisplayObject":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/ObjectPool ../../core/libs/gl-matrix-2/mat4f32 ../../core/libs/gl-matrix-2/vec2f32 ../../geometry/support/spatialReferenceUtils ../2d/engine/DisplayObject ../2d/tiling/TileKey ./RenderBucket ../webgl/BufferObject".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a){var l="fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer".split(" ");return function(b){function e(){for(var a,c=[],e=0;e<arguments.length;e++)c[e]=arguments[e];e=b.call(this)||this;e._renderBuckets=[];e._vectorTileData=
null;e._symbolUpdateData=null;e.coords=[0,0];e.bounds=[0,0,0,0];e.tileTransform={transform:k.mat4f32.create(),displayCoord:d.vec2f32.create()};e.stencilData={mask:0,reference:0};0<c.length&&(a=e.acquire).call.apply(a,[e].concat(c));return e}n(e,b);e.prototype.reset=function(){p.pool.release(this.key);this.key=null;this.coords[0]=0;this.coords[1]=0;this.bounds[0]=0;this.bounds[1]=0;this.bounds[2]=0;this.height=this.width=this.bounds[3]=0;this.resolution=null;this.rotation=0;this.id=this.client=this.styleLayers=
this._vectorTileData=null;this.tileTransform.transform.fill(0);this.tileTransform.displayCoord.fill(0);this.stencilData.mask=0;this.stencilData.reference=0;this._renderBuckets.length=0;this.stage=this._symbolUpdateData=null};e.prototype.acquire=function(a,b,c,d){this.key=a;var e=b.lodAt(a.level),e=null!==e?e.resolution:0,f=b.size[0]*e,g=b.origin,l=a.col*f,k=a.row*f,m=b.spatialReference,p=0;m&&(m._isWrappable?m._isWrappable():m.isWrappable)&&(m=h.getInfo(m),p=m.valid[1]-m.valid[0]);l=g.x+l+a.world*
p;g=g.y-k;this.coords[0]=l;this.coords[1]=g;this.bounds[0]=l;this.bounds[1]=g;this.bounds[2]=l+f;this.bounds[3]=g-f;this.widthInPixels=b.size[1];this.coordRange=4096;this.resolution=e;this.rotation=d;this.styleLayers=c;this.id=a.id};e.prototype.setData=function(a,b){this._vectorTileData=a;this.client=b};e.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};e.prototype.updateTileData=function(a){this._vectorTileData=a;this.stage.requestRender()};e.prototype.dispose=
function(){for(var a="fillVertexArrayObject fillDDVertexArrayObject outlineVertexArrayObject lineVertexArrayObject lineDDVertexArrayObject iconVertexArrayObject iconDDVertexArrayObject textVertexArrayObject textDDVertexArrayObject circleVertexArrayObject fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer texture".split(" "),
b=0;b<a.length;++b){var c=a[b];this[c]&&(this[c].dispose(),this[c]=null)}this._renderBuckets.length=0};e.prototype.getCpuMemoryUsage=function(){return null!=this._vectorTileData&&this._vectorTileData.bufferData?this._vectorTileData.bufferData.reduce(function(a,b){return a+b.byteLength},0)+this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength:0};e.prototype.getGpuMemoryUsage=function(){var a=this,b=l.reduce(function(b,c){return a[c]?b+a[c].size:b},0);this.texture&&
(b+=this.texture.descriptor.width*this.texture.descriptor.height*4);return b};e.prototype.attachWithContext=function(a){this.stage={context:a};this.attached=this.attach()};e.prototype._commitChanges=function(){this._vectorTileData&&(this.dispose(),this._createRenderBuckets(),this._createBufferObjects(),this._vectorTileData=null)};e.prototype._createRenderBuckets=function(){for(var a=new Uint32Array(this._vectorTileData.bucketDataInfo),b=a.length,d=0;d<b;){var e=a[d];switch(a[d+1]){case 0:var f=new c.BackgroundRenderBucket;
f.layerID=e;this._renderBuckets.push(f);d+=2;break;case 1:f=new c.FillRenderBucket;f.layerID=e;f.triangleElementStart=a[d+2];f.triangleElementCount=a[d+3];f.outlineElementStart=a[d+4];f.outlineElementCount=a[d+5];this._renderBuckets.push(f);d+=6;break;case 2:f=new c.LineRenderBucket;f.layerID=e;f.triangleElementStart=a[d+2];f.triangleElementCount=a[d+3];this._renderBuckets.push(f);d+=4;break;case 3:f=new c.SymbolRenderBucket;f.layerID=e;f.isSDF=0!==a[d+2];var g=d+3,e=a[g];g++;if(0<e)for(var h=void 0,
l=void 0,k=void 0,m=0;m<e;m++)h=a[g],l=a[g+1],k=a[g+2],f.markerPerPageElementsMap.set(h,[l,k]),g+=3;var p=a[g];g++;if(0<p)for(k=l=h=void 0,m=0;m<p;m++)h=a[g],l=a[g+1],k=a[g+2],f.glyphPerPageElementsMap.set(h,[l,k]),g+=3;this._renderBuckets.push(f);d+=5+3*e+3*p;break;case 4:f=new c.CircleRenderBucket;f.layerID=e;f.triangleElementStart=a[d+2];f.triangleElementCount=a[d+3];this._renderBuckets.push(f);d+=4;break;default:console.error("Bad bucket type!"),d+=2}}};e._createBufferToObject=function(){var b=
[];b[1]={create:a.createVertex,var:"fillVertexBuffer"};b[2]={create:a.createVertex,var:"fillDDVertexBuffer"};b[3]={create:a.createIndex,var:"fillIndexBuffer"};b[4]={create:a.createVertex,var:"outlineVertexBuffer"};b[5]={create:a.createVertex,var:"outlineDDVertexBuffer"};b[6]={create:a.createIndex,var:"outlineIndexBuffer"};b[7]={create:a.createVertex,var:"lineVertexBuffer"};b[8]={create:a.createVertex,var:"lineDDVertexBuffer"};b[9]={create:a.createIndex,var:"lineIndexBuffer"};b[10]={create:a.createVertex,
var:"iconVertexBuffer"};b[11]={create:a.createVertex,var:"iconDDVertexBuffer"};b[12]={create:a.createIndex,var:"iconIndexBuffer"};b[13]={create:a.createVertex,var:"textVertexBuffer"};b[14]={create:a.createVertex,var:"textDDVertexBuffer"};b[15]={create:a.createIndex,var:"textIndexBuffer"};b[16]={create:a.createVertex,var:"circleVertexBuffer"};b[17]={create:a.createIndex,var:"circleIndexBuffer"};return b};e.prototype._createBufferObjects=function(){for(var a=this.stage.context,b=new Uint32Array(this._vectorTileData.bufferDataInfo),
c=b.length,d=0,f=0;f<c;f+=2,d++){var g=b[f];if(!(0>=b[f+1]||0===this._vectorTileData.bufferData[d].byteLength)){var h=e.bufferToObject[g];h?this[h.var]?this[h.var].setData(this._vectorTileData.bufferData[d]):this[h.var]=h.create(a,35044,this._vectorTileData.bufferData[d]):console.error("Bad buffer type "+g)}}};e.prototype.detach=function(){this.isReady&&this.client.invoke("destructTileData",this.id);this.dispose();b.prototype.detach.call(this)};e.prototype.doRender=function(a){if(this.visible&&this.isReady){var b=
this.stage.context,c=a.renderer;if(b&&c){this._commitChanges();var d=a.drawphase;this._symbolUpdateData&&(this._updateSymbolData(a,this._symbolUpdateData),this._symbolUpdateData=null);b.setStencilFunction(514,this.stencilData.reference,this.stencilData.mask);var e=this.styleLayers,f,g=void 0!==a.layerOpacity?a.layerOpacity:1;if(0!==g){var h=this._renderBuckets.length;if(0===d)for(var l=h-1;0<=l;l--){var k=this._renderBuckets[l];f=e.layers[k.layerID];if(!k||!f)break;1!==k.type&&0!==k.type||!k.hasData()||
c.renderBucket(b,k,a.displayLevel,a.requiredLevel,d,this,f,g)}else for(l=0;l<h;l++){k=this._renderBuckets[l];f=e.layers[k.layerID];if(!k||!f)break;k.hasData()&&c.renderBucket(b,k,a.displayLevel,a.requiredLevel,d,this,f,g)}}}}};e.prototype._updateSymbolData=function(b,d){if(!d||!d.bucketDataInfo)return!0;b=new Uint32Array(d.bucketDataInfo);var e=b.length;if(0===e)return!0;if(!this.isReady)return this.requestRender(),!1;for(var f=this.stage.context,g=new Uint32Array(d.bufferDataInfo),h=g.length,l=0,
k=0;k<h;k+=2,l++)switch(g[k]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=a.createVertex(f,35044,d.bufferData[l]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null);this.iconDDVertexBuffer=a.createVertex(f,35044,d.bufferData[l]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);this.iconIndexBuffer=a.createIndex(f,35044,d.bufferData[l]);
break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=a.createVertex(f,35044,d.bufferData[l]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=null);this.textDDVertexBuffer=a.createVertex(f,35044,d.bufferData[l]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=a.createIndex(f,35044,d.bufferData[l])}d=[];for(f=0;f<this._renderBuckets.length;f++)this._renderBuckets[f]instanceof
c.SymbolRenderBucket||d.push(this._renderBuckets[f]);this._renderBuckets=d;for(f=0;f<e;){h=b[f];g=new c.SymbolRenderBucket;g.layerID=h;g.isSDF=0!==b[f+2];this.styleLayers.layers.length>g.layerID&&this.styleLayers.layers[g.layerID].type===g.type&&d.push(g);var m=f+3,h=b[m];m++;if(0<h)for(var p=k=l=void 0,n=0;n<h;n++)l=b[m],k=b[m+1],p=b[m+2],g.markerPerPageElementsMap.set(l,[k,p]),m+=3;var q=b[m];m++;if(0<q)for(p=k=l=void 0,n=0;n<q;n++)l=b[m],k=b[m+1],p=b[m+2],g.glyphPerPageElementsMap.set(l,[k,p]),
m+=3;f+=5+3*h+3*q}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null);this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);return!0};e.pool=new f(e);e.bufferToObject=e._createBufferToObject();return e}(m.DisplayObject)})},
"esri/views/2d/engine/DisplayObject":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../../../core/Evented"],function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(b){function d(){var d=null!==b&&b.apply(this,arguments)||this;d._renderRequestedCalled=!1;d._attached=!1;d._isReady=!1;d._opacity=1;d.renderRequested=!1;d._visible=!0;return d}n(d,b);Object.defineProperty(d.prototype,"attached",{get:function(){return this._attached},set:function(b){this._attached!==
b&&((this._attached=b)?this.hasEventListener("attach")&&this.emit("attach"):this.hasEventListener("detach")&&this.emit("detach"))},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"isReady",{get:function(){return this._attached&&this._isReady},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"opacity",{get:function(){return this._opacity},set:function(b){this._opacity!==b&&(this._opacity=b,this.requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,
"visible",{get:function(){return this._visible},set:function(b){this._visible!==b&&(this._visible=b,this.requestRender())},enumerable:!0,configurable:!0});d.prototype.attach=function(){this.ready();return!0};d.prototype.detach=function(){};d.prototype.processRender=function(b){this.visible&&this.attached&&(this._renderRequestedCalled=!1,this.doRender(b),this._renderRequestedCalled||(this.renderRequested=!1),this.hasEventListener("post-render")&&this.emit("post-render"))};d.prototype.requestRender=
function(){var b=this.renderRequested;this.renderRequested=this._renderRequestedCalled=!0;this.parent&&this.parent.requestChildRender(this);b!==this.renderRequested&&this.hasEventListener("will-render")&&this.emit("will-render")};d.prototype.dispose=function(){};d.prototype.ready=function(){this._isReady=!0;this.emit("isReady")};return d}(f);b.DisplayObject=q})},"esri/views/vectorTiles/RenderBucket":function(){define(["require","exports","../../core/tsSupport/extendsHelper","../../core/tsSupport/decorateHelper"],
function(q,b,n,f){Object.defineProperty(b,"__esModule",{value:!0});q=function(){return function(b){this.type=b}}();b.RenderBucket=q;f=function(b){function d(){var d=b.call(this,2)||this;d.triangleElementStart=0;d.triangleElementCount=0;return d}n(d,b);d.prototype.hasData=function(){return 0<this.triangleElementCount};return d}(q);b.LineRenderBucket=f;f=function(b){function d(){var d=b.call(this,1)||this;d.triangleElementStart=0;d.triangleElementCount=0;d.outlineElementStart=0;d.outlineElementCount=
0;return d}n(d,b);d.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.outlineElementCount};return d}(q);b.FillRenderBucket=f;f=function(b){function d(){var d=b.call(this,3)||this;d.markerPerPageElementsMap=new Map;d.glyphPerPageElementsMap=new Map;d.isSDF=!1;return d}n(d,b);d.prototype.hasData=function(){return 0<this.markerPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};return d}(q);b.SymbolRenderBucket=f;f=function(b){function d(){var d=b.call(this,4)||this;d.triangleElementStart=
0;d.triangleElementCount=0;return d}n(d,b);d.prototype.hasData=function(){return 0<this.triangleElementCount};return d}(q);b.CircleRenderBucket=f;q=function(b){function d(){return b.call(this,0)||this}n(d,b);d.prototype.hasData=function(){return!0};return d}(q);b.BackgroundRenderBucket=q})},"esri/views/3d/terrain/TileGeometryFactory":function(){define("require exports ../../../core/libs/gl-matrix-2/vec4 ../../../geometry/support/aaBoundingBox ../support/ArrayPool ../support/earthUtils ../support/mathUtils ./TerrainConst".split(" "),
function(q,b,n,f,k,d,h,m){function p(a,b,c){for(var d=0;d<c.length;d++){var e=c[d];if(e){var f=e.safeWidth,g=e.width,l=e.pixelData,k=h.clamp(e.dy*(e.y1-b),0,f),e=h.clamp(e.dx*(a-e.x0),0,f),f=Math.floor(k),p=Math.floor(e),n=f*g+p,r=n+g,q=l[n],g=l[r],n=l[n+1],l=l[r+1];if(q+g+n+l<.5*m.ELEVATION_NODATA_VALUE)return k-=f,e-=p,a=q+(n-q)*e,a+(g+(l-g)*e-a)*k}}return null}function c(a,b,c,d){var e=0<(c&2),f=b+(d?1024:0)+(e?2048:0),h=u.get(f);if(!h){var h=b-1,l=b-1,k=b*b,m=2*h+2*l,p=h*l*6,n=6*m,r=6*(2*h+l-
1);d&&(p*=2,n*=2,r*=2);for(var m=65536<k+m?new Uint32Array(p+n):new Uint16Array(p+n),q=0,t=0,w=p,y,x,v,z,A=0,Q=0;Q<=l;Q++){e&&(A=0===Q?r:Q===l?-r:0);for(var w=w+A,I=0;I<=h;I++)v=g(I,Q,h,l),-1<v&&(z=0===Q&&I!==h?1:I===h&&Q!==l?h+1:Q===l&&0!==I?-1:0===I&&0!==Q?-(h+1):0,0!==z&&(y=q,x=k+v,v=k+(0===I&&1===Q?0:v+1),z=q+z,d?(m[w+0]=y,m[w+1]=x,m[w+2]=x,m[w+3]=v,m[w+4]=v,m[w+5]=y,m[w+6]=v,m[w+7]=z,m[w+8]=z,m[w+9]=y,m[w+10]=y,m[w+11]=v,w+=12):(m[w+0]=y,m[w+1]=x,m[w+2]=v,m[w+3]=v,m[w+4]=z,m[w+5]=y,w+=6))),++q,
I<h&&Q<l&&(y=Q*(h+1)+I,x=y+1,v=x+(h+1),z=v-1,d?(m[t+0]=y,m[t+1]=x,m[t+2]=x,m[t+3]=v,m[t+4]=v,m[t+5]=y,m[t+6]=v,m[t+7]=z,m[t+8]=z,m[t+9]=y,m[t+10]=y,m[t+11]=v,t+=12):(m[t+0]=y,m[t+1]=x,m[t+2]=v,m[t+3]=v,m[t+4]=z,m[t+5]=y,t+=6));w-=A}h={values:m,numSurfaceIndices:p,numSkirtIndices:n};u.set(f,h)}a.indices=h.values;a.numSurfaceIndices=h.numSurfaceIndices;a.numSkirtIndices=h.numSkirtIndices;a.numWithoutSkirtIndices=a.numSurfaceIndices+(c?6*(b-1)*(d?2:1):0)}function a(a,b,c,d){a<d[0]&&(d[0]=a);a>d[3]&&
(d[3]=a);b<d[1]&&(d[1]=b);b>d[4]&&(d[4]=b);c<d[2]&&(d[2]=c);c>d[5]&&(d[5]=c)}function l(a,b){var c=b>a?1:0;return 2+4*c+(1-2*c)*(a+b)}function g(a,b,c,d){return 0===b?a:a===c?c+b:b===d?c+d+(c-a):0===a&&0<b?2*c+d+(d-b):-1}Object.defineProperty(b,"__esModule",{value:!0});var e=new k.ArrayPool(Float32Array);b.clearCaches=function(){e.clear();u.clear()};b.releaseGeometry=function(a){e.put(a.vertexAttributes);a.vertexAttributes=null;a.indices=null};b.elevationSampler=p;b.createSphericalGlobeTile=function(b,
k,q,u,B,C,E,F){var v=q[0],x=q[1],z=q[2];q=q[3];var A=.1*d.earthRadius*(q-x),M=b.numVertsPerRow-1,O=b.numVertsPerRow-1,N=b.numVertsPerRow*b.numVertsPerRow,P=e.get((N+(2*M+2*O))*m.GEOMETRY_VERTEX_STRIDE),L=F.geometryInfo.boundingBox;f.empty(L);var T=k[2]-k[0],R=k[3]-k[1],J=z-v,z=B[0],U=B[1];B=B[2];for(var Q=0;Q<=M;Q++){var I=Q/M,V=v+I*J;t[Q]=Math.sin(V);r[Q]=Math.cos(V);y[Q]=I;w[Q]=k[0]+I*T}v=u&&!!(C&1);T=u&&!!(C&2);for(V=J=0;V<=O;V++){var X=V/O,Q=h.lerp(x,q,X),W=Math.cos(Q),ca=Math.sin(Q),da=void 0;
u?(da=d.earthRadius/2*Math.log((1+ca)/(1-ca)),X=(da-k[1])/R):da=180*Q/Math.PI;for(Q=0;Q<=M;Q++){var I=y[Q],ba=t[Q],aa=r[Q],S=d.earthRadius;b.samplerData&&(S+=p(w[Q],da,b.samplerData)||0);aa=aa*W*S-z;ba=ba*W*S-U;S=ca*S-B;a(aa,ba,S,L);var Z=m.GEOMETRY_VERTEX_STRIDE*J;P[Z+0]=aa;P[Z+1]=ba;P[Z+2]=S;P[Z+3]=I;P[Z+4]=X;Z=g(Q,V,M,O);if(-1<Z){var Z=m.GEOMETRY_VERTEX_STRIDE*(N+Z),Y=v&&0===V?-1:T&&V===O?1:0,aa=0===Y?aa:-z,ba=0===Y?ba:-U,S=0===Y?S:d.earthRadius*Y-B;P[Z+0]=aa;P[Z+1]=ba;P[Z+2]=S;P[Z+3]=0===Y?l(I,
X):I;P[Z+4]=0===Y?A:X;0!==Y&&a(aa,ba,S,L)}++J}}F.geometryInfo.numVertsPerRow=b.numVertsPerRow;F.geometryInfo.vertexAttributes=P;F.geometryInfo.skirtLength=A;n.vec4.set(F.geometryInfo.uvOffsetAndScale,0,0,1,1);c(F.geometryInfo,b.numVertsPerRow,u?C:0,E)};b.createPlanarGlobeTile=function(b,d,h,k,r){var q=d[0],t=d[1],u=d[2]-q,w=d[3]-t,y=b.clippingArea,v=y?Math.max(0,(y[0]-d[0])/u):0,x=y?Math.max(0,(y[1]-d[1])/w):0,z=y?Math.min(1,(y[2]-d[0])/u):1;d=y?Math.min(1,(y[3]-d[1])/w):1;var A=z>v?1/(z-v):1,B=d>
x?1/(d-x):1,P=-v*A,L=-x*B,T=.1*u,R=b.numVertsPerRow-1,J=b.numVertsPerRow-1,U=b.numVertsPerRow*b.numVertsPerRow,Q=e.get((U+(2*R+2*J))*m.GEOMETRY_VERTEX_STRIDE),I=r.geometryInfo.boundingBox;f.empty(I);for(var V=0,X=0;X<=J;X++){var W=X/J,ca=L+W*B,W=t+W*w;y&&(W<y[1]?(W=y[1],ca=0):W>y[3]&&(W=y[3],ca=1));for(var da=0;da<=R;da++){var ba=da/R,aa=P+ba*A,ba=q+ba*u;y&&(ba<y[0]?(ba=y[0],aa=0):ba>y[2]&&(ba=y[2],aa=1));var S=b.samplerData?p(ba,W,b.samplerData)||0:0,ba=ba-h[0],Z=W-h[1],S=S-h[2];a(ba,Z,S,I);Q[m.GEOMETRY_VERTEX_STRIDE*
V]=ba;Q[m.GEOMETRY_VERTEX_STRIDE*V+1]=Z;Q[m.GEOMETRY_VERTEX_STRIDE*V+2]=S;Q[m.GEOMETRY_VERTEX_STRIDE*V+3]=aa;Q[m.GEOMETRY_VERTEX_STRIDE*V+4]=ca;var Y=g(da,X,R,R);-1<Y&&(Y=m.GEOMETRY_VERTEX_STRIDE*(U+Y),Q[Y]=ba,Q[Y+1]=Z,Q[Y+2]=S,Q[Y+3]=l(aa,ca),Q[Y+4]=T);++V}}r.geometryInfo.numVertsPerRow=b.numVertsPerRow;r.geometryInfo.vertexAttributes=Q;r.geometryInfo.skirtLength=T;n.vec4.set(r.geometryInfo.uvOffsetAndScale,v,x,z-v,d-x);c(r.geometryInfo,b.numVertsPerRow,0,k)};var u=new Map,t=Array(m.MAX_TILE_TESSELATION+
1),r=Array(m.MAX_TILE_TESSELATION+1),y=Array(m.MAX_TILE_TESSELATION+1),w=Array(m.MAX_TILE_TESSELATION+1)})},"esri/views/3d/support/ArrayPool":function(){define(["require","exports","../../../core/PooledArray"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(b){this.arrayConstructor=b;this._pool=new Map}b.prototype.get=function(b){var d=this._pool.get(b);if(!d||0===d.length)try{return new this.arrayConstructor(b)}catch(m){var d=window.performance&&window.performance.memory,
f="";d&&(f="\n  totalJSHeapSize: "+d.totalJSHeapSize+", usedJSHeapSize: "+d.usedJSHeapSize+", jsHeapSizeLimit: "+d.jsHeapSizeLimit);console.log("Array allocation of size "+b+" failed: "+m+f);throw m;}return d.pop()};b.prototype.put=function(b){var d=this._pool.get(b.length);d||(d=new n({shrink:!0}),this._pool.set(b.length,d));d.push(b)};b.prototype.clear=function(){this._pool.clear()};return b}();b.ArrayPool=q})},"esri/views/3d/terrain/SphericalTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../support/earthUtils ../support/geometryUtils ../support/mathUtils ./Tile ./TileGeometryFactory".split(" "),
function(q,b,n,f,k,d,h,m,p,c){function a(a,b,c,f){c=d.earthRadius+c;var e=Math.cos(a);f[0]=Math.cos(b)*e*c;f[1]=Math.sin(b)*e*c;f[2]=Math.sin(a)*c}return function(b){function g(a,c,d){var e=b.call(this,g.NumSubdivisionsAtLevel)||this;e.obb=Array(8);e.isWebMercator=!1;e.tileUp=k.vec3f64.create();for(var f=0;8>f;f++)e.obb[f]=k.vec3f64.create();void 0!==a&&e.init(a,c,d);return e}n(g,b);g.prototype.init=function(c,g,h){b.prototype.init.call(this,c,g,h);this.isWebMercator=h.tilingScheme.spatialReference.isWebMercator;
g=this.extentWGS84Rad[0];h=this.extentWGS84Rad[1];var e=this.extentWGS84Rad[2],l=this.extentWGS84Rad[3];c=c[0];var k=m.lerp(h,l,.5),p=m.lerp(g,e,.5);this.edgeLen=(e-g)*Math.cos(0===c?0:Math.min(Math.abs(h),Math.abs(l)))*d.earthRadius;this.edgeLen2=this.edgeLen*this.edgeLen;this.curvatureHeight=d.earthRadius-Math.sqrt(d.earthRadius*d.earthRadius-this.edgeLen2/4);a(k,p,0,this.centerAtSeaLevel);f.vec3.copy(this.tileUp,this.centerAtSeaLevel);f.vec3.normalize(this.tileUp,this.tileUp);this._updateOBB();
this.updateRadiusAndCenter()};g.prototype.updateRadiusAndCenter=function(){if(0===this.lij[0])f.vec3.set(this.center,0,0,0),this.radius=d.earthRadius+this.elevationBounds[1];else{b.prototype.updateRadiusAndCenter.call(this);var a=Math.max(f.vec3.squaredDistance(this.center,this.obb[0]),f.vec3.squaredDistance(this.center,this.obb[1]));this.radius=Math.sqrt(a)}};g.prototype._isVisible=function(){if(!this.intersectsClippingArea)return!1;var a=this.surface.frustum.planes;if(10>this.lij[0])return h.frustum.intersectsSphere(a,
h.sphere.wrap(this.radius,this.center));for(var b=this.obb,c=0;6>c;c++){for(var d=void 0,d=0;8>d&&!h.plane.isPointOutside(a[c],b[d]);d++);if(8===d)return!1}return!0};g.prototype.computeElevationBounds=function(){b.prototype.computeElevationBounds.call(this);this._updateOBB()};g.prototype.createGeometry=function(a,b,d){var e=this._isPole(this.lij[1],this.lij[0]);c.createSphericalGlobeTile(a,this.extent,this.extentWGS84Rad,this.isWebMercator,b,e,d,this.renderData);this.updateMemoryUsed()};g.prototype._updateOBB=
function(){for(var b=this.extentWGS84Rad,c=this.obb,g=0;2>g;g++){var h=this.elevationBounds[g],l=4*g;a(b[1],b[0],h,c[l++]);a(b[3],b[0],h,c[l++]);a(b[3],b[2],h,c[l++]);a(b[1],b[2],h,c[l++])}this.isWebMercator&&(b=this._isPole(this.lij[1],this.lij[0]),2===b?(f.vec3.set(c[1],0,0,d.earthRadius),f.vec3.set(c[2],0,0,d.earthRadius),f.vec3.set(c[5],0,0,d.earthRadius),f.vec3.set(c[6],0,0,d.earthRadius)):1===b&&(f.vec3.set(c[0],0,0,-d.earthRadius),f.vec3.set(c[3],0,0,-d.earthRadius),f.vec3.set(c[4],0,0,-d.earthRadius),
f.vec3.set(c[7],0,0,-d.earthRadius)))};g.prototype._isPole=function(a,b){var c=0;a===(1<<b)-1&&(c+=1);0===a&&(c+=2);return c};g.NumSubdivisionsAtLevel=[128,64,32,16,16,8,8,4];return g}(p)})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ./TerrainConst ./terrainUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a){function l(a,b){a&&!a.spatialReference.equals(b)&&(a=p.canProject(a.spatialReference,b)?p.project(a,b):null);return a}Object.defineProperty(b,"__esModule",{value:!0});q=function(a){function b(b){b=a.call(this,b)||this;b._changeListeners=new d;return b}n(b,a);b.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layerViews.on("change",function(){return a.notifyChange("stencilEnabledExtents")})])};b.prototype.destroy=function(){this._changeListeners.destroy();
this._changeListeners=null};Object.defineProperty(b.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,
"spatialReference",{set:function(a){this.tilingScheme||this._set("spatialReference",a)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"tilingScheme",{set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)},enumerable:!0,configurable:!0});b.prototype._computeStencilEnabledExtents=function(a,b){var c=[],d=0;for(a=a.items;d<a.length;d++){var e=a[d].layer;"IntegratedMeshLayer"===e.operationalLayerType&&null!=b&&(e=l(e.fullExtent,b),null!=e&&c.push(m.fromExtent(e)))}return c};
f([h.property({readOnly:!0})],b.prototype,"layerViewsExtent",null);f([h.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],b.prototype,"tiledLayersExtent",null);f([h.property({readOnly:!0,dependsOn:["spatialReference"]})],b.prototype,"stencilEnabledExtents",null);f([h.property()],b.prototype,"spatialReference",null);f([h.property()],b.prototype,"tilingScheme",null);f([h.property()],b.prototype,"defaultTiledLayersExtent",void 0);f([h.property({constructOnly:!0})],b.prototype,"layers",
void 0);f([h.property({constructOnly:!0})],b.prototype,"layerViews",void 0);return b=f([h.subclass()],b)}(h.declared(k));k=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}n(b,a);b.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()};b.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()};b.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?c.WEBMERCATOR_WORLD_EXTENT:c.GEOGRAPHIC_WORLD_EXTENT};f([h.property({dependsOn:["spatialReference"]})],
b.prototype,"layerViewsExtent",void 0);return b=f([h.subclass()],b)}(h.declared(q));b.SurfaceExtentHelperGlobal=k;q=function(b){function c(){return null!==b&&b.apply(this,arguments)||this}n(c,b);c.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layers.on("change",function(){return a.notifyChange("tiledLayersExtent")}),this.layerViews.on("change",function(){return a.notifyChange("layerViewsExtent")})])};c.prototype._computeLayerViewsExtent=function(){var a=m.empty(),b=this.spatialReference;
this.layerViews.forEach(function(c){c.isResolved()&&(c=c.fullExtentInLocalViewSpatialReference||c.layer.fullExtent,(c=l(c,b))&&m.expand(a,c))});var c=m.allFinite(a)?a:null,d=this._get("layerViewsExtent");return m.equals(c,d)?d:c};c.prototype._computeTiledLayersExtent=function(){var b=this.tilingScheme;if(!b)return null;var c=this.spatialReference,d=m.empty();this.layers.forEach(function(e){if(e.loaded&&a.isTiledLayer(e)){var f=a.getTiledLayerInfo(e,c,"local");e=f.tileInfo;f=f.fullExtent;e&&b.compatibleWith(e)&&
f&&f.spatialReference.equals(c)&&m.expand(d,f)}});this.defaultTiledLayersExtent&&m.expand(d,this.defaultTiledLayersExtent);var e=m.allFinite(d)?d:null,f=this._get("tiledLayersExtent");return m.equals(e,f)?f:e};return c=f([h.subclass()],c)}(h.declared(q));b.SurfaceExtentHelperLocal=q})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ./terrainUtils ./TilingScheme".split(" "),
function(q,b,n,f,k,d,h,m,p){return function(b){function a(a){a=b.call(this,a)||this;a._changeHandles=new d;return a}n(a,b);a.prototype.initialize=function(){var a=this;this._changeHandles.add(this.layers.on("change",function(){return a._update()}));this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",function(){return a._setAdHocTilingScheme()}));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};a.prototype.destroy=function(){this._changeHandles.destroy();this._changeHandles=
null};a.prototype._update=function(){var a=this;this._waitTask=null;if(!this.tilingSchemeLocked){this._set("tilingSchemeDone",!1);var b=this.layers.find(function(b){return m.isTiledLayer(b)?b.isFulfilled()?b.isRejected()?!1:!!m.getTiledLayerInfo(b,a.viewSpatialReference,a.manifold).tileInfo:!0:!1});if(b)if(b.isResolved()){var c=m.getTiledLayerInfo(b,this.viewSpatialReference,this.manifold).tileInfo,c=new p(c),b=m.getKnownTiledServiceLevelCap(b.url);Infinity>b&&c.capMaxLod(b);this._set("tilingSchemeDone",
!0);this._lockTilingScheme(c)}else this._updateWhen(b);else this._set("tilingSchemeDone",!0)}};a.prototype._updateWhen=function(a){var b=this,c=a.when().catch(function(a){return a}).then(function(){c===b._waitTask&&b._update()});this._waitTask=c};a.prototype._lockTilingScheme=function(a){var b=this;if("spherical"===this.manifold){var c=a.levels.length-1;a=a.spatialReference.isWebMercator?p.makeWebMercatorAuxiliarySphere(c):p.makeWGS84WithTileSize(a.pixelSize[0],c)}this.tilingSchemeLocked=!0;this.tilingScheme=
a;this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this._changeHandles.removeAll();this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",function(){return b._updateTiledLayerExtent()}))};a.prototype._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent};a.prototype._setAdHocTilingScheme=function(){if("spherical"===this.manifold)this.tilingScheme=this.extentHelper.spatialReference.isWebMercator?p.WebMercatorAuxiliarySphere:p.makeWGS84WithTileSize(256),
this.extent=this.extentHelper.layerViewsExtent;else{var a=this.extentHelper.layerViewsExtent;a&&(this.tilingScheme=p.fromExtent(a,this.extentHelper.spatialReference),this.extent=a)}};f([h.property()],a.prototype,"tilingScheme",void 0);f([h.property()],a.prototype,"extent",void 0);f([h.property({value:!1})],a.prototype,"tilingSchemeLocked",void 0);f([h.property({readOnly:!0,value:!1})],a.prototype,"tilingSchemeDone",void 0);f([h.property({constructOnly:!0})],a.prototype,"viewSpatialReference",void 0);
f([h.property({constructOnly:!0})],a.prototype,"layers",void 0);f([h.property({constructOnly:!0})],a.prototype,"extentHelper",void 0);f([h.property({constructOnly:!0})],a.prototype,"manifold",void 0);return a=f([h.subclass()],a)}(h.declared(k))})},"esri/views/3d/terrain/TerrainRenderer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/assignHelper ../../../Color ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/libs/gl-matrix-2/mat4f64 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec3 ../../../core/libs/gl-matrix-2/vec3f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ../support/imageUtils ./ResourceCounter ./TerrainConst ./TileGeometryFactory ./TileRenderData ./TileRenderer ./tileUtils ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/tracer ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainRendererPrograms ../../webgl/renderState ../../webgl/Util".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B,C,E,F,H,D,G,K,M){var O=H.assert,N=c.mat4f64.create(),P=g.vec3f64.create(),L=a.vec2f64.create(),T=t.create(),R=u.vec4f64.create(),J=u.vec4f64.create(),U=u.vec4f64.create(),Q=function(){return function(){this.extent=u.vec4f64.create();this.maxLevel=this.minLevel=0;this.callback=null}}();q=function(){function a(a,b){this._memCache=b;this.tileSize=256;this.initialized=!1;this.rctx=null;this.renderDataPool=new h(v.TileRenderData);this.perOriginTileData=
new m({allocator:function(a){return a||{root:null,origin:null,tiles:new m}},deallocator:function(a){a.root=null;a.origin=null;a.tiles.clear();return a}});this.perOriginTileDataDirty=!0;this.perOriginTileDataMap=new Map;this.tileIterator=new A.IteratorPreorder;this._highestVisibleLODTile=null;this.visible=!0;this.debugScreenSizePerspective=!1;this.wireframe=D.copyParameters(I);this._opaque=!0;this._skirtScale=1;this._cullBackFaces=this._disableRendering=this._drawBorders=!1;this._renderOrder=w.RenderOrder.FRONT_TO_BACK;
this._velvetOverground=!0;this._slicePlaneEnabled=this._hasOverlays=!1;this.castShadows=!0;this.receiveShadows=!1;this.backgroundPromise=this.tileRenderer=this.emptyTex=null;this.tileBackgroundInitialized=!1;this.stencilEnabledLayerExtents=[];this.numOriginsRendered=this.numTilesCulled=this.numTilesRendered=this.numTrianglesRendered=0;this.resourceCounter=new y;this.loaded=this.clippingExtent=null;this._loaded=!1;this.needsRender=!0;this.needsHighlight=this.didRender=!1;this.visibleScaleRangeQueries=
new m({initialSize:10});this.visibleScaleRangeQueriesInvPtr=0;this.visibleScaleRangeQueryQueue=new m({initialSize:30});this.visibleScaleRangeQueryPool=new h(Q,!1);this.manifold=a}a.prototype.destroy=function(a){this.uninstall(a);this.backgroundPromise&&(this.backgroundPromise.cancel(),this.backgroundPromise=null);x.clearCaches()};a.prototype.install=function(a){a.addRenderPlugin([3,8],this);this.drapedRenderer=a.getDrapedRenderer()};a.prototype.uninstall=function(a){a.removeRenderPlugin(this)};Object.defineProperty(a.prototype,
"disableRendering",{set:function(a){this._disableRendering=!!a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"opaque",{set:function(a){this._opaque=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"skirtScale",{set:function(a){this._skirtScale=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"drawBorders",{set:function(a){this._drawBorders!==a&&(this._drawBorders=a,this._updatePrograms())},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"cullBackFaces",{set:function(a){this._cullBackFaces=a;this._updatePrograms();this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderOrder",{get:function(){return this._renderOrder},set:function(a){this._renderOrder=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"velvetOverground",{set:function(a){this._velvetOverground!==a&&(this._velvetOverground=
a,this._updatePrograms())},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"intersectionHandlerId",{get:function(){return C.TERRAIN_ID},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"slicePlaneEnabled",{get:function(){return this._slicePlaneEnabled},set:function(a){this._slicePlaneEnabled!==a&&(this._slicePlaneEnabled=a,this._updatePrograms())},enumerable:!0,configurable:!0});a.prototype.setRootTiles=function(a){this.rootTiles=a;this.setNeedsRender()};a.prototype.setNeedsHighlight=
function(a){this.needsHighlight=a;this.setNeedsRender()};a.prototype.setStencilEnabledLayerExtents=function(a){this.stencilEnabledLayerExtents=a;this.setNeedsRender()};a.prototype.setTileSize=function(a){this.tileSize=a;this.tileRenderer&&(this.tileRenderer.tileSize=a);this.setNeedsRender()};a.prototype.loadCachedElevationData=function(a){O(null===a.renderData);var b=A.tile2str(a);if(b=this._memCache.pop(b)){a.renderData=b.renderData;a.renderData.tile=a;a.renderData.localOrigin=this._getLocalOriginOfTile(a);
for(var c in b.upsampleLIJs){var d=A.findParentByLIJ(a,b.upsampleLIJs[c]);a.layerInfo[w.LayerClass.ELEVATION][c].setUpsampleInfo(a,d)}}return null!=b};a.prototype.loadTile=function(a){a.renderData||(a.renderData=this.renderDataPool.acquire(),a.renderData.init(a),a.renderData.localOrigin=this._getLocalOriginOfTile(a),this.updateTileGeometry(a));this.tileBackgroundInitialized&&this.tileRenderer.updateTileTexture(a)};a.prototype.queryVisibleLevelRange=function(a,b,c,d){var f=this.visibleScaleRangeQueryPool.acquire();
e.vec4.copy(f.extent,a);f.minLevel=b?b:-Number.MAX_VALUE;f.maxLevel=null!=c?c:Number.MAX_VALUE;f.callback=d;this.visibleScaleRangeQueryQueue.push(f);this.setNeedsRender()};a.prototype.updateTileTexture=function(a){this.tileRenderer&&this.tileBackgroundInitialized&&this.tileRenderer.updateTileTexture(a)};a.prototype.updateTileGeometry=function(a){for(var b=0,c=a.layerInfo[w.LayerClass.ELEVATION];b<c.length;b++)c[b].pendingUpdates&=~w.TileUpdate.GEOMETRY;a.renderData.updateGeometry(this.rctx,"debug"===
this.wireframe.mode)&&this.setNeedsRender()};a.prototype.unloadTile=function(a,b){if(a.renderData){a.renderData.releaseTexture();if(b){b={renderData:a.renderData,upsampleLIJs:[]};for(var c=0,d=a.layerInfo[w.LayerClass.ELEVATION];c<d.length;c++){var e=d[c].upsampleFromTile.tile.lij;b.upsampleLIJs.push([e[0],e[1],e[2]])}this._memCache.put(A.tile2str(a),b,a.renderData.estimatedGeometryMemoryUsage)}else this.releaseTileGeometry(a.renderData);a.renderData=null;a.updateMemoryUsed()}};a.prototype._getLocalOriginOfTile=
function(a){var b=Math.max(0,7*Math.floor((a.lij[0]-3)/7));if("spherical"===this.manifold&&0===b)return P;for(;a.parent&&a.lij[0]>b;)a=a.parent;return a.centerAtSeaLevel};a.prototype.setVisibility=function(a){this.visible=a;this.setNeedsRender()};a.prototype.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,numOriginsRendered:this.numOriginsRendered}};a.prototype.getWireframeEnabled=function(){return"shader"===
this.wireframe.mode};a.prototype.setDebugScreenSizePerspective=function(a){a!==this.debugScreenSizePerspective&&(this.debugScreenSizePerspective=a,this._updatePrograms())};a.prototype.setWireframe=function(a){var b=this;if(!1===a||!0===a)a={mode:a?"shader":"none"};var c=this.wireframe;if(void 0!==a.mode&&c.mode!==a.mode){var d="debug"===c.mode,e="debug"===a.mode;c.mode=a.mode;this._updatePrograms();d!==e&&this.rootTiles&&(A.traverseTilesPreorder(this.rootTiles,function(a){a.renderData&&a.renderData.updateGeometry(b.rctx,
e)}),this.setNeedsRender())}for(var f in a)c.hasOwnProperty(f)&&(c[f]=a[f]),this.setNeedsRender();c.resolution&&(c.resolution=Math.min(c.resolution,this.tileSize),c.resolution=1<<Math.round(Math.log(c.resolution)/Math.LN2))};a.prototype.setNeedsRender=function(){this.needsRender=!0;this.didRender=!1;this.perOriginTileDataDirty=!0};a.prototype.resetNeedsRender=function(){this.didRender&&(this.needsRender=0!==this.visibleScaleRangeQueryQueue.length,this.didRender=!1)};a.prototype.isOpaqueExcludingSlice=
function(){var a=this.wireframe,a="shader"===a.mode&&(1>a.wireOpacity||1>a.surfaceOpacity);return this._opaque&&!a};a.prototype.isOpaque=function(){return this.isOpaqueExcludingSlice()&&!this._slicePlaneEnabled};a.prototype.updateTileBackground=function(a){this.backgroundPromise&&this.backgroundPromise.cancel();this.backgroundPromise="string"===typeof a?r.requestImage(a).catch(function(){return null}):null!=a?p.resolve(k.toUnitRGBA(a)):p.resolve(null);this._renderTileBackground()};a.prototype.initializeRenderContext=
function(a){var b=this,c=this.rctx=a.rctx;a=this.programRep=a.programRep;var d=function(a){p.when(a).then(function(){b.initialized=!0;b.setNeedsRender()}).catch(d)};d(this._renderTileBackground());this._updatePrograms();this.tileRenderer=new z(c,this.tileSize,a,this.resourceCounter,function(){return b.setNeedsRender()});this._renderTileBackground();this.emptyTex=B.createEmptyTexture(c)};a.prototype.uninitializeRenderContext=function(a){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null);
this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};a.prototype.render=function(a){var b=a.rctx;if(!this.initialized||this._disableRendering||!this.visible||!this.rootTiles||!this.tileBackgroundInitialized)return!1;var c=this.isOpaque()?3:8;if(a.slot!==c)return!1;F.trace("# BEGIN RENDER TERRAIN");var c=a.pass,d=1===a.lightingData.helper.globalFactor;0===c?this._renderMaterialPass(a,this._updatePerOriginTileData()):3===c&&this.castShadows&&d?this._renderDepthPass(a,this.programs.depthShadowMap,
this._updatePerOriginTileData()):1===c?this._renderDepthPass(a,this.programs.depth,this._updatePerOriginTileData()):2===c?this._renderNormalPass(a,this._updatePerOriginTileData()):4===c&&this.needsHighlight&&(this._renderHighlightPass(a,this._updatePerOriginTileData()),b.clearSafe(256));F.trace("# END RENDER TERRAIN");return!0};a.prototype.intersect=function(a,b,c,e,f){if(this.rootTiles&&(!a.enable.selectOpaqueTerrainOnly||!a.enable.selectionMode||this.isOpaqueExcludingSlice())){var g=X,h=W;l.vec3.subtract(g,
e,c);l.vec3.set(h,1/g[0],1/g[1],1/g[2]);var k=a.results.min,m=a.results.max,p=a.results.terrain,n=null,r=this.clippingExtent,q=this.tileIterator;q.reset(this.rootTiles);f=function(){var f=q.next();if(null===f.renderData)return"continue";if(a.enable.invisibleTerrain){if(!f.visible&&r&&!f.intersectsExtent(r))return"continue"}else if(!f.visible)return"continue";var y=f.renderData.geometryInfo,v=-u._skirtScale*y.skirtLength;if(0!==v){var x=f.tileUp;t.offset(y.boundingBox,v*x[0],v*x[1],v*x[2],T);t.expandWithBuffer(T,
y.boundingBox,0,2)}var x=0===v?y.boundingBox:T,z=f.renderData.localOrigin;l.vec3.subtract(ca,c,z);if(!D.intersectAabbInvDir(x,ca,h,a.tolerance))return"continue";var B=function(a,b,c,d){a.set(void 0,A.tile2str(b),c,d,N,void 0);a.intersector=ba;a.target=aa},x=function(h,r,q){0<=h&&(a.enable.backfacesTerrain||0>l.vec3.dot(r,g))&&(a.enable.invisibleTerrain||!a.enable.selectionMode||null==b||b(c,e,h))&&((null==p.dist||h<p.dist)&&B(p,f,h,r),a.enable.storeTerrainResults&&(a.enable.storeAll&&(d.isNone(n)?
(n=new C.IntersectorResult(a.ray),B(n,f,h,r),a.results.all.push(n)):h<n.dist&&B(n,f,h,r)),(null==k.dist||h<k.dist)&&B(k,f,h,r),(null==m.dist||h>m.dist)&&B(m,f,h,r)))},E=da;l.vec3.subtract(E,e,z);var z=y.indices,J={data:y.vertexAttributes,size:3,offsetIdx:0,strideIdx:w.GEOMETRY_VERTEX_STRIDE},y=y.numWithoutSkirtIndices/3;D.intersectTriangles(ca,E,0,y,z,J,null,x);0!==v&&A.intersectSkirts(ca,E,y,z.length/3,z,J,null,"spherical"===u.manifold?function(a){return l.vec3.scale(a,a,v/l.vec3.length(a))}:function(a){return l.vec3.set(a,
0,0,v)},x)};for(var u=this;!q.done;)f()}};a.prototype._renderTileBackground=function(){var a=this;if(this.rctx&&this.backgroundPromise&&this.tileRenderer)return this.backgroundPromise.then(function(b){a.tileRenderer&&(a.tileBackgroundInitialized=!0,a.tileRenderer.setBackground(b),a.rootTiles&&A.traverseTilesPreorder(a.rootTiles,function(b){return a.tileRenderer.updateTileTexture(b)}))})};a.prototype._updatePrograms=function(){var a="shader"===this.wireframe.mode,b=this.programRep;this.programs={color:b.getProgram(G.colorPass,
{mode:a||this._drawBorders?"wireframe":"normal",overlay:this._hasOverlays,atmosphere:"spherical"===this.manifold&&this._velvetOverground,wireframeTexture:a,tileBorders:this._drawBorders,receiveShadows:this.receiveShadows,screenSizePerspective:this.debugScreenSizePerspective,slice:this._slicePlaneEnabled}),normal:b.getProgram(G.normalPass,{alphaZero:!0}),depth:b.getProgram(G.depthPass,{shadowMap:!1}),depthShadowMap:b.getProgram(G.depthPass,{shadowMap:!0}),highlight:b.getProgram(G.highlightPass,{})};
this.defaultPipelineState=K.makePipelineState({culling:this._cullBackFaces&&K.backFaceCullingParams,depthTest:{func:513},depthWrite:K.defaultDepthWriteParams,colorWrite:K.defaultColorWriteParams});this.stencilPipelineState=K.makePipelineState(f({},this.defaultPipelineState,{stencilTest:{function:{func:517,ref:1,mask:255},operation:{fail:7680,zFail:7680,zPass:7680}}}));this.setNeedsRender()};a.prototype._renderMaterialPass=function(a,b){var c=this,d=a.shadowMap&&a.shadowMap.enabled,e=a.rctx;this.receiveShadows!==
d&&(this.receiveShadows=d,this._updatePrograms());d=!this.drapedRenderer.isEmpty();d!==this._hasOverlays&&(this._hasOverlays=d,this._updatePrograms());var d=a.camera,f=this.wireframe,g=this.programs.color;e.bindProgram(g);if("shader"===f.mode||this._drawBorders)g.setUniform1f("wireframe.width",this.wireframe.width),g.setUniform1f("wireframe.falloff",Math.min(f.width,f.falloff)),g.setUniform1f("wireframe.wireOpacity",f.wireOpacity),g.setUniform1f("wireframe.surfaceOpacity",f.surfaceOpacity),g.setUniform4fv("wireframe.color",
f.color);a.shadowMap&&a.shadowMap.bind(g);a.ssaoHelper&&a.ssaoHelper.setUniforms(g);g.setUniform1i("tex",0);g.setUniform1i("overlay0Tex",1);g.setUniform1i("overlay1Tex",2);g.setUniformMatrix4fv("viewNormal",d.viewInverseTransposeMatrix);g.setUniformMatrix4fv("proj",d.projectionMatrix);a.lightingData.helper.setUniforms(g,!0);e=d.viewMatrix;l.vec3.set(V,e[12],e[13],e[14]);l.vec3.normalize(V,V);g.setUniform3fv("viewDirection",V);this.numOriginsRendered=this.numTrianglesRendered=this.numTilesCulled=this.numTilesRendered=
0;this._prepareScaleRangeQueries();this.isOpaque()?this._renderTiles(a,g,b):a.offscreenRenderingHelper.renderToTargets(function(){return c._renderTiles(a,g,b)},a.offscreenRenderingHelper.tmpColor,a.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._processScaleRangeQueries();0<this.numTilesRendered&&!this._loaded&&(this._loaded=!0,this.loaded&&this.loaded())};a.prototype._renderDepthPass=function(a,b,c){var d=a.camera;a.rctx.bindProgram(b);b.setUniformMatrix4fv("model",N);b.setUniformMatrix4fv("viewNormal",
d.viewInverseTransposeMatrix);L[0]=d.near;L[1]=d.far;b.setUniform2fv("nearFar",L);this._renderTilesAuxiliary(a,b,c,!1)};a.prototype._renderNormalPass=function(a,b){var c=a.camera,d=this.programs.normal;a.rctx.bindProgram(d);d.setUniformMatrix4fv("viewNormal",c.viewInverseTransposeMatrix);this._renderTilesAuxiliary(a,d,b,!1)};a.prototype._renderHighlightPass=function(a,b){var c=a.rctx,d=this.programs.highlight;c.bindProgram(d);var e=a.offscreenRenderingHelper;c.bindTexture(e.depthTexture,3);d.setUniform1i("depthTex",
3);d.setUniform4f("highlightViewportPixelSz",0,0,1/e.width,1/e.height);this._renderTilesAuxiliary(a,d,b,!0)};a.prototype._updatePerOriginTileData=function(){var a=this,b=this.perOriginTileData;if(!this.perOriginTileDataDirty)return b;this._highestVisibleLODTile=null;b.clear();this._renderCollectOrigins(b);if(this._renderOrder!==w.RenderOrder.NONE){for(var c=0;c<b.length;c++)A.sortTiles(this._renderOrder,b.data[c].tiles);b.sort(function(b,c){var d=a._renderOrder;b=0===b.tiles.length?-d:0===c.tiles.length?
d:A.compareTiles(b.tiles.data[0],c.tiles.data[0],d);return b})}this.perOriginTileDataDirty=!1;return b};a.prototype._renderCollectOrigins=function(a){var b=this.rootTiles,c="spherical"===this.manifold;a.clear();for(var d=0;d<b.length;d++){var e=b[d],f=a.pushNew();f.root=e;f.origin=c?P:e.centerAtSeaLevel;f.tiles.clear();this._renderCollectOriginsForRoot(a,f)}};a.prototype._renderCollectOriginsForRoot=function(a,b){var c=this.tileIterator;c.resetOne(b.root);var d=this.perOriginTileDataMap;d.clear();
for(d.set(b.origin,b);!c.done;){b=c.next();var e=b.renderData;if(e&&!b.visible)this.numTilesCulled++,c.skipSubtree();else{if(0===b.lij[0]%7){var f=a.pushNew();f.root=b;f.origin=b.centerAtSeaLevel;d.set(b.centerAtSeaLevel,f);f.tiles.clear()}if(e){(e=d.get(b.renderData.localOrigin))&&e.tiles.push(b);if(!this._highestVisibleLODTile||b.vlevel>this._highestVisibleLODTile.vlevel)this._highestVisibleLODTile=b;c.skipSubtree()}}}};a.prototype._scaleQueriesForTile=function(a){var b=a.extent;a=a.lij[0];for(var c=
0;c<this.visibleScaleRangeQueriesInvPtr;){var d=this.visibleScaleRangeQueries.data[c],e=d.extent;a>=d.minLevel&&a<=d.maxLevel&&e[0]<=b[2]&&e[2]>=b[0]&&e[1]<=b[3]&&e[3]>=b[1]?(this.visibleScaleRangeQueries.swapElements(c,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):c++}};a.prototype._tileIntersectsStencilEnabledLayer=function(a){for(var b=this.stencilEnabledLayerExtents,c=0;c<b.length;c++)if(a.intersectsExtent(b[c]))return!0;return!1};a.prototype._renderTilesAuxiliary=
function(a,b,c,d){var e=a.rctx,f=a.camera;a=f.viewMatrix;e.setPipelineState(this.defaultPipelineState);var g=0<this.stencilEnabledLayerExtents.length;b.setUniformMatrix4fv("proj",f.projectionMatrix);b.setUniform1f("skirtScale",this._skirtScale);d&&(b.setUniform1i("overlay0Tex",1),b.setUniform1i("overlay1Tex",2));for(f=0;f<c.length;f++){var h=c.data[f];b.setUniform3fv("origin",h.origin);D.bindView(h.origin,a,b);for(var l=0;l<h.tiles.length;l++){var k=h.tiles.data[l],m=k.renderData;d&&(this._bindOverlayTextures(b,
m.overlays,!0),b.setUniform1f("overlayOpacity",m.overlayOpacity));g&&e.setPipelineState(this._tileIntersectsStencilEnabledLayer(k)?this.stencilPipelineState:this.defaultPipelineState);e.bindVAO(m.vao);M.assertCompatibleVertexAttributeLocations(m.vao,b);e.drawElements(4,0===this._skirtScale?m.geometryInfo.numWithoutSkirtIndices:m.vao.indexBuffer.size,m.vao.indexBuffer.indexType,0)}}e.bindVAO(null)};a.prototype._renderTiles=function(a,b,c){var d=a.rctx,f=a.camera,g=f.viewMatrix;d.setPipelineState(this.defaultPipelineState);
if(this.debugScreenSizePerspective&&this.pointsOfInterest){var h=E.getSettings("spherical"===this.manifold?"global":"local");h.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:f.fovY});D.bindScreenSizePerspective(h,b,"screenSizePerspective")}f=0<this.stencilEnabledLayerExtents.length;b.setUniform1f("skirtScale",this._skirtScale);for(h=0;h<c.length;h++){var l=c.data[h],k=l.tiles;if(0!==k.length){b.setUniform3fv("origin",l.origin);D.bindView(l.origin,g,b);var m=a.sliceHelper&&
a.sliceHelper.plane;m&&D.bindSlicePlane(l.origin,m,b);a.shadowMap&&a.shadowMap.bindView(b,l.origin);this.numOriginsRendered++;var l="debug"===this.wireframe.mode?1:4,p=this._highestVisibleLODTile,n=m=void 0;p?(m=p.vlevel,n=this.tileSize/this.wireframe.resolution):(m=16,n=this.tileSize/64);for(p=0;p<k.length;p++){var r=k.data[p],q=r.renderData;f&&d.setPipelineState(this._tileIntersectsStencilEnabledLayer(r)?this.stencilPipelineState:this.defaultPipelineState);F.trace("# RENDER TILE "+A.tile2str(r)+
", screenDepth:"+r.screenDepth);var t=q.geometryInfo.uvOffsetAndScale,u=q.texOffsetAndScale;e.vec4.set(U,t[0]*u[2]+u[0],t[1]*u[3]+u[1],t[2]*u[2],t[3]*u[3]);b.setUniform4fv("texOffsetAndScale",U);d.bindTexture(q.textureReference,0);b.setUniform1f("opacity",q.opacity);this._bindOverlayTextures(b,q.overlays,!1);b.setUniform1f("overlayOpacity",q.overlayOpacity);("shader"===this.wireframe.mode||this._drawBorders)&&b.setUniform1f("wireframe.subdivision",n*(1<<m-r.vlevel));t=0===this._skirtScale?q.geometryInfo.numWithoutSkirtIndices:
q.vao.indexBuffer.size;d.bindVAO(q.vao);M.assertCompatibleVertexAttributeLocations(q.vao,b);d.drawElements(l,t,q.vao.indexBuffer.indexType,0);r.renderOrder=this.numTilesRendered;this.numTilesRendered++;this.numTrianglesRendered+=t/3;this._scaleQueriesForTile(r)}}}d.bindVAO(null)};a.prototype._bindOverlayTextures=function(a,b,c){for(var d=0;2>d;d++){var e=2*d,f=b[d],g=c?f.highlightRenderTargetId:f.renderTargetId;g?(g=this.drapedRenderer.getRenderTargetTexture(g),R[e]=f.texOffset[0],R[e+1]=f.texOffset[1],
J[e]=f.texScale[0],J[e+1]=f.texScale[1],this.rctx.bindTexture(g,1+d)):(R[e]=0,R[e+1]=0,J[e]=0,J[e+1]=0,this.rctx.bindTexture(this.emptyTex,1+d))}a.setUniform4fv("overlayTexOffset",R);a.setUniform4fv("overlayTexScale",J)};a.prototype.releaseTileGeometry=function(a){a.releaseGeometry()&&this.setNeedsRender();this.renderDataPool.release(a)};a.prototype._prepareScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryQueue;a.length<a.data.length&&0<b.length;){var c=
b.pop();a.push(c)}this.visibleScaleRangeQueriesInvPtr=a.length};a.prototype._processScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryPool,c=0;c<a.length;c++){var d=a.data[c];b.release(d);d.callback(c>=this.visibleScaleRangeQueriesInvPtr);d.callback=null}a.clear()};return a}();var I={mode:"none",width:1.5,falloff:1.5,wireOpacity:1,surfaceOpacity:0,color:[1,1,1,0],resolution:64},V=g.vec3f64.create(),X=g.vec3f64.create(),W=g.vec3f64.create(),ca=g.vec3f64.create(),
da=g.vec3f64.create(),ba="TerrainRenderer",aa={type:"external"};return q})},"esri/views/3d/terrain/ResourceCounter":function(){define(["require","exports"],function(q,b){return function(){function b(){this._numTileTexturesComposited=0}Object.defineProperty(b.prototype,"numTileTexturesComposited",{get:function(){return this._numTileTexturesComposited},enumerable:!0,configurable:!0});b.prototype.incrementNumTileTexturesComposited=function(){this._numTileTexturesComposited++};b.prototype.resetNumTileTexturesComposited=
function(){this._numTileTexturesComposited=0};return b}()})},"esri/views/3d/terrain/TileRenderData":function(){define("require exports ../../../core/arrayUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec2f64 ../../../core/libs/gl-matrix-2/vec4 ../../../core/libs/gl-matrix-2/vec4f64 ../../../geometry/support/aaBoundingBox ../support/mathUtils ./TerrainConst ./TileGeometryFactory ./tileUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t){Object.defineProperty(b,"__esModule",{value:!0});q=function(){function b(){this.overlayTexOffset=k.vec2f64.create();this.texOffsetAndScale=h.vec4f64.create();this.geometryInfo={indices:null,vertexAttributes:null,boundingBox:m.empty(),numSurfaceIndices:0,numSkirtIndices:0,numWithoutSkirtIndices:0,numVertsPerRow:0,skirtLength:0,uvOffsetAndScale:h.vec4f64.create()}}b.prototype.init=function(a){this.tile=a;a=this.geometryInfo;a.indices=null;a.vertexAttributes=
null;m.empty(a.boundingBox);a.numSurfaceIndices=0;a.numSkirtIndices=0;a.numWithoutSkirtIndices=0;a.numVertsPerRow=0;this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1};this.textureReference=this._texture=this._vao=null;d.vec4.set(this.texOffsetAndScale,0,0,1,1);this.opacity=1;if(this.overlays){a=0;for(var b=this.overlays;a<b.length;a++){var c=b[a];c.renderTargetId=null;c.highlightRenderTargetId=null;f.vec2.set(c.texScale,1,1);f.vec2.set(c.texOffset,0,0)}}else for(this.overlays=
[null,null],a=0;2>a;a++)this.overlays[a]={renderTargetId:null,highlightRenderTargetId:null,texScale:[1,1],texOffset:[0,0]};this.overlayOpacity=1;this.localOrigin=null};b.prototype.updateGeometry=function(a,b){if(!this._updateGeometryState(b))return!1;this._releaseGeometry();this._createGeometry(a,b);return!0};b.prototype.releaseGeometry=function(){return this._releaseGeometry()?(this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1},!0):!1};b.prototype.ensureTexture=
function(a,b){this._texture&&this._texture.descriptor.width!==b&&this.releaseTexture();this._texture||(this._texture=a(b),this.tile.updateMemoryUsed());return this._texture};b.prototype.releaseTexture=function(){this._texture&&(this._texture.dispose(),this._texture=null);this.textureReference=null};b.prototype._updateGeometryState=function(a){var b=this._getElevationInfo(),d=this.tile.lij[0],e=8>d?this.tile.numSubdivisionsAtLevel[d]+1:2;b.samplerData&&(e=this.tile.maxTesselation,e=p.clamp((e>>Math.max(d-
b.maxTileLevel,c.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-d)))+1,2,e+1));d=this.tile.clippingArea;if(!this.tile.intersectsClippingArea||this.tile.isWithinClippingArea)d=null;var f=this.geometryState,g=!1;f.numVertsPerRow!==e&&(f.numVertsPerRow=e,g=!0);b.changed&&(f.samplerData=b.samplerData,g=!0);n.equals(f.clippingArea,d)||(f.clippingArea=d,g=!0);f.wireframe!==a&&(f.wireframe=a,g=!0);return g};b.prototype._createGeometry=function(a,b){this.tile.createGeometry(this.geometryState,this.localOrigin,
b);b=this.geometryInfo.indices;var c=a.gl;this._vao=new t(a,g.Default3D,{geometry:e.Pos3Tex},{geometry:u.createVertex(a,c.STATIC_DRAW,this.geometryInfo.vertexAttributes)},u.createIndex(a,c.STATIC_DRAW,b))};b.prototype._releaseGeometry=function(){if(!this._vao)return!1;this._vao.dispose();this._vao=null;a.releaseGeometry(this.geometryInfo);return!0};Object.defineProperty(b.prototype,"vao",{get:function(){return this._vao},enumerable:!0,configurable:!0});b.prototype._getElevationInfo=function(){for(var a=
this.geometryState.samplerData,b=this.tile.layerInfo[c.LayerClass.ELEVATION],d=b.length,e=Array(d),f=0,g=0,h=!1,k=0;k<d;k++){var m=b[k];if(m.upsampleFromTile){var m=m.upsampleFromTile.tile,p=m.layerInfo[c.LayerClass.ELEVATION][k].data,p=p.samplerData;a&&a[f]===p||(h=!0);e[f++]=p;g=Math.max(g,m.lij[0])}else m.data&&(p=this.tile.surface.layerViewByIndex(k,c.LayerClass.ELEVATION),l.fallsWithinLayer(this.tile,p.layer,!1)&&(p=m.data,a&&a[f]===p.samplerData||(h=!0),e[f++]=p.samplerData,g=this.tile.lij[0]))}a&&
a.length!==f&&(h=!0);0<f?e.length=f:e=null;return{changed:h,samplerData:e,maxTileLevel:g}};Object.defineProperty(b.prototype,"estimatedGeometryMemoryUsage",{get:function(){return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"textureDescriptor",{get:function(){return this._texture?this._texture.descriptor:null},enumerable:!0,configurable:!0});return b}();b.TileRenderData=q})},"esri/views/3d/terrain/TileRenderer":function(){define("require exports ../../../core/mathUtils ../../../core/libs/gl-matrix-2/vec2 ../../../core/libs/gl-matrix-2/vec4 ./TerrainConst ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../webgl-engine/shaders/MiscPrograms ../../vectorTiles/tileRendererHelper3D ../../vectorTiles/VectorTileDisplayObject ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/renderState ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y){function w(a){var b=n.nextHighestPowerOfTwo(a),c=b*b,d=a*a;if(c===d)return a;a=b/2;return c-d<d-a*a?b:a}var x=Array(20),v=[0,0],z={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIdx:0};return function(){function b(a,b,d,e,f){this._blackTex=this._backgroundTex=null;this.tileSize=256;this._context=a;this.tileSize=b;this._resourceCounter=e;this._setNeedsRender=f;a.capabilities.textureFilterAnisotropic&&(this._maxAnisotropy=Math.min(8,
a.parameters.maxMaxAnisotropy));b=new Float32Array(20);b[0]=-1;b[1]=-1;b[2]=0;b[3]=0;b[4]=0;b[5]=1;b[6]=-1;b[7]=0;b[8]=1;b[9]=0;b[10]=-1;b[11]=1;b[12]=0;b[13]=0;b[14]=1;b[15]=1;b[16]=1;b[17]=0;b[18]=1;b[19]=1;this._vaoQuad=new y(a,h.Default3D,{geometry:m.Pos3Tex},{geometry:g.createVertex(a,35044,b)});this._blendLayersProgram=d.getProgram(c.blendLayers);this._blendLayersPipelineState=u.makePipelineState({blending:u.simpleBlendingParams(1,771),colorWrite:u.defaultColorWriteParams});this._applyOpacityPipelineState=
u.makePipelineState({blending:u.simpleBlendingParams(0,770),colorWrite:u.defaultColorWriteParams});this._blackTex=p.createColorTexture(this._context,[0,0,0,1])}b.prototype.dispose=function(){this._fbo&&(this._fbo.dispose(),this._fbo=null);this._vtFBO&&(this._vtFBO.dispose(),this._vtFBO=null);this._vaoQuad&&(this._vaoQuad.dispose(),this._vaoQuad=null);this._backgroundTex&&(this._backgroundTex.dispose(),this._backgroundTex=null);this._blackTex&&(this._blackTex.dispose(),this._blackTex=null);this._blendLayersProgram&&
(this._blendLayersProgram.dispose(),this._blendLayersProgram=null);this._context=null};b.prototype.updateTileTexture=function(a){for(var b=d.LayerClass.MAP,c=a.layerInfo[b],e=0;e<c.length;e++)c[e].pendingUpdates&=~d.TileUpdate.TEXTURE;if(a.renderData){var e=a.renderData,f=a.surface,g=f.baseOpacity,h=0,m=1,p=!1,n,r=c.length;for(n=0;n<c.length&&!p;n++){var q=f.layerViewByIndex(n,b),t=q.fullOpacity;x[n]=t;this._isBaseLayer(q.layer)&&r>=c.length&&(r=n);if(0!==t){var u=this._getTileRenderInfo(a,n,z);u&&
(u&&u.sourceLayerInfo&&u.sourceLayerInfo.data instanceof l&&(m=q.view.pixelRatio),h++,q.isOpaque&&1===g&&1===t&&(p=!0))}}b=n-1;0===h&&this._backgroundTex?(e.opacity=g,e.textureReference=this._backgroundTex,k.vec4.set(e.texOffsetAndScale,0,0,1,1)):1===h&&p?(e.opacity=g,u=this._getTileRenderInfo(a,b,z),a=w(this.tileSize*m),this._dataToTexture(this._context,u,a,a/this.tileSize)&&(e.textureReference=u.sourceLayerInfo.data,k.vec4.set(e.texOffsetAndScale,u.offset[0],u.offset[1],u.scale,u.scale))):(this._composeMapLayers(a,
b,r,p,x,m),k.vec4.set(e.texOffsetAndScale,0,0,1,1));this._setNeedsRender()}};b.prototype.setBackground=function(a){this._backgroundTex=a instanceof HTMLImageElement?this._buildTexture(a):p.createColorTexture(this._context,a||[0,0,0,0])};b.prototype._buildTexture=function(a){var b={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},c=this._context,d;if("number"===typeof a)b.width=b.height=a,d=new t(c,b);else try{d=
new t(c,b,a)}catch(H){d=p.createEmptyTexture(c),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}c.bindTexture(d);d.generateMipmap();return d};b.prototype._bindFBO=function(a,b,c,d){a&&a.width===b&&a.height===c||(a&&a.dispose(),a=e.create(this._context,{colorTarget:0,depthStencilTarget:d?1:0,width:b,height:c}));this._context.bindFramebuffer(a);return a};b.prototype._drawRasterData=function(a,b,c,d){void 0===d&&(d=1);var e=this._context,f=this._blendLayersProgram,
g=this._vaoQuad;e.bindProgram(f);e.bindVAO(g);r.assertCompatibleVertexAttributeLocations(g,f);e.bindTexture(a,0);f.setUniform1i("tex",0);f.setUniform1f("scale",b);f.setUniform2f("offset",c[0],c[1]);f.setUniform1f("opacity",d);e.drawArrays(5,0,r.vertexCount(g,"geometry"))};b.prototype._composeMapLayers=function(a,b,c,d,e,f){var g=this;f=w(this.tileSize*f);var h=a.renderData.ensureTexture(function(a){return g._buildTexture(a)},f),l=this._context,k=f/this.tileSize;this._fbo=this._bindFBO(this._fbo,h.descriptor.width,
h.descriptor.height,!1);l.setViewport(0,0,f,f);l.setClearColor(0,0,0,0);l.setClearDepth(1);l.clearSafe(16384);!d&&this._backgroundTex&&(l.setPipelineState(this._blendLayersPipelineState),this._drawRasterData(this._backgroundTex,1,v));d=a.surface.baseOpacity;for(var m=!1;0<=b;b--){var p=this._getTileRenderInfo(a,b,z);p&&(b<c&&1>d&&!m&&(l.setPipelineState(this._applyOpacityPipelineState),this._drawRasterData(this._blackTex,1,v,d),m=!0),0!==e[b]&&this._dataToTexture(l,p,f,k)&&(l.setPipelineState(this._blendLayersPipelineState),
this._drawRasterData(p.sourceLayerInfo.data,p.scale,p.offset,e[b])))}l.bindTexture(h);l.gl.copyTexImage2D(l.gl.TEXTURE_2D,0,h.descriptor.pixelFormat,0,0,h.descriptor.width,h.descriptor.height,0);h.generateMipmap();l.bindFramebuffer(null);this._resourceCounter.incrementNumTileTexturesComposited();a.renderData.opacity=m?1:d;a.renderData.textureReference=h};b.prototype._dataToTexture=function(a,b,c,d){b&&b.sourceLayerInfo&&b.sourceLayerInfo.data instanceof l&&(this._vectorDataToTexture(a,b,c,d),b.tile.updateMemoryUsed());
a=b&&b.sourceLayerInfo&&b.sourceLayerInfo.data;if(a instanceof HTMLImageElement||a instanceof HTMLCanvasElement)this._rasterDataToTexture(b),b.tile.updateMemoryUsed();return b&&b.sourceLayerInfo&&b.sourceLayerInfo.data instanceof t};b.prototype._rasterDataToTexture=function(a){a=a.sourceLayerInfo;a.data=this._buildTexture(a.data)};b.prototype._vectorDataToTexture=function(b,c,e,f){var g=c.tile.surface.layerViewByIndex(c.layerIdx,d.LayerClass.MAP);this._vtFBO=this._bindFBO(this._vtFBO,e,e,!0);b.setClearColor(1,
1,1,0);b.clearSafe(16640);var h=c.sourceLayerInfo,l=h.data;a.renderVectorTile(this._context,c.sourceLod,l,g.renderer,g.schemaHelper,this.tileSize,this.tileSize,f);l.dispose();h.data=this._buildTexture(e);b.bindTexture(h.data);b.gl.copyTexImage2D(b.gl.TEXTURE_2D,0,h.data.descriptor.pixelFormat,0,0,e,e,0);h.data.generateMipmap();b.bindFramebuffer(this._fbo)};b.prototype._getTileRenderInfo=function(a,b,c){var e=a.layerInfo[d.LayerClass.MAP][b];c.layerIdx=b;if(e.data)return f.vec2.set(c.offset,0,0),c.tile=
a,c.scale=1,c.sourceLod=a.lij,c.sourceLayerInfo=e,c;if(!e.upsampleFromTile)return null;a=e.upsampleFromTile;b=a.tile.layerInfo[d.LayerClass.MAP][b];c.tile=a.tile;f.vec2.copy(c.offset,a.offset);c.scale=a.scale;c.sourceLod=a.tile.lij;c.sourceLayerInfo=b;return c};b.prototype._isBaseLayer=function(a){return a.parent&&"esri.Basemap"===a.parent.declaredClass&&-1<a.parent.baseLayers.indexOf(a)};return b}()})},"esri/views/vectorTiles/tileRendererHelper3D":function(){define("require exports ../../geometry ../../Viewpoint ../../core/has ../../core/libs/gl-matrix-2/mat4 ../2d/ViewState ../webgl/renderState".split(" "),
function(q,b,n,f,k,d,h,m){Object.defineProperty(b,"__esModule",{value:!0});b.renderVectorTile=function(b,f,e,h,m,n,q,w){if(n!==q)throw Error("It is expected that tiles are square!");var g=m.adjustLevel(f[0]);w={context:b,drawPhase:0,state:p,stationary:!0,pixelRatio:w,displayLevel:g,requiredLevel:g,drawphase:0,renderer:h,layerOpacity:1,globalOpacity:1};h.initializeProgramCache(b);g=m.getScale(f[0]);m=m.getShift(f,g);var l=m[1];e.tileTransform.displayCoord[0]=-1-m[0];e.tileTransform.displayCoord[1]=
1+l;m=e.tileTransform.transform;d.mat4.identity(m);g=.25*g/n;m[0]=g;m[5]=-g;w.state.size=[n,q];h.setStateParams(w.state,w.pixelRatio,f[0]);e.attachWithContext(b);b.setPipelineState(c);e.processRender(w);b.setPipelineState(a);w.drawphase=1;e.processRender(w);w.drawphase=2;e.processRender(w);k("esri-vector-tiles-debug")&&h.renderTileInfo(b,e)};var p=new h({viewpoint:new f({targetGeometry:new n.Point(0,0),scale:1,rotation:0}),size:[256,256]}),c=m.makePipelineState({depthTest:{func:515},depthWrite:m.defaultDepthWriteParams,
colorWrite:m.defaultColorWriteParams}),a=m.makePipelineState({blending:m.simpleBlendingParams(1,771),depthTest:{func:515},colorWrite:m.defaultColorWriteParams})})},"esri/views/2d/ViewState":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators ../../core/libs/gl-matrix-2/common ../../core/libs/gl-matrix-2/mat2d ../../core/libs/gl-matrix-2/mat2df32 ../../core/libs/gl-matrix-2/mat2df64 ../../core/libs/gl-matrix-2/mat3 ../../core/libs/gl-matrix-2/mat3f32 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f32 ../../core/libs/gl-matrix-2/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ./viewpointUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w){var x=[0,0];return function(b){function h(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];c=b.apply(this,c)||this;c._viewpoint2D={center:r.vec2f64.create(),rotation:0,scale:0,spatialReference:null};c.center=[0,0];c.extent=new k.Extent;c.id=0;c.inverseTransform=l.mat2df64.create();c.resolution=0;c.rotation=0;c.scale=0;c.transform=l.mat2df64.create();c.transformNoRotation=l.mat2df64.create();c.displayMat3=e.mat3f32.create();c.displayViewMat3=
e.mat3f32.create();c.viewMat3=e.mat3f32.create();c.viewMat2d=a.mat2df32.create();c.worldScreenWidth=0;c.size=[0,0];return c}n(h,b);q=h;Object.defineProperty(h.prototype,"pixelRatio",{set:function(a){this._set("pixelRatio",a);this._update()},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"size",{set:function(a){this._set("size",a);this._update()},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"viewpoint",{set:function(a){if(a){var b=this._viewpoint2D,c=a.targetGeometry;
b.center[0]=c.x;b.center[1]=c.y;b.rotation=a.rotation;b.scale=a.scale;b.spatialReference=c.spatialReference}this._update()},enumerable:!0,configurable:!0});h.prototype.copy=function(a){var b=this.size,c=this.viewpoint;c&&b?(this.viewpoint=w.copy(c,a.viewpoint),this._set("size",u.vec2.copy(b,a.size))):(this.viewpoint=a.viewpoint.clone(),this._set("size",[a.size[0],a.size[1]]));this._set("pixelRatio",a.pixelRatio);return this};h.prototype.clone=function(){return new q({size:this.size,viewpoint:this.viewpoint.clone(),
pixelRatio:this.pixelRatio})};h.prototype.toMap=function(a,b,c){if(y.isVec2(b))return u.vec2.transformMat2d(a,b,this.inverseTransform);x[0]=b;x[1]=c;return u.vec2.transformMat2d(a,x,this.inverseTransform)};h.prototype.toScreen=function(a,b,c){if(y.isVec2(b))return u.vec2.transformMat2d(a,b,this.transform);x[0]=b;x[1]=c;return u.vec2.transformMat2d(a,x,this.transform)};h.prototype.toScreenNoRotation=function(a,b,c){if(y.isVec2(b))return u.vec2.transformMat2d(a,b,this.transformNoRotation);x[0]=b;x[1]=
c;return u.vec2.transformMat2d(a,x,this.transformNoRotation)};h.prototype.pixelSizeAt=function(a){return w.pixelSizeAt(a,this.viewpoint,this.size)};h.prototype.getScreenTransform=function(a,b){var c=this._viewpoint2D.center,d=this._get("pixelRatio")||1,e=this._get("size");w.getMatrix(a,c,e,b,0,d);return a};h.prototype._update=function(){var a=this._viewpoint2D,b=a.center,e=a.spatialReference,f=a.scale,h=a.rotation,a=this._get("pixelRatio")||1,l=this._get("size");this._set("id",this.id+1);var m=new d({targetGeometry:new k.Point(b[0],
b[1],e),scale:f,rotation:h});this._set("viewpoint",m);if(l&&e&&f)return this.resolution=w.getResolution(m),this.rotation=h,this.scale=f,this.spatialReference=e,u.vec2.copy(this.center,b),g.mat3.set(this.displayMat3,0!==l[0]?2/l[0]:0,0,0,0,0!==l[1]?-2/l[1]:0,0,-1,1,1),f=g.mat3.identity(this.viewMat3),b=t.vec2f32.fromValues(l[0]/2,l[1]/2),e=t.vec2f32.fromValues(-l[0]/2,-l[1]/2),h=p.common.toRadian(h),g.mat3.translate(f,f,b),g.mat3.rotate(f,f,h),g.mat3.translate(f,f,e),g.mat3.multiply(this.displayViewMat3,
this.displayMat3,f),f=c.mat2d.identity(this.viewMat2d),c.mat2d.translate(f,f,b),c.mat2d.rotate(f,f,h),c.mat2d.translate(f,f,e),w.getExtent(this.extent,m,l),w.getTransform(this.transform,m,l,a),c.mat2d.invert(this.inverseTransform,this.transform),w.getTransformNoRotation(this.transformNoRotation,m,l,a),this.worldScreenWidth=w.getWorldScreenWidth(this.spatialReference,this.resolution),this};var q;f([m.property({readOnly:!0})],h.prototype,"id",void 0);f([m.property({value:1,json:{write:!0}})],h.prototype,
"pixelRatio",null);f([m.property({json:{write:!0}})],h.prototype,"size",null);f([m.property({type:d,json:{write:!0}})],h.prototype,"viewpoint",null);return h=q=f([m.subclass("esri.views.2d.ViewState")],h)}(m.declared(h))})},"esri/core/libs/gl-matrix-2/common":function(){define(["require","exports","./math/common"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.common=n})},"esri/core/libs/gl-matrix-2/mat2d":function(){define(["require","exports","./math/mat2d"],function(q,b,n){Object.defineProperty(b,
"__esModule",{value:!0});b.mat2d=n})},"esri/core/libs/gl-matrix-2/math/mat2d":function(){define(["require","exports","./common"],function(q,b,n){function f(b,f,k){var d=f[0],c=f[1],a=f[2],h=f[3],g=f[4];f=f[5];var e=k[0],m=k[1],n=k[2],r=k[3],q=k[4];k=k[5];b[0]=d*e+a*m;b[1]=c*e+h*m;b[2]=d*n+a*r;b[3]=c*n+h*r;b[4]=d*q+a*k+g;b[5]=c*q+h*k+f;return b}function k(b,f,k){b[0]=f[0]-k[0];b[1]=f[1]-k[1];b[2]=f[2]-k[2];b[3]=f[3]-k[3];b[4]=f[4]-k[4];b[5]=f[5]-k[5];return b}Object.defineProperty(b,"__esModule",{value:!0});
b.copy=function(b,f){b[0]=f[0];b[1]=f[1];b[2]=f[2];b[3]=f[3];b[4]=f[4];b[5]=f[5];return b};b.identity=function(b){b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=0;b[5]=0;return b};b.set=function(b,f,k,p,c,a,l){b[0]=f;b[1]=k;b[2]=p;b[3]=c;b[4]=a;b[5]=l;return b};b.invert=function(b,f){var d=f[0],h=f[1],c=f[2],a=f[3],l=f[4];f=f[5];var g=d*a-h*c;if(!g)return null;g=1/g;b[0]=a*g;b[1]=-h*g;b[2]=-c*g;b[3]=d*g;b[4]=(c*f-a*l)*g;b[5]=(h*l-d*f)*g;return b};b.determinant=function(b){return b[0]*b[3]-b[1]*b[2]};b.multiply=
f;b.rotate=function(b,f,k){var d=f[0],c=f[1],a=f[2],h=f[3],g=f[4];f=f[5];var e=Math.sin(k);k=Math.cos(k);b[0]=d*k+a*e;b[1]=c*k+h*e;b[2]=d*-e+a*k;b[3]=c*-e+h*k;b[4]=g;b[5]=f;return b};b.scale=function(b,f,k){var d=f[1],c=f[2],a=f[3],h=f[4],g=f[5],e=k[0];k=k[1];b[0]=f[0]*e;b[1]=d*e;b[2]=c*k;b[3]=a*k;b[4]=h;b[5]=g;return b};b.translate=function(b,f,k){var d=f[0],c=f[1],a=f[2],h=f[3],g=f[4];f=f[5];var e=k[0];k=k[1];b[0]=d;b[1]=c;b[2]=a;b[3]=h;b[4]=d*e+a*k+g;b[5]=c*e+h*k+f;return b};b.fromRotation=function(b,
f){var d=Math.sin(f);f=Math.cos(f);b[0]=f;b[1]=d;b[2]=-d;b[3]=f;b[4]=0;b[5]=0;return b};b.fromScaling=function(b,f){b[0]=f[0];b[1]=0;b[2]=0;b[3]=f[1];b[4]=0;b[5]=0;return b};b.fromTranslation=function(b,f){b[0]=1;b[1]=0;b[2]=0;b[3]=1;b[4]=f[0];b[5]=f[1];return b};b.str=function(b){return"mat2d("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+", "+b[4]+", "+b[5]+")"};b.frob=function(b){return Math.sqrt(Math.pow(b[0],2)+Math.pow(b[1],2)+Math.pow(b[2],2)+Math.pow(b[3],2)+Math.pow(b[4],2)+Math.pow(b[5],2)+1)};b.add=
function(b,f,k){b[0]=f[0]+k[0];b[1]=f[1]+k[1];b[2]=f[2]+k[2];b[3]=f[3]+k[3];b[4]=f[4]+k[4];b[5]=f[5]+k[5];return b};b.subtract=k;b.multiplyScalar=function(b,f,k){b[0]=f[0]*k;b[1]=f[1]*k;b[2]=f[2]*k;b[3]=f[3]*k;b[4]=f[4]*k;b[5]=f[5]*k;return b};b.multiplyScalarAndAdd=function(b,f,k,p){b[0]=f[0]+k[0]*p;b[1]=f[1]+k[1]*p;b[2]=f[2]+k[2]*p;b[3]=f[3]+k[3]*p;b[4]=f[4]+k[4]*p;b[5]=f[5]+k[5]*p;return b};b.exactEquals=function(b,f){return b[0]===f[0]&&b[1]===f[1]&&b[2]===f[2]&&b[3]===f[3]&&b[4]===f[4]&&b[5]===
f[5]};b.equals=function(b,f){var d=b[0],h=b[1],c=b[2],a=b[3],l=b[4];b=b[5];var g=f[0],e=f[1],k=f[2],q=f[3],r=f[4];f=f[5];return Math.abs(d-g)<=n.EPSILON*Math.max(1,Math.abs(d),Math.abs(g))&&Math.abs(h-e)<=n.EPSILON*Math.max(1,Math.abs(h),Math.abs(e))&&Math.abs(c-k)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(a-q)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(q))&&Math.abs(l-r)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(r))&&Math.abs(b-f)<=n.EPSILON*Math.max(1,Math.abs(b),Math.abs(f))};b.mul=
f;b.sub=k})},"esri/core/libs/gl-matrix-2/mat2df32":function(){define(["require","exports","./factories/mat2df32"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.mat2df32=n})},"esri/core/libs/gl-matrix-2/factories/mat2df32":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var b=new Float32Array(6);b[0]=1;b[3]=1;return b};b.clone=function(b){var f=new Float32Array(6);f[0]=b[0];f[1]=b[1];f[2]=b[2];f[3]=b[3];
f[4]=b[4];f[5]=b[5];return f};b.fromValues=function(b,f,k,d,h,m){var p=new Float32Array(6);p[0]=b;p[1]=f;p[2]=k;p[3]=d;p[4]=h;p[5]=m;return p};b.createView=function(b,f){return new Float32Array(b,f,6)}})},"esri/core/libs/gl-matrix-2/mat2df64":function(){define(["require","exports","./factories/mat2df64"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.mat2df64=n})},"esri/core/libs/gl-matrix-2/factories/mat2df64":function(){define(["require","exports"],function(q,b){Object.defineProperty(b,
"__esModule",{value:!0});b.create=function(){return[1,0,0,1,0,0]};b.clone=function(b){return[b[0],b[1],b[2],b[3],b[4],b[5]]};b.fromValues=function(b,f,k,d,h,m){return[b,f,k,d,h,m]};b.createView=function(b,f){return new Float64Array(b,f,6)}})},"esri/core/libs/gl-matrix-2/mat3f32":function(){define(["require","exports","./factories/mat3f32"],function(q,b,n){Object.defineProperty(b,"__esModule",{value:!0});b.mat3f32=n})},"esri/core/libs/gl-matrix-2/factories/mat3f32":function(){define(["require","exports"],
function(q,b){Object.defineProperty(b,"__esModule",{value:!0});b.create=function(){var b=new Float32Array(9);b[0]=1;b[4]=1;b[8]=1;return b};b.clone=function(b){var f=new Float32Array(9);f[0]=b[0];f[1]=b[1];f[2]=b[2];f[3]=b[3];f[4]=b[4];f[5]=b[5];f[6]=b[6];f[7]=b[7];f[8]=b[8];return f};b.fromValues=function(b,f,k,d,h,m,p,c,a){var l=new Float32Array(9);l[0]=b;l[1]=f;l[2]=k;l[3]=d;l[4]=h;l[5]=m;l[6]=p;l[7]=c;l[8]=a;return l};b.createView=function(b,f){return new Float32Array(b,f,9)}})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["require",
"exports"],function(q,b){function n(b){return b instanceof Float32Array&&2<=b.length}function f(b){return Array.isArray(b)&&2<=b.length}Object.defineProperty(b,"__esModule",{value:!0});b.isVec2f32=n;b.isVec2f64=f;b.isVec2=function(b){return n(b)||f(b)}})},"esri/views/2d/viewpointUtils":function(){define("require exports ../../core/tsSupport/generatorHelper ../../core/tsSupport/awaiterHelper ../../Viewpoint ../../core/asyncUtils ../../core/promiseUtils ../../core/unitUtils ../../core/wgs84Constants ../../core/libs/gl-matrix-2/common ../../core/libs/gl-matrix-2/mat2d ../../core/libs/gl-matrix-2/mat2df64 ../../core/libs/gl-matrix-2/vec2 ../../core/libs/gl-matrix-2/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ../../geometry/support/webMercatorUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v){function z(a,b,d,e){return e&&d&&!e.equals(d)&&x.canProject(e,d)&&e.isWebMercator?(e.isWebMercator?(d=b[1],89.99999<d?d=89.99999:-89.99999>d&&(d=-89.99999),d=Math.sin(c.common.toRadian(d)),a=g.vec2.set(a,c.common.toRadian(b[0])*T,.5*T*Math.log((1+d)/(1-d)))):(d=c.common.toDegree(b[0]/T),a=g.vec2.set(a,d-360*Math.floor((d+180)/360),c.common.toDegree(.5*Math.PI-2*Math.atan(Math.exp(-1*b[1]/T))))),a):g.vec2.copy(a,b)}function A(a){return a.wkid?a:a.spatialReference||
y.WGS84}function B(a,b){return b.type?g.vec2.set(a,b.x,b.y):g.vec2.copy(a,b)}function C(a,b){return Math.max(a.width/b[0],a.height/b[1])*P(a.spatialReference)}function E(a,b,c,d){return f(this,void 0,void 0,function(){var e,f,g,l,k,m,p,q,w,y,v,z,A,B,C,J,D,F,I,H,G,U,Q,L,K,M,P,N;return n(this,function(n){switch(n.label){case 0:if(!a||Array.isArray(a)&&!a.length)return[2,null];if(!Array.isArray(a)||!a.length||"object"!==typeof a[0])return[3,7];f=a.every(function(a){return"attributes"in a});g=a.some(function(a){return!a.geometry});
l=a;if(!(f&&g&&b&&b.allLayerViews))return[3,2];k=new Map;m=0;for(p=a;m<p.length;m++)q=p[m],w=q.layer,y=k.get(w)||[],v=q.attributes[w.objectIdField],null!=v&&y.push(v),k.set(w,y);z=[];k.forEach(function(a,c){var d=b.allLayerViews.find(function(a){return a.layer.id===c.id});if("queryFeatures"in d){var e=c.createQuery();e.objectIds=a;e.returnGeometry=!0;z.push(d.queryFeatures(e))}});return[4,h.all(z)];case 1:A=n.sent();B=[];C=0;for(J=A;C<J.length;C++)if((D=J[C])&&D.features&&D.features.length)for(F=
0,I=D.features;F<I.length;F++)q=I[F],q.geometry&&B.push(q.geometry);l=B;n.label=2;case 2:H=0,G=l,n.label=3;case 3:if(!(H<G.length))return[3,6];U=G[H];return[4,E(U,b,c,d)];case 4:d=n.sent(),n.label=5;case 5:return H++,[3,3];case 6:return[2,d];case 7:if(!Array.isArray(a)||2!==a.length||"number"!==typeof a[0]||"number"!==typeof a[1])return[3,8];e=new r(a);return[3,12];case 8:if(!(a instanceof t))return[3,9];e=a;return[3,12];case 9:if(!("geometry"in a))return[3,12];if(!a.geometry)return[3,10];e=a.geometry;
return[3,12];case 10:if(!a.layer)return[3,12];Q=a.layer;L=b.allLayerViews.find(function(a){return a.layer.id===Q.id});if(!("queryFeatures"in L))return[3,12];K=Q.createQuery();K.objectIds=[a.attributes[Q.objectIdField]];K.returnGeometry=!0;return[4,L.queryFeatures(K)];case 11:e=(M=n.sent())&&M.features&&M.features[0]&&M.features[0].geometry,n.label=12;case 12:if(!e)return[2,null];P="point"===e.type?new u({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference}):e.extent;if(!P)return[2,
null];N=x.canProject(P,c);if(!P.spatialReference.equals(c)&&N)P=x.project(P,c);else if(!N)return[2,null];d=d?d.union(P):P.clone();return[2,d]}})})}function F(a){if(a&&(!Array.isArray(a)||"number"!==typeof a[0])&&("object"===typeof a||Array.isArray(a)&&"object"===typeof a[0])){if("layer"in a&&a.layer&&a.layer.minScale&&a.layer.maxScale){var b=a.layer;return{min:b.minScale,max:b.maxScale}}if(Array.isArray(a)&&a.length&&a.every(function(a){return"layer"in a})){for(var c=0,d=0,e=0;e<a.length;e++)(b=a[e].layer)&&
b.minScale&&b.maxScale&&(c=b.minScale<c?b.minScale:c,d=b.maxScale>d?b.maxScale:d);return c&&d?{min:c,max:d}:null}}}function H(a,b){return f(this,void 0,void 0,function(){var c,d,f,g,h,l,m,p,q,t,w,y,D,J,H,G;return n(this,function(n){switch(n.label){case 0:if(!a)return[2,new k({targetGeometry:new r,scale:0,rotation:0})];c=b.spatialReference;d=b.size;f=b.viewpoint;g=b.constraints;h=null;"esri.Viewpoint"===a.declaredClass?h=a:a.viewpoint?h=a.viewpoint:a.target&&"esri.Viewpoint"===a.target.declaredClass&&
(h=a.target);l=null;if(!h||!h.targetGeometry)return[3,1];l=h.targetGeometry;return[3,10];case 1:if(!(a instanceof u))return[3,2];l=a;return[3,10];case 2:return a||a&&(a.hasOwnProperty("center")||a.hasOwnProperty("extent")||a.hasOwnProperty("target"))?[4,E(a.center,b,c)]:[3,10];case 3:return(q=n.sent())?[3,5]:[4,E(a.extent,b,c)];case 4:q=n.sent(),n.label=5;case 5:return(p=q)?[3,7]:[4,E(a.target,b,c)];case 6:p=n.sent(),n.label=7;case 7:return(m=p)?[3,9]:[4,E(a,b,c)];case 8:m=n.sent(),n.label=9;case 9:l=
m,n.label=10;case 10:!l&&f&&f.targetGeometry?l=f.targetGeometry:!l&&b.extent&&(l=b.extent);t=A(l);c||(c=A(b.spatialReference||b.extent||l));if(!v.canProject(l,c)&&t&&!t.equals(c))return[2,null];w=B(e.vec2f64.create(),l.center?l.center:l);y=new r(z(w,w,t,c),c);D=null;D=h&&h.targetGeometry&&"point"===h.targetGeometry.type?h.scale:a.hasOwnProperty("scale")&&a.scale?a.scale:a.hasOwnProperty("zoom")&&-1!==a.zoom&&g&&g.effectiveLODs?g.zoomToScale(a.zoom):Array.isArray(l)||"point"===l.type||"extent"===l.type&&
0===l.width&&0===l.height?b.extent&&x.canProject(b.extent,c)?C(x.project(b.extent,c),d):b.extent?C(b.extent,d):f.scale:x.canProject(l.extent,c)?C(x.project(l.extent,c),d):C(l.extent,d);if(J=F(a))J.min&&J.min>D?D=J.min:J.max&&J.max<D&&(D=J.max);H=0;h?H=h.rotation:a.hasOwnProperty("rotation")?H=a.rotation:f&&(H=f.rotation);G=new k({targetGeometry:y,scale:D,rotation:H});g&&(G=g.fit(G),g.rotationEnabled||(G.rotation=H));return[2,G]}})})}function D(a,b){var c=a.targetGeometry,d=b.targetGeometry;c.x=d.x;
c.y=d.y;c.spatialReference=d.spatialReference;a.scale=b.scale;a.rotation=b.rotation;return a}function G(a,b,c){return c?g.vec2.set(a,.5*(b[0]-c.right+c.left),.5*(b[1]-c.bottom+c.top)):g.vec2.scale(a,b,.5)}function K(c,d,e,f){b.getTransform(c,d,e,f);return a.mat2d.invert(c,c)}function M(a,b,c){var d=N(b);b=Math.abs(Math.cos(d));d=Math.abs(Math.sin(d));return g.vec2.set(a,Math.round(c[1]*d+c[0]*b),Math.round(c[1]*b+c[0]*d))}function O(a){var b=a.scale;a=a.targetGeometry.spatialReference;a=w.isValid(a)?
1/(39.37*m.getMetersPerUnitForSR(a)*96):1;return b*a}function N(a){return c.common.toRadian(a.rotation)||0}function P(a){return w.isValid(a)?39.37*m.getMetersPerUnitForSR(a)*96:1}function L(a){return a.isWrappable?(a=w.getInfo(a),a.valid[1]-a.valid[0]):0}Object.defineProperty(b,"__esModule",{value:!0});var T=p.wgs84Radius,R=180/Math.PI;b.extentToScale=C;b.create=H;b.copy=D;b.getAnchor=G;b.getExtent=function(){var a=e.vec2f64.create();return function(b,c,d){var e=c.targetGeometry;B(a,e);c=.5*O(c);
b.xmin=a[0]-c*d[0];b.ymin=a[1]-c*d[1];b.xmax=a[0]+c*d[0];b.ymax=a[1]+c*d[1];b.spatialReference=e.spatialReference;return b}}();b.setExtent=function(a,c,d,e,f){b.centerAt(a,c,d.center);a.scale=C(d,e);f&&f.constraints&&f.constraints.constrain(a);return a};b.getOuterExtent=function(){var a=e.vec2f64.create(),b=e.vec2f64.create();return function(c,d,e){B(a,d.targetGeometry);M(b,d,e);e=.5*O(d);c.set({xmin:a[0]-e*b[0],ymin:a[1]-e*b[1],xmax:a[0]+e*b[0],ymax:a[1]+e*b[1],spatialReference:d.targetGeometry.spatialReference});
return c}}();b.getOuterSize=M;b.getPaddingScreenTranslation=function(){var a=e.vec2f64.create();return function(b,c,d){return g.vec2.sub(b,g.vec2.scale(b,c,.5),G(a,c,d))}}();b.getPaddingMapTranslation=function(){var c=l.mat2df64.create(),d=e.vec2f64.create();return function(e,f,h,l){var k=O(f);f=N(f);g.vec2.set(d,k,k);a.mat2d.fromScaling(c,d);a.mat2d.rotate(c,c,f);a.mat2d.translate(c,c,b.getPaddingScreenTranslation(d,h,l));a.mat2d.translate(c,c,[0,l.top-l.bottom]);return g.vec2.set(e,c[4],c[5])}}();
b.getResolution=O;b.getResolutionToScaleFactor=P;b.getMatrix=function(){var b=e.vec2f64.create(),c=e.vec2f64.create(),d=e.vec2f64.create();return function(e,f,h,l,k,m){g.vec2.negate(b,f);g.vec2.scale(c,h,.5*m);g.vec2.set(d,1/l*m,-1/l*m);a.mat2d.identity(e);a.mat2d.translate(e,e,c);k&&a.mat2d.rotate(e,e,k);a.mat2d.scale(e,e,d);a.mat2d.translate(e,e,b);return e}}();b.getTransform=function(){var a=e.vec2f64.create();return function(c,d,e,f){var g=O(d),h=N(d);B(a,d.targetGeometry);return b.getMatrix(c,
a,e,g,h,f)}}();b.getTransformNoRotation=function(){var a=e.vec2f64.create();return function(c,d,e,f){var g=O(d);B(a,d.targetGeometry);return b.getMatrix(c,a,e,g,0,f)}}();b.getWorldWidth=L;b.getWorldScreenWidth=function(a,b){return Math.round(L(a)/b)};b.createAsync=function(a,b){return d.safeCast(H(a,b))};b.angleBetween=function(){var a=e.vec2f64.create(),b=e.vec2f64.create(),c=[0,0,0];return function(d,e,f){g.vec2.subtract(a,d,e);g.vec2.normalize(a,a);g.vec2.subtract(b,d,f);g.vec2.normalize(b,b);
g.vec2.cross(c,a,b);d=Math.acos(g.vec2.dot(a,b)/(g.vec2.length(a)*g.vec2.length(b)))*R;0>c[2]&&(d=-d);isNaN(d)&&(d=0);return d}}();b.addPadding=function(){var a=e.vec2f64.create();return function(c,d,e,f){var g=c.targetGeometry;D(c,d);b.getPaddingMapTranslation(a,d,e,f);g.x+=a[0];g.y+=a[1];return c}}();b.removePadding=function(){var a=e.vec2f64.create();return function(c,d,e,f){var g=c.targetGeometry;D(c,d);b.getPaddingMapTranslation(a,d,e,f);g.x-=a[0];g.y-=a[1];return c}}();b.centerAt=function(){var a=
e.vec2f64.create();return function(b,c,d){D(b,c);c=b.targetGeometry;var e=A(d),f=A(c);B(a,d);z(a,a,e,f);c.x=a[0];c.y=a[1];return b}}();b.pixelSizeAt=function(a,b,c){return O(b)};b.resize=function(){var a=e.vec2f64.create();return function(c,d,e,f,h){h||(h="center");g.vec2.sub(a,e,f);g.vec2.scale(a,a,.5);e=a[0];f=a[1];switch(h){case "center":g.vec2.set(a,0,0);break;case "left":g.vec2.set(a,-e,0);break;case "top":g.vec2.set(a,0,f);break;case "right":g.vec2.set(a,e,0);break;case "bottom":g.vec2.set(a,
0,-f);break;case "top-left":g.vec2.set(a,-e,f);break;case "bottom-left":g.vec2.set(a,-e,-f);break;case "top-right":g.vec2.set(a,e,f);break;case "bottom-right":g.vec2.set(a,e,-f)}b.translateBy(c,d,a);return c}}();b.rotateBy=function(a,b,c){D(a,b);a.rotation+=c;return a};b.rotateTo=function(a,b,c){D(a,b);a.rotation=c;return a};b.scaleBy=function(){var a=e.vec2f64.create();return function(c,d,e,f,h){D(c,d);isNaN(e)||0===e||(b.toMap(a,f,d,h),c.scale=d.scale*e,b.toScreen(a,a,c,h),b.translateBy(c,c,g.vec2.set(a,
a[0]-f[0],f[1]-a[1])));return c}}();b.scaleTo=function(a,b,c){D(a,b);a.scale=c;return a};b.scaleAndRotateBy=function(){var a=e.vec2f64.create();return function(c,d,e,f,h,l){D(c,d);isNaN(e)||0===e||(b.toMap(a,h,d,l),c.scale=d.scale*e,c.rotation+=f,b.toScreen(a,a,c,l),b.translateBy(c,c,g.vec2.set(a,a[0]-h[0],h[1]-a[1])));return c}}();b.padAndScaleAndRotateBy=function(){var a=e.vec2f64.create(),c=e.vec2f64.create();return function(d,e,f,h,l,k,m){b.getPaddingScreenTranslation(c,k,m);g.vec2.add(a,l,c);
return h?b.scaleAndRotateBy(d,e,f,h,a,k):b.scaleBy(d,e,f,a,k)}}();b.toMap=function(){var a=l.mat2df64.create();return function(b,c,d,e){return g.vec2.transformMat2d(b,c,K(a,d,e,1))}}();b.toScreen=function(){var a=l.mat2df64.create();return function(c,d,e,f){return g.vec2.transformMat2d(c,d,b.getTransform(a,e,f,1))}}();b.translateBy=function(){var b=e.vec2f64.create(),c=l.mat2df64.create();return function(d,f,h){D(d,f);var l=O(f),k=d.targetGeometry;a.mat2d.fromRotation(c,N(f));a.mat2d.scale(c,c,e.vec2f64.fromValues(l,
l));g.vec2.transformMat2d(b,h,c);k.x+=b[0];k.y+=b[1];return d}}()})},"esri/views/3d/webgl-engine/shaders/TerrainRendererPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});var d=function(b){return k.glslifyDefineMap({OVERLAY:b.overlay,ATMOSPHERE:b.atmosphere,WIREFRAME_TEXTURE:b.wireframeTexture,TILE_BORDERS:b.tileBorders,RECEIVE_SHADOWS:b.receiveShadows,
SCREEN_SIZE_PERSPECTIVE:b.screenSizePerspective,ALPHA_ZERO:b.alphaZero,BIAS_SHADOWMAP:b.shadowMap,SLICE:b.slice})};b.colorPass={name:"terrain-color",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("terrainRenderer/colorPass.vert"),fragmentShader:d(b)+f.resolveIncludes("terrainRenderer/colorPass.frag")}},attributes:n.Default3D};b.normalPass={name:"terrain-normal",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("terrainRenderer/normalPass.vert"),fragmentShader:d(b)+f.resolveIncludes("terrainRenderer/normalPass.frag")}},
attributes:n.Default3D};b.depthPass={name:"terrain-depth",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("terrainRenderer/depthPass.vert"),fragmentShader:d(b)+f.resolveIncludes("terrainRenderer/depthPass.frag")}},attributes:n.Default3D};b.highlightPass={name:"terrain-highlight",shaders:function(b){return{vertexShader:d(b)+f.resolveIncludes("terrainRenderer/highlightPass.vert"),fragmentShader:d(b)+f.resolveIncludes("terrainRenderer/highlightPass.frag")}},attributes:n.Default3D}})},
"esri/views/3d/terrain/TilemapOnlyTile":function(){define(["require","exports","./TerrainConst","./TilePerLayerInfo"],function(q,b,n,f){return function(){function b(b,f){this.lij=b;this._pool=f;this.layerInfo=Array(n.LayerClass.COUNT);this.parent=null}b.prototype.hasDataAvailable=function(b,f,k){return(f=this.layerInfo[k][f].tilemap)?"unavailable"!==f.getAvailability(b.lij[1],b.lij[2]):!0};b.prototype.modifyLayers=function(b,h,k){b=this.layerInfo[k];for(var d=h.length,c=Array(d),a=0;a<d;a++){var l=
h[a];c[a]=-1<l?b[l]:f.TilePerLayerInfo.makeEmptyLayerInfo(k,this._pool)}this.layerInfo[k]=c};return b}()})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["require","exports","../../../core/libs/gl-matrix-2/vec2f64"],function(q,b,n){return function(){function b(){this.offset=n.vec2f64.create();this.scale=0;this.tile=null}b.prototype.init=function(b,d,f,m){this.tile=b;this.offset[0]=d;this.offset[1]=f;this.scale=m};b.prototype.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=
this.offset[1]=0};return b}()})},"esri/views/support/WebGLRequirements":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/Error","../../core/has"],function(q,b,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});var d={supportsMajorWebPerformanceCaveat:!1};b.check=function(b){b=n({},d,b);return k("esri-webgl")?!b.supportsMajorWebPerformanceCaveat&&k("esri-webgl-major-performance-caveat")?new f("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is blacklisted."):
k("esri-webgl-high-precision-fragment")?k("esri-webgl-vertex-shader-samplers")?k("esri-webgl-element-index-uint")?k("esri-webgl-standard-derivatives")?k("esri-webgl-instanced-arrays")?null:new f("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):new f("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new f("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):
new f("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new f("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new f("webgl:required","WebGL is required but not supported.")}})},"esri/views/ui/3d/DefaultUI3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../DefaultUI".split(" "),
function(q,b,n,f,k,d){return function(b){function d(d){d=b.call(this)||this;d.components=["attribution","zoom","navigation-toggle","compass"];return d}n(d,b);f([k.property()],d.prototype,"components",void 0);return d=f([k.subclass("esri.views.ui.3d.DefaultUI3D")],d)}(k.declared(d))})},"esri/views/ui/DefaultUI":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l){return function(b){function e(a){a=b.call(this)||this;a._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"};a.components=[];return a}n(e,b);e.prototype.initialize=function(){this._handles.add([k.init(this,"components",this._componentsWatcher.bind(this)),k.init(this,"view",this._updateViewAwareWidgets.bind(this))])};e.prototype._removeComponents=function(a){var b=this;a.forEach(function(a){if(a=b.find(a))b.remove(a),
a.destroy()})};e.prototype._updateViewAwareWidgets=function(a){var b=this;this.components.forEach(function(c){(c=(c=b.find(c))&&c.widget)&&void 0!==c.view&&c.set("view",a)})};e.prototype._componentsWatcher=function(a,b){this._removeComponents(b);this._addComponents(a);this._adjustPadding(a)};e.prototype._adjustPadding=function(a){-1!==a.indexOf("attribution")||this._isOverridden("padding")||(this.padding=this.padding.top)};e.prototype._addComponents=function(a){var b=this;this.initialized&&a.forEach(function(a){return b.add(b._createComponent(a),
b._defaultPositionLookup[a])})};e.prototype._createComponent=function(a){var b=this._createWidget(a);if(b)return new h({id:a,node:b})};e.prototype._createWidget=function(a){if("attribution"===a)return this._createAttribution();if("compass"===a)return this._createCompass();if("navigation-toggle"===a)return this._createNavigationToggle();if("zoom"===a)return this._createZoom()};e.prototype._createAttribution=function(){return new p({view:this.view})};e.prototype._createCompass=function(){return new c({view:this.view})};
e.prototype._createNavigationToggle=function(){return new a({view:this.view})};e.prototype._createZoom=function(){return new l({view:this.view})};f([d.property()],e.prototype,"components",void 0);return e=f([d.subclass("esri.views.ui.DefaultUI")],e)}(d.declared(m))})},"esri/views/ui/Component":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom dojo/dom-class ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(q,b,n,f,k,d,h,m){return function(b){function c(){var a=null!==b&&b.apply(this,arguments)||this;a.widget=null;return a}n(c,b);c.prototype.destroy=function(){this.widget&&this.widget.destroy();this.node=null};Object.defineProperty(c.prototype,"id",{get:function(){return this._get("id")||this.get("node.id")},set:function(a){this._set("id",a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"node",{set:function(a){var b=this._get("node");a!==b&&(a&&d.add(a,"esri-component"),
b&&d.remove(b,"esri-component"),this._set("node",a))},enumerable:!0,configurable:!0});c.prototype.castNode=function(a){if(!a)return this._set("widget",null),null;if("string"===typeof a||a&&"nodeType"in a)return this._set("widget",null),k.byId(a);a&&"function"===typeof a.render&&!a.domNode&&(a.domNode=document.createElement("div"));this._set("widget",a);return a.domNode};f([m.property()],c.prototype,"id",null);f([m.property()],c.prototype,"node",null);f([m.cast("node")],c.prototype,"castNode",null);
f([m.property({readOnly:!0})],c.prototype,"widget",void 0);return c=f([m.subclass("esri.views.ui.Component")],c)}(m.declared(h))})},"esri/views/ui/UI":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom-class dojo/dom-construct dojo/dom-style ../../core/Accessor ../../core/domUtils ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ../../widgets/support/widgetUtils".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t){function r(a){return"object"!==typeof a||a&&a.isInstanceOf&&a.isInstanceOf(u)||!("component"in a||"index"in a||"position"in a)?null:a}var y={left:0,top:0,bottom:0,right:0},w={bottom:30,top:15,right:15,left:15};return function(a){function b(b){b=a.call(this)||this;b._cornerNameToContainerLookup={};b._positionNameToContainerLookup={};b._components=[];b._handles=new l;b._componentToKey=new Map;b.view=null;b._initContainers();return b}f(b,a);b.prototype.initialize=
function(){this._handles.add([g.init(this,"view.padding, container",this._applyViewPadding.bind(this)),g.init(this,"padding",this._applyUIPadding.bind(this))])};b.prototype.destroy=function(){this.container=null;this._components.forEach(function(a){a.destroy()});this._components.length=0;this._handles.destroy();this._componentToKey.clear();this._componentToKey=null};Object.defineProperty(b.prototype,"container",{set:function(a){var b=this._get("container");a!==b&&(a&&(a.classList.add("esri-ui"),this._attachContainers(a)),
b&&(b.classList.remove("esri-ui"),m.set(b,{top:"",bottom:"",left:"",right:""}),c.empty(b)),this._set("container",a))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){var a=this.get("view.height")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.top+b.bottom),0)},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"padding",{get:function(){return this._get("padding")},set:function(a){a?this._override("padding",a):this._clearOverride("padding")},
enumerable:!0,configurable:!0});b.prototype.castPadding=function(a){return"number"===typeof a?{bottom:a,top:a,right:a,left:a}:n({},w,a)};Object.defineProperty(b.prototype,"width",{get:function(){var a=this.get("view.width")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.left+b.right),0)},enumerable:!0,configurable:!0});b.prototype.add=function(a,b){var c=this,d,e;if(Array.isArray(a))a.forEach(function(a){return c.add(a,b)});else{var f=r(a);f&&(d=f.index,b=f.position,a=f.component,
e=f.key);b&&"object"===typeof b&&(d=b.index,e=b.key,b=b.position);!a||b&&!this._isValidPosition(b)||(a&&a.isInstanceOf&&a.isInstanceOf(u)||(a=new u({node:a})),this._place({component:a,position:b,index:d}),this._components.push(a),e&&this._componentToKey.set(a,e))}};b.prototype.remove=function(a,b){var c=this;if(a){if(Array.isArray(a))return a.map(function(a){return c.remove(a,b)});var d=this.find(a);if(d){var e=this._componentToKey;if(!e.has(a)||e.get(a)===b)return e=this._components.indexOf(d),d.node.parentNode&&
d.node.parentNode.removeChild(d.node),this._componentToKey.delete(a),this._components.splice(e,1)[0]}}};b.prototype.empty=function(a){var b=this;if(Array.isArray(a))return a.map(function(a){return b.empty(a)}).reduce(function(a,b){return a.concat(b)});a=a||"manual";if("manual"===a)return Array.prototype.slice.call(this._manualContainer.children).filter(function(a){return!d.contains(a,"esri-ui-corner")}).map(function(a){return b.remove(a)});if(this._isValidPosition(a))return Array.prototype.slice.call(this._cornerNameToContainerLookup[a].children).map(this.remove,
this)};b.prototype.move=function(a,b){var c=this;Array.isArray(a)&&a.forEach(function(a){return c.move(a,b)});if(a){var d,e=r(a)||r(b);e&&(d=e.index,b=e.position,a=e.component||a);(!b||this._isValidPosition(b))&&(a=this.remove(a))&&this.add(a,{position:b,index:d})}};b.prototype.find=function(a){return a?a&&a.isInstanceOf&&a.isInstanceOf(u)?this._findByComponent(a):"string"===typeof a?this._findById(a):this._findByNode(a.domNode||a):null};b.prototype._getViewPadding=function(){return this.get("view.padding")||
y};b.prototype._attachContainers=function(a){a.appendChild(this._manualContainer);a.appendChild(this._innerContainer)};b.prototype._initContainers=function(){var a=h.create("div",{className:"esri-ui-inner-container esri-ui-corner-container"}),b=h.create("div",{className:"esri-ui-inner-container esri-ui-manual-container"}),c=h.create("div",{className:"esri-ui-top-left esri-ui-corner"},a),d=h.create("div",{className:"esri-ui-top-right esri-ui-corner"},a),e=h.create("div",{className:"esri-ui-bottom-left esri-ui-corner"},
a),f=h.create("div",{className:"esri-ui-bottom-right esri-ui-corner"},a);this._innerContainer=a;this._manualContainer=b;a=t.isRTL();this._cornerNameToContainerLookup={"top-left":c,"top-right":d,"bottom-left":e,"bottom-right":f,"top-leading":a?d:c,"top-trailing":a?c:d,"bottom-leading":a?f:e,"bottom-trailing":a?e:f};this._positionNameToContainerLookup=n({manual:b},this._cornerNameToContainerLookup)};b.prototype._isValidPosition=function(a){return!!this._positionNameToContainerLookup[a]};b.prototype._place=
function(a){var b=a.component,c=a.index;a=this._positionNameToContainerLookup[a.position||"manual"];var d;-1<c?(d=Array.prototype.slice.call(a.children),0===c?this._placeComponent(b,a,"first"):c>=d.length?this._placeComponent(b,a,"last"):this._placeComponent(b,d[c],"before")):this._placeComponent(b,a,"last")};b.prototype._placeComponent=function(a,b,c){var d=a.widget;d&&!d._started&&"function"===typeof d.postMixInProperties&&"function"===typeof d.buildRendering&&"function"===typeof d.postCreate&&
"function"===typeof d.startup&&a.widget.startup();h.place(a.node,b,c)};b.prototype._applyViewPadding=function(){var a=this.container;a&&m.set(a,this._toPxPosition(this._getViewPadding()))};b.prototype._applyUIPadding=function(){this._innerContainer&&m.set(this._innerContainer,this._toPxPosition(this.padding))};b.prototype._toPxPosition=function(a){return{top:this._toPxUnit(a.top),left:this._toPxUnit(a.left),right:this._toPxUnit(a.right),bottom:this._toPxUnit(a.bottom)}};b.prototype._toPxUnit=function(a){return 0===
a?0:a+"px"};b.prototype._findByComponent=function(a){var b=null,c;this._components.some(function(d){(c=d===a)&&(b=d);return c});return b};b.prototype._findById=function(a){var b=null,c;this._components.some(function(d){(c=d.id===a)&&(b=d);return c});return b};b.prototype._findByNode=function(a){var b=null,c;this._components.some(function(d){(c=d.node===a)&&(b=d);return c});return b};k([e.property()],b.prototype,"container",null);k([e.property({dependsOn:["view.height"]})],b.prototype,"height",null);
k([e.property({value:w})],b.prototype,"padding",null);k([e.cast("padding")],b.prototype,"castPadding",null);k([e.property()],b.prototype,"view",void 0);k([e.property({dependsOn:["view.width"]})],b.prototype,"width",null);return b=k([e.subclass("esri.views.ui.UI")],b)}(e.declared(p,a))})},"esri/widgets/Attribution":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Attribution/nls/Attribution ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Attribution/AttributionViewModel ./support/widget".split(" "),
function(q,b,n,f,k,d,h,m,p,c){return function(a){function b(b){b=a.call(this)||this;b._isOpen=!1;b._attributionTextOverflowed=!1;b._prevSourceNodeHeight=0;b.iconClass="esri-icon-description";b.itemDelimiter=" | ";b.label=k.widgetLabel;b.view=null;b.viewModel=new p;return b}n(b,a);b.prototype.postInitialize=function(){var a=this;this.own(d.on(this,"viewModel.items","change",function(){return a.scheduleRender()}))};Object.defineProperty(b.prototype,"attributionText",{get:function(){return this.viewModel.items.reduce(function(a,
b){-1===a.indexOf(b.text)&&a.push(b.text);return a},[]).join(this.itemDelimiter)},enumerable:!0,configurable:!0});b.prototype.render=function(){var a,b=(a={},a["esri-attribution--open"]=this._isOpen,a);return c.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",b),onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),c.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",c.tsx("a",{target:"_blank",href:"http://www.esri.com/",class:this.classes("esri-attribution__link",
"esri-widget__anchor")},"Esri")))};b.prototype._renderSourcesNode=function(){var a,b=this._isOpen,d=this._isInteractive(),f=d?0:-1,h=this.attributionText,l=d?"button":void 0,b=(a={},a["esri-attribution__sources--open"]=b,a["esri-interactive"]=d,a);return c.tsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",b),innerHTML:h,role:l,tabIndex:f})};b.prototype._afterSourcesNodeCreate=function(a){this._prevSourceNodeHeight=
a.clientWidth};b.prototype._afterSourcesNodeUpdate=function(a){var b=!1,c=a.clientHeight;a=a.scrollWidth>=a.clientWidth;var d=this._attributionTextOverflowed!==a;this._attributionTextOverflowed=a;d&&(b=!0);this._isOpen&&(a=c<this._prevSourceNodeHeight,this._prevSourceNodeHeight=c,a&&(this._isOpen=!1,b=!0));b&&this.scheduleRender()};b.prototype._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)};b.prototype._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed};
f([h.property({dependsOn:["viewModel.items.length","itemDelimiter"],readOnly:!0}),c.renderable()],b.prototype,"attributionText",null);f([h.property()],b.prototype,"iconClass",void 0);f([h.property(),c.renderable()],b.prototype,"itemDelimiter",void 0);f([h.property()],b.prototype,"label",void 0);f([h.aliasOf("viewModel.view")],b.prototype,"view",void 0);f([h.property({type:p}),c.renderable(["state","view.size"])],b.prototype,"viewModel",void 0);f([c.accessibleHandler()],b.prototype,"_toggleState",
null);return b=f([h.subclass("esri.widgets.Attribution")],b)}(h.declared(m))})},"esri/widgets/Attribution/AttributionViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/Accessor ../../core/arrayUtils ../../core/Collection ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),function(q,b,n,f,k,
d,h,m,p,c,a,l,g){return function(b){function d(a){a=b.call(this,a)||this;a._handles=new p;a._pendingAttributionItemsByLayerId={};a._attributionDataByLayerId={};a.items=new m;a.view=null;a._updateAttributionItems=a._updateAttributionItems.bind(a);return a}n(d,b);d.prototype.initialize=function(){this._handles.add(c.init(this,"view",this._viewWatcher))};d.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(d.prototype,"state",{get:function(){return this.get("view.ready")?
"ready":"disabled"},enumerable:!0,configurable:!0});d.prototype._viewWatcher=function(a){var b=this,d=this._handles;d&&d.remove();a&&(d.add([a.allLayerViews.on("change",function(a){b._addLayerViews(a.added);0<a.removed.length&&(a.removed.forEach(function(a){d.remove(a.uid)}),b._updateAttributionItems())}),c.init(a,"stationary",this._updateAttributionItems)]),this._addLayerViews(a.allLayerViews))};d.prototype._addLayerViews=function(a){var b=this;a.forEach(function(a){b._handles.has(a.uid)||b._handles.add(c.init(a,
"suspended",b._updateAttributionItems),a.uid)})};d.prototype._updateAttributionItems=function(){var a=this,b=[];this._getActiveLayerViews().forEach(function(c){var d=c.layer;if(d&&"function"===typeof d.originOf&&"user"===d.originOf("copyright"))a._addIfUnique(b,{layer:d,text:d.copyright});else if(c=d.get("portalItem.accessInformation"))a._addIfUnique(b,{layer:d,text:c});else if(d.hasAttributionData){var e=a._attributionDataByLayerId;if(e[d.uid])a._addIfUnique(b,{layer:d,text:a._getDynamicAttribution(e[d.uid],
a.view,d)});else{var f=a._pendingAttributionItemsByLayerId;a._inProgress(f[d.uid])||(f[d.uid]=d.fetchAttributionData().then(function(b){b=a._createContributionIndex(b,a._isBingLayer(d));delete f[d.uid];e[d.uid]=b;a._updateAttributionItems()}))}}else a._addIfUnique(b,{layer:d,text:d.copyright})});this._itemsChanged(this.items,b)&&(this.items.removeAll(),this.items.addMany(b))};d.prototype._itemsChanged=function(a,b){return a.length!==b.length||a.some(function(a,c){return a.text!==b[c].text})};d.prototype._inProgress=
function(a){return a&&!a.isFulfilled()};d.prototype._getActiveLayerViews=function(){return this.get("view.allLayerViews").filter(function(a){return!a.suspended&&a.get("layer.attributionVisible")})};d.prototype._addIfUnique=function(a,b){var c=b.layer,d=b.text;d&&c&&(h.find(a,function(a){return a.layer===c&&a.text===d})||a.push({text:d,layer:c}))};d.prototype._isBingLayer=function(a){return"bing-maps"===a.type};d.prototype._createContributionIndex=function(a,b){a=a.contributors;var c={};if(!a)return c;
for(var d=0;d<a.length;d++){var e=a[d],f=e.coverageAreas;if(!f)return;for(var h=0;h<f.length;h++)for(var l=f[h],m=l.bbox,p=l.zoomMin-(b&&l.zoomMin?1:0),n=l.zoomMax-(b&&l.zoomMax?1:0),l={extent:g.geographicToWebMercator({xmin:m[1],ymin:m[0],xmax:m[3],ymax:m[2],spatialReference:k.SpatialReference.WGS84}),attribution:e.attribution||"",score:null!=l.score?l.score:100,id:d};p<=n;p++)c[p]=c[p]||[],c[p].push(l)}c.maxKey=Math.max.apply(null,Object.keys(c));return c};d.prototype._getDynamicAttribution=function(a,
b,c){var d=b.extent;c=c.tileInfo.scaleToZoom(b.scale);c=Math.min(a.maxKey,Math.round(c));if(!d||null==c||-1>=c)return"";a=a[c];var e=g.project(d.center.clone().normalize(),b.spatialReference),f={};return a.filter(function(a){var b=!f[a.id]&&e&&l.extentContainsPoint(a.extent,e);b&&(f[a.id]=!0);return b}).sort(function(a,b){return b.score-a.score||a.objectId-b.objectId}).map(function(a){return a.attribution}).join(", ")};f([a.property({readOnly:!0,type:m})],d.prototype,"items",void 0);f([a.property({dependsOn:["view.ready"],
readOnly:!0})],d.prototype,"state",null);f([a.property()],d.prototype,"view",void 0);return d=f([a.subclass("esri.widgets.Attribution.AttributionViewModel")],d)}(a.declared(d))})},"esri/widgets/Compass":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Compass/nls/Compass ../core/accessorSupport/decorators ./Widget ./Compass/CompassViewModel ./support/widget".split(" "),function(q,b,n,f,k,d,h,m,p){return function(b){function a(a){a=
b.call(this)||this;a.goToOverride=null;a.iconClass="esri-icon-locate-circled";a.label=k.widgetLabel;a.view=null;a.viewModel=new m;return a}n(a,b);a.prototype.reset=function(){};a.prototype.render=function(){var a,b,c=this.viewModel,d=c.orientation,c=c.state,f="disabled"===c,h="compass"===("rotation"===c?"rotation":"compass"),c=f?-1:0,f=(a={},a["esri-disabled"]=f,a["esri-interactive"]=!f,a);a=(b={},b["esri-icon-compass"]=h,b["esri-icon-dial"]=!h,b);return p.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",
f),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:c,"aria-label":k.reset,title:k.reset},p.tsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",a),styles:this._toRotationTransform(d)}),p.tsx("span",{class:"esri-icon-font-fallback-text"},k.reset))};a.prototype._reset=function(){this.viewModel.reset()};a.prototype._toRotationTransform=function(a){return{transform:"rotateZ("+a.z+"deg)"}};f([d.aliasOf("viewModel.goToOverride")],a.prototype,"goToOverride",void 0);f([d.property()],
a.prototype,"iconClass",void 0);f([d.property()],a.prototype,"label",void 0);f([d.aliasOf("viewModel.view")],a.prototype,"view",void 0);f([d.property({type:m}),p.renderable(["viewModel.orientation","viewModel.state"])],a.prototype,"viewModel",void 0);f([d.aliasOf("viewModel.reset")],a.prototype,"reset",null);f([p.accessibleHandler()],a.prototype,"_reset",null);return a=f([d.subclass("esri.widgets.Compass")],a)}(d.declared(h))})},"esri/widgets/Compass/CompassViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ../support/GoTo".split(" "),
function(q,b,n,f,k,d,h,m,p){return function(b){function a(a){a=b.call(this,a)||this;a._handles=new d;a.orientation={x:0,y:0,z:0};a.view=null;a._updateForCamera=a._updateForCamera.bind(a);a._updateForRotation=a._updateForRotation.bind(a);a._updateRotationWatcher=a._updateRotationWatcher.bind(a);return a}n(a,b);a.prototype.initialize=function(){this._handles.add(h.init(this,"view",this._updateRotationWatcher))};a.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(a.prototype,
"canShowNorth",{get:function(){var a=this.get("view.spatialReference");return a&&(a.isWebMercator||a.isWGS84)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"state",{get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"},enumerable:!0,configurable:!0});a.prototype.reset=function(){if(this.get("view.ready")){var a={};"2d"===this.view.type?a.rotation=0:a.heading=0;this.callGoTo({target:a})}};a.prototype._updateForRotation=function(a){void 0!==
a&&null!==a&&(this.orientation={z:a})};a.prototype._updateForCamera=function(a){a&&(this.orientation={x:0,y:0,z:-a.heading})};a.prototype._updateRotationWatcher=function(a){this._handles.removeAll();a&&("2d"===a.type?this._handles.add(h.init(this,"view.rotation",this._updateForRotation)):this._handles.add(h.init(this,"view.camera",this._updateForCamera)))};f([m.property({dependsOn:["view.spatialReference.isWebMercator","view.spatialReference.wkid"],readOnly:!0})],a.prototype,"canShowNorth",null);
f([m.property()],a.prototype,"orientation",void 0);f([m.property({dependsOn:["view.ready","canShowNorth"],readOnly:!0})],a.prototype,"state",null);f([m.property()],a.prototype,"view",void 0);f([m.property()],a.prototype,"reset",null);return a=f([m.subclass("esri.widgets.CompassViewModel")],a)}(m.declared(k,p))})},"esri/widgets/NavigationToggle":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./NavigationToggle/nls/NavigationToggle ../core/accessorSupport/decorators ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/widget".split(" "),
function(q,b,n,f,k,d,h,m,p){return function(b){function a(a){a=b.call(this)||this;a.iconClass="esri-icon-pan2";a.label=k.widgetLabel;a.view=null;a.viewModel=new m;return a}n(a,b);Object.defineProperty(a.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});a.prototype.toggle=function(){};a.prototype.render=function(){var a,b,c,d="disabled"===this.get("viewModel.state"),f="pan"===this.get("viewModel.navigationMode"),h=(a={},a["esri-disabled"]=
d,a["esri-navigation-toggle--horizontal"]="horizontal"===this.layout,a);a=(b={},b["esri-navigation-toggle__button--active"]=f,b);b=(c={},c["esri-navigation-toggle__button--active"]=!f,c);c=d?-1:0;return p.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",h),onclick:this._toggle,onkeydown:this._toggle,tabIndex:c,"aria-label":k.toggle,title:k.toggle},p.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",
a)},p.tsx("span",{class:"esri-icon-pan"})),p.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--rotate",b)},p.tsx("span",{class:"esri-icon-rotate"})))};a.prototype._toggle=function(){this.toggle()};f([d.property()],a.prototype,"iconClass",void 0);f([d.property()],a.prototype,"label",void 0);f([d.property({value:"vertical"}),p.renderable()],a.prototype,"layout",null);f([d.aliasOf("viewModel.view"),p.renderable()],a.prototype,"view",void 0);
f([d.property({type:m}),p.renderable(["viewModel.state","viewModel.navigationMode"])],a.prototype,"viewModel",void 0);f([d.aliasOf("viewModel.toggle")],a.prototype,"toggle",null);f([p.accessibleHandler()],a.prototype,"_toggle",null);return a=f([d.subclass("esri.widgets.NavigationToggle")],a)}(d.declared(h))})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),
function(q,b,n,f,k,d,h,m){return function(b){function c(a){a=b.call(this,a)||this;a._handles=new d;a.navigationMode="pan";a.view=null;a.toggle=a.toggle.bind(a);return a}n(c,b);c.prototype.initialize=function(){this._handles.add(h.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};c.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(c.prototype,"state",{get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":
"disabled"},enumerable:!0,configurable:!0});c.prototype.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};c.prototype._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};f([m.property({dependsOn:["view.ready"],readOnly:!0})],c.prototype,"state",null);f([m.property()],c.prototype,"navigationMode",void 0);f([m.property()],c.prototype,"view",void 0);
f([m.property()],c.prototype,"toggle",null);return c=f([m.subclass("esri.widgets.NavigationToggleViewModel")],c)}(m.declared(k))})},"esri/widgets/Zoom":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Zoom/nls/Zoom ../core/accessorSupport/decorators ./Widget ./Zoom/IconButton ./Zoom/ZoomViewModel ./support/widget".split(" "),function(q,b,n,f,k,d,h,m,p,c){return function(a){function b(b){b=a.call(this)||this;b.iconClass="esri-icon-zoom-in-magnifying-glass";
b.label=k.widgetLabel;b.view=null;b.viewModel=new p;return b}n(b,a);b.prototype.postInitialize=function(){this._zoomInButton=new m({action:this.zoomIn,iconClass:"esri-icon-plus",title:k.zoomIn});this._zoomOutButton=new m({action:this.zoomOut,iconClass:"esri-icon-minus",title:k.zoomOut})};Object.defineProperty(b.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});b.prototype.render=function(){var a,b=this.viewModel,d=(a={},a["esri-zoom--horizontal"]=
"horizontal"===this.layout,a);this._zoomInButton.enabled="ready"===b.state&&b.canZoomIn;this._zoomOutButton.enabled="ready"===b.state&&b.canZoomOut;return c.tsx("div",{class:this.classes("esri-zoom esri-widget",d)},this._zoomInButton.render(),this._zoomOutButton.render())};b.prototype.zoomIn=function(){};b.prototype.zoomOut=function(){};f([d.property()],b.prototype,"iconClass",void 0);f([d.property()],b.prototype,"label",void 0);f([d.property({value:"vertical"}),c.renderable()],b.prototype,"layout",
null);f([d.aliasOf("viewModel.view"),c.renderable()],b.prototype,"view",void 0);f([d.property({type:p}),c.renderable(["viewModel.canZoomIn","viewModel.canZoomOut","viewModel.state"])],b.prototype,"viewModel",void 0);f([d.aliasOf("viewModel.zoomIn")],b.prototype,"zoomIn",null);f([d.aliasOf("viewModel.zoomOut")],b.prototype,"zoomOut",null);return b=f([d.subclass("esri.widgets.Zoom")],b)}(d.declared(h))})},"esri/widgets/Zoom/IconButton":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../Widget ../support/widget".split(" "),
function(q,b,n,f,k,d,h){return function(b){function d(){var c=null!==b&&b.apply(this,arguments)||this;c.enabled=!0;c.iconClass="";c.title="";return c}n(d,b);d.prototype.render=function(){var b,a,d=this.enabled?0:-1,f=(b={},b["esri-disabled"]=!this.enabled,b["esri-interactive"]=this.enabled,b);b=(a={},a[this.iconClass]=!!this.iconClass,a);return h.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",f),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:d,
title:this.title},h.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",b)}),h.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};d.prototype._triggerAction=function(){this.action.call(this)};f([k.property()],d.prototype,"action",void 0);f([k.property(),h.renderable()],d.prototype,"enabled",void 0);f([k.property(),h.renderable()],d.prototype,"iconClass",void 0);f([k.property(),h.renderable()],d.prototype,"title",void 0);f([h.accessibleHandler()],d.prototype,
"_triggerAction",null);return d=f([k.subclass("esri.widgets.IconButton")],d)}(k.declared(d))})},"esri/widgets/Zoom/ZoomViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(q,b,n,f,k,d,h,m){return function(b){function c(a){a=b.call(this,a)||this;a.canZoomIn=null;a.canZoomOut=null;a.zoomIn=a.zoomIn.bind(a);a.zoomOut=
a.zoomOut.bind(a);return a}n(c,b);c.prototype.destroy=function(){this.view=null};Object.defineProperty(c.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"view",{set:function(a){a?"2d"===a.type?this._zoomConditions=new h({view:a}):"3d"===a.type&&(this._zoomConditions=new m):this._zoomConditions=null;this._set("view",a)},enumerable:!0,configurable:!0});c.prototype.zoomIn=function(){this.canZoomIn&&
this._zoomToFactor(.5)};c.prototype.zoomOut=function(){this.canZoomOut&&this._zoomToFactor(2)};c.prototype._zoomToFactor=function(a){if("ready"===this.state){var b=this.view;"3d"===this.view.type?b.goTo({zoomFactor:1/a}):b.goTo({scale:this.get("view.scale")*a})}};f([d.property()],c.prototype,"_zoomConditions",void 0);f([d.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],c.prototype,"canZoomIn",void 0);f([d.property({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],c.prototype,"canZoomOut",
void 0);f([d.property({dependsOn:["view.ready"],readOnly:!0})],c.prototype,"state",null);f([d.property()],c.prototype,"view",null);f([d.property()],c.prototype,"zoomIn",null);f([d.property()],c.prototype,"zoomOut",null);return c=f([d.subclass("esri.widgets.Zoom.ZoomViewModel")],c)}(d.declared(k))})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(q,b,n,f,k,d){return function(b){function h(){return null!==b&&b.apply(this,arguments)||this}n(h,b);Object.defineProperty(h.prototype,"canZoomIn",{get:function(){var b=this.get("view.animation.target.scale")||this.get("view.scale"),c=this.get("view.constraints.effectiveMaxScale");return 0===c||b>c},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"canZoomOut",{get:function(){var b=this.get("view.animation.target.scale")||this.get("view.scale"),c=this.get("view.constraints.effectiveMinScale");
return 0===c||b<c},enumerable:!0,configurable:!0});f([d.property({dependsOn:["view.ready","view.scale"],readOnly:!0})],h.prototype,"canZoomIn",null);f([d.property({dependsOn:["view.ready","view.scale"],readOnly:!0})],h.prototype,"canZoomOut",null);f([d.property()],h.prototype,"view",void 0);return h=f([d.subclass("esri.widgets.Zoom.ZoomConditions2D")],h)}(d.declared(k))})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(q,b,n,f,k,d){return function(b){function h(){var d=null!==b&&b.apply(this,arguments)||this;d.canZoomIn=!0;d.canZoomOut=!0;return d}n(h,b);f([d.property({readOnly:!0})],h.prototype,"canZoomIn",void 0);f([d.property({readOnly:!0})],h.prototype,"canZoomOut",void 0);return h=f([d.subclass("esri.widgets.Zoom.ZoomConditions3D")],h)}(d.declared(k))})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","./WidgetManager"],function(q,b,n,f){var k=null,d;d=q(null,
{constructor:function(){n.subscribe("publishData",b.hitch(this,this.onDataPublished));n.subscribe("fetchData",b.hitch(this,this.onFetchData));n.subscribe("clearAllData",b.hitch(this,this.onClearAllData));n.subscribe("removeData",b.hitch(this,this.onRemoveData));n.subscribe("clearDataHistory",b.hitch(this,this.onClearDataHistory));this.widgetManager=f.getInstance()},_dataStore:{},onDataPublished:function(b,d,f,c){"undefined"===typeof c&&(c=!1);this._dataStore[d]?(this._dataStore[d].current=f,c&&(this._dataStore[d].history?
this._dataStore[d].history.push(f):this._dataStore[d].history=[f])):(this._dataStore[d]={current:f},c&&(this._dataStore[d].history=[f]))},onFetchData:function(b){var d;if(b)"framework"===b?this._dataStore[b]?n.publish("dataFetched","framework","framework",this._dataStore[b].current,this._dataStore[b].history):n.publish("noData","framework","framework"):(d=this.widgetManager.getWidgetById(b))?this._dataStore[b]?n.publish("dataFetched",d.name,b,this._dataStore[b].current,this._dataStore[b].history):
n.publish("noData",d.name,b):n.publish("noData",void 0,b);else for(var f in this._dataStore)(d=this.widgetManager.getWidgetById(f))&&n.publish("dataFetched",d.name,f,this._dataStore[f].current,this._dataStore[f].history)},onClearAllData:function(){this._dataStore={};n.publish("allDataCleared")},onRemoveData:function(b){delete this._dataStore[b];n.publish("dataRemoved",b)},onClearDataHistory:function(b){this._dataStore[b]&&(this._dataStore[b].history=[]);n.publish("dataHistoryCleared",b)}});d.getInstance=
function(){null===k&&(k=new d);return k};return d})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),function(q,b,n,f,k,d,h,m,p){return q([d,h],{type:"widget",id:void 0,label:void 0,icon:void 0,uri:void 0,position:{},config:void 0,openAtStart:!1,sceneView:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,
templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(k.subscribe("publishData",b.hitch(this,this._onReceiveData)));this.own(k.subscribe("dataFetched",b.hitch(this,this._onReceiveData)));this.own(k.subscribe("noData",b.hitch(this,this._onNoData)))},startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},
onActive:function(){},onDeActive:function(){},onSignIn:function(b){},onSignOut:function(){},onPositionChange:function(b){this.setPosition(b)},setPosition:function(b,a){this.position=b;var c=m.getPositionStyle(this.position);c.position="absolute";a||(a="map"===b.relativeTo?this.sceneView.map.id:window.jimuConfig.layoutId);f.place(this.domNode,a);f.setStyle(this.domNode,c);this.started&&this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return f.getMarginBox(this.domNode)},
setState:function(b){this.state=b},setWindowState:function(b){this.windowState=b},resize:function(){},onConfigChanged:function(b){},onAppConfigChanged:function(b,a,d){},onAction:function(b,a){},getPanel:function(){if(!1===this.inPanel)return null;if("widgetOnScreen"===this.gid||"widgetPool"===this.gid)return p.getInstance().getPanelById(this.id+"_panel");var b=p.getInstance().getPanelById(this.gid+"_panel");return b?b:p.getInstance().getPanelById(this.id+"_panel")},publishData:function(b,a){"undefined"===
typeof a&&(a=!1);k.publish("publishData",this.name,this.id,b,a)},fetchData:function(b){b?k.publish("fetchData",b):0!==this.listenWidgetIds.length?n.forEach(this.listenWidgetIds,function(a){k.publish("fetchData",a)},this):k.publish("fetchData")},fetchDataByName:function(b){b=this.widgetManager.getWidgetsByName(b);n.forEach(b,function(a){this.fetchData(a.id)},this)},openWidgetById:function(b){return this.widgetManager.triggerWidgetOpen(b)},_onReceiveData:function(b,a,d,f){if(a!==this.id&&!(0!==this.listenWidgetIds.length&&
0>this.listenWidgetIds.indexOf(a)))this.onReceiveData(b,a,d,f)},onReceiveData:function(b,a,d,f){},_onNoData:function(b,a){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(a)))this.onNoData(b,a)},onNoData:function(b,a){}})})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),function(q,b,n,f,k,d,h,m,p,c,a,
l,g){var e,u=null;e=q(null,{constructor:function(){this.panels=[];this.widgetManager=g.getInstance();m(window,"resize",b.hitch(this,this.onWindowResize));this.activePanel=null;p.subscribe("/dnd/move/start",b.hitch(this,this._onMoveStart));p.subscribe("widgetActived",b.hitch(this,this._onWidgetActived))},showPanel:function(a){var c=new d,e=this.getPanelById(a.id+"_panel");e?("closed"===e.state&&this.openPanel(e),c.resolve(e)):h({Panel:this._loadPanelClass(a.panel.uri),nls:this._loadThemeI18N(a.panel.uri)}).then(b.hitch(this,
function(d){var e=a.id+"_panel",f=this.getPanelById(e),g={label:a.label,config:a,uri:a.panel.uri,position:a.panel.position,sceneView:this.sceneView,widgetManager:this.widgetManager,panelManager:this,id:e,gid:a.gid,nls:d.nls};b.mixin(g,a.panel.options);try{f=new d.Panel(g),console.log("panel ["+e+"] created.")}catch(A){console.log("create panel error: "+A+", panelId: "+e);c.reject(A);return}f.setPosition(a.panel.position);l.setVerticalCenter(f.domNode);this.openPanel(f);this.panels.push(f);m(f.domNode,
"click",b.hitch(this,this._onPanelClick,f));c.resolve(f)}));return c},setSceneView:function(a){this.sceneView=a;m(this.sceneView,"resize",b.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a.gid&&this.panels[b].id!==a.id&&this.closePanel(this.panels[b])},closeAllPanelsInGroup:function(a){for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a&&this.closePanel(this.panels[b])},
openPanel:function(a){var c=new d;if("string"===typeof a&&(a=this.getPanelById(a),!a))return c.reject(),c;if(!a.started)try{a.started=!0,a.startup()}catch(y){console.error("fail to startup panel "+a.id+". "+y.stack)}if("opened"===a.state)return c.resolve(a),c;a.setState("opened");return this.playOpenPanelAnimation(a).then(b.hitch(this,function(){f.setStyle(a.domNode,"display","");a.onOpen();this._activePanel(a);return a}))},closePanel:function(a){var b=new d;return"string"===typeof a&&(a=this.getPanelById(a),
!a)||"closed"===a.state?(b.resolve(),b):this.playClosePanelAnimation(a).then(function(){this.activePanel&&this.activePanel.id===a.id&&(this.activePanel.onDeActive(),this.activePanel=null);a.setState("closed");a.onClose();a.domNode&&f.setStyle(a.domNode,"display","none")})},minimizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("minimized");try{a.onMinimize()}catch(r){console.log(console.error("fail to minimize panel "+
a.id+". "+r.stack))}},maximizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("maximized");try{a.onMaximize()}catch(r){console.log(console.error("fail to maximize panel "+a.id+". "+r.stack))}},normalizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("normal");try{a.onNormalize()}catch(r){console.log(console.error("fail to noralize panel "+
a.id+". "+r.stack))}},changeWindowStateTo:function(a,b){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"normal"===b?this.normalizePanel(a):"minimized"===b?this.minimizePanel(a):"maximized"===b?this.maximizePanel(a):console.log("error state: "+b)},getPanelById:function(a){for(var b=0;b<this.panels.length;b++)if(this.panels[b].id===a)return this.panels[b]},onWindowResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"!==this.panels[a].position.relativeTo&&
this.panels[a].resize()},onMapResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"===this.panels[a].position.relativeTo&&this.panels[a].resize()},destroyPanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;if(a.domNode){"closed"!==a.state&&this.closePanel(a);this._removePanel(a);try{a.destroy()}catch(r){console.log(console.error("fail to destroy panel "+a.id+". "+r.stack))}}},destroyAllPanels:function(){var a=n.map(this.panels,function(a){return a.id});
n.forEach(a,function(a){this.destroyPanel(a)},this);this.panels=[]},playOpenPanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.openAnimation||0===a.animationDuration)return c();var b=new d;"string"===typeof a.openAnimation?"fadeIn"===a.openAnimation?(f.setStyle(a.domNode,{opacity:0,display:""}),k.fadeIn({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play()):b.resolve():b.resolve();return b},playClosePanelAnimation:function(a){if("string"===
typeof a&&(a=this.getPanelById(a),!a)||!a.closeAnimation||0===a.animationDuration)return c();var b=new d;"string"===typeof a.closeAnimation&&("fadeOut"===a.closeAnimation?k.fadeOut({node:a.domNode,duration:a.animationDuration,onEnd:function(){b.resolve()}}).play():b.resolve());return b},getPositionOnMobile:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return{};var b=f.getMarginBox(window.jimuConfig.layoutId),c=b.h/2;a.titleHeight||(a.titleHeight=35);return"maximized"===a.windowState?
{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:b.h-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===a.windowState?b.h>b.w?{left:0,right:0,top:"auto",bottom:0,width:"auto",height:a.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:"auto",bottom:0,width:b.w/
2,height:a.titleHeight,contentHeight:b.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}:b.h>b.w?{left:0,right:0,top:c,bottom:0,width:"auto",height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:
{left:b.w-b.w/2,right:0,top:0,bottom:0,width:b.w/2,height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(a){this._activePanel(a)},_activePanel:function(a){if(this.activePanel){if(this.activePanel.id===a.id){this.activePanel.moveTopOnActive&&
f.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),f.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var b=this.widgetManager.activeWidget;b&&"active"===b.state&&b.getPanel()!==a&&(b.setState("opened"),!1===b.inPanel&&f.setStyle(b.domNode,"zIndex","undefined"!==typeof b.position.zIndex?b.position.zIndex:
"auto"),b.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=a;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&f.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(a){var b=this.panels.indexOf(a);-1<b&&this.panels.splice(b,1);this.activePanel&&this.activePanel.id===a.id&&(this.activePanel=null)},_onMoveStart:function(a){n.forEach(this.panels,function(b){b.domNode===a.node&&this._activePanel(b)},
this)},_onWidgetActived:function(a){this.activePanel&&"active"===this.activePanel.state&&a.getPanel()!==this.activePanel&&(this.activePanel.setState("opened"),f.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(b){var c=new d;a([b],function(a){c.resolve(a)});return c},_loadThemeI18N:function(b){var c=new d;b.startWith("themes")?(b=b.split("/"),
a(["dojo/i18n!"+(b[0]+"/"+b[1]+"/nls/strings")],function(a){c.resolve(a)})):c.resolve({});return c}});e.getInstance=function(){null===u&&(u=new e,window._panelManager=u);return u};return e})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(q,b,n,f){return q([f],{widget:null,baseClass:"jimu-widget-frame jimu-container",postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);
this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&"closed"!==this.widget.state&&b.isFunction(this.widget.resize)&&this.widget.resize()},setLoading:function(b){this.loading=b;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(b){this.widget=b;this.loading&&this.loading.destroy();n.place(b.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&
this.widget.domNode)try{this.widget.destroy()}catch(k){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+k.stack)}this.loading&&this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),function(q,b,n,f,k,d,h,m,p){return q([k,d],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",
windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var c=this.getAllWidgetConfigs(),c=Array.isArray(this.config.widgets)?this.config.widgets:[this.config];n.forEach(c,function(a){var c,d;!1!==a.visible&&(d=new h,c=this.createFrame(a),this.addChild(c),c.setLoading(d),this.widgetManager.loadWidget(a).then(b.hitch(this,function(a){c.setWidget(a);
a.startup()})))},this)},getAllWidgetConfigs:function(){var b=[];return b=Array.isArray(this.config.widgets)?this.config.widgets:[this.config]},getWidgetById:function(b){for(var a=this.getChildren(),c=0;c<a.length;c++)if(a[c].getWidget()&&a[c].getWidget().id===b)return a[c].getWidget()},createFrame:function(b){return new m},setPosition:function(b,a){this.position=b;var c=p.getPositionStyle(this.position);c.position="absolute";a||(a="map"===b.relativeTo?this.sceneView.map.id:window.jimuConfig.layoutId);
this.started?this.resize():this.openAnimation&&(c.display="none");f.place(this.domNode,a);f.setStyle(this.domNode,c)},getPosition:function(){return this.position},setState:function(b){this.state=b},setWindowState:function(b){this.windowState=b},resize:function(){this.getChildren().forEach(function(b){b.resize()})},onPositionChange:function(b){this.setPosition(b)},onOpen:function(){n.forEach(this.getChildren(),function(b){b.getWidget()&&this.widgetManager.openWidget(b.getWidget())},this)},onClose:function(){n.forEach(this.getChildren(),
function(b){b.getWidget()&&this.widgetManager.closeWidget(b.getWidget())},this)},onMaximize:function(){n.forEach(this.getChildren(),function(b){b.getWidget()&&this.widgetManager.maximizeWidget(b.getWidget())},this)},onMinimize:function(){n.forEach(this.getChildren(),function(b){b.getWidget()&&this.widgetManager.minimizeWidget(b.getWidget())},this)},onNormalize:function(){n.forEach(this.getChildren(),function(b){b.getWidget()&&this.widgetManager.normalizeWidget(b.getWidget())},this)},onActive:function(){},
onDeActive:function(){},updateConfig:function(b){this._updateConfig(b)},reloadWidget:function(c){this.isWidgetInPanel(c)&&(this._updateConfig(c),this.getChildren().forEach(function(a){a.getWidget()&&a.getWidget().id===c.id&&(a.getWidget().destroy(),a.setLoading(new h),this.widgetManager.loadWidget(c).then(b.hitch(this,function(b){a.setWidget(b);b.startup();"closed"===this.state&&this.widgetManager.closeWidget(b)})))},this))},isWidgetInPanel:function(b){return n.some(this.getAllWidgetConfigs(),function(a){if(b.id===
a.id)return!0})?!0:!1},_updateConfig:function(b){if(Array.isArray(this.config.widgets)){for(var a=-1,c=0;c<this.config.widgets.length;c++)this.config.widgets[c].id===b.id&&(a=c);0<a&&(this.config.widgets[a]=b)}else this.config=b},destroy:function(){this.getChildren().forEach(function(b){try{b.domNode&&b.destroy()}catch(a){console.error("destroy widget frame error."+a.stack)}});this.inherited(arguments)}})})},"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase",
"dojo/dom-style","dojo/dom-construct"],function(q,b,n,f){return q(b,{baseClass:"jimu-loading-indicator",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);(this.hidden=!0===this.hidden)&&n.set(this.domNode,{display:"none"});n.set(this.domNode,{width:"100%",height:"100%"});f.place(' \x3cdiv class\x3d"loading-container"\x3e\x3cdiv data-dojo-attach-point\x3d"loadingNode" class\x3d"img-div"\x3e\x3c/div\x3e\x3c/div\x3e',this.domNode)},show:function(){this.domNode&&
n.set(this.domNode,"display","block")},hide:function(){this.domNode&&n.set(this.domNode,"display","none")}})})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(q,b,n,f,k){return q([f,k],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(n(window,"resize",b.hitch(this,this._onWindowResize)))},getConfig:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},
"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array","jimu/PanelManager"],function(q,b,n){return q(null,{constructor:function(){this.panelManager=n.getInstance()},postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(b){},getConfigById:function(b){for(var f=this.getAllConfigs(),d=0;d<f.length;d++)if(f[d].id===b)return f[d]},getAllConfigs:function(){var f=
[],f=f.concat(this.getWidgetConfigs(),this.getGroupConfigs()),f=b.filter(f,function(b){return b.visible});return f.sort(function(b,d){return b.index-d.index})},getAllConfigsIncludeInvisible:function(){var b=[],b=b.concat(this.getWidgetConfigs(),this.getGroupConfigs());return b.sort(function(b,d){return b.index-d.index})},isControlled:function(f){return b.some(this.getAllConfigsIncludeInvisible(),function(b){return b.id===f})},widgetIsControlled:function(f){return b.some(this.getAllConfigsIncludeInvisible(),
function(k){return k.id===f?!0:b.some(k.widgets,function(b){return b.id===f})})},getGroupConfigs:function(){var f=[];if(!this.appConfig.widgetPool)return f;this.appConfig.widgetPool.groups&&b.forEach(this.appConfig.widgetPool.groups,function(b){this.controlledGroups&&(Array.isArray(this.controlledGroups)?-1<this.controlledGroups.indexOf(b.id)&&f.push(b):"all"===this.controlledGroups&&f.push(b))},this);return f},getWidgetConfigs:function(){var f=[];if(!this.appConfig.widgetPool)return f;this.appConfig.widgetPool.widgets&&
b.forEach(this.appConfig.widgetPool.widgets,function(b){this.controlledWidgets&&(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(b.id)&&f.push(b):"all"===this.controlledWidgets&&f.push(b))},this);return f}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/geometry/SpatialReference ./unitUtils".split(" "),function(q,b,n,f,k,d,h,m){var p=null,c=null,a=!1;q=q(null,function(){});
var l=require.toUrl("jimu"),g=d(l+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),e=d(l+"/SpatialReference/transform.json",{handleAs:"json"});q.loadResource=function(){var b=new f;if(p&&c)return b.resolve(),b;k([g,e]).then(function(d){p=d[0];c=d[1];a=!0;b.resolve()},function(c){console.error(c);a=!1;b.reject(c)});return b};q.getAllCSUnits=function(){if(a){var c=[];n.forEach(p.wkids,b.hitch(this,function(a){a=this.getCSUnit(a);-1===n.indexOf(c,a)&&c.push(a)}));return c}};q.convertUnit=function(b,
c,d){if(a)return m.convertUnit(b,c,d)};q.getUnitRate=function(b,c){if(a)return m.getUnitRate(b,c)};q.isProjectUnit=function(b){if(a)return m.isProjectUnit(b)};q.isGeographicUnit=function(b){if(a)return m.isGeographicUnit(b)};q.getGeographicUnits=function(){if(a)return m.getGeographicUnits()};q.getProjectUnits=function(){if(a)return m.getProjectUnits()};q.getCSUnit=function(b){if(a){b=this.getCSStr(b);var c=0,d=0,c=b.lastIndexOf("UNIT"),d=b.indexOf(",",c);return b.slice(c+6,d-1)}};q.isSameSR=function(b,
c){if(a)return b=this.indexOfWkid(b),c=this.indexOfWkid(c),p.labels[b]===p.labels[c]};q.isValidWkid=function(b){if(a)return-1<this.indexOfWkid(b)};q.getSRLabel=function(b){if(a&&this.isValidWkid(b))return b=this.indexOfWkid(b),p.labels[b]};q.indexOfWkid=function(b){if(a)return n.indexOf(p.wkids,b)};q.isWebMercator=function(a){return h.prototype._isWebMercator?h.prototype._isWebMercator.apply({wkid:parseInt(a,10)},[]):(new h(parseInt(a,10))).isWebMercator};q.standardizeWkid=function(a){return this.isWebMercator(a)?
3857:parseInt(a,10)};q.isValidTfWkid=function(b){if(a)return-1<this.indexOfTfWkid(b)};q.getTransformationLabel=function(b){if(a)return this.isValidTfWkid(b)?(b=this.indexOfTfWkid(b),c.labels[b]):""};q.indexOfTfWkid=function(b){if(a)return n.indexOf(c.tfWkids,b)};q.isGeographicCS=function(b){if(a)return this.isValidWkid(b)?p.details[this.indexOfWkid(b)].startWith("GEOGCS"):!1};q.isProjectedCS=function(b){if(a)return this.isValidWkid(b)?p.details[this.indexOfWkid(b)].startWith("PROJCS"):!1};q.getGeoCSByProj=
function(b){if(a&&this.isProjectedCS(b))return b=this.getSpheroidStr(b),b=n.indexOf(p.details,b),p.wkids[b]};q.getSpheroidStr=function(b){if(a){if(this.isGeographicCS(b))return p.details[this.indexOfWkid(b)];if(this.isProjectedCS(b)){b=p.details[this.indexOfWkid(b)];var c=b.indexOf("GEOGCS"),d=b.indexOf("PROJECTION")-1;return b.slice(c,d)}return null}};q.getCSStr=function(b){if(a)return p.details[this.indexOfWkid(b)]};q.isSameSpheroid=function(b,c){if(a)return b=this.getSpheroidStr(b),c=this.getSpheroidStr(c),
b&&c&&b===c?!0:!1};return q})},"dojo/request":function(){define(["./request/default!"],function(q){return q})},"dojo/request/default":function(){define(["exports","require","../has"],function(q,b,n){var f=n("config-requestProvider"),k;if(n("host-browser")||n("host-webworker"))k="./xhr";f||(f=k);q.getPlatformDefaultId=function(){return k};q.load=function(d,h,m,p){b(["platform"==d?k:f],function(b){m(b)})}})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare","dojo/_base/array"],
function(q,b){var n="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),f="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),k={INCHES:.0254,FOOT:.3048,FOOT_US:.3048006096012192,YARDS:.9144,MILES:1609.344,NAUTICAL_MILES:1852,MILLIMETERS:.001,
CENTIMETERS:.01,METER:1,KILOMETERS:1E3,DECIMETERS:.1,LINK_CLARKE:.2011661949,FOOT_GOLD_COAST:.3047997101815088,FOOT_CLARKE:.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:.9143984146160287,CHAIN_SEARS:20.11676512155263,FOOT_SEARS:.3047994715386762,YARD_INDIAN_1937:.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:.0174532925199433,DECIMAL_DEGREES:.0174532925199433,MGRS:.0174532925199433,USNG:.0174532925199433,
DEGREE_MINUTE_SECONDS:.0174532925199433,GRAD:.01570796326794897};q=q(null,function(){});q.convertUnit=function(b,f,m){return k[b.toUpperCase()]/k[f.toUpperCase()]*m};q.getUnitRate=function(b,f){return k[b.toUpperCase()]/k[f.toUpperCase()]};q.isProjectUnit=function(d){return-1<b.indexOf(n,d.toUpperCase())};q.isGeographicUnit=function(d){return-1<b.indexOf(f,d.toUpperCase())};q.getGeographicUnits=function(){return f};q.getProjectUnits=function(){return n};return q})},"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle dojo/touch".split(" "),
function(q,b,n,f,k,d,h,m,p){return q([h,d],{baseClass:"jimu-panel jimu-on-screen-widget-panel",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title jimu-main-background" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode"\x3e${label}\x3c/div\x3e\x3cdiv class\x3d"close-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,press:_onCloseBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"max-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"foldable-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w)},_onMaxBtnClicked:function(b){b.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?this.panelManager.normalizePanel(this):this.panelManager.maximizePanel(this),this._setMobilePosition())},_onFoldableBtnClicked:function(b){b.stopPropagation();
this._getPositionInfo().isRunInMobile&&("minimized"===this.windowState?(n.removeClass(this.foldableNode,"fold-up"),n.addClass(this.foldableNode,"fold-down"),this.panelManager.normalizePanel(this)):(n.removeClass(this.foldableNode,"fold-down"),n.addClass(this.foldableNode,"fold-up"),this.panelManager.minimizePanel(this)),this._setMobilePosition())},_onCloseBtnClicked:function(b){this.panelManager.closePanel(this);b.stopPropagation()},_normalizePositionObj:function(c){var a=this._getLayoutBox();c.left=
isFinite(c.left)?c.left:a.w-c.right;c.top=isFinite(c.top)?c.top:a.h-c.bottom;delete c.right;delete c.bottom;this.position=b.mixin(b.clone(this.position),c)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();
this.resizeHandle=(new p({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(c,a){this.disableMoveable();var d=n.getMarginBox(jimuConfig.layoutId);d.l=d.l-c+a;d.w+=2*(c-a);this.moveable=new k.boxConstrainedMoveable(this.domNode,{box:d,handle:this.titleNode,within:!0});this.own(f(this.moveable,
"Moving",b.hitch(this,this.onMoving)));this.own(f(this.moveable,"MoveStop",b.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);this.inherited(arguments)},_switchToMobileUI:function(){n.removeClass(this.titleNode,"title-normal");n.addClass(this.titleNode,"title-full");n.setStyle(this.foldableNode,"display",
"block");n.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(n.removeClass(this.foldableNode,"fold-up"),n.addClass(this.foldableNode,"fold-down")):(n.removeClass(this.foldableNode,"fold-down"),n.addClass(this.foldableNode,"fold-up"))},_switchToDesktopUI:function(){n.removeClass(this.titleNode,"title-full");n.addClass(this.titleNode,"title-normal");n.setStyle(this.foldableNode,"display","none");n.setStyle(this.maxNode,"display","none")},resize:function(c){var a=this._getPositionInfo(),
d={left:a.position.left,top:a.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};c&&(c.t=this.domNode.offsetTop,d.left=isFinite(c.l)?c.l:d.left,d.top=isFinite(c.t)?c.t:d.top,d.width=isFinite(c.w)?c.w:d.width,d.height=isFinite(c.h)?c.h:d.height,this._normalizePositionObj(b.clone(d)),this.makePositionInfoBox(),d.width=this._positionInfoBox.w,d.height=this._positionInfoBox.h);a.position=d;this._onResponsible(a);this.inherited(arguments)},_onResponsible:function(b){b.isRunInMobile?
(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(b.position),this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(b){this._normalizePositionObj(b);this.makePositionInfoBox();b=this._getPositionInfo();this._onResponsible(b)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var b=jimuConfig.layoutId,
b="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return n.getMarginBox(b)},_getPositionInfo:function(){var b={isRunInMobile:!1,position:{left:0,top:5}},a=this._getLayoutBox(),d=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return b.isRunInMobile=!0,b;b.position.left=window.isRTL?a.w-d:d;var d=this._positionInfoBox.t,f=a.h-d;d>=f?d>=this._positionInfoBox.h&&(b.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):f>=this._positionInfoBox.h&&(b.position.top=
this._positionInfoBox.t+40+3);!b.isRunInMobile&&b.position.left+this._positionInfoBox.w>a.w&&(b.position.left-=this._positionInfoBox.w);return b},_setMobilePosition:function(){n.place(this.domNode,jimuConfig.layoutId);var c=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(c.zIndex=this.position.zIndex);var a=m.getPositionStyle(c);b.mixin(a,c.borderRadiusStyle);n.setStyle(this.domNode,a)},_setDesktopPosition:function(b){n.place(this.domNode,jimuConfig.mapId);n.setStyle(this.domNode,
{left:b.left+"px",right:"auto",top:b.top+"px",width:(b.width||this.position.width||this._originalBox.w)+"px",height:(b.height||this.position.height||this._originalBox.h)+"px"})},onMoving:function(b){n.setStyle(b.node,"opacity",.9)},onMoveStop:function(c){n.setStyle(c.node,"opacity",1);c=n.getMarginBox(c.node);this._normalizePositionObj(b.clone({left:c.l,top:c.t,width:c.w,height:c.h}));this.makePositionInfoBox()}})})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r){q.experimental("dojox.layout.ResizeHandle");var y=g("dojox.layout._ResizeHelper",t,{show:function(){l.set(this.domNode,"display","")},hide:function(){l.set(this.domNode,"display","none")},resize:function(b){a.setMarginBox(this.domNode,b)}});return g("dojox.layout.ResizeHandle",[t,r],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,
minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,e.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=u.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new y({id:"dojoxGlobalResizeHelper"})).placeAt(h.body()),
c.add(this._resizeHelper.domNode,this.activeResizeClass)));this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var a=b.partial(c.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;a("dojoxResizeNW");break;case "x":this._resizeX=!0;a("dojoxResizeW");break;case "y":this._resizeY=!0,a("dojoxResizeN")}},_beginSizing:function(b){if(!this._isSizing&&
(n.publish(this.startTopic,[this]),this.targetDomNode=(this.targetWidget=u.byId(this.targetId))?this.targetWidget.domNode:p.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var c=a.position(this.targetDomNode,!0);this._resizeHelper.resize({l:c.x,t:c.y,w:c.w,h:c.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:c.x,t:c.y})}this._isSizing=!0;this.startPoint={x:b.clientX,y:b.clientY};
var c=l.getComputedStyle(this.targetDomNode),d="border-model"===a.boxModel?{w:0,h:0}:a.getPadBorderExtents(this.targetDomNode,c),f=a.getMarginExtents(this.targetDomNode,c);this.startSize={w:l.get(this.targetDomNode,"width",c),h:l.get(this.targetDomNode,"height",c),pbw:d.w,pbh:d.h,mw:f.w,mh:f.h};this.isLeftToRight()||"absolute"!=l.get(this.targetDomNode,"position")||(c=a.position(this.targetDomNode,!0),this.startPosition={l:c.x,t:c.y});this._pconnects=[n.connect(h.doc,e.move,this,"_updateSizing"),
n.connect(h.doc,e.release,this,"_endSizing")];k.stop(b)}},_updateSizing:function(a){if(this.activeResize)this._changeSizing(a);else{var b=this._getNewCoords(a,"border",this._resizeHelper.startPosition);if(!1===b)return;this._resizeHelper.resize(b)}a.preventDefault()},_getNewCoords:function(a,b,c){try{if(!a.clientX||!a.clientY)return!1}catch(B){return!1}this._activeResizeLastEvent=a;var d=(this.isLeftToRight()?1:-1)*(this.startPoint.x-a.clientX),e=this.startPoint.y-a.clientY;a=this.startSize.w-(this._resizeX?
d:0);e=this._checkConstraints(a,this.startSize.h-(this._resizeY?e:0));(c=c||this.startPosition)&&this._resizeX&&(e.l=c.l+d,e.w!=a&&(e.l+=a-e.w),e.t=c.t);switch(b){case "margin":e.w+=this.startSize.mw,e.h+=this.startSize.mh;case "border":e.w+=this.startSize.pbw,e.h+=this.startSize.pbh}return e},_checkConstraints:function(a,b){if(this.minSize){var c=this.minSize;a<c.w&&(a=c.w);b<c.h&&(b=c.h)}this.constrainMax&&this.maxSize&&(c=this.maxSize,a>c.w&&(a=c.w),b>c.h&&(b=c.h));if(this.fixedAspect){var c=this.startSize.w,
d=this.startSize.h,e=c*b-d*a;0>e?a=b*c/d:0<e&&(b=a*d/c)}return{w:a,h:b}},_changeSizing:function(a){var c=this.targetWidget&&b.isFunction(this.targetWidget.resize),e=this._getNewCoords(a,c&&"margin");if(!1!==e&&(c?this.targetWidget.resize(e):this.animateSizing?m[this.animateMethod]([d.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:e.w}},duration:this.animateDuration}),d.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:e.h}},
duration:this.animateDuration})]).play():l.set(this.targetDomNode,{width:e.w+"px",height:e.h+"px"}),this.intermediateChanges))this.onResize(a)},_endSizing:function(a){f.forEach(this._pconnects,n.disconnect);var c=b.partial(n.publish,this.endTopic,[this]);this.activeResize?c():(this._resizeHelper.hide(),this._changeSizing(a),setTimeout(c,this.animateDuration+15));this._isSizing=!1;this.onResize(a)},onResize:function(a){}})})},"dojo/fx":function(){define("./_base/lang ./Evented ./_base/kernel ./_base/array ./aspect ./_base/fx ./dom ./dom-style ./dom-geometry ./ready require".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a){n.isAsync||c(0,function(){a(["./fx/Toggler"])});n=n.fx={};c={_fire:function(a,b){this[a]&&this[a].apply(this,b||[]);return this}};var l=function(a){this._index=-1;this._animations=a||[];this._current=this._onAnimateCtx=this._onEndCtx=null;this.duration=0;f.forEach(this._animations,function(a){a&&("undefined"!=typeof a.duration&&(this.duration+=a.duration),a.delay&&(this.duration+=a.delay))},this)};l.prototype=new b;q.extend(l,{_onAnimate:function(){this._fire("onAnimate",
arguments)},_onEnd:function(){this._onAnimateCtx.remove();this._onEndCtx.remove();this._onAnimateCtx=this._onEndCtx=null;this._index+1==this._animations.length?this._fire("onEnd"):(this._current=this._animations[++this._index],this._onAnimateCtx=k.after(this._current,"onAnimate",q.hitch(this,"_onAnimate"),!0),this._onEndCtx=k.after(this._current,"onEnd",q.hitch(this,"_onEnd"),!0),this._current.play(0,!0))},play:function(a,b){this._current||(this._current=this._animations[this._index=0]);if(!b&&"playing"==
this._current.status())return this;var c=k.after(this._current,"beforeBegin",q.hitch(this,function(){this._fire("beforeBegin")}),!0),d=k.after(this._current,"onBegin",q.hitch(this,function(a){this._fire("onBegin",arguments)}),!0),e=k.after(this._current,"onPlay",q.hitch(this,function(a){this._fire("onPlay",arguments);c.remove();d.remove();e.remove()}));this._onAnimateCtx&&this._onAnimateCtx.remove();this._onAnimateCtx=k.after(this._current,"onAnimate",q.hitch(this,"_onAnimate"),!0);this._onEndCtx&&
this._onEndCtx.remove();this._onEndCtx=k.after(this._current,"onEnd",q.hitch(this,"_onEnd"),!0);this._current.play.apply(this._current,arguments);return this},pause:function(){if(this._current){var a=k.after(this._current,"onPause",q.hitch(this,function(b){this._fire("onPause",arguments);a.remove()}),!0);this._current.pause()}return this},gotoPercent:function(a,b){this.pause();var c=this.duration*a;this._current=null;f.some(this._animations,function(a,b){if(c<=a.duration)return this._current=a,this._index=
b,!0;c-=a.duration;return!1},this);this._current&&this._current.gotoPercent(c/this._current.duration);b&&this.play();return this},stop:function(a){if(this._current){if(a){for(;this._index+1<this._animations.length;++this._index)this._animations[this._index].stop(!0);this._current=this._animations[this._index]}var b=k.after(this._current,"onStop",q.hitch(this,function(a){this._fire("onStop",arguments);b.remove()}),!0);this._current.stop()}return this},status:function(){return this._current?this._current.status():
"stopped"},destroy:function(){this.stop();this._onAnimateCtx&&this._onAnimateCtx.remove();this._onEndCtx&&this._onEndCtx.remove()}});q.extend(l,c);n.chain=function(a){return new l(q.isArray(a)?a:Array.prototype.slice.call(a,0))};var g=function(a){this._animations=a||[];this._connects=[];this.duration=this._finished=0;f.forEach(a,function(a){var b=a.duration;a.delay&&(b+=a.delay);this.duration<b&&(this.duration=b);this._connects.push(k.after(a,"onEnd",q.hitch(this,"_onEnd"),!0))},this);this._pseudoAnimation=
new d.Animation({curve:[0,1],duration:this.duration});var b=this;f.forEach("beforeBegin onBegin onPlay onAnimate onPause onStop onEnd".split(" "),function(a){b._connects.push(k.after(b._pseudoAnimation,a,function(){b._fire(a,arguments)},!0))})};q.extend(g,{_doAction:function(a,b){f.forEach(this._animations,function(c){c[a].apply(c,b)});return this},_onEnd:function(){++this._finished>this._animations.length&&this._fire("onEnd")},_call:function(a,b){var c=this._pseudoAnimation;c[a].apply(c,b)},play:function(a,
b){this._finished=0;this._doAction("play",arguments);this._call("play",arguments);return this},pause:function(){this._doAction("pause",arguments);this._call("pause",arguments);return this},gotoPercent:function(a,b){var c=this.duration*a;f.forEach(this._animations,function(a){a.gotoPercent(a.duration<c?1:c/a.duration,b)});this._call("gotoPercent",arguments);return this},stop:function(a){this._doAction("stop",arguments);this._call("stop",arguments);return this},status:function(){return this._pseudoAnimation.status()},
destroy:function(){this.stop();f.forEach(this._connects,function(a){a.remove()})}});q.extend(g,c);n.combine=function(a){return new g(q.isArray(a)?a:Array.prototype.slice.call(a,0))};n.wipeIn=function(a){var b=a.node=h.byId(a.node),c=b.style,e;a=d.animateProperty(q.mixin({properties:{height:{start:function(){e=c.overflow;c.overflow="hidden";if("hidden"==c.visibility||"none"==c.display)return c.height="1px",c.display="",c.visibility="",1;var a=m.get(b,"height");return Math.max(a,1)},end:function(){return b.scrollHeight}}}},
a));var f=function(){c.height="auto";c.overflow=e};k.after(a,"onStop",f,!0);k.after(a,"onEnd",f,!0);return a};n.wipeOut=function(a){var b=(a.node=h.byId(a.node)).style,c;a=d.animateProperty(q.mixin({properties:{height:{end:1}}},a));k.after(a,"beforeBegin",function(){c=b.overflow;b.overflow="hidden";b.display=""},!0);var e=function(){b.overflow=c;b.height="auto";b.display="none"};k.after(a,"onStop",e,!0);k.after(a,"onEnd",e,!0);return a};n.slideTo=function(a){var b=null,c=null,e=function(a){return function(){var d=
m.getComputedStyle(a),e=d.position;b="absolute"==e?a.offsetTop:parseInt(d.top)||0;c="absolute"==e?a.offsetLeft:parseInt(d.left)||0;"absolute"!=e&&"relative"!=e&&(d=p.position(a,!0),b=d.y,c=d.x,a.style.position="absolute",a.style.top=b+"px",a.style.left=c+"px")}}(a.node=h.byId(a.node));e();a=d.animateProperty(q.mixin({properties:{top:a.top||0,left:a.left||0}},a));k.after(a,"beforeBegin",e,!0);return a};return n})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),
function(q,b,n,f,k,d,h,m,p){return d("dijit.layout._LayoutWidget",[b,n,f],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);h.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var b=this.getParent&&this.getParent();b&&b.isLayoutContainer||(this.resize(),this.own(k.on("resize",q.hitch(this,"resize"))))}},resize:function(b,a){var c=this.domNode;b&&m.setMarginBox(c,b);a=a||{};
q.mixin(a,b||{});"h"in a&&"w"in a||(a=q.mixin(m.getMarginBox(c),a));b=p.getComputedStyle(c);var d=m.getMarginExtents(c,b),e=m.getBorderExtents(c,b);a=this._borderBox={w:a.w-(d.w+e.w),h:a.h-(d.h+e.h)};d=m.getPadExtents(c,b);this._contentBox={l:p.toPixelValue(c,b.paddingLeft),t:p.toPixelValue(c,b.paddingTop),w:a.w-d.w,h:a.h-d.h};this.layout()},layout:function(){},_setupChild:function(b){h.add(b.domNode,this.baseClass+"-child "+(b.baseClass?this.baseClass+"-"+b.baseClass:""))},addChild:function(b,a){this.inherited(arguments);
this._started&&this._setupChild(b)},removeChild:function(b){h.remove(b.domNode,this.baseClass+"-child"+(b.baseClass?" "+this.baseClass+"-"+b.baseClass:""));this.inherited(arguments)}})})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(q,b){return q("dijit._Contained",null,{_getSibling:function(b){var f=this.getParent();return f&&f._getSiblingOfChild&&f._getSiblingOfChild(this,"previous"==b?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},
getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var b=this.getParent();return b&&b.getIndexOfChild?b.getIndexOfChild(this):-1}})})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t){a("dijit-legacy-requires")&&t(0,function(){q(["dijit/MenuItem",
"dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return n("dijit.Menu",u,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):b.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return g.get(this._iframeContentDocument(a))||this._iframeContentDocument(a).__parent__||
a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(a){a=f.byId(a,this.ownerDocument);var b;if("iframe"==a.tagName.toLowerCase()){var d=a;b=this._iframeContentWindow(d);b=l.body(b.document)}else b=a==l.body(this.ownerDocument)?this.ownerDocument.documentElement:a;var e={node:a,iframe:d};k.set(a,"_dijitMenu"+this.id,
this._bindings.push(e));var g=p.hitch(this,function(a){var b=this.selector,e=b?function(a){return c.selector(b,a)}:function(a){return a},f=this;return[c(a,e(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<f._lastKeyDown+500||f._scheduleOpen(this,d,{x:a.pageX,y:a.pageY},a.target)}),c(a,e("keydown"),function(a){if(93==a.keyCode||a.shiftKey&&a.keyCode==m.F10||f.leftClickToOpen&&a.keyCode==m.SPACE)a.stopPropagation(),a.preventDefault(),
f._scheduleOpen(this,d,null,a.target),f._lastKeyDown=(new Date).getTime()})]});e.connects=b?g(b):[];d&&(e.onloadHandler=p.hitch(this,function(){var a=this._iframeContentWindow(d),a=l.body(a.document);e.connects=g(a)}),d.addEventListener?d.addEventListener("load",e.onloadHandler,!1):d.attachEvent("onload",e.onloadHandler))},unBindDomNode:function(a){var b;try{b=f.byId(a,this.ownerDocument)}catch(z){return}a="_dijitMenu"+this.id;if(b&&k.has(b,a)){for(var c=k.get(b,a)-1,d=this._bindings[c],e;e=d.connects.pop();)e.remove();
(e=d.iframe)&&(e.removeEventListener?e.removeEventListener("load",d.onloadHandler,!1):e.detachEvent("onload",d.onloadHandler));k.remove(b,a);delete this._bindings[c]}},_scheduleOpen:function(a,b,c,d){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:d,delegatedTarget:a,iframe:b,coords:c})},1))},_openMyself:function(b){function c(){q.refocus&&t&&t.focus();e.close(q)}var g=b.target,l=b.iframe,k=b.coords,m=!k;this.currentTarget=b.delegatedTarget;
if(k){if(l){b=d.position(l,!0);var g=this._iframeContentWindow(l),g=d.docScroll(g.document),p=h.getComputedStyle(l),n=h.toPixelValue,r=(a("ie"),n(l,p.paddingLeft))+(a("ie"),0),l=(a("ie"),n(l,p.paddingTop))+(a("ie"),0);k.x+=b.x+r-g.x;k.y+=b.y+l-g.y}}else k=d.position(g,!0),k.x+=10,k.y+=10;var q=this,l=this._focusManager.get("prevNode");b=this._focusManager.get("curNode");var t=!b||f.isDescendant(b,this.domNode)?l:b;e.open({popup:this,x:k.x,y:k.y,onExecute:c,onCancel:c,orient:this.isLeftToRight()?"L":
"R"});this.focus();m||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);e.close(this)}},destroy:function(){b.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dijit/popup":function(){define("dojo/_base/array dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on ./place ./BackgroundIframe ./Viewport ./main dojo/touch".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t){function r(){this._popupWrapper&&(d.destroy(this._popupWrapper),delete this._popupWrapper)}n=n(null,{_stack:[],_beginZIndex:1E3,_idGen:1,_repositionAll:function(){if(this._firstAroundNode){var b=this._firstAroundPosition,c=h.position(this._firstAroundNode,!0),d=c.x-b.x,b=c.y-b.y;if(d||b)for(this._firstAroundPosition=c,c=0;c<this._stack.length;c++){var e=this._stack[c].wrapper.style;e.top=parseFloat(e.top)+b+"px";"auto"==e.right?e.left=parseFloat(e.left)+d+
"px":e.right=parseFloat(e.right)-d+"px"}this._aroundMoveListener=setTimeout(a.hitch(this,"_repositionAll"),d||b?10:50)}},_createWrapper:function(a){var c=a._popupWrapper,e=a.domNode;c||(c=d.create("div",{"class":"dijitPopup",style:{display:"none"},role:"region","aria-label":a["aria-label"]||a.label||a.name||a.id},a.ownerDocumentBody),c.appendChild(e),e=e.style,e.display="",e.visibility="",e.position="",e.top="0px",a._popupWrapper=c,b.after(a,"destroy",r,!0),"ontouchend"in document&&l(c,"touchend",
function(a){/^(input|button|textarea)$/i.test(a.target.tagName)||a.preventDefault()}),c.dojoClick=!0);return c},moveOffScreen:function(a){var b=this._createWrapper(a);a=h.isBodyLtr(a.ownerDocument);var c={visibility:"hidden",top:"-9999px",display:""};c[a?"left":"right"]="-9999px";c[a?"right":"left"]="auto";m.set(b,c);return b},hide:function(a){var b=this._createWrapper(a);m.set(b,{display:"none",height:"auto",overflowY:"visible",border:""});a=a.domNode;"_originalStyle"in a&&(a.style.cssText=a._originalStyle)},
getTopPopup:function(){for(var a=this._stack,b=a.length-1;0<b&&a[b].parent===a[b-1].widget;b--);return a[b]},open:function(b){for(var d=this._stack,n=b.popup,r=n.domNode,q=b.orient||["below","below-alt","above","above-alt"],t=b.parent?b.parent.isLeftToRight():h.isBodyLtr(n.ownerDocument),y=b.around,C=b.around&&b.around.id?b.around.id+"_dropdown":"popup_"+this._idGen++;d.length&&(!b.parent||!f.isDescendant(b.parent.domNode,d[d.length-1].widget.domNode));)this.close(d[d.length-1].widget);var E=this.moveOffScreen(n);
n.startup&&!n._started&&n.startup();var F,H=h.position(r);if("maxHeight"in b&&-1!=b.maxHeight)F=b.maxHeight||Infinity;else{F=u.getEffectiveBox(this.ownerDocument);var D=y?h.position(y,!1):{y:b.y-(b.padding||0),h:2*(b.padding||0)};F=Math.floor(Math.max(D.y,F.h-(D.y+D.h)))}H.h>F&&(H=m.getComputedStyle(r),m.set(E,{overflowY:"scroll",height:F+"px",border:H.borderLeftWidth+" "+H.borderLeftStyle+" "+H.borderLeftColor}),r._originalStyle=r.style.cssText,r.style.border="none");k.set(E,{id:C,style:{zIndex:this._beginZIndex+
d.length},"class":"dijitPopup "+(n.baseClass||n["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:b.parent?b.parent.id:""});0==d.length&&y&&(this._firstAroundNode=y,this._firstAroundPosition=h.position(y,!0),this._aroundMoveListener=setTimeout(a.hitch(this,"_repositionAll"),50));p("config-bgIframe")&&!n.bgIframe&&(n.bgIframe=new e(E));C=n.orient?a.hitch(n,"orient"):null;q=y?g.around(E,y,q,t,C):g.at(E,b,"R"==q?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],b.padding,C);E.style.visibility="visible";
r.style.visibility="visible";r=[];r.push(l(E,"keydown",a.hitch(this,function(a){if(a.keyCode==c.ESCAPE&&b.onCancel)a.stopPropagation(),a.preventDefault(),b.onCancel();else if(a.keyCode==c.TAB&&(a.stopPropagation(),a.preventDefault(),(a=this.getTopPopup())&&a.onCancel))a.onCancel()})));n.onCancel&&b.onCancel&&r.push(n.on("cancel",b.onCancel));r.push(n.on(n.onExecute?"execute":"change",a.hitch(this,function(){var a=this.getTopPopup();if(a&&a.onExecute)a.onExecute()})));d.push({widget:n,wrapper:E,parent:b.parent,
onExecute:b.onExecute,onCancel:b.onCancel,onClose:b.onClose,handlers:r});if(n.onOpen)n.onOpen(q);return q},close:function(a){for(var b=this._stack;a&&q.some(b,function(b){return b.widget==a})||!a&&b.length;){var c=b.pop(),d=c.widget,e=c.onClose;d.bgIframe&&(d.bgIframe.destroy(),delete d.bgIframe);if(d.onClose)d.onClose();for(var f;f=c.handlers.pop();)f.remove();d&&d.domNode&&this.hide(d);e&&e()}0==b.length&&this._aroundMoveListener&&(clearTimeout(this._aroundMoveListener),this._firstAroundNode=this._firstAroundPosition=
this._aroundMoveListener=null)}});return t.popup=new n})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(q,b,n,f){return q("dijit.DropDownMenu",f,{templateString:n,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(b){this._moveToPopup(b);b.stopPropagation();b.preventDefault()},_onLeftArrow:function(b){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();
else this.onCancel(!1);else b.stopPropagation(),b.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u){return b("dijit._MenuBase",[l,u,e,g],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),
this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){k.toggle(this.domNode,"dijitMenuActive",a);k.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,childSelector:function(b){var c=a.byNode(b);return b.parentNode==this.containerNode&&c&&c.focus},postCreate:function(){var b=this,e="string"==typeof this.childSelector?this.childSelector:
d.hitch(this,"childSelector");this.own(m(this.containerNode,m.selector(e,h.enter),function(){b.onItemHover(a.byNode(this))}),m(this.containerNode,m.selector(e,h.leave),function(){b.onItemUnhover(a.byNode(this))}),m(this.containerNode,m.selector(e,c),function(c){b.onItemClick(a.byNode(this),c);c.stopPropagation()}),m(this.containerNode,m.selector(e,"focusin"),function(){b._onItemFocus(a.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(a,b,c,d){this.inherited(arguments);if(a&&(-1==
d||a.popup&&1==d))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},
onItemHover:function(a){this.activated?(this.set("selected",a),!a.popup||a.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,{type:"click"})},this.passivePopupDelay));this._hoveredChild=a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==
a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&
(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;a.popup?(this.set("selected",a),this.set("activated",!0),b=/^key/.test(b._origType||b.type)||0==b.clientX&&0==b.clientY,this._openItemPopup(a,b)):(this.onExecute(),a._onClick?a._onClick(b):a.onClick(b))},_openItemPopup:function(a,b){if(a!=
this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var c=a.popup;c.parentMenu=this;this.own(this._mouseoverHandle=m.once(c.domNode,"mouseover",d.hitch(this,"_onPopupHover")));var e=this;a._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){b&&e.focusChild(a);e._cleanUp()},onExecute:d.hitch(this,"_cleanUp",!0),onClose:function(){e._mouseoverHandle&&(e._mouseoverHandle.remove(),delete e._mouseoverHandle)}},
b);this.currentPopupItem=a}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(f.set(this.selected.focusNode,"tabIndex",this.tabIndex),this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=
a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),function(q,b,n,f,k,d,h,m,p,c){return b("dijit._KeyNavContainer",
[p,c,m],{connectKeyNavHandlers:function(a,b){var c=this._keyNavCodes={},e=d.hitch(this,"focusPrev"),f=d.hitch(this,"focusNext");q.forEach(a,function(a){c[a]=e});q.forEach(b,function(a){c[a]=f});c[k.HOME]=d.hitch(this,"focusFirstChild");c[k.END]=d.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){f.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);q.forEach(this.getChildren(),d.hitch(this,"_startupChild"))},addChild:function(a,
b){this.inherited(arguments);this._startupChild(a)},_startupChild:function(a){a.set("tabIndex","-1")},_getFirst:function(){var a=this.getChildren();return a.length?a[0]:null},_getLast:function(){var a=this.getChildren();return a.length?a[a.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(a){return(a=h.byNode(a))&&a.getParent()==this}})})},
"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(q,b,n,f,k,d,h,m){return b("dijit._KeyNavMixin",m,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);n.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var b=this._keyNavCodes={};b[f.HOME]=k.hitch(this,"focusFirstChild");b[f.END]=k.hitch(this,"focusLastChild");b[this.isLeftToRight()?
f.LEFT_ARROW:f.RIGHT_ARROW]=k.hitch(this,"_onLeftArrow");b[this.isLeftToRight()?f.RIGHT_ARROW:f.LEFT_ARROW]=k.hitch(this,"_onRightArrow");b[f.UP_ARROW]=k.hitch(this,"_onUpArrow");b[f.DOWN_ARROW]=k.hitch(this,"_onDownArrow")}var c=this,b="string"==typeof this.childSelector?this.childSelector:k.hitch(this,"childSelector");this.own(d(this.domNode,"keypress",k.hitch(this,"_onContainerKeypress")),d(this.domNode,"keydown",k.hitch(this,"_onContainerKeydown")),d(this.domNode,"focus",k.hitch(this,"_onContainerFocus")),
d(this.containerNode,d.selector(b,"focusin"),function(a){c._onChildFocus(h.getEnclosingWidget(this),a)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},
focusChild:function(b,c){b&&(this.focusedChild&&b!==this.focusedChild&&this._onChildBlur(this.focusedChild),b.set("tabIndex",this.tabIndex),b.focus(c?"end":"start"))},_onContainerFocus:function(b){b.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){n.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(b){n.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex","-1"),this.lastFocusedChild=this.focusedChild,
this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(b){b&&b!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),b.set("tabIndex",this.tabIndex),this.lastFocused=b,this._set("focusedChild",b))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(b,c,a,d){b&&this.focusChild(b)},_keyboardSearchCompare:function(b,c){var a=b.domNode;b=(b.label||(a.focusNode?a.focusNode.label:"")||a.innerText||a.textContent||
"").replace(/^\s+/,"").substr(0,c.length).toLowerCase();return c.length&&b==c?-1:0},_isFormElement:function(b){return"INPUT"===b.tagName||"TEXTAREA"===b.tagName||"SELECT"===b.tagName||"BUTTON"===b.tagName},_onContainerKeydown:function(b){if(!this._isFormElement(document.activeElement)){var c=this._keyNavCodes[b.keyCode];c?(c(b,this.focusedChild),b.stopPropagation(),b.preventDefault(),this._searchString=""):b.keyCode!=f.SPACE||!this._searchTimer||b.ctrlKey||b.altKey||b.metaKey||(b.stopImmediatePropagation(),
b.preventDefault(),this._keyboardSearch(b," "))}},_onContainerKeypress:function(b){this._isFormElement(document.activeElement)||b.charCode<=f.SPACE||b.ctrlKey||b.altKey||b.metaKey||(b.preventDefault(),b.stopPropagation(),this._keyboardSearch(b,String.fromCharCode(b.charCode).toLowerCase()))},_keyboardSearch:function(b,c){var a=null,d,f=0;k.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=c;var b=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;
d=this._searchString.substr(0,b);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var g=this.focusedChild||null;if(1==b||!g)if(g=this._getNextFocusableChild(g,1),!g)return;b=g;do{var h=this._keyboardSearchCompare(g,d);h&&0==f++&&(a=g);if(-1==h){f=-1;break}g=this._getNextFocusableChild(g,1)}while(g&&g!=b)})();this.onKeyboardSearch(a,b,d,f)},_onChildBlur:function(){},_getNextFocusableChild:function(b,c){var a=b;do{if(b)b=this._getNext(b,
c);else if(b=this[0<c?"_getFirst":"_getLast"](),!b)break;if(null!=b&&b!=a&&b.isFocusable())return b}while(b!=a);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(b,c){if(b)for(b=b.domNode;b;)if((b=b[0>c?"previousSibling":"nextSibling"])&&"getAttribute"in b){var a=h.byNode(b);if(a)return a}return null}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],function(q,b,n){return q([b,
n],{})})},"dgrid/Grid":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/on dojo/has ./List ./util/misc dojo/_base/sniff".split(" "),function(q,b,n,f,k,d,h,m){function p(b,a){a&&a.nodeType&&b.appendChild(a)}q=q(h,{columns:null,hasNeutralSort:!1,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(b){return"object"!==typeof b?this.columns[b]:this.cell(b).column},listType:"grid",cell:function(b,a){if(b.column&&b.element)return b;b.target&&b.target.nodeType&&
(b=b.target);var c;if(b.nodeType){do{if(this._rowIdToObject[b.id])break;var d=b.columnId;if(d){a=d;c=b;break}b=b.parentNode}while(b&&b!==this.domNode)}if(!c&&"undefined"!==typeof a){var e=this.row(b);if(d=e&&e.element)for(var d=d.getElementsByTagName("td"),f=0;f<d.length;f++)if(d[f].columnId===a){c=d[f];break}}if(null!=b)return{row:e||this.row(b),column:a&&this.column(a),element:c}},createRowCells:function(b,a,f,g,e){var c=n.create("table",{className:"dgrid-row-table",role:"presentation"}),h=9>d("ie")?
n.create("tbody",null,c):c,l,k,p,q,v,z,A,B,C,E;f=f||this.subRows;k=0;for(p=f.length;k<p;k++)for(z=f[k],l=n.create("tr",null,h),z.className&&(l.className=z.className),q=0,v=z.length;q<v;q++){A=z[q];B=A.id;C=A.field?" field-"+m.escapeCssIdentifier(A.field,"-"):"";(E="function"===typeof A.className?A.className(g):A.className)&&(C+=" "+E);C=n.create(b,{className:"dgrid-cell"+(B?" dgrid-column-"+m.escapeCssIdentifier(B,"-"):"")+C,role:"th"===b?"columnheader":"gridcell"});C.columnId=B;if(B=A.colSpan)C.colSpan=
B;if(B=A.rowSpan)C.rowSpan=B;a(C,A,g,e);l.appendChild(C)}return c},_createBodyRowCell:function(b,a,d,f){var c=d;a.get?c=a.get(d):"field"in a&&"_item"!==a.field&&(c=d[a.field]);a.renderCell?p(b,a.renderCell(d,c,b,f)):this._defaultRenderCell.call(a,d,c,b,f)},_createHeaderRowCell:function(b,a){var c=a.headerNode=b,d=a.field;d&&(b.field=d);a.renderHeaderCell?p(c,a.renderHeaderCell(c)):("label"in a||a.field)&&c.appendChild(document.createTextNode("label"in a?a.label:a.field));!1!==a.sortable&&d&&"_item"!==
d&&(b.sortable=!0,b.className+=" dgrid-sortable")},left:function(b,a){b.element||(b=this.cell(b));return this.cell(this._move(b,-(a||1),"dgrid-cell"))},right:function(b,a){b.element||(b=this.cell(b));return this.cell(this._move(b,a||1,"dgrid-cell"))},_defaultRenderCell:function(b,a,d){if(this.formatter){var c=this.formatter,e=this.grid.formatterScope;d.innerHTML="string"===typeof c&&e?e[c](a,b):this.formatter(a,b)}else null!=a&&d.appendChild(document.createTextNode(a))},renderRow:function(c,a){c=
this.createRowCells("td",b.hitch(this,"_createBodyRowCell"),a&&a.subRows,c,a);a=n.create("div",{role:"row"});a.appendChild(c);return a},renderHeader:function(){var c=this,a=this.headerNode;a.setAttribute("role","row");n.empty(a);var f=this.createRowCells("th",b.hitch(this,"_createHeaderRowCell"),this.subRows&&this.subRows.headerRows);this._rowIdToObject[f.id=this.id+"-header"]=this.columns;a.appendChild(f);this._sortListener&&this._sortListener.remove();this._sortListener=k(f,"click,keydown",function(b){if("click"===
b.type||32===b.keyCode||!d("opera")&&13===b.keyCode){var e=b.target,f,g;do if(e.sortable){f=e.field||e.columnId;g=c.sort[0];f=c.hasNeutralSort&&g&&g.property===f&&g.descending?[]:[{property:f,descending:g&&g.property===f&&!g.descending}];g={bubbles:!0,cancelable:!0,grid:c,parentType:b.type,sort:f};k.emit(b.target,"dgrid-sort",g)&&(c._sortNode=e,c.set("sort",f));break}while((e=e.parentNode)&&e!==a)}})},resize:function(){var b=this.headerNode.firstChild,a=this.contentNode,d;this.inherited(arguments);
a.style.width="";a&&b&&(d=b.offsetWidth)>a.offsetWidth&&(a.style.width=d+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(){this.inherited(arguments);this.updateSortArrow(this.sort)},_findSortArrowParent:function(b){var a=this.columns,c;for(c in a){var d=a[c];if(d.field===b)return d.headerNode}},updateSortArrow:function(b,a){this._lastSortedArrow&&(f.remove(this._lastSortedArrow.parentNode,"dgrid-sort-up dgrid-sort-down"),
n.destroy(this._lastSortedArrow),delete this._lastSortedArrow);a&&(this.sort=b);b[0]&&(a=b[0].property,b=b[0].descending,a=this._sortNode||this._findSortArrowParent(a),delete this._sortNode,a&&(a=a.contents||a,this._lastSortedArrow=n.create("div",{className:"dgrid-sort-arrow ui-icon",innerHTML:"\x26nbsp;",role:"presentation"},a,"first"),f.add(a,"dgrid-sort-"+(b?"down":"up")),this.resize()))},styleColumn:function(b,a){return this.addCssRule("#"+m.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+
m.escapeCssIdentifier(b,"-"),a)},_configColumns:function(b,a){var c=[],d=a instanceof Array;m.each(a,function(e,f){"string"===typeof e&&(a[f]=e={label:e});d||e.field||(e.field=f);f=e.id=e.id||(isNaN(f)?f:b+f);this._configColumn&&(this._configColumn(e,a,b),f=e.id);d&&(this.columns[f]=e);e.grid=this;c.push(e)},this);return d?a:c},_destroyColumns:function(){this.cleanup()},configStructure:function(){var b=this.subRows,a=this._columns=this.columns;this.columns=!a||a instanceof Array?{}:a;if(b)for(a=0;a<
b.length;a++)b[a]=this._configColumns(a+"-",b[a]);else this.subRows=[this._configColumns("",a)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(b){this._destroyColumns();this.subRows=null;this.columns=b;this._updateColumns()},_setSubRows:function(b){this._destroyColumns();this.subRows=b;this._updateColumns()},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&
(this.sort.length?(this._lastSortedArrow=null,this.updateSortArrow(this.sort)):this.resize())}});q.appendIfNode=p;return q})},"dgrid/List":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/on dojo/has ./util/misc dojo/_base/sniff".split(" "),function(q,b,n,f,k,d,h){function m(a,b){a.className="dgrid-scrollbar-measure";document.body.appendChild(a);b=a["offset"+b]-a["client"+b];a.className="";a.parentNode&&document.body.removeChild(a);return b}function p(a){f.replace(this.domNode,
a,this._class||"");this._class=a}function c(){return this._class}var a=[];a.push("has-mozilla");d("touch")&&a.push("has-touch");f.add(document.documentElement,a);d.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});var l,g;d.add("dom-scrollbar-width",function(a,b,c){return m(c,"Width")});d.add("dom-scrollbar-height",function(a,b,c){return m(c,"Height")});d.add("dom-rtl-scrollbar-left",function(a,b,c){a=document.createElement("div");c.className="dgrid-scrollbar-measure";
c.setAttribute("dir","rtl");c.appendChild(a);document.body.appendChild(c);b=!!d("ie")||!1||/\bEdge\//.test(navigator.userAgent)||a.offsetLeft>=d("dom-scrollbar-width");c.className="";c.parentNode&&document.body.removeChild(c);n.destroy(a);c.removeAttribute("dir");return b});var e=0,u=function(){this._started&&this.resize()},t=q(null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,addUiClasses:!0,highlightDuration:250,resizeThrottleDelay:h.defaultDelay,resizeThrottleMethod:"throttleDelayed",
postscript:function(a,b){var c=this;(this._Row=function(a,b,c){this.id=a;this.data=b;this.element=c}).prototype.remove=function(){c.removeRow(this.element)};b&&(this.srcNodeRef=b=b.nodeType?b:document.getElementById(b));this.create(a,b)},listType:"list",create:function(a,b){b=this.domNode=b||document.createElement("div");var c;a&&(this.params=a,q.safeMixin(this,a),c=a["class"]||a.className||b.className);this.sort=this.sort||[];this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();
this.id=b.id=b.id||this.id||t.autoIdPrefix+e++;this.buildRendering();c&&p.call(this,c);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var a=this.domNode,c=this.addUiClasses,e=this,g,l,m;m=this.isRTL="rtl"===(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();a.className="";a.setAttribute("role","grid");f.add(a,"dgrid dgrid-"+this.listType+(c?" ui-widget":""));g=this.headerNode=n.create("div",
{className:"dgrid-header dgrid-header-row"+(c?" ui-widget-header":"")+(this.showHeader?"":" dgrid-header-hidden")},a);l=this.bodyNode=n.create("div",{className:"dgrid-scroller"},a);l.tabIndex=-1;this.headerScrollNode=n.create("div",{className:"dgrid-header dgrid-header-scroll dgrid-scrollbar-width"+(c?" ui-widget-header":"")},a);this.footerNode=n.create("div",{className:"dgrid-footer"+(this.showFooter?"":" dgrid-footer-hidden")},a);m&&(a.className+=" dgrid-rtl"+(d("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":
""));k(l,"scroll",function(b){e.showHeader&&(g.scrollLeft=b.scrollLeft||l.scrollLeft);b.stopPropagation();k.emit(a,"scroll",{scrollTarget:l})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=n.create("div",{className:"dgrid-content"+(c?" ui-widget-content":"")},this.bodyNode);"string"===typeof this.resizeThrottleMethod&&h[this.resizeThrottleMethod]?c=h[this.resizeThrottleMethod](u,this,this.resizeThrottleDelay):"function"===typeof this.resizeThrottleMethod?c=this.resizeThrottleMethod(b.hitch(this,
u),this.resizeThrottleDelay):(console.warn("Invalid value specified for resizeThrottleMethod:  "+this.resizeThrottleMethod),c=h.throttleDelayed(u,this,this.resizeThrottleDelay));this._resizeHandle=k(window,"resize",c);this._listeners.push(this._resizeHandle)},postCreate:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this.sort))},configStructure:function(){},resize:function(){var a=this.bodyNode,b=this.footerNode,b=this.showFooter?
b.offsetHeight:0;this.headerScrollNode.style.height=a.style.marginTop=this.headerNode.offsetHeight+"px";a.style.marginBottom=b+"px";l||(l=d("dom-scrollbar-width"),g=d("dom-scrollbar-height"),d("ie")&&(l++,g++),h.addCssRule(".dgrid-scrollbar-width","width: "+l+"px"),h.addCssRule(".dgrid-scrollbar-height","height: "+g+"px"),17!==l&&(h.addCssRule(".dgrid-header-row","right: "+l+"px"),h.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+l+"px")))},addCssRule:function(a,b){a=h.addCssRule(a,b);this.cleanAddedRules&&
this._listeners.push(a);return a},on:function(a,b){return k(this.domNode,a,b)},cleanup:function(){for(var a in this._rowIdToObject)if(this._rowIdToObject[a]!==this.columns){var b=document.getElementById(a);b&&this.removeRow(b,!0)}},destroy:function(){if(this._listeners){for(var a=this._listeners.length;a--;)this._listeners[a].remove();this._listeners=null}this._started=!1;this.cleanup();n.destroy(this.domNode)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoRowId=0;this.contentNode.innerHTML=
"";this.scrollTo({x:0,y:0})},highlightRow:function(a,b){var c="dgrid-highlight"+(this.addUiClasses?" ui-state-highlight":"");a=a.element||a;f.add(a,c);setTimeout(function(){f.remove(a,c)},b||this.highlightDuration)},adjustRowIndices:function(a){var b=a.rowIndex;if(-1<b){do-1<a.rowIndex&&(this.maintainOddEven&&f.contains(a,"dgrid-row")&&f.replace(a,1===b%2?"dgrid-row-odd":"dgrid-row-even",0===b%2?"dgrid-row-odd":"dgrid-row-even"),a.rowIndex=b++);while((a=a.nextSibling)&&a.rowIndex!==b)}},renderArray:function(a,
b,c){c=c||{};var d=c.start||0,e=document.createDocumentFragment(),f=[],g=0,h=a.length;b||(this._lastCollection=a);for(;g<h;)f[g]=this.insertRow(a[g],e,null,d++,c),g++;(a=b?b.parentNode:this.contentNode)&&a.parentNode&&(a!==this.contentNode||h)&&(a.insertBefore(e,b||null),h&&this.adjustRowIndices(f[h-1]));return f},renderHeader:function(){},_autoRowId:0,insertRow:function(a,b,c,d,e){var f=this.id+"-row-"+(this.collection&&this.collection.getIdentity?this.collection.getIdentity(a):this._autoRowId++),
g=document.getElementById(f),h=g&&g.previousSibling;g&&(g===c&&(c=(c.connected||c).nextSibling),this.removeRow(g,!1,e));g=this.renderRow(a,e);g.className=(g.className||"")+" dgrid-row "+(1===d%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?" ui-state-default":"");this._rowIdToObject[g.id=f]=a;b.insertBefore(g,c||null);g.rowIndex=d;h&&h.rowIndex!==g.rowIndex-1&&this.adjustRowIndices(h);return g},renderRow:function(a){var b=document.createElement("div");b.appendChild(document.createTextNode(a));
return b},removeRow:function(a,b){a=a.element||a;delete this._rowIdToObject[a.id];b||n.destroy(a)},row:function(a){var b;if(a instanceof this._Row)return a;a.target&&a.target.nodeType&&(a=a.target);if(a.nodeType){do{var c=a.id;if(b=this._rowIdToObject[c])return new this._Row(c.substring(this.id.length+5),b,a);a=a.parentNode}while(a&&a!==this.domNode)}else return"object"===typeof a?b=this.collection.getIdentity(a):(b=a,a=this._rowIdToObject[this.id+"-row-"+b]),new this._Row(b,a,document.getElementById(this.id+
"-row-"+b))},cell:function(a){return{row:this.row(a)}},_move:function(a,b,c,d){var e,f;f=e=a.element;b=b||1;do if(a=e[0>b?"previousSibling":"nextSibling"]){do if((e=a)&&-1<(e.className+" ").indexOf(c+" ")){f=e;b+=0>b?1:-1;break}while(a=(!d||!e.hidden)&&e[0>b?"lastChild":"firstChild"])}else if(e=e.parentNode,!e||e===this.bodyNode||e===this.headerNode)break;while(b);return f},up:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,-(b||1),"dgrid-row",c))},down:function(a,b,c){a.element||
(a=this.row(a));return this.row(this._move(a,b||1,"dgrid-row",c))},scrollTo:function(a){"undefined"!==typeof a.x&&(this.bodyNode.scrollLeft=a.x);"undefined"!==typeof a.y&&(this.bodyNode.scrollTop=a.y)},getScrollPosition:function(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}},get:function(a){var b="_get"+a.charAt(0).toUpperCase()+a.slice(1);return"function"===typeof this[b]?this[b].apply(this,[].slice.call(arguments,1)):this[a]},set:function(a,b){if("object"===typeof a)for(var c in a)this.set(c,
a[c]);else c="_set"+a.charAt(0).toUpperCase()+a.slice(1),"function"===typeof this[c]?this[c].apply(this,[].slice.call(arguments,1)):this[a]=b;return this},_getClass:c,_setClass:p,_getClassName:c,_setClassName:p,_setSort:function(a,b){this.sort="string"!==typeof a?a:[{property:a,descending:b}];this._applySort()},_applySort:function(){this.refresh();if(this._lastCollection){var a=this.sort;if(a&&0<a.length){var b=a[0].property,c=!!a[0].descending;this._lastCollection.sort(function(a,d){a=a[b];d=d[b];
void 0===a&&(a="");void 0===d&&(d="");return a===d?0:a>d!==c?1:-1})}this.renderArray(this._lastCollection)}},_setShowHeader:function(a){var b=this.headerNode;this.showHeader=a;f.toggle(b,"dgrid-header-hidden",!a);this.renderHeader();this.resize();a&&(b.scrollLeft=this.getScrollPosition().x)},_setShowFooter:function(a){this.showFooter=a;f.toggle(this.footerNode,"dgrid-footer-hidden",!a);this.resize()}});t.autoIdPrefix="dgrid_";return t})},"dgrid/util/misc":function(){define(["dojo/has"],function(q){var b=
[],n,f,k,d=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,h=setTimeout,m=clearTimeout;q.add("requestidlecallback",function(b){return"function"===typeof b.requestIdleCallback});var p={defaultDelay:15,throttle:function(b,a,d){var c=!1;d=d||p.defaultDelay;return function(){c||(c=!0,b.apply(a,arguments),h(function(){c=!1},d))}},throttleDelayed:function(b,a,d){var c=!1;d=d||p.defaultDelay;return function(){if(!c){c=!0;var e=arguments;h(function(){c=!1;b.apply(a,e)},d)}}},debounce:function(b,a,d){var c;d=d||p.defaultDelay;
return function(){c&&(m(c),c=null);var e=arguments;c=h(function(){c=null;b.apply(a,e)},d)}},each:function(b,a,d){var c,e;if(b)if("number"===typeof b.length)for(c=0,e=b.length;c<e;c++)a.call(d,b[c],c,b);else for(c in b)a.call(d,b[c],c,b)},addCssRule:function(c,a){n||(n=document.createElement("style"),document.getElementsByTagName("head")[0].appendChild(n),n=n.sheet||n.styleSheet,f=n.deleteRule?"deleteRule":"removeRule",k=n.cssRules?"cssRules":"rules");var d=b.length;b[d]=(n.cssRules||n.rules).length;
n.addRule?n.addRule(c,a):n.insertRule(c+"{"+a+"}",b[d]);return{get:function(a){return n[k][b[d]].style[a]},set:function(a,c){"undefined"!==typeof b[d]&&(n[k][b[d]].style[a]=c)},remove:function(){var a=b[d],c,h;if(void 0!==a)for(n[f](a),b[d]=void 0,c=d+1,h=b.length;c<h;c++)b[c]>a&&b[c]--}}},escapeCssIdentifier:function(b,a){return"string"===typeof b?b.replace(d,a||"\\$1"):b}};return p})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/on dojo/when dojo/query ./util/misc".split(" "),
function(q,b,n,f,k,d,h,m,p){function c(a){return a&&(0<=a.className.indexOf("dgrid-row")||0<=a.className.indexOf("dgrid-loading"))}function a(a){return a&&0<=a.className.indexOf("dgrid-preload")}var l=0;return n([q,b],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:p.defaultDelay,keepScrollPosition:!1,rowHeight:0,_deleteQueue:[],postCreate:function(){this.inherited(arguments);var a=this;d(this.bodyNode,
"scroll",p[this.pagingMethod](function(b){a._processScroll(b)},null,this.pagingDelay))},renderQuery:function(a,b){var c=this,d=b&&b.container||this.contentNode,e,g,m,p,n=0,q=b&&b.start||0;"level"in a&&(n=p=a.level);e={query:a,count:0,level:n,top:!1};var A={node:k.create("div",{className:"dgrid-preload",style:{height:"0"}},d),count:0,query:a,next:e,level:n,top:!0};g=A.node;g.rowIndex=0;e.previous=A;m=e.node=k.create("div",{className:"dgrid-preload",style:{height:"0"}},d);A.id=l++;g.setAttribute("data-preloadid",
A.id);e.id=l++;m.setAttribute("data-preloadid",e.id);m.rowIndex=this.minRowsPerPage;c._insertPreload(A);var B=k.create("div",{className:"dgrid-loading"},m,"before");k.create("div",{className:"dgrid-below"},B).innerHTML=this.loadingMessage;b=f.mixin({start:0,count:this.minRowsPerPage},b);null!=p&&(b.queryLevel=p);return this._trackError(function(){var d=a(b);return c.renderQueryResults(d,m,b).then(function(a){return d.totalLength.then(function(d){var f=a.length,l=m.parentNode;!c._rows||"queryLevel"in
b||(c._rows.min=0,c._rows.max=f===d?Infinity:f-1);k.destroy(B);"queryLevel"in b||(c._total=d);0===d&&l&&(c.noDataNode&&k.destroy(c.noDataNode),c._insertNoDataNode(l));A.count=q;e.count=d-f-q;m.rowIndex=q+f;d?c._updatePreloadRowHeights(A):(m.style.display="none",g.style.display="none");c._previousScrollPosition&&l.offsetHeight&&(c.scrollTo(c._previousScrollPosition),delete c._previousScrollPosition);return h(c._processScroll()).then(function(){return a})})}).otherwise(function(a){k.destroy(B);throw a;
})})},_insertPreload:function(a){var b=this.preload;if(b){for(;b.node.compareDocumentPosition(a.node)&Node.DOCUMENT_POSITION_PRECEDING;)if(b=b.previous,null==b)return;for(;b.node.compareDocumentPosition(a.node)&Node.DOCUMENT_POSITION_FOLLOWING&&b.next;)b=b.next;b.previous.next=a;a.previous=b.previous;a=a.next;a.next=b;b.previous=a}else this.preload=a},refresh:function(a){var b=this,c=a&&a.keepScrollPosition;"undefined"===typeof c&&(c=this.keepScrollPosition);c&&(this._previousScrollPosition=this.getScrollPosition());
this.inherited(arguments);if(this._renderedCollection)return this.renderQuery(function(a){return b._renderedCollection.fetchRange({start:a.start,end:a.start+a.count})}).then(function(){b._emitRefreshComplete()})},resize:function(){this.inherited(arguments);this._processScroll()},cleanup:function(){this.inherited(arguments);this.preload=null},renderQueryResults:function(a){var b=this.inherited(arguments),c=this._getRenderedCollection(this.preload);c&&c.releaseRange&&b.then(function(b){b[0]&&!b[0].parentNode.tagName&&
a.totalLength.then(function(){c.releaseRange(b[0].rowIndex,b[b.length-1].rowIndex+1)})});return b},_getFirstRowSibling:function(a){return a.lastChild},_calcRowHeight:function(a){var b=a.nextSibling;return b&&!/\bdgrid-preload\b/.test(b.className)?b.offsetTop-a.offsetTop:a.offsetHeight},_calcAverageRowHeight:function(a){for(var b=a.length,c=0,d=0;d<b;d++)c+=this._calcRowHeight(a[d]);return b&&c?c/b:0},_updatePreloadRowHeights:function(){var a=this.preload;if(a){for(;a.previous;)a=a.previous;for(;a;)a.rowHeight||
(a.rowHeight=this.rowHeight||this._calcAverageRowHeight(a.node.parentNode.querySelectorAll(".dgrid-row")),this._adjustPreloadHeight(a)),a=a.next}},lastScrollTop:0,_processScroll:function(b){function d(a,b){b=b?"next":"previous";for(var c;c=a[b];)a=c;return a}function f(b,e){function f(){var c;a:{c=!e;for(var d=b;d=d[e?"previous":"next"];)if(c===d.top){c=d;break a}c=void 0}if(c&&l!==c&&!a(c.top?c.node.nextSibling:c.node.previousSibling))return h(),b=c,r=b.node,k=e?b.node.offsetTop-q:n-(b.node.offsetTop+
b.node.offsetHeight),y=(c=g(r))&&c.rowIndex,v=void 0,c}function g(b){var d=a(b);(b=b[u])&&!c(b)&&(b=d&&a(b)?null:(d=f())?d:g(b));return b}function h(){b.count+=t;e&&(r.rowIndex-=t);m._adjustPreloadHeight(b);t=0;m._releaseRange(b,e,y,v)}var l=b;b=d(b,e);var k=e?b.node.offsetTop-q:n-(b.node.offsetTop+b.node.offsetHeight),p=m.farOffRemoval,r=b.node,u=e?"previousSibling":"nextSibling",t=0,w=0,y,v;if(k>2*p){var x;y=(x=g(r))&&x.rowIndex;for(v=void 0;x&&l!==b;){var z=m._calcRowHeight(x);w+z+p>k||!c(x)?x=
f():(w+=z,t+=x.count||1,m._pruneRow(x,e),"rowIndex"in x&&(v=x.rowIndex),x=g(x))}h();m._deleteNodeQueue()}}function g(a,b){do a=b?a.next:a.previous;while(a&&!a.node.offsetWidth);return a}var h=this.preload,l;this._updatePreloadRowHeights();if(l=h&&h.rowHeight){var m=this,p=m.bodyNode,n=b&&b.scrollTop||this.getScrollPosition().y,q=p.offsetHeight+n,A;b=m.lastScrollTop;var p=m.bufferRows*l,B=p-l,C,E=!0;for(m.lastScrollTop=n;h&&!h.node.offsetWidth;)h=h.previous;for(;h&&h!==A;){A=m.preload;m.preload=h;
l=h.node;var F=l.offsetTop;if(q+1+B<F)h=g(h,E=!1);else if(n-1-B>F+l.offsetHeight)h=g(h,E=!0);else{var F=((l.top?n-p:q)-F)/h.rowHeight,H=(q-n+2*p)/h.rowHeight,H=H+Math.min(Math.abs(Math.max(Math.min((n-b)*h.rowHeight,m.maxRowsPerPage/2),m.maxRowsPerPage/-2)),10);l.top&&(F-=H);F=Math.max(F,0);10>F&&0<F&&H+F<m.maxRowsPerPage&&(H+=Math.max(0,F),F=0);H=Math.min(Math.max(H,m.minRowsPerPage),m.maxRowsPerPage,h.count);if(0===H)h=g(h,E);else{var H=Math.ceil(H),F=Math.min(Math.floor(F),h.count-H),D={};h.count-=
H;var G=l,K,M=m.queryRowsOverlap,O=!h.top&&h;O?(h.previous&&(f(h),0<F&&a(l.previousSibling)?(F=Math.min(h.count,F),h.previous.count+=F,m._adjustPreloadHeight(h.previous,!0),l.rowIndex+=F,M=0):H+=F,h.count-=F),D.start=l.rowIndex-M,D.count=Math.min(H+M,m.maxRowsPerPage),l.rowIndex=D.start+D.count):(h.next&&(G=l.nextSibling,f(h,!0),a(l.nextSibling)?(h.next.count+=h.count-F,h.next.node.rowIndex=F+H,m._adjustPreloadHeight(h.next),h.count=F,M=0,G=h.next.node):K=!0),D.start=h.count,D.count=Math.min(H+M,
m.maxRowsPerPage),D.scrollingUp=!0);K&&G&&G.offsetWidth&&(K=G.offsetTop);m._adjustPreloadHeight(h);"level"in h.query&&(D.queryLevel=h.query.level);if("queryLevel"in D||!(D.start>m._total||0>D.count)){var N=k.create("div",{className:"dgrid-loading",style:{height:H*h.rowHeight+"px"}},G,"before");k.create("div",{className:"dgrid-"+(O?"below":"above"),innerHTML:m.loadingMessage},N);N.count=H;m._trackError(function(){(function(a,b,c){var d=h.query(D);C=m.renderQueryResults(d,a,D).then(function(e){var f=
m._rows;!f||"queryLevel"in D||!e.length||(b?(f.max<=f.min&&(f.min=e[0].rowIndex),f.max=e[e.length-1].rowIndex):(f.max<=f.min&&(f.max=e[e.length-1].rowIndex),f.min=e[0].rowIndex));G=a.nextSibling;k.destroy(a);c&&G&&G.offsetWidth&&m.scrollTo({y:m.bodyNode.scrollTop+G.offsetTop-c});d.totalLength.then(function(a){"queryLevel"in D||(m._total=a,m._rows&&m._rows.max>=m._total-1&&(m._rows.max=Infinity));b&&(b.count=a-b.node.rowIndex,m._adjustPreloadHeight(b))});m._processScroll();return e},function(b){k.destroy(a);
throw b;})})(N,O,K)});h=h.previous}}}}return C}},_adjustPreloadHeight:function(a,b){a.node.style.height=this._calculatePreloadHeight(a,b)+"px"},_calculatePreloadHeight:function(a,b){return Math.min(a.count*a.rowHeight,b?Infinity:this.maxEmptySpace)},_pruneRow:function(a,b,c){this.removeRow(a,!0,c);this._queueNodeForDeletion(a)},_queueNodeForDeletion:function(a){this._deleteQueue.push(a)},_deleteNodeQueue:function(){for(var a=document.createElement("div"),b=this._deleteQueue,c=b.length;c--;)a.appendChild(b[c]);
this._deleteQueue=[];setTimeout(function(){k.destroy(a)},1)},_removePreloads:function(a){if(a&&a.length){var b=this,c=this._getHeadPreload();a.forEach(function(a){if(a=b._findPreload(a,c))a.previous&&(a.previous.next=a.next),a.next&&(a.next.previous=a.previous)})}},_getHeadPreload:function(){var a=this.preload;if(a)for(;a.previous;)a=a.previous;return a},_findPreload:function(a,b){for(b||(b=this._getHeadPreload());b;){if(b.node===a)return b;b=b.next}},_getRenderedCollection:function(){return this._renderedCollection},
_releaseRange:function(a,b,c,d){if(a){var e=a.level;a=this._getRenderedCollection(a);null!=d&&a.releaseRange&&"number"===typeof c&&"number"===typeof d&&(b?a.releaseRange(d,c+1):a.releaseRange(c,d+1),this._rows&&!e&&(this._rows[b?"max":"min"]=d,this._rows.max>=this._total-1&&(this._rows.max=Infinity)))}}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/aspect dojo/dom-construct dojo/has dojo/on dojo/when".split(" "),function(q,b,n,f,k,d,h,m){function p(b){if("object"!==
typeof b)b=Error(b);else if("cancel"===b.dojoType)return;h.emit(this.domNode,"dgrid-error",{grid:this,error:b,cancelable:!0,bubbles:!0})&&console.error(b)}return q(null,{collection:null,_renderedCollection:null,_rows:null,_observerHandle:null,shouldTrackCollection:!0,getBeforePut:!0,noDataMessage:"",loadingMessage:"",_total:0,constructor:function(){this.dirty={};this._updating={};this._columnsWithSet={};f.before(this,"configStructure",b.hitch(this,function(){this._columnsWithSet={}}))},destroy:function(){this.inherited(arguments);
this._renderedCollection&&this._cleanupCollection();this._refreshTimeout&&clearTimeout(this._refreshTimeout)},_configColumn:function(b){b.set&&(this._columnsWithSet[b.field]=b);this.inherited(arguments)},_setCollection:function(b){this._renderedCollection&&(this.cleanup(),this._cleanupCollection({shouldRevert:!b||b.storage!==this._renderedCollection.storage}));this.collection=b;if(this._started){if(b){var a=b;this.sort&&0<this.sort.length&&(a=b.sort(this.sort));a.track&&this.shouldTrackCollection&&
(a=a.track(),this._rows=[],this._observerHandle=this._observeCollection(a,this.contentNode,{rows:this._rows}));this._renderedCollection=a}this.refresh()}},_setStore:function(){this.collection||console.debug("set('store') call detected, but you probably meant set('collection')")},_getTotal:function(){return this._total},_cleanupCollection:function(b){b=b||{};this._renderedCollection.tracking&&this._renderedCollection.tracking.remove();this._observerHandle&&(this._observerHandle.remove(),this._observerHandle=
this._rows=null);!1!==b.shouldRevert&&(this.dirty={});this._renderedCollection=this.collection=null},_applySort:function(){this.collection?this.set("collection",this.collection):this.store&&console.debug("_StoreMixin found store property but not collection; this is often the sign of a mistake during migration from 0.3 to 0.4")},_emitRefreshComplete:function(){var b=this;this._refreshTimeout=setTimeout(function(){h.emit(b.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:b});b._refreshTimeout=
null},0)},_insertNoDataNode:function(b){this._removeNoDataNode();b=b||this.contentNode;var a=this.noDataNode=k.create("div",{className:"dgrid-no-data",innerHTML:this.noDataMessage});b.insertBefore(a,this._getFirstRowSibling?this._getFirstRowSibling(b):null);return a},_removeNoDataNode:function(){return this.noDataNode?(k.destroy(this.noDataNode),delete this.noDataNode,!0):!1},row:function(){var b=this.inherited(arguments);b&&b.data&&"undefined"!==typeof b.id&&(b.id=this.collection.getIdentity(b.data));
return b},refresh:function(){var b=this.inherited(arguments);this.collection||this._insertNoDataNode();return b},refreshCell:function(c){if(!this.collection||!this._createBodyRowCell)throw Error("refreshCell requires a Grid with a collection.");this.inherited(arguments);return this.collection.get(c.row.id).then(b.hitch(this,"_refreshCellFromItem",c))},_refreshCellFromItem:function(c,a,d){var f=c.element;k.empty(f);var e=this.dirty&&this.dirty[c.row.id];e&&(a=b.delegate(a,e));this._createBodyRowCell(f,
c.column,a,d)},renderArray:function(){var b=this.inherited(arguments);this.collection||b.length&&this.noDataNode&&k.destroy(this.noDataNode);return b},insertRow:function(c,a,d,f,e){var g=this.collection,h=this.dirty,g=g&&g.getIdentity(c),l;g in h&&!(g in this._updating)&&(l=h[g]);l&&(c=b.delegate(c,l));h=this.inherited(arguments);e&&e.rows&&(e.rows[f]=h);this.noDataNode&&(k.destroy(this.noDataNode),this.noDataNode=null);return h},updateDirty:function(b,a,d){var c=this.dirty,e=c[b];e||(e=c[b]={});
e[a]=d},save:function(){function b(b,c){return function(e){var g=a._columnsWithSet,l=a._updating,k,m;if("function"===typeof e.set)e.set(c);else for(k in c)e[k]=c[k];for(k in g)m=g[k].set(e),void 0!==m&&(e[k]=m);l[b]=!0;return d.put(e).then(function(a){delete f[b];delete l[b];h[b]=a;return h})}}var a=this,d=this.collection,f=this.dirty,e=new n,h={},k=function(b){var c;return a.getBeforePut||!(c=a.row(b).data)?function(){return d.get(b)}:function(){return c}},m=e.then(function(){return h}),p;for(p in f)var q=
b(p,f[p]),m=m.then(k(p)).then(q);e.resolve();return m},revert:function(){this.dirty={};this.refresh()},_trackError:function(c){"string"===typeof c&&(c=b.hitch(this,c));var a=this,d;try{d=m(c())}catch(g){c=new n,c.reject(g),d=c.promise}d.otherwise(function(b){p.call(a,b)});return d},removeRow:function(b,a,d){var c={element:b};a||this.up(c).element!==b||this.down(c).element!==b||this._insertNoDataNode();(c=d&&d.rows||this._rows)&&delete c[b.rowIndex];return this.inherited(arguments)},renderQueryResults:function(c,
a,d){d=b.mixin({rows:this._rows},d);var f=this;return c.then(function(b){b=f.renderArray(b,a,d);delete f._lastCollection;return b})},_observeCollection:function(b,a,d){var c=this,e=d.rows,f,h=[b.on("delete, update",function(b){var g=b.previousIndex,h=b.index;void 0!==g&&e[g]&&("max"in e&&(void 0===h||h<e.min||h>e.max)&&e.max--,f=e[g],f.parentNode===a&&c.removeRow(f,!1,d),e.splice(g,1),("delete"===b.type||"update"===b.type&&(g<h||void 0===h))&&e[g]&&e[g].rowIndex--);"delete"===b.type&&(f=null)}),b.on("add, update",
function(b){var g=b.previousIndex,h=b.index;if(void 0!==h&&(!("max"in e)||h>=e.min&&h<=e.max)){"max"in e&&(void 0===g||g<e.min||g>e.max)&&e.max++;if(e.length){if(g=e[h],!g&&(g=e[h-1]))g=(g.connected||g).nextSibling}else g=c._getFirstRowSibling&&c._getFirstRowSibling(a);f&&g&&f.id===g.id&&(g=(g.connected||g).nextSibling);g&&!g.parentNode&&(g=document.getElementById(g.id));e.splice(h,0,void 0);f=c.insertRow(b.target,a,g,h,d);c.highlightRow(f)}f=null}),b.on("add, delete, update",function(a){var d="undefined"!==
typeof a.previousIndex?a.previousIndex:Infinity,f="undefined"!==typeof a.index?a.index:Infinity,g=Math.min(d,f);d!==f&&e[g]&&c.adjustRowIndices(e[g]);Infinity!==d&&c._processScroll&&(e[d]||e[d-1])&&c._processScroll();c._onNotification(e,a,b);b===c._renderedCollection&&"totalLength"in a&&(c._total=a.totalLength)})];return{remove:function(){for(;0<h.length;)h.pop().remove()}}},_onNotification:function(){}})})},"dgrid/Selection":function(){define("dojo/_base/declare dojo/dom-class dojo/on dojo/has dojo/aspect ./List dojo/has!touch?./util/touch dojo/query dojo/_base/sniff dojo/dom".split(" "),
function(q,b,n,f,k,d,h){function m(a,b){b=a.unselectable=b?"on":"";a=a.getElementsByTagName("*");for(var c=a.length;--c;)"INPUT"!==a[c].tagName&&"TEXTAREA"!==a[c].tagName&&(a[c].unselectable=b)}function p(a,b){var d=a.bodyNode,e=b?"text":"-moz-none";c&&"msUserSelect"!==c?d.style[c]=e:f("dom-selectstart")?b||a._selectstartHandle?b&&a._selectstartHandle&&(a._selectstartHandle.remove(),delete a._selectstartHandle):a._selectstartHandle=n(d,"selectstart",function(a){var b=a.target&&a.target.tagName;"INPUT"!==
b&&"TEXTAREA"!==b&&a.preventDefault()}):(m(d,!b),b||a._unselectableHandle)?b&&a._unselectableHandle&&(a._unselectableHandle.remove(),delete a._unselectableHandle):a._unselectableHandle=k.after(a,"renderRow",function(a){m(a,!0);return a})}f.add("dom-comparedocumentposition",function(a,b,c){return!!c.compareDocumentPosition});f.add("dom-selectstart","undefined"!==typeof document.onselectstart);var c=f("css-user-select"),a=(d=f("pointer"))&&"MS"===d.slice(0,2),l=d?d+(a?"Down":"down"):"mousedown",g=d?
d+(a?"Up":"up"):"mouseup";"WebkitUserSelect"===c&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(c=!1);return q(null,{selectionDelegate:".dgrid-row",selectionEvents:l+","+g+",dgrid-cellfocusin",selectionTouchEvents:f("touch")?h.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);
this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!==this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},
_setAllowTextSelection:function(a){"undefined"!==typeof a?p(this,a):p(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(a,b){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(b))&&("dgrid-cellfocusin"!==a.type||"mousedown"!==a.parentType)&&(a.type!==g||b===this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=a;if(!a.keyCode||!a.ctrlKey||32===a.keyCode)if(!a.shiftKey&&a.type===l&&this.isSelected(b))this._waitForMouseUp=b;else this[this._selectionHandlerName](a,
b);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(a,b){a=a.keyCode?a.ctrlKey:a.metaKey;this._lastSelected===b?this.select(b,null,!a||!this.isSelected(b)):(this.clearSelection(),this.select(b),this._lastSelected=b)},_multipleSelectionHandler:function(a,b){var c=this._lastSelected,d=a.keyCode?a.ctrlKey:a.metaKey,e;a.shiftKey||(e=d?null:!0,c=null);this.select(b,c,e);c||(this._lastSelected=b)},_extendedSelectionHandler:function(a,b){(2===a.button?this.isSelected(b):a.keyCode?a.ctrlKey:
a.metaKey)||this.clearSelection(null,!0);this._multipleSelectionHandler(a,b)},_toggleSelectionHandler:function(a,b){this.select(b,null,null)},_initSelectionEvents:function(){var a=this,b=this.contentNode,c=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};f("touch")&&!f("pointer")&&this.selectionTouchEvents?(n(b,h.selector(c,this.selectionTouchEvents),function(b){a._handleSelect(b,this);a._ignoreMouseSelect=this}),n(b,n.selector(c,this.selectionEvents),function(b){a._ignoreMouseSelect!==
this?a._handleSelect(b,this):b.type===g&&(a._ignoreMouseSelect=null)})):n(b,n.selector(c,this.selectionEvents),function(b){a._handleSelect(b,this)});this.addKeyHandler&&this.addKeyHandler(32,function(b){a._handleSelect(b,b.target)});if(this.allowSelectAll)this.on("keydown",function(b){b.metaKey&&65===b.keyCode&&!/\bdgrid-input\b/.test(b.target.className)&&(b.preventDefault(),a[a.allSelected?"clearSelection":"selectAll"]())});this._setCollection&&k.before(this,"_setCollection",function(b){a._updateDeselectionAspect(b)});
this._updateDeselectionAspect()},_updateDeselectionAspect:function(a){function b(a,b){if((a=c.row(a))&&c.selection[a.id])c[b](a)}var c=this,d;this._removeDeselectSignals&&this._removeDeselectSignals();d=a&&a.track&&this._observeCollection?[k.before(this,"_observeCollection",function(a){d.push(a.on("delete",function(a){"undefined"===typeof a.index&&b(a.id,"deselect")}))}),k.after(this,"_observeCollection",function(a){d.push(a.on("update",function(c){"undefined"!==typeof c.index&&b(a.getIdentity(c.target),
"select")}))},!0)]:[k.before(this,"removeRow",function(a,b){b||(a=this.row(a))&&a.id in this.selection&&this.deselect(a)})];this._removeDeselectSignals=function(){for(var a=d.length;a--;)d[a].remove();d=[]}},allowSelect:function(){return!0},_fireSelectionEvent:function(a){var b=this._selectionEventQueues[a],c=this._selectionTriggerEvent,d;d={bubbles:!0,grid:this};c&&(d.parentType=c.type);d[this._selectionTargetType]=b;this._selectionEventQueues[a]=[];n.emit(this.contentNode,"dgrid-"+a,d)},_fireSelectionEvents:function(){var a=
this._selectionEventQueues,b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},_select:function(a,c,d){var e,f,g;"undefined"===typeof d&&(d=!0);a.element||(a=this.row(a));if(!1===d||this.allowSelect(a))if(e=this.selection,f=!!e[a.id],null===d&&(d=!f),g=a.element,d||this.allSelected?e[a.id]=d:delete this.selection[a.id],g&&(d?b.add(g,"dgrid-selected"+(this.addUiClasses?" ui-state-active":"")):b.remove(g,"dgrid-selected ui-state-active")),d!==f&&g&&this._selectionEventQueues[(d?"":"de")+"select"].push(a),
c)if(c.element||(c=this.row(c)),c){if(c=c.element)for(e=this._determineSelectionDirection(g,c),e||(c=document.getElementById(c.id),e=this._determineSelectionDirection(g,c));a.element!==c&&(a=this[e](a));)this._select(a,null,d)}else this._lastSelected=g,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},
_determineSelectionDirection:f("dom-comparedocumentposition")?function(a,b){a=b.compareDocumentPosition(a);return a&1?!1:2===a?"down":"up"}:function(a,b){return 1>b.sourceIndex?!1:b.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,b,c){this._select(a,b,c);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var c in this.selection)a!==c&&this._select(c,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},
selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},
renderArray:function(){var a=this.inherited(arguments),b=this.selection,c,d,f;for(c=0;c<a.length;c++)d=this.row(a[c]),(f=d.id in b?b[d.id]:this.allSelected)&&this.select(d,null,f);this._fireSelectionEvents();return a}})})},"dojo/store/Memory":function(){define(["../_base/declare","./util/QueryResults","./util/SimpleQueryEngine"],function(q,b,n){return q("dojo.store.Memory",null,{constructor:function(b){for(var f in b)this[f]=b[f];this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:n,
get:function(b){return this.data[this.index[b]]},getIdentity:function(b){return b[this.idProperty]},put:function(b,k){var d=this.data,f=this.index,m=this.idProperty,m=b[m]=k&&"id"in k?k.id:m in b?b[m]:Math.random();if(m in f){if(k&&!1===k.overwrite)throw Error("Object already exists");d[f[m]]=b}else f[m]=d.push(b)-1;return m},add:function(b,k){(k=k||{}).overwrite=!1;return this.put(b,k)},remove:function(b){var f=this.index,d=this.data;if(b in f)return d.splice(f[b],1),this.setData(d),!0},query:function(f,
k){return b(this.queryEngine(f,k)(this.data))},setData:function(b){b.items?(this.idProperty=b.identifier||this.idProperty,b=this.data=b.items):this.data=b;this.index={};for(var f=0,d=b.length;f<d;f++)this.index[b[f][this.idProperty]]=f}})})},"dojo/store/util/QueryResults":function(){define(["../../_base/array","../../_base/lang","../../when"],function(q,b,n){var f=function(k){function d(b){k[b]=function(){var d=arguments,c=n(k,function(a){Array.prototype.unshift.call(d,a);return f(q[b].apply(q,d))});
if("forEach"!==b||h)return c}}if(!k)return k;var h=!!k.then;h&&(k=b.delegate(k));d("forEach");d("filter");d("map");null==k.total&&(k.total=n(k,function(b){return b.length}));return k};b.setObject("dojo.store.util.QueryResults",f);return f})},"dojo/store/util/SimpleQueryEngine":function(){define(["../../_base/array"],function(q){return function(b,n){function f(d){d=q.filter(d,b);var f=n&&n.sort;f&&d.sort("function"==typeof f?f:function(b,c){for(var a,d=0;a=f[d];d++){var g=b[a.attribute],e=c[a.attribute],
g=null!=g?g.valueOf():g,e=null!=e?e.valueOf():e;if(g!=e)return!!a.descending==(null==g||g>e)?-1:1}return 0});if(n&&(n.start||n.count)){var k=d.length;d=d.slice(n.start||0,(n.start||0)+(n.count||Infinity));d.total=k}return d}switch(typeof b){default:throw Error("Can not query with a "+typeof b);case "object":case "undefined":var k=b;b=function(b){for(var d in k){var f=k[d];if(f&&f.test){if(!f.test(b[d],b))return!1}else if(f!=b[d])return!1}return!0};break;case "string":if(!this[b])throw Error("No filter function "+
b+" was found in store");b=this[b];case "function":}f.matches=b;return f}})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(q,b,n,f,k,d,h,m,p,c,a,l){n.isAsync||m(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var g=b("dojo.dnd.Source",a,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,
autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(a,b){f.mixin(this,f.mixin({},b));a=this.accept;if(a.length)for(this.accept={},b=0;b<a.length;++b)this.accept[a[b]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&k.add(this.node,"dojoDndSource");this.targetState="";this.accept&&k.add(this.node,"dojoDndTarget");this.horizontal&&k.add(this.node,"dojoDndHorizontal");this.topics=
[p.subscribe("/dnd/source/over",f.hitch(this,"onDndSourceOver")),p.subscribe("/dnd/start",f.hitch(this,"onDndStart")),p.subscribe("/dnd/drop",f.hitch(this,"onDndDrop")),p.subscribe("/dnd/cancel",f.hitch(this,"onDndCancel"))]},checkAcceptance:function(a,b){if(this==a)return!this.copyOnly||this.selfAccept;for(var c=0;c<b.length;++c){for(var d=a.getItem(b[c].id).type,e=!1,f=0;f<d.length;++f)if(d[f]in this.accept){e=!0;break}if(!e)return!1}return!0},copyState:function(a,b){if(a)return!0;2>arguments.length&&
(b=this==l.manager().target);if(b){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){g.superclass.destroy.call(this);q.forEach(this.topics,function(a){a.remove()});this.targetAnchor=null},onMouseMove:function(a){if(!this.isDragging||"Disabled"!=this.targetState){g.superclass.onMouseMove.call(this,a);var b=l.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(a.pageX-this._lastX)>this.delay||Math.abs(a.pageY-this._lastY)>this.delay)){var e=
this.getSelectedNodes();e.length&&b.startDrag(this,e,this.copyState(c.getCopyKeyState(a),!0))}this.isDragging&&(e=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=d.position(this.current,!0)),e=this.horizontal?a.pageX-this.targetBox.x<this.targetBox.w/2==d.isBodyLtr(this.current.ownerDocument):a.pageY-this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||e!=this.before)&&(this._markTargetAnchor(e),b.canDrop(!this.current||b.source!=this||!(this.current.id in
this.selection)))}},onMouseDown:function(a){this.mouseDown||!this._legalMouseDown(a)||this.skipForm&&c.isFormElement(a)||(this.mouseDown=!0,this._lastX=a.pageX,this._lastY=a.pageY,g.superclass.onMouseDown.call(this,a))},onMouseUp:function(a){this.mouseDown&&(this.mouseDown=!1,g.superclass.onMouseUp.call(this,a))},onDndSourceOver:function(a){this!==a?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(a=l.manager(),a.canDrop("Disabled"!=this.targetState&&(!this.current||
a.source!=this||!(this.current.id in this.selection))))},onDndStart:function(a,b,c){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==a?c?"Copied":"Moved":"");b=this.accept&&this.checkAcceptance(a,b);this._changeState("Target",b?"":"Disabled");this==a&&l.manager().overSource(this);this.isDragging=!0},onDndDrop:function(a,b,c,d){if(this==d)this.onDrop(a,b,c);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=
!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(a,b,c){if(this!=a)this.onDropExternal(a,b,c);else this.onDropInternal(b,c)},onDropExternal:function(a,b,d){var e=this._normalizedCreator;this._normalizedCreator=this.creator?function(b,c){return e.call(this,a.getItem(b.id).data,c)}:d?function(b){var d=a.getItem(b.id);b=b.cloneNode(!0);b.id=c.getUniqueId();return{node:b,data:d.data,type:d.type}}:function(b){var c=a.getItem(b.id);a.delItem(b.id);
return{node:b,data:c.data,type:c.type}};this.selectNone();d||this.creator||a.selectNone();this.insertNodes(!0,b,this.before,this.current);!d&&this.creator&&a.deleteSelectedNodes();this._normalizedCreator=e},onDropInternal:function(a,b){var d=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(b)this._normalizedCreator=this.creator?function(a,b){return d.call(this,this.getItem(a.id).data,b)}:function(a){var b=this.getItem(a.id);a=a.cloneNode(!0);a.id=c.getUniqueId();return{node:a,
data:b.data,type:b.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var b=this.getItem(a.id);return{node:a,data:b.data,type:b.type}}}this._removeSelection();this.insertNodes(!0,a,this.before,this.current);this._normalizedCreator=d}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){g.superclass.onOverEvent.call(this);l.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){g.superclass.onOutEvent.call(this);
l.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(a){if(this.current!=this.targetAnchor||this.before!=a)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=a,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,
this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(a){this._changeState("Source",a?"Copied":"Moved")},_legalMouseDown:function(a){if("touchstart"!=a.type&&!h.isLeft(a))return!1;if(!this.withHandles)return!0;for(a=a.target;a&&a!==this.node;a=a.parentNode){if(k.contains(a,"dojoDndHandle"))return!0;if(k.contains(a,"dojoDndItem")||k.contains(a,"dojoDndIgnore"))break}return!1}});return g})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l){var g=b("dojo.dnd.Selector",l,{constructor:function(a,b){b||(b={});this.singular=b.singular;this.autoSync=b.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(p(this.node,c.press,f.hitch(this,"onMouseDown")),p(this.node,c.release,f.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var b=new m,c=a._empty,d;for(d in this.selection)d in c||b.push(k.byId(d));return b},selectNone:function(){return this._removeSelection()._removeAnchor()},
selectAll:function(){this.forInItems(function(a,b){this._addItemClass(k.byId(b),"Selected");this.selection[b]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var b=a._empty,c;for(c in this.selection)if(!(c in b)){var f=k.byId(c);this.delItem(c);d.destroy(f)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(b,c){c=c||n.global;var d=this.selection,e=a._empty,f;for(f in d)f in e||b.call(c,this.getItem(f),f,this)},sync:function(){g.superclass.sync.call(this);
this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var b=[],c=a._empty,d;for(d in this.selection)d in c||this.getItem(d)||b.push(d);q.forEach(b,function(a){delete this.selection[a]},this);return this},insertNodes:function(a,b,c,d){var e=this._normalizedCreator;this._normalizedCreator=function(b,c){b=e.call(this,b,c);a?(this.anchor?this.anchor!=b.node&&(this._removeItemClass(b.node,"Anchor"),this._addItemClass(b.node,"Selected")):(this.anchor=b.node,this._removeItemClass(b.node,"Selected"),
this._addItemClass(this.anchor,"Anchor")),this.selection[b.node.id]=1):(this._removeItemClass(b.node,"Selected"),this._removeItemClass(b.node,"Anchor"));return b};g.superclass.insertNodes.call(this,b,c,d);this._normalizedCreator=e;return this},destroy:function(){g.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(b){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!a.getCopyKeyState(b)&&!b.shiftKey&&this.current.id in this.selection)this.simpleSelection=
!0,h.isLeft(b)&&(b.stopPropagation(),b.preventDefault());else{if(!this.singular&&b.shiftKey){a.getCopyKeyState(b)||this._removeSelection();var c=this.getAllNodes();if(c.length&&(this.anchor||(this.anchor=c[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var d=0,e;d<c.length&&(e=c[d],e!=this.anchor&&e!=this.current);++d);for(++d;d<c.length;++d){e=c[d];if(e==this.anchor||e==this.current)break;this._addItemClass(e,"Selected");this.selection[e.id]=
1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?a.getCopyKeyState(b)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):a.getCopyKeyState(b)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):
(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);b.stopPropagation();b.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&
(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=p(this.node,c.move,f.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var b=a._empty,c;for(c in this.selection)if(!(c in b)){var d=k.byId(c);d&&this._removeItemClass(d,"Selected")}this.selection=
{};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return g})},"dojo/_base/NodeList":function(){define(["./kernel","../query","./array","./html","../NodeList-dom"],function(q,b,n){b=b.NodeList;var f=b.prototype;f.connect=b._adaptAsForEach(function(){return q.connect.apply(this,arguments)});f.coords=b._adaptAsMap(q.coords);b.events="blur focus change click error keydown keypress keyup load mousedown mouseenter mouseleave mousemove mouseout mouseover mouseup submit".split(" ");
n.forEach(b.events,function(b){var d="on"+b;f[d]=function(b,f){return this.connect(d,b,f)}});return q.NodeList=b})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),function(q,b,n,f,k,d,h,m,p,c,a,l,g,e){b=b("dojo.dnd.Container",p,{skipForm:!1,allowNested:!1,constructor:function(b,c){this.node=d.byId(b);c||(c={});this.creator=c.creator||
null;this.skipForm=c.skipForm;this.parent=c.dropParent&&d.byId(c.dropParent);this.map={};this.current=null;this.containerState="";h.add(this.node,"dojoDndContainer");c&&c._skipStartup||this.startup();this.events=[a(this.node,g.over,f.hitch(this,"onMouseOver")),a(this.node,g.out,f.hitch(this,"onMouseOut")),a(this.node,"dragstart",f.hitch(this,"onSelectStart")),a(this.node,"selectstart",f.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(a){return this.map[a]},setItem:function(a,
b){this.map[a]=b},delItem:function(a){delete this.map[a]},forInItems:function(a,b){b=b||n.global;var c=this.map,d=e._empty,f;for(f in c)f in d||a.call(b,c[f],f,this);return b},clearItems:function(){this.map={}},getAllNodes:function(){return l((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var a={};this.getAllNodes().forEach(function(b){if(b.id){var c=this.getItem(b.id);if(c){a[b.id]=c;return}}else b.id=e.getUniqueId();var c=b.getAttribute("dndType"),d=b.getAttribute("dndData");
a[b.id]={data:d||b.innerHTML,type:c?c.split(/\s*,\s*/):["text"]}},this);this.map=a;return this},insertNodes:function(a,b,c){this.parent.firstChild?b?c||(c=this.parent.firstChild):c&&(c=c.nextSibling):c=null;var d;if(c)for(b=0;b<a.length;++b)d=this._normalizedCreator(a[b]),this.setItem(d.node.id,{data:d.data,type:d.type}),c.parentNode.insertBefore(d.node,c);else for(b=0;b<a.length;++b)d=this._normalizedCreator(a[b]),this.setItem(d.node.id,{data:d.data,type:d.type}),this.parent.appendChild(d.node);
return this},destroy:function(){q.forEach(this.events,function(a){a.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(a,b,c){a._skipStartup=!0;return new c(b,a)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var a=this.parent.getElementsByTagName("tbody");a&&a.length&&(this.parent=a[0])}this.defaultCreator=e._defaultCreator(this.parent);this.sync()},onMouseOver:function(a){for(var b=a.relatedTarget;b&&
b!=this.node;)try{b=b.parentNode}catch(r){b=null}b||(this._changeState("Container","Over"),this.onOverEvent());b=this._getChildByEvent(a);this.current!=b&&(this.current&&this._removeItemClass(this.current,"Over"),b&&this._addItemClass(b,"Over"),this.current=b)},onMouseOut:function(a){for(a=a.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(t){a=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(a){this.withHandles||
this.skipForm&&e.isFormElement(a)||(a.stopPropagation(),a.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(a,b){var c="dojoDnd"+a;a=a.toLowerCase()+"State";h.replace(this.node,c+b,c+this[a]);this[a]=b},_addItemClass:function(a,b){h.add(a,"dojoDndItem"+b)},_removeItemClass:function(a,b){h.remove(a,"dojoDndItem"+b)},_getChildByEvent:function(a){if(a=a.target)for(var b=a.parentNode;b;a=b,b=a.parentNode)if((b==this.parent||this.allowNested)&&h.contains(a,"dojoDndItem"))return a;
return null},_normalizedCreator:function(a,b){a=(this.creator||this.defaultCreator).call(this,a,b);f.isArray(a.type)||(a.type=["text"]);a.node.id||(a.node.id=e.getUniqueId());h.add(a.node,"dojoDndItem");return a}});e._createNode=function(a){return a?function(b){return m.create(a,{innerHTML:b})}:e._createSpan};e._createTrTd=function(a){var b=m.create("tr");m.create("td",{innerHTML:a},b);return b};e._createSpan=function(a){return m.create("span",{innerHTML:a})};e._defaultCreatorNodes={ul:"li",ol:"li",
div:"div",p:"div"};e._defaultCreator=function(a){a=a.tagName.toLowerCase();var b="tbody"==a||"thead"==a?e._createTrTd:e._createNode(e._defaultCreatorNodes[a]);return function(a,c){var d=a&&f.isObject(a),g;d&&a.tagName&&a.nodeType&&a.getAttribute?(g=a.getAttribute("dndData")||a.innerHTML,d=(d=a.getAttribute("dndType"))?d.split(/\s*,\s*/):["text"]):(g=d&&a.data?a.data:a,d=d&&a.type?a.type:["text"],a=("avatar"==c?e._createSpan:b)(String(g)));a.id||(a.id=e.getUniqueId());return{node:a,data:g,type:d}}};
return b})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(q,b,n,f,k,d,h,m,p,c,a,l,g,e){var u=b("dojo.dnd.Manager",[d],{constructor:function(){this.source=this.avatar=null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:h("touch")?4:16,OFFSET_Y:h("touch")?4:16,overSource:function(a){this.avatar&&
(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=!!this.target,this.avatar.update());c.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),c.publish("/dnd/source/over",null)):c.publish("/dnd/source/over",null)},startDrag:function(b,d,e){function h(a){a.preventDefault();a.stopPropagation()}g.autoScrollStart(f.doc);this.source=b;this.nodes=d;this.copy=!!e;this.avatar=this.makeAvatar();f.body().appendChild(this.avatar.node);
c.publish("/dnd/start",b,d,this.copy);this.events=[p(f.doc,a.move,n.hitch(this,"onMouseMove")),p(f.doc,a.release,n.hitch(this,"onMouseUp")),p(f.doc,"keydown",n.hitch(this,"onKeyDown")),p(f.doc,"keyup",n.hitch(this,"onKeyUp")),p(f.doc,"dragstart",h),p(f.body(),"selectstart",h)];b="dojoDnd"+(e?"Copy":"Move");k.add(f.body(),b)},canDrop:function(a){a=!(!this.target||!a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){k.remove(f.body(),["dojoDndCopy","dojoDndMove"]);
q.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new e(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(a){var b=this.avatar;b&&(g.autoScrollNodes(a),b=b.node.style,b.left=a.pageX+this.OFFSET_X+"px",b.top=a.pageY+this.OFFSET_Y+"px",b=!!this.source.copyState(l.getCopyKeyState(a)),this.copy!=b&&this._setCopyStatus(b));h("touch")&&a.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&
this.canDropFlag){var b=!!this.source.copyState(l.getCopyKeyState(a));c.publish("/dnd/drop/before",this.source,this.nodes,b,this.target,a);c.publish("/dnd/drop",this.source,this.nodes,b,this.target,a)}else c.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(a){if(this.avatar)switch(a.keyCode){case m.CTRL:a=!!this.source.copyState(!0);this.copy!=a&&this._setCopyStatus(a);break;case m.ESCAPE:c.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(a){this.avatar&&a.keyCode==m.CTRL&&(a=
!!this.source.copyState(!1),this.copy!=a&&this._setCopyStatus(a))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();k.replace(f.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});l._manager=null;u.manager=l.manager=function(){l._manager||(l._manager=new u);return l._manager};return u})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),
function(q,b,n,f,k,d,h,m){return q("dojo.dnd.Avatar",null,{constructor:function(b){this.manager=b;this.construct()},construct:function(){var b=d.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),c=this.manager.source,a,l=d.create("tbody",null,b),g=d.create("tr",null,l),e=d.create("td",null,g),k=Math.min(5,this.manager.nodes.length),m=0;h("highcontrast")&&d.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},e);d.create("span",{innerHTML:c.generateText?
this._generateText():""},e);for(f.set(g,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});m<k;++m)c.creator?a=c._normalizedCreator(c.getItem(this.manager.nodes[m].id).data,"avatar").node:(a=this.manager.nodes[m].cloneNode(!0),"tr"==a.tagName.toLowerCase()&&(g=d.create("table"),d.create("tbody",null,g).appendChild(a),a=g)),a.id="",g=d.create("tr",null,l),e=d.create("td",null,g),e.appendChild(a),f.set(g,{"class":"dojoDndAvatarItem",style:{opacity:(9-m)/10}});this.node=b},destroy:function(){d.destroy(this.node);
this.node=!1},update:function(){k.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(h("highcontrast")){var b=n.byId("a11yIcon"),c="+";this.manager.canDropFlag&&!this.manager.copy?c="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||(c="x"):c="o";b.innerHTML=c}m("tr.dojoDndAvatarHeader td span"+(h("highcontrast")?" span":""),this.node).forEach(function(a){a.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},
"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(q,b,n,f){return q("dijit.CheckedMenuItem",n,{baseClass:"dijitMenuItem dijitCheckedMenuItem",templateString:f,checked:!1,_setCheckedAttr:function(b){this.domNode.setAttribute("aria-checked",b?"true":"false");this._set("checked",b)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(b){this.disabled||
(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(b)}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),function(q,b,n,f,k,d,h,m,p,c,a,l){h=q("dijit.MenuItem"+(d("dojo-bidi")?"_NoBidi":""),[m,p,c,a],{templateString:l,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",
a);var b="",c;c=a.search(/{\S}/);if(0<=c){var b=a.charAt(c+1),d=a.substr(0,c);a=a.substr(c+3);c=d+b+a;a=d+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+b+"\x3c/span\x3e"+a}else c=a;this.domNode.setAttribute("aria-label",c+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){!a||"label"in this.params||this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);
n.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&n.set(this.accelKeyNode,"id",this.id+"_accel");b.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==d("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(g){}},_setSelected:function(a){f.toggle(this.domNode,"dijitMenuItemSelected",a)},setLabel:function(a){k.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){k.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.",
"","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){this.accelKeyNode&&(this.accelKeyNode.style.display=a?"":"none",this.accelKeyNode.innerHTML=a,n.set(this.containerNode,"colSpan",a?"1":"2"));this._set("accelKey",a)}});d("dojo-bidi")&&(h=q("dijit.MenuItem",h,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));
return h})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w){function x(a){return function(b){this._isLoaded?this.inherited(a,arguments):
this.loadDropDown(m.hitch(this,a,b))}}var v=b("dijit.form._SelectMenu",g,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(p(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}))},focus:function(){var a=!1,b=this.parentWidget.value;m.isArray(b)&&(b=b[b.length-1]);b&&q.forEach(this.parentWidget._getChildren(),function(c){c.option&&b===c.option.value&&(a=!0,
this.focusChild(c,!1))},this);a||this.inherited(arguments)}});k=b("dijit.form.Select"+(c("dojo-bidi")?"_NoBidi":""),[a,l,r],{baseClass:"dijitSelect dijitValidationTextBox",templateString:w,_buttonInputDisabled:c("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);if(this.options.length&&!this.value&&this.srcNodeRef){var a=this.srcNodeRef.selectedIndex||0;this._set("value",
this.options[0<=a?a:0].value)}this.dropDown=new v({id:this.id+"_menu",parentWidget:this});f.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(a){if(a.value||a.label){var b=m.hitch(this,"_setValueAttr",a);a=new e({option:a,label:("text"===this.labelType?(a.label||"").toString().replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a.label)||this.emptyLabel,onClick:b,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:a.disabled||
!1});a.focusNode.setAttribute("role","option");return a}return new u({ownerDocument:this.ownerDocument})},_addOptionItem:function(a){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(a))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(z){}},focusChild:function(a){a&&this.set("value",a.option)},_getFirst:function(){var a=this._getChildren();return a.length?a[0]:null},
_getLast:function(){var a=this._getChildren();return a.length?a[a.length-1]:null},childSelector:function(a){return(a=y.byNode(a))&&a.getParent()==this.dropDown},onKeyboardSearch:function(a,b,c,d){a&&this.focusChild(a)},_loadChildren:function(a){if(!0===a)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{q.forEach(this._getChildren(),function(a){a.destroyRecursive()});var b=new e({ownerDocument:this.ownerDocument,label:this.emptyLabel});
this.dropDown.addChild(b)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(a){this.inherited(arguments);n.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",_setDisabledAttr:function(a){this.inherited(arguments);this._refreshState()},
_setRequiredAttr:function(a){this._set("required",a);this.focusNode.setAttribute("aria-required",a);this._refreshState()},_setOptionsAttr:function(a){this._isLoaded=!1;this._set("options",a)},_setDisplay:function(a){a=("text"===this.labelType?(a||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+a+"\x3c/span\x3e"},
validate:function(a){a=this.disabled||this.isValid(a);this._set("state",a?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",a?"false":"true");var b=a?"":this._missingMsg;b&&this.focused&&this._hasBeenBlurred?t.show(b,this.domNode,this.tooltipPosition,!this.isLeftToRight()):t.hide(this.domNode);this._set("message",b);return a},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||"")},reset:function(){this.inherited(arguments);t.hide(this.domNode);
this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=d.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(p(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var a=this._keyNavCodes;delete a[h.LEFT_ARROW];delete a[h.RIGHT_ARROW]},_setStyleAttr:function(a){this.inherited(arguments);f.toggle(this.domNode,
this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(a){this._loadChildren(!0);this._isLoaded=!0;a()},destroy:function(a){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(a),delete this.dropDown);t.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){t.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});c("dojo-bidi")&&(k=
b("dijit.form.Select",k,{_setDisplay:function(a){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));k._Menu=v;k.prototype._onContainerKeydown=x("_onContainerKeydown");k.prototype._onContainerKeypress=x("_onContainerKeypress");return k})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g){return k("dijit.form._FormSelectWidget",g,{multiple:!1,options:null,store:null,_setStoreAttr:function(a){this._created&&this._deprecatedSetStore(a)},query:null,_setQueryAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:a})},queryOptions:null,_setQueryOptionsAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:a})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(a){var b=this.options||[];if(null==a)return b;if(p.isArrayLike(a))return q.map(a,"return this.getOptions(item);",this);p.isString(a)&&(a={value:a});p.isObject(a)&&(q.some(b,function(b,c){for(var d in a)if(!(d in b)||b[d]!=a[d])return!1;a=c;return!0})||(a=-1));return 0<=a&&a<b.length?b[a]:null},addOption:function(a){q.forEach(p.isArrayLike(a)?a:[a],function(a){a&&p.isObject(a)&&this.options.push(a)},this);this._loadChildren()},removeOption:function(a){a=this.getOptions(p.isArrayLike(a)?
a:[a]);q.forEach(a,function(a){a&&(this.options=q.filter(this.options,function(b){return b.value!==a.value||b.label!==a.label}),this._removeOptionItem(a))},this);this._loadChildren()},updateOption:function(a){q.forEach(p.isArrayLike(a)?a:[a],function(a){var b=this.getOptions({value:a.value}),c;if(b)for(c in a)b[c]=a[c]},this);this._loadChildren()},setStore:function(a,b,c){m.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(a,b,c)},_deprecatedSetStore:function(c,d,g){var e=this.store;g=g||{};if(e!==c){for(var h;h=this._notifyConnections.pop();)h.remove();c.get||(p.mixin(c,{_oldAPI:!0,get:function(a){var c=new b;this.fetchItemByIdentity({identity:a,onItem:function(a){c.resolve(a)},onError:function(a){c.reject(a)}});return c.promise},query:function(a,c){var d=new b(function(){e.abort&&e.abort()});d.total=new b;var e=this.fetch(p.mixin({query:a,onBegin:function(a){d.total.resolve(a)},
onComplete:function(a){d.resolve(a)},onError:function(a){d.reject(a)}},c));return new l(d)}}),c.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[n.after(c,"onNew",p.hitch(this,"_onNewItem"),!0),n.after(c,"onDelete",p.hitch(this,"_onDeleteItem"),!0),n.after(c,"onSet",p.hitch(this,"_onSetItem"),!0)]));this._set("store",c)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);g.query&&this._set("query",g.query);g.queryOptions&&this._set("queryOptions",g.queryOptions);c&&c.query&&(this._loadingStore=!0,this.onLoadDeferred=new b,this._queryRes=c.query(this.query,this.queryOptions),a(this._queryRes,p.hitch(this,function(a){if(this.sortByLabel&&!g.sort&&a.length)if(c.getValue)a.sort(f.createSortFunction([{attribute:c.getLabelAttributes(a[0])[0]}],c));else{var b=this.labelAttr;a.sort(function(a,c){return a[b]>c[b]?1:c[b]>
a[b]?-1:0})}g.onFetch&&(a=g.onFetch.call(this,a,g));q.forEach(a,function(a){this._addOptionForItem(a)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(p.hitch(this,function(a,b,c){b==c?this._onSetItem(a):(-1!=b&&this._onDeleteItem(a),-1!=c&&this._onNewItem(a))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:d);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(a):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),p.hitch(this,function(a){console.error("dijit.form.Select: "+a.toString());this.onLoadDeferred.reject(a)})));return e},_setValueAttr:function(a,b){this._onChangeActive||(b=null);if(this._loadingStore)this._pendingValue=a;else if(null!=a){a=p.isArrayLike(a)?q.map(a,function(a){return p.isObject(a)?a:{value:a}}):p.isObject(a)?[a]:[{value:a}];a=q.filter(this.getOptions(a),function(a){return a&&a.value});var c=this.getOptions()||[];this.multiple||a[0]&&a[0].value||!c.length||(a[0]=
c[0]);q.forEach(c,function(b){b.selected=q.some(a,function(a){return a.value===b.value})});c=q.map(a,function(a){return a.value});if("undefined"!=typeof c&&"undefined"!=typeof c[0]){var d=q.map(a,function(a){return a.label});this._setDisplay(this.multiple?d:d[0]);this.inherited(arguments,[this.multiple?c:c[0],b]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var a=q.map([].concat(this.get("selectedOptions")),function(a){return a&&"label"in a?a.label:a?a.value:null},this);return this.multiple?
a:a[0]},_setDisplayedValueAttr:function(a){this.set("value",this.getOptions("string"==typeof a?{label:a}:a))},_loadChildren:function(){this._loadingStore||(q.forEach(this._getChildren(),function(a){a.destroyRecursive()}),q.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var a=[].concat(this.value);if(a&&a[0]){var b=this;q.forEach(this._getChildren(),function(c){var d=q.some(a,function(a){return c.option&&
a===c.option.value});d&&!b.multiple&&(b.focusedChild=c);h.toggle(c.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),d);c.domNode.setAttribute("aria-selected",d?"true":"false")},this)}},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var b=q.filter(a,function(a){return a.selected})[0];if(b&&b.value)return b.value;a[0].selected=!0;return a[0].value}return this.multiple?q.map(q.filter(a,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(a,b){b&&b.parent||this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption({value:this.store.getIdentity(a)})},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var b=this.store,c=this.labelAttr&&this.labelAttr in a?a[this.labelAttr]:b.getLabel(a);return{value:c?b.getIdentity(a):null,label:c,item:a}},_addOptionForItem:function(a){var b=this.store;b.isItemLoaded&&!b.isItemLoaded(a)?b.loadItem({item:a,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(a=this._getOptionObjForItem(a),this.addOption(a))},constructor:function(a){this._oValue=(a||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);d.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?c("\x3e *",this.srcNodeRef).map(function(a){return"separator"===a.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:a.getAttribute("data-"+m._scopeName+"-value")||a.getAttribute("value"),
label:String(a.innerHTML),selected:a.getAttribute("selected")||!1,disabled:a.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);n.after(this,"onChange",p.hitch(this,"_updateSelection"));var a=this.store;a&&(a.getIdentity||a.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(a,this._oValue,
{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var a;a=this._notifyConnections.pop();)a.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(q){var b={};q.setObject("dojo.data.util.sorter",b);b.basicComparator=function(b,f){var k=-1;null===b&&(b=void 0);null===f&&(f=void 0);if(b==f)k=0;else if(b>f||null==b)k=1;return k};b.createSortFunction=function(n,f){function k(a,b,c,d){return function(e,f){e=d.getValue(e,a);f=d.getValue(f,a);
return b*c(e,f)}}for(var d=[],h,m=f.comparatorMap,p=b.basicComparator,c=0;c<n.length;c++){h=n[c];var a=h.attribute;if(a){h=h.descending?-1:1;var l=p;m&&("string"!==typeof a&&"toString"in a&&(a=a.toString()),l=m[a]||p);d.push(k(a,h,l,f))}}return function(a,b){for(var c=0;c<d.length;){var e=d[c++](a,b);if(0!==e)return e}return 0}};return b})},"dijit/_HasDropDown":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on dojo/touch ./registry ./focus ./popup ./_FocusMixin".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t){return q("dijit._HasDropDown",t,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(b){this.disabled||this.readOnly||("MSPointerDown"!=b.type&&b.preventDefault(),this.own(a.once(this.ownerDocument,l.release,c.hitch(this,"_onDropDownMouseUp"))),this.toggleDropDown())},_onDropDownMouseUp:function(a){var b=
this.dropDown,c=!1;if(a&&this._opened){var e=d.position(this._buttonNode,!0);if(!(a.pageX>=e.x&&a.pageX<=e.x+e.w&&a.pageY>=e.y&&a.pageY<=e.y+e.h)){for(e=a.target;e&&!c;)k.contains(e,"dijitPopup")?c=!0:e=e.parentNode;if(c){e=a.target;if(b.onItemClick){for(var f;e&&!(f=g.byNode(e));)e=e.parentNode;if(f&&f.onClick&&f.getParent)f.getParent().onItemClick(f,a)}return}}}this._opened?b.focus&&(!1!==b.autoFocus||"mouseup"==a.type&&!this.hovering)&&(this._focusDropDownTimer=this.defer(function(){b.focus();
delete this._focusDropDownTimer})):this.focus&&this.defer("focus")},_onDropDownClick:function(a){this._stopClickEvents&&(a.stopPropagation(),a.preventDefault())},buildRendering:function(){this.inherited(arguments);this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var a={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||
this.dropDownPosition[0]||"Down";k.add(this._arrowWrapperNode||this._buttonNode,"dijit"+a+"ArrowButton")},postCreate:function(){this.inherited(arguments);var b=this.focusNode||this.domNode;this.own(a(this._buttonNode,l.press,c.hitch(this,"_onDropDownMouseDown")),a(this._buttonNode,"click",c.hitch(this,"_onDropDownClick")),a(b,"keydown",c.hitch(this,"_onKey")),a(b,"keyup",c.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0);this.dropDown&&(this.dropDown._destroyed||this.dropDown.destroyRecursive(),
delete this.dropDown);this.inherited(arguments)},_onKey:function(a){if(!this.disabled&&!this.readOnly){var b=this.dropDown,c=a.target;b&&this._opened&&b.handleKey&&!1===b.handleKey(a)?(a.stopPropagation(),a.preventDefault()):b&&this._opened&&a.keyCode==p.ESCAPE?(this.closeDropDown(),a.stopPropagation(),a.preventDefault()):!this._opened&&(a.keyCode==p.DOWN_ARROW||(a.keyCode==p.ENTER||a.keyCode==p.SPACE&&(!this._searchTimer||a.ctrlKey||a.altKey||a.metaKey))&&("input"!==(c.tagName||"").toLowerCase()||
c.type&&"text"!==c.type.toLowerCase()))&&(this._toggleOnKeyUp=!0,a.stopPropagation(),a.preventDefault())}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp;this.toggleDropDown();var a=this.dropDown;a&&a.focus&&this.defer(c.hitch(a,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1);this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(a){a()},loadAndOpenDropDown:function(){var a=new b,d=c.hitch(this,function(){this.openDropDown();a.resolve(this.dropDown)});
this.isLoaded()?d():this.loadDropDown(d);return a},toggleDropDown:function(){this.disabled||this.readOnly||(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var a=this.dropDown,b=a.domNode,e=this._aroundNode||this.domNode,g=this,h=u.open({parent:this,popup:a,around:e,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){g.closeDropDown(!0)},onCancel:function(){g.closeDropDown(!0)},onClose:function(){f.set(g._popupStateNode,"popupActive",
!1);k.remove(g._popupStateNode,"dijitHasDropDownOpen");g._set("_opened",!1)}});if(this.forceWidth||this.autoWidth&&e.offsetWidth>a._popupWrapper.offsetWidth){var e=e.offsetWidth-a._popupWrapper.offsetWidth,l={w:a.domNode.offsetWidth+e};this._origStyle=b.style.cssText;c.isFunction(a.resize)?a.resize(l):d.setMarginBox(b,l);"R"==h.corner[1]&&(a._popupWrapper.style.left=a._popupWrapper.style.left.replace("px","")-e+"px")}f.set(this._popupStateNode,"popupActive","true");k.add(this._popupStateNode,"dijitHasDropDownOpen");
this._set("_opened",!0);this._popupStateNode.setAttribute("aria-expanded","true");this._popupStateNode.setAttribute("aria-owns",a.id);"presentation"===b.getAttribute("role")||b.getAttribute("aria-labelledby")||b.setAttribute("aria-labelledby",this.id);return h},closeDropDown:function(a){this._focusDropDownTimer&&(this._focusDropDownTimer.remove(),delete this._focusDropDownTimer);this._opened&&(this._popupStateNode.setAttribute("aria-expanded","false"),a&&this.focus&&this.focus(),u.close(this.dropDown),
this._opened=!1);this._origStyle&&(this.dropDown.domNode.style.cssText=this._origStyle,delete this._origStyle)}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(q,b,n,f,k,d){return q("dijit.MenuSeparator",[n,f,k],{templateString:d,buildRendering:function(){this.inherited(arguments);b.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare",
"dojo/keys","./_Spinner","./NumberTextBox"],function(q,b,n,f){return q("dijit.form.NumberSpinner",[n,f.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(b,d){var f=this.constraints,k=isNaN(b),p=!isNaN(f.max),c=!isNaN(f.min);k&&0!=d&&(b=0<d?c?f.min:p?f.max:0:p?this.constraints.max:c?f.min:0);d=b+d;if(k||isNaN(d))return b;p&&d>f.max&&(d=f.max);c&&d<f.min&&(d=f.min);return d},_onKeyDown:function(f){if(!(this.disabled||this.readOnly||f.keyCode!=b.HOME&&f.keyCode!=b.END||
f.ctrlKey||f.altKey||f.metaKey||"undefined"==typeof this.get("value"))){var d=this.constraints[f.keyCode==b.HOME?"min":"max"];"number"==typeof d&&this._setValueAttr(d,!1);f.stopPropagation();f.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),function(q,b,n,f,k,d,h,m,p,c){return q("dijit.form._Spinner",m,{defaultTimeout:500,
minimumTimeout:10,timeoutChangeRate:.9,smallDelta:1,largeDelta:10,templateString:p,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(a){return a},_arrowPressed:function(a,b,d){this.disabled||this.readOnly||(this._setValueAttr(this.adjust(this.get("value"),b*d),!1),c.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=null},_typematicCallback:function(a,c,d){var e=
this.smallDelta;c==this.textbox&&(c=d.keyCode,e=c==b.PAGE_UP||c==b.PAGE_DOWN?this.largeDelta:this.smallDelta,c=c==b.UP_ARROW||c==b.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==a?this._arrowReleased(c):this._arrowPressed(c,c==this.upArrowNode?1:-1,e)},_wheelTimer:null,_mouseWheeled:function(a){if(this.focused){a.stopPropagation();a.preventDefault();var b=a.wheelDelta/120;Math.floor(b)!=b&&(b=0<a.wheelDelta?1:-1);a=a.detail?-1*a.detail:b;if(0!==a){var c=this[0<a?"upArrowNode":"downArrowNode"];this._arrowPressed(c,
a,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(c)},50)}}},_setConstraintsAttr:function(a){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(a,
b){this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(d(this.domNode,k.wheel,n.hitch(this,"_mouseWheeled")),h.addListener(this.upArrowNode,this.textbox,{keyCode:b.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),h.addListener(this.downArrowNode,this.textbox,{keyCode:b.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,
"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),h.addListener(this.upArrowNode,this.textbox,{keyCode:b.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),h.addListener(this.downArrowNode,this.textbox,{keyCode:b.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout))}})})},"dijit/typematic":function(){define("dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/on dojo/sniff ./main".split(" "),
function(q,b,n,f,k,d){var h=d.typematic={_fireEventAndReload:function(){this._timer=null;this._callback(++this._count,this._node,this._evt);this._currentTimeout=Math.max(0>this._currentTimeout?this._initialDelay:1<this._subsequentDelay?this._subsequentDelay:Math.round(this._currentTimeout*this._subsequentDelay),this._minDelay);this._timer=setTimeout(n.hitch(this,"_fireEventAndReload"),this._currentTimeout)},trigger:function(b,d,c,a,f,g,e,h){if(f!=this._obj){this.stop();this._initialDelay=e||500;this._subsequentDelay=
g||.9;this._minDelay=h||10;this._obj=f;this._node=c;this._count=this._currentTimeout=-1;this._callback=n.hitch(d,a);this._evt={faux:!0};for(var l in b)"layerX"!=l&&"layerY"!=l&&(d=b[l],"function"!=typeof d&&"undefined"!=typeof d&&(this._evt[l]=d));this._fireEventAndReload()}},stop:function(){this._timer&&(clearTimeout(this._timer),this._timer=null);this._obj&&(this._callback(-1,this._node,this._evt),this._obj=null)},addKeyListener:function(d,k,c,a,l,g,e){var m="keyCode"in k?"keyCode":"charCode"in
k?"charCode":"charOrCode",p=[f(d,"keyCode"in k?"keydown":"charCode"in k?"keypress":b._keypress,n.hitch(this,function(b){b[m]!=k[m]||void 0!==k.ctrlKey&&k.ctrlKey!=b.ctrlKey||void 0!==k.altKey&&k.altKey!=b.altKey||void 0!==k.metaKey&&k.metaKey!=(b.metaKey||!1)||void 0!==k.shiftKey&&k.shiftKey!=b.shiftKey?h._obj==k&&h.stop():(b.stopPropagation(),b.preventDefault(),h.trigger(b,c,d,a,k,l,g,e))})),f(d,"keyup",n.hitch(this,function(){h._obj==k&&h.stop()}))];return{remove:function(){q.forEach(p,function(a){a.remove()})}}},
addMouseListener:function(b,d,c,a,l,g){var e=[f(b,"mousedown",n.hitch(this,function(e){e.preventDefault();h.trigger(e,d,b,c,b,a,l,g)})),f(b,"mouseup",n.hitch(this,function(a){this._obj&&a.preventDefault();h.stop()})),f(b,"mouseout",n.hitch(this,function(a){this._obj&&a.preventDefault();h.stop()})),f(b,"dblclick",n.hitch(this,function(e){e.preventDefault();9>k("ie")&&(h.trigger(e,d,b,c,b,a,l,g),setTimeout(n.hitch(this,h.stop),50))}))];return{remove:function(){q.forEach(e,function(a){a.remove()})}}},
addListener:function(b,d,c,a,f,g,e,h){var k=[this.addKeyListener(d,c,a,f,g,e,h),this.addMouseListener(b,a,f,g,e,h)];return{remove:function(){q.forEach(k,function(a){a.remove()})}}}};return h})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(q,b,n){return q("dijit.form.RangeBoundTextBox",n,{rangeMessage:"",rangeCheck:function(b,k){return("min"in k?0<=this.compare(b,k.min):!0)&&("max"in k?0>=this.compare(b,k.max):
!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var b=this.get("value");if(null==b)return!1;var k=!1;"min"in this.constraints&&(k=this.constraints.min,k=0>this.compare(b,"number"==typeof k&&0<=k&&0!=b?0:k));!k&&"max"in this.constraints&&(k=this.constraints.max,k=0<this.compare(b,"number"!=typeof k||0<k?k:0));return k},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(b){return this.inherited(arguments)&&
(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(b))},getErrorMessage:function(b){var f=this.get("value");return null==f||""===f||"number"==typeof f&&isNaN(f)||this.isInRange(b)?this.inherited(arguments):this.rangeMessage},postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=b.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare",
"dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(q,b,n,f){return q("dijit.form.MappedTextBox",f,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(b){return b.toString?b.toString():""},toString:function(){var b=this.filter(this.get("value"));return null!=b?"string"==typeof b?b:this.serialize(b,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},
buildRendering:function(){this.inherited(arguments);this.valueNode=n.place("\x3cinput type\x3d'hidden'"+(this.name?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),function(q,b,n,f,k,d){var h=function(b){b=b||{};var c=n.getLocalization("dojo.cldr",
"number",n.normalizeLocale(b.locale)),a=b.pattern?b.pattern:c[(b.type||"decimal")+"Format"];b="number"==typeof b.places?b.places:"string"===typeof b.places&&0<b.places.length?b.places.replace(/.*,/,""):-1!=a.indexOf(".")?a.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:c.decimal,places:b}},m=q("dijit.form.NumberTextBoxMixin",null,{pattern:function(d){return"("+(this.focused&&this.editOptions?this._regExpGenerator(b.delegate(d,this.editOptions))+"|":"")+this._regExpGenerator(d)+")"},value:NaN,
editOptions:{pattern:"#.######"},_formatter:k.format,_regExpGenerator:k.regexp,_decimalInfo:h(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(b){var c="number"==typeof b.places?b.places:0;c&&c++;"number"!=typeof b.max&&(b.max=9*Math.pow(10,15-c));"number"!=typeof b.min&&(b.min=-9*Math.pow(10,15-c));this.inherited(arguments,[b]);this.focusNode&&this.focusNode.value&&!isNaN(this.value)&&this.set("value",this.value);this._decimalInfo=
h(b)},_onFocus:function(b){if(!this.disabled&&!this.readOnly){var c=this.get("value");"number"!=typeof c||isNaN(c)||(c=this.format(c,this.constraints),void 0!==c&&(this.textbox.value=c,"mouse"!==b&&this.textbox.select()));this.inherited(arguments)}},format:function(d,c){var a=String(d);if("number"!=typeof d)return a;if(isNaN(d))return"";if(!("rangeCheck"in this&&this.rangeCheck(d,c))&&!1!==c.exponent&&/\de[-+]?\d/i.test(a))return a;this.editOptions&&this.focused&&(c=b.mixin({},c,this.editOptions));
return this._formatter(d,c)},_parser:k.parse,parse:function(d,c){var a=b.mixin({},c,this.editOptions&&this.focused?this.editOptions:{});if(this.focused&&null!=a.places){var f=a.places,f="number"===typeof f?f:Number(f.split(",").pop());a.places="0,"+f}a=this._parser(d,a);this.editOptions&&this.focused&&isNaN(a)&&(a=this._parser(d,c));return a},_getDisplayedValueAttr:function(){var b=this.inherited(arguments);return isNaN(b)?this.textbox.value:b},filter:function(b){if(null==b||"string"==typeof b&&""==
b)return NaN;"number"!=typeof b||isNaN(b)||0==b||(b=k.round(b,this._decimalInfo.places));return this.inherited(arguments,[b])},serialize:function(b,c){return"number"!=typeof b||isNaN(b)?"":this.inherited(arguments)},_setBlurValue:function(){var d=b.hitch(b.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(d,!0)},_setValueAttr:function(b,c,a){if(void 0!==b&&void 0===a)if(a=String(b),"number"==typeof b)if(isNaN(b))a="";else{if("rangeCheck"in this&&this.rangeCheck(b,this.constraints)||!1===
this.constraints.exponent||!/\de[-+]?\d/i.test(a))a=void 0}else b?b=void 0:(a="",b=NaN);this.inherited(arguments,[b,c,a])},_getValueAttr:function(){var d=this.inherited(arguments);if(isNaN(d)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+k._realNumberRegexp(b.delegate(this.constraints))+"$")).test(this.textbox.value))return d=Number(this.textbox.value),isNaN(d)?void 0:d}else return d},isValid:function(b){if(!this.focused||this._isEmpty(this.textbox.value))return this.inherited(arguments);
var c=this.get("value");return!isNaN(c)&&this.rangeCheck(c,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var b="number"==typeof this.constraints.min,c="number"==typeof this.constraints.max,a=this.get("value");if(isNaN(a)||!b&&!c)return this.inherited(arguments);var d=a|0,g=0>a,e=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),h=(this.maxLength||20)-this.textbox.value.length,k=e?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,
""):"",d=e?d+"."+k:d+"",h=f.rep("9",h),e=a;g?e=Number(d+h):a=Number(d+h);return!(b&&a<this.constraints.min||c&&e>this.constraints.max)}});q=q("dijit.form.NumberTextBox",[d,m],{baseClass:"dijitTextBox dijitNumberTextBox"});q.Mixin=m;return q})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a){var l=p("dijit.ColorPalette",[n,f,k],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:b,baseClass:"dijitColorPalette",_dyeFactory:function(a,b,c,d){return new this._dyeClass(a,
b,c,d)},buildRendering:function(){this.inherited(arguments);this._dyeClass=p(l._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],h.getLocalization("dojo","colors",this.lang))}});l._Color=p("dijit._Color",m,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":q.toUrl("./themes/a11y/colors7x10.png"),"3x4":q.toUrl("./themes/a11y/colors3x4.png")},constructor:function(a,b,c,d){this._title=d;this._row=b;this._col=c;this.setColor(m.named[a])},getValue:function(){return this.toHex()},fillCell:function(b,e){e=a.substitute(d("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:e,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});c.place(e,b)}});return l})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(q,b,n,f,k,d,h,m,p,c,a){return q("dijit._PaletteMixin",m,{defaultTimeout:500,timeoutChangeRate:.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(a){return new ("string"==
typeof this.dyeClass?d.getObject(this.dyeClass):this.dyeClass)(a)},_preparePalette:function(b,c){this._cells=[];var e=this._blankGif;this.own(h(this.gridNode,p,d.hitch(this,"_onCellClick")));for(var g=0;g<b.length;g++)for(var l=f.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),m=0;m<b[g].length;m++){var n=b[g][m];if(n){var q=this._dyeFactory(n,g,m,c[n]),n=f.create("td",{"class":this.cellClass,tabIndex:"-1",title:c[n],role:"gridcell"},l);q.fillCell(n,e);n.idx=this._cells.length;this._cells.push({node:n,
dye:q})}}this._xDim=b[0].length;this._yDim=b.length;var x={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},v;for(v in x)this.own(a.addKeyListener(this.domNode,{keyCode:k[v],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var a=x[v];return function(b){this._navigateByKey(a,b)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){c.focus(this._currentFocus)},
_onCellClick:function(a){for(var b=a.target;"TD"!=b.tagName;){if(!b.parentNode||b==this.gridNode)return;b=b.parentNode}var d=this._getDye(b).getValue();this._setCurrent(b);c.focus(b);this._setValueAttr(d,!0);a.stopPropagation();a.preventDefault()},_setCurrent:function(a){"_currentFocus"in this&&b.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=a)&&b.set(a,"tabIndex",this.tabIndex)},_setValueAttr:function(a,b){0<=this._selectedCell&&n.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(a)for(var c=0;c<this._cells.length;c++)if(a==this._cells[c].dye.getValue()){this._selectedCell=c;n.add(this._cells[c].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?a:null);if(b||void 0===b)this.onChange(a)},onChange:function(){},_navigateByKey:function(a,b){-1!=b&&(a=this._currentFocus.idx+a,a<this._cells.length&&-1<a&&(a=this._cells[a].node,this._setCurrent(a),this.defer(d.hitch(c,"focus",a))))},_getDye:function(a){return this._cells[a.idx].dye}})})},
"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(q,b,n,f){var k={};b.setObject("dojo.colors",k);var d=function(b,d,c){0>c&&++c;1<c&&--c;var a=6*c;return 1>a?b+(d-b)*a:1>2*c?d:2>3*c?b+(d-b)*(2/3-c)*6:b};q.colorFromRgb=n.fromRgb=function(b,h){var c=b.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(c){b=c[2].split(/\s*,\s*/);var a=b.length,c=c[1];if("rgb"==c&&3==a||"rgba"==c&&4==a)return c=b[0],"%"==c.charAt(c.length-1)?(c=f.map(b,
function(a){return 2.56*parseFloat(a)}),4==a&&(c[3]=b[3]),n.fromArray(c,h)):n.fromArray(b,h);if("hsl"==c&&3==a||"hsla"==c&&4==a){var c=(parseFloat(b[0])%360+360)%360/360,k=parseFloat(b[1])/100,g=parseFloat(b[2])/100,k=.5>=g?g*(k+1):g+k-g*k,g=2*g-k,c=[256*d(g,k,c+1/3),256*d(g,k,c),256*d(g,k,c-1/3),1];4==a&&(c[3]=b[3]);return n.fromArray(c,h)}}return null};var h=function(b,d,c){b=Number(b);return isNaN(b)?c:b<d?d:b>c?c:b};n.prototype.sanitize=function(){this.r=Math.round(h(this.r,0,255));this.g=Math.round(h(this.g,
0,255));this.b=Math.round(h(this.b,0,255));this.a=h(this.a,0,1);return this};k.makeGrey=n.makeGrey=function(b,d){return n.fromArray([b,b,b,d])};b.mixin(n.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,
149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,
0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],
lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,
0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,
232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,
250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return n})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),
function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v){var z=b("dijit.form._SliderMover",a,{onMouseMove:function(a){var b=this.widget,c=b._abspos;c||(c=b._abspos=k.position(b.sliderBarContainer,!0),b._setPixelValue_=m.hitch(b,"_setPixelValue"),b._isReversed_=b._isReversed());a=a[b._mousePixelCoord]-c[b._startingPixelCoord];b._setPixelValue_(b._isReversed_?c[b._pixelCount]-a:a,c[b._pixelCount],!1)},destroy:function(b){a.prototype.destroy.apply(this,arguments);var c=this.widget;c._abspos=null;c._setValueAttr(c.value,
!0)}});n=b("dijit.form.HorizontalSlider",[w,x],{templateString:v,value:0,showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:u.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",
_onKeyUp:function(a){this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey||this._setValueAttr(this.value,!0)},_onKeyDown:function(a){if(!(this.disabled||this.readOnly||a.altKey||a.ctrlKey||a.metaKey)){switch(a.keyCode){case h.HOME:this._setValueAttr(this.minimum,!1);break;case h.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?h.RIGHT_ARROW:h.LEFT_ARROW:case !1===this._descending?h.DOWN_ARROW:h.UP_ARROW:case !1===this._descending?h.PAGE_DOWN:h.PAGE_UP:this.increment(a);
break;case this._descending||this.isLeftToRight()?h.LEFT_ARROW:h.RIGHT_ARROW:case !1===this._descending?h.UP_ARROW:h.DOWN_ARROW:case !1===this._descending?h.PAGE_UP:h.PAGE_DOWN:this.decrement(a);break;default:return}a.stopPropagation();a.preventDefault()}},_onHandleClick:function(a){this.disabled||this.readOnly||(p("ie")||t.focus(this.sliderHandle),a.stopPropagation(),a.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(a){if(!this.disabled&&!this.readOnly&&
this.clickSelect){t.focus(this.sliderHandle);a.stopPropagation();a.preventDefault();var b=k.position(this.sliderBarContainer,!0),c=a[this._mousePixelCoord]-b[this._startingPixelCoord];this._setPixelValue(this._isReversed()?b[this._pixelCount]-c:c,b[this._pixelCount],!0);this._movable.onMouseDown(a)}},_setPixelValue:function(a,b,c){if(!this.disabled&&!this.readOnly){var d=this.discreteValues;if(1>=d||Infinity==d)d=b;d--;this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*Math.round(a/
(b/d))/d+this.minimum,this.maximum),this.minimum),c)}},_setValueAttr:function(a,b){this._set("value",a);this.valueNode.value=a;this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments);var c=this.maximum>this.minimum?(a-this.minimum)/(this.maximum-this.minimum):0,d=!1===this._descending?this.remainingBar:this.progressBar,e=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(b&&0<this.slideDuration&&
d.style[this._progressPixelSize]){var g=this,h={},k=parseFloat(d.style[this._progressPixelSize]),l=this.slideDuration*(c-k/100);0!=l&&(0>l&&(l=0-l),h[this._progressPixelSize]={start:k,end:100*c,units:"%"},this._inProgressAnim=f.animateProperty({node:d,duration:l,onAnimate:function(a){e.style[g._progressPixelSize]=100-parseFloat(a[g._progressPixelSize])+"%"},onEnd:function(){delete g._inProgressAnim},properties:h}),this._inProgressAnim.play())}else d.style[this._progressPixelSize]=100*c+"%",e.style[this._progressPixelSize]=
100*(1-c)+"%"},_bumpValue:function(a,b){if(!(this.disabled||this.readOnly||this.maximum<=this.minimum)){var c=d.getComputedStyle(this.sliderBarContainer),e=k.getContentBox(this.sliderBarContainer,c),c=this.discreteValues;if(1>=c||Infinity==c)c=e[this._pixelCount];c--;a=Math.round((this.value-this.minimum)*c/(this.maximum-this.minimum))+a;0>a&&(a=0);a>c&&(a=c);a=a*(this.maximum-this.minimum)/c+this.minimum;this._setValueAttr(a,b)}},_onClkBumper:function(a){this.disabled||this.readOnly||!this.clickSelect||
this._setValueAttr(a,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(a){this._bumpValue(a.keyCode==h.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(a){this._bumpValue(a.keyCode==h.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(a){this.focused&&(a.stopPropagation(),a.preventDefault(),this._bumpValue(0>a.wheelDelta?-1:1,!0))},
startup:function(){this._started||(q.forEach(this.getChildren(),function(a){this[a.container]!=this.containerNode&&this[a.container].appendChild(a.domNode)},this),this.inherited(arguments))},_typematicCallback:function(a,b,c){if(-1==a)this._setValueAttr(this.value,!0);else this[b==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](c)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display=
"");var a=l('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+"_label"),this.focusNode.setAttribute("aria-labelledby",a[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(r.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),r.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(e(this.domNode,
g.wheel,m.hitch(this,"_mouseWheeled")));var a=b(z,{widget:this});this._movable=new c(this.sliderHandle,{mover:a});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});n._Mover=z;return n})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(q,b,n){return q("dijit.form.HorizontalRule",[b,n],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',
count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(b){return this._positionPrefix+b+this._positionSuffix+this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);var b;if(1==this.count)b=this._genHTML(50,0);else{var k,d=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){b=this._genHTML(0,0);for(k=1;k<
this.count-1;k++)b+=this._genHTML(d*k,k);b+=this._genHTML(100,this.count-1)}else{b=this._genHTML(100,0);for(k=1;k<this.count-1;k++)b+=this._genHTML(100-d*k,k);b+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=b}})})},"dojo/_base/query":function(){define(["../query","./NodeList"],function(q){return q})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),
function(q,b,n,f,k,d,h,m,p){f("dijit-legacy-requires")&&d(0,function(){q(["dijit/form/RadioButton"])});return b("dijit.form.CheckBox",[h,m],{templateString:p,baseClass:"dijitCheckBox",_setValueAttr:function(b,a){"string"==typeof b&&(this.inherited(arguments),b=!0);this._created&&this.set("checked",b,a)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},
_fillContent:function(){},_onFocus:function(){this.id&&k("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&k("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");this.inherited(arguments)}})})},"dijit/form/ToggleButton":function(){define(["dojo/_base/declare","dojo/_base/kernel","./Button","./_ToggleButtonMixin"],function(q,b,n,f){return q("dijit.form.ToggleButton",[n,f],{baseClass:"dijitToggleButton",setChecked:function(f){b.deprecated("setChecked("+
f+") is deprecated. Use set('checked',"+f+") instead.","","2.0");this.set("checked",f)}})})},"dijit/form/_ToggleButtonMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(q,b){return q("dijit.form._ToggleButtonMixin",null,{checked:!1,_aria_attr:"aria-pressed",_onClick:function(b){var f=this.checked;this._set("checked",!f);var k=this.inherited(arguments);this.set("checked",k?this.checked:f);return k},_setCheckedAttr:function(n,f){this._set("checked",n);var k=this.focusNode||this.domNode;
this._created&&b.get(k,"checked")!=!!n&&b.set(k,"checked",!!n);k.setAttribute(this._aria_attr,String(n));this._handleOnChange(n,f)},postCreate:function(){this.inherited(arguments);var b=this.focusNode||this.domNode;this.checked&&b.setAttribute("checked","checked");void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.checked)},reset:function(){this._hasBeenBlurred=!1;this.set("checked",this.params.checked||!1)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare",
"dojo/dom-attr"],function(q,b){return q("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(n){this._set("readOnly",n);b.set(this.focusNode,"readOnly",n)},_setLabelAttr:void 0,_getSubmitValue:function(b){return null==b||""===b?"on":b},_setValueAttr:function(n){n=this._getSubmitValue(n);this._set("value",n);b.set(this.focusNode,"value",n)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));
b.set(this.focusNode,"value",this.value)},_onClick:function(b){return this.readOnly?(b.stopPropagation(),b.preventDefault(),!1):this.inherited(arguments)}})})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox","./ComboBoxMixin"],function(q,b,n){return q("dijit.form.ComboBox",[b,n],{})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(q,b,n,f,k,d,h,m,p){return q("dijit.form.ComboBoxMixin",[m,d],{dropDownClass:h,hasDownArrow:!0,templateString:p,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(b){this._set("hasDownArrow",b);this._buttonNode.style.display=b?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(c){c.get||f.mixin(c,{_oldAPI:!0,get:function(a){var c=new b;this.fetchItemByIdentity({identity:a,
onItem:function(a){c.resolve(a)},onError:function(a){c.reject(a)}});return c.promise},query:function(a,c){var d=new b(function(){e.abort&&e.abort()});d.total=new b;var e=this.fetch(f.mixin({query:a,onBegin:function(a){d.total.resolve(a)},onComplete:function(a){d.resolve(a)},onError:function(a){d.reject(a)}},c));return k(d)}});this._set("store",c)},postMixInProperties:function(){var b=this.params.store||this.store;b&&this._setStoreAttr(b);this.inherited(arguments);if(!this.params.store&&this.store&&
!this.store._oldAPI){var a=this.declaredClass;f.mixin(this.store,{getValue:function(b,c){n.deprecated(a+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return b[c]},getLabel:function(b){n.deprecated(a+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return b.name},fetch:function(b){n.deprecated(a+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],
f.hitch(this,function(a){(new a({objectStore:this})).fetch(b)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(q,b,n,f,k,d,h,m,p,c,a){b=b("dijit.form._AutoCompleterMixin",a,{item:null,
autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(a){var b=0;if("number"==typeof a.selectionStart)b=a.selectionStart;else if(m("ie")){var c=a.ownerDocument.selection.createRange().duplicate();a=a.createTextRange();c.move("character",0);a.move("character",0);try{a.setEndPoint("EndToEnd",c),b=String(a.text).replace(/\r/g,"").length}catch(u){}}return b},_setCaretPos:function(a,b){b=parseInt(b);c.selectInputText(a,b,b)},_setDisabledAttr:function(a){this.inherited(arguments);
this.domNode.setAttribute("aria-disabled",a?"true":"false")},_onKey:function(a){if(!(32<=a.charCode)){var b=a.charCode||a.keyCode;if(b!=f.ALT&&b!=f.CTRL&&b!=f.META&&b!=f.SHIFT){var c=this.dropDown,d=null;this._abortQuery();this.inherited(arguments);if(!(a.altKey||a.ctrlKey||a.metaKey))switch(this._opened&&(d=c.getHighlightedOption()),b){case f.PAGE_DOWN:case f.DOWN_ARROW:case f.PAGE_UP:case f.UP_ARROW:this._opened&&this._announceOption(d);a.stopPropagation();a.preventDefault();break;case f.ENTER:if(d){if(d==
c.nextButton){this._nextSearch(1);a.stopPropagation();a.preventDefault();break}else if(d==c.previousButton){this._nextSearch(-1);a.stopPropagation();a.preventDefault();break}a.stopPropagation();a.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case f.TAB:b=this.get("displayedValue");if(c&&(b==c._messages.previousMessage||b==c._messages.nextMessage))break;d&&this._selectOption(d);case f.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},
_autoCompleteText:function(a){var b=this.focusNode;c.selectInputText(b,b.value.length);var d=this.ignoreCase?"toLowerCase":"substr";0==a[d](0).indexOf(this.focusNode.value[d](0))?(d=this.autoComplete?this._getCaretPos(b):b.value.length,d+1>b.value.length&&(b.value=a,c.selectInputText(b,d))):(b.value=a,c.selectInputText(b))},_openResultList:function(a,b,c){var d=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();a.length||0!=c.start?(this._nextSearch=this.dropDown.onPage=k.hitch(this,
function(b){a.nextPage(-1!==b);this.focus()}),this.dropDown.createOptions(a,c,k.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in c?(c.direction?this.dropDown.highlightFirstOption():c.direction||this.dropDown.highlightLastOption(),d&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(b[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)):this.closeDropDown()},
_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var a=this.get("displayedValue"),b=this.dropDown;!b||a!=b._messages.previousMessage&&a!=b._messages.nextMessage?"undefined"==typeof this.item?
(this.item=null,this.set("displayedValue",a)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(a,b,c){var d="";a&&(c||(c=this.store._oldAPI?this.store.getValue(a,this.searchAttr):a[this.searchAttr]),d=this._getValueField()!=this.searchAttr?this.store.getIdentity(a):c);this.set("value",d,b,c,a)},_announceOption:function(a){if(a){var b;
if(a==this.dropDown.nextButton||a==this.dropDown.previousButton)b=a.innerHTML,this.item=void 0,this.value="";else{var c=this.dropDown.items[a.getAttribute("item")];b=(this.store._oldAPI?this.store.getValue(c,this.searchAttr):c[this.searchAttr]).toString();this.set("item",c,!1,b)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",n.get(a,"id"));this._autoCompleteText(b)}},_selectOption:function(a){this.closeDropDown();a&&
this._announceOption(a);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(a){if(!this.dropDown){var b=this.id+"_popup";this.dropDown=new (k.isString(this.dropDownClass)?k.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:k.hitch(this,
this._selectOption),id:b,dir:this.dir,textDir:this.textDir})}this._lastInput=a;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new p({},this.srcNodeRef),!("value"in this.params))){var a=this.item=this.store.fetchSelectedItem();if(a){var b=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(a,b):a[b]}}},postCreate:function(){var a=d('label[for\x3d"'+
this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",a[0].id));this.inherited(arguments);q.after(this,"onSearch",k.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(a){a=this.labelFunc(a,this.store);var b=this.labelType;"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(a=this.doHighlight(a,this._lastInput),b="html");return{html:"html"==b,label:a}},doHighlight:function(a,b){var c=(this.ignoreCase?"i":"")+("all"==
this.highlightMatch?"g":""),d=this.queryExpr.indexOf("${0}");b=h.escapeString(b);return this._escapeHtml(a.replace(new RegExp((0==d?"^":"")+"("+b+")"+(d==this.queryExpr.length-4?"$":""),c),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(a){return a=String(a).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},
labelFunc:function(a,b){return(b._oldAPI?b.getValue(a,this.labelAttr||this.searchAttr):a[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(a,b,c,d){this._set("item",d||null);null==a&&(a="");this.inherited(arguments)}});m("dojo-bidi")&&b.extend({_setTextDirAttr:function(a){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",a)}});return b})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),
function(q,b,n,f,k,d){function h(b){return{id:b.value,value:b.value,name:n.trim(b.innerText||b.textContent||"")}}return q("dijit.form.DataList",k,{constructor:function(k,p){this.domNode=b.byId(p);n.mixin(this,k);this.id&&d.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:f("option",this.domNode).map(h)}])},destroy:function(){d.remove(this.id)},fetchSelectedItem:function(){var b=f("\x3e option[selected]",this.domNode)[0]||f("\x3e option",this.domNode)[0];return b&&h(b)}})})},
"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),function(q,b,n,f,k,d,h){return q("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(b){this._set("list",b)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(b){return new RegExp("^"+b.replace(/(\\.)|(\*)|(\?)|\W/g,function(b,c,a,d){return a?".*":
d?".":c?c:"\\"+b})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(d){if(!this.disabled&&
!this.readOnly){d=d.charOrCode;this._prev_key_backspace=!1;if(d==b.DELETE||d==b.BACKSPACE)this._maskValidSubsetError=this._prev_key_backspace=!0;if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(b){this._abortQuery();var f=this,c=n.clone(this.query),a={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},h=k.substitute(this.queryExpr,
[b.replace(/([\\\*\?])/g,"\\$1")]),g,e=function(){var b=f._fetchHandle=f.store.query(c,a);f.disabled||f.readOnly||g!==f._lastQuery||d(b,function(h){f._fetchHandle=null;f.disabled||f.readOnly||g!==f._lastQuery||d(b.total,function(b){h.total=b;var d=f.pageSize;if(isNaN(d)||d>h.total)d=h.total;h.nextPage=function(b){a.direction=b=!1!==b;a.count=d;b?(a.start+=h.length,a.start>=h.total&&(a.count=0)):(a.start-=d,0>a.start&&(a.count=Math.max(d+a.start,0),a.start=0));0>=a.count?(h.length=0,f.onSearch(h,c,
a)):e()};f.onSearch(h,c,a)})},function(a){f._fetchHandle=null;f._cancelingQuery||console.error(f.declaredClass+" "+a.toString())})};n.mixin(a,this.fetchProperties);this.store._oldAPI?g=h:(g=this._patternToRegExp(h),g.toString=function(){return h});this._lastQuery=c[this.searchAttr]=g;this._queryDeferHandle=this.defer(e,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var b=this.list;b&&(this.store=h.byId(b))}this.inherited(arguments)}})})},
"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),function(q,b,n,f,k,d,h,m){return q("dijit.form._ComboBoxMenu",[k,d,m,h],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(b.add(this.previousButton,"dijitMenuItemRtl"),b.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var b=this.ownerDocument.createElement("div");b.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");b.setAttribute("role","option");return b},onHover:function(d){b.add(d,"dijitMenuItemHover")},onUnhover:function(d){b.remove(d,
"dijitMenuItemHover")},onSelect:function(d){b.add(d,"dijitMenuItemSelected")},onDeselect:function(d){b.remove(d,"dijitMenuItemSelected")},_page:function(b){var c=0,a=this.domNode.scrollTop,d=n.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();c<d;){var f=this.getHighlightedOption();if(b){if(!f.previousSibling||"none"==f.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!f.nextSibling||"none"==f.nextSibling.style.display)break;this.selectNextNode()}f=
this.domNode.scrollTop;c+=(f-a)*(b?-1:1);a=f}},handleKey:function(b){switch(b.keyCode){case f.DOWN_ARROW:return this.selectNextNode(),!1;case f.PAGE_DOWN:return this._page(!1),!1;case f.UP_ARROW:return this.selectPreviousNode(),!1;case f.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(q,b,n,f,k){var d=b("dijit.form._ComboBoxMenuMixin"+
(f("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=k.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(b){this._set("value",b);this.onChange(b)},onClick:function(b){if(b==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(b==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(b)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(b,d){var f=this._createMenuItem();b=d(b);b.html?f.innerHTML=b.label:f.appendChild(f.ownerDocument.createTextNode(b.label));""==f.innerHTML&&(f.innerHTML="\x26#160;");return f},createOptions:function(b,d,f){this.items=b;this.previousButton.style.display=0==d.start?"none":"";n.set(this.previousButton,"id",this.id+
"_prev");q.forEach(b,function(a,b){a=this._createOption(a,f);a.setAttribute("item",b);n.set(a,"id",this.id+b);this.nextButton.parentNode.insertBefore(a,this.nextButton)},this);var c=!1;b.total&&!b.total.then&&-1!=b.total?d.start+d.count<b.total?c=!0:d.start+d.count>b.total&&d.count==b.length&&(c=!0):d.count==b.length&&(c=!0);this.nextButton.style.display=c?"":"none";n.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var b=this.containerNode;2<b.childNodes.length;)b.removeChild(b.childNodes[b.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});f("dojo-bidi")&&(d=b("dijit.form._ComboBoxMenuMixin",
d,{_createOption:function(){var b=this.inherited(arguments);this.applyTextDir(b);return b}}));return d})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(q,b,n,f){return q("dijit.form._ListMouseMixin",f,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(b,d){this._setSelectedAttr(d,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(d)})},_onMouseDown:function(b,d){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(d,!1)},_onMouseUp:function(b,d){this._isDragging=!1;var f=this.selected,k=this._hoveredNode;f&&d==f?this.defer(function(){this._onClick(b,
f)}):k&&this.defer(function(){this._onClick(b,k)})},_onMouseOut:function(b,d){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(b,d){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=d;this.onHover(d);this._isDragging&&this._setSelectedAttr(d,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(q,b,n){return q("dijit.form._ListBase",null,{selected:null,_listConnect:function(f,k){var d=this;return d.own(b(d.containerNode,b.selector(function(b,d,f){return b.parentNode==f},f),function(b){d[k](b,this)}))},selectFirstNode:function(){for(var b=this.containerNode.firstChild;b&&"none"==b.style.display;)b=b.nextSibling;this._setSelectedAttr(b,!0)},selectLastNode:function(){for(var b=this.containerNode.lastChild;b&&"none"==b.style.display;)b=b.previousSibling;this._setSelectedAttr(b,
!0)},selectNextNode:function(){var b=this.selected;if(b){for(b=b.nextSibling;b&&"none"==b.style.display;)b=b.nextSibling;b?this._setSelectedAttr(b,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var b=this.selected;if(b){for(b=b.previousSibling;b&&"none"==b.style.display;)b=b.previousSibling;b?this._setSelectedAttr(b,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(b,k){if(this.selected!=b){var d=this.selected;if(d)this.onDeselect(d);
b&&(k&&n.scrollIntoView(b),this.onSelect(b));this._set("selected",b)}else if(b)this.onSelect(b)}})})},"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',
"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"*now":function(q){q(['dojo/i18n!*preload*jimu/nls/main*["ar","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hi","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sl","sr","sv","th","tr","zh-cn","vi","uk","zh-hk","zh-tw","ROOT"]'])}}});
define("./ConfigManager ./LayoutManager ./DataManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query dojo/domReady! esri/config esri/request esri/core/urlUtils esri/identity/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main dojo/ready".split(" "),function(q,b,n,f,k,d,h,m,p,c,a,l,g,e,u,t,r,y,w,x,v,z,A,B){function C(){var a=window.location.search;if(""===a)return{};var a=g.queryToObject(a.substr(1)),
b;for(b in a)a[b]=x.sanitizeHTML(a[b]);return a}d={};p=x.getEsriConfigRequestObject();p.timeout=18E4;"function"!==typeof c.getAll&&(c.getAll=function(a){var b=[];(a=c(a))&&b.push(a);return b});window.jimuNls=A;y.setProtocolErrorHandler(function(){return!0});y=x.getAncestorWindow();var E=!1;try{E=0===y.location.href.indexOf("https://")}catch(H){}var F=/\/SceneServer\/layers\/\d+\/?$/;p.interceptors=[{before:function(a){a&&"object"===typeof a.requestOptions&&!a.requestOptions.content&&F.test(a.url)&&
(a.content={f:"json"});a.requestOptions.query&&a.requestOptions.query.printFlag&&(a.timeout=3E5);E&&(a.url=a.url.replace(/^http(s?):\/\//gi,"https://"));-1===a.url.indexOf("/queryRelatedRecords?")||x.isHostedService(a.url)||(a.url=a.url.replace("FeatureServer","MapServer"))}}];h(window,"mousedown",function(a){if(m.isMiddle(a))return a.preventDefault(),a.stopPropagation(),a.returnValue=!1});String.prototype.startWith=function(a){return this.substr(0,a.length)===a?!0:!1};String.prototype.endWith=function(a){return this.substr(this.length-
a.length,a.length)===a?!0:!1};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=k.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="2.12";window.productVersion="Online 7.1";d.initApp=function(){var a,c;console.log("jimu.js init...");a=C();n.getInstance();f.setStyle(jimuConfig.loadingId,"display","none");f.setStyle(jimuConfig.mainPageId,
"display","block");c=b.getInstance({mapId:jimuConfig.mapId,urlParams:a},jimuConfig.layoutId);a=q.getInstance(a);c.startup();a.loadConfig();B(function(){setTimeout(function(){f.removeClass(document.body,"dj_a11y")},50)})};return d});